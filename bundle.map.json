{"version":3,"sources":["../../../../AppData/Roaming/npm/node_modules/browserify/node_modules/browser-pack/_prelude.js","main.js","RequestAnimationFrame.js","rubbable.js","js/THREEx.KeyboardState.js","libgif.js","js/Utils.js","js/Globals.js","js/Game.js","js/PointerLockControls.js","js/Systems.js","js/ResourceManager.js","js/SoundController.js","js/MouseController.js","js/EntityFactory.js","node_modules/physijs-browserify/physi.js","node_modules/js-class/class.js","node_modules/howler/howler.js","node_modules/stats.js/src/Stats.js","node_modules/three/three.js","js/Components.js","b3core.0.1.0.js","node_modules/tiny-ecs/index.js","js/components/Jump.js","js/components/Identifier.js","js/components/Position.js","js/components/OneTimeHit.js","js/components/CameraPitch.js","js/components/Steaming.js","js/components/Ai.js","js/components/CameraFollow.js","js/components/Velocity.js","js/components/Drawable.js","js/components/Gun.js","js/components/Hurt.js","js/components/Bullet.js","js/components/Health.js","js/components/Expirable.js","js/components/ShootDelay.js","node_modules/tiny-ecs/lib/Messanger.js","node_modules/tiny-ecs/lib/ObjectPool.js","node_modules/tiny-ecs/lib/QuadTree.js","node_modules/tiny-ecs/lib/EntityManager.js","node_modules/tiny-ecs/lib/Spatial.js","node_modules/tiny-ecs/lib/Entity.js","node_modules/tiny-ecs/lib/Vec2.js","node_modules/tiny-ecs/lib/Event.js","node_modules/tiny-ecs/node_modules/typedef/index.js","node_modules/tiny-ecs/node_modules/typedef/lib/mixin.js","node_modules/tiny-ecs/node_modules/typedef/lib/getArguments.js","node_modules/tiny-ecs/node_modules/typedef/lib/extends.js","node_modules/tiny-ecs/node_modules/typedef/lib/getName.js"],"names":["init","Globals","instance","hudElement","document","getElementById","healthElement","scoreElement","reloadingElement","reloadImg","SuperGif","gif","load","overlayElement","gameOptions","container","loadingContainer","blocker","instructions","crosshair","modelsToPreload","soundsToPreload","game","Game","start","global","Class","require","THREE","THREEx","Physijs","Stats","Howler","Utils","scripts","worker","ammo","window","requestAnimationFrame","webkitRequestAnimationFrame","mozRequestAnimationFrame","oRequestAnimationFrame","msRequestAnimationFrame","callback","element","setTimeout","root","factory","define","amd","exports","module","RubbableGif","this","options","sup","register_canvas_handers","isvp","x","vp_l","canvas","get_canvas","w","vp_w","width","maxDistance","Math","floor","get_length","startX","startTime","cantouch","aj","last_played","addEventListener","e","preventDefault","get_auto_play","pause","pos","touches","length","layerX","progress","move_to","timeStamp","pageX","play","currentX","currentDistance","abs","currentTime","get_current_frame","move_relative","orig_load","KeyboardState","domElement","keyCodes","modifiers","_this","_onKeyDown","event","_onKeyChange","_onKeyUp","_onBlur","prop","prototype","destroy","removeEventListener","MODIFIERS","ALIAS","left","up","right","down","space","pageup","pagedown","tab","escape","keyCode","pressed","type","shiftKey","ctrlKey","altKey","metaKey","keyDesc","keys","split","i","key","indexOf","Object","toUpperCase","charCodeAt","eventMatches","aliases","aliasKeys","bitsToNum","ba","reduce","s","n","byteToBitArr","bite","a","push","Stream","data","len","readByte","Error","Uint8Array","readBytes","bytes","read","String","fromCharCode","readUnsigned","lzwDecode","minCodeSize","code","last","readCode","size","output","clearCode","eoiCode","codeSize","dict","clear","concat","apply","parseGIF","st","handler","parseCT","entries","ct","readSubBlocks","parseHeader","hdr","sig","ver","height","bits","gctFlag","shift","colorRes","splice","sorted","gctSize","bgColor","pixelAspectRatio","gct","parseExt","block","parseGCExt","reserved","disposalMethod","userInput","transparencyGiven","delayTime","transparencyIndex","terminator","gce","parseComExt","comment","com","parsePTExt","ptHeader","ptData","pte","parseAppExt","parseNetscapeExt","unknown","iterations","app","NETSCAPE","parseUnknownAppExt","appData","identifier","authCode","parseUnknownExt","label","extType","parseImg","img","deinterlace","pixels","newPixels","Array","rows","cpRow","toRow","fromRow","fromPixels","slice","offsets","steps","pass","leftPos","topPos","lctFlag","interlaced","lctSize","lct","lzwMinCodeSize","lzwData","parseBlock","sentinel","eof","toString","parse","opts","vp_t","vp_h","c_w","c_h","is_vp","stream","loadError","loading","transparency","delay","disposalRestoreFromIdx","lastDisposalMethod","frame","lastImg","playing","forward","ctx_scaled","frames","frameOffsets","auto_play","getAttribute","ctx","toolbar","tmpCanvas","onEndListener","hasOwnProperty","on_end","loopDelay","loop_delay","overrideLoopMode","loop_mode","drawWhileLoading","draw_while_loading","showProgressBar","show_progress_bar","doParse","err","doLoadError","setSizes","h","get_canvas_scale","style","minWidth","getContext","setTransform","setFrameOffset","offset","y","doShowProgress","draw","mid","top","fillStyle","fillRect","originOfError","drawError","strokeStyle","lineWidth","moveTo","lineTo","stroke","doHdr","_hdr","doGCE","pushFrame","getImageData","doImg","currIdx","putImageData","clearRect","imgData","cdd","forEach","pixel","set","scale","drawImage","player","iterationCount","getNextFrameNo","delta","stepFrame","amount","putFrame","completeLoop","step","stepping","doStep","nextFrameNo","parseInt","globalCompositeOperation","current_frame","frame_idx","doDecodeProgress","doNothing","withProgress","fn","load_callback","parent","parentNode","span","createElement","className","appendChild","insertBefore","removeChild","initialized","max_width","load_setup","get_playing","get_loading","load_url","src","XMLHttpRequest","overrideMimeType","onloadstart","onload","responseText","onprogress","lengthComputable","loaded","total","onerror","open","send","load_raw","arr","set_frame_offset","randomRange","min","max","random","constructor","dt","score","sound","statics",{"end":{"file":"?","comments_before":[],"nlb":false,"endpos":352,"endcol":16,"endline":21,"pos":344,"col":8,"line":21,"value":"instance","type":"name"},"start":{"file":"?","comments_before":[],"nlb":false,"endpos":352,"endcol":16,"endline":21,"pos":344,"col":8,"line":21,"value":"instance","type":"name"},"name":"instance"},"_instance","DIR","ENTITY_TYPES","enemy","ground","obstacle","bullet","stats","prevTime","performance","now","renderer","scene","camera","paused","controlsEnabled","controls","systems","postPhysicsSystems","percentModelsLoaded","percentSoundsLoaded","systemsDelay","runImmediately","undefined","onResize","bind","onkeydown","onKeyDown","onMouseDown","onMouseUp","WebGLRenderer","antialias","setSize","innerWidth","innerHeight","setClearColor","setMode","position","bottom","body","Scene","setGravity","Vector3","aspectRatio","PerspectiveCamera","add","PointerLockControls","getObject","ambientLight","AmbientLight","dirLight","DirectionalLight","EntityFactory","makeGround","makePlayer","controlsObject","cameraOffset","gunOffset","hp","makeEnemy","aiTarget","bulletSpeed","setupAudio","PlayerInputSystem","entities","AISystem","MovementSystem","ExpirableSystem","CameraPitchSystem","ShootDelaySystem","HurtSystem","PlayerHealthSystem","HealthBarSystem","DeathSystem","SteamRemovalSystem","SteamUpdateSystem","PhysicsUpdateSystem","CameraFollowSystem","loadModels","loadSounds","AudioContext","webkitAudioContext","SoundController","context","following","path","loadSound","soundLoaded","percentPerSound","visibility","display","scrollTop","documentElement","update","initPointerLock","ResourceManager","loadModel","modelLoaded","model","percentPerModel","animationFrame","time","system","simulate","MouseController","render","aspect","updateProjectionMatrix","which","KEY_CODES","button","isDown","wasPressed","havePointerLock","pointerlockchange","pointerLockElement","mozPointerLockElement","webkitPointerLockElement","enabled","pointerlockerror","requestPointerLock","mozRequestPointerLock","webkitRequestPointerLock","test","navigator","userAgent","fullscreenchange","fullscreenElement","mozFullscreenElement","mozFullScreenElement","requestFullscreen","mozRequestFullscreen","mozRequestFullScreen","webkitRequestFullscreen","innerHTML","rotation","pitchObject","Object3D","yawObject","moveForward","moveBackward","moveLeft","moveRight","isOnObject","canJump","velocity","mass","moveSpeed","minimumY","onMouseMove","onKeyUp","movementX","mozMovementX","webkitMovementX","movementY","mozMovementY","webkitMovementY","PI_2","bool","getDirection","direction","Euler","v","copy","applyEuler","z","translateX","translateY","translateZ","PI","C","keyboard","jumped","players","queryTag","entity","dv","MOVE_SPEED","jump","JUMP_FORCE","applyMatrix4","rotationMatrix","shootDelay","canShoot","cameraFollow","gunPos","setFromMatrixPosition","gun","mesh","matrixWorld","bulletPos","clone","bulletOffset","yMatrix","Matrix4","extractRotation","matrix","multiply","bulletRot","object","makePotato","drawable","owner","getSound","setPosition","setVelocity","setOrientation","baseDirection","basePos","piOver2","bulletDirection","makeFry","moveables","queryComponents","Position","Velocity","doMove","hasComponent","Drawable","applyCentralImpulse","expirables","Expirable","expirable","age","maxAge","remove","follows","CameraFollow","shooters","ShootDelay","timer","delayTheshold","hurtables","Hurt","hurt","invulnerabilityFrames","material","color","hurtColor","hasTag","backgroundColor","originalColor","removeComponent","health","changed","percent","maxHP","percentRounded","round","Color","getHexString","mortals","Health","healthBar","_physijs","collision_type","COLLISION_TYPES","singularities","AI","ai","tree","target","blackboard","tick","steaming","Steaming","particles","particleCount","vertices","particle","verticesNeedUpdate","Bullet","isHot","pitchables","CameraPitch","cameraPitch","getLinearVelocity","Model","geometry","loadingManager","LoadingManager","jsonLoader","JSONLoader","textures","models","getTexture","ImageUtils","loadTexture","materials","MeshFaceMaterial","Sound","source","createBufferSource","volume","createGain","panner","createPanner","connect","mainVolume","loop","self","request","responseType","decodeAudioData","response","buffer","alert","orientation","destination","sounds","setListenerPosition","applyProjection","normalize","setListenerOrientation","listener","EntityManager","b3","createEntity","addTag","addComponent","Identifier","Jump","Gun","CapsuleMesh","createMaterial","MeshBasicMaterial","MASS","collision_masks","enemyBullet","setDamping","setAngularFactor","other_object","relative_velocity","relative_rotation","contact_normal","makeGun","cameraControls","MeshPhongMaterial","playerBullet","Mesh","BoxGeometry","FaceNode","Action","name","parameters","facing","__Action_initialize","initialize","settings","_manager","FAILURE","parentPos","followingPos","posDif","sub","angle","angleTo","SUCCESS","lookAtMatrix","lookAt","parentRotation","Quaternion","setFromEuler","targetRotation","setFromRotationMatrix","str","slerp","setFromQuaternion","__dirtyRotation","RUNNING","RandomChildNode","Composite","__Composite_initialize","chance","children","status","_execute","FollowNode","distance","distanceTo","difference","subVectors","normal","ShootNode","shootingAt","spawnLocation","spawnOffset","followingVel","multiplyScalar","predictedPos","velOffset","BehaviorTree","Sequence","Blackboard","potato","OneTimeHit","mat","setHex","hitPlayer","hitEnemy","oneTimeHit","alreadyHit","uuid","touchedGround","soundPos","soundForward","vel","Geometry","smokeTexture","smokeMaterial","PointCloudMaterial","map","transparent","depthWrite","blending","AdditiveBlending","PointCloud","sortParticles","Gyroscope","fry","BoxMesh","mainTex","wrapS","wrapT","RepeatWrapping","diffuseTex","specularTex","displacementMap","specularMap","nothing","SUPPORT_TRANSFERABLE","Eventable","getObjectId","getEulerXYZFromQuaternion","getQuatertionFromEuler","convertWorldPositionToObject","addObjectChildren","_temp1","_temp2","_is_simulating","_Physijs","_temp_vector3_1","_temp_vector3_2","_temp_matrix4_1","_quaternion_1","MESSAGE_TYPES","WORLDREPORT","COLLISIONREPORT","VEHICLEREPORT","CONSTRAINTREPORT","REPORT_ITEMSIZE","COLLISIONREPORT_ITEMSIZE","VEHICLEREPORT_ITEMSIZE","CONSTRAINTREPORT_ITEMSIZE","_eventListeners","event_name","index","dispatchEvent","call","arguments","make","obj","_id","atan2","asin","c1","s1","c2","s2","c3","s3","c1c2","s1s2","cos","sin","identity","makeRotationFromQuaternion","quaternion","getInverse","noConflict","friction","restitution","physijs_material","id","PointConstraint","objecta","objectb","appliedImpulse","positiona","positionb","getDefinition","HingeConstraint","axis","setLimits","low","high","bias_factor","relaxation_factor","execute","constraint","enableAngularMotor","acceleration","disableMotor","SliderConstraint","lin_lower","lin_upper","ang_lower","ang_upper","setRestitution","linear","angular","enableLinearMotor","disableLinearMotor","disableAngularMotor","ConeTwistConstraint","axisa","axisb","setLimit","enableMotor","setMaxMotorImpulse","max_impulse","setMotorTarget","DOFConstraint","setLinearLowerLimit","limit","setLinearUpperLimit","setAngularLowerLimit","setAngularUpperLimit","configureAngularMotor","low_angle","high_angle","max_force","params","_worker","Worker","transferableMessage","webkitPostMessage","postMessage","_materials_ref_counts","_objects","_vehicles","_constraints","ab","ArrayBuffer","byteLength","console","log","message","filename","lineno","onmessage","_temp","Float32Array","_updateScene","_updateCollisions","_updateVehicles","_updateConstraints","cmd","debug","dir","fixedTimeStep","rateLimit","num_objects","__dirtyPosition","linearVelocity","angularVelocity","vehicle","wheel","wheels","addVectors","j","object2","id1","id2","collisions","normal_offsets","getAngularVelocity","normal_offset","addConstraint","show_marker","marker","SphereGeometry","MeshNormalMaterial","onSimulationResume","removeConstraint","updateMatrix","updateMatrixWorld","position_offset","world","Vehicle","materialId","depth","pop","setFixedTimeStep","gravity","timeStep","maxSubSteps","object_id","quat","boundingBox","computeBoundingBox","__defineGetter__","__defineSetter__","force","applyImpulse","impulse_x","impulse_y","impulse_z","applyTorque","torque_x","torque_y","torque_z","applyCentralForce","applyForce","force_x","force_y","force_z","setAngularVelocity","setLinearVelocity","factor","setLinearFactor","setCcdMotionThreshold","threshold","setCcdSweptSphereRadius","radius","PlaneMesh","faces","HeightfieldMesh","xdiv","ydiv","xsize","ysize","xpts","sqrt","ypts","absMaxHeight","b","points","SphereMesh","boundingSphere","computeBoundingSphere","pow","CylinderMesh","ConeMesh","ConcaveMesh","face","triangles","Face3","c","Face4","d","ConvexMesh","tuning","VehicleTuning","rigidBody","suspension_stiffness","suspension_compression","suspension_damping","max_suspension_travel","friction_slip","max_suspension_force","addWheel","wheel_geometry","wheel_material","connection_point","wheel_direction","wheel_axle","suspension_rest_length","wheel_radius","is_front_wheel","castShadow","receiveShadow","setSteering","steering","setBrake","brake","applyEngineForce","inherit","dest","noParent","getOwnPropertyNames","desc","getOwnPropertyDescriptor","defineProperty","__proto__","findType","meta","implType","implMeta","proto","base","implements","classProto","isArray","implementedType","extend","theClass","value","enumerable","configurable","writable","Checker","typeOf","typeInfo","an","is","VERSION","cache","usingWebAudio","noAudio","Audio","masterGain","createGainNode","gain","HowlerGlobal","codecs","_volume","_muted","_howls","_codecs","iOSAutoEnable","vol","parseFloat","_webAudio","_audioNode","mute","_setMuted","unmute","muted","ext","_enableiOSAudio","_iOSEnabled","unlock","createBuffer","noteOn","playbackState","PLAYING_STATE","FINISHED_STATE","audioTest","mp3","canPlayType","replace","opus","ogg","wav","aac","m4a","mp4","weba","Howl","o","_autoplay","autoplay","_buffer","_duration","duration","_format","format","_loop","_loaded","_sprite","sprite","_src","_pos3d","pos3d","_urls","urls","_rate","rate","_model","_onload","_onloaderror","onloaderror","_onend","onend","_onpause","onpause","_onplay","onplay","_onendTimer","_setupAudioNode","url","on","urlItem","exec","toLowerCase","loadBuffer","newNode","error","_pos","preload","ceil","_default","stop","_inactiveNode","node","timerId","soundId","Date","_nodeById","_clearEndTimer","loopStart","loopEnd","refreshBuffer","_playStart","bufferSource","noteGrainOn","readyState","isCocoonJS","playSprite","activeNode","_activeNode","noteOff","isNaN","panningModel","fade","from","to","diff","stepTime","change","toVol","fadeIn","fadeOut","_drainPool","listenerEvent","inactive","disconnect","clearTimeout","events","off","fnString","unload","nodes","atob","dataView","xhr","_gainNode","arraybuffer","playbackRate","ms","msMin","Infinity","msMax","fps","fpsMin","fpsMax","mode","cssText","fpsDiv","fpsText","fpsGraph","bar","msDiv","msText","msGraph","updateGraph","dom","child","firstChild","REVISION","begin","end","textContent","sign","warn","MOUSE","LEFT","MIDDLE","RIGHT","CullFaceNone","CullFaceBack","CullFaceFront","CullFaceFrontBack","FrontFaceDirectionCW","FrontFaceDirectionCCW","BasicShadowMap","PCFShadowMap","PCFSoftShadowMap","FrontSide","BackSide","DoubleSide","NoShading","FlatShading","SmoothShading","NoColors","FaceColors","VertexColors","NoBlending","NormalBlending","SubtractiveBlending","MultiplyBlending","CustomBlending","AddEquation","SubtractEquation","ReverseSubtractEquation","MinEquation","MaxEquation","ZeroFactor","OneFactor","SrcColorFactor","OneMinusSrcColorFactor","SrcAlphaFactor","OneMinusSrcAlphaFactor","DstAlphaFactor","OneMinusDstAlphaFactor","DstColorFactor","OneMinusDstColorFactor","SrcAlphaSaturateFactor","MultiplyOperation","MixOperation","AddOperation","UVMapping","CubeReflectionMapping","CubeRefractionMapping","EquirectangularReflectionMapping","EquirectangularRefractionMapping","SphericalReflectionMapping","ClampToEdgeWrapping","MirroredRepeatWrapping","NearestFilter","NearestMipMapNearestFilter","NearestMipMapLinearFilter","LinearFilter","LinearMipMapNearestFilter","LinearMipMapLinearFilter","UnsignedByteType","ByteType","ShortType","UnsignedShortType","IntType","UnsignedIntType","FloatType","HalfFloatType","UnsignedShort4444Type","UnsignedShort5551Type","UnsignedShort565Type","AlphaFormat","RGBFormat","RGBAFormat","LuminanceFormat","LuminanceAlphaFormat","RGBEFormat","RGB_S3TC_DXT1_Format","RGBA_S3TC_DXT1_Format","RGBA_S3TC_DXT3_Format","RGBA_S3TC_DXT5_Format","RGB_PVRTC_4BPPV1_Format","RGB_PVRTC_2BPPV1_Format","RGBA_PVRTC_4BPPV1_Format","RGBA_PVRTC_2BPPV1_Format","Projector","projectVector","vector","project","unprojectVector","unproject","pickingRay","CanvasRenderer","setRGB","r","g","setStyle","hex","setHSL","l","hue2rgb","p","q","t","ColorKeywords","copyGammaToLinear","gammaFactor","copyLinearToGamma","safeInverse","convertGammaToLinear","convertLinearToGamma","getHex","getHSL","optionalTarget","hue","saturation","hsl","lightness","getStyle","offsetHSL","addColors","color1","color2","addScalar","lerp","alpha","equals","fromArray","array","toArray","aliceblue","antiquewhite","aqua","aquamarine","azure","beige","bisque","black","blanchedalmond","blue","blueviolet","brown","burlywood","cadetblue","chartreuse","chocolate","coral","cornflowerblue","cornsilk","crimson","cyan","darkblue","darkcyan","darkgoldenrod","darkgray","darkgreen","darkgrey","darkkhaki","darkmagenta","darkolivegreen","darkorange","darkorchid","darkred","darksalmon","darkseagreen","darkslateblue","darkslategray","darkslategrey","darkturquoise","darkviolet","deeppink","deepskyblue","dimgray","dimgrey","dodgerblue","firebrick","floralwhite","forestgreen","fuchsia","gainsboro","ghostwhite","gold","goldenrod","gray","green","greenyellow","grey","honeydew","hotpink","indianred","indigo","ivory","khaki","lavender","lavenderblush","lawngreen","lemonchiffon","lightblue","lightcoral","lightcyan","lightgoldenrodyellow","lightgray","lightgreen","lightgrey","lightpink","lightsalmon","lightseagreen","lightskyblue","lightslategray","lightslategrey","lightsteelblue","lightyellow","lime","limegreen","linen","magenta","maroon","mediumaquamarine","mediumblue","mediumorchid","mediumpurple","mediumseagreen","mediumslateblue","mediumspringgreen","mediumturquoise","mediumvioletred","midnightblue","mintcream","mistyrose","moccasin","navajowhite","navy","oldlace","olive","olivedrab","orange","orangered","orchid","palegoldenrod","palegreen","paleturquoise","palevioletred","papayawhip","peachpuff","peru","pink","plum","powderblue","purple","red","rosybrown","royalblue","saddlebrown","salmon","sandybrown","seagreen","seashell","sienna","silver","skyblue","slateblue","slategray","slategrey","snow","springgreen","steelblue","tan","teal","thistle","tomato","turquoise","violet","wheat","white","whitesmoke","yellow","yellowgreen","_x","_y","_z","_w","onChangeCallback","euler","order","setFromAxisAngle","halfAngle","m","te","elements","m11","m12","m13","m21","m22","m23","m31","m32","m33","trace","setFromUnitVectors","v1","EPS","vFrom","vTo","dot","crossVectors","inverse","conjugate","lengthSq","multiplyQuaternions","qax","qay","qaz","qaw","qbx","qby","qbz","qbw","multiplyVector3","applyQuaternion","qb","cosHalfTheta","halfTheta","acos","sinHalfTheta","ratioA","ratioB","onChange","qa","qm","Vector2","setX","setY","setComponent","getComponent","subScalar","divide","divideScalar","scalar","invScalar","clamp","clampScalar","minVal","maxVal","roundToZero","negate","distanceToSquared","dx","dy","setLength","oldLength","lerpVectors","v2","fromAttribute","attribute","itemSize","setZ","multiplyVectors","applyAxisAngle","applyMatrix3","qx","qy","qz","qw","ix","iy","iz","iw","multiplyMatrices","projectionMatrix","transformDirection","lengthManhattan","cross","ax","ay","az","bx","by","bz","projectOnVector","projectOnPlane","planeNormal","reflect","theta","dz","setEulerFromRotationMatrix","setEulerFromQuaternion","getPositionFromMatrix","getScaleFromMatrix","setFromMatrixScale","getColumnFromMatrix","setFromMatrixColumn","sx","sy","sz","me","Vector4","setW","setAxisAngleFromQuaternion","setAxisAngleFromRotationMatrix","epsilon","epsilon2","xx","yy","zz","xy","xz","yz","_order","DefaultOrder","RotationOrders","setFromVector3","reorder","newOrder","toVector3","optionalResult","Line3","line","center","result","distanceSq","at","closestPointToPointParameter","startP","startEnd","point","clampToLine","startEnd2","startEnd_startP","closestPointToPoint","Box2","setFromPoints","makeEmpty","il","expandByPoint","setFromCenterAndSize","halfSize","box","empty","expandByVector","expandByScalar","containsPoint","containsBox","getParameter","isIntersectionBox","clampPoint","distanceToPoint","clampedPoint","intersect","union","translate","Box3","setFromObject","scope","traverse","BufferGeometry","attributes","positions","getBoundingSphere","Sphere","Matrix3","n11","n12","n13","n21","n22","n23","n31","n32","n33","multiplyVector3Array","applyToVector3Array","determinant","f","throwOnInvertible","det","msg","transpose","tmp","flattenToArrayOffset","getNormalMatrix","transposeIntoArray","n14","n24","n34","n41","n42","n43","n44","extractPosition","copyPosition","extractBasis","xAxis","yAxis","zAxis","makeBasis","scaleX","scaleY","scaleZ","makeRotationFromEuler","ae","af","be","bf","ce","cf","de","df","ac","ad","bc","bd","setRotationFromQuaternion","x2","y2","z2","wx","wy","wz","eye","a11","a12","a13","a14","a21","a22","a23","a24","a31","a32","a33","a34","a41","a42","a43","a44","b11","b12","b13","b14","b21","b22","b23","b24","b31","b32","b33","b34","b41","b42","b43","b44","multiplyToArray","multiplyVector4","rotateAxis","crossVector","getPosition","rotateX","rotateY","rotateZ","rotateByAxis","getMaxScaleOnAxis","scaleXSq","scaleYSq","scaleZSq","makeTranslation","makeRotationX","makeRotationY","makeRotationZ","makeRotationAxis","tx","ty","makeScale","compose","decompose","invSX","invSY","invSZ","makeFrustum","near","far","makePerspective","fov","ymax","degToRad","ymin","xmin","xmax","makeOrthographic","Ray","origin","ray","recast","directionDistance","distanceSqToSegment","segCenter","segDir","v0","optionalPointOnRay","optionalPointOnSegment","s0","sqrDist","extDet","segExtent","a01","b0","b1","invDet","isIntersectionSphere","sphere","intersectSphere","tca","d2","radius2","thc","t0","t1","isIntersectionPlane","plane","distToPoint","denominator","distanceToPlane","constant","intersectPlane","intersectBox","tmin","tmax","tymin","tymax","tzmin","tzmax","invdirx","invdiry","invdirz","intersectTriangle","edge1","edge2","backfaceCulling","DdN","DdQxE2","DdE1xQ","QdN","matrix4","optionalCenter","maxRadiusSq","intersectsSphere","radiusSum","deltaLengthSq","getBoundingBox","Frustum","p0","p1","p2","p3","p4","p5","planes","Plane","frustum","setFromMatrix","me0","me1","me2","me3","me4","me5","me6","me7","me8","me9","me10","me11","me12","me13","me14","me15","setComponents","intersectsObject","negRadius","intersectsBox","d1","setFromNormalAndCoplanarPoint","setFromCoplanarPoints","inverseNormalLength","distanceToSphere","projectPoint","orthoPoint","perpendicularMagnitude","isIntersectionLine","startSign","endSign","intersectLine","coplanarPoint","m1","optionalNormalMatrix","normalMatrix","newNormal","newCoplanarPoint","generateUUID","chars","rnd","join","clampBottom","mapLinear","a1","a2","b2","smoothstep","smootherstep","random16","randInt","randFloat","randFloatSpread","range","degreeToRadiansFactor","degrees","radToDeg","radianToDegreesFactor","radians","isPowerOfTwo","nextPowerOfTwo","Spline","interpolate","t2","t3","intPoint","weight","w2","w3","pa","pb","pc","pd","v3","initFromArray","getPoint","k","getControlPointsArray","coords","getLength","nSubDivisions","nSamples","oldIntPoint","oldPosition","tmpVec","chunkLengths","totalLength","chunks","reparametrizeByArcLength","samplingCoef","indexCurrent","indexNext","realDistance","sampling","newpoints","sl","Triangle","resultLengthSq","barycoordFromPoint","dot00","dot01","dot02","dot11","dot12","denom","invDenom","u","setFromPointsAndIndices","i0","i1","i2","triangle","area","midpoint","Clock","autoStart","oldTime","elapsedTime","running","getElapsedTime","getDelta","newTime","EventDispatcher","hasEventListener","_listeners","listeners","listenerArray","Raycaster","Sprite","LOD","Line","descSort","intersectObject","raycaster","intersects","recursive","raycast","precision","linePrecision","setFromCamera","OrthographicCamera","sort","intersectObjects","objects","Object3DIdCount","DefaultUp","onRotationChange","onQuaternionChange","defineProperties","rotationAutoUpdate","matrixAutoUpdate","matrixWorldNeedsUpdate","visible","frustumCulled","renderOrder","userData","eulerOrder","useQuaternion","applyMatrix","setRotationFromAxisAngle","setRotationFromEuler","setRotationFromMatrix","rotateOnAxis","q1","translateOnAxis","localToWorld","worldToLocal","getChildByName","getObjectByName","getObjectById","getObjectByProperty","getWorldPosition","getWorldQuaternion","getWorldRotation","getWorldScale","getWorldDirection","traverseVisible","traverseAncestors","toJSON","metadata","version","generator","geometries","parseGeometry","json","parseMaterial","parseObject","JSON","stringify","intensity","PointLight","decay","SpotLight","exponent","HemisphereLight","groundColor","materialIndex","vertexNormals","vertexColors","vertexTangents","BufferAttribute","needsUpdate","copyAt","index1","index2","setXY","setXYZ","setXYZW","Int8Attribute","Uint8Attribute","Uint8ClampedAttribute","Int16Attribute","Uint16Attribute","Int32Attribute","Uint32Attribute","Float32Attribute","Float64Attribute","DynamicBufferAttribute","updateRange","count","create","GeometryIdCount","attributesKeys","drawcalls","addAttribute","addDrawCall","indexOffset","fromGeometry","faceVertexUvs","hasFaceVertexUv","hasFaceVertexNormals","normals","colors","uvs","i3","na","nb","nc","fc","vca","vcb","vcc","uva","uvb","uvc","bb","computeFaceNormals","computeVertexNormals","vA","vB","vC","pA","pB","pC","cb","indices","jl","normalizeNormals","computeTangents","handleTriangle","uvA","uvB","uvC","x1","y1","z1","sdir","tdir","tan1","tan2","handleVertex","n2","tmp2","tangents","uv","nVertices","tangent","iA","iB","iC","computeOffsets","facesCount","sortedIndices","Uint16Array","indexPtr","vertexPtr","duplicatedVertices","newVerticeMaps","faceVertices","Int32Array","vertexMap","revVertexMap","findex","vo","vid","faceMax","new_offset","new_vid","reorderBuffers","merge","attribute1","attributeArray1","attribute2","attributeArray2","attributeSize","indexBuffer","indexMap","vertexCount","sortedAttributes","attr","sourceArray","attrArray","attrSize","sortedAttr","numItems","sourceAttr","dispose","morphTargets","morphColors","morphNormals","skinWeights","skinIndices","lineDistances","hasTangents","dynamic","elementsNeedUpdate","uvsNeedUpdate","normalsNeedUpdate","tangentsNeedUpdate","colorsNeedUpdate","lineDistancesNeedUpdate","groupsNeedUpdate","vertex","fromBufferGeometry","tempNormals","tempUVs","addFace","drawcall","fl","areaWeighted","vl","computeMorphNormals","__originalFaceNormal","__originalVertexNormals","tmpGeo","faceNormals","faceNormal","dstNormalsFace","dstNormalsVertex","ua","ub","uc","vertexIndex","faceIndex","computeLineDistances","materialIndexOffset","vertexOffset","vertices1","vertices2","faces1","faces2","uvs1","uvs2","vertexCopy","faceCopy","faceVertexNormals","faceVertexColors","uvCopy","mergeMesh","mergeVertices","verticesMap","unique","changes","precisionPoints","faceIndicesToRemove","dupIndex","idx","setBit","getNormalIndex","hash","normalsHash","getColorIndex","colorsHash","getUvIndex","uvsHash","hasMaterial","hasFaceUv","hasFaceNormal","hasFaceVertexNormal","hasFaceColor","hasFaceVertexColor","faceType","uvsCopy","kl","Camera","matrixWorldInverse","CubeCamera","cubeResolution","cameraPX","cameraNX","cameraPY","cameraNY","cameraPZ","cameraNZ","renderTarget","WebGLRenderTargetCube","magFilter","minFilter","updateCubeMap","generateMipmaps","activeCubeFace","zoom","cx","cy","setLens","focalLength","frameHeight","atan","setViewOffset","fullWidth","fullHeight","Light","light","AreaLight","constantAttenuation","linearAttenuation","quadraticAttenuation","onlyShadow","shadowCameraNear","shadowCameraFar","shadowCameraLeft","shadowCameraRight","shadowCameraTop","shadowCameraBottom","shadowCameraVisible","shadowBias","shadowDarkness","shadowMapWidth","shadowMapHeight","shadowCascade","shadowCascadeOffset","shadowCascadeCount","shadowCascadeBias","shadowCascadeWidth","shadowCascadeHeight","shadowCascadeNearZ","shadowCascadeFarZ","shadowCascadeArray","shadowMap","shadowMapSize","shadowCamera","shadowMatrix","skyColor","shadowCameraFov","Cache","files","file","get","Loader","showStatus","statusDomElement","addStatusElement","imageLoader","ImageLoader","onLoadStart","onLoadProgress","onLoadComplete","crossOrigin","fontSize","textAlign","background","padding","zIndex","updateProgress","toFixed","extractUrlBase","parts","initMaterials","texturePath","needsTangents","ShaderMaterial","nearest_pow2","LN2","create_texture","where","sourceFile","repeat","wrap","anisotropy","texture","fullPath","loader","Handlers","Texture","image","wrapMap","mirror","rgb2hex","rgb","mtype","mpars","opacity","lightMap","normalMap","bumpMap","wireframe","shading","depthTest","flipSided","side","doubleSided","colorDiffuse","DbgColor","colorSpecular","specular","colorEmissive","emissive","specularCoef","shininess","mapDiffuse","mapDiffuseRepeat","mapDiffuseOffset","mapDiffuseWrap","mapDiffuseAnisotropy","mapLight","mapLightRepeat","mapLightOffset","mapLightWrap","mapLightAnisotropy","mapBump","mapBumpRepeat","mapBumpOffset","mapBumpWrap","mapBumpAnisotropy","mapNormal","mapNormalRepeat","mapNormalOffset","mapNormalWrap","mapNormalAnisotropy","mapSpecular","mapSpecularRepeat","mapSpecularOffset","mapSpecularWrap","mapSpecularAnisotropy","mapAlpha","mapAlphaRepeat","mapAlphaOffset","mapAlphaWrap","mapAlphaAnisotropy","mapBumpScale","bumpScale","mapNormalFactor","normalScale","DbgName","handlers","regex","XHRLoader","manager","DefaultLoadingManager","onLoad","onProgress","onError","cached","itemEnd","itemStart","setResponseType","setCrossOrigin","withCredentials","loadAjaxJSON","callbackProgress","onreadystatechange","DONE","LOADING","getResponseHeader","HEADERS_RECEIVED","parseModel","isBitSet","fi","zLength","colorIndex","normalIndex","uvIndex","isQuad","faceA","faceB","uvLayer","nUvLayers","parseSkin","influencesPerVertex","bones","animation","animations","parseMorphing","dstVertices","srcVertices","cl","dstColors","srcColors","BufferGeometryLoader","text","typedArray","MaterialLoader","uniforms","vertexShader","fragmentShader","sizeAttenuation","ObjectLoader","substring","lastIndexOf","setTexturePath","parseGeometries","images","parseImages","parseTextures","parseMaterials","geometryLoader","bufferGeometryLoader","widthSegments","heightSegments","depthSegments","CircleGeometry","segments","CylinderGeometry","radiusTop","radiusBottom","radialSegments","openEnded","phiStart","phiLength","thetaStart","thetaLength","IcosahedronGeometry","detail","TorusGeometry","tube","tubularSegments","arc","TorusKnotGeometry","heightScale","alphaMap","envMap","loadImage","getGeometry","getMaterial","Group","TextureLoader","DataTextureLoader","BinaryTextureLoader","_parser","DataTexture","texData","mipmaps","mipmapCount","CompressedTextureLoader","CompressedTexture","texDatas","isCubemap","Material","MaterialIdCount","blendSrc","blendDst","blendEquation","blendSrcAlpha","blendDstAlpha","blendEquationAlpha","colorWrite","polygonOffset","polygonOffsetFactor","polygonOffsetUnits","alphaTest","overdraw","_needsUpdate","setValues","values","newValue","currentValue","Number","MeshLambertMaterial","MeshDepthMaterial","SpriteMaterial","LineBasicMaterial","linewidth","linecap","linejoin","fog","LineDashedMaterial","dashSize","gapSize","combine","reflectivity","refractionRatio","wireframeLinewidth","wireframeLinecap","wireframeLinejoin","skinning","wrapAround","wrapRGB","metal","ParticleBasicMaterial","ParticleSystemMaterial","defines","lights","defaultAttributeValues","uv2","index0AttributeName","UniformsUtils","RawShaderMaterial","mapping","TextureIdCount","DEFAULT_IMAGE","DEFAULT_MAPPING","premultiplyAlpha","flipY","unpackAlignment","onUpdate","CubeTexture","VideoTexture","video","HAVE_ENOUGH_DATA","inverseMatrix","localThreshold","testPoint","rayPointDistance","intersectPoint","distanceToRay","oi","ol","pointCount","ParticleSystem","LineStrip","LinePieces","precisionSq","vStart","vEnd","interSegment","interRay","distSq","offsetIndex","nbVertices","updateMorphTargets","morphTargetBase","morphTargetForcedOrder","morphTargetInfluences","morphTargetDictionary","ml","getMorphTargetIndexByName","intersectionPoint","isFaceMaterial","objectMaterials","morphInfluences","tl","influence","targets","Bone","skin","Skeleton","boneInverses","useVertexTexture","identityMatrix","boneTextureWidth","boneTextureHeight","boneMatrices","boneTexture","calculateInverses","bl","pose","bone","offsetMatrix","SkinnedMesh","bindMode","bindMatrix","bindMatrixInverse","gbone","rotq","scl","normalizeSkinWeights","skeleton","sw","MorphAnimMesh","mirroredLoop","lastKeyframe","currentKeyframe","directionBackwards","setFrameRange","startKeyframe","endKeyframe","setDirectionForward","setDirectionBackward","parseAnimations","firstAnimation","pattern","morph","match","setAnimationLabel","playAnimation","updateAnimation","frameTime","keyframe","mix","interpolateTargets","influences","addLevel","getObjectForDistance","matrixPosition","Particle","LensFlare","lensFlares","positionScreen","customUpdateCallback","updateLensFlares","flare","vecX","vecY","wantedRotation","overrideMaterial","autoUpdate","Fog","FogExp2","density","ShaderChunk","merged","uniforms_src","uniforms_dst","parameter_src","UniformsLib","common","diffuse","offsetRepeat","flipEnvMap","bump","normalmap","fogDensity","fogNear","fogFar","fogColor","ambientLightColor","directionalLightDirection","directionalLightColor","hemisphereLightDirection","hemisphereLightSkyColor","hemisphereLightGroundColor","pointLightColor","pointLightPosition","pointLightDistance","pointLightDecay","spotLightColor","spotLightPosition","spotLightDirection","spotLightDistance","spotLightAngleCos","spotLightExponent","spotLightDecay","psColor","shadowmap","ShaderLib","basic","lambert","phong","particle_basic","dashed","totalSize","mNear","mFar","cube","tCube","tFlip","equirect","tEquirect","depthRGBA","createParticleBuffers","__webglVertexBuffer","_gl","__webglColorBuffer","info","memory","createLineBuffers","__webglLineDistanceBuffer","createMeshBuffers","geometryGroup","__webglNormalBuffer","__webglTangentBuffer","__webglUVBuffer","__webglUV2Buffer","__webglSkinIndicesBuffer","__webglSkinWeightsBuffer","__webglFaceBuffer","__webglLineBuffer","numMorphTargets","__webglMorphTargetsBuffers","numMorphNormals","__webglMorphNormalsBuffers","initCustomAttributes","nvertices","__webglCustomAttributesList","__webglInitialized","createUniqueBuffers","belongsToAttribute","initParticleBuffers","__vertexArray","__colorArray","__webglParticleCount","initLineBuffers","__lineDistanceArray","__webglLineCount","initMeshBuffers","faces3","ntris","nlines","getBufferMaterial","__normalArray","__uvArray","__uv2Array","__tangentArray","__skinIndexArray","__skinWeightArray","UintArray","extensions","Uint32Array","__typeArray","__faceArray","__lineArray","__morphTargetsArrays","__morphNormalsArrays","__webglFaceCount","originalAttribute","property","__original","__inittedArrays","materialNeedsFaceNormals","setParticleBuffers","hint","ca","cal","customAttribute","vertexArray","colorArray","dirtyVertices","dirtyColors","customAttributes","bindBuffer","ARRAY_BUFFER","bufferData","boundTo","setLineBuffers","dl","lineDistanceArray","dirtyLineDistances","setMeshBuffers","faceColor","n1","n3","sw1","sw2","sw3","si1","si2","si3","vn","uvi","uv2i","vk","vkl","vka","nka","chf","needsFaceNormals","offset_uv","offset_uv2","offset_face","offset_normal","offset_tangent","offset_line","offset_color","offset_skin","offset_morphTarget","offset_custom","uvArray","uv2Array","normalArray","tangentArray","skinIndexArray","skinWeightArray","morphTargetsArrays","morphNormalsArrays","faceArray","lineArray","dirtyElements","dirtyUvs","dirtyNormals","dirtyTangents","dirtyMorphTargets","morphTargetsNeedUpdate","chunk_faces3","obj_faces","obj_uvs","obj_uvs2","obj_skinIndices","obj_skinWeights","ELEMENT_ARRAY_BUFFER","pp","setupVertexAttributes","program","startIndex","geometryAttributes","programAttributes","programAttributesKeys","programAttribute","geometryAttribute","state","enableAttribute","vertexAttribPointer","FLOAT","vertexAttrib2fv","vertexAttrib3fv","disableUnusedAttributes","setupMorphTargets","numSupportedMorphTargets","__webglMorphTargetInfluences","activeInfluenceIndices","numericalSort","numSupportedMorphNormals","influenceIndex","uniform1fv","painterSortStable","reversePainterSortStable","projectObject","initObject","sprites","webglObjects","_webglObjects","_frustum","webglObject","unrollBufferMaterial","sortObjects","_vector3","_projScreenMatrix","renderObjects","renderList","setupMatrices","setMaterial","setMaterialFaces","renderBufferDirect","renderBuffer","renderObjectsImmediate","materialType","renderImmediateObject","unrollImmediateBufferMaterial","globject","opaque","transparentObjects","opaqueObjects","__webglInit","_modelViewMatrix","_normalMatrix","onObjectRemoved","onGeometryDispose","initGeometryGroups","__webglActive","addBuffer","geometryGroupsList","geometryGroups","ImmediateRenderObject","immediateRenderCallback","addBufferImmediate","_webglObjectsImmediate","makeGroups","usesFaceMaterial","groupHash","group","maxVerticesInGroup","hash_map","groups","groupsList","counter","geometryGroupCounter","addBuffers","objlist","updateObject","bufferType","DYNAMIC_DRAW","STATIC_DRAW","bufferSubData","BYTES_PER_ELEMENT","subarray","customAttributesDirty","areCustomAttributesDirty","clearCustomAttributes","removeObject","removeInstances","initMaterial","onMaterialDispose","shaderID","shaderIDs","shader","__webglShader","maxLightCount","allocateLights","maxShadows","allocateShadows","maxBones","allocateBones","_precision","supportsVertexTextures","_supportsVertexTextures","envMapMode","useFog","fogExp","flatShading","logarithmicDepthBuffer","_logarithmicDepthBuffer","_supportsBoneTextures","maxMorphTargets","maxMorphNormals","maxDirLights","directional","maxPointLights","maxSpotLights","spot","maxHemiLights","hemi","shadowMapEnabled","shadowMapType","shadowMapDebug","shadowMapCascade","pl","_programs","programInfo","usedTimes","WebGLProgram","programs","uniformsList","location","setBlending","setDepthTest","setDepthWrite","setColorWrite","setPolygonOffset","setProgram","_usedTextureUnits","deallocateMaterial","refreshProgram","refreshMaterial","refreshLights","p_uniforms","m_uniforms","_currentProgram","useProgram","_currentMaterialId","_currentCamera","uniformMatrix4fv","uniform1f","logDepthBufFC","cameraPosition","uniform3f","viewMatrix","textureUnit","getTextureUnit","uniform1i","setTexture","boneGlobalMatrices","refreshUniformsFog","_lightsNeedUpdate","setupLights","refreshUniformsLights","_lights","markUniformsLightsNeedsUpdate","refreshUniformsCommon","refreshUniformsLine","refreshUniformsDash","refreshUniformsParticle","refreshUniformsPhong","refreshUniformsLambert","_shadowPass","refreshUniformsShadow","loadUniformsGeneric","loadUniformsMatrices","modelMatrix","uvScaleMap","_canvas","ambient","distances","decays","directions","anglesCos","exponents","skyColors","groundColors","modelViewMatrix","uniformMatrix3fv","_maxTextures","uniform","uniform2f","uniform4f","uniform1iv","uniform3iv","uniform2fv","uniform3fv","uniform4fv","_array","setCubeTexture","setCubeTextureDynamic","setColorLinear","ll","zlights","dirColors","dirPositions","pointColors","pointPositions","pointDistances","pointDecays","spotColors","spotPositions","spotDistances","spotDirections","spotAnglesCos","spotExponents","spotDecays","hemiSkyColors","hemiGroundColors","hemiPositions","dirLength","pointLength","spotLength","hemiLength","dirCount","spotCount","hemiCount","dirOffset","pointOffset","spotOffset","hemiOffset","_direction","setTextureParameters","textureType","isImagePowerOfTwo","extension","texParameteri","TEXTURE_WRAP_S","paramThreeToGL","TEXTURE_WRAP_T","TEXTURE_MAG_FILTER","TEXTURE_MIN_FILTER","CLAMP_TO_EDGE","filterFallback","__currentAnisotropy","texParameterf","TEXTURE_MAX_ANISOTROPY_EXT","getMaxAnisotropy","clampToMaxSize","maxSize","slot","__webglTextureCube","onTextureDispose","createTexture","activeTexture","TEXTURE0","bindTexture","TEXTURE_CUBE_MAP","pixelStorei","UNPACK_FLIP_Y_WEBGL","isCompressed","isDataTexture","cubeImage","autoScaleCubemaps","_maxCubemapSize","glFormat","glType","mipmap","getCompressedTextureFormats","compressedTexImage2D","TEXTURE_CUBE_MAP_POSITIVE_X","texImage2D","generateMipmap","__webglTexture","setupFrameBuffer","framebuffer","textureTarget","bindFramebuffer","FRAMEBUFFER","framebufferTexture2D","COLOR_ATTACHMENT0","setupRenderBuffer","renderbuffer","bindRenderbuffer","RENDERBUFFER","depthBuffer","stencilBuffer","renderbufferStorage","DEPTH_COMPONENT16","framebufferRenderbuffer","DEPTH_ATTACHMENT","DEPTH_STENCIL","DEPTH_STENCIL_ATTACHMENT","RGBA4","updateRenderTargetMipmap","TEXTURE_2D","NEAREST","LINEAR","REPEAT","MIRRORED_REPEAT","NEAREST_MIPMAP_NEAREST","NEAREST_MIPMAP_LINEAR","LINEAR_MIPMAP_NEAREST","LINEAR_MIPMAP_LINEAR","UNSIGNED_BYTE","UNSIGNED_SHORT_4_4_4_4","UNSIGNED_SHORT_5_5_5_1","UNSIGNED_SHORT_5_6_5","BYTE","SHORT","UNSIGNED_SHORT","INT","UNSIGNED_INT","HALF_FLOAT_OES","ALPHA","RGB","RGBA","LUMINANCE","LUMINANCE_ALPHA","FUNC_ADD","FUNC_SUBTRACT","FUNC_REVERSE_SUBTRACT","ZERO","ONE","SRC_COLOR","ONE_MINUS_SRC_COLOR","SRC_ALPHA","ONE_MINUS_SRC_ALPHA","DST_ALPHA","ONE_MINUS_DST_ALPHA","DST_COLOR","ONE_MINUS_DST_COLOR","SRC_ALPHA_SATURATE","COMPRESSED_RGB_S3TC_DXT1_EXT","COMPRESSED_RGBA_S3TC_DXT1_EXT","COMPRESSED_RGBA_S3TC_DXT3_EXT","COMPRESSED_RGBA_S3TC_DXT5_EXT","COMPRESSED_RGB_PVRTC_4BPPV1_IMG","COMPRESSED_RGB_PVRTC_2BPPV1_IMG","COMPRESSED_RGBA_PVRTC_4BPPV1_IMG","COMPRESSED_RGBA_PVRTC_2BPPV1_IMG","MIN_EXT","MAX_EXT","nVertexUniforms","MAX_VERTEX_UNIFORM_VECTORS","nVertexMatrices","dirLights","pointLights","spotLights","hemiLights","_context","pixelRatio","_alpha","_depth","_stencil","stencil","_antialias","_premultipliedAlpha","premultipliedAlpha","_preserveDrawingBuffer","preserveDrawingBuffer","_clearColor","_clearAlpha","autoClear","autoClearColor","autoClearDepth","autoClearStencil","gammaInput","gammaOutput","shadowMapCullFace","calls","_currentFramebuffer","_currentGeometryProgram","_viewportX","_viewportY","_viewportWidth","_viewportHeight","_currentWidth","_currentHeight","resetGLState","setDefaultGLState","WebGLState","getShaderPrecisionFormat","rangeMin","rangeMax","WebGLExtensions","glClearColor","clearColor","clearDepth","clearStencil","enable","DEPTH_TEST","depthFunc","LEQUAL","frontFace","CCW","cullFace","BACK","CULL_FACE","BLEND","blendFunc","viewport","reset","MAX_TEXTURE_IMAGE_UNITS","_maxVertexTextures","MAX_VERTEX_TEXTURE_IMAGE_UNITS","_maxTextureSize","MAX_TEXTURE_SIZE","MAX_CUBE_MAP_TEXTURE_SIZE","_vertexShaderPrecisionHighpFloat","VERTEX_SHADER","HIGH_FLOAT","_vertexShaderPrecisionMediumpFloat","MEDIUM_FLOAT","_fragmentShaderPrecisionHighpFloat","FRAGMENT_SHADER","_fragmentShaderPrecisionMediumpFloat","formats","COMPRESSED_TEXTURE_FORMATS","highpAvailable","mediumpAvailable","shadowMapPlugin","ShadowMapPlugin","spritePlugin","SpritePlugin","lensFlarePlugin","LensFlarePlugin","forceContextLoss","loseContext","supportsFloatTextures","supportsHalfFloatTextures","supportsStandardDerivatives","supportsCompressedTextureS3TC","supportsCompressedTexturePVRTC","supportsBlendMinMax","MAX_TEXTURE_MAX_ANISOTROPY_EXT","getPrecision","getPixelRatio","setPixelRatio","updateStyle","setViewport","setScissor","scissor","enableScissorTest","SCISSOR_TEST","disable","getClearColor","getClearAlpha","setClearAlpha","COLOR_BUFFER_BIT","DEPTH_BUFFER_BIT","STENCIL_BUFFER_BIT","clearTarget","setRenderTarget","deallocateGeometry","deallocateTexture","onRenderTargetDispose","deallocateRenderTarget","deleteBuffers","buffers","deleteBuffer","deleteTexture","deleteFramebuffer","__webglFramebuffer","deleteRenderbuffer","__webglRenderbuffer","deleteProgram","newPrograms","renderBufferImmediate","initAttributes","hasPositions","hasNormals","hasUvs","__webglUvBuffer","hasColors","positionArray","nx","ny","nz","nax","nbx","ncx","nay","nby","ncy","naz","nbz","ncz","drawArrays","TRIANGLES","updateBuffers","wireframeBit","geometryProgram","LINES","drawElements","POINTS","LINE_STRIP","setLineWidth","skinIndex","skinWeight","lineDistance","forceClear","setFaceCulling","frontFaceDirection","CW","FRONT","FRONT_AND_BACK","setDoubleSided","setFlipSided","uploadTexture","UNPACK_PREMULTIPLY_ALPHA_WEBGL","UNPACK_ALIGNMENT","isCube","isTargetPowerOfTwo","createFramebuffer","createRenderbuffer","shareDepthFrom","vx","vy","readRenderTargetPixels","WebGLRenderTarget","restore","checkFramebufferStatus","FRAMEBUFFER_COMPLETE","readPixels","addPrePlugin","addPostPlugin","updateShadowMap","gl","getExtension","programIdCount","generateDefines","chunk","cacheUniformLocations","identifiers","getUniformLocation","cacheAttributeLocations","getAttribLocation","shadowMapTypeDefine","envMapTypeDefine","envMapModeDefine","envMapBlendingDefine","prefix_vertex","prefix_fragment","gammaFactorDefine","customDefines","createProgram","glVertexShader","WebGLShader","glFragmentShader","attachShader","bindAttribLocation","linkProgram","programLogInfo","getProgramInfoLog","getProgramParameter","LINK_STATUS","getError","VALIDATE_STATUS","deleteShader","addLineNumbers","string","lines","createShader","shaderSource","compileShader","getShaderParameter","COMPILE_STATUS","getShaderInfoLog","newAttributes","enabledAttributes","currentBlending","currentBlendEquation","currentBlendSrc","currentBlendDst","currentBlendEquationAlpha","currentBlendSrcAlpha","currentBlendDstAlpha","currentDepthTest","currentDepthWrite","currentColorWrite","currentDoubleSided","currentFlipSided","currentLineWidth","currentPolygonOffset","currentPolygonOffsetFactor","currentPolygonOffsetUnits","enableVertexAttribArray","disableVertexAttribArray","blendEquationSeparate","blendFuncSeparate","depthMask","colorMask","polygonoffset","units","POLYGON_OFFSET_FILL","flares","prefix","vertexBuffer","elementBuffer","hasVertexTexture","tempTexture","occlusionTexture","renderType","occlusionMap","screenPosition","viewportWidth","viewportHeight","tempPosition","invAspect","halfViewportWidth","halfViewportHeight","screenPositionPixels","TEXTURE1","copyTexImage2D","_renderer","_renderList","createVirtualLight","cascade","virtualLight","isVirtual","pointsWorld","pointsFrustum","nearZ","farZ","updateVirtualLight","updateShadowCamera","_min","_max","getObjectMaterial","_depthMaterial","_depthMaterialMorph","_depthMaterialSkin","_depthMaterialMorphSkin","_matrixPosition","depthShader","depthUniforms","originalCamera","gyro","shadowFilter","pars","cameraHelper","CameraHelper","objectMaterial","useMorphing","useSkinning","customDepthMaterial","clearAlpha","spritePosition","spriteRotation","spriteScale","uvOffset","uvScale","fogType","oldFogType","sceneFogType","GeometryUtils","geometry1","geometry2","loadTextureCube","loadCompressedTexture","loadCompressedTextureCube","getNormalMap","subtract","imageData","createImageData","ly","uy","lx","ux","num_points","generateDataTexture","SceneUtils","createMultiMaterialObject","detach","attach","FontUtils","divisions","getFace","loadFace","family","familyName","ThreeFont","cssFontWeight","cssFontStyle","drawText","resolution","fontPaths","Path","ret","extractGlyphPoints","paths","outline","action","cpx","cpy","cpx0","cpy0","cpx1","cpy1","cpx2","cpy2","laste","pts","glyph","glyphs","_cachedOutline","quadraticCurveTo","Shape","bezierCurveTo","ha","generateShapes","curveSegments","font","shapes","toShapes","namespace","EPSILON","process","contour","verts","vertIndices","nv","snip","px","py","aX","aY","bX","bY","cX","cY","apx","apy","bpx","bpy","cCROSSap","bCROSScp","aCROSSbp","Triangulate","_typeface_js","typeface_js","onended","onEnded","isPlaying","setLoop","setRefDistance","refDistance","setRolloffFactor","rolloffFactor","setVolume","AudioListener","positionPrev","Curve","getPointAt","getUtoTmapping","getPoints","getSpacedPoints","lengths","getLengths","cacheArcLengths","current","sum","updateArcLengths","targetArcLength","arcLengths","comparison","lengthBefore","lengthAfter","segmentLength","segmentFraction","getTangent","pt1","pt2","vec","getTangentAt","tangentQuadraticBezier","tangentCubicBezier","tangentSpline","h00","h10","h01","h11","getPointFunc","CurvePath","curves","bends","autoClose","curve","checkConnection","closePath","startPoint","endPoint","LineCurve","curveLengths","getCurveLengths","lens","cacheLengths","sums","maxX","maxY","maxZ","minX","minY","minZ","NEGATIVE_INFINITY","POSITIVE_INFINITY","createPointsGeometry","createGeometry","createSpacedPointsGeometry","addWrapPath","bendpath","getTransformedPoints","oldPts","getWrapPoints","getTransformedSpacedPoints","oldX","oldY","xNorm","bounds","pathPt","translationObject","quaternionObject","scaleObject","translationWorld","quaternionWorld","scaleWorld","actions","fromPoints","PathActions","MOVE_TO","LINE_TO","QUADRATIC_CURVE_TO","BEZIER_CURVE_TO","CSPLINE_THRU","ARC","ELLIPSE","vectors","vlen","args","lastargs","x0","y0","aCPx","aCPy","QuadraticBezierCurve","aCP1x","aCP1y","aCP2x","aCP2y","CubicBezierCurve","splineThru","npts","SplineCurve","aRadius","aStartAngle","aEndAngle","aClockwise","absarc","absellipse","ellipse","xRadius","yRadius","EllipseCurve","lastPoint","closedPath","useSpacedPoints","item","spts","spline","deltaAngle","tdivisions","isCCW","noHoles","extractSubpaths","inActions","subPaths","lastPath","toShapesNoHoles","inSubpaths","tmpPath","tmpShape","isPointInsidePolygon","inPt","inPolygon","polyLen","inside","edgeLowPt","edgeHighPt","edgeDx","edgeDy","perpEdge","solid","holesFirst","isClockWise","tmpPoints","betterShapeHoles","newShapes","newShapeHoles","mainIdx","ambigious","toChange","sIdx","sLen","sho","hIdx","ho","hole_unassigned","s2Idx","froms","tos","hole","tmpHoles","holes","extrude","extruded","ExtrudeGeometry","makeGeometry","ShapeGeometry","getPointsHoles","holesPts","getSpacedPointsHoles","extractAllPoints","shape","extractPoints","extractAllSpacedPoints","triangulateShape","point_in_segment_2D_colin","inSegPt1","inSegPt2","inOtherPt","intersect_segments_2D","inSeg1Pt1","inSeg1Pt2","inSeg2Pt1","inSeg2Pt2","inExcludeAdjacentSegs","seg1dx","seg1dy","seg2dx","seg2dy","seg1seg2dx","seg1seg2dy","perpSeg1","perpSeg2","factorSeg1","seg1Pt","seg2Pt","seg1min","seg1max","seg1minVal","seg1maxVal","seg2min","seg2max","seg2minVal","seg2maxVal","isPointInsideAngle","inVertex","inLegFromPt","inLegToPt","legFromPtX","legFromPtY","legToPtX","legToPtY","otherPtX","otherPtY","from2toAngle","from2otherAngle","other2toAngle","removeHoles","isCutLineInsideAngles","inShapeIdx","inHoleIdx","lastShapeIdx","prevShapeIdx","nextShapeIdx","insideAngle","lastHoleIdx","prevHoleIdx","nextHoleIdx","intersectsShapeEdge","inShapePt","inHolePt","nextIdx","intersection","intersectsHoleEdge","ihIdx","chkHole","indepHoles","holeIndex","shapeIndex","shapePt","holePt","holeIdx","cutKey","tmpShape1","tmpShape2","tmpHole1","tmpHole2","failedCuts","hl","minShapeIndex","h2","allPointsMap","allpoints","shapeWithoutHoles","b2p0","b2p1","b2p2","b3p0","b3p1","b3p2","b3p3","point0","point1","point2","point3","ArcCurve","LineCurve3","QuadraticBezierCurve3","CubicBezierCurve3","SplineCurve3","ClosedSplineCurve3","AnimationHandler","CATMULLROM","CATMULLROM_FORWARD","hierarchy","rot","usedMorphTargets","morphTargetName","morphTargetsInfluences","parseRecurseHierarchy","deltaTimeMS","resetBlendWeights","Animation","timeScale","interpolationType","keyTypes","animationCache","positionWeight","quaternionWeight","scaleWeight","prevKey","nextKey","originalMatrix","getNextKeyWith","newVector","newQuat","interpolateCatmullRom","prevXYZ","nextXYZ","proportionalWeight","getPrevKeyWith","currentPoint","forwardPoint","KeyFrameAnimation","isPaused","sids","sid","next","endTime","original","hasTarget","MorphAnimation","lastFrame","currentFrame","interpolation","buildPlane","udir","vdir","gridX","gridY","width_half","height_half","gridX1","gridY1","segment_width","segment_height","uvd","depth_half","centerUV","segment","CubeGeometry","heightHalf","verticesRow","uvsRow","tanTheta","v4","n4","uv1","uv3","uv4","addShapeList","addShape","scalePt2","pt","getBevelVec","inPrev","inNext","v_trans_x","v_trans_y","shrink_by","v_prev_x","v_prev_y","v_next_x","v_next_y","v_prev_lensq","colinear0","v_prev_len","v_next_len","ptPrevShift_x","ptPrevShift_y","ptNextShift_x","ptNextShift_y","sf","v_trans_lensq","direction_eq","buildLidFaces","bevelEnabled","layer","flen","f3","bevelSegments","buildSideFaces","layeroffset","sidewalls","ahole","slen1","slen2","f4","shapesOffset","uvgen","generateTopUV","wallContour","stepIndex","stepsLength","contourIndex1","contourIndex2","extrudeMaterial","generateSideWallUV","extrudePts","splineTube","binormal","position2","bevelThickness","bevelSize","extrudePath","extrudeByPath","UVGenerator","WorldUVGenerator","TubeGeometry","FrenetFrames","shapePoints","reverse","bs","vert","contourMovements","oneHoleMovements","holesMovements","verticesMovements","binormals","indexA","indexB","indexC","indexD","LatheGeometry","inversePointLength","inverseSegments","phi","np","u0","u1","PlaneGeometry","PlaneBufferGeometry","offset2","RingGeometry","innerRadius","outerRadius","thetaSegments","phiSegments","radiusStep","thetaSegment","TextGeometry","textShapes","getPos","in_q","in_p","cu","su","quOverP","cs","tz","grid","tang","bitan","ip","jp","closed","taper","NoTaper","numpoints","pos2","SinusoidalTaper","initialNormal3","smallest","MAX_VALUE","PolyhedronGeometry","prepare","that","azimuth","inclination","centroid","azi","correctUV","subdivide","cols","bj","DodecahedronGeometry","OctahedronGeometry","TetrahedronGeometry","ParametricGeometry","func","slices","stacks","sliceCount","AxisHelper","ArrowHelper","lineGeometry","coneGeometry","headLength","headWidth","cone","setDirection","setColor","BoxHelper","BoundingBoxHelper","addLine","addPoint","pointMap","hexFrustum","hexCone","hexUp","hexTarget","hexCross","setPoint","DirectionalLightHelper","lightPlane","targetLine","EdgesHelper","thresholdAngle","thresholdDot","edge","sortFunction","numEdges","vert1","vert2","face1","face2","FaceNormalsHelper","objectVertices","objectFaces","objectWorldMatrix","GridHelper","setColors","colorCenterLine","colorGrid","HemisphereLightHelper","sphereSize","lightSphere","PointLightHelper","SkeletonHelper","getBoneList","boneList","matrixWorldInv","boneMatrix","SpotLightHelper","vector2","coneLength","coneWidth","VertexNormalsHelper","worldMatrix","vertexId","VertexTangentsHelper","WireframeHelper","edges","numTris","renderCallback","MorphBlendMesh","animationsMap","animationsList","numFrames","startFrame","endFrame","createAnimation","setAnimationWeight","active","autoCreateAnimations","frameRanges","setAnimationDirectionForward","setAnimationDirectionBackward","setAnimationFPS","setAnimationDuration","setAnimationTime","getAnimationTime","getAnimationDuration","stopAnimation","ERROR","COMPOSITE","DECORATOR","ACTION","CONDITION","createUUID","hexDigits","substr","baseClass","cls","_baseMemory","_treeMemory","_getTreeMemory","treeScope","nodeMemory","openNodes","traversalDepth","traversalCycle","_getNodeMemory","treeMemory","nodeScope","_getMemory","Tick","_openNodes","_nodeCount","_enterNode","_openNode","_tickNode","_closeNode","_exitNode","title","description","properties","names","spec","EvalError","category","cid","dump","stack","lastOpenNodes","currOpenNodes","_close","BaseNode","_enter","_open","_tick","_exit","enter","close","exit","__BaseNode_initialize","Decorator","Condition","Priority","MemSequence","MemPriority","Inverter","Limiter","maxLoop","__Decorator_initialize","MaxTime","maxTime","getTime","currTime","Repeater","RepeatUntilFailure","RepeatUntilSuccess","Failer","Runner","Succeeder","Wait","milliseconds","Entity","Messanger","ObjectPool","QuadTree","Spatial","Vec2","Ai","_events","fired","handled","Event","listenTo","eventName","trigger","option","fire","T","freeList","aquire","expand","__init","release","totalFree","totalUsed","level","maxEntities","maxLevels","pool","insert","_getIndex","spatial","absPosition","absHwidth","_splitAndRedistributeIfNeeded","_node","queryArea","hwidth","out__entities","overlapping","rectIntersect","reIndex","_combine","tSize","tPos","validateEntity","hw","assign","smult","rectContains","midX","midY","_split","_redistribute","_factory","messanger","_tags","_entities","_groups","_entityPool","_componentPools","Components","componentPropertyName","Component","getName","charAt","groupKey","ENTITY_CREATED","ENTITY_REMOVE","COMPONENT_ADDED","COMPONENT_REMOVE","_trigger","removeEntitiesByTag","tag","removeAllEntities","removeEntity","entityRemoveAllComponents","entityAddTag","entityRemoveTag","entityAddComponent","_Components","cName","cPool","component","groupName","hasAllComponents","Cs","entityRemoveComponent","loc","propName","_indexGroup","poolStats","used","_absScale","_absPosition","_absHwidth","COINCIDENT","attachTo","absRotation","rotate","pScale","absScale","TComponent","removeTag","magnitude","magnitude2","angleBetween","pcopy","fromAngle","pfromAngle","r1","r2","sizeToHwidth","out__position","out__hwidth","_name","_callback","Comps","whereComponent","whereComponents","extends","mixin","getArguments","mixin_","Function","FUNCTION_ARGS","extends_","Child","Parent","Super","makeT","FUNCTION_NAME"],"mappings":"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","file":"bundle.js","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})","global.Class = require('js-class');\r\nglobal.THREE = require('three');\r\nglobal.THREEx = require('./js/THREEx.KeyboardState.js');\r\nglobal.Physijs = require('physijs-browserify')(THREE);\r\nglobal.Stats = require('stats.js');\r\nglobal.Howler = require('howler');\r\n\r\nrequire('./RequestAnimationFrame.js');\r\nrequire('./rubbable.js');\r\nglobal.SuperGif = require('./libgif.js');\r\n\r\nglobal.Utils = require('./js/Utils.js');\r\n\r\nrequire('./js/Game.js');\r\nrequire('./js/Globals.js');\r\nrequire('./js/ResourceManager.js');\r\nrequire('./js/PointerLockControls.js');\r\nrequire('./js/EntityFactory.js');\r\nrequire('./js/Systems.js');\r\nrequire('./js/MouseController.js');\r\nrequire('./js/SoundController.js');\r\n\r\nPhysijs.scripts.worker = './libs/physijsWorker.js';\r\nPhysijs.scripts.ammo = './ammo.js';\r\n\r\n// purpose: function as a basic FPS game using an ECS (entity-component system) pattern\r\n//\r\n// requires: RequestAnimationFrame.js, three.js, three-pointerlockcontrols.js, stats.js, js-class.js, physijs, tiny-ecs\r\n//           Game.js, ResourceManager.js\r\n//\r\n// author: Cornell Daly\r\n//\r\n// date: November 3, 2015\r\n//\r\n// additional notes: code is separated into multiple files\r\n\r\nvar game = null;\r\n\r\nfunction init() {\r\n  Globals.instance.hudElement = document.getElementById(\"hud\");\r\n\r\n  Globals.instance.healthElement = document.getElementById(\"health\");\r\n  Globals.instance.scoreElement = document.getElementById(\"score\");\r\n\r\n  Globals.instance.reloadingElement = document.getElementById(\"reloading\");\r\n  Globals.instance.reloadImg = new SuperGif({\r\n    gif: document.getElementById(\"reloadImg\")\r\n  });\r\n  Globals.instance.reloadImg.load();\r\n\r\n  Globals.instance.overlayElement = document.getElementById(\"overlay\");\r\n\r\n  var gameOptions = {\r\n    container: document.getElementById(\"container\"),\r\n    loadingContainer: document.getElementById(\"loadingContainer\"),\r\n    blocker: document.getElementById(\"blocker\"),\r\n    instructions: document.getElementById(\"instructions\"),\r\n    crosshair: document.getElementById(\"crosshair\"),\r\n    modelsToPreload: [\r\n      \"models/potato.json\",\r\n      \"models/potatoCannon.json\",\r\n      \"models/character.json\",\r\n      \"models/fry.json\"\r\n    ],\r\n    soundsToPreload: [\r\n      \"sfx/arrowlessBow.mp3\",\r\n      \"sfx/hitSplat.wav\"\r\n    ]\r\n  };\r\n  game = new Game(gameOptions);\r\n\r\n  game.start();\r\n}\r\n\r\ninit();\r\n\r\n","/**\n * Provides requestAnimationFrame in a cross browser way.\n * http://paulirish.com/2011/requestanimationframe-for-smart-animating/\n */\n\nif ( !window.requestAnimationFrame ) {\n\n\twindow.requestAnimationFrame = ( function() {\n\n\t\treturn window.webkitRequestAnimationFrame ||\n\t\twindow.mozRequestAnimationFrame ||\n\t\twindow.oRequestAnimationFrame ||\n\t\twindow.msRequestAnimationFrame ||\n\t\tfunction( /* function FrameRequestCallback */ callback, /* DOMElement Element */ element ) {\n\n\t\t\twindow.setTimeout( callback, 1000 / 60 );\n\n\t\t};\n\n\t} )();\n\n}\n","/*\n\tRubbableGif\n\n\tExample usage:\n\n\t\t<img src=\"./example1_preview.gif\" rel:animated_src=\"./example1.gif\" width=\"360\" height=\"360\" rel:auto_play=\"1\" />\n\n\t\t<script type=\"text/javascript\">\n\t\t\t$$('img').each(function (img_tag) {\n\t\t\t\tif (/.*\\.gif/.test(img_tag.src)) {\n\t\t\t\t\tvar rub = new RubbableGif({ gif: img_tag } );\n\t\t\t\t\trub.load();\n\t\t\t\t}\n\t\t\t});\n\t\t</script>\n\n\tImage tag attributes:\n\n\t\trel:animated_src -\tIf this url is specified, it's loaded into the player instead of src.\n\t\t\t\t\t\t\tThis allows a preview frame to be shown until animated gif data is streamed into the canvas\n\n\t\trel:auto_play -\t\tDefaults to 1 if not specified. If set to zero, the gif will be rubbable but will not \n\t\t\t\t\t\t\tanimate unless the user is rubbing it.\n\n\tConstructor options args\n\n\t\tgif \t\t\t\tRequired. The DOM element of an img tag.\n\t\tauto_play \t\t\tOptional. Same as the rel:auto_play attribute above, this arg overrides the img tag info.\n\t\tmax_width\t\t\tOptional. Scale images over max_width down to max_width. Helpful with mobile.\n\n\tInstance methods\n\n\t\t// loading\n\t\tload( callback )\tLoads the gif into a canvas element and then calls callback if one is passed\n\n\t\t// play controls\n\t\tplay -\t\t\t\tStart playing the gif\n\t\tpause -\t\t\t\tStop playing the gif\n\t\tmove_to(i) -\t\tMove to frame i of the gif\n\t\tmove_relative(i) -\tMove i frames ahead (or behind if i < 0)\n\n\t\t// getters\n\t\tget_canvas\t\t\tThe canvas element that the gif is playing in.\n\t\tget_playing\t\t\tWhether or not the gif is currently playing\n\t\tget_loading\t\t\tWhether or not the gif has finished loading/parsing\n\t\tget_auto_play\t\tWhether or not the gif is set to play automatically\n\t\tget_length\t\t\tThe number of frames in the gif\n\t\tget_current_frame\tThe index of the currently displayed frame of the gif\n\n\t\tFor additional customization (viewport inside iframe) these params may be passed:\n\t\tc_w, c_h - width and height of canvas\n\t\tvp_t, vp_l, vp_ w, vp_h - top, left, width and height of the viewport\n\n*/\n(function (root, factory) {\n    if (typeof define === 'function' && define.amd) {\n        define(['./libgif'], factory);\n    } else if (typeof exports === 'object') {\n        module.exports = factory(require('./libgif'));\n    } else {\n        root.RubbableGif = factory(root.SuperGif);\n    }\n}(this, function (SuperGif) {\n    var RubbableGif = function( options ) {\n        var sup = new SuperGif( options );\n\n        var register_canvas_handers = function () {\n\n            var isvp = function(x) {\n                return (options.vp_l ? ( x - options.vp_l ) : x );\n            }\n\n            var canvas = sup.get_canvas();\n            var maxTime = 1000,\n            // allow movement if < 1000 ms (1 sec)\n                w = ( options.vp_w ? options.vp_w : canvas.width ),\n                maxDistance = Math.floor(w / (sup.get_length() * 2)),\n            // swipe movement of 50 pixels triggers the swipe\n                startX = 0,\n                startTime = 0;\n\n            var cantouch = \"ontouchend\" in document;\n\n            var aj = 0;\n            var last_played = 0;\n\n            canvas.addEventListener((cantouch) ? 'touchstart' : 'mousedown', function (e) {\n                // prevent image drag (Firefox)\n                e.preventDefault();\n                if (sup.get_auto_play()) sup.pause();\n\n                var pos = (e.touches && e.touches.length > 0) ? e.touches[0] : e;\n\n                var x = (pos.layerX > 0) ? isvp(pos.layerX) : w / 2;\n                var progress = x / w;\n\n                sup.move_to( Math.floor(progress * (sup.get_length() - 1)) );\n\n                startTime = e.timeStamp;\n                startX = isvp(pos.pageX);\n            });\n\n            canvas.addEventListener((cantouch) ? 'touchend' : 'mouseup', function (e) {\n                startTime = 0;\n                startX = 0;\n                if (sup.get_auto_play()) sup.play();\n            });\n\n            canvas.addEventListener((cantouch) ? 'touchmove' : 'mousemove', function (e) {\n                e.preventDefault();\n                var pos = (e.touches && e.touches.length > 0) ? e.touches[0] : e;\n\n                var currentX = isvp(pos.pageX);\n                currentDistance = (startX === 0) ? 0 : Math.abs(currentX - startX);\n                // allow if movement < 1 sec\n                currentTime = e.timeStamp;\n                if (startTime !== 0 && currentDistance > maxDistance) {\n                    if (currentX < startX && sup.get_current_frame() > 0) {\n                        sup.move_relative(-1);\n                    }\n                    if (currentX > startX && sup.get_current_frame() < sup.get_length() - 1) {\n                        sup.move_relative(1);\n                    }\n                    startTime = e.timeStamp;\n                    startX = isvp(pos.pageX);\n                }\n\n                var time_since_last_play = e.timeStamp - last_played;\n                {\n                    aj++;\n                    if (document.getElementById('tickles' + ((aj % 5) + 1))) document.getElementById('tickles' + ((aj % 5) + 1)).play();\n                    last_played = e.timeStamp;\n                }\n\n\n            });\n        };\n\n        sup.orig_load = sup.load;\n        sup.load = function(callback) {\n            sup.orig_load( function() {\n                if (callback) callback();\n                register_canvas_handers( sup );\n            } );\n        }\n\n        return sup;\n    }\n\n    return RubbableGif;\n}));","// THREEx.KeyboardState.js keep the current state of the keyboard.\r\n// It is possible to query it at any time. No need of an event.\r\n// This is particularly convenient in loop driven case, like in\r\n// 3D demos or games.\r\n//\r\n// # Usage\r\n//\r\n// **Step 1**: Create the object\r\n//\r\n// ```var keyboard  = new THREEx.KeyboardState();```\r\n//\r\n// **Step 2**: Query the keyboard state\r\n//\r\n// This will return true if shift and A are pressed, false otherwise\r\n//\r\n// ```keyboard.pressed(\"shift+A\")```\r\n//\r\n// **Step 3**: Stop listening to the keyboard\r\n//\r\n// ```keyboard.destroy()```\r\n//\r\n// NOTE: this library may be nice as standaline. independant from three.js\r\n// - rename it keyboardForGame\r\n//\r\n// # Code\r\n//\r\n\r\n/** @namespace */\r\nvar THREEx = THREEx || {};\r\n\r\nif (typeof module === 'object') {\r\n\r\n  module.exports = THREEx;\r\n\r\n}\r\n\r\n/**\r\n * - NOTE: it would be quite easy to push event-driven too\r\n *   - microevent.js for events handling\r\n *   - in this._onkeyChange, generate a string from the DOM event\r\n *   - use this as event name\r\n */\r\nTHREEx.KeyboardState = function(domElement) {\r\n  this.domElement = domElement || document;\r\n  // to store the current state\r\n  this.keyCodes = {};\r\n  this.modifiers = {};\r\n\r\n  // create callback to bind/unbind keyboard events\r\n  var _this = this;\r\n  this._onKeyDown = function(event) {\r\n    _this._onKeyChange(event)\r\n  };\r\n  this._onKeyUp = function(event) {\r\n    _this._onKeyChange(event)\r\n  };\r\n\r\n  // bind keyEvents\r\n  this.domElement.addEventListener(\"keydown\", this._onKeyDown, false);\r\n  this.domElement.addEventListener(\"keyup\", this._onKeyUp, false);\r\n\r\n  // create callback to bind/unbind window blur event\r\n  this._onBlur = function() {\r\n    for (var prop in _this.keyCodes) _this.keyCodes[prop] = false;\r\n    for (var prop in _this.modifiers) _this.modifiers[prop] = false;\r\n  };\r\n\r\n  // bind window blur\r\n  window.addEventListener(\"blur\", this._onBlur, false);\r\n};\r\n\r\n/**\r\n * To stop listening of the keyboard events\r\n */\r\nTHREEx.KeyboardState.prototype.destroy = function() {\r\n  // unbind keyEvents\r\n  this.domElement.removeEventListener(\"keydown\", this._onKeyDown, false);\r\n  this.domElement.removeEventListener(\"keyup\", this._onKeyUp, false);\r\n\r\n  // unbind window blur event\r\n  window.removeEventListener(\"blur\", this._onBlur, false);\r\n};\r\n\r\nTHREEx.KeyboardState.MODIFIERS = ['shift', 'ctrl', 'alt', 'meta'];\r\nTHREEx.KeyboardState.ALIAS = {\r\n  'left': 37,\r\n  'up': 38,\r\n  'right': 39,\r\n  'down': 40,\r\n  'space': 32,\r\n  'pageup': 33,\r\n  'pagedown': 34,\r\n  'tab': 9,\r\n  'escape': 27\r\n};\r\n\r\n/**\r\n * to process the keyboard dom event\r\n */\r\nTHREEx.KeyboardState.prototype._onKeyChange = function(event) {\r\n  // log to debug\r\n  //console.log(\"onKeyChange\", event, event.keyCode, event.shiftKey, event.ctrlKey, event.altKey, event.metaKey)\r\n\r\n  // update this.keyCodes\r\n  var keyCode = event.keyCode\r\n  var pressed = event.type === 'keydown' ? true : false\r\n  this.keyCodes[keyCode] = pressed\r\n    // update this.modifiers\r\n  this.modifiers['shift'] = event.shiftKey\r\n  this.modifiers['ctrl'] = event.ctrlKey\r\n  this.modifiers['alt'] = event.altKey\r\n  this.modifiers['meta'] = event.metaKey\r\n};\r\n\r\n/**\r\n * query keyboard state to know if a key is pressed of not\r\n *\r\n * @param {String} keyDesc the description of the key. format : modifiers+key e.g shift+A\r\n * @returns {Boolean} true if the key is pressed, false otherwise\r\n */\r\nTHREEx.KeyboardState.prototype.pressed = function(keyDesc) {\r\n  var keys = keyDesc.split(\"+\");\r\n  for (var i = 0; i < keys.length; i++) {\r\n    var key = keys[i]\r\n    var pressed = false\r\n    if (THREEx.KeyboardState.MODIFIERS.indexOf(key) !== -1) {\r\n      pressed = this.modifiers[key];\r\n    }\r\n    else if (Object.keys(THREEx.KeyboardState.ALIAS).indexOf(key) != -1) {\r\n      pressed = this.keyCodes[THREEx.KeyboardState.ALIAS[key]];\r\n    }\r\n    else {\r\n      pressed = this.keyCodes[key.toUpperCase().charCodeAt(0)]\r\n    }\r\n    if (!pressed) return false;\r\n  };\r\n  return true;\r\n};\r\n\r\n/**\r\n * return true if an event match a keyDesc\r\n * @param  {KeyboardEvent} event   keyboard event\r\n * @param  {String} keyDesc string description of the key\r\n * @return {Boolean}         true if the event match keyDesc, false otherwise\r\n */\r\nTHREEx.KeyboardState.prototype.eventMatches = function(event, keyDesc) {\r\n  var aliases = THREEx.KeyboardState.ALIAS\r\n  var aliasKeys = Object.keys(aliases)\r\n  var keys = keyDesc.split(\"+\")\r\n    // log to debug\r\n    // console.log(\"eventMatches\", event, event.keyCode, event.shiftKey, event.ctrlKey, event.altKey, event.metaKey)\r\n  for (var i = 0; i < keys.length; i++) {\r\n    var key = keys[i];\r\n    var pressed = false;\r\n    if (key === 'shift') {\r\n      pressed = (event.shiftKey ? true : false)\r\n    }\r\n    else if (key === 'ctrl') {\r\n      pressed = (event.ctrlKey ? true : false)\r\n    }\r\n    else if (key === 'alt') {\r\n      pressed = (event.altKey ? true : false)\r\n    }\r\n    else if (key === 'meta') {\r\n      pressed = (event.metaKey ? true : false)\r\n    }\r\n    else if (aliasKeys.indexOf(key) !== -1) {\r\n      pressed = (event.keyCode === aliases[key] ? true : false);\r\n    }\r\n    else if (event.keyCode === key.toUpperCase().charCodeAt(0)) {\r\n      pressed = true;\r\n    }\r\n    if (!pressed) return false;\r\n  }\r\n  return true;\r\n};\r\n\r\nif (typeof exports !== 'undefined') {\r\n  if (typeof module !== 'undefined' && module.exports) {\r\n    exports = module.exports = THREEx;\r\n  }\r\n  else {\r\n    exports.THREEx = THREEx;\r\n  }\r\n}\r\nelse {\r\n  this['THREEx'] = THREEx;\r\n}\r\n\r\n","/*\n    SuperGif\n\n    Example usage:\n\n        <img src=\"./example1_preview.gif\" rel:animated_src=\"./example1.gif\" width=\"360\" height=\"360\" rel:auto_play=\"1\" />\n\n        <script type=\"text/javascript\">\n            $$('img').each(function (img_tag) {\n                if (/.*\\.gif/.test(img_tag.src)) {\n                    var rub = new SuperGif({ gif: img_tag } );\n                    rub.load();\n                }\n            });\n        </script>\n\n    Image tag attributes:\n\n        rel:animated_src -  If this url is specified, it's loaded into the player instead of src.\n                            This allows a preview frame to be shown until animated gif data is streamed into the canvas\n\n        rel:auto_play -     Defaults to 1 if not specified. If set to zero, a call to the play() method is needed\n\n    Constructor options args\n\n        gif                 Required. The DOM element of an img tag.\n        loop_mode           Optional. Setting this to false will force disable looping of the gif.\n        auto_play           Optional. Same as the rel:auto_play attribute above, this arg overrides the img tag info.\n        max_width           Optional. Scale images over max_width down to max_width. Helpful with mobile.\n        on_end              Optional. Add a callback for when the gif reaches the end of a single loop (one iteration). The first argument passed will be the gif HTMLElement.\n        loop_delay          Optional. The amount of time to pause (in ms) after each single loop (iteration).\n        draw_while_loading  Optional. Determines whether the gif will be drawn to the canvas whilst it is loaded.\n        show_progress_bar   Optional. Only applies when draw_while_loading is set to true.\n\n    Instance methods\n\n        // loading\n        load( callback )        Loads the gif specified by the src or rel:animated_src sttributie of the img tag into a canvas element and then calls callback if one is passed\n        load_url( src, callback )   Loads the gif file specified in the src argument into a canvas element and then calls callback if one is passed\n\n        // play controls\n        play -              Start playing the gif\n        pause -             Stop playing the gif\n        move_to(i) -        Move to frame i of the gif\n        move_relative(i) -  Move i frames ahead (or behind if i < 0)\n\n        // getters\n        get_canvas          The canvas element that the gif is playing in. Handy for assigning event handlers to.\n        get_playing         Whether or not the gif is currently playing\n        get_loading         Whether or not the gif has finished loading/parsing\n        get_auto_play       Whether or not the gif is set to play automatically\n        get_length          The number of frames in the gif\n        get_current_frame   The index of the currently displayed frame of the gif\n\n        For additional customization (viewport inside iframe) these params may be passed:\n        c_w, c_h - width and height of canvas\n        vp_t, vp_l, vp_ w, vp_h - top, left, width and height of the viewport\n\n        A bonus: few articles to understand what is going on\n            http://enthusiasms.org/post/16976438906\n            http://www.matthewflickinger.com/lab/whatsinagif/bits_and_bytes.asp\n            http://humpy77.deviantart.com/journal/Frame-Delay-Times-for-Animated-GIFs-214150546\n\n*/\n\n// Generic functions\nvar bitsToNum = function(ba) {\n  return ba.reduce(function(s, n) {\n    return s * 2 + n;\n  }, 0);\n};\n\nvar byteToBitArr = function(bite) {\n  var a = [];\n  for (var i = 7; i >= 0; i--) {\n    a.push(!!(bite & (1 << i)));\n  }\n  return a;\n};\n\n// Stream\n/**\n * @constructor\n */\n// Make compiler happy.\nvar Stream = function(data) {\n  this.data = data;\n  this.len = this.data.length;\n  this.pos = 0;\n\n  this.readByte = function() {\n    if (this.pos >= this.data.length) {\n      throw new Error('Attempted to read past end of stream.');\n    }\n    if (data instanceof Uint8Array)\n      return data[this.pos++];\n    else\n      return data.charCodeAt(this.pos++) & 0xFF;\n  };\n\n  this.readBytes = function(n) {\n    var bytes = [];\n    for (var i = 0; i < n; i++) {\n      bytes.push(this.readByte());\n    }\n    return bytes;\n  };\n\n  this.read = function(n) {\n    var s = '';\n    for (var i = 0; i < n; i++) {\n      s += String.fromCharCode(this.readByte());\n    }\n    return s;\n  };\n\n  this.readUnsigned = function() { // Little-endian.\n    var a = this.readBytes(2);\n    return (a[1] << 8) + a[0];\n  };\n};\n\nvar lzwDecode = function(minCodeSize, data) {\n  // TODO: Now that the GIF parser is a bit different, maybe this should get an array of bytes instead of a String?\n  var pos = 0; // Maybe this streaming thing should be merged with the Stream?\n  var readCode = function(size) {\n    var code = 0;\n    for (var i = 0; i < size; i++) {\n      if (data.charCodeAt(pos >> 3) & (1 << (pos & 7))) {\n        code |= 1 << i;\n      }\n      pos++;\n    }\n    return code;\n  };\n\n  var output = [];\n\n  var clearCode = 1 << minCodeSize;\n  var eoiCode = clearCode + 1;\n\n  var codeSize = minCodeSize + 1;\n\n  var dict = [];\n\n  var clear = function() {\n    dict = [];\n    codeSize = minCodeSize + 1;\n    for (var i = 0; i < clearCode; i++) {\n      dict[i] = [i];\n    }\n    dict[clearCode] = [];\n    dict[eoiCode] = null;\n\n  };\n\n  var code;\n  var last;\n\n  while (true) {\n    last = code;\n    code = readCode(codeSize);\n\n    if (code === clearCode) {\n      clear();\n      continue;\n    }\n    if (code === eoiCode) break;\n\n    if (code < dict.length) {\n      if (last !== clearCode) {\n        dict.push(dict[last].concat(dict[code][0]));\n      }\n    }\n    else {\n      if (code !== dict.length) throw new Error('Invalid LZW code.');\n      dict.push(dict[last].concat(dict[last][0]));\n    }\n    output.push.apply(output, dict[code]);\n\n    if (dict.length === (1 << codeSize) && codeSize < 12) {\n      // If we're at the last code and codeSize is 12, the next code will be a clearCode, and it'll be 12 bits long.\n      codeSize++;\n    }\n  }\n\n  // I don't know if this is technically an error, but some GIFs do it.\n  //if (Math.ceil(pos / 8) !== data.length) throw new Error('Extraneous LZW bytes.');\n  return output;\n};\n\n\n// The actual parsing; returns an object with properties.\nvar parseGIF = function(st, handler) {\n  handler || (handler = {});\n\n  // LZW (GIF-specific)\n  var parseCT = function(entries) { // Each entry is 3 bytes, for RGB.\n    var ct = [];\n    for (var i = 0; i < entries; i++) {\n      ct.push(st.readBytes(3));\n    }\n    return ct;\n  };\n\n  var readSubBlocks = function() {\n    var size, data;\n    data = '';\n    do {\n      size = st.readByte();\n      data += st.read(size);\n    } while (size !== 0);\n    return data;\n  };\n\n  var parseHeader = function() {\n    var hdr = {};\n    hdr.sig = st.read(3);\n    hdr.ver = st.read(3);\n    if (hdr.sig !== 'GIF') throw new Error('Not a GIF file.'); // XXX: This should probably be handled more nicely.\n    hdr.width = st.readUnsigned();\n    hdr.height = st.readUnsigned();\n\n    var bits = byteToBitArr(st.readByte());\n    hdr.gctFlag = bits.shift();\n    hdr.colorRes = bitsToNum(bits.splice(0, 3));\n    hdr.sorted = bits.shift();\n    hdr.gctSize = bitsToNum(bits.splice(0, 3));\n\n    hdr.bgColor = st.readByte();\n    hdr.pixelAspectRatio = st.readByte(); // if not 0, aspectRatio = (pixelAspectRatio + 15) / 64\n    if (hdr.gctFlag) {\n      hdr.gct = parseCT(1 << (hdr.gctSize + 1));\n    }\n    handler.hdr && handler.hdr(hdr);\n  };\n\n  var parseExt = function(block) {\n    var parseGCExt = function(block) {\n      var blockSize = st.readByte(); // Always 4\n      var bits = byteToBitArr(st.readByte());\n      block.reserved = bits.splice(0, 3); // Reserved; should be 000.\n      block.disposalMethod = bitsToNum(bits.splice(0, 3));\n      block.userInput = bits.shift();\n      block.transparencyGiven = bits.shift();\n\n      block.delayTime = st.readUnsigned();\n\n      block.transparencyIndex = st.readByte();\n\n      block.terminator = st.readByte();\n\n      handler.gce && handler.gce(block);\n    };\n\n    var parseComExt = function(block) {\n      block.comment = readSubBlocks();\n      handler.com && handler.com(block);\n    };\n\n    var parsePTExt = function(block) {\n      // No one *ever* uses this. If you use it, deal with parsing it yourself.\n      var blockSize = st.readByte(); // Always 12\n      block.ptHeader = st.readBytes(12);\n      block.ptData = readSubBlocks();\n      handler.pte && handler.pte(block);\n    };\n\n    var parseAppExt = function(block) {\n      var parseNetscapeExt = function(block) {\n        var blockSize = st.readByte(); // Always 3\n        block.unknown = st.readByte(); // ??? Always 1? What is this?\n        block.iterations = st.readUnsigned();\n        block.terminator = st.readByte();\n        handler.app && handler.app.NETSCAPE && handler.app.NETSCAPE(block);\n      };\n\n      var parseUnknownAppExt = function(block) {\n        block.appData = readSubBlocks();\n        // FIXME: This won't work if a handler wants to match on any identifier.\n        handler.app && handler.app[block.identifier] && handler.app[block.identifier](block);\n      };\n\n      var blockSize = st.readByte(); // Always 11\n      block.identifier = st.read(8);\n      block.authCode = st.read(3);\n      switch (block.identifier) {\n        case 'NETSCAPE':\n          parseNetscapeExt(block);\n          break;\n        default:\n          parseUnknownAppExt(block);\n          break;\n      }\n    };\n\n    var parseUnknownExt = function(block) {\n      block.data = readSubBlocks();\n      handler.unknown && handler.unknown(block);\n    };\n\n    block.label = st.readByte();\n    switch (block.label) {\n      case 0xF9:\n        block.extType = 'gce';\n        parseGCExt(block);\n        break;\n      case 0xFE:\n        block.extType = 'com';\n        parseComExt(block);\n        break;\n      case 0x01:\n        block.extType = 'pte';\n        parsePTExt(block);\n        break;\n      case 0xFF:\n        block.extType = 'app';\n        parseAppExt(block);\n        break;\n      default:\n        block.extType = 'unknown';\n        parseUnknownExt(block);\n        break;\n    }\n  };\n\n  var parseImg = function(img) {\n    var deinterlace = function(pixels, width) {\n      // Of course this defeats the purpose of interlacing. And it's *probably*\n      // the least efficient way it's ever been implemented. But nevertheless...\n      var newPixels = new Array(pixels.length);\n      var rows = pixels.length / width;\n      var cpRow = function(toRow, fromRow) {\n        var fromPixels = pixels.slice(fromRow * width, (fromRow + 1) * width);\n        newPixels.splice.apply(newPixels, [toRow * width, width].concat(fromPixels));\n      };\n\n      // See appendix E.\n      var offsets = [0, 4, 2, 1];\n      var steps = [8, 8, 4, 2];\n\n      var fromRow = 0;\n      for (var pass = 0; pass < 4; pass++) {\n        for (var toRow = offsets[pass]; toRow < rows; toRow += steps[pass]) {\n          cpRow(toRow, fromRow)\n          fromRow++;\n        }\n      }\n\n      return newPixels;\n    };\n\n    img.leftPos = st.readUnsigned();\n    img.topPos = st.readUnsigned();\n    img.width = st.readUnsigned();\n    img.height = st.readUnsigned();\n\n    var bits = byteToBitArr(st.readByte());\n    img.lctFlag = bits.shift();\n    img.interlaced = bits.shift();\n    img.sorted = bits.shift();\n    img.reserved = bits.splice(0, 2);\n    img.lctSize = bitsToNum(bits.splice(0, 3));\n\n    if (img.lctFlag) {\n      img.lct = parseCT(1 << (img.lctSize + 1));\n    }\n\n    img.lzwMinCodeSize = st.readByte();\n\n    var lzwData = readSubBlocks();\n\n    img.pixels = lzwDecode(img.lzwMinCodeSize, lzwData);\n\n    if (img.interlaced) { // Move\n      img.pixels = deinterlace(img.pixels, img.width);\n    }\n\n    handler.img && handler.img(img);\n  };\n\n  var parseBlock = function() {\n    var block = {};\n    block.sentinel = st.readByte();\n\n    switch (String.fromCharCode(block.sentinel)) { // For ease of matching\n      case '!':\n        block.type = 'ext';\n        parseExt(block);\n        break;\n      case ',':\n        block.type = 'img';\n        parseImg(block);\n        break;\n      case ';':\n        block.type = 'eof';\n        handler.eof && handler.eof(block);\n        break;\n      default:\n        throw new Error('Unknown block: 0x' + block.sentinel.toString(16)); // TODO: Pad this with a 0.\n    }\n\n    if (block.type !== 'eof') setTimeout(parseBlock, 0);\n  };\n\n  var parse = function() {\n    parseHeader();\n    setTimeout(parseBlock, 0);\n  };\n\n  parse();\n};\n\nvar SuperGif = function(opts) {\n  var options = {\n    //viewport position\n    vp_l: 0,\n    vp_t: 0,\n    vp_w: null,\n    vp_h: null,\n    //canvas sizes\n    c_w: null,\n    c_h: null\n  };\n  for (var i in opts) {\n    options[i] = opts[i]\n  }\n  if (options.vp_w && options.vp_h) options.is_vp = true;\n\n  var stream;\n  var hdr;\n\n  var loadError = null;\n  var loading = false;\n\n  var transparency = null;\n  var delay = null;\n  var disposalMethod = null;\n  var disposalRestoreFromIdx = 0;\n  var lastDisposalMethod = null;\n  var frame = null;\n  var lastImg = null;\n\n  var playing = true;\n  var forward = true;\n\n  var ctx_scaled = false;\n\n  var frames = [];\n  var frameOffsets = []; // elements have .x and .y properties\n\n  var gif = options.gif;\n  if (typeof options.auto_play == 'undefined')\n    options.auto_play = (!gif.getAttribute('rel:auto_play') || gif.getAttribute('rel:auto_play') == '1');\n\n  var onEndListener = (options.hasOwnProperty('on_end') ? options.on_end : null);\n  var loopDelay = (options.hasOwnProperty('loop_delay') ? options.loop_delay : 0);\n  var overrideLoopMode = (options.hasOwnProperty('loop_mode') ? options.loop_mode : 'auto');\n  var drawWhileLoading = (options.hasOwnProperty('draw_while_loading') ? options.draw_while_loading : true);\n  var showProgressBar = drawWhileLoading ? (options.hasOwnProperty('show_progress_bar') ? options.show_progress_bar : true) : false;\n\n  var clear = function() {\n    transparency = null;\n    delay = null;\n    lastDisposalMethod = disposalMethod;\n    disposalMethod = null;\n    frame = null;\n  };\n\n  // XXX: There's probably a better way to handle catching exceptions when\n  // callbacks are involved.\n  var doParse = function() {\n    try {\n      parseGIF(stream, handler);\n    }\n    catch (err) {\n      doLoadError('parse');\n    }\n  };\n\n  var doText = function(text) {\n    toolbar.innerHTML = text; // innerText? Escaping? Whatever.\n    toolbar.style.visibility = 'visible';\n  };\n\n  var setSizes = function(w, h) {\n    canvas.width = w * get_canvas_scale();\n    canvas.height = h * get_canvas_scale();\n    toolbar.style.minWidth = (w * get_canvas_scale()) + 'px';\n\n    tmpCanvas.width = w;\n    tmpCanvas.height = h;\n    tmpCanvas.style.width = w + 'px';\n    tmpCanvas.style.height = h + 'px';\n    tmpCanvas.getContext('2d').setTransform(1, 0, 0, 1, 0, 0);\n  };\n\n  var setFrameOffset = function(frame, offset) {\n    if (!frameOffsets[frame]) {\n      frameOffsets[frame] = offset;\n      return;\n    }\n    if (typeof offset.x !== 'undefined') {\n      frameOffsets[frame].x = offset.x;\n    }\n    if (typeof offset.y !== 'undefined') {\n      frameOffsets[frame].y = offset.y;\n    }\n  };\n\n  var doShowProgress = function(pos, length, draw) {\n    if (draw && showProgressBar) {\n      var height = 25;\n      var left, mid, top, width;\n      if (options.is_vp) {\n        if (!ctx_scaled) {\n          top = (options.vp_t + options.vp_h - height);\n          height = height;\n          left = options.vp_l;\n          mid = left + (pos / length) * options.vp_w;\n          width = canvas.width;\n        }\n        else {\n          top = (options.vp_t + options.vp_h - height) / get_canvas_scale();\n          height = height / get_canvas_scale();\n          left = (options.vp_l / get_canvas_scale());\n          mid = left + (pos / length) * (options.vp_w / get_canvas_scale());\n          width = canvas.width / get_canvas_scale();\n        }\n        //some debugging, draw rect around viewport\n        if (false) {\n          if (!ctx_scaled) {\n            var l = options.vp_l,\n              t = options.vp_t;\n            var w = options.vp_w,\n              h = options.vp_h;\n          }\n          else {\n            var l = options.vp_l / get_canvas_scale(),\n              t = options.vp_t / get_canvas_scale();\n            var w = options.vp_w / get_canvas_scale(),\n              h = options.vp_h / get_canvas_scale();\n          }\n          ctx.rect(l, t, w, h);\n          ctx.stroke();\n        }\n      }\n      else {\n        top = (canvas.height - height) / (ctx_scaled ? get_canvas_scale() : 1);\n        mid = ((pos / length) * canvas.width) / (ctx_scaled ? get_canvas_scale() : 1);\n        width = canvas.width / (ctx_scaled ? get_canvas_scale() : 1);\n        height /= ctx_scaled ? get_canvas_scale() : 1;\n      }\n      // XXX Figure out alpha fillRect.\n      //ctx.fillStyle = 'salmon';\n      ctx.fillStyle = 'rgba(255,255,255,0.4)';\n      ctx.fillRect(mid, top, width - mid, height);\n\n      //ctx.fillStyle = 'teal';\n      ctx.fillStyle = 'rgba(255,0,22,.8)';\n      ctx.fillRect(0, top, mid, height);\n    }\n  };\n\n  var doLoadError = function(originOfError) {\n    var drawError = function() {\n      ctx.fillStyle = 'black';\n      ctx.fillRect(0, 0, options.c_w ? options.c_w : hdr.width, options.c_h ? options.c_h : hdr.height);\n      ctx.strokeStyle = 'red';\n      ctx.lineWidth = 3;\n      ctx.moveTo(0, 0);\n      ctx.lineTo(options.c_w ? options.c_w : hdr.width, options.c_h ? options.c_h : hdr.height);\n      ctx.moveTo(0, options.c_h ? options.c_h : hdr.height);\n      ctx.lineTo(options.c_w ? options.c_w : hdr.width, 0);\n      ctx.stroke();\n    };\n\n    loadError = originOfError;\n    hdr = {\n      width: gif.width,\n      height: gif.height\n    }; // Fake header.\n    frames = [];\n    drawError();\n  };\n\n  var doHdr = function(_hdr) {\n    hdr = _hdr;\n    setSizes(hdr.width, hdr.height)\n  };\n\n  var doGCE = function(gce) {\n    pushFrame();\n    clear();\n    transparency = gce.transparencyGiven ? gce.transparencyIndex : null;\n    delay = gce.delayTime;\n    disposalMethod = gce.disposalMethod;\n    // We don't have much to do with the rest of GCE.\n  };\n\n  var pushFrame = function() {\n    if (!frame) return;\n    frames.push({\n      data: frame.getImageData(0, 0, hdr.width, hdr.height),\n      delay: delay\n    });\n    frameOffsets.push({\n      x: 0,\n      y: 0\n    });\n  };\n\n  var doImg = function(img) {\n    if (!frame) frame = tmpCanvas.getContext('2d');\n\n    var currIdx = frames.length;\n\n    //ct = color table, gct = global color table\n    var ct = img.lctFlag ? img.lct : hdr.gct; // TODO: What if neither exists?\n\n    /*\n    Disposal method indicates the way in which the graphic is to\n    be treated after being displayed.\n\n    Values :    0 - No disposal specified. The decoder is\n                    not required to take any action.\n                1 - Do not dispose. The graphic is to be left\n                    in place.\n                2 - Restore to background color. The area used by the\n                    graphic must be restored to the background color.\n                3 - Restore to previous. The decoder is required to\n                    restore the area overwritten by the graphic with\n                    what was there prior to rendering the graphic.\n\n                    Importantly, \"previous\" means the frame state\n                    after the last disposal of method 0, 1, or 2.\n    */\n    if (currIdx > 0) {\n      if (lastDisposalMethod === 3) {\n        // Restore to previous\n        frame.putImageData(frames[disposalRestoreFromIdx].data, 0, 0);\n      }\n      else {\n        disposalRestoreFromIdx = currIdx - 1;\n      }\n\n      if (lastDisposalMethod === 2) {\n        // Restore to background color\n        // Browser implementations historically restore to transparent; we do the same.\n        // http://www.wizards-toolkit.org/discourse-server/viewtopic.php?f=1&t=21172#p86079\n        frame.clearRect(lastImg.leftPos, lastImg.topPos, lastImg.width, lastImg.height);\n      }\n    }\n    // else, Undefined/Do not dispose.\n    // frame contains final pixel data from the last frame; do nothing\n\n    //Get existing pixels for img region after applying disposal method\n    var imgData = frame.getImageData(img.leftPos, img.topPos, img.width, img.height);\n\n    //apply color table colors\n    var cdd = imgData.data;\n    img.pixels.forEach(function(pixel, i) {\n      // imgData.data === [R,G,B,A,R,G,B,A,...]\n      if (pixel !== transparency) {\n        cdd[i * 4 + 0] = ct[pixel][0];\n        cdd[i * 4 + 1] = ct[pixel][1];\n        cdd[i * 4 + 2] = ct[pixel][2];\n        cdd[i * 4 + 3] = 255; // Opaque.\n      }\n    });\n    imgData.data.set(cdd);\n\n    frame.putImageData(imgData, img.leftPos, img.topPos);\n\n    if (!ctx_scaled) {\n      ctx.scale(get_canvas_scale(), get_canvas_scale());\n      ctx_scaled = true;\n    }\n\n    // We could use the on-page canvas directly, except that we draw a progress\n    // bar for each image chunk (not just the final image).\n    if (drawWhileLoading)\n      ctx.drawImage(tmpCanvas, 0, 0);\n\n    lastImg = img;\n  };\n\n  var player = (function() {\n    var i = -1;\n    var iterationCount = 0;\n\n    var showingInfo = false;\n    var pinned = false;\n\n    /**\n     * Gets the index of the frame \"up next\".\n     * @returns {number}\n     */\n    var getNextFrameNo = function() {\n      var delta = (forward ? 1 : -1);\n      return (i + delta + frames.length) % frames.length;\n    };\n\n    var stepFrame = function(amount) { // XXX: Name is confusing.\n      i = i + amount;\n\n      putFrame();\n    };\n\n    var completeLoop = function() {\n      if (onEndListener !== null)\n        onEndListener(gif);\n      iterationCount++;\n    };\n\n    var step = (function() {\n      var stepping = false;\n\n      var doStep = function() {\n        stepping = playing;\n        if (!stepping) return;\n\n        stepFrame(1);\n        var delay = frames[i].delay * 10;\n        if (!delay) delay = 100; // FIXME: Should this even default at all? What should it be?\n\n        var nextFrameNo = getNextFrameNo();\n        if (nextFrameNo === 0) {\n          delay += loopDelay;\n          setTimeout(completeLoop, delay - 1);\n        }\n\n        if ((overrideLoopMode !== false || nextFrameNo !== 0 || iterationCount < 0))\n          setTimeout(doStep, delay);\n\n      };\n\n      return function() {\n        if (!stepping) setTimeout(doStep, 0);\n      };\n    }());\n\n    var putFrame = function() {\n      var offset;\n      i = parseInt(i, 10);\n\n      if (i > frames.length - 1) {\n        i = 0;\n      }\n\n      if (i < 0) {\n        i = 0;\n      }\n\n      offset = frameOffsets[i];\n\n      tmpCanvas.getContext(\"2d\").putImageData(frames[i].data, offset.x, offset.y);\n      ctx.globalCompositeOperation = \"copy\";\n      ctx.drawImage(tmpCanvas, 0, 0);\n    };\n\n    var play = function() {\n      playing = true;\n      step();\n    };\n\n    var pause = function() {\n      playing = false;\n    };\n\n\n    return {\n      init: function() {\n        if (loadError) return;\n\n        if (!(options.c_w && options.c_h)) {\n          ctx.scale(get_canvas_scale(), get_canvas_scale());\n        }\n\n        if (options.auto_play) {\n          step();\n        }\n        else {\n          i = 0;\n          putFrame();\n        }\n      },\n      step: step,\n      play: play,\n      pause: pause,\n      playing: playing,\n      move_relative: stepFrame,\n      current_frame: function() {\n        return i;\n      },\n      length: function() {\n        return frames.length\n      },\n      move_to: function(frame_idx) {\n        i = frame_idx;\n        putFrame();\n      }\n    }\n  }());\n\n  var doDecodeProgress = function(draw) {\n    doShowProgress(stream.pos, stream.data.length, draw);\n  };\n\n  var doNothing = function() {};\n  /**\n   * @param{boolean=} draw Whether to draw progress bar or not; this is not idempotent because of translucency.\n   *                       Note that this means that the text will be unsynchronized with the progress bar on non-frames;\n   *                       but those are typically so small (GCE etc.) that it doesn't really matter. TODO: Do this properly.\n   */\n  var withProgress = function(fn, draw) {\n    return function(block) {\n      fn(block);\n      doDecodeProgress(draw);\n    };\n  };\n\n\n  var handler = {\n    hdr: withProgress(doHdr),\n    gce: withProgress(doGCE),\n    com: withProgress(doNothing),\n    // I guess that's all for now.\n    app: {\n      // TODO: Is there much point in actually supporting iterations?\n      NETSCAPE: withProgress(doNothing)\n    },\n    img: withProgress(doImg, true),\n    eof: function(block) {\n      //toolbar.style.display = '';\n      pushFrame();\n      doDecodeProgress(false);\n      if (!(options.c_w && options.c_h)) {\n        canvas.width = hdr.width * get_canvas_scale();\n        canvas.height = hdr.height * get_canvas_scale();\n      }\n      player.init();\n      loading = false;\n      if (load_callback) {\n        load_callback(gif);\n      }\n\n    }\n  };\n\n  var init = function() {\n    var parent = gif.parentNode;\n\n    var span = document.createElement('span');\n    canvas = document.createElement('canvas');\n    ctx = canvas.getContext('2d');\n    toolbar = document.createElement('div');\n\n    tmpCanvas = document.createElement('canvas');\n\n    span.width = canvas.width = gif.width;\n    span.height = canvas.height = gif.height;\n    toolbar.style.minWidth = gif.width + 'px';\n\n    span.className = 'jsgif';\n    toolbar.className = 'jsgif_toolbar';\n    span.appendChild(canvas);\n    span.appendChild(toolbar);\n\n    parent.insertBefore(span, gif);\n    parent.removeChild(gif);\n\n    if (options.c_w && options.c_h) setSizes(options.c_w, options.c_h);\n    initialized = true;\n  };\n\n  var get_canvas_scale = function() {\n    var scale;\n    if (options.max_width && hdr && hdr.width > options.max_width) {\n      scale = options.max_width / hdr.width;\n    }\n    else {\n      scale = 1;\n    }\n    return scale;\n  }\n\n  var canvas, ctx, toolbar, tmpCanvas;\n  var initialized = false;\n  var load_callback = false;\n\n  var load_setup = function(callback) {\n    if (loading) return false;\n    if (callback) load_callback = callback;\n    else load_callback = false;\n\n    loading = true;\n    frames = [];\n    clear();\n    disposalRestoreFromIdx = 0;\n    lastDisposalMethod = null;\n    frame = null;\n    lastImg = null;\n\n    return true;\n  }\n\n  return {\n    // play controls\n    play: player.play,\n    pause: player.pause,\n    move_relative: player.move_relative,\n    move_to: player.move_to,\n\n    // getters for instance vars\n    get_playing: function() {\n      return player.playing\n    },\n    get_canvas: function() {\n      return canvas\n    },\n    get_canvas_scale: function() {\n      return get_canvas_scale()\n    },\n    get_loading: function() {\n      return loading\n    },\n    get_auto_play: function() {\n      return options.auto_play\n    },\n    get_length: function() {\n      return player.length()\n    },\n    get_current_frame: function() {\n      return player.current_frame()\n    },\n    load_url: function(src, callback) {\n      if (!load_setup(callback)) return;\n\n      var h = new XMLHttpRequest();\n      h.overrideMimeType('text/plain; charset=x-user-defined');\n      h.onloadstart = function() {\n        // Wait until connection is opened to replace the gif element with a canvas to avoid a blank img\n        if (!initialized) init();\n      };\n      h.onload = function(e) {\n        stream = new Stream(h.responseText);\n        setTimeout(doParse, 0);\n      };\n      h.onprogress = function(e) {\n        if (e.lengthComputable) doShowProgress(e.loaded, e.total, true);\n      };\n      h.onerror = function() {\n        doLoadError('xhr');\n      };\n      h.open('GET', src, true);\n      h.send();\n    },\n    load: function(callback) {\n      this.load_url(gif.getAttribute('rel:animated_src') || gif.src, callback);\n    },\n    load_raw: function(arr, callback) {\n      if (!load_setup(callback)) return;\n      if (!initialized) init();\n      stream = new Stream(arr);\n      setTimeout(doParse, 0);\n    },\n    set_frame_offset: setFrameOffset\n  };\n};\n\nmodule.exports = SuperGif;\n\n","var Utils = Utils || {};\r\n\r\nUtils.randomRange = function(min, max) {\r\n  return Math.random() * (max - min) + min;\r\n};\r\n\r\nmodule.exports = Utils;\r\n\r\n","Globals = Class({\r\n  constructor: function() {\r\n    this.dt = 0;\r\n\r\n    this.hudElement = null;\r\n\r\n    this.healthElement = null;\r\n\r\n    this.scoreElement = null;\r\n    this.score = 0;\r\n\r\n    this.reloadingElement = null;\r\n    this.reloadImg = null;\r\n\r\n    this.overlayElement = null;\r\n\r\n    this.sound = null;\r\n  }\r\n}, {\r\n  statics: {\r\n    get instance() {\r\n      if (!Globals._instance) {\r\n        Globals._instance = new Globals();\r\n      }\r\n      return Globals._instance;\r\n    },\r\n\r\n    DIR: \"./\",\r\n\r\n    ENTITY_TYPES: {\r\n      player: 0,\r\n      enemy: 1,\r\n\r\n      ground: 2,\r\n      obstacle: 3,\r\n\r\n      bullet: 4\r\n    }\r\n  }\r\n});\r\n\r\n","Game = Class({\r\n  constructor: function(options) {\r\n    this.container = options.container;\r\n    this.loadingContainer = options.loadingContainer;\r\n    this.blocker = options.blocker;\r\n    this.instructions = options.instructions;\r\n    this.crosshair = options.crosshair;\r\n\r\n    this.stats = null;\r\n\r\n    this.prevTime = performance.now();\r\n\r\n    this.renderer = null;\r\n    this.scene = null;\r\n    this.camera = null;\r\n\r\n    this.paused = true;\r\n\r\n    this.controlsEnabled = false;\r\n    this.controls = null;\r\n\r\n    this.systems = [];\r\n    this.postPhysicsSystems = [];\r\n\r\n    this.modelsToPreload = options.modelsToPreload;\r\n    this.percentModelsLoaded = 0;\r\n\r\n    this.soundsToPreload = options.soundsToPreload;\r\n    this.percentSoundsLoaded = 0;\r\n\r\n    this.systemsDelay = 0;\r\n  },\r\n\r\n  start: function(runImmediately) {\r\n    if (runImmediately === undefined || runImmediately === null) {\r\n      runImmediately = true;\r\n    }\r\n\r\n    window.addEventListener('resize', this.onResize.bind(this));\r\n    window.onkeydown = this.onKeyDown.bind(this); // prevent spacebar from scrolling the page\r\n    window.addEventListener('mousedown', this.onMouseDown.bind(this));\r\n    window.addEventListener('mouseup', this.onMouseUp.bind(this));\r\n\r\n    this.renderer = new THREE.WebGLRenderer({\r\n      antialias: true\r\n    });\r\n    this.renderer.setSize(window.innerWidth, window.innerHeight);\r\n    //this.renderer.setClearColor(0xffffff, 1);\r\n    this.renderer.setClearColor(0xbc00bc, 1);\r\n    this.container.appendChild(this.renderer.domElement);\r\n\r\n    /* Stats.js Setup */\r\n    this.stats = new Stats();\r\n    this.stats.setMode(0);\r\n\r\n    this.stats.domElement.style.position = 'absolute';\r\n    this.stats.domElement.style.left = '10px';\r\n    this.stats.domElement.style.bottom = '10px';\r\n\r\n    document.body.appendChild(this.stats.domElement);\r\n\r\n    // Create a new Three.js scene\r\n    this.scene = new Physijs.Scene();\r\n    this.scene.setGravity(new THREE.Vector3(0, -32, 0));\r\n\r\n    // Put in a camera\r\n    var aspectRatio = window.innerWidth / window.innerHeight;\r\n    this.camera = new THREE.PerspectiveCamera(45, aspectRatio, 0.1, 1000);\r\n    this.scene.add(this.camera);\r\n\r\n    /* Camera Controller */\r\n    this.controls = new PointerLockControls({\r\n      camera: this.camera\r\n    });\r\n    this.scene.add(this.controls.getObject());\r\n\r\n    /* Setup Crosshair */\r\n\r\n    this.crosshair.style.left = ((window.innerWidth / 2) - 32) + 'px';\r\n    this.crosshair.style.top = ((window.innerHeight / 2) - 32) + 'px';\r\n\r\n    var ambientLight = new THREE.AmbientLight(0xcbcbcb);\r\n    this.scene.add(ambientLight);\r\n\r\n    var dirLight = new THREE.DirectionalLight(0xdcdcdc, 0.5);\r\n    this.scene.add(dirLight);\r\n\r\n    /* Create Entities */\r\n\r\n    EntityFactory.instance.makeGround({\r\n      scene: this.scene,\r\n      width: 2000,\r\n      height: 2000\r\n    });\r\n\r\n    this.player = EntityFactory.instance.makePlayer({\r\n      scene: this.scene,\r\n      position: new THREE.Vector3(0, 30, 0),\r\n      controls: this.controls,\r\n      controlsObject: this.controls.getObject(),\r\n      cameraOffset: new THREE.Vector3(0, 10, 0), // 10, 10, 25\r\n      gunOffset: new THREE.Vector3(9, 11, 0),\r\n      hp: 20\r\n    });\r\n\r\n    EntityFactory.instance.makeEnemy({\r\n      scene: this.scene,\r\n      position: new THREE.Vector3(0, 30, -200),\r\n      aiTarget: this.player,\r\n      bulletSpeed: Math.random() * (60 - 15) + 15,\r\n      hp: 15\r\n    });\r\n\r\n    EntityFactory.instance.makeEnemy({\r\n      scene: this.scene,\r\n      position: new THREE.Vector3(-100, 30, -150),\r\n      aiTarget: this.player,\r\n      bulletSpeed: Math.random() * (60 - 15) + 15,\r\n      hp: 15\r\n    });\r\n\r\n    this.setupAudio();\r\n\r\n    /* Setup Systems */\r\n\r\n    this.systems.push(new PlayerInputSystem(EntityFactory.instance.entities));\r\n    this.systems.push(new AISystem(EntityFactory.instance.entities));\r\n    this.systems.push(new MovementSystem(EntityFactory.instance.entities));\r\n    this.systems.push(new ExpirableSystem(EntityFactory.instance.entities));\r\n    this.systems.push(new CameraPitchSystem(EntityFactory.instance.entities));\r\n    this.systems.push(new ShootDelaySystem(EntityFactory.instance.entities));\r\n    this.systems.push(new HurtSystem(EntityFactory.instance.entities));\r\n    this.systems.push(new PlayerHealthSystem(EntityFactory.instance.entities));\r\n    this.systems.push(new HealthBarSystem(EntityFactory.instance.entities));\r\n    this.systems.push(new DeathSystem(EntityFactory.instance.entities));\r\n    this.systems.push(new SteamRemovalSystem(EntityFactory.instance.entities));\r\n    this.systems.push(new SteamUpdateSystem(EntityFactory.instance.entities));\r\n\r\n    this.postPhysicsSystems.push(new PhysicsUpdateSystem(EntityFactory.instance.entities));\r\n    this.postPhysicsSystems.push(new CameraFollowSystem(EntityFactory.instance.entities));\r\n\r\n    this.loadModels();\r\n    this.loadSounds();\r\n  },\r\n\r\n  setupAudio: function() {\r\n    window.AudioContext = (\r\n      window.AudioContext ||\r\n      window.webkitAudioContext ||\r\n      null\r\n    );\r\n\r\n    if (!AudioContext) {\r\n      throw new Error(\"AudioContext not supported!\");\r\n    }\r\n\r\n    var ctx = new AudioContext();\r\n\r\n    Globals.instance.sound = new SoundController({\r\n      context: ctx,\r\n      following: this.camera\r\n    });\r\n  },\r\n\r\n  loadSounds: function() {\r\n    this.soundsToPreload.forEach(function(path) {\r\n      Globals.instance.sound.loadSound(Globals.DIR + path, this.soundLoaded.bind(this));\r\n    }.bind(this));\r\n  },\r\n\r\n  soundLoaded: function(sound) {\r\n    var percentPerSound = 100.0 / this.soundsToPreload.length;\r\n    this.percentSoundsLoaded += percentPerSound;\r\n\r\n    if (this.percentSoundsLoaded > 99.0) {\r\n      // hide loading indicator and show instructions\r\n      this.loadingContainer.style.visibility = \"hidden\";\r\n      this.blocker.style.visibility = \"visible\";\r\n      this.instructions.style.visibility = \"visible\";\r\n      Globals.instance.hudElement.style.display = 'block';\r\n      //this.crosshair.style.display = 'block';\r\n\r\n      // ensure the user is at the top of the page\r\n      document.body.scrollTop = document.documentElement.scrollTop = 0;\r\n\r\n      this.update(false);\r\n\r\n      this.initPointerLock();\r\n\r\n      this.update(true);\r\n    }\r\n  },\r\n\r\n  loadModels: function() {\r\n    this.modelsToPreload.forEach(function(path) {\r\n      ResourceManager.instance.loadModel(Globals.DIR + path, this.modelLoaded.bind(this));\r\n    }.bind(this));\r\n  },\r\n\r\n  modelLoaded: function(model) {\r\n    var percentPerModel = 100.0 / this.modelsToPreload.length;\r\n    this.percentModelsLoaded += percentPerModel;\r\n  },\r\n\r\n  update: function(animationFrame) {\r\n    if (animationFrame) {\r\n      requestAnimationFrame(this.update.bind(this));\r\n    }\r\n\r\n    var time = performance.now();\r\n    var dt = (time - this.prevTime) / 1000;\r\n    Globals.instance.dt = dt;\r\n\r\n    if (!this.paused) {\r\n      if (dt > 0.05) {\r\n        dt = 0.05;\r\n      }\r\n\r\n      this.systems.forEach(function(system) {\r\n        system.update(dt);\r\n      });\r\n\r\n      this.scene.simulate(dt);\r\n\r\n      this.postPhysicsSystems.forEach(function(system) {\r\n        system.update(dt);\r\n      });\r\n\r\n      Globals.instance.sound.update(dt);\r\n\r\n      MouseController.instance.update(dt);\r\n    }\r\n\r\n    this.renderer.render(this.scene, this.camera);\r\n    this.stats.update();\r\n\r\n    this.prevTime = time;\r\n  },\r\n\r\n  onResize: function(e) {\r\n    this.renderer.setSize(window.innerWidth, window.innerHeight);\r\n\r\n    this.camera.aspect = (window.innerWidth / window.innerHeight);\r\n    this.camera.updateProjectionMatrix();\r\n\r\n    this.crosshair.style.left = ((window.innerWidth / 2) - 32) + 'px';\r\n    this.crosshair.style.top = ((window.innerHeight / 2) - 32) + 'px';\r\n  },\r\n\r\n  onKeyDown: function(e) {\r\n    var keyCode = ('which' in event) ? event.which : event.keyCode;\r\n\r\n    return (keyCode !== Game.KEY_CODES.space);\r\n  },\r\n\r\n  onMouseDown: function(e) {\r\n    if (this.paused) {\r\n      return;\r\n    }\r\n\r\n    if (e.button === 0) {\r\n      MouseController.instance.isDown.left = true;\r\n    }\r\n    else if (e.button === 2) {\r\n      MouseController.instance.isDown.right = true;\r\n    }\r\n  },\r\n\r\n  onMouseUp: function(e) {\r\n    if (this.paused) {\r\n      return;\r\n    }\r\n\r\n    if (e.button === 0) {\r\n      MouseController.instance.isDown.left = false;\r\n      MouseController.instance.wasPressed.left = true;\r\n    }\r\n    else if (e.button === 2) {\r\n      MouseController.instance.isDown.right = false;\r\n      MouseController.instance.wasPressed.right = true;\r\n    }\r\n  },\r\n\r\n  initPointerLock: function() {\r\n    var havePointerLock = 'pointerLockElement' in document || 'mozPointerLockElement' in document || 'webkitPointerLockElement' in document;\r\n\r\n    if (havePointerLock) {\r\n\r\n      var element = document.body;\r\n\r\n      var pointerlockchange = function(event) {\r\n\r\n        if (document.pointerLockElement === element || document.mozPointerLockElement === element || document.webkitPointerLockElement === element) {\r\n\r\n          this.controlsEnabled = true;\r\n          this.controls.enabled = true;\r\n\r\n          this.blocker.style.display = 'none';\r\n\r\n          if (Globals.instance.reloadingElement.style.visibility === 'visible') {\r\n            Globals.instance.reloadImg.play();\r\n          }\r\n\r\n          this.paused = false;\r\n\r\n        }\r\n        else {\r\n\r\n          this.controls.enabled = false;\r\n\r\n          this.blocker.style.display = '-webkit-box';\r\n          this.blocker.style.display = '-moz-box';\r\n          this.blocker.style.display = 'box';\r\n\r\n          this.instructions.style.display = '';\r\n\r\n          if (Globals.instance.reloadImg.get_playing()) {\r\n            Globals.instance.reloadImg.pause();\r\n          }\r\n\r\n          this.paused = true;\r\n\r\n        }\r\n\r\n      }.bind(this);\r\n\r\n      var pointerlockerror = function(event) {\r\n\r\n        this.instructions.style.display = '';\r\n\r\n      }.bind(this);\r\n\r\n      // Hook pointer lock state change events\r\n      document.addEventListener('pointerlockchange', pointerlockchange, false);\r\n      document.addEventListener('mozpointerlockchange', pointerlockchange, false);\r\n      document.addEventListener('webkitpointerlockchange', pointerlockchange, false);\r\n\r\n      document.addEventListener('pointerlockerror', pointerlockerror, false);\r\n      document.addEventListener('mozpointerlockerror', pointerlockerror, false);\r\n      document.addEventListener('webkitpointerlockerror', pointerlockerror, false);\r\n\r\n      this.instructions.addEventListener('click', function(event) {\r\n\r\n        this.instructions.style.display = 'none';\r\n\r\n        // Ask the browser to lock the pointer\r\n        element.requestPointerLock = element.requestPointerLock || element.mozRequestPointerLock || element.webkitRequestPointerLock;\r\n\r\n        if (/Firefox/i.test(navigator.userAgent)) {\r\n\r\n          var fullscreenchange = function(event) {\r\n\r\n            if (document.fullscreenElement === element || document.mozFullscreenElement === element || document.mozFullScreenElement === element) {\r\n\r\n              document.removeEventListener('fullscreenchange', fullscreenchange);\r\n              document.removeEventListener('mozfullscreenchange', fullscreenchange);\r\n\r\n              element.requestPointerLock();\r\n            }\r\n\r\n          };\r\n\r\n          document.addEventListener('fullscreenchange', fullscreenchange, false);\r\n          document.addEventListener('mozfullscreenchange', fullscreenchange, false);\r\n\r\n          element.requestFullscreen = element.requestFullscreen || element.mozRequestFullscreen || element.mozRequestFullScreen || element.webkitRequestFullscreen;\r\n\r\n          element.requestFullscreen();\r\n\r\n        }\r\n        else {\r\n\r\n          element.requestPointerLock();\r\n\r\n        }\r\n\r\n      }.bind(this), false);\r\n\r\n    }\r\n    else {\r\n\r\n      this.instructions.innerHTML = 'Your browser doesn\\'t seem to support Pointer Lock API';\r\n\r\n    }\r\n  }\r\n}, {\r\n  statics: {\r\n    KEY_CODES: {\r\n      space: 32\r\n    }\r\n  }\r\n});\r\n\r\n","PointerLockControls = Class({\r\n  constructor: function(options) {\r\n    this.camera = options.camera;\r\n    this.camera.rotation.set(0, 0, 0);\r\n\r\n    this.pitchObject = new THREE.Object3D();\r\n    this.pitchObject.add(this.camera);\r\n\r\n    this.yawObject = new THREE.Object3D();\r\n    this.yawObject.position.y = 10;\r\n    this.yawObject.add(this.pitchObject);\r\n\r\n    this.moveForward = false;\r\n    this.moveBackward = false;\r\n    this.moveLeft = false;\r\n    this.moveRight = false;\r\n\r\n    this.isOnObject = false;\r\n    this.canJump = false;\r\n\r\n    this.prevTime = performance.now();\r\n\r\n    this.velocity = new THREE.Vector3();\r\n\r\n    this.enabled = false;\r\n\r\n    this.mass = options.mass || 100.0;\r\n    this.moveSpeed = options.moveSpeed || new THREE.Vector3(400.0, 350.0, 400.0);\r\n    this.minimumY = options.minimumY || 10;\r\n\r\n    document.addEventListener('mousemove', this.onMouseMove.bind(this), false);\r\n    document.addEventListener('keydown', this.onKeyDown.bind(this), false);\r\n    document.addEventListener('keyup', this.onKeyUp.bind(this), false);\r\n  },\r\n\r\n  onMouseMove: function(event) {\r\n    if (this.enabled === false) {\r\n      return;\r\n    }\r\n\r\n    var movementX = event.movementX || event.mozMovementX || event.webkitMovementX || 0;\r\n    var movementY = event.movementY || event.mozMovementY || event.webkitMovementY || 0;\r\n\r\n    this.yawObject.rotation.y -= movementX * 0.002;\r\n    this.pitchObject.rotation.x -= movementY * 0.002;\r\n\r\n    this.pitchObject.rotation.x = Math.max(-PointerLockControls.PI_2, Math.min(PointerLockControls.PI_2, this.pitchObject.rotation.x));\r\n  },\r\n\r\n  onKeyDown: function(event) {\r\n    switch (event.keyCode) {\r\n      case 38: // up\r\n      case 87: // w\r\n        this.moveForward = true;\r\n        break;\r\n\r\n      case 37: // left\r\n      case 65: // a\r\n        this.moveLeft = true;\r\n        break;\r\n\r\n      case 40: // down\r\n      case 83: // s\r\n        this.moveBackward = true;\r\n        break;\r\n\r\n      case 39: // right\r\n      case 68: // d\r\n        this.moveRight = true;\r\n        break;\r\n\r\n      case 32: // space\r\n        if (this.canJump === true) {\r\n          this.velocity.y += this.moveSpeed.y;\r\n        }\r\n\r\n        this.canJump = false;\r\n\r\n        break;\r\n\r\n      default:\r\n        break;\r\n    }\r\n  },\r\n\r\n  onKeyUp: function(event) {\r\n    switch (event.keyCode) {\r\n      case 38: // up\r\n      case 87: // w\r\n        this.moveForward = false;\r\n        break;\r\n\r\n      case 37: // left\r\n      case 65: // a\r\n        this.moveLeft = false;\r\n        break;\r\n\r\n      case 40: // down\r\n      case 83: // s\r\n        this.moveBackward = false;\r\n        break;\r\n\r\n      case 39: // right\r\n      case 68: // d\r\n        this.moveRight = false;\r\n        break;\r\n\r\n      default:\r\n        break;\r\n    }\r\n  },\r\n\r\n  getObject: function() {\r\n    return this.yawObject;\r\n  },\r\n\r\n  isOnObject: function(bool) {\r\n    this.isOnObject = bool;\r\n    this.canJump = bool;\r\n  },\r\n\r\n  getDirection: function() {\r\n    // assumes the camera itself is not rotated\r\n    var direction = new THREE.Vector3(0, 0, -1);\r\n    var rotation = new THREE.Euler(0, 0, 0, \"YXZ\");\r\n\r\n    return function(v) {\r\n      rotation.set(this.pitchObject.rotation.x, this.yawObject.rotation.y, 0);\r\n\r\n      v.copy(direction).applyEuler(rotation);\r\n\r\n      return v;\r\n    };\r\n  }(),\r\n\r\n  update: function(dt) {\r\n    if (this.enabled === false) {\r\n      return;\r\n    }\r\n\r\n    this.velocity.x -= this.velocity.x * 10.0 * dt;\r\n    this.velocity.z -= this.velocity.z * 10.0 * dt;\r\n\r\n    this.velocity.y -= 9.8 * this.mass * dt;\r\n\r\n    if (this.moveForward) {\r\n      this.velocity.z -= this.moveSpeed.z * dt;\r\n    }\r\n    if (this.moveBackward) {\r\n      this.velocity.z += this.moveSpeed.z * dt;\r\n    }\r\n\r\n    if (this.moveLeft) {\r\n      this.velocity.x -= this.moveSpeed.x * dt;\r\n    }\r\n    if (this.moveRight) {\r\n      this.velocity.x += this.moveSpeed.x * dt;\r\n    }\r\n\r\n    if (this.isOnObject === true) {\r\n      this.velocity.y = Math.max(0, this.velocity.y);\r\n    }\r\n\r\n    this.yawObject.translateX(this.velocity.x * dt);\r\n    this.yawObject.translateY(this.velocity.y * dt);\r\n    this.yawObject.translateZ(this.velocity.z * dt);\r\n\r\n    if (this.yawObject.position.y < this.minimumY) {\r\n      this.velocity.y = 0;\r\n      this.yawObject.position.y = this.minimumY;\r\n\r\n      this.canJump = true;\r\n    }\r\n  }\r\n}, {\r\n  statics: {\r\n    PI_2: Math.PI / 2\r\n  }\r\n});\r\n\r\n","var C = require('./Components.js');\r\n\r\nPlayerInputSystem = Class({\r\n  constructor: function(entities) {\r\n    this.entities = entities;\r\n\r\n    this.keyboard = new THREEx.KeyboardState();\r\n    this.jumped = false;\r\n  },\r\n\r\n  update: function(dt) {\r\n    var players = this.entities.queryTag(\"player\");\r\n\r\n    players.forEach(function(entity) {\r\n      var velocity = new THREE.Vector3(entity.velocity.x, entity.velocity.y, entity.velocity.z);\r\n      var dv = new THREE.Vector3(); // delta velocity\r\n\r\n      if (this.keyboard.pressed(\"w\")) {\r\n        dv.z = -PlayerInputSystem.MOVE_SPEED;\r\n      }\r\n      else if (this.keyboard.pressed(\"s\")) {\r\n        dv.z = PlayerInputSystem.MOVE_SPEED;\r\n      }\r\n\r\n      if (this.keyboard.pressed(\"a\")) {\r\n        dv.x = -PlayerInputSystem.MOVE_SPEED;\r\n      }\r\n      else if (this.keyboard.pressed(\"d\")) {\r\n        dv.x = PlayerInputSystem.MOVE_SPEED;\r\n      }\r\n\r\n      if (this.keyboard.pressed(\"space\") && entity.jump.canJump) {\r\n        dv.y = PlayerInputSystem.JUMP_FORCE;\r\n        entity.jump.canJump = false;\r\n      }\r\n\r\n      dv = dv.applyMatrix4(entity.velocity.rotationMatrix);\r\n\r\n      velocity.add(dv);\r\n\r\n      entity.velocity.x = velocity.x;\r\n      entity.velocity.y = velocity.y;\r\n      entity.velocity.z = velocity.z;\r\n\r\n      if (entity.shootDelay.canShoot) {\r\n        if (MouseController.instance.wasPressed.left) {\r\n          var direction = new THREE.Vector3();\r\n          entity.cameraFollow.controls.getDirection(direction);\r\n\r\n          var gunPos = new THREE.Vector3().setFromMatrixPosition(entity.gun.mesh.matrixWorld);\r\n          var bulletPos = gunPos.clone();\r\n          var bulletOffset = new THREE.Vector3(0, 0.4, -25);\r\n\r\n          var rotationMatrix = entity.velocity.rotationMatrix.clone();\r\n          var yMatrix = new THREE.Matrix4().extractRotation(entity.cameraFollow.controls.pitchObject.matrix);\r\n          rotationMatrix.multiply(yMatrix);\r\n\r\n          bulletOffset.applyMatrix4(rotationMatrix);\r\n          bulletPos.add(bulletOffset);\r\n\r\n          var bulletRot = entity.cameraFollow.object.rotation.clone();\r\n          bulletRot.y += 90 * Math.PI / 180;\r\n\r\n          EntityFactory.instance.makePotato({\r\n            scene: entity.drawable.scene,\r\n            position: bulletPos,\r\n            rotation: bulletRot,\r\n            direction: direction,\r\n            rotationMatrix: entity.velocity.rotationMatrix,\r\n            velocity: 35,\r\n            owner: 'player'\r\n          });\r\n\r\n          entity.shootDelay.canShoot = false;\r\n\r\n          Globals.instance.reloadImg.move_to(0);\r\n          Globals.instance.reloadImg.play();\r\n          Globals.instance.reloadingElement.style.visibility = \"visible\";\r\n\r\n          var sound = Globals.instance.sound.getSound(Globals.DIR + 'sfx/arrowlessBow.mp3');\r\n          sound.setPosition(gunPos);\r\n          sound.setVelocity(velocity);\r\n          sound.setOrientation(direction);\r\n          sound.play();\r\n        }\r\n        else if (MouseController.instance.wasPressed.right) {\r\n          var baseDirection = new THREE.Vector3();\r\n          entity.cameraFollow.controls.getDirection(baseDirection);\r\n\r\n          var basePos = new THREE.Vector3().setFromMatrixPosition(entity.gun.mesh.matrixWorld);\r\n\r\n          var rotationMatrix = entity.velocity.rotationMatrix.clone();\r\n          var yMatrix = new THREE.Matrix4().extractRotation(entity.cameraFollow.controls.pitchObject.matrix);\r\n          rotationMatrix.multiply(yMatrix);\r\n\r\n          var bulletRot = entity.cameraFollow.object.rotation.clone();\r\n          bulletRot.y += 90 * Math.PI / 180;\r\n\r\n          for (var i = 0; i < Utils.randomRange(4, 9); i++) {\r\n            var bulletPos = basePos.clone();\r\n            var bulletOffset = new THREE.Vector3(Utils.randomRange(-1, 1), Utils.randomRange(-1, 1), -30);\r\n\r\n            bulletOffset.applyMatrix4(rotationMatrix);\r\n            bulletPos.add(bulletOffset);\r\n\r\n            var piOver2 = Math.PI / 2;\r\n\r\n            bulletRot.x += Utils.randomRange(-piOver2, piOver2);\r\n            bulletRot.z += Utils.randomRange(-piOver2, piOver2);\r\n\r\n            var bulletDirection = baseDirection.clone();\r\n            bulletDirection.x += Utils.randomRange(-0.2, 0.2);\r\n            bulletDirection.y += Utils.randomRange(-0.1, 0.2);\r\n            bulletDirection.z += Utils.randomRange(-0.2, 0.2);\r\n\r\n            EntityFactory.instance.makeFry({\r\n              scene: entity.drawable.scene,\r\n              position: bulletPos,\r\n              rotation: bulletRot,\r\n              direction: bulletDirection,\r\n              rotationMatrix: entity.velocity.rotationMatrix,\r\n              velocity: 0.5,\r\n              owner: 'player'\r\n            });\r\n          }\r\n\r\n          entity.shootDelay.canShoot = false;\r\n\r\n          Globals.instance.reloadImg.move_to(0);\r\n          Globals.instance.reloadImg.play();\r\n          Globals.instance.reloadingElement.style.visibility = \"visible\";\r\n        }\r\n      }\r\n    }.bind(this));\r\n  }\r\n}, {\r\n  statics: {\r\n    MOVE_SPEED: 120,\r\n    JUMP_FORCE: 2500\r\n  }\r\n});\r\n\r\nMovementSystem = Class({\r\n  constructor: function(entities) {\r\n    this.entities = entities;\r\n  },\r\n\r\n  update: function(dt) {\r\n    var moveables = this.entities.queryComponents([C.Position, C.Velocity]);\r\n\r\n    moveables.forEach(function(entity) {\r\n      var velocity = new THREE.Vector3(entity.velocity.x, entity.velocity.y, entity.velocity.z);\r\n\r\n      if (entity.velocity.doMove === false) {\r\n        return;\r\n      }\r\n\r\n      if (entity.hasComponent(C.Drawable)) {\r\n        entity.drawable.mesh.applyCentralImpulse(velocity);\r\n        //entity.drawable.mesh.setLinearVelocity(entity.velocity);\r\n      }\r\n      else {\r\n        entity.position.x += velocity.x * dt;\r\n        entity.position.y += velocity.y * dt;\r\n        entity.position.z += velocity.z * dt;\r\n      }\r\n    });\r\n  }\r\n});\r\n\r\nExpirableSystem = Class({\r\n  constructor: function(entities) {\r\n    this.entities = entities;\r\n  },\r\n\r\n  update: function(dt) {\r\n    var expirables = this.entities.queryComponents([C.Expirable]);\r\n\r\n    expirables.forEach(function(entity) {\r\n      entity.expirable.age += dt;\r\n\r\n      if (entity.expirable.age >= entity.expirable.maxAge) {\r\n        if (entity.hasComponent(C.Drawable)) {\r\n          entity.drawable.scene.remove(entity.drawable.mesh);\r\n        }\r\n\r\n        entity.remove();\r\n      }\r\n    });\r\n  }\r\n});\r\n\r\nCameraFollowSystem = Class({\r\n  constructor: function(entities) {\r\n    this.entities = entities;\r\n  },\r\n\r\n  update: function(dt) {\r\n    var follows = this.entities.queryComponents([C.CameraFollow, C.Position, C.Velocity]);\r\n\r\n    /*if (follows.length > 1) {\r\n      throw new Error(\"The camera can only follow one object at a time!\");\r\n    }*/\r\n\r\n    follows.forEach(function(entity) {\r\n      if (entity.velocity.rotationMatrix === null) {\r\n        return;\r\n      }\r\n\r\n      var offset = entity.cameraFollow.offset.clone();\r\n      offset = offset.applyMatrix4(entity.velocity.rotationMatrix);\r\n\r\n      entity.cameraFollow.object.position.x = entity.position.x + offset.x;\r\n      entity.cameraFollow.object.position.y = entity.position.y + offset.y;\r\n      entity.cameraFollow.object.position.z = entity.position.z + offset.z;\r\n\r\n      entity.drawable.mesh.rotation.x = entity.cameraFollow.object.rotation.x;\r\n      entity.drawable.mesh.rotation.y = entity.cameraFollow.object.rotation.y;\r\n      entity.drawable.mesh.rotation.z = entity.cameraFollow.object.rotation.z;\r\n    });\r\n  }\r\n});\r\n\r\nShootDelaySystem = Class({\r\n  constructor: function(entities) {\r\n    this.entities = entities;\r\n  },\r\n\r\n  update: function(dt) {\r\n    var shooters = this.entities.queryComponents([C.ShootDelay]);\r\n\r\n    shooters.forEach(function(entity) {\r\n      if (entity.shootDelay.canShoot === false) {\r\n        entity.shootDelay.timer += dt;\r\n\r\n        if (entity.shootDelay.timer > entity.shootDelay.delayTheshold) {\r\n          entity.shootDelay.canShoot = true;\r\n          entity.shootDelay.timer = 0;\r\n\r\n          Globals.instance.reloadImg.pause();\r\n          Globals.instance.reloadingElement.style.visibility = \"hidden\";\r\n        }\r\n      }\r\n    });\r\n  }\r\n});\r\n\r\nHurtSystem = Class({\r\n  constructor: function(entities) {\r\n    this.entities = entities;\r\n  },\r\n\r\n  update: function(dt) {\r\n    var hurtables = this.entities.queryComponents([C.Hurt, C.Drawable]);\r\n\r\n    hurtables.forEach(function(entity) {\r\n      entity.hurt.timer += dt;\r\n\r\n      if (entity.hurt.timer < entity.hurt.invulnerabilityFrames) {\r\n        entity.drawable.mesh.material.color = entity.hurt.hurtColor;\r\n\r\n        if (entity.hasTag(\"player\")) {\r\n          Globals.instance.overlayElement.style.backgroundColor = \"#bb0000\";\r\n          Globals.instance.overlayElement.style.visibility = \"visible\";\r\n        }\r\n      }\r\n      else {\r\n        entity.drawable.mesh.material.color = entity.hurt.originalColor;\r\n\r\n        entity.removeComponent(C.Hurt);\r\n\r\n        if (entity.hasTag(\"player\")) {\r\n          Globals.instance.overlayElement.style.visibility = \"hidden\";\r\n        }\r\n      }\r\n    });\r\n  }\r\n});\r\n\r\nPlayerHealthSystem = Class({\r\n  constructor: function(entities) {\r\n    this.entities = entities;\r\n\r\n    this.keyboard = new THREEx.KeyboardState();\r\n    this.jumped = false;\r\n  },\r\n\r\n  update: function(dt) {\r\n    var players = this.entities.queryTag(\"player\");\r\n\r\n    players.forEach(function(entity) {\r\n      if (entity.health.changed === false) {\r\n        return;\r\n      }\r\n\r\n      var percent = entity.health.hp / entity.health.maxHP;\r\n      var percentRounded = Math.round(percent * 100);\r\n\r\n      var healthElement = Globals.instance.healthElement;\r\n      var color = new THREE.Color(1 - percent, percent, 0);\r\n\r\n      healthElement.innerHTML = percentRounded + \"%\";\r\n      healthElement.style.color = \"#\" + color.getHexString();\r\n    });\r\n  }\r\n});\r\n\r\nHealthBarSystem = Class({\r\n  constructor: function(entities) {\r\n    this.entities = entities;\r\n  },\r\n\r\n  update: function(dt) {\r\n    var mortals = this.entities.queryComponents([C.Health]);\r\n\r\n    mortals.forEach(function(entity) {\r\n      if (entity.health.healthBar === null || entity.health.changed === false) {\r\n        return;\r\n      }\r\n\r\n      var percent = entity.health.hp / entity.health.maxHP;\r\n\r\n      entity.health.healthBar.scale.x = percent;\r\n      entity.health.healthBar.material.color = new THREE.Color(1 - percent, percent, 0);\r\n\r\n      entity.health.changed = false;\r\n    });\r\n  }\r\n});\r\n\r\nDeathSystem = Class({\r\n  constructor: function(entities) {\r\n    this.entities = entities;\r\n  },\r\n\r\n  update: function(dt) {\r\n    var mortals = this.entities.queryComponents([C.Health]);\r\n\r\n    mortals.forEach(function(entity) {\r\n      if (entity.health.hp <= 0) {\r\n        if (entity.hasComponent(C.Drawable)) {\r\n          if (entity.drawable.mesh._physijs.collision_type === EntityFactory.COLLISION_TYPES.enemy) {\r\n            Globals.instance.score += 10;\r\n\r\n            Globals.instance.scoreElement.innerHTML = Globals.instance.score;\r\n          }\r\n\r\n          entity.drawable.scene.remove(entity.drawable.mesh);\r\n        }\r\n\r\n        entity.remove();\r\n      }\r\n    });\r\n  }\r\n});\r\n\r\nAISystem = Class({\r\n  constructor: function(entities) {\r\n    this.entities = entities;\r\n  },\r\n\r\n  update: function(dt) {\r\n    var singularities = this.entities.queryComponents([C.AI]);\r\n\r\n    singularities.forEach(function(entity) {\r\n      if (entity.ai.tree === null || entity.ai.target === null || entity.ai.blackboard === null) {\r\n        return;\r\n      }\r\n\r\n      entity.ai.tree.tick(entity.ai.target, entity.ai.blackboard);\r\n    });\r\n  }\r\n});\r\n\r\nSteamUpdateSystem = Class({\r\n  constructor: function(entities) {\r\n    this.entities = entities;\r\n  },\r\n\r\n  update: function(dt) {\r\n    var steaming = this.entities.queryComponents([C.Steaming]);\r\n\r\n    steaming.forEach(function(entity) {\r\n      var particles = entity.steaming.particles;\r\n\r\n      var particleCount = particles.vertices.length;\r\n      while (particleCount--) {\r\n        var particle = particles.vertices[particleCount];\r\n        particle.y += dt * 50;\r\n\r\n        if (particle.y >= 5 + Utils.randomRange(-2, 4)) {\r\n          particle.y = Math.random();\r\n          particle.x = Math.random() * Utils.randomRange(-2, 2);\r\n          particle.z = Math.random() * Utils.randomRange(-2, 2);\r\n        }\r\n      }\r\n\r\n      particles.verticesNeedUpdate = true;\r\n    });\r\n  }\r\n});\r\n\r\nSteamRemovalSystem = Class({\r\n  constructor: function(entities) {\r\n    this.entities = entities;\r\n  },\r\n\r\n  update: function(dt) {\r\n    var steaming = this.entities.queryComponents([C.Steaming, C.Bullet, C.Drawable]);\r\n\r\n    steaming.forEach(function(entity) {\r\n      if (entity.bullet.isHot === false) {\r\n        entity.drawable.mesh.remove(entity.steaming.container);\r\n      }\r\n    });\r\n  }\r\n});\r\n\r\nCameraPitchSystem = Class({\r\n  constructor: function(entities) {\r\n    this.entities = entities;\r\n  },\r\n\r\n  update: function(dt) {\r\n    var pitchables = this.entities.queryComponents([C.CameraPitch, C.Drawable]);\r\n\r\n    pitchables.forEach(function(entity) {\r\n      entity.drawable.mesh.rotation.x = entity.cameraPitch.controls.pitchObject.rotation.x + entity.cameraPitch.offset;\r\n    });\r\n  }\r\n});\r\n\r\nPhysicsUpdateSystem = Class({\r\n  constructor: function(entities) {\r\n    this.entities = entities;\r\n  },\r\n\r\n  update: function(dt) {\r\n    var moveables = this.entities.queryComponents([C.Position, C.Velocity, C.Drawable]);\r\n\r\n    moveables.forEach(function(entity) {\r\n      entity.position.x = entity.drawable.mesh.position.x;\r\n      entity.position.y = entity.drawable.mesh.position.y;\r\n      entity.position.z = entity.drawable.mesh.position.z;\r\n\r\n      entity.velocity.x = entity.drawable.mesh.getLinearVelocity().x;\r\n      entity.velocity.y = entity.drawable.mesh.getLinearVelocity().y;\r\n      entity.velocity.z = entity.drawable.mesh.getLinearVelocity().z;\r\n\r\n      entity.velocity.rotationMatrix = new THREE.Matrix4().extractRotation(entity.drawable.mesh.matrix);\r\n    });\r\n  }\r\n});\r\n\r\n","Model = Class({\r\n  constructor: function(options) {\r\n    this.geometry = options.geometry;\r\n    this.material = options.material;\r\n  },\r\n\r\n  clone: function() {\r\n    return new Model({\r\n      geometry: this.geometry.clone(),\r\n      material: this.material.clone()\r\n    });\r\n  }\r\n});\r\n\r\nResourceManager = Class({\r\n  constructor: function() {\r\n    this.loadingManager = new THREE.LoadingManager();\r\n\r\n    this.jsonLoader = new THREE.JSONLoader(this.loadingManager);\r\n\r\n    this.textures = {};\r\n    this.models = {};\r\n  },\r\n\r\n  getTexture: function(path, callback) {\r\n    if (path === null || path === undefined) {\r\n      return null;\r\n    }\r\n    else if (path in this.textures) {\r\n      return this.textures[path];\r\n    }\r\n\r\n    this.textures[path] = THREE.ImageUtils.loadTexture(path, undefined, callback);\r\n\r\n    return this.textures[path];\r\n  },\r\n\r\n  loadModel: function(path, callback) {\r\n    if (path === null || path === undefined) {\r\n      return;\r\n    }\r\n    else if (path in this.models) {\r\n      callback(this.models[path]);\r\n\r\n      return;\r\n    }\r\n\r\n    this.jsonLoader.load(path, function(geometry, materials) {\r\n      var material = new THREE.MeshFaceMaterial(materials);\r\n\r\n      var model = new Model({\r\n        geometry: geometry,\r\n        material: material\r\n      });\r\n      this.models[path] = model;\r\n\r\n      callback(model);\r\n    }.bind(this));\r\n  }\r\n}, {\r\n  statics: {\r\n    get instance() {\r\n      if (!ResourceManager._instance) {\r\n        ResourceManager._instance = new ResourceManager();\r\n      }\r\n      return ResourceManager._instance;\r\n    }\r\n  }\r\n});\r\n\r\n","Sound = Class({\r\n  constructor: function(options) {\r\n    this.context = options.context;\r\n    this.source = this.context.createBufferSource();\r\n    this.volume = this.context.createGain();\r\n    this.panner = this.context.createPanner();\r\n\r\n    this.volume.connect(this.panner);\r\n    this.panner.connect(options.mainVolume);\r\n\r\n    this.source.loop = options.loop || false;\r\n\r\n    var self = this;\r\n\r\n    var request = new XMLHttpRequest();\r\n    request.open(\"GET\", options.path, true);\r\n    request.responseType = \"arraybuffer\";\r\n    request.onload = function(e) {\r\n      self.context.decodeAudioData(this.response, function onSuccess(buffer) {\r\n        self.buffer = buffer;\r\n\r\n        self.source.buffer = self.buffer;\r\n\r\n        if (options.callback) {\r\n          options.callback(self);\r\n        }\r\n      }, function onFailure() {\r\n        alert(\"Decoding the audio buffer failed\");\r\n      });\r\n    };\r\n    request.send();\r\n  },\r\n\r\n  setPosition: function(position) {\r\n    this.panner.setPosition(position.x, position.y, position.z);\r\n  },\r\n\r\n  setVelocity: function(velocity) {\r\n    this.panner.setVelocity(velocity.x, velocity.y, velocity.z);\r\n  },\r\n\r\n  setOrientation: function(orientation) {\r\n    this.panner.setOrientation(orientation.x, orientation.y, orientation.z);\r\n  },\r\n\r\n  play: function(startTime) {\r\n    this.source = this.context.createBufferSource();\r\n    this.source.buffer = this.buffer;\r\n    this.source.connect(this.volume);\r\n    this.source.start(startTime || 0);\r\n  }\r\n});\r\n\r\nSoundController = Class({\r\n  constructor: function(options) {\r\n    this.context = options.context;\r\n\r\n    this.mainVolume = this.context.createGain();\r\n    this.mainVolume.connect(this.context.destination);\r\n\r\n    this.following = options.following;\r\n\r\n    this.sounds = {};\r\n  },\r\n\r\n  update: function(dt) {\r\n    var position = new THREE.Vector3().setFromMatrixPosition(this.following.matrixWorld);\r\n    this.setListenerPosition(position);\r\n\r\n    var orientation = new THREE.Vector3(0, 0, 1);\r\n    orientation.applyProjection(this.following.matrix);\r\n    orientation.normalize();\r\n\r\n    var up = new THREE.Vector3(0, -1, 0);\r\n    up.applyProjection(this.following.matrix);\r\n    up.normalize();\r\n\r\n    this.setListenerOrientation(orientation, up);\r\n  },\r\n\r\n  loadSound: function(path, callback) {\r\n    if (path in this.sounds) {\r\n      throw new Error(\"The sound located at \" + path + \" is already loaded\");\r\n    }\r\n\r\n    this.sounds[path] = new Sound({\r\n      context: this.context,\r\n      mainVolume: this.mainVolume,\r\n      path: path,\r\n      callback: callback\r\n    });\r\n  },\r\n\r\n  getSound: function(path) {\r\n    if (path in this.sounds) {\r\n      return this.sounds[path];\r\n    }\r\n\r\n    throw new Error(\"The sound located at \" + path + \" is not loaded\");\r\n  },\r\n\r\n  setListenerPosition: function(position) {\r\n    this.context.listener.setPosition(position.x, position.y, position.z);\r\n  },\r\n\r\n  setListenerOrientation: function(orientation, up) {\r\n    this.context.listener.setOrientation(orientation.x, orientation.y, orientation.z, up.x, up.y, up.z);\r\n  }\r\n});\r\n\r\n","MouseController = Class({\r\n  constructor: function() {\r\n    this.isDown = {\r\n      left: false,\r\n      right: false\r\n    };\r\n\r\n    this.wasPressed = {\r\n      left: false,\r\n      right: false\r\n    };\r\n  },\r\n\r\n  update: function(dt) {\r\n    this.wasPressed.left = false;\r\n    this.wasPressed.right = false;\r\n  }\r\n}, {\r\n  statics: {\r\n    get instance() {\r\n      if (!MouseController._instance) {\r\n        MouseController._instance = new MouseController();\r\n      }\r\n      return MouseController._instance;\r\n    }\r\n  }\r\n});\r\n\r\n","var EntityManager = require('tiny-ecs').EntityManager;\r\nvar C = require('./Components.js');\r\nvar b3 = require('./../b3core.0.1.0.js');\r\n\r\nEntityFactory = Class({\r\n  constructor: function() {\r\n    this.entities = new EntityManager();\r\n  },\r\n\r\n  makePlayer: function(options) {\r\n    var player = this.entities.createEntity();\r\n\r\n    ResourceManager.instance.loadModel('models/character.json', function(model) {\r\n      player.addTag(\"player\");\r\n\r\n      player.addComponent(C.Identifier);\r\n      player.addComponent(C.Position);\r\n      player.addComponent(C.Velocity);\r\n      player.addComponent(C.Jump);\r\n      player.addComponent(C.Drawable);\r\n      player.addComponent(C.CameraFollow);\r\n      player.addComponent(C.ShootDelay);\r\n      player.addComponent(C.Health);\r\n      player.addComponent(C.Gun);\r\n\r\n      player.identifier.type = Globals.ENTITY_TYPES.player;\r\n\r\n      player.drawable.scene = options.scene;\r\n\r\n      player.drawable.mesh = new Physijs.CapsuleMesh(\r\n        model.geometry,\r\n        Physijs.createMaterial(new THREE.MeshBasicMaterial({\r\n          color: 0xffff00\r\n        }), 0.9, 0.01), EntityFactory.MASS.player);\r\n      player.drawable.mesh.entity = player;\r\n\r\n      player.drawable.mesh.position.copy(options.position);\r\n      //player.drawable.mesh.rotation.copy(options.rotation);\r\n\r\n      player.drawable.mesh._physijs.collision_type = EntityFactory.COLLISION_TYPES.player;\r\n      player.drawable.mesh._physijs.collision_masks = (\r\n        EntityFactory.COLLISION_TYPES.obstacle |\r\n        EntityFactory.COLLISION_TYPES.enemy |\r\n        EntityFactory.COLLISION_TYPES.enemyBullet);\r\n\r\n      player.drawable.scene.add(player.drawable.mesh);\r\n\r\n      player.drawable.mesh.setDamping(0.99, 0);\r\n      player.drawable.mesh.setAngularFactor(new THREE.Vector3(0, 0, 0));\r\n\r\n      player.drawable.mesh.addEventListener('collision', function(other_object, relative_velocity, relative_rotation, contact_normal) {\r\n        if (contact_normal.y < 0 && other_object.entity.identifier.type === Globals.ENTITY_TYPES.ground) {\r\n          player.jump.canJump = true;\r\n        }\r\n\r\n        if (other_object.entity.identifier.type === Globals.ENTITY_TYPES.enemy && player.hasComponent(C.Hurt) === false) {\r\n          player.addComponent(C.Hurt);\r\n          player.hurt.originalColor = player.drawable.mesh.material.color;\r\n\r\n          player.health.hp--;\r\n          player.health.changed = true;\r\n        }\r\n      });\r\n\r\n      player.health.hp = player.health.maxHP = options.hp || 20;\r\n\r\n      player.position.x = options.position.x;\r\n      player.position.y = options.position.y;\r\n      player.position.z = options.position.z;\r\n\r\n      player.velocity.rotationMatrix = new THREE.Matrix4().extractRotation(player.drawable.mesh.matrix);\r\n\r\n      player.cameraFollow.controls = options.controls;\r\n      player.cameraFollow.object = options.controlsObject;\r\n      player.cameraFollow.offset = options.cameraOffset;\r\n\r\n      player.shootDelay.delayTheshold = 1.5;\r\n\r\n      this.makeGun({\r\n        parent: player.drawable.mesh,\r\n        cameraControls: options.controls,\r\n        offset: options.gunOffset,\r\n        callback: function(gun) {\r\n          player.gun.entity = gun;\r\n          player.gun.mesh = gun.drawable.mesh;\r\n        }\r\n      });\r\n    }.bind(this));\r\n\r\n    return player;\r\n  },\r\n\r\n  makeEnemy: function(options) {\r\n    ResourceManager.instance.loadModel('models/character.json', function(model) {\r\n      var enemy = this.entities.createEntity();\r\n\r\n      enemy.addTag(\"enemy\");\r\n\r\n      enemy.addComponent(C.Identifier);\r\n      enemy.addComponent(C.Position);\r\n      enemy.addComponent(C.Velocity);\r\n      enemy.addComponent(C.Drawable);\r\n      enemy.addComponent(C.Health);\r\n      enemy.addComponent(C.ShootDelay);\r\n      enemy.addComponent(C.AI);\r\n\r\n      enemy.identifier.type = Globals.ENTITY_TYPES.enemy;\r\n\r\n      enemy.drawable.scene = options.scene;\r\n\r\n      enemy.drawable.mesh = new Physijs.CapsuleMesh(\r\n        model.geometry,\r\n        Physijs.createMaterial(new THREE.MeshPhongMaterial({\r\n          color: 0x0000ff\r\n        }), 0.9, 0.1), EntityFactory.MASS.enemy);\r\n      enemy.drawable.mesh.entity = enemy;\r\n\r\n      enemy.drawable.mesh._physijs.collision_type = EntityFactory.COLLISION_TYPES.enemy;\r\n      enemy.drawable.mesh._physijs.collision_masks = (\r\n        EntityFactory.COLLISION_TYPES.obstacle |\r\n        EntityFactory.COLLISION_TYPES.player |\r\n        EntityFactory.COLLISION_TYPES.enemy |\r\n        EntityFactory.COLLISION_TYPES.playerBullet |\r\n        EntityFactory.COLLISION_TYPES.enemyBullet);\r\n\r\n      enemy.drawable.mesh.position.copy(options.position);\r\n      //enemy.drawable.mesh.rotation.copy(options.rotation);\r\n\r\n      enemy.drawable.scene.add(enemy.drawable.mesh);\r\n\r\n      enemy.drawable.mesh.setDamping(0.99, 0);\r\n      enemy.drawable.mesh.setAngularFactor(new THREE.Vector3(0, 1, 0));\r\n\r\n      enemy.position.x = options.position.x;\r\n      enemy.position.y = options.position.y;\r\n      enemy.position.z = options.position.z;\r\n\r\n      enemy.velocity.rotationMatrix = new THREE.Matrix4().extractRotation(enemy.drawable.mesh.matrix);\r\n\r\n      enemy.health.hp = enemy.health.maxHP = options.hp || 15;\r\n      enemy.health.healthBar = new THREE.Mesh(\r\n        new THREE.BoxGeometry(14, 1.5, 0.5),\r\n        new THREE.MeshBasicMaterial({\r\n          color: 0x00ff00\r\n        }));\r\n      enemy.health.healthBar.position.set(0, 25, 0);\r\n      enemy.drawable.mesh.add(enemy.health.healthBar);\r\n\r\n      enemy.shootDelay.delayTheshold = 1.5;\r\n\r\n      var FaceNode = b3.Class(b3.Action);\r\n      FaceNode.prototype.name = 'FaceNode';\r\n      FaceNode.prototype.parameters = {\r\n        'facing': null\r\n      };\r\n\r\n      FaceNode.prototype.__Action_initialize = FaceNode.prototype.initialize;\r\n      FaceNode.prototype.initialize = function(settings) {\r\n        settings = settings || {};\r\n\r\n        this.__Action_initialize();\r\n\r\n        this.facing = settings.facing;\r\n      };\r\n\r\n      FaceNode.prototype.tick = function(tick) {\r\n        if (this.facing._manager === null || this.facing._manager === undefined) {\r\n          return b3.FAILURE;\r\n        }\r\n\r\n        // http://forum.unity3d.com/threads/making-an-object-rotate-to-face-another.1211/\r\n        // http://answers.unity3d.com/questions/503934/chow-to-check-if-an-object-is-facing-another.html\r\n\r\n        var parentPos = tick.target.drawable.mesh.position.clone();\r\n        var followingPos = this.facing.drawable.mesh.position.clone();\r\n\r\n        parentPos.y = 0;\r\n        followingPos.y = 0;\r\n\r\n        var posDif = parentPos.clone();\r\n        posDif.sub(followingPos);\r\n\r\n        var direction = new THREE.Vector3(0, 0, -1);\r\n        var rotation = new THREE.Euler(0, 0, 0, \"YXZ\");\r\n        rotation.set(tick.target.drawable.mesh.rotation.x, tick.target.drawable.mesh.rotation.y, 0);\r\n\r\n        var forward = new THREE.Vector3();\r\n        forward.copy(direction).applyEuler(rotation);\r\n\r\n        var angle = forward.angleTo(posDif);\r\n\r\n        if (angle <= 0.1) {\r\n          return b3.SUCCESS;\r\n        }\r\n\r\n        var lookAtMatrix = new THREE.Matrix4();\r\n        lookAtMatrix.lookAt(followingPos, parentPos, new THREE.Vector3(0, 1, 0));\r\n\r\n        var parentRotation = new THREE.Quaternion().setFromEuler(tick.target.drawable.mesh.rotation);\r\n        var targetRotation = new THREE.Quaternion().setFromRotationMatrix(lookAtMatrix);\r\n\r\n        var str = Math.min(3 * Globals.instance.dt, 5);\r\n\r\n        parentRotation.slerp(targetRotation, str);\r\n\r\n        tick.target.drawable.mesh.rotation.setFromQuaternion(parentRotation);\r\n        tick.target.drawable.mesh.__dirtyRotation = true;\r\n\r\n        return b3.RUNNING;\r\n      };\r\n\r\n      var RandomChildNode = b3.Class(b3.Composite);\r\n      RandomChildNode.prototype.name = 'RandomChildNode';\r\n\r\n      RandomChildNode.prototype.__Composite_initialize = RandomChildNode.prototype.initialize;\r\n      RandomChildNode.prototype.initialize = function(settings) {\r\n        settings = settings || {};\r\n\r\n        this.__Composite_initialize(settings);\r\n\r\n        this.chance = settings.chance;\r\n      };\r\n\r\n      RandomChildNode.prototype.tick = function(tick) {\r\n        //var chance = 1 / this.children.length;\r\n\r\n        for (var i = 0; i < this.children.length; i++) {\r\n          if (Math.random() <= this.chance[i]) {\r\n            var status = this.children[i]._execute(tick);\r\n\r\n            if (status !== b3.SUCCESS) {\r\n              return status;\r\n            }\r\n          }\r\n        }\r\n\r\n        return b3.SUCCESS;\r\n      };\r\n\r\n      var FollowNode = b3.Class(b3.Action);\r\n      FollowNode.prototype.name = 'FollowNode';\r\n      FollowNode.prototype.parameters = {\r\n        'following': null\r\n      };\r\n\r\n      FollowNode.prototype.__Action_initialize = FollowNode.prototype.initialize;\r\n      FollowNode.prototype.initialize = function(settings) {\r\n        settings = settings || {};\r\n\r\n        this.__Action_initialize();\r\n\r\n        this.following = settings.following;\r\n      };\r\n\r\n      FollowNode.prototype.tick = function(tick) {\r\n        if (this.following._manager === null || this.following._manager === undefined) {\r\n          return b3.FAILURE;\r\n        }\r\n\r\n        var parentPos = tick.target.drawable.mesh.position.clone();\r\n        var followingPos = this.following.drawable.mesh.position.clone();\r\n\r\n        var distance = parentPos.distanceTo(followingPos);\r\n\r\n        if (distance < 50) {\r\n          return b3.SUCCESS;\r\n        }\r\n\r\n        var difference = new THREE.Vector3();\r\n        difference.subVectors(followingPos, parentPos);\r\n\r\n        var normal = difference.normalize();\r\n        var velocity = new THREE.Vector3(tick.target.velocity.x, tick.target.velocity.y, tick.target.velocity.z);\r\n        var dv = new THREE.Vector3(EntityFactory.MOVE_SPEED.enemy * normal.x, 0, EntityFactory.MOVE_SPEED.enemy * normal.z);\r\n\r\n        velocity.add(dv);\r\n\r\n        tick.target.velocity.x = velocity.x;\r\n        tick.target.velocity.y = velocity.y;\r\n        tick.target.velocity.z = velocity.z;\r\n\r\n        return b3.RUNNING;\r\n      };\r\n\r\n      var ShootNode = b3.Class(b3.Action);\r\n      ShootNode.prototype.name = 'ShootNode';\r\n      ShootNode.prototype.parameters = {\r\n        'shootingAt': null\r\n      };\r\n\r\n      ShootNode.prototype.__Action_initialize = ShootNode.prototype.initialize;\r\n      ShootNode.prototype.initialize = function(settings) {\r\n        settings = settings || {};\r\n\r\n        this.__Action_initialize();\r\n\r\n        this.shootingAt = settings.shootingAt;\r\n        this.bulletSpeed = settings.bulletSpeed;\r\n      };\r\n\r\n      ShootNode.prototype.tick = function(tick) {\r\n        if (this.shootingAt._manager === null || this.shootingAt._manager === undefined) {\r\n          return b3.FAILURE;\r\n        }\r\n        else if (tick.target.shootDelay.canShoot === false) {\r\n          return b3.FAILURE;\r\n        }\r\n\r\n        var parentPos = tick.target.drawable.mesh.position.clone();\r\n        var followingPos = this.shootingAt.drawable.mesh.position.clone();\r\n\r\n        var spawnLocation = parentPos.clone();\r\n        var spawnOffset = new THREE.Vector3(0, 10, 20);\r\n        spawnOffset.applyMatrix4(tick.target.velocity.rotationMatrix);\r\n        spawnLocation.add(spawnOffset);\r\n\r\n        var followingVel = new THREE.Vector3(this.shootingAt.velocity.x, this.shootingAt.velocity.y, this.shootingAt.velocity.z);\r\n        followingVel.multiplyScalar(Globals.instance.dt);\r\n        var predictedPos = followingPos.clone();\r\n        predictedPos.add(followingVel);\r\n\r\n        /*var positionOffset = parentPos.clone().sub(followingPos);\r\n        predictedPos.add(positionOffset);*/\r\n\r\n        var rotation = new THREE.Euler(0, 0, 0, \"YXZ\");\r\n        rotation.set(tick.target.drawable.mesh.rotation.x, tick.target.drawable.mesh.rotation.y, 0);\r\n\r\n        var forward = new THREE.Vector3(0, 0, 1);\r\n        forward.applyEuler(rotation);\r\n\r\n        var distance = spawnLocation.distanceTo(followingPos);\r\n\r\n        var velocity = this.bulletSpeed;\r\n\r\n        // I have no clue why this works\r\n        //var velOffset = (Math.PI / 2) - (velocity / 250);\r\n        //var velOffset = 1.3 + (velocity / 1000);\r\n        var velOffset = 1 + (velocity / 100);\r\n        forward.y += distance / ((velocity - (velocity * velOffset * EntityFactory.MASS.bullet)) * velocity);\r\n\r\n        EntityFactory.instance.makePotato({\r\n          scene: tick.target.drawable.scene,\r\n          position: spawnLocation,\r\n          rotation: tick.target.drawable.mesh.rotation.clone(),\r\n          direction: forward,\r\n          velocity: velocity,\r\n          owner: 'enemy'\r\n        });\r\n\r\n        tick.target.shootDelay.canShoot = false;\r\n\r\n        return b3.SUCCESS;\r\n      };\r\n\r\n      enemy.ai.tree = new b3.BehaviorTree();\r\n      enemy.ai.tree.root = new b3.Sequence({\r\n        children: [\r\n          new b3.Sequence({\r\n            children: [\r\n              new FaceNode({\r\n                facing: options.aiTarget\r\n              }),\r\n              new RandomChildNode({\r\n                children: [\r\n                  new FollowNode({\r\n                    following: options.aiTarget\r\n                  }),\r\n                  new ShootNode({\r\n                    shootingAt: options.aiTarget,\r\n                    bulletSpeed: options.bulletSpeed\r\n                  })\r\n                ],\r\n                chance: [\r\n                  0.9,\r\n                  0.1\r\n                ]\r\n              })\r\n            ]\r\n          })\r\n        ]\r\n      });\r\n\r\n      enemy.ai.target = enemy;\r\n      enemy.ai.blackboard = new b3.Blackboard();\r\n    }.bind(this));\r\n  },\r\n\r\n  makeGun: function(options) {\r\n    ResourceManager.instance.loadModel('models/potatoCannon.json', function(model) {\r\n      var gun = this.entities.createEntity();\r\n\r\n      gun.addComponent(C.Position);\r\n      gun.addComponent(C.Drawable);\r\n\r\n      gun.drawable.scene = options.parent;\r\n      gun.drawable.mesh = new THREE.Mesh(\r\n        model.geometry,\r\n        model.material.clone());\r\n\r\n      gun.drawable.mesh.position.copy(options.offset);\r\n\r\n      gun.drawable.scene.add(gun.drawable.mesh);\r\n\r\n      if (options.cameraControls) {\r\n        gun.addComponent(C.CameraPitch);\r\n\r\n        gun.cameraPitch.controls = options.cameraControls;\r\n        //gun.cameraPitch.offset = 90 * Math.PI / 180;\r\n      }\r\n\r\n      if (options.callback) {\r\n        options.callback(gun);\r\n      }\r\n    }.bind(this));\r\n  },\r\n\r\n  makePotato: function(options) {\r\n    ResourceManager.instance.loadModel('models/potato.json', function(model) {\r\n      var potato = this.entities.createEntity();\r\n\r\n      potato.addTag(\"bullet\");\r\n      potato.addTag(\"potato\");\r\n\r\n      potato.addComponent(C.Identifier);\r\n      potato.addComponent(C.Position);\r\n      potato.addComponent(C.Velocity);\r\n      potato.addComponent(C.Drawable);\r\n      potato.addComponent(C.Bullet);\r\n      potato.addComponent(C.Expirable);\r\n      potato.addComponent(C.OneTimeHit);\r\n      potato.addComponent(C.Steaming);\r\n\r\n      potato.identifier.type = Globals.ENTITY_TYPES.bullet;\r\n      potato.bullet.owner = options.owner;\r\n\r\n      potato.velocity.doMove = false;\r\n\r\n      potato.drawable.scene = options.scene;\r\n\r\n      potato.drawable.mesh = new Physijs.CapsuleMesh(\r\n        model.geometry,\r\n        Physijs.createMaterial(model.material.clone(), 0.7, 0.01),\r\n        0.3);\r\n      potato.drawable.mesh.entity = potato;\r\n\r\n      // potatos are \"hot\" when created, so tint them red\r\n      potato.drawable.mesh.material.materials.forEach(function(mat) {\r\n        mat.color.setHex(0xE34D4D);\r\n      });\r\n\r\n      if (options.owner === 'player') {\r\n        potato.drawable.mesh._physijs.collision_type = EntityFactory.COLLISION_TYPES.playerBullet;\r\n      }\r\n      else {\r\n        potato.drawable.mesh._physijs.collision_type = EntityFactory.COLLISION_TYPES.enemyBullet;\r\n      }\r\n\r\n      potato.drawable.mesh._physijs.collision_masks = (\r\n        EntityFactory.COLLISION_TYPES.obstacle |\r\n        EntityFactory.COLLISION_TYPES.enemy |\r\n        EntityFactory.COLLISION_TYPES.player |\r\n        EntityFactory.COLLISION_TYPES.playerBullet |\r\n        EntityFactory.COLLISION_TYPES.enemyBullet);\r\n\r\n      potato.drawable.mesh.position.copy(options.position);\r\n      potato.drawable.mesh.rotation.copy(options.rotation);\r\n      if (options.scale) {\r\n        potato.drawable.mesh.scale.copy(options.scale);\r\n      }\r\n\r\n      potato.drawable.scene.add(potato.drawable.mesh);\r\n\r\n      potato.drawable.mesh.setDamping(0.1, 0);\r\n\r\n      potato.drawable.mesh.addEventListener('collision', function(other_object, relative_velocity, relative_rotation, contact_normal) {\r\n        if (potato.bullet.isHot === false) {\r\n          return;\r\n        }\r\n\r\n        var hitPlayer = potato.bullet.owner === 'enemy' && other_object.entity.identifier.type === Globals.ENTITY_TYPES.player;\r\n        var hitEnemy = potato.bullet.owner === 'player' && other_object.entity.identifier.type === Globals.ENTITY_TYPES.enemy;\r\n\r\n        if ((hitPlayer || hitEnemy) && other_object.entity.hasComponent(C.Hurt) === false && potato.oneTimeHit.alreadyHit.indexOf(other_object.uuid) < 0) {\r\n          other_object.entity.addComponent(C.Hurt);\r\n          other_object.entity.hurt.originalColor = other_object.material.color.clone();\r\n\r\n          other_object.entity.health.hp -= 5;\r\n          other_object.entity.health.changed = true;\r\n\r\n          potato.oneTimeHit.alreadyHit.push(other_object.uuid);\r\n        }\r\n        else if (other_object.entity.identifier.type === Globals.ENTITY_TYPES.ground) {\r\n          potato.bullet.touchedGround = true;\r\n        }\r\n        else if (potato.bullet.owner === 'player' && other_object.entity.identifier.type === Globals.ENTITY_TYPES.bullet && other_object.entity.bullet.owner === 'enemy' && potato.oneTimeHit.alreadyHit.indexOf(other_object.uuid) < 0) {\r\n          Globals.instance.score += 5;\r\n\r\n          Globals.instance.scoreElement.innerHTML = Globals.instance.score;\r\n\r\n          potato.oneTimeHit.alreadyHit.push(other_object.uuid);\r\n        }\r\n\r\n        var soundPos = new THREE.Vector3().setFromMatrixPosition(potato.drawable.mesh.matrixWorld);\r\n        var soundVel = new THREE.Vector3(potato.velocity.x * Globals.instance.dt, potato.velocity.y * Globals.instance.dt, potato.velocity.z * Globals.instance.dt);\r\n        var soundForward = new THREE.Vector3(0, 0, 1);\r\n        soundForward.applyProjection(potato.drawable.mesh.matrixWorld);\r\n        soundForward.normalize();\r\n\r\n        var sound = Globals.instance.sound.getSound(Globals.DIR + 'sfx/hitSplat.wav');\r\n        sound.setPosition(soundPos);\r\n        sound.setVelocity(vel);\r\n        sound.setOrientation(soundForward);\r\n        sound.play();\r\n\r\n        potato.bullet.isHot = false;\r\n\r\n        // the potato is now \"cold,\" so tint it blue\r\n        potato.drawable.mesh.material.materials.forEach(function(mat) {\r\n          mat.color.setHex(0x45B7DE);\r\n        });\r\n      }.bind(this));\r\n\r\n      potato.position.x = options.position.x;\r\n      potato.position.y = options.position.y;\r\n      potato.position.z = options.position.z;\r\n\r\n      var vel = new THREE.Vector3(options.velocity, options.velocity, options.velocity);\r\n      vel.multiply(options.direction);\r\n      potato.drawable.mesh.applyCentralImpulse(vel);\r\n\r\n      potato.expirable.maxAge = 6;\r\n\r\n      potato.steaming.parent = potato.drawable.mesh;\r\n      potato.steaming.particles = new THREE.Geometry();\r\n      for (var i = 0; i < 25; i++) {\r\n        var particle = new THREE.Vector3(\r\n          Math.random() * Utils.randomRange(-2, 2),\r\n          Math.random() * 20,\r\n          Math.random() * Utils.randomRange(-2, 2));\r\n        potato.steaming.particles.vertices.push(particle);\r\n      }\r\n\r\n      var smokeTexture = ResourceManager.instance.getTexture(Globals.DIR + '/gfx/smoketex.jpg');\r\n      var smokeMaterial = new THREE.PointCloudMaterial({\r\n        map: smokeTexture,\r\n        transparent: true,\r\n        depthWrite: false,\r\n        blending: THREE.AdditiveBlending,\r\n        size: 2,\r\n        color: 0x111111\r\n      });\r\n\r\n      potato.steaming.system = new THREE.PointCloud(potato.steaming.particles, smokeMaterial);\r\n      potato.steaming.system.sortParticles = true;\r\n\r\n      potato.steaming.container = new THREE.Gyroscope();\r\n      potato.steaming.container.add(potato.steaming.system);\r\n      potato.drawable.mesh.add(potato.steaming.container);\r\n\r\n      if (options.callback) {\r\n        options.callback(potato);\r\n      }\r\n    }.bind(this));\r\n  },\r\n\r\n  makeFry: function(options) {\r\n    ResourceManager.instance.loadModel('models/fry.json', function(model) {\r\n      var fry = this.entities.createEntity();\r\n\r\n      fry.addTag(\"bullet\");\r\n      fry.addTag(\"fry\");\r\n\r\n      fry.addComponent(C.Identifier);\r\n      fry.addComponent(C.Position);\r\n      fry.addComponent(C.Drawable);\r\n      fry.addComponent(C.Bullet);\r\n      fry.addComponent(C.Expirable);\r\n      fry.addComponent(C.OneTimeHit);\r\n      fry.addComponent(C.Steaming);\r\n\r\n      fry.identifier.type = Globals.ENTITY_TYPES.bullet;\r\n      fry.bullet.owner = options.owner;\r\n\r\n      fry.drawable.scene = options.scene;\r\n\r\n      fry.drawable.mesh = new Physijs.BoxMesh(\r\n        model.geometry,\r\n        Physijs.createMaterial(model.material.clone(), 0.7, 0.01),\r\n        0.002);\r\n      fry.drawable.mesh.entity = fry;\r\n\r\n      // fries are \"hot\" when created, so tint them red\r\n      fry.drawable.mesh.material.materials.forEach(function(mat) {\r\n        mat.color.setHex(0xE34D4D);\r\n      });\r\n\r\n      if (options.owner === 'player') {\r\n        fry.drawable.mesh._physijs.collision_type = EntityFactory.COLLISION_TYPES.playerBullet;\r\n      }\r\n      else {\r\n        fry.drawable.mesh._physijs.collision_type = EntityFactory.COLLISION_TYPES.enemyBullet;\r\n      }\r\n\r\n      fry.drawable.mesh._physijs.collision_masks = (\r\n        EntityFactory.COLLISION_TYPES.obstacle |\r\n        EntityFactory.COLLISION_TYPES.enemy |\r\n        EntityFactory.COLLISION_TYPES.player |\r\n        EntityFactory.COLLISION_TYPES.playerBullet |\r\n        EntityFactory.COLLISION_TYPES.enemyBullet);\r\n\r\n      fry.drawable.mesh.position.copy(options.position);\r\n      fry.drawable.mesh.rotation.copy(options.rotation);\r\n      if (options.scale) {\r\n        fry.drawable.mesh.scale.copy(options.scale);\r\n      }\r\n\r\n      fry.drawable.scene.add(fry.drawable.mesh);\r\n\r\n      fry.drawable.mesh.setDamping(0.1, 0);\r\n\r\n      fry.drawable.mesh.addEventListener('collision', function(other_object, relative_velocity, relative_rotation, contact_normal) {\r\n        if (fry.bullet.isHot === false) {\r\n          return;\r\n        }\r\n\r\n        var hitPlayer = fry.bullet.owner === 'enemy' && other_object.entity.identifier.type === Globals.ENTITY_TYPES.player;\r\n        var hitEnemy = fry.bullet.owner === 'player' && other_object.entity.identifier.type === Globals.ENTITY_TYPES.enemy;\r\n\r\n        if ((hitPlayer || hitEnemy) && other_object.entity.hasComponent(C.Hurt) === false && fry.oneTimeHit.alreadyHit.indexOf(other_object.uuid) < 0) {\r\n          other_object.entity.addComponent(C.Hurt);\r\n          other_object.entity.hurt.originalColor = other_object.material.color.clone();\r\n\r\n          other_object.entity.health.hp -= 1;\r\n          other_object.entity.health.changed = true;\r\n\r\n          fry.oneTimeHit.alreadyHit.push(other_object.uuid);\r\n        }\r\n        else if (other_object.entity.identifier.type === Globals.ENTITY_TYPES.ground) {\r\n          fry.bullet.touchedGround = true;\r\n        }\r\n        else if (fry.bullet.owner === 'player' && other_object.entity.identifier.type === Globals.ENTITY_TYPES.bullet && other_object.entity.bullet.owner === 'enemy' && fry.oneTimeHit.alreadyHit.indexOf(other_object.uuid) < 0) {\r\n          Globals.instance.score += 5;\r\n\r\n          Globals.instance.scoreElement.innerHTML = Globals.instance.score;\r\n\r\n          fry.oneTimeHit.alreadyHit.push(other_object.uuid);\r\n        }\r\n\r\n        fry.bullet.isHot = other_object.entity.hasTag(\"fry\");\r\n\r\n        if (fry.bullet.isHot === false) {\r\n          // the fry is now \"cold,\" so tint it blue\r\n          fry.drawable.mesh.material.materials.forEach(function(mat) {\r\n            mat.color.setHex(0x45B7DE);\r\n          });\r\n        }\r\n      }.bind(this));\r\n\r\n      fry.position.x = options.position.x;\r\n      fry.position.y = options.position.y;\r\n      fry.position.z = options.position.z;\r\n\r\n      var vel = new THREE.Vector3(options.velocity, options.velocity, options.velocity);\r\n      vel.multiply(options.direction);\r\n      fry.drawable.mesh.applyCentralImpulse(vel);\r\n\r\n      fry.expirable.maxAge = 6;\r\n\r\n      fry.steaming.parent = fry.drawable.mesh;\r\n      fry.steaming.particles = new THREE.Geometry();\r\n      for (var i = 0; i < 25; i++) {\r\n        var particle = new THREE.Vector3(\r\n          Math.random() * Utils.randomRange(-2, 2),\r\n          Math.random() * 20,\r\n          Math.random() * Utils.randomRange(-2, 2));\r\n        fry.steaming.particles.vertices.push(particle);\r\n      }\r\n\r\n      var smokeTexture = ResourceManager.instance.getTexture(Globals.DIR + '/gfx/smoketex.jpg');\r\n      var smokeMaterial = new THREE.PointCloudMaterial({\r\n        map: smokeTexture,\r\n        transparent: true,\r\n        depthWrite: false,\r\n        blending: THREE.AdditiveBlending,\r\n        size: 2,\r\n        color: 0x111111\r\n      });\r\n\r\n      fry.steaming.system = new THREE.PointCloud(fry.steaming.particles, smokeMaterial);\r\n      fry.steaming.system.sortParticles = true;\r\n\r\n      fry.steaming.container = new THREE.Gyroscope();\r\n      fry.steaming.container.add(fry.steaming.system);\r\n      fry.drawable.mesh.add(fry.steaming.container);\r\n\r\n      if (options.callback) {\r\n        options.callback(fry);\r\n      }\r\n    }.bind(this));\r\n  },\r\n\r\n  makeGround: function(options) {\r\n    var ground = this.entities.createEntity();\r\n\r\n    ground.addComponent(C.Identifier);\r\n    ground.addComponent(C.Position);\r\n    ground.addComponent(C.Drawable);\r\n\r\n    ground.identifier.type = Globals.ENTITY_TYPES.ground;\r\n\r\n    ground.drawable.scene = options.scene;\r\n\r\n    var mainTex = ResourceManager.instance.getTexture('gfx/brick-floor-tileable_COLOR.jpg');\r\n    mainTex.wrapS = mainTex.wrapT = THREE.RepeatWrapping;\r\n    var diffuseTex = ResourceManager.instance.getTexture('gfx/brick-floor-tileable_DISP.jpg');\r\n    diffuseTex.wrapS = mainTex.wrapT = THREE.RepeatWrapping;\r\n    var specularTex = ResourceManager.instance.getTexture('gfx/brick-floor-tileable_SPEC.jpg');\r\n    specularTex.wrapS = mainTex.wrapT = THREE.RepeatWrapping;\r\n\r\n    ground.drawable.mesh = new Physijs.BoxMesh(\r\n      new THREE.BoxGeometry(options.width, 1, options.height),\r\n      new THREE.MeshPhongMaterial({\r\n        map: ResourceManager.instance.getTexture('gfx/brick-floor-tileable_COLOR.jpg'),\r\n        displacementMap: ResourceManager.instance.getTexture('gfx/brick-floor-tileable_DISP.jpg'),\r\n        specularMap: ResourceManager.instance.getTexture('gfx/brick-floor-tileable_SPEC.jpg')\r\n          //color: 0x00ff00\r\n      }), 0);\r\n    ground.drawable.mesh.entity = ground;\r\n\r\n    ground.drawable.mesh._physijs.collision_type = EntityFactory.COLLISION_TYPES.obstacle;\r\n    ground.drawable.mesh._physijs.collision_masks = (\r\n      EntityFactory.COLLISION_TYPES.obstacle |\r\n      EntityFactory.COLLISION_TYPES.player |\r\n      EntityFactory.COLLISION_TYPES.enemy |\r\n      EntityFactory.COLLISION_TYPES.playerBullet |\r\n      EntityFactory.COLLISION_TYPES.enemyBullet);\r\n\r\n    ground.drawable.scene.add(ground.drawable.mesh);\r\n  }\r\n}, {\r\n  statics: {\r\n    get instance() {\r\n      if (!EntityFactory._instance) {\r\n        EntityFactory._instance = new EntityFactory();\r\n      }\r\n      return EntityFactory._instance;\r\n    },\r\n\r\n    COLLISION_TYPES: {\r\n      nothing: 0, // collide with nothing\r\n\r\n      obstacle: 1 << 0,\r\n      player: 1 << 2,\r\n      enemy: 1 << 3,\r\n\r\n      playerBullet: 1 << 4,\r\n      enemyBullet: 1 << 5\r\n    },\r\n\r\n    MOVE_SPEED: {\r\n      enemy: 160\r\n    },\r\n\r\n    MASS: {\r\n      player: 73,\r\n      enemy: 81,\r\n      bullet: 0.3\r\n    }\r\n  }\r\n});\r\n\r\n","module.exports = function(THREE) {\n  'use strict';\n\n  var SUPPORT_TRANSFERABLE,\n    _is_simulating = false,\n    _Physijs = Physijs, // used for noConflict method\n    Physijs = {}, // object assigned to window.Physijs\n    Eventable, // class to provide simple event methods\n    getObjectId, // returns a unique ID for a Physijs mesh object\n    getEulerXYZFromQuaternion, getQuatertionFromEuler,\n    convertWorldPositionToObject, // Converts a world-space position to object-space\n    addObjectChildren,\n\n    _temp1, _temp2,\n    _temp_vector3_1 = new THREE.Vector3,\n    _temp_vector3_2 = new THREE.Vector3,\n    _temp_matrix4_1 = new THREE.Matrix4,\n    _quaternion_1 = new THREE.Quaternion,\n\n    // constants\n    MESSAGE_TYPES = {\n      WORLDREPORT: 0,\n      COLLISIONREPORT: 1,\n      VEHICLEREPORT: 2,\n      CONSTRAINTREPORT: 3\n    },\n    REPORT_ITEMSIZE = 14,\n    COLLISIONREPORT_ITEMSIZE = 5,\n    VEHICLEREPORT_ITEMSIZE = 9,\n    CONSTRAINTREPORT_ITEMSIZE = 6;\n\n  Physijs.scripts = {};\n\n  Eventable = function() {\n    this._eventListeners = {};\n  };\n  Eventable.prototype.addEventListener = function(event_name, callback) {\n    if (!this._eventListeners.hasOwnProperty(event_name)) {\n      this._eventListeners[event_name] = [];\n    }\n    this._eventListeners[event_name].push(callback);\n  };\n  Eventable.prototype.removeEventListener = function(event_name, callback) {\n    var index;\n\n    if (!this._eventListeners.hasOwnProperty(event_name)) return false;\n\n    if ((index = this._eventListeners[event_name].indexOf(callback)) >= 0) {\n      this._eventListeners[event_name].splice(index, 1);\n      return true;\n    }\n\n    return false;\n  };\n  Eventable.prototype.dispatchEvent = function(event_name) {\n    var i,\n      parameters = Array.prototype.splice.call(arguments, 1);\n\n    if (this._eventListeners.hasOwnProperty(event_name)) {\n      for (i = 0; i < this._eventListeners[event_name].length; i++) {\n        this._eventListeners[event_name][i].apply(this, parameters);\n      }\n    }\n  };\n  Eventable.make = function(obj) {\n    obj.prototype.addEventListener = Eventable.prototype.addEventListener;\n    obj.prototype.removeEventListener = Eventable.prototype.removeEventListener;\n    obj.prototype.dispatchEvent = Eventable.prototype.dispatchEvent;\n  };\n\n  getObjectId = (function() {\n    var _id = 1;\n    return function() {\n      return _id++;\n    };\n  })();\n\n  getEulerXYZFromQuaternion = function(x, y, z, w) {\n    return new THREE.Vector3(\n      Math.atan2(2 * (x * w - y * z), (w * w - x * x - y * y + z * z)),\n      Math.asin(2 * (x * z + y * w)),\n      Math.atan2(2 * (z * w - x * y), (w * w + x * x - y * y - z * z))\n    );\n  };\n\n  getQuatertionFromEuler = function(x, y, z) {\n    var c1, s1, c2, s2, c3, s3, c1c2, s1s2;\n    c1 = Math.cos(y);\n    s1 = Math.sin(y);\n    c2 = Math.cos(-z);\n    s2 = Math.sin(-z);\n    c3 = Math.cos(x);\n    s3 = Math.sin(x);\n\n    c1c2 = c1 * c2;\n    s1s2 = s1 * s2;\n\n    return {\n      w: c1c2 * c3 - s1s2 * s3,\n      x: c1c2 * s3 + s1s2 * c3,\n      y: s1 * c2 * c3 + c1 * s2 * s3,\n      z: c1 * s2 * c3 - s1 * c2 * s3\n    };\n  };\n\n  convertWorldPositionToObject = function(position, object) {\n    _temp_matrix4_1.identity(); // reset temp matrix\n\n    // Set the temp matrix's rotation to the object's rotation\n    _temp_matrix4_1.identity().makeRotationFromQuaternion(object.quaternion);\n\n    // Invert rotation matrix in order to \"unrotate\" a point back to object space\n    _temp_matrix4_1.getInverse(_temp_matrix4_1);\n\n    // Yay! Temp vars!\n    _temp_vector3_1.copy(position);\n    _temp_vector3_2.copy(object.position);\n\n    // Apply the rotation\n\n    return _temp_vector3_1.sub(_temp_vector3_2).applyMatrix4(_temp_matrix4_1);\n  };\n\n\n\n  // Physijs.noConflict\n  Physijs.noConflict = function() {\n    window.Physijs = _Physijs;\n    return Physijs;\n  };\n\n\n  // Physijs.createMaterial\n  Physijs.createMaterial = function(material, friction, restitution) {\n    var physijs_material = function() {};\n    physijs_material.prototype = material;\n    physijs_material = new physijs_material;\n\n    physijs_material._physijs = {\n      id: material.id,\n      friction: friction === undefined ? .8 : friction,\n      restitution: restitution === undefined ? .2 : restitution\n    };\n\n    return physijs_material;\n  };\n\n\n  // Constraints\n  Physijs.PointConstraint = function(objecta, objectb, position) {\n    if (position === undefined) {\n      position = objectb;\n      objectb = undefined;\n    }\n\n    this.type = 'point';\n    this.appliedImpulse = 0;\n    this.id = getObjectId();\n    this.objecta = objecta._physijs.id;\n    this.positiona = convertWorldPositionToObject(position, objecta).clone();\n\n    if (objectb) {\n      this.objectb = objectb._physijs.id;\n      this.positionb = convertWorldPositionToObject(position, objectb).clone();\n    }\n  };\n  Physijs.PointConstraint.prototype.getDefinition = function() {\n    return {\n      type: this.type,\n      id: this.id,\n      objecta: this.objecta,\n      objectb: this.objectb,\n      positiona: this.positiona,\n      positionb: this.positionb\n    };\n  };\n\n  Physijs.HingeConstraint = function(objecta, objectb, position, axis) {\n    if (axis === undefined) {\n      axis = position;\n      position = objectb;\n      objectb = undefined;\n    }\n\n    this.type = 'hinge';\n    this.appliedImpulse = 0;\n    this.id = getObjectId();\n    this.scene = objecta.parent;\n    this.objecta = objecta._physijs.id;\n    this.positiona = convertWorldPositionToObject(position, objecta).clone();\n    this.position = position.clone();\n    this.axis = axis;\n\n    if (objectb) {\n      this.objectb = objectb._physijs.id;\n      this.positionb = convertWorldPositionToObject(position, objectb).clone();\n    }\n  };\n  Physijs.HingeConstraint.prototype.getDefinition = function() {\n    return {\n      type: this.type,\n      id: this.id,\n      objecta: this.objecta,\n      objectb: this.objectb,\n      positiona: this.positiona,\n      positionb: this.positionb,\n      axis: this.axis\n    };\n  };\n  /*\n   * low = minimum angle in radians\n   * high = maximum angle in radians\n   * bias_factor = applied as a factor to constraint error\n   * relaxation_factor = controls bounce (0.0 == no bounce)\n   */\n  Physijs.HingeConstraint.prototype.setLimits = function(low, high, bias_factor, relaxation_factor) {\n    this.scene.execute('hinge_setLimits', {\n      constraint: this.id,\n      low: low,\n      high: high,\n      bias_factor: bias_factor,\n      relaxation_factor: relaxation_factor\n    });\n  };\n  Physijs.HingeConstraint.prototype.enableAngularMotor = function(velocity, acceleration) {\n    this.scene.execute('hinge_enableAngularMotor', {\n      constraint: this.id,\n      velocity: velocity,\n      acceleration: acceleration\n    });\n  };\n  Physijs.HingeConstraint.prototype.disableMotor = function(velocity, acceleration) {\n    this.scene.execute('hinge_disableMotor', {\n      constraint: this.id\n    });\n  };\n\n  Physijs.SliderConstraint = function(objecta, objectb, position, axis) {\n    if (axis === undefined) {\n      axis = position;\n      position = objectb;\n      objectb = undefined;\n    }\n\n    this.type = 'slider';\n    this.appliedImpulse = 0;\n    this.id = getObjectId();\n    this.scene = objecta.parent;\n    this.objecta = objecta._physijs.id;\n    this.positiona = convertWorldPositionToObject(position, objecta).clone();\n    this.axis = axis;\n\n    if (objectb) {\n      this.objectb = objectb._physijs.id;\n      this.positionb = convertWorldPositionToObject(position, objectb).clone();\n    }\n  };\n  Physijs.SliderConstraint.prototype.getDefinition = function() {\n    return {\n      type: this.type,\n      id: this.id,\n      objecta: this.objecta,\n      objectb: this.objectb,\n      positiona: this.positiona,\n      positionb: this.positionb,\n      axis: this.axis\n    };\n  };\n  Physijs.SliderConstraint.prototype.setLimits = function(lin_lower, lin_upper, ang_lower, ang_upper) {\n    this.scene.execute('slider_setLimits', {\n      constraint: this.id,\n      lin_lower: lin_lower,\n      lin_upper: lin_upper,\n      ang_lower: ang_lower,\n      ang_upper: ang_upper\n    });\n  };\n  Physijs.SliderConstraint.prototype.setRestitution = function(linear, angular) {\n    this.scene.execute(\n      'slider_setRestitution', {\n        constraint: this.id,\n        linear: linear,\n        angular: angular\n      }\n    );\n  };\n  Physijs.SliderConstraint.prototype.enableLinearMotor = function(velocity, acceleration) {\n    this.scene.execute('slider_enableLinearMotor', {\n      constraint: this.id,\n      velocity: velocity,\n      acceleration: acceleration\n    });\n  };\n  Physijs.SliderConstraint.prototype.disableLinearMotor = function() {\n    this.scene.execute('slider_disableLinearMotor', {\n      constraint: this.id\n    });\n  };\n  Physijs.SliderConstraint.prototype.enableAngularMotor = function(velocity, acceleration) {\n    this.scene.execute('slider_enableAngularMotor', {\n      constraint: this.id,\n      velocity: velocity,\n      acceleration: acceleration\n    });\n  };\n  Physijs.SliderConstraint.prototype.disableAngularMotor = function() {\n    this.scene.execute('slider_disableAngularMotor', {\n      constraint: this.id\n    });\n  };\n\n  Physijs.ConeTwistConstraint = function(objecta, objectb, position) {\n    if (position === undefined) {\n      throw 'Both objects must be defined in a ConeTwistConstraint.';\n    }\n    this.type = 'conetwist';\n    this.appliedImpulse = 0;\n    this.id = getObjectId();\n    this.scene = objecta.parent;\n    this.objecta = objecta._physijs.id;\n    this.positiona = convertWorldPositionToObject(position, objecta).clone();\n    this.objectb = objectb._physijs.id;\n    this.positionb = convertWorldPositionToObject(position, objectb).clone();\n    this.axisa = {\n      x: objecta.rotation.x,\n      y: objecta.rotation.y,\n      z: objecta.rotation.z\n    };\n    this.axisb = {\n      x: objectb.rotation.x,\n      y: objectb.rotation.y,\n      z: objectb.rotation.z\n    };\n  };\n  Physijs.ConeTwistConstraint.prototype.getDefinition = function() {\n    return {\n      type: this.type,\n      id: this.id,\n      objecta: this.objecta,\n      objectb: this.objectb,\n      positiona: this.positiona,\n      positionb: this.positionb,\n      axisa: this.axisa,\n      axisb: this.axisb\n    };\n  };\n  Physijs.ConeTwistConstraint.prototype.setLimit = function(x, y, z) {\n    this.scene.execute('conetwist_setLimit', {\n      constraint: this.id,\n      x: x,\n      y: y,\n      z: z\n    });\n  };\n  Physijs.ConeTwistConstraint.prototype.enableMotor = function() {\n    this.scene.execute('conetwist_enableMotor', {\n      constraint: this.id\n    });\n  };\n  Physijs.ConeTwistConstraint.prototype.setMaxMotorImpulse = function(max_impulse) {\n    this.scene.execute('conetwist_setMaxMotorImpulse', {\n      constraint: this.id,\n      max_impulse: max_impulse\n    });\n  };\n  Physijs.ConeTwistConstraint.prototype.setMotorTarget = function(target) {\n    if (target instanceof THREE.Vector3) {\n      target = new THREE.Quaternion().setFromEuler(new THREE.Euler(target.x, target.y, target.z));\n    }\n    else if (target instanceof THREE.Euler) {\n      target = new THREE.Quaternion().setFromEuler(target);\n    }\n    else if (target instanceof THREE.Matrix4) {\n      target = new THREE.Quaternion().setFromRotationMatrix(target);\n    }\n    this.scene.execute('conetwist_setMotorTarget', {\n      constraint: this.id,\n      x: target.x,\n      y: target.y,\n      z: target.z,\n      w: target.w\n    });\n  };\n  Physijs.ConeTwistConstraint.prototype.disableMotor = function() {\n    this.scene.execute('conetwist_disableMotor', {\n      constraint: this.id\n    });\n  };\n\n  Physijs.DOFConstraint = function(objecta, objectb, position) {\n    if (position === undefined) {\n      position = objectb;\n      objectb = undefined;\n    }\n    this.type = 'dof';\n    this.appliedImpulse = 0;\n    this.id = getObjectId();\n    this.scene = objecta.parent;\n    this.objecta = objecta._physijs.id;\n    this.positiona = convertWorldPositionToObject(position, objecta).clone();\n    this.axisa = {\n      x: objecta.rotation.x,\n      y: objecta.rotation.y,\n      z: objecta.rotation.z\n    };\n\n    if (objectb) {\n      this.objectb = objectb._physijs.id;\n      this.positionb = convertWorldPositionToObject(position, objectb).clone();\n      this.axisb = {\n        x: objectb.rotation.x,\n        y: objectb.rotation.y,\n        z: objectb.rotation.z\n      };\n    }\n  };\n  Physijs.DOFConstraint.prototype.getDefinition = function() {\n    return {\n      type: this.type,\n      id: this.id,\n      objecta: this.objecta,\n      objectb: this.objectb,\n      positiona: this.positiona,\n      positionb: this.positionb,\n      axisa: this.axisa,\n      axisb: this.axisb\n    };\n  };\n  Physijs.DOFConstraint.prototype.setLinearLowerLimit = function(limit) {\n    this.scene.execute('dof_setLinearLowerLimit', {\n      constraint: this.id,\n      x: limit.x,\n      y: limit.y,\n      z: limit.z\n    });\n  };\n  Physijs.DOFConstraint.prototype.setLinearUpperLimit = function(limit) {\n    this.scene.execute('dof_setLinearUpperLimit', {\n      constraint: this.id,\n      x: limit.x,\n      y: limit.y,\n      z: limit.z\n    });\n  };\n  Physijs.DOFConstraint.prototype.setAngularLowerLimit = function(limit) {\n    this.scene.execute('dof_setAngularLowerLimit', {\n      constraint: this.id,\n      x: limit.x,\n      y: limit.y,\n      z: limit.z\n    });\n  };\n  Physijs.DOFConstraint.prototype.setAngularUpperLimit = function(limit) {\n    this.scene.execute('dof_setAngularUpperLimit', {\n      constraint: this.id,\n      x: limit.x,\n      y: limit.y,\n      z: limit.z\n    });\n  };\n  Physijs.DOFConstraint.prototype.enableAngularMotor = function(which) {\n    this.scene.execute('dof_enableAngularMotor', {\n      constraint: this.id,\n      which: which\n    });\n  };\n  Physijs.DOFConstraint.prototype.configureAngularMotor = function(which, low_angle, high_angle, velocity, max_force) {\n    this.scene.execute('dof_configureAngularMotor', {\n      constraint: this.id,\n      which: which,\n      low_angle: low_angle,\n      high_angle: high_angle,\n      velocity: velocity,\n      max_force: max_force\n    });\n  };\n  Physijs.DOFConstraint.prototype.disableAngularMotor = function(which) {\n    this.scene.execute('dof_disableAngularMotor', {\n      constraint: this.id,\n      which: which\n    });\n  };\n\n  // Physijs.Scene\n  Physijs.Scene = function(params) {\n    var self = this;\n\n    Eventable.call(this);\n    THREE.Scene.call(this);\n\n    this._worker = new Worker(Physijs.scripts.worker || 'physijsWorker.js');\n    this._worker.transferableMessage = this._worker.webkitPostMessage || this._worker.postMessage;\n    this._materials_ref_counts = {};\n    this._objects = {};\n    this._vehicles = {};\n    this._constraints = {};\n\n    var ab = new ArrayBuffer(1);\n    this._worker.transferableMessage(ab, [ab]);\n    SUPPORT_TRANSFERABLE = (ab.byteLength === 0);\n\n    this._worker.onerror = function(event) {\n      console.log(event.message);\n      console.log(event.filename);\n      console.log(event.lineno);\n    };\n\n    this._worker.onmessage = function(event) {\n      var _temp,\n        data = event.data;\n\n      if (data instanceof ArrayBuffer && data.byteLength !== 1) { // byteLength === 1 is the worker making a SUPPORT_TRANSFERABLE test\n        data = new Float32Array(data);\n      }\n\n      if (data instanceof Float32Array) {\n\n        // transferable object\n        switch (data[0]) {\n          case MESSAGE_TYPES.WORLDREPORT:\n            self._updateScene(data);\n            break;\n\n          case MESSAGE_TYPES.COLLISIONREPORT:\n            self._updateCollisions(data);\n            break;\n\n          case MESSAGE_TYPES.VEHICLEREPORT:\n            self._updateVehicles(data);\n            break;\n\n          case MESSAGE_TYPES.CONSTRAINTREPORT:\n            self._updateConstraints(data);\n            break;\n        }\n\n      }\n      else {\n\n        if (data.cmd) {\n\n          // non-transferable object\n          switch (data.cmd) {\n            case 'objectReady':\n              _temp = data.params;\n              if (self._objects[_temp]) {\n                self._objects[_temp].dispatchEvent('ready');\n              }\n              break;\n\n            case 'worldReady':\n              self.dispatchEvent('ready');\n              break;\n\n            case 'vehicle':\n              window.test = data;\n              break;\n\n            default:\n              // Do nothing, just show the message\n              console.debug('Received: ' + data.cmd);\n              console.dir(data.params);\n              break;\n          }\n\n        }\n        else {\n\n          switch (data[0]) {\n            case MESSAGE_TYPES.WORLDREPORT:\n              self._updateScene(data);\n              break;\n\n            case MESSAGE_TYPES.COLLISIONREPORT:\n              self._updateCollisions(data);\n              break;\n\n            case MESSAGE_TYPES.VEHICLEREPORT:\n              self._updateVehicles(data);\n              break;\n\n            case MESSAGE_TYPES.CONSTRAINTREPORT:\n              self._updateConstraints(data);\n              break;\n          }\n\n        }\n\n      }\n    };\n\n\n    params = params || {};\n    params.ammo = Physijs.scripts.ammo || 'ammo.js';\n    params.fixedTimeStep = params.fixedTimeStep || 1 / 60;\n    params.rateLimit = params.rateLimit || true;\n    this.execute('init', params);\n  };\n  Physijs.Scene.prototype = new THREE.Scene;\n  Physijs.Scene.prototype.constructor = Physijs.Scene;\n  Eventable.make(Physijs.Scene);\n\n  Physijs.Scene.prototype._updateScene = function(data) {\n    var num_objects = data[1],\n      object,\n      i, offset;\n\n    for (i = 0; i < num_objects; i++) {\n      offset = 2 + i * REPORT_ITEMSIZE;\n      object = this._objects[data[offset]];\n\n      if (object === undefined) {\n        continue;\n      }\n\n      if (object.__dirtyPosition === false) {\n        object.position.set(\n          data[offset + 1],\n          data[offset + 2],\n          data[offset + 3]\n        );\n      }\n\n      if (object.__dirtyRotation === false) {\n        object.quaternion.set(\n          data[offset + 4],\n          data[offset + 5],\n          data[offset + 6],\n          data[offset + 7]\n        );\n      }\n\n      object._physijs.linearVelocity.set(\n        data[offset + 8],\n        data[offset + 9],\n        data[offset + 10]\n      );\n\n      object._physijs.angularVelocity.set(\n        data[offset + 11],\n        data[offset + 12],\n        data[offset + 13]\n      );\n\n    }\n\n    if (SUPPORT_TRANSFERABLE) {\n      // Give the typed array back to the worker\n      this._worker.transferableMessage(data.buffer, [data.buffer]);\n    }\n\n    _is_simulating = false;\n    this.dispatchEvent('update');\n  };\n\n  Physijs.Scene.prototype._updateVehicles = function(data) {\n    var vehicle, wheel,\n      i, offset;\n\n    for (i = 0; i < (data.length - 1) / VEHICLEREPORT_ITEMSIZE; i++) {\n      offset = 1 + i * VEHICLEREPORT_ITEMSIZE;\n      vehicle = this._vehicles[data[offset]];\n\n      if (vehicle === undefined) {\n        continue;\n      }\n\n      wheel = vehicle.wheels[data[offset + 1]];\n\n      wheel.position.set(\n        data[offset + 2],\n        data[offset + 3],\n        data[offset + 4]\n      );\n\n      wheel.quaternion.set(\n        data[offset + 5],\n        data[offset + 6],\n        data[offset + 7],\n        data[offset + 8]\n      );\n    }\n\n    if (SUPPORT_TRANSFERABLE) {\n      // Give the typed array back to the worker\n      this._worker.transferableMessage(data.buffer, [data.buffer]);\n    }\n  };\n\n  Physijs.Scene.prototype._updateConstraints = function(data) {\n    var constraint, object,\n      i, offset;\n\n    for (i = 0; i < (data.length - 1) / CONSTRAINTREPORT_ITEMSIZE; i++) {\n      offset = 1 + i * CONSTRAINTREPORT_ITEMSIZE;\n      constraint = this._constraints[data[offset]];\n      object = this._objects[data[offset + 1]];\n\n      if (constraint === undefined || object === undefined) {\n        continue;\n      }\n\n      _temp_vector3_1.set(\n        data[offset + 2],\n        data[offset + 3],\n        data[offset + 4]\n      );\n      _temp_matrix4_1.extractRotation(object.matrix);\n      _temp_vector3_1.applyMatrix4(_temp_matrix4_1);\n\n      constraint.positiona.addVectors(object.position, _temp_vector3_1);\n      constraint.appliedImpulse = data[offset + 5];\n    }\n\n    if (SUPPORT_TRANSFERABLE) {\n      // Give the typed array back to the worker\n      this._worker.transferableMessage(data.buffer, [data.buffer]);\n    }\n  };\n\n  Physijs.Scene.prototype._updateCollisions = function(data) {\n    /**\n     * #TODO\n     * This is probably the worst way ever to handle collisions. The inherent evilness is a residual\n     * effect from the previous version's evilness which mutated when switching to transferable objects.\n     *\n     * If you feel inclined to make this better, please do so.\n     */\n\n    var i, j, offset, object, object2, id1, id2,\n      collisions = {},\n      normal_offsets = {};\n\n    // Build collision manifest\n    for (i = 0; i < data[1]; i++) {\n      offset = 2 + i * COLLISIONREPORT_ITEMSIZE;\n      object = data[offset];\n      object2 = data[offset + 1];\n\n      normal_offsets[object + '-' + object2] = offset + 2;\n      normal_offsets[object2 + '-' + object] = -1 * (offset + 2);\n\n      // Register collisions for both the object colliding and the object being collided with\n      if (!collisions[object]) collisions[object] = [];\n      collisions[object].push(object2);\n\n      if (!collisions[object2]) collisions[object2] = [];\n      collisions[object2].push(object);\n    }\n\n    // Deal with collisions\n    for (id1 in this._objects) {\n      if (!this._objects.hasOwnProperty(id1)) continue;\n      object = this._objects[id1];\n\n      // If object touches anything, ...\n      if (collisions[id1]) {\n\n        // Clean up touches array\n        for (j = 0; j < object._physijs.touches.length; j++) {\n          if (collisions[id1].indexOf(object._physijs.touches[j]) === -1) {\n            object._physijs.touches.splice(j--, 1);\n          }\n        }\n\n        // Handle each colliding object\n        for (j = 0; j < collisions[id1].length; j++) {\n          id2 = collisions[id1][j];\n          object2 = this._objects[id2];\n\n          if (object2) {\n            // If object was not already touching object2, notify object\n            if (object._physijs.touches.indexOf(id2) === -1) {\n              object._physijs.touches.push(id2);\n\n              _temp_vector3_1.subVectors(object.getLinearVelocity(), object2.getLinearVelocity());\n              _temp1 = _temp_vector3_1.clone();\n\n              _temp_vector3_1.subVectors(object.getAngularVelocity(), object2.getAngularVelocity());\n              _temp2 = _temp_vector3_1.clone();\n\n              var normal_offset = normal_offsets[object._physijs.id + '-' + object2._physijs.id];\n              if (normal_offset > 0) {\n                _temp_vector3_1.set(-data[normal_offset], -data[normal_offset + 1], -data[normal_offset + 2]);\n              }\n              else {\n                normal_offset *= -1;\n                _temp_vector3_1.set(\n                  data[normal_offset],\n                  data[normal_offset + 1],\n                  data[normal_offset + 2]\n                );\n              }\n\n              object.dispatchEvent('collision', object2, _temp1, _temp2, _temp_vector3_1);\n            }\n          }\n        }\n\n      }\n      else {\n\n        // not touching other objects\n        object._physijs.touches.length = 0;\n\n      }\n\n    }\n\n    this.collisions = collisions;\n\n    if (SUPPORT_TRANSFERABLE) {\n      // Give the typed array back to the worker\n      this._worker.transferableMessage(data.buffer, [data.buffer]);\n    }\n  };\n\n  Physijs.Scene.prototype.addConstraint = function(constraint, show_marker) {\n    this._constraints[constraint.id] = constraint;\n    this.execute('addConstraint', constraint.getDefinition());\n\n    if (show_marker) {\n      var marker;\n\n      switch (constraint.type) {\n        case 'point':\n          marker = new THREE.Mesh(\n            new THREE.SphereGeometry(1.5),\n            new THREE.MeshNormalMaterial\n          );\n          marker.position.copy(constraint.positiona);\n          this._objects[constraint.objecta].add(marker);\n          break;\n\n        case 'hinge':\n          marker = new THREE.Mesh(\n            new THREE.SphereGeometry(1.5),\n            new THREE.MeshNormalMaterial\n          );\n          marker.position.copy(constraint.positiona);\n          this._objects[constraint.objecta].add(marker);\n          break;\n\n        case 'slider':\n          marker = new THREE.Mesh(\n            new THREE.BoxGeometry(10, 1, 1),\n            new THREE.MeshNormalMaterial\n          );\n          marker.position.copy(constraint.positiona);\n          // This rotation isn't right if all three axis are non-0 values\n          // TODO: change marker's rotation order to ZYX\n          marker.rotation.set(\n            constraint.axis.y, // yes, y and\n            constraint.axis.x, // x axis are swapped\n            constraint.axis.z\n          );\n          this._objects[constraint.objecta].add(marker);\n          break;\n\n        case 'conetwist':\n          marker = new THREE.Mesh(\n            new THREE.SphereGeometry(1.5),\n            new THREE.MeshNormalMaterial\n          );\n          marker.position.copy(constraint.positiona);\n          this._objects[constraint.objecta].add(marker);\n          break;\n\n        case 'dof':\n          marker = new THREE.Mesh(\n            new THREE.SphereGeometry(1.5),\n            new THREE.MeshNormalMaterial\n          );\n          marker.position.copy(constraint.positiona);\n          this._objects[constraint.objecta].add(marker);\n          break;\n      }\n    }\n\n    return constraint;\n  };\n\n  Physijs.Scene.prototype.onSimulationResume = function() {\n    this.execute('onSimulationResume', {});\n  };\n\n  Physijs.Scene.prototype.removeConstraint = function(constraint) {\n    if (this._constraints[constraint.id] !== undefined) {\n      this.execute('removeConstraint', {\n        id: constraint.id\n      });\n      delete this._constraints[constraint.id];\n    }\n  };\n\n  Physijs.Scene.prototype.execute = function(cmd, params) {\n    this._worker.postMessage({\n      cmd: cmd,\n      params: params\n    });\n  };\n\n  addObjectChildren = function(parent, object) {\n    var i;\n\n    for (i = 0; i < object.children.length; i++) {\n      if (object.children[i]._physijs) {\n        object.children[i].updateMatrix();\n        object.children[i].updateMatrixWorld();\n\n        _temp_vector3_1.setFromMatrixPosition(object.children[i].matrixWorld);\n        _quaternion_1.setFromRotationMatrix(object.children[i].matrixWorld);\n\n        object.children[i]._physijs.position_offset = {\n          x: _temp_vector3_1.x,\n          y: _temp_vector3_1.y,\n          z: _temp_vector3_1.z\n        };\n\n        object.children[i]._physijs.rotation = {\n          x: _quaternion_1.x,\n          y: _quaternion_1.y,\n          z: _quaternion_1.z,\n          w: _quaternion_1.w\n        };\n\n        parent._physijs.children.push(object.children[i]._physijs);\n      }\n\n      addObjectChildren(parent, object.children[i]);\n    }\n  };\n\n  Physijs.Scene.prototype.add = function(object) {\n    THREE.Mesh.prototype.add.call(this, object);\n\n    if (object._physijs) {\n\n      object.world = this;\n\n      if (object instanceof Physijs.Vehicle) {\n\n        this.add(object.mesh);\n        this._vehicles[object._physijs.id] = object;\n        this.execute('addVehicle', object._physijs);\n\n      }\n      else {\n\n        object.__dirtyPosition = false;\n        object.__dirtyRotation = false;\n        this._objects[object._physijs.id] = object;\n\n        if (object.children.length) {\n          object._physijs.children = [];\n          addObjectChildren(object, object);\n        }\n\n        if (object.material._physijs) {\n          if (!this._materials_ref_counts.hasOwnProperty(object.material._physijs.id)) {\n            this.execute('registerMaterial', object.material._physijs);\n            object._physijs.materialId = object.material._physijs.id;\n            this._materials_ref_counts[object.material._physijs.id] = 1;\n          }\n          else {\n            this._materials_ref_counts[object.material._physijs.id]++;\n          }\n        }\n\n        // Object starting position + rotation\n        object._physijs.position = {\n          x: object.position.x,\n          y: object.position.y,\n          z: object.position.z\n        };\n        object._physijs.rotation = {\n          x: object.quaternion.x,\n          y: object.quaternion.y,\n          z: object.quaternion.z,\n          w: object.quaternion.w\n        };\n\n        // Check for scaling\n        var mass_scaling = new THREE.Vector3(1, 1, 1);\n        if (object._physijs.width) {\n          object._physijs.width *= object.scale.x;\n        }\n        if (object._physijs.height) {\n          object._physijs.height *= object.scale.y;\n        }\n        if (object._physijs.depth) {\n          object._physijs.depth *= object.scale.z;\n        }\n\n        this.execute('addObject', object._physijs);\n\n      }\n    }\n  };\n\n  Physijs.Scene.prototype.remove = function(object) {\n    if (object instanceof Physijs.Vehicle) {\n      this.execute('removeVehicle', {\n        id: object._physijs.id\n      });\n      while (object.wheels.length) {\n        this.remove(object.wheels.pop());\n      }\n      this.remove(object.mesh);\n      delete this._vehicles[object._physijs.id];\n    }\n    else {\n      THREE.Mesh.prototype.remove.call(this, object);\n      if (object._physijs) {\n        delete this._objects[object._physijs.id];\n        this.execute('removeObject', {\n          id: object._physijs.id\n        });\n      }\n    }\n    if (object.material && object.material._physijs && this._materials_ref_counts.hasOwnProperty(object.material._physijs.id)) {\n      this._materials_ref_counts[object.material._physijs.id]--;\n      if (this._materials_ref_counts[object.material._physijs.id] == 0) {\n        this.execute('unRegisterMaterial', object.material._physijs);\n        delete this._materials_ref_counts[object.material._physijs.id];\n      }\n    }\n  };\n\n  Physijs.Scene.prototype.setFixedTimeStep = function(fixedTimeStep) {\n    if (fixedTimeStep) {\n      this.execute('setFixedTimeStep', fixedTimeStep);\n    }\n  };\n\n  Physijs.Scene.prototype.setGravity = function(gravity) {\n    if (gravity) {\n      this.execute('setGravity', gravity);\n    }\n  };\n\n  Physijs.Scene.prototype.simulate = function(timeStep, maxSubSteps) {\n    var object_id, object, update;\n\n    if (_is_simulating) {\n      return false;\n    }\n\n    _is_simulating = true;\n\n    for (object_id in this._objects) {\n      if (!this._objects.hasOwnProperty(object_id)) continue;\n\n      object = this._objects[object_id];\n\n      if (object.__dirtyPosition || object.__dirtyRotation) {\n        update = {\n          id: object._physijs.id\n        };\n\n        if (object.__dirtyPosition) {\n          update.pos = {\n            x: object.position.x,\n            y: object.position.y,\n            z: object.position.z\n          };\n          object.__dirtyPosition = false;\n        }\n\n        if (object.__dirtyRotation) {\n          update.quat = {\n            x: object.quaternion.x,\n            y: object.quaternion.y,\n            z: object.quaternion.z,\n            w: object.quaternion.w\n          };\n          object.__dirtyRotation = false;\n        }\n\n        this.execute('updateTransform', update);\n      }\n    }\n\n    this.execute('simulate', {\n      timeStep: timeStep,\n      maxSubSteps: maxSubSteps\n    });\n\n    return true;\n  };\n\n\n  // Phsijs.Mesh\n  Physijs.Mesh = function(geometry, material, mass) {\n    var index;\n\n    if (!geometry) {\n      return;\n    }\n\n    Eventable.call(this);\n    THREE.Mesh.call(this, geometry, material);\n\n    if (!geometry.boundingBox) {\n      geometry.computeBoundingBox();\n    }\n\n    this._physijs = {\n      type: null,\n      id: getObjectId(),\n      mass: mass || 0,\n      touches: [],\n      linearVelocity: new THREE.Vector3,\n      angularVelocity: new THREE.Vector3\n    };\n  };\n  Physijs.Mesh.prototype = new THREE.Mesh;\n  Physijs.Mesh.prototype.constructor = Physijs.Mesh;\n  Eventable.make(Physijs.Mesh);\n\n  // Physijs.Mesh.mass\n  Physijs.Mesh.prototype.__defineGetter__('mass', function() {\n    return this._physijs.mass;\n  });\n  Physijs.Mesh.prototype.__defineSetter__('mass', function(mass) {\n    this._physijs.mass = mass;\n    if (this.world) {\n      this.world.execute('updateMass', {\n        id: this._physijs.id,\n        mass: mass\n      });\n    }\n  });\n\n  // Physijs.Mesh.applyCentralImpulse\n  Physijs.Mesh.prototype.applyCentralImpulse = function(force) {\n    if (this.world) {\n      this.world.execute('applyCentralImpulse', {\n        id: this._physijs.id,\n        x: force.x,\n        y: force.y,\n        z: force.z\n      });\n    }\n  };\n\n  // Physijs.Mesh.applyImpulse\n  Physijs.Mesh.prototype.applyImpulse = function(force, offset) {\n    if (this.world) {\n      this.world.execute('applyImpulse', {\n        id: this._physijs.id,\n        impulse_x: force.x,\n        impulse_y: force.y,\n        impulse_z: force.z,\n        x: offset.x,\n        y: offset.y,\n        z: offset.z\n      });\n    }\n  };\n\n  // Physijs.Mesh.applyTorque\n  Physijs.Mesh.prototype.applyTorque = function(force) {\n    if (this.world) {\n      this.world.execute('applyTorque', {\n        id: this._physijs.id,\n        torque_x: force.x,\n        torque_y: force.y,\n        torque_z: force.z\n      });\n    }\n  };\n\n  // Physijs.Mesh.applyCentralForce\n  Physijs.Mesh.prototype.applyCentralForce = function(force) {\n    if (this.world) {\n      this.world.execute('applyCentralForce', {\n        id: this._physijs.id,\n        x: force.x,\n        y: force.y,\n        z: force.z\n      });\n    }\n  };\n\n  // Physijs.Mesh.applyForce\n  Physijs.Mesh.prototype.applyForce = function(force, offset) {\n    if (this.world) {\n      this.world.execute('applyForce', {\n        id: this._physijs.id,\n        force_x: force.x,\n        force_y: force.y,\n        force_z: force.z,\n        x: offset.x,\n        y: offset.y,\n        z: offset.z\n      });\n    }\n  };\n\n  // Physijs.Mesh.getAngularVelocity\n  Physijs.Mesh.prototype.getAngularVelocity = function() {\n    return this._physijs.angularVelocity;\n  };\n\n  // Physijs.Mesh.setAngularVelocity\n  Physijs.Mesh.prototype.setAngularVelocity = function(velocity) {\n    if (this.world) {\n      this.world.execute('setAngularVelocity', {\n        id: this._physijs.id,\n        x: velocity.x,\n        y: velocity.y,\n        z: velocity.z\n      });\n    }\n  };\n\n  // Physijs.Mesh.getLinearVelocity\n  Physijs.Mesh.prototype.getLinearVelocity = function() {\n    return this._physijs.linearVelocity;\n  };\n\n  // Physijs.Mesh.setLinearVelocity\n  Physijs.Mesh.prototype.setLinearVelocity = function(velocity) {\n    if (this.world) {\n      this.world.execute('setLinearVelocity', {\n        id: this._physijs.id,\n        x: velocity.x,\n        y: velocity.y,\n        z: velocity.z\n      });\n    }\n  };\n\n  // Physijs.Mesh.setAngularFactor\n  Physijs.Mesh.prototype.setAngularFactor = function(factor) {\n    if (this.world) {\n      this.world.execute('setAngularFactor', {\n        id: this._physijs.id,\n        x: factor.x,\n        y: factor.y,\n        z: factor.z\n      });\n    }\n  };\n\n  // Physijs.Mesh.setLinearFactor\n  Physijs.Mesh.prototype.setLinearFactor = function(factor) {\n    if (this.world) {\n      this.world.execute('setLinearFactor', {\n        id: this._physijs.id,\n        x: factor.x,\n        y: factor.y,\n        z: factor.z\n      });\n    }\n  };\n\n  // Physijs.Mesh.setDamping\n  Physijs.Mesh.prototype.setDamping = function(linear, angular) {\n    if (this.world) {\n      this.world.execute('setDamping', {\n        id: this._physijs.id,\n        linear: linear,\n        angular: angular\n      });\n    }\n  };\n\n  // Physijs.Mesh.setCcdMotionThreshold\n  Physijs.Mesh.prototype.setCcdMotionThreshold = function(threshold) {\n    if (this.world) {\n      this.world.execute('setCcdMotionThreshold', {\n        id: this._physijs.id,\n        threshold: threshold\n      });\n    }\n  };\n\n  // Physijs.Mesh.setCcdSweptSphereRadius\n  Physijs.Mesh.prototype.setCcdSweptSphereRadius = function(radius) {\n    if (this.world) {\n      this.world.execute('setCcdSweptSphereRadius', {\n        id: this._physijs.id,\n        radius: radius\n      });\n    }\n  };\n\n\n  // Physijs.PlaneMesh\n  Physijs.PlaneMesh = function(geometry, material, mass) {\n    var width, height;\n\n    Physijs.Mesh.call(this, geometry, material, mass);\n\n    if (!geometry.boundingBox) {\n      geometry.computeBoundingBox();\n    }\n\n    width = geometry.boundingBox.max.x - geometry.boundingBox.min.x;\n    height = geometry.boundingBox.max.y - geometry.boundingBox.min.y;\n\n    this._physijs.type = 'plane';\n    this._physijs.normal = geometry.faces[0].normal.clone();\n    this._physijs.mass = (typeof mass === 'undefined') ? width * height : mass;\n  };\n  Physijs.PlaneMesh.prototype = new Physijs.Mesh;\n  Physijs.PlaneMesh.prototype.constructor = Physijs.PlaneMesh;\n\n  // Physijs.HeightfieldMesh\n  Physijs.HeightfieldMesh = function(geometry, material, mass, xdiv, ydiv) {\n    Physijs.Mesh.call(this, geometry, material, mass);\n\n    this._physijs.type = 'heightfield';\n    this._physijs.xsize = geometry.boundingBox.max.x - geometry.boundingBox.min.x;\n    this._physijs.ysize = geometry.boundingBox.max.y - geometry.boundingBox.min.y;\n    this._physijs.xpts = (typeof xdiv === 'undefined') ? Math.sqrt(geometry.vertices.length) : xdiv + 1;\n    this._physijs.ypts = (typeof ydiv === 'undefined') ? Math.sqrt(geometry.vertices.length) : ydiv + 1;\n    // note - this assumes our plane geometry is square, unless we pass in specific xdiv and ydiv\n    this._physijs.absMaxHeight = Math.max(geometry.boundingBox.max.z, Math.abs(geometry.boundingBox.min.z));\n\n    var points = [];\n\n    var a, b;\n    for (var i = 0; i < geometry.vertices.length; i++) {\n\n      a = i % this._physijs.xpts;\n      b = Math.round((i / this._physijs.xpts) - ((i % this._physijs.xpts) / this._physijs.xpts));\n      points[i] = geometry.vertices[a + ((this._physijs.ypts - b - 1) * this._physijs.ypts)].z;\n\n      //points[i] = geometry.vertices[i];\n    }\n\n    this._physijs.points = points;\n  };\n  Physijs.HeightfieldMesh.prototype = new Physijs.Mesh;\n  Physijs.HeightfieldMesh.prototype.constructor = Physijs.HeightfieldMesh;\n\n  // Physijs.BoxMesh\n  Physijs.BoxMesh = function(geometry, material, mass) {\n    var width, height, depth;\n\n    Physijs.Mesh.call(this, geometry, material, mass);\n\n    if (!geometry.boundingBox) {\n      geometry.computeBoundingBox();\n    }\n\n    width = geometry.boundingBox.max.x - geometry.boundingBox.min.x;\n    height = geometry.boundingBox.max.y - geometry.boundingBox.min.y;\n    depth = geometry.boundingBox.max.z - geometry.boundingBox.min.z;\n\n    this._physijs.type = 'box';\n    this._physijs.width = width;\n    this._physijs.height = height;\n    this._physijs.depth = depth;\n    this._physijs.mass = (typeof mass === 'undefined') ? width * height * depth : mass;\n  };\n  Physijs.BoxMesh.prototype = new Physijs.Mesh;\n  Physijs.BoxMesh.prototype.constructor = Physijs.BoxMesh;\n\n\n  // Physijs.SphereMesh\n  Physijs.SphereMesh = function(geometry, material, mass) {\n    Physijs.Mesh.call(this, geometry, material, mass);\n\n    if (!geometry.boundingSphere) {\n      geometry.computeBoundingSphere();\n    }\n\n    this._physijs.type = 'sphere';\n    this._physijs.radius = geometry.boundingSphere.radius;\n    this._physijs.mass = (typeof mass === 'undefined') ? (4 / 3) * Math.PI * Math.pow(this._physijs.radius, 3) : mass;\n  };\n  Physijs.SphereMesh.prototype = new Physijs.Mesh;\n  Physijs.SphereMesh.prototype.constructor = Physijs.SphereMesh;\n\n\n  // Physijs.CylinderMesh\n  Physijs.CylinderMesh = function(geometry, material, mass) {\n    var width, height, depth;\n\n    Physijs.Mesh.call(this, geometry, material, mass);\n\n    if (!geometry.boundingBox) {\n      geometry.computeBoundingBox();\n    }\n\n    width = geometry.boundingBox.max.x - geometry.boundingBox.min.x;\n    height = geometry.boundingBox.max.y - geometry.boundingBox.min.y;\n    depth = geometry.boundingBox.max.z - geometry.boundingBox.min.z;\n\n    this._physijs.type = 'cylinder';\n    this._physijs.width = width;\n    this._physijs.height = height;\n    this._physijs.depth = depth;\n    this._physijs.mass = (typeof mass === 'undefined') ? width * height * depth : mass;\n  };\n  Physijs.CylinderMesh.prototype = new Physijs.Mesh;\n  Physijs.CylinderMesh.prototype.constructor = Physijs.CylinderMesh;\n\n\n  // Physijs.CapsuleMesh\n  Physijs.CapsuleMesh = function(geometry, material, mass) {\n    var width, height, depth;\n\n    Physijs.Mesh.call(this, geometry, material, mass);\n\n    if (!geometry.boundingBox) {\n      geometry.computeBoundingBox();\n    }\n\n    width = geometry.boundingBox.max.x - geometry.boundingBox.min.x;\n    height = geometry.boundingBox.max.y - geometry.boundingBox.min.y;\n    depth = geometry.boundingBox.max.z - geometry.boundingBox.min.z;\n\n    this._physijs.type = 'capsule';\n    this._physijs.radius = Math.max(width / 2, depth / 2);\n    this._physijs.height = height;\n    this._physijs.mass = (typeof mass === 'undefined') ? width * height * depth : mass;\n  };\n  Physijs.CapsuleMesh.prototype = new Physijs.Mesh;\n  Physijs.CapsuleMesh.prototype.constructor = Physijs.CapsuleMesh;\n\n\n  // Physijs.ConeMesh\n  Physijs.ConeMesh = function(geometry, material, mass) {\n    var width, height, depth;\n\n    Physijs.Mesh.call(this, geometry, material, mass);\n\n    if (!geometry.boundingBox) {\n      geometry.computeBoundingBox();\n    }\n\n    width = geometry.boundingBox.max.x - geometry.boundingBox.min.x;\n    height = geometry.boundingBox.max.y - geometry.boundingBox.min.y;\n\n    this._physijs.type = 'cone';\n    this._physijs.radius = width / 2;\n    this._physijs.height = height;\n    this._physijs.mass = (typeof mass === 'undefined') ? width * height : mass;\n  };\n  Physijs.ConeMesh.prototype = new Physijs.Mesh;\n  Physijs.ConeMesh.prototype.constructor = Physijs.ConeMesh;\n\n\n  // Physijs.ConcaveMesh\n  Physijs.ConcaveMesh = function(geometry, material, mass) {\n    var i,\n      width, height, depth,\n      vertices, face, triangles = [];\n\n    Physijs.Mesh.call(this, geometry, material, mass);\n\n    if (!geometry.boundingBox) {\n      geometry.computeBoundingBox();\n    }\n\n    vertices = geometry.vertices;\n\n    for (i = 0; i < geometry.faces.length; i++) {\n      face = geometry.faces[i];\n      if (face instanceof THREE.Face3) {\n\n        triangles.push([{\n          x: vertices[face.a].x,\n          y: vertices[face.a].y,\n          z: vertices[face.a].z\n        }, {\n          x: vertices[face.b].x,\n          y: vertices[face.b].y,\n          z: vertices[face.b].z\n        }, {\n          x: vertices[face.c].x,\n          y: vertices[face.c].y,\n          z: vertices[face.c].z\n        }]);\n\n      }\n      else if (face instanceof THREE.Face4) {\n\n        triangles.push([{\n          x: vertices[face.a].x,\n          y: vertices[face.a].y,\n          z: vertices[face.a].z\n        }, {\n          x: vertices[face.b].x,\n          y: vertices[face.b].y,\n          z: vertices[face.b].z\n        }, {\n          x: vertices[face.d].x,\n          y: vertices[face.d].y,\n          z: vertices[face.d].z\n        }]);\n        triangles.push([{\n          x: vertices[face.b].x,\n          y: vertices[face.b].y,\n          z: vertices[face.b].z\n        }, {\n          x: vertices[face.c].x,\n          y: vertices[face.c].y,\n          z: vertices[face.c].z\n        }, {\n          x: vertices[face.d].x,\n          y: vertices[face.d].y,\n          z: vertices[face.d].z\n        }]);\n\n      }\n    }\n\n    width = geometry.boundingBox.max.x - geometry.boundingBox.min.x;\n    height = geometry.boundingBox.max.y - geometry.boundingBox.min.y;\n    depth = geometry.boundingBox.max.z - geometry.boundingBox.min.z;\n\n    this._physijs.type = 'concave';\n    this._physijs.triangles = triangles;\n    this._physijs.mass = (typeof mass === 'undefined') ? width * height * depth : mass;\n  };\n  Physijs.ConcaveMesh.prototype = new Physijs.Mesh;\n  Physijs.ConcaveMesh.prototype.constructor = Physijs.ConcaveMesh;\n\n\n  // Physijs.ConvexMesh\n  Physijs.ConvexMesh = function(geometry, material, mass) {\n    var i,\n      width, height, depth,\n      points = [];\n\n    Physijs.Mesh.call(this, geometry, material, mass);\n\n    if (!geometry.boundingBox) {\n      geometry.computeBoundingBox();\n    }\n\n    for (i = 0; i < geometry.vertices.length; i++) {\n      points.push({\n        x: geometry.vertices[i].x,\n        y: geometry.vertices[i].y,\n        z: geometry.vertices[i].z\n      });\n    }\n\n\n    width = geometry.boundingBox.max.x - geometry.boundingBox.min.x;\n    height = geometry.boundingBox.max.y - geometry.boundingBox.min.y;\n    depth = geometry.boundingBox.max.z - geometry.boundingBox.min.z;\n\n    this._physijs.type = 'convex';\n    this._physijs.points = points;\n    this._physijs.mass = (typeof mass === 'undefined') ? width * height * depth : mass;\n  };\n  Physijs.ConvexMesh.prototype = new Physijs.Mesh;\n  Physijs.ConvexMesh.prototype.constructor = Physijs.ConvexMesh;\n\n\n  // Physijs.Vehicle\n  Physijs.Vehicle = function(mesh, tuning) {\n    tuning = tuning || new Physijs.VehicleTuning;\n    this.mesh = mesh;\n    this.wheels = [];\n    this._physijs = {\n      id: getObjectId(),\n      rigidBody: mesh._physijs.id,\n      suspension_stiffness: tuning.suspension_stiffness,\n      suspension_compression: tuning.suspension_compression,\n      suspension_damping: tuning.suspension_damping,\n      max_suspension_travel: tuning.max_suspension_travel,\n      friction_slip: tuning.friction_slip,\n      max_suspension_force: tuning.max_suspension_force\n    };\n  };\n  Physijs.Vehicle.prototype.addWheel = function(wheel_geometry, wheel_material, connection_point, wheel_direction, wheel_axle, suspension_rest_length, wheel_radius, is_front_wheel, tuning) {\n    var wheel = new THREE.Mesh(wheel_geometry, wheel_material);\n    wheel.castShadow = wheel.receiveShadow = true;\n    wheel.position.copy(wheel_direction).multiplyScalar(suspension_rest_length / 100).add(connection_point);\n    this.world.add(wheel);\n    this.wheels.push(wheel);\n\n    this.world.execute('addWheel', {\n      id: this._physijs.id,\n      connection_point: {\n        x: connection_point.x,\n        y: connection_point.y,\n        z: connection_point.z\n      },\n      wheel_direction: {\n        x: wheel_direction.x,\n        y: wheel_direction.y,\n        z: wheel_direction.z\n      },\n      wheel_axle: {\n        x: wheel_axle.x,\n        y: wheel_axle.y,\n        z: wheel_axle.z\n      },\n      suspension_rest_length: suspension_rest_length,\n      wheel_radius: wheel_radius,\n      is_front_wheel: is_front_wheel,\n      tuning: tuning\n    });\n  };\n  Physijs.Vehicle.prototype.setSteering = function(amount, wheel) {\n    if (wheel !== undefined && this.wheels[wheel] !== undefined) {\n      this.world.execute('setSteering', {\n        id: this._physijs.id,\n        wheel: wheel,\n        steering: amount\n      });\n    }\n    else if (this.wheels.length > 0) {\n      for (var i = 0; i < this.wheels.length; i++) {\n        this.world.execute('setSteering', {\n          id: this._physijs.id,\n          wheel: i,\n          steering: amount\n        });\n      }\n    }\n  };\n  Physijs.Vehicle.prototype.setBrake = function(amount, wheel) {\n    if (wheel !== undefined && this.wheels[wheel] !== undefined) {\n      this.world.execute('setBrake', {\n        id: this._physijs.id,\n        wheel: wheel,\n        brake: amount\n      });\n    }\n    else if (this.wheels.length > 0) {\n      for (var i = 0; i < this.wheels.length; i++) {\n        this.world.execute('setBrake', {\n          id: this._physijs.id,\n          wheel: i,\n          brake: amount\n        });\n      }\n    }\n  };\n  Physijs.Vehicle.prototype.applyEngineForce = function(amount, wheel) {\n    if (wheel !== undefined && this.wheels[wheel] !== undefined) {\n      this.world.execute('applyEngineForce', {\n        id: this._physijs.id,\n        wheel: wheel,\n        force: amount\n      });\n    }\n    else if (this.wheels.length > 0) {\n      for (var i = 0; i < this.wheels.length; i++) {\n        this.world.execute('applyEngineForce', {\n          id: this._physijs.id,\n          wheel: i,\n          force: amount\n        });\n      }\n    }\n  };\n\n  // Physijs.VehicleTuning\n  Physijs.VehicleTuning = function(suspension_stiffness, suspension_compression, suspension_damping, max_suspension_travel, friction_slip, max_suspension_force) {\n    this.suspension_stiffness = suspension_stiffness !== undefined ? suspension_stiffness : 5.88;\n    this.suspension_compression = suspension_compression !== undefined ? suspension_compression : 0.83;\n    this.suspension_damping = suspension_damping !== undefined ? suspension_damping : 0.88;\n    this.max_suspension_travel = max_suspension_travel !== undefined ? max_suspension_travel : 500;\n    this.friction_slip = friction_slip !== undefined ? friction_slip : 10.5;\n    this.max_suspension_force = max_suspension_force !== undefined ? max_suspension_force : 6000;\n  };\n\n  return Physijs;\n}\n\n","/** @preserve http://github.com/easeway/js-class */\n\n// Class Definition using ECMA5 prototype chain\n\nfunction inherit(dest, src, noParent) {\n    while (src && src !== Object.prototype) {\n        Object.getOwnPropertyNames(src).forEach(function (name) {\n            if (name != '.class' && !dest.hasOwnProperty(name)) {\n                var desc = Object.getOwnPropertyDescriptor(src, name);\n                Object.defineProperty(dest, name, desc);\n            }\n        });\n        if (noParent) {\n            break;\n        }\n        src = src.__proto__;\n    }\n    return dest;\n}\n\nvar Class = function (base, proto, options) {\n    if (typeof(base) != 'function') {\n        options = proto;\n        proto = base;\n        base = Object;\n    }\n    if (!proto) {\n        proto = {};\n    }\n    if (!options) {\n        options = {};\n    }\n    \n    var meta = {\n        name: options.name,\n        base: base,\n        implements: []\n    }\n    var classProto = Class.clone(proto);\n    if (options.implements) {\n        (Array.isArray(options.implements) ? options.implements : [options.implements])\n            .forEach(function (implementedType) {\n                if (typeof(implementedType) == 'function' && implementedType.prototype) {\n                    meta.implements.push(implementedType);\n                    Class.extend(classProto, implementedType.prototype);\n                }\n            });\n    }\n    classProto.__proto__ = base.prototype;\n    var theClass = function () {\n        if (typeof(this.constructor) == 'function') {\n            this.constructor.apply(this, arguments);\n        }\n    };\n    meta.type = theClass;\n    theClass.prototype = classProto;\n    Object.defineProperty(theClass, '.class.meta', { value: meta, enumerable: false, configurable: false, writable: false });\n    Object.defineProperty(classProto, '.class', { value: theClass, enumerable: false, configurable: false, writable: false });\n    if (options.statics) {\n        Class.extend(theClass, options.statics);\n    }\n    return theClass;\n};\n\nClass.extend = inherit;\n\nClass.clone = function (object) {\n    return inherit({}, object);\n};\n\nfunction findType(meta, type) {\n    while (meta) {\n        if (meta.type.prototype === type.prototype) {\n            return true;\n        }\n        for (var i in meta.implements) {\n            var implType = meta.implements[i];\n            var implMeta = implType['.class.meta'];\n            if (implMeta) {\n                if (findType(implMeta, type)) {\n                    return true;\n                }\n            } else {\n                for (var proto = implType.prototype; proto; proto = proto.__proto__) {\n                    if (proto === type.prototype) {\n                        return true;\n                    }\n                }\n            }\n        }\n        meta = meta.base ? meta.base['.class.meta'] : undefined;\n    }\n    return false;\n}\n\nvar Checker = Class({\n    constructor: function (object) {\n        this.object = object;\n    },\n    \n    typeOf: function (type) {\n        if (this.object instanceof type) {\n            return true;\n        }\n        var meta = Class.typeInfo(this.object);\n        return meta && findType(meta, type);\n    }\n});\n\n// aliases\nChecker.prototype.a = Checker.prototype.typeOf;\nChecker.prototype.an = Checker.prototype.typeOf;\n\nClass.is = function (object) {\n    return new Checker(object);\n};\n\nClass.typeInfo = function (object) {\n    var theClass = object.__proto__['.class'];\n    return theClass ? theClass['.class.meta'] : undefined;\n};\n\nClass.VERSION = [0, 0, 2];\n\nif (module) {\n    module.exports = Class;\n} else {\n    global.Class = Class;   // for browser\n}","/*!\n *  howler.js v1.1.28\n *  howlerjs.com\n *\n *  (c) 2013-2015, James Simpson of GoldFire Studios\n *  goldfirestudios.com\n *\n *  MIT License\n */\n\n(function() {\n  // setup\n  var cache = {};\n\n  // setup the audio context\n  var ctx = null,\n    usingWebAudio = true,\n    noAudio = false;\n  try {\n    if (typeof AudioContext !== 'undefined') {\n      ctx = new AudioContext();\n    } else if (typeof webkitAudioContext !== 'undefined') {\n      ctx = new webkitAudioContext();\n    } else {\n      usingWebAudio = false;\n    }\n  } catch(e) {\n    usingWebAudio = false;\n  }\n\n  if (!usingWebAudio) {\n    if (typeof Audio !== 'undefined') {\n      try {\n        new Audio();\n      } catch(e) {\n        noAudio = true;\n      }\n    } else {\n      noAudio = true;\n    }\n  }\n\n  // create a master gain node\n  if (usingWebAudio) {\n    var masterGain = (typeof ctx.createGain === 'undefined') ? ctx.createGainNode() : ctx.createGain();\n    masterGain.gain.value = 1;\n    masterGain.connect(ctx.destination);\n  }\n\n  // create global controller\n  var HowlerGlobal = function(codecs) {\n    this._volume = 1;\n    this._muted = false;\n    this.usingWebAudio = usingWebAudio;\n    this.ctx = ctx;\n    this.noAudio = noAudio;\n    this._howls = [];\n    this._codecs = codecs;\n    this.iOSAutoEnable = true;\n  };\n  HowlerGlobal.prototype = {\n    /**\n     * Get/set the global volume for all sounds.\n     * @param  {Float} vol Volume from 0.0 to 1.0.\n     * @return {Howler/Float}     Returns self or current volume.\n     */\n    volume: function(vol) {\n      var self = this;\n\n      // make sure volume is a number\n      vol = parseFloat(vol);\n\n      if (vol >= 0 && vol <= 1) {\n        self._volume = vol;\n\n        if (usingWebAudio) {\n          masterGain.gain.value = vol;\n        }\n\n        // loop through cache and change volume of all nodes that are using HTML5 Audio\n        for (var key in self._howls) {\n          if (self._howls.hasOwnProperty(key) && self._howls[key]._webAudio === false) {\n            // loop through the audio nodes\n            for (var i=0; i<self._howls[key]._audioNode.length; i++) {\n              self._howls[key]._audioNode[i].volume = self._howls[key]._volume * self._volume;\n            }\n          }\n        }\n\n        return self;\n      }\n\n      // return the current global volume\n      return (usingWebAudio) ? masterGain.gain.value : self._volume;\n    },\n\n    /**\n     * Mute all sounds.\n     * @return {Howler}\n     */\n    mute: function() {\n      this._setMuted(true);\n\n      return this;\n    },\n\n    /**\n     * Unmute all sounds.\n     * @return {Howler}\n     */\n    unmute: function() {\n      this._setMuted(false);\n\n      return this;\n    },\n\n    /**\n     * Handle muting and unmuting globally.\n     * @param  {Boolean} muted Is muted or not.\n     */\n    _setMuted: function(muted) {\n      var self = this;\n\n      self._muted = muted;\n\n      if (usingWebAudio) {\n        masterGain.gain.value = muted ? 0 : self._volume;\n      }\n\n      for (var key in self._howls) {\n        if (self._howls.hasOwnProperty(key) && self._howls[key]._webAudio === false) {\n          // loop through the audio nodes\n          for (var i=0; i<self._howls[key]._audioNode.length; i++) {\n            self._howls[key]._audioNode[i].muted = muted;\n          }\n        }\n      }\n    },\n\n    /**\n     * Check for codec support.\n     * @param  {String} ext Audio file extention.\n     * @return {Boolean}\n     */\n    codecs: function(ext) {\n      return this._codecs[ext];\n    },\n\n    /**\n     * iOS will only allow audio to be played after a user interaction.\n     * Attempt to automatically unlock audio on the first user interaction.\n     * Concept from: http://paulbakaus.com/tutorials/html5/web-audio-on-ios/\n     * @return {Howler}\n     */\n    _enableiOSAudio: function() {\n      var self = this;\n\n      // only run this on iOS if audio isn't already eanbled\n      if (ctx && (self._iOSEnabled || !/iPhone|iPad|iPod/i.test(navigator.userAgent))) {\n        return;\n      }\n\n      self._iOSEnabled = false;\n\n      // call this method on touch start to create and play a buffer,\n      // then check if the audio actually played to determine if\n      // audio has now been unlocked on iOS\n      var unlock = function() {\n        // create an empty buffer\n        var buffer = ctx.createBuffer(1, 1, 22050);\n        var source = ctx.createBufferSource();\n        source.buffer = buffer;\n        source.connect(ctx.destination);\n\n        // play the empty buffer\n        if (typeof source.start === 'undefined') {\n          source.noteOn(0);\n        } else {\n          source.start(0);\n        }\n\n        // setup a timeout to check that we are unlocked on the next event loop\n        setTimeout(function() {\n          if ((source.playbackState === source.PLAYING_STATE || source.playbackState === source.FINISHED_STATE)) {\n            // update the unlocked state and prevent this check from happening again\n            self._iOSEnabled = true;\n            self.iOSAutoEnable = false;\n\n            // remove the touch start listener\n            window.removeEventListener('touchend', unlock, false);\n          }\n        }, 0);\n      };\n\n      // setup a touch start listener to attempt an unlock in\n      window.addEventListener('touchend', unlock, false);\n\n      return self;\n    }\n  };\n\n  // check for browser codec support\n  var audioTest = null;\n  var codecs = {};\n  if (!noAudio) {\n    audioTest = new Audio();\n    codecs = {\n      mp3: !!audioTest.canPlayType('audio/mpeg;').replace(/^no$/, ''),\n      opus: !!audioTest.canPlayType('audio/ogg; codecs=\"opus\"').replace(/^no$/, ''),\n      ogg: !!audioTest.canPlayType('audio/ogg; codecs=\"vorbis\"').replace(/^no$/, ''),\n      wav: !!audioTest.canPlayType('audio/wav; codecs=\"1\"').replace(/^no$/, ''),\n      aac: !!audioTest.canPlayType('audio/aac;').replace(/^no$/, ''),\n      m4a: !!(audioTest.canPlayType('audio/x-m4a;') || audioTest.canPlayType('audio/m4a;') || audioTest.canPlayType('audio/aac;')).replace(/^no$/, ''),\n      mp4: !!(audioTest.canPlayType('audio/x-mp4;') || audioTest.canPlayType('audio/mp4;') || audioTest.canPlayType('audio/aac;')).replace(/^no$/, ''),\n      weba: !!audioTest.canPlayType('audio/webm; codecs=\"vorbis\"').replace(/^no$/, '')\n    };\n  }\n\n  // allow access to the global audio controls\n  var Howler = new HowlerGlobal(codecs);\n\n  // setup the audio object\n  var Howl = function(o) {\n    var self = this;\n\n    // setup the defaults\n    self._autoplay = o.autoplay || false;\n    self._buffer = o.buffer || false;\n    self._duration = o.duration || 0;\n    self._format = o.format || null;\n    self._loop = o.loop || false;\n    self._loaded = false;\n    self._sprite = o.sprite || {};\n    self._src = o.src || '';\n    self._pos3d = o.pos3d || [0, 0, -0.5];\n    self._volume = o.volume !== undefined ? o.volume : 1;\n    self._urls = o.urls || [];\n    self._rate = o.rate || 1;\n\n    // allow forcing of a specific panningModel ('equalpower' or 'HRTF'),\n    // if none is specified, defaults to 'equalpower' and switches to 'HRTF'\n    // if 3d sound is used\n    self._model = o.model || null;\n\n    // setup event functions\n    self._onload = [o.onload || function() {}];\n    self._onloaderror = [o.onloaderror || function() {}];\n    self._onend = [o.onend || function() {}];\n    self._onpause = [o.onpause || function() {}];\n    self._onplay = [o.onplay || function() {}];\n\n    self._onendTimer = [];\n\n    // Web Audio or HTML5 Audio?\n    self._webAudio = usingWebAudio && !self._buffer;\n\n    // check if we need to fall back to HTML5 Audio\n    self._audioNode = [];\n    if (self._webAudio) {\n      self._setupAudioNode();\n    }\n\n    // automatically try to enable audio on iOS\n    if (typeof ctx !== 'undefined' && ctx && Howler.iOSAutoEnable) {\n      Howler._enableiOSAudio();\n    }\n\n    // add this to an array of Howl's to allow global control\n    Howler._howls.push(self);\n\n    // load the track\n    self.load();\n  };\n\n  // setup all of the methods\n  Howl.prototype = {\n    /**\n     * Load an audio file.\n     * @return {Howl}\n     */\n    load: function() {\n      var self = this,\n        url = null;\n\n      // if no audio is available, quit immediately\n      if (noAudio) {\n        self.on('loaderror');\n        return;\n      }\n\n      // loop through source URLs and pick the first one that is compatible\n      for (var i=0; i<self._urls.length; i++) {\n        var ext, urlItem;\n\n        if (self._format) {\n          // use specified audio format if available\n          ext = self._format;\n        } else {\n          // figure out the filetype (whether an extension or base64 data)\n          urlItem = self._urls[i];\n          ext = /^data:audio\\/([^;,]+);/i.exec(urlItem);\n          if (!ext) {\n            ext = /\\.([^.]+)$/.exec(urlItem.split('?', 1)[0]);\n          }\n\n          if (ext) {\n            ext = ext[1].toLowerCase();\n          } else {\n            self.on('loaderror');\n            return;\n          }\n        }\n\n        if (codecs[ext]) {\n          url = self._urls[i];\n          break;\n        }\n      }\n\n      if (!url) {\n        self.on('loaderror');\n        return;\n      }\n\n      self._src = url;\n\n      if (self._webAudio) {\n        loadBuffer(self, url);\n      } else {\n        var newNode = new Audio();\n\n        // listen for errors with HTML5 audio (http://dev.w3.org/html5/spec-author-view/spec.html#mediaerror)\n        newNode.addEventListener('error', function () {\n          if (newNode.error && newNode.error.code === 4) {\n            HowlerGlobal.noAudio = true;\n          }\n\n          self.on('loaderror', {type: newNode.error ? newNode.error.code : 0});\n        }, false);\n\n        self._audioNode.push(newNode);\n\n        // setup the new audio node\n        newNode.src = url;\n        newNode._pos = 0;\n        newNode.preload = 'auto';\n        newNode.volume = (Howler._muted) ? 0 : self._volume * Howler.volume();\n\n        // setup the event listener to start playing the sound\n        // as soon as it has buffered enough\n        var listener = function() {\n          // round up the duration when using HTML5 Audio to account for the lower precision\n          self._duration = Math.ceil(newNode.duration * 10) / 10;\n\n          // setup a sprite if none is defined\n          if (Object.getOwnPropertyNames(self._sprite).length === 0) {\n            self._sprite = {_default: [0, self._duration * 1000]};\n          }\n\n          if (!self._loaded) {\n            self._loaded = true;\n            self.on('load');\n          }\n\n          if (self._autoplay) {\n            self.play();\n          }\n\n          // clear the event listener\n          newNode.removeEventListener('canplaythrough', listener, false);\n        };\n        newNode.addEventListener('canplaythrough', listener, false);\n        newNode.load();\n      }\n\n      return self;\n    },\n\n    /**\n     * Get/set the URLs to be pulled from to play in this source.\n     * @param  {Array} urls  Arry of URLs to load from\n     * @return {Howl}        Returns self or the current URLs\n     */\n    urls: function(urls) {\n      var self = this;\n\n      if (urls) {\n        self.stop();\n        self._urls = (typeof urls === 'string') ? [urls] : urls;\n        self._loaded = false;\n        self.load();\n\n        return self;\n      } else {\n        return self._urls;\n      }\n    },\n\n    /**\n     * Play a sound from the current time (0 by default).\n     * @param  {String}   sprite   (optional) Plays from the specified position in the sound sprite definition.\n     * @param  {Function} callback (optional) Returns the unique playback id for this sound instance.\n     * @return {Howl}\n     */\n    play: function(sprite, callback) {\n      var self = this;\n\n      // if no sprite was passed but a callback was, update the variables\n      if (typeof sprite === 'function') {\n        callback = sprite;\n      }\n\n      // use the default sprite if none is passed\n      if (!sprite || typeof sprite === 'function') {\n        sprite = '_default';\n      }\n\n      // if the sound hasn't been loaded, add it to the event queue\n      if (!self._loaded) {\n        self.on('load', function() {\n          self.play(sprite, callback);\n        });\n\n        return self;\n      }\n\n      // if the sprite doesn't exist, play nothing\n      if (!self._sprite[sprite]) {\n        if (typeof callback === 'function') callback();\n        return self;\n      }\n\n      // get the node to playback\n      self._inactiveNode(function(node) {\n        // persist the sprite being played\n        node._sprite = sprite;\n\n        // determine where to start playing from\n        var pos = (node._pos > 0) ? node._pos : self._sprite[sprite][0] / 1000;\n\n        // determine how long to play for\n        var duration = 0;\n        if (self._webAudio) {\n          duration = self._sprite[sprite][1] / 1000 - node._pos;\n          if (node._pos > 0) {\n            pos = self._sprite[sprite][0] / 1000 + pos;\n          }\n        } else {\n          duration = self._sprite[sprite][1] / 1000 - (pos - self._sprite[sprite][0] / 1000);\n        }\n\n        // determine if this sound should be looped\n        var loop = !!(self._loop || self._sprite[sprite][2]);\n\n        // set timer to fire the 'onend' event\n        var soundId = (typeof callback === 'string') ? callback : Math.round(Date.now() * Math.random()) + '',\n          timerId;\n        (function() {\n          var data = {\n            id: soundId,\n            sprite: sprite,\n            loop: loop\n          };\n          timerId = setTimeout(function() {\n            // if looping, restart the track\n            if (!self._webAudio && loop) {\n              self.stop(data.id).play(sprite, data.id);\n            }\n\n            // set web audio node to paused at end\n            if (self._webAudio && !loop) {\n              self._nodeById(data.id).paused = true;\n              self._nodeById(data.id)._pos = 0;\n\n              // clear the end timer\n              self._clearEndTimer(data.id);\n            }\n\n            // end the track if it is HTML audio and a sprite\n            if (!self._webAudio && !loop) {\n              self.stop(data.id);\n            }\n\n            // fire ended event\n            self.on('end', soundId);\n          }, duration * 1000);\n\n          // store the reference to the timer\n          self._onendTimer.push({timer: timerId, id: data.id});\n        })();\n\n        if (self._webAudio) {\n          var loopStart = self._sprite[sprite][0] / 1000,\n            loopEnd = self._sprite[sprite][1] / 1000;\n\n          // set the play id to this node and load into context\n          node.id = soundId;\n          node.paused = false;\n          refreshBuffer(self, [loop, loopStart, loopEnd], soundId);\n          self._playStart = ctx.currentTime;\n          node.gain.value = self._volume;\n\n          if (typeof node.bufferSource.start === 'undefined') {\n            loop ? node.bufferSource.noteGrainOn(0, pos, 86400) : node.bufferSource.noteGrainOn(0, pos, duration);\n          } else {\n            loop ? node.bufferSource.start(0, pos, 86400) : node.bufferSource.start(0, pos, duration);\n          }\n        } else {\n          if (node.readyState === 4 || !node.readyState && navigator.isCocoonJS) {\n            node.readyState = 4;\n            node.id = soundId;\n            node.currentTime = pos;\n            node.muted = Howler._muted || node.muted;\n            node.volume = self._volume * Howler.volume();\n            setTimeout(function() { node.play(); }, 0);\n          } else {\n            self._clearEndTimer(soundId);\n\n            (function(){\n              var sound = self,\n                playSprite = sprite,\n                fn = callback,\n                newNode = node;\n              var listener = function() {\n                sound.play(playSprite, fn);\n\n                // clear the event listener\n                newNode.removeEventListener('canplaythrough', listener, false);\n              };\n              newNode.addEventListener('canplaythrough', listener, false);\n            })();\n\n            return self;\n          }\n        }\n\n        // fire the play event and send the soundId back in the callback\n        self.on('play');\n        if (typeof callback === 'function') callback(soundId);\n\n        return self;\n      });\n\n      return self;\n    },\n\n    /**\n     * Pause playback and save the current position.\n     * @param {String} id (optional) The play instance ID.\n     * @return {Howl}\n     */\n    pause: function(id) {\n      var self = this;\n\n      // if the sound hasn't been loaded, add it to the event queue\n      if (!self._loaded) {\n        self.on('play', function() {\n          self.pause(id);\n        });\n\n        return self;\n      }\n\n      // clear 'onend' timer\n      self._clearEndTimer(id);\n\n      var activeNode = (id) ? self._nodeById(id) : self._activeNode();\n      if (activeNode) {\n        activeNode._pos = self.pos(null, id);\n\n        if (self._webAudio) {\n          // make sure the sound has been created\n          if (!activeNode.bufferSource || activeNode.paused) {\n            return self;\n          }\n\n          activeNode.paused = true;\n          if (typeof activeNode.bufferSource.stop === 'undefined') {\n            activeNode.bufferSource.noteOff(0);\n          } else {\n            activeNode.bufferSource.stop(0);\n          }\n        } else {\n          activeNode.pause();\n        }\n      }\n\n      self.on('pause');\n\n      return self;\n    },\n\n    /**\n     * Stop playback and reset to start.\n     * @param  {String} id  (optional) The play instance ID.\n     * @return {Howl}\n     */\n    stop: function(id) {\n      var self = this;\n\n      // if the sound hasn't been loaded, add it to the event queue\n      if (!self._loaded) {\n        self.on('play', function() {\n          self.stop(id);\n        });\n\n        return self;\n      }\n\n      // clear 'onend' timer\n      self._clearEndTimer(id);\n\n      var activeNode = (id) ? self._nodeById(id) : self._activeNode();\n      if (activeNode) {\n        activeNode._pos = 0;\n\n        if (self._webAudio) {\n          // make sure the sound has been created\n          if (!activeNode.bufferSource || activeNode.paused) {\n            return self;\n          }\n\n          activeNode.paused = true;\n\n          if (typeof activeNode.bufferSource.stop === 'undefined') {\n            activeNode.bufferSource.noteOff(0);\n          } else {\n            activeNode.bufferSource.stop(0);\n          }\n        } else if (!isNaN(activeNode.duration)) {\n          activeNode.pause();\n          activeNode.currentTime = 0;\n        }\n      }\n\n      return self;\n    },\n\n    /**\n     * Mute this sound.\n     * @param  {String} id (optional) The play instance ID.\n     * @return {Howl}\n     */\n    mute: function(id) {\n      var self = this;\n\n      // if the sound hasn't been loaded, add it to the event queue\n      if (!self._loaded) {\n        self.on('play', function() {\n          self.mute(id);\n        });\n\n        return self;\n      }\n\n      var activeNode = (id) ? self._nodeById(id) : self._activeNode();\n      if (activeNode) {\n        if (self._webAudio) {\n          activeNode.gain.value = 0;\n        } else {\n          activeNode.muted = true;\n        }\n      }\n\n      return self;\n    },\n\n    /**\n     * Unmute this sound.\n     * @param  {String} id (optional) The play instance ID.\n     * @return {Howl}\n     */\n    unmute: function(id) {\n      var self = this;\n\n      // if the sound hasn't been loaded, add it to the event queue\n      if (!self._loaded) {\n        self.on('play', function() {\n          self.unmute(id);\n        });\n\n        return self;\n      }\n\n      var activeNode = (id) ? self._nodeById(id) : self._activeNode();\n      if (activeNode) {\n        if (self._webAudio) {\n          activeNode.gain.value = self._volume;\n        } else {\n          activeNode.muted = false;\n        }\n      }\n\n      return self;\n    },\n\n    /**\n     * Get/set volume of this sound.\n     * @param  {Float}  vol Volume from 0.0 to 1.0.\n     * @param  {String} id  (optional) The play instance ID.\n     * @return {Howl/Float}     Returns self or current volume.\n     */\n    volume: function(vol, id) {\n      var self = this;\n\n      // make sure volume is a number\n      vol = parseFloat(vol);\n\n      if (vol >= 0 && vol <= 1) {\n        self._volume = vol;\n\n        // if the sound hasn't been loaded, add it to the event queue\n        if (!self._loaded) {\n          self.on('play', function() {\n            self.volume(vol, id);\n          });\n\n          return self;\n        }\n\n        var activeNode = (id) ? self._nodeById(id) : self._activeNode();\n        if (activeNode) {\n          if (self._webAudio) {\n            activeNode.gain.value = vol;\n          } else {\n            activeNode.volume = vol * Howler.volume();\n          }\n        }\n\n        return self;\n      } else {\n        return self._volume;\n      }\n    },\n\n    /**\n     * Get/set whether to loop the sound.\n     * @param  {Boolean} loop To loop or not to loop, that is the question.\n     * @return {Howl/Boolean}      Returns self or current looping value.\n     */\n    loop: function(loop) {\n      var self = this;\n\n      if (typeof loop === 'boolean') {\n        self._loop = loop;\n\n        return self;\n      } else {\n        return self._loop;\n      }\n    },\n\n    /**\n     * Get/set sound sprite definition.\n     * @param  {Object} sprite Example: {spriteName: [offset, duration, loop]}\n     *                @param {Integer} offset   Where to begin playback in milliseconds\n     *                @param {Integer} duration How long to play in milliseconds\n     *                @param {Boolean} loop     (optional) Set true to loop this sprite\n     * @return {Howl}        Returns current sprite sheet or self.\n     */\n    sprite: function(sprite) {\n      var self = this;\n\n      if (typeof sprite === 'object') {\n        self._sprite = sprite;\n\n        return self;\n      } else {\n        return self._sprite;\n      }\n    },\n\n    /**\n     * Get/set the position of playback.\n     * @param  {Float}  pos The position to move current playback to.\n     * @param  {String} id  (optional) The play instance ID.\n     * @return {Howl/Float}      Returns self or current playback position.\n     */\n    pos: function(pos, id) {\n      var self = this;\n\n      // if the sound hasn't been loaded, add it to the event queue\n      if (!self._loaded) {\n        self.on('load', function() {\n          self.pos(pos);\n        });\n\n        return typeof pos === 'number' ? self : self._pos || 0;\n      }\n\n      // make sure we are dealing with a number for pos\n      pos = parseFloat(pos);\n\n      var activeNode = (id) ? self._nodeById(id) : self._activeNode();\n      if (activeNode) {\n        if (pos >= 0) {\n          self.pause(id);\n          activeNode._pos = pos;\n          self.play(activeNode._sprite, id);\n\n          return self;\n        } else {\n          return self._webAudio ? activeNode._pos + (ctx.currentTime - self._playStart) : activeNode.currentTime;\n        }\n      } else if (pos >= 0) {\n        return self;\n      } else {\n        // find the first inactive node to return the pos for\n        for (var i=0; i<self._audioNode.length; i++) {\n          if (self._audioNode[i].paused && self._audioNode[i].readyState === 4) {\n            return (self._webAudio) ? self._audioNode[i]._pos : self._audioNode[i].currentTime;\n          }\n        }\n      }\n    },\n\n    /**\n     * Get/set the 3D position of the audio source.\n     * The most common usage is to set the 'x' position\n     * to affect the left/right ear panning. Setting any value higher than\n     * 1.0 will begin to decrease the volume of the sound as it moves further away.\n     * NOTE: This only works with Web Audio API, HTML5 Audio playback\n     * will not be affected.\n     * @param  {Float}  x  The x-position of the playback from -1000.0 to 1000.0\n     * @param  {Float}  y  The y-position of the playback from -1000.0 to 1000.0\n     * @param  {Float}  z  The z-position of the playback from -1000.0 to 1000.0\n     * @param  {String} id (optional) The play instance ID.\n     * @return {Howl/Array}   Returns self or the current 3D position: [x, y, z]\n     */\n    pos3d: function(x, y, z, id) {\n      var self = this;\n\n      // set a default for the optional 'y' & 'z'\n      y = (typeof y === 'undefined' || !y) ? 0 : y;\n      z = (typeof z === 'undefined' || !z) ? -0.5 : z;\n\n      // if the sound hasn't been loaded, add it to the event queue\n      if (!self._loaded) {\n        self.on('play', function() {\n          self.pos3d(x, y, z, id);\n        });\n\n        return self;\n      }\n\n      if (x >= 0 || x < 0) {\n        if (self._webAudio) {\n          var activeNode = (id) ? self._nodeById(id) : self._activeNode();\n          if (activeNode) {\n            self._pos3d = [x, y, z];\n            activeNode.panner.setPosition(x, y, z);\n            activeNode.panner.panningModel = self._model || 'HRTF';\n          }\n        }\n      } else {\n        return self._pos3d;\n      }\n\n      return self;\n    },\n\n    /**\n     * Fade a currently playing sound between two volumes.\n     * @param  {Number}   from     The volume to fade from (0.0 to 1.0).\n     * @param  {Number}   to       The volume to fade to (0.0 to 1.0).\n     * @param  {Number}   len      Time in milliseconds to fade.\n     * @param  {Function} callback (optional) Fired when the fade is complete.\n     * @param  {String}   id       (optional) The play instance ID.\n     * @return {Howl}\n     */\n    fade: function(from, to, len, callback, id) {\n      var self = this,\n        diff = Math.abs(from - to),\n        dir = from > to ? 'down' : 'up',\n        steps = diff / 0.01,\n        stepTime = len / steps;\n\n      // if the sound hasn't been loaded, add it to the event queue\n      if (!self._loaded) {\n        self.on('load', function() {\n          self.fade(from, to, len, callback, id);\n        });\n\n        return self;\n      }\n\n      // set the volume to the start position\n      self.volume(from, id);\n\n      for (var i=1; i<=steps; i++) {\n        (function() {\n          var change = self._volume + (dir === 'up' ? 0.01 : -0.01) * i,\n            vol = Math.round(1000 * change) / 1000,\n            toVol = to;\n\n          setTimeout(function() {\n            self.volume(vol, id);\n\n            if (vol === toVol) {\n              if (callback) callback();\n            }\n          }, stepTime * i);\n        })();\n      }\n    },\n\n    /**\n     * [DEPRECATED] Fade in the current sound.\n     * @param  {Float}    to      Volume to fade to (0.0 to 1.0).\n     * @param  {Number}   len     Time in milliseconds to fade.\n     * @param  {Function} callback\n     * @return {Howl}\n     */\n    fadeIn: function(to, len, callback) {\n      return this.volume(0).play().fade(0, to, len, callback);\n    },\n\n    /**\n     * [DEPRECATED] Fade out the current sound and pause when finished.\n     * @param  {Float}    to       Volume to fade to (0.0 to 1.0).\n     * @param  {Number}   len      Time in milliseconds to fade.\n     * @param  {Function} callback\n     * @param  {String}   id       (optional) The play instance ID.\n     * @return {Howl}\n     */\n    fadeOut: function(to, len, callback, id) {\n      var self = this;\n\n      return self.fade(self._volume, to, len, function() {\n        if (callback) callback();\n        self.pause(id);\n\n        // fire ended event\n        self.on('end');\n      }, id);\n    },\n\n    /**\n     * Get an audio node by ID.\n     * @return {Howl} Audio node.\n     */\n    _nodeById: function(id) {\n      var self = this,\n        node = self._audioNode[0];\n\n      // find the node with this ID\n      for (var i=0; i<self._audioNode.length; i++) {\n        if (self._audioNode[i].id === id) {\n          node = self._audioNode[i];\n          break;\n        }\n      }\n\n      return node;\n    },\n\n    /**\n     * Get the first active audio node.\n     * @return {Howl} Audio node.\n     */\n    _activeNode: function() {\n      var self = this,\n        node = null;\n\n      // find the first playing node\n      for (var i=0; i<self._audioNode.length; i++) {\n        if (!self._audioNode[i].paused) {\n          node = self._audioNode[i];\n          break;\n        }\n      }\n\n      // remove excess inactive nodes\n      self._drainPool();\n\n      return node;\n    },\n\n    /**\n     * Get the first inactive audio node.\n     * If there is none, create a new one and add it to the pool.\n     * @param  {Function} callback Function to call when the audio node is ready.\n     */\n    _inactiveNode: function(callback) {\n      var self = this,\n        node = null;\n\n      // find first inactive node to recycle\n      for (var i=0; i<self._audioNode.length; i++) {\n        if (self._audioNode[i].paused && self._audioNode[i].readyState === 4) {\n          // send the node back for use by the new play instance\n          callback(self._audioNode[i]);\n          node = true;\n          break;\n        }\n      }\n\n      // remove excess inactive nodes\n      self._drainPool();\n\n      if (node) {\n        return;\n      }\n\n      // create new node if there are no inactives\n      var newNode;\n      if (self._webAudio) {\n        newNode = self._setupAudioNode();\n        callback(newNode);\n      } else {\n        self.load();\n        newNode = self._audioNode[self._audioNode.length - 1];\n\n        // listen for the correct load event and fire the callback\n        var listenerEvent = navigator.isCocoonJS ? 'canplaythrough' : 'loadedmetadata';\n        var listener = function() {\n          newNode.removeEventListener(listenerEvent, listener, false);\n          callback(newNode);\n        };\n        newNode.addEventListener(listenerEvent, listener, false);\n      }\n    },\n\n    /**\n     * If there are more than 5 inactive audio nodes in the pool, clear out the rest.\n     */\n    _drainPool: function() {\n      var self = this,\n        inactive = 0,\n        i;\n\n      // count the number of inactive nodes\n      for (i=0; i<self._audioNode.length; i++) {\n        if (self._audioNode[i].paused) {\n          inactive++;\n        }\n      }\n\n      // remove excess inactive nodes\n      for (i=self._audioNode.length-1; i>=0; i--) {\n        if (inactive <= 5) {\n          break;\n        }\n\n        if (self._audioNode[i].paused) {\n          // disconnect the audio source if using Web Audio\n          if (self._webAudio) {\n            self._audioNode[i].disconnect(0);\n          }\n\n          inactive--;\n          self._audioNode.splice(i, 1);\n        }\n      }\n    },\n\n    /**\n     * Clear 'onend' timeout before it ends.\n     * @param  {String} soundId  The play instance ID.\n     */\n    _clearEndTimer: function(soundId) {\n      var self = this,\n        index = 0;\n\n      // loop through the timers to find the one associated with this sound\n      for (var i=0; i<self._onendTimer.length; i++) {\n        if (self._onendTimer[i].id === soundId) {\n          index = i;\n          break;\n        }\n      }\n\n      var timer = self._onendTimer[index];\n      if (timer) {\n        clearTimeout(timer.timer);\n        self._onendTimer.splice(index, 1);\n      }\n    },\n\n    /**\n     * Setup the gain node and panner for a Web Audio instance.\n     * @return {Object} The new audio node.\n     */\n    _setupAudioNode: function() {\n      var self = this,\n        node = self._audioNode,\n        index = self._audioNode.length;\n\n      // create gain node\n      node[index] = (typeof ctx.createGain === 'undefined') ? ctx.createGainNode() : ctx.createGain();\n      node[index].gain.value = self._volume;\n      node[index].paused = true;\n      node[index]._pos = 0;\n      node[index].readyState = 4;\n      node[index].connect(masterGain);\n\n      // create the panner\n      node[index].panner = ctx.createPanner();\n      node[index].panner.panningModel = self._model || 'equalpower';\n      node[index].panner.setPosition(self._pos3d[0], self._pos3d[1], self._pos3d[2]);\n      node[index].panner.connect(node[index]);\n\n      return node[index];\n    },\n\n    /**\n     * Call/set custom events.\n     * @param  {String}   event Event type.\n     * @param  {Function} fn    Function to call.\n     * @return {Howl}\n     */\n    on: function(event, fn) {\n      var self = this,\n        events = self['_on' + event];\n\n      if (typeof fn === 'function') {\n        events.push(fn);\n      } else {\n        for (var i=0; i<events.length; i++) {\n          if (fn) {\n            events[i].call(self, fn);\n          } else {\n            events[i].call(self);\n          }\n        }\n      }\n\n      return self;\n    },\n\n    /**\n     * Remove a custom event.\n     * @param  {String}   event Event type.\n     * @param  {Function} fn    Listener to remove.\n     * @return {Howl}\n     */\n    off: function(event, fn) {\n      var self = this,\n        events = self['_on' + event],\n        fnString = fn ? fn.toString() : null;\n\n      if (fnString) {\n        // loop through functions in the event for comparison\n        for (var i=0; i<events.length; i++) {\n          if (fnString === events[i].toString()) {\n            events.splice(i, 1);\n            break;\n          }\n        }\n      } else {\n        self['_on' + event] = [];\n      }\n\n      return self;\n    },\n\n    /**\n     * Unload and destroy the current Howl object.\n     * This will immediately stop all play instances attached to this sound.\n     */\n    unload: function() {\n      var self = this;\n\n      // stop playing any active nodes\n      var nodes = self._audioNode;\n      for (var i=0; i<self._audioNode.length; i++) {\n        // stop the sound if it is currently playing\n        if (!nodes[i].paused) {\n          self.stop(nodes[i].id);\n          self.on('end', nodes[i].id);\n        }\n\n        if (!self._webAudio) {\n          // remove the source if using HTML5 Audio\n          nodes[i].src = '';\n        } else {\n          // disconnect the output from the master gain\n          nodes[i].disconnect(0);\n        }\n      }\n\n      // make sure all timeouts are cleared\n      for (i=0; i<self._onendTimer.length; i++) {\n        clearTimeout(self._onendTimer[i].timer);\n      }\n\n      // remove the reference in the global Howler object\n      var index = Howler._howls.indexOf(self);\n      if (index !== null && index >= 0) {\n        Howler._howls.splice(index, 1);\n      }\n\n      // delete this sound from the cache\n      delete cache[self._src];\n      self = null;\n    }\n\n  };\n\n  // only define these functions when using WebAudio\n  if (usingWebAudio) {\n\n    /**\n     * Buffer a sound from URL (or from cache) and decode to audio source (Web Audio API).\n     * @param  {Object} obj The Howl object for the sound to load.\n     * @param  {String} url The path to the sound file.\n     */\n    var loadBuffer = function(obj, url) {\n      // check if the buffer has already been cached\n      if (url in cache) {\n        // set the duration from the cache\n        obj._duration = cache[url].duration;\n\n        // load the sound into this object\n        loadSound(obj);\n        return;\n      }\n      \n      if (/^data:[^;]+;base64,/.test(url)) {\n        // Decode base64 data-URIs because some browsers cannot load data-URIs with XMLHttpRequest.\n        var data = atob(url.split(',')[1]);\n        var dataView = new Uint8Array(data.length);\n        for (var i=0; i<data.length; ++i) {\n          dataView[i] = data.charCodeAt(i);\n        }\n        \n        decodeAudioData(dataView.buffer, obj, url);\n      } else {\n        // load the buffer from the URL\n        var xhr = new XMLHttpRequest();\n        xhr.open('GET', url, true);\n        xhr.responseType = 'arraybuffer';\n        xhr.onload = function() {\n          decodeAudioData(xhr.response, obj, url);\n        };\n        xhr.onerror = function() {\n          // if there is an error, switch the sound to HTML Audio\n          if (obj._webAudio) {\n            obj._buffer = true;\n            obj._webAudio = false;\n            obj._audioNode = [];\n            delete obj._gainNode;\n            delete cache[url];\n            obj.load();\n          }\n        };\n        try {\n          xhr.send();\n        } catch (e) {\n          xhr.onerror();\n        }\n      }\n    };\n\n    /**\n     * Decode audio data from an array buffer.\n     * @param  {ArrayBuffer} arraybuffer The audio data.\n     * @param  {Object} obj The Howl object for the sound to load.\n     * @param  {String} url The path to the sound file.\n     */\n    var decodeAudioData = function(arraybuffer, obj, url) {\n      // decode the buffer into an audio source\n      ctx.decodeAudioData(\n        arraybuffer,\n        function(buffer) {\n          if (buffer) {\n            cache[url] = buffer;\n            loadSound(obj, buffer);\n          }\n        },\n        function(err) {\n          obj.on('loaderror');\n        }\n      );\n    };\n\n    /**\n     * Finishes loading the Web Audio API sound and fires the loaded event\n     * @param  {Object}  obj    The Howl object for the sound to load.\n     * @param  {Objecct} buffer The decoded buffer sound source.\n     */\n    var loadSound = function(obj, buffer) {\n      // set the duration\n      obj._duration = (buffer) ? buffer.duration : obj._duration;\n\n      // setup a sprite if none is defined\n      if (Object.getOwnPropertyNames(obj._sprite).length === 0) {\n        obj._sprite = {_default: [0, obj._duration * 1000]};\n      }\n\n      // fire the loaded event\n      if (!obj._loaded) {\n        obj._loaded = true;\n        obj.on('load');\n      }\n\n      if (obj._autoplay) {\n        obj.play();\n      }\n    };\n\n    /**\n     * Load the sound back into the buffer source.\n     * @param  {Object} obj   The sound to load.\n     * @param  {Array}  loop  Loop boolean, pos, and duration.\n     * @param  {String} id    (optional) The play instance ID.\n     */\n    var refreshBuffer = function(obj, loop, id) {\n      // determine which node to connect to\n      var node = obj._nodeById(id);\n\n      // setup the buffer source for playback\n      node.bufferSource = ctx.createBufferSource();\n      node.bufferSource.buffer = cache[obj._src];\n      node.bufferSource.connect(node.panner);\n      node.bufferSource.loop = loop[0];\n      if (loop[0]) {\n        node.bufferSource.loopStart = loop[1];\n        node.bufferSource.loopEnd = loop[1] + loop[2];\n      }\n      node.bufferSource.playbackRate.value = obj._rate;\n    };\n\n  }\n\n  /**\n   * Add support for AMD (Asynchronous Module Definition) libraries such as require.js.\n   */\n  if (typeof define === 'function' && define.amd) {\n    define(function() {\n      return {\n        Howler: Howler,\n        Howl: Howl\n      };\n    });\n  }\n\n  /**\n   * Add support for CommonJS libraries such as browserify.\n   */\n  if (typeof exports !== 'undefined') {\n    exports.Howler = Howler;\n    exports.Howl = Howl;\n  }\n\n  // define globally in case AMD is not available or available but not used\n\n  if (typeof window !== 'undefined') {\n    window.Howler = Howler;\n    window.Howl = Howl;\n  }\n\n})();\n","/**\n * @author mrdoob / http://mrdoob.com/\n */\n\nvar Stats = function () {\n\n\tvar startTime = Date.now(), prevTime = startTime;\n\tvar ms = 0, msMin = Infinity, msMax = 0;\n\tvar fps = 0, fpsMin = Infinity, fpsMax = 0;\n\tvar frames = 0, mode = 0;\n\n\tvar container = document.createElement( 'div' );\n\tcontainer.id = 'stats';\n\tcontainer.addEventListener( 'mousedown', function ( event ) { event.preventDefault(); setMode( ++ mode % 2 ) }, false );\n\tcontainer.style.cssText = 'width:80px;opacity:0.9;cursor:pointer';\n\n\tvar fpsDiv = document.createElement( 'div' );\n\tfpsDiv.id = 'fps';\n\tfpsDiv.style.cssText = 'padding:0 0 3px 3px;text-align:left;background-color:#002';\n\tcontainer.appendChild( fpsDiv );\n\n\tvar fpsText = document.createElement( 'div' );\n\tfpsText.id = 'fpsText';\n\tfpsText.style.cssText = 'color:#0ff;font-family:Helvetica,Arial,sans-serif;font-size:9px;font-weight:bold;line-height:15px';\n\tfpsText.innerHTML = 'FPS';\n\tfpsDiv.appendChild( fpsText );\n\n\tvar fpsGraph = document.createElement( 'div' );\n\tfpsGraph.id = 'fpsGraph';\n\tfpsGraph.style.cssText = 'position:relative;width:74px;height:30px;background-color:#0ff';\n\tfpsDiv.appendChild( fpsGraph );\n\n\twhile ( fpsGraph.children.length < 74 ) {\n\n\t\tvar bar = document.createElement( 'span' );\n\t\tbar.style.cssText = 'width:1px;height:30px;float:left;background-color:#113';\n\t\tfpsGraph.appendChild( bar );\n\n\t}\n\n\tvar msDiv = document.createElement( 'div' );\n\tmsDiv.id = 'ms';\n\tmsDiv.style.cssText = 'padding:0 0 3px 3px;text-align:left;background-color:#020;display:none';\n\tcontainer.appendChild( msDiv );\n\n\tvar msText = document.createElement( 'div' );\n\tmsText.id = 'msText';\n\tmsText.style.cssText = 'color:#0f0;font-family:Helvetica,Arial,sans-serif;font-size:9px;font-weight:bold;line-height:15px';\n\tmsText.innerHTML = 'MS';\n\tmsDiv.appendChild( msText );\n\n\tvar msGraph = document.createElement( 'div' );\n\tmsGraph.id = 'msGraph';\n\tmsGraph.style.cssText = 'position:relative;width:74px;height:30px;background-color:#0f0';\n\tmsDiv.appendChild( msGraph );\n\n\twhile ( msGraph.children.length < 74 ) {\n\n\t\tvar bar = document.createElement( 'span' );\n\t\tbar.style.cssText = 'width:1px;height:30px;float:left;background-color:#131';\n\t\tmsGraph.appendChild( bar );\n\n\t}\n\n\tvar setMode = function ( value ) {\n\n\t\tmode = value;\n\n\t\tswitch ( mode ) {\n\n\t\t\tcase 0:\n\t\t\t\tfpsDiv.style.display = 'block';\n\t\t\t\tmsDiv.style.display = 'none';\n\t\t\t\tbreak;\n\t\t\tcase 1:\n\t\t\t\tfpsDiv.style.display = 'none';\n\t\t\t\tmsDiv.style.display = 'block';\n\t\t\t\tbreak;\n\t\t}\n\n\t};\n\n\tvar updateGraph = function ( dom, value ) {\n\n\t\tvar child = dom.appendChild( dom.firstChild );\n\t\tchild.style.height = value + 'px';\n\n\t};\n\n\treturn {\n\n\t\tREVISION: 12,\n\n\t\tdomElement: container,\n\n\t\tsetMode: setMode,\n\n\t\tbegin: function () {\n\n\t\t\tstartTime = Date.now();\n\n\t\t},\n\n\t\tend: function () {\n\n\t\t\tvar time = Date.now();\n\n\t\t\tms = time - startTime;\n\t\t\tmsMin = Math.min( msMin, ms );\n\t\t\tmsMax = Math.max( msMax, ms );\n\n\t\t\tmsText.textContent = ms + ' MS (' + msMin + '-' + msMax + ')';\n\t\t\tupdateGraph( msGraph, Math.min( 30, 30 - ( ms / 200 ) * 30 ) );\n\n\t\t\tframes ++;\n\n\t\t\tif ( time > prevTime + 1000 ) {\n\n\t\t\t\tfps = Math.round( ( frames * 1000 ) / ( time - prevTime ) );\n\t\t\t\tfpsMin = Math.min( fpsMin, fps );\n\t\t\t\tfpsMax = Math.max( fpsMax, fps );\n\n\t\t\t\tfpsText.textContent = fps + ' FPS (' + fpsMin + '-' + fpsMax + ')';\n\t\t\t\tupdateGraph( fpsGraph, Math.min( 30, 30 - ( fps / 100 ) * 30 ) );\n\n\t\t\t\tprevTime = time;\n\t\t\t\tframes = 0;\n\n\t\t\t}\n\n\t\t\treturn time;\n\n\t\t},\n\n\t\tupdate: function () {\n\n\t\t\tstartTime = this.end();\n\n\t\t}\n\n\t}\n\n};\n\nif ( typeof module === 'object' ) {\n\n\tmodule.exports = Stats;\n\n}","var self = self || {}; // File:src/Three.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nvar THREE = {\r\n  REVISION: '71'\r\n};\r\n\r\n// browserify support\r\n\r\nif (typeof module === 'object') {\r\n\r\n  module.exports = THREE;\r\n\r\n}\r\n\r\n// polyfills\r\n\r\nif (Math.sign === undefined) {\r\n\r\n  // https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Math/sign\r\n\r\n  Math.sign = function(x) {\r\n\r\n    return (x < 0) ? -1 : (x > 0) ? 1 : +x;\r\n\r\n  };\r\n\r\n}\r\n\r\n\r\n// set the default log handlers\r\nTHREE.log = function() {\r\n  console.log.apply(console, arguments);\r\n}\r\nTHREE.warn = function() {\r\n  console.warn.apply(console, arguments);\r\n}\r\nTHREE.error = function() {\r\n  console.error.apply(console, arguments);\r\n}\r\n\r\n\r\n// https://developer.mozilla.org/en-US/docs/Web/API/MouseEvent.button\r\n\r\nTHREE.MOUSE = {\r\n  LEFT: 0,\r\n  MIDDLE: 1,\r\n  RIGHT: 2\r\n};\r\n\r\n// GL STATE CONSTANTS\r\n\r\nTHREE.CullFaceNone = 0;\r\nTHREE.CullFaceBack = 1;\r\nTHREE.CullFaceFront = 2;\r\nTHREE.CullFaceFrontBack = 3;\r\n\r\nTHREE.FrontFaceDirectionCW = 0;\r\nTHREE.FrontFaceDirectionCCW = 1;\r\n\r\n// SHADOWING TYPES\r\n\r\nTHREE.BasicShadowMap = 0;\r\nTHREE.PCFShadowMap = 1;\r\nTHREE.PCFSoftShadowMap = 2;\r\n\r\n// MATERIAL CONSTANTS\r\n\r\n// side\r\n\r\nTHREE.FrontSide = 0;\r\nTHREE.BackSide = 1;\r\nTHREE.DoubleSide = 2;\r\n\r\n// shading\r\n\r\nTHREE.NoShading = 0;\r\nTHREE.FlatShading = 1;\r\nTHREE.SmoothShading = 2;\r\n\r\n// colors\r\n\r\nTHREE.NoColors = 0;\r\nTHREE.FaceColors = 1;\r\nTHREE.VertexColors = 2;\r\n\r\n// blending modes\r\n\r\nTHREE.NoBlending = 0;\r\nTHREE.NormalBlending = 1;\r\nTHREE.AdditiveBlending = 2;\r\nTHREE.SubtractiveBlending = 3;\r\nTHREE.MultiplyBlending = 4;\r\nTHREE.CustomBlending = 5;\r\n\r\n// custom blending equations\r\n// (numbers start from 100 not to clash with other\r\n//  mappings to OpenGL constants defined in Texture.js)\r\n\r\nTHREE.AddEquation = 100;\r\nTHREE.SubtractEquation = 101;\r\nTHREE.ReverseSubtractEquation = 102;\r\nTHREE.MinEquation = 103;\r\nTHREE.MaxEquation = 104;\r\n\r\n// custom blending destination factors\r\n\r\nTHREE.ZeroFactor = 200;\r\nTHREE.OneFactor = 201;\r\nTHREE.SrcColorFactor = 202;\r\nTHREE.OneMinusSrcColorFactor = 203;\r\nTHREE.SrcAlphaFactor = 204;\r\nTHREE.OneMinusSrcAlphaFactor = 205;\r\nTHREE.DstAlphaFactor = 206;\r\nTHREE.OneMinusDstAlphaFactor = 207;\r\n\r\n// custom blending source factors\r\n\r\n//THREE.ZeroFactor = 200;\r\n//THREE.OneFactor = 201;\r\n//THREE.SrcAlphaFactor = 204;\r\n//THREE.OneMinusSrcAlphaFactor = 205;\r\n//THREE.DstAlphaFactor = 206;\r\n//THREE.OneMinusDstAlphaFactor = 207;\r\nTHREE.DstColorFactor = 208;\r\nTHREE.OneMinusDstColorFactor = 209;\r\nTHREE.SrcAlphaSaturateFactor = 210;\r\n\r\n\r\n// TEXTURE CONSTANTS\r\n\r\nTHREE.MultiplyOperation = 0;\r\nTHREE.MixOperation = 1;\r\nTHREE.AddOperation = 2;\r\n\r\n// Mapping modes\r\n\r\nTHREE.UVMapping = 300;\r\n\r\nTHREE.CubeReflectionMapping = 301;\r\nTHREE.CubeRefractionMapping = 302;\r\n\r\nTHREE.EquirectangularReflectionMapping = 303;\r\nTHREE.EquirectangularRefractionMapping = 304;\r\n\r\nTHREE.SphericalReflectionMapping = 305;\r\n\r\n// Wrapping modes\r\n\r\nTHREE.RepeatWrapping = 1000;\r\nTHREE.ClampToEdgeWrapping = 1001;\r\nTHREE.MirroredRepeatWrapping = 1002;\r\n\r\n// Filters\r\n\r\nTHREE.NearestFilter = 1003;\r\nTHREE.NearestMipMapNearestFilter = 1004;\r\nTHREE.NearestMipMapLinearFilter = 1005;\r\nTHREE.LinearFilter = 1006;\r\nTHREE.LinearMipMapNearestFilter = 1007;\r\nTHREE.LinearMipMapLinearFilter = 1008;\r\n\r\n// Data types\r\n\r\nTHREE.UnsignedByteType = 1009;\r\nTHREE.ByteType = 1010;\r\nTHREE.ShortType = 1011;\r\nTHREE.UnsignedShortType = 1012;\r\nTHREE.IntType = 1013;\r\nTHREE.UnsignedIntType = 1014;\r\nTHREE.FloatType = 1015;\r\nTHREE.HalfFloatType = 1025;\r\n\r\n// Pixel types\r\n\r\n//THREE.UnsignedByteType = 1009;\r\nTHREE.UnsignedShort4444Type = 1016;\r\nTHREE.UnsignedShort5551Type = 1017;\r\nTHREE.UnsignedShort565Type = 1018;\r\n\r\n// Pixel formats\r\n\r\nTHREE.AlphaFormat = 1019;\r\nTHREE.RGBFormat = 1020;\r\nTHREE.RGBAFormat = 1021;\r\nTHREE.LuminanceFormat = 1022;\r\nTHREE.LuminanceAlphaFormat = 1023;\r\n// THREE.RGBEFormat handled as THREE.RGBAFormat in shaders\r\nTHREE.RGBEFormat = THREE.RGBAFormat; //1024;\r\n\r\n// DDS / ST3C Compressed texture formats\r\n\r\nTHREE.RGB_S3TC_DXT1_Format = 2001;\r\nTHREE.RGBA_S3TC_DXT1_Format = 2002;\r\nTHREE.RGBA_S3TC_DXT3_Format = 2003;\r\nTHREE.RGBA_S3TC_DXT5_Format = 2004;\r\n\r\n\r\n// PVRTC compressed texture formats\r\n\r\nTHREE.RGB_PVRTC_4BPPV1_Format = 2100;\r\nTHREE.RGB_PVRTC_2BPPV1_Format = 2101;\r\nTHREE.RGBA_PVRTC_4BPPV1_Format = 2102;\r\nTHREE.RGBA_PVRTC_2BPPV1_Format = 2103;\r\n\r\n\r\n// DEPRECATED\r\n\r\nTHREE.Projector = function() {\r\n\r\n  THREE.error('THREE.Projector has been moved to /examples/js/renderers/Projector.js.');\r\n\r\n  this.projectVector = function(vector, camera) {\r\n\r\n    THREE.warn('THREE.Projector: .projectVector() is now vector.project().');\r\n    vector.project(camera);\r\n\r\n  };\r\n\r\n  this.unprojectVector = function(vector, camera) {\r\n\r\n    THREE.warn('THREE.Projector: .unprojectVector() is now vector.unproject().');\r\n    vector.unproject(camera);\r\n\r\n  };\r\n\r\n  this.pickingRay = function(vector, camera) {\r\n\r\n    THREE.error('THREE.Projector: .pickingRay() is now raycaster.setFromCamera().');\r\n\r\n  };\r\n\r\n};\r\n\r\nTHREE.CanvasRenderer = function() {\r\n\r\n  THREE.error('THREE.CanvasRenderer has been moved to /examples/js/renderers/CanvasRenderer.js');\r\n\r\n  this.domElement = document.createElement('canvas');\r\n  this.clear = function() {};\r\n  this.render = function() {};\r\n  this.setClearColor = function() {};\r\n  this.setSize = function() {};\r\n\r\n};\r\n\r\n// File:src/math/Color.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.Color = function(color) {\r\n\r\n  if (arguments.length === 3) {\r\n\r\n    return this.setRGB(arguments[0], arguments[1], arguments[2]);\r\n\r\n  }\r\n\r\n  return this.set(color)\r\n\r\n};\r\n\r\nTHREE.Color.prototype = {\r\n\r\n  constructor: THREE.Color,\r\n\r\n  r: 1,\r\n  g: 1,\r\n  b: 1,\r\n\r\n  set: function(value) {\r\n\r\n    if (value instanceof THREE.Color) {\r\n\r\n      this.copy(value);\r\n\r\n    }\r\n    else if (typeof value === 'number') {\r\n\r\n      this.setHex(value);\r\n\r\n    }\r\n    else if (typeof value === 'string') {\r\n\r\n      this.setStyle(value);\r\n\r\n    }\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  setHex: function(hex) {\r\n\r\n    hex = Math.floor(hex);\r\n\r\n    this.r = (hex >> 16 & 255) / 255;\r\n    this.g = (hex >> 8 & 255) / 255;\r\n    this.b = (hex & 255) / 255;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  setRGB: function(r, g, b) {\r\n\r\n    this.r = r;\r\n    this.g = g;\r\n    this.b = b;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  setHSL: function(h, s, l) {\r\n\r\n    // h,s,l ranges are in 0.0 - 1.0\r\n\r\n    if (s === 0) {\r\n\r\n      this.r = this.g = this.b = l;\r\n\r\n    }\r\n    else {\r\n\r\n      var hue2rgb = function(p, q, t) {\r\n\r\n        if (t < 0) t += 1;\r\n        if (t > 1) t -= 1;\r\n        if (t < 1 / 6) return p + (q - p) * 6 * t;\r\n        if (t < 1 / 2) return q;\r\n        if (t < 2 / 3) return p + (q - p) * 6 * (2 / 3 - t);\r\n        return p;\r\n\r\n      };\r\n\r\n      var p = l <= 0.5 ? l * (1 + s) : l + s - (l * s);\r\n      var q = (2 * l) - p;\r\n\r\n      this.r = hue2rgb(q, p, h + 1 / 3);\r\n      this.g = hue2rgb(q, p, h);\r\n      this.b = hue2rgb(q, p, h - 1 / 3);\r\n\r\n    }\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  setStyle: function(style) {\r\n\r\n    // rgb(255,0,0)\r\n\r\n    if (/^rgb\\((\\d+), ?(\\d+), ?(\\d+)\\)$/i.test(style)) {\r\n\r\n      var color = /^rgb\\((\\d+), ?(\\d+), ?(\\d+)\\)$/i.exec(style);\r\n\r\n      this.r = Math.min(255, parseInt(color[1], 10)) / 255;\r\n      this.g = Math.min(255, parseInt(color[2], 10)) / 255;\r\n      this.b = Math.min(255, parseInt(color[3], 10)) / 255;\r\n\r\n      return this;\r\n\r\n    }\r\n\r\n    // rgb(100%,0%,0%)\r\n\r\n    if (/^rgb\\((\\d+)\\%, ?(\\d+)\\%, ?(\\d+)\\%\\)$/i.test(style)) {\r\n\r\n      var color = /^rgb\\((\\d+)\\%, ?(\\d+)\\%, ?(\\d+)\\%\\)$/i.exec(style);\r\n\r\n      this.r = Math.min(100, parseInt(color[1], 10)) / 100;\r\n      this.g = Math.min(100, parseInt(color[2], 10)) / 100;\r\n      this.b = Math.min(100, parseInt(color[3], 10)) / 100;\r\n\r\n      return this;\r\n\r\n    }\r\n\r\n    // #ff0000\r\n\r\n    if (/^\\#([0-9a-f]{6})$/i.test(style)) {\r\n\r\n      var color = /^\\#([0-9a-f]{6})$/i.exec(style);\r\n\r\n      this.setHex(parseInt(color[1], 16));\r\n\r\n      return this;\r\n\r\n    }\r\n\r\n    // #f00\r\n\r\n    if (/^\\#([0-9a-f])([0-9a-f])([0-9a-f])$/i.test(style)) {\r\n\r\n      var color = /^\\#([0-9a-f])([0-9a-f])([0-9a-f])$/i.exec(style);\r\n\r\n      this.setHex(parseInt(color[1] + color[1] + color[2] + color[2] + color[3] + color[3], 16));\r\n\r\n      return this;\r\n\r\n    }\r\n\r\n    // red\r\n\r\n    if (/^(\\w+)$/i.test(style)) {\r\n\r\n      this.setHex(THREE.ColorKeywords[style]);\r\n\r\n      return this;\r\n\r\n    }\r\n\r\n\r\n  },\r\n\r\n  copy: function(color) {\r\n\r\n    this.r = color.r;\r\n    this.g = color.g;\r\n    this.b = color.b;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  copyGammaToLinear: function(color, gammaFactor) {\r\n\r\n    if (gammaFactor === undefined) gammaFactor = 2.0;\r\n\r\n    this.r = Math.pow(color.r, gammaFactor);\r\n    this.g = Math.pow(color.g, gammaFactor);\r\n    this.b = Math.pow(color.b, gammaFactor);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  copyLinearToGamma: function(color, gammaFactor) {\r\n\r\n    if (gammaFactor === undefined) gammaFactor = 2.0;\r\n\r\n    var safeInverse = (gammaFactor > 0) ? (1.0 / gammaFactor) : 1.0;\r\n\r\n    this.r = Math.pow(color.r, safeInverse);\r\n    this.g = Math.pow(color.g, safeInverse);\r\n    this.b = Math.pow(color.b, safeInverse);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  convertGammaToLinear: function() {\r\n\r\n    var r = this.r,\r\n      g = this.g,\r\n      b = this.b;\r\n\r\n    this.r = r * r;\r\n    this.g = g * g;\r\n    this.b = b * b;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  convertLinearToGamma: function() {\r\n\r\n    this.r = Math.sqrt(this.r);\r\n    this.g = Math.sqrt(this.g);\r\n    this.b = Math.sqrt(this.b);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  getHex: function() {\r\n\r\n    return (this.r * 255) << 16 ^ (this.g * 255) << 8 ^ (this.b * 255) << 0;\r\n\r\n  },\r\n\r\n  getHexString: function() {\r\n\r\n    return ('000000' + this.getHex().toString(16)).slice(-6);\r\n\r\n  },\r\n\r\n  getHSL: function(optionalTarget) {\r\n\r\n    // h,s,l ranges are in 0.0 - 1.0\r\n\r\n    var hsl = optionalTarget || {\r\n      h: 0,\r\n      s: 0,\r\n      l: 0\r\n    };\r\n\r\n    var r = this.r,\r\n      g = this.g,\r\n      b = this.b;\r\n\r\n    var max = Math.max(r, g, b);\r\n    var min = Math.min(r, g, b);\r\n\r\n    var hue, saturation;\r\n    var lightness = (min + max) / 2.0;\r\n\r\n    if (min === max) {\r\n\r\n      hue = 0;\r\n      saturation = 0;\r\n\r\n    }\r\n    else {\r\n\r\n      var delta = max - min;\r\n\r\n      saturation = lightness <= 0.5 ? delta / (max + min) : delta / (2 - max - min);\r\n\r\n      switch (max) {\r\n\r\n        case r:\r\n          hue = (g - b) / delta + (g < b ? 6 : 0);\r\n          break;\r\n        case g:\r\n          hue = (b - r) / delta + 2;\r\n          break;\r\n        case b:\r\n          hue = (r - g) / delta + 4;\r\n          break;\r\n\r\n      }\r\n\r\n      hue /= 6;\r\n\r\n    }\r\n\r\n    hsl.h = hue;\r\n    hsl.s = saturation;\r\n    hsl.l = lightness;\r\n\r\n    return hsl;\r\n\r\n  },\r\n\r\n  getStyle: function() {\r\n\r\n    return 'rgb(' + ((this.r * 255) | 0) + ',' + ((this.g * 255) | 0) + ',' + ((this.b * 255) | 0) + ')';\r\n\r\n  },\r\n\r\n  offsetHSL: function(h, s, l) {\r\n\r\n    var hsl = this.getHSL();\r\n\r\n    hsl.h += h;\r\n    hsl.s += s;\r\n    hsl.l += l;\r\n\r\n    this.setHSL(hsl.h, hsl.s, hsl.l);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  add: function(color) {\r\n\r\n    this.r += color.r;\r\n    this.g += color.g;\r\n    this.b += color.b;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  addColors: function(color1, color2) {\r\n\r\n    this.r = color1.r + color2.r;\r\n    this.g = color1.g + color2.g;\r\n    this.b = color1.b + color2.b;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  addScalar: function(s) {\r\n\r\n    this.r += s;\r\n    this.g += s;\r\n    this.b += s;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  multiply: function(color) {\r\n\r\n    this.r *= color.r;\r\n    this.g *= color.g;\r\n    this.b *= color.b;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  multiplyScalar: function(s) {\r\n\r\n    this.r *= s;\r\n    this.g *= s;\r\n    this.b *= s;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  lerp: function(color, alpha) {\r\n\r\n    this.r += (color.r - this.r) * alpha;\r\n    this.g += (color.g - this.g) * alpha;\r\n    this.b += (color.b - this.b) * alpha;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  equals: function(c) {\r\n\r\n    return (c.r === this.r) && (c.g === this.g) && (c.b === this.b);\r\n\r\n  },\r\n\r\n  fromArray: function(array) {\r\n\r\n    this.r = array[0];\r\n    this.g = array[1];\r\n    this.b = array[2];\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  toArray: function(array, offset) {\r\n\r\n    if (array === undefined) array = [];\r\n    if (offset === undefined) offset = 0;\r\n\r\n    array[offset] = this.r;\r\n    array[offset + 1] = this.g;\r\n    array[offset + 2] = this.b;\r\n\r\n    return array;\r\n  },\r\n\r\n  clone: function() {\r\n\r\n    return new THREE.Color().setRGB(this.r, this.g, this.b);\r\n\r\n  }\r\n\r\n};\r\n\r\nTHREE.ColorKeywords = {\r\n  'aliceblue': 0xF0F8FF,\r\n  'antiquewhite': 0xFAEBD7,\r\n  'aqua': 0x00FFFF,\r\n  'aquamarine': 0x7FFFD4,\r\n  'azure': 0xF0FFFF,\r\n  'beige': 0xF5F5DC,\r\n  'bisque': 0xFFE4C4,\r\n  'black': 0x000000,\r\n  'blanchedalmond': 0xFFEBCD,\r\n  'blue': 0x0000FF,\r\n  'blueviolet': 0x8A2BE2,\r\n  'brown': 0xA52A2A,\r\n  'burlywood': 0xDEB887,\r\n  'cadetblue': 0x5F9EA0,\r\n  'chartreuse': 0x7FFF00,\r\n  'chocolate': 0xD2691E,\r\n  'coral': 0xFF7F50,\r\n  'cornflowerblue': 0x6495ED,\r\n  'cornsilk': 0xFFF8DC,\r\n  'crimson': 0xDC143C,\r\n  'cyan': 0x00FFFF,\r\n  'darkblue': 0x00008B,\r\n  'darkcyan': 0x008B8B,\r\n  'darkgoldenrod': 0xB8860B,\r\n  'darkgray': 0xA9A9A9,\r\n  'darkgreen': 0x006400,\r\n  'darkgrey': 0xA9A9A9,\r\n  'darkkhaki': 0xBDB76B,\r\n  'darkmagenta': 0x8B008B,\r\n  'darkolivegreen': 0x556B2F,\r\n  'darkorange': 0xFF8C00,\r\n  'darkorchid': 0x9932CC,\r\n  'darkred': 0x8B0000,\r\n  'darksalmon': 0xE9967A,\r\n  'darkseagreen': 0x8FBC8F,\r\n  'darkslateblue': 0x483D8B,\r\n  'darkslategray': 0x2F4F4F,\r\n  'darkslategrey': 0x2F4F4F,\r\n  'darkturquoise': 0x00CED1,\r\n  'darkviolet': 0x9400D3,\r\n  'deeppink': 0xFF1493,\r\n  'deepskyblue': 0x00BFFF,\r\n  'dimgray': 0x696969,\r\n  'dimgrey': 0x696969,\r\n  'dodgerblue': 0x1E90FF,\r\n  'firebrick': 0xB22222,\r\n  'floralwhite': 0xFFFAF0,\r\n  'forestgreen': 0x228B22,\r\n  'fuchsia': 0xFF00FF,\r\n  'gainsboro': 0xDCDCDC,\r\n  'ghostwhite': 0xF8F8FF,\r\n  'gold': 0xFFD700,\r\n  'goldenrod': 0xDAA520,\r\n  'gray': 0x808080,\r\n  'green': 0x008000,\r\n  'greenyellow': 0xADFF2F,\r\n  'grey': 0x808080,\r\n  'honeydew': 0xF0FFF0,\r\n  'hotpink': 0xFF69B4,\r\n  'indianred': 0xCD5C5C,\r\n  'indigo': 0x4B0082,\r\n  'ivory': 0xFFFFF0,\r\n  'khaki': 0xF0E68C,\r\n  'lavender': 0xE6E6FA,\r\n  'lavenderblush': 0xFFF0F5,\r\n  'lawngreen': 0x7CFC00,\r\n  'lemonchiffon': 0xFFFACD,\r\n  'lightblue': 0xADD8E6,\r\n  'lightcoral': 0xF08080,\r\n  'lightcyan': 0xE0FFFF,\r\n  'lightgoldenrodyellow': 0xFAFAD2,\r\n  'lightgray': 0xD3D3D3,\r\n  'lightgreen': 0x90EE90,\r\n  'lightgrey': 0xD3D3D3,\r\n  'lightpink': 0xFFB6C1,\r\n  'lightsalmon': 0xFFA07A,\r\n  'lightseagreen': 0x20B2AA,\r\n  'lightskyblue': 0x87CEFA,\r\n  'lightslategray': 0x778899,\r\n  'lightslategrey': 0x778899,\r\n  'lightsteelblue': 0xB0C4DE,\r\n  'lightyellow': 0xFFFFE0,\r\n  'lime': 0x00FF00,\r\n  'limegreen': 0x32CD32,\r\n  'linen': 0xFAF0E6,\r\n  'magenta': 0xFF00FF,\r\n  'maroon': 0x800000,\r\n  'mediumaquamarine': 0x66CDAA,\r\n  'mediumblue': 0x0000CD,\r\n  'mediumorchid': 0xBA55D3,\r\n  'mediumpurple': 0x9370DB,\r\n  'mediumseagreen': 0x3CB371,\r\n  'mediumslateblue': 0x7B68EE,\r\n  'mediumspringgreen': 0x00FA9A,\r\n  'mediumturquoise': 0x48D1CC,\r\n  'mediumvioletred': 0xC71585,\r\n  'midnightblue': 0x191970,\r\n  'mintcream': 0xF5FFFA,\r\n  'mistyrose': 0xFFE4E1,\r\n  'moccasin': 0xFFE4B5,\r\n  'navajowhite': 0xFFDEAD,\r\n  'navy': 0x000080,\r\n  'oldlace': 0xFDF5E6,\r\n  'olive': 0x808000,\r\n  'olivedrab': 0x6B8E23,\r\n  'orange': 0xFFA500,\r\n  'orangered': 0xFF4500,\r\n  'orchid': 0xDA70D6,\r\n  'palegoldenrod': 0xEEE8AA,\r\n  'palegreen': 0x98FB98,\r\n  'paleturquoise': 0xAFEEEE,\r\n  'palevioletred': 0xDB7093,\r\n  'papayawhip': 0xFFEFD5,\r\n  'peachpuff': 0xFFDAB9,\r\n  'peru': 0xCD853F,\r\n  'pink': 0xFFC0CB,\r\n  'plum': 0xDDA0DD,\r\n  'powderblue': 0xB0E0E6,\r\n  'purple': 0x800080,\r\n  'red': 0xFF0000,\r\n  'rosybrown': 0xBC8F8F,\r\n  'royalblue': 0x4169E1,\r\n  'saddlebrown': 0x8B4513,\r\n  'salmon': 0xFA8072,\r\n  'sandybrown': 0xF4A460,\r\n  'seagreen': 0x2E8B57,\r\n  'seashell': 0xFFF5EE,\r\n  'sienna': 0xA0522D,\r\n  'silver': 0xC0C0C0,\r\n  'skyblue': 0x87CEEB,\r\n  'slateblue': 0x6A5ACD,\r\n  'slategray': 0x708090,\r\n  'slategrey': 0x708090,\r\n  'snow': 0xFFFAFA,\r\n  'springgreen': 0x00FF7F,\r\n  'steelblue': 0x4682B4,\r\n  'tan': 0xD2B48C,\r\n  'teal': 0x008080,\r\n  'thistle': 0xD8BFD8,\r\n  'tomato': 0xFF6347,\r\n  'turquoise': 0x40E0D0,\r\n  'violet': 0xEE82EE,\r\n  'wheat': 0xF5DEB3,\r\n  'white': 0xFFFFFF,\r\n  'whitesmoke': 0xF5F5F5,\r\n  'yellow': 0xFFFF00,\r\n  'yellowgreen': 0x9ACD32\r\n};\r\n\r\n// File:src/math/Quaternion.js\r\n\r\n/**\r\n * @author mikael emtinger / http://gomo.se/\r\n * @author alteredq / http://alteredqualia.com/\r\n * @author WestLangley / http://github.com/WestLangley\r\n * @author bhouston / http://exocortex.com\r\n */\r\n\r\nTHREE.Quaternion = function(x, y, z, w) {\r\n\r\n  this._x = x || 0;\r\n  this._y = y || 0;\r\n  this._z = z || 0;\r\n  this._w = (w !== undefined) ? w : 1;\r\n\r\n};\r\n\r\nTHREE.Quaternion.prototype = {\r\n\r\n  constructor: THREE.Quaternion,\r\n\r\n  _x: 0,\r\n  _y: 0,\r\n  _z: 0,\r\n  _w: 0,\r\n\r\n  get x() {\r\n\r\n    return this._x;\r\n\r\n  },\r\n\r\n  set x(value) {\r\n\r\n    this._x = value;\r\n    this.onChangeCallback();\r\n\r\n  },\r\n\r\n  get y() {\r\n\r\n    return this._y;\r\n\r\n  },\r\n\r\n  set y(value) {\r\n\r\n    this._y = value;\r\n    this.onChangeCallback();\r\n\r\n  },\r\n\r\n  get z() {\r\n\r\n    return this._z;\r\n\r\n  },\r\n\r\n  set z(value) {\r\n\r\n    this._z = value;\r\n    this.onChangeCallback();\r\n\r\n  },\r\n\r\n  get w() {\r\n\r\n    return this._w;\r\n\r\n  },\r\n\r\n  set w(value) {\r\n\r\n    this._w = value;\r\n    this.onChangeCallback();\r\n\r\n  },\r\n\r\n  set: function(x, y, z, w) {\r\n\r\n    this._x = x;\r\n    this._y = y;\r\n    this._z = z;\r\n    this._w = w;\r\n\r\n    this.onChangeCallback();\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  copy: function(quaternion) {\r\n\r\n    this._x = quaternion.x;\r\n    this._y = quaternion.y;\r\n    this._z = quaternion.z;\r\n    this._w = quaternion.w;\r\n\r\n    this.onChangeCallback();\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  setFromEuler: function(euler, update) {\r\n\r\n    if (euler instanceof THREE.Euler === false) {\r\n\r\n      throw new Error('THREE.Quaternion: .setFromEuler() now expects a Euler rotation rather than a Vector3 and order.');\r\n    }\r\n\r\n    // http://www.mathworks.com/matlabcentral/fileexchange/\r\n    // \t20696-function-to-convert-between-dcm-euler-angles-quaternions-and-euler-vectors/\r\n    //\tcontent/SpinCalc.m\r\n\r\n    var c1 = Math.cos(euler._x / 2);\r\n    var c2 = Math.cos(euler._y / 2);\r\n    var c3 = Math.cos(euler._z / 2);\r\n    var s1 = Math.sin(euler._x / 2);\r\n    var s2 = Math.sin(euler._y / 2);\r\n    var s3 = Math.sin(euler._z / 2);\r\n\r\n    if (euler.order === 'XYZ') {\r\n\r\n      this._x = s1 * c2 * c3 + c1 * s2 * s3;\r\n      this._y = c1 * s2 * c3 - s1 * c2 * s3;\r\n      this._z = c1 * c2 * s3 + s1 * s2 * c3;\r\n      this._w = c1 * c2 * c3 - s1 * s2 * s3;\r\n\r\n    }\r\n    else if (euler.order === 'YXZ') {\r\n\r\n      this._x = s1 * c2 * c3 + c1 * s2 * s3;\r\n      this._y = c1 * s2 * c3 - s1 * c2 * s3;\r\n      this._z = c1 * c2 * s3 - s1 * s2 * c3;\r\n      this._w = c1 * c2 * c3 + s1 * s2 * s3;\r\n\r\n    }\r\n    else if (euler.order === 'ZXY') {\r\n\r\n      this._x = s1 * c2 * c3 - c1 * s2 * s3;\r\n      this._y = c1 * s2 * c3 + s1 * c2 * s3;\r\n      this._z = c1 * c2 * s3 + s1 * s2 * c3;\r\n      this._w = c1 * c2 * c3 - s1 * s2 * s3;\r\n\r\n    }\r\n    else if (euler.order === 'ZYX') {\r\n\r\n      this._x = s1 * c2 * c3 - c1 * s2 * s3;\r\n      this._y = c1 * s2 * c3 + s1 * c2 * s3;\r\n      this._z = c1 * c2 * s3 - s1 * s2 * c3;\r\n      this._w = c1 * c2 * c3 + s1 * s2 * s3;\r\n\r\n    }\r\n    else if (euler.order === 'YZX') {\r\n\r\n      this._x = s1 * c2 * c3 + c1 * s2 * s3;\r\n      this._y = c1 * s2 * c3 + s1 * c2 * s3;\r\n      this._z = c1 * c2 * s3 - s1 * s2 * c3;\r\n      this._w = c1 * c2 * c3 - s1 * s2 * s3;\r\n\r\n    }\r\n    else if (euler.order === 'XZY') {\r\n\r\n      this._x = s1 * c2 * c3 - c1 * s2 * s3;\r\n      this._y = c1 * s2 * c3 - s1 * c2 * s3;\r\n      this._z = c1 * c2 * s3 + s1 * s2 * c3;\r\n      this._w = c1 * c2 * c3 + s1 * s2 * s3;\r\n\r\n    }\r\n\r\n    if (update !== false) this.onChangeCallback();\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  setFromAxisAngle: function(axis, angle) {\r\n\r\n    // http://www.euclideanspace.com/maths/geometry/rotations/conversions/angleToQuaternion/index.htm\r\n\r\n    // assumes axis is normalized\r\n\r\n    var halfAngle = angle / 2,\r\n      s = Math.sin(halfAngle);\r\n\r\n    this._x = axis.x * s;\r\n    this._y = axis.y * s;\r\n    this._z = axis.z * s;\r\n    this._w = Math.cos(halfAngle);\r\n\r\n    this.onChangeCallback();\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  setFromRotationMatrix: function(m) {\r\n\r\n    // http://www.euclideanspace.com/maths/geometry/rotations/conversions/matrixToQuaternion/index.htm\r\n\r\n    // assumes the upper 3x3 of m is a pure rotation matrix (i.e, unscaled)\r\n\r\n    var te = m.elements,\r\n\r\n      m11 = te[0],\r\n      m12 = te[4],\r\n      m13 = te[8],\r\n      m21 = te[1],\r\n      m22 = te[5],\r\n      m23 = te[9],\r\n      m31 = te[2],\r\n      m32 = te[6],\r\n      m33 = te[10],\r\n\r\n      trace = m11 + m22 + m33,\r\n      s;\r\n\r\n    if (trace > 0) {\r\n\r\n      s = 0.5 / Math.sqrt(trace + 1.0);\r\n\r\n      this._w = 0.25 / s;\r\n      this._x = (m32 - m23) * s;\r\n      this._y = (m13 - m31) * s;\r\n      this._z = (m21 - m12) * s;\r\n\r\n    }\r\n    else if (m11 > m22 && m11 > m33) {\r\n\r\n      s = 2.0 * Math.sqrt(1.0 + m11 - m22 - m33);\r\n\r\n      this._w = (m32 - m23) / s;\r\n      this._x = 0.25 * s;\r\n      this._y = (m12 + m21) / s;\r\n      this._z = (m13 + m31) / s;\r\n\r\n    }\r\n    else if (m22 > m33) {\r\n\r\n      s = 2.0 * Math.sqrt(1.0 + m22 - m11 - m33);\r\n\r\n      this._w = (m13 - m31) / s;\r\n      this._x = (m12 + m21) / s;\r\n      this._y = 0.25 * s;\r\n      this._z = (m23 + m32) / s;\r\n\r\n    }\r\n    else {\r\n\r\n      s = 2.0 * Math.sqrt(1.0 + m33 - m11 - m22);\r\n\r\n      this._w = (m21 - m12) / s;\r\n      this._x = (m13 + m31) / s;\r\n      this._y = (m23 + m32) / s;\r\n      this._z = 0.25 * s;\r\n\r\n    }\r\n\r\n    this.onChangeCallback();\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  setFromUnitVectors: function() {\r\n\r\n    // http://lolengine.net/blog/2014/02/24/quaternion-from-two-vectors-final\r\n\r\n    // assumes direction vectors vFrom and vTo are normalized\r\n\r\n    var v1, r;\r\n\r\n    var EPS = 0.000001;\r\n\r\n    return function(vFrom, vTo) {\r\n\r\n      if (v1 === undefined) v1 = new THREE.Vector3();\r\n\r\n      r = vFrom.dot(vTo) + 1;\r\n\r\n      if (r < EPS) {\r\n\r\n        r = 0;\r\n\r\n        if (Math.abs(vFrom.x) > Math.abs(vFrom.z)) {\r\n\r\n          v1.set(-vFrom.y, vFrom.x, 0);\r\n\r\n        }\r\n        else {\r\n\r\n          v1.set(0, -vFrom.z, vFrom.y);\r\n\r\n        }\r\n\r\n      }\r\n      else {\r\n\r\n        v1.crossVectors(vFrom, vTo);\r\n\r\n      }\r\n\r\n      this._x = v1.x;\r\n      this._y = v1.y;\r\n      this._z = v1.z;\r\n      this._w = r;\r\n\r\n      this.normalize();\r\n\r\n      return this;\r\n\r\n    }\r\n\r\n  }(),\r\n\r\n  inverse: function() {\r\n\r\n    this.conjugate().normalize();\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  conjugate: function() {\r\n\r\n    this._x *= -1;\r\n    this._y *= -1;\r\n    this._z *= -1;\r\n\r\n    this.onChangeCallback();\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  dot: function(v) {\r\n\r\n    return this._x * v._x + this._y * v._y + this._z * v._z + this._w * v._w;\r\n\r\n  },\r\n\r\n  lengthSq: function() {\r\n\r\n    return this._x * this._x + this._y * this._y + this._z * this._z + this._w * this._w;\r\n\r\n  },\r\n\r\n  length: function() {\r\n\r\n    return Math.sqrt(this._x * this._x + this._y * this._y + this._z * this._z + this._w * this._w);\r\n\r\n  },\r\n\r\n  normalize: function() {\r\n\r\n    var l = this.length();\r\n\r\n    if (l === 0) {\r\n\r\n      this._x = 0;\r\n      this._y = 0;\r\n      this._z = 0;\r\n      this._w = 1;\r\n\r\n    }\r\n    else {\r\n\r\n      l = 1 / l;\r\n\r\n      this._x = this._x * l;\r\n      this._y = this._y * l;\r\n      this._z = this._z * l;\r\n      this._w = this._w * l;\r\n\r\n    }\r\n\r\n    this.onChangeCallback();\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  multiply: function(q, p) {\r\n\r\n    if (p !== undefined) {\r\n\r\n      THREE.warn('THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead.');\r\n      return this.multiplyQuaternions(q, p);\r\n\r\n    }\r\n\r\n    return this.multiplyQuaternions(this, q);\r\n\r\n  },\r\n\r\n  multiplyQuaternions: function(a, b) {\r\n\r\n    // from http://www.euclideanspace.com/maths/algebra/realNormedAlgebra/quaternions/code/index.htm\r\n\r\n    var qax = a._x,\r\n      qay = a._y,\r\n      qaz = a._z,\r\n      qaw = a._w;\r\n    var qbx = b._x,\r\n      qby = b._y,\r\n      qbz = b._z,\r\n      qbw = b._w;\r\n\r\n    this._x = qax * qbw + qaw * qbx + qay * qbz - qaz * qby;\r\n    this._y = qay * qbw + qaw * qby + qaz * qbx - qax * qbz;\r\n    this._z = qaz * qbw + qaw * qbz + qax * qby - qay * qbx;\r\n    this._w = qaw * qbw - qax * qbx - qay * qby - qaz * qbz;\r\n\r\n    this.onChangeCallback();\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  multiplyVector3: function(vector) {\r\n\r\n    THREE.warn('THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead.');\r\n    return vector.applyQuaternion(this);\r\n\r\n  },\r\n\r\n  slerp: function(qb, t) {\r\n\r\n    if (t === 0) return this;\r\n    if (t === 1) return this.copy(qb);\r\n\r\n    var x = this._x,\r\n      y = this._y,\r\n      z = this._z,\r\n      w = this._w;\r\n\r\n    // http://www.euclideanspace.com/maths/algebra/realNormedAlgebra/quaternions/slerp/\r\n\r\n    var cosHalfTheta = w * qb._w + x * qb._x + y * qb._y + z * qb._z;\r\n\r\n    if (cosHalfTheta < 0) {\r\n\r\n      this._w = -qb._w;\r\n      this._x = -qb._x;\r\n      this._y = -qb._y;\r\n      this._z = -qb._z;\r\n\r\n      cosHalfTheta = -cosHalfTheta;\r\n\r\n    }\r\n    else {\r\n\r\n      this.copy(qb);\r\n\r\n    }\r\n\r\n    if (cosHalfTheta >= 1.0) {\r\n\r\n      this._w = w;\r\n      this._x = x;\r\n      this._y = y;\r\n      this._z = z;\r\n\r\n      return this;\r\n\r\n    }\r\n\r\n    var halfTheta = Math.acos(cosHalfTheta);\r\n    var sinHalfTheta = Math.sqrt(1.0 - cosHalfTheta * cosHalfTheta);\r\n\r\n    if (Math.abs(sinHalfTheta) < 0.001) {\r\n\r\n      this._w = 0.5 * (w + this._w);\r\n      this._x = 0.5 * (x + this._x);\r\n      this._y = 0.5 * (y + this._y);\r\n      this._z = 0.5 * (z + this._z);\r\n\r\n      return this;\r\n\r\n    }\r\n\r\n    var ratioA = Math.sin((1 - t) * halfTheta) / sinHalfTheta,\r\n      ratioB = Math.sin(t * halfTheta) / sinHalfTheta;\r\n\r\n    this._w = (w * ratioA + this._w * ratioB);\r\n    this._x = (x * ratioA + this._x * ratioB);\r\n    this._y = (y * ratioA + this._y * ratioB);\r\n    this._z = (z * ratioA + this._z * ratioB);\r\n\r\n    this.onChangeCallback();\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  equals: function(quaternion) {\r\n\r\n    return (quaternion._x === this._x) && (quaternion._y === this._y) && (quaternion._z === this._z) && (quaternion._w === this._w);\r\n\r\n  },\r\n\r\n  fromArray: function(array, offset) {\r\n\r\n    if (offset === undefined) offset = 0;\r\n\r\n    this._x = array[offset];\r\n    this._y = array[offset + 1];\r\n    this._z = array[offset + 2];\r\n    this._w = array[offset + 3];\r\n\r\n    this.onChangeCallback();\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  toArray: function(array, offset) {\r\n\r\n    if (array === undefined) array = [];\r\n    if (offset === undefined) offset = 0;\r\n\r\n    array[offset] = this._x;\r\n    array[offset + 1] = this._y;\r\n    array[offset + 2] = this._z;\r\n    array[offset + 3] = this._w;\r\n\r\n    return array;\r\n\r\n  },\r\n\r\n  onChange: function(callback) {\r\n\r\n    this.onChangeCallback = callback;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  onChangeCallback: function() {},\r\n\r\n  clone: function() {\r\n\r\n    return new THREE.Quaternion(this._x, this._y, this._z, this._w);\r\n\r\n  }\r\n\r\n};\r\n\r\nTHREE.Quaternion.slerp = function(qa, qb, qm, t) {\r\n\r\n  return qm.copy(qa).slerp(qb, t);\r\n\r\n}\r\n\r\n// File:src/math/Vector2.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author philogb / http://blog.thejit.org/\r\n * @author egraether / http://egraether.com/\r\n * @author zz85 / http://www.lab4games.net/zz85/blog\r\n */\r\n\r\nTHREE.Vector2 = function(x, y) {\r\n\r\n  this.x = x || 0;\r\n  this.y = y || 0;\r\n\r\n};\r\n\r\nTHREE.Vector2.prototype = {\r\n\r\n  constructor: THREE.Vector2,\r\n\r\n  set: function(x, y) {\r\n\r\n    this.x = x;\r\n    this.y = y;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  setX: function(x) {\r\n\r\n    this.x = x;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  setY: function(y) {\r\n\r\n    this.y = y;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  setComponent: function(index, value) {\r\n\r\n    switch (index) {\r\n\r\n      case 0:\r\n        this.x = value;\r\n        break;\r\n      case 1:\r\n        this.y = value;\r\n        break;\r\n      default:\r\n        throw new Error('index is out of range: ' + index);\r\n\r\n    }\r\n\r\n  },\r\n\r\n  getComponent: function(index) {\r\n\r\n    switch (index) {\r\n\r\n      case 0:\r\n        return this.x;\r\n      case 1:\r\n        return this.y;\r\n      default:\r\n        throw new Error('index is out of range: ' + index);\r\n\r\n    }\r\n\r\n  },\r\n\r\n  copy: function(v) {\r\n\r\n    this.x = v.x;\r\n    this.y = v.y;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  add: function(v, w) {\r\n\r\n    if (w !== undefined) {\r\n\r\n      THREE.warn('THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead.');\r\n      return this.addVectors(v, w);\r\n\r\n    }\r\n\r\n    this.x += v.x;\r\n    this.y += v.y;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  addScalar: function(s) {\r\n\r\n    this.x += s;\r\n    this.y += s;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  addVectors: function(a, b) {\r\n\r\n    this.x = a.x + b.x;\r\n    this.y = a.y + b.y;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  sub: function(v, w) {\r\n\r\n    if (w !== undefined) {\r\n\r\n      THREE.warn('THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead.');\r\n      return this.subVectors(v, w);\r\n\r\n    }\r\n\r\n    this.x -= v.x;\r\n    this.y -= v.y;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  subScalar: function(s) {\r\n\r\n    this.x -= s;\r\n    this.y -= s;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  subVectors: function(a, b) {\r\n\r\n    this.x = a.x - b.x;\r\n    this.y = a.y - b.y;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  multiply: function(v) {\r\n\r\n    this.x *= v.x;\r\n    this.y *= v.y;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  multiplyScalar: function(s) {\r\n\r\n    this.x *= s;\r\n    this.y *= s;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  divide: function(v) {\r\n\r\n    this.x /= v.x;\r\n    this.y /= v.y;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  divideScalar: function(scalar) {\r\n\r\n    if (scalar !== 0) {\r\n\r\n      var invScalar = 1 / scalar;\r\n\r\n      this.x *= invScalar;\r\n      this.y *= invScalar;\r\n\r\n    }\r\n    else {\r\n\r\n      this.x = 0;\r\n      this.y = 0;\r\n\r\n    }\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  min: function(v) {\r\n\r\n    if (this.x > v.x) {\r\n\r\n      this.x = v.x;\r\n\r\n    }\r\n\r\n    if (this.y > v.y) {\r\n\r\n      this.y = v.y;\r\n\r\n    }\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  max: function(v) {\r\n\r\n    if (this.x < v.x) {\r\n\r\n      this.x = v.x;\r\n\r\n    }\r\n\r\n    if (this.y < v.y) {\r\n\r\n      this.y = v.y;\r\n\r\n    }\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  clamp: function(min, max) {\r\n\r\n    // This function assumes min < max, if this assumption isn't true it will not operate correctly\r\n\r\n    if (this.x < min.x) {\r\n\r\n      this.x = min.x;\r\n\r\n    }\r\n    else if (this.x > max.x) {\r\n\r\n      this.x = max.x;\r\n\r\n    }\r\n\r\n    if (this.y < min.y) {\r\n\r\n      this.y = min.y;\r\n\r\n    }\r\n    else if (this.y > max.y) {\r\n\r\n      this.y = max.y;\r\n\r\n    }\r\n\r\n    return this;\r\n  },\r\n\r\n  clampScalar: (function() {\r\n\r\n    var min, max;\r\n\r\n    return function(minVal, maxVal) {\r\n\r\n      if (min === undefined) {\r\n\r\n        min = new THREE.Vector2();\r\n        max = new THREE.Vector2();\r\n\r\n      }\r\n\r\n      min.set(minVal, minVal);\r\n      max.set(maxVal, maxVal);\r\n\r\n      return this.clamp(min, max);\r\n\r\n    };\r\n\r\n  })(),\r\n\r\n  floor: function() {\r\n\r\n    this.x = Math.floor(this.x);\r\n    this.y = Math.floor(this.y);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  ceil: function() {\r\n\r\n    this.x = Math.ceil(this.x);\r\n    this.y = Math.ceil(this.y);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  round: function() {\r\n\r\n    this.x = Math.round(this.x);\r\n    this.y = Math.round(this.y);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  roundToZero: function() {\r\n\r\n    this.x = (this.x < 0) ? Math.ceil(this.x) : Math.floor(this.x);\r\n    this.y = (this.y < 0) ? Math.ceil(this.y) : Math.floor(this.y);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  negate: function() {\r\n\r\n    this.x = -this.x;\r\n    this.y = -this.y;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  dot: function(v) {\r\n\r\n    return this.x * v.x + this.y * v.y;\r\n\r\n  },\r\n\r\n  lengthSq: function() {\r\n\r\n    return this.x * this.x + this.y * this.y;\r\n\r\n  },\r\n\r\n  length: function() {\r\n\r\n    return Math.sqrt(this.x * this.x + this.y * this.y);\r\n\r\n  },\r\n\r\n  normalize: function() {\r\n\r\n    return this.divideScalar(this.length());\r\n\r\n  },\r\n\r\n  distanceTo: function(v) {\r\n\r\n    return Math.sqrt(this.distanceToSquared(v));\r\n\r\n  },\r\n\r\n  distanceToSquared: function(v) {\r\n\r\n    var dx = this.x - v.x,\r\n      dy = this.y - v.y;\r\n    return dx * dx + dy * dy;\r\n\r\n  },\r\n\r\n  setLength: function(l) {\r\n\r\n    var oldLength = this.length();\r\n\r\n    if (oldLength !== 0 && l !== oldLength) {\r\n\r\n      this.multiplyScalar(l / oldLength);\r\n    }\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  lerp: function(v, alpha) {\r\n\r\n    this.x += (v.x - this.x) * alpha;\r\n    this.y += (v.y - this.y) * alpha;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  lerpVectors: function(v1, v2, alpha) {\r\n\r\n    this.subVectors(v2, v1).multiplyScalar(alpha).add(v1);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  equals: function(v) {\r\n\r\n    return ((v.x === this.x) && (v.y === this.y));\r\n\r\n  },\r\n\r\n  fromArray: function(array, offset) {\r\n\r\n    if (offset === undefined) offset = 0;\r\n\r\n    this.x = array[offset];\r\n    this.y = array[offset + 1];\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  toArray: function(array, offset) {\r\n\r\n    if (array === undefined) array = [];\r\n    if (offset === undefined) offset = 0;\r\n\r\n    array[offset] = this.x;\r\n    array[offset + 1] = this.y;\r\n\r\n    return array;\r\n\r\n  },\r\n\r\n  fromAttribute: function(attribute, index, offset) {\r\n\r\n    if (offset === undefined) offset = 0;\r\n\r\n    index = index * attribute.itemSize + offset;\r\n\r\n    this.x = attribute.array[index];\r\n    this.y = attribute.array[index + 1];\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  clone: function() {\r\n\r\n    return new THREE.Vector2(this.x, this.y);\r\n\r\n  }\r\n\r\n};\r\n\r\n// File:src/math/Vector3.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author *kile / http://kile.stravaganza.org/\r\n * @author philogb / http://blog.thejit.org/\r\n * @author mikael emtinger / http://gomo.se/\r\n * @author egraether / http://egraether.com/\r\n * @author WestLangley / http://github.com/WestLangley\r\n */\r\n\r\nTHREE.Vector3 = function(x, y, z) {\r\n\r\n  this.x = x || 0;\r\n  this.y = y || 0;\r\n  this.z = z || 0;\r\n\r\n};\r\n\r\nTHREE.Vector3.prototype = {\r\n\r\n  constructor: THREE.Vector3,\r\n\r\n  set: function(x, y, z) {\r\n\r\n    this.x = x;\r\n    this.y = y;\r\n    this.z = z;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  setX: function(x) {\r\n\r\n    this.x = x;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  setY: function(y) {\r\n\r\n    this.y = y;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  setZ: function(z) {\r\n\r\n    this.z = z;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  setComponent: function(index, value) {\r\n\r\n    switch (index) {\r\n\r\n      case 0:\r\n        this.x = value;\r\n        break;\r\n      case 1:\r\n        this.y = value;\r\n        break;\r\n      case 2:\r\n        this.z = value;\r\n        break;\r\n      default:\r\n        throw new Error('index is out of range: ' + index);\r\n\r\n    }\r\n\r\n  },\r\n\r\n  getComponent: function(index) {\r\n\r\n    switch (index) {\r\n\r\n      case 0:\r\n        return this.x;\r\n      case 1:\r\n        return this.y;\r\n      case 2:\r\n        return this.z;\r\n      default:\r\n        throw new Error('index is out of range: ' + index);\r\n\r\n    }\r\n\r\n  },\r\n\r\n  copy: function(v) {\r\n\r\n    this.x = v.x;\r\n    this.y = v.y;\r\n    this.z = v.z;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  add: function(v, w) {\r\n\r\n    if (w !== undefined) {\r\n\r\n      THREE.warn('THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead.');\r\n      return this.addVectors(v, w);\r\n\r\n    }\r\n\r\n    this.x += v.x;\r\n    this.y += v.y;\r\n    this.z += v.z;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  addScalar: function(s) {\r\n\r\n    this.x += s;\r\n    this.y += s;\r\n    this.z += s;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  addVectors: function(a, b) {\r\n\r\n    this.x = a.x + b.x;\r\n    this.y = a.y + b.y;\r\n    this.z = a.z + b.z;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  sub: function(v, w) {\r\n\r\n    if (w !== undefined) {\r\n\r\n      THREE.warn('THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead.');\r\n      return this.subVectors(v, w);\r\n\r\n    }\r\n\r\n    this.x -= v.x;\r\n    this.y -= v.y;\r\n    this.z -= v.z;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  subScalar: function(s) {\r\n\r\n    this.x -= s;\r\n    this.y -= s;\r\n    this.z -= s;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  subVectors: function(a, b) {\r\n\r\n    this.x = a.x - b.x;\r\n    this.y = a.y - b.y;\r\n    this.z = a.z - b.z;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  multiply: function(v, w) {\r\n\r\n    if (w !== undefined) {\r\n\r\n      THREE.warn('THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead.');\r\n      return this.multiplyVectors(v, w);\r\n\r\n    }\r\n\r\n    this.x *= v.x;\r\n    this.y *= v.y;\r\n    this.z *= v.z;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  multiplyScalar: function(scalar) {\r\n\r\n    this.x *= scalar;\r\n    this.y *= scalar;\r\n    this.z *= scalar;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  multiplyVectors: function(a, b) {\r\n\r\n    this.x = a.x * b.x;\r\n    this.y = a.y * b.y;\r\n    this.z = a.z * b.z;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  applyEuler: function() {\r\n\r\n    var quaternion;\r\n\r\n    return function(euler) {\r\n\r\n      if (euler instanceof THREE.Euler === false) {\r\n\r\n        THREE.error('THREE.Vector3: .applyEuler() now expects a Euler rotation rather than a Vector3 and order.');\r\n\r\n      }\r\n\r\n      if (quaternion === undefined) quaternion = new THREE.Quaternion();\r\n\r\n      this.applyQuaternion(quaternion.setFromEuler(euler));\r\n\r\n      return this;\r\n\r\n    };\r\n\r\n  }(),\r\n\r\n  applyAxisAngle: function() {\r\n\r\n    var quaternion;\r\n\r\n    return function(axis, angle) {\r\n\r\n      if (quaternion === undefined) quaternion = new THREE.Quaternion();\r\n\r\n      this.applyQuaternion(quaternion.setFromAxisAngle(axis, angle));\r\n\r\n      return this;\r\n\r\n    };\r\n\r\n  }(),\r\n\r\n  applyMatrix3: function(m) {\r\n\r\n    var x = this.x;\r\n    var y = this.y;\r\n    var z = this.z;\r\n\r\n    var e = m.elements;\r\n\r\n    this.x = e[0] * x + e[3] * y + e[6] * z;\r\n    this.y = e[1] * x + e[4] * y + e[7] * z;\r\n    this.z = e[2] * x + e[5] * y + e[8] * z;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  applyMatrix4: function(m) {\r\n\r\n    // input: THREE.Matrix4 affine matrix\r\n\r\n    var x = this.x,\r\n      y = this.y,\r\n      z = this.z;\r\n\r\n    var e = m.elements;\r\n\r\n    this.x = e[0] * x + e[4] * y + e[8] * z + e[12];\r\n    this.y = e[1] * x + e[5] * y + e[9] * z + e[13];\r\n    this.z = e[2] * x + e[6] * y + e[10] * z + e[14];\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  applyProjection: function(m) {\r\n\r\n    // input: THREE.Matrix4 projection matrix\r\n\r\n    var x = this.x,\r\n      y = this.y,\r\n      z = this.z;\r\n\r\n    var e = m.elements;\r\n    var d = 1 / (e[3] * x + e[7] * y + e[11] * z + e[15]); // perspective divide\r\n\r\n    this.x = (e[0] * x + e[4] * y + e[8] * z + e[12]) * d;\r\n    this.y = (e[1] * x + e[5] * y + e[9] * z + e[13]) * d;\r\n    this.z = (e[2] * x + e[6] * y + e[10] * z + e[14]) * d;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  applyQuaternion: function(q) {\r\n\r\n    var x = this.x;\r\n    var y = this.y;\r\n    var z = this.z;\r\n\r\n    var qx = q.x;\r\n    var qy = q.y;\r\n    var qz = q.z;\r\n    var qw = q.w;\r\n\r\n    // calculate quat * vector\r\n\r\n    var ix = qw * x + qy * z - qz * y;\r\n    var iy = qw * y + qz * x - qx * z;\r\n    var iz = qw * z + qx * y - qy * x;\r\n    var iw = -qx * x - qy * y - qz * z;\r\n\r\n    // calculate result * inverse quat\r\n\r\n    this.x = ix * qw + iw * -qx + iy * -qz - iz * -qy;\r\n    this.y = iy * qw + iw * -qy + iz * -qx - ix * -qz;\r\n    this.z = iz * qw + iw * -qz + ix * -qy - iy * -qx;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  project: function() {\r\n\r\n    var matrix;\r\n\r\n    return function(camera) {\r\n\r\n      if (matrix === undefined) matrix = new THREE.Matrix4();\r\n\r\n      matrix.multiplyMatrices(camera.projectionMatrix, matrix.getInverse(camera.matrixWorld));\r\n      return this.applyProjection(matrix);\r\n\r\n    };\r\n\r\n  }(),\r\n\r\n  unproject: function() {\r\n\r\n    var matrix;\r\n\r\n    return function(camera) {\r\n\r\n      if (matrix === undefined) matrix = new THREE.Matrix4();\r\n\r\n      matrix.multiplyMatrices(camera.matrixWorld, matrix.getInverse(camera.projectionMatrix));\r\n      return this.applyProjection(matrix);\r\n\r\n    };\r\n\r\n  }(),\r\n\r\n  transformDirection: function(m) {\r\n\r\n    // input: THREE.Matrix4 affine matrix\r\n    // vector interpreted as a direction\r\n\r\n    var x = this.x,\r\n      y = this.y,\r\n      z = this.z;\r\n\r\n    var e = m.elements;\r\n\r\n    this.x = e[0] * x + e[4] * y + e[8] * z;\r\n    this.y = e[1] * x + e[5] * y + e[9] * z;\r\n    this.z = e[2] * x + e[6] * y + e[10] * z;\r\n\r\n    this.normalize();\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  divide: function(v) {\r\n\r\n    this.x /= v.x;\r\n    this.y /= v.y;\r\n    this.z /= v.z;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  divideScalar: function(scalar) {\r\n\r\n    if (scalar !== 0) {\r\n\r\n      var invScalar = 1 / scalar;\r\n\r\n      this.x *= invScalar;\r\n      this.y *= invScalar;\r\n      this.z *= invScalar;\r\n\r\n    }\r\n    else {\r\n\r\n      this.x = 0;\r\n      this.y = 0;\r\n      this.z = 0;\r\n\r\n    }\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  min: function(v) {\r\n\r\n    if (this.x > v.x) {\r\n\r\n      this.x = v.x;\r\n\r\n    }\r\n\r\n    if (this.y > v.y) {\r\n\r\n      this.y = v.y;\r\n\r\n    }\r\n\r\n    if (this.z > v.z) {\r\n\r\n      this.z = v.z;\r\n\r\n    }\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  max: function(v) {\r\n\r\n    if (this.x < v.x) {\r\n\r\n      this.x = v.x;\r\n\r\n    }\r\n\r\n    if (this.y < v.y) {\r\n\r\n      this.y = v.y;\r\n\r\n    }\r\n\r\n    if (this.z < v.z) {\r\n\r\n      this.z = v.z;\r\n\r\n    }\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  clamp: function(min, max) {\r\n\r\n    // This function assumes min < max, if this assumption isn't true it will not operate correctly\r\n\r\n    if (this.x < min.x) {\r\n\r\n      this.x = min.x;\r\n\r\n    }\r\n    else if (this.x > max.x) {\r\n\r\n      this.x = max.x;\r\n\r\n    }\r\n\r\n    if (this.y < min.y) {\r\n\r\n      this.y = min.y;\r\n\r\n    }\r\n    else if (this.y > max.y) {\r\n\r\n      this.y = max.y;\r\n\r\n    }\r\n\r\n    if (this.z < min.z) {\r\n\r\n      this.z = min.z;\r\n\r\n    }\r\n    else if (this.z > max.z) {\r\n\r\n      this.z = max.z;\r\n\r\n    }\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  clampScalar: (function() {\r\n\r\n    var min, max;\r\n\r\n    return function(minVal, maxVal) {\r\n\r\n      if (min === undefined) {\r\n\r\n        min = new THREE.Vector3();\r\n        max = new THREE.Vector3();\r\n\r\n      }\r\n\r\n      min.set(minVal, minVal, minVal);\r\n      max.set(maxVal, maxVal, maxVal);\r\n\r\n      return this.clamp(min, max);\r\n\r\n    };\r\n\r\n  })(),\r\n\r\n  floor: function() {\r\n\r\n    this.x = Math.floor(this.x);\r\n    this.y = Math.floor(this.y);\r\n    this.z = Math.floor(this.z);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  ceil: function() {\r\n\r\n    this.x = Math.ceil(this.x);\r\n    this.y = Math.ceil(this.y);\r\n    this.z = Math.ceil(this.z);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  round: function() {\r\n\r\n    this.x = Math.round(this.x);\r\n    this.y = Math.round(this.y);\r\n    this.z = Math.round(this.z);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  roundToZero: function() {\r\n\r\n    this.x = (this.x < 0) ? Math.ceil(this.x) : Math.floor(this.x);\r\n    this.y = (this.y < 0) ? Math.ceil(this.y) : Math.floor(this.y);\r\n    this.z = (this.z < 0) ? Math.ceil(this.z) : Math.floor(this.z);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  negate: function() {\r\n\r\n    this.x = -this.x;\r\n    this.y = -this.y;\r\n    this.z = -this.z;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  dot: function(v) {\r\n\r\n    return this.x * v.x + this.y * v.y + this.z * v.z;\r\n\r\n  },\r\n\r\n  lengthSq: function() {\r\n\r\n    return this.x * this.x + this.y * this.y + this.z * this.z;\r\n\r\n  },\r\n\r\n  length: function() {\r\n\r\n    return Math.sqrt(this.x * this.x + this.y * this.y + this.z * this.z);\r\n\r\n  },\r\n\r\n  lengthManhattan: function() {\r\n\r\n    return Math.abs(this.x) + Math.abs(this.y) + Math.abs(this.z);\r\n\r\n  },\r\n\r\n  normalize: function() {\r\n\r\n    return this.divideScalar(this.length());\r\n\r\n  },\r\n\r\n  setLength: function(l) {\r\n\r\n    var oldLength = this.length();\r\n\r\n    if (oldLength !== 0 && l !== oldLength) {\r\n\r\n      this.multiplyScalar(l / oldLength);\r\n    }\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  lerp: function(v, alpha) {\r\n\r\n    this.x += (v.x - this.x) * alpha;\r\n    this.y += (v.y - this.y) * alpha;\r\n    this.z += (v.z - this.z) * alpha;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  lerpVectors: function(v1, v2, alpha) {\r\n\r\n    this.subVectors(v2, v1).multiplyScalar(alpha).add(v1);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  cross: function(v, w) {\r\n\r\n    if (w !== undefined) {\r\n\r\n      THREE.warn('THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead.');\r\n      return this.crossVectors(v, w);\r\n\r\n    }\r\n\r\n    var x = this.x,\r\n      y = this.y,\r\n      z = this.z;\r\n\r\n    this.x = y * v.z - z * v.y;\r\n    this.y = z * v.x - x * v.z;\r\n    this.z = x * v.y - y * v.x;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  crossVectors: function(a, b) {\r\n\r\n    var ax = a.x,\r\n      ay = a.y,\r\n      az = a.z;\r\n    var bx = b.x,\r\n      by = b.y,\r\n      bz = b.z;\r\n\r\n    this.x = ay * bz - az * by;\r\n    this.y = az * bx - ax * bz;\r\n    this.z = ax * by - ay * bx;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  projectOnVector: function() {\r\n\r\n    var v1, dot;\r\n\r\n    return function(vector) {\r\n\r\n      if (v1 === undefined) v1 = new THREE.Vector3();\r\n\r\n      v1.copy(vector).normalize();\r\n\r\n      dot = this.dot(v1);\r\n\r\n      return this.copy(v1).multiplyScalar(dot);\r\n\r\n    };\r\n\r\n  }(),\r\n\r\n  projectOnPlane: function() {\r\n\r\n    var v1;\r\n\r\n    return function(planeNormal) {\r\n\r\n      if (v1 === undefined) v1 = new THREE.Vector3();\r\n\r\n      v1.copy(this).projectOnVector(planeNormal);\r\n\r\n      return this.sub(v1);\r\n\r\n    }\r\n\r\n  }(),\r\n\r\n  reflect: function() {\r\n\r\n    // reflect incident vector off plane orthogonal to normal\r\n    // normal is assumed to have unit length\r\n\r\n    var v1;\r\n\r\n    return function(normal) {\r\n\r\n      if (v1 === undefined) v1 = new THREE.Vector3();\r\n\r\n      return this.sub(v1.copy(normal).multiplyScalar(2 * this.dot(normal)));\r\n\r\n    }\r\n\r\n  }(),\r\n\r\n  angleTo: function(v) {\r\n\r\n    var theta = this.dot(v) / (this.length() * v.length());\r\n\r\n    // clamp, to handle numerical problems\r\n\r\n    return Math.acos(THREE.Math.clamp(theta, -1, 1));\r\n\r\n  },\r\n\r\n  distanceTo: function(v) {\r\n\r\n    return Math.sqrt(this.distanceToSquared(v));\r\n\r\n  },\r\n\r\n  distanceToSquared: function(v) {\r\n\r\n    var dx = this.x - v.x;\r\n    var dy = this.y - v.y;\r\n    var dz = this.z - v.z;\r\n\r\n    return dx * dx + dy * dy + dz * dz;\r\n\r\n  },\r\n\r\n  setEulerFromRotationMatrix: function(m, order) {\r\n\r\n    THREE.error('THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.');\r\n\r\n  },\r\n\r\n  setEulerFromQuaternion: function(q, order) {\r\n\r\n    THREE.error('THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.');\r\n\r\n  },\r\n\r\n  getPositionFromMatrix: function(m) {\r\n\r\n    THREE.warn('THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition().');\r\n\r\n    return this.setFromMatrixPosition(m);\r\n\r\n  },\r\n\r\n  getScaleFromMatrix: function(m) {\r\n\r\n    THREE.warn('THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale().');\r\n\r\n    return this.setFromMatrixScale(m);\r\n  },\r\n\r\n  getColumnFromMatrix: function(index, matrix) {\r\n\r\n    THREE.warn('THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn().');\r\n\r\n    return this.setFromMatrixColumn(index, matrix);\r\n\r\n  },\r\n\r\n  setFromMatrixPosition: function(m) {\r\n\r\n    this.x = m.elements[12];\r\n    this.y = m.elements[13];\r\n    this.z = m.elements[14];\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  setFromMatrixScale: function(m) {\r\n\r\n    var sx = this.set(m.elements[0], m.elements[1], m.elements[2]).length();\r\n    var sy = this.set(m.elements[4], m.elements[5], m.elements[6]).length();\r\n    var sz = this.set(m.elements[8], m.elements[9], m.elements[10]).length();\r\n\r\n    this.x = sx;\r\n    this.y = sy;\r\n    this.z = sz;\r\n\r\n    return this;\r\n  },\r\n\r\n  setFromMatrixColumn: function(index, matrix) {\r\n\r\n    var offset = index * 4;\r\n\r\n    var me = matrix.elements;\r\n\r\n    this.x = me[offset];\r\n    this.y = me[offset + 1];\r\n    this.z = me[offset + 2];\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  equals: function(v) {\r\n\r\n    return ((v.x === this.x) && (v.y === this.y) && (v.z === this.z));\r\n\r\n  },\r\n\r\n  fromArray: function(array, offset) {\r\n\r\n    if (offset === undefined) offset = 0;\r\n\r\n    this.x = array[offset];\r\n    this.y = array[offset + 1];\r\n    this.z = array[offset + 2];\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  toArray: function(array, offset) {\r\n\r\n    if (array === undefined) array = [];\r\n    if (offset === undefined) offset = 0;\r\n\r\n    array[offset] = this.x;\r\n    array[offset + 1] = this.y;\r\n    array[offset + 2] = this.z;\r\n\r\n    return array;\r\n\r\n  },\r\n\r\n  fromAttribute: function(attribute, index, offset) {\r\n\r\n    if (offset === undefined) offset = 0;\r\n\r\n    index = index * attribute.itemSize + offset;\r\n\r\n    this.x = attribute.array[index];\r\n    this.y = attribute.array[index + 1];\r\n    this.z = attribute.array[index + 2];\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  clone: function() {\r\n\r\n    return new THREE.Vector3(this.x, this.y, this.z);\r\n\r\n  }\r\n\r\n};\r\n\r\n// File:src/math/Vector4.js\r\n\r\n/**\r\n * @author supereggbert / http://www.paulbrunt.co.uk/\r\n * @author philogb / http://blog.thejit.org/\r\n * @author mikael emtinger / http://gomo.se/\r\n * @author egraether / http://egraether.com/\r\n * @author WestLangley / http://github.com/WestLangley\r\n */\r\n\r\nTHREE.Vector4 = function(x, y, z, w) {\r\n\r\n  this.x = x || 0;\r\n  this.y = y || 0;\r\n  this.z = z || 0;\r\n  this.w = (w !== undefined) ? w : 1;\r\n\r\n};\r\n\r\nTHREE.Vector4.prototype = {\r\n\r\n  constructor: THREE.Vector4,\r\n\r\n  set: function(x, y, z, w) {\r\n\r\n    this.x = x;\r\n    this.y = y;\r\n    this.z = z;\r\n    this.w = w;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  setX: function(x) {\r\n\r\n    this.x = x;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  setY: function(y) {\r\n\r\n    this.y = y;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  setZ: function(z) {\r\n\r\n    this.z = z;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  setW: function(w) {\r\n\r\n    this.w = w;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  setComponent: function(index, value) {\r\n\r\n    switch (index) {\r\n\r\n      case 0:\r\n        this.x = value;\r\n        break;\r\n      case 1:\r\n        this.y = value;\r\n        break;\r\n      case 2:\r\n        this.z = value;\r\n        break;\r\n      case 3:\r\n        this.w = value;\r\n        break;\r\n      default:\r\n        throw new Error('index is out of range: ' + index);\r\n\r\n    }\r\n\r\n  },\r\n\r\n  getComponent: function(index) {\r\n\r\n    switch (index) {\r\n\r\n      case 0:\r\n        return this.x;\r\n      case 1:\r\n        return this.y;\r\n      case 2:\r\n        return this.z;\r\n      case 3:\r\n        return this.w;\r\n      default:\r\n        throw new Error('index is out of range: ' + index);\r\n\r\n    }\r\n\r\n  },\r\n\r\n  copy: function(v) {\r\n\r\n    this.x = v.x;\r\n    this.y = v.y;\r\n    this.z = v.z;\r\n    this.w = (v.w !== undefined) ? v.w : 1;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  add: function(v, w) {\r\n\r\n    if (w !== undefined) {\r\n\r\n      THREE.warn('THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead.');\r\n      return this.addVectors(v, w);\r\n\r\n    }\r\n\r\n    this.x += v.x;\r\n    this.y += v.y;\r\n    this.z += v.z;\r\n    this.w += v.w;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  addScalar: function(s) {\r\n\r\n    this.x += s;\r\n    this.y += s;\r\n    this.z += s;\r\n    this.w += s;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  addVectors: function(a, b) {\r\n\r\n    this.x = a.x + b.x;\r\n    this.y = a.y + b.y;\r\n    this.z = a.z + b.z;\r\n    this.w = a.w + b.w;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  sub: function(v, w) {\r\n\r\n    if (w !== undefined) {\r\n\r\n      THREE.warn('THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead.');\r\n      return this.subVectors(v, w);\r\n\r\n    }\r\n\r\n    this.x -= v.x;\r\n    this.y -= v.y;\r\n    this.z -= v.z;\r\n    this.w -= v.w;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  subScalar: function(s) {\r\n\r\n    this.x -= s;\r\n    this.y -= s;\r\n    this.z -= s;\r\n    this.w -= s;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  subVectors: function(a, b) {\r\n\r\n    this.x = a.x - b.x;\r\n    this.y = a.y - b.y;\r\n    this.z = a.z - b.z;\r\n    this.w = a.w - b.w;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  multiplyScalar: function(scalar) {\r\n\r\n    this.x *= scalar;\r\n    this.y *= scalar;\r\n    this.z *= scalar;\r\n    this.w *= scalar;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  applyMatrix4: function(m) {\r\n\r\n    var x = this.x;\r\n    var y = this.y;\r\n    var z = this.z;\r\n    var w = this.w;\r\n\r\n    var e = m.elements;\r\n\r\n    this.x = e[0] * x + e[4] * y + e[8] * z + e[12] * w;\r\n    this.y = e[1] * x + e[5] * y + e[9] * z + e[13] * w;\r\n    this.z = e[2] * x + e[6] * y + e[10] * z + e[14] * w;\r\n    this.w = e[3] * x + e[7] * y + e[11] * z + e[15] * w;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  divideScalar: function(scalar) {\r\n\r\n    if (scalar !== 0) {\r\n\r\n      var invScalar = 1 / scalar;\r\n\r\n      this.x *= invScalar;\r\n      this.y *= invScalar;\r\n      this.z *= invScalar;\r\n      this.w *= invScalar;\r\n\r\n    }\r\n    else {\r\n\r\n      this.x = 0;\r\n      this.y = 0;\r\n      this.z = 0;\r\n      this.w = 1;\r\n\r\n    }\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  setAxisAngleFromQuaternion: function(q) {\r\n\r\n    // http://www.euclideanspace.com/maths/geometry/rotations/conversions/quaternionToAngle/index.htm\r\n\r\n    // q is assumed to be normalized\r\n\r\n    this.w = 2 * Math.acos(q.w);\r\n\r\n    var s = Math.sqrt(1 - q.w * q.w);\r\n\r\n    if (s < 0.0001) {\r\n\r\n      this.x = 1;\r\n      this.y = 0;\r\n      this.z = 0;\r\n\r\n    }\r\n    else {\r\n\r\n      this.x = q.x / s;\r\n      this.y = q.y / s;\r\n      this.z = q.z / s;\r\n\r\n    }\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  setAxisAngleFromRotationMatrix: function(m) {\r\n\r\n    // http://www.euclideanspace.com/maths/geometry/rotations/conversions/matrixToAngle/index.htm\r\n\r\n    // assumes the upper 3x3 of m is a pure rotation matrix (i.e, unscaled)\r\n\r\n    var angle, x, y, z, // variables for result\r\n      epsilon = 0.01, // margin to allow for rounding errors\r\n      epsilon2 = 0.1, // margin to distinguish between 0 and 180 degrees\r\n\r\n      te = m.elements,\r\n\r\n      m11 = te[0],\r\n      m12 = te[4],\r\n      m13 = te[8],\r\n      m21 = te[1],\r\n      m22 = te[5],\r\n      m23 = te[9],\r\n      m31 = te[2],\r\n      m32 = te[6],\r\n      m33 = te[10];\r\n\r\n    if ((Math.abs(m12 - m21) < epsilon) && (Math.abs(m13 - m31) < epsilon) && (Math.abs(m23 - m32) < epsilon)) {\r\n\r\n      // singularity found\r\n      // first check for identity matrix which must have +1 for all terms\r\n      // in leading diagonal and zero in other terms\r\n\r\n      if ((Math.abs(m12 + m21) < epsilon2) && (Math.abs(m13 + m31) < epsilon2) && (Math.abs(m23 + m32) < epsilon2) && (Math.abs(m11 + m22 + m33 - 3) < epsilon2)) {\r\n\r\n        // this singularity is identity matrix so angle = 0\r\n\r\n        this.set(1, 0, 0, 0);\r\n\r\n        return this; // zero angle, arbitrary axis\r\n\r\n      }\r\n\r\n      // otherwise this singularity is angle = 180\r\n\r\n      angle = Math.PI;\r\n\r\n      var xx = (m11 + 1) / 2;\r\n      var yy = (m22 + 1) / 2;\r\n      var zz = (m33 + 1) / 2;\r\n      var xy = (m12 + m21) / 4;\r\n      var xz = (m13 + m31) / 4;\r\n      var yz = (m23 + m32) / 4;\r\n\r\n      if ((xx > yy) && (xx > zz)) { // m11 is the largest diagonal term\r\n\r\n        if (xx < epsilon) {\r\n\r\n          x = 0;\r\n          y = 0.707106781;\r\n          z = 0.707106781;\r\n\r\n        }\r\n        else {\r\n\r\n          x = Math.sqrt(xx);\r\n          y = xy / x;\r\n          z = xz / x;\r\n\r\n        }\r\n\r\n      }\r\n      else if (yy > zz) { // m22 is the largest diagonal term\r\n\r\n        if (yy < epsilon) {\r\n\r\n          x = 0.707106781;\r\n          y = 0;\r\n          z = 0.707106781;\r\n\r\n        }\r\n        else {\r\n\r\n          y = Math.sqrt(yy);\r\n          x = xy / y;\r\n          z = yz / y;\r\n\r\n        }\r\n\r\n      }\r\n      else { // m33 is the largest diagonal term so base result on this\r\n\r\n        if (zz < epsilon) {\r\n\r\n          x = 0.707106781;\r\n          y = 0.707106781;\r\n          z = 0;\r\n\r\n        }\r\n        else {\r\n\r\n          z = Math.sqrt(zz);\r\n          x = xz / z;\r\n          y = yz / z;\r\n\r\n        }\r\n\r\n      }\r\n\r\n      this.set(x, y, z, angle);\r\n\r\n      return this; // return 180 deg rotation\r\n\r\n    }\r\n\r\n    // as we have reached here there are no singularities so we can handle normally\r\n\r\n    var s = Math.sqrt((m32 - m23) * (m32 - m23) + (m13 - m31) * (m13 - m31) + (m21 - m12) * (m21 - m12)); // used to normalize\r\n\r\n    if (Math.abs(s) < 0.001) s = 1;\r\n\r\n    // prevent divide by zero, should not happen if matrix is orthogonal and should be\r\n    // caught by singularity test above, but I've left it in just in case\r\n\r\n    this.x = (m32 - m23) / s;\r\n    this.y = (m13 - m31) / s;\r\n    this.z = (m21 - m12) / s;\r\n    this.w = Math.acos((m11 + m22 + m33 - 1) / 2);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  min: function(v) {\r\n\r\n    if (this.x > v.x) {\r\n\r\n      this.x = v.x;\r\n\r\n    }\r\n\r\n    if (this.y > v.y) {\r\n\r\n      this.y = v.y;\r\n\r\n    }\r\n\r\n    if (this.z > v.z) {\r\n\r\n      this.z = v.z;\r\n\r\n    }\r\n\r\n    if (this.w > v.w) {\r\n\r\n      this.w = v.w;\r\n\r\n    }\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  max: function(v) {\r\n\r\n    if (this.x < v.x) {\r\n\r\n      this.x = v.x;\r\n\r\n    }\r\n\r\n    if (this.y < v.y) {\r\n\r\n      this.y = v.y;\r\n\r\n    }\r\n\r\n    if (this.z < v.z) {\r\n\r\n      this.z = v.z;\r\n\r\n    }\r\n\r\n    if (this.w < v.w) {\r\n\r\n      this.w = v.w;\r\n\r\n    }\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  clamp: function(min, max) {\r\n\r\n    // This function assumes min < max, if this assumption isn't true it will not operate correctly\r\n\r\n    if (this.x < min.x) {\r\n\r\n      this.x = min.x;\r\n\r\n    }\r\n    else if (this.x > max.x) {\r\n\r\n      this.x = max.x;\r\n\r\n    }\r\n\r\n    if (this.y < min.y) {\r\n\r\n      this.y = min.y;\r\n\r\n    }\r\n    else if (this.y > max.y) {\r\n\r\n      this.y = max.y;\r\n\r\n    }\r\n\r\n    if (this.z < min.z) {\r\n\r\n      this.z = min.z;\r\n\r\n    }\r\n    else if (this.z > max.z) {\r\n\r\n      this.z = max.z;\r\n\r\n    }\r\n\r\n    if (this.w < min.w) {\r\n\r\n      this.w = min.w;\r\n\r\n    }\r\n    else if (this.w > max.w) {\r\n\r\n      this.w = max.w;\r\n\r\n    }\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  clampScalar: (function() {\r\n\r\n    var min, max;\r\n\r\n    return function(minVal, maxVal) {\r\n\r\n      if (min === undefined) {\r\n\r\n        min = new THREE.Vector4();\r\n        max = new THREE.Vector4();\r\n\r\n      }\r\n\r\n      min.set(minVal, minVal, minVal, minVal);\r\n      max.set(maxVal, maxVal, maxVal, maxVal);\r\n\r\n      return this.clamp(min, max);\r\n\r\n    };\r\n\r\n  })(),\r\n\r\n  floor: function() {\r\n\r\n    this.x = Math.floor(this.x);\r\n    this.y = Math.floor(this.y);\r\n    this.z = Math.floor(this.z);\r\n    this.w = Math.floor(this.w);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  ceil: function() {\r\n\r\n    this.x = Math.ceil(this.x);\r\n    this.y = Math.ceil(this.y);\r\n    this.z = Math.ceil(this.z);\r\n    this.w = Math.ceil(this.w);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  round: function() {\r\n\r\n    this.x = Math.round(this.x);\r\n    this.y = Math.round(this.y);\r\n    this.z = Math.round(this.z);\r\n    this.w = Math.round(this.w);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  roundToZero: function() {\r\n\r\n    this.x = (this.x < 0) ? Math.ceil(this.x) : Math.floor(this.x);\r\n    this.y = (this.y < 0) ? Math.ceil(this.y) : Math.floor(this.y);\r\n    this.z = (this.z < 0) ? Math.ceil(this.z) : Math.floor(this.z);\r\n    this.w = (this.w < 0) ? Math.ceil(this.w) : Math.floor(this.w);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  negate: function() {\r\n\r\n    this.x = -this.x;\r\n    this.y = -this.y;\r\n    this.z = -this.z;\r\n    this.w = -this.w;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  dot: function(v) {\r\n\r\n    return this.x * v.x + this.y * v.y + this.z * v.z + this.w * v.w;\r\n\r\n  },\r\n\r\n  lengthSq: function() {\r\n\r\n    return this.x * this.x + this.y * this.y + this.z * this.z + this.w * this.w;\r\n\r\n  },\r\n\r\n  length: function() {\r\n\r\n    return Math.sqrt(this.x * this.x + this.y * this.y + this.z * this.z + this.w * this.w);\r\n\r\n  },\r\n\r\n  lengthManhattan: function() {\r\n\r\n    return Math.abs(this.x) + Math.abs(this.y) + Math.abs(this.z) + Math.abs(this.w);\r\n\r\n  },\r\n\r\n  normalize: function() {\r\n\r\n    return this.divideScalar(this.length());\r\n\r\n  },\r\n\r\n  setLength: function(l) {\r\n\r\n    var oldLength = this.length();\r\n\r\n    if (oldLength !== 0 && l !== oldLength) {\r\n\r\n      this.multiplyScalar(l / oldLength);\r\n\r\n    }\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  lerp: function(v, alpha) {\r\n\r\n    this.x += (v.x - this.x) * alpha;\r\n    this.y += (v.y - this.y) * alpha;\r\n    this.z += (v.z - this.z) * alpha;\r\n    this.w += (v.w - this.w) * alpha;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  lerpVectors: function(v1, v2, alpha) {\r\n\r\n    this.subVectors(v2, v1).multiplyScalar(alpha).add(v1);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  equals: function(v) {\r\n\r\n    return ((v.x === this.x) && (v.y === this.y) && (v.z === this.z) && (v.w === this.w));\r\n\r\n  },\r\n\r\n  fromArray: function(array, offset) {\r\n\r\n    if (offset === undefined) offset = 0;\r\n\r\n    this.x = array[offset];\r\n    this.y = array[offset + 1];\r\n    this.z = array[offset + 2];\r\n    this.w = array[offset + 3];\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  toArray: function(array, offset) {\r\n\r\n    if (array === undefined) array = [];\r\n    if (offset === undefined) offset = 0;\r\n\r\n    array[offset] = this.x;\r\n    array[offset + 1] = this.y;\r\n    array[offset + 2] = this.z;\r\n    array[offset + 3] = this.w;\r\n\r\n    return array;\r\n\r\n  },\r\n\r\n  fromAttribute: function(attribute, index, offset) {\r\n\r\n    if (offset === undefined) offset = 0;\r\n\r\n    index = index * attribute.itemSize + offset;\r\n\r\n    this.x = attribute.array[index];\r\n    this.y = attribute.array[index + 1];\r\n    this.z = attribute.array[index + 2];\r\n    this.w = attribute.array[index + 3];\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  clone: function() {\r\n\r\n    return new THREE.Vector4(this.x, this.y, this.z, this.w);\r\n\r\n  }\r\n\r\n};\r\n\r\n// File:src/math/Euler.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author WestLangley / http://github.com/WestLangley\r\n * @author bhouston / http://exocortex.com\r\n */\r\n\r\nTHREE.Euler = function(x, y, z, order) {\r\n\r\n  this._x = x || 0;\r\n  this._y = y || 0;\r\n  this._z = z || 0;\r\n  this._order = order || THREE.Euler.DefaultOrder;\r\n\r\n};\r\n\r\nTHREE.Euler.RotationOrders = ['XYZ', 'YZX', 'ZXY', 'XZY', 'YXZ', 'ZYX'];\r\n\r\nTHREE.Euler.DefaultOrder = 'XYZ';\r\n\r\nTHREE.Euler.prototype = {\r\n\r\n  constructor: THREE.Euler,\r\n\r\n  _x: 0,\r\n  _y: 0,\r\n  _z: 0,\r\n  _order: THREE.Euler.DefaultOrder,\r\n\r\n  get x() {\r\n\r\n    return this._x;\r\n\r\n  },\r\n\r\n  set x(value) {\r\n\r\n    this._x = value;\r\n    this.onChangeCallback();\r\n\r\n  },\r\n\r\n  get y() {\r\n\r\n    return this._y;\r\n\r\n  },\r\n\r\n  set y(value) {\r\n\r\n    this._y = value;\r\n    this.onChangeCallback();\r\n\r\n  },\r\n\r\n  get z() {\r\n\r\n    return this._z;\r\n\r\n  },\r\n\r\n  set z(value) {\r\n\r\n    this._z = value;\r\n    this.onChangeCallback();\r\n\r\n  },\r\n\r\n  get order() {\r\n\r\n    return this._order;\r\n\r\n  },\r\n\r\n  set order(value) {\r\n\r\n    this._order = value;\r\n    this.onChangeCallback();\r\n\r\n  },\r\n\r\n  set: function(x, y, z, order) {\r\n\r\n    this._x = x;\r\n    this._y = y;\r\n    this._z = z;\r\n    this._order = order || this._order;\r\n\r\n    this.onChangeCallback();\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  copy: function(euler) {\r\n\r\n    this._x = euler._x;\r\n    this._y = euler._y;\r\n    this._z = euler._z;\r\n    this._order = euler._order;\r\n\r\n    this.onChangeCallback();\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  setFromRotationMatrix: function(m, order, update) {\r\n\r\n    var clamp = THREE.Math.clamp;\r\n\r\n    // assumes the upper 3x3 of m is a pure rotation matrix (i.e, unscaled)\r\n\r\n    var te = m.elements;\r\n    var m11 = te[0],\r\n      m12 = te[4],\r\n      m13 = te[8];\r\n    var m21 = te[1],\r\n      m22 = te[5],\r\n      m23 = te[9];\r\n    var m31 = te[2],\r\n      m32 = te[6],\r\n      m33 = te[10];\r\n\r\n    order = order || this._order;\r\n\r\n    if (order === 'XYZ') {\r\n\r\n      this._y = Math.asin(clamp(m13, -1, 1));\r\n\r\n      if (Math.abs(m13) < 0.99999) {\r\n\r\n        this._x = Math.atan2(-m23, m33);\r\n        this._z = Math.atan2(-m12, m11);\r\n\r\n      }\r\n      else {\r\n\r\n        this._x = Math.atan2(m32, m22);\r\n        this._z = 0;\r\n\r\n      }\r\n\r\n    }\r\n    else if (order === 'YXZ') {\r\n\r\n      this._x = Math.asin(-clamp(m23, -1, 1));\r\n\r\n      if (Math.abs(m23) < 0.99999) {\r\n\r\n        this._y = Math.atan2(m13, m33);\r\n        this._z = Math.atan2(m21, m22);\r\n\r\n      }\r\n      else {\r\n\r\n        this._y = Math.atan2(-m31, m11);\r\n        this._z = 0;\r\n\r\n      }\r\n\r\n    }\r\n    else if (order === 'ZXY') {\r\n\r\n      this._x = Math.asin(clamp(m32, -1, 1));\r\n\r\n      if (Math.abs(m32) < 0.99999) {\r\n\r\n        this._y = Math.atan2(-m31, m33);\r\n        this._z = Math.atan2(-m12, m22);\r\n\r\n      }\r\n      else {\r\n\r\n        this._y = 0;\r\n        this._z = Math.atan2(m21, m11);\r\n\r\n      }\r\n\r\n    }\r\n    else if (order === 'ZYX') {\r\n\r\n      this._y = Math.asin(-clamp(m31, -1, 1));\r\n\r\n      if (Math.abs(m31) < 0.99999) {\r\n\r\n        this._x = Math.atan2(m32, m33);\r\n        this._z = Math.atan2(m21, m11);\r\n\r\n      }\r\n      else {\r\n\r\n        this._x = 0;\r\n        this._z = Math.atan2(-m12, m22);\r\n\r\n      }\r\n\r\n    }\r\n    else if (order === 'YZX') {\r\n\r\n      this._z = Math.asin(clamp(m21, -1, 1));\r\n\r\n      if (Math.abs(m21) < 0.99999) {\r\n\r\n        this._x = Math.atan2(-m23, m22);\r\n        this._y = Math.atan2(-m31, m11);\r\n\r\n      }\r\n      else {\r\n\r\n        this._x = 0;\r\n        this._y = Math.atan2(m13, m33);\r\n\r\n      }\r\n\r\n    }\r\n    else if (order === 'XZY') {\r\n\r\n      this._z = Math.asin(-clamp(m12, -1, 1));\r\n\r\n      if (Math.abs(m12) < 0.99999) {\r\n\r\n        this._x = Math.atan2(m32, m22);\r\n        this._y = Math.atan2(m13, m11);\r\n\r\n      }\r\n      else {\r\n\r\n        this._x = Math.atan2(-m23, m33);\r\n        this._y = 0;\r\n\r\n      }\r\n\r\n    }\r\n    else {\r\n\r\n      THREE.warn('THREE.Euler: .setFromRotationMatrix() given unsupported order: ' + order)\r\n\r\n    }\r\n\r\n    this._order = order;\r\n\r\n    if (update !== false) this.onChangeCallback();\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  setFromQuaternion: function() {\r\n\r\n    var matrix;\r\n\r\n    return function(q, order, update) {\r\n\r\n      if (matrix === undefined) matrix = new THREE.Matrix4();\r\n      matrix.makeRotationFromQuaternion(q);\r\n      this.setFromRotationMatrix(matrix, order, update);\r\n\r\n      return this;\r\n\r\n    };\r\n\r\n  }(),\r\n\r\n  setFromVector3: function(v, order) {\r\n\r\n    return this.set(v.x, v.y, v.z, order || this._order);\r\n\r\n  },\r\n\r\n  reorder: function() {\r\n\r\n    // WARNING: this discards revolution information -bhouston\r\n\r\n    var q = new THREE.Quaternion();\r\n\r\n    return function(newOrder) {\r\n\r\n      q.setFromEuler(this);\r\n      this.setFromQuaternion(q, newOrder);\r\n\r\n    };\r\n\r\n  }(),\r\n\r\n  equals: function(euler) {\r\n\r\n    return (euler._x === this._x) && (euler._y === this._y) && (euler._z === this._z) && (euler._order === this._order);\r\n\r\n  },\r\n\r\n  fromArray: function(array) {\r\n\r\n    this._x = array[0];\r\n    this._y = array[1];\r\n    this._z = array[2];\r\n    if (array[3] !== undefined) this._order = array[3];\r\n\r\n    this.onChangeCallback();\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  toArray: function(array, offset) {\r\n\r\n    if (array === undefined) array = [];\r\n    if (offset === undefined) offset = 0;\r\n\r\n    array[offset] = this._x;\r\n    array[offset + 1] = this._y;\r\n    array[offset + 2] = this._z;\r\n    array[offset + 3] = this._order;\r\n\r\n    return array;\r\n  },\r\n\r\n  toVector3: function(optionalResult) {\r\n\r\n    if (optionalResult) {\r\n\r\n      return optionalResult.set(this._x, this._y, this._z);\r\n\r\n    }\r\n    else {\r\n\r\n      return new THREE.Vector3(this._x, this._y, this._z);\r\n\r\n    }\r\n\r\n  },\r\n\r\n  onChange: function(callback) {\r\n\r\n    this.onChangeCallback = callback;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  onChangeCallback: function() {},\r\n\r\n  clone: function() {\r\n\r\n    return new THREE.Euler(this._x, this._y, this._z, this._order);\r\n\r\n  }\r\n\r\n};\r\n\r\n// File:src/math/Line3.js\r\n\r\n/**\r\n * @author bhouston / http://exocortex.com\r\n */\r\n\r\nTHREE.Line3 = function(start, end) {\r\n\r\n  this.start = (start !== undefined) ? start : new THREE.Vector3();\r\n  this.end = (end !== undefined) ? end : new THREE.Vector3();\r\n\r\n};\r\n\r\nTHREE.Line3.prototype = {\r\n\r\n  constructor: THREE.Line3,\r\n\r\n  set: function(start, end) {\r\n\r\n    this.start.copy(start);\r\n    this.end.copy(end);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  copy: function(line) {\r\n\r\n    this.start.copy(line.start);\r\n    this.end.copy(line.end);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  center: function(optionalTarget) {\r\n\r\n    var result = optionalTarget || new THREE.Vector3();\r\n    return result.addVectors(this.start, this.end).multiplyScalar(0.5);\r\n\r\n  },\r\n\r\n  delta: function(optionalTarget) {\r\n\r\n    var result = optionalTarget || new THREE.Vector3();\r\n    return result.subVectors(this.end, this.start);\r\n\r\n  },\r\n\r\n  distanceSq: function() {\r\n\r\n    return this.start.distanceToSquared(this.end);\r\n\r\n  },\r\n\r\n  distance: function() {\r\n\r\n    return this.start.distanceTo(this.end);\r\n\r\n  },\r\n\r\n  at: function(t, optionalTarget) {\r\n\r\n    var result = optionalTarget || new THREE.Vector3();\r\n\r\n    return this.delta(result).multiplyScalar(t).add(this.start);\r\n\r\n  },\r\n\r\n  closestPointToPointParameter: function() {\r\n\r\n    var startP = new THREE.Vector3();\r\n    var startEnd = new THREE.Vector3();\r\n\r\n    return function(point, clampToLine) {\r\n\r\n      startP.subVectors(point, this.start);\r\n      startEnd.subVectors(this.end, this.start);\r\n\r\n      var startEnd2 = startEnd.dot(startEnd);\r\n      var startEnd_startP = startEnd.dot(startP);\r\n\r\n      var t = startEnd_startP / startEnd2;\r\n\r\n      if (clampToLine) {\r\n\r\n        t = THREE.Math.clamp(t, 0, 1);\r\n\r\n      }\r\n\r\n      return t;\r\n\r\n    };\r\n\r\n  }(),\r\n\r\n  closestPointToPoint: function(point, clampToLine, optionalTarget) {\r\n\r\n    var t = this.closestPointToPointParameter(point, clampToLine);\r\n\r\n    var result = optionalTarget || new THREE.Vector3();\r\n\r\n    return this.delta(result).multiplyScalar(t).add(this.start);\r\n\r\n  },\r\n\r\n  applyMatrix4: function(matrix) {\r\n\r\n    this.start.applyMatrix4(matrix);\r\n    this.end.applyMatrix4(matrix);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  equals: function(line) {\r\n\r\n    return line.start.equals(this.start) && line.end.equals(this.end);\r\n\r\n  },\r\n\r\n  clone: function() {\r\n\r\n    return new THREE.Line3().copy(this);\r\n\r\n  }\r\n\r\n};\r\n\r\n// File:src/math/Box2.js\r\n\r\n/**\r\n * @author bhouston / http://exocortex.com\r\n */\r\n\r\nTHREE.Box2 = function(min, max) {\r\n\r\n  this.min = (min !== undefined) ? min : new THREE.Vector2(Infinity, Infinity);\r\n  this.max = (max !== undefined) ? max : new THREE.Vector2(-Infinity, -Infinity);\r\n\r\n};\r\n\r\nTHREE.Box2.prototype = {\r\n\r\n  constructor: THREE.Box2,\r\n\r\n  set: function(min, max) {\r\n\r\n    this.min.copy(min);\r\n    this.max.copy(max);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  setFromPoints: function(points) {\r\n\r\n    this.makeEmpty();\r\n\r\n    for (var i = 0, il = points.length; i < il; i++) {\r\n\r\n      this.expandByPoint(points[i])\r\n\r\n    }\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  setFromCenterAndSize: function() {\r\n\r\n    var v1 = new THREE.Vector2();\r\n\r\n    return function(center, size) {\r\n\r\n      var halfSize = v1.copy(size).multiplyScalar(0.5);\r\n      this.min.copy(center).sub(halfSize);\r\n      this.max.copy(center).add(halfSize);\r\n\r\n      return this;\r\n\r\n    };\r\n\r\n  }(),\r\n\r\n  copy: function(box) {\r\n\r\n    this.min.copy(box.min);\r\n    this.max.copy(box.max);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  makeEmpty: function() {\r\n\r\n    this.min.x = this.min.y = Infinity;\r\n    this.max.x = this.max.y = -Infinity;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  empty: function() {\r\n\r\n    // this is a more robust check for empty than ( volume <= 0 ) because volume can get positive with two negative axes\r\n\r\n    return (this.max.x < this.min.x) || (this.max.y < this.min.y);\r\n\r\n  },\r\n\r\n  center: function(optionalTarget) {\r\n\r\n    var result = optionalTarget || new THREE.Vector2();\r\n    return result.addVectors(this.min, this.max).multiplyScalar(0.5);\r\n\r\n  },\r\n\r\n  size: function(optionalTarget) {\r\n\r\n    var result = optionalTarget || new THREE.Vector2();\r\n    return result.subVectors(this.max, this.min);\r\n\r\n  },\r\n\r\n  expandByPoint: function(point) {\r\n\r\n    this.min.min(point);\r\n    this.max.max(point);\r\n\r\n    return this;\r\n  },\r\n\r\n  expandByVector: function(vector) {\r\n\r\n    this.min.sub(vector);\r\n    this.max.add(vector);\r\n\r\n    return this;\r\n  },\r\n\r\n  expandByScalar: function(scalar) {\r\n\r\n    this.min.addScalar(-scalar);\r\n    this.max.addScalar(scalar);\r\n\r\n    return this;\r\n  },\r\n\r\n  containsPoint: function(point) {\r\n\r\n    if (point.x < this.min.x || point.x > this.max.x ||\r\n      point.y < this.min.y || point.y > this.max.y) {\r\n\r\n      return false;\r\n\r\n    }\r\n\r\n    return true;\r\n\r\n  },\r\n\r\n  containsBox: function(box) {\r\n\r\n    if ((this.min.x <= box.min.x) && (box.max.x <= this.max.x) &&\r\n      (this.min.y <= box.min.y) && (box.max.y <= this.max.y)) {\r\n\r\n      return true;\r\n\r\n    }\r\n\r\n    return false;\r\n\r\n  },\r\n\r\n  getParameter: function(point, optionalTarget) {\r\n\r\n    // This can potentially have a divide by zero if the box\r\n    // has a size dimension of 0.\r\n\r\n    var result = optionalTarget || new THREE.Vector2();\r\n\r\n    return result.set(\r\n      (point.x - this.min.x) / (this.max.x - this.min.x), (point.y - this.min.y) / (this.max.y - this.min.y)\r\n    );\r\n\r\n  },\r\n\r\n  isIntersectionBox: function(box) {\r\n\r\n    // using 6 splitting planes to rule out intersections.\r\n\r\n    if (box.max.x < this.min.x || box.min.x > this.max.x ||\r\n      box.max.y < this.min.y || box.min.y > this.max.y) {\r\n\r\n      return false;\r\n\r\n    }\r\n\r\n    return true;\r\n\r\n  },\r\n\r\n  clampPoint: function(point, optionalTarget) {\r\n\r\n    var result = optionalTarget || new THREE.Vector2();\r\n    return result.copy(point).clamp(this.min, this.max);\r\n\r\n  },\r\n\r\n  distanceToPoint: function() {\r\n\r\n    var v1 = new THREE.Vector2();\r\n\r\n    return function(point) {\r\n\r\n      var clampedPoint = v1.copy(point).clamp(this.min, this.max);\r\n      return clampedPoint.sub(point).length();\r\n\r\n    };\r\n\r\n  }(),\r\n\r\n  intersect: function(box) {\r\n\r\n    this.min.max(box.min);\r\n    this.max.min(box.max);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  union: function(box) {\r\n\r\n    this.min.min(box.min);\r\n    this.max.max(box.max);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  translate: function(offset) {\r\n\r\n    this.min.add(offset);\r\n    this.max.add(offset);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  equals: function(box) {\r\n\r\n    return box.min.equals(this.min) && box.max.equals(this.max);\r\n\r\n  },\r\n\r\n  clone: function() {\r\n\r\n    return new THREE.Box2().copy(this);\r\n\r\n  }\r\n\r\n};\r\n\r\n// File:src/math/Box3.js\r\n\r\n/**\r\n * @author bhouston / http://exocortex.com\r\n * @author WestLangley / http://github.com/WestLangley\r\n */\r\n\r\nTHREE.Box3 = function(min, max) {\r\n\r\n  this.min = (min !== undefined) ? min : new THREE.Vector3(Infinity, Infinity, Infinity);\r\n  this.max = (max !== undefined) ? max : new THREE.Vector3(-Infinity, -Infinity, -Infinity);\r\n\r\n};\r\n\r\nTHREE.Box3.prototype = {\r\n\r\n  constructor: THREE.Box3,\r\n\r\n  set: function(min, max) {\r\n\r\n    this.min.copy(min);\r\n    this.max.copy(max);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  setFromPoints: function(points) {\r\n\r\n    this.makeEmpty();\r\n\r\n    for (var i = 0, il = points.length; i < il; i++) {\r\n\r\n      this.expandByPoint(points[i])\r\n\r\n    }\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  setFromCenterAndSize: function() {\r\n\r\n    var v1 = new THREE.Vector3();\r\n\r\n    return function(center, size) {\r\n\r\n      var halfSize = v1.copy(size).multiplyScalar(0.5);\r\n\r\n      this.min.copy(center).sub(halfSize);\r\n      this.max.copy(center).add(halfSize);\r\n\r\n      return this;\r\n\r\n    };\r\n\r\n  }(),\r\n\r\n  setFromObject: function() {\r\n\r\n    // Computes the world-axis-aligned bounding box of an object (including its children),\r\n    // accounting for both the object's, and childrens', world transforms\r\n\r\n    var v1 = new THREE.Vector3();\r\n\r\n    return function(object) {\r\n\r\n      var scope = this;\r\n\r\n      object.updateMatrixWorld(true);\r\n\r\n      this.makeEmpty();\r\n\r\n      object.traverse(function(node) {\r\n\r\n        var geometry = node.geometry;\r\n\r\n        if (geometry !== undefined) {\r\n\r\n          if (geometry instanceof THREE.Geometry) {\r\n\r\n            var vertices = geometry.vertices;\r\n\r\n            for (var i = 0, il = vertices.length; i < il; i++) {\r\n\r\n              v1.copy(vertices[i]);\r\n\r\n              v1.applyMatrix4(node.matrixWorld);\r\n\r\n              scope.expandByPoint(v1);\r\n\r\n            }\r\n\r\n          }\r\n          else if (geometry instanceof THREE.BufferGeometry && geometry.attributes['position'] !== undefined) {\r\n\r\n            var positions = geometry.attributes['position'].array;\r\n\r\n            for (var i = 0, il = positions.length; i < il; i += 3) {\r\n\r\n              v1.set(positions[i], positions[i + 1], positions[i + 2]);\r\n\r\n              v1.applyMatrix4(node.matrixWorld);\r\n\r\n              scope.expandByPoint(v1);\r\n\r\n            }\r\n\r\n          }\r\n\r\n        }\r\n\r\n      });\r\n\r\n      return this;\r\n\r\n    };\r\n\r\n  }(),\r\n\r\n  copy: function(box) {\r\n\r\n    this.min.copy(box.min);\r\n    this.max.copy(box.max);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  makeEmpty: function() {\r\n\r\n    this.min.x = this.min.y = this.min.z = Infinity;\r\n    this.max.x = this.max.y = this.max.z = -Infinity;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  empty: function() {\r\n\r\n    // this is a more robust check for empty than ( volume <= 0 ) because volume can get positive with two negative axes\r\n\r\n    return (this.max.x < this.min.x) || (this.max.y < this.min.y) || (this.max.z < this.min.z);\r\n\r\n  },\r\n\r\n  center: function(optionalTarget) {\r\n\r\n    var result = optionalTarget || new THREE.Vector3();\r\n    return result.addVectors(this.min, this.max).multiplyScalar(0.5);\r\n\r\n  },\r\n\r\n  size: function(optionalTarget) {\r\n\r\n    var result = optionalTarget || new THREE.Vector3();\r\n    return result.subVectors(this.max, this.min);\r\n\r\n  },\r\n\r\n  expandByPoint: function(point) {\r\n\r\n    this.min.min(point);\r\n    this.max.max(point);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  expandByVector: function(vector) {\r\n\r\n    this.min.sub(vector);\r\n    this.max.add(vector);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  expandByScalar: function(scalar) {\r\n\r\n    this.min.addScalar(-scalar);\r\n    this.max.addScalar(scalar);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  containsPoint: function(point) {\r\n\r\n    if (point.x < this.min.x || point.x > this.max.x ||\r\n      point.y < this.min.y || point.y > this.max.y ||\r\n      point.z < this.min.z || point.z > this.max.z) {\r\n\r\n      return false;\r\n\r\n    }\r\n\r\n    return true;\r\n\r\n  },\r\n\r\n  containsBox: function(box) {\r\n\r\n    if ((this.min.x <= box.min.x) && (box.max.x <= this.max.x) &&\r\n      (this.min.y <= box.min.y) && (box.max.y <= this.max.y) &&\r\n      (this.min.z <= box.min.z) && (box.max.z <= this.max.z)) {\r\n\r\n      return true;\r\n\r\n    }\r\n\r\n    return false;\r\n\r\n  },\r\n\r\n  getParameter: function(point, optionalTarget) {\r\n\r\n    // This can potentially have a divide by zero if the box\r\n    // has a size dimension of 0.\r\n\r\n    var result = optionalTarget || new THREE.Vector3();\r\n\r\n    return result.set(\r\n      (point.x - this.min.x) / (this.max.x - this.min.x), (point.y - this.min.y) / (this.max.y - this.min.y), (point.z - this.min.z) / (this.max.z - this.min.z)\r\n    );\r\n\r\n  },\r\n\r\n  isIntersectionBox: function(box) {\r\n\r\n    // using 6 splitting planes to rule out intersections.\r\n\r\n    if (box.max.x < this.min.x || box.min.x > this.max.x ||\r\n      box.max.y < this.min.y || box.min.y > this.max.y ||\r\n      box.max.z < this.min.z || box.min.z > this.max.z) {\r\n\r\n      return false;\r\n\r\n    }\r\n\r\n    return true;\r\n\r\n  },\r\n\r\n  clampPoint: function(point, optionalTarget) {\r\n\r\n    var result = optionalTarget || new THREE.Vector3();\r\n    return result.copy(point).clamp(this.min, this.max);\r\n\r\n  },\r\n\r\n  distanceToPoint: function() {\r\n\r\n    var v1 = new THREE.Vector3();\r\n\r\n    return function(point) {\r\n\r\n      var clampedPoint = v1.copy(point).clamp(this.min, this.max);\r\n      return clampedPoint.sub(point).length();\r\n\r\n    };\r\n\r\n  }(),\r\n\r\n  getBoundingSphere: function() {\r\n\r\n    var v1 = new THREE.Vector3();\r\n\r\n    return function(optionalTarget) {\r\n\r\n      var result = optionalTarget || new THREE.Sphere();\r\n\r\n      result.center = this.center();\r\n      result.radius = this.size(v1).length() * 0.5;\r\n\r\n      return result;\r\n\r\n    };\r\n\r\n  }(),\r\n\r\n  intersect: function(box) {\r\n\r\n    this.min.max(box.min);\r\n    this.max.min(box.max);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  union: function(box) {\r\n\r\n    this.min.min(box.min);\r\n    this.max.max(box.max);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  applyMatrix4: function() {\r\n\r\n    var points = [\r\n      new THREE.Vector3(),\r\n      new THREE.Vector3(),\r\n      new THREE.Vector3(),\r\n      new THREE.Vector3(),\r\n      new THREE.Vector3(),\r\n      new THREE.Vector3(),\r\n      new THREE.Vector3(),\r\n      new THREE.Vector3()\r\n    ];\r\n\r\n    return function(matrix) {\r\n\r\n      // NOTE: I am using a binary pattern to specify all 2^3 combinations below\r\n      points[0].set(this.min.x, this.min.y, this.min.z).applyMatrix4(matrix); // 000\r\n      points[1].set(this.min.x, this.min.y, this.max.z).applyMatrix4(matrix); // 001\r\n      points[2].set(this.min.x, this.max.y, this.min.z).applyMatrix4(matrix); // 010\r\n      points[3].set(this.min.x, this.max.y, this.max.z).applyMatrix4(matrix); // 011\r\n      points[4].set(this.max.x, this.min.y, this.min.z).applyMatrix4(matrix); // 100\r\n      points[5].set(this.max.x, this.min.y, this.max.z).applyMatrix4(matrix); // 101\r\n      points[6].set(this.max.x, this.max.y, this.min.z).applyMatrix4(matrix); // 110\r\n      points[7].set(this.max.x, this.max.y, this.max.z).applyMatrix4(matrix); // 111\r\n\r\n      this.makeEmpty();\r\n      this.setFromPoints(points);\r\n\r\n      return this;\r\n\r\n    };\r\n\r\n  }(),\r\n\r\n  translate: function(offset) {\r\n\r\n    this.min.add(offset);\r\n    this.max.add(offset);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  equals: function(box) {\r\n\r\n    return box.min.equals(this.min) && box.max.equals(this.max);\r\n\r\n  },\r\n\r\n  clone: function() {\r\n\r\n    return new THREE.Box3().copy(this);\r\n\r\n  }\r\n\r\n};\r\n\r\n// File:src/math/Matrix3.js\r\n\r\n/**\r\n * @author alteredq / http://alteredqualia.com/\r\n * @author WestLangley / http://github.com/WestLangley\r\n * @author bhouston / http://exocortex.com\r\n */\r\n\r\nTHREE.Matrix3 = function() {\r\n\r\n  this.elements = new Float32Array([\r\n\r\n    1, 0, 0,\r\n    0, 1, 0,\r\n    0, 0, 1\r\n\r\n  ]);\r\n\r\n  if (arguments.length > 0) {\r\n\r\n    THREE.error('THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.');\r\n\r\n  }\r\n\r\n};\r\n\r\nTHREE.Matrix3.prototype = {\r\n\r\n  constructor: THREE.Matrix3,\r\n\r\n  set: function(n11, n12, n13, n21, n22, n23, n31, n32, n33) {\r\n\r\n    var te = this.elements;\r\n\r\n    te[0] = n11;\r\n    te[3] = n12;\r\n    te[6] = n13;\r\n    te[1] = n21;\r\n    te[4] = n22;\r\n    te[7] = n23;\r\n    te[2] = n31;\r\n    te[5] = n32;\r\n    te[8] = n33;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  identity: function() {\r\n\r\n    this.set(\r\n\r\n      1, 0, 0,\r\n      0, 1, 0,\r\n      0, 0, 1\r\n\r\n    );\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  copy: function(m) {\r\n\r\n    var me = m.elements;\r\n\r\n    this.set(\r\n\r\n      me[0], me[3], me[6],\r\n      me[1], me[4], me[7],\r\n      me[2], me[5], me[8]\r\n\r\n    );\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  multiplyVector3: function(vector) {\r\n\r\n    THREE.warn('THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead.');\r\n    return vector.applyMatrix3(this);\r\n\r\n  },\r\n\r\n  multiplyVector3Array: function(a) {\r\n\r\n    THREE.warn('THREE.Matrix3: .multiplyVector3Array() has been renamed. Use matrix.applyToVector3Array( array ) instead.');\r\n    return this.applyToVector3Array(a);\r\n\r\n  },\r\n\r\n  applyToVector3Array: function() {\r\n\r\n    var v1 = new THREE.Vector3();\r\n\r\n    return function(array, offset, length) {\r\n\r\n      if (offset === undefined) offset = 0;\r\n      if (length === undefined) length = array.length;\r\n\r\n      for (var i = 0, j = offset; i < length; i += 3, j += 3) {\r\n\r\n        v1.x = array[j];\r\n        v1.y = array[j + 1];\r\n        v1.z = array[j + 2];\r\n\r\n        v1.applyMatrix3(this);\r\n\r\n        array[j] = v1.x;\r\n        array[j + 1] = v1.y;\r\n        array[j + 2] = v1.z;\r\n\r\n      }\r\n\r\n      return array;\r\n\r\n    };\r\n\r\n  }(),\r\n\r\n  multiplyScalar: function(s) {\r\n\r\n    var te = this.elements;\r\n\r\n    te[0] *= s;\r\n    te[3] *= s;\r\n    te[6] *= s;\r\n    te[1] *= s;\r\n    te[4] *= s;\r\n    te[7] *= s;\r\n    te[2] *= s;\r\n    te[5] *= s;\r\n    te[8] *= s;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  determinant: function() {\r\n\r\n    var te = this.elements;\r\n\r\n    var a = te[0],\r\n      b = te[1],\r\n      c = te[2],\r\n      d = te[3],\r\n      e = te[4],\r\n      f = te[5],\r\n      g = te[6],\r\n      h = te[7],\r\n      i = te[8];\r\n\r\n    return a * e * i - a * f * h - b * d * i + b * f * g + c * d * h - c * e * g;\r\n\r\n  },\r\n\r\n  getInverse: function(matrix, throwOnInvertible) {\r\n\r\n    // input: THREE.Matrix4\r\n    // ( based on http://code.google.com/p/webgl-mjs/ )\r\n\r\n    var me = matrix.elements;\r\n    var te = this.elements;\r\n\r\n    te[0] = me[10] * me[5] - me[6] * me[9];\r\n    te[1] = -me[10] * me[1] + me[2] * me[9];\r\n    te[2] = me[6] * me[1] - me[2] * me[5];\r\n    te[3] = -me[10] * me[4] + me[6] * me[8];\r\n    te[4] = me[10] * me[0] - me[2] * me[8];\r\n    te[5] = -me[6] * me[0] + me[2] * me[4];\r\n    te[6] = me[9] * me[4] - me[5] * me[8];\r\n    te[7] = -me[9] * me[0] + me[1] * me[8];\r\n    te[8] = me[5] * me[0] - me[1] * me[4];\r\n\r\n    var det = me[0] * te[0] + me[1] * te[3] + me[2] * te[6];\r\n\r\n    // no inverse\r\n\r\n    if (det === 0) {\r\n\r\n      var msg = \"Matrix3.getInverse(): can't invert matrix, determinant is 0\";\r\n\r\n      if (throwOnInvertible || false) {\r\n\r\n        throw new Error(msg);\r\n\r\n      }\r\n      else {\r\n\r\n        THREE.warn(msg);\r\n\r\n      }\r\n\r\n      this.identity();\r\n\r\n      return this;\r\n\r\n    }\r\n\r\n    this.multiplyScalar(1.0 / det);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  transpose: function() {\r\n\r\n    var tmp, m = this.elements;\r\n\r\n    tmp = m[1];\r\n    m[1] = m[3];\r\n    m[3] = tmp;\r\n    tmp = m[2];\r\n    m[2] = m[6];\r\n    m[6] = tmp;\r\n    tmp = m[5];\r\n    m[5] = m[7];\r\n    m[7] = tmp;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  flattenToArrayOffset: function(array, offset) {\r\n\r\n    var te = this.elements;\r\n\r\n    array[offset] = te[0];\r\n    array[offset + 1] = te[1];\r\n    array[offset + 2] = te[2];\r\n\r\n    array[offset + 3] = te[3];\r\n    array[offset + 4] = te[4];\r\n    array[offset + 5] = te[5];\r\n\r\n    array[offset + 6] = te[6];\r\n    array[offset + 7] = te[7];\r\n    array[offset + 8] = te[8];\r\n\r\n    return array;\r\n\r\n  },\r\n\r\n  getNormalMatrix: function(m) {\r\n\r\n    // input: THREE.Matrix4\r\n\r\n    this.getInverse(m).transpose();\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  transposeIntoArray: function(r) {\r\n\r\n    var m = this.elements;\r\n\r\n    r[0] = m[0];\r\n    r[1] = m[3];\r\n    r[2] = m[6];\r\n    r[3] = m[1];\r\n    r[4] = m[4];\r\n    r[5] = m[7];\r\n    r[6] = m[2];\r\n    r[7] = m[5];\r\n    r[8] = m[8];\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  fromArray: function(array) {\r\n\r\n    this.elements.set(array);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  toArray: function() {\r\n\r\n    var te = this.elements;\r\n\r\n    return [\r\n      te[0], te[1], te[2],\r\n      te[3], te[4], te[5],\r\n      te[6], te[7], te[8]\r\n    ];\r\n\r\n  },\r\n\r\n  clone: function() {\r\n\r\n    return new THREE.Matrix3().fromArray(this.elements);\r\n\r\n  }\r\n\r\n};\r\n\r\n// File:src/math/Matrix4.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author supereggbert / http://www.paulbrunt.co.uk/\r\n * @author philogb / http://blog.thejit.org/\r\n * @author jordi_ros / http://plattsoft.com\r\n * @author D1plo1d / http://github.com/D1plo1d\r\n * @author alteredq / http://alteredqualia.com/\r\n * @author mikael emtinger / http://gomo.se/\r\n * @author timknip / http://www.floorplanner.com/\r\n * @author bhouston / http://exocortex.com\r\n * @author WestLangley / http://github.com/WestLangley\r\n */\r\n\r\nTHREE.Matrix4 = function() {\r\n\r\n  this.elements = new Float32Array([\r\n\r\n    1, 0, 0, 0,\r\n    0, 1, 0, 0,\r\n    0, 0, 1, 0,\r\n    0, 0, 0, 1\r\n\r\n  ]);\r\n\r\n  if (arguments.length > 0) {\r\n\r\n    THREE.error('THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.');\r\n\r\n  }\r\n\r\n};\r\n\r\nTHREE.Matrix4.prototype = {\r\n\r\n  constructor: THREE.Matrix4,\r\n\r\n  set: function(n11, n12, n13, n14, n21, n22, n23, n24, n31, n32, n33, n34, n41, n42, n43, n44) {\r\n\r\n    var te = this.elements;\r\n\r\n    te[0] = n11;\r\n    te[4] = n12;\r\n    te[8] = n13;\r\n    te[12] = n14;\r\n    te[1] = n21;\r\n    te[5] = n22;\r\n    te[9] = n23;\r\n    te[13] = n24;\r\n    te[2] = n31;\r\n    te[6] = n32;\r\n    te[10] = n33;\r\n    te[14] = n34;\r\n    te[3] = n41;\r\n    te[7] = n42;\r\n    te[11] = n43;\r\n    te[15] = n44;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  identity: function() {\r\n\r\n    this.set(\r\n\r\n      1, 0, 0, 0,\r\n      0, 1, 0, 0,\r\n      0, 0, 1, 0,\r\n      0, 0, 0, 1\r\n\r\n    );\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  copy: function(m) {\r\n\r\n    this.elements.set(m.elements);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  extractPosition: function(m) {\r\n\r\n    THREE.warn('THREE.Matrix4: .extractPosition() has been renamed to .copyPosition().');\r\n    return this.copyPosition(m);\r\n\r\n  },\r\n\r\n  copyPosition: function(m) {\r\n\r\n    var te = this.elements;\r\n    var me = m.elements;\r\n\r\n    te[12] = me[12];\r\n    te[13] = me[13];\r\n    te[14] = me[14];\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  extractBasis: function(xAxis, yAxis, zAxis) {\r\n\r\n    var te = this.elements;\r\n\r\n    xAxis.set(te[0], te[1], te[2]);\r\n    yAxis.set(te[4], te[5], te[6]);\r\n    zAxis.set(te[8], te[9], te[10]);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  makeBasis: function(xAxis, yAxis, zAxis) {\r\n\r\n    this.set(\r\n      xAxis.x, yAxis.x, zAxis.x, 0,\r\n      xAxis.y, yAxis.y, zAxis.y, 0,\r\n      xAxis.z, yAxis.z, zAxis.z, 0,\r\n      0, 0, 0, 1\r\n    );\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  extractRotation: function() {\r\n\r\n    var v1 = new THREE.Vector3();\r\n\r\n    return function(m) {\r\n\r\n      var te = this.elements;\r\n      var me = m.elements;\r\n\r\n      var scaleX = 1 / v1.set(me[0], me[1], me[2]).length();\r\n      var scaleY = 1 / v1.set(me[4], me[5], me[6]).length();\r\n      var scaleZ = 1 / v1.set(me[8], me[9], me[10]).length();\r\n\r\n      te[0] = me[0] * scaleX;\r\n      te[1] = me[1] * scaleX;\r\n      te[2] = me[2] * scaleX;\r\n\r\n      te[4] = me[4] * scaleY;\r\n      te[5] = me[5] * scaleY;\r\n      te[6] = me[6] * scaleY;\r\n\r\n      te[8] = me[8] * scaleZ;\r\n      te[9] = me[9] * scaleZ;\r\n      te[10] = me[10] * scaleZ;\r\n\r\n      return this;\r\n\r\n    };\r\n\r\n  }(),\r\n\r\n  makeRotationFromEuler: function(euler) {\r\n\r\n    if (euler instanceof THREE.Euler === false) {\r\n\r\n      THREE.error('THREE.Matrix: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.');\r\n\r\n    }\r\n\r\n    var te = this.elements;\r\n\r\n    var x = euler.x,\r\n      y = euler.y,\r\n      z = euler.z;\r\n    var a = Math.cos(x),\r\n      b = Math.sin(x);\r\n    var c = Math.cos(y),\r\n      d = Math.sin(y);\r\n    var e = Math.cos(z),\r\n      f = Math.sin(z);\r\n\r\n    if (euler.order === 'XYZ') {\r\n\r\n      var ae = a * e,\r\n        af = a * f,\r\n        be = b * e,\r\n        bf = b * f;\r\n\r\n      te[0] = c * e;\r\n      te[4] = -c * f;\r\n      te[8] = d;\r\n\r\n      te[1] = af + be * d;\r\n      te[5] = ae - bf * d;\r\n      te[9] = -b * c;\r\n\r\n      te[2] = bf - ae * d;\r\n      te[6] = be + af * d;\r\n      te[10] = a * c;\r\n\r\n    }\r\n    else if (euler.order === 'YXZ') {\r\n\r\n      var ce = c * e,\r\n        cf = c * f,\r\n        de = d * e,\r\n        df = d * f;\r\n\r\n      te[0] = ce + df * b;\r\n      te[4] = de * b - cf;\r\n      te[8] = a * d;\r\n\r\n      te[1] = a * f;\r\n      te[5] = a * e;\r\n      te[9] = -b;\r\n\r\n      te[2] = cf * b - de;\r\n      te[6] = df + ce * b;\r\n      te[10] = a * c;\r\n\r\n    }\r\n    else if (euler.order === 'ZXY') {\r\n\r\n      var ce = c * e,\r\n        cf = c * f,\r\n        de = d * e,\r\n        df = d * f;\r\n\r\n      te[0] = ce - df * b;\r\n      te[4] = -a * f;\r\n      te[8] = de + cf * b;\r\n\r\n      te[1] = cf + de * b;\r\n      te[5] = a * e;\r\n      te[9] = df - ce * b;\r\n\r\n      te[2] = -a * d;\r\n      te[6] = b;\r\n      te[10] = a * c;\r\n\r\n    }\r\n    else if (euler.order === 'ZYX') {\r\n\r\n      var ae = a * e,\r\n        af = a * f,\r\n        be = b * e,\r\n        bf = b * f;\r\n\r\n      te[0] = c * e;\r\n      te[4] = be * d - af;\r\n      te[8] = ae * d + bf;\r\n\r\n      te[1] = c * f;\r\n      te[5] = bf * d + ae;\r\n      te[9] = af * d - be;\r\n\r\n      te[2] = -d;\r\n      te[6] = b * c;\r\n      te[10] = a * c;\r\n\r\n    }\r\n    else if (euler.order === 'YZX') {\r\n\r\n      var ac = a * c,\r\n        ad = a * d,\r\n        bc = b * c,\r\n        bd = b * d;\r\n\r\n      te[0] = c * e;\r\n      te[4] = bd - ac * f;\r\n      te[8] = bc * f + ad;\r\n\r\n      te[1] = f;\r\n      te[5] = a * e;\r\n      te[9] = -b * e;\r\n\r\n      te[2] = -d * e;\r\n      te[6] = ad * f + bc;\r\n      te[10] = ac - bd * f;\r\n\r\n    }\r\n    else if (euler.order === 'XZY') {\r\n\r\n      var ac = a * c,\r\n        ad = a * d,\r\n        bc = b * c,\r\n        bd = b * d;\r\n\r\n      te[0] = c * e;\r\n      te[4] = -f;\r\n      te[8] = d * e;\r\n\r\n      te[1] = ac * f + bd;\r\n      te[5] = a * e;\r\n      te[9] = ad * f - bc;\r\n\r\n      te[2] = bc * f - ad;\r\n      te[6] = b * e;\r\n      te[10] = bd * f + ac;\r\n\r\n    }\r\n\r\n    // last column\r\n    te[3] = 0;\r\n    te[7] = 0;\r\n    te[11] = 0;\r\n\r\n    // bottom row\r\n    te[12] = 0;\r\n    te[13] = 0;\r\n    te[14] = 0;\r\n    te[15] = 1;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  setRotationFromQuaternion: function(q) {\r\n\r\n    THREE.warn('THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion().');\r\n\r\n    return this.makeRotationFromQuaternion(q);\r\n\r\n  },\r\n\r\n  makeRotationFromQuaternion: function(q) {\r\n\r\n    var te = this.elements;\r\n\r\n    var x = q.x,\r\n      y = q.y,\r\n      z = q.z,\r\n      w = q.w;\r\n    var x2 = x + x,\r\n      y2 = y + y,\r\n      z2 = z + z;\r\n    var xx = x * x2,\r\n      xy = x * y2,\r\n      xz = x * z2;\r\n    var yy = y * y2,\r\n      yz = y * z2,\r\n      zz = z * z2;\r\n    var wx = w * x2,\r\n      wy = w * y2,\r\n      wz = w * z2;\r\n\r\n    te[0] = 1 - (yy + zz);\r\n    te[4] = xy - wz;\r\n    te[8] = xz + wy;\r\n\r\n    te[1] = xy + wz;\r\n    te[5] = 1 - (xx + zz);\r\n    te[9] = yz - wx;\r\n\r\n    te[2] = xz - wy;\r\n    te[6] = yz + wx;\r\n    te[10] = 1 - (xx + yy);\r\n\r\n    // last column\r\n    te[3] = 0;\r\n    te[7] = 0;\r\n    te[11] = 0;\r\n\r\n    // bottom row\r\n    te[12] = 0;\r\n    te[13] = 0;\r\n    te[14] = 0;\r\n    te[15] = 1;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  lookAt: function() {\r\n\r\n    var x = new THREE.Vector3();\r\n    var y = new THREE.Vector3();\r\n    var z = new THREE.Vector3();\r\n\r\n    return function(eye, target, up) {\r\n\r\n      var te = this.elements;\r\n\r\n      z.subVectors(eye, target).normalize();\r\n\r\n      if (z.length() === 0) {\r\n\r\n        z.z = 1;\r\n\r\n      }\r\n\r\n      x.crossVectors(up, z).normalize();\r\n\r\n      if (x.length() === 0) {\r\n\r\n        z.x += 0.0001;\r\n        x.crossVectors(up, z).normalize();\r\n\r\n      }\r\n\r\n      y.crossVectors(z, x);\r\n\r\n\r\n      te[0] = x.x;\r\n      te[4] = y.x;\r\n      te[8] = z.x;\r\n      te[1] = x.y;\r\n      te[5] = y.y;\r\n      te[9] = z.y;\r\n      te[2] = x.z;\r\n      te[6] = y.z;\r\n      te[10] = z.z;\r\n\r\n      return this;\r\n\r\n    };\r\n\r\n  }(),\r\n\r\n  multiply: function(m, n) {\r\n\r\n    if (n !== undefined) {\r\n\r\n      THREE.warn('THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead.');\r\n      return this.multiplyMatrices(m, n);\r\n\r\n    }\r\n\r\n    return this.multiplyMatrices(this, m);\r\n\r\n  },\r\n\r\n  multiplyMatrices: function(a, b) {\r\n\r\n    var ae = a.elements;\r\n    var be = b.elements;\r\n    var te = this.elements;\r\n\r\n    var a11 = ae[0],\r\n      a12 = ae[4],\r\n      a13 = ae[8],\r\n      a14 = ae[12];\r\n    var a21 = ae[1],\r\n      a22 = ae[5],\r\n      a23 = ae[9],\r\n      a24 = ae[13];\r\n    var a31 = ae[2],\r\n      a32 = ae[6],\r\n      a33 = ae[10],\r\n      a34 = ae[14];\r\n    var a41 = ae[3],\r\n      a42 = ae[7],\r\n      a43 = ae[11],\r\n      a44 = ae[15];\r\n\r\n    var b11 = be[0],\r\n      b12 = be[4],\r\n      b13 = be[8],\r\n      b14 = be[12];\r\n    var b21 = be[1],\r\n      b22 = be[5],\r\n      b23 = be[9],\r\n      b24 = be[13];\r\n    var b31 = be[2],\r\n      b32 = be[6],\r\n      b33 = be[10],\r\n      b34 = be[14];\r\n    var b41 = be[3],\r\n      b42 = be[7],\r\n      b43 = be[11],\r\n      b44 = be[15];\r\n\r\n    te[0] = a11 * b11 + a12 * b21 + a13 * b31 + a14 * b41;\r\n    te[4] = a11 * b12 + a12 * b22 + a13 * b32 + a14 * b42;\r\n    te[8] = a11 * b13 + a12 * b23 + a13 * b33 + a14 * b43;\r\n    te[12] = a11 * b14 + a12 * b24 + a13 * b34 + a14 * b44;\r\n\r\n    te[1] = a21 * b11 + a22 * b21 + a23 * b31 + a24 * b41;\r\n    te[5] = a21 * b12 + a22 * b22 + a23 * b32 + a24 * b42;\r\n    te[9] = a21 * b13 + a22 * b23 + a23 * b33 + a24 * b43;\r\n    te[13] = a21 * b14 + a22 * b24 + a23 * b34 + a24 * b44;\r\n\r\n    te[2] = a31 * b11 + a32 * b21 + a33 * b31 + a34 * b41;\r\n    te[6] = a31 * b12 + a32 * b22 + a33 * b32 + a34 * b42;\r\n    te[10] = a31 * b13 + a32 * b23 + a33 * b33 + a34 * b43;\r\n    te[14] = a31 * b14 + a32 * b24 + a33 * b34 + a34 * b44;\r\n\r\n    te[3] = a41 * b11 + a42 * b21 + a43 * b31 + a44 * b41;\r\n    te[7] = a41 * b12 + a42 * b22 + a43 * b32 + a44 * b42;\r\n    te[11] = a41 * b13 + a42 * b23 + a43 * b33 + a44 * b43;\r\n    te[15] = a41 * b14 + a42 * b24 + a43 * b34 + a44 * b44;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  multiplyToArray: function(a, b, r) {\r\n\r\n    var te = this.elements;\r\n\r\n    this.multiplyMatrices(a, b);\r\n\r\n    r[0] = te[0];\r\n    r[1] = te[1];\r\n    r[2] = te[2];\r\n    r[3] = te[3];\r\n    r[4] = te[4];\r\n    r[5] = te[5];\r\n    r[6] = te[6];\r\n    r[7] = te[7];\r\n    r[8] = te[8];\r\n    r[9] = te[9];\r\n    r[10] = te[10];\r\n    r[11] = te[11];\r\n    r[12] = te[12];\r\n    r[13] = te[13];\r\n    r[14] = te[14];\r\n    r[15] = te[15];\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  multiplyScalar: function(s) {\r\n\r\n    var te = this.elements;\r\n\r\n    te[0] *= s;\r\n    te[4] *= s;\r\n    te[8] *= s;\r\n    te[12] *= s;\r\n    te[1] *= s;\r\n    te[5] *= s;\r\n    te[9] *= s;\r\n    te[13] *= s;\r\n    te[2] *= s;\r\n    te[6] *= s;\r\n    te[10] *= s;\r\n    te[14] *= s;\r\n    te[3] *= s;\r\n    te[7] *= s;\r\n    te[11] *= s;\r\n    te[15] *= s;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  multiplyVector3: function(vector) {\r\n\r\n    THREE.warn('THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) or vector.applyProjection( matrix ) instead.');\r\n    return vector.applyProjection(this);\r\n\r\n  },\r\n\r\n  multiplyVector4: function(vector) {\r\n\r\n    THREE.warn('THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead.');\r\n    return vector.applyMatrix4(this);\r\n\r\n  },\r\n\r\n  multiplyVector3Array: function(a) {\r\n\r\n    THREE.warn('THREE.Matrix4: .multiplyVector3Array() has been renamed. Use matrix.applyToVector3Array( array ) instead.');\r\n    return this.applyToVector3Array(a);\r\n\r\n  },\r\n\r\n  applyToVector3Array: function() {\r\n\r\n    var v1 = new THREE.Vector3();\r\n\r\n    return function(array, offset, length) {\r\n\r\n      if (offset === undefined) offset = 0;\r\n      if (length === undefined) length = array.length;\r\n\r\n      for (var i = 0, j = offset; i < length; i += 3, j += 3) {\r\n\r\n        v1.x = array[j];\r\n        v1.y = array[j + 1];\r\n        v1.z = array[j + 2];\r\n\r\n        v1.applyMatrix4(this);\r\n\r\n        array[j] = v1.x;\r\n        array[j + 1] = v1.y;\r\n        array[j + 2] = v1.z;\r\n\r\n      }\r\n\r\n      return array;\r\n\r\n    };\r\n\r\n  }(),\r\n\r\n  rotateAxis: function(v) {\r\n\r\n    THREE.warn('THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead.');\r\n\r\n    v.transformDirection(this);\r\n\r\n  },\r\n\r\n  crossVector: function(vector) {\r\n\r\n    THREE.warn('THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead.');\r\n    return vector.applyMatrix4(this);\r\n\r\n  },\r\n\r\n  determinant: function() {\r\n\r\n    var te = this.elements;\r\n\r\n    var n11 = te[0],\r\n      n12 = te[4],\r\n      n13 = te[8],\r\n      n14 = te[12];\r\n    var n21 = te[1],\r\n      n22 = te[5],\r\n      n23 = te[9],\r\n      n24 = te[13];\r\n    var n31 = te[2],\r\n      n32 = te[6],\r\n      n33 = te[10],\r\n      n34 = te[14];\r\n    var n41 = te[3],\r\n      n42 = te[7],\r\n      n43 = te[11],\r\n      n44 = te[15];\r\n\r\n    //TODO: make this more efficient\r\n    //( based on http://www.euclideanspace.com/maths/algebra/matrix/functions/inverse/fourD/index.htm )\r\n\r\n    return (\r\n      n41 * (+n14 * n23 * n32 - n13 * n24 * n32 - n14 * n22 * n33 + n12 * n24 * n33 + n13 * n22 * n34 - n12 * n23 * n34) +\r\n      n42 * (+n11 * n23 * n34 - n11 * n24 * n33 + n14 * n21 * n33 - n13 * n21 * n34 + n13 * n24 * n31 - n14 * n23 * n31) +\r\n      n43 * (+n11 * n24 * n32 - n11 * n22 * n34 - n14 * n21 * n32 + n12 * n21 * n34 + n14 * n22 * n31 - n12 * n24 * n31) +\r\n      n44 * (-n13 * n22 * n31 - n11 * n23 * n32 + n11 * n22 * n33 + n13 * n21 * n32 - n12 * n21 * n33 + n12 * n23 * n31)\r\n\r\n    );\r\n\r\n  },\r\n\r\n  transpose: function() {\r\n\r\n    var te = this.elements;\r\n    var tmp;\r\n\r\n    tmp = te[1];\r\n    te[1] = te[4];\r\n    te[4] = tmp;\r\n    tmp = te[2];\r\n    te[2] = te[8];\r\n    te[8] = tmp;\r\n    tmp = te[6];\r\n    te[6] = te[9];\r\n    te[9] = tmp;\r\n\r\n    tmp = te[3];\r\n    te[3] = te[12];\r\n    te[12] = tmp;\r\n    tmp = te[7];\r\n    te[7] = te[13];\r\n    te[13] = tmp;\r\n    tmp = te[11];\r\n    te[11] = te[14];\r\n    te[14] = tmp;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  flattenToArrayOffset: function(array, offset) {\r\n\r\n    var te = this.elements;\r\n\r\n    array[offset] = te[0];\r\n    array[offset + 1] = te[1];\r\n    array[offset + 2] = te[2];\r\n    array[offset + 3] = te[3];\r\n\r\n    array[offset + 4] = te[4];\r\n    array[offset + 5] = te[5];\r\n    array[offset + 6] = te[6];\r\n    array[offset + 7] = te[7];\r\n\r\n    array[offset + 8] = te[8];\r\n    array[offset + 9] = te[9];\r\n    array[offset + 10] = te[10];\r\n    array[offset + 11] = te[11];\r\n\r\n    array[offset + 12] = te[12];\r\n    array[offset + 13] = te[13];\r\n    array[offset + 14] = te[14];\r\n    array[offset + 15] = te[15];\r\n\r\n    return array;\r\n\r\n  },\r\n\r\n  getPosition: function() {\r\n\r\n    var v1 = new THREE.Vector3();\r\n\r\n    return function() {\r\n\r\n      THREE.warn('THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead.');\r\n\r\n      var te = this.elements;\r\n      return v1.set(te[12], te[13], te[14]);\r\n\r\n    };\r\n\r\n  }(),\r\n\r\n  setPosition: function(v) {\r\n\r\n    var te = this.elements;\r\n\r\n    te[12] = v.x;\r\n    te[13] = v.y;\r\n    te[14] = v.z;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  getInverse: function(m, throwOnInvertible) {\r\n\r\n    // based on http://www.euclideanspace.com/maths/algebra/matrix/functions/inverse/fourD/index.htm\r\n    var te = this.elements;\r\n    var me = m.elements;\r\n\r\n    var n11 = me[0],\r\n      n12 = me[4],\r\n      n13 = me[8],\r\n      n14 = me[12];\r\n    var n21 = me[1],\r\n      n22 = me[5],\r\n      n23 = me[9],\r\n      n24 = me[13];\r\n    var n31 = me[2],\r\n      n32 = me[6],\r\n      n33 = me[10],\r\n      n34 = me[14];\r\n    var n41 = me[3],\r\n      n42 = me[7],\r\n      n43 = me[11],\r\n      n44 = me[15];\r\n\r\n    te[0] = n23 * n34 * n42 - n24 * n33 * n42 + n24 * n32 * n43 - n22 * n34 * n43 - n23 * n32 * n44 + n22 * n33 * n44;\r\n    te[4] = n14 * n33 * n42 - n13 * n34 * n42 - n14 * n32 * n43 + n12 * n34 * n43 + n13 * n32 * n44 - n12 * n33 * n44;\r\n    te[8] = n13 * n24 * n42 - n14 * n23 * n42 + n14 * n22 * n43 - n12 * n24 * n43 - n13 * n22 * n44 + n12 * n23 * n44;\r\n    te[12] = n14 * n23 * n32 - n13 * n24 * n32 - n14 * n22 * n33 + n12 * n24 * n33 + n13 * n22 * n34 - n12 * n23 * n34;\r\n    te[1] = n24 * n33 * n41 - n23 * n34 * n41 - n24 * n31 * n43 + n21 * n34 * n43 + n23 * n31 * n44 - n21 * n33 * n44;\r\n    te[5] = n13 * n34 * n41 - n14 * n33 * n41 + n14 * n31 * n43 - n11 * n34 * n43 - n13 * n31 * n44 + n11 * n33 * n44;\r\n    te[9] = n14 * n23 * n41 - n13 * n24 * n41 - n14 * n21 * n43 + n11 * n24 * n43 + n13 * n21 * n44 - n11 * n23 * n44;\r\n    te[13] = n13 * n24 * n31 - n14 * n23 * n31 + n14 * n21 * n33 - n11 * n24 * n33 - n13 * n21 * n34 + n11 * n23 * n34;\r\n    te[2] = n22 * n34 * n41 - n24 * n32 * n41 + n24 * n31 * n42 - n21 * n34 * n42 - n22 * n31 * n44 + n21 * n32 * n44;\r\n    te[6] = n14 * n32 * n41 - n12 * n34 * n41 - n14 * n31 * n42 + n11 * n34 * n42 + n12 * n31 * n44 - n11 * n32 * n44;\r\n    te[10] = n12 * n24 * n41 - n14 * n22 * n41 + n14 * n21 * n42 - n11 * n24 * n42 - n12 * n21 * n44 + n11 * n22 * n44;\r\n    te[14] = n14 * n22 * n31 - n12 * n24 * n31 - n14 * n21 * n32 + n11 * n24 * n32 + n12 * n21 * n34 - n11 * n22 * n34;\r\n    te[3] = n23 * n32 * n41 - n22 * n33 * n41 - n23 * n31 * n42 + n21 * n33 * n42 + n22 * n31 * n43 - n21 * n32 * n43;\r\n    te[7] = n12 * n33 * n41 - n13 * n32 * n41 + n13 * n31 * n42 - n11 * n33 * n42 - n12 * n31 * n43 + n11 * n32 * n43;\r\n    te[11] = n13 * n22 * n41 - n12 * n23 * n41 - n13 * n21 * n42 + n11 * n23 * n42 + n12 * n21 * n43 - n11 * n22 * n43;\r\n    te[15] = n12 * n23 * n31 - n13 * n22 * n31 + n13 * n21 * n32 - n11 * n23 * n32 - n12 * n21 * n33 + n11 * n22 * n33;\r\n\r\n    var det = n11 * te[0] + n21 * te[4] + n31 * te[8] + n41 * te[12];\r\n\r\n    if (det == 0) {\r\n\r\n      var msg = \"THREE.Matrix4.getInverse(): can't invert matrix, determinant is 0\";\r\n\r\n      if (throwOnInvertible || false) {\r\n\r\n        throw new Error(msg);\r\n\r\n      }\r\n      else {\r\n\r\n        THREE.warn(msg);\r\n\r\n      }\r\n\r\n      this.identity();\r\n\r\n      return this;\r\n    }\r\n\r\n    this.multiplyScalar(1 / det);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  translate: function(v) {\r\n\r\n    THREE.error('THREE.Matrix4: .translate() has been removed.');\r\n\r\n  },\r\n\r\n  rotateX: function(angle) {\r\n\r\n    THREE.error('THREE.Matrix4: .rotateX() has been removed.');\r\n\r\n  },\r\n\r\n  rotateY: function(angle) {\r\n\r\n    THREE.error('THREE.Matrix4: .rotateY() has been removed.');\r\n\r\n  },\r\n\r\n  rotateZ: function(angle) {\r\n\r\n    THREE.error('THREE.Matrix4: .rotateZ() has been removed.');\r\n\r\n  },\r\n\r\n  rotateByAxis: function(axis, angle) {\r\n\r\n    THREE.error('THREE.Matrix4: .rotateByAxis() has been removed.');\r\n\r\n  },\r\n\r\n  scale: function(v) {\r\n\r\n    var te = this.elements;\r\n    var x = v.x,\r\n      y = v.y,\r\n      z = v.z;\r\n\r\n    te[0] *= x;\r\n    te[4] *= y;\r\n    te[8] *= z;\r\n    te[1] *= x;\r\n    te[5] *= y;\r\n    te[9] *= z;\r\n    te[2] *= x;\r\n    te[6] *= y;\r\n    te[10] *= z;\r\n    te[3] *= x;\r\n    te[7] *= y;\r\n    te[11] *= z;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  getMaxScaleOnAxis: function() {\r\n\r\n    var te = this.elements;\r\n\r\n    var scaleXSq = te[0] * te[0] + te[1] * te[1] + te[2] * te[2];\r\n    var scaleYSq = te[4] * te[4] + te[5] * te[5] + te[6] * te[6];\r\n    var scaleZSq = te[8] * te[8] + te[9] * te[9] + te[10] * te[10];\r\n\r\n    return Math.sqrt(Math.max(scaleXSq, Math.max(scaleYSq, scaleZSq)));\r\n\r\n  },\r\n\r\n  makeTranslation: function(x, y, z) {\r\n\r\n    this.set(\r\n\r\n      1, 0, 0, x,\r\n      0, 1, 0, y,\r\n      0, 0, 1, z,\r\n      0, 0, 0, 1\r\n\r\n    );\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  makeRotationX: function(theta) {\r\n\r\n    var c = Math.cos(theta),\r\n      s = Math.sin(theta);\r\n\r\n    this.set(\r\n\r\n      1, 0, 0, 0,\r\n      0, c, -s, 0,\r\n      0, s, c, 0,\r\n      0, 0, 0, 1\r\n\r\n    );\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  makeRotationY: function(theta) {\r\n\r\n    var c = Math.cos(theta),\r\n      s = Math.sin(theta);\r\n\r\n    this.set(\r\n\r\n      c, 0, s, 0,\r\n      0, 1, 0, 0, -s, 0, c, 0,\r\n      0, 0, 0, 1\r\n\r\n    );\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  makeRotationZ: function(theta) {\r\n\r\n    var c = Math.cos(theta),\r\n      s = Math.sin(theta);\r\n\r\n    this.set(\r\n\r\n      c, -s, 0, 0,\r\n      s, c, 0, 0,\r\n      0, 0, 1, 0,\r\n      0, 0, 0, 1\r\n\r\n    );\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  makeRotationAxis: function(axis, angle) {\r\n\r\n    // Based on http://www.gamedev.net/reference/articles/article1199.asp\r\n\r\n    var c = Math.cos(angle);\r\n    var s = Math.sin(angle);\r\n    var t = 1 - c;\r\n    var x = axis.x,\r\n      y = axis.y,\r\n      z = axis.z;\r\n    var tx = t * x,\r\n      ty = t * y;\r\n\r\n    this.set(\r\n\r\n      tx * x + c, tx * y - s * z, tx * z + s * y, 0,\r\n      tx * y + s * z, ty * y + c, ty * z - s * x, 0,\r\n      tx * z - s * y, ty * z + s * x, t * z * z + c, 0,\r\n      0, 0, 0, 1\r\n\r\n    );\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  makeScale: function(x, y, z) {\r\n\r\n    this.set(\r\n\r\n      x, 0, 0, 0,\r\n      0, y, 0, 0,\r\n      0, 0, z, 0,\r\n      0, 0, 0, 1\r\n\r\n    );\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  compose: function(position, quaternion, scale) {\r\n\r\n    this.makeRotationFromQuaternion(quaternion);\r\n    this.scale(scale);\r\n    this.setPosition(position);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  decompose: function() {\r\n\r\n    var vector = new THREE.Vector3();\r\n    var matrix = new THREE.Matrix4();\r\n\r\n    return function(position, quaternion, scale) {\r\n\r\n      var te = this.elements;\r\n\r\n      var sx = vector.set(te[0], te[1], te[2]).length();\r\n      var sy = vector.set(te[4], te[5], te[6]).length();\r\n      var sz = vector.set(te[8], te[9], te[10]).length();\r\n\r\n      // if determine is negative, we need to invert one scale\r\n      var det = this.determinant();\r\n      if (det < 0) {\r\n        sx = -sx;\r\n      }\r\n\r\n      position.x = te[12];\r\n      position.y = te[13];\r\n      position.z = te[14];\r\n\r\n      // scale the rotation part\r\n\r\n      matrix.elements.set(this.elements); // at this point matrix is incomplete so we can't use .copy()\r\n\r\n      var invSX = 1 / sx;\r\n      var invSY = 1 / sy;\r\n      var invSZ = 1 / sz;\r\n\r\n      matrix.elements[0] *= invSX;\r\n      matrix.elements[1] *= invSX;\r\n      matrix.elements[2] *= invSX;\r\n\r\n      matrix.elements[4] *= invSY;\r\n      matrix.elements[5] *= invSY;\r\n      matrix.elements[6] *= invSY;\r\n\r\n      matrix.elements[8] *= invSZ;\r\n      matrix.elements[9] *= invSZ;\r\n      matrix.elements[10] *= invSZ;\r\n\r\n      quaternion.setFromRotationMatrix(matrix);\r\n\r\n      scale.x = sx;\r\n      scale.y = sy;\r\n      scale.z = sz;\r\n\r\n      return this;\r\n\r\n    };\r\n\r\n  }(),\r\n\r\n  makeFrustum: function(left, right, bottom, top, near, far) {\r\n\r\n    var te = this.elements;\r\n    var x = 2 * near / (right - left);\r\n    var y = 2 * near / (top - bottom);\r\n\r\n    var a = (right + left) / (right - left);\r\n    var b = (top + bottom) / (top - bottom);\r\n    var c = -(far + near) / (far - near);\r\n    var d = -2 * far * near / (far - near);\r\n\r\n    te[0] = x;\r\n    te[4] = 0;\r\n    te[8] = a;\r\n    te[12] = 0;\r\n    te[1] = 0;\r\n    te[5] = y;\r\n    te[9] = b;\r\n    te[13] = 0;\r\n    te[2] = 0;\r\n    te[6] = 0;\r\n    te[10] = c;\r\n    te[14] = d;\r\n    te[3] = 0;\r\n    te[7] = 0;\r\n    te[11] = -1;\r\n    te[15] = 0;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  makePerspective: function(fov, aspect, near, far) {\r\n\r\n    var ymax = near * Math.tan(THREE.Math.degToRad(fov * 0.5));\r\n    var ymin = -ymax;\r\n    var xmin = ymin * aspect;\r\n    var xmax = ymax * aspect;\r\n\r\n    return this.makeFrustum(xmin, xmax, ymin, ymax, near, far);\r\n\r\n  },\r\n\r\n  makeOrthographic: function(left, right, top, bottom, near, far) {\r\n\r\n    var te = this.elements;\r\n    var w = right - left;\r\n    var h = top - bottom;\r\n    var p = far - near;\r\n\r\n    var x = (right + left) / w;\r\n    var y = (top + bottom) / h;\r\n    var z = (far + near) / p;\r\n\r\n    te[0] = 2 / w;\r\n    te[4] = 0;\r\n    te[8] = 0;\r\n    te[12] = -x;\r\n    te[1] = 0;\r\n    te[5] = 2 / h;\r\n    te[9] = 0;\r\n    te[13] = -y;\r\n    te[2] = 0;\r\n    te[6] = 0;\r\n    te[10] = -2 / p;\r\n    te[14] = -z;\r\n    te[3] = 0;\r\n    te[7] = 0;\r\n    te[11] = 0;\r\n    te[15] = 1;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  fromArray: function(array) {\r\n\r\n    this.elements.set(array);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  toArray: function() {\r\n\r\n    var te = this.elements;\r\n\r\n    return [\r\n      te[0], te[1], te[2], te[3],\r\n      te[4], te[5], te[6], te[7],\r\n      te[8], te[9], te[10], te[11],\r\n      te[12], te[13], te[14], te[15]\r\n    ];\r\n\r\n  },\r\n\r\n  clone: function() {\r\n\r\n    return new THREE.Matrix4().fromArray(this.elements);\r\n\r\n  }\r\n\r\n};\r\n\r\n// File:src/math/Ray.js\r\n\r\n/**\r\n * @author bhouston / http://exocortex.com\r\n */\r\n\r\nTHREE.Ray = function(origin, direction) {\r\n\r\n  this.origin = (origin !== undefined) ? origin : new THREE.Vector3();\r\n  this.direction = (direction !== undefined) ? direction : new THREE.Vector3();\r\n\r\n};\r\n\r\nTHREE.Ray.prototype = {\r\n\r\n  constructor: THREE.Ray,\r\n\r\n  set: function(origin, direction) {\r\n\r\n    this.origin.copy(origin);\r\n    this.direction.copy(direction);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  copy: function(ray) {\r\n\r\n    this.origin.copy(ray.origin);\r\n    this.direction.copy(ray.direction);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  at: function(t, optionalTarget) {\r\n\r\n    var result = optionalTarget || new THREE.Vector3();\r\n\r\n    return result.copy(this.direction).multiplyScalar(t).add(this.origin);\r\n\r\n  },\r\n\r\n  recast: function() {\r\n\r\n    var v1 = new THREE.Vector3();\r\n\r\n    return function(t) {\r\n\r\n      this.origin.copy(this.at(t, v1));\r\n\r\n      return this;\r\n\r\n    };\r\n\r\n  }(),\r\n\r\n  closestPointToPoint: function(point, optionalTarget) {\r\n\r\n    var result = optionalTarget || new THREE.Vector3();\r\n    result.subVectors(point, this.origin);\r\n    var directionDistance = result.dot(this.direction);\r\n\r\n    if (directionDistance < 0) {\r\n\r\n      return result.copy(this.origin);\r\n\r\n    }\r\n\r\n    return result.copy(this.direction).multiplyScalar(directionDistance).add(this.origin);\r\n\r\n  },\r\n\r\n  distanceToPoint: function() {\r\n\r\n    var v1 = new THREE.Vector3();\r\n\r\n    return function(point) {\r\n\r\n      var directionDistance = v1.subVectors(point, this.origin).dot(this.direction);\r\n\r\n      // point behind the ray\r\n\r\n      if (directionDistance < 0) {\r\n\r\n        return this.origin.distanceTo(point);\r\n\r\n      }\r\n\r\n      v1.copy(this.direction).multiplyScalar(directionDistance).add(this.origin);\r\n\r\n      return v1.distanceTo(point);\r\n\r\n    };\r\n\r\n  }(),\r\n\r\n  distanceSqToSegment: function() {\r\n\r\n    var segCenter = new THREE.Vector3();\r\n    var segDir = new THREE.Vector3();\r\n    var diff = new THREE.Vector3();\r\n\r\n    return function(v0, v1, optionalPointOnRay, optionalPointOnSegment) {\r\n\r\n      // from http://www.geometrictools.com/LibMathematics/Distance/Wm5DistRay3Segment3.cpp\r\n      // It returns the min distance between the ray and the segment\r\n      // defined by v0 and v1\r\n      // It can also set two optional targets :\r\n      // - The closest point on the ray\r\n      // - The closest point on the segment\r\n\r\n      segCenter.copy(v0).add(v1).multiplyScalar(0.5);\r\n      segDir.copy(v1).sub(v0).normalize();\r\n      diff.copy(this.origin).sub(segCenter);\r\n\r\n      var segExtent = v0.distanceTo(v1) * 0.5;\r\n      var a01 = -this.direction.dot(segDir);\r\n      var b0 = diff.dot(this.direction);\r\n      var b1 = -diff.dot(segDir);\r\n      var c = diff.lengthSq();\r\n      var det = Math.abs(1 - a01 * a01);\r\n      var s0, s1, sqrDist, extDet;\r\n\r\n      if (det > 0) {\r\n\r\n        // The ray and segment are not parallel.\r\n\r\n        s0 = a01 * b1 - b0;\r\n        s1 = a01 * b0 - b1;\r\n        extDet = segExtent * det;\r\n\r\n        if (s0 >= 0) {\r\n\r\n          if (s1 >= -extDet) {\r\n\r\n            if (s1 <= extDet) {\r\n\r\n              // region 0\r\n              // Minimum at interior points of ray and segment.\r\n\r\n              var invDet = 1 / det;\r\n              s0 *= invDet;\r\n              s1 *= invDet;\r\n              sqrDist = s0 * (s0 + a01 * s1 + 2 * b0) + s1 * (a01 * s0 + s1 + 2 * b1) + c;\r\n\r\n            }\r\n            else {\r\n\r\n              // region 1\r\n\r\n              s1 = segExtent;\r\n              s0 = Math.max(0, -(a01 * s1 + b0));\r\n              sqrDist = -s0 * s0 + s1 * (s1 + 2 * b1) + c;\r\n\r\n            }\r\n\r\n          }\r\n          else {\r\n\r\n            // region 5\r\n\r\n            s1 = -segExtent;\r\n            s0 = Math.max(0, -(a01 * s1 + b0));\r\n            sqrDist = -s0 * s0 + s1 * (s1 + 2 * b1) + c;\r\n\r\n          }\r\n\r\n        }\r\n        else {\r\n\r\n          if (s1 <= -extDet) {\r\n\r\n            // region 4\r\n\r\n            s0 = Math.max(0, -(-a01 * segExtent + b0));\r\n            s1 = (s0 > 0) ? -segExtent : Math.min(Math.max(-segExtent, -b1), segExtent);\r\n            sqrDist = -s0 * s0 + s1 * (s1 + 2 * b1) + c;\r\n\r\n          }\r\n          else if (s1 <= extDet) {\r\n\r\n            // region 3\r\n\r\n            s0 = 0;\r\n            s1 = Math.min(Math.max(-segExtent, -b1), segExtent);\r\n            sqrDist = s1 * (s1 + 2 * b1) + c;\r\n\r\n          }\r\n          else {\r\n\r\n            // region 2\r\n\r\n            s0 = Math.max(0, -(a01 * segExtent + b0));\r\n            s1 = (s0 > 0) ? segExtent : Math.min(Math.max(-segExtent, -b1), segExtent);\r\n            sqrDist = -s0 * s0 + s1 * (s1 + 2 * b1) + c;\r\n\r\n          }\r\n\r\n        }\r\n\r\n      }\r\n      else {\r\n\r\n        // Ray and segment are parallel.\r\n\r\n        s1 = (a01 > 0) ? -segExtent : segExtent;\r\n        s0 = Math.max(0, -(a01 * s1 + b0));\r\n        sqrDist = -s0 * s0 + s1 * (s1 + 2 * b1) + c;\r\n\r\n      }\r\n\r\n      if (optionalPointOnRay) {\r\n\r\n        optionalPointOnRay.copy(this.direction).multiplyScalar(s0).add(this.origin);\r\n\r\n      }\r\n\r\n      if (optionalPointOnSegment) {\r\n\r\n        optionalPointOnSegment.copy(segDir).multiplyScalar(s1).add(segCenter);\r\n\r\n      }\r\n\r\n      return sqrDist;\r\n\r\n    };\r\n\r\n  }(),\r\n\r\n\r\n  isIntersectionSphere: function(sphere) {\r\n\r\n    return this.distanceToPoint(sphere.center) <= sphere.radius;\r\n\r\n  },\r\n\r\n  intersectSphere: function() {\r\n\r\n    // from http://www.scratchapixel.com/lessons/3d-basic-lessons/lesson-7-intersecting-simple-shapes/ray-sphere-intersection/\r\n\r\n    var v1 = new THREE.Vector3();\r\n\r\n    return function(sphere, optionalTarget) {\r\n\r\n      v1.subVectors(sphere.center, this.origin);\r\n\r\n      var tca = v1.dot(this.direction);\r\n\r\n      var d2 = v1.dot(v1) - tca * tca;\r\n\r\n      var radius2 = sphere.radius * sphere.radius;\r\n\r\n      if (d2 > radius2) return null;\r\n\r\n      var thc = Math.sqrt(radius2 - d2);\r\n\r\n      // t0 = first intersect point - entrance on front of sphere\r\n      var t0 = tca - thc;\r\n\r\n      // t1 = second intersect point - exit point on back of sphere\r\n      var t1 = tca + thc;\r\n\r\n      // test to see if both t0 and t1 are behind the ray - if so, return null\r\n      if (t0 < 0 && t1 < 0) return null;\r\n\r\n      // test to see if t0 is behind the ray:\r\n      // if it is, the ray is inside the sphere, so return the second exit point scaled by t1,\r\n      // in order to always return an intersect point that is in front of the ray.\r\n      if (t0 < 0) return this.at(t1, optionalTarget);\r\n\r\n      // else t0 is in front of the ray, so return the first collision point scaled by t0 \r\n      return this.at(t0, optionalTarget);\r\n\r\n    }\r\n\r\n  }(),\r\n\r\n  isIntersectionPlane: function(plane) {\r\n\r\n    // check if the ray lies on the plane first\r\n\r\n    var distToPoint = plane.distanceToPoint(this.origin);\r\n\r\n    if (distToPoint === 0) {\r\n\r\n      return true;\r\n\r\n    }\r\n\r\n    var denominator = plane.normal.dot(this.direction);\r\n\r\n    if (denominator * distToPoint < 0) {\r\n\r\n      return true;\r\n\r\n    }\r\n\r\n    // ray origin is behind the plane (and is pointing behind it)\r\n\r\n    return false;\r\n\r\n  },\r\n\r\n  distanceToPlane: function(plane) {\r\n\r\n    var denominator = plane.normal.dot(this.direction);\r\n    if (denominator == 0) {\r\n\r\n      // line is coplanar, return origin\r\n      if (plane.distanceToPoint(this.origin) == 0) {\r\n\r\n        return 0;\r\n\r\n      }\r\n\r\n      // Null is preferable to undefined since undefined means.... it is undefined\r\n\r\n      return null;\r\n\r\n    }\r\n\r\n    var t = -(this.origin.dot(plane.normal) + plane.constant) / denominator;\r\n\r\n    // Return if the ray never intersects the plane\r\n\r\n    return t >= 0 ? t : null;\r\n\r\n  },\r\n\r\n  intersectPlane: function(plane, optionalTarget) {\r\n\r\n    var t = this.distanceToPlane(plane);\r\n\r\n    if (t === null) {\r\n\r\n      return null;\r\n    }\r\n\r\n    return this.at(t, optionalTarget);\r\n\r\n  },\r\n\r\n  isIntersectionBox: function() {\r\n\r\n    var v = new THREE.Vector3();\r\n\r\n    return function(box) {\r\n\r\n      return this.intersectBox(box, v) !== null;\r\n\r\n    };\r\n\r\n  }(),\r\n\r\n  intersectBox: function(box, optionalTarget) {\r\n\r\n    // http://www.scratchapixel.com/lessons/3d-basic-lessons/lesson-7-intersecting-simple-shapes/ray-box-intersection/\r\n\r\n    var tmin, tmax, tymin, tymax, tzmin, tzmax;\r\n\r\n    var invdirx = 1 / this.direction.x,\r\n      invdiry = 1 / this.direction.y,\r\n      invdirz = 1 / this.direction.z;\r\n\r\n    var origin = this.origin;\r\n\r\n    if (invdirx >= 0) {\r\n\r\n      tmin = (box.min.x - origin.x) * invdirx;\r\n      tmax = (box.max.x - origin.x) * invdirx;\r\n\r\n    }\r\n    else {\r\n\r\n      tmin = (box.max.x - origin.x) * invdirx;\r\n      tmax = (box.min.x - origin.x) * invdirx;\r\n    }\r\n\r\n    if (invdiry >= 0) {\r\n\r\n      tymin = (box.min.y - origin.y) * invdiry;\r\n      tymax = (box.max.y - origin.y) * invdiry;\r\n\r\n    }\r\n    else {\r\n\r\n      tymin = (box.max.y - origin.y) * invdiry;\r\n      tymax = (box.min.y - origin.y) * invdiry;\r\n    }\r\n\r\n    if ((tmin > tymax) || (tymin > tmax)) return null;\r\n\r\n    // These lines also handle the case where tmin or tmax is NaN\r\n    // (result of 0 * Infinity). x !== x returns true if x is NaN\r\n\r\n    if (tymin > tmin || tmin !== tmin) tmin = tymin;\r\n\r\n    if (tymax < tmax || tmax !== tmax) tmax = tymax;\r\n\r\n    if (invdirz >= 0) {\r\n\r\n      tzmin = (box.min.z - origin.z) * invdirz;\r\n      tzmax = (box.max.z - origin.z) * invdirz;\r\n\r\n    }\r\n    else {\r\n\r\n      tzmin = (box.max.z - origin.z) * invdirz;\r\n      tzmax = (box.min.z - origin.z) * invdirz;\r\n    }\r\n\r\n    if ((tmin > tzmax) || (tzmin > tmax)) return null;\r\n\r\n    if (tzmin > tmin || tmin !== tmin) tmin = tzmin;\r\n\r\n    if (tzmax < tmax || tmax !== tmax) tmax = tzmax;\r\n\r\n    //return point closest to the ray (positive side)\r\n\r\n    if (tmax < 0) return null;\r\n\r\n    return this.at(tmin >= 0 ? tmin : tmax, optionalTarget);\r\n\r\n  },\r\n\r\n  intersectTriangle: function() {\r\n\r\n    // Compute the offset origin, edges, and normal.\r\n    var diff = new THREE.Vector3();\r\n    var edge1 = new THREE.Vector3();\r\n    var edge2 = new THREE.Vector3();\r\n    var normal = new THREE.Vector3();\r\n\r\n    return function(a, b, c, backfaceCulling, optionalTarget) {\r\n\r\n      // from http://www.geometrictools.com/LibMathematics/Intersection/Wm5IntrRay3Triangle3.cpp\r\n\r\n      edge1.subVectors(b, a);\r\n      edge2.subVectors(c, a);\r\n      normal.crossVectors(edge1, edge2);\r\n\r\n      // Solve Q + t*D = b1*E1 + b2*E2 (Q = kDiff, D = ray direction,\r\n      // E1 = kEdge1, E2 = kEdge2, N = Cross(E1,E2)) by\r\n      //   |Dot(D,N)|*b1 = sign(Dot(D,N))*Dot(D,Cross(Q,E2))\r\n      //   |Dot(D,N)|*b2 = sign(Dot(D,N))*Dot(D,Cross(E1,Q))\r\n      //   |Dot(D,N)|*t = -sign(Dot(D,N))*Dot(Q,N)\r\n      var DdN = this.direction.dot(normal);\r\n      var sign;\r\n\r\n      if (DdN > 0) {\r\n\r\n        if (backfaceCulling) return null;\r\n        sign = 1;\r\n\r\n      }\r\n      else if (DdN < 0) {\r\n\r\n        sign = -1;\r\n        DdN = -DdN;\r\n\r\n      }\r\n      else {\r\n\r\n        return null;\r\n\r\n      }\r\n\r\n      diff.subVectors(this.origin, a);\r\n      var DdQxE2 = sign * this.direction.dot(edge2.crossVectors(diff, edge2));\r\n\r\n      // b1 < 0, no intersection\r\n      if (DdQxE2 < 0) {\r\n\r\n        return null;\r\n\r\n      }\r\n\r\n      var DdE1xQ = sign * this.direction.dot(edge1.cross(diff));\r\n\r\n      // b2 < 0, no intersection\r\n      if (DdE1xQ < 0) {\r\n\r\n        return null;\r\n\r\n      }\r\n\r\n      // b1+b2 > 1, no intersection\r\n      if (DdQxE2 + DdE1xQ > DdN) {\r\n\r\n        return null;\r\n\r\n      }\r\n\r\n      // Line intersects triangle, check if ray does.\r\n      var QdN = -sign * diff.dot(normal);\r\n\r\n      // t < 0, no intersection\r\n      if (QdN < 0) {\r\n\r\n        return null;\r\n\r\n      }\r\n\r\n      // Ray intersects triangle.\r\n      return this.at(QdN / DdN, optionalTarget);\r\n\r\n    };\r\n\r\n  }(),\r\n\r\n  applyMatrix4: function(matrix4) {\r\n\r\n    this.direction.add(this.origin).applyMatrix4(matrix4);\r\n    this.origin.applyMatrix4(matrix4);\r\n    this.direction.sub(this.origin);\r\n    this.direction.normalize();\r\n\r\n    return this;\r\n  },\r\n\r\n  equals: function(ray) {\r\n\r\n    return ray.origin.equals(this.origin) && ray.direction.equals(this.direction);\r\n\r\n  },\r\n\r\n  clone: function() {\r\n\r\n    return new THREE.Ray().copy(this);\r\n\r\n  }\r\n\r\n};\r\n\r\n// File:src/math/Sphere.js\r\n\r\n/**\r\n * @author bhouston / http://exocortex.com\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.Sphere = function(center, radius) {\r\n\r\n  this.center = (center !== undefined) ? center : new THREE.Vector3();\r\n  this.radius = (radius !== undefined) ? radius : 0;\r\n\r\n};\r\n\r\nTHREE.Sphere.prototype = {\r\n\r\n  constructor: THREE.Sphere,\r\n\r\n  set: function(center, radius) {\r\n\r\n    this.center.copy(center);\r\n    this.radius = radius;\r\n\r\n    return this;\r\n  },\r\n\r\n  setFromPoints: function() {\r\n\r\n    var box = new THREE.Box3();\r\n\r\n    return function(points, optionalCenter) {\r\n\r\n      var center = this.center;\r\n\r\n      if (optionalCenter !== undefined) {\r\n\r\n        center.copy(optionalCenter);\r\n\r\n      }\r\n      else {\r\n\r\n        box.setFromPoints(points).center(center);\r\n\r\n      }\r\n\r\n      var maxRadiusSq = 0;\r\n\r\n      for (var i = 0, il = points.length; i < il; i++) {\r\n\r\n        maxRadiusSq = Math.max(maxRadiusSq, center.distanceToSquared(points[i]));\r\n\r\n      }\r\n\r\n      this.radius = Math.sqrt(maxRadiusSq);\r\n\r\n      return this;\r\n\r\n    };\r\n\r\n  }(),\r\n\r\n  copy: function(sphere) {\r\n\r\n    this.center.copy(sphere.center);\r\n    this.radius = sphere.radius;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  empty: function() {\r\n\r\n    return (this.radius <= 0);\r\n\r\n  },\r\n\r\n  containsPoint: function(point) {\r\n\r\n    return (point.distanceToSquared(this.center) <= (this.radius * this.radius));\r\n\r\n  },\r\n\r\n  distanceToPoint: function(point) {\r\n\r\n    return (point.distanceTo(this.center) - this.radius);\r\n\r\n  },\r\n\r\n  intersectsSphere: function(sphere) {\r\n\r\n    var radiusSum = this.radius + sphere.radius;\r\n\r\n    return sphere.center.distanceToSquared(this.center) <= (radiusSum * radiusSum);\r\n\r\n  },\r\n\r\n  clampPoint: function(point, optionalTarget) {\r\n\r\n    var deltaLengthSq = this.center.distanceToSquared(point);\r\n\r\n    var result = optionalTarget || new THREE.Vector3();\r\n    result.copy(point);\r\n\r\n    if (deltaLengthSq > (this.radius * this.radius)) {\r\n\r\n      result.sub(this.center).normalize();\r\n      result.multiplyScalar(this.radius).add(this.center);\r\n\r\n    }\r\n\r\n    return result;\r\n\r\n  },\r\n\r\n  getBoundingBox: function(optionalTarget) {\r\n\r\n    var box = optionalTarget || new THREE.Box3();\r\n\r\n    box.set(this.center, this.center);\r\n    box.expandByScalar(this.radius);\r\n\r\n    return box;\r\n\r\n  },\r\n\r\n  applyMatrix4: function(matrix) {\r\n\r\n    this.center.applyMatrix4(matrix);\r\n    this.radius = this.radius * matrix.getMaxScaleOnAxis();\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  translate: function(offset) {\r\n\r\n    this.center.add(offset);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  equals: function(sphere) {\r\n\r\n    return sphere.center.equals(this.center) && (sphere.radius === this.radius);\r\n\r\n  },\r\n\r\n  clone: function() {\r\n\r\n    return new THREE.Sphere().copy(this);\r\n\r\n  }\r\n\r\n};\r\n\r\n// File:src/math/Frustum.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author alteredq / http://alteredqualia.com/\r\n * @author bhouston / http://exocortex.com\r\n */\r\n\r\nTHREE.Frustum = function(p0, p1, p2, p3, p4, p5) {\r\n\r\n  this.planes = [\r\n\r\n    (p0 !== undefined) ? p0 : new THREE.Plane(), (p1 !== undefined) ? p1 : new THREE.Plane(), (p2 !== undefined) ? p2 : new THREE.Plane(), (p3 !== undefined) ? p3 : new THREE.Plane(), (p4 !== undefined) ? p4 : new THREE.Plane(), (p5 !== undefined) ? p5 : new THREE.Plane()\r\n\r\n  ];\r\n\r\n};\r\n\r\nTHREE.Frustum.prototype = {\r\n\r\n  constructor: THREE.Frustum,\r\n\r\n  set: function(p0, p1, p2, p3, p4, p5) {\r\n\r\n    var planes = this.planes;\r\n\r\n    planes[0].copy(p0);\r\n    planes[1].copy(p1);\r\n    planes[2].copy(p2);\r\n    planes[3].copy(p3);\r\n    planes[4].copy(p4);\r\n    planes[5].copy(p5);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  copy: function(frustum) {\r\n\r\n    var planes = this.planes;\r\n\r\n    for (var i = 0; i < 6; i++) {\r\n\r\n      planes[i].copy(frustum.planes[i]);\r\n\r\n    }\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  setFromMatrix: function(m) {\r\n\r\n    var planes = this.planes;\r\n    var me = m.elements;\r\n    var me0 = me[0],\r\n      me1 = me[1],\r\n      me2 = me[2],\r\n      me3 = me[3];\r\n    var me4 = me[4],\r\n      me5 = me[5],\r\n      me6 = me[6],\r\n      me7 = me[7];\r\n    var me8 = me[8],\r\n      me9 = me[9],\r\n      me10 = me[10],\r\n      me11 = me[11];\r\n    var me12 = me[12],\r\n      me13 = me[13],\r\n      me14 = me[14],\r\n      me15 = me[15];\r\n\r\n    planes[0].setComponents(me3 - me0, me7 - me4, me11 - me8, me15 - me12).normalize();\r\n    planes[1].setComponents(me3 + me0, me7 + me4, me11 + me8, me15 + me12).normalize();\r\n    planes[2].setComponents(me3 + me1, me7 + me5, me11 + me9, me15 + me13).normalize();\r\n    planes[3].setComponents(me3 - me1, me7 - me5, me11 - me9, me15 - me13).normalize();\r\n    planes[4].setComponents(me3 - me2, me7 - me6, me11 - me10, me15 - me14).normalize();\r\n    planes[5].setComponents(me3 + me2, me7 + me6, me11 + me10, me15 + me14).normalize();\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  intersectsObject: function() {\r\n\r\n    var sphere = new THREE.Sphere();\r\n\r\n    return function(object) {\r\n\r\n      var geometry = object.geometry;\r\n\r\n      if (geometry.boundingSphere === null) geometry.computeBoundingSphere();\r\n\r\n      sphere.copy(geometry.boundingSphere);\r\n      sphere.applyMatrix4(object.matrixWorld);\r\n\r\n      return this.intersectsSphere(sphere);\r\n\r\n    };\r\n\r\n  }(),\r\n\r\n  intersectsSphere: function(sphere) {\r\n\r\n    var planes = this.planes;\r\n    var center = sphere.center;\r\n    var negRadius = -sphere.radius;\r\n\r\n    for (var i = 0; i < 6; i++) {\r\n\r\n      var distance = planes[i].distanceToPoint(center);\r\n\r\n      if (distance < negRadius) {\r\n\r\n        return false;\r\n\r\n      }\r\n\r\n    }\r\n\r\n    return true;\r\n\r\n  },\r\n\r\n  intersectsBox: function() {\r\n\r\n    var p1 = new THREE.Vector3(),\r\n      p2 = new THREE.Vector3();\r\n\r\n    return function(box) {\r\n\r\n      var planes = this.planes;\r\n\r\n      for (var i = 0; i < 6; i++) {\r\n\r\n        var plane = planes[i];\r\n\r\n        p1.x = plane.normal.x > 0 ? box.min.x : box.max.x;\r\n        p2.x = plane.normal.x > 0 ? box.max.x : box.min.x;\r\n        p1.y = plane.normal.y > 0 ? box.min.y : box.max.y;\r\n        p2.y = plane.normal.y > 0 ? box.max.y : box.min.y;\r\n        p1.z = plane.normal.z > 0 ? box.min.z : box.max.z;\r\n        p2.z = plane.normal.z > 0 ? box.max.z : box.min.z;\r\n\r\n        var d1 = plane.distanceToPoint(p1);\r\n        var d2 = plane.distanceToPoint(p2);\r\n\r\n        // if both outside plane, no intersection\r\n\r\n        if (d1 < 0 && d2 < 0) {\r\n\r\n          return false;\r\n\r\n        }\r\n      }\r\n\r\n      return true;\r\n    };\r\n\r\n  }(),\r\n\r\n\r\n  containsPoint: function(point) {\r\n\r\n    var planes = this.planes;\r\n\r\n    for (var i = 0; i < 6; i++) {\r\n\r\n      if (planes[i].distanceToPoint(point) < 0) {\r\n\r\n        return false;\r\n\r\n      }\r\n\r\n    }\r\n\r\n    return true;\r\n\r\n  },\r\n\r\n  clone: function() {\r\n\r\n    return new THREE.Frustum().copy(this);\r\n\r\n  }\r\n\r\n};\r\n\r\n// File:src/math/Plane.js\r\n\r\n/**\r\n * @author bhouston / http://exocortex.com\r\n */\r\n\r\nTHREE.Plane = function(normal, constant) {\r\n\r\n  this.normal = (normal !== undefined) ? normal : new THREE.Vector3(1, 0, 0);\r\n  this.constant = (constant !== undefined) ? constant : 0;\r\n\r\n};\r\n\r\nTHREE.Plane.prototype = {\r\n\r\n  constructor: THREE.Plane,\r\n\r\n  set: function(normal, constant) {\r\n\r\n    this.normal.copy(normal);\r\n    this.constant = constant;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  setComponents: function(x, y, z, w) {\r\n\r\n    this.normal.set(x, y, z);\r\n    this.constant = w;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  setFromNormalAndCoplanarPoint: function(normal, point) {\r\n\r\n    this.normal.copy(normal);\r\n    this.constant = -point.dot(this.normal); // must be this.normal, not normal, as this.normal is normalized\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  setFromCoplanarPoints: function() {\r\n\r\n    var v1 = new THREE.Vector3();\r\n    var v2 = new THREE.Vector3();\r\n\r\n    return function(a, b, c) {\r\n\r\n      var normal = v1.subVectors(c, b).cross(v2.subVectors(a, b)).normalize();\r\n\r\n      // Q: should an error be thrown if normal is zero (e.g. degenerate plane)?\r\n\r\n      this.setFromNormalAndCoplanarPoint(normal, a);\r\n\r\n      return this;\r\n\r\n    };\r\n\r\n  }(),\r\n\r\n\r\n  copy: function(plane) {\r\n\r\n    this.normal.copy(plane.normal);\r\n    this.constant = plane.constant;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  normalize: function() {\r\n\r\n    // Note: will lead to a divide by zero if the plane is invalid.\r\n\r\n    var inverseNormalLength = 1.0 / this.normal.length();\r\n    this.normal.multiplyScalar(inverseNormalLength);\r\n    this.constant *= inverseNormalLength;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  negate: function() {\r\n\r\n    this.constant *= -1;\r\n    this.normal.negate();\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  distanceToPoint: function(point) {\r\n\r\n    return this.normal.dot(point) + this.constant;\r\n\r\n  },\r\n\r\n  distanceToSphere: function(sphere) {\r\n\r\n    return this.distanceToPoint(sphere.center) - sphere.radius;\r\n\r\n  },\r\n\r\n  projectPoint: function(point, optionalTarget) {\r\n\r\n    return this.orthoPoint(point, optionalTarget).sub(point).negate();\r\n\r\n  },\r\n\r\n  orthoPoint: function(point, optionalTarget) {\r\n\r\n    var perpendicularMagnitude = this.distanceToPoint(point);\r\n\r\n    var result = optionalTarget || new THREE.Vector3();\r\n    return result.copy(this.normal).multiplyScalar(perpendicularMagnitude);\r\n\r\n  },\r\n\r\n  isIntersectionLine: function(line) {\r\n\r\n    // Note: this tests if a line intersects the plane, not whether it (or its end-points) are coplanar with it.\r\n\r\n    var startSign = this.distanceToPoint(line.start);\r\n    var endSign = this.distanceToPoint(line.end);\r\n\r\n    return (startSign < 0 && endSign > 0) || (endSign < 0 && startSign > 0);\r\n\r\n  },\r\n\r\n  intersectLine: function() {\r\n\r\n    var v1 = new THREE.Vector3();\r\n\r\n    return function(line, optionalTarget) {\r\n\r\n      var result = optionalTarget || new THREE.Vector3();\r\n\r\n      var direction = line.delta(v1);\r\n\r\n      var denominator = this.normal.dot(direction);\r\n\r\n      if (denominator == 0) {\r\n\r\n        // line is coplanar, return origin\r\n        if (this.distanceToPoint(line.start) == 0) {\r\n\r\n          return result.copy(line.start);\r\n\r\n        }\r\n\r\n        // Unsure if this is the correct method to handle this case.\r\n        return undefined;\r\n\r\n      }\r\n\r\n      var t = -(line.start.dot(this.normal) + this.constant) / denominator;\r\n\r\n      if (t < 0 || t > 1) {\r\n\r\n        return undefined;\r\n\r\n      }\r\n\r\n      return result.copy(direction).multiplyScalar(t).add(line.start);\r\n\r\n    };\r\n\r\n  }(),\r\n\r\n\r\n  coplanarPoint: function(optionalTarget) {\r\n\r\n    var result = optionalTarget || new THREE.Vector3();\r\n    return result.copy(this.normal).multiplyScalar(-this.constant);\r\n\r\n  },\r\n\r\n  applyMatrix4: function() {\r\n\r\n    var v1 = new THREE.Vector3();\r\n    var v2 = new THREE.Vector3();\r\n    var m1 = new THREE.Matrix3();\r\n\r\n    return function(matrix, optionalNormalMatrix) {\r\n\r\n      // compute new normal based on theory here:\r\n      // http://www.songho.ca/opengl/gl_normaltransform.html\r\n      var normalMatrix = optionalNormalMatrix || m1.getNormalMatrix(matrix);\r\n      var newNormal = v1.copy(this.normal).applyMatrix3(normalMatrix);\r\n\r\n      var newCoplanarPoint = this.coplanarPoint(v2);\r\n      newCoplanarPoint.applyMatrix4(matrix);\r\n\r\n      this.setFromNormalAndCoplanarPoint(newNormal, newCoplanarPoint);\r\n\r\n      return this;\r\n\r\n    };\r\n\r\n  }(),\r\n\r\n  translate: function(offset) {\r\n\r\n    this.constant = this.constant - offset.dot(this.normal);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  equals: function(plane) {\r\n\r\n    return plane.normal.equals(this.normal) && (plane.constant == this.constant);\r\n\r\n  },\r\n\r\n  clone: function() {\r\n\r\n    return new THREE.Plane().copy(this);\r\n\r\n  }\r\n\r\n};\r\n\r\n// File:src/math/Math.js\r\n\r\n/**\r\n * @author alteredq / http://alteredqualia.com/\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.Math = {\r\n\r\n  generateUUID: function() {\r\n\r\n    // http://www.broofa.com/Tools/Math.uuid.htm\r\n\r\n    var chars = '0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz'.split('');\r\n    var uuid = new Array(36);\r\n    var rnd = 0,\r\n      r;\r\n\r\n    return function() {\r\n\r\n      for (var i = 0; i < 36; i++) {\r\n\r\n        if (i == 8 || i == 13 || i == 18 || i == 23) {\r\n\r\n          uuid[i] = '-';\r\n\r\n        }\r\n        else if (i == 14) {\r\n\r\n          uuid[i] = '4';\r\n\r\n        }\r\n        else {\r\n\r\n          if (rnd <= 0x02) rnd = 0x2000000 + (Math.random() * 0x1000000) | 0;\r\n          r = rnd & 0xf;\r\n          rnd = rnd >> 4;\r\n          uuid[i] = chars[(i == 19) ? (r & 0x3) | 0x8 : r];\r\n\r\n        }\r\n      }\r\n\r\n      return uuid.join('');\r\n\r\n    };\r\n\r\n  }(),\r\n\r\n  // Clamp value to range <a, b>\r\n\r\n  clamp: function(x, a, b) {\r\n\r\n    return (x < a) ? a : ((x > b) ? b : x);\r\n\r\n  },\r\n\r\n  // Clamp value to range <a, inf)\r\n\r\n  clampBottom: function(x, a) {\r\n\r\n    return x < a ? a : x;\r\n\r\n  },\r\n\r\n  // Linear mapping from range <a1, a2> to range <b1, b2>\r\n\r\n  mapLinear: function(x, a1, a2, b1, b2) {\r\n\r\n    return b1 + (x - a1) * (b2 - b1) / (a2 - a1);\r\n\r\n  },\r\n\r\n  // http://en.wikipedia.org/wiki/Smoothstep\r\n\r\n  smoothstep: function(x, min, max) {\r\n\r\n    if (x <= min) return 0;\r\n    if (x >= max) return 1;\r\n\r\n    x = (x - min) / (max - min);\r\n\r\n    return x * x * (3 - 2 * x);\r\n\r\n  },\r\n\r\n  smootherstep: function(x, min, max) {\r\n\r\n    if (x <= min) return 0;\r\n    if (x >= max) return 1;\r\n\r\n    x = (x - min) / (max - min);\r\n\r\n    return x * x * x * (x * (x * 6 - 15) + 10);\r\n\r\n  },\r\n\r\n  // Random float from <0, 1> with 16 bits of randomness\r\n  // (standard Math.random() creates repetitive patterns when applied over larger space)\r\n\r\n  random16: function() {\r\n\r\n    return (65280 * Math.random() + 255 * Math.random()) / 65535;\r\n\r\n  },\r\n\r\n  // Random integer from <low, high> interval\r\n\r\n  randInt: function(low, high) {\r\n\r\n    return Math.floor(this.randFloat(low, high));\r\n\r\n  },\r\n\r\n  // Random float from <low, high> interval\r\n\r\n  randFloat: function(low, high) {\r\n\r\n    return low + Math.random() * (high - low);\r\n\r\n  },\r\n\r\n  // Random float from <-range/2, range/2> interval\r\n\r\n  randFloatSpread: function(range) {\r\n\r\n    return range * (0.5 - Math.random());\r\n\r\n  },\r\n\r\n  degToRad: function() {\r\n\r\n    var degreeToRadiansFactor = Math.PI / 180;\r\n\r\n    return function(degrees) {\r\n\r\n      return degrees * degreeToRadiansFactor;\r\n\r\n    };\r\n\r\n  }(),\r\n\r\n  radToDeg: function() {\r\n\r\n    var radianToDegreesFactor = 180 / Math.PI;\r\n\r\n    return function(radians) {\r\n\r\n      return radians * radianToDegreesFactor;\r\n\r\n    };\r\n\r\n  }(),\r\n\r\n  isPowerOfTwo: function(value) {\r\n\r\n    return (value & (value - 1)) === 0 && value !== 0;\r\n\r\n  },\r\n\r\n  nextPowerOfTwo: function(value) {\r\n\r\n    value--;\r\n    value |= value >> 1;\r\n    value |= value >> 2;\r\n    value |= value >> 4;\r\n    value |= value >> 8;\r\n    value |= value >> 16;\r\n    value++;\r\n\r\n    return value;\r\n\r\n  }\r\n\r\n};\r\n\r\n// File:src/math/Spline.js\r\n\r\n/**\r\n * Spline from Tween.js, slightly optimized (and trashed)\r\n * http://sole.github.com/tween.js/examples/05_spline.html\r\n *\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author alteredq / http://alteredqualia.com/\r\n */\r\n\r\nTHREE.Spline = function(points) {\r\n\r\n  this.points = points;\r\n\r\n  var c = [],\r\n    v3 = {\r\n      x: 0,\r\n      y: 0,\r\n      z: 0\r\n    },\r\n    point, intPoint, weight, w2, w3,\r\n    pa, pb, pc, pd;\r\n\r\n  this.initFromArray = function(a) {\r\n\r\n    this.points = [];\r\n\r\n    for (var i = 0; i < a.length; i++) {\r\n\r\n      this.points[i] = {\r\n        x: a[i][0],\r\n        y: a[i][1],\r\n        z: a[i][2]\r\n      };\r\n\r\n    }\r\n\r\n  };\r\n\r\n  this.getPoint = function(k) {\r\n\r\n    point = (this.points.length - 1) * k;\r\n    intPoint = Math.floor(point);\r\n    weight = point - intPoint;\r\n\r\n    c[0] = intPoint === 0 ? intPoint : intPoint - 1;\r\n    c[1] = intPoint;\r\n    c[2] = intPoint > this.points.length - 2 ? this.points.length - 1 : intPoint + 1;\r\n    c[3] = intPoint > this.points.length - 3 ? this.points.length - 1 : intPoint + 2;\r\n\r\n    pa = this.points[c[0]];\r\n    pb = this.points[c[1]];\r\n    pc = this.points[c[2]];\r\n    pd = this.points[c[3]];\r\n\r\n    w2 = weight * weight;\r\n    w3 = weight * w2;\r\n\r\n    v3.x = interpolate(pa.x, pb.x, pc.x, pd.x, weight, w2, w3);\r\n    v3.y = interpolate(pa.y, pb.y, pc.y, pd.y, weight, w2, w3);\r\n    v3.z = interpolate(pa.z, pb.z, pc.z, pd.z, weight, w2, w3);\r\n\r\n    return v3;\r\n\r\n  };\r\n\r\n  this.getControlPointsArray = function() {\r\n\r\n    var i, p, l = this.points.length,\r\n      coords = [];\r\n\r\n    for (i = 0; i < l; i++) {\r\n\r\n      p = this.points[i];\r\n      coords[i] = [p.x, p.y, p.z];\r\n\r\n    }\r\n\r\n    return coords;\r\n\r\n  };\r\n\r\n  // approximate length by summing linear segments\r\n\r\n  this.getLength = function(nSubDivisions) {\r\n\r\n    var i, index, nSamples, position,\r\n      point = 0,\r\n      intPoint = 0,\r\n      oldIntPoint = 0,\r\n      oldPosition = new THREE.Vector3(),\r\n      tmpVec = new THREE.Vector3(),\r\n      chunkLengths = [],\r\n      totalLength = 0;\r\n\r\n    // first point has 0 length\r\n\r\n    chunkLengths[0] = 0;\r\n\r\n    if (!nSubDivisions) nSubDivisions = 100;\r\n\r\n    nSamples = this.points.length * nSubDivisions;\r\n\r\n    oldPosition.copy(this.points[0]);\r\n\r\n    for (i = 1; i < nSamples; i++) {\r\n\r\n      index = i / nSamples;\r\n\r\n      position = this.getPoint(index);\r\n      tmpVec.copy(position);\r\n\r\n      totalLength += tmpVec.distanceTo(oldPosition);\r\n\r\n      oldPosition.copy(position);\r\n\r\n      point = (this.points.length - 1) * index;\r\n      intPoint = Math.floor(point);\r\n\r\n      if (intPoint != oldIntPoint) {\r\n\r\n        chunkLengths[intPoint] = totalLength;\r\n        oldIntPoint = intPoint;\r\n\r\n      }\r\n\r\n    }\r\n\r\n    // last point ends with total length\r\n\r\n    chunkLengths[chunkLengths.length] = totalLength;\r\n\r\n    return {\r\n      chunks: chunkLengths,\r\n      total: totalLength\r\n    };\r\n\r\n  };\r\n\r\n  this.reparametrizeByArcLength = function(samplingCoef) {\r\n\r\n    var i, j,\r\n      index, indexCurrent, indexNext,\r\n      realDistance,\r\n      sampling, position,\r\n      newpoints = [],\r\n      tmpVec = new THREE.Vector3(),\r\n      sl = this.getLength();\r\n\r\n    newpoints.push(tmpVec.copy(this.points[0]).clone());\r\n\r\n    for (i = 1; i < this.points.length; i++) {\r\n\r\n      //tmpVec.copy( this.points[ i - 1 ] );\r\n      //linearDistance = tmpVec.distanceTo( this.points[ i ] );\r\n\r\n      realDistance = sl.chunks[i] - sl.chunks[i - 1];\r\n\r\n      sampling = Math.ceil(samplingCoef * realDistance / sl.total);\r\n\r\n      indexCurrent = (i - 1) / (this.points.length - 1);\r\n      indexNext = i / (this.points.length - 1);\r\n\r\n      for (j = 1; j < sampling - 1; j++) {\r\n\r\n        index = indexCurrent + j * (1 / sampling) * (indexNext - indexCurrent);\r\n\r\n        position = this.getPoint(index);\r\n        newpoints.push(tmpVec.copy(position).clone());\r\n\r\n      }\r\n\r\n      newpoints.push(tmpVec.copy(this.points[i]).clone());\r\n\r\n    }\r\n\r\n    this.points = newpoints;\r\n\r\n  };\r\n\r\n  // Catmull-Rom\r\n\r\n  function interpolate(p0, p1, p2, p3, t, t2, t3) {\r\n\r\n    var v0 = (p2 - p0) * 0.5,\r\n      v1 = (p3 - p1) * 0.5;\r\n\r\n    return (2 * (p1 - p2) + v0 + v1) * t3 + (-3 * (p1 - p2) - 2 * v0 - v1) * t2 + v0 * t + p1;\r\n\r\n  };\r\n\r\n};\r\n\r\n// File:src/math/Triangle.js\r\n\r\n/**\r\n * @author bhouston / http://exocortex.com\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.Triangle = function(a, b, c) {\r\n\r\n  this.a = (a !== undefined) ? a : new THREE.Vector3();\r\n  this.b = (b !== undefined) ? b : new THREE.Vector3();\r\n  this.c = (c !== undefined) ? c : new THREE.Vector3();\r\n\r\n};\r\n\r\nTHREE.Triangle.normal = function() {\r\n\r\n  var v0 = new THREE.Vector3();\r\n\r\n  return function(a, b, c, optionalTarget) {\r\n\r\n    var result = optionalTarget || new THREE.Vector3();\r\n\r\n    result.subVectors(c, b);\r\n    v0.subVectors(a, b);\r\n    result.cross(v0);\r\n\r\n    var resultLengthSq = result.lengthSq();\r\n    if (resultLengthSq > 0) {\r\n\r\n      return result.multiplyScalar(1 / Math.sqrt(resultLengthSq));\r\n\r\n    }\r\n\r\n    return result.set(0, 0, 0);\r\n\r\n  };\r\n\r\n}();\r\n\r\n// static/instance method to calculate barycoordinates\r\n// based on: http://www.blackpawn.com/texts/pointinpoly/default.html\r\nTHREE.Triangle.barycoordFromPoint = function() {\r\n\r\n  var v0 = new THREE.Vector3();\r\n  var v1 = new THREE.Vector3();\r\n  var v2 = new THREE.Vector3();\r\n\r\n  return function(point, a, b, c, optionalTarget) {\r\n\r\n    v0.subVectors(c, a);\r\n    v1.subVectors(b, a);\r\n    v2.subVectors(point, a);\r\n\r\n    var dot00 = v0.dot(v0);\r\n    var dot01 = v0.dot(v1);\r\n    var dot02 = v0.dot(v2);\r\n    var dot11 = v1.dot(v1);\r\n    var dot12 = v1.dot(v2);\r\n\r\n    var denom = (dot00 * dot11 - dot01 * dot01);\r\n\r\n    var result = optionalTarget || new THREE.Vector3();\r\n\r\n    // colinear or singular triangle\r\n    if (denom == 0) {\r\n      // arbitrary location outside of triangle?\r\n      // not sure if this is the best idea, maybe should be returning undefined\r\n      return result.set(-2, -1, -1);\r\n    }\r\n\r\n    var invDenom = 1 / denom;\r\n    var u = (dot11 * dot02 - dot01 * dot12) * invDenom;\r\n    var v = (dot00 * dot12 - dot01 * dot02) * invDenom;\r\n\r\n    // barycoordinates must always sum to 1\r\n    return result.set(1 - u - v, v, u);\r\n\r\n  };\r\n\r\n}();\r\n\r\nTHREE.Triangle.containsPoint = function() {\r\n\r\n  var v1 = new THREE.Vector3();\r\n\r\n  return function(point, a, b, c) {\r\n\r\n    var result = THREE.Triangle.barycoordFromPoint(point, a, b, c, v1);\r\n\r\n    return (result.x >= 0) && (result.y >= 0) && ((result.x + result.y) <= 1);\r\n\r\n  };\r\n\r\n}();\r\n\r\nTHREE.Triangle.prototype = {\r\n\r\n  constructor: THREE.Triangle,\r\n\r\n  set: function(a, b, c) {\r\n\r\n    this.a.copy(a);\r\n    this.b.copy(b);\r\n    this.c.copy(c);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  setFromPointsAndIndices: function(points, i0, i1, i2) {\r\n\r\n    this.a.copy(points[i0]);\r\n    this.b.copy(points[i1]);\r\n    this.c.copy(points[i2]);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  copy: function(triangle) {\r\n\r\n    this.a.copy(triangle.a);\r\n    this.b.copy(triangle.b);\r\n    this.c.copy(triangle.c);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  area: function() {\r\n\r\n    var v0 = new THREE.Vector3();\r\n    var v1 = new THREE.Vector3();\r\n\r\n    return function() {\r\n\r\n      v0.subVectors(this.c, this.b);\r\n      v1.subVectors(this.a, this.b);\r\n\r\n      return v0.cross(v1).length() * 0.5;\r\n\r\n    };\r\n\r\n  }(),\r\n\r\n  midpoint: function(optionalTarget) {\r\n\r\n    var result = optionalTarget || new THREE.Vector3();\r\n    return result.addVectors(this.a, this.b).add(this.c).multiplyScalar(1 / 3);\r\n\r\n  },\r\n\r\n  normal: function(optionalTarget) {\r\n\r\n    return THREE.Triangle.normal(this.a, this.b, this.c, optionalTarget);\r\n\r\n  },\r\n\r\n  plane: function(optionalTarget) {\r\n\r\n    var result = optionalTarget || new THREE.Plane();\r\n\r\n    return result.setFromCoplanarPoints(this.a, this.b, this.c);\r\n\r\n  },\r\n\r\n  barycoordFromPoint: function(point, optionalTarget) {\r\n\r\n    return THREE.Triangle.barycoordFromPoint(point, this.a, this.b, this.c, optionalTarget);\r\n\r\n  },\r\n\r\n  containsPoint: function(point) {\r\n\r\n    return THREE.Triangle.containsPoint(point, this.a, this.b, this.c);\r\n\r\n  },\r\n\r\n  equals: function(triangle) {\r\n\r\n    return triangle.a.equals(this.a) && triangle.b.equals(this.b) && triangle.c.equals(this.c);\r\n\r\n  },\r\n\r\n  clone: function() {\r\n\r\n    return new THREE.Triangle().copy(this);\r\n\r\n  }\r\n\r\n};\r\n\r\n// File:src/core/Clock.js\r\n\r\n/**\r\n * @author alteredq / http://alteredqualia.com/\r\n */\r\n\r\nTHREE.Clock = function(autoStart) {\r\n\r\n  this.autoStart = (autoStart !== undefined) ? autoStart : true;\r\n\r\n  this.startTime = 0;\r\n  this.oldTime = 0;\r\n  this.elapsedTime = 0;\r\n\r\n  this.running = false;\r\n\r\n};\r\n\r\nTHREE.Clock.prototype = {\r\n\r\n  constructor: THREE.Clock,\r\n\r\n  start: function() {\r\n\r\n    this.startTime = self.performance !== undefined && self.performance.now !== undefined ? self.performance.now() : Date.now();\r\n\r\n    this.oldTime = this.startTime;\r\n    this.running = true;\r\n  },\r\n\r\n  stop: function() {\r\n\r\n    this.getElapsedTime();\r\n    this.running = false;\r\n\r\n  },\r\n\r\n  getElapsedTime: function() {\r\n\r\n    this.getDelta();\r\n    return this.elapsedTime;\r\n\r\n  },\r\n\r\n  getDelta: function() {\r\n\r\n    var diff = 0;\r\n\r\n    if (this.autoStart && !this.running) {\r\n\r\n      this.start();\r\n\r\n    }\r\n\r\n    if (this.running) {\r\n\r\n      var newTime = self.performance !== undefined && self.performance.now !== undefined ? self.performance.now() : Date.now();\r\n\r\n      diff = 0.001 * (newTime - this.oldTime);\r\n      this.oldTime = newTime;\r\n\r\n      this.elapsedTime += diff;\r\n\r\n    }\r\n\r\n    return diff;\r\n\r\n  }\r\n\r\n};\r\n\r\n// File:src/core/EventDispatcher.js\r\n\r\n/**\r\n * https://github.com/mrdoob/eventdispatcher.js/\r\n */\r\n\r\nTHREE.EventDispatcher = function() {}\r\n\r\nTHREE.EventDispatcher.prototype = {\r\n\r\n  constructor: THREE.EventDispatcher,\r\n\r\n  apply: function(object) {\r\n\r\n    object.addEventListener = THREE.EventDispatcher.prototype.addEventListener;\r\n    object.hasEventListener = THREE.EventDispatcher.prototype.hasEventListener;\r\n    object.removeEventListener = THREE.EventDispatcher.prototype.removeEventListener;\r\n    object.dispatchEvent = THREE.EventDispatcher.prototype.dispatchEvent;\r\n\r\n  },\r\n\r\n  addEventListener: function(type, listener) {\r\n\r\n    if (this._listeners === undefined) this._listeners = {};\r\n\r\n    var listeners = this._listeners;\r\n\r\n    if (listeners[type] === undefined) {\r\n\r\n      listeners[type] = [];\r\n\r\n    }\r\n\r\n    if (listeners[type].indexOf(listener) === -1) {\r\n\r\n      listeners[type].push(listener);\r\n\r\n    }\r\n\r\n  },\r\n\r\n  hasEventListener: function(type, listener) {\r\n\r\n    if (this._listeners === undefined) return false;\r\n\r\n    var listeners = this._listeners;\r\n\r\n    if (listeners[type] !== undefined && listeners[type].indexOf(listener) !== -1) {\r\n\r\n      return true;\r\n\r\n    }\r\n\r\n    return false;\r\n\r\n  },\r\n\r\n  removeEventListener: function(type, listener) {\r\n\r\n    if (this._listeners === undefined) return;\r\n\r\n    var listeners = this._listeners;\r\n    var listenerArray = listeners[type];\r\n\r\n    if (listenerArray !== undefined) {\r\n\r\n      var index = listenerArray.indexOf(listener);\r\n\r\n      if (index !== -1) {\r\n\r\n        listenerArray.splice(index, 1);\r\n\r\n      }\r\n\r\n    }\r\n\r\n  },\r\n\r\n  dispatchEvent: function(event) {\r\n\r\n    if (this._listeners === undefined) return;\r\n\r\n    var listeners = this._listeners;\r\n    var listenerArray = listeners[event.type];\r\n\r\n    if (listenerArray !== undefined) {\r\n\r\n      event.target = this;\r\n\r\n      var array = [];\r\n      var length = listenerArray.length;\r\n\r\n      for (var i = 0; i < length; i++) {\r\n\r\n        array[i] = listenerArray[i];\r\n\r\n      }\r\n\r\n      for (var i = 0; i < length; i++) {\r\n\r\n        array[i].call(this, event);\r\n\r\n      }\r\n\r\n    }\r\n\r\n  }\r\n\r\n};\r\n\r\n// File:src/core/Raycaster.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author bhouston / http://exocortex.com/\r\n * @author stephomi / http://stephaneginier.com/\r\n */\r\n\r\n(function(THREE) {\r\n\r\n  THREE.Raycaster = function(origin, direction, near, far) {\r\n\r\n    this.ray = new THREE.Ray(origin, direction);\r\n    // direction is assumed to be normalized (for accurate distance calculations)\r\n\r\n    this.near = near || 0;\r\n    this.far = far || Infinity;\r\n\r\n    this.params = {\r\n      Sprite: {},\r\n      Mesh: {},\r\n      PointCloud: {\r\n        threshold: 1\r\n      },\r\n      LOD: {},\r\n      Line: {}\r\n    };\r\n\r\n  };\r\n\r\n  var descSort = function(a, b) {\r\n\r\n    return a.distance - b.distance;\r\n\r\n  };\r\n\r\n  var intersectObject = function(object, raycaster, intersects, recursive) {\r\n\r\n    object.raycast(raycaster, intersects);\r\n\r\n    if (recursive === true) {\r\n\r\n      var children = object.children;\r\n\r\n      for (var i = 0, l = children.length; i < l; i++) {\r\n\r\n        intersectObject(children[i], raycaster, intersects, true);\r\n\r\n      }\r\n\r\n    }\r\n\r\n  };\r\n\r\n  //\r\n\r\n  THREE.Raycaster.prototype = {\r\n\r\n    constructor: THREE.Raycaster,\r\n\r\n    precision: 0.0001,\r\n    linePrecision: 1,\r\n\r\n    set: function(origin, direction) {\r\n\r\n      // direction is assumed to be normalized (for accurate distance calculations)\r\n\r\n      this.ray.set(origin, direction);\r\n\r\n    },\r\n\r\n    setFromCamera: function(coords, camera) {\r\n\r\n      // camera is assumed _not_ to be a child of a transformed object\r\n\r\n      if (camera instanceof THREE.PerspectiveCamera) {\r\n\r\n        this.ray.origin.copy(camera.position);\r\n        this.ray.direction.set(coords.x, coords.y, 0.5).unproject(camera).sub(camera.position).normalize();\r\n\r\n      }\r\n      else if (camera instanceof THREE.OrthographicCamera) {\r\n\r\n        this.ray.origin.set(coords.x, coords.y, -1).unproject(camera);\r\n        this.ray.direction.set(0, 0, -1).transformDirection(camera.matrixWorld);\r\n\r\n      }\r\n      else {\r\n\r\n        THREE.error('THREE.Raycaster: Unsupported camera type.');\r\n\r\n      }\r\n\r\n    },\r\n\r\n    intersectObject: function(object, recursive) {\r\n\r\n      var intersects = [];\r\n\r\n      intersectObject(object, this, intersects, recursive);\r\n\r\n      intersects.sort(descSort);\r\n\r\n      return intersects;\r\n\r\n    },\r\n\r\n    intersectObjects: function(objects, recursive) {\r\n\r\n      var intersects = [];\r\n\r\n      if (objects instanceof Array === false) {\r\n\r\n        THREE.warn('THREE.Raycaster.intersectObjects: objects is not an Array.');\r\n        return intersects;\r\n\r\n      }\r\n\r\n      for (var i = 0, l = objects.length; i < l; i++) {\r\n\r\n        intersectObject(objects[i], this, intersects, recursive);\r\n\r\n      }\r\n\r\n      intersects.sort(descSort);\r\n\r\n      return intersects;\r\n\r\n    }\r\n\r\n  };\r\n\r\n}(THREE));\r\n\r\n// File:src/core/Object3D.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author mikael emtinger / http://gomo.se/\r\n * @author alteredq / http://alteredqualia.com/\r\n * @author WestLangley / http://github.com/WestLangley\r\n */\r\n\r\nTHREE.Object3D = function() {\r\n\r\n  Object.defineProperty(this, 'id', {\r\n    value: THREE.Object3DIdCount++\r\n  });\r\n\r\n  this.uuid = THREE.Math.generateUUID();\r\n\r\n  this.name = '';\r\n  this.type = 'Object3D';\r\n\r\n  this.parent = undefined;\r\n  this.children = [];\r\n\r\n  this.up = THREE.Object3D.DefaultUp.clone();\r\n\r\n  var position = new THREE.Vector3();\r\n  var rotation = new THREE.Euler();\r\n  var quaternion = new THREE.Quaternion();\r\n  var scale = new THREE.Vector3(1, 1, 1);\r\n\r\n  var onRotationChange = function() {\r\n    quaternion.setFromEuler(rotation, false);\r\n  };\r\n\r\n  var onQuaternionChange = function() {\r\n    rotation.setFromQuaternion(quaternion, undefined, false);\r\n  };\r\n\r\n  rotation.onChange(onRotationChange);\r\n  quaternion.onChange(onQuaternionChange);\r\n\r\n  Object.defineProperties(this, {\r\n    position: {\r\n      enumerable: true,\r\n      value: position\r\n    },\r\n    rotation: {\r\n      enumerable: true,\r\n      value: rotation\r\n    },\r\n    quaternion: {\r\n      enumerable: true,\r\n      value: quaternion\r\n    },\r\n    scale: {\r\n      enumerable: true,\r\n      value: scale\r\n    }\r\n  });\r\n\r\n  this.rotationAutoUpdate = true;\r\n\r\n  this.matrix = new THREE.Matrix4();\r\n  this.matrixWorld = new THREE.Matrix4();\r\n\r\n  this.matrixAutoUpdate = true;\r\n  this.matrixWorldNeedsUpdate = false;\r\n\r\n  this.visible = true;\r\n\r\n  this.castShadow = false;\r\n  this.receiveShadow = false;\r\n\r\n  this.frustumCulled = true;\r\n  this.renderOrder = 0;\r\n\r\n  this.userData = {};\r\n\r\n};\r\n\r\nTHREE.Object3D.DefaultUp = new THREE.Vector3(0, 1, 0);\r\n\r\nTHREE.Object3D.prototype = {\r\n\r\n  constructor: THREE.Object3D,\r\n\r\n  get eulerOrder() {\r\n\r\n    THREE.warn('THREE.Object3D: .eulerOrder has been moved to .rotation.order.');\r\n\r\n    return this.rotation.order;\r\n\r\n  },\r\n\r\n  set eulerOrder(value) {\r\n\r\n    THREE.warn('THREE.Object3D: .eulerOrder has been moved to .rotation.order.');\r\n\r\n    this.rotation.order = value;\r\n\r\n  },\r\n\r\n  get useQuaternion() {\r\n\r\n    THREE.warn('THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.');\r\n\r\n  },\r\n\r\n  set useQuaternion(value) {\r\n\r\n    THREE.warn('THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.');\r\n\r\n  },\r\n\r\n  applyMatrix: function(matrix) {\r\n\r\n    this.matrix.multiplyMatrices(matrix, this.matrix);\r\n\r\n    this.matrix.decompose(this.position, this.quaternion, this.scale);\r\n\r\n  },\r\n\r\n  setRotationFromAxisAngle: function(axis, angle) {\r\n\r\n    // assumes axis is normalized\r\n\r\n    this.quaternion.setFromAxisAngle(axis, angle);\r\n\r\n  },\r\n\r\n  setRotationFromEuler: function(euler) {\r\n\r\n    this.quaternion.setFromEuler(euler, true);\r\n\r\n  },\r\n\r\n  setRotationFromMatrix: function(m) {\r\n\r\n    // assumes the upper 3x3 of m is a pure rotation matrix (i.e, unscaled)\r\n\r\n    this.quaternion.setFromRotationMatrix(m);\r\n\r\n  },\r\n\r\n  setRotationFromQuaternion: function(q) {\r\n\r\n    // assumes q is normalized\r\n\r\n    this.quaternion.copy(q);\r\n\r\n  },\r\n\r\n  rotateOnAxis: function() {\r\n\r\n    // rotate object on axis in object space\r\n    // axis is assumed to be normalized\r\n\r\n    var q1 = new THREE.Quaternion();\r\n\r\n    return function(axis, angle) {\r\n\r\n      q1.setFromAxisAngle(axis, angle);\r\n\r\n      this.quaternion.multiply(q1);\r\n\r\n      return this;\r\n\r\n    }\r\n\r\n  }(),\r\n\r\n  rotateX: function() {\r\n\r\n    var v1 = new THREE.Vector3(1, 0, 0);\r\n\r\n    return function(angle) {\r\n\r\n      return this.rotateOnAxis(v1, angle);\r\n\r\n    };\r\n\r\n  }(),\r\n\r\n  rotateY: function() {\r\n\r\n    var v1 = new THREE.Vector3(0, 1, 0);\r\n\r\n    return function(angle) {\r\n\r\n      return this.rotateOnAxis(v1, angle);\r\n\r\n    };\r\n\r\n  }(),\r\n\r\n  rotateZ: function() {\r\n\r\n    var v1 = new THREE.Vector3(0, 0, 1);\r\n\r\n    return function(angle) {\r\n\r\n      return this.rotateOnAxis(v1, angle);\r\n\r\n    };\r\n\r\n  }(),\r\n\r\n  translateOnAxis: function() {\r\n\r\n    // translate object by distance along axis in object space\r\n    // axis is assumed to be normalized\r\n\r\n    var v1 = new THREE.Vector3();\r\n\r\n    return function(axis, distance) {\r\n\r\n      v1.copy(axis).applyQuaternion(this.quaternion);\r\n\r\n      this.position.add(v1.multiplyScalar(distance));\r\n\r\n      return this;\r\n\r\n    }\r\n\r\n  }(),\r\n\r\n  translate: function(distance, axis) {\r\n\r\n    THREE.warn('THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead.');\r\n    return this.translateOnAxis(axis, distance);\r\n\r\n  },\r\n\r\n  translateX: function() {\r\n\r\n    var v1 = new THREE.Vector3(1, 0, 0);\r\n\r\n    return function(distance) {\r\n\r\n      return this.translateOnAxis(v1, distance);\r\n\r\n    };\r\n\r\n  }(),\r\n\r\n  translateY: function() {\r\n\r\n    var v1 = new THREE.Vector3(0, 1, 0);\r\n\r\n    return function(distance) {\r\n\r\n      return this.translateOnAxis(v1, distance);\r\n\r\n    };\r\n\r\n  }(),\r\n\r\n  translateZ: function() {\r\n\r\n    var v1 = new THREE.Vector3(0, 0, 1);\r\n\r\n    return function(distance) {\r\n\r\n      return this.translateOnAxis(v1, distance);\r\n\r\n    };\r\n\r\n  }(),\r\n\r\n  localToWorld: function(vector) {\r\n\r\n    return vector.applyMatrix4(this.matrixWorld);\r\n\r\n  },\r\n\r\n  worldToLocal: function() {\r\n\r\n    var m1 = new THREE.Matrix4();\r\n\r\n    return function(vector) {\r\n\r\n      return vector.applyMatrix4(m1.getInverse(this.matrixWorld));\r\n\r\n    };\r\n\r\n  }(),\r\n\r\n  lookAt: function() {\r\n\r\n    // This routine does not support objects with rotated and/or translated parent(s)\r\n\r\n    var m1 = new THREE.Matrix4();\r\n\r\n    return function(vector) {\r\n\r\n      m1.lookAt(vector, this.position, this.up);\r\n\r\n      this.quaternion.setFromRotationMatrix(m1);\r\n\r\n    };\r\n\r\n  }(),\r\n\r\n  add: function(object) {\r\n\r\n    if (arguments.length > 1) {\r\n\r\n      for (var i = 0; i < arguments.length; i++) {\r\n\r\n        this.add(arguments[i]);\r\n\r\n      }\r\n\r\n      return this;\r\n\r\n    };\r\n\r\n    if (object === this) {\r\n\r\n      THREE.error(\"THREE.Object3D.add: object can't be added as a child of itself.\", object);\r\n      return this;\r\n\r\n    }\r\n\r\n    if (object instanceof THREE.Object3D) {\r\n\r\n      if (object.parent !== undefined) {\r\n\r\n        object.parent.remove(object);\r\n\r\n      }\r\n\r\n      object.parent = this;\r\n      object.dispatchEvent({\r\n        type: 'added'\r\n      });\r\n\r\n      this.children.push(object);\r\n\r\n    }\r\n    else {\r\n\r\n      THREE.error(\"THREE.Object3D.add: object not an instance of THREE.Object3D.\", object);\r\n\r\n    }\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  remove: function(object) {\r\n\r\n    if (arguments.length > 1) {\r\n\r\n      for (var i = 0; i < arguments.length; i++) {\r\n\r\n        this.remove(arguments[i]);\r\n\r\n      }\r\n\r\n    };\r\n\r\n    var index = this.children.indexOf(object);\r\n\r\n    if (index !== -1) {\r\n\r\n      object.parent = undefined;\r\n\r\n      object.dispatchEvent({\r\n        type: 'removed'\r\n      });\r\n\r\n      this.children.splice(index, 1);\r\n\r\n    }\r\n\r\n  },\r\n\r\n  getChildByName: function(name) {\r\n\r\n    THREE.warn('THREE.Object3D: .getChildByName() has been renamed to .getObjectByName().');\r\n    return this.getObjectByName(name);\r\n\r\n  },\r\n\r\n  getObjectById: function(id) {\r\n\r\n    return this.getObjectByProperty('id', id);\r\n\r\n  },\r\n\r\n  getObjectByName: function(name) {\r\n\r\n    return this.getObjectByProperty('name', name);\r\n\r\n  },\r\n\r\n  getObjectByProperty: function(name, value) {\r\n\r\n    if (this[name] === value) return this;\r\n\r\n    for (var i = 0, l = this.children.length; i < l; i++) {\r\n\r\n      var child = this.children[i];\r\n      var object = child.getObjectByProperty(name, value);\r\n\r\n      if (object !== undefined) {\r\n\r\n        return object;\r\n\r\n      }\r\n\r\n    }\r\n\r\n    return undefined;\r\n\r\n  },\r\n\r\n  getWorldPosition: function(optionalTarget) {\r\n\r\n    var result = optionalTarget || new THREE.Vector3();\r\n\r\n    this.updateMatrixWorld(true);\r\n\r\n    return result.setFromMatrixPosition(this.matrixWorld);\r\n\r\n  },\r\n\r\n  getWorldQuaternion: function() {\r\n\r\n    var position = new THREE.Vector3();\r\n    var scale = new THREE.Vector3();\r\n\r\n    return function(optionalTarget) {\r\n\r\n      var result = optionalTarget || new THREE.Quaternion();\r\n\r\n      this.updateMatrixWorld(true);\r\n\r\n      this.matrixWorld.decompose(position, result, scale);\r\n\r\n      return result;\r\n\r\n    }\r\n\r\n  }(),\r\n\r\n  getWorldRotation: function() {\r\n\r\n    var quaternion = new THREE.Quaternion();\r\n\r\n    return function(optionalTarget) {\r\n\r\n      var result = optionalTarget || new THREE.Euler();\r\n\r\n      this.getWorldQuaternion(quaternion);\r\n\r\n      return result.setFromQuaternion(quaternion, this.rotation.order, false);\r\n\r\n    }\r\n\r\n  }(),\r\n\r\n  getWorldScale: function() {\r\n\r\n    var position = new THREE.Vector3();\r\n    var quaternion = new THREE.Quaternion();\r\n\r\n    return function(optionalTarget) {\r\n\r\n      var result = optionalTarget || new THREE.Vector3();\r\n\r\n      this.updateMatrixWorld(true);\r\n\r\n      this.matrixWorld.decompose(position, quaternion, result);\r\n\r\n      return result;\r\n\r\n    }\r\n\r\n  }(),\r\n\r\n  getWorldDirection: function() {\r\n\r\n    var quaternion = new THREE.Quaternion();\r\n\r\n    return function(optionalTarget) {\r\n\r\n      var result = optionalTarget || new THREE.Vector3();\r\n\r\n      this.getWorldQuaternion(quaternion);\r\n\r\n      return result.set(0, 0, 1).applyQuaternion(quaternion);\r\n\r\n    }\r\n\r\n  }(),\r\n\r\n  raycast: function() {},\r\n\r\n  traverse: function(callback) {\r\n\r\n    callback(this);\r\n\r\n    for (var i = 0, l = this.children.length; i < l; i++) {\r\n\r\n      this.children[i].traverse(callback);\r\n\r\n    }\r\n\r\n  },\r\n\r\n  traverseVisible: function(callback) {\r\n\r\n    if (this.visible === false) return;\r\n\r\n    callback(this);\r\n\r\n    for (var i = 0, l = this.children.length; i < l; i++) {\r\n\r\n      this.children[i].traverseVisible(callback);\r\n\r\n    }\r\n\r\n  },\r\n\r\n  traverseAncestors: function(callback) {\r\n\r\n    if (this.parent) {\r\n\r\n      callback(this.parent);\r\n\r\n      this.parent.traverseAncestors(callback);\r\n\r\n    }\r\n\r\n  },\r\n\r\n  updateMatrix: function() {\r\n\r\n    this.matrix.compose(this.position, this.quaternion, this.scale);\r\n\r\n    this.matrixWorldNeedsUpdate = true;\r\n\r\n  },\r\n\r\n  updateMatrixWorld: function(force) {\r\n\r\n    if (this.matrixAutoUpdate === true) this.updateMatrix();\r\n\r\n    if (this.matrixWorldNeedsUpdate === true || force === true) {\r\n\r\n      if (this.parent === undefined) {\r\n\r\n        this.matrixWorld.copy(this.matrix);\r\n\r\n      }\r\n      else {\r\n\r\n        this.matrixWorld.multiplyMatrices(this.parent.matrixWorld, this.matrix);\r\n\r\n      }\r\n\r\n      this.matrixWorldNeedsUpdate = false;\r\n\r\n      force = true;\r\n\r\n    }\r\n\r\n    // update children\r\n\r\n    for (var i = 0, l = this.children.length; i < l; i++) {\r\n\r\n      this.children[i].updateMatrixWorld(force);\r\n\r\n    }\r\n\r\n  },\r\n\r\n  toJSON: function() {\r\n\r\n    var output = {\r\n      metadata: {\r\n        version: 4.3,\r\n        type: 'Object',\r\n        generator: 'ObjectExporter'\r\n      }\r\n    };\r\n\r\n    //\r\n\r\n    var geometries = {};\r\n\r\n    var parseGeometry = function(geometry) {\r\n\r\n      if (output.geometries === undefined) {\r\n\r\n        output.geometries = [];\r\n\r\n      }\r\n\r\n      if (geometries[geometry.uuid] === undefined) {\r\n\r\n        var json = geometry.toJSON();\r\n\r\n        delete json.metadata;\r\n\r\n        geometries[geometry.uuid] = json;\r\n\r\n        output.geometries.push(json);\r\n\r\n      }\r\n\r\n      return geometry.uuid;\r\n\r\n    };\r\n\r\n    //\r\n\r\n    var materials = {};\r\n\r\n    var parseMaterial = function(material) {\r\n\r\n      if (output.materials === undefined) {\r\n\r\n        output.materials = [];\r\n\r\n      }\r\n\r\n      if (materials[material.uuid] === undefined) {\r\n\r\n        var json = material.toJSON();\r\n\r\n        delete json.metadata;\r\n\r\n        materials[material.uuid] = json;\r\n\r\n        output.materials.push(json);\r\n\r\n      }\r\n\r\n      return material.uuid;\r\n\r\n    };\r\n\r\n    //\r\n\r\n    var parseObject = function(object) {\r\n\r\n      var data = {};\r\n\r\n      data.uuid = object.uuid;\r\n      data.type = object.type;\r\n\r\n      if (object.name !== '') data.name = object.name;\r\n      if (JSON.stringify(object.userData) !== '{}') data.userData = object.userData;\r\n      if (object.visible !== true) data.visible = object.visible;\r\n\r\n      if (object instanceof THREE.PerspectiveCamera) {\r\n\r\n        data.fov = object.fov;\r\n        data.aspect = object.aspect;\r\n        data.near = object.near;\r\n        data.far = object.far;\r\n\r\n      }\r\n      else if (object instanceof THREE.OrthographicCamera) {\r\n\r\n        data.left = object.left;\r\n        data.right = object.right;\r\n        data.top = object.top;\r\n        data.bottom = object.bottom;\r\n        data.near = object.near;\r\n        data.far = object.far;\r\n\r\n      }\r\n      else if (object instanceof THREE.AmbientLight) {\r\n\r\n        data.color = object.color.getHex();\r\n\r\n      }\r\n      else if (object instanceof THREE.DirectionalLight) {\r\n\r\n        data.color = object.color.getHex();\r\n        data.intensity = object.intensity;\r\n\r\n      }\r\n      else if (object instanceof THREE.PointLight) {\r\n\r\n        data.color = object.color.getHex();\r\n        data.intensity = object.intensity;\r\n        data.distance = object.distance;\r\n        data.decay = object.decay;\r\n\r\n      }\r\n      else if (object instanceof THREE.SpotLight) {\r\n\r\n        data.color = object.color.getHex();\r\n        data.intensity = object.intensity;\r\n        data.distance = object.distance;\r\n        data.angle = object.angle;\r\n        data.exponent = object.exponent;\r\n        data.decay = object.decay;\r\n\r\n      }\r\n      else if (object instanceof THREE.HemisphereLight) {\r\n\r\n        data.color = object.color.getHex();\r\n        data.groundColor = object.groundColor.getHex();\r\n\r\n      }\r\n      else if (object instanceof THREE.Mesh || object instanceof THREE.Line || object instanceof THREE.PointCloud) {\r\n\r\n        data.geometry = parseGeometry(object.geometry);\r\n        data.material = parseMaterial(object.material);\r\n\r\n        if (object instanceof THREE.Line) data.mode = object.mode;\r\n\r\n      }\r\n      else if (object instanceof THREE.Sprite) {\r\n\r\n        data.material = parseMaterial(object.material);\r\n\r\n      }\r\n\r\n      data.matrix = object.matrix.toArray();\r\n\r\n      if (object.children.length > 0) {\r\n\r\n        data.children = [];\r\n\r\n        for (var i = 0; i < object.children.length; i++) {\r\n\r\n          data.children.push(parseObject(object.children[i]));\r\n\r\n        }\r\n\r\n      }\r\n\r\n      return data;\r\n\r\n    }\r\n\r\n    output.object = parseObject(this);\r\n\r\n    return output;\r\n\r\n  },\r\n\r\n  clone: function(object, recursive) {\r\n\r\n    if (object === undefined) object = new THREE.Object3D();\r\n    if (recursive === undefined) recursive = true;\r\n\r\n    object.name = this.name;\r\n\r\n    object.up.copy(this.up);\r\n\r\n    object.position.copy(this.position);\r\n    object.quaternion.copy(this.quaternion);\r\n    object.scale.copy(this.scale);\r\n\r\n    object.rotationAutoUpdate = this.rotationAutoUpdate;\r\n\r\n    object.matrix.copy(this.matrix);\r\n    object.matrixWorld.copy(this.matrixWorld);\r\n\r\n    object.matrixAutoUpdate = this.matrixAutoUpdate;\r\n    object.matrixWorldNeedsUpdate = this.matrixWorldNeedsUpdate;\r\n\r\n    object.visible = this.visible;\r\n\r\n    object.castShadow = this.castShadow;\r\n    object.receiveShadow = this.receiveShadow;\r\n\r\n    object.frustumCulled = this.frustumCulled;\r\n\r\n    object.userData = JSON.parse(JSON.stringify(this.userData));\r\n\r\n    if (recursive === true) {\r\n\r\n      for (var i = 0; i < this.children.length; i++) {\r\n\r\n        var child = this.children[i];\r\n        object.add(child.clone());\r\n\r\n      }\r\n\r\n    }\r\n\r\n    return object;\r\n\r\n  }\r\n\r\n};\r\n\r\nTHREE.EventDispatcher.prototype.apply(THREE.Object3D.prototype);\r\n\r\nTHREE.Object3DIdCount = 0;\r\n\r\n// File:src/core/Face3.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author alteredq / http://alteredqualia.com/\r\n */\r\n\r\nTHREE.Face3 = function(a, b, c, normal, color, materialIndex) {\r\n\r\n  this.a = a;\r\n  this.b = b;\r\n  this.c = c;\r\n\r\n  this.normal = normal instanceof THREE.Vector3 ? normal : new THREE.Vector3();\r\n  this.vertexNormals = normal instanceof Array ? normal : [];\r\n\r\n  this.color = color instanceof THREE.Color ? color : new THREE.Color();\r\n  this.vertexColors = color instanceof Array ? color : [];\r\n\r\n  this.vertexTangents = [];\r\n\r\n  this.materialIndex = materialIndex !== undefined ? materialIndex : 0;\r\n\r\n};\r\n\r\nTHREE.Face3.prototype = {\r\n\r\n  constructor: THREE.Face3,\r\n\r\n  clone: function() {\r\n\r\n    var face = new THREE.Face3(this.a, this.b, this.c);\r\n\r\n    face.normal.copy(this.normal);\r\n    face.color.copy(this.color);\r\n\r\n    face.materialIndex = this.materialIndex;\r\n\r\n    for (var i = 0, il = this.vertexNormals.length; i < il; i++) {\r\n\r\n      face.vertexNormals[i] = this.vertexNormals[i].clone();\r\n\r\n    }\r\n\r\n    for (var i = 0, il = this.vertexColors.length; i < il; i++) {\r\n\r\n      face.vertexColors[i] = this.vertexColors[i].clone();\r\n\r\n    }\r\n\r\n    for (var i = 0, il = this.vertexTangents.length; i < il; i++) {\r\n\r\n      face.vertexTangents[i] = this.vertexTangents[i].clone();\r\n\r\n    }\r\n\r\n    return face;\r\n\r\n  }\r\n\r\n};\r\n\r\n// File:src/core/Face4.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.Face4 = function(a, b, c, d, normal, color, materialIndex) {\r\n\r\n  THREE.warn('THREE.Face4 has been removed. A THREE.Face3 will be created instead.')\r\n  return new THREE.Face3(a, b, c, normal, color, materialIndex);\r\n\r\n};\r\n\r\n// File:src/core/BufferAttribute.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.BufferAttribute = function(array, itemSize) {\r\n\r\n  this.array = array;\r\n  this.itemSize = itemSize;\r\n\r\n  this.needsUpdate = false;\r\n\r\n};\r\n\r\nTHREE.BufferAttribute.prototype = {\r\n\r\n  constructor: THREE.BufferAttribute,\r\n\r\n  get length() {\r\n\r\n    return this.array.length;\r\n\r\n  },\r\n\r\n  copyAt: function(index1, attribute, index2) {\r\n\r\n    index1 *= this.itemSize;\r\n    index2 *= attribute.itemSize;\r\n\r\n    for (var i = 0, l = this.itemSize; i < l; i++) {\r\n\r\n      this.array[index1 + i] = attribute.array[index2 + i];\r\n\r\n    }\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  set: function(value, offset) {\r\n\r\n    if (offset === undefined) offset = 0;\r\n\r\n    this.array.set(value, offset);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  setX: function(index, x) {\r\n\r\n    this.array[index * this.itemSize] = x;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  setY: function(index, y) {\r\n\r\n    this.array[index * this.itemSize + 1] = y;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  setZ: function(index, z) {\r\n\r\n    this.array[index * this.itemSize + 2] = z;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  setXY: function(index, x, y) {\r\n\r\n    index *= this.itemSize;\r\n\r\n    this.array[index] = x;\r\n    this.array[index + 1] = y;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  setXYZ: function(index, x, y, z) {\r\n\r\n    index *= this.itemSize;\r\n\r\n    this.array[index] = x;\r\n    this.array[index + 1] = y;\r\n    this.array[index + 2] = z;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  setXYZW: function(index, x, y, z, w) {\r\n\r\n    index *= this.itemSize;\r\n\r\n    this.array[index] = x;\r\n    this.array[index + 1] = y;\r\n    this.array[index + 2] = z;\r\n    this.array[index + 3] = w;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  clone: function() {\r\n\r\n    return new THREE.BufferAttribute(new this.array.constructor(this.array), this.itemSize);\r\n\r\n  }\r\n\r\n};\r\n\r\n//\r\n\r\nTHREE.Int8Attribute = function(data, itemSize) {\r\n\r\n  THREE.warn('THREE.Int8Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead.');\r\n  return new THREE.BufferAttribute(data, itemSize);\r\n\r\n};\r\n\r\nTHREE.Uint8Attribute = function(data, itemSize) {\r\n\r\n  THREE.warn('THREE.Uint8Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead.');\r\n  return new THREE.BufferAttribute(data, itemSize);\r\n\r\n};\r\n\r\nTHREE.Uint8ClampedAttribute = function(data, itemSize) {\r\n\r\n  THREE.warn('THREE.Uint8ClampedAttribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead.');\r\n  return new THREE.BufferAttribute(data, itemSize);\r\n\r\n\r\n};\r\n\r\nTHREE.Int16Attribute = function(data, itemSize) {\r\n\r\n  THREE.warn('THREE.Int16Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead.');\r\n  return new THREE.BufferAttribute(data, itemSize);\r\n\r\n};\r\n\r\nTHREE.Uint16Attribute = function(data, itemSize) {\r\n\r\n  THREE.warn('THREE.Uint16Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead.');\r\n  return new THREE.BufferAttribute(data, itemSize);\r\n\r\n};\r\n\r\nTHREE.Int32Attribute = function(data, itemSize) {\r\n\r\n  THREE.warn('THREE.Int32Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead.');\r\n  return new THREE.BufferAttribute(data, itemSize);\r\n\r\n};\r\n\r\nTHREE.Uint32Attribute = function(data, itemSize) {\r\n\r\n  THREE.warn('THREE.Uint32Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead.');\r\n  return new THREE.BufferAttribute(data, itemSize);\r\n\r\n};\r\n\r\nTHREE.Float32Attribute = function(data, itemSize) {\r\n\r\n  THREE.warn('THREE.Float32Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead.');\r\n  return new THREE.BufferAttribute(data, itemSize);\r\n\r\n};\r\n\r\nTHREE.Float64Attribute = function(data, itemSize) {\r\n\r\n  THREE.warn('THREE.Float64Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead.');\r\n  return new THREE.BufferAttribute(data, itemSize);\r\n\r\n};\r\n\r\n// File:src/core/DynamicBufferAttribute.js\r\n\r\n/**\r\n * @author benaadams / https://twitter.com/ben_a_adams\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.DynamicBufferAttribute = function(array, itemSize) {\r\n\r\n  THREE.BufferAttribute.call(this, array, itemSize);\r\n\r\n  this.updateRange = {\r\n    offset: 0,\r\n    count: -1\r\n  };\r\n\r\n};\r\n\r\nTHREE.DynamicBufferAttribute.prototype = Object.create(THREE.BufferAttribute.prototype);\r\nTHREE.DynamicBufferAttribute.prototype.constructor = THREE.DynamicBufferAttribute;\r\n\r\nTHREE.DynamicBufferAttribute.prototype.clone = function() {\r\n\r\n  return new THREE.DynamicBufferAttribute(new this.array.constructor(this.array), this.itemSize);\r\n\r\n};\r\n\r\n// File:src/core/BufferGeometry.js\r\n\r\n/**\r\n * @author alteredq / http://alteredqualia.com/\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.BufferGeometry = function() {\r\n\r\n  Object.defineProperty(this, 'id', {\r\n    value: THREE.GeometryIdCount++\r\n  });\r\n\r\n  this.uuid = THREE.Math.generateUUID();\r\n\r\n  this.name = '';\r\n  this.type = 'BufferGeometry';\r\n\r\n  this.attributes = {};\r\n  this.attributesKeys = [];\r\n\r\n  this.drawcalls = [];\r\n  this.offsets = this.drawcalls; // backwards compatibility\r\n\r\n  this.boundingBox = null;\r\n  this.boundingSphere = null;\r\n\r\n};\r\n\r\nTHREE.BufferGeometry.prototype = {\r\n\r\n  constructor: THREE.BufferGeometry,\r\n\r\n  addAttribute: function(name, attribute) {\r\n\r\n    if (attribute instanceof THREE.BufferAttribute === false) {\r\n\r\n      THREE.warn('THREE.BufferGeometry: .addAttribute() now expects ( name, attribute ).');\r\n\r\n      this.attributes[name] = {\r\n        array: arguments[1],\r\n        itemSize: arguments[2]\r\n      };\r\n\r\n      return;\r\n\r\n    }\r\n\r\n    this.attributes[name] = attribute;\r\n    this.attributesKeys = Object.keys(this.attributes);\r\n\r\n  },\r\n\r\n  getAttribute: function(name) {\r\n\r\n    return this.attributes[name];\r\n\r\n  },\r\n\r\n  addDrawCall: function(start, count, indexOffset) {\r\n\r\n    this.drawcalls.push({\r\n\r\n      start: start,\r\n      count: count,\r\n      index: indexOffset !== undefined ? indexOffset : 0\r\n\r\n    });\r\n\r\n  },\r\n\r\n  applyMatrix: function(matrix) {\r\n\r\n    var position = this.attributes.position;\r\n\r\n    if (position !== undefined) {\r\n\r\n      matrix.applyToVector3Array(position.array);\r\n      position.needsUpdate = true;\r\n\r\n    }\r\n\r\n    var normal = this.attributes.normal;\r\n\r\n    if (normal !== undefined) {\r\n\r\n      var normalMatrix = new THREE.Matrix3().getNormalMatrix(matrix);\r\n\r\n      normalMatrix.applyToVector3Array(normal.array);\r\n      normal.needsUpdate = true;\r\n\r\n    }\r\n\r\n    if (this.boundingBox !== null) {\r\n\r\n      this.computeBoundingBox();\r\n\r\n    }\r\n\r\n    if (this.boundingSphere !== null) {\r\n\r\n      this.computeBoundingSphere();\r\n\r\n    }\r\n\r\n  },\r\n\r\n  center: function() {\r\n\r\n    this.computeBoundingBox();\r\n\r\n    var offset = this.boundingBox.center().negate();\r\n\r\n    this.applyMatrix(new THREE.Matrix4().setPosition(offset));\r\n\r\n    return offset;\r\n\r\n  },\r\n\r\n  fromGeometry: function(geometry, settings) {\r\n\r\n    settings = settings || {\r\n      'vertexColors': THREE.NoColors\r\n    };\r\n\r\n    var vertices = geometry.vertices;\r\n    var faces = geometry.faces;\r\n    var faceVertexUvs = geometry.faceVertexUvs;\r\n    var vertexColors = settings.vertexColors;\r\n    var hasFaceVertexUv = faceVertexUvs[0].length > 0;\r\n    var hasFaceVertexNormals = faces[0].vertexNormals.length == 3;\r\n\r\n    var positions = new Float32Array(faces.length * 3 * 3);\r\n    this.addAttribute('position', new THREE.BufferAttribute(positions, 3));\r\n\r\n    var normals = new Float32Array(faces.length * 3 * 3);\r\n    this.addAttribute('normal', new THREE.BufferAttribute(normals, 3));\r\n\r\n    if (vertexColors !== THREE.NoColors) {\r\n\r\n      var colors = new Float32Array(faces.length * 3 * 3);\r\n      this.addAttribute('color', new THREE.BufferAttribute(colors, 3));\r\n\r\n    }\r\n\r\n    if (hasFaceVertexUv === true) {\r\n\r\n      var uvs = new Float32Array(faces.length * 3 * 2);\r\n      this.addAttribute('uv', new THREE.BufferAttribute(uvs, 2));\r\n\r\n    }\r\n\r\n    for (var i = 0, i2 = 0, i3 = 0; i < faces.length; i++, i2 += 6, i3 += 9) {\r\n\r\n      var face = faces[i];\r\n\r\n      var a = vertices[face.a];\r\n      var b = vertices[face.b];\r\n      var c = vertices[face.c];\r\n\r\n      positions[i3] = a.x;\r\n      positions[i3 + 1] = a.y;\r\n      positions[i3 + 2] = a.z;\r\n\r\n      positions[i3 + 3] = b.x;\r\n      positions[i3 + 4] = b.y;\r\n      positions[i3 + 5] = b.z;\r\n\r\n      positions[i3 + 6] = c.x;\r\n      positions[i3 + 7] = c.y;\r\n      positions[i3 + 8] = c.z;\r\n\r\n      if (hasFaceVertexNormals === true) {\r\n\r\n        var na = face.vertexNormals[0];\r\n        var nb = face.vertexNormals[1];\r\n        var nc = face.vertexNormals[2];\r\n\r\n        normals[i3] = na.x;\r\n        normals[i3 + 1] = na.y;\r\n        normals[i3 + 2] = na.z;\r\n\r\n        normals[i3 + 3] = nb.x;\r\n        normals[i3 + 4] = nb.y;\r\n        normals[i3 + 5] = nb.z;\r\n\r\n        normals[i3 + 6] = nc.x;\r\n        normals[i3 + 7] = nc.y;\r\n        normals[i3 + 8] = nc.z;\r\n\r\n      }\r\n      else {\r\n\r\n        var n = face.normal;\r\n\r\n        normals[i3] = n.x;\r\n        normals[i3 + 1] = n.y;\r\n        normals[i3 + 2] = n.z;\r\n\r\n        normals[i3 + 3] = n.x;\r\n        normals[i3 + 4] = n.y;\r\n        normals[i3 + 5] = n.z;\r\n\r\n        normals[i3 + 6] = n.x;\r\n        normals[i3 + 7] = n.y;\r\n        normals[i3 + 8] = n.z;\r\n\r\n      }\r\n\r\n      if (vertexColors === THREE.FaceColors) {\r\n\r\n        var fc = face.color;\r\n\r\n        colors[i3] = fc.r;\r\n        colors[i3 + 1] = fc.g;\r\n        colors[i3 + 2] = fc.b;\r\n\r\n        colors[i3 + 3] = fc.r;\r\n        colors[i3 + 4] = fc.g;\r\n        colors[i3 + 5] = fc.b;\r\n\r\n        colors[i3 + 6] = fc.r;\r\n        colors[i3 + 7] = fc.g;\r\n        colors[i3 + 8] = fc.b;\r\n\r\n      }\r\n      else if (vertexColors === THREE.VertexColors) {\r\n\r\n        var vca = face.vertexColors[0];\r\n        var vcb = face.vertexColors[1];\r\n        var vcc = face.vertexColors[2];\r\n\r\n        colors[i3] = vca.r;\r\n        colors[i3 + 1] = vca.g;\r\n        colors[i3 + 2] = vca.b;\r\n\r\n        colors[i3 + 3] = vcb.r;\r\n        colors[i3 + 4] = vcb.g;\r\n        colors[i3 + 5] = vcb.b;\r\n\r\n        colors[i3 + 6] = vcc.r;\r\n        colors[i3 + 7] = vcc.g;\r\n        colors[i3 + 8] = vcc.b;\r\n\r\n      }\r\n\r\n      if (hasFaceVertexUv === true) {\r\n\r\n        var uva = faceVertexUvs[0][i][0];\r\n        var uvb = faceVertexUvs[0][i][1];\r\n        var uvc = faceVertexUvs[0][i][2];\r\n\r\n        uvs[i2] = uva.x;\r\n        uvs[i2 + 1] = uva.y;\r\n\r\n        uvs[i2 + 2] = uvb.x;\r\n        uvs[i2 + 3] = uvb.y;\r\n\r\n        uvs[i2 + 4] = uvc.x;\r\n        uvs[i2 + 5] = uvc.y;\r\n\r\n      }\r\n\r\n    }\r\n\r\n    this.computeBoundingSphere()\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  computeBoundingBox: function() {\r\n\r\n    var vector = new THREE.Vector3();\r\n\r\n    return function() {\r\n\r\n      if (this.boundingBox === null) {\r\n\r\n        this.boundingBox = new THREE.Box3();\r\n\r\n      }\r\n\r\n      var positions = this.attributes.position.array;\r\n\r\n      if (positions) {\r\n\r\n        var bb = this.boundingBox;\r\n        bb.makeEmpty();\r\n\r\n        for (var i = 0, il = positions.length; i < il; i += 3) {\r\n\r\n          vector.set(positions[i], positions[i + 1], positions[i + 2]);\r\n          bb.expandByPoint(vector);\r\n\r\n        }\r\n\r\n      }\r\n\r\n      if (positions === undefined || positions.length === 0) {\r\n\r\n        this.boundingBox.min.set(0, 0, 0);\r\n        this.boundingBox.max.set(0, 0, 0);\r\n\r\n      }\r\n\r\n      if (isNaN(this.boundingBox.min.x) || isNaN(this.boundingBox.min.y) || isNaN(this.boundingBox.min.z)) {\r\n\r\n        THREE.error('THREE.BufferGeometry.computeBoundingBox: Computed min/max have NaN values. The \"position\" attribute is likely to have NaN values.');\r\n\r\n      }\r\n\r\n    }\r\n\r\n  }(),\r\n\r\n  computeBoundingSphere: function() {\r\n\r\n    var box = new THREE.Box3();\r\n    var vector = new THREE.Vector3();\r\n\r\n    return function() {\r\n\r\n      if (this.boundingSphere === null) {\r\n\r\n        this.boundingSphere = new THREE.Sphere();\r\n\r\n      }\r\n\r\n      var positions = this.attributes.position.array;\r\n\r\n      if (positions) {\r\n\r\n        box.makeEmpty();\r\n\r\n        var center = this.boundingSphere.center;\r\n\r\n        for (var i = 0, il = positions.length; i < il; i += 3) {\r\n\r\n          vector.set(positions[i], positions[i + 1], positions[i + 2]);\r\n          box.expandByPoint(vector);\r\n\r\n        }\r\n\r\n        box.center(center);\r\n\r\n        // hoping to find a boundingSphere with a radius smaller than the\r\n        // boundingSphere of the boundingBox:  sqrt(3) smaller in the best case\r\n\r\n        var maxRadiusSq = 0;\r\n\r\n        for (var i = 0, il = positions.length; i < il; i += 3) {\r\n\r\n          vector.set(positions[i], positions[i + 1], positions[i + 2]);\r\n          maxRadiusSq = Math.max(maxRadiusSq, center.distanceToSquared(vector));\r\n\r\n        }\r\n\r\n        this.boundingSphere.radius = Math.sqrt(maxRadiusSq);\r\n\r\n        if (isNaN(this.boundingSphere.radius)) {\r\n\r\n          THREE.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The \"position\" attribute is likely to have NaN values.');\r\n\r\n        }\r\n\r\n      }\r\n\r\n    }\r\n\r\n  }(),\r\n\r\n  computeFaceNormals: function() {\r\n\r\n    // backwards compatibility\r\n\r\n  },\r\n\r\n  computeVertexNormals: function() {\r\n\r\n    var attributes = this.attributes;\r\n\r\n    if (attributes.position) {\r\n\r\n      var positions = attributes.position.array;\r\n\r\n      if (attributes.normal === undefined) {\r\n\r\n        this.addAttribute('normal', new THREE.BufferAttribute(new Float32Array(positions.length), 3));\r\n\r\n      }\r\n      else {\r\n\r\n        // reset existing normals to zero\r\n\r\n        var normals = attributes.normal.array;\r\n\r\n        for (var i = 0, il = normals.length; i < il; i++) {\r\n\r\n          normals[i] = 0;\r\n\r\n        }\r\n\r\n      }\r\n\r\n      var normals = attributes.normal.array;\r\n\r\n      var vA, vB, vC,\r\n\r\n        pA = new THREE.Vector3(),\r\n        pB = new THREE.Vector3(),\r\n        pC = new THREE.Vector3(),\r\n\r\n        cb = new THREE.Vector3(),\r\n        ab = new THREE.Vector3();\r\n\r\n      // indexed elements\r\n\r\n      if (attributes.index) {\r\n\r\n        var indices = attributes.index.array;\r\n\r\n        var offsets = (this.offsets.length > 0 ? this.offsets : [{\r\n          start: 0,\r\n          count: indices.length,\r\n          index: 0\r\n        }]);\r\n\r\n        for (var j = 0, jl = offsets.length; j < jl; ++j) {\r\n\r\n          var start = offsets[j].start;\r\n          var count = offsets[j].count;\r\n          var index = offsets[j].index;\r\n\r\n          for (var i = start, il = start + count; i < il; i += 3) {\r\n\r\n            vA = (index + indices[i]) * 3;\r\n            vB = (index + indices[i + 1]) * 3;\r\n            vC = (index + indices[i + 2]) * 3;\r\n\r\n            pA.fromArray(positions, vA);\r\n            pB.fromArray(positions, vB);\r\n            pC.fromArray(positions, vC);\r\n\r\n            cb.subVectors(pC, pB);\r\n            ab.subVectors(pA, pB);\r\n            cb.cross(ab);\r\n\r\n            normals[vA] += cb.x;\r\n            normals[vA + 1] += cb.y;\r\n            normals[vA + 2] += cb.z;\r\n\r\n            normals[vB] += cb.x;\r\n            normals[vB + 1] += cb.y;\r\n            normals[vB + 2] += cb.z;\r\n\r\n            normals[vC] += cb.x;\r\n            normals[vC + 1] += cb.y;\r\n            normals[vC + 2] += cb.z;\r\n\r\n          }\r\n\r\n        }\r\n\r\n      }\r\n      else {\r\n\r\n        // non-indexed elements (unconnected triangle soup)\r\n\r\n        for (var i = 0, il = positions.length; i < il; i += 9) {\r\n\r\n          pA.fromArray(positions, i);\r\n          pB.fromArray(positions, i + 3);\r\n          pC.fromArray(positions, i + 6);\r\n\r\n          cb.subVectors(pC, pB);\r\n          ab.subVectors(pA, pB);\r\n          cb.cross(ab);\r\n\r\n          normals[i] = cb.x;\r\n          normals[i + 1] = cb.y;\r\n          normals[i + 2] = cb.z;\r\n\r\n          normals[i + 3] = cb.x;\r\n          normals[i + 4] = cb.y;\r\n          normals[i + 5] = cb.z;\r\n\r\n          normals[i + 6] = cb.x;\r\n          normals[i + 7] = cb.y;\r\n          normals[i + 8] = cb.z;\r\n\r\n        }\r\n\r\n      }\r\n\r\n      this.normalizeNormals();\r\n\r\n      attributes.normal.needsUpdate = true;\r\n\r\n    }\r\n\r\n  },\r\n\r\n  computeTangents: function() {\r\n\r\n    // based on http://www.terathon.com/code/tangent.html\r\n    // (per vertex tangents)\r\n\r\n    if (this.attributes.index === undefined ||\r\n      this.attributes.position === undefined ||\r\n      this.attributes.normal === undefined ||\r\n      this.attributes.uv === undefined) {\r\n\r\n      THREE.warn('THREE.BufferGeometry: Missing required attributes (index, position, normal or uv) in BufferGeometry.computeTangents()');\r\n      return;\r\n\r\n    }\r\n\r\n    var indices = this.attributes.index.array;\r\n    var positions = this.attributes.position.array;\r\n    var normals = this.attributes.normal.array;\r\n    var uvs = this.attributes.uv.array;\r\n\r\n    var nVertices = positions.length / 3;\r\n\r\n    if (this.attributes.tangent === undefined) {\r\n\r\n      this.addAttribute('tangent', new THREE.BufferAttribute(new Float32Array(4 * nVertices), 4));\r\n\r\n    }\r\n\r\n    var tangents = this.attributes.tangent.array;\r\n\r\n    var tan1 = [],\r\n      tan2 = [];\r\n\r\n    for (var k = 0; k < nVertices; k++) {\r\n\r\n      tan1[k] = new THREE.Vector3();\r\n      tan2[k] = new THREE.Vector3();\r\n\r\n    }\r\n\r\n    var vA = new THREE.Vector3(),\r\n      vB = new THREE.Vector3(),\r\n      vC = new THREE.Vector3(),\r\n\r\n      uvA = new THREE.Vector2(),\r\n      uvB = new THREE.Vector2(),\r\n      uvC = new THREE.Vector2(),\r\n\r\n      x1, x2, y1, y2, z1, z2,\r\n      s1, s2, t1, t2, r;\r\n\r\n    var sdir = new THREE.Vector3(),\r\n      tdir = new THREE.Vector3();\r\n\r\n    function handleTriangle(a, b, c) {\r\n\r\n      vA.fromArray(positions, a * 3);\r\n      vB.fromArray(positions, b * 3);\r\n      vC.fromArray(positions, c * 3);\r\n\r\n      uvA.fromArray(uvs, a * 2);\r\n      uvB.fromArray(uvs, b * 2);\r\n      uvC.fromArray(uvs, c * 2);\r\n\r\n      x1 = vB.x - vA.x;\r\n      x2 = vC.x - vA.x;\r\n\r\n      y1 = vB.y - vA.y;\r\n      y2 = vC.y - vA.y;\r\n\r\n      z1 = vB.z - vA.z;\r\n      z2 = vC.z - vA.z;\r\n\r\n      s1 = uvB.x - uvA.x;\r\n      s2 = uvC.x - uvA.x;\r\n\r\n      t1 = uvB.y - uvA.y;\r\n      t2 = uvC.y - uvA.y;\r\n\r\n      r = 1.0 / (s1 * t2 - s2 * t1);\r\n\r\n      sdir.set(\r\n        (t2 * x1 - t1 * x2) * r, (t2 * y1 - t1 * y2) * r, (t2 * z1 - t1 * z2) * r\r\n      );\r\n\r\n      tdir.set(\r\n        (s1 * x2 - s2 * x1) * r, (s1 * y2 - s2 * y1) * r, (s1 * z2 - s2 * z1) * r\r\n      );\r\n\r\n      tan1[a].add(sdir);\r\n      tan1[b].add(sdir);\r\n      tan1[c].add(sdir);\r\n\r\n      tan2[a].add(tdir);\r\n      tan2[b].add(tdir);\r\n      tan2[c].add(tdir);\r\n\r\n    }\r\n\r\n    var i, il;\r\n    var j, jl;\r\n    var iA, iB, iC;\r\n\r\n    if (this.drawcalls.length === 0) {\r\n\r\n      this.addDrawCall(0, indices.length, 0);\r\n\r\n    }\r\n\r\n    var drawcalls = this.drawcalls;\r\n\r\n    for (j = 0, jl = drawcalls.length; j < jl; ++j) {\r\n\r\n      var start = drawcalls[j].start;\r\n      var count = drawcalls[j].count;\r\n      var index = drawcalls[j].index;\r\n\r\n      for (i = start, il = start + count; i < il; i += 3) {\r\n\r\n        iA = index + indices[i];\r\n        iB = index + indices[i + 1];\r\n        iC = index + indices[i + 2];\r\n\r\n        handleTriangle(iA, iB, iC);\r\n\r\n      }\r\n\r\n    }\r\n\r\n    var tmp = new THREE.Vector3(),\r\n      tmp2 = new THREE.Vector3();\r\n    var n = new THREE.Vector3(),\r\n      n2 = new THREE.Vector3();\r\n    var w, t, test;\r\n\r\n    function handleVertex(v) {\r\n\r\n      n.fromArray(normals, v * 3);\r\n      n2.copy(n);\r\n\r\n      t = tan1[v];\r\n\r\n      // Gram-Schmidt orthogonalize\r\n\r\n      tmp.copy(t);\r\n      tmp.sub(n.multiplyScalar(n.dot(t))).normalize();\r\n\r\n      // Calculate handedness\r\n\r\n      tmp2.crossVectors(n2, t);\r\n      test = tmp2.dot(tan2[v]);\r\n      w = (test < 0.0) ? -1.0 : 1.0;\r\n\r\n      tangents[v * 4] = tmp.x;\r\n      tangents[v * 4 + 1] = tmp.y;\r\n      tangents[v * 4 + 2] = tmp.z;\r\n      tangents[v * 4 + 3] = w;\r\n\r\n    }\r\n\r\n    for (j = 0, jl = drawcalls.length; j < jl; ++j) {\r\n\r\n      var start = drawcalls[j].start;\r\n      var count = drawcalls[j].count;\r\n      var index = drawcalls[j].index;\r\n\r\n      for (i = start, il = start + count; i < il; i += 3) {\r\n\r\n        iA = index + indices[i];\r\n        iB = index + indices[i + 1];\r\n        iC = index + indices[i + 2];\r\n\r\n        handleVertex(iA);\r\n        handleVertex(iB);\r\n        handleVertex(iC);\r\n\r\n      }\r\n\r\n    }\r\n\r\n  },\r\n\r\n  /*\r\n  Compute the draw offset for large models by chunking the index buffer into chunks of 65k addressable vertices.\r\n  This method will effectively rewrite the index buffer and remap all attributes to match the new indices.\r\n  WARNING: This method will also expand the vertex count to prevent sprawled triangles across draw offsets.\r\n  size - Defaults to 65535, but allows for larger or smaller chunks.\r\n  */\r\n  computeOffsets: function(size) {\r\n\r\n    if (size === undefined) size = 65535; // WebGL limits type of index buffer values to 16-bit.\r\n\r\n    var indices = this.attributes.index.array;\r\n    var vertices = this.attributes.position.array;\r\n\r\n    var facesCount = (indices.length / 3);\r\n\r\n    /*\r\n    console.log(\"Computing buffers in offsets of \"+size+\" -> indices:\"+indices.length+\" vertices:\"+vertices.length);\r\n    console.log(\"Faces to process: \"+(indices.length/3));\r\n    console.log(\"Reordering \"+verticesCount+\" vertices.\");\r\n    */\r\n\r\n    var sortedIndices = new Uint16Array(indices.length); //16-bit buffers\r\n    var indexPtr = 0;\r\n    var vertexPtr = 0;\r\n\r\n    var offsets = [{\r\n      start: 0,\r\n      count: 0,\r\n      index: 0\r\n    }];\r\n    var offset = offsets[0];\r\n\r\n    var duplicatedVertices = 0;\r\n    var newVerticeMaps = 0;\r\n    var faceVertices = new Int32Array(6);\r\n    var vertexMap = new Int32Array(vertices.length);\r\n    var revVertexMap = new Int32Array(vertices.length);\r\n    for (var j = 0; j < vertices.length; j++) {\r\n      vertexMap[j] = -1;\r\n      revVertexMap[j] = -1;\r\n    }\r\n\r\n    /*\r\n    \tTraverse every face and reorder vertices in the proper offsets of 65k.\r\n    \tWe can have more than 65k entries in the index buffer per offset, but only reference 65k values.\r\n    */\r\n    for (var findex = 0; findex < facesCount; findex++) {\r\n      newVerticeMaps = 0;\r\n\r\n      for (var vo = 0; vo < 3; vo++) {\r\n        var vid = indices[findex * 3 + vo];\r\n        if (vertexMap[vid] == -1) {\r\n          //Unmapped vertice\r\n          faceVertices[vo * 2] = vid;\r\n          faceVertices[vo * 2 + 1] = -1;\r\n          newVerticeMaps++;\r\n        }\r\n        else if (vertexMap[vid] < offset.index) {\r\n          //Reused vertices from previous block (duplicate)\r\n          faceVertices[vo * 2] = vid;\r\n          faceVertices[vo * 2 + 1] = -1;\r\n          duplicatedVertices++;\r\n        }\r\n        else {\r\n          //Reused vertice in the current block\r\n          faceVertices[vo * 2] = vid;\r\n          faceVertices[vo * 2 + 1] = vertexMap[vid];\r\n        }\r\n      }\r\n\r\n      var faceMax = vertexPtr + newVerticeMaps;\r\n      if (faceMax > (offset.index + size)) {\r\n        var new_offset = {\r\n          start: indexPtr,\r\n          count: 0,\r\n          index: vertexPtr\r\n        };\r\n        offsets.push(new_offset);\r\n        offset = new_offset;\r\n\r\n        //Re-evaluate reused vertices in light of new offset.\r\n        for (var v = 0; v < 6; v += 2) {\r\n          var new_vid = faceVertices[v + 1];\r\n          if (new_vid > -1 && new_vid < offset.index)\r\n            faceVertices[v + 1] = -1;\r\n        }\r\n      }\r\n\r\n      //Reindex the face.\r\n      for (var v = 0; v < 6; v += 2) {\r\n        var vid = faceVertices[v];\r\n        var new_vid = faceVertices[v + 1];\r\n\r\n        if (new_vid === -1)\r\n          new_vid = vertexPtr++;\r\n\r\n        vertexMap[vid] = new_vid;\r\n        revVertexMap[new_vid] = vid;\r\n        sortedIndices[indexPtr++] = new_vid - offset.index; //XXX overflows at 16bit\r\n        offset.count++;\r\n      }\r\n    }\r\n\r\n    /* Move all attribute values to map to the new computed indices , also expand the vertice stack to match our new vertexPtr. */\r\n    this.reorderBuffers(sortedIndices, revVertexMap, vertexPtr);\r\n    this.offsets = offsets; // TODO: Deprecate\r\n    this.drawcalls = offsets;\r\n\r\n    /*\r\n    var orderTime = Date.now();\r\n    console.log(\"Reorder time: \"+(orderTime-s)+\"ms\");\r\n    console.log(\"Duplicated \"+duplicatedVertices+\" vertices.\");\r\n    console.log(\"Compute Buffers time: \"+(Date.now()-s)+\"ms\");\r\n    console.log(\"Draw offsets: \"+offsets.length);\r\n    */\r\n\r\n    return offsets;\r\n\r\n  },\r\n\r\n  merge: function(geometry, offset) {\r\n\r\n    if (geometry instanceof THREE.BufferGeometry === false) {\r\n\r\n      THREE.error('THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.', geometry);\r\n      return;\r\n\r\n    }\r\n\r\n    if (offset === undefined) offset = 0;\r\n\r\n    var attributes = this.attributes;\r\n\r\n    for (var key in attributes) {\r\n\r\n      if (geometry.attributes[key] === undefined) continue;\r\n\r\n      var attribute1 = attributes[key];\r\n      var attributeArray1 = attribute1.array;\r\n\r\n      var attribute2 = geometry.attributes[key];\r\n      var attributeArray2 = attribute2.array;\r\n\r\n      var attributeSize = attribute2.itemSize;\r\n\r\n      for (var i = 0, j = attributeSize * offset; i < attributeArray2.length; i++, j++) {\r\n\r\n        attributeArray1[j] = attributeArray2[i];\r\n\r\n      }\r\n\r\n    }\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  normalizeNormals: function() {\r\n\r\n    var normals = this.attributes.normal.array;\r\n\r\n    var x, y, z, n;\r\n\r\n    for (var i = 0, il = normals.length; i < il; i += 3) {\r\n\r\n      x = normals[i];\r\n      y = normals[i + 1];\r\n      z = normals[i + 2];\r\n\r\n      n = 1.0 / Math.sqrt(x * x + y * y + z * z);\r\n\r\n      normals[i] *= n;\r\n      normals[i + 1] *= n;\r\n      normals[i + 2] *= n;\r\n\r\n    }\r\n\r\n  },\r\n\r\n  /*\r\n  \treoderBuffers:\r\n  \tReorder attributes based on a new indexBuffer and indexMap.\r\n  \tindexBuffer - Uint16Array of the new ordered indices.\r\n  \tindexMap - Int32Array where the position is the new vertex ID and the value the old vertex ID for each vertex.\r\n  \tvertexCount - Amount of total vertices considered in this reordering (in case you want to grow the vertice stack).\r\n  */\r\n  reorderBuffers: function(indexBuffer, indexMap, vertexCount) {\r\n\r\n    /* Create a copy of all attributes for reordering. */\r\n    var sortedAttributes = {};\r\n    for (var attr in this.attributes) {\r\n      if (attr == 'index')\r\n        continue;\r\n      var sourceArray = this.attributes[attr].array;\r\n      sortedAttributes[attr] = new sourceArray.constructor(this.attributes[attr].itemSize * vertexCount);\r\n    }\r\n\r\n    /* Move attribute positions based on the new index map */\r\n    for (var new_vid = 0; new_vid < vertexCount; new_vid++) {\r\n      var vid = indexMap[new_vid];\r\n      for (var attr in this.attributes) {\r\n        if (attr == 'index')\r\n          continue;\r\n        var attrArray = this.attributes[attr].array;\r\n        var attrSize = this.attributes[attr].itemSize;\r\n        var sortedAttr = sortedAttributes[attr];\r\n        for (var k = 0; k < attrSize; k++)\r\n          sortedAttr[new_vid * attrSize + k] = attrArray[vid * attrSize + k];\r\n      }\r\n    }\r\n\r\n    /* Carry the new sorted buffers locally */\r\n    this.attributes['index'].array = indexBuffer;\r\n    for (var attr in this.attributes) {\r\n      if (attr == 'index')\r\n        continue;\r\n      this.attributes[attr].array = sortedAttributes[attr];\r\n      this.attributes[attr].numItems = this.attributes[attr].itemSize * vertexCount;\r\n    }\r\n  },\r\n\r\n  toJSON: function() {\r\n\r\n    var output = {\r\n      metadata: {\r\n        version: 4.0,\r\n        type: 'BufferGeometry',\r\n        generator: 'BufferGeometryExporter'\r\n      },\r\n      uuid: this.uuid,\r\n      type: this.type,\r\n      data: {\r\n        attributes: {}\r\n      }\r\n    };\r\n\r\n    var attributes = this.attributes;\r\n    var offsets = this.offsets;\r\n    var boundingSphere = this.boundingSphere;\r\n\r\n    for (var key in attributes) {\r\n\r\n      var attribute = attributes[key];\r\n\r\n      var array = Array.prototype.slice.call(attribute.array);\r\n\r\n      output.data.attributes[key] = {\r\n        itemSize: attribute.itemSize,\r\n        type: attribute.array.constructor.name,\r\n        array: array\r\n      }\r\n\r\n    }\r\n\r\n    if (offsets.length > 0) {\r\n\r\n      output.data.offsets = JSON.parse(JSON.stringify(offsets));\r\n\r\n    }\r\n\r\n    if (boundingSphere !== null) {\r\n\r\n      output.data.boundingSphere = {\r\n        center: boundingSphere.center.toArray(),\r\n        radius: boundingSphere.radius\r\n      }\r\n\r\n    }\r\n\r\n    return output;\r\n\r\n  },\r\n\r\n  clone: function() {\r\n\r\n    var geometry = new THREE.BufferGeometry();\r\n\r\n    for (var attr in this.attributes) {\r\n\r\n      var sourceAttr = this.attributes[attr];\r\n      geometry.addAttribute(attr, sourceAttr.clone());\r\n\r\n    }\r\n\r\n    for (var i = 0, il = this.offsets.length; i < il; i++) {\r\n\r\n      var offset = this.offsets[i];\r\n\r\n      geometry.offsets.push({\r\n\r\n        start: offset.start,\r\n        index: offset.index,\r\n        count: offset.count\r\n\r\n      });\r\n\r\n    }\r\n\r\n    return geometry;\r\n\r\n  },\r\n\r\n  dispose: function() {\r\n\r\n    this.dispatchEvent({\r\n      type: 'dispose'\r\n    });\r\n\r\n  }\r\n\r\n};\r\n\r\nTHREE.EventDispatcher.prototype.apply(THREE.BufferGeometry.prototype);\r\n\r\n// File:src/core/Geometry.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author kile / http://kile.stravaganza.org/\r\n * @author alteredq / http://alteredqualia.com/\r\n * @author mikael emtinger / http://gomo.se/\r\n * @author zz85 / http://www.lab4games.net/zz85/blog\r\n * @author bhouston / http://exocortex.com\r\n */\r\n\r\nTHREE.Geometry = function() {\r\n\r\n  Object.defineProperty(this, 'id', {\r\n    value: THREE.GeometryIdCount++\r\n  });\r\n\r\n  this.uuid = THREE.Math.generateUUID();\r\n\r\n  this.name = '';\r\n  this.type = 'Geometry';\r\n\r\n  this.vertices = [];\r\n  this.colors = []; // one-to-one vertex colors, used in Points and Line\r\n\r\n  this.faces = [];\r\n\r\n  this.faceVertexUvs = [\r\n    []\r\n  ];\r\n\r\n  this.morphTargets = [];\r\n  this.morphColors = [];\r\n  this.morphNormals = [];\r\n\r\n  this.skinWeights = [];\r\n  this.skinIndices = [];\r\n\r\n  this.lineDistances = [];\r\n\r\n  this.boundingBox = null;\r\n  this.boundingSphere = null;\r\n\r\n  this.hasTangents = false;\r\n\r\n  this.dynamic = true; // the intermediate typed arrays will be deleted when set to false\r\n\r\n  // update flags\r\n\r\n  this.verticesNeedUpdate = false;\r\n  this.elementsNeedUpdate = false;\r\n  this.uvsNeedUpdate = false;\r\n  this.normalsNeedUpdate = false;\r\n  this.tangentsNeedUpdate = false;\r\n  this.colorsNeedUpdate = false;\r\n  this.lineDistancesNeedUpdate = false;\r\n\r\n  this.groupsNeedUpdate = false;\r\n\r\n};\r\n\r\nTHREE.Geometry.prototype = {\r\n\r\n  constructor: THREE.Geometry,\r\n\r\n  applyMatrix: function(matrix) {\r\n\r\n    var normalMatrix = new THREE.Matrix3().getNormalMatrix(matrix);\r\n\r\n    for (var i = 0, il = this.vertices.length; i < il; i++) {\r\n\r\n      var vertex = this.vertices[i];\r\n      vertex.applyMatrix4(matrix);\r\n\r\n    }\r\n\r\n    for (var i = 0, il = this.faces.length; i < il; i++) {\r\n\r\n      var face = this.faces[i];\r\n      face.normal.applyMatrix3(normalMatrix).normalize();\r\n\r\n      for (var j = 0, jl = face.vertexNormals.length; j < jl; j++) {\r\n\r\n        face.vertexNormals[j].applyMatrix3(normalMatrix).normalize();\r\n\r\n      }\r\n\r\n    }\r\n\r\n    if (this.boundingBox !== null) {\r\n\r\n      this.computeBoundingBox();\r\n\r\n    }\r\n\r\n    if (this.boundingSphere !== null) {\r\n\r\n      this.computeBoundingSphere();\r\n\r\n    }\r\n\r\n    this.verticesNeedUpdate = true;\r\n    this.normalsNeedUpdate = true;\r\n\r\n  },\r\n\r\n  fromBufferGeometry: function(geometry) {\r\n\r\n    var scope = this;\r\n\r\n    var attributes = geometry.attributes;\r\n\r\n    var vertices = attributes.position.array;\r\n    var indices = attributes.index !== undefined ? attributes.index.array : undefined;\r\n    var normals = attributes.normal !== undefined ? attributes.normal.array : undefined;\r\n    var colors = attributes.color !== undefined ? attributes.color.array : undefined;\r\n    var uvs = attributes.uv !== undefined ? attributes.uv.array : undefined;\r\n\r\n    var tempNormals = [];\r\n    var tempUVs = [];\r\n\r\n    for (var i = 0, j = 0; i < vertices.length; i += 3, j += 2) {\r\n\r\n      scope.vertices.push(new THREE.Vector3(vertices[i], vertices[i + 1], vertices[i + 2]));\r\n\r\n      if (normals !== undefined) {\r\n\r\n        tempNormals.push(new THREE.Vector3(normals[i], normals[i + 1], normals[i + 2]));\r\n\r\n      }\r\n\r\n      if (colors !== undefined) {\r\n\r\n        scope.colors.push(new THREE.Color(colors[i], colors[i + 1], colors[i + 2]));\r\n\r\n      }\r\n\r\n      if (uvs !== undefined) {\r\n\r\n        tempUVs.push(new THREE.Vector2(uvs[j], uvs[j + 1]));\r\n\r\n      }\r\n\r\n    }\r\n\r\n    var addFace = function(a, b, c) {\r\n\r\n      var vertexNormals = normals !== undefined ? [tempNormals[a].clone(), tempNormals[b].clone(), tempNormals[c].clone()] : [];\r\n      var vertexColors = colors !== undefined ? [scope.colors[a].clone(), scope.colors[b].clone(), scope.colors[c].clone()] : [];\r\n\r\n      scope.faces.push(new THREE.Face3(a, b, c, vertexNormals, vertexColors));\r\n\r\n      if (uvs !== undefined) {\r\n\r\n        scope.faceVertexUvs[0].push([tempUVs[a].clone(), tempUVs[b].clone(), tempUVs[c].clone()]);\r\n\r\n      }\r\n\r\n    };\r\n\r\n    if (indices !== undefined) {\r\n\r\n      var drawcalls = geometry.drawcalls;\r\n\r\n      if (drawcalls.length > 0) {\r\n\r\n        for (var i = 0; i < drawcalls.length; i++) {\r\n\r\n          var drawcall = drawcalls[i];\r\n\r\n          var start = drawcall.start;\r\n          var count = drawcall.count;\r\n          var index = drawcall.index;\r\n\r\n          for (var j = start, jl = start + count; j < jl; j += 3) {\r\n\r\n            addFace(index + indices[j], index + indices[j + 1], index + indices[j + 2]);\r\n\r\n          }\r\n\r\n        }\r\n\r\n      }\r\n      else {\r\n\r\n        for (var i = 0; i < indices.length; i += 3) {\r\n\r\n          addFace(indices[i], indices[i + 1], indices[i + 2]);\r\n\r\n        }\r\n\r\n      }\r\n\r\n    }\r\n    else {\r\n\r\n      for (var i = 0; i < vertices.length / 3; i += 3) {\r\n\r\n        addFace(i, i + 1, i + 2);\r\n\r\n      }\r\n\r\n    }\r\n\r\n    this.computeFaceNormals();\r\n\r\n    if (geometry.boundingBox !== null) {\r\n\r\n      this.boundingBox = geometry.boundingBox.clone();\r\n\r\n    }\r\n\r\n    if (geometry.boundingSphere !== null) {\r\n\r\n      this.boundingSphere = geometry.boundingSphere.clone();\r\n\r\n    }\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  center: function() {\r\n\r\n    this.computeBoundingBox();\r\n\r\n    var offset = this.boundingBox.center().negate();\r\n\r\n    this.applyMatrix(new THREE.Matrix4().setPosition(offset));\r\n\r\n    return offset;\r\n\r\n  },\r\n\r\n  computeFaceNormals: function() {\r\n\r\n    var cb = new THREE.Vector3(),\r\n      ab = new THREE.Vector3();\r\n\r\n    for (var f = 0, fl = this.faces.length; f < fl; f++) {\r\n\r\n      var face = this.faces[f];\r\n\r\n      var vA = this.vertices[face.a];\r\n      var vB = this.vertices[face.b];\r\n      var vC = this.vertices[face.c];\r\n\r\n      cb.subVectors(vC, vB);\r\n      ab.subVectors(vA, vB);\r\n      cb.cross(ab);\r\n\r\n      cb.normalize();\r\n\r\n      face.normal.copy(cb);\r\n\r\n    }\r\n\r\n  },\r\n\r\n  computeVertexNormals: function(areaWeighted) {\r\n\r\n    var v, vl, f, fl, face, vertices;\r\n\r\n    vertices = new Array(this.vertices.length);\r\n\r\n    for (v = 0, vl = this.vertices.length; v < vl; v++) {\r\n\r\n      vertices[v] = new THREE.Vector3();\r\n\r\n    }\r\n\r\n    if (areaWeighted) {\r\n\r\n      // vertex normals weighted by triangle areas\r\n      // http://www.iquilezles.org/www/articles/normals/normals.htm\r\n\r\n      var vA, vB, vC;\r\n      var cb = new THREE.Vector3(),\r\n        ab = new THREE.Vector3();\r\n\r\n      for (f = 0, fl = this.faces.length; f < fl; f++) {\r\n\r\n        face = this.faces[f];\r\n\r\n        vA = this.vertices[face.a];\r\n        vB = this.vertices[face.b];\r\n        vC = this.vertices[face.c];\r\n\r\n        cb.subVectors(vC, vB);\r\n        ab.subVectors(vA, vB);\r\n        cb.cross(ab);\r\n\r\n        vertices[face.a].add(cb);\r\n        vertices[face.b].add(cb);\r\n        vertices[face.c].add(cb);\r\n\r\n      }\r\n\r\n    }\r\n    else {\r\n\r\n      for (f = 0, fl = this.faces.length; f < fl; f++) {\r\n\r\n        face = this.faces[f];\r\n\r\n        vertices[face.a].add(face.normal);\r\n        vertices[face.b].add(face.normal);\r\n        vertices[face.c].add(face.normal);\r\n\r\n      }\r\n\r\n    }\r\n\r\n    for (v = 0, vl = this.vertices.length; v < vl; v++) {\r\n\r\n      vertices[v].normalize();\r\n\r\n    }\r\n\r\n    for (f = 0, fl = this.faces.length; f < fl; f++) {\r\n\r\n      face = this.faces[f];\r\n\r\n      face.vertexNormals[0] = vertices[face.a].clone();\r\n      face.vertexNormals[1] = vertices[face.b].clone();\r\n      face.vertexNormals[2] = vertices[face.c].clone();\r\n\r\n    }\r\n\r\n  },\r\n\r\n  computeMorphNormals: function() {\r\n\r\n    var i, il, f, fl, face;\r\n\r\n    // save original normals\r\n    // - create temp variables on first access\r\n    //   otherwise just copy (for faster repeated calls)\r\n\r\n    for (f = 0, fl = this.faces.length; f < fl; f++) {\r\n\r\n      face = this.faces[f];\r\n\r\n      if (!face.__originalFaceNormal) {\r\n\r\n        face.__originalFaceNormal = face.normal.clone();\r\n\r\n      }\r\n      else {\r\n\r\n        face.__originalFaceNormal.copy(face.normal);\r\n\r\n      }\r\n\r\n      if (!face.__originalVertexNormals) face.__originalVertexNormals = [];\r\n\r\n      for (i = 0, il = face.vertexNormals.length; i < il; i++) {\r\n\r\n        if (!face.__originalVertexNormals[i]) {\r\n\r\n          face.__originalVertexNormals[i] = face.vertexNormals[i].clone();\r\n\r\n        }\r\n        else {\r\n\r\n          face.__originalVertexNormals[i].copy(face.vertexNormals[i]);\r\n\r\n        }\r\n\r\n      }\r\n\r\n    }\r\n\r\n    // use temp geometry to compute face and vertex normals for each morph\r\n\r\n    var tmpGeo = new THREE.Geometry();\r\n    tmpGeo.faces = this.faces;\r\n\r\n    for (i = 0, il = this.morphTargets.length; i < il; i++) {\r\n\r\n      // create on first access\r\n\r\n      if (!this.morphNormals[i]) {\r\n\r\n        this.morphNormals[i] = {};\r\n        this.morphNormals[i].faceNormals = [];\r\n        this.morphNormals[i].vertexNormals = [];\r\n\r\n        var dstNormalsFace = this.morphNormals[i].faceNormals;\r\n        var dstNormalsVertex = this.morphNormals[i].vertexNormals;\r\n\r\n        var faceNormal, vertexNormals;\r\n\r\n        for (f = 0, fl = this.faces.length; f < fl; f++) {\r\n\r\n          faceNormal = new THREE.Vector3();\r\n          vertexNormals = {\r\n            a: new THREE.Vector3(),\r\n            b: new THREE.Vector3(),\r\n            c: new THREE.Vector3()\r\n          };\r\n\r\n          dstNormalsFace.push(faceNormal);\r\n          dstNormalsVertex.push(vertexNormals);\r\n\r\n        }\r\n\r\n      }\r\n\r\n      var morphNormals = this.morphNormals[i];\r\n\r\n      // set vertices to morph target\r\n\r\n      tmpGeo.vertices = this.morphTargets[i].vertices;\r\n\r\n      // compute morph normals\r\n\r\n      tmpGeo.computeFaceNormals();\r\n      tmpGeo.computeVertexNormals();\r\n\r\n      // store morph normals\r\n\r\n      var faceNormal, vertexNormals;\r\n\r\n      for (f = 0, fl = this.faces.length; f < fl; f++) {\r\n\r\n        face = this.faces[f];\r\n\r\n        faceNormal = morphNormals.faceNormals[f];\r\n        vertexNormals = morphNormals.vertexNormals[f];\r\n\r\n        faceNormal.copy(face.normal);\r\n\r\n        vertexNormals.a.copy(face.vertexNormals[0]);\r\n        vertexNormals.b.copy(face.vertexNormals[1]);\r\n        vertexNormals.c.copy(face.vertexNormals[2]);\r\n\r\n      }\r\n\r\n    }\r\n\r\n    // restore original normals\r\n\r\n    for (f = 0, fl = this.faces.length; f < fl; f++) {\r\n\r\n      face = this.faces[f];\r\n\r\n      face.normal = face.__originalFaceNormal;\r\n      face.vertexNormals = face.__originalVertexNormals;\r\n\r\n    }\r\n\r\n  },\r\n\r\n  computeTangents: function() {\r\n\r\n    // based on http://www.terathon.com/code/tangent.html\r\n    // tangents go to vertices\r\n\r\n    var f, fl, v, vl, i, vertexIndex,\r\n      face, uv, vA, vB, vC, uvA, uvB, uvC,\r\n      x1, x2, y1, y2, z1, z2,\r\n      s1, s2, t1, t2, r, t, test,\r\n      tan1 = [],\r\n      tan2 = [],\r\n      sdir = new THREE.Vector3(),\r\n      tdir = new THREE.Vector3(),\r\n      tmp = new THREE.Vector3(),\r\n      tmp2 = new THREE.Vector3(),\r\n      n = new THREE.Vector3(),\r\n      w;\r\n\r\n    for (v = 0, vl = this.vertices.length; v < vl; v++) {\r\n\r\n      tan1[v] = new THREE.Vector3();\r\n      tan2[v] = new THREE.Vector3();\r\n\r\n    }\r\n\r\n    function handleTriangle(context, a, b, c, ua, ub, uc) {\r\n\r\n      vA = context.vertices[a];\r\n      vB = context.vertices[b];\r\n      vC = context.vertices[c];\r\n\r\n      uvA = uv[ua];\r\n      uvB = uv[ub];\r\n      uvC = uv[uc];\r\n\r\n      x1 = vB.x - vA.x;\r\n      x2 = vC.x - vA.x;\r\n      y1 = vB.y - vA.y;\r\n      y2 = vC.y - vA.y;\r\n      z1 = vB.z - vA.z;\r\n      z2 = vC.z - vA.z;\r\n\r\n      s1 = uvB.x - uvA.x;\r\n      s2 = uvC.x - uvA.x;\r\n      t1 = uvB.y - uvA.y;\r\n      t2 = uvC.y - uvA.y;\r\n\r\n      r = 1.0 / (s1 * t2 - s2 * t1);\r\n      sdir.set((t2 * x1 - t1 * x2) * r, (t2 * y1 - t1 * y2) * r, (t2 * z1 - t1 * z2) * r);\r\n      tdir.set((s1 * x2 - s2 * x1) * r, (s1 * y2 - s2 * y1) * r, (s1 * z2 - s2 * z1) * r);\r\n\r\n      tan1[a].add(sdir);\r\n      tan1[b].add(sdir);\r\n      tan1[c].add(sdir);\r\n\r\n      tan2[a].add(tdir);\r\n      tan2[b].add(tdir);\r\n      tan2[c].add(tdir);\r\n\r\n    }\r\n\r\n    for (f = 0, fl = this.faces.length; f < fl; f++) {\r\n\r\n      face = this.faces[f];\r\n      uv = this.faceVertexUvs[0][f]; // use UV layer 0 for tangents\r\n\r\n      handleTriangle(this, face.a, face.b, face.c, 0, 1, 2);\r\n\r\n    }\r\n\r\n    var faceIndex = ['a', 'b', 'c', 'd'];\r\n\r\n    for (f = 0, fl = this.faces.length; f < fl; f++) {\r\n\r\n      face = this.faces[f];\r\n\r\n      for (i = 0; i < Math.min(face.vertexNormals.length, 3); i++) {\r\n\r\n        n.copy(face.vertexNormals[i]);\r\n\r\n        vertexIndex = face[faceIndex[i]];\r\n\r\n        t = tan1[vertexIndex];\r\n\r\n        // Gram-Schmidt orthogonalize\r\n\r\n        tmp.copy(t);\r\n        tmp.sub(n.multiplyScalar(n.dot(t))).normalize();\r\n\r\n        // Calculate handedness\r\n\r\n        tmp2.crossVectors(face.vertexNormals[i], t);\r\n        test = tmp2.dot(tan2[vertexIndex]);\r\n        w = (test < 0.0) ? -1.0 : 1.0;\r\n\r\n        face.vertexTangents[i] = new THREE.Vector4(tmp.x, tmp.y, tmp.z, w);\r\n\r\n      }\r\n\r\n    }\r\n\r\n    this.hasTangents = true;\r\n\r\n  },\r\n\r\n  computeLineDistances: function() {\r\n\r\n    var d = 0;\r\n    var vertices = this.vertices;\r\n\r\n    for (var i = 0, il = vertices.length; i < il; i++) {\r\n\r\n      if (i > 0) {\r\n\r\n        d += vertices[i].distanceTo(vertices[i - 1]);\r\n\r\n      }\r\n\r\n      this.lineDistances[i] = d;\r\n\r\n    }\r\n\r\n  },\r\n\r\n  computeBoundingBox: function() {\r\n\r\n    if (this.boundingBox === null) {\r\n\r\n      this.boundingBox = new THREE.Box3();\r\n\r\n    }\r\n\r\n    this.boundingBox.setFromPoints(this.vertices);\r\n\r\n  },\r\n\r\n  computeBoundingSphere: function() {\r\n\r\n    if (this.boundingSphere === null) {\r\n\r\n      this.boundingSphere = new THREE.Sphere();\r\n\r\n    }\r\n\r\n    this.boundingSphere.setFromPoints(this.vertices);\r\n\r\n  },\r\n\r\n  merge: function(geometry, matrix, materialIndexOffset) {\r\n\r\n    if (geometry instanceof THREE.Geometry === false) {\r\n\r\n      THREE.error('THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.', geometry);\r\n      return;\r\n\r\n    }\r\n\r\n    var normalMatrix,\r\n      vertexOffset = this.vertices.length,\r\n      vertices1 = this.vertices,\r\n      vertices2 = geometry.vertices,\r\n      faces1 = this.faces,\r\n      faces2 = geometry.faces,\r\n      uvs1 = this.faceVertexUvs[0],\r\n      uvs2 = geometry.faceVertexUvs[0];\r\n\r\n    if (materialIndexOffset === undefined) materialIndexOffset = 0;\r\n\r\n    if (matrix !== undefined) {\r\n\r\n      normalMatrix = new THREE.Matrix3().getNormalMatrix(matrix);\r\n\r\n    }\r\n\r\n    // vertices\r\n\r\n    for (var i = 0, il = vertices2.length; i < il; i++) {\r\n\r\n      var vertex = vertices2[i];\r\n\r\n      var vertexCopy = vertex.clone();\r\n\r\n      if (matrix !== undefined) vertexCopy.applyMatrix4(matrix);\r\n\r\n      vertices1.push(vertexCopy);\r\n\r\n    }\r\n\r\n    // faces\r\n\r\n    for (i = 0, il = faces2.length; i < il; i++) {\r\n\r\n      var face = faces2[i],\r\n        faceCopy, normal, color,\r\n        faceVertexNormals = face.vertexNormals,\r\n        faceVertexColors = face.vertexColors;\r\n\r\n      faceCopy = new THREE.Face3(face.a + vertexOffset, face.b + vertexOffset, face.c + vertexOffset);\r\n      faceCopy.normal.copy(face.normal);\r\n\r\n      if (normalMatrix !== undefined) {\r\n\r\n        faceCopy.normal.applyMatrix3(normalMatrix).normalize();\r\n\r\n      }\r\n\r\n      for (var j = 0, jl = faceVertexNormals.length; j < jl; j++) {\r\n\r\n        normal = faceVertexNormals[j].clone();\r\n\r\n        if (normalMatrix !== undefined) {\r\n\r\n          normal.applyMatrix3(normalMatrix).normalize();\r\n\r\n        }\r\n\r\n        faceCopy.vertexNormals.push(normal);\r\n\r\n      }\r\n\r\n      faceCopy.color.copy(face.color);\r\n\r\n      for (var j = 0, jl = faceVertexColors.length; j < jl; j++) {\r\n\r\n        color = faceVertexColors[j];\r\n        faceCopy.vertexColors.push(color.clone());\r\n\r\n      }\r\n\r\n      faceCopy.materialIndex = face.materialIndex + materialIndexOffset;\r\n\r\n      faces1.push(faceCopy);\r\n\r\n    }\r\n\r\n    // uvs\r\n\r\n    for (i = 0, il = uvs2.length; i < il; i++) {\r\n\r\n      var uv = uvs2[i],\r\n        uvCopy = [];\r\n\r\n      if (uv === undefined) {\r\n\r\n        continue;\r\n\r\n      }\r\n\r\n      for (var j = 0, jl = uv.length; j < jl; j++) {\r\n\r\n        uvCopy.push(uv[j].clone());\r\n\r\n      }\r\n\r\n      uvs1.push(uvCopy);\r\n\r\n    }\r\n\r\n  },\r\n\r\n  mergeMesh: function(mesh) {\r\n\r\n    if (mesh instanceof THREE.Mesh === false) {\r\n\r\n      THREE.error('THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.', mesh);\r\n      return;\r\n\r\n    }\r\n\r\n    mesh.matrixAutoUpdate && mesh.updateMatrix();\r\n\r\n    this.merge(mesh.geometry, mesh.matrix);\r\n\r\n  },\r\n\r\n  /*\r\n   * Checks for duplicate vertices with hashmap.\r\n   * Duplicated vertices are removed\r\n   * and faces' vertices are updated.\r\n   */\r\n\r\n  mergeVertices: function() {\r\n\r\n    var verticesMap = {}; // Hashmap for looking up vertice by position coordinates (and making sure they are unique)\r\n    var unique = [],\r\n      changes = [];\r\n\r\n    var v, key;\r\n    var precisionPoints = 4; // number of decimal points, eg. 4 for epsilon of 0.0001\r\n    var precision = Math.pow(10, precisionPoints);\r\n    var i, il, face;\r\n    var indices, j, jl;\r\n\r\n    for (i = 0, il = this.vertices.length; i < il; i++) {\r\n\r\n      v = this.vertices[i];\r\n      key = Math.round(v.x * precision) + '_' + Math.round(v.y * precision) + '_' + Math.round(v.z * precision);\r\n\r\n      if (verticesMap[key] === undefined) {\r\n\r\n        verticesMap[key] = i;\r\n        unique.push(this.vertices[i]);\r\n        changes[i] = unique.length - 1;\r\n\r\n      }\r\n      else {\r\n\r\n        //console.log('Duplicate vertex found. ', i, ' could be using ', verticesMap[key]);\r\n        changes[i] = changes[verticesMap[key]];\r\n\r\n      }\r\n\r\n    };\r\n\r\n\r\n    // if faces are completely degenerate after merging vertices, we\r\n    // have to remove them from the geometry.\r\n    var faceIndicesToRemove = [];\r\n\r\n    for (i = 0, il = this.faces.length; i < il; i++) {\r\n\r\n      face = this.faces[i];\r\n\r\n      face.a = changes[face.a];\r\n      face.b = changes[face.b];\r\n      face.c = changes[face.c];\r\n\r\n      indices = [face.a, face.b, face.c];\r\n\r\n      var dupIndex = -1;\r\n\r\n      // if any duplicate vertices are found in a Face3\r\n      // we have to remove the face as nothing can be saved\r\n      for (var n = 0; n < 3; n++) {\r\n        if (indices[n] == indices[(n + 1) % 3]) {\r\n\r\n          dupIndex = n;\r\n          faceIndicesToRemove.push(i);\r\n          break;\r\n\r\n        }\r\n      }\r\n\r\n    }\r\n\r\n    for (i = faceIndicesToRemove.length - 1; i >= 0; i--) {\r\n      var idx = faceIndicesToRemove[i];\r\n\r\n      this.faces.splice(idx, 1);\r\n\r\n      for (j = 0, jl = this.faceVertexUvs.length; j < jl; j++) {\r\n\r\n        this.faceVertexUvs[j].splice(idx, 1);\r\n\r\n      }\r\n\r\n    }\r\n\r\n    // Use unique set of vertices\r\n\r\n    var diff = this.vertices.length - unique.length;\r\n    this.vertices = unique;\r\n    return diff;\r\n\r\n  },\r\n\r\n  toJSON: function() {\r\n\r\n    var output = {\r\n      metadata: {\r\n        version: 4.0,\r\n        type: 'BufferGeometry',\r\n        generator: 'BufferGeometryExporter'\r\n      },\r\n      uuid: this.uuid,\r\n      type: this.type\r\n    };\r\n\r\n    if (this.name !== \"\") output.name = this.name;\r\n\r\n    if (this.parameters !== undefined) {\r\n\r\n      var parameters = this.parameters;\r\n\r\n      for (var key in parameters) {\r\n\r\n        if (parameters[key] !== undefined) output[key] = parameters[key];\r\n\r\n      }\r\n\r\n      return output;\r\n\r\n    }\r\n\r\n    var vertices = [];\r\n\r\n    for (var i = 0; i < this.vertices.length; i++) {\r\n\r\n      var vertex = this.vertices[i];\r\n      vertices.push(vertex.x, vertex.y, vertex.z);\r\n\r\n    }\r\n\r\n    var faces = [];\r\n    var normals = [];\r\n    var normalsHash = {};\r\n    var colors = [];\r\n    var colorsHash = {};\r\n    var uvs = [];\r\n    var uvsHash = {};\r\n\r\n    for (var i = 0; i < this.faces.length; i++) {\r\n\r\n      var face = this.faces[i];\r\n\r\n      var hasMaterial = false; // face.materialIndex !== undefined;\r\n      var hasFaceUv = false; // deprecated\r\n      var hasFaceVertexUv = this.faceVertexUvs[0][i] !== undefined;\r\n      var hasFaceNormal = face.normal.length() > 0;\r\n      var hasFaceVertexNormal = face.vertexNormals.length > 0;\r\n      var hasFaceColor = face.color.r !== 1 || face.color.g !== 1 || face.color.b !== 1;\r\n      var hasFaceVertexColor = face.vertexColors.length > 0;\r\n\r\n      var faceType = 0;\r\n\r\n      faceType = setBit(faceType, 0, 0);\r\n      faceType = setBit(faceType, 1, hasMaterial);\r\n      faceType = setBit(faceType, 2, hasFaceUv);\r\n      faceType = setBit(faceType, 3, hasFaceVertexUv);\r\n      faceType = setBit(faceType, 4, hasFaceNormal);\r\n      faceType = setBit(faceType, 5, hasFaceVertexNormal);\r\n      faceType = setBit(faceType, 6, hasFaceColor);\r\n      faceType = setBit(faceType, 7, hasFaceVertexColor);\r\n\r\n      faces.push(faceType);\r\n      faces.push(face.a, face.b, face.c);\r\n\r\n\r\n      /*\r\n      if ( hasMaterial ) {\r\n\r\n      \tfaces.push( face.materialIndex );\r\n\r\n      }\r\n      */\r\n\r\n      if (hasFaceVertexUv) {\r\n\r\n        var faceVertexUvs = this.faceVertexUvs[0][i];\r\n\r\n        faces.push(\r\n          getUvIndex(faceVertexUvs[0]),\r\n          getUvIndex(faceVertexUvs[1]),\r\n          getUvIndex(faceVertexUvs[2])\r\n        );\r\n\r\n      }\r\n\r\n      if (hasFaceNormal) {\r\n\r\n        faces.push(getNormalIndex(face.normal));\r\n\r\n      }\r\n\r\n      if (hasFaceVertexNormal) {\r\n\r\n        var vertexNormals = face.vertexNormals;\r\n\r\n        faces.push(\r\n          getNormalIndex(vertexNormals[0]),\r\n          getNormalIndex(vertexNormals[1]),\r\n          getNormalIndex(vertexNormals[2])\r\n        );\r\n\r\n      }\r\n\r\n      if (hasFaceColor) {\r\n\r\n        faces.push(getColorIndex(face.color));\r\n\r\n      }\r\n\r\n      if (hasFaceVertexColor) {\r\n\r\n        var vertexColors = face.vertexColors;\r\n\r\n        faces.push(\r\n          getColorIndex(vertexColors[0]),\r\n          getColorIndex(vertexColors[1]),\r\n          getColorIndex(vertexColors[2])\r\n        );\r\n\r\n      }\r\n\r\n    }\r\n\r\n    function setBit(value, position, enabled) {\r\n\r\n      return enabled ? value | (1 << position) : value & (~(1 << position));\r\n\r\n    }\r\n\r\n    function getNormalIndex(normal) {\r\n\r\n      var hash = normal.x.toString() + normal.y.toString() + normal.z.toString();\r\n\r\n      if (normalsHash[hash] !== undefined) {\r\n\r\n        return normalsHash[hash];\r\n\r\n      }\r\n\r\n      normalsHash[hash] = normals.length / 3;\r\n      normals.push(normal.x, normal.y, normal.z);\r\n\r\n      return normalsHash[hash];\r\n\r\n    }\r\n\r\n    function getColorIndex(color) {\r\n\r\n      var hash = color.r.toString() + color.g.toString() + color.b.toString();\r\n\r\n      if (colorsHash[hash] !== undefined) {\r\n\r\n        return colorsHash[hash];\r\n\r\n      }\r\n\r\n      colorsHash[hash] = colors.length;\r\n      colors.push(color.getHex());\r\n\r\n      return colorsHash[hash];\r\n\r\n    }\r\n\r\n    function getUvIndex(uv) {\r\n\r\n      var hash = uv.x.toString() + uv.y.toString();\r\n\r\n      if (uvsHash[hash] !== undefined) {\r\n\r\n        return uvsHash[hash];\r\n\r\n      }\r\n\r\n      uvsHash[hash] = uvs.length / 2;\r\n      uvs.push(uv.x, uv.y);\r\n\r\n      return uvsHash[hash];\r\n\r\n    }\r\n\r\n    output.data = {};\r\n\r\n    output.data.vertices = vertices;\r\n    output.data.normals = normals;\r\n    if (colors.length > 0) output.data.colors = colors;\r\n    if (uvs.length > 0) output.data.uvs = [uvs]; // temporal backward compatibility\r\n    output.data.faces = faces;\r\n\r\n    //\r\n\r\n    return output;\r\n\r\n  },\r\n\r\n  clone: function() {\r\n\r\n    var geometry = new THREE.Geometry();\r\n\r\n    var vertices = this.vertices;\r\n\r\n    for (var i = 0, il = vertices.length; i < il; i++) {\r\n\r\n      geometry.vertices.push(vertices[i].clone());\r\n\r\n    }\r\n\r\n    var faces = this.faces;\r\n\r\n    for (var i = 0, il = faces.length; i < il; i++) {\r\n\r\n      geometry.faces.push(faces[i].clone());\r\n\r\n    }\r\n\r\n    for (var i = 0, il = this.faceVertexUvs.length; i < il; i++) {\r\n\r\n      var faceVertexUvs = this.faceVertexUvs[i];\r\n\r\n      if (geometry.faceVertexUvs[i] === undefined) {\r\n\r\n        geometry.faceVertexUvs[i] = [];\r\n\r\n      }\r\n\r\n      for (var j = 0, jl = faceVertexUvs.length; j < jl; j++) {\r\n\r\n        var uvs = faceVertexUvs[j],\r\n          uvsCopy = [];\r\n\r\n        for (var k = 0, kl = uvs.length; k < kl; k++) {\r\n\r\n          var uv = uvs[k];\r\n\r\n          uvsCopy.push(uv.clone());\r\n\r\n        }\r\n\r\n        geometry.faceVertexUvs[i].push(uvsCopy);\r\n\r\n      }\r\n\r\n    }\r\n\r\n    return geometry;\r\n\r\n  },\r\n\r\n  dispose: function() {\r\n\r\n    this.dispatchEvent({\r\n      type: 'dispose'\r\n    });\r\n\r\n  }\r\n\r\n};\r\n\r\nTHREE.EventDispatcher.prototype.apply(THREE.Geometry.prototype);\r\n\r\nTHREE.GeometryIdCount = 0;\r\n\r\n// File:src/cameras/Camera.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author mikael emtinger / http://gomo.se/\r\n * @author WestLangley / http://github.com/WestLangley\r\n */\r\n\r\nTHREE.Camera = function() {\r\n\r\n  THREE.Object3D.call(this);\r\n\r\n  this.type = 'Camera';\r\n\r\n  this.matrixWorldInverse = new THREE.Matrix4();\r\n  this.projectionMatrix = new THREE.Matrix4();\r\n\r\n};\r\n\r\nTHREE.Camera.prototype = Object.create(THREE.Object3D.prototype);\r\nTHREE.Camera.prototype.constructor = THREE.Camera;\r\n\r\nTHREE.Camera.prototype.getWorldDirection = function() {\r\n\r\n  var quaternion = new THREE.Quaternion();\r\n\r\n  return function(optionalTarget) {\r\n\r\n    var result = optionalTarget || new THREE.Vector3();\r\n\r\n    this.getWorldQuaternion(quaternion);\r\n\r\n    return result.set(0, 0, -1).applyQuaternion(quaternion);\r\n\r\n  }\r\n\r\n}();\r\n\r\nTHREE.Camera.prototype.lookAt = function() {\r\n\r\n  // This routine does not support cameras with rotated and/or translated parent(s)\r\n\r\n  var m1 = new THREE.Matrix4();\r\n\r\n  return function(vector) {\r\n\r\n    m1.lookAt(this.position, vector, this.up);\r\n\r\n    this.quaternion.setFromRotationMatrix(m1);\r\n\r\n  };\r\n\r\n}();\r\n\r\nTHREE.Camera.prototype.clone = function(camera) {\r\n\r\n  if (camera === undefined) camera = new THREE.Camera();\r\n\r\n  THREE.Object3D.prototype.clone.call(this, camera);\r\n\r\n  camera.matrixWorldInverse.copy(this.matrixWorldInverse);\r\n  camera.projectionMatrix.copy(this.projectionMatrix);\r\n\r\n  return camera;\r\n};\r\n\r\n// File:src/cameras/CubeCamera.js\r\n\r\n/**\r\n * Camera for rendering cube maps\r\n *\t- renders scene into axis-aligned cube\r\n *\r\n * @author alteredq / http://alteredqualia.com/\r\n */\r\n\r\nTHREE.CubeCamera = function(near, far, cubeResolution) {\r\n\r\n  THREE.Object3D.call(this);\r\n\r\n  this.type = 'CubeCamera';\r\n\r\n  var fov = 90,\r\n    aspect = 1;\r\n\r\n  var cameraPX = new THREE.PerspectiveCamera(fov, aspect, near, far);\r\n  cameraPX.up.set(0, -1, 0);\r\n  cameraPX.lookAt(new THREE.Vector3(1, 0, 0));\r\n  this.add(cameraPX);\r\n\r\n  var cameraNX = new THREE.PerspectiveCamera(fov, aspect, near, far);\r\n  cameraNX.up.set(0, -1, 0);\r\n  cameraNX.lookAt(new THREE.Vector3(-1, 0, 0));\r\n  this.add(cameraNX);\r\n\r\n  var cameraPY = new THREE.PerspectiveCamera(fov, aspect, near, far);\r\n  cameraPY.up.set(0, 0, 1);\r\n  cameraPY.lookAt(new THREE.Vector3(0, 1, 0));\r\n  this.add(cameraPY);\r\n\r\n  var cameraNY = new THREE.PerspectiveCamera(fov, aspect, near, far);\r\n  cameraNY.up.set(0, 0, -1);\r\n  cameraNY.lookAt(new THREE.Vector3(0, -1, 0));\r\n  this.add(cameraNY);\r\n\r\n  var cameraPZ = new THREE.PerspectiveCamera(fov, aspect, near, far);\r\n  cameraPZ.up.set(0, -1, 0);\r\n  cameraPZ.lookAt(new THREE.Vector3(0, 0, 1));\r\n  this.add(cameraPZ);\r\n\r\n  var cameraNZ = new THREE.PerspectiveCamera(fov, aspect, near, far);\r\n  cameraNZ.up.set(0, -1, 0);\r\n  cameraNZ.lookAt(new THREE.Vector3(0, 0, -1));\r\n  this.add(cameraNZ);\r\n\r\n  this.renderTarget = new THREE.WebGLRenderTargetCube(cubeResolution, cubeResolution, {\r\n    format: THREE.RGBFormat,\r\n    magFilter: THREE.LinearFilter,\r\n    minFilter: THREE.LinearFilter\r\n  });\r\n\r\n  this.updateCubeMap = function(renderer, scene) {\r\n\r\n    var renderTarget = this.renderTarget;\r\n    var generateMipmaps = renderTarget.generateMipmaps;\r\n\r\n    renderTarget.generateMipmaps = false;\r\n\r\n    renderTarget.activeCubeFace = 0;\r\n    renderer.render(scene, cameraPX, renderTarget);\r\n\r\n    renderTarget.activeCubeFace = 1;\r\n    renderer.render(scene, cameraNX, renderTarget);\r\n\r\n    renderTarget.activeCubeFace = 2;\r\n    renderer.render(scene, cameraPY, renderTarget);\r\n\r\n    renderTarget.activeCubeFace = 3;\r\n    renderer.render(scene, cameraNY, renderTarget);\r\n\r\n    renderTarget.activeCubeFace = 4;\r\n    renderer.render(scene, cameraPZ, renderTarget);\r\n\r\n    renderTarget.generateMipmaps = generateMipmaps;\r\n\r\n    renderTarget.activeCubeFace = 5;\r\n    renderer.render(scene, cameraNZ, renderTarget);\r\n\r\n  };\r\n\r\n};\r\n\r\nTHREE.CubeCamera.prototype = Object.create(THREE.Object3D.prototype);\r\nTHREE.CubeCamera.prototype.constructor = THREE.CubeCamera;\r\n\r\n// File:src/cameras/OrthographicCamera.js\r\n\r\n/**\r\n * @author alteredq / http://alteredqualia.com/\r\n */\r\n\r\nTHREE.OrthographicCamera = function(left, right, top, bottom, near, far) {\r\n\r\n  THREE.Camera.call(this);\r\n\r\n  this.type = 'OrthographicCamera';\r\n\r\n  this.zoom = 1;\r\n\r\n  this.left = left;\r\n  this.right = right;\r\n  this.top = top;\r\n  this.bottom = bottom;\r\n\r\n  this.near = (near !== undefined) ? near : 0.1;\r\n  this.far = (far !== undefined) ? far : 2000;\r\n\r\n  this.updateProjectionMatrix();\r\n\r\n};\r\n\r\nTHREE.OrthographicCamera.prototype = Object.create(THREE.Camera.prototype);\r\nTHREE.OrthographicCamera.prototype.constructor = THREE.OrthographicCamera;\r\n\r\nTHREE.OrthographicCamera.prototype.updateProjectionMatrix = function() {\r\n\r\n  var dx = (this.right - this.left) / (2 * this.zoom);\r\n  var dy = (this.top - this.bottom) / (2 * this.zoom);\r\n  var cx = (this.right + this.left) / 2;\r\n  var cy = (this.top + this.bottom) / 2;\r\n\r\n  this.projectionMatrix.makeOrthographic(cx - dx, cx + dx, cy + dy, cy - dy, this.near, this.far);\r\n\r\n};\r\n\r\nTHREE.OrthographicCamera.prototype.clone = function() {\r\n\r\n  var camera = new THREE.OrthographicCamera();\r\n\r\n  THREE.Camera.prototype.clone.call(this, camera);\r\n\r\n  camera.zoom = this.zoom;\r\n\r\n  camera.left = this.left;\r\n  camera.right = this.right;\r\n  camera.top = this.top;\r\n  camera.bottom = this.bottom;\r\n\r\n  camera.near = this.near;\r\n  camera.far = this.far;\r\n\r\n  camera.projectionMatrix.copy(this.projectionMatrix);\r\n\r\n  return camera;\r\n};\r\n\r\n// File:src/cameras/PerspectiveCamera.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author greggman / http://games.greggman.com/\r\n * @author zz85 / http://www.lab4games.net/zz85/blog\r\n */\r\n\r\nTHREE.PerspectiveCamera = function(fov, aspect, near, far) {\r\n\r\n  THREE.Camera.call(this);\r\n\r\n  this.type = 'PerspectiveCamera';\r\n\r\n  this.zoom = 1;\r\n\r\n  this.fov = fov !== undefined ? fov : 50;\r\n  this.aspect = aspect !== undefined ? aspect : 1;\r\n  this.near = near !== undefined ? near : 0.1;\r\n  this.far = far !== undefined ? far : 2000;\r\n\r\n  this.updateProjectionMatrix();\r\n\r\n};\r\n\r\nTHREE.PerspectiveCamera.prototype = Object.create(THREE.Camera.prototype);\r\nTHREE.PerspectiveCamera.prototype.constructor = THREE.PerspectiveCamera;\r\n\r\n\r\n/**\r\n * Uses Focal Length (in mm) to estimate and set FOV\r\n * 35mm (fullframe) camera is used if frame size is not specified;\r\n * Formula based on http://www.bobatkins.com/photography/technical/field_of_view.html\r\n */\r\n\r\nTHREE.PerspectiveCamera.prototype.setLens = function(focalLength, frameHeight) {\r\n\r\n  if (frameHeight === undefined) frameHeight = 24;\r\n\r\n  this.fov = 2 * THREE.Math.radToDeg(Math.atan(frameHeight / (focalLength * 2)));\r\n  this.updateProjectionMatrix();\r\n\r\n}\r\n\r\n\r\n/**\r\n * Sets an offset in a larger frustum. This is useful for multi-window or\r\n * multi-monitor/multi-machine setups.\r\n *\r\n * For example, if you have 3x2 monitors and each monitor is 1920x1080 and\r\n * the monitors are in grid like this\r\n *\r\n *   +---+---+---+\r\n *   | A | B | C |\r\n *   +---+---+---+\r\n *   | D | E | F |\r\n *   +---+---+---+\r\n *\r\n * then for each monitor you would call it like this\r\n *\r\n *   var w = 1920;\r\n *   var h = 1080;\r\n *   var fullWidth = w * 3;\r\n *   var fullHeight = h * 2;\r\n *\r\n *   --A--\r\n *   camera.setOffset( fullWidth, fullHeight, w * 0, h * 0, w, h );\r\n *   --B--\r\n *   camera.setOffset( fullWidth, fullHeight, w * 1, h * 0, w, h );\r\n *   --C--\r\n *   camera.setOffset( fullWidth, fullHeight, w * 2, h * 0, w, h );\r\n *   --D--\r\n *   camera.setOffset( fullWidth, fullHeight, w * 0, h * 1, w, h );\r\n *   --E--\r\n *   camera.setOffset( fullWidth, fullHeight, w * 1, h * 1, w, h );\r\n *   --F--\r\n *   camera.setOffset( fullWidth, fullHeight, w * 2, h * 1, w, h );\r\n *\r\n *   Note there is no reason monitors have to be the same size or in a grid.\r\n */\r\n\r\nTHREE.PerspectiveCamera.prototype.setViewOffset = function(fullWidth, fullHeight, x, y, width, height) {\r\n\r\n  this.fullWidth = fullWidth;\r\n  this.fullHeight = fullHeight;\r\n  this.x = x;\r\n  this.y = y;\r\n  this.width = width;\r\n  this.height = height;\r\n\r\n  this.updateProjectionMatrix();\r\n\r\n};\r\n\r\n\r\nTHREE.PerspectiveCamera.prototype.updateProjectionMatrix = function() {\r\n\r\n  var fov = THREE.Math.radToDeg(2 * Math.atan(Math.tan(THREE.Math.degToRad(this.fov) * 0.5) / this.zoom));\r\n\r\n  if (this.fullWidth) {\r\n\r\n    var aspect = this.fullWidth / this.fullHeight;\r\n    var top = Math.tan(THREE.Math.degToRad(fov * 0.5)) * this.near;\r\n    var bottom = -top;\r\n    var left = aspect * bottom;\r\n    var right = aspect * top;\r\n    var width = Math.abs(right - left);\r\n    var height = Math.abs(top - bottom);\r\n\r\n    this.projectionMatrix.makeFrustum(\r\n      left + this.x * width / this.fullWidth,\r\n      left + (this.x + this.width) * width / this.fullWidth,\r\n      top - (this.y + this.height) * height / this.fullHeight,\r\n      top - this.y * height / this.fullHeight,\r\n      this.near,\r\n      this.far\r\n    );\r\n\r\n  }\r\n  else {\r\n\r\n    this.projectionMatrix.makePerspective(fov, this.aspect, this.near, this.far);\r\n\r\n  }\r\n\r\n};\r\n\r\nTHREE.PerspectiveCamera.prototype.clone = function() {\r\n\r\n  var camera = new THREE.PerspectiveCamera();\r\n\r\n  THREE.Camera.prototype.clone.call(this, camera);\r\n\r\n  camera.zoom = this.zoom;\r\n\r\n  camera.fov = this.fov;\r\n  camera.aspect = this.aspect;\r\n  camera.near = this.near;\r\n  camera.far = this.far;\r\n\r\n  camera.projectionMatrix.copy(this.projectionMatrix);\r\n\r\n  return camera;\r\n\r\n};\r\n\r\n// File:src/lights/Light.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author alteredq / http://alteredqualia.com/\r\n */\r\n\r\nTHREE.Light = function(color) {\r\n\r\n  THREE.Object3D.call(this);\r\n\r\n  this.type = 'Light';\r\n\r\n  this.color = new THREE.Color(color);\r\n\r\n};\r\n\r\nTHREE.Light.prototype = Object.create(THREE.Object3D.prototype);\r\nTHREE.Light.prototype.constructor = THREE.Light;\r\n\r\nTHREE.Light.prototype.clone = function(light) {\r\n\r\n  if (light === undefined) light = new THREE.Light();\r\n\r\n  THREE.Object3D.prototype.clone.call(this, light);\r\n\r\n  light.color.copy(this.color);\r\n\r\n  return light;\r\n\r\n};\r\n\r\n// File:src/lights/AmbientLight.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.AmbientLight = function(color) {\r\n\r\n  THREE.Light.call(this, color);\r\n\r\n  this.type = 'AmbientLight';\r\n\r\n};\r\n\r\nTHREE.AmbientLight.prototype = Object.create(THREE.Light.prototype);\r\nTHREE.AmbientLight.prototype.constructor = THREE.AmbientLight;\r\n\r\nTHREE.AmbientLight.prototype.clone = function() {\r\n\r\n  var light = new THREE.AmbientLight();\r\n\r\n  THREE.Light.prototype.clone.call(this, light);\r\n\r\n  return light;\r\n\r\n};\r\n\r\n// File:src/lights/AreaLight.js\r\n\r\n/**\r\n * @author MPanknin / http://www.redplant.de/\r\n * @author alteredq / http://alteredqualia.com/\r\n */\r\n\r\nTHREE.AreaLight = function(color, intensity) {\r\n\r\n  THREE.Light.call(this, color);\r\n\r\n  this.type = 'AreaLight';\r\n\r\n  this.normal = new THREE.Vector3(0, -1, 0);\r\n  this.right = new THREE.Vector3(1, 0, 0);\r\n\r\n  this.intensity = (intensity !== undefined) ? intensity : 1;\r\n\r\n  this.width = 1.0;\r\n  this.height = 1.0;\r\n\r\n  this.constantAttenuation = 1.5;\r\n  this.linearAttenuation = 0.5;\r\n  this.quadraticAttenuation = 0.1;\r\n\r\n};\r\n\r\nTHREE.AreaLight.prototype = Object.create(THREE.Light.prototype);\r\nTHREE.AreaLight.prototype.constructor = THREE.AreaLight;\r\n\r\n\r\n// File:src/lights/DirectionalLight.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author alteredq / http://alteredqualia.com/\r\n */\r\n\r\nTHREE.DirectionalLight = function(color, intensity) {\r\n\r\n  THREE.Light.call(this, color);\r\n\r\n  this.type = 'DirectionalLight';\r\n\r\n  this.position.set(0, 1, 0);\r\n  this.target = new THREE.Object3D();\r\n\r\n  this.intensity = (intensity !== undefined) ? intensity : 1;\r\n\r\n  this.castShadow = false;\r\n  this.onlyShadow = false;\r\n\r\n  //\r\n\r\n  this.shadowCameraNear = 50;\r\n  this.shadowCameraFar = 5000;\r\n\r\n  this.shadowCameraLeft = -500;\r\n  this.shadowCameraRight = 500;\r\n  this.shadowCameraTop = 500;\r\n  this.shadowCameraBottom = -500;\r\n\r\n  this.shadowCameraVisible = false;\r\n\r\n  this.shadowBias = 0;\r\n  this.shadowDarkness = 0.5;\r\n\r\n  this.shadowMapWidth = 512;\r\n  this.shadowMapHeight = 512;\r\n\r\n  //\r\n\r\n  this.shadowCascade = false;\r\n\r\n  this.shadowCascadeOffset = new THREE.Vector3(0, 0, -1000);\r\n  this.shadowCascadeCount = 2;\r\n\r\n  this.shadowCascadeBias = [0, 0, 0];\r\n  this.shadowCascadeWidth = [512, 512, 512];\r\n  this.shadowCascadeHeight = [512, 512, 512];\r\n\r\n  this.shadowCascadeNearZ = [-1.000, 0.990, 0.998];\r\n  this.shadowCascadeFarZ = [0.990, 0.998, 1.000];\r\n\r\n  this.shadowCascadeArray = [];\r\n\r\n  //\r\n\r\n  this.shadowMap = null;\r\n  this.shadowMapSize = null;\r\n  this.shadowCamera = null;\r\n  this.shadowMatrix = null;\r\n\r\n};\r\n\r\nTHREE.DirectionalLight.prototype = Object.create(THREE.Light.prototype);\r\nTHREE.DirectionalLight.prototype.constructor = THREE.DirectionalLight;\r\n\r\nTHREE.DirectionalLight.prototype.clone = function() {\r\n\r\n  var light = new THREE.DirectionalLight();\r\n\r\n  THREE.Light.prototype.clone.call(this, light);\r\n\r\n  light.target = this.target.clone();\r\n\r\n  light.intensity = this.intensity;\r\n\r\n  light.castShadow = this.castShadow;\r\n  light.onlyShadow = this.onlyShadow;\r\n\r\n  //\r\n\r\n  light.shadowCameraNear = this.shadowCameraNear;\r\n  light.shadowCameraFar = this.shadowCameraFar;\r\n\r\n  light.shadowCameraLeft = this.shadowCameraLeft;\r\n  light.shadowCameraRight = this.shadowCameraRight;\r\n  light.shadowCameraTop = this.shadowCameraTop;\r\n  light.shadowCameraBottom = this.shadowCameraBottom;\r\n\r\n  light.shadowCameraVisible = this.shadowCameraVisible;\r\n\r\n  light.shadowBias = this.shadowBias;\r\n  light.shadowDarkness = this.shadowDarkness;\r\n\r\n  light.shadowMapWidth = this.shadowMapWidth;\r\n  light.shadowMapHeight = this.shadowMapHeight;\r\n\r\n  //\r\n\r\n  light.shadowCascade = this.shadowCascade;\r\n\r\n  light.shadowCascadeOffset.copy(this.shadowCascadeOffset);\r\n  light.shadowCascadeCount = this.shadowCascadeCount;\r\n\r\n  light.shadowCascadeBias = this.shadowCascadeBias.slice(0);\r\n  light.shadowCascadeWidth = this.shadowCascadeWidth.slice(0);\r\n  light.shadowCascadeHeight = this.shadowCascadeHeight.slice(0);\r\n\r\n  light.shadowCascadeNearZ = this.shadowCascadeNearZ.slice(0);\r\n  light.shadowCascadeFarZ = this.shadowCascadeFarZ.slice(0);\r\n\r\n  return light;\r\n\r\n};\r\n\r\n// File:src/lights/HemisphereLight.js\r\n\r\n/**\r\n * @author alteredq / http://alteredqualia.com/\r\n */\r\n\r\nTHREE.HemisphereLight = function(skyColor, groundColor, intensity) {\r\n\r\n  THREE.Light.call(this, skyColor);\r\n\r\n  this.type = 'HemisphereLight';\r\n\r\n  this.position.set(0, 100, 0);\r\n\r\n  this.groundColor = new THREE.Color(groundColor);\r\n  this.intensity = (intensity !== undefined) ? intensity : 1;\r\n\r\n};\r\n\r\nTHREE.HemisphereLight.prototype = Object.create(THREE.Light.prototype);\r\nTHREE.HemisphereLight.prototype.constructor = THREE.HemisphereLight;\r\n\r\nTHREE.HemisphereLight.prototype.clone = function() {\r\n\r\n  var light = new THREE.HemisphereLight();\r\n\r\n  THREE.Light.prototype.clone.call(this, light);\r\n\r\n  light.groundColor.copy(this.groundColor);\r\n  light.intensity = this.intensity;\r\n\r\n  return light;\r\n\r\n};\r\n\r\n// File:src/lights/PointLight.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.PointLight = function(color, intensity, distance, decay) {\r\n\r\n  THREE.Light.call(this, color);\r\n\r\n  this.type = 'PointLight';\r\n\r\n  this.intensity = (intensity !== undefined) ? intensity : 1;\r\n  this.distance = (distance !== undefined) ? distance : 0;\r\n  this.decay = (decay !== undefined) ? decay : 1; // for physically correct lights, should be 2.\r\n\r\n};\r\n\r\nTHREE.PointLight.prototype = Object.create(THREE.Light.prototype);\r\nTHREE.PointLight.prototype.constructor = THREE.PointLight;\r\n\r\nTHREE.PointLight.prototype.clone = function() {\r\n\r\n  var light = new THREE.PointLight();\r\n\r\n  THREE.Light.prototype.clone.call(this, light);\r\n\r\n  light.intensity = this.intensity;\r\n  light.distance = this.distance;\r\n  light.decay = this.decay;\r\n\r\n  return light;\r\n\r\n};\r\n\r\n// File:src/lights/SpotLight.js\r\n\r\n/**\r\n * @author alteredq / http://alteredqualia.com/\r\n */\r\n\r\nTHREE.SpotLight = function(color, intensity, distance, angle, exponent, decay) {\r\n\r\n  THREE.Light.call(this, color);\r\n\r\n  this.type = 'SpotLight';\r\n\r\n  this.position.set(0, 1, 0);\r\n  this.target = new THREE.Object3D();\r\n\r\n  this.intensity = (intensity !== undefined) ? intensity : 1;\r\n  this.distance = (distance !== undefined) ? distance : 0;\r\n  this.angle = (angle !== undefined) ? angle : Math.PI / 3;\r\n  this.exponent = (exponent !== undefined) ? exponent : 10;\r\n  this.decay = (decay !== undefined) ? decay : 1; // for physically correct lights, should be 2.\r\n\r\n  this.castShadow = false;\r\n  this.onlyShadow = false;\r\n\r\n  //\r\n\r\n  this.shadowCameraNear = 50;\r\n  this.shadowCameraFar = 5000;\r\n  this.shadowCameraFov = 50;\r\n\r\n  this.shadowCameraVisible = false;\r\n\r\n  this.shadowBias = 0;\r\n  this.shadowDarkness = 0.5;\r\n\r\n  this.shadowMapWidth = 512;\r\n  this.shadowMapHeight = 512;\r\n\r\n  //\r\n\r\n  this.shadowMap = null;\r\n  this.shadowMapSize = null;\r\n  this.shadowCamera = null;\r\n  this.shadowMatrix = null;\r\n\r\n};\r\n\r\nTHREE.SpotLight.prototype = Object.create(THREE.Light.prototype);\r\nTHREE.SpotLight.prototype.constructor = THREE.SpotLight;\r\n\r\nTHREE.SpotLight.prototype.clone = function() {\r\n\r\n  var light = new THREE.SpotLight();\r\n\r\n  THREE.Light.prototype.clone.call(this, light);\r\n\r\n  light.target = this.target.clone();\r\n\r\n  light.intensity = this.intensity;\r\n  light.distance = this.distance;\r\n  light.angle = this.angle;\r\n  light.exponent = this.exponent;\r\n  light.decay = this.decay;\r\n\r\n  light.castShadow = this.castShadow;\r\n  light.onlyShadow = this.onlyShadow;\r\n\r\n  //\r\n\r\n  light.shadowCameraNear = this.shadowCameraNear;\r\n  light.shadowCameraFar = this.shadowCameraFar;\r\n  light.shadowCameraFov = this.shadowCameraFov;\r\n\r\n  light.shadowCameraVisible = this.shadowCameraVisible;\r\n\r\n  light.shadowBias = this.shadowBias;\r\n  light.shadowDarkness = this.shadowDarkness;\r\n\r\n  light.shadowMapWidth = this.shadowMapWidth;\r\n  light.shadowMapHeight = this.shadowMapHeight;\r\n\r\n  return light;\r\n\r\n};\r\n\r\n// File:src/loaders/Cache.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.Cache = {\r\n\r\n  files: {},\r\n\r\n  add: function(key, file) {\r\n\r\n    // console.log( 'THREE.Cache', 'Adding key:', key );\r\n\r\n    this.files[key] = file;\r\n\r\n  },\r\n\r\n  get: function(key) {\r\n\r\n    // console.log( 'THREE.Cache', 'Checking key:', key );\r\n\r\n    return this.files[key];\r\n\r\n  },\r\n\r\n  remove: function(key) {\r\n\r\n    delete this.files[key];\r\n\r\n  },\r\n\r\n  clear: function() {\r\n\r\n    this.files = {}\r\n\r\n  }\r\n\r\n};\r\n\r\n// File:src/loaders/Loader.js\r\n\r\n/**\r\n * @author alteredq / http://alteredqualia.com/\r\n */\r\n\r\nTHREE.Loader = function(showStatus) {\r\n\r\n  this.showStatus = showStatus;\r\n  this.statusDomElement = showStatus ? THREE.Loader.prototype.addStatusElement() : null;\r\n\r\n  this.imageLoader = new THREE.ImageLoader();\r\n\r\n  this.onLoadStart = function() {};\r\n  this.onLoadProgress = function() {};\r\n  this.onLoadComplete = function() {};\r\n\r\n};\r\n\r\nTHREE.Loader.prototype = {\r\n\r\n  constructor: THREE.Loader,\r\n\r\n  crossOrigin: undefined,\r\n\r\n  addStatusElement: function() {\r\n\r\n    var e = document.createElement('div');\r\n\r\n    e.style.position = 'absolute';\r\n    e.style.right = '0px';\r\n    e.style.top = '0px';\r\n    e.style.fontSize = '0.8em';\r\n    e.style.textAlign = 'left';\r\n    e.style.background = 'rgba(0,0,0,0.25)';\r\n    e.style.color = '#fff';\r\n    e.style.width = '120px';\r\n    e.style.padding = '0.5em 0.5em 0.5em 0.5em';\r\n    e.style.zIndex = 1000;\r\n\r\n    e.innerHTML = 'Loading ...';\r\n\r\n    return e;\r\n\r\n  },\r\n\r\n  updateProgress: function(progress) {\r\n\r\n    var message = 'Loaded ';\r\n\r\n    if (progress.total) {\r\n\r\n      message += (100 * progress.loaded / progress.total).toFixed(0) + '%';\r\n\r\n\r\n    }\r\n    else {\r\n\r\n      message += (progress.loaded / 1024).toFixed(2) + ' KB';\r\n\r\n    }\r\n\r\n    this.statusDomElement.innerHTML = message;\r\n\r\n  },\r\n\r\n  extractUrlBase: function(url) {\r\n\r\n    var parts = url.split('/');\r\n\r\n    if (parts.length === 1) return './';\r\n\r\n    parts.pop();\r\n\r\n    return parts.join('/') + '/';\r\n\r\n  },\r\n\r\n  initMaterials: function(materials, texturePath) {\r\n\r\n    var array = [];\r\n\r\n    for (var i = 0; i < materials.length; ++i) {\r\n\r\n      array[i] = this.createMaterial(materials[i], texturePath);\r\n\r\n    }\r\n\r\n    return array;\r\n\r\n  },\r\n\r\n  needsTangents: function(materials) {\r\n\r\n    for (var i = 0, il = materials.length; i < il; i++) {\r\n\r\n      var m = materials[i];\r\n\r\n      if (m instanceof THREE.ShaderMaterial) return true;\r\n\r\n    }\r\n\r\n    return false;\r\n\r\n  },\r\n\r\n  createMaterial: function(m, texturePath) {\r\n\r\n    var scope = this;\r\n\r\n    function nearest_pow2(n) {\r\n\r\n      var l = Math.log(n) / Math.LN2;\r\n      return Math.pow(2, Math.round(l));\r\n\r\n    }\r\n\r\n    function create_texture(where, name, sourceFile, repeat, offset, wrap, anisotropy) {\r\n\r\n      var fullPath = texturePath + sourceFile;\r\n\r\n      var texture;\r\n\r\n      var loader = THREE.Loader.Handlers.get(fullPath);\r\n\r\n      if (loader !== null) {\r\n\r\n        texture = loader.load(fullPath);\r\n\r\n      }\r\n      else {\r\n\r\n        texture = new THREE.Texture();\r\n\r\n        loader = scope.imageLoader;\r\n        loader.crossOrigin = scope.crossOrigin;\r\n        loader.load(fullPath, function(image) {\r\n\r\n          if (THREE.Math.isPowerOfTwo(image.width) === false ||\r\n            THREE.Math.isPowerOfTwo(image.height) === false) {\r\n\r\n            var width = nearest_pow2(image.width);\r\n            var height = nearest_pow2(image.height);\r\n\r\n            var canvas = document.createElement('canvas');\r\n            canvas.width = width;\r\n            canvas.height = height;\r\n\r\n            var context = canvas.getContext('2d');\r\n            context.drawImage(image, 0, 0, width, height);\r\n\r\n            texture.image = canvas;\r\n\r\n          }\r\n          else {\r\n\r\n            texture.image = image;\r\n\r\n          }\r\n\r\n          texture.needsUpdate = true;\r\n\r\n        });\r\n\r\n      }\r\n\r\n      texture.sourceFile = sourceFile;\r\n\r\n      if (repeat) {\r\n\r\n        texture.repeat.set(repeat[0], repeat[1]);\r\n\r\n        if (repeat[0] !== 1) texture.wrapS = THREE.RepeatWrapping;\r\n        if (repeat[1] !== 1) texture.wrapT = THREE.RepeatWrapping;\r\n\r\n      }\r\n\r\n      if (offset) {\r\n\r\n        texture.offset.set(offset[0], offset[1]);\r\n\r\n      }\r\n\r\n      if (wrap) {\r\n\r\n        var wrapMap = {\r\n          'repeat': THREE.RepeatWrapping,\r\n          'mirror': THREE.MirroredRepeatWrapping\r\n        }\r\n\r\n        if (wrapMap[wrap[0]] !== undefined) texture.wrapS = wrapMap[wrap[0]];\r\n        if (wrapMap[wrap[1]] !== undefined) texture.wrapT = wrapMap[wrap[1]];\r\n\r\n      }\r\n\r\n      if (anisotropy) {\r\n\r\n        texture.anisotropy = anisotropy;\r\n\r\n      }\r\n\r\n      where[name] = texture;\r\n\r\n    }\r\n\r\n    function rgb2hex(rgb) {\r\n\r\n      return (rgb[0] * 255 << 16) + (rgb[1] * 255 << 8) + rgb[2] * 255;\r\n\r\n    }\r\n\r\n    // defaults\r\n\r\n    var mtype = 'MeshLambertMaterial';\r\n    var mpars = {\r\n      color: 0xeeeeee,\r\n      opacity: 1.0,\r\n      map: null,\r\n      lightMap: null,\r\n      normalMap: null,\r\n      bumpMap: null,\r\n      wireframe: false\r\n    };\r\n\r\n    // parameters from model file\r\n\r\n    if (m.shading) {\r\n\r\n      var shading = m.shading.toLowerCase();\r\n\r\n      if (shading === 'phong') mtype = 'MeshPhongMaterial';\r\n      else if (shading === 'basic') mtype = 'MeshBasicMaterial';\r\n\r\n    }\r\n\r\n    if (m.blending !== undefined && THREE[m.blending] !== undefined) {\r\n\r\n      mpars.blending = THREE[m.blending];\r\n\r\n    }\r\n\r\n    if (m.transparent !== undefined) {\r\n\r\n      mpars.transparent = m.transparent;\r\n\r\n    }\r\n\r\n    if (m.opacity !== undefined && m.opacity < 1.0) {\r\n\r\n      mpars.transparent = true;\r\n\r\n    }\r\n\r\n    if (m.depthTest !== undefined) {\r\n\r\n      mpars.depthTest = m.depthTest;\r\n\r\n    }\r\n\r\n    if (m.depthWrite !== undefined) {\r\n\r\n      mpars.depthWrite = m.depthWrite;\r\n\r\n    }\r\n\r\n    if (m.visible !== undefined) {\r\n\r\n      mpars.visible = m.visible;\r\n\r\n    }\r\n\r\n    if (m.flipSided !== undefined) {\r\n\r\n      mpars.side = THREE.BackSide;\r\n\r\n    }\r\n\r\n    if (m.doubleSided !== undefined) {\r\n\r\n      mpars.side = THREE.DoubleSide;\r\n\r\n    }\r\n\r\n    if (m.wireframe !== undefined) {\r\n\r\n      mpars.wireframe = m.wireframe;\r\n\r\n    }\r\n\r\n    if (m.vertexColors !== undefined) {\r\n\r\n      if (m.vertexColors === 'face') {\r\n\r\n        mpars.vertexColors = THREE.FaceColors;\r\n\r\n      }\r\n      else if (m.vertexColors) {\r\n\r\n        mpars.vertexColors = THREE.VertexColors;\r\n\r\n      }\r\n\r\n    }\r\n\r\n    // colors\r\n\r\n    if (m.colorDiffuse) {\r\n\r\n      mpars.color = rgb2hex(m.colorDiffuse);\r\n\r\n    }\r\n    else if (m.DbgColor) {\r\n\r\n      mpars.color = m.DbgColor;\r\n\r\n    }\r\n\r\n    if (m.colorSpecular) {\r\n\r\n      mpars.specular = rgb2hex(m.colorSpecular);\r\n\r\n    }\r\n\r\n    if (m.colorEmissive) {\r\n\r\n      mpars.emissive = rgb2hex(m.colorEmissive);\r\n\r\n    }\r\n\r\n    // modifiers\r\n\r\n    if (m.transparency !== undefined) {\r\n\r\n      console.warn('THREE.Loader: transparency has been renamed to opacity');\r\n      m.opacity = m.transparency;\r\n\r\n    }\r\n\r\n    if (m.opacity !== undefined) {\r\n\r\n      mpars.opacity = m.opacity;\r\n\r\n    }\r\n\r\n    if (m.specularCoef) {\r\n\r\n      mpars.shininess = m.specularCoef;\r\n\r\n    }\r\n\r\n    // textures\r\n\r\n    if (m.mapDiffuse && texturePath) {\r\n\r\n      create_texture(mpars, 'map', m.mapDiffuse, m.mapDiffuseRepeat, m.mapDiffuseOffset, m.mapDiffuseWrap, m.mapDiffuseAnisotropy);\r\n\r\n    }\r\n\r\n    if (m.mapLight && texturePath) {\r\n\r\n      create_texture(mpars, 'lightMap', m.mapLight, m.mapLightRepeat, m.mapLightOffset, m.mapLightWrap, m.mapLightAnisotropy);\r\n\r\n    }\r\n\r\n    if (m.mapBump && texturePath) {\r\n\r\n      create_texture(mpars, 'bumpMap', m.mapBump, m.mapBumpRepeat, m.mapBumpOffset, m.mapBumpWrap, m.mapBumpAnisotropy);\r\n\r\n    }\r\n\r\n    if (m.mapNormal && texturePath) {\r\n\r\n      create_texture(mpars, 'normalMap', m.mapNormal, m.mapNormalRepeat, m.mapNormalOffset, m.mapNormalWrap, m.mapNormalAnisotropy);\r\n\r\n    }\r\n\r\n    if (m.mapSpecular && texturePath) {\r\n\r\n      create_texture(mpars, 'specularMap', m.mapSpecular, m.mapSpecularRepeat, m.mapSpecularOffset, m.mapSpecularWrap, m.mapSpecularAnisotropy);\r\n\r\n    }\r\n\r\n    if (m.mapAlpha && texturePath) {\r\n\r\n      create_texture(mpars, 'alphaMap', m.mapAlpha, m.mapAlphaRepeat, m.mapAlphaOffset, m.mapAlphaWrap, m.mapAlphaAnisotropy);\r\n\r\n    }\r\n\r\n    //\r\n\r\n    if (m.mapBumpScale) {\r\n\r\n      mpars.bumpScale = m.mapBumpScale;\r\n\r\n    }\r\n\r\n    if (m.mapNormalFactor) {\r\n\r\n      mpars.normalScale = new THREE.Vector2(m.mapNormalFactor, m.mapNormalFactor);\r\n\r\n    }\r\n\r\n    var material = new THREE[mtype](mpars);\r\n\r\n    if (m.DbgName !== undefined) material.name = m.DbgName;\r\n\r\n    return material;\r\n\r\n  }\r\n\r\n};\r\n\r\nTHREE.Loader.Handlers = {\r\n\r\n  handlers: [],\r\n\r\n  add: function(regex, loader) {\r\n\r\n    this.handlers.push(regex, loader);\r\n\r\n  },\r\n\r\n  get: function(file) {\r\n\r\n    for (var i = 0, l = this.handlers.length; i < l; i += 2) {\r\n\r\n      var regex = this.handlers[i];\r\n      var loader = this.handlers[i + 1];\r\n\r\n      if (regex.test(file)) {\r\n\r\n        return loader;\r\n\r\n      }\r\n\r\n    }\r\n\r\n    return null;\r\n\r\n  }\r\n\r\n};\r\n\r\n// File:src/loaders/XHRLoader.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.XHRLoader = function(manager) {\r\n\r\n  this.manager = (manager !== undefined) ? manager : THREE.DefaultLoadingManager;\r\n\r\n};\r\n\r\nTHREE.XHRLoader.prototype = {\r\n\r\n  constructor: THREE.XHRLoader,\r\n\r\n  load: function(url, onLoad, onProgress, onError) {\r\n\r\n    var scope = this;\r\n\r\n    var cached = THREE.Cache.get(url);\r\n\r\n    if (cached !== undefined) {\r\n\r\n      if (onLoad) onLoad(cached);\r\n      return;\r\n\r\n    }\r\n\r\n    var request = new XMLHttpRequest();\r\n    request.open('GET', url, true);\r\n\r\n    request.addEventListener('load', function(event) {\r\n\r\n      THREE.Cache.add(url, this.response);\r\n\r\n      if (onLoad) onLoad(this.response);\r\n\r\n      scope.manager.itemEnd(url);\r\n\r\n    }, false);\r\n\r\n    if (onProgress !== undefined) {\r\n\r\n      request.addEventListener('progress', function(event) {\r\n\r\n        onProgress(event);\r\n\r\n      }, false);\r\n\r\n    }\r\n\r\n    if (onError !== undefined) {\r\n\r\n      request.addEventListener('error', function(event) {\r\n\r\n        onError(event);\r\n\r\n      }, false);\r\n\r\n    }\r\n\r\n    if (this.crossOrigin !== undefined) request.crossOrigin = this.crossOrigin;\r\n    if (this.responseType !== undefined) request.responseType = this.responseType;\r\n\r\n    request.send(null);\r\n\r\n    scope.manager.itemStart(url);\r\n\r\n  },\r\n\r\n  setResponseType: function(value) {\r\n\r\n    this.responseType = value;\r\n\r\n  },\r\n\r\n  setCrossOrigin: function(value) {\r\n\r\n    this.crossOrigin = value;\r\n\r\n  }\r\n\r\n};\r\n\r\n// File:src/loaders/ImageLoader.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.ImageLoader = function(manager) {\r\n\r\n  this.manager = (manager !== undefined) ? manager : THREE.DefaultLoadingManager;\r\n\r\n};\r\n\r\nTHREE.ImageLoader.prototype = {\r\n\r\n  constructor: THREE.ImageLoader,\r\n\r\n  load: function(url, onLoad, onProgress, onError) {\r\n\r\n    var scope = this;\r\n\r\n    var cached = THREE.Cache.get(url);\r\n\r\n    if (cached !== undefined) {\r\n\r\n      onLoad(cached);\r\n      return;\r\n\r\n    }\r\n\r\n    var image = document.createElement('img');\r\n\r\n    image.addEventListener('load', function(event) {\r\n\r\n      THREE.Cache.add(url, this);\r\n\r\n      if (onLoad) onLoad(this);\r\n\r\n      scope.manager.itemEnd(url);\r\n\r\n    }, false);\r\n\r\n    if (onProgress !== undefined) {\r\n\r\n      image.addEventListener('progress', function(event) {\r\n\r\n        onProgress(event);\r\n\r\n      }, false);\r\n\r\n    }\r\n\r\n    if (onError !== undefined) {\r\n\r\n      image.addEventListener('error', function(event) {\r\n\r\n        onError(event);\r\n\r\n      }, false);\r\n\r\n    }\r\n\r\n    if (this.crossOrigin !== undefined) image.crossOrigin = this.crossOrigin;\r\n\r\n    image.src = url;\r\n\r\n    scope.manager.itemStart(url);\r\n\r\n    return image;\r\n\r\n  },\r\n\r\n  setCrossOrigin: function(value) {\r\n\r\n    this.crossOrigin = value;\r\n\r\n  }\r\n\r\n}\r\n\r\n// File:src/loaders/JSONLoader.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author alteredq / http://alteredqualia.com/\r\n */\r\n\r\nTHREE.JSONLoader = function(showStatus) {\r\n\r\n  THREE.Loader.call(this, showStatus);\r\n\r\n  this.withCredentials = false;\r\n\r\n};\r\n\r\nTHREE.JSONLoader.prototype = Object.create(THREE.Loader.prototype);\r\nTHREE.JSONLoader.prototype.constructor = THREE.JSONLoader;\r\n\r\nTHREE.JSONLoader.prototype.load = function(url, callback, texturePath) {\r\n\r\n  // todo: unify load API to for easier SceneLoader use\r\n\r\n  texturePath = texturePath && (typeof texturePath === 'string') ? texturePath : this.extractUrlBase(url);\r\n\r\n  this.onLoadStart();\r\n  this.loadAjaxJSON(this, url, callback, texturePath);\r\n\r\n};\r\n\r\nTHREE.JSONLoader.prototype.loadAjaxJSON = function(context, url, callback, texturePath, callbackProgress) {\r\n\r\n  var xhr = new XMLHttpRequest();\r\n\r\n  var length = 0;\r\n\r\n  xhr.onreadystatechange = function() {\r\n\r\n    if (xhr.readyState === xhr.DONE) {\r\n\r\n      if (xhr.status === 200 || xhr.status === 0) {\r\n\r\n        if (xhr.responseText) {\r\n\r\n          var json = JSON.parse(xhr.responseText);\r\n          var metadata = json.metadata;\r\n\r\n          if (metadata !== undefined) {\r\n\r\n            if (metadata.type === 'object') {\r\n\r\n              THREE.error('THREE.JSONLoader: ' + url + ' should be loaded with THREE.ObjectLoader instead.');\r\n              return;\r\n\r\n            }\r\n\r\n            if (metadata.type === 'scene') {\r\n\r\n              THREE.error('THREE.JSONLoader: ' + url + ' seems to be a Scene. Use THREE.SceneLoader instead.');\r\n              return;\r\n\r\n            }\r\n\r\n          }\r\n\r\n          var result = context.parse(json, texturePath);\r\n          callback(result.geometry, result.materials);\r\n\r\n        }\r\n        else {\r\n\r\n          THREE.error('THREE.JSONLoader: ' + url + ' seems to be unreachable or the file is empty.');\r\n\r\n        }\r\n\r\n        // in context of more complex asset initialization\r\n        // do not block on single failed file\r\n        // maybe should go even one more level up\r\n\r\n        context.onLoadComplete();\r\n\r\n      }\r\n      else {\r\n\r\n        THREE.error('THREE.JSONLoader: Couldn\\'t load ' + url + ' (' + xhr.status + ')');\r\n\r\n      }\r\n\r\n    }\r\n    else if (xhr.readyState === xhr.LOADING) {\r\n\r\n      if (callbackProgress) {\r\n\r\n        if (length === 0) {\r\n\r\n          length = xhr.getResponseHeader('Content-Length');\r\n\r\n        }\r\n\r\n        callbackProgress({\r\n          total: length,\r\n          loaded: xhr.responseText.length\r\n        });\r\n\r\n      }\r\n\r\n    }\r\n    else if (xhr.readyState === xhr.HEADERS_RECEIVED) {\r\n\r\n      if (callbackProgress !== undefined) {\r\n\r\n        length = xhr.getResponseHeader('Content-Length');\r\n\r\n      }\r\n\r\n    }\r\n\r\n  };\r\n\r\n  xhr.open('GET', url, true);\r\n  xhr.withCredentials = this.withCredentials;\r\n  xhr.send(null);\r\n\r\n};\r\n\r\nTHREE.JSONLoader.prototype.parse = function(json, texturePath) {\r\n\r\n  var geometry = new THREE.Geometry(),\r\n    scale = (json.scale !== undefined) ? 1.0 / json.scale : 1.0;\r\n\r\n  parseModel(scale);\r\n\r\n  parseSkin();\r\n  parseMorphing(scale);\r\n\r\n  geometry.computeFaceNormals();\r\n  geometry.computeBoundingSphere();\r\n\r\n  function parseModel(scale) {\r\n\r\n    function isBitSet(value, position) {\r\n\r\n      return value & (1 << position);\r\n\r\n    }\r\n\r\n    var i, j, fi,\r\n\r\n      offset, zLength,\r\n\r\n      colorIndex, normalIndex, uvIndex, materialIndex,\r\n\r\n      type,\r\n      isQuad,\r\n      hasMaterial,\r\n      hasFaceVertexUv,\r\n      hasFaceNormal, hasFaceVertexNormal,\r\n      hasFaceColor, hasFaceVertexColor,\r\n\r\n      vertex, face, faceA, faceB, hex, normal,\r\n\r\n      uvLayer, uv, u, v,\r\n\r\n      faces = json.faces,\r\n      vertices = json.vertices,\r\n      normals = json.normals,\r\n      colors = json.colors,\r\n\r\n      nUvLayers = 0;\r\n\r\n    if (json.uvs !== undefined) {\r\n\r\n      // disregard empty arrays\r\n\r\n      for (i = 0; i < json.uvs.length; i++) {\r\n\r\n        if (json.uvs[i].length) nUvLayers++;\r\n\r\n      }\r\n\r\n      for (i = 0; i < nUvLayers; i++) {\r\n\r\n        geometry.faceVertexUvs[i] = [];\r\n\r\n      }\r\n\r\n    }\r\n\r\n    offset = 0;\r\n    zLength = vertices.length;\r\n\r\n    while (offset < zLength) {\r\n\r\n      vertex = new THREE.Vector3();\r\n\r\n      vertex.x = vertices[offset++] * scale;\r\n      vertex.y = vertices[offset++] * scale;\r\n      vertex.z = vertices[offset++] * scale;\r\n\r\n      geometry.vertices.push(vertex);\r\n\r\n    }\r\n\r\n    offset = 0;\r\n    zLength = faces.length;\r\n\r\n    while (offset < zLength) {\r\n\r\n      type = faces[offset++];\r\n\r\n\r\n      isQuad = isBitSet(type, 0);\r\n      hasMaterial = isBitSet(type, 1);\r\n      hasFaceVertexUv = isBitSet(type, 3);\r\n      hasFaceNormal = isBitSet(type, 4);\r\n      hasFaceVertexNormal = isBitSet(type, 5);\r\n      hasFaceColor = isBitSet(type, 6);\r\n      hasFaceVertexColor = isBitSet(type, 7);\r\n\r\n      // console.log(\"type\", type, \"bits\", isQuad, hasMaterial, hasFaceVertexUv, hasFaceNormal, hasFaceVertexNormal, hasFaceColor, hasFaceVertexColor);\r\n\r\n      if (isQuad) {\r\n\r\n        faceA = new THREE.Face3();\r\n        faceA.a = faces[offset];\r\n        faceA.b = faces[offset + 1];\r\n        faceA.c = faces[offset + 3];\r\n\r\n        faceB = new THREE.Face3();\r\n        faceB.a = faces[offset + 1];\r\n        faceB.b = faces[offset + 2];\r\n        faceB.c = faces[offset + 3];\r\n\r\n        offset += 4;\r\n\r\n        if (hasMaterial) {\r\n\r\n          materialIndex = faces[offset++];\r\n          faceA.materialIndex = materialIndex;\r\n          faceB.materialIndex = materialIndex;\r\n\r\n        }\r\n\r\n        // to get face <=> uv index correspondence\r\n\r\n        fi = geometry.faces.length;\r\n\r\n        if (hasFaceVertexUv) {\r\n\r\n          for (i = 0; i < nUvLayers; i++) {\r\n\r\n            uvLayer = json.uvs[i];\r\n\r\n            geometry.faceVertexUvs[i][fi] = [];\r\n            geometry.faceVertexUvs[i][fi + 1] = []\r\n\r\n            for (j = 0; j < 4; j++) {\r\n\r\n              uvIndex = faces[offset++];\r\n\r\n              u = uvLayer[uvIndex * 2];\r\n              v = uvLayer[uvIndex * 2 + 1];\r\n\r\n              uv = new THREE.Vector2(u, v);\r\n\r\n              if (j !== 2) geometry.faceVertexUvs[i][fi].push(uv);\r\n              if (j !== 0) geometry.faceVertexUvs[i][fi + 1].push(uv);\r\n\r\n            }\r\n\r\n          }\r\n\r\n        }\r\n\r\n        if (hasFaceNormal) {\r\n\r\n          normalIndex = faces[offset++] * 3;\r\n\r\n          faceA.normal.set(\r\n            normals[normalIndex++],\r\n            normals[normalIndex++],\r\n            normals[normalIndex]\r\n          );\r\n\r\n          faceB.normal.copy(faceA.normal);\r\n\r\n        }\r\n\r\n        if (hasFaceVertexNormal) {\r\n\r\n          for (i = 0; i < 4; i++) {\r\n\r\n            normalIndex = faces[offset++] * 3;\r\n\r\n            normal = new THREE.Vector3(\r\n              normals[normalIndex++],\r\n              normals[normalIndex++],\r\n              normals[normalIndex]\r\n            );\r\n\r\n\r\n            if (i !== 2) faceA.vertexNormals.push(normal);\r\n            if (i !== 0) faceB.vertexNormals.push(normal);\r\n\r\n          }\r\n\r\n        }\r\n\r\n\r\n        if (hasFaceColor) {\r\n\r\n          colorIndex = faces[offset++];\r\n          hex = colors[colorIndex];\r\n\r\n          faceA.color.setHex(hex);\r\n          faceB.color.setHex(hex);\r\n\r\n        }\r\n\r\n\r\n        if (hasFaceVertexColor) {\r\n\r\n          for (i = 0; i < 4; i++) {\r\n\r\n            colorIndex = faces[offset++];\r\n            hex = colors[colorIndex];\r\n\r\n            if (i !== 2) faceA.vertexColors.push(new THREE.Color(hex));\r\n            if (i !== 0) faceB.vertexColors.push(new THREE.Color(hex));\r\n\r\n          }\r\n\r\n        }\r\n\r\n        geometry.faces.push(faceA);\r\n        geometry.faces.push(faceB);\r\n\r\n      }\r\n      else {\r\n\r\n        face = new THREE.Face3();\r\n        face.a = faces[offset++];\r\n        face.b = faces[offset++];\r\n        face.c = faces[offset++];\r\n\r\n        if (hasMaterial) {\r\n\r\n          materialIndex = faces[offset++];\r\n          face.materialIndex = materialIndex;\r\n\r\n        }\r\n\r\n        // to get face <=> uv index correspondence\r\n\r\n        fi = geometry.faces.length;\r\n\r\n        if (hasFaceVertexUv) {\r\n\r\n          for (i = 0; i < nUvLayers; i++) {\r\n\r\n            uvLayer = json.uvs[i];\r\n\r\n            geometry.faceVertexUvs[i][fi] = [];\r\n\r\n            for (j = 0; j < 3; j++) {\r\n\r\n              uvIndex = faces[offset++];\r\n\r\n              u = uvLayer[uvIndex * 2];\r\n              v = uvLayer[uvIndex * 2 + 1];\r\n\r\n              uv = new THREE.Vector2(u, v);\r\n\r\n              geometry.faceVertexUvs[i][fi].push(uv);\r\n\r\n            }\r\n\r\n          }\r\n\r\n        }\r\n\r\n        if (hasFaceNormal) {\r\n\r\n          normalIndex = faces[offset++] * 3;\r\n\r\n          face.normal.set(\r\n            normals[normalIndex++],\r\n            normals[normalIndex++],\r\n            normals[normalIndex]\r\n          );\r\n\r\n        }\r\n\r\n        if (hasFaceVertexNormal) {\r\n\r\n          for (i = 0; i < 3; i++) {\r\n\r\n            normalIndex = faces[offset++] * 3;\r\n\r\n            normal = new THREE.Vector3(\r\n              normals[normalIndex++],\r\n              normals[normalIndex++],\r\n              normals[normalIndex]\r\n            );\r\n\r\n            face.vertexNormals.push(normal);\r\n\r\n          }\r\n\r\n        }\r\n\r\n\r\n        if (hasFaceColor) {\r\n\r\n          colorIndex = faces[offset++];\r\n          face.color.setHex(colors[colorIndex]);\r\n\r\n        }\r\n\r\n\r\n        if (hasFaceVertexColor) {\r\n\r\n          for (i = 0; i < 3; i++) {\r\n\r\n            colorIndex = faces[offset++];\r\n            face.vertexColors.push(new THREE.Color(colors[colorIndex]));\r\n\r\n          }\r\n\r\n        }\r\n\r\n        geometry.faces.push(face);\r\n\r\n      }\r\n\r\n    }\r\n\r\n  };\r\n\r\n  function parseSkin() {\r\n    var influencesPerVertex = (json.influencesPerVertex !== undefined) ? json.influencesPerVertex : 2;\r\n\r\n    if (json.skinWeights) {\r\n\r\n      for (var i = 0, l = json.skinWeights.length; i < l; i += influencesPerVertex) {\r\n\r\n        var x = json.skinWeights[i];\r\n        var y = (influencesPerVertex > 1) ? json.skinWeights[i + 1] : 0;\r\n        var z = (influencesPerVertex > 2) ? json.skinWeights[i + 2] : 0;\r\n        var w = (influencesPerVertex > 3) ? json.skinWeights[i + 3] : 0;\r\n\r\n        geometry.skinWeights.push(new THREE.Vector4(x, y, z, w));\r\n\r\n      }\r\n\r\n    }\r\n\r\n    if (json.skinIndices) {\r\n\r\n      for (var i = 0, l = json.skinIndices.length; i < l; i += influencesPerVertex) {\r\n\r\n        var a = json.skinIndices[i];\r\n        var b = (influencesPerVertex > 1) ? json.skinIndices[i + 1] : 0;\r\n        var c = (influencesPerVertex > 2) ? json.skinIndices[i + 2] : 0;\r\n        var d = (influencesPerVertex > 3) ? json.skinIndices[i + 3] : 0;\r\n\r\n        geometry.skinIndices.push(new THREE.Vector4(a, b, c, d));\r\n\r\n      }\r\n\r\n    }\r\n\r\n    geometry.bones = json.bones;\r\n\r\n    if (geometry.bones && geometry.bones.length > 0 && (geometry.skinWeights.length !== geometry.skinIndices.length || geometry.skinIndices.length !== geometry.vertices.length)) {\r\n\r\n      THREE.warn('THREE.JSONLoader: When skinning, number of vertices (' + geometry.vertices.length + '), skinIndices (' +\r\n        geometry.skinIndices.length + '), and skinWeights (' + geometry.skinWeights.length + ') should match.');\r\n\r\n    }\r\n\r\n\r\n    // could change this to json.animations[0] or remove completely\r\n\r\n    geometry.animation = json.animation;\r\n    geometry.animations = json.animations;\r\n\r\n  };\r\n\r\n  function parseMorphing(scale) {\r\n\r\n    if (json.morphTargets !== undefined) {\r\n\r\n      var i, l, v, vl, dstVertices, srcVertices;\r\n\r\n      for (i = 0, l = json.morphTargets.length; i < l; i++) {\r\n\r\n        geometry.morphTargets[i] = {};\r\n        geometry.morphTargets[i].name = json.morphTargets[i].name;\r\n        geometry.morphTargets[i].vertices = [];\r\n\r\n        dstVertices = geometry.morphTargets[i].vertices;\r\n        srcVertices = json.morphTargets[i].vertices;\r\n\r\n        for (v = 0, vl = srcVertices.length; v < vl; v += 3) {\r\n\r\n          var vertex = new THREE.Vector3();\r\n          vertex.x = srcVertices[v] * scale;\r\n          vertex.y = srcVertices[v + 1] * scale;\r\n          vertex.z = srcVertices[v + 2] * scale;\r\n\r\n          dstVertices.push(vertex);\r\n\r\n        }\r\n\r\n      }\r\n\r\n    }\r\n\r\n    if (json.morphColors !== undefined) {\r\n\r\n      var i, l, c, cl, dstColors, srcColors, color;\r\n\r\n      for (i = 0, l = json.morphColors.length; i < l; i++) {\r\n\r\n        geometry.morphColors[i] = {};\r\n        geometry.morphColors[i].name = json.morphColors[i].name;\r\n        geometry.morphColors[i].colors = [];\r\n\r\n        dstColors = geometry.morphColors[i].colors;\r\n        srcColors = json.morphColors[i].colors;\r\n\r\n        for (c = 0, cl = srcColors.length; c < cl; c += 3) {\r\n\r\n          color = new THREE.Color(0xffaa00);\r\n          color.setRGB(srcColors[c], srcColors[c + 1], srcColors[c + 2]);\r\n          dstColors.push(color);\r\n\r\n        }\r\n\r\n      }\r\n\r\n    }\r\n\r\n  };\r\n\r\n  if (json.materials === undefined || json.materials.length === 0) {\r\n\r\n    return {\r\n      geometry: geometry\r\n    };\r\n\r\n  }\r\n  else {\r\n\r\n    var materials = this.initMaterials(json.materials, texturePath);\r\n\r\n    if (this.needsTangents(materials)) {\r\n\r\n      geometry.computeTangents();\r\n\r\n    }\r\n\r\n    return {\r\n      geometry: geometry,\r\n      materials: materials\r\n    };\r\n\r\n  }\r\n\r\n};\r\n\r\n// File:src/loaders/LoadingManager.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.LoadingManager = function(onLoad, onProgress, onError) {\r\n\r\n  var scope = this;\r\n\r\n  var loaded = 0,\r\n    total = 0;\r\n\r\n  this.onLoad = onLoad;\r\n  this.onProgress = onProgress;\r\n  this.onError = onError;\r\n\r\n  this.itemStart = function(url) {\r\n\r\n    total++;\r\n\r\n  };\r\n\r\n  this.itemEnd = function(url) {\r\n\r\n    loaded++;\r\n\r\n    if (scope.onProgress !== undefined) {\r\n\r\n      scope.onProgress(url, loaded, total);\r\n\r\n    }\r\n\r\n    if (loaded === total && scope.onLoad !== undefined) {\r\n\r\n      scope.onLoad();\r\n\r\n    }\r\n\r\n  };\r\n\r\n};\r\n\r\nTHREE.DefaultLoadingManager = new THREE.LoadingManager();\r\n\r\n// File:src/loaders/BufferGeometryLoader.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.BufferGeometryLoader = function(manager) {\r\n\r\n  this.manager = (manager !== undefined) ? manager : THREE.DefaultLoadingManager;\r\n\r\n};\r\n\r\nTHREE.BufferGeometryLoader.prototype = {\r\n\r\n  constructor: THREE.BufferGeometryLoader,\r\n\r\n  load: function(url, onLoad, onProgress, onError) {\r\n\r\n    var scope = this;\r\n\r\n    var loader = new THREE.XHRLoader(scope.manager);\r\n    loader.setCrossOrigin(this.crossOrigin);\r\n    loader.load(url, function(text) {\r\n\r\n      onLoad(scope.parse(JSON.parse(text)));\r\n\r\n    }, onProgress, onError);\r\n\r\n  },\r\n\r\n  setCrossOrigin: function(value) {\r\n\r\n    this.crossOrigin = value;\r\n\r\n  },\r\n\r\n  parse: function(json) {\r\n\r\n    var geometry = new THREE.BufferGeometry();\r\n\r\n    var attributes = json.data.attributes;\r\n\r\n    for (var key in attributes) {\r\n\r\n      var attribute = attributes[key];\r\n      var typedArray = new self[attribute.type](attribute.array);\r\n\r\n      geometry.addAttribute(key, new THREE.BufferAttribute(typedArray, attribute.itemSize));\r\n\r\n    }\r\n\r\n    var offsets = json.data.offsets;\r\n\r\n    if (offsets !== undefined) {\r\n\r\n      geometry.offsets = JSON.parse(JSON.stringify(offsets));\r\n\r\n    }\r\n\r\n    var boundingSphere = json.data.boundingSphere;\r\n\r\n    if (boundingSphere !== undefined) {\r\n\r\n      var center = new THREE.Vector3();\r\n\r\n      if (boundingSphere.center !== undefined) {\r\n\r\n        center.fromArray(boundingSphere.center);\r\n\r\n      }\r\n\r\n      geometry.boundingSphere = new THREE.Sphere(center, boundingSphere.radius);\r\n\r\n    }\r\n\r\n    return geometry;\r\n\r\n  }\r\n\r\n};\r\n\r\n// File:src/loaders/MaterialLoader.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.MaterialLoader = function(manager) {\r\n\r\n  this.manager = (manager !== undefined) ? manager : THREE.DefaultLoadingManager;\r\n\r\n};\r\n\r\nTHREE.MaterialLoader.prototype = {\r\n\r\n  constructor: THREE.MaterialLoader,\r\n\r\n  load: function(url, onLoad, onProgress, onError) {\r\n\r\n    var scope = this;\r\n\r\n    var loader = new THREE.XHRLoader(scope.manager);\r\n    loader.setCrossOrigin(this.crossOrigin);\r\n    loader.load(url, function(text) {\r\n\r\n      onLoad(scope.parse(JSON.parse(text)));\r\n\r\n    }, onProgress, onError);\r\n\r\n  },\r\n\r\n  setCrossOrigin: function(value) {\r\n\r\n    this.crossOrigin = value;\r\n\r\n  },\r\n\r\n  parse: function(json) {\r\n\r\n    var material = new THREE[json.type];\r\n\r\n    if (json.color !== undefined) material.color.setHex(json.color);\r\n    if (json.emissive !== undefined) material.emissive.setHex(json.emissive);\r\n    if (json.specular !== undefined) material.specular.setHex(json.specular);\r\n    if (json.shininess !== undefined) material.shininess = json.shininess;\r\n    if (json.uniforms !== undefined) material.uniforms = json.uniforms;\r\n    if (json.vertexShader !== undefined) material.vertexShader = json.vertexShader;\r\n    if (json.fragmentShader !== undefined) material.fragmentShader = json.fragmentShader;\r\n    if (json.vertexColors !== undefined) material.vertexColors = json.vertexColors;\r\n    if (json.shading !== undefined) material.shading = json.shading;\r\n    if (json.blending !== undefined) material.blending = json.blending;\r\n    if (json.side !== undefined) material.side = json.side;\r\n    if (json.opacity !== undefined) material.opacity = json.opacity;\r\n    if (json.transparent !== undefined) material.transparent = json.transparent;\r\n    if (json.wireframe !== undefined) material.wireframe = json.wireframe;\r\n\r\n    // for PointCloudMaterial\r\n    if (json.size !== undefined) material.size = json.size;\r\n    if (json.sizeAttenuation !== undefined) material.sizeAttenuation = json.sizeAttenuation;\r\n\r\n    if (json.materials !== undefined) {\r\n\r\n      for (var i = 0, l = json.materials.length; i < l; i++) {\r\n\r\n        material.materials.push(this.parse(json.materials[i]));\r\n\r\n      }\r\n\r\n    }\r\n\r\n    return material;\r\n\r\n  }\r\n\r\n};\r\n\r\n// File:src/loaders/ObjectLoader.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.ObjectLoader = function(manager) {\r\n\r\n  this.manager = (manager !== undefined) ? manager : THREE.DefaultLoadingManager;\r\n  this.texturePath = '';\r\n\r\n};\r\n\r\nTHREE.ObjectLoader.prototype = {\r\n\r\n  constructor: THREE.ObjectLoader,\r\n\r\n  load: function(url, onLoad, onProgress, onError) {\r\n\r\n    if (this.texturePath === '') {\r\n\r\n      this.texturePath = url.substring(0, url.lastIndexOf('/') + 1);\r\n\r\n    }\r\n\r\n    var scope = this;\r\n\r\n    var loader = new THREE.XHRLoader(scope.manager);\r\n    loader.setCrossOrigin(this.crossOrigin);\r\n    loader.load(url, function(text) {\r\n\r\n      scope.parse(JSON.parse(text), onLoad);\r\n\r\n    }, onProgress, onError);\r\n\r\n  },\r\n\r\n  setTexturePath: function(value) {\r\n\r\n    this.texturePath = value;\r\n\r\n  },\r\n\r\n  setCrossOrigin: function(value) {\r\n\r\n    this.crossOrigin = value;\r\n\r\n  },\r\n\r\n  parse: function(json, onLoad) {\r\n\r\n    var geometries = this.parseGeometries(json.geometries);\r\n\r\n    var images = this.parseImages(json.images, function() {\r\n\r\n      if (onLoad !== undefined) onLoad(object);\r\n\r\n    });\r\n    var textures = this.parseTextures(json.textures, images);\r\n    var materials = this.parseMaterials(json.materials, textures);\r\n    var object = this.parseObject(json.object, geometries, materials);\r\n\r\n    if (json.images === undefined || json.images.length === 0) {\r\n\r\n      if (onLoad !== undefined) onLoad(object);\r\n\r\n    }\r\n\r\n    return object;\r\n\r\n  },\r\n\r\n  parseGeometries: function(json) {\r\n\r\n    var geometries = {};\r\n\r\n    if (json !== undefined) {\r\n\r\n      var geometryLoader = new THREE.JSONLoader();\r\n      var bufferGeometryLoader = new THREE.BufferGeometryLoader();\r\n\r\n      for (var i = 0, l = json.length; i < l; i++) {\r\n\r\n        var geometry;\r\n        var data = json[i];\r\n\r\n        switch (data.type) {\r\n\r\n          case 'PlaneGeometry':\r\n          case 'PlaneBufferGeometry':\r\n\r\n            geometry = new THREE[data.type](\r\n              data.width,\r\n              data.height,\r\n              data.widthSegments,\r\n              data.heightSegments\r\n            );\r\n\r\n            break;\r\n\r\n          case 'BoxGeometry':\r\n          case 'CubeGeometry': // backwards compatible\r\n\r\n            geometry = new THREE.BoxGeometry(\r\n              data.width,\r\n              data.height,\r\n              data.depth,\r\n              data.widthSegments,\r\n              data.heightSegments,\r\n              data.depthSegments\r\n            );\r\n\r\n            break;\r\n\r\n          case 'CircleGeometry':\r\n\r\n            geometry = new THREE.CircleGeometry(\r\n              data.radius,\r\n              data.segments\r\n            );\r\n\r\n            break;\r\n\r\n          case 'CylinderGeometry':\r\n\r\n            geometry = new THREE.CylinderGeometry(\r\n              data.radiusTop,\r\n              data.radiusBottom,\r\n              data.height,\r\n              data.radialSegments,\r\n              data.heightSegments,\r\n              data.openEnded\r\n            );\r\n\r\n            break;\r\n\r\n          case 'SphereGeometry':\r\n\r\n            geometry = new THREE.SphereGeometry(\r\n              data.radius,\r\n              data.widthSegments,\r\n              data.heightSegments,\r\n              data.phiStart,\r\n              data.phiLength,\r\n              data.thetaStart,\r\n              data.thetaLength\r\n            );\r\n\r\n            break;\r\n\r\n          case 'IcosahedronGeometry':\r\n\r\n            geometry = new THREE.IcosahedronGeometry(\r\n              data.radius,\r\n              data.detail\r\n            );\r\n\r\n            break;\r\n\r\n          case 'TorusGeometry':\r\n\r\n            geometry = new THREE.TorusGeometry(\r\n              data.radius,\r\n              data.tube,\r\n              data.radialSegments,\r\n              data.tubularSegments,\r\n              data.arc\r\n            );\r\n\r\n            break;\r\n\r\n          case 'TorusKnotGeometry':\r\n\r\n            geometry = new THREE.TorusKnotGeometry(\r\n              data.radius,\r\n              data.tube,\r\n              data.radialSegments,\r\n              data.tubularSegments,\r\n              data.p,\r\n              data.q,\r\n              data.heightScale\r\n            );\r\n\r\n            break;\r\n\r\n          case 'BufferGeometry':\r\n\r\n            geometry = bufferGeometryLoader.parse(data);\r\n\r\n            break;\r\n\r\n          case 'Geometry':\r\n\r\n            geometry = geometryLoader.parse(data.data).geometry;\r\n\r\n            break;\r\n\r\n        }\r\n\r\n        geometry.uuid = data.uuid;\r\n\r\n        if (data.name !== undefined) geometry.name = data.name;\r\n\r\n        geometries[data.uuid] = geometry;\r\n\r\n      }\r\n\r\n    }\r\n\r\n    return geometries;\r\n\r\n  },\r\n\r\n  parseMaterials: function(json, textures) {\r\n\r\n    var materials = {};\r\n\r\n    if (json !== undefined) {\r\n\r\n      var getTexture = function(name) {\r\n\r\n        if (textures[name] === undefined) {\r\n\r\n          THREE.warn('THREE.ObjectLoader: Undefined texture', name);\r\n\r\n        }\r\n\r\n        return textures[name];\r\n\r\n      };\r\n\r\n      var loader = new THREE.MaterialLoader();\r\n\r\n      for (var i = 0, l = json.length; i < l; i++) {\r\n\r\n        var data = json[i];\r\n        var material = loader.parse(data);\r\n\r\n        material.uuid = data.uuid;\r\n\r\n        if (data.name !== undefined) material.name = data.name;\r\n\r\n        if (data.map !== undefined) {\r\n\r\n          material.map = getTexture(data.map);\r\n\r\n        }\r\n\r\n        if (data.bumpMap !== undefined) {\r\n\r\n          material.bumpMap = getTexture(data.bumpMap);\r\n          if (data.bumpScale) {\r\n            material.bumpScale = new THREE.Vector2(data.bumpScale, data.bumpScale);\r\n          }\r\n\r\n        }\r\n\r\n        if (data.alphaMap !== undefined) {\r\n\r\n          material.alphaMap = getTexture(data.alphaMap);\r\n\r\n        }\r\n\r\n        if (data.envMap !== undefined) {\r\n\r\n          material.envMap = getTexture(data.envMap);\r\n\r\n        }\r\n\r\n        if (data.normalMap !== undefined) {\r\n\r\n          material.normalMap = getTexture(data.normalMap);\r\n          if (data.normalScale) {\r\n            material.normalScale = new THREE.Vector2(data.normalScale, data.normalScale);\r\n          }\r\n\r\n        }\r\n\r\n        if (data.lightMap !== undefined) {\r\n\r\n          material.lightMap = getTexture(data.lightMap);\r\n\r\n        }\r\n\r\n        if (data.specularMap !== undefined) {\r\n\r\n          material.specularMap = getTexture(data.specularMap);\r\n\r\n        }\r\n\r\n        materials[data.uuid] = material;\r\n\r\n      }\r\n\r\n    }\r\n\r\n    return materials;\r\n\r\n  },\r\n\r\n  parseImages: function(json, onLoad) {\r\n\r\n    var scope = this;\r\n    var images = {};\r\n\r\n    if (json !== undefined && json.length > 0) {\r\n\r\n      var manager = new THREE.LoadingManager(onLoad);\r\n\r\n      var loader = new THREE.ImageLoader(manager);\r\n      loader.setCrossOrigin(this.crossOrigin);\r\n\r\n      var loadImage = function(url) {\r\n\r\n        scope.manager.itemStart(url);\r\n\r\n        return loader.load(url, function() {\r\n\r\n          scope.manager.itemEnd(url);\r\n\r\n        });\r\n\r\n      };\r\n\r\n      for (var i = 0, l = json.length; i < l; i++) {\r\n\r\n        var image = json[i];\r\n        var path = /^(\\/\\/)|([a-z]+:(\\/\\/)?)/i.test(image.url) ? image.url : scope.texturePath + image.url;\r\n\r\n        images[image.uuid] = loadImage(path);\r\n\r\n      }\r\n\r\n    }\r\n\r\n    return images;\r\n\r\n  },\r\n\r\n  parseTextures: function(json, images) {\r\n\r\n    var textures = {};\r\n\r\n    if (json !== undefined) {\r\n\r\n      for (var i = 0, l = json.length; i < l; i++) {\r\n\r\n        var data = json[i];\r\n\r\n        if (data.image === undefined) {\r\n\r\n          THREE.warn('THREE.ObjectLoader: No \"image\" speficied for', data.uuid);\r\n\r\n        }\r\n\r\n        if (images[data.image] === undefined) {\r\n\r\n          THREE.warn('THREE.ObjectLoader: Undefined image', data.image);\r\n\r\n        }\r\n\r\n        var texture = new THREE.Texture(images[data.image]);\r\n        texture.needsUpdate = true;\r\n\r\n        texture.uuid = data.uuid;\r\n\r\n        if (data.name !== undefined) texture.name = data.name;\r\n        if (data.repeat !== undefined) texture.repeat = new THREE.Vector2(data.repeat[0], data.repeat[1]);\r\n        if (data.minFilter !== undefined) texture.minFilter = THREE[data.minFilter];\r\n        if (data.magFilter !== undefined) texture.magFilter = THREE[data.magFilter];\r\n        if (data.anisotropy !== undefined) texture.anisotropy = data.anisotropy;\r\n        if (data.wrap instanceof Array) {\r\n\r\n          texture.wrapS = THREE[data.wrap[0]];\r\n          texture.wrapT = THREE[data.wrap[1]];\r\n\r\n        }\r\n\r\n        textures[data.uuid] = texture;\r\n\r\n      }\r\n\r\n    }\r\n\r\n    return textures;\r\n\r\n  },\r\n\r\n  parseObject: function() {\r\n\r\n    var matrix = new THREE.Matrix4();\r\n\r\n    return function(data, geometries, materials) {\r\n\r\n      var object;\r\n\r\n      var getGeometry = function(name) {\r\n\r\n        if (geometries[name] === undefined) {\r\n\r\n          THREE.warn('THREE.ObjectLoader: Undefined geometry', name);\r\n\r\n        }\r\n\r\n        return geometries[name];\r\n\r\n      };\r\n\r\n      var getMaterial = function(name) {\r\n\r\n        if (materials[name] === undefined) {\r\n\r\n          THREE.warn('THREE.ObjectLoader: Undefined material', name);\r\n\r\n        }\r\n\r\n        return materials[name];\r\n\r\n      };\r\n\r\n      switch (data.type) {\r\n\r\n        case 'Scene':\r\n\r\n          object = new THREE.Scene();\r\n\r\n          break;\r\n\r\n        case 'PerspectiveCamera':\r\n\r\n          object = new THREE.PerspectiveCamera(data.fov, data.aspect, data.near, data.far);\r\n\r\n          break;\r\n\r\n        case 'OrthographicCamera':\r\n\r\n          object = new THREE.OrthographicCamera(data.left, data.right, data.top, data.bottom, data.near, data.far);\r\n\r\n          break;\r\n\r\n        case 'AmbientLight':\r\n\r\n          object = new THREE.AmbientLight(data.color);\r\n\r\n          break;\r\n\r\n        case 'DirectionalLight':\r\n\r\n          object = new THREE.DirectionalLight(data.color, data.intensity);\r\n\r\n          break;\r\n\r\n        case 'PointLight':\r\n\r\n          object = new THREE.PointLight(data.color, data.intensity, data.distance, data.decay);\r\n\r\n          break;\r\n\r\n        case 'SpotLight':\r\n\r\n          object = new THREE.SpotLight(data.color, data.intensity, data.distance, data.angle, data.exponent, data.decay);\r\n\r\n          break;\r\n\r\n        case 'HemisphereLight':\r\n\r\n          object = new THREE.HemisphereLight(data.color, data.groundColor, data.intensity);\r\n\r\n          break;\r\n\r\n        case 'Mesh':\r\n\r\n          object = new THREE.Mesh(getGeometry(data.geometry), getMaterial(data.material));\r\n\r\n          break;\r\n\r\n        case 'Line':\r\n\r\n          object = new THREE.Line(getGeometry(data.geometry), getMaterial(data.material), data.mode);\r\n\r\n          break;\r\n\r\n        case 'PointCloud':\r\n\r\n          object = new THREE.PointCloud(getGeometry(data.geometry), getMaterial(data.material));\r\n\r\n          break;\r\n\r\n        case 'Sprite':\r\n\r\n          object = new THREE.Sprite(getMaterial(data.material));\r\n\r\n          break;\r\n\r\n        case 'Group':\r\n\r\n          object = new THREE.Group();\r\n\r\n          break;\r\n\r\n        default:\r\n\r\n          object = new THREE.Object3D();\r\n\r\n      }\r\n\r\n      object.uuid = data.uuid;\r\n\r\n      if (data.name !== undefined) object.name = data.name;\r\n      if (data.matrix !== undefined) {\r\n\r\n        matrix.fromArray(data.matrix);\r\n        matrix.decompose(object.position, object.quaternion, object.scale);\r\n\r\n      }\r\n      else {\r\n\r\n        if (data.position !== undefined) object.position.fromArray(data.position);\r\n        if (data.rotation !== undefined) object.rotation.fromArray(data.rotation);\r\n        if (data.scale !== undefined) object.scale.fromArray(data.scale);\r\n\r\n      }\r\n\r\n      if (data.visible !== undefined) object.visible = data.visible;\r\n      if (data.userData !== undefined) object.userData = data.userData;\r\n\r\n      if (data.children !== undefined) {\r\n\r\n        for (var child in data.children) {\r\n\r\n          object.add(this.parseObject(data.children[child], geometries, materials));\r\n\r\n        }\r\n\r\n      }\r\n\r\n      return object;\r\n\r\n    }\r\n\r\n  }()\r\n\r\n};\r\n\r\n// File:src/loaders/TextureLoader.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.TextureLoader = function(manager) {\r\n\r\n  this.manager = (manager !== undefined) ? manager : THREE.DefaultLoadingManager;\r\n\r\n};\r\n\r\nTHREE.TextureLoader.prototype = {\r\n\r\n  constructor: THREE.TextureLoader,\r\n\r\n  load: function(url, onLoad, onProgress, onError) {\r\n\r\n    var scope = this;\r\n\r\n    var loader = new THREE.ImageLoader(scope.manager);\r\n    loader.setCrossOrigin(this.crossOrigin);\r\n    loader.load(url, function(image) {\r\n\r\n      var texture = new THREE.Texture(image);\r\n      texture.needsUpdate = true;\r\n\r\n      if (onLoad !== undefined) {\r\n\r\n        onLoad(texture);\r\n\r\n      }\r\n\r\n    }, onProgress, onError);\r\n\r\n  },\r\n\r\n  setCrossOrigin: function(value) {\r\n\r\n    this.crossOrigin = value;\r\n\r\n  }\r\n\r\n};\r\n\r\n// File:src/loaders/BinaryTextureLoader.js\r\n\r\n/**\r\n * @author Nikos M. / https://github.com/foo123/\r\n *\r\n * Abstract Base class to load generic binary textures formats (rgbe, hdr, ...)\r\n */\r\n\r\nTHREE.DataTextureLoader = THREE.BinaryTextureLoader = function() {\r\n\r\n  // override in sub classes\r\n  this._parser = null;\r\n\r\n};\r\n\r\nTHREE.BinaryTextureLoader.prototype = {\r\n\r\n  constructor: THREE.BinaryTextureLoader,\r\n\r\n  load: function(url, onLoad, onProgress, onError) {\r\n\r\n    var scope = this;\r\n\r\n    var texture = new THREE.DataTexture();\r\n\r\n    var loader = new THREE.XHRLoader();\r\n    loader.setResponseType('arraybuffer');\r\n\r\n    loader.load(url, function(buffer) {\r\n\r\n      var texData = scope._parser(buffer);\r\n\r\n      if (!texData) return;\r\n\r\n      if (undefined !== texData.image) {\r\n\r\n        texture.image = texData.image;\r\n\r\n      }\r\n      else if (undefined !== texData.data) {\r\n\r\n        texture.image.width = texData.width;\r\n        texture.image.height = texData.height;\r\n        texture.image.data = texData.data;\r\n\r\n      }\r\n\r\n      texture.wrapS = undefined !== texData.wrapS ? texData.wrapS : THREE.ClampToEdgeWrapping;\r\n      texture.wrapT = undefined !== texData.wrapT ? texData.wrapT : THREE.ClampToEdgeWrapping;\r\n\r\n      texture.magFilter = undefined !== texData.magFilter ? texData.magFilter : THREE.LinearFilter;\r\n      texture.minFilter = undefined !== texData.minFilter ? texData.minFilter : THREE.LinearMipMapLinearFilter;\r\n\r\n      texture.anisotropy = undefined !== texData.anisotropy ? texData.anisotropy : 1;\r\n\r\n      if (undefined !== texData.format) {\r\n\r\n        texture.format = texData.format;\r\n\r\n      }\r\n      if (undefined !== texData.type) {\r\n\r\n        texture.type = texData.type;\r\n\r\n      }\r\n\r\n      if (undefined !== texData.mipmaps) {\r\n\r\n        texture.mipmaps = texData.mipmaps;\r\n\r\n      }\r\n\r\n      if (1 === texData.mipmapCount) {\r\n\r\n        texture.minFilter = THREE.LinearFilter;\r\n\r\n      }\r\n\r\n      texture.needsUpdate = true;\r\n\r\n      if (onLoad) onLoad(texture, texData);\r\n\r\n    }, onProgress, onError);\r\n\r\n\r\n    return texture;\r\n\r\n  }\r\n\r\n};\r\n\r\n// File:src/loaders/CompressedTextureLoader.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n *\r\n * Abstract Base class to block based textures loader (dds, pvr, ...)\r\n */\r\n\r\nTHREE.CompressedTextureLoader = function() {\r\n\r\n  // override in sub classes\r\n  this._parser = null;\r\n\r\n};\r\n\r\n\r\nTHREE.CompressedTextureLoader.prototype = {\r\n\r\n  constructor: THREE.CompressedTextureLoader,\r\n\r\n  load: function(url, onLoad, onError) {\r\n\r\n    var scope = this;\r\n\r\n    var images = [];\r\n\r\n    var texture = new THREE.CompressedTexture();\r\n    texture.image = images;\r\n\r\n    var loader = new THREE.XHRLoader();\r\n    loader.setResponseType('arraybuffer');\r\n\r\n    if (url instanceof Array) {\r\n\r\n      var loaded = 0;\r\n\r\n      var loadTexture = function(i) {\r\n\r\n        loader.load(url[i], function(buffer) {\r\n\r\n          var texDatas = scope._parser(buffer, true);\r\n\r\n          images[i] = {\r\n            width: texDatas.width,\r\n            height: texDatas.height,\r\n            format: texDatas.format,\r\n            mipmaps: texDatas.mipmaps\r\n          };\r\n\r\n          loaded += 1;\r\n\r\n          if (loaded === 6) {\r\n\r\n            if (texDatas.mipmapCount == 1)\r\n              texture.minFilter = THREE.LinearFilter;\r\n\r\n            texture.format = texDatas.format;\r\n            texture.needsUpdate = true;\r\n\r\n            if (onLoad) onLoad(texture);\r\n\r\n          }\r\n\r\n        });\r\n\r\n      };\r\n\r\n      for (var i = 0, il = url.length; i < il; ++i) {\r\n\r\n        loadTexture(i);\r\n\r\n      }\r\n\r\n    }\r\n    else {\r\n\r\n      // compressed cubemap texture stored in a single DDS file\r\n\r\n      loader.load(url, function(buffer) {\r\n\r\n        var texDatas = scope._parser(buffer, true);\r\n\r\n        if (texDatas.isCubemap) {\r\n\r\n          var faces = texDatas.mipmaps.length / texDatas.mipmapCount;\r\n\r\n          for (var f = 0; f < faces; f++) {\r\n\r\n            images[f] = {\r\n              mipmaps: []\r\n            };\r\n\r\n            for (var i = 0; i < texDatas.mipmapCount; i++) {\r\n\r\n              images[f].mipmaps.push(texDatas.mipmaps[f * texDatas.mipmapCount + i]);\r\n              images[f].format = texDatas.format;\r\n              images[f].width = texDatas.width;\r\n              images[f].height = texDatas.height;\r\n\r\n            }\r\n\r\n          }\r\n\r\n        }\r\n        else {\r\n\r\n          texture.image.width = texDatas.width;\r\n          texture.image.height = texDatas.height;\r\n          texture.mipmaps = texDatas.mipmaps;\r\n\r\n        }\r\n\r\n        if (texDatas.mipmapCount === 1) {\r\n\r\n          texture.minFilter = THREE.LinearFilter;\r\n\r\n        }\r\n\r\n        texture.format = texDatas.format;\r\n        texture.needsUpdate = true;\r\n\r\n        if (onLoad) onLoad(texture);\r\n\r\n      });\r\n\r\n    }\r\n\r\n    return texture;\r\n\r\n  }\r\n\r\n};\r\n\r\n// File:src/materials/Material.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author alteredq / http://alteredqualia.com/\r\n */\r\n\r\nTHREE.Material = function() {\r\n\r\n  Object.defineProperty(this, 'id', {\r\n    value: THREE.MaterialIdCount++\r\n  });\r\n\r\n  this.uuid = THREE.Math.generateUUID();\r\n\r\n  this.name = '';\r\n  this.type = 'Material';\r\n\r\n  this.side = THREE.FrontSide;\r\n\r\n  this.opacity = 1;\r\n  this.transparent = false;\r\n\r\n  this.blending = THREE.NormalBlending;\r\n\r\n  this.blendSrc = THREE.SrcAlphaFactor;\r\n  this.blendDst = THREE.OneMinusSrcAlphaFactor;\r\n  this.blendEquation = THREE.AddEquation;\r\n  this.blendSrcAlpha = null;\r\n  this.blendDstAlpha = null;\r\n  this.blendEquationAlpha = null;\r\n\r\n  this.depthTest = true;\r\n  this.depthWrite = true;\r\n\r\n  this.colorWrite = true;\r\n\r\n  this.polygonOffset = false;\r\n  this.polygonOffsetFactor = 0;\r\n  this.polygonOffsetUnits = 0;\r\n\r\n  this.alphaTest = 0;\r\n\r\n  this.overdraw = 0; // Overdrawn pixels (typically between 0 and 1) for fixing antialiasing gaps in CanvasRenderer\r\n\r\n  this.visible = true;\r\n\r\n  this._needsUpdate = true;\r\n\r\n};\r\n\r\nTHREE.Material.prototype = {\r\n\r\n  constructor: THREE.Material,\r\n\r\n  get needsUpdate() {\r\n\r\n    return this._needsUpdate;\r\n\r\n  },\r\n\r\n  set needsUpdate(value) {\r\n\r\n    if (value === true) this.update();\r\n\r\n    this._needsUpdate = value;\r\n\r\n  },\r\n\r\n  setValues: function(values) {\r\n\r\n    if (values === undefined) return;\r\n\r\n    for (var key in values) {\r\n\r\n      var newValue = values[key];\r\n\r\n      if (newValue === undefined) {\r\n\r\n        THREE.warn(\"THREE.Material: '\" + key + \"' parameter is undefined.\");\r\n        continue;\r\n\r\n      }\r\n\r\n      if (key in this) {\r\n\r\n        var currentValue = this[key];\r\n\r\n        if (currentValue instanceof THREE.Color) {\r\n\r\n          currentValue.set(newValue);\r\n\r\n        }\r\n        else if (currentValue instanceof THREE.Vector3 && newValue instanceof THREE.Vector3) {\r\n\r\n          currentValue.copy(newValue);\r\n\r\n        }\r\n        else if (key == 'overdraw') {\r\n\r\n          // ensure overdraw is backwards-compatable with legacy boolean type\r\n          this[key] = Number(newValue);\r\n\r\n        }\r\n        else {\r\n\r\n          this[key] = newValue;\r\n\r\n        }\r\n\r\n      }\r\n\r\n    }\r\n\r\n  },\r\n\r\n  toJSON: function() {\r\n\r\n    var output = {\r\n      metadata: {\r\n        version: 4.2,\r\n        type: 'material',\r\n        generator: 'MaterialExporter'\r\n      },\r\n      uuid: this.uuid,\r\n      type: this.type\r\n    };\r\n\r\n    if (this.name !== \"\") output.name = this.name;\r\n\r\n    if (this instanceof THREE.MeshBasicMaterial) {\r\n\r\n      output.color = this.color.getHex();\r\n      if (this.vertexColors !== THREE.NoColors) output.vertexColors = this.vertexColors;\r\n      if (this.blending !== THREE.NormalBlending) output.blending = this.blending;\r\n      if (this.side !== THREE.FrontSide) output.side = this.side;\r\n\r\n    }\r\n    else if (this instanceof THREE.MeshLambertMaterial) {\r\n\r\n      output.color = this.color.getHex();\r\n      output.emissive = this.emissive.getHex();\r\n      if (this.vertexColors !== THREE.NoColors) output.vertexColors = this.vertexColors;\r\n      if (this.shading !== THREE.SmoothShading) output.shading = this.shading;\r\n      if (this.blending !== THREE.NormalBlending) output.blending = this.blending;\r\n      if (this.side !== THREE.FrontSide) output.side = this.side;\r\n\r\n    }\r\n    else if (this instanceof THREE.MeshPhongMaterial) {\r\n\r\n      output.color = this.color.getHex();\r\n      output.emissive = this.emissive.getHex();\r\n      output.specular = this.specular.getHex();\r\n      output.shininess = this.shininess;\r\n      if (this.vertexColors !== THREE.NoColors) output.vertexColors = this.vertexColors;\r\n      if (this.shading !== THREE.SmoothShading) output.shading = this.shading;\r\n      if (this.blending !== THREE.NormalBlending) output.blending = this.blending;\r\n      if (this.side !== THREE.FrontSide) output.side = this.side;\r\n\r\n    }\r\n    else if (this instanceof THREE.MeshNormalMaterial) {\r\n\r\n      if (this.blending !== THREE.NormalBlending) output.blending = this.blending;\r\n      if (this.side !== THREE.FrontSide) output.side = this.side;\r\n\r\n    }\r\n    else if (this instanceof THREE.MeshDepthMaterial) {\r\n\r\n      if (this.blending !== THREE.NormalBlending) output.blending = this.blending;\r\n      if (this.side !== THREE.FrontSide) output.side = this.side;\r\n\r\n    }\r\n    else if (this instanceof THREE.PointCloudMaterial) {\r\n\r\n      output.size = this.size;\r\n      output.sizeAttenuation = this.sizeAttenuation;\r\n      output.color = this.color.getHex();\r\n\r\n      if (this.vertexColors !== THREE.NoColors) output.vertexColors = this.vertexColors;\r\n      if (this.blending !== THREE.NormalBlending) output.blending = this.blending;\r\n\r\n    }\r\n    else if (this instanceof THREE.ShaderMaterial) {\r\n\r\n      output.uniforms = this.uniforms;\r\n      output.vertexShader = this.vertexShader;\r\n      output.fragmentShader = this.fragmentShader;\r\n\r\n    }\r\n    else if (this instanceof THREE.SpriteMaterial) {\r\n\r\n      output.color = this.color.getHex();\r\n\r\n    }\r\n\r\n    if (this.opacity < 1) output.opacity = this.opacity;\r\n    if (this.transparent !== false) output.transparent = this.transparent;\r\n    if (this.wireframe !== false) output.wireframe = this.wireframe;\r\n\r\n    return output;\r\n\r\n  },\r\n\r\n  clone: function(material) {\r\n\r\n    if (material === undefined) material = new THREE.Material();\r\n\r\n    material.name = this.name;\r\n\r\n    material.side = this.side;\r\n\r\n    material.opacity = this.opacity;\r\n    material.transparent = this.transparent;\r\n\r\n    material.blending = this.blending;\r\n\r\n    material.blendSrc = this.blendSrc;\r\n    material.blendDst = this.blendDst;\r\n    material.blendEquation = this.blendEquation;\r\n    material.blendSrcAlpha = this.blendSrcAlpha;\r\n    material.blendDstAlpha = this.blendDstAlpha;\r\n    material.blendEquationAlpha = this.blendEquationAlpha;\r\n\r\n    material.depthTest = this.depthTest;\r\n    material.depthWrite = this.depthWrite;\r\n\r\n    material.polygonOffset = this.polygonOffset;\r\n    material.polygonOffsetFactor = this.polygonOffsetFactor;\r\n    material.polygonOffsetUnits = this.polygonOffsetUnits;\r\n\r\n    material.alphaTest = this.alphaTest;\r\n\r\n    material.overdraw = this.overdraw;\r\n\r\n    material.visible = this.visible;\r\n\r\n    return material;\r\n\r\n  },\r\n\r\n  update: function() {\r\n\r\n    this.dispatchEvent({\r\n      type: 'update'\r\n    });\r\n\r\n  },\r\n\r\n  dispose: function() {\r\n\r\n    this.dispatchEvent({\r\n      type: 'dispose'\r\n    });\r\n\r\n  }\r\n\r\n};\r\n\r\nTHREE.EventDispatcher.prototype.apply(THREE.Material.prototype);\r\n\r\nTHREE.MaterialIdCount = 0;\r\n\r\n// File:src/materials/LineBasicMaterial.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author alteredq / http://alteredqualia.com/\r\n *\r\n * parameters = {\r\n *  color: <hex>,\r\n *  opacity: <float>,\r\n *\r\n *  blending: THREE.NormalBlending,\r\n *  depthTest: <bool>,\r\n *  depthWrite: <bool>,\r\n *\r\n *  linewidth: <float>,\r\n *  linecap: \"round\",\r\n *  linejoin: \"round\",\r\n *\r\n *  vertexColors: <bool>\r\n *\r\n *  fog: <bool>\r\n * }\r\n */\r\n\r\nTHREE.LineBasicMaterial = function(parameters) {\r\n\r\n  THREE.Material.call(this);\r\n\r\n  this.type = 'LineBasicMaterial';\r\n\r\n  this.color = new THREE.Color(0xffffff);\r\n\r\n  this.linewidth = 1;\r\n  this.linecap = 'round';\r\n  this.linejoin = 'round';\r\n\r\n  this.vertexColors = THREE.NoColors;\r\n\r\n  this.fog = true;\r\n\r\n  this.setValues(parameters);\r\n\r\n};\r\n\r\nTHREE.LineBasicMaterial.prototype = Object.create(THREE.Material.prototype);\r\nTHREE.LineBasicMaterial.prototype.constructor = THREE.LineBasicMaterial;\r\n\r\nTHREE.LineBasicMaterial.prototype.clone = function() {\r\n\r\n  var material = new THREE.LineBasicMaterial();\r\n\r\n  THREE.Material.prototype.clone.call(this, material);\r\n\r\n  material.color.copy(this.color);\r\n\r\n  material.linewidth = this.linewidth;\r\n  material.linecap = this.linecap;\r\n  material.linejoin = this.linejoin;\r\n\r\n  material.vertexColors = this.vertexColors;\r\n\r\n  material.fog = this.fog;\r\n\r\n  return material;\r\n\r\n};\r\n\r\n// File:src/materials/LineDashedMaterial.js\r\n\r\n/**\r\n * @author alteredq / http://alteredqualia.com/\r\n *\r\n * parameters = {\r\n *  color: <hex>,\r\n *  opacity: <float>,\r\n *\r\n *  blending: THREE.NormalBlending,\r\n *  depthTest: <bool>,\r\n *  depthWrite: <bool>,\r\n *\r\n *  linewidth: <float>,\r\n *\r\n *  scale: <float>,\r\n *  dashSize: <float>,\r\n *  gapSize: <float>,\r\n *\r\n *  vertexColors: <bool>\r\n *\r\n *  fog: <bool>\r\n * }\r\n */\r\n\r\nTHREE.LineDashedMaterial = function(parameters) {\r\n\r\n  THREE.Material.call(this);\r\n\r\n  this.type = 'LineDashedMaterial';\r\n\r\n  this.color = new THREE.Color(0xffffff);\r\n\r\n  this.linewidth = 1;\r\n\r\n  this.scale = 1;\r\n  this.dashSize = 3;\r\n  this.gapSize = 1;\r\n\r\n  this.vertexColors = false;\r\n\r\n  this.fog = true;\r\n\r\n  this.setValues(parameters);\r\n\r\n};\r\n\r\nTHREE.LineDashedMaterial.prototype = Object.create(THREE.Material.prototype);\r\nTHREE.LineDashedMaterial.prototype.constructor = THREE.LineDashedMaterial;\r\n\r\nTHREE.LineDashedMaterial.prototype.clone = function() {\r\n\r\n  var material = new THREE.LineDashedMaterial();\r\n\r\n  THREE.Material.prototype.clone.call(this, material);\r\n\r\n  material.color.copy(this.color);\r\n\r\n  material.linewidth = this.linewidth;\r\n\r\n  material.scale = this.scale;\r\n  material.dashSize = this.dashSize;\r\n  material.gapSize = this.gapSize;\r\n\r\n  material.vertexColors = this.vertexColors;\r\n\r\n  material.fog = this.fog;\r\n\r\n  return material;\r\n\r\n};\r\n\r\n// File:src/materials/MeshBasicMaterial.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author alteredq / http://alteredqualia.com/\r\n *\r\n * parameters = {\r\n *  color: <hex>,\r\n *  opacity: <float>,\r\n *  map: new THREE.Texture( <Image> ),\r\n *\r\n *  lightMap: new THREE.Texture( <Image> ),\r\n *\r\n *  specularMap: new THREE.Texture( <Image> ),\r\n *\r\n *  alphaMap: new THREE.Texture( <Image> ),\r\n *\r\n *  envMap: new THREE.TextureCube( [posx, negx, posy, negy, posz, negz] ),\r\n *  combine: THREE.Multiply,\r\n *  reflectivity: <float>,\r\n *  refractionRatio: <float>,\r\n *\r\n *  shading: THREE.SmoothShading,\r\n *  blending: THREE.NormalBlending,\r\n *  depthTest: <bool>,\r\n *  depthWrite: <bool>,\r\n *\r\n *  wireframe: <boolean>,\r\n *  wireframeLinewidth: <float>,\r\n *\r\n *  vertexColors: THREE.NoColors / THREE.VertexColors / THREE.FaceColors,\r\n *\r\n *  skinning: <bool>,\r\n *  morphTargets: <bool>,\r\n *\r\n *  fog: <bool>\r\n * }\r\n */\r\n\r\nTHREE.MeshBasicMaterial = function(parameters) {\r\n\r\n  THREE.Material.call(this);\r\n\r\n  this.type = 'MeshBasicMaterial';\r\n\r\n  this.color = new THREE.Color(0xffffff); // emissive\r\n\r\n  this.map = null;\r\n\r\n  this.lightMap = null;\r\n\r\n  this.specularMap = null;\r\n\r\n  this.alphaMap = null;\r\n\r\n  this.envMap = null;\r\n  this.combine = THREE.MultiplyOperation;\r\n  this.reflectivity = 1;\r\n  this.refractionRatio = 0.98;\r\n\r\n  this.fog = true;\r\n\r\n  this.shading = THREE.SmoothShading;\r\n\r\n  this.wireframe = false;\r\n  this.wireframeLinewidth = 1;\r\n  this.wireframeLinecap = 'round';\r\n  this.wireframeLinejoin = 'round';\r\n\r\n  this.vertexColors = THREE.NoColors;\r\n\r\n  this.skinning = false;\r\n  this.morphTargets = false;\r\n\r\n  this.setValues(parameters);\r\n\r\n};\r\n\r\nTHREE.MeshBasicMaterial.prototype = Object.create(THREE.Material.prototype);\r\nTHREE.MeshBasicMaterial.prototype.constructor = THREE.MeshBasicMaterial;\r\n\r\nTHREE.MeshBasicMaterial.prototype.clone = function() {\r\n\r\n  var material = new THREE.MeshBasicMaterial();\r\n\r\n  THREE.Material.prototype.clone.call(this, material);\r\n\r\n  material.color.copy(this.color);\r\n\r\n  material.map = this.map;\r\n\r\n  material.lightMap = this.lightMap;\r\n\r\n  material.specularMap = this.specularMap;\r\n\r\n  material.alphaMap = this.alphaMap;\r\n\r\n  material.envMap = this.envMap;\r\n  material.combine = this.combine;\r\n  material.reflectivity = this.reflectivity;\r\n  material.refractionRatio = this.refractionRatio;\r\n\r\n  material.fog = this.fog;\r\n\r\n  material.shading = this.shading;\r\n\r\n  material.wireframe = this.wireframe;\r\n  material.wireframeLinewidth = this.wireframeLinewidth;\r\n  material.wireframeLinecap = this.wireframeLinecap;\r\n  material.wireframeLinejoin = this.wireframeLinejoin;\r\n\r\n  material.vertexColors = this.vertexColors;\r\n\r\n  material.skinning = this.skinning;\r\n  material.morphTargets = this.morphTargets;\r\n\r\n  return material;\r\n\r\n};\r\n\r\n// File:src/materials/MeshLambertMaterial.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author alteredq / http://alteredqualia.com/\r\n *\r\n * parameters = {\r\n *  color: <hex>,\r\n *  emissive: <hex>,\r\n *  opacity: <float>,\r\n *\r\n *  map: new THREE.Texture( <Image> ),\r\n *\r\n *  lightMap: new THREE.Texture( <Image> ),\r\n *\r\n *  specularMap: new THREE.Texture( <Image> ),\r\n *\r\n *  alphaMap: new THREE.Texture( <Image> ),\r\n *\r\n *  envMap: new THREE.TextureCube( [posx, negx, posy, negy, posz, negz] ),\r\n *  combine: THREE.Multiply,\r\n *  reflectivity: <float>,\r\n *  refractionRatio: <float>,\r\n *\r\n *  shading: THREE.SmoothShading,\r\n *  blending: THREE.NormalBlending,\r\n *  depthTest: <bool>,\r\n *  depthWrite: <bool>,\r\n *\r\n *  wireframe: <boolean>,\r\n *  wireframeLinewidth: <float>,\r\n *\r\n *  vertexColors: THREE.NoColors / THREE.VertexColors / THREE.FaceColors,\r\n *\r\n *  skinning: <bool>,\r\n *  morphTargets: <bool>,\r\n *  morphNormals: <bool>,\r\n *\r\n *\tfog: <bool>\r\n * }\r\n */\r\n\r\nTHREE.MeshLambertMaterial = function(parameters) {\r\n\r\n  THREE.Material.call(this);\r\n\r\n  this.type = 'MeshLambertMaterial';\r\n\r\n  this.color = new THREE.Color(0xffffff); // diffuse\r\n  this.emissive = new THREE.Color(0x000000);\r\n\r\n  this.wrapAround = false;\r\n  this.wrapRGB = new THREE.Vector3(1, 1, 1);\r\n\r\n  this.map = null;\r\n\r\n  this.lightMap = null;\r\n\r\n  this.specularMap = null;\r\n\r\n  this.alphaMap = null;\r\n\r\n  this.envMap = null;\r\n  this.combine = THREE.MultiplyOperation;\r\n  this.reflectivity = 1;\r\n  this.refractionRatio = 0.98;\r\n\r\n  this.fog = true;\r\n\r\n  this.shading = THREE.SmoothShading;\r\n\r\n  this.wireframe = false;\r\n  this.wireframeLinewidth = 1;\r\n  this.wireframeLinecap = 'round';\r\n  this.wireframeLinejoin = 'round';\r\n\r\n  this.vertexColors = THREE.NoColors;\r\n\r\n  this.skinning = false;\r\n  this.morphTargets = false;\r\n  this.morphNormals = false;\r\n\r\n  this.setValues(parameters);\r\n\r\n};\r\n\r\nTHREE.MeshLambertMaterial.prototype = Object.create(THREE.Material.prototype);\r\nTHREE.MeshLambertMaterial.prototype.constructor = THREE.MeshLambertMaterial;\r\n\r\nTHREE.MeshLambertMaterial.prototype.clone = function() {\r\n\r\n  var material = new THREE.MeshLambertMaterial();\r\n\r\n  THREE.Material.prototype.clone.call(this, material);\r\n\r\n  material.color.copy(this.color);\r\n  material.emissive.copy(this.emissive);\r\n\r\n  material.wrapAround = this.wrapAround;\r\n  material.wrapRGB.copy(this.wrapRGB);\r\n\r\n  material.map = this.map;\r\n\r\n  material.lightMap = this.lightMap;\r\n\r\n  material.specularMap = this.specularMap;\r\n\r\n  material.alphaMap = this.alphaMap;\r\n\r\n  material.envMap = this.envMap;\r\n  material.combine = this.combine;\r\n  material.reflectivity = this.reflectivity;\r\n  material.refractionRatio = this.refractionRatio;\r\n\r\n  material.fog = this.fog;\r\n\r\n  material.shading = this.shading;\r\n\r\n  material.wireframe = this.wireframe;\r\n  material.wireframeLinewidth = this.wireframeLinewidth;\r\n  material.wireframeLinecap = this.wireframeLinecap;\r\n  material.wireframeLinejoin = this.wireframeLinejoin;\r\n\r\n  material.vertexColors = this.vertexColors;\r\n\r\n  material.skinning = this.skinning;\r\n  material.morphTargets = this.morphTargets;\r\n  material.morphNormals = this.morphNormals;\r\n\r\n  return material;\r\n\r\n};\r\n\r\n// File:src/materials/MeshPhongMaterial.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author alteredq / http://alteredqualia.com/\r\n *\r\n * parameters = {\r\n *  color: <hex>,\r\n *  emissive: <hex>,\r\n *  specular: <hex>,\r\n *  shininess: <float>,\r\n *  opacity: <float>,\r\n *\r\n *  map: new THREE.Texture( <Image> ),\r\n *\r\n *  lightMap: new THREE.Texture( <Image> ),\r\n *\r\n *  bumpMap: new THREE.Texture( <Image> ),\r\n *  bumpScale: <float>,\r\n *\r\n *  normalMap: new THREE.Texture( <Image> ),\r\n *  normalScale: <Vector2>,\r\n *\r\n *  specularMap: new THREE.Texture( <Image> ),\r\n *\r\n *  alphaMap: new THREE.Texture( <Image> ),\r\n *\r\n *  envMap: new THREE.TextureCube( [posx, negx, posy, negy, posz, negz] ),\r\n *  combine: THREE.Multiply,\r\n *  reflectivity: <float>,\r\n *  refractionRatio: <float>,\r\n *\r\n *  shading: THREE.SmoothShading,\r\n *  blending: THREE.NormalBlending,\r\n *  depthTest: <bool>,\r\n *  depthWrite: <bool>,\r\n *\r\n *  wireframe: <boolean>,\r\n *  wireframeLinewidth: <float>,\r\n *\r\n *  vertexColors: THREE.NoColors / THREE.VertexColors / THREE.FaceColors,\r\n *\r\n *  skinning: <bool>,\r\n *  morphTargets: <bool>,\r\n *  morphNormals: <bool>,\r\n *\r\n *\tfog: <bool>\r\n * }\r\n */\r\n\r\nTHREE.MeshPhongMaterial = function(parameters) {\r\n\r\n  THREE.Material.call(this);\r\n\r\n  this.type = 'MeshPhongMaterial';\r\n\r\n  this.color = new THREE.Color(0xffffff); // diffuse\r\n  this.emissive = new THREE.Color(0x000000);\r\n  this.specular = new THREE.Color(0x111111);\r\n  this.shininess = 30;\r\n\r\n  this.metal = false;\r\n\r\n  this.wrapAround = false;\r\n  this.wrapRGB = new THREE.Vector3(1, 1, 1);\r\n\r\n  this.map = null;\r\n\r\n  this.lightMap = null;\r\n\r\n  this.bumpMap = null;\r\n  this.bumpScale = 1;\r\n\r\n  this.normalMap = null;\r\n  this.normalScale = new THREE.Vector2(1, 1);\r\n\r\n  this.specularMap = null;\r\n\r\n  this.alphaMap = null;\r\n\r\n  this.envMap = null;\r\n  this.combine = THREE.MultiplyOperation;\r\n  this.reflectivity = 1;\r\n  this.refractionRatio = 0.98;\r\n\r\n  this.fog = true;\r\n\r\n  this.shading = THREE.SmoothShading;\r\n\r\n  this.wireframe = false;\r\n  this.wireframeLinewidth = 1;\r\n  this.wireframeLinecap = 'round';\r\n  this.wireframeLinejoin = 'round';\r\n\r\n  this.vertexColors = THREE.NoColors;\r\n\r\n  this.skinning = false;\r\n  this.morphTargets = false;\r\n  this.morphNormals = false;\r\n\r\n  this.setValues(parameters);\r\n\r\n};\r\n\r\nTHREE.MeshPhongMaterial.prototype = Object.create(THREE.Material.prototype);\r\nTHREE.MeshPhongMaterial.prototype.constructor = THREE.MeshPhongMaterial;\r\n\r\nTHREE.MeshPhongMaterial.prototype.clone = function() {\r\n\r\n  var material = new THREE.MeshPhongMaterial();\r\n\r\n  THREE.Material.prototype.clone.call(this, material);\r\n\r\n  material.color.copy(this.color);\r\n  material.emissive.copy(this.emissive);\r\n  material.specular.copy(this.specular);\r\n  material.shininess = this.shininess;\r\n\r\n  material.metal = this.metal;\r\n\r\n  material.wrapAround = this.wrapAround;\r\n  material.wrapRGB.copy(this.wrapRGB);\r\n\r\n  material.map = this.map;\r\n\r\n  material.lightMap = this.lightMap;\r\n\r\n  material.bumpMap = this.bumpMap;\r\n  material.bumpScale = this.bumpScale;\r\n\r\n  material.normalMap = this.normalMap;\r\n  material.normalScale.copy(this.normalScale);\r\n\r\n  material.specularMap = this.specularMap;\r\n\r\n  material.alphaMap = this.alphaMap;\r\n\r\n  material.envMap = this.envMap;\r\n  material.combine = this.combine;\r\n  material.reflectivity = this.reflectivity;\r\n  material.refractionRatio = this.refractionRatio;\r\n\r\n  material.fog = this.fog;\r\n\r\n  material.shading = this.shading;\r\n\r\n  material.wireframe = this.wireframe;\r\n  material.wireframeLinewidth = this.wireframeLinewidth;\r\n  material.wireframeLinecap = this.wireframeLinecap;\r\n  material.wireframeLinejoin = this.wireframeLinejoin;\r\n\r\n  material.vertexColors = this.vertexColors;\r\n\r\n  material.skinning = this.skinning;\r\n  material.morphTargets = this.morphTargets;\r\n  material.morphNormals = this.morphNormals;\r\n\r\n  return material;\r\n\r\n};\r\n\r\n// File:src/materials/MeshDepthMaterial.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author alteredq / http://alteredqualia.com/\r\n *\r\n * parameters = {\r\n *  opacity: <float>,\r\n *\r\n *  blending: THREE.NormalBlending,\r\n *  depthTest: <bool>,\r\n *  depthWrite: <bool>,\r\n *\r\n *  wireframe: <boolean>,\r\n *  wireframeLinewidth: <float>\r\n * }\r\n */\r\n\r\nTHREE.MeshDepthMaterial = function(parameters) {\r\n\r\n  THREE.Material.call(this);\r\n\r\n  this.type = 'MeshDepthMaterial';\r\n\r\n  this.morphTargets = false;\r\n  this.wireframe = false;\r\n  this.wireframeLinewidth = 1;\r\n\r\n  this.setValues(parameters);\r\n\r\n};\r\n\r\nTHREE.MeshDepthMaterial.prototype = Object.create(THREE.Material.prototype);\r\nTHREE.MeshDepthMaterial.prototype.constructor = THREE.MeshDepthMaterial;\r\n\r\nTHREE.MeshDepthMaterial.prototype.clone = function() {\r\n\r\n  var material = new THREE.MeshDepthMaterial();\r\n\r\n  THREE.Material.prototype.clone.call(this, material);\r\n\r\n  material.wireframe = this.wireframe;\r\n  material.wireframeLinewidth = this.wireframeLinewidth;\r\n\r\n  return material;\r\n\r\n};\r\n\r\n// File:src/materials/MeshNormalMaterial.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n *\r\n * parameters = {\r\n *  opacity: <float>,\r\n *\r\n *  shading: THREE.FlatShading,\r\n *  blending: THREE.NormalBlending,\r\n *  depthTest: <bool>,\r\n *  depthWrite: <bool>,\r\n *\r\n *  wireframe: <boolean>,\r\n *  wireframeLinewidth: <float>\r\n * }\r\n */\r\n\r\nTHREE.MeshNormalMaterial = function(parameters) {\r\n\r\n  THREE.Material.call(this, parameters);\r\n\r\n  this.type = 'MeshNormalMaterial';\r\n\r\n  this.wireframe = false;\r\n  this.wireframeLinewidth = 1;\r\n\r\n  this.morphTargets = false;\r\n\r\n  this.setValues(parameters);\r\n\r\n};\r\n\r\nTHREE.MeshNormalMaterial.prototype = Object.create(THREE.Material.prototype);\r\nTHREE.MeshNormalMaterial.prototype.constructor = THREE.MeshNormalMaterial;\r\n\r\nTHREE.MeshNormalMaterial.prototype.clone = function() {\r\n\r\n  var material = new THREE.MeshNormalMaterial();\r\n\r\n  THREE.Material.prototype.clone.call(this, material);\r\n\r\n  material.wireframe = this.wireframe;\r\n  material.wireframeLinewidth = this.wireframeLinewidth;\r\n\r\n  return material;\r\n\r\n};\r\n\r\n// File:src/materials/MeshFaceMaterial.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.MeshFaceMaterial = function(materials) {\r\n\r\n  this.uuid = THREE.Math.generateUUID();\r\n\r\n  this.type = 'MeshFaceMaterial';\r\n\r\n  this.materials = materials instanceof Array ? materials : [];\r\n\r\n};\r\n\r\nTHREE.MeshFaceMaterial.prototype = {\r\n\r\n  constructor: THREE.MeshFaceMaterial,\r\n\r\n  toJSON: function() {\r\n\r\n    var output = {\r\n      metadata: {\r\n        version: 4.2,\r\n        type: 'material',\r\n        generator: 'MaterialExporter'\r\n      },\r\n      uuid: this.uuid,\r\n      type: this.type,\r\n      materials: []\r\n    };\r\n\r\n    for (var i = 0, l = this.materials.length; i < l; i++) {\r\n\r\n      output.materials.push(this.materials[i].toJSON());\r\n\r\n    }\r\n\r\n    return output;\r\n\r\n  },\r\n\r\n  clone: function() {\r\n\r\n    var material = new THREE.MeshFaceMaterial();\r\n\r\n    for (var i = 0; i < this.materials.length; i++) {\r\n\r\n      material.materials.push(this.materials[i].clone());\r\n\r\n    }\r\n\r\n    return material;\r\n\r\n  }\r\n\r\n};\r\n\r\n// File:src/materials/PointCloudMaterial.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author alteredq / http://alteredqualia.com/\r\n *\r\n * parameters = {\r\n *  color: <hex>,\r\n *  opacity: <float>,\r\n *  map: new THREE.Texture( <Image> ),\r\n *\r\n *  size: <float>,\r\n *  sizeAttenuation: <bool>,\r\n *\r\n *  blending: THREE.NormalBlending,\r\n *  depthTest: <bool>,\r\n *  depthWrite: <bool>,\r\n *\r\n *  vertexColors: <bool>,\r\n *\r\n *  fog: <bool>\r\n * }\r\n */\r\n\r\nTHREE.PointCloudMaterial = function(parameters) {\r\n\r\n  THREE.Material.call(this);\r\n\r\n  this.type = 'PointCloudMaterial';\r\n\r\n  this.color = new THREE.Color(0xffffff);\r\n\r\n  this.map = null;\r\n\r\n  this.size = 1;\r\n  this.sizeAttenuation = true;\r\n\r\n  this.vertexColors = THREE.NoColors;\r\n\r\n  this.fog = true;\r\n\r\n  this.setValues(parameters);\r\n\r\n};\r\n\r\nTHREE.PointCloudMaterial.prototype = Object.create(THREE.Material.prototype);\r\nTHREE.PointCloudMaterial.prototype.constructor = THREE.PointCloudMaterial;\r\n\r\nTHREE.PointCloudMaterial.prototype.clone = function() {\r\n\r\n  var material = new THREE.PointCloudMaterial();\r\n\r\n  THREE.Material.prototype.clone.call(this, material);\r\n\r\n  material.color.copy(this.color);\r\n\r\n  material.map = this.map;\r\n\r\n  material.size = this.size;\r\n  material.sizeAttenuation = this.sizeAttenuation;\r\n\r\n  material.vertexColors = this.vertexColors;\r\n\r\n  material.fog = this.fog;\r\n\r\n  return material;\r\n\r\n};\r\n\r\n// backwards compatibility\r\n\r\nTHREE.ParticleBasicMaterial = function(parameters) {\r\n\r\n  THREE.warn('THREE.ParticleBasicMaterial has been renamed to THREE.PointCloudMaterial.');\r\n  return new THREE.PointCloudMaterial(parameters);\r\n\r\n};\r\n\r\nTHREE.ParticleSystemMaterial = function(parameters) {\r\n\r\n  THREE.warn('THREE.ParticleSystemMaterial has been renamed to THREE.PointCloudMaterial.');\r\n  return new THREE.PointCloudMaterial(parameters);\r\n\r\n};\r\n\r\n// File:src/materials/ShaderMaterial.js\r\n\r\n/**\r\n * @author alteredq / http://alteredqualia.com/\r\n *\r\n * parameters = {\r\n *  defines: { \"label\" : \"value\" },\r\n *  uniforms: { \"parameter1\": { type: \"f\", value: 1.0 }, \"parameter2\": { type: \"i\" value2: 2 } },\r\n *\r\n *  fragmentShader: <string>,\r\n *  vertexShader: <string>,\r\n *\r\n *  shading: THREE.SmoothShading,\r\n *  blending: THREE.NormalBlending,\r\n *  depthTest: <bool>,\r\n *  depthWrite: <bool>,\r\n *\r\n *  wireframe: <boolean>,\r\n *  wireframeLinewidth: <float>,\r\n *\r\n *  lights: <bool>,\r\n *\r\n *  vertexColors: THREE.NoColors / THREE.VertexColors / THREE.FaceColors,\r\n *\r\n *  skinning: <bool>,\r\n *  morphTargets: <bool>,\r\n *  morphNormals: <bool>,\r\n *\r\n *\tfog: <bool>\r\n * }\r\n */\r\n\r\nTHREE.ShaderMaterial = function(parameters) {\r\n\r\n  THREE.Material.call(this);\r\n\r\n  this.type = 'ShaderMaterial';\r\n\r\n  this.defines = {};\r\n  this.uniforms = {};\r\n  this.attributes = null;\r\n\r\n  this.vertexShader = 'void main() {\\n\\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\\n}';\r\n  this.fragmentShader = 'void main() {\\n\\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\\n}';\r\n\r\n  this.shading = THREE.SmoothShading;\r\n\r\n  this.linewidth = 1;\r\n\r\n  this.wireframe = false;\r\n  this.wireframeLinewidth = 1;\r\n\r\n  this.fog = false; // set to use scene fog\r\n\r\n  this.lights = false; // set to use scene lights\r\n\r\n  this.vertexColors = THREE.NoColors; // set to use \"color\" attribute stream\r\n\r\n  this.skinning = false; // set to use skinning attribute streams\r\n\r\n  this.morphTargets = false; // set to use morph targets\r\n  this.morphNormals = false; // set to use morph normals\r\n\r\n  // When rendered geometry doesn't include these attributes but the material does,\r\n  // use these default values in WebGL. This avoids errors when buffer data is missing.\r\n  this.defaultAttributeValues = {\r\n    'color': [1, 1, 1],\r\n    'uv': [0, 0],\r\n    'uv2': [0, 0]\r\n  };\r\n\r\n  this.index0AttributeName = undefined;\r\n\r\n  this.setValues(parameters);\r\n\r\n};\r\n\r\nTHREE.ShaderMaterial.prototype = Object.create(THREE.Material.prototype);\r\nTHREE.ShaderMaterial.prototype.constructor = THREE.ShaderMaterial;\r\n\r\nTHREE.ShaderMaterial.prototype.clone = function() {\r\n\r\n  var material = new THREE.ShaderMaterial();\r\n\r\n  THREE.Material.prototype.clone.call(this, material);\r\n\r\n  material.fragmentShader = this.fragmentShader;\r\n  material.vertexShader = this.vertexShader;\r\n\r\n  material.uniforms = THREE.UniformsUtils.clone(this.uniforms);\r\n\r\n  material.attributes = this.attributes;\r\n  material.defines = this.defines;\r\n\r\n  material.shading = this.shading;\r\n\r\n  material.wireframe = this.wireframe;\r\n  material.wireframeLinewidth = this.wireframeLinewidth;\r\n\r\n  material.fog = this.fog;\r\n\r\n  material.lights = this.lights;\r\n\r\n  material.vertexColors = this.vertexColors;\r\n\r\n  material.skinning = this.skinning;\r\n\r\n  material.morphTargets = this.morphTargets;\r\n  material.morphNormals = this.morphNormals;\r\n\r\n  return material;\r\n\r\n};\r\n\r\n// File:src/materials/RawShaderMaterial.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.RawShaderMaterial = function(parameters) {\r\n\r\n  THREE.ShaderMaterial.call(this, parameters);\r\n\r\n  this.type = 'RawShaderMaterial';\r\n\r\n};\r\n\r\nTHREE.RawShaderMaterial.prototype = Object.create(THREE.ShaderMaterial.prototype);\r\nTHREE.RawShaderMaterial.prototype.constructor = THREE.RawShaderMaterial;\r\n\r\nTHREE.RawShaderMaterial.prototype.clone = function() {\r\n\r\n  var material = new THREE.RawShaderMaterial();\r\n\r\n  THREE.ShaderMaterial.prototype.clone.call(this, material);\r\n\r\n  return material;\r\n\r\n};\r\n\r\n// File:src/materials/SpriteMaterial.js\r\n\r\n/**\r\n * @author alteredq / http://alteredqualia.com/\r\n *\r\n * parameters = {\r\n *  color: <hex>,\r\n *  opacity: <float>,\r\n *  map: new THREE.Texture( <Image> ),\r\n *\r\n *  blending: THREE.NormalBlending,\r\n *  depthTest: <bool>,\r\n *  depthWrite: <bool>,\r\n *\r\n *\tuvOffset: new THREE.Vector2(),\r\n *\tuvScale: new THREE.Vector2(),\r\n *\r\n *  fog: <bool>\r\n * }\r\n */\r\n\r\nTHREE.SpriteMaterial = function(parameters) {\r\n\r\n  THREE.Material.call(this);\r\n\r\n  this.type = 'SpriteMaterial';\r\n\r\n  this.color = new THREE.Color(0xffffff);\r\n  this.map = null;\r\n\r\n  this.rotation = 0;\r\n\r\n  this.fog = false;\r\n\r\n  // set parameters\r\n\r\n  this.setValues(parameters);\r\n\r\n};\r\n\r\nTHREE.SpriteMaterial.prototype = Object.create(THREE.Material.prototype);\r\nTHREE.SpriteMaterial.prototype.constructor = THREE.SpriteMaterial;\r\n\r\nTHREE.SpriteMaterial.prototype.clone = function() {\r\n\r\n  var material = new THREE.SpriteMaterial();\r\n\r\n  THREE.Material.prototype.clone.call(this, material);\r\n\r\n  material.color.copy(this.color);\r\n  material.map = this.map;\r\n\r\n  material.rotation = this.rotation;\r\n\r\n  material.fog = this.fog;\r\n\r\n  return material;\r\n\r\n};\r\n\r\n// File:src/textures/Texture.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author alteredq / http://alteredqualia.com/\r\n * @author szimek / https://github.com/szimek/\r\n */\r\n\r\nTHREE.Texture = function(image, mapping, wrapS, wrapT, magFilter, minFilter, format, type, anisotropy) {\r\n\r\n  Object.defineProperty(this, 'id', {\r\n    value: THREE.TextureIdCount++\r\n  });\r\n\r\n  this.uuid = THREE.Math.generateUUID();\r\n\r\n  this.name = '';\r\n  this.sourceFile = '';\r\n\r\n  this.image = image !== undefined ? image : THREE.Texture.DEFAULT_IMAGE;\r\n  this.mipmaps = [];\r\n\r\n  this.mapping = mapping !== undefined ? mapping : THREE.Texture.DEFAULT_MAPPING;\r\n\r\n  this.wrapS = wrapS !== undefined ? wrapS : THREE.ClampToEdgeWrapping;\r\n  this.wrapT = wrapT !== undefined ? wrapT : THREE.ClampToEdgeWrapping;\r\n\r\n  this.magFilter = magFilter !== undefined ? magFilter : THREE.LinearFilter;\r\n  this.minFilter = minFilter !== undefined ? minFilter : THREE.LinearMipMapLinearFilter;\r\n\r\n  this.anisotropy = anisotropy !== undefined ? anisotropy : 1;\r\n\r\n  this.format = format !== undefined ? format : THREE.RGBAFormat;\r\n  this.type = type !== undefined ? type : THREE.UnsignedByteType;\r\n\r\n  this.offset = new THREE.Vector2(0, 0);\r\n  this.repeat = new THREE.Vector2(1, 1);\r\n\r\n  this.generateMipmaps = true;\r\n  this.premultiplyAlpha = false;\r\n  this.flipY = true;\r\n  this.unpackAlignment = 4; // valid values: 1, 2, 4, 8 (see http://www.khronos.org/opengles/sdk/docs/man/xhtml/glPixelStorei.xml)\r\n\r\n  this._needsUpdate = false;\r\n  this.onUpdate = null;\r\n\r\n};\r\n\r\nTHREE.Texture.DEFAULT_IMAGE = undefined;\r\nTHREE.Texture.DEFAULT_MAPPING = THREE.UVMapping;\r\n\r\nTHREE.Texture.prototype = {\r\n\r\n  constructor: THREE.Texture,\r\n\r\n  get needsUpdate() {\r\n\r\n    return this._needsUpdate;\r\n\r\n  },\r\n\r\n  set needsUpdate(value) {\r\n\r\n    if (value === true) this.update();\r\n\r\n    this._needsUpdate = value;\r\n\r\n  },\r\n\r\n  clone: function(texture) {\r\n\r\n    if (texture === undefined) texture = new THREE.Texture();\r\n\r\n    texture.image = this.image;\r\n    texture.mipmaps = this.mipmaps.slice(0);\r\n\r\n    texture.mapping = this.mapping;\r\n\r\n    texture.wrapS = this.wrapS;\r\n    texture.wrapT = this.wrapT;\r\n\r\n    texture.magFilter = this.magFilter;\r\n    texture.minFilter = this.minFilter;\r\n\r\n    texture.anisotropy = this.anisotropy;\r\n\r\n    texture.format = this.format;\r\n    texture.type = this.type;\r\n\r\n    texture.offset.copy(this.offset);\r\n    texture.repeat.copy(this.repeat);\r\n\r\n    texture.generateMipmaps = this.generateMipmaps;\r\n    texture.premultiplyAlpha = this.premultiplyAlpha;\r\n    texture.flipY = this.flipY;\r\n    texture.unpackAlignment = this.unpackAlignment;\r\n\r\n    return texture;\r\n\r\n  },\r\n\r\n  update: function() {\r\n\r\n    this.dispatchEvent({\r\n      type: 'update'\r\n    });\r\n\r\n  },\r\n\r\n  dispose: function() {\r\n\r\n    this.dispatchEvent({\r\n      type: 'dispose'\r\n    });\r\n\r\n  }\r\n\r\n};\r\n\r\nTHREE.EventDispatcher.prototype.apply(THREE.Texture.prototype);\r\n\r\nTHREE.TextureIdCount = 0;\r\n\r\n// File:src/textures/CubeTexture.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.CubeTexture = function(images, mapping, wrapS, wrapT, magFilter, minFilter, format, type, anisotropy) {\r\n\r\n  mapping = mapping !== undefined ? mapping : THREE.CubeReflectionMapping;\r\n\r\n  THREE.Texture.call(this, images, mapping, wrapS, wrapT, magFilter, minFilter, format, type, anisotropy);\r\n\r\n  this.images = images;\r\n\r\n};\r\n\r\nTHREE.CubeTexture.prototype = Object.create(THREE.Texture.prototype);\r\nTHREE.CubeTexture.prototype.constructor = THREE.CubeTexture;\r\n\r\nTHREE.CubeTexture.clone = function(texture) {\r\n\r\n  if (texture === undefined) texture = new THREE.CubeTexture();\r\n\r\n  THREE.Texture.prototype.clone.call(this, texture);\r\n\r\n  texture.images = this.images;\r\n\r\n  return texture;\r\n\r\n};\r\n\r\n// File:src/textures/CompressedTexture.js\r\n\r\n/**\r\n * @author alteredq / http://alteredqualia.com/\r\n */\r\n\r\nTHREE.CompressedTexture = function(mipmaps, width, height, format, type, mapping, wrapS, wrapT, magFilter, minFilter, anisotropy) {\r\n\r\n  THREE.Texture.call(this, null, mapping, wrapS, wrapT, magFilter, minFilter, format, type, anisotropy);\r\n\r\n  this.image = {\r\n    width: width,\r\n    height: height\r\n  };\r\n  this.mipmaps = mipmaps;\r\n\r\n  // no flipping for cube textures\r\n  // (also flipping doesn't work for compressed textures )\r\n\r\n  this.flipY = false;\r\n\r\n  // can't generate mipmaps for compressed textures\r\n  // mips must be embedded in DDS files\r\n\r\n  this.generateMipmaps = false;\r\n\r\n};\r\n\r\nTHREE.CompressedTexture.prototype = Object.create(THREE.Texture.prototype);\r\nTHREE.CompressedTexture.prototype.constructor = THREE.CompressedTexture;\r\n\r\nTHREE.CompressedTexture.prototype.clone = function() {\r\n\r\n  var texture = new THREE.CompressedTexture();\r\n\r\n  THREE.Texture.prototype.clone.call(this, texture);\r\n\r\n  return texture;\r\n\r\n};\r\n\r\n// File:src/textures/DataTexture.js\r\n\r\n/**\r\n * @author alteredq / http://alteredqualia.com/\r\n */\r\n\r\nTHREE.DataTexture = function(data, width, height, format, type, mapping, wrapS, wrapT, magFilter, minFilter, anisotropy) {\r\n\r\n  THREE.Texture.call(this, null, mapping, wrapS, wrapT, magFilter, minFilter, format, type, anisotropy);\r\n\r\n  this.image = {\r\n    data: data,\r\n    width: width,\r\n    height: height\r\n  };\r\n\r\n};\r\n\r\nTHREE.DataTexture.prototype = Object.create(THREE.Texture.prototype);\r\nTHREE.DataTexture.prototype.constructor = THREE.DataTexture;\r\n\r\nTHREE.DataTexture.prototype.clone = function() {\r\n\r\n  var texture = new THREE.DataTexture();\r\n\r\n  THREE.Texture.prototype.clone.call(this, texture);\r\n\r\n  return texture;\r\n\r\n};\r\n\r\n// File:src/textures/VideoTexture.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.VideoTexture = function(video, mapping, wrapS, wrapT, magFilter, minFilter, format, type, anisotropy) {\r\n\r\n  THREE.Texture.call(this, video, mapping, wrapS, wrapT, magFilter, minFilter, format, type, anisotropy);\r\n\r\n  this.generateMipmaps = false;\r\n\r\n  var scope = this;\r\n\r\n  var update = function() {\r\n\r\n    requestAnimationFrame(update);\r\n\r\n    if (video.readyState === video.HAVE_ENOUGH_DATA) {\r\n\r\n      scope.needsUpdate = true;\r\n\r\n    }\r\n\r\n  };\r\n\r\n  update();\r\n\r\n};\r\n\r\nTHREE.VideoTexture.prototype = Object.create(THREE.Texture.prototype);\r\nTHREE.VideoTexture.prototype.constructor = THREE.VideoTexture;\r\n\r\n// File:src/objects/Group.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.Group = function() {\r\n\r\n  THREE.Object3D.call(this);\r\n\r\n  this.type = 'Group';\r\n\r\n};\r\n\r\nTHREE.Group.prototype = Object.create(THREE.Object3D.prototype);\r\nTHREE.Group.prototype.constructor = THREE.Group;\r\n\r\n// File:src/objects/PointCloud.js\r\n\r\n/**\r\n * @author alteredq / http://alteredqualia.com/\r\n */\r\n\r\nTHREE.PointCloud = function(geometry, material) {\r\n\r\n  THREE.Object3D.call(this);\r\n\r\n  this.type = 'PointCloud';\r\n\r\n  this.geometry = geometry !== undefined ? geometry : new THREE.Geometry();\r\n  this.material = material !== undefined ? material : new THREE.PointCloudMaterial({\r\n    color: Math.random() * 0xffffff\r\n  });\r\n\r\n};\r\n\r\nTHREE.PointCloud.prototype = Object.create(THREE.Object3D.prototype);\r\nTHREE.PointCloud.prototype.constructor = THREE.PointCloud;\r\n\r\nTHREE.PointCloud.prototype.raycast = (function() {\r\n\r\n  var inverseMatrix = new THREE.Matrix4();\r\n  var ray = new THREE.Ray();\r\n\r\n  return function(raycaster, intersects) {\r\n\r\n    var object = this;\r\n    var geometry = object.geometry;\r\n    var threshold = raycaster.params.PointCloud.threshold;\r\n\r\n    inverseMatrix.getInverse(this.matrixWorld);\r\n    ray.copy(raycaster.ray).applyMatrix4(inverseMatrix);\r\n\r\n    if (geometry.boundingBox !== null) {\r\n\r\n      if (ray.isIntersectionBox(geometry.boundingBox) === false) {\r\n\r\n        return;\r\n\r\n      }\r\n\r\n    }\r\n\r\n    var localThreshold = threshold / ((this.scale.x + this.scale.y + this.scale.z) / 3);\r\n    var position = new THREE.Vector3();\r\n\r\n    var testPoint = function(point, index) {\r\n\r\n      var rayPointDistance = ray.distanceToPoint(point);\r\n\r\n      if (rayPointDistance < localThreshold) {\r\n\r\n        var intersectPoint = ray.closestPointToPoint(point);\r\n        intersectPoint.applyMatrix4(object.matrixWorld);\r\n\r\n        var distance = raycaster.ray.origin.distanceTo(intersectPoint);\r\n\r\n        intersects.push({\r\n\r\n          distance: distance,\r\n          distanceToRay: rayPointDistance,\r\n          point: intersectPoint.clone(),\r\n          index: index,\r\n          face: null,\r\n          object: object\r\n\r\n        });\r\n\r\n      }\r\n\r\n    };\r\n\r\n    if (geometry instanceof THREE.BufferGeometry) {\r\n\r\n      var attributes = geometry.attributes;\r\n      var positions = attributes.position.array;\r\n\r\n      if (attributes.index !== undefined) {\r\n\r\n        var indices = attributes.index.array;\r\n        var offsets = geometry.offsets;\r\n\r\n        if (offsets.length === 0) {\r\n\r\n          var offset = {\r\n            start: 0,\r\n            count: indices.length,\r\n            index: 0\r\n          };\r\n\r\n          offsets = [offset];\r\n\r\n        }\r\n\r\n        for (var oi = 0, ol = offsets.length; oi < ol; ++oi) {\r\n\r\n          var start = offsets[oi].start;\r\n          var count = offsets[oi].count;\r\n          var index = offsets[oi].index;\r\n\r\n          for (var i = start, il = start + count; i < il; i++) {\r\n\r\n            var a = index + indices[i];\r\n\r\n            position.fromArray(positions, a * 3);\r\n\r\n            testPoint(position, a);\r\n\r\n          }\r\n\r\n        }\r\n\r\n      }\r\n      else {\r\n\r\n        var pointCount = positions.length / 3;\r\n\r\n        for (var i = 0; i < pointCount; i++) {\r\n\r\n          position.set(\r\n            positions[3 * i],\r\n            positions[3 * i + 1],\r\n            positions[3 * i + 2]\r\n          );\r\n\r\n          testPoint(position, i);\r\n\r\n        }\r\n\r\n      }\r\n\r\n    }\r\n    else {\r\n\r\n      var vertices = this.geometry.vertices;\r\n\r\n      for (var i = 0; i < vertices.length; i++) {\r\n\r\n        testPoint(vertices[i], i);\r\n\r\n      }\r\n\r\n    }\r\n\r\n  };\r\n\r\n}());\r\n\r\nTHREE.PointCloud.prototype.clone = function(object) {\r\n\r\n  if (object === undefined) object = new THREE.PointCloud(this.geometry, this.material);\r\n\r\n  THREE.Object3D.prototype.clone.call(this, object);\r\n\r\n  return object;\r\n\r\n};\r\n\r\n// Backwards compatibility\r\n\r\nTHREE.ParticleSystem = function(geometry, material) {\r\n\r\n  THREE.warn('THREE.ParticleSystem has been renamed to THREE.PointCloud.');\r\n  return new THREE.PointCloud(geometry, material);\r\n\r\n};\r\n\r\n// File:src/objects/Line.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.Line = function(geometry, material, mode) {\r\n\r\n  THREE.Object3D.call(this);\r\n\r\n  this.type = 'Line';\r\n\r\n  this.geometry = geometry !== undefined ? geometry : new THREE.Geometry();\r\n  this.material = material !== undefined ? material : new THREE.LineBasicMaterial({\r\n    color: Math.random() * 0xffffff\r\n  });\r\n\r\n  this.mode = mode !== undefined ? mode : THREE.LineStrip;\r\n\r\n};\r\n\r\nTHREE.LineStrip = 0;\r\nTHREE.LinePieces = 1;\r\n\r\nTHREE.Line.prototype = Object.create(THREE.Object3D.prototype);\r\nTHREE.Line.prototype.constructor = THREE.Line;\r\n\r\nTHREE.Line.prototype.raycast = (function() {\r\n\r\n  var inverseMatrix = new THREE.Matrix4();\r\n  var ray = new THREE.Ray();\r\n  var sphere = new THREE.Sphere();\r\n\r\n  return function(raycaster, intersects) {\r\n\r\n    var precision = raycaster.linePrecision;\r\n    var precisionSq = precision * precision;\r\n\r\n    var geometry = this.geometry;\r\n\r\n    if (geometry.boundingSphere === null) geometry.computeBoundingSphere();\r\n\r\n    // Checking boundingSphere distance to ray\r\n\r\n    sphere.copy(geometry.boundingSphere);\r\n    sphere.applyMatrix4(this.matrixWorld);\r\n\r\n    if (raycaster.ray.isIntersectionSphere(sphere) === false) {\r\n\r\n      return;\r\n\r\n    }\r\n\r\n    inverseMatrix.getInverse(this.matrixWorld);\r\n    ray.copy(raycaster.ray).applyMatrix4(inverseMatrix);\r\n\r\n    var vStart = new THREE.Vector3();\r\n    var vEnd = new THREE.Vector3();\r\n    var interSegment = new THREE.Vector3();\r\n    var interRay = new THREE.Vector3();\r\n    var step = this.mode === THREE.LineStrip ? 1 : 2;\r\n\r\n    if (geometry instanceof THREE.BufferGeometry) {\r\n\r\n      var attributes = geometry.attributes;\r\n\r\n      if (attributes.index !== undefined) {\r\n\r\n        var indices = attributes.index.array;\r\n        var positions = attributes.position.array;\r\n        var offsets = geometry.offsets;\r\n\r\n        if (offsets.length === 0) {\r\n\r\n          offsets = [{\r\n            start: 0,\r\n            count: indices.length,\r\n            index: 0\r\n          }];\r\n\r\n        }\r\n\r\n        for (var oi = 0; oi < offsets.length; oi++) {\r\n\r\n          var start = offsets[oi].start;\r\n          var count = offsets[oi].count;\r\n          var index = offsets[oi].index;\r\n\r\n          for (var i = start; i < start + count - 1; i += step) {\r\n\r\n            var a = index + indices[i];\r\n            var b = index + indices[i + 1];\r\n\r\n            vStart.fromArray(positions, a * 3);\r\n            vEnd.fromArray(positions, b * 3);\r\n\r\n            var distSq = ray.distanceSqToSegment(vStart, vEnd, interRay, interSegment);\r\n\r\n            if (distSq > precisionSq) continue;\r\n\r\n            var distance = ray.origin.distanceTo(interRay);\r\n\r\n            if (distance < raycaster.near || distance > raycaster.far) continue;\r\n\r\n            intersects.push({\r\n\r\n              distance: distance,\r\n              // What do we want? intersection point on the ray or on the segment??\r\n              // point: raycaster.ray.at( distance ),\r\n              point: interSegment.clone().applyMatrix4(this.matrixWorld),\r\n              index: i,\r\n              offsetIndex: oi,\r\n              face: null,\r\n              faceIndex: null,\r\n              object: this\r\n\r\n            });\r\n\r\n          }\r\n\r\n        }\r\n\r\n      }\r\n      else {\r\n\r\n        var positions = attributes.position.array;\r\n\r\n        for (var i = 0; i < positions.length / 3 - 1; i += step) {\r\n\r\n          vStart.fromArray(positions, 3 * i);\r\n          vEnd.fromArray(positions, 3 * i + 3);\r\n\r\n          var distSq = ray.distanceSqToSegment(vStart, vEnd, interRay, interSegment);\r\n\r\n          if (distSq > precisionSq) continue;\r\n\r\n          var distance = ray.origin.distanceTo(interRay);\r\n\r\n          if (distance < raycaster.near || distance > raycaster.far) continue;\r\n\r\n          intersects.push({\r\n\r\n            distance: distance,\r\n            // What do we want? intersection point on the ray or on the segment??\r\n            // point: raycaster.ray.at( distance ),\r\n            point: interSegment.clone().applyMatrix4(this.matrixWorld),\r\n            index: i,\r\n            face: null,\r\n            faceIndex: null,\r\n            object: this\r\n\r\n          });\r\n\r\n        }\r\n\r\n      }\r\n\r\n    }\r\n    else if (geometry instanceof THREE.Geometry) {\r\n\r\n      var vertices = geometry.vertices;\r\n      var nbVertices = vertices.length;\r\n\r\n      for (var i = 0; i < nbVertices - 1; i += step) {\r\n\r\n        var distSq = ray.distanceSqToSegment(vertices[i], vertices[i + 1], interRay, interSegment);\r\n\r\n        if (distSq > precisionSq) continue;\r\n\r\n        var distance = ray.origin.distanceTo(interRay);\r\n\r\n        if (distance < raycaster.near || distance > raycaster.far) continue;\r\n\r\n        intersects.push({\r\n\r\n          distance: distance,\r\n          // What do we want? intersection point on the ray or on the segment??\r\n          // point: raycaster.ray.at( distance ),\r\n          point: interSegment.clone().applyMatrix4(this.matrixWorld),\r\n          index: i,\r\n          face: null,\r\n          faceIndex: null,\r\n          object: this\r\n\r\n        });\r\n\r\n      }\r\n\r\n    }\r\n\r\n  };\r\n\r\n}());\r\n\r\nTHREE.Line.prototype.clone = function(object) {\r\n\r\n  if (object === undefined) object = new THREE.Line(this.geometry, this.material, this.mode);\r\n\r\n  THREE.Object3D.prototype.clone.call(this, object);\r\n\r\n  return object;\r\n\r\n};\r\n\r\n// File:src/objects/Mesh.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author alteredq / http://alteredqualia.com/\r\n * @author mikael emtinger / http://gomo.se/\r\n * @author jonobr1 / http://jonobr1.com/\r\n */\r\n\r\nTHREE.Mesh = function(geometry, material) {\r\n\r\n  THREE.Object3D.call(this);\r\n\r\n  this.type = 'Mesh';\r\n\r\n  this.geometry = geometry !== undefined ? geometry : new THREE.Geometry();\r\n  this.material = material !== undefined ? material : new THREE.MeshBasicMaterial({\r\n    color: Math.random() * 0xffffff\r\n  });\r\n\r\n  this.updateMorphTargets();\r\n\r\n};\r\n\r\nTHREE.Mesh.prototype = Object.create(THREE.Object3D.prototype);\r\nTHREE.Mesh.prototype.constructor = THREE.Mesh;\r\n\r\nTHREE.Mesh.prototype.updateMorphTargets = function() {\r\n\r\n  if (this.geometry.morphTargets !== undefined && this.geometry.morphTargets.length > 0) {\r\n\r\n    this.morphTargetBase = -1;\r\n    this.morphTargetForcedOrder = [];\r\n    this.morphTargetInfluences = [];\r\n    this.morphTargetDictionary = {};\r\n\r\n    for (var m = 0, ml = this.geometry.morphTargets.length; m < ml; m++) {\r\n\r\n      this.morphTargetInfluences.push(0);\r\n      this.morphTargetDictionary[this.geometry.morphTargets[m].name] = m;\r\n\r\n    }\r\n\r\n  }\r\n\r\n};\r\n\r\nTHREE.Mesh.prototype.getMorphTargetIndexByName = function(name) {\r\n\r\n  if (this.morphTargetDictionary[name] !== undefined) {\r\n\r\n    return this.morphTargetDictionary[name];\r\n\r\n  }\r\n\r\n  THREE.warn('THREE.Mesh.getMorphTargetIndexByName: morph target ' + name + ' does not exist. Returning 0.');\r\n\r\n  return 0;\r\n\r\n};\r\n\r\n\r\nTHREE.Mesh.prototype.raycast = (function() {\r\n\r\n  var inverseMatrix = new THREE.Matrix4();\r\n  var ray = new THREE.Ray();\r\n  var sphere = new THREE.Sphere();\r\n\r\n  var vA = new THREE.Vector3();\r\n  var vB = new THREE.Vector3();\r\n  var vC = new THREE.Vector3();\r\n\r\n  return function(raycaster, intersects) {\r\n\r\n    var geometry = this.geometry;\r\n\r\n    // Checking boundingSphere distance to ray\r\n\r\n    if (geometry.boundingSphere === null) geometry.computeBoundingSphere();\r\n\r\n    sphere.copy(geometry.boundingSphere);\r\n    sphere.applyMatrix4(this.matrixWorld);\r\n\r\n    if (raycaster.ray.isIntersectionSphere(sphere) === false) {\r\n\r\n      return;\r\n\r\n    }\r\n\r\n    // Check boundingBox before continuing\r\n\r\n    inverseMatrix.getInverse(this.matrixWorld);\r\n    ray.copy(raycaster.ray).applyMatrix4(inverseMatrix);\r\n\r\n    if (geometry.boundingBox !== null) {\r\n\r\n      if (ray.isIntersectionBox(geometry.boundingBox) === false) {\r\n\r\n        return;\r\n\r\n      }\r\n\r\n    }\r\n\r\n    if (geometry instanceof THREE.BufferGeometry) {\r\n\r\n      var material = this.material;\r\n\r\n      if (material === undefined) return;\r\n\r\n      var attributes = geometry.attributes;\r\n\r\n      var a, b, c;\r\n      var precision = raycaster.precision;\r\n\r\n      if (attributes.index !== undefined) {\r\n\r\n        var indices = attributes.index.array;\r\n        var positions = attributes.position.array;\r\n        var offsets = geometry.offsets;\r\n\r\n        if (offsets.length === 0) {\r\n\r\n          offsets = [{\r\n            start: 0,\r\n            count: indices.length,\r\n            index: 0\r\n          }];\r\n\r\n        }\r\n\r\n        for (var oi = 0, ol = offsets.length; oi < ol; ++oi) {\r\n\r\n          var start = offsets[oi].start;\r\n          var count = offsets[oi].count;\r\n          var index = offsets[oi].index;\r\n\r\n          for (var i = start, il = start + count; i < il; i += 3) {\r\n\r\n            a = index + indices[i];\r\n            b = index + indices[i + 1];\r\n            c = index + indices[i + 2];\r\n\r\n            vA.fromArray(positions, a * 3);\r\n            vB.fromArray(positions, b * 3);\r\n            vC.fromArray(positions, c * 3);\r\n\r\n            if (material.side === THREE.BackSide) {\r\n\r\n              var intersectionPoint = ray.intersectTriangle(vC, vB, vA, true);\r\n\r\n            }\r\n            else {\r\n\r\n              var intersectionPoint = ray.intersectTriangle(vA, vB, vC, material.side !== THREE.DoubleSide);\r\n\r\n            }\r\n\r\n            if (intersectionPoint === null) continue;\r\n\r\n            intersectionPoint.applyMatrix4(this.matrixWorld);\r\n\r\n            var distance = raycaster.ray.origin.distanceTo(intersectionPoint);\r\n\r\n            if (distance < precision || distance < raycaster.near || distance > raycaster.far) continue;\r\n\r\n            intersects.push({\r\n\r\n              distance: distance,\r\n              point: intersectionPoint,\r\n              face: new THREE.Face3(a, b, c, THREE.Triangle.normal(vA, vB, vC)),\r\n              faceIndex: null,\r\n              object: this\r\n\r\n            });\r\n\r\n          }\r\n\r\n        }\r\n\r\n      }\r\n      else {\r\n\r\n        var positions = attributes.position.array;\r\n\r\n        for (var i = 0, j = 0, il = positions.length; i < il; i += 3, j += 9) {\r\n\r\n          a = i;\r\n          b = i + 1;\r\n          c = i + 2;\r\n\r\n          vA.fromArray(positions, j);\r\n          vB.fromArray(positions, j + 3);\r\n          vC.fromArray(positions, j + 6);\r\n\r\n          if (material.side === THREE.BackSide) {\r\n\r\n            var intersectionPoint = ray.intersectTriangle(vC, vB, vA, true);\r\n\r\n          }\r\n          else {\r\n\r\n            var intersectionPoint = ray.intersectTriangle(vA, vB, vC, material.side !== THREE.DoubleSide);\r\n\r\n          }\r\n\r\n          if (intersectionPoint === null) continue;\r\n\r\n          intersectionPoint.applyMatrix4(this.matrixWorld);\r\n\r\n          var distance = raycaster.ray.origin.distanceTo(intersectionPoint);\r\n\r\n          if (distance < precision || distance < raycaster.near || distance > raycaster.far) continue;\r\n\r\n          intersects.push({\r\n\r\n            distance: distance,\r\n            point: intersectionPoint,\r\n            face: new THREE.Face3(a, b, c, THREE.Triangle.normal(vA, vB, vC)),\r\n            faceIndex: null,\r\n            object: this\r\n\r\n          });\r\n\r\n        }\r\n\r\n      }\r\n\r\n    }\r\n    else if (geometry instanceof THREE.Geometry) {\r\n\r\n      var isFaceMaterial = this.material instanceof THREE.MeshFaceMaterial;\r\n      var objectMaterials = isFaceMaterial === true ? this.material.materials : null;\r\n\r\n      var a, b, c;\r\n      var precision = raycaster.precision;\r\n\r\n      var vertices = geometry.vertices;\r\n\r\n      for (var f = 0, fl = geometry.faces.length; f < fl; f++) {\r\n\r\n        var face = geometry.faces[f];\r\n\r\n        var material = isFaceMaterial === true ? objectMaterials[face.materialIndex] : this.material;\r\n\r\n        if (material === undefined) continue;\r\n\r\n        a = vertices[face.a];\r\n        b = vertices[face.b];\r\n        c = vertices[face.c];\r\n\r\n        if (material.morphTargets === true) {\r\n\r\n          var morphTargets = geometry.morphTargets;\r\n          var morphInfluences = this.morphTargetInfluences;\r\n\r\n          vA.set(0, 0, 0);\r\n          vB.set(0, 0, 0);\r\n          vC.set(0, 0, 0);\r\n\r\n          for (var t = 0, tl = morphTargets.length; t < tl; t++) {\r\n\r\n            var influence = morphInfluences[t];\r\n\r\n            if (influence === 0) continue;\r\n\r\n            var targets = morphTargets[t].vertices;\r\n\r\n            vA.x += (targets[face.a].x - a.x) * influence;\r\n            vA.y += (targets[face.a].y - a.y) * influence;\r\n            vA.z += (targets[face.a].z - a.z) * influence;\r\n\r\n            vB.x += (targets[face.b].x - b.x) * influence;\r\n            vB.y += (targets[face.b].y - b.y) * influence;\r\n            vB.z += (targets[face.b].z - b.z) * influence;\r\n\r\n            vC.x += (targets[face.c].x - c.x) * influence;\r\n            vC.y += (targets[face.c].y - c.y) * influence;\r\n            vC.z += (targets[face.c].z - c.z) * influence;\r\n\r\n          }\r\n\r\n          vA.add(a);\r\n          vB.add(b);\r\n          vC.add(c);\r\n\r\n          a = vA;\r\n          b = vB;\r\n          c = vC;\r\n\r\n        }\r\n\r\n        if (material.side === THREE.BackSide) {\r\n\r\n          var intersectionPoint = ray.intersectTriangle(c, b, a, true);\r\n\r\n        }\r\n        else {\r\n\r\n          var intersectionPoint = ray.intersectTriangle(a, b, c, material.side !== THREE.DoubleSide);\r\n\r\n        }\r\n\r\n        if (intersectionPoint === null) continue;\r\n\r\n        intersectionPoint.applyMatrix4(this.matrixWorld);\r\n\r\n        var distance = raycaster.ray.origin.distanceTo(intersectionPoint);\r\n\r\n        if (distance < precision || distance < raycaster.near || distance > raycaster.far) continue;\r\n\r\n        intersects.push({\r\n\r\n          distance: distance,\r\n          point: intersectionPoint,\r\n          face: face,\r\n          faceIndex: f,\r\n          object: this\r\n\r\n        });\r\n\r\n      }\r\n\r\n    }\r\n\r\n  };\r\n\r\n}());\r\n\r\nTHREE.Mesh.prototype.clone = function(object, recursive) {\r\n\r\n  if (object === undefined) object = new THREE.Mesh(this.geometry, this.material);\r\n\r\n  THREE.Object3D.prototype.clone.call(this, object, recursive);\r\n\r\n  return object;\r\n\r\n};\r\n\r\n// File:src/objects/Bone.js\r\n\r\n/**\r\n * @author mikael emtinger / http://gomo.se/\r\n * @author alteredq / http://alteredqualia.com/\r\n * @author ikerr / http://verold.com\r\n */\r\n\r\nTHREE.Bone = function(skin) {\r\n\r\n  THREE.Object3D.call(this);\r\n\r\n  this.type = 'Bone';\r\n\r\n  this.skin = skin;\r\n\r\n};\r\n\r\nTHREE.Bone.prototype = Object.create(THREE.Object3D.prototype);\r\nTHREE.Bone.prototype.constructor = THREE.Bone;\r\n\r\n// File:src/objects/Skeleton.js\r\n\r\n/**\r\n * @author mikael emtinger / http://gomo.se/\r\n * @author alteredq / http://alteredqualia.com/\r\n * @author michael guerrero / http://realitymeltdown.com\r\n * @author ikerr / http://verold.com\r\n */\r\n\r\nTHREE.Skeleton = function(bones, boneInverses, useVertexTexture) {\r\n\r\n  this.useVertexTexture = useVertexTexture !== undefined ? useVertexTexture : true;\r\n\r\n  this.identityMatrix = new THREE.Matrix4();\r\n\r\n  // copy the bone array\r\n\r\n  bones = bones || [];\r\n\r\n  this.bones = bones.slice(0);\r\n\r\n  // create a bone texture or an array of floats\r\n\r\n  if (this.useVertexTexture) {\r\n\r\n    // layout (1 matrix = 4 pixels)\r\n    //      RGBA RGBA RGBA RGBA (=> column1, column2, column3, column4)\r\n    //  with  8x8  pixel texture max   16 bones  (8 * 8  / 4)\r\n    //       16x16 pixel texture max   64 bones (16 * 16 / 4)\r\n    //       32x32 pixel texture max  256 bones (32 * 32 / 4)\r\n    //       64x64 pixel texture max 1024 bones (64 * 64 / 4)\r\n\r\n    var size;\r\n\r\n    if (this.bones.length > 256)\r\n      size = 64;\r\n    else if (this.bones.length > 64)\r\n      size = 32;\r\n    else if (this.bones.length > 16)\r\n      size = 16;\r\n    else\r\n      size = 8;\r\n\r\n    this.boneTextureWidth = size;\r\n    this.boneTextureHeight = size;\r\n\r\n    this.boneMatrices = new Float32Array(this.boneTextureWidth * this.boneTextureHeight * 4); // 4 floats per RGBA pixel\r\n    this.boneTexture = new THREE.DataTexture(this.boneMatrices, this.boneTextureWidth, this.boneTextureHeight, THREE.RGBAFormat, THREE.FloatType);\r\n    this.boneTexture.minFilter = THREE.NearestFilter;\r\n    this.boneTexture.magFilter = THREE.NearestFilter;\r\n    this.boneTexture.generateMipmaps = false;\r\n    this.boneTexture.flipY = false;\r\n\r\n  }\r\n  else {\r\n\r\n    this.boneMatrices = new Float32Array(16 * this.bones.length);\r\n\r\n  }\r\n\r\n  // use the supplied bone inverses or calculate the inverses\r\n\r\n  if (boneInverses === undefined) {\r\n\r\n    this.calculateInverses();\r\n\r\n  }\r\n  else {\r\n\r\n    if (this.bones.length === boneInverses.length) {\r\n\r\n      this.boneInverses = boneInverses.slice(0);\r\n\r\n    }\r\n    else {\r\n\r\n      THREE.warn('THREE.Skeleton bonInverses is the wrong length.');\r\n\r\n      this.boneInverses = [];\r\n\r\n      for (var b = 0, bl = this.bones.length; b < bl; b++) {\r\n\r\n        this.boneInverses.push(new THREE.Matrix4());\r\n\r\n      }\r\n\r\n    }\r\n\r\n  }\r\n\r\n};\r\n\r\nTHREE.Skeleton.prototype.calculateInverses = function() {\r\n\r\n  this.boneInverses = [];\r\n\r\n  for (var b = 0, bl = this.bones.length; b < bl; b++) {\r\n\r\n    var inverse = new THREE.Matrix4();\r\n\r\n    if (this.bones[b]) {\r\n\r\n      inverse.getInverse(this.bones[b].matrixWorld);\r\n\r\n    }\r\n\r\n    this.boneInverses.push(inverse);\r\n\r\n  }\r\n\r\n};\r\n\r\nTHREE.Skeleton.prototype.pose = function() {\r\n\r\n  var bone;\r\n\r\n  // recover the bind-time world matrices\r\n\r\n  for (var b = 0, bl = this.bones.length; b < bl; b++) {\r\n\r\n    bone = this.bones[b];\r\n\r\n    if (bone) {\r\n\r\n      bone.matrixWorld.getInverse(this.boneInverses[b]);\r\n\r\n    }\r\n\r\n  }\r\n\r\n  // compute the local matrices, positions, rotations and scales\r\n\r\n  for (var b = 0, bl = this.bones.length; b < bl; b++) {\r\n\r\n    bone = this.bones[b];\r\n\r\n    if (bone) {\r\n\r\n      if (bone.parent) {\r\n\r\n        bone.matrix.getInverse(bone.parent.matrixWorld);\r\n        bone.matrix.multiply(bone.matrixWorld);\r\n\r\n      }\r\n      else {\r\n\r\n        bone.matrix.copy(bone.matrixWorld);\r\n\r\n      }\r\n\r\n      bone.matrix.decompose(bone.position, bone.quaternion, bone.scale);\r\n\r\n    }\r\n\r\n  }\r\n\r\n};\r\n\r\nTHREE.Skeleton.prototype.update = (function() {\r\n\r\n  var offsetMatrix = new THREE.Matrix4();\r\n\r\n  return function() {\r\n\r\n    // flatten bone matrices to array\r\n\r\n    for (var b = 0, bl = this.bones.length; b < bl; b++) {\r\n\r\n      // compute the offset between the current and the original transform\r\n\r\n      var matrix = this.bones[b] ? this.bones[b].matrixWorld : this.identityMatrix;\r\n\r\n      offsetMatrix.multiplyMatrices(matrix, this.boneInverses[b]);\r\n      offsetMatrix.flattenToArrayOffset(this.boneMatrices, b * 16);\r\n\r\n    }\r\n\r\n    if (this.useVertexTexture) {\r\n\r\n      this.boneTexture.needsUpdate = true;\r\n\r\n    }\r\n\r\n  };\r\n\r\n})();\r\n\r\n\r\n// File:src/objects/SkinnedMesh.js\r\n\r\n/**\r\n * @author mikael emtinger / http://gomo.se/\r\n * @author alteredq / http://alteredqualia.com/\r\n * @author ikerr / http://verold.com\r\n */\r\n\r\nTHREE.SkinnedMesh = function(geometry, material, useVertexTexture) {\r\n\r\n  THREE.Mesh.call(this, geometry, material);\r\n\r\n  this.type = 'SkinnedMesh';\r\n\r\n  this.bindMode = \"attached\";\r\n  this.bindMatrix = new THREE.Matrix4();\r\n  this.bindMatrixInverse = new THREE.Matrix4();\r\n\r\n  // init bones\r\n\r\n  // TODO: remove bone creation as there is no reason (other than\r\n  // convenience) for THREE.SkinnedMesh to do this.\r\n\r\n  var bones = [];\r\n\r\n  if (this.geometry && this.geometry.bones !== undefined) {\r\n\r\n    var bone, gbone, p, q, s;\r\n\r\n    for (var b = 0, bl = this.geometry.bones.length; b < bl; ++b) {\r\n\r\n      gbone = this.geometry.bones[b];\r\n\r\n      p = gbone.pos;\r\n      q = gbone.rotq;\r\n      s = gbone.scl;\r\n\r\n      bone = new THREE.Bone(this);\r\n      bones.push(bone);\r\n\r\n      bone.name = gbone.name;\r\n      bone.position.set(p[0], p[1], p[2]);\r\n      bone.quaternion.set(q[0], q[1], q[2], q[3]);\r\n\r\n      if (s !== undefined) {\r\n\r\n        bone.scale.set(s[0], s[1], s[2]);\r\n\r\n      }\r\n      else {\r\n\r\n        bone.scale.set(1, 1, 1);\r\n\r\n      }\r\n\r\n    }\r\n\r\n    for (var b = 0, bl = this.geometry.bones.length; b < bl; ++b) {\r\n\r\n      gbone = this.geometry.bones[b];\r\n\r\n      if (gbone.parent !== -1) {\r\n\r\n        bones[gbone.parent].add(bones[b]);\r\n\r\n      }\r\n      else {\r\n\r\n        this.add(bones[b]);\r\n\r\n      }\r\n\r\n    }\r\n\r\n  }\r\n\r\n  this.normalizeSkinWeights();\r\n\r\n  this.updateMatrixWorld(true);\r\n  this.bind(new THREE.Skeleton(bones, undefined, useVertexTexture));\r\n\r\n};\r\n\r\n\r\nTHREE.SkinnedMesh.prototype = Object.create(THREE.Mesh.prototype);\r\nTHREE.SkinnedMesh.prototype.constructor = THREE.SkinnedMesh;\r\n\r\nTHREE.SkinnedMesh.prototype.bind = function(skeleton, bindMatrix) {\r\n\r\n  this.skeleton = skeleton;\r\n\r\n  if (bindMatrix === undefined) {\r\n\r\n    this.updateMatrixWorld(true);\r\n\r\n    bindMatrix = this.matrixWorld;\r\n\r\n  }\r\n\r\n  this.bindMatrix.copy(bindMatrix);\r\n  this.bindMatrixInverse.getInverse(bindMatrix);\r\n\r\n};\r\n\r\nTHREE.SkinnedMesh.prototype.pose = function() {\r\n\r\n  this.skeleton.pose();\r\n\r\n};\r\n\r\nTHREE.SkinnedMesh.prototype.normalizeSkinWeights = function() {\r\n\r\n  if (this.geometry instanceof THREE.Geometry) {\r\n\r\n    for (var i = 0; i < this.geometry.skinIndices.length; i++) {\r\n\r\n      var sw = this.geometry.skinWeights[i];\r\n\r\n      var scale = 1.0 / sw.lengthManhattan();\r\n\r\n      if (scale !== Infinity) {\r\n\r\n        sw.multiplyScalar(scale);\r\n\r\n      }\r\n      else {\r\n\r\n        sw.set(1); // this will be normalized by the shader anyway\r\n\r\n      }\r\n\r\n    }\r\n\r\n  }\r\n  else {\r\n\r\n    // skinning weights assumed to be normalized for THREE.BufferGeometry\r\n\r\n  }\r\n\r\n};\r\n\r\nTHREE.SkinnedMesh.prototype.updateMatrixWorld = function(force) {\r\n\r\n  THREE.Mesh.prototype.updateMatrixWorld.call(this, true);\r\n\r\n  if (this.bindMode === \"attached\") {\r\n\r\n    this.bindMatrixInverse.getInverse(this.matrixWorld);\r\n\r\n  }\r\n  else if (this.bindMode === \"detached\") {\r\n\r\n    this.bindMatrixInverse.getInverse(this.bindMatrix);\r\n\r\n  }\r\n  else {\r\n\r\n    THREE.warn('THREE.SkinnedMesh unreckognized bindMode: ' + this.bindMode);\r\n\r\n  }\r\n\r\n};\r\n\r\nTHREE.SkinnedMesh.prototype.clone = function(object) {\r\n\r\n  if (object === undefined) {\r\n\r\n    object = new THREE.SkinnedMesh(this.geometry, this.material, this.useVertexTexture);\r\n\r\n  }\r\n\r\n  THREE.Mesh.prototype.clone.call(this, object);\r\n\r\n  return object;\r\n\r\n};\r\n\r\n\r\n// File:src/objects/MorphAnimMesh.js\r\n\r\n/**\r\n * @author alteredq / http://alteredqualia.com/\r\n */\r\n\r\nTHREE.MorphAnimMesh = function(geometry, material) {\r\n\r\n  THREE.Mesh.call(this, geometry, material);\r\n\r\n  this.type = 'MorphAnimMesh';\r\n\r\n  // API\r\n\r\n  this.duration = 1000; // milliseconds\r\n  this.mirroredLoop = false;\r\n  this.time = 0;\r\n\r\n  // internals\r\n\r\n  this.lastKeyframe = 0;\r\n  this.currentKeyframe = 0;\r\n\r\n  this.direction = 1;\r\n  this.directionBackwards = false;\r\n\r\n  this.setFrameRange(0, this.geometry.morphTargets.length - 1);\r\n\r\n};\r\n\r\nTHREE.MorphAnimMesh.prototype = Object.create(THREE.Mesh.prototype);\r\nTHREE.MorphAnimMesh.prototype.constructor = THREE.MorphAnimMesh;\r\n\r\nTHREE.MorphAnimMesh.prototype.setFrameRange = function(start, end) {\r\n\r\n  this.startKeyframe = start;\r\n  this.endKeyframe = end;\r\n\r\n  this.length = this.endKeyframe - this.startKeyframe + 1;\r\n\r\n};\r\n\r\nTHREE.MorphAnimMesh.prototype.setDirectionForward = function() {\r\n\r\n  this.direction = 1;\r\n  this.directionBackwards = false;\r\n\r\n};\r\n\r\nTHREE.MorphAnimMesh.prototype.setDirectionBackward = function() {\r\n\r\n  this.direction = -1;\r\n  this.directionBackwards = true;\r\n\r\n};\r\n\r\nTHREE.MorphAnimMesh.prototype.parseAnimations = function() {\r\n\r\n  var geometry = this.geometry;\r\n\r\n  if (!geometry.animations) geometry.animations = {};\r\n\r\n  var firstAnimation, animations = geometry.animations;\r\n\r\n  var pattern = /([a-z]+)_?(\\d+)/;\r\n\r\n  for (var i = 0, il = geometry.morphTargets.length; i < il; i++) {\r\n\r\n    var morph = geometry.morphTargets[i];\r\n    var parts = morph.name.match(pattern);\r\n\r\n    if (parts && parts.length > 1) {\r\n\r\n      var label = parts[1];\r\n\r\n      if (!animations[label]) animations[label] = {\r\n        start: Infinity,\r\n        end: -Infinity\r\n      };\r\n\r\n      var animation = animations[label];\r\n\r\n      if (i < animation.start) animation.start = i;\r\n      if (i > animation.end) animation.end = i;\r\n\r\n      if (!firstAnimation) firstAnimation = label;\r\n\r\n    }\r\n\r\n  }\r\n\r\n  geometry.firstAnimation = firstAnimation;\r\n\r\n};\r\n\r\nTHREE.MorphAnimMesh.prototype.setAnimationLabel = function(label, start, end) {\r\n\r\n  if (!this.geometry.animations) this.geometry.animations = {};\r\n\r\n  this.geometry.animations[label] = {\r\n    start: start,\r\n    end: end\r\n  };\r\n\r\n};\r\n\r\nTHREE.MorphAnimMesh.prototype.playAnimation = function(label, fps) {\r\n\r\n  var animation = this.geometry.animations[label];\r\n\r\n  if (animation) {\r\n\r\n    this.setFrameRange(animation.start, animation.end);\r\n    this.duration = 1000 * ((animation.end - animation.start) / fps);\r\n    this.time = 0;\r\n\r\n  }\r\n  else {\r\n\r\n    THREE.warn('THREE.MorphAnimMesh: animation[' + label + '] undefined in .playAnimation()');\r\n\r\n  }\r\n\r\n};\r\n\r\nTHREE.MorphAnimMesh.prototype.updateAnimation = function(delta) {\r\n\r\n  var frameTime = this.duration / this.length;\r\n\r\n  this.time += this.direction * delta;\r\n\r\n  if (this.mirroredLoop) {\r\n\r\n    if (this.time > this.duration || this.time < 0) {\r\n\r\n      this.direction *= -1;\r\n\r\n      if (this.time > this.duration) {\r\n\r\n        this.time = this.duration;\r\n        this.directionBackwards = true;\r\n\r\n      }\r\n\r\n      if (this.time < 0) {\r\n\r\n        this.time = 0;\r\n        this.directionBackwards = false;\r\n\r\n      }\r\n\r\n    }\r\n\r\n  }\r\n  else {\r\n\r\n    this.time = this.time % this.duration;\r\n\r\n    if (this.time < 0) this.time += this.duration;\r\n\r\n  }\r\n\r\n  var keyframe = this.startKeyframe + THREE.Math.clamp(Math.floor(this.time / frameTime), 0, this.length - 1);\r\n\r\n  if (keyframe !== this.currentKeyframe) {\r\n\r\n    this.morphTargetInfluences[this.lastKeyframe] = 0;\r\n    this.morphTargetInfluences[this.currentKeyframe] = 1;\r\n\r\n    this.morphTargetInfluences[keyframe] = 0;\r\n\r\n    this.lastKeyframe = this.currentKeyframe;\r\n    this.currentKeyframe = keyframe;\r\n\r\n  }\r\n\r\n  var mix = (this.time % frameTime) / frameTime;\r\n\r\n  if (this.directionBackwards) {\r\n\r\n    mix = 1 - mix;\r\n\r\n  }\r\n\r\n  this.morphTargetInfluences[this.currentKeyframe] = mix;\r\n  this.morphTargetInfluences[this.lastKeyframe] = 1 - mix;\r\n\r\n};\r\n\r\nTHREE.MorphAnimMesh.prototype.interpolateTargets = function(a, b, t) {\r\n\r\n  var influences = this.morphTargetInfluences;\r\n\r\n  for (var i = 0, l = influences.length; i < l; i++) {\r\n\r\n    influences[i] = 0;\r\n\r\n  }\r\n\r\n  if (a > -1) influences[a] = 1 - t;\r\n  if (b > -1) influences[b] = t;\r\n\r\n};\r\n\r\nTHREE.MorphAnimMesh.prototype.clone = function(object) {\r\n\r\n  if (object === undefined) object = new THREE.MorphAnimMesh(this.geometry, this.material);\r\n\r\n  object.duration = this.duration;\r\n  object.mirroredLoop = this.mirroredLoop;\r\n  object.time = this.time;\r\n\r\n  object.lastKeyframe = this.lastKeyframe;\r\n  object.currentKeyframe = this.currentKeyframe;\r\n\r\n  object.direction = this.direction;\r\n  object.directionBackwards = this.directionBackwards;\r\n\r\n  THREE.Mesh.prototype.clone.call(this, object);\r\n\r\n  return object;\r\n\r\n};\r\n\r\n// File:src/objects/LOD.js\r\n\r\n/**\r\n * @author mikael emtinger / http://gomo.se/\r\n * @author alteredq / http://alteredqualia.com/\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.LOD = function() {\r\n\r\n  THREE.Object3D.call(this);\r\n\r\n  this.objects = [];\r\n\r\n};\r\n\r\n\r\nTHREE.LOD.prototype = Object.create(THREE.Object3D.prototype);\r\nTHREE.LOD.prototype.constructor = THREE.LOD;\r\n\r\nTHREE.LOD.prototype.addLevel = function(object, distance) {\r\n\r\n  if (distance === undefined) distance = 0;\r\n\r\n  distance = Math.abs(distance);\r\n\r\n  for (var l = 0; l < this.objects.length; l++) {\r\n\r\n    if (distance < this.objects[l].distance) {\r\n\r\n      break;\r\n\r\n    }\r\n\r\n  }\r\n\r\n  this.objects.splice(l, 0, {\r\n    distance: distance,\r\n    object: object\r\n  });\r\n  this.add(object);\r\n\r\n};\r\n\r\nTHREE.LOD.prototype.getObjectForDistance = function(distance) {\r\n\r\n  for (var i = 1, l = this.objects.length; i < l; i++) {\r\n\r\n    if (distance < this.objects[i].distance) {\r\n\r\n      break;\r\n\r\n    }\r\n\r\n  }\r\n\r\n  return this.objects[i - 1].object;\r\n\r\n};\r\n\r\nTHREE.LOD.prototype.raycast = (function() {\r\n\r\n  var matrixPosition = new THREE.Vector3();\r\n\r\n  return function(raycaster, intersects) {\r\n\r\n    matrixPosition.setFromMatrixPosition(this.matrixWorld);\r\n\r\n    var distance = raycaster.ray.origin.distanceTo(matrixPosition);\r\n\r\n    this.getObjectForDistance(distance).raycast(raycaster, intersects);\r\n\r\n  };\r\n\r\n}());\r\n\r\nTHREE.LOD.prototype.update = function() {\r\n\r\n  var v1 = new THREE.Vector3();\r\n  var v2 = new THREE.Vector3();\r\n\r\n  return function(camera) {\r\n\r\n    if (this.objects.length > 1) {\r\n\r\n      v1.setFromMatrixPosition(camera.matrixWorld);\r\n      v2.setFromMatrixPosition(this.matrixWorld);\r\n\r\n      var distance = v1.distanceTo(v2);\r\n\r\n      this.objects[0].object.visible = true;\r\n\r\n      for (var i = 1, l = this.objects.length; i < l; i++) {\r\n\r\n        if (distance >= this.objects[i].distance) {\r\n\r\n          this.objects[i - 1].object.visible = false;\r\n          this.objects[i].object.visible = true;\r\n\r\n        }\r\n        else {\r\n\r\n          break;\r\n\r\n        }\r\n\r\n      }\r\n\r\n      for (; i < l; i++) {\r\n\r\n        this.objects[i].object.visible = false;\r\n\r\n      }\r\n\r\n    }\r\n\r\n  };\r\n\r\n}();\r\n\r\nTHREE.LOD.prototype.clone = function(object) {\r\n\r\n  if (object === undefined) object = new THREE.LOD();\r\n\r\n  THREE.Object3D.prototype.clone.call(this, object);\r\n\r\n  for (var i = 0, l = this.objects.length; i < l; i++) {\r\n    var x = this.objects[i].object.clone();\r\n    x.visible = i === 0;\r\n    object.addLevel(x, this.objects[i].distance);\r\n  }\r\n\r\n  return object;\r\n\r\n};\r\n\r\n// File:src/objects/Sprite.js\r\n\r\n/**\r\n * @author mikael emtinger / http://gomo.se/\r\n * @author alteredq / http://alteredqualia.com/\r\n */\r\n\r\nTHREE.Sprite = (function() {\r\n\r\n  var indices = new Uint16Array([0, 1, 2, 0, 2, 3]);\r\n  var vertices = new Float32Array([-0.5, -0.5, 0, 0.5, -0.5, 0, 0.5, 0.5, 0, -0.5, 0.5, 0]);\r\n  var uvs = new Float32Array([0, 0, 1, 0, 1, 1, 0, 1]);\r\n\r\n  var geometry = new THREE.BufferGeometry();\r\n  geometry.addAttribute('index', new THREE.BufferAttribute(indices, 1));\r\n  geometry.addAttribute('position', new THREE.BufferAttribute(vertices, 3));\r\n  geometry.addAttribute('uv', new THREE.BufferAttribute(uvs, 2));\r\n\r\n  return function(material) {\r\n\r\n    THREE.Object3D.call(this);\r\n\r\n    this.type = 'Sprite';\r\n\r\n    this.geometry = geometry;\r\n    this.material = (material !== undefined) ? material : new THREE.SpriteMaterial();\r\n\r\n  };\r\n\r\n})();\r\n\r\nTHREE.Sprite.prototype = Object.create(THREE.Object3D.prototype);\r\nTHREE.Sprite.prototype.constructor = THREE.Sprite;\r\n\r\nTHREE.Sprite.prototype.raycast = (function() {\r\n\r\n  var matrixPosition = new THREE.Vector3();\r\n\r\n  return function(raycaster, intersects) {\r\n\r\n    matrixPosition.setFromMatrixPosition(this.matrixWorld);\r\n\r\n    var distance = raycaster.ray.distanceToPoint(matrixPosition);\r\n\r\n    if (distance > this.scale.x) {\r\n\r\n      return;\r\n\r\n    }\r\n\r\n    intersects.push({\r\n\r\n      distance: distance,\r\n      point: this.position,\r\n      face: null,\r\n      object: this\r\n\r\n    });\r\n\r\n  };\r\n\r\n}());\r\n\r\nTHREE.Sprite.prototype.clone = function(object) {\r\n\r\n  if (object === undefined) object = new THREE.Sprite(this.material);\r\n\r\n  THREE.Object3D.prototype.clone.call(this, object);\r\n\r\n  return object;\r\n\r\n};\r\n\r\n// Backwards compatibility\r\n\r\nTHREE.Particle = THREE.Sprite;\r\n\r\n// File:src/objects/LensFlare.js\r\n\r\n/**\r\n * @author mikael emtinger / http://gomo.se/\r\n * @author alteredq / http://alteredqualia.com/\r\n */\r\n\r\nTHREE.LensFlare = function(texture, size, distance, blending, color) {\r\n\r\n  THREE.Object3D.call(this);\r\n\r\n  this.lensFlares = [];\r\n\r\n  this.positionScreen = new THREE.Vector3();\r\n  this.customUpdateCallback = undefined;\r\n\r\n  if (texture !== undefined) {\r\n\r\n    this.add(texture, size, distance, blending, color);\r\n\r\n  }\r\n\r\n};\r\n\r\nTHREE.LensFlare.prototype = Object.create(THREE.Object3D.prototype);\r\nTHREE.LensFlare.prototype.constructor = THREE.LensFlare;\r\n\r\n\r\n/*\r\n * Add: adds another flare\r\n */\r\n\r\nTHREE.LensFlare.prototype.add = function(texture, size, distance, blending, color, opacity) {\r\n\r\n  if (size === undefined) size = -1;\r\n  if (distance === undefined) distance = 0;\r\n  if (opacity === undefined) opacity = 1;\r\n  if (color === undefined) color = new THREE.Color(0xffffff);\r\n  if (blending === undefined) blending = THREE.NormalBlending;\r\n\r\n  distance = Math.min(distance, Math.max(0, distance));\r\n\r\n  this.lensFlares.push({\r\n    texture: texture, // THREE.Texture\r\n    size: size, // size in pixels (-1 = use texture.width)\r\n    distance: distance, // distance (0-1) from light source (0=at light source)\r\n    x: 0,\r\n    y: 0,\r\n    z: 0, // screen position (-1 => 1) z = 0 is ontop z = 1 is back\r\n    scale: 1, // scale\r\n    rotation: 1, // rotation\r\n    opacity: opacity, // opacity\r\n    color: color, // color\r\n    blending: blending // blending\r\n  });\r\n\r\n};\r\n\r\n/*\r\n * Update lens flares update positions on all flares based on the screen position\r\n * Set myLensFlare.customUpdateCallback to alter the flares in your project specific way.\r\n */\r\n\r\nTHREE.LensFlare.prototype.updateLensFlares = function() {\r\n\r\n  var f, fl = this.lensFlares.length;\r\n  var flare;\r\n  var vecX = -this.positionScreen.x * 2;\r\n  var vecY = -this.positionScreen.y * 2;\r\n\r\n  for (f = 0; f < fl; f++) {\r\n\r\n    flare = this.lensFlares[f];\r\n\r\n    flare.x = this.positionScreen.x + vecX * flare.distance;\r\n    flare.y = this.positionScreen.y + vecY * flare.distance;\r\n\r\n    flare.wantedRotation = flare.x * Math.PI * 0.25;\r\n    flare.rotation += (flare.wantedRotation - flare.rotation) * 0.25;\r\n\r\n  }\r\n\r\n};\r\n\r\n\r\n// File:src/scenes/Scene.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.Scene = function() {\r\n\r\n  THREE.Object3D.call(this);\r\n\r\n  this.type = 'Scene';\r\n\r\n  this.fog = null;\r\n  this.overrideMaterial = null;\r\n\r\n  this.autoUpdate = true; // checked by the renderer\r\n\r\n};\r\n\r\nTHREE.Scene.prototype = Object.create(THREE.Object3D.prototype);\r\nTHREE.Scene.prototype.constructor = THREE.Scene;\r\n\r\nTHREE.Scene.prototype.clone = function(object) {\r\n\r\n  if (object === undefined) object = new THREE.Scene();\r\n\r\n  THREE.Object3D.prototype.clone.call(this, object);\r\n\r\n  if (this.fog !== null) object.fog = this.fog.clone();\r\n  if (this.overrideMaterial !== null) object.overrideMaterial = this.overrideMaterial.clone();\r\n\r\n  object.autoUpdate = this.autoUpdate;\r\n  object.matrixAutoUpdate = this.matrixAutoUpdate;\r\n\r\n  return object;\r\n\r\n};\r\n\r\n// File:src/scenes/Fog.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author alteredq / http://alteredqualia.com/\r\n */\r\n\r\nTHREE.Fog = function(color, near, far) {\r\n\r\n  this.name = '';\r\n\r\n  this.color = new THREE.Color(color);\r\n\r\n  this.near = (near !== undefined) ? near : 1;\r\n  this.far = (far !== undefined) ? far : 1000;\r\n\r\n};\r\n\r\nTHREE.Fog.prototype.clone = function() {\r\n\r\n  return new THREE.Fog(this.color.getHex(), this.near, this.far);\r\n\r\n};\r\n\r\n// File:src/scenes/FogExp2.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author alteredq / http://alteredqualia.com/\r\n */\r\n\r\nTHREE.FogExp2 = function(color, density) {\r\n\r\n  this.name = '';\r\n\r\n  this.color = new THREE.Color(color);\r\n  this.density = (density !== undefined) ? density : 0.00025;\r\n\r\n};\r\n\r\nTHREE.FogExp2.prototype.clone = function() {\r\n\r\n  return new THREE.FogExp2(this.color.getHex(), this.density);\r\n\r\n};\r\n\r\n// File:src/renderers/shaders/ShaderChunk.js\r\n\r\nTHREE.ShaderChunk = {};\r\n\r\n// File:src/renderers/shaders/ShaderChunk/common.glsl\r\n\r\nTHREE.ShaderChunk['common'] = \"#define PI 3.14159\\n#define PI2 6.28318\\n#define RECIPROCAL_PI2 0.15915494\\n#define LOG2 1.442695\\n#define EPSILON 1e-6\\n\\nfloat square( in float a ) { return a*a; }\\nvec2  square( in vec2 a )  { return vec2( a.x*a.x, a.y*a.y ); }\\nvec3  square( in vec3 a )  { return vec3( a.x*a.x, a.y*a.y, a.z*a.z ); }\\nvec4  square( in vec4 a )  { return vec4( a.x*a.x, a.y*a.y, a.z*a.z, a.w*a.w ); }\\nfloat saturate( in float a ) { return clamp( a, 0.0, 1.0 ); }\\nvec2  saturate( in vec2 a )  { return clamp( a, 0.0, 1.0 ); }\\nvec3  saturate( in vec3 a )  { return clamp( a, 0.0, 1.0 ); }\\nvec4  saturate( in vec4 a )  { return clamp( a, 0.0, 1.0 ); }\\nfloat average( in float a ) { return a; }\\nfloat average( in vec2 a )  { return ( a.x + a.y) * 0.5; }\\nfloat average( in vec3 a )  { return ( a.x + a.y + a.z) / 3.0; }\\nfloat average( in vec4 a )  { return ( a.x + a.y + a.z + a.w) * 0.25; }\\nfloat whiteCompliment( in float a ) { return saturate( 1.0 - a ); }\\nvec2  whiteCompliment( in vec2 a )  { return saturate( vec2(1.0) - a ); }\\nvec3  whiteCompliment( in vec3 a )  { return saturate( vec3(1.0) - a ); }\\nvec4  whiteCompliment( in vec4 a )  { return saturate( vec4(1.0) - a ); }\\nvec3 transformDirection( in vec3 normal, in mat4 matrix ) {\\n\treturn normalize( ( matrix * vec4( normal, 0.0 ) ).xyz );\\n}\\n// http://en.wikibooks.org/wiki/GLSL_Programming/Applying_Matrix_Transformations\\nvec3 inverseTransformDirection( in vec3 normal, in mat4 matrix ) {\\n\treturn normalize( ( vec4( normal, 0.0 ) * matrix ).xyz );\\n}\\nvec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal) {\\n\tfloat distance = dot( planeNormal, point-pointOnPlane );\\n\treturn point - distance * planeNormal;\\n}\\nfloat sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\\n\treturn sign( dot( point - pointOnPlane, planeNormal ) );\\n}\\nvec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {\\n\treturn pointOnLine + lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) );\\n}\\nfloat calcLightAttenuation( float lightDistance, float cutoffDistance, float decayExponent ) {\\n\tif ( decayExponent > 0.0 ) {\\n\t  return pow( saturate( 1.0 - lightDistance / cutoffDistance ), decayExponent );\\n\t}\\n\treturn 1.0;\\n}\\n\\nvec3 inputToLinear( in vec3 a ) {\\n#ifdef GAMMA_INPUT\\n\treturn pow( a, vec3( float( GAMMA_FACTOR ) ) );\\n#else\\n\treturn a;\\n#endif\\n}\\nvec3 linearToOutput( in vec3 a ) {\\n#ifdef GAMMA_OUTPUT\\n\treturn pow( a, vec3( 1.0 / float( GAMMA_FACTOR ) ) );\\n#else\\n\treturn a;\\n#endif\\n}\\n\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/alphatest_fragment.glsl\r\n\r\nTHREE.ShaderChunk['alphatest_fragment'] = \"#ifdef ALPHATEST\\n\\n\tif ( diffuseColor.a < ALPHATEST ) discard;\\n\\n#endif\\n\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/lights_lambert_vertex.glsl\r\n\r\nTHREE.ShaderChunk['lights_lambert_vertex'] = \"vLightFront = vec3( 0.0 );\\n\\n#ifdef DOUBLE_SIDED\\n\\n\tvLightBack = vec3( 0.0 );\\n\\n#endif\\n\\ntransformedNormal = normalize( transformedNormal );\\n\\n#if MAX_DIR_LIGHTS > 0\\n\\nfor( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {\\n\\n\tvec3 dirVector = transformDirection( directionalLightDirection[ i ], viewMatrix );\\n\\n\tfloat dotProduct = dot( transformedNormal, dirVector );\\n\tvec3 directionalLightWeighting = vec3( max( dotProduct, 0.0 ) );\\n\\n\t#ifdef DOUBLE_SIDED\\n\\n\t\tvec3 directionalLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );\\n\\n\t\t#ifdef WRAP_AROUND\\n\\n\t\t\tvec3 directionalLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );\\n\\n\t\t#endif\\n\\n\t#endif\\n\\n\t#ifdef WRAP_AROUND\\n\\n\t\tvec3 directionalLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );\\n\t\tdirectionalLightWeighting = mix( directionalLightWeighting, directionalLightWeightingHalf, wrapRGB );\\n\\n\t\t#ifdef DOUBLE_SIDED\\n\\n\t\t\tdirectionalLightWeightingBack = mix( directionalLightWeightingBack, directionalLightWeightingHalfBack, wrapRGB );\\n\\n\t\t#endif\\n\\n\t#endif\\n\\n\tvLightFront += directionalLightColor[ i ] * directionalLightWeighting;\\n\\n\t#ifdef DOUBLE_SIDED\\n\\n\t\tvLightBack += directionalLightColor[ i ] * directionalLightWeightingBack;\\n\\n\t#endif\\n\\n}\\n\\n#endif\\n\\n#if MAX_POINT_LIGHTS > 0\\n\\n\tfor( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\\n\\n\t\tvec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\\n\t\tvec3 lVector = lPosition.xyz - mvPosition.xyz;\\n\\n\t\tfloat attenuation = calcLightAttenuation( length( lVector ), pointLightDistance[ i ], pointLightDecay[ i ] );\\n\\n\t\tlVector = normalize( lVector );\\n\t\tfloat dotProduct = dot( transformedNormal, lVector );\\n\\n\t\tvec3 pointLightWeighting = vec3( max( dotProduct, 0.0 ) );\\n\\n\t\t#ifdef DOUBLE_SIDED\\n\\n\t\t\tvec3 pointLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );\\n\\n\t\t\t#ifdef WRAP_AROUND\\n\\n\t\t\t\tvec3 pointLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );\\n\\n\t\t\t#endif\\n\\n\t\t#endif\\n\\n\t\t#ifdef WRAP_AROUND\\n\\n\t\t\tvec3 pointLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );\\n\t\t\tpointLightWeighting = mix( pointLightWeighting, pointLightWeightingHalf, wrapRGB );\\n\\n\t\t\t#ifdef DOUBLE_SIDED\\n\\n\t\t\t\tpointLightWeightingBack = mix( pointLightWeightingBack, pointLightWeightingHalfBack, wrapRGB );\\n\\n\t\t\t#endif\\n\\n\t\t#endif\\n\\n\t\tvLightFront += pointLightColor[ i ] * pointLightWeighting * attenuation;\\n\\n\t\t#ifdef DOUBLE_SIDED\\n\\n\t\t\tvLightBack += pointLightColor[ i ] * pointLightWeightingBack * attenuation;\\n\\n\t\t#endif\\n\\n\t}\\n\\n#endif\\n\\n#if MAX_SPOT_LIGHTS > 0\\n\\n\tfor( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {\\n\\n\t\tvec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );\\n\t\tvec3 lVector = lPosition.xyz - mvPosition.xyz;\\n\\n\t\tfloat spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - worldPosition.xyz ) );\\n\\n\t\tif ( spotEffect > spotLightAngleCos[ i ] ) {\\n\\n\t\t\tspotEffect = max( pow( max( spotEffect, 0.0 ), spotLightExponent[ i ] ), 0.0 );\\n\\n\t\t\tfloat attenuation = calcLightAttenuation( length( lVector ), spotLightDistance[ i ], spotLightDecay[ i ] );\\n\\n\t\t\tlVector = normalize( lVector );\\n\\n\t\t\tfloat dotProduct = dot( transformedNormal, lVector );\\n\t\t\tvec3 spotLightWeighting = vec3( max( dotProduct, 0.0 ) );\\n\\n\t\t\t#ifdef DOUBLE_SIDED\\n\\n\t\t\t\tvec3 spotLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );\\n\\n\t\t\t\t#ifdef WRAP_AROUND\\n\\n\t\t\t\t\tvec3 spotLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );\\n\\n\t\t\t\t#endif\\n\\n\t\t\t#endif\\n\\n\t\t\t#ifdef WRAP_AROUND\\n\\n\t\t\t\tvec3 spotLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );\\n\t\t\t\tspotLightWeighting = mix( spotLightWeighting, spotLightWeightingHalf, wrapRGB );\\n\\n\t\t\t\t#ifdef DOUBLE_SIDED\\n\\n\t\t\t\t\tspotLightWeightingBack = mix( spotLightWeightingBack, spotLightWeightingHalfBack, wrapRGB );\\n\\n\t\t\t\t#endif\\n\\n\t\t\t#endif\\n\\n\t\t\tvLightFront += spotLightColor[ i ] * spotLightWeighting * attenuation * spotEffect;\\n\\n\t\t\t#ifdef DOUBLE_SIDED\\n\\n\t\t\t\tvLightBack += spotLightColor[ i ] * spotLightWeightingBack * attenuation * spotEffect;\\n\\n\t\t\t#endif\\n\\n\t\t}\\n\\n\t}\\n\\n#endif\\n\\n#if MAX_HEMI_LIGHTS > 0\\n\\n\tfor( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {\\n\\n\t\tvec3 lVector = transformDirection( hemisphereLightDirection[ i ], viewMatrix );\\n\\n\t\tfloat dotProduct = dot( transformedNormal, lVector );\\n\\n\t\tfloat hemiDiffuseWeight = 0.5 * dotProduct + 0.5;\\n\t\tfloat hemiDiffuseWeightBack = -0.5 * dotProduct + 0.5;\\n\\n\t\tvLightFront += mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );\\n\\n\t\t#ifdef DOUBLE_SIDED\\n\\n\t\t\tvLightBack += mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeightBack );\\n\\n\t\t#endif\\n\\n\t}\\n\\n#endif\\n\\nvLightFront += ambientLightColor;\\n\\n#ifdef DOUBLE_SIDED\\n\\n\tvLightBack += ambientLightColor;\\n\\n#endif\\n\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/map_particle_pars_fragment.glsl\r\n\r\nTHREE.ShaderChunk['map_particle_pars_fragment'] = \"#ifdef USE_MAP\\n\\n\tuniform vec4 offsetRepeat;\\n\tuniform sampler2D map;\\n\\n#endif\\n\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/default_vertex.glsl\r\n\r\nTHREE.ShaderChunk['default_vertex'] = \"#ifdef USE_SKINNING\\n\\n\tvec4 mvPosition = modelViewMatrix * skinned;\\n\\n#elif defined( USE_MORPHTARGETS )\\n\\n\tvec4 mvPosition = modelViewMatrix * vec4( morphed, 1.0 );\\n\\n#else\\n\\n\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\\n\\n#endif\\n\\ngl_Position = projectionMatrix * mvPosition;\\n\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/map_pars_fragment.glsl\r\n\r\nTHREE.ShaderChunk['map_pars_fragment'] = \"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP )\\n\\n\tvarying vec2 vUv;\\n\\n#endif\\n\\n#ifdef USE_MAP\\n\\n\tuniform sampler2D map;\\n\\n#endif\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/skinnormal_vertex.glsl\r\n\r\nTHREE.ShaderChunk['skinnormal_vertex'] = \"#ifdef USE_SKINNING\\n\\n\tmat4 skinMatrix = mat4( 0.0 );\\n\tskinMatrix += skinWeight.x * boneMatX;\\n\tskinMatrix += skinWeight.y * boneMatY;\\n\tskinMatrix += skinWeight.z * boneMatZ;\\n\tskinMatrix += skinWeight.w * boneMatW;\\n\tskinMatrix  = bindMatrixInverse * skinMatrix * bindMatrix;\\n\\n\t#ifdef USE_MORPHNORMALS\\n\\n\tvec4 skinnedNormal = skinMatrix * vec4( morphedNormal, 0.0 );\\n\\n\t#else\\n\\n\tvec4 skinnedNormal = skinMatrix * vec4( normal, 0.0 );\\n\\n\t#endif\\n\\n#endif\\n\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/logdepthbuf_pars_vertex.glsl\r\n\r\nTHREE.ShaderChunk['logdepthbuf_pars_vertex'] = \"#ifdef USE_LOGDEPTHBUF\\n\\n\t#ifdef USE_LOGDEPTHBUF_EXT\\n\\n\t\tvarying float vFragDepth;\\n\\n\t#endif\\n\\n\tuniform float logDepthBufFC;\\n\\n#endif\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/lightmap_pars_vertex.glsl\r\n\r\nTHREE.ShaderChunk['lightmap_pars_vertex'] = \"#ifdef USE_LIGHTMAP\\n\\n\tvarying vec2 vUv2;\\n\\n#endif\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/lights_phong_fragment.glsl\r\n\r\nTHREE.ShaderChunk['lights_phong_fragment'] = \"#ifndef FLAT_SHADED\\n\\n\tvec3 normal = normalize( vNormal );\\n\\n\t#ifdef DOUBLE_SIDED\\n\\n\t\tnormal = normal * ( -1.0 + 2.0 * float( gl_FrontFacing ) );\\n\\n\t#endif\\n\\n#else\\n\\n\tvec3 fdx = dFdx( vViewPosition );\\n\tvec3 fdy = dFdy( vViewPosition );\\n\tvec3 normal = normalize( cross( fdx, fdy ) );\\n\\n#endif\\n\\nvec3 viewPosition = normalize( vViewPosition );\\n\\n#ifdef USE_NORMALMAP\\n\\n\tnormal = perturbNormal2Arb( -vViewPosition, normal );\\n\\n#elif defined( USE_BUMPMAP )\\n\\n\tnormal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );\\n\\n#endif\\n\\nvec3 totalDiffuseLight = vec3( 0.0 );\\nvec3 totalSpecularLight = vec3( 0.0 );\\n\\n#if MAX_POINT_LIGHTS > 0\\n\\n\tfor ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\\n\\n\t\tvec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\\n\t\tvec3 lVector = lPosition.xyz + vViewPosition.xyz;\\n\\n\t\tfloat attenuation = calcLightAttenuation( length( lVector ), pointLightDistance[ i ], pointLightDecay[ i ] );\\n\\n\t\tlVector = normalize( lVector );\\n\\n\t\t// diffuse\\n\\n\t\tfloat dotProduct = dot( normal, lVector );\\n\\n\t\t#ifdef WRAP_AROUND\\n\\n\t\t\tfloat pointDiffuseWeightFull = max( dotProduct, 0.0 );\\n\t\t\tfloat pointDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );\\n\\n\t\t\tvec3 pointDiffuseWeight = mix( vec3( pointDiffuseWeightFull ), vec3( pointDiffuseWeightHalf ), wrapRGB );\\n\\n\t\t#else\\n\\n\t\t\tfloat pointDiffuseWeight = max( dotProduct, 0.0 );\\n\\n\t\t#endif\\n\\n\t\ttotalDiffuseLight += pointLightColor[ i ] * pointDiffuseWeight * attenuation;\\n\\n\t\t\t\t// specular\\n\\n\t\tvec3 pointHalfVector = normalize( lVector + viewPosition );\\n\t\tfloat pointDotNormalHalf = max( dot( normal, pointHalfVector ), 0.0 );\\n\t\tfloat pointSpecularWeight = specularStrength * max( pow( pointDotNormalHalf, shininess ), 0.0 );\\n\\n\t\tfloat specularNormalization = ( shininess + 2.0 ) / 8.0;\\n\\n\t\tvec3 schlick = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVector, pointHalfVector ), 0.0 ), 5.0 );\\n\t\ttotalSpecularLight += schlick * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * attenuation * specularNormalization;\\n\\n\t}\\n\\n#endif\\n\\n#if MAX_SPOT_LIGHTS > 0\\n\\n\tfor ( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {\\n\\n\t\tvec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );\\n\t\tvec3 lVector = lPosition.xyz + vViewPosition.xyz;\\n\\n\t\tfloat attenuation = calcLightAttenuation( length( lVector ), spotLightDistance[ i ], spotLightDecay[ i ] );\\n\\n\t\tlVector = normalize( lVector );\\n\\n\t\tfloat spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - vWorldPosition ) );\\n\\n\t\tif ( spotEffect > spotLightAngleCos[ i ] ) {\\n\\n\t\t\tspotEffect = max( pow( max( spotEffect, 0.0 ), spotLightExponent[ i ] ), 0.0 );\\n\\n\t\t\t// diffuse\\n\\n\t\t\tfloat dotProduct = dot( normal, lVector );\\n\\n\t\t\t#ifdef WRAP_AROUND\\n\\n\t\t\t\tfloat spotDiffuseWeightFull = max( dotProduct, 0.0 );\\n\t\t\t\tfloat spotDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );\\n\\n\t\t\t\tvec3 spotDiffuseWeight = mix( vec3( spotDiffuseWeightFull ), vec3( spotDiffuseWeightHalf ), wrapRGB );\\n\\n\t\t\t#else\\n\\n\t\t\t\tfloat spotDiffuseWeight = max( dotProduct, 0.0 );\\n\\n\t\t\t#endif\\n\\n\t\t\ttotalDiffuseLight += spotLightColor[ i ] * spotDiffuseWeight * attenuation * spotEffect;\\n\\n\t\t\t// specular\\n\\n\t\t\tvec3 spotHalfVector = normalize( lVector + viewPosition );\\n\t\t\tfloat spotDotNormalHalf = max( dot( normal, spotHalfVector ), 0.0 );\\n\t\t\tfloat spotSpecularWeight = specularStrength * max( pow( spotDotNormalHalf, shininess ), 0.0 );\\n\\n\t\t\tfloat specularNormalization = ( shininess + 2.0 ) / 8.0;\\n\\n\t\t\tvec3 schlick = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVector, spotHalfVector ), 0.0 ), 5.0 );\\n\t\t\ttotalSpecularLight += schlick * spotLightColor[ i ] * spotSpecularWeight * spotDiffuseWeight * attenuation * specularNormalization * spotEffect;\\n\\n\t\t}\\n\\n\t}\\n\\n#endif\\n\\n#if MAX_DIR_LIGHTS > 0\\n\\n\tfor( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {\\n\\n\t\tvec3 dirVector = transformDirection( directionalLightDirection[ i ], viewMatrix );\\n\\n\t\t// diffuse\\n\\n\t\tfloat dotProduct = dot( normal, dirVector );\\n\\n\t\t#ifdef WRAP_AROUND\\n\\n\t\t\tfloat dirDiffuseWeightFull = max( dotProduct, 0.0 );\\n\t\t\tfloat dirDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );\\n\\n\t\t\tvec3 dirDiffuseWeight = mix( vec3( dirDiffuseWeightFull ), vec3( dirDiffuseWeightHalf ), wrapRGB );\\n\\n\t\t#else\\n\\n\t\t\tfloat dirDiffuseWeight = max( dotProduct, 0.0 );\\n\\n\t\t#endif\\n\\n\t\ttotalDiffuseLight += directionalLightColor[ i ] * dirDiffuseWeight;\\n\\n\t\t// specular\\n\\n\t\tvec3 dirHalfVector = normalize( dirVector + viewPosition );\\n\t\tfloat dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );\\n\t\tfloat dirSpecularWeight = specularStrength * max( pow( dirDotNormalHalf, shininess ), 0.0 );\\n\\n\t\t/*\\n\t\t// fresnel term from skin shader\\n\t\tconst float F0 = 0.128;\\n\\n\t\tfloat base = 1.0 - dot( viewPosition, dirHalfVector );\\n\t\tfloat exponential = pow( base, 5.0 );\\n\\n\t\tfloat fresnel = exponential + F0 * ( 1.0 - exponential );\\n\t\t*/\\n\\n\t\t/*\\n\t\t// fresnel term from fresnel shader\\n\t\tconst float mFresnelBias = 0.08;\\n\t\tconst float mFresnelScale = 0.3;\\n\t\tconst float mFresnelPower = 5.0;\\n\\n\t\tfloat fresnel = mFresnelBias + mFresnelScale * pow( 1.0 + dot( normalize( -viewPosition ), normal ), mFresnelPower );\\n\t\t*/\\n\\n\t\tfloat specularNormalization = ( shininess + 2.0 ) / 8.0;\\n\\n\t\t// \t\tdirSpecular += specular * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight * specularNormalization * fresnel;\\n\\n\t\tvec3 schlick = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( dirVector, dirHalfVector ), 0.0 ), 5.0 );\\n\t\ttotalSpecularLight += schlick * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight * specularNormalization;\\n\\n\\n\t}\\n\\n#endif\\n\\n#if MAX_HEMI_LIGHTS > 0\\n\\n\tfor( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {\\n\\n\t\tvec3 lVector = transformDirection( hemisphereLightDirection[ i ], viewMatrix );\\n\\n\t\t// diffuse\\n\\n\t\tfloat dotProduct = dot( normal, lVector );\\n\t\tfloat hemiDiffuseWeight = 0.5 * dotProduct + 0.5;\\n\\n\t\tvec3 hemiColor = mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );\\n\\n\t\ttotalDiffuseLight += hemiColor;\\n\\n\t\t// specular (sky light)\\n\\n\t\tvec3 hemiHalfVectorSky = normalize( lVector + viewPosition );\\n\t\tfloat hemiDotNormalHalfSky = 0.5 * dot( normal, hemiHalfVectorSky ) + 0.5;\\n\t\tfloat hemiSpecularWeightSky = specularStrength * max( pow( max( hemiDotNormalHalfSky, 0.0 ), shininess ), 0.0 );\\n\\n\t\t// specular (ground light)\\n\\n\t\tvec3 lVectorGround = -lVector;\\n\\n\t\tvec3 hemiHalfVectorGround = normalize( lVectorGround + viewPosition );\\n\t\tfloat hemiDotNormalHalfGround = 0.5 * dot( normal, hemiHalfVectorGround ) + 0.5;\\n\t\tfloat hemiSpecularWeightGround = specularStrength * max( pow( max( hemiDotNormalHalfGround, 0.0 ), shininess ), 0.0 );\\n\\n\t\tfloat dotProductGround = dot( normal, lVectorGround );\\n\\n\t\tfloat specularNormalization = ( shininess + 2.0 ) / 8.0;\\n\\n\t\tvec3 schlickSky = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVector, hemiHalfVectorSky ), 0.0 ), 5.0 );\\n\t\tvec3 schlickGround = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVectorGround, hemiHalfVectorGround ), 0.0 ), 5.0 );\\n\t\ttotalSpecularLight += hemiColor * specularNormalization * ( schlickSky * hemiSpecularWeightSky * max( dotProduct, 0.0 ) + schlickGround * hemiSpecularWeightGround * max( dotProductGround, 0.0 ) );\\n\\n\t}\\n\\n#endif\\n\\n#ifdef METAL\\n\\n\toutgoingLight += diffuseColor.rgb * ( totalDiffuseLight + ambientLightColor ) * specular + totalSpecularLight + emissive;\\n\\n#else\\n\\n\toutgoingLight += diffuseColor.rgb * ( totalDiffuseLight + ambientLightColor ) + totalSpecularLight + emissive;\\n\\n#endif\\n\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/fog_pars_fragment.glsl\r\n\r\nTHREE.ShaderChunk['fog_pars_fragment'] = \"#ifdef USE_FOG\\n\\n\tuniform vec3 fogColor;\\n\\n\t#ifdef FOG_EXP2\\n\\n\t\tuniform float fogDensity;\\n\\n\t#else\\n\\n\t\tuniform float fogNear;\\n\t\tuniform float fogFar;\\n\t#endif\\n\\n#endif\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/morphnormal_vertex.glsl\r\n\r\nTHREE.ShaderChunk['morphnormal_vertex'] = \"#ifdef USE_MORPHNORMALS\\n\\n\tvec3 morphedNormal = vec3( 0.0 );\\n\\n\tmorphedNormal += ( morphNormal0 - normal ) * morphTargetInfluences[ 0 ];\\n\tmorphedNormal += ( morphNormal1 - normal ) * morphTargetInfluences[ 1 ];\\n\tmorphedNormal += ( morphNormal2 - normal ) * morphTargetInfluences[ 2 ];\\n\tmorphedNormal += ( morphNormal3 - normal ) * morphTargetInfluences[ 3 ];\\n\\n\tmorphedNormal += normal;\\n\\n#endif\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/envmap_pars_fragment.glsl\r\n\r\nTHREE.ShaderChunk['envmap_pars_fragment'] = \"#ifdef USE_ENVMAP\\n\\n\tuniform float reflectivity;\\n\t#ifdef ENVMAP_TYPE_CUBE\\n\t\tuniform samplerCube envMap;\\n\t#else\\n\t\tuniform sampler2D envMap;\\n\t#endif\\n\tuniform float flipEnvMap;\\n\\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\\n\\n\t\tuniform float refractionRatio;\\n\\n\t#else\\n\\n\t\tvarying vec3 vReflect;\\n\\n\t#endif\\n\\n#endif\\n\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/logdepthbuf_fragment.glsl\r\n\r\nTHREE.ShaderChunk['logdepthbuf_fragment'] = \"#if defined(USE_LOGDEPTHBUF) && defined(USE_LOGDEPTHBUF_EXT)\\n\\n\tgl_FragDepthEXT = log2(vFragDepth) * logDepthBufFC * 0.5;\\n\\n#endif\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/normalmap_pars_fragment.glsl\r\n\r\nTHREE.ShaderChunk['normalmap_pars_fragment'] = \"#ifdef USE_NORMALMAP\\n\\n\tuniform sampler2D normalMap;\\n\tuniform vec2 normalScale;\\n\\n\t// Per-Pixel Tangent Space Normal Mapping\\n\t// http://hacksoflife.blogspot.ch/2009/11/per-pixel-tangent-space-normal-mapping.html\\n\\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm ) {\\n\\n\t\tvec3 q0 = dFdx( eye_pos.xyz );\\n\t\tvec3 q1 = dFdy( eye_pos.xyz );\\n\t\tvec2 st0 = dFdx( vUv.st );\\n\t\tvec2 st1 = dFdy( vUv.st );\\n\\n\t\tvec3 S = normalize( q0 * st1.t - q1 * st0.t );\\n\t\tvec3 T = normalize( -q0 * st1.s + q1 * st0.s );\\n\t\tvec3 N = normalize( surf_norm );\\n\\n\t\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\\n\t\tmapN.xy = normalScale * mapN.xy;\\n\t\tmat3 tsn = mat3( S, T, N );\\n\t\treturn normalize( tsn * mapN );\\n\\n\t}\\n\\n#endif\\n\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/lights_phong_pars_vertex.glsl\r\n\r\nTHREE.ShaderChunk['lights_phong_pars_vertex'] = \"#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP ) || defined( USE_ENVMAP )\\n\\n\tvarying vec3 vWorldPosition;\\n\\n#endif\\n\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/lightmap_pars_fragment.glsl\r\n\r\nTHREE.ShaderChunk['lightmap_pars_fragment'] = \"#ifdef USE_LIGHTMAP\\n\\n\tvarying vec2 vUv2;\\n\tuniform sampler2D lightMap;\\n\\n#endif\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/shadowmap_vertex.glsl\r\n\r\nTHREE.ShaderChunk['shadowmap_vertex'] = \"#ifdef USE_SHADOWMAP\\n\\n\tfor( int i = 0; i < MAX_SHADOWS; i ++ ) {\\n\\n\t\tvShadowCoord[ i ] = shadowMatrix[ i ] * worldPosition;\\n\\n\t}\\n\\n#endif\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/lights_phong_vertex.glsl\r\n\r\nTHREE.ShaderChunk['lights_phong_vertex'] = \"#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP ) || defined( USE_ENVMAP )\\n\\n\tvWorldPosition = worldPosition.xyz;\\n\\n#endif\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/map_fragment.glsl\r\n\r\nTHREE.ShaderChunk['map_fragment'] = \"#ifdef USE_MAP\\n\\n\tvec4 texelColor = texture2D( map, vUv );\\n\\n\ttexelColor.xyz = inputToLinear( texelColor.xyz );\\n\\n\tdiffuseColor *= texelColor;\\n\\n#endif\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/lightmap_vertex.glsl\r\n\r\nTHREE.ShaderChunk['lightmap_vertex'] = \"#ifdef USE_LIGHTMAP\\n\\n\tvUv2 = uv2;\\n\\n#endif\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/map_particle_fragment.glsl\r\n\r\nTHREE.ShaderChunk['map_particle_fragment'] = \"#ifdef USE_MAP\\n\\n\tdiffuseColor *= texture2D( map, vec2( gl_PointCoord.x, 1.0 - gl_PointCoord.y ) * offsetRepeat.zw + offsetRepeat.xy );\\n\\n#endif\\n\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/color_pars_fragment.glsl\r\n\r\nTHREE.ShaderChunk['color_pars_fragment'] = \"#ifdef USE_COLOR\\n\\n\tvarying vec3 vColor;\\n\\n#endif\\n\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/color_vertex.glsl\r\n\r\nTHREE.ShaderChunk['color_vertex'] = \"#ifdef USE_COLOR\\n\\n\tvColor.xyz = inputToLinear( color.xyz );\\n\\n#endif\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/skinning_vertex.glsl\r\n\r\nTHREE.ShaderChunk['skinning_vertex'] = \"#ifdef USE_SKINNING\\n\\n\t#ifdef USE_MORPHTARGETS\\n\\n\tvec4 skinVertex = bindMatrix * vec4( morphed, 1.0 );\\n\\n\t#else\\n\\n\tvec4 skinVertex = bindMatrix * vec4( position, 1.0 );\\n\\n\t#endif\\n\\n\tvec4 skinned = vec4( 0.0 );\\n\tskinned += boneMatX * skinVertex * skinWeight.x;\\n\tskinned += boneMatY * skinVertex * skinWeight.y;\\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\\n\tskinned += boneMatW * skinVertex * skinWeight.w;\\n\tskinned  = bindMatrixInverse * skinned;\\n\\n#endif\\n\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/envmap_pars_vertex.glsl\r\n\r\nTHREE.ShaderChunk['envmap_pars_vertex'] = \"#if defined( USE_ENVMAP ) && ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP ) && ! defined( PHONG )\\n\\n\tvarying vec3 vReflect;\\n\\n\tuniform float refractionRatio;\\n\\n#endif\\n\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/linear_to_gamma_fragment.glsl\r\n\r\nTHREE.ShaderChunk['linear_to_gamma_fragment'] = \"\\n\toutgoingLight = linearToOutput( outgoingLight );\\n\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/color_pars_vertex.glsl\r\n\r\nTHREE.ShaderChunk['color_pars_vertex'] = \"#ifdef USE_COLOR\\n\\n\tvarying vec3 vColor;\\n\\n#endif\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/lights_lambert_pars_vertex.glsl\r\n\r\nTHREE.ShaderChunk['lights_lambert_pars_vertex'] = \"uniform vec3 ambientLightColor;\\n\\n#if MAX_DIR_LIGHTS > 0\\n\\n\tuniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\\n\tuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\\n\\n#endif\\n\\n#if MAX_HEMI_LIGHTS > 0\\n\\n\tuniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];\\n\tuniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];\\n\tuniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];\\n\\n#endif\\n\\n#if MAX_POINT_LIGHTS > 0\\n\\n\tuniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\\n\tuniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\\n\tuniform float pointLightDistance[ MAX_POINT_LIGHTS ];\\n\tuniform float pointLightDecay[ MAX_POINT_LIGHTS ];\\n\\n#endif\\n\\n#if MAX_SPOT_LIGHTS > 0\\n\\n\tuniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];\\n\tuniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];\\n\tuniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];\\n\tuniform float spotLightDistance[ MAX_SPOT_LIGHTS ];\\n\tuniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];\\n\tuniform float spotLightExponent[ MAX_SPOT_LIGHTS ];\\n\tuniform float spotLightDecay[ MAX_SPOT_LIGHTS ];\\n\\n#endif\\n\\n#ifdef WRAP_AROUND\\n\\n\tuniform vec3 wrapRGB;\\n\\n#endif\\n\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/map_pars_vertex.glsl\r\n\r\nTHREE.ShaderChunk['map_pars_vertex'] = \"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP )\\n\\n\tvarying vec2 vUv;\\n\tuniform vec4 offsetRepeat;\\n\\n#endif\\n\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/envmap_fragment.glsl\r\n\r\nTHREE.ShaderChunk['envmap_fragment'] = \"#ifdef USE_ENVMAP\\n\\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\\n\\n\t\tvec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );\\n\\n\t\t// Transforming Normal Vectors with the Inverse Transformation\\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\\n\\n\t\t#ifdef ENVMAP_MODE_REFLECTION\\n\\n\t\t\tvec3 reflectVec = reflect( cameraToVertex, worldNormal );\\n\\n\t\t#else\\n\\n\t\t\tvec3 reflectVec = refract( cameraToVertex, worldNormal, refractionRatio );\\n\\n\t\t#endif\\n\\n\t#else\\n\\n\t\tvec3 reflectVec = vReflect;\\n\\n\t#endif\\n\\n\t#ifdef DOUBLE_SIDED\\n\t\tfloat flipNormal = ( -1.0 + 2.0 * float( gl_FrontFacing ) );\\n\t#else\\n\t\tfloat flipNormal = 1.0;\\n\t#endif\\n\\n\t#ifdef ENVMAP_TYPE_CUBE\\n\t\tvec4 envColor = textureCube( envMap, flipNormal * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\\n\\n\t#elif defined( ENVMAP_TYPE_EQUIREC )\\n\t\tvec2 sampleUV;\\n\t\tsampleUV.y = saturate( flipNormal * reflectVec.y * 0.5 + 0.5 );\\n\t\tsampleUV.x = atan( flipNormal * reflectVec.z, flipNormal * reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\\n\t\tvec4 envColor = texture2D( envMap, sampleUV );\\n\\n\t#elif defined( ENVMAP_TYPE_SPHERE )\\n\t\tvec3 reflectView = flipNormal * normalize((viewMatrix * vec4( reflectVec, 0.0 )).xyz + vec3(0.0,0.0,1.0));\\n\t\tvec4 envColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5 );\\n\t#endif\\n\\n\tenvColor.xyz = inputToLinear( envColor.xyz );\\n\\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\\n\\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\\n\\n\t#elif defined( ENVMAP_BLENDING_MIX )\\n\\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\\n\\n\t#elif defined( ENVMAP_BLENDING_ADD )\\n\\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\\n\\n\t#endif\\n\\n#endif\\n\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/specularmap_pars_fragment.glsl\r\n\r\nTHREE.ShaderChunk['specularmap_pars_fragment'] = \"#ifdef USE_SPECULARMAP\\n\\n\tuniform sampler2D specularMap;\\n\\n#endif\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/logdepthbuf_vertex.glsl\r\n\r\nTHREE.ShaderChunk['logdepthbuf_vertex'] = \"#ifdef USE_LOGDEPTHBUF\\n\\n\tgl_Position.z = log2(max( EPSILON, gl_Position.w + 1.0 )) * logDepthBufFC;\\n\\n\t#ifdef USE_LOGDEPTHBUF_EXT\\n\\n\t\tvFragDepth = 1.0 + gl_Position.w;\\n\\n#else\\n\\n\t\tgl_Position.z = (gl_Position.z - 1.0) * gl_Position.w;\\n\\n\t#endif\\n\\n#endif\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/morphtarget_pars_vertex.glsl\r\n\r\nTHREE.ShaderChunk['morphtarget_pars_vertex'] = \"#ifdef USE_MORPHTARGETS\\n\\n\t#ifndef USE_MORPHNORMALS\\n\\n\tuniform float morphTargetInfluences[ 8 ];\\n\\n\t#else\\n\\n\tuniform float morphTargetInfluences[ 4 ];\\n\\n\t#endif\\n\\n#endif\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/specularmap_fragment.glsl\r\n\r\nTHREE.ShaderChunk['specularmap_fragment'] = \"float specularStrength;\\n\\n#ifdef USE_SPECULARMAP\\n\\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\\n\tspecularStrength = texelSpecular.r;\\n\\n#else\\n\\n\tspecularStrength = 1.0;\\n\\n#endif\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/fog_fragment.glsl\r\n\r\nTHREE.ShaderChunk['fog_fragment'] = \"#ifdef USE_FOG\\n\\n\t#ifdef USE_LOGDEPTHBUF_EXT\\n\\n\t\tfloat depth = gl_FragDepthEXT / gl_FragCoord.w;\\n\\n\t#else\\n\\n\t\tfloat depth = gl_FragCoord.z / gl_FragCoord.w;\\n\\n\t#endif\\n\\n\t#ifdef FOG_EXP2\\n\\n\t\tfloat fogFactor = exp2( - square( fogDensity ) * square( depth ) * LOG2 );\\n\t\tfogFactor = whiteCompliment( fogFactor );\\n\\n\t#else\\n\\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, depth );\\n\\n\t#endif\\n\t\\n\toutgoingLight = mix( outgoingLight, fogColor, fogFactor );\\n\\n#endif\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/bumpmap_pars_fragment.glsl\r\n\r\nTHREE.ShaderChunk['bumpmap_pars_fragment'] = \"#ifdef USE_BUMPMAP\\n\\n\tuniform sampler2D bumpMap;\\n\tuniform float bumpScale;\\n\\n\t// Derivative maps - bump mapping unparametrized surfaces by Morten Mikkelsen\\n\t// http://mmikkelsen3d.blogspot.sk/2011/07/derivative-maps.html\\n\\n\t// Evaluate the derivative of the height w.r.t. screen-space using forward differencing (listing 2)\\n\\n\tvec2 dHdxy_fwd() {\\n\\n\t\tvec2 dSTdx = dFdx( vUv );\\n\t\tvec2 dSTdy = dFdy( vUv );\\n\\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\\n\\n\t\treturn vec2( dBx, dBy );\\n\\n\t}\\n\\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\\n\\n\t\tvec3 vSigmaX = dFdx( surf_pos );\\n\t\tvec3 vSigmaY = dFdy( surf_pos );\\n\t\tvec3 vN = surf_norm;\t\t// normalized\\n\\n\t\tvec3 R1 = cross( vSigmaY, vN );\\n\t\tvec3 R2 = cross( vN, vSigmaX );\\n\\n\t\tfloat fDet = dot( vSigmaX, R1 );\\n\\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\\n\\n\t}\\n\\n#endif\\n\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/defaultnormal_vertex.glsl\r\n\r\nTHREE.ShaderChunk['defaultnormal_vertex'] = \"#ifdef USE_SKINNING\\n\\n\tvec3 objectNormal = skinnedNormal.xyz;\\n\\n#elif defined( USE_MORPHNORMALS )\\n\\n\tvec3 objectNormal = morphedNormal;\\n\\n#else\\n\\n\tvec3 objectNormal = normal;\\n\\n#endif\\n\\n#ifdef FLIP_SIDED\\n\\n\tobjectNormal = -objectNormal;\\n\\n#endif\\n\\nvec3 transformedNormal = normalMatrix * objectNormal;\\n\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/lights_phong_pars_fragment.glsl\r\n\r\nTHREE.ShaderChunk['lights_phong_pars_fragment'] = \"uniform vec3 ambientLightColor;\\n\\n#if MAX_DIR_LIGHTS > 0\\n\\n\tuniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\\n\tuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\\n\\n#endif\\n\\n#if MAX_HEMI_LIGHTS > 0\\n\\n\tuniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];\\n\tuniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];\\n\tuniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];\\n\\n#endif\\n\\n#if MAX_POINT_LIGHTS > 0\\n\\n\tuniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\\n\\n\tuniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\\n\tuniform float pointLightDistance[ MAX_POINT_LIGHTS ];\\n\tuniform float pointLightDecay[ MAX_POINT_LIGHTS ];\\n\\n#endif\\n\\n#if MAX_SPOT_LIGHTS > 0\\n\\n\tuniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];\\n\tuniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];\\n\tuniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];\\n\tuniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];\\n\tuniform float spotLightExponent[ MAX_SPOT_LIGHTS ];\\n\tuniform float spotLightDistance[ MAX_SPOT_LIGHTS ];\\n\tuniform float spotLightDecay[ MAX_SPOT_LIGHTS ];\\n\\n#endif\\n\\n#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP ) || defined( USE_ENVMAP )\\n\\n\tvarying vec3 vWorldPosition;\\n\\n#endif\\n\\n#ifdef WRAP_AROUND\\n\\n\tuniform vec3 wrapRGB;\\n\\n#endif\\n\\nvarying vec3 vViewPosition;\\n\\n#ifndef FLAT_SHADED\\n\\n\tvarying vec3 vNormal;\\n\\n#endif\\n\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/skinbase_vertex.glsl\r\n\r\nTHREE.ShaderChunk['skinbase_vertex'] = \"#ifdef USE_SKINNING\\n\\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\\n\\n#endif\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/map_vertex.glsl\r\n\r\nTHREE.ShaderChunk['map_vertex'] = \"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP )\\n\\n\tvUv = uv * offsetRepeat.zw + offsetRepeat.xy;\\n\\n#endif\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/lightmap_fragment.glsl\r\n\r\nTHREE.ShaderChunk['lightmap_fragment'] = \"#ifdef USE_LIGHTMAP\\n\\n\toutgoingLight *= diffuseColor.xyz * texture2D( lightMap, vUv2 ).xyz;\\n\\n#endif\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/shadowmap_pars_vertex.glsl\r\n\r\nTHREE.ShaderChunk['shadowmap_pars_vertex'] = \"#ifdef USE_SHADOWMAP\\n\\n\tvarying vec4 vShadowCoord[ MAX_SHADOWS ];\\n\tuniform mat4 shadowMatrix[ MAX_SHADOWS ];\\n\\n#endif\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/color_fragment.glsl\r\n\r\nTHREE.ShaderChunk['color_fragment'] = \"#ifdef USE_COLOR\\n\\n\tdiffuseColor.rgb *= vColor;\\n\\n#endif\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/morphtarget_vertex.glsl\r\n\r\nTHREE.ShaderChunk['morphtarget_vertex'] = \"#ifdef USE_MORPHTARGETS\\n\\n\tvec3 morphed = vec3( 0.0 );\\n\tmorphed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];\\n\tmorphed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];\\n\tmorphed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];\\n\tmorphed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];\\n\\n\t#ifndef USE_MORPHNORMALS\\n\\n\tmorphed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];\\n\tmorphed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];\\n\tmorphed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];\\n\tmorphed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];\\n\\n\t#endif\\n\\n\tmorphed += position;\\n\\n#endif\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/envmap_vertex.glsl\r\n\r\nTHREE.ShaderChunk['envmap_vertex'] = \"#if defined( USE_ENVMAP ) && ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP ) && ! defined( PHONG )\\n\\n\tvec3 worldNormal = transformDirection( objectNormal, modelMatrix );\\n\\n\tvec3 cameraToVertex = normalize( worldPosition.xyz - cameraPosition );\\n\\n\t#ifdef ENVMAP_MODE_REFLECTION\\n\\n\t\tvReflect = reflect( cameraToVertex, worldNormal );\\n\\n\t#else\\n\\n\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\\n\\n\t#endif\\n\\n#endif\\n\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/shadowmap_fragment.glsl\r\n\r\nTHREE.ShaderChunk['shadowmap_fragment'] = \"#ifdef USE_SHADOWMAP\\n\\n\t#ifdef SHADOWMAP_DEBUG\\n\\n\t\tvec3 frustumColors[3];\\n\t\tfrustumColors[0] = vec3( 1.0, 0.5, 0.0 );\\n\t\tfrustumColors[1] = vec3( 0.0, 1.0, 0.8 );\\n\t\tfrustumColors[2] = vec3( 0.0, 0.5, 1.0 );\\n\\n\t#endif\\n\\n\t#ifdef SHADOWMAP_CASCADE\\n\\n\t\tint inFrustumCount = 0;\\n\\n\t#endif\\n\\n\tfloat fDepth;\\n\tvec3 shadowColor = vec3( 1.0 );\\n\\n\tfor( int i = 0; i < MAX_SHADOWS; i ++ ) {\\n\\n\t\tvec3 shadowCoord = vShadowCoord[ i ].xyz / vShadowCoord[ i ].w;\\n\\n\t\t\t\t// if ( something && something ) breaks ATI OpenGL shader compiler\\n\t\t\t\t// if ( all( something, something ) ) using this instead\\n\\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\\n\t\tbool inFrustum = all( inFrustumVec );\\n\\n\t\t\t\t// don't shadow pixels outside of light frustum\\n\t\t\t\t// use just first frustum (for cascades)\\n\t\t\t\t// don't shadow pixels behind far plane of light frustum\\n\\n\t\t#ifdef SHADOWMAP_CASCADE\\n\\n\t\t\tinFrustumCount += int( inFrustum );\\n\t\t\tbvec3 frustumTestVec = bvec3( inFrustum, inFrustumCount == 1, shadowCoord.z <= 1.0 );\\n\\n\t\t#else\\n\\n\t\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\\n\\n\t\t#endif\\n\\n\t\tbool frustumTest = all( frustumTestVec );\\n\\n\t\tif ( frustumTest ) {\\n\\n\t\t\tshadowCoord.z += shadowBias[ i ];\\n\\n\t\t\t#if defined( SHADOWMAP_TYPE_PCF )\\n\\n\t\t\t\t\t\t// Percentage-close filtering\\n\t\t\t\t\t\t// (9 pixel kernel)\\n\t\t\t\t\t\t// http://fabiensanglard.net/shadowmappingPCF/\\n\\n\t\t\t\tfloat shadow = 0.0;\\n\\n\t\t/*\\n\t\t\t\t\t\t// nested loops breaks shader compiler / validator on some ATI cards when using OpenGL\\n\t\t\t\t\t\t// must enroll loop manually\\n\\n\t\t\t\tfor ( float y = -1.25; y <= 1.25; y += 1.25 )\\n\t\t\t\t\tfor ( float x = -1.25; x <= 1.25; x += 1.25 ) {\\n\\n\t\t\t\t\t\tvec4 rgbaDepth = texture2D( shadowMap[ i ], vec2( x * xPixelOffset, y * yPixelOffset ) + shadowCoord.xy );\\n\\n\t\t\t\t\t\t\t\t// doesn't seem to produce any noticeable visual difference compared to simple texture2D lookup\\n\t\t\t\t\t\t\t\t//vec4 rgbaDepth = texture2DProj( shadowMap[ i ], vec4( vShadowCoord[ i ].w * ( vec2( x * xPixelOffset, y * yPixelOffset ) + shadowCoord.xy ), 0.05, vShadowCoord[ i ].w ) );\\n\\n\t\t\t\t\t\tfloat fDepth = unpackDepth( rgbaDepth );\\n\\n\t\t\t\t\t\tif ( fDepth < shadowCoord.z )\\n\t\t\t\t\t\t\tshadow += 1.0;\\n\\n\t\t\t\t}\\n\\n\t\t\t\tshadow /= 9.0;\\n\\n\t\t*/\\n\\n\t\t\t\tconst float shadowDelta = 1.0 / 9.0;\\n\\n\t\t\t\tfloat xPixelOffset = 1.0 / shadowMapSize[ i ].x;\\n\t\t\t\tfloat yPixelOffset = 1.0 / shadowMapSize[ i ].y;\\n\\n\t\t\t\tfloat dx0 = -1.25 * xPixelOffset;\\n\t\t\t\tfloat dy0 = -1.25 * yPixelOffset;\\n\t\t\t\tfloat dx1 = 1.25 * xPixelOffset;\\n\t\t\t\tfloat dy1 = 1.25 * yPixelOffset;\\n\\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy0 ) ) );\\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\\n\\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy0 ) ) );\\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\\n\\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy0 ) ) );\\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\\n\\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, 0.0 ) ) );\\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\\n\\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy ) );\\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\\n\\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, 0.0 ) ) );\\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\\n\\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy1 ) ) );\\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\\n\\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy1 ) ) );\\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\\n\\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy1 ) ) );\\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\\n\\n\t\t\t\tshadowColor = shadowColor * vec3( ( 1.0 - shadowDarkness[ i ] * shadow ) );\\n\\n\t\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\\n\\n\t\t\t\t\t\t// Percentage-close filtering\\n\t\t\t\t\t\t// (9 pixel kernel)\\n\t\t\t\t\t\t// http://fabiensanglard.net/shadowmappingPCF/\\n\\n\t\t\t\tfloat shadow = 0.0;\\n\\n\t\t\t\tfloat xPixelOffset = 1.0 / shadowMapSize[ i ].x;\\n\t\t\t\tfloat yPixelOffset = 1.0 / shadowMapSize[ i ].y;\\n\\n\t\t\t\tfloat dx0 = -1.0 * xPixelOffset;\\n\t\t\t\tfloat dy0 = -1.0 * yPixelOffset;\\n\t\t\t\tfloat dx1 = 1.0 * xPixelOffset;\\n\t\t\t\tfloat dy1 = 1.0 * yPixelOffset;\\n\\n\t\t\t\tmat3 shadowKernel;\\n\t\t\t\tmat3 depthKernel;\\n\\n\t\t\t\tdepthKernel[0][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy0 ) ) );\\n\t\t\t\tdepthKernel[0][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, 0.0 ) ) );\\n\t\t\t\tdepthKernel[0][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy1 ) ) );\\n\t\t\t\tdepthKernel[1][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy0 ) ) );\\n\t\t\t\tdepthKernel[1][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy ) );\\n\t\t\t\tdepthKernel[1][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy1 ) ) );\\n\t\t\t\tdepthKernel[2][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy0 ) ) );\\n\t\t\t\tdepthKernel[2][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, 0.0 ) ) );\\n\t\t\t\tdepthKernel[2][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy1 ) ) );\\n\\n\t\t\t\tvec3 shadowZ = vec3( shadowCoord.z );\\n\t\t\t\tshadowKernel[0] = vec3(lessThan(depthKernel[0], shadowZ ));\\n\t\t\t\tshadowKernel[0] *= vec3(0.25);\\n\\n\t\t\t\tshadowKernel[1] = vec3(lessThan(depthKernel[1], shadowZ ));\\n\t\t\t\tshadowKernel[1] *= vec3(0.25);\\n\\n\t\t\t\tshadowKernel[2] = vec3(lessThan(depthKernel[2], shadowZ ));\\n\t\t\t\tshadowKernel[2] *= vec3(0.25);\\n\\n\t\t\t\tvec2 fractionalCoord = 1.0 - fract( shadowCoord.xy * shadowMapSize[i].xy );\\n\\n\t\t\t\tshadowKernel[0] = mix( shadowKernel[1], shadowKernel[0], fractionalCoord.x );\\n\t\t\t\tshadowKernel[1] = mix( shadowKernel[2], shadowKernel[1], fractionalCoord.x );\\n\\n\t\t\t\tvec4 shadowValues;\\n\t\t\t\tshadowValues.x = mix( shadowKernel[0][1], shadowKernel[0][0], fractionalCoord.y );\\n\t\t\t\tshadowValues.y = mix( shadowKernel[0][2], shadowKernel[0][1], fractionalCoord.y );\\n\t\t\t\tshadowValues.z = mix( shadowKernel[1][1], shadowKernel[1][0], fractionalCoord.y );\\n\t\t\t\tshadowValues.w = mix( shadowKernel[1][2], shadowKernel[1][1], fractionalCoord.y );\\n\\n\t\t\t\tshadow = dot( shadowValues, vec4( 1.0 ) );\\n\\n\t\t\t\tshadowColor = shadowColor * vec3( ( 1.0 - shadowDarkness[ i ] * shadow ) );\\n\\n\t\t\t#else\\n\\n\t\t\t\tvec4 rgbaDepth = texture2D( shadowMap[ i ], shadowCoord.xy );\\n\t\t\t\tfloat fDepth = unpackDepth( rgbaDepth );\\n\\n\t\t\t\tif ( fDepth < shadowCoord.z )\\n\\n\t\t// spot with multiple shadows is darker\\n\\n\t\t\t\t\tshadowColor = shadowColor * vec3( 1.0 - shadowDarkness[ i ] );\\n\\n\t\t// spot with multiple shadows has the same color as single shadow spot\\n\\n\t\t// \t\t\t\t\tshadowColor = min( shadowColor, vec3( shadowDarkness[ i ] ) );\\n\\n\t\t\t#endif\\n\\n\t\t}\\n\\n\\n\t\t#ifdef SHADOWMAP_DEBUG\\n\\n\t\t\t#ifdef SHADOWMAP_CASCADE\\n\\n\t\t\t\tif ( inFrustum && inFrustumCount == 1 ) outgoingLight *= frustumColors[ i ];\\n\\n\t\t\t#else\\n\\n\t\t\t\tif ( inFrustum ) outgoingLight *= frustumColors[ i ];\\n\\n\t\t\t#endif\\n\\n\t\t#endif\\n\\n\t}\\n\\n\t// NOTE: I am unsure if this is correct in linear space.  -bhouston, Dec 29, 2014\\n\tshadowColor = inputToLinear( shadowColor );\\n\\n\toutgoingLight = outgoingLight * shadowColor;\\n\\n#endif\\n\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/worldpos_vertex.glsl\r\n\r\nTHREE.ShaderChunk['worldpos_vertex'] = \"#if defined( USE_ENVMAP ) || defined( PHONG ) || defined( LAMBERT ) || defined ( USE_SHADOWMAP )\\n\\n\t#ifdef USE_SKINNING\\n\\n\t\tvec4 worldPosition = modelMatrix * skinned;\\n\\n\t#elif defined( USE_MORPHTARGETS )\\n\\n\t\tvec4 worldPosition = modelMatrix * vec4( morphed, 1.0 );\\n\\n\t#else\\n\\n\t\tvec4 worldPosition = modelMatrix * vec4( position, 1.0 );\\n\\n\t#endif\\n\\n#endif\\n\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/shadowmap_pars_fragment.glsl\r\n\r\nTHREE.ShaderChunk['shadowmap_pars_fragment'] = \"#ifdef USE_SHADOWMAP\\n\\n\tuniform sampler2D shadowMap[ MAX_SHADOWS ];\\n\tuniform vec2 shadowMapSize[ MAX_SHADOWS ];\\n\\n\tuniform float shadowDarkness[ MAX_SHADOWS ];\\n\tuniform float shadowBias[ MAX_SHADOWS ];\\n\\n\tvarying vec4 vShadowCoord[ MAX_SHADOWS ];\\n\\n\tfloat unpackDepth( const in vec4 rgba_depth ) {\\n\\n\t\tconst vec4 bit_shift = vec4( 1.0 / ( 256.0 * 256.0 * 256.0 ), 1.0 / ( 256.0 * 256.0 ), 1.0 / 256.0, 1.0 );\\n\t\tfloat depth = dot( rgba_depth, bit_shift );\\n\t\treturn depth;\\n\\n\t}\\n\\n#endif\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/skinning_pars_vertex.glsl\r\n\r\nTHREE.ShaderChunk['skinning_pars_vertex'] = \"#ifdef USE_SKINNING\\n\\n\tuniform mat4 bindMatrix;\\n\tuniform mat4 bindMatrixInverse;\\n\\n\t#ifdef BONE_TEXTURE\\n\\n\t\tuniform sampler2D boneTexture;\\n\t\tuniform int boneTextureWidth;\\n\t\tuniform int boneTextureHeight;\\n\\n\t\tmat4 getBoneMatrix( const in float i ) {\\n\\n\t\t\tfloat j = i * 4.0;\\n\t\t\tfloat x = mod( j, float( boneTextureWidth ) );\\n\t\t\tfloat y = floor( j / float( boneTextureWidth ) );\\n\\n\t\t\tfloat dx = 1.0 / float( boneTextureWidth );\\n\t\t\tfloat dy = 1.0 / float( boneTextureHeight );\\n\\n\t\t\ty = dy * ( y + 0.5 );\\n\\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\\n\\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\\n\\n\t\t\treturn bone;\\n\\n\t\t}\\n\\n\t#else\\n\\n\t\tuniform mat4 boneGlobalMatrices[ MAX_BONES ];\\n\\n\t\tmat4 getBoneMatrix( const in float i ) {\\n\\n\t\t\tmat4 bone = boneGlobalMatrices[ int(i) ];\\n\t\t\treturn bone;\\n\\n\t\t}\\n\\n\t#endif\\n\\n#endif\\n\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/logdepthbuf_pars_fragment.glsl\r\n\r\nTHREE.ShaderChunk['logdepthbuf_pars_fragment'] = \"#ifdef USE_LOGDEPTHBUF\\n\\n\tuniform float logDepthBufFC;\\n\\n\t#ifdef USE_LOGDEPTHBUF_EXT\\n\\n\t\t#extension GL_EXT_frag_depth : enable\\n\t\tvarying float vFragDepth;\\n\\n\t#endif\\n\\n#endif\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/alphamap_fragment.glsl\r\n\r\nTHREE.ShaderChunk['alphamap_fragment'] = \"#ifdef USE_ALPHAMAP\\n\\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\\n\\n#endif\\n\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/alphamap_pars_fragment.glsl\r\n\r\nTHREE.ShaderChunk['alphamap_pars_fragment'] = \"#ifdef USE_ALPHAMAP\\n\\n\tuniform sampler2D alphaMap;\\n\\n#endif\\n\";\r\n\r\n// File:src/renderers/shaders/UniformsUtils.js\r\n\r\n/**\r\n * Uniform Utilities\r\n */\r\n\r\nTHREE.UniformsUtils = {\r\n\r\n  merge: function(uniforms) {\r\n\r\n    var merged = {};\r\n\r\n    for (var u = 0; u < uniforms.length; u++) {\r\n\r\n      var tmp = this.clone(uniforms[u]);\r\n\r\n      for (var p in tmp) {\r\n\r\n        merged[p] = tmp[p];\r\n\r\n      }\r\n\r\n    }\r\n\r\n    return merged;\r\n\r\n  },\r\n\r\n  clone: function(uniforms_src) {\r\n\r\n    var uniforms_dst = {};\r\n\r\n    for (var u in uniforms_src) {\r\n\r\n      uniforms_dst[u] = {};\r\n\r\n      for (var p in uniforms_src[u]) {\r\n\r\n        var parameter_src = uniforms_src[u][p];\r\n\r\n        if (parameter_src instanceof THREE.Color ||\r\n          parameter_src instanceof THREE.Vector2 ||\r\n          parameter_src instanceof THREE.Vector3 ||\r\n          parameter_src instanceof THREE.Vector4 ||\r\n          parameter_src instanceof THREE.Matrix4 ||\r\n          parameter_src instanceof THREE.Texture) {\r\n\r\n          uniforms_dst[u][p] = parameter_src.clone();\r\n\r\n        }\r\n        else if (parameter_src instanceof Array) {\r\n\r\n          uniforms_dst[u][p] = parameter_src.slice();\r\n\r\n        }\r\n        else {\r\n\r\n          uniforms_dst[u][p] = parameter_src;\r\n\r\n        }\r\n\r\n      }\r\n\r\n    }\r\n\r\n    return uniforms_dst;\r\n\r\n  }\r\n\r\n};\r\n\r\n// File:src/renderers/shaders/UniformsLib.js\r\n\r\n/**\r\n * Uniforms library for shared webgl shaders\r\n */\r\n\r\nTHREE.UniformsLib = {\r\n\r\n  common: {\r\n\r\n    \"diffuse\": {\r\n      type: \"c\",\r\n      value: new THREE.Color(0xeeeeee)\r\n    },\r\n    \"opacity\": {\r\n      type: \"f\",\r\n      value: 1.0\r\n    },\r\n\r\n    \"map\": {\r\n      type: \"t\",\r\n      value: null\r\n    },\r\n    \"offsetRepeat\": {\r\n      type: \"v4\",\r\n      value: new THREE.Vector4(0, 0, 1, 1)\r\n    },\r\n\r\n    \"lightMap\": {\r\n      type: \"t\",\r\n      value: null\r\n    },\r\n    \"specularMap\": {\r\n      type: \"t\",\r\n      value: null\r\n    },\r\n    \"alphaMap\": {\r\n      type: \"t\",\r\n      value: null\r\n    },\r\n\r\n    \"envMap\": {\r\n      type: \"t\",\r\n      value: null\r\n    },\r\n    \"flipEnvMap\": {\r\n      type: \"f\",\r\n      value: -1\r\n    },\r\n    \"reflectivity\": {\r\n      type: \"f\",\r\n      value: 1.0\r\n    },\r\n    \"refractionRatio\": {\r\n      type: \"f\",\r\n      value: 0.98\r\n    },\r\n\r\n    \"morphTargetInfluences\": {\r\n      type: \"f\",\r\n      value: 0\r\n    }\r\n\r\n  },\r\n\r\n  bump: {\r\n\r\n    \"bumpMap\": {\r\n      type: \"t\",\r\n      value: null\r\n    },\r\n    \"bumpScale\": {\r\n      type: \"f\",\r\n      value: 1\r\n    }\r\n\r\n  },\r\n\r\n  normalmap: {\r\n\r\n    \"normalMap\": {\r\n      type: \"t\",\r\n      value: null\r\n    },\r\n    \"normalScale\": {\r\n      type: \"v2\",\r\n      value: new THREE.Vector2(1, 1)\r\n    }\r\n  },\r\n\r\n  fog: {\r\n\r\n    \"fogDensity\": {\r\n      type: \"f\",\r\n      value: 0.00025\r\n    },\r\n    \"fogNear\": {\r\n      type: \"f\",\r\n      value: 1\r\n    },\r\n    \"fogFar\": {\r\n      type: \"f\",\r\n      value: 2000\r\n    },\r\n    \"fogColor\": {\r\n      type: \"c\",\r\n      value: new THREE.Color(0xffffff)\r\n    }\r\n\r\n  },\r\n\r\n  lights: {\r\n\r\n    \"ambientLightColor\": {\r\n      type: \"fv\",\r\n      value: []\r\n    },\r\n\r\n    \"directionalLightDirection\": {\r\n      type: \"fv\",\r\n      value: []\r\n    },\r\n    \"directionalLightColor\": {\r\n      type: \"fv\",\r\n      value: []\r\n    },\r\n\r\n    \"hemisphereLightDirection\": {\r\n      type: \"fv\",\r\n      value: []\r\n    },\r\n    \"hemisphereLightSkyColor\": {\r\n      type: \"fv\",\r\n      value: []\r\n    },\r\n    \"hemisphereLightGroundColor\": {\r\n      type: \"fv\",\r\n      value: []\r\n    },\r\n\r\n    \"pointLightColor\": {\r\n      type: \"fv\",\r\n      value: []\r\n    },\r\n    \"pointLightPosition\": {\r\n      type: \"fv\",\r\n      value: []\r\n    },\r\n    \"pointLightDistance\": {\r\n      type: \"fv1\",\r\n      value: []\r\n    },\r\n    \"pointLightDecay\": {\r\n      type: \"fv1\",\r\n      value: []\r\n    },\r\n\r\n    \"spotLightColor\": {\r\n      type: \"fv\",\r\n      value: []\r\n    },\r\n    \"spotLightPosition\": {\r\n      type: \"fv\",\r\n      value: []\r\n    },\r\n    \"spotLightDirection\": {\r\n      type: \"fv\",\r\n      value: []\r\n    },\r\n    \"spotLightDistance\": {\r\n      type: \"fv1\",\r\n      value: []\r\n    },\r\n    \"spotLightAngleCos\": {\r\n      type: \"fv1\",\r\n      value: []\r\n    },\r\n    \"spotLightExponent\": {\r\n      type: \"fv1\",\r\n      value: []\r\n    },\r\n    \"spotLightDecay\": {\r\n      type: \"fv1\",\r\n      value: []\r\n    }\r\n\r\n  },\r\n\r\n  particle: {\r\n\r\n    \"psColor\": {\r\n      type: \"c\",\r\n      value: new THREE.Color(0xeeeeee)\r\n    },\r\n    \"opacity\": {\r\n      type: \"f\",\r\n      value: 1.0\r\n    },\r\n    \"size\": {\r\n      type: \"f\",\r\n      value: 1.0\r\n    },\r\n    \"scale\": {\r\n      type: \"f\",\r\n      value: 1.0\r\n    },\r\n    \"map\": {\r\n      type: \"t\",\r\n      value: null\r\n    },\r\n    \"offsetRepeat\": {\r\n      type: \"v4\",\r\n      value: new THREE.Vector4(0, 0, 1, 1)\r\n    },\r\n\r\n    \"fogDensity\": {\r\n      type: \"f\",\r\n      value: 0.00025\r\n    },\r\n    \"fogNear\": {\r\n      type: \"f\",\r\n      value: 1\r\n    },\r\n    \"fogFar\": {\r\n      type: \"f\",\r\n      value: 2000\r\n    },\r\n    \"fogColor\": {\r\n      type: \"c\",\r\n      value: new THREE.Color(0xffffff)\r\n    }\r\n\r\n  },\r\n\r\n  shadowmap: {\r\n\r\n    \"shadowMap\": {\r\n      type: \"tv\",\r\n      value: []\r\n    },\r\n    \"shadowMapSize\": {\r\n      type: \"v2v\",\r\n      value: []\r\n    },\r\n\r\n    \"shadowBias\": {\r\n      type: \"fv1\",\r\n      value: []\r\n    },\r\n    \"shadowDarkness\": {\r\n      type: \"fv1\",\r\n      value: []\r\n    },\r\n\r\n    \"shadowMatrix\": {\r\n      type: \"m4v\",\r\n      value: []\r\n    }\r\n\r\n  }\r\n\r\n};\r\n\r\n// File:src/renderers/shaders/ShaderLib.js\r\n\r\n/**\r\n * Webgl Shader Library for three.js\r\n *\r\n * @author alteredq / http://alteredqualia.com/\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author mikael emtinger / http://gomo.se/\r\n */\r\n\r\n\r\nTHREE.ShaderLib = {\r\n\r\n  'basic': {\r\n\r\n    uniforms: THREE.UniformsUtils.merge([\r\n\r\n      THREE.UniformsLib[\"common\"],\r\n      THREE.UniformsLib[\"fog\"],\r\n      THREE.UniformsLib[\"shadowmap\"]\r\n\r\n    ]),\r\n\r\n    vertexShader: [\r\n\r\n      THREE.ShaderChunk[\"common\"],\r\n      THREE.ShaderChunk[\"map_pars_vertex\"],\r\n      THREE.ShaderChunk[\"lightmap_pars_vertex\"],\r\n      THREE.ShaderChunk[\"envmap_pars_vertex\"],\r\n      THREE.ShaderChunk[\"color_pars_vertex\"],\r\n      THREE.ShaderChunk[\"morphtarget_pars_vertex\"],\r\n      THREE.ShaderChunk[\"skinning_pars_vertex\"],\r\n      THREE.ShaderChunk[\"shadowmap_pars_vertex\"],\r\n      THREE.ShaderChunk[\"logdepthbuf_pars_vertex\"],\r\n\r\n      \"void main() {\",\r\n\r\n      THREE.ShaderChunk[\"map_vertex\"],\r\n      THREE.ShaderChunk[\"lightmap_vertex\"],\r\n      THREE.ShaderChunk[\"color_vertex\"],\r\n      THREE.ShaderChunk[\"skinbase_vertex\"],\r\n\r\n      \"\t#ifdef USE_ENVMAP\",\r\n\r\n      THREE.ShaderChunk[\"morphnormal_vertex\"],\r\n      THREE.ShaderChunk[\"skinnormal_vertex\"],\r\n      THREE.ShaderChunk[\"defaultnormal_vertex\"],\r\n\r\n      \"\t#endif\",\r\n\r\n      THREE.ShaderChunk[\"morphtarget_vertex\"],\r\n      THREE.ShaderChunk[\"skinning_vertex\"],\r\n      THREE.ShaderChunk[\"default_vertex\"],\r\n      THREE.ShaderChunk[\"logdepthbuf_vertex\"],\r\n\r\n      THREE.ShaderChunk[\"worldpos_vertex\"],\r\n      THREE.ShaderChunk[\"envmap_vertex\"],\r\n      THREE.ShaderChunk[\"shadowmap_vertex\"],\r\n\r\n      \"}\"\r\n\r\n    ].join(\"\\n\"),\r\n\r\n    fragmentShader: [\r\n\r\n      \"uniform vec3 diffuse;\",\r\n      \"uniform float opacity;\",\r\n\r\n      THREE.ShaderChunk[\"common\"],\r\n      THREE.ShaderChunk[\"color_pars_fragment\"],\r\n      THREE.ShaderChunk[\"map_pars_fragment\"],\r\n      THREE.ShaderChunk[\"alphamap_pars_fragment\"],\r\n      THREE.ShaderChunk[\"lightmap_pars_fragment\"],\r\n      THREE.ShaderChunk[\"envmap_pars_fragment\"],\r\n      THREE.ShaderChunk[\"fog_pars_fragment\"],\r\n      THREE.ShaderChunk[\"shadowmap_pars_fragment\"],\r\n      THREE.ShaderChunk[\"specularmap_pars_fragment\"],\r\n      THREE.ShaderChunk[\"logdepthbuf_pars_fragment\"],\r\n\r\n      \"void main() {\",\r\n\r\n      \"\tvec3 outgoingLight = vec3( 0.0 );\", // outgoing light does not have an alpha, the surface does\r\n      \"\tvec4 diffuseColor = vec4( diffuse, opacity );\",\r\n\r\n      THREE.ShaderChunk[\"logdepthbuf_fragment\"],\r\n      THREE.ShaderChunk[\"map_fragment\"],\r\n      THREE.ShaderChunk[\"color_fragment\"],\r\n      THREE.ShaderChunk[\"alphamap_fragment\"],\r\n      THREE.ShaderChunk[\"alphatest_fragment\"],\r\n      THREE.ShaderChunk[\"specularmap_fragment\"],\r\n\r\n      \"\toutgoingLight = diffuseColor.rgb;\", // simple shader\r\n\r\n      THREE.ShaderChunk[\"lightmap_fragment\"], // TODO: Light map on an otherwise unlit surface doesn't make sense.\r\n      THREE.ShaderChunk[\"envmap_fragment\"],\r\n      THREE.ShaderChunk[\"shadowmap_fragment\"], // TODO: Shadows on an otherwise unlit surface doesn't make sense.\r\n\r\n      THREE.ShaderChunk[\"linear_to_gamma_fragment\"],\r\n\r\n      THREE.ShaderChunk[\"fog_fragment\"],\r\n\r\n      \"\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\", // TODO, this should be pre-multiplied to allow for bright highlights on very transparent objects\r\n\r\n      \"}\"\r\n\r\n    ].join(\"\\n\")\r\n\r\n  },\r\n\r\n  'lambert': {\r\n\r\n    uniforms: THREE.UniformsUtils.merge([\r\n\r\n      THREE.UniformsLib[\"common\"],\r\n      THREE.UniformsLib[\"fog\"],\r\n      THREE.UniformsLib[\"lights\"],\r\n      THREE.UniformsLib[\"shadowmap\"],\r\n\r\n      {\r\n        \"emissive\": {\r\n          type: \"c\",\r\n          value: new THREE.Color(0x000000)\r\n        },\r\n        \"wrapRGB\": {\r\n          type: \"v3\",\r\n          value: new THREE.Vector3(1, 1, 1)\r\n        }\r\n      }\r\n\r\n    ]),\r\n\r\n    vertexShader: [\r\n\r\n      \"#define LAMBERT\",\r\n\r\n      \"varying vec3 vLightFront;\",\r\n\r\n      \"#ifdef DOUBLE_SIDED\",\r\n\r\n      \"\tvarying vec3 vLightBack;\",\r\n\r\n      \"#endif\",\r\n\r\n      THREE.ShaderChunk[\"common\"],\r\n      THREE.ShaderChunk[\"map_pars_vertex\"],\r\n      THREE.ShaderChunk[\"lightmap_pars_vertex\"],\r\n      THREE.ShaderChunk[\"envmap_pars_vertex\"],\r\n      THREE.ShaderChunk[\"lights_lambert_pars_vertex\"],\r\n      THREE.ShaderChunk[\"color_pars_vertex\"],\r\n      THREE.ShaderChunk[\"morphtarget_pars_vertex\"],\r\n      THREE.ShaderChunk[\"skinning_pars_vertex\"],\r\n      THREE.ShaderChunk[\"shadowmap_pars_vertex\"],\r\n      THREE.ShaderChunk[\"logdepthbuf_pars_vertex\"],\r\n\r\n      \"void main() {\",\r\n\r\n      THREE.ShaderChunk[\"map_vertex\"],\r\n      THREE.ShaderChunk[\"lightmap_vertex\"],\r\n      THREE.ShaderChunk[\"color_vertex\"],\r\n\r\n      THREE.ShaderChunk[\"morphnormal_vertex\"],\r\n      THREE.ShaderChunk[\"skinbase_vertex\"],\r\n      THREE.ShaderChunk[\"skinnormal_vertex\"],\r\n      THREE.ShaderChunk[\"defaultnormal_vertex\"],\r\n\r\n      THREE.ShaderChunk[\"morphtarget_vertex\"],\r\n      THREE.ShaderChunk[\"skinning_vertex\"],\r\n      THREE.ShaderChunk[\"default_vertex\"],\r\n      THREE.ShaderChunk[\"logdepthbuf_vertex\"],\r\n\r\n      THREE.ShaderChunk[\"worldpos_vertex\"],\r\n      THREE.ShaderChunk[\"envmap_vertex\"],\r\n      THREE.ShaderChunk[\"lights_lambert_vertex\"],\r\n      THREE.ShaderChunk[\"shadowmap_vertex\"],\r\n\r\n      \"}\"\r\n\r\n    ].join(\"\\n\"),\r\n\r\n    fragmentShader: [\r\n\r\n      \"uniform vec3 diffuse;\",\r\n      \"uniform vec3 emissive;\",\r\n      \"uniform float opacity;\",\r\n\r\n      \"varying vec3 vLightFront;\",\r\n\r\n      \"#ifdef DOUBLE_SIDED\",\r\n\r\n      \"\tvarying vec3 vLightBack;\",\r\n\r\n      \"#endif\",\r\n\r\n      THREE.ShaderChunk[\"common\"],\r\n      THREE.ShaderChunk[\"color_pars_fragment\"],\r\n      THREE.ShaderChunk[\"map_pars_fragment\"],\r\n      THREE.ShaderChunk[\"alphamap_pars_fragment\"],\r\n      THREE.ShaderChunk[\"lightmap_pars_fragment\"],\r\n      THREE.ShaderChunk[\"envmap_pars_fragment\"],\r\n      THREE.ShaderChunk[\"fog_pars_fragment\"],\r\n      THREE.ShaderChunk[\"shadowmap_pars_fragment\"],\r\n      THREE.ShaderChunk[\"specularmap_pars_fragment\"],\r\n      THREE.ShaderChunk[\"logdepthbuf_pars_fragment\"],\r\n\r\n      \"void main() {\",\r\n\r\n      \"\tvec3 outgoingLight = vec3( 0.0 );\", // outgoing light does not have an alpha, the surface does\r\n      \"\tvec4 diffuseColor = vec4( diffuse, opacity );\",\r\n\r\n      THREE.ShaderChunk[\"logdepthbuf_fragment\"],\r\n      THREE.ShaderChunk[\"map_fragment\"],\r\n      THREE.ShaderChunk[\"color_fragment\"],\r\n      THREE.ShaderChunk[\"alphamap_fragment\"],\r\n      THREE.ShaderChunk[\"alphatest_fragment\"],\r\n      THREE.ShaderChunk[\"specularmap_fragment\"],\r\n\r\n      \"\t#ifdef DOUBLE_SIDED\",\r\n\r\n      //\"float isFront = float( gl_FrontFacing );\",\r\n      //\"gl_FragColor.xyz *= isFront * vLightFront + ( 1.0 - isFront ) * vLightBack;\",\r\n\r\n      \"\t\tif ( gl_FrontFacing )\",\r\n      \"\t\t\toutgoingLight += diffuseColor.rgb * vLightFront + emissive;\",\r\n      \"\t\telse\",\r\n      \"\t\t\toutgoingLight += diffuseColor.rgb * vLightBack + emissive;\",\r\n\r\n      \"\t#else\",\r\n\r\n      \"\t\toutgoingLight += diffuseColor.rgb * vLightFront + emissive;\",\r\n\r\n      \"\t#endif\",\r\n\r\n      THREE.ShaderChunk[\"lightmap_fragment\"],\r\n      THREE.ShaderChunk[\"envmap_fragment\"],\r\n      THREE.ShaderChunk[\"shadowmap_fragment\"],\r\n\r\n      THREE.ShaderChunk[\"linear_to_gamma_fragment\"],\r\n\r\n      THREE.ShaderChunk[\"fog_fragment\"],\r\n\r\n      \"\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\", // TODO, this should be pre-multiplied to allow for bright highlights on very transparent objects\r\n\r\n      \"}\"\r\n\r\n    ].join(\"\\n\")\r\n\r\n  },\r\n\r\n  'phong': {\r\n\r\n    uniforms: THREE.UniformsUtils.merge([\r\n\r\n      THREE.UniformsLib[\"common\"],\r\n      THREE.UniformsLib[\"bump\"],\r\n      THREE.UniformsLib[\"normalmap\"],\r\n      THREE.UniformsLib[\"fog\"],\r\n      THREE.UniformsLib[\"lights\"],\r\n      THREE.UniformsLib[\"shadowmap\"],\r\n\r\n      {\r\n        \"emissive\": {\r\n          type: \"c\",\r\n          value: new THREE.Color(0x000000)\r\n        },\r\n        \"specular\": {\r\n          type: \"c\",\r\n          value: new THREE.Color(0x111111)\r\n        },\r\n        \"shininess\": {\r\n          type: \"f\",\r\n          value: 30\r\n        },\r\n        \"wrapRGB\": {\r\n          type: \"v3\",\r\n          value: new THREE.Vector3(1, 1, 1)\r\n        }\r\n      }\r\n\r\n    ]),\r\n\r\n    vertexShader: [\r\n\r\n      \"#define PHONG\",\r\n\r\n      \"varying vec3 vViewPosition;\",\r\n\r\n      \"#ifndef FLAT_SHADED\",\r\n\r\n      \"\tvarying vec3 vNormal;\",\r\n\r\n      \"#endif\",\r\n\r\n      THREE.ShaderChunk[\"common\"],\r\n      THREE.ShaderChunk[\"map_pars_vertex\"],\r\n      THREE.ShaderChunk[\"lightmap_pars_vertex\"],\r\n      THREE.ShaderChunk[\"envmap_pars_vertex\"],\r\n      THREE.ShaderChunk[\"lights_phong_pars_vertex\"],\r\n      THREE.ShaderChunk[\"color_pars_vertex\"],\r\n      THREE.ShaderChunk[\"morphtarget_pars_vertex\"],\r\n      THREE.ShaderChunk[\"skinning_pars_vertex\"],\r\n      THREE.ShaderChunk[\"shadowmap_pars_vertex\"],\r\n      THREE.ShaderChunk[\"logdepthbuf_pars_vertex\"],\r\n\r\n      \"void main() {\",\r\n\r\n      THREE.ShaderChunk[\"map_vertex\"],\r\n      THREE.ShaderChunk[\"lightmap_vertex\"],\r\n      THREE.ShaderChunk[\"color_vertex\"],\r\n\r\n      THREE.ShaderChunk[\"morphnormal_vertex\"],\r\n      THREE.ShaderChunk[\"skinbase_vertex\"],\r\n      THREE.ShaderChunk[\"skinnormal_vertex\"],\r\n      THREE.ShaderChunk[\"defaultnormal_vertex\"],\r\n\r\n      \"#ifndef FLAT_SHADED\", // Normal computed with derivatives when FLAT_SHADED\r\n\r\n      \"\tvNormal = normalize( transformedNormal );\",\r\n\r\n      \"#endif\",\r\n\r\n      THREE.ShaderChunk[\"morphtarget_vertex\"],\r\n      THREE.ShaderChunk[\"skinning_vertex\"],\r\n      THREE.ShaderChunk[\"default_vertex\"],\r\n      THREE.ShaderChunk[\"logdepthbuf_vertex\"],\r\n\r\n      \"\tvViewPosition = -mvPosition.xyz;\",\r\n\r\n      THREE.ShaderChunk[\"worldpos_vertex\"],\r\n      THREE.ShaderChunk[\"envmap_vertex\"],\r\n      THREE.ShaderChunk[\"lights_phong_vertex\"],\r\n      THREE.ShaderChunk[\"shadowmap_vertex\"],\r\n\r\n      \"}\"\r\n\r\n    ].join(\"\\n\"),\r\n\r\n    fragmentShader: [\r\n\r\n      \"#define PHONG\",\r\n\r\n      \"uniform vec3 diffuse;\",\r\n      \"uniform vec3 emissive;\",\r\n      \"uniform vec3 specular;\",\r\n      \"uniform float shininess;\",\r\n      \"uniform float opacity;\",\r\n\r\n      THREE.ShaderChunk[\"common\"],\r\n      THREE.ShaderChunk[\"color_pars_fragment\"],\r\n      THREE.ShaderChunk[\"map_pars_fragment\"],\r\n      THREE.ShaderChunk[\"alphamap_pars_fragment\"],\r\n      THREE.ShaderChunk[\"lightmap_pars_fragment\"],\r\n      THREE.ShaderChunk[\"envmap_pars_fragment\"],\r\n      THREE.ShaderChunk[\"fog_pars_fragment\"],\r\n      THREE.ShaderChunk[\"lights_phong_pars_fragment\"],\r\n      THREE.ShaderChunk[\"shadowmap_pars_fragment\"],\r\n      THREE.ShaderChunk[\"bumpmap_pars_fragment\"],\r\n      THREE.ShaderChunk[\"normalmap_pars_fragment\"],\r\n      THREE.ShaderChunk[\"specularmap_pars_fragment\"],\r\n      THREE.ShaderChunk[\"logdepthbuf_pars_fragment\"],\r\n\r\n      \"void main() {\",\r\n\r\n      \"\tvec3 outgoingLight = vec3( 0.0 );\", // outgoing light does not have an alpha, the surface does\r\n      \"\tvec4 diffuseColor = vec4( diffuse, opacity );\",\r\n\r\n      THREE.ShaderChunk[\"logdepthbuf_fragment\"],\r\n      THREE.ShaderChunk[\"map_fragment\"],\r\n      THREE.ShaderChunk[\"color_fragment\"],\r\n      THREE.ShaderChunk[\"alphamap_fragment\"],\r\n      THREE.ShaderChunk[\"alphatest_fragment\"],\r\n      THREE.ShaderChunk[\"specularmap_fragment\"],\r\n\r\n      THREE.ShaderChunk[\"lights_phong_fragment\"],\r\n\r\n      THREE.ShaderChunk[\"lightmap_fragment\"],\r\n      THREE.ShaderChunk[\"envmap_fragment\"],\r\n      THREE.ShaderChunk[\"shadowmap_fragment\"],\r\n\r\n      THREE.ShaderChunk[\"linear_to_gamma_fragment\"],\r\n\r\n      THREE.ShaderChunk[\"fog_fragment\"],\r\n\r\n      \"\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\", // TODO, this should be pre-multiplied to allow for bright highlights on very transparent objects\r\n\r\n      \"}\"\r\n\r\n    ].join(\"\\n\")\r\n\r\n  },\r\n\r\n  'particle_basic': {\r\n\r\n    uniforms: THREE.UniformsUtils.merge([\r\n\r\n      THREE.UniformsLib[\"particle\"],\r\n      THREE.UniformsLib[\"shadowmap\"]\r\n\r\n    ]),\r\n\r\n    vertexShader: [\r\n\r\n      \"uniform float size;\",\r\n      \"uniform float scale;\",\r\n\r\n      THREE.ShaderChunk[\"common\"],\r\n      THREE.ShaderChunk[\"color_pars_vertex\"],\r\n      THREE.ShaderChunk[\"shadowmap_pars_vertex\"],\r\n      THREE.ShaderChunk[\"logdepthbuf_pars_vertex\"],\r\n\r\n      \"void main() {\",\r\n\r\n      THREE.ShaderChunk[\"color_vertex\"],\r\n\r\n      \"\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\",\r\n\r\n      \"\t#ifdef USE_SIZEATTENUATION\",\r\n      \"\t\tgl_PointSize = size * ( scale / length( mvPosition.xyz ) );\",\r\n      \"\t#else\",\r\n      \"\t\tgl_PointSize = size;\",\r\n      \"\t#endif\",\r\n\r\n      \"\tgl_Position = projectionMatrix * mvPosition;\",\r\n\r\n      THREE.ShaderChunk[\"logdepthbuf_vertex\"],\r\n      THREE.ShaderChunk[\"worldpos_vertex\"],\r\n      THREE.ShaderChunk[\"shadowmap_vertex\"],\r\n\r\n      \"}\"\r\n\r\n    ].join(\"\\n\"),\r\n\r\n    fragmentShader: [\r\n\r\n      \"uniform vec3 psColor;\",\r\n      \"uniform float opacity;\",\r\n\r\n      THREE.ShaderChunk[\"common\"],\r\n      THREE.ShaderChunk[\"color_pars_fragment\"],\r\n      THREE.ShaderChunk[\"map_particle_pars_fragment\"],\r\n      THREE.ShaderChunk[\"fog_pars_fragment\"],\r\n      THREE.ShaderChunk[\"shadowmap_pars_fragment\"],\r\n      THREE.ShaderChunk[\"logdepthbuf_pars_fragment\"],\r\n\r\n      \"void main() {\",\r\n\r\n      \"\tvec3 outgoingLight = vec3( 0.0 );\", // outgoing light does not have an alpha, the surface does\r\n      \"\tvec4 diffuseColor = vec4( psColor, opacity );\",\r\n\r\n      THREE.ShaderChunk[\"logdepthbuf_fragment\"],\r\n      THREE.ShaderChunk[\"map_particle_fragment\"],\r\n      THREE.ShaderChunk[\"color_fragment\"],\r\n      THREE.ShaderChunk[\"alphatest_fragment\"],\r\n\r\n      \"\toutgoingLight = diffuseColor.rgb;\", // simple shader\r\n\r\n      THREE.ShaderChunk[\"shadowmap_fragment\"],\r\n      THREE.ShaderChunk[\"fog_fragment\"],\r\n\r\n      \"\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\", // TODO, this should be pre-multiplied to allow for bright highlights on very transparent objects\r\n\r\n      \"}\"\r\n\r\n    ].join(\"\\n\")\r\n\r\n  },\r\n\r\n  'dashed': {\r\n\r\n    uniforms: THREE.UniformsUtils.merge([\r\n\r\n      THREE.UniformsLib[\"common\"],\r\n      THREE.UniformsLib[\"fog\"],\r\n\r\n      {\r\n        \"scale\": {\r\n          type: \"f\",\r\n          value: 1\r\n        },\r\n        \"dashSize\": {\r\n          type: \"f\",\r\n          value: 1\r\n        },\r\n        \"totalSize\": {\r\n          type: \"f\",\r\n          value: 2\r\n        }\r\n      }\r\n\r\n    ]),\r\n\r\n    vertexShader: [\r\n\r\n      \"uniform float scale;\",\r\n      \"attribute float lineDistance;\",\r\n\r\n      \"varying float vLineDistance;\",\r\n\r\n      THREE.ShaderChunk[\"common\"],\r\n      THREE.ShaderChunk[\"color_pars_vertex\"],\r\n      THREE.ShaderChunk[\"logdepthbuf_pars_vertex\"],\r\n\r\n      \"void main() {\",\r\n\r\n      THREE.ShaderChunk[\"color_vertex\"],\r\n\r\n      \"\tvLineDistance = scale * lineDistance;\",\r\n\r\n      \"\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\",\r\n      \"\tgl_Position = projectionMatrix * mvPosition;\",\r\n\r\n      THREE.ShaderChunk[\"logdepthbuf_vertex\"],\r\n\r\n      \"}\"\r\n\r\n    ].join(\"\\n\"),\r\n\r\n    fragmentShader: [\r\n\r\n      \"uniform vec3 diffuse;\",\r\n      \"uniform float opacity;\",\r\n\r\n      \"uniform float dashSize;\",\r\n      \"uniform float totalSize;\",\r\n\r\n      \"varying float vLineDistance;\",\r\n\r\n      THREE.ShaderChunk[\"common\"],\r\n      THREE.ShaderChunk[\"color_pars_fragment\"],\r\n      THREE.ShaderChunk[\"fog_pars_fragment\"],\r\n      THREE.ShaderChunk[\"logdepthbuf_pars_fragment\"],\r\n\r\n      \"void main() {\",\r\n\r\n      \"\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\",\r\n\r\n      \"\t\tdiscard;\",\r\n\r\n      \"\t}\",\r\n\r\n      \"\tvec3 outgoingLight = vec3( 0.0 );\", // outgoing light does not have an alpha, the surface does\r\n      \"\tvec4 diffuseColor = vec4( diffuse, opacity );\",\r\n\r\n      THREE.ShaderChunk[\"logdepthbuf_fragment\"],\r\n      THREE.ShaderChunk[\"color_fragment\"],\r\n\r\n      \"\toutgoingLight = diffuseColor.rgb;\", // simple shader\r\n\r\n      THREE.ShaderChunk[\"fog_fragment\"],\r\n\r\n      \"\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\", // TODO, this should be pre-multiplied to allow for bright highlights on very transparent objects\r\n\r\n      \"}\"\r\n\r\n    ].join(\"\\n\")\r\n\r\n  },\r\n\r\n  'depth': {\r\n\r\n    uniforms: {\r\n\r\n      \"mNear\": {\r\n        type: \"f\",\r\n        value: 1.0\r\n      },\r\n      \"mFar\": {\r\n        type: \"f\",\r\n        value: 2000.0\r\n      },\r\n      \"opacity\": {\r\n        type: \"f\",\r\n        value: 1.0\r\n      }\r\n\r\n    },\r\n\r\n    vertexShader: [\r\n\r\n      THREE.ShaderChunk[\"common\"],\r\n      THREE.ShaderChunk[\"morphtarget_pars_vertex\"],\r\n      THREE.ShaderChunk[\"logdepthbuf_pars_vertex\"],\r\n\r\n      \"void main() {\",\r\n\r\n      THREE.ShaderChunk[\"morphtarget_vertex\"],\r\n      THREE.ShaderChunk[\"default_vertex\"],\r\n      THREE.ShaderChunk[\"logdepthbuf_vertex\"],\r\n\r\n      \"}\"\r\n\r\n    ].join(\"\\n\"),\r\n\r\n    fragmentShader: [\r\n\r\n      \"uniform float mNear;\",\r\n      \"uniform float mFar;\",\r\n      \"uniform float opacity;\",\r\n\r\n      THREE.ShaderChunk[\"common\"],\r\n      THREE.ShaderChunk[\"logdepthbuf_pars_fragment\"],\r\n\r\n      \"void main() {\",\r\n\r\n      THREE.ShaderChunk[\"logdepthbuf_fragment\"],\r\n\r\n      \"\t#ifdef USE_LOGDEPTHBUF_EXT\",\r\n\r\n      \"\t\tfloat depth = gl_FragDepthEXT / gl_FragCoord.w;\",\r\n\r\n      \"\t#else\",\r\n\r\n      \"\t\tfloat depth = gl_FragCoord.z / gl_FragCoord.w;\",\r\n\r\n      \"\t#endif\",\r\n\r\n      \"\tfloat color = 1.0 - smoothstep( mNear, mFar, depth );\",\r\n      \"\tgl_FragColor = vec4( vec3( color ), opacity );\", // TODO, this should be pre-multiplied to allow for bright highlights on very transparent objects\r\n\r\n      \"}\"\r\n\r\n    ].join(\"\\n\")\r\n\r\n  },\r\n\r\n  'normal': {\r\n\r\n    uniforms: {\r\n\r\n      \"opacity\": {\r\n        type: \"f\",\r\n        value: 1.0\r\n      }\r\n\r\n    },\r\n\r\n    vertexShader: [\r\n\r\n      \"varying vec3 vNormal;\",\r\n\r\n      THREE.ShaderChunk[\"common\"],\r\n      THREE.ShaderChunk[\"morphtarget_pars_vertex\"],\r\n      THREE.ShaderChunk[\"logdepthbuf_pars_vertex\"],\r\n\r\n      \"void main() {\",\r\n\r\n      \"\tvNormal = normalize( normalMatrix * normal );\",\r\n\r\n      THREE.ShaderChunk[\"morphtarget_vertex\"],\r\n      THREE.ShaderChunk[\"default_vertex\"],\r\n      THREE.ShaderChunk[\"logdepthbuf_vertex\"],\r\n\r\n      \"}\"\r\n\r\n    ].join(\"\\n\"),\r\n\r\n    fragmentShader: [\r\n\r\n      \"uniform float opacity;\",\r\n      \"varying vec3 vNormal;\",\r\n\r\n      THREE.ShaderChunk[\"common\"],\r\n      THREE.ShaderChunk[\"logdepthbuf_pars_fragment\"],\r\n\r\n      \"void main() {\",\r\n\r\n      \"\tgl_FragColor = vec4( 0.5 * normalize( vNormal ) + 0.5, opacity );\",\r\n\r\n      THREE.ShaderChunk[\"logdepthbuf_fragment\"],\r\n\r\n      \"}\"\r\n\r\n    ].join(\"\\n\")\r\n\r\n  },\r\n\r\n  /* -------------------------------------------------------------------------\r\n  //\tCube map shader\r\n   ------------------------------------------------------------------------- */\r\n\r\n  'cube': {\r\n\r\n    uniforms: {\r\n      \"tCube\": {\r\n        type: \"t\",\r\n        value: null\r\n      },\r\n      \"tFlip\": {\r\n        type: \"f\",\r\n        value: -1\r\n      }\r\n    },\r\n\r\n    vertexShader: [\r\n\r\n      \"varying vec3 vWorldPosition;\",\r\n\r\n      THREE.ShaderChunk[\"common\"],\r\n      THREE.ShaderChunk[\"logdepthbuf_pars_vertex\"],\r\n\r\n      \"void main() {\",\r\n\r\n      \"\tvWorldPosition = transformDirection( position, modelMatrix );\",\r\n\r\n      \"\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\",\r\n\r\n      THREE.ShaderChunk[\"logdepthbuf_vertex\"],\r\n\r\n      \"}\"\r\n\r\n    ].join(\"\\n\"),\r\n\r\n    fragmentShader: [\r\n\r\n      \"uniform samplerCube tCube;\",\r\n      \"uniform float tFlip;\",\r\n\r\n      \"varying vec3 vWorldPosition;\",\r\n\r\n      THREE.ShaderChunk[\"common\"],\r\n      THREE.ShaderChunk[\"logdepthbuf_pars_fragment\"],\r\n\r\n      \"void main() {\",\r\n\r\n      \"\tgl_FragColor = textureCube( tCube, vec3( tFlip * vWorldPosition.x, vWorldPosition.yz ) );\",\r\n\r\n      THREE.ShaderChunk[\"logdepthbuf_fragment\"],\r\n\r\n      \"}\"\r\n\r\n    ].join(\"\\n\")\r\n\r\n  },\r\n\r\n  /* -------------------------------------------------------------------------\r\n  //\tCube map shader\r\n   ------------------------------------------------------------------------- */\r\n\r\n  'equirect': {\r\n\r\n    uniforms: {\r\n      \"tEquirect\": {\r\n        type: \"t\",\r\n        value: null\r\n      },\r\n      \"tFlip\": {\r\n        type: \"f\",\r\n        value: -1\r\n      }\r\n    },\r\n\r\n    vertexShader: [\r\n\r\n      \"varying vec3 vWorldPosition;\",\r\n\r\n      THREE.ShaderChunk[\"common\"],\r\n      THREE.ShaderChunk[\"logdepthbuf_pars_vertex\"],\r\n\r\n      \"void main() {\",\r\n\r\n      \"\tvWorldPosition = transformDirection( position, modelMatrix );\",\r\n\r\n      \"\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\",\r\n\r\n      THREE.ShaderChunk[\"logdepthbuf_vertex\"],\r\n\r\n      \"}\"\r\n\r\n    ].join(\"\\n\"),\r\n\r\n    fragmentShader: [\r\n\r\n      \"uniform sampler2D tEquirect;\",\r\n      \"uniform float tFlip;\",\r\n\r\n      \"varying vec3 vWorldPosition;\",\r\n\r\n      THREE.ShaderChunk[\"common\"],\r\n      THREE.ShaderChunk[\"logdepthbuf_pars_fragment\"],\r\n\r\n      \"void main() {\",\r\n\r\n      // \"\tgl_FragColor = textureCube( tCube, vec3( tFlip * vWorldPosition.x, vWorldPosition.yz ) );\",\r\n      \"vec3 direction = normalize( vWorldPosition );\",\r\n      \"vec2 sampleUV;\",\r\n      \"sampleUV.y = saturate( tFlip * direction.y * -0.5 + 0.5 );\",\r\n      \"sampleUV.x = atan( direction.z, direction.x ) * RECIPROCAL_PI2 + 0.5;\",\r\n      \"gl_FragColor = texture2D( tEquirect, sampleUV );\",\r\n\r\n      THREE.ShaderChunk[\"logdepthbuf_fragment\"],\r\n\r\n      \"}\"\r\n\r\n    ].join(\"\\n\")\r\n\r\n  },\r\n\r\n  /* Depth encoding into RGBA texture\r\n   *\r\n   * based on SpiderGL shadow map example\r\n   * http://spidergl.org/example.php?id=6\r\n   *\r\n   * originally from\r\n   * http://www.gamedev.net/topic/442138-packing-a-float-into-a-a8r8g8b8-texture-shader/page__whichpage__1%25EF%25BF%25BD\r\n   *\r\n   * see also\r\n   * http://aras-p.info/blog/2009/07/30/encoding-floats-to-rgba-the-final/\r\n   */\r\n\r\n  'depthRGBA': {\r\n\r\n    uniforms: {},\r\n\r\n    vertexShader: [\r\n\r\n      THREE.ShaderChunk[\"common\"],\r\n      THREE.ShaderChunk[\"morphtarget_pars_vertex\"],\r\n      THREE.ShaderChunk[\"skinning_pars_vertex\"],\r\n      THREE.ShaderChunk[\"logdepthbuf_pars_vertex\"],\r\n\r\n      \"void main() {\",\r\n\r\n      THREE.ShaderChunk[\"skinbase_vertex\"],\r\n      THREE.ShaderChunk[\"morphtarget_vertex\"],\r\n      THREE.ShaderChunk[\"skinning_vertex\"],\r\n      THREE.ShaderChunk[\"default_vertex\"],\r\n      THREE.ShaderChunk[\"logdepthbuf_vertex\"],\r\n\r\n      \"}\"\r\n\r\n    ].join(\"\\n\"),\r\n\r\n    fragmentShader: [\r\n\r\n      THREE.ShaderChunk[\"common\"],\r\n      THREE.ShaderChunk[\"logdepthbuf_pars_fragment\"],\r\n\r\n      \"vec4 pack_depth( const in float depth ) {\",\r\n\r\n      \"\tconst vec4 bit_shift = vec4( 256.0 * 256.0 * 256.0, 256.0 * 256.0, 256.0, 1.0 );\",\r\n      \"\tconst vec4 bit_mask = vec4( 0.0, 1.0 / 256.0, 1.0 / 256.0, 1.0 / 256.0 );\",\r\n      \"\tvec4 res = mod( depth * bit_shift * vec4( 255 ), vec4( 256 ) ) / vec4( 255 );\", // \"\tvec4 res = fract( depth * bit_shift );\",\r\n      \"\tres -= res.xxyz * bit_mask;\",\r\n      \"\treturn res;\",\r\n\r\n      \"}\",\r\n\r\n      \"void main() {\",\r\n\r\n      THREE.ShaderChunk[\"logdepthbuf_fragment\"],\r\n\r\n      \"\t#ifdef USE_LOGDEPTHBUF_EXT\",\r\n\r\n      \"\t\tgl_FragData[ 0 ] = pack_depth( gl_FragDepthEXT );\",\r\n\r\n      \"\t#else\",\r\n\r\n      \"\t\tgl_FragData[ 0 ] = pack_depth( gl_FragCoord.z );\",\r\n\r\n      \"\t#endif\",\r\n\r\n      //\"gl_FragData[ 0 ] = pack_depth( gl_FragCoord.z / gl_FragCoord.w );\",\r\n      //\"float z = ( ( gl_FragCoord.z / gl_FragCoord.w ) - 3.0 ) / ( 4000.0 - 3.0 );\",\r\n      //\"gl_FragData[ 0 ] = pack_depth( z );\",\r\n      //\"gl_FragData[ 0 ] = vec4( z, z, z, 1.0 );\",\r\n\r\n      \"}\"\r\n\r\n    ].join(\"\\n\")\r\n\r\n  }\r\n\r\n};\r\n\r\n// File:src/renderers/WebGLRenderer.js\r\n\r\n/**\r\n * @author supereggbert / http://www.paulbrunt.co.uk/\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author alteredq / http://alteredqualia.com/\r\n * @author szimek / https://github.com/szimek/\r\n */\r\n\r\nTHREE.WebGLRenderer = function(parameters) {\r\n\r\n  console.log('THREE.WebGLRenderer', THREE.REVISION);\r\n\r\n  parameters = parameters || {};\r\n\r\n  var _canvas = parameters.canvas !== undefined ? parameters.canvas : document.createElement('canvas'),\r\n    _context = parameters.context !== undefined ? parameters.context : null,\r\n\r\n    pixelRatio = 1,\r\n\r\n    _precision = parameters.precision !== undefined ? parameters.precision : 'highp',\r\n\r\n    _alpha = parameters.alpha !== undefined ? parameters.alpha : false,\r\n    _depth = parameters.depth !== undefined ? parameters.depth : true,\r\n    _stencil = parameters.stencil !== undefined ? parameters.stencil : true,\r\n    _antialias = parameters.antialias !== undefined ? parameters.antialias : false,\r\n    _premultipliedAlpha = parameters.premultipliedAlpha !== undefined ? parameters.premultipliedAlpha : true,\r\n    _preserveDrawingBuffer = parameters.preserveDrawingBuffer !== undefined ? parameters.preserveDrawingBuffer : false,\r\n    _logarithmicDepthBuffer = parameters.logarithmicDepthBuffer !== undefined ? parameters.logarithmicDepthBuffer : false,\r\n\r\n    _clearColor = new THREE.Color(0x000000),\r\n    _clearAlpha = 0;\r\n\r\n  var lights = [];\r\n\r\n  var _webglObjects = {};\r\n  var _webglObjectsImmediate = [];\r\n\r\n  var opaqueObjects = [];\r\n  var transparentObjects = [];\r\n\r\n  var sprites = [];\r\n  var lensFlares = [];\r\n\r\n  // public properties\r\n\r\n  this.domElement = _canvas;\r\n  this.context = null;\r\n\r\n  // clearing\r\n\r\n  this.autoClear = true;\r\n  this.autoClearColor = true;\r\n  this.autoClearDepth = true;\r\n  this.autoClearStencil = true;\r\n\r\n  // scene graph\r\n\r\n  this.sortObjects = true;\r\n\r\n  // physically based shading\r\n\r\n  this.gammaFactor = 2.0; // for backwards compatibility\r\n  this.gammaInput = false;\r\n  this.gammaOutput = false;\r\n\r\n  // shadow map\r\n\r\n  this.shadowMapEnabled = false;\r\n  this.shadowMapType = THREE.PCFShadowMap;\r\n  this.shadowMapCullFace = THREE.CullFaceFront;\r\n  this.shadowMapDebug = false;\r\n  this.shadowMapCascade = false;\r\n\r\n  // morphs\r\n\r\n  this.maxMorphTargets = 8;\r\n  this.maxMorphNormals = 4;\r\n\r\n  // flags\r\n\r\n  this.autoScaleCubemaps = true;\r\n\r\n  // info\r\n\r\n  this.info = {\r\n\r\n    memory: {\r\n\r\n      programs: 0,\r\n      geometries: 0,\r\n      textures: 0\r\n\r\n    },\r\n\r\n    render: {\r\n\r\n      calls: 0,\r\n      vertices: 0,\r\n      faces: 0,\r\n      points: 0\r\n\r\n    }\r\n\r\n  };\r\n\r\n  // internal properties\r\n\r\n  var _this = this,\r\n\r\n    _programs = [],\r\n\r\n    // internal state cache\r\n\r\n    _currentProgram = null,\r\n    _currentFramebuffer = null,\r\n    _currentMaterialId = -1,\r\n    _currentGeometryProgram = '',\r\n    _currentCamera = null,\r\n\r\n    _usedTextureUnits = 0,\r\n\r\n    _viewportX = 0,\r\n    _viewportY = 0,\r\n    _viewportWidth = _canvas.width,\r\n    _viewportHeight = _canvas.height,\r\n    _currentWidth = 0,\r\n    _currentHeight = 0,\r\n\r\n    // frustum\r\n\r\n    _frustum = new THREE.Frustum(),\r\n\r\n    // camera matrices cache\r\n\r\n    _projScreenMatrix = new THREE.Matrix4(),\r\n\r\n    _vector3 = new THREE.Vector3(),\r\n\r\n    // light arrays cache\r\n\r\n    _direction = new THREE.Vector3(),\r\n\r\n    _lightsNeedUpdate = true,\r\n\r\n    _lights = {\r\n\r\n      ambient: [0, 0, 0],\r\n      directional: {\r\n        length: 0,\r\n        colors: [],\r\n        positions: []\r\n      },\r\n      point: {\r\n        length: 0,\r\n        colors: [],\r\n        positions: [],\r\n        distances: [],\r\n        decays: []\r\n      },\r\n      spot: {\r\n        length: 0,\r\n        colors: [],\r\n        positions: [],\r\n        distances: [],\r\n        directions: [],\r\n        anglesCos: [],\r\n        exponents: [],\r\n        decays: []\r\n      },\r\n      hemi: {\r\n        length: 0,\r\n        skyColors: [],\r\n        groundColors: [],\r\n        positions: []\r\n      }\r\n\r\n    };\r\n\r\n  // initialize\r\n\r\n  var _gl;\r\n\r\n  try {\r\n\r\n    var attributes = {\r\n      alpha: _alpha,\r\n      depth: _depth,\r\n      stencil: _stencil,\r\n      antialias: _antialias,\r\n      premultipliedAlpha: _premultipliedAlpha,\r\n      preserveDrawingBuffer: _preserveDrawingBuffer\r\n    };\r\n\r\n    _gl = _context || _canvas.getContext('webgl', attributes) || _canvas.getContext('experimental-webgl', attributes);\r\n\r\n    if (_gl === null) {\r\n\r\n      if (_canvas.getContext('webgl') !== null) {\r\n\r\n        throw 'Error creating WebGL context with your selected attributes.';\r\n\r\n      }\r\n      else {\r\n\r\n        throw 'Error creating WebGL context.';\r\n\r\n      }\r\n\r\n    }\r\n\r\n    _canvas.addEventListener('webglcontextlost', function(event) {\r\n\r\n      event.preventDefault();\r\n\r\n      resetGLState();\r\n      setDefaultGLState();\r\n\r\n      _webglObjects = {};\r\n\r\n    }, false);\r\n\r\n  }\r\n  catch (error) {\r\n\r\n    THREE.error('THREE.WebGLRenderer: ' + error);\r\n\r\n  }\r\n\r\n  var state = new THREE.WebGLState(_gl, paramThreeToGL);\r\n\r\n  if (_gl.getShaderPrecisionFormat === undefined) {\r\n\r\n    _gl.getShaderPrecisionFormat = function() {\r\n\r\n      return {\r\n        'rangeMin': 1,\r\n        'rangeMax': 1,\r\n        'precision': 1\r\n      };\r\n\r\n    }\r\n\r\n  }\r\n\r\n  var extensions = new THREE.WebGLExtensions(_gl);\r\n\r\n  extensions.get('OES_texture_float');\r\n  extensions.get('OES_texture_float_linear');\r\n  extensions.get('OES_texture_half_float');\r\n  extensions.get('OES_texture_half_float_linear');\r\n  extensions.get('OES_standard_derivatives');\r\n\r\n  if (_logarithmicDepthBuffer) {\r\n\r\n    extensions.get('EXT_frag_depth');\r\n\r\n  }\r\n\r\n  //\r\n\r\n  var glClearColor = function(r, g, b, a) {\r\n\r\n    if (_premultipliedAlpha === true) {\r\n\r\n      r *= a;\r\n      g *= a;\r\n      b *= a;\r\n\r\n    }\r\n\r\n    _gl.clearColor(r, g, b, a);\r\n\r\n  };\r\n\r\n  var setDefaultGLState = function() {\r\n\r\n    _gl.clearColor(0, 0, 0, 1);\r\n    _gl.clearDepth(1);\r\n    _gl.clearStencil(0);\r\n\r\n    _gl.enable(_gl.DEPTH_TEST);\r\n    _gl.depthFunc(_gl.LEQUAL);\r\n\r\n    _gl.frontFace(_gl.CCW);\r\n    _gl.cullFace(_gl.BACK);\r\n    _gl.enable(_gl.CULL_FACE);\r\n\r\n    _gl.enable(_gl.BLEND);\r\n    _gl.blendEquation(_gl.FUNC_ADD);\r\n    _gl.blendFunc(_gl.SRC_ALPHA, _gl.ONE_MINUS_SRC_ALPHA);\r\n\r\n    _gl.viewport(_viewportX, _viewportY, _viewportWidth, _viewportHeight);\r\n\r\n    glClearColor(_clearColor.r, _clearColor.g, _clearColor.b, _clearAlpha);\r\n\r\n  };\r\n\r\n  var resetGLState = function() {\r\n\r\n    _currentProgram = null;\r\n    _currentCamera = null;\r\n\r\n    _currentGeometryProgram = '';\r\n    _currentMaterialId = -1;\r\n\r\n    _lightsNeedUpdate = true;\r\n\r\n    state.reset();\r\n\r\n  };\r\n\r\n  setDefaultGLState();\r\n\r\n  this.context = _gl;\r\n  this.state = state;\r\n\r\n  // GPU capabilities\r\n\r\n  var _maxTextures = _gl.getParameter(_gl.MAX_TEXTURE_IMAGE_UNITS);\r\n  var _maxVertexTextures = _gl.getParameter(_gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS);\r\n  var _maxTextureSize = _gl.getParameter(_gl.MAX_TEXTURE_SIZE);\r\n  var _maxCubemapSize = _gl.getParameter(_gl.MAX_CUBE_MAP_TEXTURE_SIZE);\r\n\r\n  var _supportsVertexTextures = _maxVertexTextures > 0;\r\n  var _supportsBoneTextures = _supportsVertexTextures && extensions.get('OES_texture_float');\r\n\r\n  //\r\n\r\n  var _vertexShaderPrecisionHighpFloat = _gl.getShaderPrecisionFormat(_gl.VERTEX_SHADER, _gl.HIGH_FLOAT);\r\n  var _vertexShaderPrecisionMediumpFloat = _gl.getShaderPrecisionFormat(_gl.VERTEX_SHADER, _gl.MEDIUM_FLOAT);\r\n\r\n  var _fragmentShaderPrecisionHighpFloat = _gl.getShaderPrecisionFormat(_gl.FRAGMENT_SHADER, _gl.HIGH_FLOAT);\r\n  var _fragmentShaderPrecisionMediumpFloat = _gl.getShaderPrecisionFormat(_gl.FRAGMENT_SHADER, _gl.MEDIUM_FLOAT);\r\n\r\n  var getCompressedTextureFormats = (function() {\r\n\r\n    var array;\r\n\r\n    return function() {\r\n\r\n      if (array !== undefined) {\r\n\r\n        return array;\r\n\r\n      }\r\n\r\n      array = [];\r\n\r\n      if (extensions.get('WEBGL_compressed_texture_pvrtc') || extensions.get('WEBGL_compressed_texture_s3tc')) {\r\n\r\n        var formats = _gl.getParameter(_gl.COMPRESSED_TEXTURE_FORMATS);\r\n\r\n        for (var i = 0; i < formats.length; i++) {\r\n\r\n          array.push(formats[i]);\r\n\r\n        }\r\n\r\n      }\r\n\r\n      return array;\r\n\r\n    };\r\n\r\n  })();\r\n\r\n  // clamp precision to maximum available\r\n\r\n  var highpAvailable = _vertexShaderPrecisionHighpFloat.precision > 0 && _fragmentShaderPrecisionHighpFloat.precision > 0;\r\n  var mediumpAvailable = _vertexShaderPrecisionMediumpFloat.precision > 0 && _fragmentShaderPrecisionMediumpFloat.precision > 0;\r\n\r\n  if (_precision === 'highp' && !highpAvailable) {\r\n\r\n    if (mediumpAvailable) {\r\n\r\n      _precision = 'mediump';\r\n      THREE.warn('THREE.WebGLRenderer: highp not supported, using mediump.');\r\n\r\n    }\r\n    else {\r\n\r\n      _precision = 'lowp';\r\n      THREE.warn('THREE.WebGLRenderer: highp and mediump not supported, using lowp.');\r\n\r\n    }\r\n\r\n  }\r\n\r\n  if (_precision === 'mediump' && !mediumpAvailable) {\r\n\r\n    _precision = 'lowp';\r\n    THREE.warn('THREE.WebGLRenderer: mediump not supported, using lowp.');\r\n\r\n  }\r\n\r\n  // Plugins\r\n\r\n  var shadowMapPlugin = new THREE.ShadowMapPlugin(this, lights, _webglObjects, _webglObjectsImmediate);\r\n\r\n  var spritePlugin = new THREE.SpritePlugin(this, sprites);\r\n  var lensFlarePlugin = new THREE.LensFlarePlugin(this, lensFlares);\r\n\r\n  // API\r\n\r\n  this.getContext = function() {\r\n\r\n    return _gl;\r\n\r\n  };\r\n\r\n  this.forceContextLoss = function() {\r\n\r\n    extensions.get('WEBGL_lose_context').loseContext();\r\n\r\n  };\r\n\r\n  this.supportsVertexTextures = function() {\r\n\r\n    return _supportsVertexTextures;\r\n\r\n  };\r\n\r\n  this.supportsFloatTextures = function() {\r\n\r\n    return extensions.get('OES_texture_float');\r\n\r\n  };\r\n\r\n  this.supportsHalfFloatTextures = function() {\r\n\r\n    return extensions.get('OES_texture_half_float');\r\n\r\n  };\r\n\r\n  this.supportsStandardDerivatives = function() {\r\n\r\n    return extensions.get('OES_standard_derivatives');\r\n\r\n  };\r\n\r\n  this.supportsCompressedTextureS3TC = function() {\r\n\r\n    return extensions.get('WEBGL_compressed_texture_s3tc');\r\n\r\n  };\r\n\r\n  this.supportsCompressedTexturePVRTC = function() {\r\n\r\n    return extensions.get('WEBGL_compressed_texture_pvrtc');\r\n\r\n  };\r\n\r\n  this.supportsBlendMinMax = function() {\r\n\r\n    return extensions.get('EXT_blend_minmax');\r\n\r\n  };\r\n\r\n  this.getMaxAnisotropy = (function() {\r\n\r\n    var value;\r\n\r\n    return function() {\r\n\r\n      if (value !== undefined) {\r\n\r\n        return value;\r\n\r\n      }\r\n\r\n      var extension = extensions.get('EXT_texture_filter_anisotropic');\r\n\r\n      value = extension !== null ? _gl.getParameter(extension.MAX_TEXTURE_MAX_ANISOTROPY_EXT) : 0;\r\n\r\n      return value;\r\n\r\n    }\r\n\r\n  })();\r\n\r\n  this.getPrecision = function() {\r\n\r\n    return _precision;\r\n\r\n  };\r\n\r\n  this.getPixelRatio = function() {\r\n\r\n    return pixelRatio;\r\n\r\n  };\r\n\r\n  this.setPixelRatio = function(value) {\r\n\r\n    pixelRatio = value;\r\n\r\n  };\r\n\r\n  this.setSize = function(width, height, updateStyle) {\r\n\r\n    _canvas.width = width * pixelRatio;\r\n    _canvas.height = height * pixelRatio;\r\n\r\n    if (updateStyle !== false) {\r\n\r\n      _canvas.style.width = width + 'px';\r\n      _canvas.style.height = height + 'px';\r\n\r\n    }\r\n\r\n    this.setViewport(0, 0, width, height);\r\n\r\n  };\r\n\r\n  this.setViewport = function(x, y, width, height) {\r\n\r\n    _viewportX = x * pixelRatio;\r\n    _viewportY = y * pixelRatio;\r\n\r\n    _viewportWidth = width * pixelRatio;\r\n    _viewportHeight = height * pixelRatio;\r\n\r\n    _gl.viewport(_viewportX, _viewportY, _viewportWidth, _viewportHeight);\r\n\r\n  };\r\n\r\n  this.setScissor = function(x, y, width, height) {\r\n\r\n    _gl.scissor(\r\n      x * pixelRatio,\r\n      y * pixelRatio,\r\n      width * pixelRatio,\r\n      height * pixelRatio\r\n    );\r\n\r\n  };\r\n\r\n  this.enableScissorTest = function(enable) {\r\n\r\n    enable ? _gl.enable(_gl.SCISSOR_TEST) : _gl.disable(_gl.SCISSOR_TEST);\r\n\r\n  };\r\n\r\n  // Clearing\r\n\r\n  this.getClearColor = function() {\r\n\r\n    return _clearColor;\r\n\r\n  };\r\n\r\n  this.setClearColor = function(color, alpha) {\r\n\r\n    _clearColor.set(color);\r\n\r\n    _clearAlpha = alpha !== undefined ? alpha : 1;\r\n\r\n    glClearColor(_clearColor.r, _clearColor.g, _clearColor.b, _clearAlpha);\r\n\r\n  };\r\n\r\n  this.getClearAlpha = function() {\r\n\r\n    return _clearAlpha;\r\n\r\n  };\r\n\r\n  this.setClearAlpha = function(alpha) {\r\n\r\n    _clearAlpha = alpha;\r\n\r\n    glClearColor(_clearColor.r, _clearColor.g, _clearColor.b, _clearAlpha);\r\n\r\n  };\r\n\r\n  this.clear = function(color, depth, stencil) {\r\n\r\n    var bits = 0;\r\n\r\n    if (color === undefined || color) bits |= _gl.COLOR_BUFFER_BIT;\r\n    if (depth === undefined || depth) bits |= _gl.DEPTH_BUFFER_BIT;\r\n    if (stencil === undefined || stencil) bits |= _gl.STENCIL_BUFFER_BIT;\r\n\r\n    _gl.clear(bits);\r\n\r\n  };\r\n\r\n  this.clearColor = function() {\r\n\r\n    _gl.clear(_gl.COLOR_BUFFER_BIT);\r\n\r\n  };\r\n\r\n  this.clearDepth = function() {\r\n\r\n    _gl.clear(_gl.DEPTH_BUFFER_BIT);\r\n\r\n  };\r\n\r\n  this.clearStencil = function() {\r\n\r\n    _gl.clear(_gl.STENCIL_BUFFER_BIT);\r\n\r\n  };\r\n\r\n  this.clearTarget = function(renderTarget, color, depth, stencil) {\r\n\r\n    this.setRenderTarget(renderTarget);\r\n    this.clear(color, depth, stencil);\r\n\r\n  };\r\n\r\n  // Reset\r\n\r\n  this.resetGLState = resetGLState;\r\n\r\n  // Buffer allocation\r\n\r\n  function createParticleBuffers(geometry) {\r\n\r\n    geometry.__webglVertexBuffer = _gl.createBuffer();\r\n    geometry.__webglColorBuffer = _gl.createBuffer();\r\n\r\n    _this.info.memory.geometries++;\r\n\r\n  };\r\n\r\n  function createLineBuffers(geometry) {\r\n\r\n    geometry.__webglVertexBuffer = _gl.createBuffer();\r\n    geometry.__webglColorBuffer = _gl.createBuffer();\r\n    geometry.__webglLineDistanceBuffer = _gl.createBuffer();\r\n\r\n    _this.info.memory.geometries++;\r\n\r\n  };\r\n\r\n  function createMeshBuffers(geometryGroup) {\r\n\r\n    geometryGroup.__webglVertexBuffer = _gl.createBuffer();\r\n    geometryGroup.__webglNormalBuffer = _gl.createBuffer();\r\n    geometryGroup.__webglTangentBuffer = _gl.createBuffer();\r\n    geometryGroup.__webglColorBuffer = _gl.createBuffer();\r\n    geometryGroup.__webglUVBuffer = _gl.createBuffer();\r\n    geometryGroup.__webglUV2Buffer = _gl.createBuffer();\r\n\r\n    geometryGroup.__webglSkinIndicesBuffer = _gl.createBuffer();\r\n    geometryGroup.__webglSkinWeightsBuffer = _gl.createBuffer();\r\n\r\n    geometryGroup.__webglFaceBuffer = _gl.createBuffer();\r\n    geometryGroup.__webglLineBuffer = _gl.createBuffer();\r\n\r\n    var numMorphTargets = geometryGroup.numMorphTargets;\r\n\r\n    if (numMorphTargets) {\r\n\r\n      geometryGroup.__webglMorphTargetsBuffers = [];\r\n\r\n      for (var m = 0, ml = numMorphTargets; m < ml; m++) {\r\n\r\n        geometryGroup.__webglMorphTargetsBuffers.push(_gl.createBuffer());\r\n\r\n      }\r\n\r\n    }\r\n\r\n    var numMorphNormals = geometryGroup.numMorphNormals;\r\n\r\n    if (numMorphNormals) {\r\n\r\n      geometryGroup.__webglMorphNormalsBuffers = [];\r\n\r\n      for (var m = 0, ml = numMorphNormals; m < ml; m++) {\r\n\r\n        geometryGroup.__webglMorphNormalsBuffers.push(_gl.createBuffer());\r\n\r\n      }\r\n\r\n    }\r\n\r\n    _this.info.memory.geometries++;\r\n\r\n  };\r\n\r\n  // Events\r\n\r\n  var onObjectRemoved = function(event) {\r\n\r\n    var object = event.target;\r\n\r\n    object.traverse(function(child) {\r\n\r\n      child.removeEventListener('remove', onObjectRemoved);\r\n\r\n      removeObject(child);\r\n\r\n    });\r\n\r\n  };\r\n\r\n  var onGeometryDispose = function(event) {\r\n\r\n    var geometry = event.target;\r\n\r\n    geometry.removeEventListener('dispose', onGeometryDispose);\r\n\r\n    deallocateGeometry(geometry);\r\n\r\n  };\r\n\r\n  var onTextureDispose = function(event) {\r\n\r\n    var texture = event.target;\r\n\r\n    texture.removeEventListener('dispose', onTextureDispose);\r\n\r\n    deallocateTexture(texture);\r\n\r\n    _this.info.memory.textures--;\r\n\r\n\r\n  };\r\n\r\n  var onRenderTargetDispose = function(event) {\r\n\r\n    var renderTarget = event.target;\r\n\r\n    renderTarget.removeEventListener('dispose', onRenderTargetDispose);\r\n\r\n    deallocateRenderTarget(renderTarget);\r\n\r\n    _this.info.memory.textures--;\r\n\r\n  };\r\n\r\n  var onMaterialDispose = function(event) {\r\n\r\n    var material = event.target;\r\n\r\n    material.removeEventListener('dispose', onMaterialDispose);\r\n\r\n    deallocateMaterial(material);\r\n\r\n  };\r\n\r\n  // Buffer deallocation\r\n\r\n  var deleteBuffers = function(geometry) {\r\n\r\n    var buffers = [\r\n      '__webglVertexBuffer',\r\n      '__webglNormalBuffer',\r\n      '__webglTangentBuffer',\r\n      '__webglColorBuffer',\r\n      '__webglUVBuffer',\r\n      '__webglUV2Buffer',\r\n\r\n      '__webglSkinIndicesBuffer',\r\n      '__webglSkinWeightsBuffer',\r\n\r\n      '__webglFaceBuffer',\r\n      '__webglLineBuffer',\r\n\r\n      '__webglLineDistanceBuffer'\r\n    ];\r\n\r\n    for (var i = 0, l = buffers.length; i < l; i++) {\r\n\r\n      var name = buffers[i];\r\n\r\n      if (geometry[name] !== undefined) {\r\n\r\n        _gl.deleteBuffer(geometry[name]);\r\n\r\n        delete geometry[name];\r\n\r\n      }\r\n\r\n    }\r\n\r\n    // custom attributes\r\n\r\n    if (geometry.__webglCustomAttributesList !== undefined) {\r\n\r\n      for (var name in geometry.__webglCustomAttributesList) {\r\n\r\n        _gl.deleteBuffer(geometry.__webglCustomAttributesList[name].buffer);\r\n\r\n      }\r\n\r\n      delete geometry.__webglCustomAttributesList;\r\n\r\n    }\r\n\r\n    _this.info.memory.geometries--;\r\n\r\n  };\r\n\r\n  var deallocateGeometry = function(geometry) {\r\n\r\n    delete geometry.__webglInit;\r\n\r\n    if (geometry instanceof THREE.BufferGeometry) {\r\n\r\n      for (var name in geometry.attributes) {\r\n\r\n        var attribute = geometry.attributes[name];\r\n\r\n        if (attribute.buffer !== undefined) {\r\n\r\n          _gl.deleteBuffer(attribute.buffer);\r\n\r\n          delete attribute.buffer;\r\n\r\n        }\r\n\r\n      }\r\n\r\n      _this.info.memory.geometries--;\r\n\r\n    }\r\n    else {\r\n\r\n      var geometryGroupsList = geometryGroups[geometry.id];\r\n\r\n      if (geometryGroupsList !== undefined) {\r\n\r\n        for (var i = 0, l = geometryGroupsList.length; i < l; i++) {\r\n\r\n          var geometryGroup = geometryGroupsList[i];\r\n\r\n          if (geometryGroup.numMorphTargets !== undefined) {\r\n\r\n            for (var m = 0, ml = geometryGroup.numMorphTargets; m < ml; m++) {\r\n\r\n              _gl.deleteBuffer(geometryGroup.__webglMorphTargetsBuffers[m]);\r\n\r\n            }\r\n\r\n            delete geometryGroup.__webglMorphTargetsBuffers;\r\n\r\n          }\r\n\r\n          if (geometryGroup.numMorphNormals !== undefined) {\r\n\r\n            for (var m = 0, ml = geometryGroup.numMorphNormals; m < ml; m++) {\r\n\r\n              _gl.deleteBuffer(geometryGroup.__webglMorphNormalsBuffers[m]);\r\n\r\n            }\r\n\r\n            delete geometryGroup.__webglMorphNormalsBuffers;\r\n\r\n          }\r\n\r\n          deleteBuffers(geometryGroup);\r\n\r\n        }\r\n\r\n        delete geometryGroups[geometry.id];\r\n\r\n      }\r\n      else {\r\n\r\n        deleteBuffers(geometry);\r\n\r\n      }\r\n\r\n    }\r\n\r\n    // TOFIX: Workaround for deleted geometry being currently bound\r\n\r\n    _currentGeometryProgram = '';\r\n\r\n  };\r\n\r\n  var deallocateTexture = function(texture) {\r\n\r\n    if (texture.image && texture.image.__webglTextureCube) {\r\n\r\n      // cube texture\r\n\r\n      _gl.deleteTexture(texture.image.__webglTextureCube);\r\n\r\n      delete texture.image.__webglTextureCube;\r\n\r\n    }\r\n    else {\r\n\r\n      // 2D texture\r\n\r\n      if (texture.__webglInit === undefined) return;\r\n\r\n      _gl.deleteTexture(texture.__webglTexture);\r\n\r\n      delete texture.__webglTexture;\r\n      delete texture.__webglInit;\r\n\r\n    }\r\n\r\n  };\r\n\r\n  var deallocateRenderTarget = function(renderTarget) {\r\n\r\n    if (!renderTarget || renderTarget.__webglTexture === undefined) return;\r\n\r\n    _gl.deleteTexture(renderTarget.__webglTexture);\r\n\r\n    delete renderTarget.__webglTexture;\r\n\r\n    if (renderTarget instanceof THREE.WebGLRenderTargetCube) {\r\n\r\n      for (var i = 0; i < 6; i++) {\r\n\r\n        _gl.deleteFramebuffer(renderTarget.__webglFramebuffer[i]);\r\n        _gl.deleteRenderbuffer(renderTarget.__webglRenderbuffer[i]);\r\n\r\n      }\r\n\r\n    }\r\n    else {\r\n\r\n      _gl.deleteFramebuffer(renderTarget.__webglFramebuffer);\r\n      _gl.deleteRenderbuffer(renderTarget.__webglRenderbuffer);\r\n\r\n    }\r\n\r\n    delete renderTarget.__webglFramebuffer;\r\n    delete renderTarget.__webglRenderbuffer;\r\n\r\n  };\r\n\r\n  var deallocateMaterial = function(material) {\r\n\r\n    var program = material.program.program;\r\n\r\n    if (program === undefined) return;\r\n\r\n    material.program = undefined;\r\n\r\n    // only deallocate GL program if this was the last use of shared program\r\n    // assumed there is only single copy of any program in the _programs list\r\n    // (that's how it's constructed)\r\n\r\n    var i, il, programInfo;\r\n    var deleteProgram = false;\r\n\r\n    for (i = 0, il = _programs.length; i < il; i++) {\r\n\r\n      programInfo = _programs[i];\r\n\r\n      if (programInfo.program === program) {\r\n\r\n        programInfo.usedTimes--;\r\n\r\n        if (programInfo.usedTimes === 0) {\r\n\r\n          deleteProgram = true;\r\n\r\n        }\r\n\r\n        break;\r\n\r\n      }\r\n\r\n    }\r\n\r\n    if (deleteProgram === true) {\r\n\r\n      // avoid using array.splice, this is costlier than creating new array from scratch\r\n\r\n      var newPrograms = [];\r\n\r\n      for (i = 0, il = _programs.length; i < il; i++) {\r\n\r\n        programInfo = _programs[i];\r\n\r\n        if (programInfo.program !== program) {\r\n\r\n          newPrograms.push(programInfo);\r\n\r\n        }\r\n\r\n      }\r\n\r\n      _programs = newPrograms;\r\n\r\n      _gl.deleteProgram(program);\r\n\r\n      _this.info.memory.programs--;\r\n\r\n    }\r\n\r\n  };\r\n\r\n  // Buffer initialization\r\n\r\n  function initCustomAttributes(object) {\r\n\r\n    var geometry = object.geometry;\r\n    var material = object.material;\r\n\r\n    var nvertices = geometry.vertices.length;\r\n\r\n    if (material.attributes) {\r\n\r\n      if (geometry.__webglCustomAttributesList === undefined) {\r\n\r\n        geometry.__webglCustomAttributesList = [];\r\n\r\n      }\r\n\r\n      for (var name in material.attributes) {\r\n\r\n        var attribute = material.attributes[name];\r\n\r\n        if (!attribute.__webglInitialized || attribute.createUniqueBuffers) {\r\n\r\n          attribute.__webglInitialized = true;\r\n\r\n          var size = 1; // \"f\" and \"i\"\r\n\r\n          if (attribute.type === 'v2') size = 2;\r\n          else if (attribute.type === 'v3') size = 3;\r\n          else if (attribute.type === 'v4') size = 4;\r\n          else if (attribute.type === 'c') size = 3;\r\n\r\n          attribute.size = size;\r\n\r\n          attribute.array = new Float32Array(nvertices * size);\r\n\r\n          attribute.buffer = _gl.createBuffer();\r\n          attribute.buffer.belongsToAttribute = name;\r\n\r\n          attribute.needsUpdate = true;\r\n\r\n        }\r\n\r\n        geometry.__webglCustomAttributesList.push(attribute);\r\n\r\n      }\r\n\r\n    }\r\n\r\n  };\r\n\r\n  function initParticleBuffers(geometry, object) {\r\n\r\n    var nvertices = geometry.vertices.length;\r\n\r\n    geometry.__vertexArray = new Float32Array(nvertices * 3);\r\n    geometry.__colorArray = new Float32Array(nvertices * 3);\r\n\r\n    geometry.__webglParticleCount = nvertices;\r\n\r\n    initCustomAttributes(object);\r\n\r\n  };\r\n\r\n  function initLineBuffers(geometry, object) {\r\n\r\n    var nvertices = geometry.vertices.length;\r\n\r\n    geometry.__vertexArray = new Float32Array(nvertices * 3);\r\n    geometry.__colorArray = new Float32Array(nvertices * 3);\r\n    geometry.__lineDistanceArray = new Float32Array(nvertices * 1);\r\n\r\n    geometry.__webglLineCount = nvertices;\r\n\r\n    initCustomAttributes(object);\r\n\r\n  };\r\n\r\n  function initMeshBuffers(geometryGroup, object) {\r\n\r\n    var geometry = object.geometry,\r\n      faces3 = geometryGroup.faces3,\r\n\r\n      nvertices = faces3.length * 3,\r\n      ntris = faces3.length * 1,\r\n      nlines = faces3.length * 3,\r\n\r\n      material = getBufferMaterial(object, geometryGroup);\r\n\r\n    geometryGroup.__vertexArray = new Float32Array(nvertices * 3);\r\n    geometryGroup.__normalArray = new Float32Array(nvertices * 3);\r\n    geometryGroup.__colorArray = new Float32Array(nvertices * 3);\r\n    geometryGroup.__uvArray = new Float32Array(nvertices * 2);\r\n\r\n    if (geometry.faceVertexUvs.length > 1) {\r\n\r\n      geometryGroup.__uv2Array = new Float32Array(nvertices * 2);\r\n\r\n    }\r\n\r\n    if (geometry.hasTangents) {\r\n\r\n      geometryGroup.__tangentArray = new Float32Array(nvertices * 4);\r\n\r\n    }\r\n\r\n    if (object.geometry.skinWeights.length && object.geometry.skinIndices.length) {\r\n\r\n      geometryGroup.__skinIndexArray = new Float32Array(nvertices * 4);\r\n      geometryGroup.__skinWeightArray = new Float32Array(nvertices * 4);\r\n\r\n    }\r\n\r\n    var UintArray = extensions.get('OES_element_index_uint') !== null && ntris > 21845 ? Uint32Array : Uint16Array; // 65535 / 3\r\n\r\n    geometryGroup.__typeArray = UintArray;\r\n    geometryGroup.__faceArray = new UintArray(ntris * 3);\r\n    geometryGroup.__lineArray = new UintArray(nlines * 2);\r\n\r\n    var numMorphTargets = geometryGroup.numMorphTargets;\r\n\r\n    if (numMorphTargets) {\r\n\r\n      geometryGroup.__morphTargetsArrays = [];\r\n\r\n      for (var m = 0, ml = numMorphTargets; m < ml; m++) {\r\n\r\n        geometryGroup.__morphTargetsArrays.push(new Float32Array(nvertices * 3));\r\n\r\n      }\r\n\r\n    }\r\n\r\n    var numMorphNormals = geometryGroup.numMorphNormals;\r\n\r\n    if (numMorphNormals) {\r\n\r\n      geometryGroup.__morphNormalsArrays = [];\r\n\r\n      for (var m = 0, ml = numMorphNormals; m < ml; m++) {\r\n\r\n        geometryGroup.__morphNormalsArrays.push(new Float32Array(nvertices * 3));\r\n\r\n      }\r\n\r\n    }\r\n\r\n    geometryGroup.__webglFaceCount = ntris * 3;\r\n    geometryGroup.__webglLineCount = nlines * 2;\r\n\r\n\r\n    // custom attributes\r\n\r\n    if (material.attributes) {\r\n\r\n      if (geometryGroup.__webglCustomAttributesList === undefined) {\r\n\r\n        geometryGroup.__webglCustomAttributesList = [];\r\n\r\n      }\r\n\r\n      for (var name in material.attributes) {\r\n\r\n        // Do a shallow copy of the attribute object so different geometryGroup chunks use different\r\n        // attribute buffers which are correctly indexed in the setMeshBuffers function\r\n\r\n        var originalAttribute = material.attributes[name];\r\n\r\n        var attribute = {};\r\n\r\n        for (var property in originalAttribute) {\r\n\r\n          attribute[property] = originalAttribute[property];\r\n\r\n        }\r\n\r\n        if (!attribute.__webglInitialized || attribute.createUniqueBuffers) {\r\n\r\n          attribute.__webglInitialized = true;\r\n\r\n          var size = 1; // \"f\" and \"i\"\r\n\r\n          if (attribute.type === 'v2') size = 2;\r\n          else if (attribute.type === 'v3') size = 3;\r\n          else if (attribute.type === 'v4') size = 4;\r\n          else if (attribute.type === 'c') size = 3;\r\n\r\n          attribute.size = size;\r\n\r\n          attribute.array = new Float32Array(nvertices * size);\r\n\r\n          attribute.buffer = _gl.createBuffer();\r\n          attribute.buffer.belongsToAttribute = name;\r\n\r\n          originalAttribute.needsUpdate = true;\r\n          attribute.__original = originalAttribute;\r\n\r\n        }\r\n\r\n        geometryGroup.__webglCustomAttributesList.push(attribute);\r\n\r\n      }\r\n\r\n    }\r\n\r\n    geometryGroup.__inittedArrays = true;\r\n\r\n  };\r\n\r\n  function getBufferMaterial(object, geometryGroup) {\r\n\r\n    return object.material instanceof THREE.MeshFaceMaterial ? object.material.materials[geometryGroup.materialIndex] : object.material;\r\n\r\n  }\r\n\r\n  function materialNeedsFaceNormals(material) {\r\n\r\n    return material instanceof THREE.MeshPhongMaterial === false && material.shading === THREE.FlatShading;\r\n\r\n  }\r\n\r\n  // Buffer setting\r\n\r\n  function setParticleBuffers(geometry, hint, object) {\r\n\r\n    var v, c, vertex, offset, color,\r\n\r\n      vertices = geometry.vertices,\r\n      vl = vertices.length,\r\n\r\n      colors = geometry.colors,\r\n      cl = colors.length,\r\n\r\n      vertexArray = geometry.__vertexArray,\r\n      colorArray = geometry.__colorArray,\r\n\r\n      dirtyVertices = geometry.verticesNeedUpdate,\r\n      dirtyColors = geometry.colorsNeedUpdate,\r\n\r\n      customAttributes = geometry.__webglCustomAttributesList,\r\n      i, il,\r\n      ca, cal, value,\r\n      customAttribute;\r\n\r\n    if (dirtyVertices) {\r\n\r\n      for (v = 0; v < vl; v++) {\r\n\r\n        vertex = vertices[v];\r\n\r\n        offset = v * 3;\r\n\r\n        vertexArray[offset] = vertex.x;\r\n        vertexArray[offset + 1] = vertex.y;\r\n        vertexArray[offset + 2] = vertex.z;\r\n\r\n      }\r\n\r\n      _gl.bindBuffer(_gl.ARRAY_BUFFER, geometry.__webglVertexBuffer);\r\n      _gl.bufferData(_gl.ARRAY_BUFFER, vertexArray, hint);\r\n\r\n    }\r\n\r\n    if (dirtyColors) {\r\n\r\n      for (c = 0; c < cl; c++) {\r\n\r\n        color = colors[c];\r\n\r\n        offset = c * 3;\r\n\r\n        colorArray[offset] = color.r;\r\n        colorArray[offset + 1] = color.g;\r\n        colorArray[offset + 2] = color.b;\r\n\r\n      }\r\n\r\n      _gl.bindBuffer(_gl.ARRAY_BUFFER, geometry.__webglColorBuffer);\r\n      _gl.bufferData(_gl.ARRAY_BUFFER, colorArray, hint);\r\n\r\n    }\r\n\r\n    if (customAttributes) {\r\n\r\n      for (i = 0, il = customAttributes.length; i < il; i++) {\r\n\r\n        customAttribute = customAttributes[i];\r\n\r\n        if (customAttribute.needsUpdate && (customAttribute.boundTo === undefined || customAttribute.boundTo === 'vertices')) {\r\n\r\n          cal = customAttribute.value.length;\r\n\r\n          offset = 0;\r\n\r\n          if (customAttribute.size === 1) {\r\n\r\n            for (ca = 0; ca < cal; ca++) {\r\n\r\n              customAttribute.array[ca] = customAttribute.value[ca];\r\n\r\n            }\r\n\r\n          }\r\n          else if (customAttribute.size === 2) {\r\n\r\n            for (ca = 0; ca < cal; ca++) {\r\n\r\n              value = customAttribute.value[ca];\r\n\r\n              customAttribute.array[offset] = value.x;\r\n              customAttribute.array[offset + 1] = value.y;\r\n\r\n              offset += 2;\r\n\r\n            }\r\n\r\n          }\r\n          else if (customAttribute.size === 3) {\r\n\r\n            if (customAttribute.type === 'c') {\r\n\r\n              for (ca = 0; ca < cal; ca++) {\r\n\r\n                value = customAttribute.value[ca];\r\n\r\n                customAttribute.array[offset] = value.r;\r\n                customAttribute.array[offset + 1] = value.g;\r\n                customAttribute.array[offset + 2] = value.b;\r\n\r\n                offset += 3;\r\n\r\n              }\r\n\r\n            }\r\n            else {\r\n\r\n              for (ca = 0; ca < cal; ca++) {\r\n\r\n                value = customAttribute.value[ca];\r\n\r\n                customAttribute.array[offset] = value.x;\r\n                customAttribute.array[offset + 1] = value.y;\r\n                customAttribute.array[offset + 2] = value.z;\r\n\r\n                offset += 3;\r\n\r\n              }\r\n\r\n            }\r\n\r\n          }\r\n          else if (customAttribute.size === 4) {\r\n\r\n            for (ca = 0; ca < cal; ca++) {\r\n\r\n              value = customAttribute.value[ca];\r\n\r\n              customAttribute.array[offset] = value.x;\r\n              customAttribute.array[offset + 1] = value.y;\r\n              customAttribute.array[offset + 2] = value.z;\r\n              customAttribute.array[offset + 3] = value.w;\r\n\r\n              offset += 4;\r\n\r\n            }\r\n\r\n          }\r\n\r\n        }\r\n\r\n        _gl.bindBuffer(_gl.ARRAY_BUFFER, customAttribute.buffer);\r\n        _gl.bufferData(_gl.ARRAY_BUFFER, customAttribute.array, hint);\r\n\r\n        customAttribute.needsUpdate = false;\r\n\r\n      }\r\n\r\n    }\r\n\r\n  }\r\n\r\n  function setLineBuffers(geometry, hint) {\r\n\r\n    var v, c, d, vertex, offset, color,\r\n\r\n      vertices = geometry.vertices,\r\n      colors = geometry.colors,\r\n      lineDistances = geometry.lineDistances,\r\n\r\n      vl = vertices.length,\r\n      cl = colors.length,\r\n      dl = lineDistances.length,\r\n\r\n      vertexArray = geometry.__vertexArray,\r\n      colorArray = geometry.__colorArray,\r\n      lineDistanceArray = geometry.__lineDistanceArray,\r\n\r\n      dirtyVertices = geometry.verticesNeedUpdate,\r\n      dirtyColors = geometry.colorsNeedUpdate,\r\n      dirtyLineDistances = geometry.lineDistancesNeedUpdate,\r\n\r\n      customAttributes = geometry.__webglCustomAttributesList,\r\n\r\n      i, il,\r\n      ca, cal, value,\r\n      customAttribute;\r\n\r\n    if (dirtyVertices) {\r\n\r\n      for (v = 0; v < vl; v++) {\r\n\r\n        vertex = vertices[v];\r\n\r\n        offset = v * 3;\r\n\r\n        vertexArray[offset] = vertex.x;\r\n        vertexArray[offset + 1] = vertex.y;\r\n        vertexArray[offset + 2] = vertex.z;\r\n\r\n      }\r\n\r\n      _gl.bindBuffer(_gl.ARRAY_BUFFER, geometry.__webglVertexBuffer);\r\n      _gl.bufferData(_gl.ARRAY_BUFFER, vertexArray, hint);\r\n\r\n    }\r\n\r\n    if (dirtyColors) {\r\n\r\n      for (c = 0; c < cl; c++) {\r\n\r\n        color = colors[c];\r\n\r\n        offset = c * 3;\r\n\r\n        colorArray[offset] = color.r;\r\n        colorArray[offset + 1] = color.g;\r\n        colorArray[offset + 2] = color.b;\r\n\r\n      }\r\n\r\n      _gl.bindBuffer(_gl.ARRAY_BUFFER, geometry.__webglColorBuffer);\r\n      _gl.bufferData(_gl.ARRAY_BUFFER, colorArray, hint);\r\n\r\n    }\r\n\r\n    if (dirtyLineDistances) {\r\n\r\n      for (d = 0; d < dl; d++) {\r\n\r\n        lineDistanceArray[d] = lineDistances[d];\r\n\r\n      }\r\n\r\n      _gl.bindBuffer(_gl.ARRAY_BUFFER, geometry.__webglLineDistanceBuffer);\r\n      _gl.bufferData(_gl.ARRAY_BUFFER, lineDistanceArray, hint);\r\n\r\n    }\r\n\r\n    if (customAttributes) {\r\n\r\n      for (i = 0, il = customAttributes.length; i < il; i++) {\r\n\r\n        customAttribute = customAttributes[i];\r\n\r\n        if (customAttribute.needsUpdate && (customAttribute.boundTo === undefined || customAttribute.boundTo === 'vertices')) {\r\n\r\n          offset = 0;\r\n\r\n          cal = customAttribute.value.length;\r\n\r\n          if (customAttribute.size === 1) {\r\n\r\n            for (ca = 0; ca < cal; ca++) {\r\n\r\n              customAttribute.array[ca] = customAttribute.value[ca];\r\n\r\n            }\r\n\r\n          }\r\n          else if (customAttribute.size === 2) {\r\n\r\n            for (ca = 0; ca < cal; ca++) {\r\n\r\n              value = customAttribute.value[ca];\r\n\r\n              customAttribute.array[offset] = value.x;\r\n              customAttribute.array[offset + 1] = value.y;\r\n\r\n              offset += 2;\r\n\r\n            }\r\n\r\n          }\r\n          else if (customAttribute.size === 3) {\r\n\r\n            if (customAttribute.type === 'c') {\r\n\r\n              for (ca = 0; ca < cal; ca++) {\r\n\r\n                value = customAttribute.value[ca];\r\n\r\n                customAttribute.array[offset] = value.r;\r\n                customAttribute.array[offset + 1] = value.g;\r\n                customAttribute.array[offset + 2] = value.b;\r\n\r\n                offset += 3;\r\n\r\n              }\r\n\r\n            }\r\n            else {\r\n\r\n              for (ca = 0; ca < cal; ca++) {\r\n\r\n                value = customAttribute.value[ca];\r\n\r\n                customAttribute.array[offset] = value.x;\r\n                customAttribute.array[offset + 1] = value.y;\r\n                customAttribute.array[offset + 2] = value.z;\r\n\r\n                offset += 3;\r\n\r\n              }\r\n\r\n            }\r\n\r\n          }\r\n          else if (customAttribute.size === 4) {\r\n\r\n            for (ca = 0; ca < cal; ca++) {\r\n\r\n              value = customAttribute.value[ca];\r\n\r\n              customAttribute.array[offset] = value.x;\r\n              customAttribute.array[offset + 1] = value.y;\r\n              customAttribute.array[offset + 2] = value.z;\r\n              customAttribute.array[offset + 3] = value.w;\r\n\r\n              offset += 4;\r\n\r\n            }\r\n\r\n          }\r\n\r\n          _gl.bindBuffer(_gl.ARRAY_BUFFER, customAttribute.buffer);\r\n          _gl.bufferData(_gl.ARRAY_BUFFER, customAttribute.array, hint);\r\n\r\n          customAttribute.needsUpdate = false;\r\n\r\n        }\r\n\r\n      }\r\n\r\n    }\r\n\r\n  }\r\n\r\n  function setMeshBuffers(geometryGroup, object, hint, dispose, material) {\r\n\r\n    if (!geometryGroup.__inittedArrays) {\r\n\r\n      return;\r\n\r\n    }\r\n\r\n    var needsFaceNormals = materialNeedsFaceNormals(material);\r\n\r\n    var f, fl, fi, face,\r\n      vertexNormals, faceNormal,\r\n      vertexColors, faceColor,\r\n      vertexTangents,\r\n      uv, uv2, v1, v2, v3, t1, t2, t3, n1, n2, n3,\r\n      c1, c2, c3,\r\n      sw1, sw2, sw3,\r\n      si1, si2, si3,\r\n      i, il,\r\n      vn, uvi, uv2i,\r\n      vk, vkl, vka,\r\n      nka, chf, faceVertexNormals,\r\n\r\n      vertexIndex = 0,\r\n\r\n      offset = 0,\r\n      offset_uv = 0,\r\n      offset_uv2 = 0,\r\n      offset_face = 0,\r\n      offset_normal = 0,\r\n      offset_tangent = 0,\r\n      offset_line = 0,\r\n      offset_color = 0,\r\n      offset_skin = 0,\r\n      offset_morphTarget = 0,\r\n      offset_custom = 0,\r\n\r\n      value,\r\n\r\n      vertexArray = geometryGroup.__vertexArray,\r\n      uvArray = geometryGroup.__uvArray,\r\n      uv2Array = geometryGroup.__uv2Array,\r\n      normalArray = geometryGroup.__normalArray,\r\n      tangentArray = geometryGroup.__tangentArray,\r\n      colorArray = geometryGroup.__colorArray,\r\n\r\n      skinIndexArray = geometryGroup.__skinIndexArray,\r\n      skinWeightArray = geometryGroup.__skinWeightArray,\r\n\r\n      morphTargetsArrays = geometryGroup.__morphTargetsArrays,\r\n      morphNormalsArrays = geometryGroup.__morphNormalsArrays,\r\n\r\n      customAttributes = geometryGroup.__webglCustomAttributesList,\r\n      customAttribute,\r\n\r\n      faceArray = geometryGroup.__faceArray,\r\n      lineArray = geometryGroup.__lineArray,\r\n\r\n      geometry = object.geometry, // this is shared for all chunks\r\n\r\n      dirtyVertices = geometry.verticesNeedUpdate,\r\n      dirtyElements = geometry.elementsNeedUpdate,\r\n      dirtyUvs = geometry.uvsNeedUpdate,\r\n      dirtyNormals = geometry.normalsNeedUpdate,\r\n      dirtyTangents = geometry.tangentsNeedUpdate,\r\n      dirtyColors = geometry.colorsNeedUpdate,\r\n      dirtyMorphTargets = geometry.morphTargetsNeedUpdate,\r\n\r\n      vertices = geometry.vertices,\r\n      chunk_faces3 = geometryGroup.faces3,\r\n      obj_faces = geometry.faces,\r\n\r\n      obj_uvs = geometry.faceVertexUvs[0],\r\n      obj_uvs2 = geometry.faceVertexUvs[1],\r\n\r\n      obj_skinIndices = geometry.skinIndices,\r\n      obj_skinWeights = geometry.skinWeights,\r\n\r\n      morphTargets = geometry.morphTargets,\r\n      morphNormals = geometry.morphNormals;\r\n\r\n    if (dirtyVertices) {\r\n\r\n      for (f = 0, fl = chunk_faces3.length; f < fl; f++) {\r\n\r\n        face = obj_faces[chunk_faces3[f]];\r\n\r\n        v1 = vertices[face.a];\r\n        v2 = vertices[face.b];\r\n        v3 = vertices[face.c];\r\n\r\n        vertexArray[offset] = v1.x;\r\n        vertexArray[offset + 1] = v1.y;\r\n        vertexArray[offset + 2] = v1.z;\r\n\r\n        vertexArray[offset + 3] = v2.x;\r\n        vertexArray[offset + 4] = v2.y;\r\n        vertexArray[offset + 5] = v2.z;\r\n\r\n        vertexArray[offset + 6] = v3.x;\r\n        vertexArray[offset + 7] = v3.y;\r\n        vertexArray[offset + 8] = v3.z;\r\n\r\n        offset += 9;\r\n\r\n      }\r\n\r\n      _gl.bindBuffer(_gl.ARRAY_BUFFER, geometryGroup.__webglVertexBuffer);\r\n      _gl.bufferData(_gl.ARRAY_BUFFER, vertexArray, hint);\r\n\r\n    }\r\n\r\n    if (dirtyMorphTargets) {\r\n\r\n      for (vk = 0, vkl = morphTargets.length; vk < vkl; vk++) {\r\n\r\n        offset_morphTarget = 0;\r\n\r\n        for (f = 0, fl = chunk_faces3.length; f < fl; f++) {\r\n\r\n          chf = chunk_faces3[f];\r\n          face = obj_faces[chf];\r\n\r\n          // morph positions\r\n\r\n          v1 = morphTargets[vk].vertices[face.a];\r\n          v2 = morphTargets[vk].vertices[face.b];\r\n          v3 = morphTargets[vk].vertices[face.c];\r\n\r\n          vka = morphTargetsArrays[vk];\r\n\r\n          vka[offset_morphTarget] = v1.x;\r\n          vka[offset_morphTarget + 1] = v1.y;\r\n          vka[offset_morphTarget + 2] = v1.z;\r\n\r\n          vka[offset_morphTarget + 3] = v2.x;\r\n          vka[offset_morphTarget + 4] = v2.y;\r\n          vka[offset_morphTarget + 5] = v2.z;\r\n\r\n          vka[offset_morphTarget + 6] = v3.x;\r\n          vka[offset_morphTarget + 7] = v3.y;\r\n          vka[offset_morphTarget + 8] = v3.z;\r\n\r\n          // morph normals\r\n\r\n          if (material.morphNormals) {\r\n\r\n            if (needsFaceNormals) {\r\n\r\n              n1 = morphNormals[vk].faceNormals[chf];\r\n              n2 = n1;\r\n              n3 = n1;\r\n\r\n            }\r\n            else {\r\n\r\n              faceVertexNormals = morphNormals[vk].vertexNormals[chf];\r\n\r\n              n1 = faceVertexNormals.a;\r\n              n2 = faceVertexNormals.b;\r\n              n3 = faceVertexNormals.c;\r\n\r\n            }\r\n\r\n            nka = morphNormalsArrays[vk];\r\n\r\n            nka[offset_morphTarget] = n1.x;\r\n            nka[offset_morphTarget + 1] = n1.y;\r\n            nka[offset_morphTarget + 2] = n1.z;\r\n\r\n            nka[offset_morphTarget + 3] = n2.x;\r\n            nka[offset_morphTarget + 4] = n2.y;\r\n            nka[offset_morphTarget + 5] = n2.z;\r\n\r\n            nka[offset_morphTarget + 6] = n3.x;\r\n            nka[offset_morphTarget + 7] = n3.y;\r\n            nka[offset_morphTarget + 8] = n3.z;\r\n\r\n          }\r\n\r\n          //\r\n\r\n          offset_morphTarget += 9;\r\n\r\n        }\r\n\r\n        _gl.bindBuffer(_gl.ARRAY_BUFFER, geometryGroup.__webglMorphTargetsBuffers[vk]);\r\n        _gl.bufferData(_gl.ARRAY_BUFFER, morphTargetsArrays[vk], hint);\r\n\r\n        if (material.morphNormals) {\r\n\r\n          _gl.bindBuffer(_gl.ARRAY_BUFFER, geometryGroup.__webglMorphNormalsBuffers[vk]);\r\n          _gl.bufferData(_gl.ARRAY_BUFFER, morphNormalsArrays[vk], hint);\r\n\r\n        }\r\n\r\n      }\r\n\r\n    }\r\n\r\n    if (obj_skinWeights.length) {\r\n\r\n      for (f = 0, fl = chunk_faces3.length; f < fl; f++) {\r\n\r\n        face = obj_faces[chunk_faces3[f]];\r\n\r\n        // weights\r\n\r\n        sw1 = obj_skinWeights[face.a];\r\n        sw2 = obj_skinWeights[face.b];\r\n        sw3 = obj_skinWeights[face.c];\r\n\r\n        skinWeightArray[offset_skin] = sw1.x;\r\n        skinWeightArray[offset_skin + 1] = sw1.y;\r\n        skinWeightArray[offset_skin + 2] = sw1.z;\r\n        skinWeightArray[offset_skin + 3] = sw1.w;\r\n\r\n        skinWeightArray[offset_skin + 4] = sw2.x;\r\n        skinWeightArray[offset_skin + 5] = sw2.y;\r\n        skinWeightArray[offset_skin + 6] = sw2.z;\r\n        skinWeightArray[offset_skin + 7] = sw2.w;\r\n\r\n        skinWeightArray[offset_skin + 8] = sw3.x;\r\n        skinWeightArray[offset_skin + 9] = sw3.y;\r\n        skinWeightArray[offset_skin + 10] = sw3.z;\r\n        skinWeightArray[offset_skin + 11] = sw3.w;\r\n\r\n        // indices\r\n\r\n        si1 = obj_skinIndices[face.a];\r\n        si2 = obj_skinIndices[face.b];\r\n        si3 = obj_skinIndices[face.c];\r\n\r\n        skinIndexArray[offset_skin] = si1.x;\r\n        skinIndexArray[offset_skin + 1] = si1.y;\r\n        skinIndexArray[offset_skin + 2] = si1.z;\r\n        skinIndexArray[offset_skin + 3] = si1.w;\r\n\r\n        skinIndexArray[offset_skin + 4] = si2.x;\r\n        skinIndexArray[offset_skin + 5] = si2.y;\r\n        skinIndexArray[offset_skin + 6] = si2.z;\r\n        skinIndexArray[offset_skin + 7] = si2.w;\r\n\r\n        skinIndexArray[offset_skin + 8] = si3.x;\r\n        skinIndexArray[offset_skin + 9] = si3.y;\r\n        skinIndexArray[offset_skin + 10] = si3.z;\r\n        skinIndexArray[offset_skin + 11] = si3.w;\r\n\r\n        offset_skin += 12;\r\n\r\n      }\r\n\r\n      if (offset_skin > 0) {\r\n\r\n        _gl.bindBuffer(_gl.ARRAY_BUFFER, geometryGroup.__webglSkinIndicesBuffer);\r\n        _gl.bufferData(_gl.ARRAY_BUFFER, skinIndexArray, hint);\r\n\r\n        _gl.bindBuffer(_gl.ARRAY_BUFFER, geometryGroup.__webglSkinWeightsBuffer);\r\n        _gl.bufferData(_gl.ARRAY_BUFFER, skinWeightArray, hint);\r\n\r\n      }\r\n\r\n    }\r\n\r\n    if (dirtyColors) {\r\n\r\n      for (f = 0, fl = chunk_faces3.length; f < fl; f++) {\r\n\r\n        face = obj_faces[chunk_faces3[f]];\r\n\r\n        vertexColors = face.vertexColors;\r\n        faceColor = face.color;\r\n\r\n        if (vertexColors.length === 3 && material.vertexColors === THREE.VertexColors) {\r\n\r\n          c1 = vertexColors[0];\r\n          c2 = vertexColors[1];\r\n          c3 = vertexColors[2];\r\n\r\n        }\r\n        else {\r\n\r\n          c1 = faceColor;\r\n          c2 = faceColor;\r\n          c3 = faceColor;\r\n\r\n        }\r\n\r\n        colorArray[offset_color] = c1.r;\r\n        colorArray[offset_color + 1] = c1.g;\r\n        colorArray[offset_color + 2] = c1.b;\r\n\r\n        colorArray[offset_color + 3] = c2.r;\r\n        colorArray[offset_color + 4] = c2.g;\r\n        colorArray[offset_color + 5] = c2.b;\r\n\r\n        colorArray[offset_color + 6] = c3.r;\r\n        colorArray[offset_color + 7] = c3.g;\r\n        colorArray[offset_color + 8] = c3.b;\r\n\r\n        offset_color += 9;\r\n\r\n      }\r\n\r\n      if (offset_color > 0) {\r\n\r\n        _gl.bindBuffer(_gl.ARRAY_BUFFER, geometryGroup.__webglColorBuffer);\r\n        _gl.bufferData(_gl.ARRAY_BUFFER, colorArray, hint);\r\n\r\n      }\r\n\r\n    }\r\n\r\n    if (dirtyTangents && geometry.hasTangents) {\r\n\r\n      for (f = 0, fl = chunk_faces3.length; f < fl; f++) {\r\n\r\n        face = obj_faces[chunk_faces3[f]];\r\n\r\n        vertexTangents = face.vertexTangents;\r\n\r\n        t1 = vertexTangents[0];\r\n        t2 = vertexTangents[1];\r\n        t3 = vertexTangents[2];\r\n\r\n        tangentArray[offset_tangent] = t1.x;\r\n        tangentArray[offset_tangent + 1] = t1.y;\r\n        tangentArray[offset_tangent + 2] = t1.z;\r\n        tangentArray[offset_tangent + 3] = t1.w;\r\n\r\n        tangentArray[offset_tangent + 4] = t2.x;\r\n        tangentArray[offset_tangent + 5] = t2.y;\r\n        tangentArray[offset_tangent + 6] = t2.z;\r\n        tangentArray[offset_tangent + 7] = t2.w;\r\n\r\n        tangentArray[offset_tangent + 8] = t3.x;\r\n        tangentArray[offset_tangent + 9] = t3.y;\r\n        tangentArray[offset_tangent + 10] = t3.z;\r\n        tangentArray[offset_tangent + 11] = t3.w;\r\n\r\n        offset_tangent += 12;\r\n\r\n      }\r\n\r\n      _gl.bindBuffer(_gl.ARRAY_BUFFER, geometryGroup.__webglTangentBuffer);\r\n      _gl.bufferData(_gl.ARRAY_BUFFER, tangentArray, hint);\r\n\r\n    }\r\n\r\n    if (dirtyNormals) {\r\n\r\n      for (f = 0, fl = chunk_faces3.length; f < fl; f++) {\r\n\r\n        face = obj_faces[chunk_faces3[f]];\r\n\r\n        vertexNormals = face.vertexNormals;\r\n        faceNormal = face.normal;\r\n\r\n        if (vertexNormals.length === 3 && needsFaceNormals === false) {\r\n\r\n          for (i = 0; i < 3; i++) {\r\n\r\n            vn = vertexNormals[i];\r\n\r\n            normalArray[offset_normal] = vn.x;\r\n            normalArray[offset_normal + 1] = vn.y;\r\n            normalArray[offset_normal + 2] = vn.z;\r\n\r\n            offset_normal += 3;\r\n\r\n          }\r\n\r\n        }\r\n        else {\r\n\r\n          for (i = 0; i < 3; i++) {\r\n\r\n            normalArray[offset_normal] = faceNormal.x;\r\n            normalArray[offset_normal + 1] = faceNormal.y;\r\n            normalArray[offset_normal + 2] = faceNormal.z;\r\n\r\n            offset_normal += 3;\r\n\r\n          }\r\n\r\n        }\r\n\r\n      }\r\n\r\n      _gl.bindBuffer(_gl.ARRAY_BUFFER, geometryGroup.__webglNormalBuffer);\r\n      _gl.bufferData(_gl.ARRAY_BUFFER, normalArray, hint);\r\n\r\n    }\r\n\r\n    if (dirtyUvs && obj_uvs) {\r\n\r\n      for (f = 0, fl = chunk_faces3.length; f < fl; f++) {\r\n\r\n        fi = chunk_faces3[f];\r\n\r\n        uv = obj_uvs[fi];\r\n\r\n        if (uv === undefined) continue;\r\n\r\n        for (i = 0; i < 3; i++) {\r\n\r\n          uvi = uv[i];\r\n\r\n          uvArray[offset_uv] = uvi.x;\r\n          uvArray[offset_uv + 1] = uvi.y;\r\n\r\n          offset_uv += 2;\r\n\r\n        }\r\n\r\n      }\r\n\r\n      if (offset_uv > 0) {\r\n\r\n        _gl.bindBuffer(_gl.ARRAY_BUFFER, geometryGroup.__webglUVBuffer);\r\n        _gl.bufferData(_gl.ARRAY_BUFFER, uvArray, hint);\r\n\r\n      }\r\n\r\n    }\r\n\r\n    if (dirtyUvs && obj_uvs2) {\r\n\r\n      for (f = 0, fl = chunk_faces3.length; f < fl; f++) {\r\n\r\n        fi = chunk_faces3[f];\r\n\r\n        uv2 = obj_uvs2[fi];\r\n\r\n        if (uv2 === undefined) continue;\r\n\r\n        for (i = 0; i < 3; i++) {\r\n\r\n          uv2i = uv2[i];\r\n\r\n          uv2Array[offset_uv2] = uv2i.x;\r\n          uv2Array[offset_uv2 + 1] = uv2i.y;\r\n\r\n          offset_uv2 += 2;\r\n\r\n        }\r\n\r\n      }\r\n\r\n      if (offset_uv2 > 0) {\r\n\r\n        _gl.bindBuffer(_gl.ARRAY_BUFFER, geometryGroup.__webglUV2Buffer);\r\n        _gl.bufferData(_gl.ARRAY_BUFFER, uv2Array, hint);\r\n\r\n      }\r\n\r\n    }\r\n\r\n    if (dirtyElements) {\r\n\r\n      for (f = 0, fl = chunk_faces3.length; f < fl; f++) {\r\n\r\n        faceArray[offset_face] = vertexIndex;\r\n        faceArray[offset_face + 1] = vertexIndex + 1;\r\n        faceArray[offset_face + 2] = vertexIndex + 2;\r\n\r\n        offset_face += 3;\r\n\r\n        lineArray[offset_line] = vertexIndex;\r\n        lineArray[offset_line + 1] = vertexIndex + 1;\r\n\r\n        lineArray[offset_line + 2] = vertexIndex;\r\n        lineArray[offset_line + 3] = vertexIndex + 2;\r\n\r\n        lineArray[offset_line + 4] = vertexIndex + 1;\r\n        lineArray[offset_line + 5] = vertexIndex + 2;\r\n\r\n        offset_line += 6;\r\n\r\n        vertexIndex += 3;\r\n\r\n      }\r\n\r\n      _gl.bindBuffer(_gl.ELEMENT_ARRAY_BUFFER, geometryGroup.__webglFaceBuffer);\r\n      _gl.bufferData(_gl.ELEMENT_ARRAY_BUFFER, faceArray, hint);\r\n\r\n      _gl.bindBuffer(_gl.ELEMENT_ARRAY_BUFFER, geometryGroup.__webglLineBuffer);\r\n      _gl.bufferData(_gl.ELEMENT_ARRAY_BUFFER, lineArray, hint);\r\n\r\n    }\r\n\r\n    if (customAttributes) {\r\n\r\n      for (i = 0, il = customAttributes.length; i < il; i++) {\r\n\r\n        customAttribute = customAttributes[i];\r\n\r\n        if (!customAttribute.__original.needsUpdate) continue;\r\n\r\n        offset_custom = 0;\r\n\r\n        if (customAttribute.size === 1) {\r\n\r\n          if (customAttribute.boundTo === undefined || customAttribute.boundTo === 'vertices') {\r\n\r\n            for (f = 0, fl = chunk_faces3.length; f < fl; f++) {\r\n\r\n              face = obj_faces[chunk_faces3[f]];\r\n\r\n              customAttribute.array[offset_custom] = customAttribute.value[face.a];\r\n              customAttribute.array[offset_custom + 1] = customAttribute.value[face.b];\r\n              customAttribute.array[offset_custom + 2] = customAttribute.value[face.c];\r\n\r\n              offset_custom += 3;\r\n\r\n            }\r\n\r\n          }\r\n          else if (customAttribute.boundTo === 'faces') {\r\n\r\n            for (f = 0, fl = chunk_faces3.length; f < fl; f++) {\r\n\r\n              value = customAttribute.value[chunk_faces3[f]];\r\n\r\n              customAttribute.array[offset_custom] = value;\r\n              customAttribute.array[offset_custom + 1] = value;\r\n              customAttribute.array[offset_custom + 2] = value;\r\n\r\n              offset_custom += 3;\r\n\r\n            }\r\n\r\n          }\r\n\r\n        }\r\n        else if (customAttribute.size === 2) {\r\n\r\n          if (customAttribute.boundTo === undefined || customAttribute.boundTo === 'vertices') {\r\n\r\n            for (f = 0, fl = chunk_faces3.length; f < fl; f++) {\r\n\r\n              face = obj_faces[chunk_faces3[f]];\r\n\r\n              v1 = customAttribute.value[face.a];\r\n              v2 = customAttribute.value[face.b];\r\n              v3 = customAttribute.value[face.c];\r\n\r\n              customAttribute.array[offset_custom] = v1.x;\r\n              customAttribute.array[offset_custom + 1] = v1.y;\r\n\r\n              customAttribute.array[offset_custom + 2] = v2.x;\r\n              customAttribute.array[offset_custom + 3] = v2.y;\r\n\r\n              customAttribute.array[offset_custom + 4] = v3.x;\r\n              customAttribute.array[offset_custom + 5] = v3.y;\r\n\r\n              offset_custom += 6;\r\n\r\n            }\r\n\r\n          }\r\n          else if (customAttribute.boundTo === 'faces') {\r\n\r\n            for (f = 0, fl = chunk_faces3.length; f < fl; f++) {\r\n\r\n              value = customAttribute.value[chunk_faces3[f]];\r\n\r\n              v1 = value;\r\n              v2 = value;\r\n              v3 = value;\r\n\r\n              customAttribute.array[offset_custom] = v1.x;\r\n              customAttribute.array[offset_custom + 1] = v1.y;\r\n\r\n              customAttribute.array[offset_custom + 2] = v2.x;\r\n              customAttribute.array[offset_custom + 3] = v2.y;\r\n\r\n              customAttribute.array[offset_custom + 4] = v3.x;\r\n              customAttribute.array[offset_custom + 5] = v3.y;\r\n\r\n              offset_custom += 6;\r\n\r\n            }\r\n\r\n          }\r\n\r\n        }\r\n        else if (customAttribute.size === 3) {\r\n\r\n          var pp;\r\n\r\n          if (customAttribute.type === 'c') {\r\n\r\n            pp = ['r', 'g', 'b'];\r\n\r\n          }\r\n          else {\r\n\r\n            pp = ['x', 'y', 'z'];\r\n\r\n          }\r\n\r\n          if (customAttribute.boundTo === undefined || customAttribute.boundTo === 'vertices') {\r\n\r\n            for (f = 0, fl = chunk_faces3.length; f < fl; f++) {\r\n\r\n              face = obj_faces[chunk_faces3[f]];\r\n\r\n              v1 = customAttribute.value[face.a];\r\n              v2 = customAttribute.value[face.b];\r\n              v3 = customAttribute.value[face.c];\r\n\r\n              customAttribute.array[offset_custom] = v1[pp[0]];\r\n              customAttribute.array[offset_custom + 1] = v1[pp[1]];\r\n              customAttribute.array[offset_custom + 2] = v1[pp[2]];\r\n\r\n              customAttribute.array[offset_custom + 3] = v2[pp[0]];\r\n              customAttribute.array[offset_custom + 4] = v2[pp[1]];\r\n              customAttribute.array[offset_custom + 5] = v2[pp[2]];\r\n\r\n              customAttribute.array[offset_custom + 6] = v3[pp[0]];\r\n              customAttribute.array[offset_custom + 7] = v3[pp[1]];\r\n              customAttribute.array[offset_custom + 8] = v3[pp[2]];\r\n\r\n              offset_custom += 9;\r\n\r\n            }\r\n\r\n          }\r\n          else if (customAttribute.boundTo === 'faces') {\r\n\r\n            for (f = 0, fl = chunk_faces3.length; f < fl; f++) {\r\n\r\n              value = customAttribute.value[chunk_faces3[f]];\r\n\r\n              v1 = value;\r\n              v2 = value;\r\n              v3 = value;\r\n\r\n              customAttribute.array[offset_custom] = v1[pp[0]];\r\n              customAttribute.array[offset_custom + 1] = v1[pp[1]];\r\n              customAttribute.array[offset_custom + 2] = v1[pp[2]];\r\n\r\n              customAttribute.array[offset_custom + 3] = v2[pp[0]];\r\n              customAttribute.array[offset_custom + 4] = v2[pp[1]];\r\n              customAttribute.array[offset_custom + 5] = v2[pp[2]];\r\n\r\n              customAttribute.array[offset_custom + 6] = v3[pp[0]];\r\n              customAttribute.array[offset_custom + 7] = v3[pp[1]];\r\n              customAttribute.array[offset_custom + 8] = v3[pp[2]];\r\n\r\n              offset_custom += 9;\r\n\r\n            }\r\n\r\n          }\r\n          else if (customAttribute.boundTo === 'faceVertices') {\r\n\r\n            for (f = 0, fl = chunk_faces3.length; f < fl; f++) {\r\n\r\n              value = customAttribute.value[chunk_faces3[f]];\r\n\r\n              v1 = value[0];\r\n              v2 = value[1];\r\n              v3 = value[2];\r\n\r\n              customAttribute.array[offset_custom] = v1[pp[0]];\r\n              customAttribute.array[offset_custom + 1] = v1[pp[1]];\r\n              customAttribute.array[offset_custom + 2] = v1[pp[2]];\r\n\r\n              customAttribute.array[offset_custom + 3] = v2[pp[0]];\r\n              customAttribute.array[offset_custom + 4] = v2[pp[1]];\r\n              customAttribute.array[offset_custom + 5] = v2[pp[2]];\r\n\r\n              customAttribute.array[offset_custom + 6] = v3[pp[0]];\r\n              customAttribute.array[offset_custom + 7] = v3[pp[1]];\r\n              customAttribute.array[offset_custom + 8] = v3[pp[2]];\r\n\r\n              offset_custom += 9;\r\n\r\n            }\r\n\r\n          }\r\n\r\n        }\r\n        else if (customAttribute.size === 4) {\r\n\r\n          if (customAttribute.boundTo === undefined || customAttribute.boundTo === 'vertices') {\r\n\r\n            for (f = 0, fl = chunk_faces3.length; f < fl; f++) {\r\n\r\n              face = obj_faces[chunk_faces3[f]];\r\n\r\n              v1 = customAttribute.value[face.a];\r\n              v2 = customAttribute.value[face.b];\r\n              v3 = customAttribute.value[face.c];\r\n\r\n              customAttribute.array[offset_custom] = v1.x;\r\n              customAttribute.array[offset_custom + 1] = v1.y;\r\n              customAttribute.array[offset_custom + 2] = v1.z;\r\n              customAttribute.array[offset_custom + 3] = v1.w;\r\n\r\n              customAttribute.array[offset_custom + 4] = v2.x;\r\n              customAttribute.array[offset_custom + 5] = v2.y;\r\n              customAttribute.array[offset_custom + 6] = v2.z;\r\n              customAttribute.array[offset_custom + 7] = v2.w;\r\n\r\n              customAttribute.array[offset_custom + 8] = v3.x;\r\n              customAttribute.array[offset_custom + 9] = v3.y;\r\n              customAttribute.array[offset_custom + 10] = v3.z;\r\n              customAttribute.array[offset_custom + 11] = v3.w;\r\n\r\n              offset_custom += 12;\r\n\r\n            }\r\n\r\n          }\r\n          else if (customAttribute.boundTo === 'faces') {\r\n\r\n            for (f = 0, fl = chunk_faces3.length; f < fl; f++) {\r\n\r\n              value = customAttribute.value[chunk_faces3[f]];\r\n\r\n              v1 = value;\r\n              v2 = value;\r\n              v3 = value;\r\n\r\n              customAttribute.array[offset_custom] = v1.x;\r\n              customAttribute.array[offset_custom + 1] = v1.y;\r\n              customAttribute.array[offset_custom + 2] = v1.z;\r\n              customAttribute.array[offset_custom + 3] = v1.w;\r\n\r\n              customAttribute.array[offset_custom + 4] = v2.x;\r\n              customAttribute.array[offset_custom + 5] = v2.y;\r\n              customAttribute.array[offset_custom + 6] = v2.z;\r\n              customAttribute.array[offset_custom + 7] = v2.w;\r\n\r\n              customAttribute.array[offset_custom + 8] = v3.x;\r\n              customAttribute.array[offset_custom + 9] = v3.y;\r\n              customAttribute.array[offset_custom + 10] = v3.z;\r\n              customAttribute.array[offset_custom + 11] = v3.w;\r\n\r\n              offset_custom += 12;\r\n\r\n            }\r\n\r\n          }\r\n          else if (customAttribute.boundTo === 'faceVertices') {\r\n\r\n            for (f = 0, fl = chunk_faces3.length; f < fl; f++) {\r\n\r\n              value = customAttribute.value[chunk_faces3[f]];\r\n\r\n              v1 = value[0];\r\n              v2 = value[1];\r\n              v3 = value[2];\r\n\r\n              customAttribute.array[offset_custom] = v1.x;\r\n              customAttribute.array[offset_custom + 1] = v1.y;\r\n              customAttribute.array[offset_custom + 2] = v1.z;\r\n              customAttribute.array[offset_custom + 3] = v1.w;\r\n\r\n              customAttribute.array[offset_custom + 4] = v2.x;\r\n              customAttribute.array[offset_custom + 5] = v2.y;\r\n              customAttribute.array[offset_custom + 6] = v2.z;\r\n              customAttribute.array[offset_custom + 7] = v2.w;\r\n\r\n              customAttribute.array[offset_custom + 8] = v3.x;\r\n              customAttribute.array[offset_custom + 9] = v3.y;\r\n              customAttribute.array[offset_custom + 10] = v3.z;\r\n              customAttribute.array[offset_custom + 11] = v3.w;\r\n\r\n              offset_custom += 12;\r\n\r\n            }\r\n\r\n          }\r\n\r\n        }\r\n\r\n        _gl.bindBuffer(_gl.ARRAY_BUFFER, customAttribute.buffer);\r\n        _gl.bufferData(_gl.ARRAY_BUFFER, customAttribute.array, hint);\r\n\r\n      }\r\n\r\n    }\r\n\r\n    if (dispose) {\r\n\r\n      delete geometryGroup.__inittedArrays;\r\n      delete geometryGroup.__colorArray;\r\n      delete geometryGroup.__normalArray;\r\n      delete geometryGroup.__tangentArray;\r\n      delete geometryGroup.__uvArray;\r\n      delete geometryGroup.__uv2Array;\r\n      delete geometryGroup.__faceArray;\r\n      delete geometryGroup.__vertexArray;\r\n      delete geometryGroup.__lineArray;\r\n      delete geometryGroup.__skinIndexArray;\r\n      delete geometryGroup.__skinWeightArray;\r\n\r\n    }\r\n\r\n  };\r\n\r\n  // Buffer rendering\r\n\r\n  this.renderBufferImmediate = function(object, program, material) {\r\n\r\n    state.initAttributes();\r\n\r\n    if (object.hasPositions && !object.__webglVertexBuffer) object.__webglVertexBuffer = _gl.createBuffer();\r\n    if (object.hasNormals && !object.__webglNormalBuffer) object.__webglNormalBuffer = _gl.createBuffer();\r\n    if (object.hasUvs && !object.__webglUvBuffer) object.__webglUvBuffer = _gl.createBuffer();\r\n    if (object.hasColors && !object.__webglColorBuffer) object.__webglColorBuffer = _gl.createBuffer();\r\n\r\n    if (object.hasPositions) {\r\n\r\n      _gl.bindBuffer(_gl.ARRAY_BUFFER, object.__webglVertexBuffer);\r\n      _gl.bufferData(_gl.ARRAY_BUFFER, object.positionArray, _gl.DYNAMIC_DRAW);\r\n\r\n      state.enableAttribute(program.attributes.position);\r\n\r\n      _gl.vertexAttribPointer(program.attributes.position, 3, _gl.FLOAT, false, 0, 0);\r\n\r\n    }\r\n\r\n    if (object.hasNormals) {\r\n\r\n      _gl.bindBuffer(_gl.ARRAY_BUFFER, object.__webglNormalBuffer);\r\n\r\n      if (material instanceof THREE.MeshPhongMaterial === false &&\r\n        material.shading === THREE.FlatShading) {\r\n\r\n        var nx, ny, nz,\r\n          nax, nbx, ncx, nay, nby, ncy, naz, nbz, ncz,\r\n          normalArray,\r\n          i, il = object.count * 3;\r\n\r\n        for (i = 0; i < il; i += 9) {\r\n\r\n          normalArray = object.normalArray;\r\n\r\n          nax = normalArray[i];\r\n          nay = normalArray[i + 1];\r\n          naz = normalArray[i + 2];\r\n\r\n          nbx = normalArray[i + 3];\r\n          nby = normalArray[i + 4];\r\n          nbz = normalArray[i + 5];\r\n\r\n          ncx = normalArray[i + 6];\r\n          ncy = normalArray[i + 7];\r\n          ncz = normalArray[i + 8];\r\n\r\n          nx = (nax + nbx + ncx) / 3;\r\n          ny = (nay + nby + ncy) / 3;\r\n          nz = (naz + nbz + ncz) / 3;\r\n\r\n          normalArray[i] = nx;\r\n          normalArray[i + 1] = ny;\r\n          normalArray[i + 2] = nz;\r\n\r\n          normalArray[i + 3] = nx;\r\n          normalArray[i + 4] = ny;\r\n          normalArray[i + 5] = nz;\r\n\r\n          normalArray[i + 6] = nx;\r\n          normalArray[i + 7] = ny;\r\n          normalArray[i + 8] = nz;\r\n\r\n        }\r\n\r\n      }\r\n\r\n      _gl.bufferData(_gl.ARRAY_BUFFER, object.normalArray, _gl.DYNAMIC_DRAW);\r\n\r\n      state.enableAttribute(program.attributes.normal);\r\n\r\n      _gl.vertexAttribPointer(program.attributes.normal, 3, _gl.FLOAT, false, 0, 0);\r\n\r\n    }\r\n\r\n    if (object.hasUvs && material.map) {\r\n\r\n      _gl.bindBuffer(_gl.ARRAY_BUFFER, object.__webglUvBuffer);\r\n      _gl.bufferData(_gl.ARRAY_BUFFER, object.uvArray, _gl.DYNAMIC_DRAW);\r\n\r\n      state.enableAttribute(program.attributes.uv);\r\n\r\n      _gl.vertexAttribPointer(program.attributes.uv, 2, _gl.FLOAT, false, 0, 0);\r\n\r\n    }\r\n\r\n    if (object.hasColors && material.vertexColors !== THREE.NoColors) {\r\n\r\n      _gl.bindBuffer(_gl.ARRAY_BUFFER, object.__webglColorBuffer);\r\n      _gl.bufferData(_gl.ARRAY_BUFFER, object.colorArray, _gl.DYNAMIC_DRAW);\r\n\r\n      state.enableAttribute(program.attributes.color);\r\n\r\n      _gl.vertexAttribPointer(program.attributes.color, 3, _gl.FLOAT, false, 0, 0);\r\n\r\n    }\r\n\r\n    state.disableUnusedAttributes();\r\n\r\n    _gl.drawArrays(_gl.TRIANGLES, 0, object.count);\r\n\r\n    object.count = 0;\r\n\r\n  };\r\n\r\n  function setupVertexAttributes(material, program, geometry, startIndex) {\r\n\r\n    var geometryAttributes = geometry.attributes;\r\n\r\n    var programAttributes = program.attributes;\r\n    var programAttributesKeys = program.attributesKeys;\r\n\r\n    for (var i = 0, l = programAttributesKeys.length; i < l; i++) {\r\n\r\n      var key = programAttributesKeys[i];\r\n      var programAttribute = programAttributes[key];\r\n\r\n      if (programAttribute >= 0) {\r\n\r\n        var geometryAttribute = geometryAttributes[key];\r\n\r\n        if (geometryAttribute !== undefined) {\r\n\r\n          var size = geometryAttribute.itemSize;\r\n\r\n          _gl.bindBuffer(_gl.ARRAY_BUFFER, geometryAttribute.buffer);\r\n\r\n          state.enableAttribute(programAttribute);\r\n\r\n          _gl.vertexAttribPointer(programAttribute, size, _gl.FLOAT, false, 0, startIndex * size * 4); // 4 bytes per Float32\r\n\r\n        }\r\n        else if (material.defaultAttributeValues !== undefined) {\r\n\r\n          if (material.defaultAttributeValues[key].length === 2) {\r\n\r\n            _gl.vertexAttrib2fv(programAttribute, material.defaultAttributeValues[key]);\r\n\r\n          }\r\n          else if (material.defaultAttributeValues[key].length === 3) {\r\n\r\n            _gl.vertexAttrib3fv(programAttribute, material.defaultAttributeValues[key]);\r\n\r\n          }\r\n\r\n        }\r\n\r\n      }\r\n\r\n    }\r\n\r\n    state.disableUnusedAttributes();\r\n\r\n  }\r\n\r\n  this.renderBufferDirect = function(camera, lights, fog, material, geometry, object) {\r\n\r\n    if (material.visible === false) return;\r\n\r\n    updateObject(object);\r\n\r\n    var program = setProgram(camera, lights, fog, material, object);\r\n\r\n    var updateBuffers = false,\r\n      wireframeBit = material.wireframe ? 1 : 0,\r\n      geometryProgram = 'direct_' + geometry.id + '_' + program.id + '_' + wireframeBit;\r\n\r\n    if (geometryProgram !== _currentGeometryProgram) {\r\n\r\n      _currentGeometryProgram = geometryProgram;\r\n      updateBuffers = true;\r\n\r\n    }\r\n\r\n    if (updateBuffers) {\r\n\r\n      state.initAttributes();\r\n\r\n    }\r\n\r\n    // render mesh\r\n\r\n    if (object instanceof THREE.Mesh) {\r\n\r\n      var mode = material.wireframe === true ? _gl.LINES : _gl.TRIANGLES;\r\n\r\n      var index = geometry.attributes.index;\r\n\r\n      if (index) {\r\n\r\n        // indexed triangles\r\n\r\n        var type, size;\r\n\r\n        if (index.array instanceof Uint32Array && extensions.get('OES_element_index_uint')) {\r\n\r\n          type = _gl.UNSIGNED_INT;\r\n          size = 4;\r\n\r\n        }\r\n        else {\r\n\r\n          type = _gl.UNSIGNED_SHORT;\r\n          size = 2;\r\n\r\n        }\r\n\r\n        var offsets = geometry.offsets;\r\n\r\n        if (offsets.length === 0) {\r\n\r\n          if (updateBuffers) {\r\n\r\n            setupVertexAttributes(material, program, geometry, 0);\r\n            _gl.bindBuffer(_gl.ELEMENT_ARRAY_BUFFER, index.buffer);\r\n\r\n          }\r\n\r\n          _gl.drawElements(mode, index.array.length, type, 0);\r\n\r\n          _this.info.render.calls++;\r\n          _this.info.render.vertices += index.array.length; // not really true, here vertices can be shared\r\n          _this.info.render.faces += index.array.length / 3;\r\n\r\n        }\r\n        else {\r\n\r\n          // if there is more than 1 chunk\r\n          // must set attribute pointers to use new offsets for each chunk\r\n          // even if geometry and materials didn't change\r\n\r\n          updateBuffers = true;\r\n\r\n          for (var i = 0, il = offsets.length; i < il; i++) {\r\n\r\n            var startIndex = offsets[i].index;\r\n\r\n            if (updateBuffers) {\r\n\r\n              setupVertexAttributes(material, program, geometry, startIndex);\r\n              _gl.bindBuffer(_gl.ELEMENT_ARRAY_BUFFER, index.buffer);\r\n\r\n            }\r\n\r\n            // render indexed triangles\r\n\r\n            _gl.drawElements(mode, offsets[i].count, type, offsets[i].start * size);\r\n\r\n            _this.info.render.calls++;\r\n            _this.info.render.vertices += offsets[i].count; // not really true, here vertices can be shared\r\n            _this.info.render.faces += offsets[i].count / 3;\r\n\r\n          }\r\n\r\n        }\r\n\r\n      }\r\n      else {\r\n\r\n        // non-indexed triangles\r\n\r\n        if (updateBuffers) {\r\n\r\n          setupVertexAttributes(material, program, geometry, 0);\r\n\r\n        }\r\n\r\n        var position = geometry.attributes['position'];\r\n\r\n        // render non-indexed triangles\r\n\r\n        _gl.drawArrays(mode, 0, position.array.length / position.itemSize);\r\n\r\n        _this.info.render.calls++;\r\n        _this.info.render.vertices += position.array.length / position.itemSize;\r\n        _this.info.render.faces += position.array.length / (3 * position.itemSize);\r\n\r\n      }\r\n\r\n    }\r\n    else if (object instanceof THREE.PointCloud) {\r\n\r\n      // render particles\r\n\r\n      var mode = _gl.POINTS;\r\n\r\n      var index = geometry.attributes.index;\r\n\r\n      if (index) {\r\n\r\n        // indexed points\r\n\r\n        var type, size;\r\n\r\n        if (index.array instanceof Uint32Array && extensions.get('OES_element_index_uint')) {\r\n\r\n          type = _gl.UNSIGNED_INT;\r\n          size = 4;\r\n\r\n        }\r\n        else {\r\n\r\n          type = _gl.UNSIGNED_SHORT;\r\n          size = 2;\r\n\r\n        }\r\n\r\n        var offsets = geometry.offsets;\r\n\r\n        if (offsets.length === 0) {\r\n\r\n          if (updateBuffers) {\r\n\r\n            setupVertexAttributes(material, program, geometry, 0);\r\n            _gl.bindBuffer(_gl.ELEMENT_ARRAY_BUFFER, index.buffer);\r\n\r\n          }\r\n\r\n          _gl.drawElements(mode, index.array.length, type, 0);\r\n\r\n          _this.info.render.calls++;\r\n          _this.info.render.points += index.array.length;\r\n\r\n        }\r\n        else {\r\n\r\n          // if there is more than 1 chunk\r\n          // must set attribute pointers to use new offsets for each chunk\r\n          // even if geometry and materials didn't change\r\n\r\n          if (offsets.length > 1) updateBuffers = true;\r\n\r\n          for (var i = 0, il = offsets.length; i < il; i++) {\r\n\r\n            var startIndex = offsets[i].index;\r\n\r\n            if (updateBuffers) {\r\n\r\n              setupVertexAttributes(material, program, geometry, startIndex);\r\n              _gl.bindBuffer(_gl.ELEMENT_ARRAY_BUFFER, index.buffer);\r\n\r\n            }\r\n\r\n            // render indexed points\r\n\r\n            _gl.drawElements(mode, offsets[i].count, type, offsets[i].start * size);\r\n\r\n            _this.info.render.calls++;\r\n            _this.info.render.points += offsets[i].count;\r\n\r\n          }\r\n\r\n        }\r\n\r\n      }\r\n      else {\r\n\r\n        // non-indexed points\r\n\r\n        if (updateBuffers) {\r\n\r\n          setupVertexAttributes(material, program, geometry, 0);\r\n\r\n        }\r\n\r\n        var position = geometry.attributes.position;\r\n        var offsets = geometry.offsets;\r\n\r\n        if (offsets.length === 0) {\r\n\r\n          _gl.drawArrays(mode, 0, position.array.length / 3);\r\n\r\n          _this.info.render.calls++;\r\n          _this.info.render.points += position.array.length / 3;\r\n\r\n        }\r\n        else {\r\n\r\n          for (var i = 0, il = offsets.length; i < il; i++) {\r\n\r\n            _gl.drawArrays(mode, offsets[i].index, offsets[i].count);\r\n\r\n            _this.info.render.calls++;\r\n            _this.info.render.points += offsets[i].count;\r\n\r\n          }\r\n\r\n        }\r\n\r\n      }\r\n\r\n    }\r\n    else if (object instanceof THREE.Line) {\r\n\r\n      var mode = (object.mode === THREE.LineStrip) ? _gl.LINE_STRIP : _gl.LINES;\r\n\r\n      state.setLineWidth(material.linewidth * pixelRatio);\r\n\r\n      var index = geometry.attributes.index;\r\n\r\n      if (index) {\r\n\r\n        // indexed lines\r\n\r\n        var type, size;\r\n\r\n        if (index.array instanceof Uint32Array) {\r\n\r\n          type = _gl.UNSIGNED_INT;\r\n          size = 4;\r\n\r\n        }\r\n        else {\r\n\r\n          type = _gl.UNSIGNED_SHORT;\r\n          size = 2;\r\n\r\n        }\r\n\r\n        var offsets = geometry.offsets;\r\n\r\n        if (offsets.length === 0) {\r\n\r\n          if (updateBuffers) {\r\n\r\n            setupVertexAttributes(material, program, geometry, 0);\r\n            _gl.bindBuffer(_gl.ELEMENT_ARRAY_BUFFER, index.buffer);\r\n\r\n          }\r\n\r\n          _gl.drawElements(mode, index.array.length, type, 0); // 2 bytes per Uint16Array\r\n\r\n          _this.info.render.calls++;\r\n          _this.info.render.vertices += index.array.length; // not really true, here vertices can be shared\r\n\r\n        }\r\n        else {\r\n\r\n          // if there is more than 1 chunk\r\n          // must set attribute pointers to use new offsets for each chunk\r\n          // even if geometry and materials didn't change\r\n\r\n          if (offsets.length > 1) updateBuffers = true;\r\n\r\n          for (var i = 0, il = offsets.length; i < il; i++) {\r\n\r\n            var startIndex = offsets[i].index;\r\n\r\n            if (updateBuffers) {\r\n\r\n              setupVertexAttributes(material, program, geometry, startIndex);\r\n              _gl.bindBuffer(_gl.ELEMENT_ARRAY_BUFFER, index.buffer);\r\n\r\n            }\r\n\r\n            // render indexed lines\r\n\r\n            _gl.drawElements(mode, offsets[i].count, type, offsets[i].start * size); // 2 bytes per Uint16Array\r\n\r\n            _this.info.render.calls++;\r\n            _this.info.render.vertices += offsets[i].count; // not really true, here vertices can be shared\r\n\r\n          }\r\n\r\n        }\r\n\r\n      }\r\n      else {\r\n\r\n        // non-indexed lines\r\n\r\n        if (updateBuffers) {\r\n\r\n          setupVertexAttributes(material, program, geometry, 0);\r\n\r\n        }\r\n\r\n        var position = geometry.attributes.position;\r\n        var offsets = geometry.offsets;\r\n\r\n        if (offsets.length === 0) {\r\n\r\n          _gl.drawArrays(mode, 0, position.array.length / 3);\r\n\r\n          _this.info.render.calls++;\r\n          _this.info.render.vertices += position.array.length / 3;\r\n\r\n        }\r\n        else {\r\n\r\n          for (var i = 0, il = offsets.length; i < il; i++) {\r\n\r\n            _gl.drawArrays(mode, offsets[i].index, offsets[i].count);\r\n\r\n            _this.info.render.calls++;\r\n            _this.info.render.vertices += offsets[i].count;\r\n\r\n          }\r\n\r\n        }\r\n\r\n      }\r\n\r\n    }\r\n\r\n  };\r\n\r\n  this.renderBuffer = function(camera, lights, fog, material, geometryGroup, object) {\r\n\r\n    if (material.visible === false) return;\r\n\r\n    updateObject(object);\r\n\r\n    var program = setProgram(camera, lights, fog, material, object);\r\n\r\n    var attributes = program.attributes;\r\n\r\n    var updateBuffers = false,\r\n      wireframeBit = material.wireframe ? 1 : 0,\r\n      geometryProgram = geometryGroup.id + '_' + program.id + '_' + wireframeBit;\r\n\r\n    if (geometryProgram !== _currentGeometryProgram) {\r\n\r\n      _currentGeometryProgram = geometryProgram;\r\n      updateBuffers = true;\r\n\r\n    }\r\n\r\n    if (updateBuffers) {\r\n\r\n      state.initAttributes();\r\n\r\n    }\r\n\r\n    // vertices\r\n\r\n    if (!material.morphTargets && attributes.position >= 0) {\r\n\r\n      if (updateBuffers) {\r\n\r\n        _gl.bindBuffer(_gl.ARRAY_BUFFER, geometryGroup.__webglVertexBuffer);\r\n\r\n        state.enableAttribute(attributes.position);\r\n\r\n        _gl.vertexAttribPointer(attributes.position, 3, _gl.FLOAT, false, 0, 0);\r\n\r\n      }\r\n\r\n    }\r\n    else {\r\n\r\n      if (object.morphTargetBase) {\r\n\r\n        setupMorphTargets(material, geometryGroup, object);\r\n\r\n      }\r\n\r\n    }\r\n\r\n\r\n    if (updateBuffers) {\r\n\r\n      // custom attributes\r\n\r\n      // Use the per-geometryGroup custom attribute arrays which are setup in initMeshBuffers\r\n\r\n      if (geometryGroup.__webglCustomAttributesList) {\r\n\r\n        for (var i = 0, il = geometryGroup.__webglCustomAttributesList.length; i < il; i++) {\r\n\r\n          var attribute = geometryGroup.__webglCustomAttributesList[i];\r\n\r\n          if (attributes[attribute.buffer.belongsToAttribute] >= 0) {\r\n\r\n            _gl.bindBuffer(_gl.ARRAY_BUFFER, attribute.buffer);\r\n\r\n            state.enableAttribute(attributes[attribute.buffer.belongsToAttribute]);\r\n\r\n            _gl.vertexAttribPointer(attributes[attribute.buffer.belongsToAttribute], attribute.size, _gl.FLOAT, false, 0, 0);\r\n\r\n          }\r\n\r\n        }\r\n\r\n      }\r\n\r\n\r\n      // colors\r\n\r\n      if (attributes.color >= 0) {\r\n\r\n        if (object.geometry.colors.length > 0 || object.geometry.faces.length > 0) {\r\n\r\n          _gl.bindBuffer(_gl.ARRAY_BUFFER, geometryGroup.__webglColorBuffer);\r\n\r\n          state.enableAttribute(attributes.color);\r\n\r\n          _gl.vertexAttribPointer(attributes.color, 3, _gl.FLOAT, false, 0, 0);\r\n\r\n        }\r\n        else if (material.defaultAttributeValues !== undefined) {\r\n\r\n\r\n          _gl.vertexAttrib3fv(attributes.color, material.defaultAttributeValues.color);\r\n\r\n        }\r\n\r\n      }\r\n\r\n      // normals\r\n\r\n      if (attributes.normal >= 0) {\r\n\r\n        _gl.bindBuffer(_gl.ARRAY_BUFFER, geometryGroup.__webglNormalBuffer);\r\n\r\n        state.enableAttribute(attributes.normal);\r\n\r\n        _gl.vertexAttribPointer(attributes.normal, 3, _gl.FLOAT, false, 0, 0);\r\n\r\n      }\r\n\r\n      // tangents\r\n\r\n      if (attributes.tangent >= 0) {\r\n\r\n        _gl.bindBuffer(_gl.ARRAY_BUFFER, geometryGroup.__webglTangentBuffer);\r\n\r\n        state.enableAttribute(attributes.tangent);\r\n\r\n        _gl.vertexAttribPointer(attributes.tangent, 4, _gl.FLOAT, false, 0, 0);\r\n\r\n      }\r\n\r\n      // uvs\r\n\r\n      if (attributes.uv >= 0) {\r\n\r\n        if (object.geometry.faceVertexUvs[0]) {\r\n\r\n          _gl.bindBuffer(_gl.ARRAY_BUFFER, geometryGroup.__webglUVBuffer);\r\n\r\n          state.enableAttribute(attributes.uv);\r\n\r\n          _gl.vertexAttribPointer(attributes.uv, 2, _gl.FLOAT, false, 0, 0);\r\n\r\n        }\r\n        else if (material.defaultAttributeValues !== undefined) {\r\n\r\n\r\n          _gl.vertexAttrib2fv(attributes.uv, material.defaultAttributeValues.uv);\r\n\r\n        }\r\n\r\n      }\r\n\r\n      if (attributes.uv2 >= 0) {\r\n\r\n        if (object.geometry.faceVertexUvs[1]) {\r\n\r\n          _gl.bindBuffer(_gl.ARRAY_BUFFER, geometryGroup.__webglUV2Buffer);\r\n\r\n          state.enableAttribute(attributes.uv2);\r\n\r\n          _gl.vertexAttribPointer(attributes.uv2, 2, _gl.FLOAT, false, 0, 0);\r\n\r\n        }\r\n        else if (material.defaultAttributeValues !== undefined) {\r\n\r\n\r\n          _gl.vertexAttrib2fv(attributes.uv2, material.defaultAttributeValues.uv2);\r\n\r\n        }\r\n\r\n      }\r\n\r\n      if (material.skinning &&\r\n        attributes.skinIndex >= 0 && attributes.skinWeight >= 0) {\r\n\r\n        _gl.bindBuffer(_gl.ARRAY_BUFFER, geometryGroup.__webglSkinIndicesBuffer);\r\n\r\n        state.enableAttribute(attributes.skinIndex);\r\n\r\n        _gl.vertexAttribPointer(attributes.skinIndex, 4, _gl.FLOAT, false, 0, 0);\r\n\r\n        _gl.bindBuffer(_gl.ARRAY_BUFFER, geometryGroup.__webglSkinWeightsBuffer);\r\n\r\n        state.enableAttribute(attributes.skinWeight);\r\n\r\n        _gl.vertexAttribPointer(attributes.skinWeight, 4, _gl.FLOAT, false, 0, 0);\r\n\r\n      }\r\n\r\n      // line distances\r\n\r\n      if (attributes.lineDistance >= 0) {\r\n\r\n        _gl.bindBuffer(_gl.ARRAY_BUFFER, geometryGroup.__webglLineDistanceBuffer);\r\n\r\n        state.enableAttribute(attributes.lineDistance);\r\n\r\n        _gl.vertexAttribPointer(attributes.lineDistance, 1, _gl.FLOAT, false, 0, 0);\r\n\r\n      }\r\n\r\n    }\r\n\r\n    state.disableUnusedAttributes();\r\n\r\n    // render mesh\r\n\r\n    if (object instanceof THREE.Mesh) {\r\n\r\n      var type = geometryGroup.__typeArray === Uint32Array ? _gl.UNSIGNED_INT : _gl.UNSIGNED_SHORT;\r\n\r\n      // wireframe\r\n\r\n      if (material.wireframe) {\r\n\r\n        state.setLineWidth(material.wireframeLinewidth * pixelRatio);\r\n\r\n        if (updateBuffers) _gl.bindBuffer(_gl.ELEMENT_ARRAY_BUFFER, geometryGroup.__webglLineBuffer);\r\n        _gl.drawElements(_gl.LINES, geometryGroup.__webglLineCount, type, 0);\r\n\r\n        // triangles\r\n\r\n      }\r\n      else {\r\n\r\n        if (updateBuffers) _gl.bindBuffer(_gl.ELEMENT_ARRAY_BUFFER, geometryGroup.__webglFaceBuffer);\r\n        _gl.drawElements(_gl.TRIANGLES, geometryGroup.__webglFaceCount, type, 0);\r\n\r\n      }\r\n\r\n      _this.info.render.calls++;\r\n      _this.info.render.vertices += geometryGroup.__webglFaceCount;\r\n      _this.info.render.faces += geometryGroup.__webglFaceCount / 3;\r\n\r\n      // render lines\r\n\r\n    }\r\n    else if (object instanceof THREE.Line) {\r\n\r\n      var mode = (object.mode === THREE.LineStrip) ? _gl.LINE_STRIP : _gl.LINES;\r\n\r\n      state.setLineWidth(material.linewidth * pixelRatio);\r\n\r\n      _gl.drawArrays(mode, 0, geometryGroup.__webglLineCount);\r\n\r\n      _this.info.render.calls++;\r\n\r\n      // render particles\r\n\r\n    }\r\n    else if (object instanceof THREE.PointCloud) {\r\n\r\n      _gl.drawArrays(_gl.POINTS, 0, geometryGroup.__webglParticleCount);\r\n\r\n      _this.info.render.calls++;\r\n      _this.info.render.points += geometryGroup.__webglParticleCount;\r\n\r\n    }\r\n\r\n  };\r\n\r\n  function setupMorphTargets(material, geometryGroup, object) {\r\n\r\n    // set base\r\n\r\n    var attributes = material.program.attributes;\r\n\r\n    if (object.morphTargetBase !== -1 && attributes.position >= 0) {\r\n\r\n      _gl.bindBuffer(_gl.ARRAY_BUFFER, geometryGroup.__webglMorphTargetsBuffers[object.morphTargetBase]);\r\n\r\n      state.enableAttribute(attributes.position);\r\n\r\n      _gl.vertexAttribPointer(attributes.position, 3, _gl.FLOAT, false, 0, 0);\r\n\r\n    }\r\n    else if (attributes.position >= 0) {\r\n\r\n      _gl.bindBuffer(_gl.ARRAY_BUFFER, geometryGroup.__webglVertexBuffer);\r\n\r\n      state.enableAttribute(attributes.position);\r\n\r\n      _gl.vertexAttribPointer(attributes.position, 3, _gl.FLOAT, false, 0, 0);\r\n\r\n    }\r\n\r\n    if (object.morphTargetForcedOrder.length) {\r\n\r\n      // set forced order\r\n\r\n      var m = 0;\r\n      var order = object.morphTargetForcedOrder;\r\n      var influences = object.morphTargetInfluences;\r\n\r\n      var attribute;\r\n\r\n      while (m < material.numSupportedMorphTargets && m < order.length) {\r\n\r\n        attribute = attributes['morphTarget' + m];\r\n\r\n        if (attribute >= 0) {\r\n\r\n          _gl.bindBuffer(_gl.ARRAY_BUFFER, geometryGroup.__webglMorphTargetsBuffers[order[m]]);\r\n\r\n          state.enableAttribute(attribute);\r\n\r\n          _gl.vertexAttribPointer(attribute, 3, _gl.FLOAT, false, 0, 0);\r\n\r\n        }\r\n\r\n        attribute = attributes['morphNormal' + m];\r\n\r\n        if (attribute >= 0 && material.morphNormals) {\r\n\r\n          _gl.bindBuffer(_gl.ARRAY_BUFFER, geometryGroup.__webglMorphNormalsBuffers[order[m]]);\r\n\r\n          state.enableAttribute(attribute);\r\n\r\n          _gl.vertexAttribPointer(attribute, 3, _gl.FLOAT, false, 0, 0);\r\n\r\n        }\r\n\r\n        object.__webglMorphTargetInfluences[m] = influences[order[m]];\r\n\r\n        m++;\r\n\r\n      }\r\n\r\n    }\r\n    else {\r\n\r\n      // find the most influencing\r\n\r\n      var activeInfluenceIndices = [];\r\n      var influences = object.morphTargetInfluences;\r\n      var morphTargets = object.geometry.morphTargets;\r\n\r\n      if (influences.length > morphTargets.length) {\r\n\r\n        console.warn('THREE.WebGLRenderer: Influences array is bigger than morphTargets array.');\r\n        influences.length = morphTargets.length;\r\n\r\n      }\r\n\r\n      for (var i = 0, il = influences.length; i < il; i++) {\r\n\r\n        var influence = influences[i];\r\n\r\n        activeInfluenceIndices.push([influence, i]);\r\n\r\n      }\r\n\r\n      if (activeInfluenceIndices.length > material.numSupportedMorphTargets) {\r\n\r\n        activeInfluenceIndices.sort(numericalSort);\r\n        activeInfluenceIndices.length = material.numSupportedMorphTargets;\r\n\r\n      }\r\n      else if (activeInfluenceIndices.length > material.numSupportedMorphNormals) {\r\n\r\n        activeInfluenceIndices.sort(numericalSort);\r\n\r\n      }\r\n      else if (activeInfluenceIndices.length === 0) {\r\n\r\n        activeInfluenceIndices.push([0, 0]);\r\n\r\n      }\r\n\r\n      var attribute;\r\n\r\n      for (var m = 0, ml = material.numSupportedMorphTargets; m < ml; m++) {\r\n\r\n        if (activeInfluenceIndices[m]) {\r\n\r\n          var influenceIndex = activeInfluenceIndices[m][1];\r\n\r\n          attribute = attributes['morphTarget' + m];\r\n\r\n          if (attribute >= 0) {\r\n\r\n            _gl.bindBuffer(_gl.ARRAY_BUFFER, geometryGroup.__webglMorphTargetsBuffers[influenceIndex]);\r\n\r\n            state.enableAttribute(attribute);\r\n\r\n            _gl.vertexAttribPointer(attribute, 3, _gl.FLOAT, false, 0, 0);\r\n\r\n          }\r\n\r\n          attribute = attributes['morphNormal' + m];\r\n\r\n          if (attribute >= 0 && material.morphNormals) {\r\n\r\n            _gl.bindBuffer(_gl.ARRAY_BUFFER, geometryGroup.__webglMorphNormalsBuffers[influenceIndex]);\r\n\r\n            state.enableAttribute(attribute);\r\n\r\n            _gl.vertexAttribPointer(attribute, 3, _gl.FLOAT, false, 0, 0);\r\n\r\n          }\r\n\r\n          object.__webglMorphTargetInfluences[m] = influences[influenceIndex];\r\n\r\n        }\r\n        else {\r\n\r\n          /*\r\n          _gl.vertexAttribPointer( attributes[ \"morphTarget\" + m ], 3, _gl.FLOAT, false, 0, 0 );\r\n\r\n          if ( material.morphNormals ) {\r\n\r\n          \t_gl.vertexAttribPointer( attributes[ \"morphNormal\" + m ], 3, _gl.FLOAT, false, 0, 0 );\r\n\r\n          }\r\n          */\r\n\r\n          object.__webglMorphTargetInfluences[m] = 0;\r\n\r\n        }\r\n\r\n      }\r\n\r\n    }\r\n\r\n    // load updated influences uniform\r\n\r\n    if (material.program.uniforms.morphTargetInfluences !== null) {\r\n\r\n      _gl.uniform1fv(material.program.uniforms.morphTargetInfluences, object.__webglMorphTargetInfluences);\r\n\r\n    }\r\n\r\n  }\r\n\r\n  // Sorting\r\n\r\n  function painterSortStable(a, b) {\r\n\r\n    if (a.object.renderOrder !== b.object.renderOrder) {\r\n\r\n      return a.object.renderOrder - b.object.renderOrder;\r\n\r\n    }\r\n    else if (a.material.id !== b.material.id) {\r\n\r\n      return a.material.id - b.material.id;\r\n\r\n    }\r\n    else if (a.z !== b.z) {\r\n\r\n      return a.z - b.z;\r\n\r\n    }\r\n    else {\r\n\r\n      return a.id - b.id;\r\n\r\n    }\r\n\r\n  }\r\n\r\n  function reversePainterSortStable(a, b) {\r\n\r\n    if (a.object.renderOrder !== b.object.renderOrder) {\r\n\r\n      return a.object.renderOrder - b.object.renderOrder;\r\n\r\n    }\r\n    if (a.z !== b.z) {\r\n\r\n      return b.z - a.z;\r\n\r\n    }\r\n    else {\r\n\r\n      return a.id - b.id;\r\n\r\n    }\r\n\r\n  }\r\n\r\n  function numericalSort(a, b) {\r\n\r\n    return b[0] - a[0];\r\n\r\n  }\r\n\r\n  // Rendering\r\n\r\n  this.render = function(scene, camera, renderTarget, forceClear) {\r\n\r\n    if (camera instanceof THREE.Camera === false) {\r\n\r\n      THREE.error('THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.');\r\n      return;\r\n\r\n    }\r\n\r\n    var fog = scene.fog;\r\n\r\n    // reset caching for this frame\r\n\r\n    _currentGeometryProgram = '';\r\n    _currentMaterialId = -1;\r\n    _currentCamera = null;\r\n    _lightsNeedUpdate = true;\r\n\r\n    // update scene graph\r\n\r\n    if (scene.autoUpdate === true) scene.updateMatrixWorld();\r\n\r\n    // update camera matrices and frustum\r\n\r\n    if (camera.parent === undefined) camera.updateMatrixWorld();\r\n\r\n    // update Skeleton objects\r\n\r\n    scene.traverse(function(object) {\r\n\r\n      if (object instanceof THREE.SkinnedMesh) {\r\n\r\n        object.skeleton.update();\r\n\r\n      }\r\n\r\n    });\r\n\r\n    camera.matrixWorldInverse.getInverse(camera.matrixWorld);\r\n\r\n    _projScreenMatrix.multiplyMatrices(camera.projectionMatrix, camera.matrixWorldInverse);\r\n    _frustum.setFromMatrix(_projScreenMatrix);\r\n\r\n    lights.length = 0;\r\n    opaqueObjects.length = 0;\r\n    transparentObjects.length = 0;\r\n\r\n    sprites.length = 0;\r\n    lensFlares.length = 0;\r\n\r\n    projectObject(scene);\r\n\r\n    if (_this.sortObjects === true) {\r\n\r\n      opaqueObjects.sort(painterSortStable);\r\n      transparentObjects.sort(reversePainterSortStable);\r\n\r\n    }\r\n\r\n    // custom render plugins (pre pass)\r\n\r\n    shadowMapPlugin.render(scene, camera);\r\n\r\n    //\r\n\r\n    _this.info.render.calls = 0;\r\n    _this.info.render.vertices = 0;\r\n    _this.info.render.faces = 0;\r\n    _this.info.render.points = 0;\r\n\r\n    this.setRenderTarget(renderTarget);\r\n\r\n    if (this.autoClear || forceClear) {\r\n\r\n      this.clear(this.autoClearColor, this.autoClearDepth, this.autoClearStencil);\r\n\r\n    }\r\n\r\n    // set matrices for immediate objects\r\n\r\n    for (var i = 0, il = _webglObjectsImmediate.length; i < il; i++) {\r\n\r\n      var webglObject = _webglObjectsImmediate[i];\r\n      var object = webglObject.object;\r\n\r\n      if (object.visible) {\r\n\r\n        setupMatrices(object, camera);\r\n\r\n        unrollImmediateBufferMaterial(webglObject);\r\n\r\n      }\r\n\r\n    }\r\n\r\n    if (scene.overrideMaterial) {\r\n\r\n      var overrideMaterial = scene.overrideMaterial;\r\n\r\n      setMaterial(overrideMaterial);\r\n\r\n      renderObjects(opaqueObjects, camera, lights, fog, overrideMaterial);\r\n      renderObjects(transparentObjects, camera, lights, fog, overrideMaterial);\r\n      renderObjectsImmediate(_webglObjectsImmediate, '', camera, lights, fog, overrideMaterial);\r\n\r\n    }\r\n    else {\r\n\r\n      // opaque pass (front-to-back order)\r\n\r\n      state.setBlending(THREE.NoBlending);\r\n\r\n      renderObjects(opaqueObjects, camera, lights, fog, null);\r\n      renderObjectsImmediate(_webglObjectsImmediate, 'opaque', camera, lights, fog, null);\r\n\r\n      // transparent pass (back-to-front order)\r\n\r\n      renderObjects(transparentObjects, camera, lights, fog, null);\r\n      renderObjectsImmediate(_webglObjectsImmediate, 'transparent', camera, lights, fog, null);\r\n\r\n    }\r\n\r\n    // custom render plugins (post pass)\r\n\r\n    spritePlugin.render(scene, camera);\r\n    lensFlarePlugin.render(scene, camera, _currentWidth, _currentHeight);\r\n\r\n    // Generate mipmap if we're using any kind of mipmap filtering\r\n\r\n    if (renderTarget && renderTarget.generateMipmaps && renderTarget.minFilter !== THREE.NearestFilter && renderTarget.minFilter !== THREE.LinearFilter) {\r\n\r\n      updateRenderTargetMipmap(renderTarget);\r\n\r\n    }\r\n\r\n    // Ensure depth buffer writing is enabled so it can be cleared on next render\r\n\r\n    state.setDepthTest(true);\r\n    state.setDepthWrite(true);\r\n    state.setColorWrite(true);\r\n\r\n    // _gl.finish();\r\n\r\n  };\r\n\r\n  function projectObject(object) {\r\n\r\n    if (object.visible === false) return;\r\n\r\n    if (object instanceof THREE.Scene || object instanceof THREE.Group) {\r\n\r\n      // skip\r\n\r\n    }\r\n    else {\r\n\r\n      initObject(object);\r\n\r\n      if (object instanceof THREE.Light) {\r\n\r\n        lights.push(object);\r\n\r\n      }\r\n      else if (object instanceof THREE.Sprite) {\r\n\r\n        sprites.push(object);\r\n\r\n      }\r\n      else if (object instanceof THREE.LensFlare) {\r\n\r\n        lensFlares.push(object);\r\n\r\n      }\r\n      else {\r\n\r\n        var webglObjects = _webglObjects[object.id];\r\n\r\n        if (webglObjects && (object.frustumCulled === false || _frustum.intersectsObject(object) === true)) {\r\n\r\n          for (var i = 0, l = webglObjects.length; i < l; i++) {\r\n\r\n            var webglObject = webglObjects[i];\r\n\r\n            unrollBufferMaterial(webglObject);\r\n\r\n            webglObject.render = true;\r\n\r\n            if (_this.sortObjects === true) {\r\n\r\n              _vector3.setFromMatrixPosition(object.matrixWorld);\r\n              _vector3.applyProjection(_projScreenMatrix);\r\n\r\n              webglObject.z = _vector3.z;\r\n\r\n            }\r\n\r\n          }\r\n\r\n        }\r\n\r\n      }\r\n\r\n    }\r\n\r\n    for (var i = 0, l = object.children.length; i < l; i++) {\r\n\r\n      projectObject(object.children[i]);\r\n\r\n    }\r\n\r\n  }\r\n\r\n  function renderObjects(renderList, camera, lights, fog, overrideMaterial) {\r\n\r\n    var material;\r\n\r\n    for (var i = 0, l = renderList.length; i < l; i++) {\r\n\r\n      var webglObject = renderList[i];\r\n\r\n      var object = webglObject.object;\r\n      var buffer = webglObject.buffer;\r\n\r\n      setupMatrices(object, camera);\r\n\r\n      if (overrideMaterial) {\r\n\r\n        material = overrideMaterial;\r\n\r\n      }\r\n      else {\r\n\r\n        material = webglObject.material;\r\n\r\n        if (!material) continue;\r\n\r\n        setMaterial(material);\r\n\r\n      }\r\n\r\n      _this.setMaterialFaces(material);\r\n\r\n      if (buffer instanceof THREE.BufferGeometry) {\r\n\r\n        _this.renderBufferDirect(camera, lights, fog, material, buffer, object);\r\n\r\n      }\r\n      else {\r\n\r\n        _this.renderBuffer(camera, lights, fog, material, buffer, object);\r\n\r\n      }\r\n\r\n    }\r\n\r\n  }\r\n\r\n  function renderObjectsImmediate(renderList, materialType, camera, lights, fog, overrideMaterial) {\r\n\r\n    var material;\r\n\r\n    for (var i = 0, l = renderList.length; i < l; i++) {\r\n\r\n      var webglObject = renderList[i];\r\n      var object = webglObject.object;\r\n\r\n      if (object.visible) {\r\n\r\n        if (overrideMaterial) {\r\n\r\n          material = overrideMaterial;\r\n\r\n        }\r\n        else {\r\n\r\n          material = webglObject[materialType];\r\n\r\n          if (!material) continue;\r\n\r\n          setMaterial(material);\r\n\r\n        }\r\n\r\n        _this.renderImmediateObject(camera, lights, fog, material, object);\r\n\r\n      }\r\n\r\n    }\r\n\r\n  }\r\n\r\n  this.renderImmediateObject = function(camera, lights, fog, material, object) {\r\n\r\n    var program = setProgram(camera, lights, fog, material, object);\r\n\r\n    _currentGeometryProgram = '';\r\n\r\n    _this.setMaterialFaces(material);\r\n\r\n    if (object.immediateRenderCallback) {\r\n\r\n      object.immediateRenderCallback(program, _gl, _frustum);\r\n\r\n    }\r\n    else {\r\n\r\n      object.render(function(object) {\r\n        _this.renderBufferImmediate(object, program, material);\r\n      });\r\n\r\n    }\r\n\r\n  };\r\n\r\n  function unrollImmediateBufferMaterial(globject) {\r\n\r\n    var object = globject.object,\r\n      material = object.material;\r\n\r\n    if (material.transparent) {\r\n\r\n      globject.transparent = material;\r\n      globject.opaque = null;\r\n\r\n    }\r\n    else {\r\n\r\n      globject.opaque = material;\r\n      globject.transparent = null;\r\n\r\n    }\r\n\r\n  }\r\n\r\n  function unrollBufferMaterial(globject) {\r\n\r\n    var object = globject.object;\r\n    var buffer = globject.buffer;\r\n\r\n    var geometry = object.geometry;\r\n    var material = object.material;\r\n\r\n    if (material instanceof THREE.MeshFaceMaterial) {\r\n\r\n      var materialIndex = geometry instanceof THREE.BufferGeometry ? 0 : buffer.materialIndex;\r\n\r\n      material = material.materials[materialIndex];\r\n\r\n      globject.material = material;\r\n\r\n      if (material.transparent) {\r\n\r\n        transparentObjects.push(globject);\r\n\r\n      }\r\n      else {\r\n\r\n        opaqueObjects.push(globject);\r\n\r\n      }\r\n\r\n    }\r\n    else if (material) {\r\n\r\n      globject.material = material;\r\n\r\n      if (material.transparent) {\r\n\r\n        transparentObjects.push(globject);\r\n\r\n      }\r\n      else {\r\n\r\n        opaqueObjects.push(globject);\r\n\r\n      }\r\n\r\n    }\r\n\r\n  }\r\n\r\n  function initObject(object) {\r\n\r\n    if (object.__webglInit === undefined) {\r\n\r\n      object.__webglInit = true;\r\n      object._modelViewMatrix = new THREE.Matrix4();\r\n      object._normalMatrix = new THREE.Matrix3();\r\n\r\n      object.addEventListener('removed', onObjectRemoved);\r\n\r\n    }\r\n\r\n    var geometry = object.geometry;\r\n\r\n    if (geometry === undefined) {\r\n\r\n      // ImmediateRenderObject\r\n\r\n    }\r\n    else if (geometry.__webglInit === undefined) {\r\n\r\n      geometry.__webglInit = true;\r\n      geometry.addEventListener('dispose', onGeometryDispose);\r\n\r\n      if (geometry instanceof THREE.BufferGeometry) {\r\n\r\n        _this.info.memory.geometries++;\r\n\r\n      }\r\n      else if (object instanceof THREE.Mesh) {\r\n\r\n        initGeometryGroups(object, geometry);\r\n\r\n      }\r\n      else if (object instanceof THREE.Line) {\r\n\r\n        if (geometry.__webglVertexBuffer === undefined) {\r\n\r\n          createLineBuffers(geometry);\r\n          initLineBuffers(geometry, object);\r\n\r\n          geometry.verticesNeedUpdate = true;\r\n          geometry.colorsNeedUpdate = true;\r\n          geometry.lineDistancesNeedUpdate = true;\r\n\r\n        }\r\n\r\n      }\r\n      else if (object instanceof THREE.PointCloud) {\r\n\r\n        if (geometry.__webglVertexBuffer === undefined) {\r\n\r\n          createParticleBuffers(geometry);\r\n          initParticleBuffers(geometry, object);\r\n\r\n          geometry.verticesNeedUpdate = true;\r\n          geometry.colorsNeedUpdate = true;\r\n\r\n        }\r\n\r\n      }\r\n\r\n    }\r\n\r\n    if (object.__webglActive === undefined) {\r\n\r\n      object.__webglActive = true;\r\n\r\n      if (object instanceof THREE.Mesh) {\r\n\r\n        if (geometry instanceof THREE.BufferGeometry) {\r\n\r\n          addBuffer(_webglObjects, geometry, object);\r\n\r\n        }\r\n        else if (geometry instanceof THREE.Geometry) {\r\n\r\n          var geometryGroupsList = geometryGroups[geometry.id];\r\n\r\n          for (var i = 0, l = geometryGroupsList.length; i < l; i++) {\r\n\r\n            addBuffer(_webglObjects, geometryGroupsList[i], object);\r\n\r\n          }\r\n\r\n        }\r\n\r\n      }\r\n      else if (object instanceof THREE.Line || object instanceof THREE.PointCloud) {\r\n\r\n        addBuffer(_webglObjects, geometry, object);\r\n\r\n      }\r\n      else if (object instanceof THREE.ImmediateRenderObject || object.immediateRenderCallback) {\r\n\r\n        addBufferImmediate(_webglObjectsImmediate, object);\r\n\r\n      }\r\n\r\n    }\r\n\r\n  }\r\n\r\n  // Geometry splitting\r\n\r\n  var geometryGroups = {};\r\n  var geometryGroupCounter = 0;\r\n\r\n  function makeGroups(geometry, usesFaceMaterial) {\r\n\r\n    var maxVerticesInGroup = extensions.get('OES_element_index_uint') ? 4294967296 : 65535;\r\n\r\n    var groupHash, hash_map = {};\r\n\r\n    var numMorphTargets = geometry.morphTargets.length;\r\n    var numMorphNormals = geometry.morphNormals.length;\r\n\r\n    var group;\r\n    var groups = {};\r\n    var groupsList = [];\r\n\r\n    for (var f = 0, fl = geometry.faces.length; f < fl; f++) {\r\n\r\n      var face = geometry.faces[f];\r\n      var materialIndex = usesFaceMaterial ? face.materialIndex : 0;\r\n\r\n      if (!(materialIndex in hash_map)) {\r\n\r\n        hash_map[materialIndex] = {\r\n          hash: materialIndex,\r\n          counter: 0\r\n        };\r\n\r\n      }\r\n\r\n      groupHash = hash_map[materialIndex].hash + '_' + hash_map[materialIndex].counter;\r\n\r\n      if (!(groupHash in groups)) {\r\n\r\n        group = {\r\n          id: geometryGroupCounter++,\r\n          faces3: [],\r\n          materialIndex: materialIndex,\r\n          vertices: 0,\r\n          numMorphTargets: numMorphTargets,\r\n          numMorphNormals: numMorphNormals\r\n        };\r\n\r\n        groups[groupHash] = group;\r\n        groupsList.push(group);\r\n\r\n      }\r\n\r\n      if (groups[groupHash].vertices + 3 > maxVerticesInGroup) {\r\n\r\n        hash_map[materialIndex].counter += 1;\r\n        groupHash = hash_map[materialIndex].hash + '_' + hash_map[materialIndex].counter;\r\n\r\n        if (!(groupHash in groups)) {\r\n\r\n          group = {\r\n            id: geometryGroupCounter++,\r\n            faces3: [],\r\n            materialIndex: materialIndex,\r\n            vertices: 0,\r\n            numMorphTargets: numMorphTargets,\r\n            numMorphNormals: numMorphNormals\r\n          };\r\n\r\n          groups[groupHash] = group;\r\n          groupsList.push(group);\r\n\r\n        }\r\n\r\n      }\r\n\r\n      groups[groupHash].faces3.push(f);\r\n      groups[groupHash].vertices += 3;\r\n\r\n    }\r\n\r\n    return groupsList;\r\n\r\n  }\r\n\r\n  function initGeometryGroups(object, geometry) {\r\n\r\n    var material = object.material,\r\n      addBuffers = false;\r\n\r\n    if (geometryGroups[geometry.id] === undefined || geometry.groupsNeedUpdate === true) {\r\n\r\n      delete _webglObjects[object.id];\r\n\r\n      geometryGroups[geometry.id] = makeGroups(geometry, material instanceof THREE.MeshFaceMaterial);\r\n\r\n      geometry.groupsNeedUpdate = false;\r\n\r\n    }\r\n\r\n    var geometryGroupsList = geometryGroups[geometry.id];\r\n\r\n    // create separate VBOs per geometry chunk\r\n\r\n    for (var i = 0, il = geometryGroupsList.length; i < il; i++) {\r\n\r\n      var geometryGroup = geometryGroupsList[i];\r\n\r\n      // initialise VBO on the first access\r\n\r\n      if (geometryGroup.__webglVertexBuffer === undefined) {\r\n\r\n        createMeshBuffers(geometryGroup);\r\n        initMeshBuffers(geometryGroup, object);\r\n\r\n        geometry.verticesNeedUpdate = true;\r\n        geometry.morphTargetsNeedUpdate = true;\r\n        geometry.elementsNeedUpdate = true;\r\n        geometry.uvsNeedUpdate = true;\r\n        geometry.normalsNeedUpdate = true;\r\n        geometry.tangentsNeedUpdate = true;\r\n        geometry.colorsNeedUpdate = true;\r\n\r\n        addBuffers = true;\r\n\r\n      }\r\n      else {\r\n\r\n        addBuffers = false;\r\n\r\n      }\r\n\r\n      if (addBuffers || object.__webglActive === undefined) {\r\n\r\n        addBuffer(_webglObjects, geometryGroup, object);\r\n\r\n      }\r\n\r\n    }\r\n\r\n    object.__webglActive = true;\r\n\r\n  }\r\n\r\n  function addBuffer(objlist, buffer, object) {\r\n\r\n    var id = object.id;\r\n    objlist[id] = objlist[id] || [];\r\n    objlist[id].push({\r\n      id: id,\r\n      buffer: buffer,\r\n      object: object,\r\n      material: null,\r\n      z: 0\r\n    });\r\n\r\n  };\r\n\r\n  function addBufferImmediate(objlist, object) {\r\n\r\n    objlist.push({\r\n      id: null,\r\n      object: object,\r\n      opaque: null,\r\n      transparent: null,\r\n      z: 0\r\n    });\r\n\r\n  };\r\n\r\n  // Objects updates\r\n\r\n  function updateObject(object) {\r\n\r\n    var geometry = object.geometry;\r\n\r\n    if (geometry instanceof THREE.BufferGeometry) {\r\n\r\n      var attributes = geometry.attributes;\r\n      var attributesKeys = geometry.attributesKeys;\r\n\r\n      for (var i = 0, l = attributesKeys.length; i < l; i++) {\r\n\r\n        var key = attributesKeys[i];\r\n        var attribute = attributes[key];\r\n        var bufferType = (key === 'index') ? _gl.ELEMENT_ARRAY_BUFFER : _gl.ARRAY_BUFFER;\r\n\r\n        if (attribute.buffer === undefined) {\r\n\r\n          attribute.buffer = _gl.createBuffer();\r\n          _gl.bindBuffer(bufferType, attribute.buffer);\r\n          _gl.bufferData(bufferType, attribute.array, (attribute instanceof THREE.DynamicBufferAttribute) ? _gl.DYNAMIC_DRAW : _gl.STATIC_DRAW);\r\n\r\n          attribute.needsUpdate = false;\r\n\r\n        }\r\n        else if (attribute.needsUpdate === true) {\r\n\r\n          _gl.bindBuffer(bufferType, attribute.buffer);\r\n\r\n          if (attribute.updateRange === undefined || attribute.updateRange.count === -1) { // Not using update ranges\r\n\r\n            _gl.bufferSubData(bufferType, 0, attribute.array);\r\n\r\n          }\r\n          else if (attribute.updateRange.count === 0) {\r\n\r\n            console.error('THREE.WebGLRenderer.updateObject: using updateRange for THREE.DynamicBufferAttribute and marked as needsUpdate but count is 0, ensure you are using set methods or updating manually.');\r\n\r\n          }\r\n          else {\r\n\r\n            _gl.bufferSubData(bufferType, attribute.updateRange.offset * attribute.array.BYTES_PER_ELEMENT,\r\n              attribute.array.subarray(attribute.updateRange.offset, attribute.updateRange.offset + attribute.updateRange.count));\r\n\r\n            attribute.updateRange.count = 0; // reset range\r\n\r\n          }\r\n\r\n          attribute.needsUpdate = false;\r\n\r\n        }\r\n\r\n      }\r\n\r\n    }\r\n    else if (object instanceof THREE.Mesh) {\r\n\r\n      // check all geometry groups\r\n\r\n      if (geometry.groupsNeedUpdate === true) {\r\n\r\n        initGeometryGroups(object, geometry);\r\n\r\n      }\r\n\r\n      var geometryGroupsList = geometryGroups[geometry.id];\r\n\r\n      for (var i = 0, il = geometryGroupsList.length; i < il; i++) {\r\n\r\n        var geometryGroup = geometryGroupsList[i];\r\n        var material = getBufferMaterial(object, geometryGroup);\r\n\r\n        var customAttributesDirty = material.attributes && areCustomAttributesDirty(material);\r\n\r\n        if (geometry.verticesNeedUpdate || geometry.morphTargetsNeedUpdate || geometry.elementsNeedUpdate ||\r\n          geometry.uvsNeedUpdate || geometry.normalsNeedUpdate ||\r\n          geometry.colorsNeedUpdate || geometry.tangentsNeedUpdate || customAttributesDirty) {\r\n\r\n          setMeshBuffers(geometryGroup, object, _gl.DYNAMIC_DRAW, !geometry.dynamic, material);\r\n\r\n        }\r\n\r\n      }\r\n\r\n      geometry.verticesNeedUpdate = false;\r\n      geometry.morphTargetsNeedUpdate = false;\r\n      geometry.elementsNeedUpdate = false;\r\n      geometry.uvsNeedUpdate = false;\r\n      geometry.normalsNeedUpdate = false;\r\n      geometry.colorsNeedUpdate = false;\r\n      geometry.tangentsNeedUpdate = false;\r\n\r\n      material.attributes && clearCustomAttributes(material);\r\n\r\n    }\r\n    else if (object instanceof THREE.Line) {\r\n\r\n      var material = getBufferMaterial(object, geometry);\r\n      var customAttributesDirty = material.attributes && areCustomAttributesDirty(material);\r\n\r\n      if (geometry.verticesNeedUpdate || geometry.colorsNeedUpdate || geometry.lineDistancesNeedUpdate || customAttributesDirty) {\r\n\r\n        setLineBuffers(geometry, _gl.DYNAMIC_DRAW);\r\n\r\n      }\r\n\r\n      geometry.verticesNeedUpdate = false;\r\n      geometry.colorsNeedUpdate = false;\r\n      geometry.lineDistancesNeedUpdate = false;\r\n\r\n      material.attributes && clearCustomAttributes(material);\r\n\r\n    }\r\n    else if (object instanceof THREE.PointCloud) {\r\n\r\n      var material = getBufferMaterial(object, geometry);\r\n      var customAttributesDirty = material.attributes && areCustomAttributesDirty(material);\r\n\r\n      if (geometry.verticesNeedUpdate || geometry.colorsNeedUpdate || customAttributesDirty) {\r\n\r\n        setParticleBuffers(geometry, _gl.DYNAMIC_DRAW, object);\r\n\r\n      }\r\n\r\n      geometry.verticesNeedUpdate = false;\r\n      geometry.colorsNeedUpdate = false;\r\n\r\n      material.attributes && clearCustomAttributes(material);\r\n\r\n    }\r\n\r\n  }\r\n\r\n  // Objects updates - custom attributes check\r\n\r\n  function areCustomAttributesDirty(material) {\r\n\r\n    for (var name in material.attributes) {\r\n\r\n      if (material.attributes[name].needsUpdate) return true;\r\n\r\n    }\r\n\r\n    return false;\r\n\r\n  }\r\n\r\n  function clearCustomAttributes(material) {\r\n\r\n    for (var name in material.attributes) {\r\n\r\n      material.attributes[name].needsUpdate = false;\r\n\r\n    }\r\n\r\n  }\r\n\r\n  // Objects removal\r\n\r\n  function removeObject(object) {\r\n\r\n    if (object instanceof THREE.Mesh ||\r\n      object instanceof THREE.PointCloud ||\r\n      object instanceof THREE.Line) {\r\n\r\n      delete _webglObjects[object.id];\r\n\r\n    }\r\n    else if (object instanceof THREE.ImmediateRenderObject || object.immediateRenderCallback) {\r\n\r\n      removeInstances(_webglObjectsImmediate, object);\r\n\r\n    }\r\n\r\n    delete object.__webglInit;\r\n    delete object._modelViewMatrix;\r\n    delete object._normalMatrix;\r\n\r\n    delete object.__webglActive;\r\n\r\n  }\r\n\r\n  function removeInstances(objlist, object) {\r\n\r\n    for (var o = objlist.length - 1; o >= 0; o--) {\r\n\r\n      if (objlist[o].object === object) {\r\n\r\n        objlist.splice(o, 1);\r\n\r\n      }\r\n\r\n    }\r\n\r\n  }\r\n\r\n  // Materials\r\n\r\n  var shaderIDs = {\r\n    MeshDepthMaterial: 'depth',\r\n    MeshNormalMaterial: 'normal',\r\n    MeshBasicMaterial: 'basic',\r\n    MeshLambertMaterial: 'lambert',\r\n    MeshPhongMaterial: 'phong',\r\n    LineBasicMaterial: 'basic',\r\n    LineDashedMaterial: 'dashed',\r\n    PointCloudMaterial: 'particle_basic'\r\n  };\r\n\r\n  function initMaterial(material, lights, fog, object) {\r\n\r\n    material.addEventListener('dispose', onMaterialDispose);\r\n\r\n    var shaderID = shaderIDs[material.type];\r\n\r\n    if (shaderID) {\r\n\r\n      var shader = THREE.ShaderLib[shaderID];\r\n\r\n      material.__webglShader = {\r\n        uniforms: THREE.UniformsUtils.clone(shader.uniforms),\r\n        vertexShader: shader.vertexShader,\r\n        fragmentShader: shader.fragmentShader\r\n      }\r\n\r\n    }\r\n    else {\r\n\r\n      material.__webglShader = {\r\n        uniforms: material.uniforms,\r\n        vertexShader: material.vertexShader,\r\n        fragmentShader: material.fragmentShader\r\n      }\r\n\r\n    }\r\n\r\n    // heuristics to create shader parameters according to lights in the scene\r\n    // (not to blow over maxLights budget)\r\n\r\n    var maxLightCount = allocateLights(lights);\r\n    var maxShadows = allocateShadows(lights);\r\n    var maxBones = allocateBones(object);\r\n\r\n    var parameters = {\r\n\r\n      precision: _precision,\r\n      supportsVertexTextures: _supportsVertexTextures,\r\n\r\n      map: !!material.map,\r\n      envMap: !!material.envMap,\r\n      envMapMode: material.envMap && material.envMap.mapping,\r\n      lightMap: !!material.lightMap,\r\n      bumpMap: !!material.bumpMap,\r\n      normalMap: !!material.normalMap,\r\n      specularMap: !!material.specularMap,\r\n      alphaMap: !!material.alphaMap,\r\n\r\n      combine: material.combine,\r\n\r\n      vertexColors: material.vertexColors,\r\n\r\n      fog: fog,\r\n      useFog: material.fog,\r\n      fogExp: fog instanceof THREE.FogExp2,\r\n\r\n      flatShading: material.shading === THREE.FlatShading,\r\n\r\n      sizeAttenuation: material.sizeAttenuation,\r\n      logarithmicDepthBuffer: _logarithmicDepthBuffer,\r\n\r\n      skinning: material.skinning,\r\n      maxBones: maxBones,\r\n      useVertexTexture: _supportsBoneTextures && object && object.skeleton && object.skeleton.useVertexTexture,\r\n\r\n      morphTargets: material.morphTargets,\r\n      morphNormals: material.morphNormals,\r\n      maxMorphTargets: _this.maxMorphTargets,\r\n      maxMorphNormals: _this.maxMorphNormals,\r\n\r\n      maxDirLights: maxLightCount.directional,\r\n      maxPointLights: maxLightCount.point,\r\n      maxSpotLights: maxLightCount.spot,\r\n      maxHemiLights: maxLightCount.hemi,\r\n\r\n      maxShadows: maxShadows,\r\n      shadowMapEnabled: _this.shadowMapEnabled && object.receiveShadow && maxShadows > 0,\r\n      shadowMapType: _this.shadowMapType,\r\n      shadowMapDebug: _this.shadowMapDebug,\r\n      shadowMapCascade: _this.shadowMapCascade,\r\n\r\n      alphaTest: material.alphaTest,\r\n      metal: material.metal,\r\n      wrapAround: material.wrapAround,\r\n      doubleSided: material.side === THREE.DoubleSide,\r\n      flipSided: material.side === THREE.BackSide\r\n\r\n    };\r\n\r\n    // Generate code\r\n\r\n    var chunks = [];\r\n\r\n    if (shaderID) {\r\n\r\n      chunks.push(shaderID);\r\n\r\n    }\r\n    else {\r\n\r\n      chunks.push(material.fragmentShader);\r\n      chunks.push(material.vertexShader);\r\n\r\n    }\r\n\r\n    if (material.defines !== undefined) {\r\n\r\n      for (var name in material.defines) {\r\n\r\n        chunks.push(name);\r\n        chunks.push(material.defines[name]);\r\n\r\n      }\r\n\r\n    }\r\n\r\n    for (var name in parameters) {\r\n\r\n      chunks.push(name);\r\n      chunks.push(parameters[name]);\r\n\r\n    }\r\n\r\n    var code = chunks.join();\r\n\r\n    var program;\r\n\r\n    // Check if code has been already compiled\r\n\r\n    for (var p = 0, pl = _programs.length; p < pl; p++) {\r\n\r\n      var programInfo = _programs[p];\r\n\r\n      if (programInfo.code === code) {\r\n\r\n        program = programInfo;\r\n        program.usedTimes++;\r\n\r\n        break;\r\n\r\n      }\r\n\r\n    }\r\n\r\n    if (program === undefined) {\r\n\r\n      program = new THREE.WebGLProgram(_this, code, material, parameters);\r\n      _programs.push(program);\r\n\r\n      _this.info.memory.programs = _programs.length;\r\n\r\n    }\r\n\r\n    material.program = program;\r\n\r\n    var attributes = program.attributes;\r\n\r\n    if (material.morphTargets) {\r\n\r\n      material.numSupportedMorphTargets = 0;\r\n\r\n      var id, base = 'morphTarget';\r\n\r\n      for (var i = 0; i < _this.maxMorphTargets; i++) {\r\n\r\n        id = base + i;\r\n\r\n        if (attributes[id] >= 0) {\r\n\r\n          material.numSupportedMorphTargets++;\r\n\r\n        }\r\n\r\n      }\r\n\r\n    }\r\n\r\n    if (material.morphNormals) {\r\n\r\n      material.numSupportedMorphNormals = 0;\r\n\r\n      var id, base = 'morphNormal';\r\n\r\n      for (i = 0; i < _this.maxMorphNormals; i++) {\r\n\r\n        id = base + i;\r\n\r\n        if (attributes[id] >= 0) {\r\n\r\n          material.numSupportedMorphNormals++;\r\n\r\n        }\r\n\r\n      }\r\n\r\n    }\r\n\r\n    material.uniformsList = [];\r\n\r\n    for (var u in material.__webglShader.uniforms) {\r\n\r\n      var location = material.program.uniforms[u];\r\n\r\n      if (location) {\r\n        material.uniformsList.push([material.__webglShader.uniforms[u], location]);\r\n      }\r\n\r\n    }\r\n\r\n  }\r\n\r\n  function setMaterial(material) {\r\n\r\n    if (material.transparent === true) {\r\n\r\n      state.setBlending(material.blending, material.blendEquation, material.blendSrc, material.blendDst, material.blendEquationAlpha, material.blendSrcAlpha, material.blendDstAlpha);\r\n\r\n    }\r\n    else {\r\n\r\n      state.setBlending(THREE.NoBlending);\r\n\r\n    }\r\n\r\n    state.setDepthTest(material.depthTest);\r\n    state.setDepthWrite(material.depthWrite);\r\n    state.setColorWrite(material.colorWrite);\r\n    state.setPolygonOffset(material.polygonOffset, material.polygonOffsetFactor, material.polygonOffsetUnits);\r\n\r\n  }\r\n\r\n  function setProgram(camera, lights, fog, material, object) {\r\n\r\n    _usedTextureUnits = 0;\r\n\r\n    if (material.needsUpdate) {\r\n\r\n      if (material.program) deallocateMaterial(material);\r\n\r\n      initMaterial(material, lights, fog, object);\r\n      material.needsUpdate = false;\r\n\r\n    }\r\n\r\n    if (material.morphTargets) {\r\n\r\n      if (!object.__webglMorphTargetInfluences) {\r\n\r\n        object.__webglMorphTargetInfluences = new Float32Array(_this.maxMorphTargets);\r\n\r\n      }\r\n\r\n    }\r\n\r\n    var refreshProgram = false;\r\n    var refreshMaterial = false;\r\n    var refreshLights = false;\r\n\r\n    var program = material.program,\r\n      p_uniforms = program.uniforms,\r\n      m_uniforms = material.__webglShader.uniforms;\r\n\r\n    if (program.id !== _currentProgram) {\r\n\r\n      _gl.useProgram(program.program);\r\n      _currentProgram = program.id;\r\n\r\n      refreshProgram = true;\r\n      refreshMaterial = true;\r\n      refreshLights = true;\r\n\r\n    }\r\n\r\n    if (material.id !== _currentMaterialId) {\r\n\r\n      if (_currentMaterialId === -1) refreshLights = true;\r\n      _currentMaterialId = material.id;\r\n\r\n      refreshMaterial = true;\r\n\r\n    }\r\n\r\n    if (refreshProgram || camera !== _currentCamera) {\r\n\r\n      _gl.uniformMatrix4fv(p_uniforms.projectionMatrix, false, camera.projectionMatrix.elements);\r\n\r\n      if (_logarithmicDepthBuffer) {\r\n\r\n        _gl.uniform1f(p_uniforms.logDepthBufFC, 2.0 / (Math.log(camera.far + 1.0) / Math.LN2));\r\n\r\n      }\r\n\r\n\r\n      if (camera !== _currentCamera) _currentCamera = camera;\r\n\r\n      // load material specific uniforms\r\n      // (shader material also gets them for the sake of genericity)\r\n\r\n      if (material instanceof THREE.ShaderMaterial ||\r\n        material instanceof THREE.MeshPhongMaterial ||\r\n        material.envMap) {\r\n\r\n        if (p_uniforms.cameraPosition !== null) {\r\n\r\n          _vector3.setFromMatrixPosition(camera.matrixWorld);\r\n          _gl.uniform3f(p_uniforms.cameraPosition, _vector3.x, _vector3.y, _vector3.z);\r\n\r\n        }\r\n\r\n      }\r\n\r\n      if (material instanceof THREE.MeshPhongMaterial ||\r\n        material instanceof THREE.MeshLambertMaterial ||\r\n        material instanceof THREE.MeshBasicMaterial ||\r\n        material instanceof THREE.ShaderMaterial ||\r\n        material.skinning) {\r\n\r\n        if (p_uniforms.viewMatrix !== null) {\r\n\r\n          _gl.uniformMatrix4fv(p_uniforms.viewMatrix, false, camera.matrixWorldInverse.elements);\r\n\r\n        }\r\n\r\n      }\r\n\r\n    }\r\n\r\n    // skinning uniforms must be set even if material didn't change\r\n    // auto-setting of texture unit for bone texture must go before other textures\r\n    // not sure why, but otherwise weird things happen\r\n\r\n    if (material.skinning) {\r\n\r\n      if (object.bindMatrix && p_uniforms.bindMatrix !== null) {\r\n\r\n        _gl.uniformMatrix4fv(p_uniforms.bindMatrix, false, object.bindMatrix.elements);\r\n\r\n      }\r\n\r\n      if (object.bindMatrixInverse && p_uniforms.bindMatrixInverse !== null) {\r\n\r\n        _gl.uniformMatrix4fv(p_uniforms.bindMatrixInverse, false, object.bindMatrixInverse.elements);\r\n\r\n      }\r\n\r\n      if (_supportsBoneTextures && object.skeleton && object.skeleton.useVertexTexture) {\r\n\r\n        if (p_uniforms.boneTexture !== null) {\r\n\r\n          var textureUnit = getTextureUnit();\r\n\r\n          _gl.uniform1i(p_uniforms.boneTexture, textureUnit);\r\n          _this.setTexture(object.skeleton.boneTexture, textureUnit);\r\n\r\n        }\r\n\r\n        if (p_uniforms.boneTextureWidth !== null) {\r\n\r\n          _gl.uniform1i(p_uniforms.boneTextureWidth, object.skeleton.boneTextureWidth);\r\n\r\n        }\r\n\r\n        if (p_uniforms.boneTextureHeight !== null) {\r\n\r\n          _gl.uniform1i(p_uniforms.boneTextureHeight, object.skeleton.boneTextureHeight);\r\n\r\n        }\r\n\r\n      }\r\n      else if (object.skeleton && object.skeleton.boneMatrices) {\r\n\r\n        if (p_uniforms.boneGlobalMatrices !== null) {\r\n\r\n          _gl.uniformMatrix4fv(p_uniforms.boneGlobalMatrices, false, object.skeleton.boneMatrices);\r\n\r\n        }\r\n\r\n      }\r\n\r\n    }\r\n\r\n    if (refreshMaterial) {\r\n\r\n      // refresh uniforms common to several materials\r\n\r\n      if (fog && material.fog) {\r\n\r\n        refreshUniformsFog(m_uniforms, fog);\r\n\r\n      }\r\n\r\n      if (material instanceof THREE.MeshPhongMaterial ||\r\n        material instanceof THREE.MeshLambertMaterial ||\r\n        material.lights) {\r\n\r\n        if (_lightsNeedUpdate) {\r\n\r\n          refreshLights = true;\r\n          setupLights(lights);\r\n          _lightsNeedUpdate = false;\r\n        }\r\n\r\n        if (refreshLights) {\r\n          refreshUniformsLights(m_uniforms, _lights);\r\n          markUniformsLightsNeedsUpdate(m_uniforms, true);\r\n        }\r\n        else {\r\n          markUniformsLightsNeedsUpdate(m_uniforms, false);\r\n        }\r\n\r\n      }\r\n\r\n      if (material instanceof THREE.MeshBasicMaterial ||\r\n        material instanceof THREE.MeshLambertMaterial ||\r\n        material instanceof THREE.MeshPhongMaterial) {\r\n\r\n        refreshUniformsCommon(m_uniforms, material);\r\n\r\n      }\r\n\r\n      // refresh single material specific uniforms\r\n\r\n      if (material instanceof THREE.LineBasicMaterial) {\r\n\r\n        refreshUniformsLine(m_uniforms, material);\r\n\r\n      }\r\n      else if (material instanceof THREE.LineDashedMaterial) {\r\n\r\n        refreshUniformsLine(m_uniforms, material);\r\n        refreshUniformsDash(m_uniforms, material);\r\n\r\n      }\r\n      else if (material instanceof THREE.PointCloudMaterial) {\r\n\r\n        refreshUniformsParticle(m_uniforms, material);\r\n\r\n      }\r\n      else if (material instanceof THREE.MeshPhongMaterial) {\r\n\r\n        refreshUniformsPhong(m_uniforms, material);\r\n\r\n      }\r\n      else if (material instanceof THREE.MeshLambertMaterial) {\r\n\r\n        refreshUniformsLambert(m_uniforms, material);\r\n\r\n      }\r\n      else if (material instanceof THREE.MeshDepthMaterial) {\r\n\r\n        m_uniforms.mNear.value = camera.near;\r\n        m_uniforms.mFar.value = camera.far;\r\n        m_uniforms.opacity.value = material.opacity;\r\n\r\n      }\r\n      else if (material instanceof THREE.MeshNormalMaterial) {\r\n\r\n        m_uniforms.opacity.value = material.opacity;\r\n\r\n      }\r\n\r\n      if (object.receiveShadow && !material._shadowPass) {\r\n\r\n        refreshUniformsShadow(m_uniforms, lights);\r\n\r\n      }\r\n\r\n      // load common uniforms\r\n\r\n      loadUniformsGeneric(material.uniformsList);\r\n\r\n    }\r\n\r\n    loadUniformsMatrices(p_uniforms, object);\r\n\r\n    if (p_uniforms.modelMatrix !== null) {\r\n\r\n      _gl.uniformMatrix4fv(p_uniforms.modelMatrix, false, object.matrixWorld.elements);\r\n\r\n    }\r\n\r\n    return program;\r\n\r\n  }\r\n\r\n  // Uniforms (refresh uniforms objects)\r\n\r\n  function refreshUniformsCommon(uniforms, material) {\r\n\r\n    uniforms.opacity.value = material.opacity;\r\n\r\n    uniforms.diffuse.value = material.color;\r\n\r\n    uniforms.map.value = material.map;\r\n    uniforms.lightMap.value = material.lightMap;\r\n    uniforms.specularMap.value = material.specularMap;\r\n    uniforms.alphaMap.value = material.alphaMap;\r\n\r\n    if (material.bumpMap) {\r\n\r\n      uniforms.bumpMap.value = material.bumpMap;\r\n      uniforms.bumpScale.value = material.bumpScale;\r\n\r\n    }\r\n\r\n    if (material.normalMap) {\r\n\r\n      uniforms.normalMap.value = material.normalMap;\r\n      uniforms.normalScale.value.copy(material.normalScale);\r\n\r\n    }\r\n\r\n    // uv repeat and offset setting priorities\r\n    //  1. color map\r\n    //  2. specular map\r\n    //  3. normal map\r\n    //  4. bump map\r\n    //  5. alpha map\r\n\r\n    var uvScaleMap;\r\n\r\n    if (material.map) {\r\n\r\n      uvScaleMap = material.map;\r\n\r\n    }\r\n    else if (material.specularMap) {\r\n\r\n      uvScaleMap = material.specularMap;\r\n\r\n    }\r\n    else if (material.normalMap) {\r\n\r\n      uvScaleMap = material.normalMap;\r\n\r\n    }\r\n    else if (material.bumpMap) {\r\n\r\n      uvScaleMap = material.bumpMap;\r\n\r\n    }\r\n    else if (material.alphaMap) {\r\n\r\n      uvScaleMap = material.alphaMap;\r\n\r\n    }\r\n\r\n    if (uvScaleMap !== undefined) {\r\n\r\n      var offset = uvScaleMap.offset;\r\n      var repeat = uvScaleMap.repeat;\r\n\r\n      uniforms.offsetRepeat.value.set(offset.x, offset.y, repeat.x, repeat.y);\r\n\r\n    }\r\n\r\n    uniforms.envMap.value = material.envMap;\r\n    uniforms.flipEnvMap.value = (material.envMap instanceof THREE.WebGLRenderTargetCube) ? 1 : -1;\r\n\r\n    uniforms.reflectivity.value = material.reflectivity;\r\n    uniforms.refractionRatio.value = material.refractionRatio;\r\n\r\n  }\r\n\r\n  function refreshUniformsLine(uniforms, material) {\r\n\r\n    uniforms.diffuse.value = material.color;\r\n    uniforms.opacity.value = material.opacity;\r\n\r\n  }\r\n\r\n  function refreshUniformsDash(uniforms, material) {\r\n\r\n    uniforms.dashSize.value = material.dashSize;\r\n    uniforms.totalSize.value = material.dashSize + material.gapSize;\r\n    uniforms.scale.value = material.scale;\r\n\r\n  }\r\n\r\n  function refreshUniformsParticle(uniforms, material) {\r\n\r\n    uniforms.psColor.value = material.color;\r\n    uniforms.opacity.value = material.opacity;\r\n    uniforms.size.value = material.size;\r\n    uniforms.scale.value = _canvas.height / 2.0; // TODO: Cache this.\r\n\r\n    uniforms.map.value = material.map;\r\n\r\n    if (material.map !== null) {\r\n\r\n      var offset = material.map.offset;\r\n      var repeat = material.map.repeat;\r\n\r\n      uniforms.offsetRepeat.value.set(offset.x, offset.y, repeat.x, repeat.y);\r\n\r\n    }\r\n\r\n  }\r\n\r\n  function refreshUniformsFog(uniforms, fog) {\r\n\r\n    uniforms.fogColor.value = fog.color;\r\n\r\n    if (fog instanceof THREE.Fog) {\r\n\r\n      uniforms.fogNear.value = fog.near;\r\n      uniforms.fogFar.value = fog.far;\r\n\r\n    }\r\n    else if (fog instanceof THREE.FogExp2) {\r\n\r\n      uniforms.fogDensity.value = fog.density;\r\n\r\n    }\r\n\r\n  }\r\n\r\n  function refreshUniformsPhong(uniforms, material) {\r\n\r\n    uniforms.shininess.value = material.shininess;\r\n\r\n    uniforms.emissive.value = material.emissive;\r\n    uniforms.specular.value = material.specular;\r\n\r\n    if (material.wrapAround) {\r\n\r\n      uniforms.wrapRGB.value.copy(material.wrapRGB);\r\n\r\n    }\r\n\r\n  }\r\n\r\n  function refreshUniformsLambert(uniforms, material) {\r\n\r\n    uniforms.emissive.value = material.emissive;\r\n\r\n    if (material.wrapAround) {\r\n\r\n      uniforms.wrapRGB.value.copy(material.wrapRGB);\r\n\r\n    }\r\n\r\n  }\r\n\r\n  function refreshUniformsLights(uniforms, lights) {\r\n\r\n    uniforms.ambientLightColor.value = lights.ambient;\r\n\r\n    uniforms.directionalLightColor.value = lights.directional.colors;\r\n    uniforms.directionalLightDirection.value = lights.directional.positions;\r\n\r\n    uniforms.pointLightColor.value = lights.point.colors;\r\n    uniforms.pointLightPosition.value = lights.point.positions;\r\n    uniforms.pointLightDistance.value = lights.point.distances;\r\n    uniforms.pointLightDecay.value = lights.point.decays;\r\n\r\n    uniforms.spotLightColor.value = lights.spot.colors;\r\n    uniforms.spotLightPosition.value = lights.spot.positions;\r\n    uniforms.spotLightDistance.value = lights.spot.distances;\r\n    uniforms.spotLightDirection.value = lights.spot.directions;\r\n    uniforms.spotLightAngleCos.value = lights.spot.anglesCos;\r\n    uniforms.spotLightExponent.value = lights.spot.exponents;\r\n    uniforms.spotLightDecay.value = lights.spot.decays;\r\n\r\n    uniforms.hemisphereLightSkyColor.value = lights.hemi.skyColors;\r\n    uniforms.hemisphereLightGroundColor.value = lights.hemi.groundColors;\r\n    uniforms.hemisphereLightDirection.value = lights.hemi.positions;\r\n\r\n  }\r\n\r\n  // If uniforms are marked as clean, they don't need to be loaded to the GPU.\r\n\r\n  function markUniformsLightsNeedsUpdate(uniforms, value) {\r\n\r\n    uniforms.ambientLightColor.needsUpdate = value;\r\n\r\n    uniforms.directionalLightColor.needsUpdate = value;\r\n    uniforms.directionalLightDirection.needsUpdate = value;\r\n\r\n    uniforms.pointLightColor.needsUpdate = value;\r\n    uniforms.pointLightPosition.needsUpdate = value;\r\n    uniforms.pointLightDistance.needsUpdate = value;\r\n    uniforms.pointLightDecay.needsUpdate = value;\r\n\r\n    uniforms.spotLightColor.needsUpdate = value;\r\n    uniforms.spotLightPosition.needsUpdate = value;\r\n    uniforms.spotLightDistance.needsUpdate = value;\r\n    uniforms.spotLightDirection.needsUpdate = value;\r\n    uniforms.spotLightAngleCos.needsUpdate = value;\r\n    uniforms.spotLightExponent.needsUpdate = value;\r\n    uniforms.spotLightDecay.needsUpdate = value;\r\n\r\n    uniforms.hemisphereLightSkyColor.needsUpdate = value;\r\n    uniforms.hemisphereLightGroundColor.needsUpdate = value;\r\n    uniforms.hemisphereLightDirection.needsUpdate = value;\r\n\r\n  }\r\n\r\n  function refreshUniformsShadow(uniforms, lights) {\r\n\r\n    if (uniforms.shadowMatrix) {\r\n\r\n      var j = 0;\r\n\r\n      for (var i = 0, il = lights.length; i < il; i++) {\r\n\r\n        var light = lights[i];\r\n\r\n        if (!light.castShadow) continue;\r\n\r\n        if (light instanceof THREE.SpotLight || (light instanceof THREE.DirectionalLight && !light.shadowCascade)) {\r\n\r\n          uniforms.shadowMap.value[j] = light.shadowMap;\r\n          uniforms.shadowMapSize.value[j] = light.shadowMapSize;\r\n\r\n          uniforms.shadowMatrix.value[j] = light.shadowMatrix;\r\n\r\n          uniforms.shadowDarkness.value[j] = light.shadowDarkness;\r\n          uniforms.shadowBias.value[j] = light.shadowBias;\r\n\r\n          j++;\r\n\r\n        }\r\n\r\n      }\r\n\r\n    }\r\n\r\n  }\r\n\r\n  // Uniforms (load to GPU)\r\n\r\n  function loadUniformsMatrices(uniforms, object) {\r\n\r\n    _gl.uniformMatrix4fv(uniforms.modelViewMatrix, false, object._modelViewMatrix.elements);\r\n\r\n    if (uniforms.normalMatrix) {\r\n\r\n      _gl.uniformMatrix3fv(uniforms.normalMatrix, false, object._normalMatrix.elements);\r\n\r\n    }\r\n\r\n  }\r\n\r\n  function getTextureUnit() {\r\n\r\n    var textureUnit = _usedTextureUnits;\r\n\r\n    if (textureUnit >= _maxTextures) {\r\n\r\n      THREE.warn('WebGLRenderer: trying to use ' + textureUnit + ' texture units while this GPU supports only ' + _maxTextures);\r\n\r\n    }\r\n\r\n    _usedTextureUnits += 1;\r\n\r\n    return textureUnit;\r\n\r\n  }\r\n\r\n  function loadUniformsGeneric(uniforms) {\r\n\r\n    var texture, textureUnit, offset;\r\n\r\n    for (var j = 0, jl = uniforms.length; j < jl; j++) {\r\n\r\n      var uniform = uniforms[j][0];\r\n\r\n      // needsUpdate property is not added to all uniforms.\r\n      if (uniform.needsUpdate === false) continue;\r\n\r\n      var type = uniform.type;\r\n      var value = uniform.value;\r\n      var location = uniforms[j][1];\r\n\r\n      switch (type) {\r\n\r\n        case '1i':\r\n          _gl.uniform1i(location, value);\r\n          break;\r\n\r\n        case '1f':\r\n          _gl.uniform1f(location, value);\r\n          break;\r\n\r\n        case '2f':\r\n          _gl.uniform2f(location, value[0], value[1]);\r\n          break;\r\n\r\n        case '3f':\r\n          _gl.uniform3f(location, value[0], value[1], value[2]);\r\n          break;\r\n\r\n        case '4f':\r\n          _gl.uniform4f(location, value[0], value[1], value[2], value[3]);\r\n          break;\r\n\r\n        case '1iv':\r\n          _gl.uniform1iv(location, value);\r\n          break;\r\n\r\n        case '3iv':\r\n          _gl.uniform3iv(location, value);\r\n          break;\r\n\r\n        case '1fv':\r\n          _gl.uniform1fv(location, value);\r\n          break;\r\n\r\n        case '2fv':\r\n          _gl.uniform2fv(location, value);\r\n          break;\r\n\r\n        case '3fv':\r\n          _gl.uniform3fv(location, value);\r\n          break;\r\n\r\n        case '4fv':\r\n          _gl.uniform4fv(location, value);\r\n          break;\r\n\r\n        case 'Matrix3fv':\r\n          _gl.uniformMatrix3fv(location, false, value);\r\n          break;\r\n\r\n        case 'Matrix4fv':\r\n          _gl.uniformMatrix4fv(location, false, value);\r\n          break;\r\n\r\n          //\r\n\r\n        case 'i':\r\n\r\n          // single integer\r\n          _gl.uniform1i(location, value);\r\n\r\n          break;\r\n\r\n        case 'f':\r\n\r\n          // single float\r\n          _gl.uniform1f(location, value);\r\n\r\n          break;\r\n\r\n        case 'v2':\r\n\r\n          // single THREE.Vector2\r\n          _gl.uniform2f(location, value.x, value.y);\r\n\r\n          break;\r\n\r\n        case 'v3':\r\n\r\n          // single THREE.Vector3\r\n          _gl.uniform3f(location, value.x, value.y, value.z);\r\n\r\n          break;\r\n\r\n        case 'v4':\r\n\r\n          // single THREE.Vector4\r\n          _gl.uniform4f(location, value.x, value.y, value.z, value.w);\r\n\r\n          break;\r\n\r\n        case 'c':\r\n\r\n          // single THREE.Color\r\n          _gl.uniform3f(location, value.r, value.g, value.b);\r\n\r\n          break;\r\n\r\n        case 'iv1':\r\n\r\n          // flat array of integers (JS or typed array)\r\n          _gl.uniform1iv(location, value);\r\n\r\n          break;\r\n\r\n        case 'iv':\r\n\r\n          // flat array of integers with 3 x N size (JS or typed array)\r\n          _gl.uniform3iv(location, value);\r\n\r\n          break;\r\n\r\n        case 'fv1':\r\n\r\n          // flat array of floats (JS or typed array)\r\n          _gl.uniform1fv(location, value);\r\n\r\n          break;\r\n\r\n        case 'fv':\r\n\r\n          // flat array of floats with 3 x N size (JS or typed array)\r\n          _gl.uniform3fv(location, value);\r\n\r\n          break;\r\n\r\n        case 'v2v':\r\n\r\n          // array of THREE.Vector2\r\n\r\n          if (uniform._array === undefined) {\r\n\r\n            uniform._array = new Float32Array(2 * value.length);\r\n\r\n          }\r\n\r\n          for (var i = 0, il = value.length; i < il; i++) {\r\n\r\n            offset = i * 2;\r\n\r\n            uniform._array[offset] = value[i].x;\r\n            uniform._array[offset + 1] = value[i].y;\r\n\r\n          }\r\n\r\n          _gl.uniform2fv(location, uniform._array);\r\n\r\n          break;\r\n\r\n        case 'v3v':\r\n\r\n          // array of THREE.Vector3\r\n\r\n          if (uniform._array === undefined) {\r\n\r\n            uniform._array = new Float32Array(3 * value.length);\r\n\r\n          }\r\n\r\n          for (var i = 0, il = value.length; i < il; i++) {\r\n\r\n            offset = i * 3;\r\n\r\n            uniform._array[offset] = value[i].x;\r\n            uniform._array[offset + 1] = value[i].y;\r\n            uniform._array[offset + 2] = value[i].z;\r\n\r\n          }\r\n\r\n          _gl.uniform3fv(location, uniform._array);\r\n\r\n          break;\r\n\r\n        case 'v4v':\r\n\r\n          // array of THREE.Vector4\r\n\r\n          if (uniform._array === undefined) {\r\n\r\n            uniform._array = new Float32Array(4 * value.length);\r\n\r\n          }\r\n\r\n          for (var i = 0, il = value.length; i < il; i++) {\r\n\r\n            offset = i * 4;\r\n\r\n            uniform._array[offset] = value[i].x;\r\n            uniform._array[offset + 1] = value[i].y;\r\n            uniform._array[offset + 2] = value[i].z;\r\n            uniform._array[offset + 3] = value[i].w;\r\n\r\n          }\r\n\r\n          _gl.uniform4fv(location, uniform._array);\r\n\r\n          break;\r\n\r\n        case 'm3':\r\n\r\n          // single THREE.Matrix3\r\n          _gl.uniformMatrix3fv(location, false, value.elements);\r\n\r\n          break;\r\n\r\n        case 'm3v':\r\n\r\n          // array of THREE.Matrix3\r\n\r\n          if (uniform._array === undefined) {\r\n\r\n            uniform._array = new Float32Array(9 * value.length);\r\n\r\n          }\r\n\r\n          for (var i = 0, il = value.length; i < il; i++) {\r\n\r\n            value[i].flattenToArrayOffset(uniform._array, i * 9);\r\n\r\n          }\r\n\r\n          _gl.uniformMatrix3fv(location, false, uniform._array);\r\n\r\n          break;\r\n\r\n        case 'm4':\r\n\r\n          // single THREE.Matrix4\r\n          _gl.uniformMatrix4fv(location, false, value.elements);\r\n\r\n          break;\r\n\r\n        case 'm4v':\r\n\r\n          // array of THREE.Matrix4\r\n\r\n          if (uniform._array === undefined) {\r\n\r\n            uniform._array = new Float32Array(16 * value.length);\r\n\r\n          }\r\n\r\n          for (var i = 0, il = value.length; i < il; i++) {\r\n\r\n            value[i].flattenToArrayOffset(uniform._array, i * 16);\r\n\r\n          }\r\n\r\n          _gl.uniformMatrix4fv(location, false, uniform._array);\r\n\r\n          break;\r\n\r\n        case 't':\r\n\r\n          // single THREE.Texture (2d or cube)\r\n\r\n          texture = value;\r\n          textureUnit = getTextureUnit();\r\n\r\n          _gl.uniform1i(location, textureUnit);\r\n\r\n          if (!texture) continue;\r\n\r\n          if (texture instanceof THREE.CubeTexture ||\r\n            (texture.image instanceof Array && texture.image.length === 6)) { // CompressedTexture can have Array in image :/\r\n\r\n            setCubeTexture(texture, textureUnit);\r\n\r\n          }\r\n          else if (texture instanceof THREE.WebGLRenderTargetCube) {\r\n\r\n            setCubeTextureDynamic(texture, textureUnit);\r\n\r\n          }\r\n          else {\r\n\r\n            _this.setTexture(texture, textureUnit);\r\n\r\n          }\r\n\r\n          break;\r\n\r\n        case 'tv':\r\n\r\n          // array of THREE.Texture (2d)\r\n\r\n          if (uniform._array === undefined) {\r\n\r\n            uniform._array = [];\r\n\r\n          }\r\n\r\n          for (var i = 0, il = uniform.value.length; i < il; i++) {\r\n\r\n            uniform._array[i] = getTextureUnit();\r\n\r\n          }\r\n\r\n          _gl.uniform1iv(location, uniform._array);\r\n\r\n          for (var i = 0, il = uniform.value.length; i < il; i++) {\r\n\r\n            texture = uniform.value[i];\r\n            textureUnit = uniform._array[i];\r\n\r\n            if (!texture) continue;\r\n\r\n            _this.setTexture(texture, textureUnit);\r\n\r\n          }\r\n\r\n          break;\r\n\r\n        default:\r\n\r\n          THREE.warn('THREE.WebGLRenderer: Unknown uniform type: ' + type);\r\n\r\n      }\r\n\r\n    }\r\n\r\n  }\r\n\r\n  function setupMatrices(object, camera) {\r\n\r\n    object._modelViewMatrix.multiplyMatrices(camera.matrixWorldInverse, object.matrixWorld);\r\n    object._normalMatrix.getNormalMatrix(object._modelViewMatrix);\r\n\r\n  }\r\n\r\n  function setColorLinear(array, offset, color, intensity) {\r\n\r\n    array[offset] = color.r * intensity;\r\n    array[offset + 1] = color.g * intensity;\r\n    array[offset + 2] = color.b * intensity;\r\n\r\n  }\r\n\r\n  function setupLights(lights) {\r\n\r\n    var l, ll, light,\r\n      r = 0,\r\n      g = 0,\r\n      b = 0,\r\n      color, skyColor, groundColor,\r\n      intensity,\r\n      distance,\r\n\r\n      zlights = _lights,\r\n\r\n      dirColors = zlights.directional.colors,\r\n      dirPositions = zlights.directional.positions,\r\n\r\n      pointColors = zlights.point.colors,\r\n      pointPositions = zlights.point.positions,\r\n      pointDistances = zlights.point.distances,\r\n      pointDecays = zlights.point.decays,\r\n\r\n      spotColors = zlights.spot.colors,\r\n      spotPositions = zlights.spot.positions,\r\n      spotDistances = zlights.spot.distances,\r\n      spotDirections = zlights.spot.directions,\r\n      spotAnglesCos = zlights.spot.anglesCos,\r\n      spotExponents = zlights.spot.exponents,\r\n      spotDecays = zlights.spot.decays,\r\n\r\n      hemiSkyColors = zlights.hemi.skyColors,\r\n      hemiGroundColors = zlights.hemi.groundColors,\r\n      hemiPositions = zlights.hemi.positions,\r\n\r\n      dirLength = 0,\r\n      pointLength = 0,\r\n      spotLength = 0,\r\n      hemiLength = 0,\r\n\r\n      dirCount = 0,\r\n      pointCount = 0,\r\n      spotCount = 0,\r\n      hemiCount = 0,\r\n\r\n      dirOffset = 0,\r\n      pointOffset = 0,\r\n      spotOffset = 0,\r\n      hemiOffset = 0;\r\n\r\n    for (l = 0, ll = lights.length; l < ll; l++) {\r\n\r\n      light = lights[l];\r\n\r\n      if (light.onlyShadow) continue;\r\n\r\n      color = light.color;\r\n      intensity = light.intensity;\r\n      distance = light.distance;\r\n\r\n      if (light instanceof THREE.AmbientLight) {\r\n\r\n        if (!light.visible) continue;\r\n\r\n        r += color.r;\r\n        g += color.g;\r\n        b += color.b;\r\n\r\n      }\r\n      else if (light instanceof THREE.DirectionalLight) {\r\n\r\n        dirCount += 1;\r\n\r\n        if (!light.visible) continue;\r\n\r\n        _direction.setFromMatrixPosition(light.matrixWorld);\r\n        _vector3.setFromMatrixPosition(light.target.matrixWorld);\r\n        _direction.sub(_vector3);\r\n        _direction.normalize();\r\n\r\n        dirOffset = dirLength * 3;\r\n\r\n        dirPositions[dirOffset] = _direction.x;\r\n        dirPositions[dirOffset + 1] = _direction.y;\r\n        dirPositions[dirOffset + 2] = _direction.z;\r\n\r\n        setColorLinear(dirColors, dirOffset, color, intensity);\r\n\r\n        dirLength += 1;\r\n\r\n      }\r\n      else if (light instanceof THREE.PointLight) {\r\n\r\n        pointCount += 1;\r\n\r\n        if (!light.visible) continue;\r\n\r\n        pointOffset = pointLength * 3;\r\n\r\n        setColorLinear(pointColors, pointOffset, color, intensity);\r\n\r\n        _vector3.setFromMatrixPosition(light.matrixWorld);\r\n\r\n        pointPositions[pointOffset] = _vector3.x;\r\n        pointPositions[pointOffset + 1] = _vector3.y;\r\n        pointPositions[pointOffset + 2] = _vector3.z;\r\n\r\n        // distance is 0 if decay is 0, because there is no attenuation at all.\r\n        pointDistances[pointLength] = distance;\r\n        pointDecays[pointLength] = (light.distance === 0) ? 0.0 : light.decay;\r\n\r\n        pointLength += 1;\r\n\r\n      }\r\n      else if (light instanceof THREE.SpotLight) {\r\n\r\n        spotCount += 1;\r\n\r\n        if (!light.visible) continue;\r\n\r\n        spotOffset = spotLength * 3;\r\n\r\n        setColorLinear(spotColors, spotOffset, color, intensity);\r\n\r\n        _direction.setFromMatrixPosition(light.matrixWorld);\r\n\r\n        spotPositions[spotOffset] = _direction.x;\r\n        spotPositions[spotOffset + 1] = _direction.y;\r\n        spotPositions[spotOffset + 2] = _direction.z;\r\n\r\n        spotDistances[spotLength] = distance;\r\n\r\n        _vector3.setFromMatrixPosition(light.target.matrixWorld);\r\n        _direction.sub(_vector3);\r\n        _direction.normalize();\r\n\r\n        spotDirections[spotOffset] = _direction.x;\r\n        spotDirections[spotOffset + 1] = _direction.y;\r\n        spotDirections[spotOffset + 2] = _direction.z;\r\n\r\n        spotAnglesCos[spotLength] = Math.cos(light.angle);\r\n        spotExponents[spotLength] = light.exponent;\r\n        spotDecays[spotLength] = (light.distance === 0) ? 0.0 : light.decay;\r\n\r\n        spotLength += 1;\r\n\r\n      }\r\n      else if (light instanceof THREE.HemisphereLight) {\r\n\r\n        hemiCount += 1;\r\n\r\n        if (!light.visible) continue;\r\n\r\n        _direction.setFromMatrixPosition(light.matrixWorld);\r\n        _direction.normalize();\r\n\r\n        hemiOffset = hemiLength * 3;\r\n\r\n        hemiPositions[hemiOffset] = _direction.x;\r\n        hemiPositions[hemiOffset + 1] = _direction.y;\r\n        hemiPositions[hemiOffset + 2] = _direction.z;\r\n\r\n        skyColor = light.color;\r\n        groundColor = light.groundColor;\r\n\r\n        setColorLinear(hemiSkyColors, hemiOffset, skyColor, intensity);\r\n        setColorLinear(hemiGroundColors, hemiOffset, groundColor, intensity);\r\n\r\n        hemiLength += 1;\r\n\r\n      }\r\n\r\n    }\r\n\r\n    // null eventual remains from removed lights\r\n    // (this is to avoid if in shader)\r\n\r\n    for (l = dirLength * 3, ll = Math.max(dirColors.length, dirCount * 3); l < ll; l++) dirColors[l] = 0.0;\r\n    for (l = pointLength * 3, ll = Math.max(pointColors.length, pointCount * 3); l < ll; l++) pointColors[l] = 0.0;\r\n    for (l = spotLength * 3, ll = Math.max(spotColors.length, spotCount * 3); l < ll; l++) spotColors[l] = 0.0;\r\n    for (l = hemiLength * 3, ll = Math.max(hemiSkyColors.length, hemiCount * 3); l < ll; l++) hemiSkyColors[l] = 0.0;\r\n    for (l = hemiLength * 3, ll = Math.max(hemiGroundColors.length, hemiCount * 3); l < ll; l++) hemiGroundColors[l] = 0.0;\r\n\r\n    zlights.directional.length = dirLength;\r\n    zlights.point.length = pointLength;\r\n    zlights.spot.length = spotLength;\r\n    zlights.hemi.length = hemiLength;\r\n\r\n    zlights.ambient[0] = r;\r\n    zlights.ambient[1] = g;\r\n    zlights.ambient[2] = b;\r\n\r\n  }\r\n\r\n  // GL state setting\r\n\r\n  this.setFaceCulling = function(cullFace, frontFaceDirection) {\r\n\r\n    if (cullFace === THREE.CullFaceNone) {\r\n\r\n      _gl.disable(_gl.CULL_FACE);\r\n\r\n    }\r\n    else {\r\n\r\n      if (frontFaceDirection === THREE.FrontFaceDirectionCW) {\r\n\r\n        _gl.frontFace(_gl.CW);\r\n\r\n      }\r\n      else {\r\n\r\n        _gl.frontFace(_gl.CCW);\r\n\r\n      }\r\n\r\n      if (cullFace === THREE.CullFaceBack) {\r\n\r\n        _gl.cullFace(_gl.BACK);\r\n\r\n      }\r\n      else if (cullFace === THREE.CullFaceFront) {\r\n\r\n        _gl.cullFace(_gl.FRONT);\r\n\r\n      }\r\n      else {\r\n\r\n        _gl.cullFace(_gl.FRONT_AND_BACK);\r\n\r\n      }\r\n\r\n      _gl.enable(_gl.CULL_FACE);\r\n\r\n    }\r\n\r\n  };\r\n\r\n  this.setMaterialFaces = function(material) {\r\n\r\n    state.setDoubleSided(material.side === THREE.DoubleSide);\r\n    state.setFlipSided(material.side === THREE.BackSide);\r\n\r\n  };\r\n\r\n  // Textures\r\n\r\n  function setTextureParameters(textureType, texture, isImagePowerOfTwo) {\r\n\r\n    var extension;\r\n\r\n    if (isImagePowerOfTwo) {\r\n\r\n      _gl.texParameteri(textureType, _gl.TEXTURE_WRAP_S, paramThreeToGL(texture.wrapS));\r\n      _gl.texParameteri(textureType, _gl.TEXTURE_WRAP_T, paramThreeToGL(texture.wrapT));\r\n\r\n      _gl.texParameteri(textureType, _gl.TEXTURE_MAG_FILTER, paramThreeToGL(texture.magFilter));\r\n      _gl.texParameteri(textureType, _gl.TEXTURE_MIN_FILTER, paramThreeToGL(texture.minFilter));\r\n\r\n    }\r\n    else {\r\n\r\n      _gl.texParameteri(textureType, _gl.TEXTURE_WRAP_S, _gl.CLAMP_TO_EDGE);\r\n      _gl.texParameteri(textureType, _gl.TEXTURE_WRAP_T, _gl.CLAMP_TO_EDGE);\r\n\r\n      if (texture.wrapS !== THREE.ClampToEdgeWrapping || texture.wrapT !== THREE.ClampToEdgeWrapping) {\r\n\r\n        THREE.warn('THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping. ( ' + texture.sourceFile + ' )');\r\n\r\n      }\r\n\r\n      _gl.texParameteri(textureType, _gl.TEXTURE_MAG_FILTER, filterFallback(texture.magFilter));\r\n      _gl.texParameteri(textureType, _gl.TEXTURE_MIN_FILTER, filterFallback(texture.minFilter));\r\n\r\n      if (texture.minFilter !== THREE.NearestFilter && texture.minFilter !== THREE.LinearFilter) {\r\n\r\n        THREE.warn('THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter. ( ' + texture.sourceFile + ' )');\r\n\r\n      }\r\n\r\n    }\r\n\r\n    extension = extensions.get('EXT_texture_filter_anisotropic');\r\n\r\n    if (extension && texture.type !== THREE.FloatType && texture.type !== THREE.HalfFloatType) {\r\n\r\n      if (texture.anisotropy > 1 || texture.__currentAnisotropy) {\r\n\r\n        _gl.texParameterf(textureType, extension.TEXTURE_MAX_ANISOTROPY_EXT, Math.min(texture.anisotropy, _this.getMaxAnisotropy()));\r\n        texture.__currentAnisotropy = texture.anisotropy;\r\n\r\n      }\r\n\r\n    }\r\n\r\n  }\r\n\r\n  this.uploadTexture = function(texture) {\r\n\r\n    if (texture.__webglInit === undefined) {\r\n\r\n      texture.__webglInit = true;\r\n\r\n      texture.addEventListener('dispose', onTextureDispose);\r\n\r\n      texture.__webglTexture = _gl.createTexture();\r\n\r\n      _this.info.memory.textures++;\r\n\r\n    }\r\n\r\n    _gl.bindTexture(_gl.TEXTURE_2D, texture.__webglTexture);\r\n\r\n    _gl.pixelStorei(_gl.UNPACK_FLIP_Y_WEBGL, texture.flipY);\r\n    _gl.pixelStorei(_gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL, texture.premultiplyAlpha);\r\n    _gl.pixelStorei(_gl.UNPACK_ALIGNMENT, texture.unpackAlignment);\r\n\r\n    texture.image = clampToMaxSize(texture.image, _maxTextureSize);\r\n\r\n    var image = texture.image,\r\n      isImagePowerOfTwo = THREE.Math.isPowerOfTwo(image.width) && THREE.Math.isPowerOfTwo(image.height),\r\n      glFormat = paramThreeToGL(texture.format),\r\n      glType = paramThreeToGL(texture.type);\r\n\r\n    setTextureParameters(_gl.TEXTURE_2D, texture, isImagePowerOfTwo);\r\n\r\n    var mipmap, mipmaps = texture.mipmaps;\r\n\r\n    if (texture instanceof THREE.DataTexture) {\r\n\r\n      // use manually created mipmaps if available\r\n      // if there are no manual mipmaps\r\n      // set 0 level mipmap and then use GL to generate other mipmap levels\r\n\r\n      if (mipmaps.length > 0 && isImagePowerOfTwo) {\r\n\r\n        for (var i = 0, il = mipmaps.length; i < il; i++) {\r\n\r\n          mipmap = mipmaps[i];\r\n          _gl.texImage2D(_gl.TEXTURE_2D, i, glFormat, mipmap.width, mipmap.height, 0, glFormat, glType, mipmap.data);\r\n\r\n        }\r\n\r\n        texture.generateMipmaps = false;\r\n\r\n      }\r\n      else {\r\n\r\n        _gl.texImage2D(_gl.TEXTURE_2D, 0, glFormat, image.width, image.height, 0, glFormat, glType, image.data);\r\n\r\n      }\r\n\r\n    }\r\n    else if (texture instanceof THREE.CompressedTexture) {\r\n\r\n      for (var i = 0, il = mipmaps.length; i < il; i++) {\r\n\r\n        mipmap = mipmaps[i];\r\n\r\n        if (texture.format !== THREE.RGBAFormat && texture.format !== THREE.RGBFormat) {\r\n\r\n          if (getCompressedTextureFormats().indexOf(glFormat) > -1) {\r\n\r\n            _gl.compressedTexImage2D(_gl.TEXTURE_2D, i, glFormat, mipmap.width, mipmap.height, 0, mipmap.data);\r\n\r\n          }\r\n          else {\r\n\r\n            THREE.warn(\"THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()\");\r\n\r\n          }\r\n\r\n        }\r\n        else {\r\n\r\n          _gl.texImage2D(_gl.TEXTURE_2D, i, glFormat, mipmap.width, mipmap.height, 0, glFormat, glType, mipmap.data);\r\n\r\n        }\r\n\r\n      }\r\n\r\n    }\r\n    else { // regular Texture (image, video, canvas)\r\n\r\n      // use manually created mipmaps if available\r\n      // if there are no manual mipmaps\r\n      // set 0 level mipmap and then use GL to generate other mipmap levels\r\n\r\n      if (mipmaps.length > 0 && isImagePowerOfTwo) {\r\n\r\n        for (var i = 0, il = mipmaps.length; i < il; i++) {\r\n\r\n          mipmap = mipmaps[i];\r\n          _gl.texImage2D(_gl.TEXTURE_2D, i, glFormat, glFormat, glType, mipmap);\r\n\r\n        }\r\n\r\n        texture.generateMipmaps = false;\r\n\r\n      }\r\n      else {\r\n\r\n        _gl.texImage2D(_gl.TEXTURE_2D, 0, glFormat, glFormat, glType, texture.image);\r\n\r\n      }\r\n\r\n    }\r\n\r\n    if (texture.generateMipmaps && isImagePowerOfTwo) _gl.generateMipmap(_gl.TEXTURE_2D);\r\n\r\n    texture.needsUpdate = false;\r\n\r\n    if (texture.onUpdate) texture.onUpdate();\r\n\r\n  };\r\n\r\n  this.setTexture = function(texture, slot) {\r\n\r\n    _gl.activeTexture(_gl.TEXTURE0 + slot);\r\n\r\n    if (texture.needsUpdate) {\r\n\r\n      _this.uploadTexture(texture);\r\n\r\n    }\r\n    else {\r\n\r\n      _gl.bindTexture(_gl.TEXTURE_2D, texture.__webglTexture);\r\n\r\n    }\r\n\r\n  };\r\n\r\n  function clampToMaxSize(image, maxSize) {\r\n\r\n    if (image.width > maxSize || image.height > maxSize) {\r\n\r\n      // Warning: Scaling through the canvas will only work with images that use\r\n      // premultiplied alpha.\r\n\r\n      var scale = maxSize / Math.max(image.width, image.height);\r\n\r\n      var canvas = document.createElement('canvas');\r\n      canvas.width = Math.floor(image.width * scale);\r\n      canvas.height = Math.floor(image.height * scale);\r\n\r\n      var context = canvas.getContext('2d');\r\n      context.drawImage(image, 0, 0, image.width, image.height, 0, 0, canvas.width, canvas.height);\r\n\r\n      THREE.warn('THREE.WebGLRenderer: image is too big (' + image.width + 'x' + image.height + '). Resized to ' + canvas.width + 'x' + canvas.height, image);\r\n\r\n      return canvas;\r\n\r\n    }\r\n\r\n    return image;\r\n\r\n  }\r\n\r\n  function setCubeTexture(texture, slot) {\r\n\r\n    if (texture.image.length === 6) {\r\n\r\n      if (texture.needsUpdate) {\r\n\r\n        if (!texture.image.__webglTextureCube) {\r\n\r\n          texture.addEventListener('dispose', onTextureDispose);\r\n\r\n          texture.image.__webglTextureCube = _gl.createTexture();\r\n\r\n          _this.info.memory.textures++;\r\n\r\n        }\r\n\r\n        _gl.activeTexture(_gl.TEXTURE0 + slot);\r\n        _gl.bindTexture(_gl.TEXTURE_CUBE_MAP, texture.image.__webglTextureCube);\r\n\r\n        _gl.pixelStorei(_gl.UNPACK_FLIP_Y_WEBGL, texture.flipY);\r\n\r\n        var isCompressed = texture instanceof THREE.CompressedTexture;\r\n        var isDataTexture = texture.image[0] instanceof THREE.DataTexture;\r\n\r\n        var cubeImage = [];\r\n\r\n        for (var i = 0; i < 6; i++) {\r\n\r\n          if (_this.autoScaleCubemaps && !isCompressed && !isDataTexture) {\r\n\r\n            cubeImage[i] = clampToMaxSize(texture.image[i], _maxCubemapSize);\r\n\r\n          }\r\n          else {\r\n\r\n            cubeImage[i] = isDataTexture ? texture.image[i].image : texture.image[i];\r\n\r\n          }\r\n\r\n        }\r\n\r\n        var image = cubeImage[0],\r\n          isImagePowerOfTwo = THREE.Math.isPowerOfTwo(image.width) && THREE.Math.isPowerOfTwo(image.height),\r\n          glFormat = paramThreeToGL(texture.format),\r\n          glType = paramThreeToGL(texture.type);\r\n\r\n        setTextureParameters(_gl.TEXTURE_CUBE_MAP, texture, isImagePowerOfTwo);\r\n\r\n        for (var i = 0; i < 6; i++) {\r\n\r\n          if (!isCompressed) {\r\n\r\n            if (isDataTexture) {\r\n\r\n              _gl.texImage2D(_gl.TEXTURE_CUBE_MAP_POSITIVE_X + i, 0, glFormat, cubeImage[i].width, cubeImage[i].height, 0, glFormat, glType, cubeImage[i].data);\r\n\r\n            }\r\n            else {\r\n\r\n              _gl.texImage2D(_gl.TEXTURE_CUBE_MAP_POSITIVE_X + i, 0, glFormat, glFormat, glType, cubeImage[i]);\r\n\r\n            }\r\n\r\n          }\r\n          else {\r\n\r\n            var mipmap, mipmaps = cubeImage[i].mipmaps;\r\n\r\n            for (var j = 0, jl = mipmaps.length; j < jl; j++) {\r\n\r\n              mipmap = mipmaps[j];\r\n\r\n              if (texture.format !== THREE.RGBAFormat && texture.format !== THREE.RGBFormat) {\r\n\r\n                if (getCompressedTextureFormats().indexOf(glFormat) > -1) {\r\n\r\n                  _gl.compressedTexImage2D(_gl.TEXTURE_CUBE_MAP_POSITIVE_X + i, j, glFormat, mipmap.width, mipmap.height, 0, mipmap.data);\r\n\r\n                }\r\n                else {\r\n\r\n                  THREE.warn(\"THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setCubeTexture()\");\r\n\r\n                }\r\n\r\n              }\r\n              else {\r\n\r\n                _gl.texImage2D(_gl.TEXTURE_CUBE_MAP_POSITIVE_X + i, j, glFormat, mipmap.width, mipmap.height, 0, glFormat, glType, mipmap.data);\r\n\r\n              }\r\n\r\n            }\r\n\r\n          }\r\n\r\n        }\r\n\r\n        if (texture.generateMipmaps && isImagePowerOfTwo) {\r\n\r\n          _gl.generateMipmap(_gl.TEXTURE_CUBE_MAP);\r\n\r\n        }\r\n\r\n        texture.needsUpdate = false;\r\n\r\n        if (texture.onUpdate) texture.onUpdate();\r\n\r\n      }\r\n      else {\r\n\r\n        _gl.activeTexture(_gl.TEXTURE0 + slot);\r\n        _gl.bindTexture(_gl.TEXTURE_CUBE_MAP, texture.image.__webglTextureCube);\r\n\r\n      }\r\n\r\n    }\r\n\r\n  }\r\n\r\n  function setCubeTextureDynamic(texture, slot) {\r\n\r\n    _gl.activeTexture(_gl.TEXTURE0 + slot);\r\n    _gl.bindTexture(_gl.TEXTURE_CUBE_MAP, texture.__webglTexture);\r\n\r\n  }\r\n\r\n  // Render targets\r\n\r\n  function setupFrameBuffer(framebuffer, renderTarget, textureTarget) {\r\n\r\n    _gl.bindFramebuffer(_gl.FRAMEBUFFER, framebuffer);\r\n    _gl.framebufferTexture2D(_gl.FRAMEBUFFER, _gl.COLOR_ATTACHMENT0, textureTarget, renderTarget.__webglTexture, 0);\r\n\r\n  }\r\n\r\n  function setupRenderBuffer(renderbuffer, renderTarget) {\r\n\r\n    _gl.bindRenderbuffer(_gl.RENDERBUFFER, renderbuffer);\r\n\r\n    if (renderTarget.depthBuffer && !renderTarget.stencilBuffer) {\r\n\r\n      _gl.renderbufferStorage(_gl.RENDERBUFFER, _gl.DEPTH_COMPONENT16, renderTarget.width, renderTarget.height);\r\n      _gl.framebufferRenderbuffer(_gl.FRAMEBUFFER, _gl.DEPTH_ATTACHMENT, _gl.RENDERBUFFER, renderbuffer);\r\n\r\n      /* For some reason this is not working. Defaulting to RGBA4.\r\n      } else if ( ! renderTarget.depthBuffer && renderTarget.stencilBuffer ) {\r\n\r\n      \t_gl.renderbufferStorage( _gl.RENDERBUFFER, _gl.STENCIL_INDEX8, renderTarget.width, renderTarget.height );\r\n      \t_gl.framebufferRenderbuffer( _gl.FRAMEBUFFER, _gl.STENCIL_ATTACHMENT, _gl.RENDERBUFFER, renderbuffer );\r\n      */\r\n    }\r\n    else if (renderTarget.depthBuffer && renderTarget.stencilBuffer) {\r\n\r\n      _gl.renderbufferStorage(_gl.RENDERBUFFER, _gl.DEPTH_STENCIL, renderTarget.width, renderTarget.height);\r\n      _gl.framebufferRenderbuffer(_gl.FRAMEBUFFER, _gl.DEPTH_STENCIL_ATTACHMENT, _gl.RENDERBUFFER, renderbuffer);\r\n\r\n    }\r\n    else {\r\n\r\n      _gl.renderbufferStorage(_gl.RENDERBUFFER, _gl.RGBA4, renderTarget.width, renderTarget.height);\r\n\r\n    }\r\n\r\n  }\r\n\r\n  this.setRenderTarget = function(renderTarget) {\r\n\r\n    var isCube = (renderTarget instanceof THREE.WebGLRenderTargetCube);\r\n\r\n    if (renderTarget && renderTarget.__webglFramebuffer === undefined) {\r\n\r\n      if (renderTarget.depthBuffer === undefined) renderTarget.depthBuffer = true;\r\n      if (renderTarget.stencilBuffer === undefined) renderTarget.stencilBuffer = true;\r\n\r\n      renderTarget.addEventListener('dispose', onRenderTargetDispose);\r\n\r\n      renderTarget.__webglTexture = _gl.createTexture();\r\n\r\n      _this.info.memory.textures++;\r\n\r\n      // Setup texture, create render and frame buffers\r\n\r\n      var isTargetPowerOfTwo = THREE.Math.isPowerOfTwo(renderTarget.width) && THREE.Math.isPowerOfTwo(renderTarget.height),\r\n        glFormat = paramThreeToGL(renderTarget.format),\r\n        glType = paramThreeToGL(renderTarget.type);\r\n\r\n      if (isCube) {\r\n\r\n        renderTarget.__webglFramebuffer = [];\r\n        renderTarget.__webglRenderbuffer = [];\r\n\r\n        _gl.bindTexture(_gl.TEXTURE_CUBE_MAP, renderTarget.__webglTexture);\r\n        setTextureParameters(_gl.TEXTURE_CUBE_MAP, renderTarget, isTargetPowerOfTwo);\r\n\r\n        for (var i = 0; i < 6; i++) {\r\n\r\n          renderTarget.__webglFramebuffer[i] = _gl.createFramebuffer();\r\n          renderTarget.__webglRenderbuffer[i] = _gl.createRenderbuffer();\r\n\r\n          _gl.texImage2D(_gl.TEXTURE_CUBE_MAP_POSITIVE_X + i, 0, glFormat, renderTarget.width, renderTarget.height, 0, glFormat, glType, null);\r\n\r\n          setupFrameBuffer(renderTarget.__webglFramebuffer[i], renderTarget, _gl.TEXTURE_CUBE_MAP_POSITIVE_X + i);\r\n          setupRenderBuffer(renderTarget.__webglRenderbuffer[i], renderTarget);\r\n\r\n        }\r\n\r\n        if (isTargetPowerOfTwo) _gl.generateMipmap(_gl.TEXTURE_CUBE_MAP);\r\n\r\n      }\r\n      else {\r\n\r\n        renderTarget.__webglFramebuffer = _gl.createFramebuffer();\r\n\r\n        if (renderTarget.shareDepthFrom) {\r\n\r\n          renderTarget.__webglRenderbuffer = renderTarget.shareDepthFrom.__webglRenderbuffer;\r\n\r\n        }\r\n        else {\r\n\r\n          renderTarget.__webglRenderbuffer = _gl.createRenderbuffer();\r\n\r\n        }\r\n\r\n        _gl.bindTexture(_gl.TEXTURE_2D, renderTarget.__webglTexture);\r\n        setTextureParameters(_gl.TEXTURE_2D, renderTarget, isTargetPowerOfTwo);\r\n\r\n        _gl.texImage2D(_gl.TEXTURE_2D, 0, glFormat, renderTarget.width, renderTarget.height, 0, glFormat, glType, null);\r\n\r\n        setupFrameBuffer(renderTarget.__webglFramebuffer, renderTarget, _gl.TEXTURE_2D);\r\n\r\n        if (renderTarget.shareDepthFrom) {\r\n\r\n          if (renderTarget.depthBuffer && !renderTarget.stencilBuffer) {\r\n\r\n            _gl.framebufferRenderbuffer(_gl.FRAMEBUFFER, _gl.DEPTH_ATTACHMENT, _gl.RENDERBUFFER, renderTarget.__webglRenderbuffer);\r\n\r\n          }\r\n          else if (renderTarget.depthBuffer && renderTarget.stencilBuffer) {\r\n\r\n            _gl.framebufferRenderbuffer(_gl.FRAMEBUFFER, _gl.DEPTH_STENCIL_ATTACHMENT, _gl.RENDERBUFFER, renderTarget.__webglRenderbuffer);\r\n\r\n          }\r\n\r\n        }\r\n        else {\r\n\r\n          setupRenderBuffer(renderTarget.__webglRenderbuffer, renderTarget);\r\n\r\n        }\r\n\r\n        if (isTargetPowerOfTwo) _gl.generateMipmap(_gl.TEXTURE_2D);\r\n\r\n      }\r\n\r\n      // Release everything\r\n\r\n      if (isCube) {\r\n\r\n        _gl.bindTexture(_gl.TEXTURE_CUBE_MAP, null);\r\n\r\n      }\r\n      else {\r\n\r\n        _gl.bindTexture(_gl.TEXTURE_2D, null);\r\n\r\n      }\r\n\r\n      _gl.bindRenderbuffer(_gl.RENDERBUFFER, null);\r\n      _gl.bindFramebuffer(_gl.FRAMEBUFFER, null);\r\n\r\n    }\r\n\r\n    var framebuffer, width, height, vx, vy;\r\n\r\n    if (renderTarget) {\r\n\r\n      if (isCube) {\r\n\r\n        framebuffer = renderTarget.__webglFramebuffer[renderTarget.activeCubeFace];\r\n\r\n      }\r\n      else {\r\n\r\n        framebuffer = renderTarget.__webglFramebuffer;\r\n\r\n      }\r\n\r\n      width = renderTarget.width;\r\n      height = renderTarget.height;\r\n\r\n      vx = 0;\r\n      vy = 0;\r\n\r\n    }\r\n    else {\r\n\r\n      framebuffer = null;\r\n\r\n      width = _viewportWidth;\r\n      height = _viewportHeight;\r\n\r\n      vx = _viewportX;\r\n      vy = _viewportY;\r\n\r\n    }\r\n\r\n    if (framebuffer !== _currentFramebuffer) {\r\n\r\n      _gl.bindFramebuffer(_gl.FRAMEBUFFER, framebuffer);\r\n      _gl.viewport(vx, vy, width, height);\r\n\r\n      _currentFramebuffer = framebuffer;\r\n\r\n    }\r\n\r\n    _currentWidth = width;\r\n    _currentHeight = height;\r\n\r\n  };\r\n\r\n  this.readRenderTargetPixels = function(renderTarget, x, y, width, height, buffer) {\r\n\r\n    if (!(renderTarget instanceof THREE.WebGLRenderTarget)) {\r\n\r\n      console.error('THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.');\r\n      return;\r\n\r\n    }\r\n\r\n    if (renderTarget.__webglFramebuffer) {\r\n\r\n      if (renderTarget.format !== THREE.RGBAFormat) {\r\n\r\n        console.error('THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA format. readPixels can read only RGBA format.');\r\n        return;\r\n\r\n      }\r\n\r\n      var restore = false;\r\n\r\n      if (renderTarget.__webglFramebuffer !== _currentFramebuffer) {\r\n\r\n        _gl.bindFramebuffer(_gl.FRAMEBUFFER, renderTarget.__webglFramebuffer);\r\n\r\n        restore = true;\r\n\r\n      }\r\n\r\n      if (_gl.checkFramebufferStatus(_gl.FRAMEBUFFER) === _gl.FRAMEBUFFER_COMPLETE) {\r\n\r\n        _gl.readPixels(x, y, width, height, _gl.RGBA, _gl.UNSIGNED_BYTE, buffer);\r\n\r\n      }\r\n      else {\r\n\r\n        console.error('THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.');\r\n\r\n      }\r\n\r\n      if (restore) {\r\n\r\n        _gl.bindFramebuffer(_gl.FRAMEBUFFER, _currentFramebuffer);\r\n\r\n      }\r\n\r\n    }\r\n\r\n  };\r\n\r\n  function updateRenderTargetMipmap(renderTarget) {\r\n\r\n    if (renderTarget instanceof THREE.WebGLRenderTargetCube) {\r\n\r\n      _gl.bindTexture(_gl.TEXTURE_CUBE_MAP, renderTarget.__webglTexture);\r\n      _gl.generateMipmap(_gl.TEXTURE_CUBE_MAP);\r\n      _gl.bindTexture(_gl.TEXTURE_CUBE_MAP, null);\r\n\r\n    }\r\n    else {\r\n\r\n      _gl.bindTexture(_gl.TEXTURE_2D, renderTarget.__webglTexture);\r\n      _gl.generateMipmap(_gl.TEXTURE_2D);\r\n      _gl.bindTexture(_gl.TEXTURE_2D, null);\r\n\r\n    }\r\n\r\n  }\r\n\r\n  // Fallback filters for non-power-of-2 textures\r\n\r\n  function filterFallback(f) {\r\n\r\n    if (f === THREE.NearestFilter || f === THREE.NearestMipMapNearestFilter || f === THREE.NearestMipMapLinearFilter) {\r\n\r\n      return _gl.NEAREST;\r\n\r\n    }\r\n\r\n    return _gl.LINEAR;\r\n\r\n  }\r\n\r\n  // Map three.js constants to WebGL constants\r\n\r\n  function paramThreeToGL(p) {\r\n\r\n    var extension;\r\n\r\n    if (p === THREE.RepeatWrapping) return _gl.REPEAT;\r\n    if (p === THREE.ClampToEdgeWrapping) return _gl.CLAMP_TO_EDGE;\r\n    if (p === THREE.MirroredRepeatWrapping) return _gl.MIRRORED_REPEAT;\r\n\r\n    if (p === THREE.NearestFilter) return _gl.NEAREST;\r\n    if (p === THREE.NearestMipMapNearestFilter) return _gl.NEAREST_MIPMAP_NEAREST;\r\n    if (p === THREE.NearestMipMapLinearFilter) return _gl.NEAREST_MIPMAP_LINEAR;\r\n\r\n    if (p === THREE.LinearFilter) return _gl.LINEAR;\r\n    if (p === THREE.LinearMipMapNearestFilter) return _gl.LINEAR_MIPMAP_NEAREST;\r\n    if (p === THREE.LinearMipMapLinearFilter) return _gl.LINEAR_MIPMAP_LINEAR;\r\n\r\n    if (p === THREE.UnsignedByteType) return _gl.UNSIGNED_BYTE;\r\n    if (p === THREE.UnsignedShort4444Type) return _gl.UNSIGNED_SHORT_4_4_4_4;\r\n    if (p === THREE.UnsignedShort5551Type) return _gl.UNSIGNED_SHORT_5_5_5_1;\r\n    if (p === THREE.UnsignedShort565Type) return _gl.UNSIGNED_SHORT_5_6_5;\r\n\r\n    if (p === THREE.ByteType) return _gl.BYTE;\r\n    if (p === THREE.ShortType) return _gl.SHORT;\r\n    if (p === THREE.UnsignedShortType) return _gl.UNSIGNED_SHORT;\r\n    if (p === THREE.IntType) return _gl.INT;\r\n    if (p === THREE.UnsignedIntType) return _gl.UNSIGNED_INT;\r\n    if (p === THREE.FloatType) return _gl.FLOAT;\r\n\r\n    extension = extensions.get('OES_texture_half_float');\r\n\r\n    if (extension !== null) {\r\n\r\n      if (p === THREE.HalfFloatType) return extension.HALF_FLOAT_OES;\r\n\r\n    }\r\n\r\n    if (p === THREE.AlphaFormat) return _gl.ALPHA;\r\n    if (p === THREE.RGBFormat) return _gl.RGB;\r\n    if (p === THREE.RGBAFormat) return _gl.RGBA;\r\n    if (p === THREE.LuminanceFormat) return _gl.LUMINANCE;\r\n    if (p === THREE.LuminanceAlphaFormat) return _gl.LUMINANCE_ALPHA;\r\n\r\n    if (p === THREE.AddEquation) return _gl.FUNC_ADD;\r\n    if (p === THREE.SubtractEquation) return _gl.FUNC_SUBTRACT;\r\n    if (p === THREE.ReverseSubtractEquation) return _gl.FUNC_REVERSE_SUBTRACT;\r\n\r\n    if (p === THREE.ZeroFactor) return _gl.ZERO;\r\n    if (p === THREE.OneFactor) return _gl.ONE;\r\n    if (p === THREE.SrcColorFactor) return _gl.SRC_COLOR;\r\n    if (p === THREE.OneMinusSrcColorFactor) return _gl.ONE_MINUS_SRC_COLOR;\r\n    if (p === THREE.SrcAlphaFactor) return _gl.SRC_ALPHA;\r\n    if (p === THREE.OneMinusSrcAlphaFactor) return _gl.ONE_MINUS_SRC_ALPHA;\r\n    if (p === THREE.DstAlphaFactor) return _gl.DST_ALPHA;\r\n    if (p === THREE.OneMinusDstAlphaFactor) return _gl.ONE_MINUS_DST_ALPHA;\r\n\r\n    if (p === THREE.DstColorFactor) return _gl.DST_COLOR;\r\n    if (p === THREE.OneMinusDstColorFactor) return _gl.ONE_MINUS_DST_COLOR;\r\n    if (p === THREE.SrcAlphaSaturateFactor) return _gl.SRC_ALPHA_SATURATE;\r\n\r\n    extension = extensions.get('WEBGL_compressed_texture_s3tc');\r\n\r\n    if (extension !== null) {\r\n\r\n      if (p === THREE.RGB_S3TC_DXT1_Format) return extension.COMPRESSED_RGB_S3TC_DXT1_EXT;\r\n      if (p === THREE.RGBA_S3TC_DXT1_Format) return extension.COMPRESSED_RGBA_S3TC_DXT1_EXT;\r\n      if (p === THREE.RGBA_S3TC_DXT3_Format) return extension.COMPRESSED_RGBA_S3TC_DXT3_EXT;\r\n      if (p === THREE.RGBA_S3TC_DXT5_Format) return extension.COMPRESSED_RGBA_S3TC_DXT5_EXT;\r\n\r\n    }\r\n\r\n    extension = extensions.get('WEBGL_compressed_texture_pvrtc');\r\n\r\n    if (extension !== null) {\r\n\r\n      if (p === THREE.RGB_PVRTC_4BPPV1_Format) return extension.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;\r\n      if (p === THREE.RGB_PVRTC_2BPPV1_Format) return extension.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;\r\n      if (p === THREE.RGBA_PVRTC_4BPPV1_Format) return extension.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;\r\n      if (p === THREE.RGBA_PVRTC_2BPPV1_Format) return extension.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG;\r\n\r\n    }\r\n\r\n    extension = extensions.get('EXT_blend_minmax');\r\n\r\n    if (extension !== null) {\r\n\r\n      if (p === THREE.MinEquation) return extension.MIN_EXT;\r\n      if (p === THREE.MaxEquation) return extension.MAX_EXT;\r\n\r\n    }\r\n\r\n    return 0;\r\n\r\n  }\r\n\r\n  // Allocations\r\n\r\n  function allocateBones(object) {\r\n\r\n    if (_supportsBoneTextures && object && object.skeleton && object.skeleton.useVertexTexture) {\r\n\r\n      return 1024;\r\n\r\n    }\r\n    else {\r\n\r\n      // default for when object is not specified\r\n      // ( for example when prebuilding shader\r\n      //   to be used with multiple objects )\r\n      //\r\n      //  - leave some extra space for other uniforms\r\n      //  - limit here is ANGLE's 254 max uniform vectors\r\n      //    (up to 54 should be safe)\r\n\r\n      var nVertexUniforms = _gl.getParameter(_gl.MAX_VERTEX_UNIFORM_VECTORS);\r\n      var nVertexMatrices = Math.floor((nVertexUniforms - 20) / 4);\r\n\r\n      var maxBones = nVertexMatrices;\r\n\r\n      if (object !== undefined && object instanceof THREE.SkinnedMesh) {\r\n\r\n        maxBones = Math.min(object.skeleton.bones.length, maxBones);\r\n\r\n        if (maxBones < object.skeleton.bones.length) {\r\n\r\n          THREE.warn('WebGLRenderer: too many bones - ' + object.skeleton.bones.length + ', this GPU supports just ' + maxBones + ' (try OpenGL instead of ANGLE)');\r\n\r\n        }\r\n\r\n      }\r\n\r\n      return maxBones;\r\n\r\n    }\r\n\r\n  }\r\n\r\n  function allocateLights(lights) {\r\n\r\n    var dirLights = 0;\r\n    var pointLights = 0;\r\n    var spotLights = 0;\r\n    var hemiLights = 0;\r\n\r\n    for (var l = 0, ll = lights.length; l < ll; l++) {\r\n\r\n      var light = lights[l];\r\n\r\n      if (light.onlyShadow || light.visible === false) continue;\r\n\r\n      if (light instanceof THREE.DirectionalLight) dirLights++;\r\n      if (light instanceof THREE.PointLight) pointLights++;\r\n      if (light instanceof THREE.SpotLight) spotLights++;\r\n      if (light instanceof THREE.HemisphereLight) hemiLights++;\r\n\r\n    }\r\n\r\n    return {\r\n      'directional': dirLights,\r\n      'point': pointLights,\r\n      'spot': spotLights,\r\n      'hemi': hemiLights\r\n    };\r\n\r\n  }\r\n\r\n  function allocateShadows(lights) {\r\n\r\n    var maxShadows = 0;\r\n\r\n    for (var l = 0, ll = lights.length; l < ll; l++) {\r\n\r\n      var light = lights[l];\r\n\r\n      if (!light.castShadow) continue;\r\n\r\n      if (light instanceof THREE.SpotLight) maxShadows++;\r\n      if (light instanceof THREE.DirectionalLight && !light.shadowCascade) maxShadows++;\r\n\r\n    }\r\n\r\n    return maxShadows;\r\n\r\n  }\r\n\r\n  // DEPRECATED\r\n\r\n  this.initMaterial = function() {\r\n\r\n    THREE.warn('THREE.WebGLRenderer: .initMaterial() has been removed.');\r\n\r\n  };\r\n\r\n  this.addPrePlugin = function() {\r\n\r\n    THREE.warn('THREE.WebGLRenderer: .addPrePlugin() has been removed.');\r\n\r\n  };\r\n\r\n  this.addPostPlugin = function() {\r\n\r\n    THREE.warn('THREE.WebGLRenderer: .addPostPlugin() has been removed.');\r\n\r\n  };\r\n\r\n  this.updateShadowMap = function() {\r\n\r\n    THREE.warn('THREE.WebGLRenderer: .updateShadowMap() has been removed.');\r\n\r\n  };\r\n\r\n};\r\n\r\n// File:src/renderers/WebGLRenderTarget.js\r\n\r\n/**\r\n * @author szimek / https://github.com/szimek/\r\n * @author alteredq / http://alteredqualia.com/\r\n */\r\n\r\nTHREE.WebGLRenderTarget = function(width, height, options) {\r\n\r\n  this.width = width;\r\n  this.height = height;\r\n\r\n  options = options || {};\r\n\r\n  this.wrapS = options.wrapS !== undefined ? options.wrapS : THREE.ClampToEdgeWrapping;\r\n  this.wrapT = options.wrapT !== undefined ? options.wrapT : THREE.ClampToEdgeWrapping;\r\n\r\n  this.magFilter = options.magFilter !== undefined ? options.magFilter : THREE.LinearFilter;\r\n  this.minFilter = options.minFilter !== undefined ? options.minFilter : THREE.LinearMipMapLinearFilter;\r\n\r\n  this.anisotropy = options.anisotropy !== undefined ? options.anisotropy : 1;\r\n\r\n  this.offset = new THREE.Vector2(0, 0);\r\n  this.repeat = new THREE.Vector2(1, 1);\r\n\r\n  this.format = options.format !== undefined ? options.format : THREE.RGBAFormat;\r\n  this.type = options.type !== undefined ? options.type : THREE.UnsignedByteType;\r\n\r\n  this.depthBuffer = options.depthBuffer !== undefined ? options.depthBuffer : true;\r\n  this.stencilBuffer = options.stencilBuffer !== undefined ? options.stencilBuffer : true;\r\n\r\n  this.generateMipmaps = true;\r\n\r\n  this.shareDepthFrom = options.shareDepthFrom !== undefined ? options.shareDepthFrom : null;\r\n\r\n};\r\n\r\nTHREE.WebGLRenderTarget.prototype = {\r\n\r\n  constructor: THREE.WebGLRenderTarget,\r\n\r\n  setSize: function(width, height) {\r\n\r\n    this.width = width;\r\n    this.height = height;\r\n\r\n  },\r\n\r\n  clone: function() {\r\n\r\n    var tmp = new THREE.WebGLRenderTarget(this.width, this.height);\r\n\r\n    tmp.wrapS = this.wrapS;\r\n    tmp.wrapT = this.wrapT;\r\n\r\n    tmp.magFilter = this.magFilter;\r\n    tmp.minFilter = this.minFilter;\r\n\r\n    tmp.anisotropy = this.anisotropy;\r\n\r\n    tmp.offset.copy(this.offset);\r\n    tmp.repeat.copy(this.repeat);\r\n\r\n    tmp.format = this.format;\r\n    tmp.type = this.type;\r\n\r\n    tmp.depthBuffer = this.depthBuffer;\r\n    tmp.stencilBuffer = this.stencilBuffer;\r\n\r\n    tmp.generateMipmaps = this.generateMipmaps;\r\n\r\n    tmp.shareDepthFrom = this.shareDepthFrom;\r\n\r\n    return tmp;\r\n\r\n  },\r\n\r\n  dispose: function() {\r\n\r\n    this.dispatchEvent({\r\n      type: 'dispose'\r\n    });\r\n\r\n  }\r\n\r\n};\r\n\r\nTHREE.EventDispatcher.prototype.apply(THREE.WebGLRenderTarget.prototype);\r\n\r\n// File:src/renderers/WebGLRenderTargetCube.js\r\n\r\n/**\r\n * @author alteredq / http://alteredqualia.com\r\n */\r\n\r\nTHREE.WebGLRenderTargetCube = function(width, height, options) {\r\n\r\n  THREE.WebGLRenderTarget.call(this, width, height, options);\r\n\r\n  this.activeCubeFace = 0; // PX 0, NX 1, PY 2, NY 3, PZ 4, NZ 5\r\n\r\n};\r\n\r\nTHREE.WebGLRenderTargetCube.prototype = Object.create(THREE.WebGLRenderTarget.prototype);\r\nTHREE.WebGLRenderTargetCube.prototype.constructor = THREE.WebGLRenderTargetCube;\r\n\r\n// File:src/renderers/webgl/WebGLExtensions.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.WebGLExtensions = function(gl) {\r\n\r\n  var extensions = {};\r\n\r\n  this.get = function(name) {\r\n\r\n    if (extensions[name] !== undefined) {\r\n\r\n      return extensions[name];\r\n\r\n    }\r\n\r\n    var extension;\r\n\r\n    switch (name) {\r\n\r\n      case 'EXT_texture_filter_anisotropic':\r\n        extension = gl.getExtension('EXT_texture_filter_anisotropic') || gl.getExtension('MOZ_EXT_texture_filter_anisotropic') || gl.getExtension('WEBKIT_EXT_texture_filter_anisotropic');\r\n        break;\r\n\r\n      case 'WEBGL_compressed_texture_s3tc':\r\n        extension = gl.getExtension('WEBGL_compressed_texture_s3tc') || gl.getExtension('MOZ_WEBGL_compressed_texture_s3tc') || gl.getExtension('WEBKIT_WEBGL_compressed_texture_s3tc');\r\n        break;\r\n\r\n      case 'WEBGL_compressed_texture_pvrtc':\r\n        extension = gl.getExtension('WEBGL_compressed_texture_pvrtc') || gl.getExtension('WEBKIT_WEBGL_compressed_texture_pvrtc');\r\n        break;\r\n\r\n      default:\r\n        extension = gl.getExtension(name);\r\n\r\n    }\r\n\r\n    if (extension === null) {\r\n\r\n      THREE.warn('THREE.WebGLRenderer: ' + name + ' extension not supported.');\r\n\r\n    }\r\n\r\n    extensions[name] = extension;\r\n\r\n    return extension;\r\n\r\n  };\r\n\r\n};\r\n\r\n// File:src/renderers/webgl/WebGLProgram.js\r\n\r\nTHREE.WebGLProgram = (function() {\r\n\r\n  var programIdCount = 0;\r\n\r\n  var generateDefines = function(defines) {\r\n\r\n    var value, chunk, chunks = [];\r\n\r\n    for (var d in defines) {\r\n\r\n      value = defines[d];\r\n      if (value === false) continue;\r\n\r\n      chunk = '#define ' + d + ' ' + value;\r\n      chunks.push(chunk);\r\n\r\n    }\r\n\r\n    return chunks.join('\\n');\r\n\r\n  };\r\n\r\n  var cacheUniformLocations = function(gl, program, identifiers) {\r\n\r\n    var uniforms = {};\r\n\r\n    for (var i = 0, l = identifiers.length; i < l; i++) {\r\n\r\n      var id = identifiers[i];\r\n      uniforms[id] = gl.getUniformLocation(program, id);\r\n\r\n    }\r\n\r\n    return uniforms;\r\n\r\n  };\r\n\r\n  var cacheAttributeLocations = function(gl, program, identifiers) {\r\n\r\n    var attributes = {};\r\n\r\n    for (var i = 0, l = identifiers.length; i < l; i++) {\r\n\r\n      var id = identifiers[i];\r\n      attributes[id] = gl.getAttribLocation(program, id);\r\n\r\n    }\r\n\r\n    return attributes;\r\n\r\n  };\r\n\r\n  return function(renderer, code, material, parameters) {\r\n\r\n    var _this = renderer;\r\n    var _gl = _this.context;\r\n\r\n    var defines = material.defines;\r\n    var uniforms = material.__webglShader.uniforms;\r\n    var attributes = material.attributes;\r\n\r\n    var vertexShader = material.__webglShader.vertexShader;\r\n    var fragmentShader = material.__webglShader.fragmentShader;\r\n\r\n    var index0AttributeName = material.index0AttributeName;\r\n\r\n    if (index0AttributeName === undefined && parameters.morphTargets === true) {\r\n\r\n      // programs with morphTargets displace position out of attribute 0\r\n\r\n      index0AttributeName = 'position';\r\n\r\n    }\r\n\r\n    var shadowMapTypeDefine = 'SHADOWMAP_TYPE_BASIC';\r\n\r\n    if (parameters.shadowMapType === THREE.PCFShadowMap) {\r\n\r\n      shadowMapTypeDefine = 'SHADOWMAP_TYPE_PCF';\r\n\r\n    }\r\n    else if (parameters.shadowMapType === THREE.PCFSoftShadowMap) {\r\n\r\n      shadowMapTypeDefine = 'SHADOWMAP_TYPE_PCF_SOFT';\r\n\r\n    }\r\n\r\n    var envMapTypeDefine = 'ENVMAP_TYPE_CUBE';\r\n    var envMapModeDefine = 'ENVMAP_MODE_REFLECTION';\r\n    var envMapBlendingDefine = 'ENVMAP_BLENDING_MULTIPLY';\r\n\r\n    if (parameters.envMap) {\r\n\r\n      switch (material.envMap.mapping) {\r\n\r\n        case THREE.CubeReflectionMapping:\r\n        case THREE.CubeRefractionMapping:\r\n          envMapTypeDefine = 'ENVMAP_TYPE_CUBE';\r\n          break;\r\n\r\n        case THREE.EquirectangularReflectionMapping:\r\n        case THREE.EquirectangularRefractionMapping:\r\n          envMapTypeDefine = 'ENVMAP_TYPE_EQUIREC';\r\n          break;\r\n\r\n        case THREE.SphericalReflectionMapping:\r\n          envMapTypeDefine = 'ENVMAP_TYPE_SPHERE';\r\n          break;\r\n\r\n      }\r\n\r\n      switch (material.envMap.mapping) {\r\n\r\n        case THREE.CubeRefractionMapping:\r\n        case THREE.EquirectangularRefractionMapping:\r\n          envMapModeDefine = 'ENVMAP_MODE_REFRACTION';\r\n          break;\r\n\r\n      }\r\n\r\n      switch (material.combine) {\r\n\r\n        case THREE.MultiplyOperation:\r\n          envMapBlendingDefine = 'ENVMAP_BLENDING_MULTIPLY';\r\n          break;\r\n\r\n        case THREE.MixOperation:\r\n          envMapBlendingDefine = 'ENVMAP_BLENDING_MIX';\r\n          break;\r\n\r\n        case THREE.AddOperation:\r\n          envMapBlendingDefine = 'ENVMAP_BLENDING_ADD';\r\n          break;\r\n\r\n      }\r\n\r\n    }\r\n\r\n    var gammaFactorDefine = (renderer.gammaFactor > 0) ? renderer.gammaFactor : 1.0;\r\n\r\n    // console.log( 'building new program ' );\r\n\r\n    //\r\n\r\n    var customDefines = generateDefines(defines);\r\n\r\n    //\r\n\r\n    var program = _gl.createProgram();\r\n\r\n    var prefix_vertex, prefix_fragment;\r\n\r\n    if (material instanceof THREE.RawShaderMaterial) {\r\n\r\n      prefix_vertex = '';\r\n      prefix_fragment = '';\r\n\r\n    }\r\n    else {\r\n\r\n      prefix_vertex = [\r\n\r\n        'precision ' + parameters.precision + ' float;',\r\n        'precision ' + parameters.precision + ' int;',\r\n\r\n        customDefines,\r\n\r\n        parameters.supportsVertexTextures ? '#define VERTEX_TEXTURES' : '',\r\n\r\n        _this.gammaInput ? '#define GAMMA_INPUT' : '',\r\n        _this.gammaOutput ? '#define GAMMA_OUTPUT' : '',\r\n        '#define GAMMA_FACTOR ' + gammaFactorDefine,\r\n\r\n        '#define MAX_DIR_LIGHTS ' + parameters.maxDirLights,\r\n        '#define MAX_POINT_LIGHTS ' + parameters.maxPointLights,\r\n        '#define MAX_SPOT_LIGHTS ' + parameters.maxSpotLights,\r\n        '#define MAX_HEMI_LIGHTS ' + parameters.maxHemiLights,\r\n\r\n        '#define MAX_SHADOWS ' + parameters.maxShadows,\r\n\r\n        '#define MAX_BONES ' + parameters.maxBones,\r\n\r\n        parameters.map ? '#define USE_MAP' : '',\r\n        parameters.envMap ? '#define USE_ENVMAP' : '',\r\n        parameters.envMap ? '#define ' + envMapModeDefine : '',\r\n        parameters.lightMap ? '#define USE_LIGHTMAP' : '',\r\n        parameters.bumpMap ? '#define USE_BUMPMAP' : '',\r\n        parameters.normalMap ? '#define USE_NORMALMAP' : '',\r\n        parameters.specularMap ? '#define USE_SPECULARMAP' : '',\r\n        parameters.alphaMap ? '#define USE_ALPHAMAP' : '',\r\n        parameters.vertexColors ? '#define USE_COLOR' : '',\r\n\r\n        parameters.flatShading ? '#define FLAT_SHADED' : '',\r\n\r\n        parameters.skinning ? '#define USE_SKINNING' : '',\r\n        parameters.useVertexTexture ? '#define BONE_TEXTURE' : '',\r\n\r\n        parameters.morphTargets ? '#define USE_MORPHTARGETS' : '',\r\n        parameters.morphNormals ? '#define USE_MORPHNORMALS' : '',\r\n        parameters.wrapAround ? '#define WRAP_AROUND' : '',\r\n        parameters.doubleSided ? '#define DOUBLE_SIDED' : '',\r\n        parameters.flipSided ? '#define FLIP_SIDED' : '',\r\n\r\n        parameters.shadowMapEnabled ? '#define USE_SHADOWMAP' : '',\r\n        parameters.shadowMapEnabled ? '#define ' + shadowMapTypeDefine : '',\r\n        parameters.shadowMapDebug ? '#define SHADOWMAP_DEBUG' : '',\r\n        parameters.shadowMapCascade ? '#define SHADOWMAP_CASCADE' : '',\r\n\r\n        parameters.sizeAttenuation ? '#define USE_SIZEATTENUATION' : '',\r\n\r\n        parameters.logarithmicDepthBuffer ? '#define USE_LOGDEPTHBUF' : '',\r\n        //_this._glExtensionFragDepth ? '#define USE_LOGDEPTHBUF_EXT' : '',\r\n\r\n\r\n        'uniform mat4 modelMatrix;',\r\n        'uniform mat4 modelViewMatrix;',\r\n        'uniform mat4 projectionMatrix;',\r\n        'uniform mat4 viewMatrix;',\r\n        'uniform mat3 normalMatrix;',\r\n        'uniform vec3 cameraPosition;',\r\n\r\n        'attribute vec3 position;',\r\n        'attribute vec3 normal;',\r\n        'attribute vec2 uv;',\r\n        'attribute vec2 uv2;',\r\n\r\n        '#ifdef USE_COLOR',\r\n\r\n        '\tattribute vec3 color;',\r\n\r\n        '#endif',\r\n\r\n        '#ifdef USE_MORPHTARGETS',\r\n\r\n        '\tattribute vec3 morphTarget0;',\r\n        '\tattribute vec3 morphTarget1;',\r\n        '\tattribute vec3 morphTarget2;',\r\n        '\tattribute vec3 morphTarget3;',\r\n\r\n        '\t#ifdef USE_MORPHNORMALS',\r\n\r\n        '\t\tattribute vec3 morphNormal0;',\r\n        '\t\tattribute vec3 morphNormal1;',\r\n        '\t\tattribute vec3 morphNormal2;',\r\n        '\t\tattribute vec3 morphNormal3;',\r\n\r\n        '\t#else',\r\n\r\n        '\t\tattribute vec3 morphTarget4;',\r\n        '\t\tattribute vec3 morphTarget5;',\r\n        '\t\tattribute vec3 morphTarget6;',\r\n        '\t\tattribute vec3 morphTarget7;',\r\n\r\n        '\t#endif',\r\n\r\n        '#endif',\r\n\r\n        '#ifdef USE_SKINNING',\r\n\r\n        '\tattribute vec4 skinIndex;',\r\n        '\tattribute vec4 skinWeight;',\r\n\r\n        '#endif',\r\n\r\n        ''\r\n\r\n      ].join('\\n');\r\n\r\n      prefix_fragment = [\r\n\r\n        'precision ' + parameters.precision + ' float;',\r\n        'precision ' + parameters.precision + ' int;',\r\n\r\n        (parameters.bumpMap || parameters.normalMap || parameters.flatShading) ? '#extension GL_OES_standard_derivatives : enable' : '',\r\n\r\n        customDefines,\r\n\r\n        '#define MAX_DIR_LIGHTS ' + parameters.maxDirLights,\r\n        '#define MAX_POINT_LIGHTS ' + parameters.maxPointLights,\r\n        '#define MAX_SPOT_LIGHTS ' + parameters.maxSpotLights,\r\n        '#define MAX_HEMI_LIGHTS ' + parameters.maxHemiLights,\r\n\r\n        '#define MAX_SHADOWS ' + parameters.maxShadows,\r\n\r\n        parameters.alphaTest ? '#define ALPHATEST ' + parameters.alphaTest : '',\r\n\r\n        _this.gammaInput ? '#define GAMMA_INPUT' : '',\r\n        _this.gammaOutput ? '#define GAMMA_OUTPUT' : '',\r\n        '#define GAMMA_FACTOR ' + gammaFactorDefine,\r\n\r\n        (parameters.useFog && parameters.fog) ? '#define USE_FOG' : '', (parameters.useFog && parameters.fogExp) ? '#define FOG_EXP2' : '',\r\n\r\n        parameters.map ? '#define USE_MAP' : '',\r\n        parameters.envMap ? '#define USE_ENVMAP' : '',\r\n        parameters.envMap ? '#define ' + envMapTypeDefine : '',\r\n        parameters.envMap ? '#define ' + envMapModeDefine : '',\r\n        parameters.envMap ? '#define ' + envMapBlendingDefine : '',\r\n        parameters.lightMap ? '#define USE_LIGHTMAP' : '',\r\n        parameters.bumpMap ? '#define USE_BUMPMAP' : '',\r\n        parameters.normalMap ? '#define USE_NORMALMAP' : '',\r\n        parameters.specularMap ? '#define USE_SPECULARMAP' : '',\r\n        parameters.alphaMap ? '#define USE_ALPHAMAP' : '',\r\n        parameters.vertexColors ? '#define USE_COLOR' : '',\r\n\r\n        parameters.flatShading ? '#define FLAT_SHADED' : '',\r\n\r\n        parameters.metal ? '#define METAL' : '',\r\n        parameters.wrapAround ? '#define WRAP_AROUND' : '',\r\n        parameters.doubleSided ? '#define DOUBLE_SIDED' : '',\r\n        parameters.flipSided ? '#define FLIP_SIDED' : '',\r\n\r\n        parameters.shadowMapEnabled ? '#define USE_SHADOWMAP' : '',\r\n        parameters.shadowMapEnabled ? '#define ' + shadowMapTypeDefine : '',\r\n        parameters.shadowMapDebug ? '#define SHADOWMAP_DEBUG' : '',\r\n        parameters.shadowMapCascade ? '#define SHADOWMAP_CASCADE' : '',\r\n\r\n        parameters.logarithmicDepthBuffer ? '#define USE_LOGDEPTHBUF' : '',\r\n        //_this._glExtensionFragDepth ? '#define USE_LOGDEPTHBUF_EXT' : '',\r\n\r\n        'uniform mat4 viewMatrix;',\r\n        'uniform vec3 cameraPosition;',\r\n        ''\r\n\r\n      ].join('\\n');\r\n\r\n    }\r\n\r\n    var glVertexShader = new THREE.WebGLShader(_gl, _gl.VERTEX_SHADER, prefix_vertex + vertexShader);\r\n    var glFragmentShader = new THREE.WebGLShader(_gl, _gl.FRAGMENT_SHADER, prefix_fragment + fragmentShader);\r\n\r\n    _gl.attachShader(program, glVertexShader);\r\n    _gl.attachShader(program, glFragmentShader);\r\n\r\n    if (index0AttributeName !== undefined) {\r\n\r\n      // Force a particular attribute to index 0.\r\n      // because potentially expensive emulation is done by browser if attribute 0 is disabled.\r\n      // And, color, for example is often automatically bound to index 0 so disabling it\r\n\r\n      _gl.bindAttribLocation(program, 0, index0AttributeName);\r\n\r\n    }\r\n\r\n    _gl.linkProgram(program);\r\n\r\n    var programLogInfo = _gl.getProgramInfoLog(program);\r\n\r\n    if (_gl.getProgramParameter(program, _gl.LINK_STATUS) === false) {\r\n\r\n      THREE.error('THREE.WebGLProgram: shader error: ' + _gl.getError(), 'gl.VALIDATE_STATUS', _gl.getProgramParameter(program, _gl.VALIDATE_STATUS), 'gl.getPRogramInfoLog', programLogInfo);\r\n\r\n    }\r\n\r\n    if (programLogInfo !== '') {\r\n\r\n      THREE.warn('THREE.WebGLProgram: gl.getProgramInfoLog()' + programLogInfo);\r\n      // THREE.warn( _gl.getExtension( 'WEBGL_debug_shaders' ).getTranslatedShaderSource( glVertexShader ) );\r\n      // THREE.warn( _gl.getExtension( 'WEBGL_debug_shaders' ).getTranslatedShaderSource( glFragmentShader ) );\r\n\r\n    }\r\n\r\n    // clean up\r\n\r\n    _gl.deleteShader(glVertexShader);\r\n    _gl.deleteShader(glFragmentShader);\r\n\r\n    // cache uniform locations\r\n\r\n    var identifiers = [\r\n\r\n      'viewMatrix',\r\n      'modelViewMatrix',\r\n      'projectionMatrix',\r\n      'normalMatrix',\r\n      'modelMatrix',\r\n      'cameraPosition',\r\n      'morphTargetInfluences',\r\n      'bindMatrix',\r\n      'bindMatrixInverse'\r\n\r\n    ];\r\n\r\n    if (parameters.useVertexTexture) {\r\n\r\n      identifiers.push('boneTexture');\r\n      identifiers.push('boneTextureWidth');\r\n      identifiers.push('boneTextureHeight');\r\n\r\n    }\r\n    else {\r\n\r\n      identifiers.push('boneGlobalMatrices');\r\n\r\n    }\r\n\r\n    if (parameters.logarithmicDepthBuffer) {\r\n\r\n      identifiers.push('logDepthBufFC');\r\n\r\n    }\r\n\r\n\r\n    for (var u in uniforms) {\r\n\r\n      identifiers.push(u);\r\n\r\n    }\r\n\r\n    this.uniforms = cacheUniformLocations(_gl, program, identifiers);\r\n\r\n    // cache attributes locations\r\n\r\n    identifiers = [\r\n\r\n      'position',\r\n      'normal',\r\n      'uv',\r\n      'uv2',\r\n      'tangent',\r\n      'color',\r\n      'skinIndex',\r\n      'skinWeight',\r\n      'lineDistance'\r\n\r\n    ];\r\n\r\n    for (var i = 0; i < parameters.maxMorphTargets; i++) {\r\n\r\n      identifiers.push('morphTarget' + i);\r\n\r\n    }\r\n\r\n    for (var i = 0; i < parameters.maxMorphNormals; i++) {\r\n\r\n      identifiers.push('morphNormal' + i);\r\n\r\n    }\r\n\r\n    for (var a in attributes) {\r\n\r\n      identifiers.push(a);\r\n\r\n    }\r\n\r\n    this.attributes = cacheAttributeLocations(_gl, program, identifiers);\r\n    this.attributesKeys = Object.keys(this.attributes);\r\n\r\n    //\r\n\r\n    this.id = programIdCount++;\r\n    this.code = code;\r\n    this.usedTimes = 1;\r\n    this.program = program;\r\n    this.vertexShader = glVertexShader;\r\n    this.fragmentShader = glFragmentShader;\r\n\r\n    return this;\r\n\r\n  };\r\n\r\n})();\r\n\r\n// File:src/renderers/webgl/WebGLShader.js\r\n\r\nTHREE.WebGLShader = (function() {\r\n\r\n  var addLineNumbers = function(string) {\r\n\r\n    var lines = string.split('\\n');\r\n\r\n    for (var i = 0; i < lines.length; i++) {\r\n\r\n      lines[i] = (i + 1) + ': ' + lines[i];\r\n\r\n    }\r\n\r\n    return lines.join('\\n');\r\n\r\n  };\r\n\r\n  return function(gl, type, string) {\r\n\r\n    var shader = gl.createShader(type);\r\n\r\n    gl.shaderSource(shader, string);\r\n    gl.compileShader(shader);\r\n\r\n    if (gl.getShaderParameter(shader, gl.COMPILE_STATUS) === false) {\r\n\r\n      THREE.error('THREE.WebGLShader: Shader couldn\\'t compile.');\r\n\r\n    }\r\n\r\n    if (gl.getShaderInfoLog(shader) !== '') {\r\n\r\n      THREE.warn('THREE.WebGLShader: gl.getShaderInfoLog()', gl.getShaderInfoLog(shader), addLineNumbers(string));\r\n\r\n    }\r\n\r\n    // --enable-privileged-webgl-extension\r\n    // console.log( type, gl.getExtension( 'WEBGL_debug_shaders' ).getTranslatedShaderSource( shader ) );\r\n\r\n    return shader;\r\n\r\n  };\r\n\r\n})();\r\n\r\n// File:src/renderers/webgl/WebGLState.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.WebGLState = function(gl, paramThreeToGL) {\r\n\r\n  var newAttributes = new Uint8Array(16);\r\n  var enabledAttributes = new Uint8Array(16);\r\n\r\n  var currentBlending = null;\r\n  var currentBlendEquation = null;\r\n  var currentBlendSrc = null;\r\n  var currentBlendDst = null;\r\n  var currentBlendEquationAlpha = null;\r\n  var currentBlendSrcAlpha = null;\r\n  var currentBlendDstAlpha = null;\r\n\r\n  var currentDepthTest = null;\r\n  var currentDepthWrite = null;\r\n\r\n  var currentColorWrite = null;\r\n\r\n  var currentDoubleSided = null;\r\n  var currentFlipSided = null;\r\n\r\n  var currentLineWidth = null;\r\n\r\n  var currentPolygonOffset = null;\r\n  var currentPolygonOffsetFactor = null;\r\n  var currentPolygonOffsetUnits = null;\r\n\r\n  this.initAttributes = function() {\r\n\r\n    for (var i = 0, l = newAttributes.length; i < l; i++) {\r\n\r\n      newAttributes[i] = 0;\r\n\r\n    }\r\n\r\n  };\r\n\r\n  this.enableAttribute = function(attribute) {\r\n\r\n    newAttributes[attribute] = 1;\r\n\r\n    if (enabledAttributes[attribute] === 0) {\r\n\r\n      gl.enableVertexAttribArray(attribute);\r\n      enabledAttributes[attribute] = 1;\r\n\r\n    }\r\n\r\n  };\r\n\r\n  this.disableUnusedAttributes = function() {\r\n\r\n    for (var i = 0, l = enabledAttributes.length; i < l; i++) {\r\n\r\n      if (enabledAttributes[i] !== newAttributes[i]) {\r\n\r\n        gl.disableVertexAttribArray(i);\r\n        enabledAttributes[i] = 0;\r\n\r\n      }\r\n\r\n    }\r\n\r\n  };\r\n\r\n  this.setBlending = function(blending, blendEquation, blendSrc, blendDst, blendEquationAlpha, blendSrcAlpha, blendDstAlpha) {\r\n\r\n    if (blending !== currentBlending) {\r\n\r\n      if (blending === THREE.NoBlending) {\r\n\r\n        gl.disable(gl.BLEND);\r\n\r\n      }\r\n      else if (blending === THREE.AdditiveBlending) {\r\n\r\n        gl.enable(gl.BLEND);\r\n        gl.blendEquation(gl.FUNC_ADD);\r\n        gl.blendFunc(gl.SRC_ALPHA, gl.ONE);\r\n\r\n      }\r\n      else if (blending === THREE.SubtractiveBlending) {\r\n\r\n        // TODO: Find blendFuncSeparate() combination\r\n        gl.enable(gl.BLEND);\r\n        gl.blendEquation(gl.FUNC_ADD);\r\n        gl.blendFunc(gl.ZERO, gl.ONE_MINUS_SRC_COLOR);\r\n\r\n      }\r\n      else if (blending === THREE.MultiplyBlending) {\r\n\r\n        // TODO: Find blendFuncSeparate() combination\r\n        gl.enable(gl.BLEND);\r\n        gl.blendEquation(gl.FUNC_ADD);\r\n        gl.blendFunc(gl.ZERO, gl.SRC_COLOR);\r\n\r\n      }\r\n      else if (blending === THREE.CustomBlending) {\r\n\r\n        gl.enable(gl.BLEND);\r\n\r\n      }\r\n      else {\r\n\r\n        gl.enable(gl.BLEND);\r\n        gl.blendEquationSeparate(gl.FUNC_ADD, gl.FUNC_ADD);\r\n        gl.blendFuncSeparate(gl.SRC_ALPHA, gl.ONE_MINUS_SRC_ALPHA, gl.ONE, gl.ONE_MINUS_SRC_ALPHA);\r\n\r\n      }\r\n\r\n      currentBlending = blending;\r\n\r\n    }\r\n\r\n    if (blending === THREE.CustomBlending) {\r\n\r\n      blendEquationAlpha = blendEquationAlpha || blendEquation;\r\n      blendSrcAlpha = blendSrcAlpha || blendSrc;\r\n      blendDstAlpha = blendDstAlpha || blendDst;\r\n\r\n      if (blendEquation !== currentBlendEquation || blendEquationAlpha !== currentBlendEquationAlpha) {\r\n\r\n        gl.blendEquationSeparate(paramThreeToGL(blendEquation), paramThreeToGL(blendEquationAlpha));\r\n\r\n        currentBlendEquation = blendEquation;\r\n        currentBlendEquationAlpha = blendEquationAlpha;\r\n\r\n      }\r\n\r\n      if (blendSrc !== currentBlendSrc || blendDst !== currentBlendDst || blendSrcAlpha !== currentBlendSrcAlpha || blendDstAlpha !== currentBlendDstAlpha) {\r\n\r\n        gl.blendFuncSeparate(paramThreeToGL(blendSrc), paramThreeToGL(blendDst), paramThreeToGL(blendSrcAlpha), paramThreeToGL(blendDstAlpha));\r\n\r\n        currentBlendSrc = blendSrc;\r\n        currentBlendDst = blendDst;\r\n        currentBlendSrcAlpha = blendSrcAlpha;\r\n        currentBlendDstAlpha = blendDstAlpha;\r\n\r\n      }\r\n\r\n    }\r\n    else {\r\n\r\n      currentBlendEquation = null;\r\n      currentBlendSrc = null;\r\n      currentBlendDst = null;\r\n      currentBlendEquationAlpha = null;\r\n      currentBlendSrcAlpha = null;\r\n      currentBlendDstAlpha = null;\r\n\r\n    }\r\n\r\n  };\r\n\r\n  this.setDepthTest = function(depthTest) {\r\n\r\n    if (currentDepthTest !== depthTest) {\r\n\r\n      if (depthTest) {\r\n\r\n        gl.enable(gl.DEPTH_TEST);\r\n\r\n      }\r\n      else {\r\n\r\n        gl.disable(gl.DEPTH_TEST);\r\n\r\n      }\r\n\r\n      currentDepthTest = depthTest;\r\n\r\n    }\r\n\r\n  };\r\n\r\n  this.setDepthWrite = function(depthWrite) {\r\n\r\n    if (currentDepthWrite !== depthWrite) {\r\n\r\n      gl.depthMask(depthWrite);\r\n      currentDepthWrite = depthWrite;\r\n\r\n    }\r\n\r\n  };\r\n\r\n  this.setColorWrite = function(colorWrite) {\r\n\r\n    if (currentColorWrite !== colorWrite) {\r\n\r\n      gl.colorMask(colorWrite, colorWrite, colorWrite, colorWrite);\r\n      currentColorWrite = colorWrite;\r\n\r\n    }\r\n\r\n  };\r\n\r\n  this.setDoubleSided = function(doubleSided) {\r\n\r\n    if (currentDoubleSided !== doubleSided) {\r\n\r\n      if (doubleSided) {\r\n\r\n        gl.disable(gl.CULL_FACE);\r\n\r\n      }\r\n      else {\r\n\r\n        gl.enable(gl.CULL_FACE);\r\n\r\n      }\r\n\r\n      currentDoubleSided = doubleSided;\r\n\r\n    }\r\n\r\n  };\r\n\r\n  this.setFlipSided = function(flipSided) {\r\n\r\n    if (currentFlipSided !== flipSided) {\r\n\r\n      if (flipSided) {\r\n\r\n        gl.frontFace(gl.CW);\r\n\r\n      }\r\n      else {\r\n\r\n        gl.frontFace(gl.CCW);\r\n\r\n      }\r\n\r\n      currentFlipSided = flipSided;\r\n\r\n    }\r\n\r\n  };\r\n\r\n  this.setLineWidth = function(width) {\r\n\r\n    if (width !== currentLineWidth) {\r\n\r\n      gl.lineWidth(width);\r\n\r\n      currentLineWidth = width;\r\n\r\n    }\r\n\r\n  };\r\n\r\n  this.setPolygonOffset = function(polygonoffset, factor, units) {\r\n\r\n    if (currentPolygonOffset !== polygonoffset) {\r\n\r\n      if (polygonoffset) {\r\n\r\n        gl.enable(gl.POLYGON_OFFSET_FILL);\r\n\r\n      }\r\n      else {\r\n\r\n        gl.disable(gl.POLYGON_OFFSET_FILL);\r\n\r\n      }\r\n\r\n      currentPolygonOffset = polygonoffset;\r\n\r\n    }\r\n\r\n    if (polygonoffset && (currentPolygonOffsetFactor !== factor || currentPolygonOffsetUnits !== units)) {\r\n\r\n      gl.polygonOffset(factor, units);\r\n\r\n      currentPolygonOffsetFactor = factor;\r\n      currentPolygonOffsetUnits = units;\r\n\r\n    }\r\n\r\n  };\r\n\r\n  this.reset = function() {\r\n\r\n    for (var i = 0; i < enabledAttributes.length; i++) {\r\n\r\n      enabledAttributes[i] = 0;\r\n\r\n    }\r\n\r\n    currentBlending = null;\r\n    currentDepthTest = null;\r\n    currentDepthWrite = null;\r\n    currentColorWrite = null;\r\n    currentDoubleSided = null;\r\n    currentFlipSided = null;\r\n\r\n  };\r\n\r\n};\r\n\r\n// File:src/renderers/webgl/plugins/LensFlarePlugin.js\r\n\r\n/**\r\n * @author mikael emtinger / http://gomo.se/\r\n * @author alteredq / http://alteredqualia.com/\r\n */\r\n\r\nTHREE.LensFlarePlugin = function(renderer, flares) {\r\n\r\n  var gl = renderer.context;\r\n\r\n  var vertexBuffer, elementBuffer;\r\n  var program, attributes, uniforms;\r\n  var hasVertexTexture;\r\n\r\n  var tempTexture, occlusionTexture;\r\n\r\n  var init = function() {\r\n\r\n    var vertices = new Float32Array([-1, -1, 0, 0,\r\n      1, -1, 1, 0,\r\n      1, 1, 1, 1, -1, 1, 0, 1\r\n    ]);\r\n\r\n    var faces = new Uint16Array([\r\n      0, 1, 2,\r\n      0, 2, 3\r\n    ]);\r\n\r\n    // buffers\r\n\r\n    vertexBuffer = gl.createBuffer();\r\n    elementBuffer = gl.createBuffer();\r\n\r\n    gl.bindBuffer(gl.ARRAY_BUFFER, vertexBuffer);\r\n    gl.bufferData(gl.ARRAY_BUFFER, vertices, gl.STATIC_DRAW);\r\n\r\n    gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, elementBuffer);\r\n    gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, faces, gl.STATIC_DRAW);\r\n\r\n    // textures\r\n\r\n    tempTexture = gl.createTexture();\r\n    occlusionTexture = gl.createTexture();\r\n\r\n    gl.bindTexture(gl.TEXTURE_2D, tempTexture);\r\n    gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGB, 16, 16, 0, gl.RGB, gl.UNSIGNED_BYTE, null);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);\r\n\r\n    gl.bindTexture(gl.TEXTURE_2D, occlusionTexture);\r\n    gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, 16, 16, 0, gl.RGBA, gl.UNSIGNED_BYTE, null);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);\r\n\r\n    hasVertexTexture = gl.getParameter(gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS) > 0;\r\n\r\n    var shader;\r\n\r\n    if (hasVertexTexture) {\r\n\r\n      shader = {\r\n\r\n        vertexShader: [\r\n\r\n          \"uniform lowp int renderType;\",\r\n\r\n          \"uniform vec3 screenPosition;\",\r\n          \"uniform vec2 scale;\",\r\n          \"uniform float rotation;\",\r\n\r\n          \"uniform sampler2D occlusionMap;\",\r\n\r\n          \"attribute vec2 position;\",\r\n          \"attribute vec2 uv;\",\r\n\r\n          \"varying vec2 vUV;\",\r\n          \"varying float vVisibility;\",\r\n\r\n          \"void main() {\",\r\n\r\n          \"vUV = uv;\",\r\n\r\n          \"vec2 pos = position;\",\r\n\r\n          \"if( renderType == 2 ) {\",\r\n\r\n          \"vec4 visibility = texture2D( occlusionMap, vec2( 0.1, 0.1 ) );\",\r\n          \"visibility += texture2D( occlusionMap, vec2( 0.5, 0.1 ) );\",\r\n          \"visibility += texture2D( occlusionMap, vec2( 0.9, 0.1 ) );\",\r\n          \"visibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) );\",\r\n          \"visibility += texture2D( occlusionMap, vec2( 0.9, 0.9 ) );\",\r\n          \"visibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) );\",\r\n          \"visibility += texture2D( occlusionMap, vec2( 0.1, 0.9 ) );\",\r\n          \"visibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) );\",\r\n          \"visibility += texture2D( occlusionMap, vec2( 0.5, 0.5 ) );\",\r\n\r\n          \"vVisibility =        visibility.r / 9.0;\",\r\n          \"vVisibility *= 1.0 - visibility.g / 9.0;\",\r\n          \"vVisibility *=       visibility.b / 9.0;\",\r\n          \"vVisibility *= 1.0 - visibility.a / 9.0;\",\r\n\r\n          \"pos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;\",\r\n          \"pos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;\",\r\n\r\n          \"}\",\r\n\r\n          \"gl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );\",\r\n\r\n          \"}\"\r\n\r\n        ].join(\"\\n\"),\r\n\r\n        fragmentShader: [\r\n\r\n          \"uniform lowp int renderType;\",\r\n\r\n          \"uniform sampler2D map;\",\r\n          \"uniform float opacity;\",\r\n          \"uniform vec3 color;\",\r\n\r\n          \"varying vec2 vUV;\",\r\n          \"varying float vVisibility;\",\r\n\r\n          \"void main() {\",\r\n\r\n          // pink square\r\n\r\n          \"if( renderType == 0 ) {\",\r\n\r\n          \"gl_FragColor = vec4( 1.0, 0.0, 1.0, 0.0 );\",\r\n\r\n          // restore\r\n\r\n          \"} else if( renderType == 1 ) {\",\r\n\r\n          \"gl_FragColor = texture2D( map, vUV );\",\r\n\r\n          // flare\r\n\r\n          \"} else {\",\r\n\r\n          \"vec4 texture = texture2D( map, vUV );\",\r\n          \"texture.a *= opacity * vVisibility;\",\r\n          \"gl_FragColor = texture;\",\r\n          \"gl_FragColor.rgb *= color;\",\r\n\r\n          \"}\",\r\n\r\n          \"}\"\r\n\r\n        ].join(\"\\n\")\r\n\r\n      };\r\n\r\n    }\r\n    else {\r\n\r\n      shader = {\r\n\r\n        vertexShader: [\r\n\r\n          \"uniform lowp int renderType;\",\r\n\r\n          \"uniform vec3 screenPosition;\",\r\n          \"uniform vec2 scale;\",\r\n          \"uniform float rotation;\",\r\n\r\n          \"attribute vec2 position;\",\r\n          \"attribute vec2 uv;\",\r\n\r\n          \"varying vec2 vUV;\",\r\n\r\n          \"void main() {\",\r\n\r\n          \"vUV = uv;\",\r\n\r\n          \"vec2 pos = position;\",\r\n\r\n          \"if( renderType == 2 ) {\",\r\n\r\n          \"pos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;\",\r\n          \"pos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;\",\r\n\r\n          \"}\",\r\n\r\n          \"gl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );\",\r\n\r\n          \"}\"\r\n\r\n        ].join(\"\\n\"),\r\n\r\n        fragmentShader: [\r\n\r\n          \"precision mediump float;\",\r\n\r\n          \"uniform lowp int renderType;\",\r\n\r\n          \"uniform sampler2D map;\",\r\n          \"uniform sampler2D occlusionMap;\",\r\n          \"uniform float opacity;\",\r\n          \"uniform vec3 color;\",\r\n\r\n          \"varying vec2 vUV;\",\r\n\r\n          \"void main() {\",\r\n\r\n          // pink square\r\n\r\n          \"if( renderType == 0 ) {\",\r\n\r\n          \"gl_FragColor = vec4( texture2D( map, vUV ).rgb, 0.0 );\",\r\n\r\n          // restore\r\n\r\n          \"} else if( renderType == 1 ) {\",\r\n\r\n          \"gl_FragColor = texture2D( map, vUV );\",\r\n\r\n          // flare\r\n\r\n          \"} else {\",\r\n\r\n          \"float visibility = texture2D( occlusionMap, vec2( 0.5, 0.1 ) ).a;\",\r\n          \"visibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) ).a;\",\r\n          \"visibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) ).a;\",\r\n          \"visibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) ).a;\",\r\n          \"visibility = ( 1.0 - visibility / 4.0 );\",\r\n\r\n          \"vec4 texture = texture2D( map, vUV );\",\r\n          \"texture.a *= opacity * visibility;\",\r\n          \"gl_FragColor = texture;\",\r\n          \"gl_FragColor.rgb *= color;\",\r\n\r\n          \"}\",\r\n\r\n          \"}\"\r\n\r\n        ].join(\"\\n\")\r\n\r\n      };\r\n\r\n    }\r\n\r\n    program = createProgram(shader);\r\n\r\n    attributes = {\r\n      vertex: gl.getAttribLocation(program, \"position\"),\r\n      uv: gl.getAttribLocation(program, \"uv\")\r\n    }\r\n\r\n    uniforms = {\r\n      renderType: gl.getUniformLocation(program, \"renderType\"),\r\n      map: gl.getUniformLocation(program, \"map\"),\r\n      occlusionMap: gl.getUniformLocation(program, \"occlusionMap\"),\r\n      opacity: gl.getUniformLocation(program, \"opacity\"),\r\n      color: gl.getUniformLocation(program, \"color\"),\r\n      scale: gl.getUniformLocation(program, \"scale\"),\r\n      rotation: gl.getUniformLocation(program, \"rotation\"),\r\n      screenPosition: gl.getUniformLocation(program, \"screenPosition\")\r\n    };\r\n\r\n  };\r\n\r\n  /*\r\n   * Render lens flares\r\n   * Method: renders 16x16 0xff00ff-colored points scattered over the light source area,\r\n   *         reads these back and calculates occlusion.\r\n   */\r\n\r\n  this.render = function(scene, camera, viewportWidth, viewportHeight) {\r\n\r\n    if (flares.length === 0) return;\r\n\r\n    var tempPosition = new THREE.Vector3();\r\n\r\n    var invAspect = viewportHeight / viewportWidth,\r\n      halfViewportWidth = viewportWidth * 0.5,\r\n      halfViewportHeight = viewportHeight * 0.5;\r\n\r\n    var size = 16 / viewportHeight,\r\n      scale = new THREE.Vector2(size * invAspect, size);\r\n\r\n    var screenPosition = new THREE.Vector3(1, 1, 0),\r\n      screenPositionPixels = new THREE.Vector2(1, 1);\r\n\r\n    if (program === undefined) {\r\n\r\n      init();\r\n\r\n    }\r\n\r\n    gl.useProgram(program);\r\n\r\n    gl.enableVertexAttribArray(attributes.vertex);\r\n    gl.enableVertexAttribArray(attributes.uv);\r\n\r\n    // loop through all lens flares to update their occlusion and positions\r\n    // setup gl and common used attribs/unforms\r\n\r\n    gl.uniform1i(uniforms.occlusionMap, 0);\r\n    gl.uniform1i(uniforms.map, 1);\r\n\r\n    gl.bindBuffer(gl.ARRAY_BUFFER, vertexBuffer);\r\n    gl.vertexAttribPointer(attributes.vertex, 2, gl.FLOAT, false, 2 * 8, 0);\r\n    gl.vertexAttribPointer(attributes.uv, 2, gl.FLOAT, false, 2 * 8, 8);\r\n\r\n    gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, elementBuffer);\r\n\r\n    gl.disable(gl.CULL_FACE);\r\n    gl.depthMask(false);\r\n\r\n    for (var i = 0, l = flares.length; i < l; i++) {\r\n\r\n      size = 16 / viewportHeight;\r\n      scale.set(size * invAspect, size);\r\n\r\n      // calc object screen position\r\n\r\n      var flare = flares[i];\r\n\r\n      tempPosition.set(flare.matrixWorld.elements[12], flare.matrixWorld.elements[13], flare.matrixWorld.elements[14]);\r\n\r\n      tempPosition.applyMatrix4(camera.matrixWorldInverse);\r\n      tempPosition.applyProjection(camera.projectionMatrix);\r\n\r\n      // setup arrays for gl programs\r\n\r\n      screenPosition.copy(tempPosition)\r\n\r\n      screenPositionPixels.x = screenPosition.x * halfViewportWidth + halfViewportWidth;\r\n      screenPositionPixels.y = screenPosition.y * halfViewportHeight + halfViewportHeight;\r\n\r\n      // screen cull\r\n\r\n      if (hasVertexTexture || (\r\n          screenPositionPixels.x > 0 &&\r\n          screenPositionPixels.x < viewportWidth &&\r\n          screenPositionPixels.y > 0 &&\r\n          screenPositionPixels.y < viewportHeight)) {\r\n\r\n        // save current RGB to temp texture\r\n\r\n        gl.activeTexture(gl.TEXTURE1);\r\n        gl.bindTexture(gl.TEXTURE_2D, tempTexture);\r\n        gl.copyTexImage2D(gl.TEXTURE_2D, 0, gl.RGB, screenPositionPixels.x - 8, screenPositionPixels.y - 8, 16, 16, 0);\r\n\r\n\r\n        // render pink quad\r\n\r\n        gl.uniform1i(uniforms.renderType, 0);\r\n        gl.uniform2f(uniforms.scale, scale.x, scale.y);\r\n        gl.uniform3f(uniforms.screenPosition, screenPosition.x, screenPosition.y, screenPosition.z);\r\n\r\n        gl.disable(gl.BLEND);\r\n        gl.enable(gl.DEPTH_TEST);\r\n\r\n        gl.drawElements(gl.TRIANGLES, 6, gl.UNSIGNED_SHORT, 0);\r\n\r\n\r\n        // copy result to occlusionMap\r\n\r\n        gl.activeTexture(gl.TEXTURE0);\r\n        gl.bindTexture(gl.TEXTURE_2D, occlusionTexture);\r\n        gl.copyTexImage2D(gl.TEXTURE_2D, 0, gl.RGBA, screenPositionPixels.x - 8, screenPositionPixels.y - 8, 16, 16, 0);\r\n\r\n\r\n        // restore graphics\r\n\r\n        gl.uniform1i(uniforms.renderType, 1);\r\n        gl.disable(gl.DEPTH_TEST);\r\n\r\n        gl.activeTexture(gl.TEXTURE1);\r\n        gl.bindTexture(gl.TEXTURE_2D, tempTexture);\r\n        gl.drawElements(gl.TRIANGLES, 6, gl.UNSIGNED_SHORT, 0);\r\n\r\n\r\n        // update object positions\r\n\r\n        flare.positionScreen.copy(screenPosition)\r\n\r\n        if (flare.customUpdateCallback) {\r\n\r\n          flare.customUpdateCallback(flare);\r\n\r\n        }\r\n        else {\r\n\r\n          flare.updateLensFlares();\r\n\r\n        }\r\n\r\n        // render flares\r\n\r\n        gl.uniform1i(uniforms.renderType, 2);\r\n        gl.enable(gl.BLEND);\r\n\r\n        for (var j = 0, jl = flare.lensFlares.length; j < jl; j++) {\r\n\r\n          var sprite = flare.lensFlares[j];\r\n\r\n          if (sprite.opacity > 0.001 && sprite.scale > 0.001) {\r\n\r\n            screenPosition.x = sprite.x;\r\n            screenPosition.y = sprite.y;\r\n            screenPosition.z = sprite.z;\r\n\r\n            size = sprite.size * sprite.scale / viewportHeight;\r\n\r\n            scale.x = size * invAspect;\r\n            scale.y = size;\r\n\r\n            gl.uniform3f(uniforms.screenPosition, screenPosition.x, screenPosition.y, screenPosition.z);\r\n            gl.uniform2f(uniforms.scale, scale.x, scale.y);\r\n            gl.uniform1f(uniforms.rotation, sprite.rotation);\r\n\r\n            gl.uniform1f(uniforms.opacity, sprite.opacity);\r\n            gl.uniform3f(uniforms.color, sprite.color.r, sprite.color.g, sprite.color.b);\r\n\r\n            renderer.state.setBlending(sprite.blending, sprite.blendEquation, sprite.blendSrc, sprite.blendDst);\r\n            renderer.setTexture(sprite.texture, 1);\r\n\r\n            gl.drawElements(gl.TRIANGLES, 6, gl.UNSIGNED_SHORT, 0);\r\n\r\n          }\r\n\r\n        }\r\n\r\n      }\r\n\r\n    }\r\n\r\n    // restore gl\r\n\r\n    gl.enable(gl.CULL_FACE);\r\n    gl.enable(gl.DEPTH_TEST);\r\n    gl.depthMask(true);\r\n\r\n    renderer.resetGLState();\r\n\r\n  };\r\n\r\n  function createProgram(shader) {\r\n\r\n    var program = gl.createProgram();\r\n\r\n    var fragmentShader = gl.createShader(gl.FRAGMENT_SHADER);\r\n    var vertexShader = gl.createShader(gl.VERTEX_SHADER);\r\n\r\n    var prefix = \"precision \" + renderer.getPrecision() + \" float;\\n\";\r\n\r\n    gl.shaderSource(fragmentShader, prefix + shader.fragmentShader);\r\n    gl.shaderSource(vertexShader, prefix + shader.vertexShader);\r\n\r\n    gl.compileShader(fragmentShader);\r\n    gl.compileShader(vertexShader);\r\n\r\n    gl.attachShader(program, fragmentShader);\r\n    gl.attachShader(program, vertexShader);\r\n\r\n    gl.linkProgram(program);\r\n\r\n    return program;\r\n\r\n  }\r\n\r\n};\r\n\r\n// File:src/renderers/webgl/plugins/ShadowMapPlugin.js\r\n\r\n/**\r\n * @author alteredq / http://alteredqualia.com/\r\n */\r\n\r\nTHREE.ShadowMapPlugin = function(_renderer, _lights, _webglObjects, _webglObjectsImmediate) {\r\n\r\n  var _gl = _renderer.context;\r\n\r\n  var _depthMaterial, _depthMaterialMorph, _depthMaterialSkin, _depthMaterialMorphSkin,\r\n\r\n    _frustum = new THREE.Frustum(),\r\n    _projScreenMatrix = new THREE.Matrix4(),\r\n\r\n    _min = new THREE.Vector3(),\r\n    _max = new THREE.Vector3(),\r\n\r\n    _matrixPosition = new THREE.Vector3(),\r\n\r\n    _renderList = [];\r\n\r\n  // init\r\n\r\n  var depthShader = THREE.ShaderLib[\"depthRGBA\"];\r\n  var depthUniforms = THREE.UniformsUtils.clone(depthShader.uniforms);\r\n\r\n  _depthMaterial = new THREE.ShaderMaterial({\r\n    uniforms: depthUniforms,\r\n    vertexShader: depthShader.vertexShader,\r\n    fragmentShader: depthShader.fragmentShader\r\n  });\r\n\r\n  _depthMaterialMorph = new THREE.ShaderMaterial({\r\n    uniforms: depthUniforms,\r\n    vertexShader: depthShader.vertexShader,\r\n    fragmentShader: depthShader.fragmentShader,\r\n    morphTargets: true\r\n  });\r\n\r\n  _depthMaterialSkin = new THREE.ShaderMaterial({\r\n    uniforms: depthUniforms,\r\n    vertexShader: depthShader.vertexShader,\r\n    fragmentShader: depthShader.fragmentShader,\r\n    skinning: true\r\n  });\r\n\r\n  _depthMaterialMorphSkin = new THREE.ShaderMaterial({\r\n    uniforms: depthUniforms,\r\n    vertexShader: depthShader.vertexShader,\r\n    fragmentShader: depthShader.fragmentShader,\r\n    morphTargets: true,\r\n    skinning: true\r\n  });\r\n\r\n  _depthMaterial._shadowPass = true;\r\n  _depthMaterialMorph._shadowPass = true;\r\n  _depthMaterialSkin._shadowPass = true;\r\n  _depthMaterialMorphSkin._shadowPass = true;\r\n\r\n  this.render = function(scene, camera) {\r\n\r\n    if (_renderer.shadowMapEnabled === false) return;\r\n\r\n    var i, il, j, jl, n,\r\n\r\n      shadowMap, shadowMatrix, shadowCamera,\r\n      buffer, material,\r\n      webglObject, object, light,\r\n\r\n      lights = [],\r\n      k = 0,\r\n\r\n      fog = null;\r\n\r\n    // set GL state for depth map\r\n\r\n    _gl.clearColor(1, 1, 1, 1);\r\n    _gl.disable(_gl.BLEND);\r\n\r\n    _gl.enable(_gl.CULL_FACE);\r\n    _gl.frontFace(_gl.CCW);\r\n\r\n    if (_renderer.shadowMapCullFace === THREE.CullFaceFront) {\r\n\r\n      _gl.cullFace(_gl.FRONT);\r\n\r\n    }\r\n    else {\r\n\r\n      _gl.cullFace(_gl.BACK);\r\n\r\n    }\r\n\r\n    _renderer.state.setDepthTest(true);\r\n\r\n    // preprocess lights\r\n    // \t- skip lights that are not casting shadows\r\n    //\t- create virtual lights for cascaded shadow maps\r\n\r\n    for (i = 0, il = _lights.length; i < il; i++) {\r\n\r\n      light = _lights[i];\r\n\r\n      if (!light.castShadow) continue;\r\n\r\n      if ((light instanceof THREE.DirectionalLight) && light.shadowCascade) {\r\n\r\n        for (n = 0; n < light.shadowCascadeCount; n++) {\r\n\r\n          var virtualLight;\r\n\r\n          if (!light.shadowCascadeArray[n]) {\r\n\r\n            virtualLight = createVirtualLight(light, n);\r\n            virtualLight.originalCamera = camera;\r\n\r\n            var gyro = new THREE.Gyroscope();\r\n            gyro.position.copy(light.shadowCascadeOffset);\r\n\r\n            gyro.add(virtualLight);\r\n            gyro.add(virtualLight.target);\r\n\r\n            camera.add(gyro);\r\n\r\n            light.shadowCascadeArray[n] = virtualLight;\r\n\r\n            //console.log( \"Created virtualLight\", virtualLight );\r\n\r\n          }\r\n          else {\r\n\r\n            virtualLight = light.shadowCascadeArray[n];\r\n\r\n          }\r\n\r\n          updateVirtualLight(light, n);\r\n\r\n          lights[k] = virtualLight;\r\n          k++;\r\n\r\n        }\r\n\r\n      }\r\n      else {\r\n\r\n        lights[k] = light;\r\n        k++;\r\n\r\n      }\r\n\r\n    }\r\n\r\n    // render depth map\r\n\r\n    for (i = 0, il = lights.length; i < il; i++) {\r\n\r\n      light = lights[i];\r\n\r\n      if (!light.shadowMap) {\r\n\r\n        var shadowFilter = THREE.LinearFilter;\r\n\r\n        if (_renderer.shadowMapType === THREE.PCFSoftShadowMap) {\r\n\r\n          shadowFilter = THREE.NearestFilter;\r\n\r\n        }\r\n\r\n        var pars = {\r\n          minFilter: shadowFilter,\r\n          magFilter: shadowFilter,\r\n          format: THREE.RGBAFormat\r\n        };\r\n\r\n        light.shadowMap = new THREE.WebGLRenderTarget(light.shadowMapWidth, light.shadowMapHeight, pars);\r\n        light.shadowMapSize = new THREE.Vector2(light.shadowMapWidth, light.shadowMapHeight);\r\n\r\n        light.shadowMatrix = new THREE.Matrix4();\r\n\r\n      }\r\n\r\n      if (!light.shadowCamera) {\r\n\r\n        if (light instanceof THREE.SpotLight) {\r\n\r\n          light.shadowCamera = new THREE.PerspectiveCamera(light.shadowCameraFov, light.shadowMapWidth / light.shadowMapHeight, light.shadowCameraNear, light.shadowCameraFar);\r\n\r\n        }\r\n        else if (light instanceof THREE.DirectionalLight) {\r\n\r\n          light.shadowCamera = new THREE.OrthographicCamera(light.shadowCameraLeft, light.shadowCameraRight, light.shadowCameraTop, light.shadowCameraBottom, light.shadowCameraNear, light.shadowCameraFar);\r\n\r\n        }\r\n        else {\r\n\r\n          THREE.error(\"THREE.ShadowMapPlugin: Unsupported light type for shadow\", light);\r\n          continue;\r\n\r\n        }\r\n\r\n        scene.add(light.shadowCamera);\r\n\r\n        if (scene.autoUpdate === true) scene.updateMatrixWorld();\r\n\r\n      }\r\n\r\n      if (light.shadowCameraVisible && !light.cameraHelper) {\r\n\r\n        light.cameraHelper = new THREE.CameraHelper(light.shadowCamera);\r\n        scene.add(light.cameraHelper);\r\n\r\n      }\r\n\r\n      if (light.isVirtual && virtualLight.originalCamera == camera) {\r\n\r\n        updateShadowCamera(camera, light);\r\n\r\n      }\r\n\r\n      shadowMap = light.shadowMap;\r\n      shadowMatrix = light.shadowMatrix;\r\n      shadowCamera = light.shadowCamera;\r\n\r\n      //\r\n\r\n      shadowCamera.position.setFromMatrixPosition(light.matrixWorld);\r\n      _matrixPosition.setFromMatrixPosition(light.target.matrixWorld);\r\n      shadowCamera.lookAt(_matrixPosition);\r\n      shadowCamera.updateMatrixWorld();\r\n\r\n      shadowCamera.matrixWorldInverse.getInverse(shadowCamera.matrixWorld);\r\n\r\n      //\r\n\r\n      if (light.cameraHelper) light.cameraHelper.visible = light.shadowCameraVisible;\r\n      if (light.shadowCameraVisible) light.cameraHelper.update();\r\n\r\n      // compute shadow matrix\r\n\r\n      shadowMatrix.set(\r\n        0.5, 0.0, 0.0, 0.5,\r\n        0.0, 0.5, 0.0, 0.5,\r\n        0.0, 0.0, 0.5, 0.5,\r\n        0.0, 0.0, 0.0, 1.0\r\n      );\r\n\r\n      shadowMatrix.multiply(shadowCamera.projectionMatrix);\r\n      shadowMatrix.multiply(shadowCamera.matrixWorldInverse);\r\n\r\n      // update camera matrices and frustum\r\n\r\n      _projScreenMatrix.multiplyMatrices(shadowCamera.projectionMatrix, shadowCamera.matrixWorldInverse);\r\n      _frustum.setFromMatrix(_projScreenMatrix);\r\n\r\n      // render shadow map\r\n\r\n      _renderer.setRenderTarget(shadowMap);\r\n      _renderer.clear();\r\n\r\n      // set object matrices & frustum culling\r\n\r\n      _renderList.length = 0;\r\n\r\n      projectObject(scene, scene, shadowCamera);\r\n\r\n\r\n      // render regular objects\r\n\r\n      var objectMaterial, useMorphing, useSkinning;\r\n\r\n      for (j = 0, jl = _renderList.length; j < jl; j++) {\r\n\r\n        webglObject = _renderList[j];\r\n\r\n        object = webglObject.object;\r\n        buffer = webglObject.buffer;\r\n\r\n        // culling is overriden globally for all objects\r\n        // while rendering depth map\r\n\r\n        // need to deal with MeshFaceMaterial somehow\r\n        // in that case just use the first of material.materials for now\r\n        // (proper solution would require to break objects by materials\r\n        //  similarly to regular rendering and then set corresponding\r\n        //  depth materials per each chunk instead of just once per object)\r\n\r\n        objectMaterial = getObjectMaterial(object);\r\n\r\n        useMorphing = object.geometry.morphTargets !== undefined && object.geometry.morphTargets.length > 0 && objectMaterial.morphTargets;\r\n        useSkinning = object instanceof THREE.SkinnedMesh && objectMaterial.skinning;\r\n\r\n        if (object.customDepthMaterial) {\r\n\r\n          material = object.customDepthMaterial;\r\n\r\n        }\r\n        else if (useSkinning) {\r\n\r\n          material = useMorphing ? _depthMaterialMorphSkin : _depthMaterialSkin;\r\n\r\n        }\r\n        else if (useMorphing) {\r\n\r\n          material = _depthMaterialMorph;\r\n\r\n        }\r\n        else {\r\n\r\n          material = _depthMaterial;\r\n\r\n        }\r\n\r\n        _renderer.setMaterialFaces(objectMaterial);\r\n\r\n        if (buffer instanceof THREE.BufferGeometry) {\r\n\r\n          _renderer.renderBufferDirect(shadowCamera, _lights, fog, material, buffer, object);\r\n\r\n        }\r\n        else {\r\n\r\n          _renderer.renderBuffer(shadowCamera, _lights, fog, material, buffer, object);\r\n\r\n        }\r\n\r\n      }\r\n\r\n      // set matrices and render immediate objects\r\n\r\n      for (j = 0, jl = _webglObjectsImmediate.length; j < jl; j++) {\r\n\r\n        webglObject = _webglObjectsImmediate[j];\r\n        object = webglObject.object;\r\n\r\n        if (object.visible && object.castShadow) {\r\n\r\n          object._modelViewMatrix.multiplyMatrices(shadowCamera.matrixWorldInverse, object.matrixWorld);\r\n\r\n          _renderer.renderImmediateObject(shadowCamera, _lights, fog, _depthMaterial, object);\r\n\r\n        }\r\n\r\n      }\r\n\r\n    }\r\n\r\n    // restore GL state\r\n\r\n    var clearColor = _renderer.getClearColor(),\r\n      clearAlpha = _renderer.getClearAlpha();\r\n\r\n    _gl.clearColor(clearColor.r, clearColor.g, clearColor.b, clearAlpha);\r\n    _gl.enable(_gl.BLEND);\r\n\r\n    if (_renderer.shadowMapCullFace === THREE.CullFaceFront) {\r\n\r\n      _gl.cullFace(_gl.BACK);\r\n\r\n    }\r\n\r\n    _renderer.resetGLState();\r\n\r\n  };\r\n\r\n  function projectObject(scene, object, shadowCamera) {\r\n\r\n    if (object.visible) {\r\n\r\n      var webglObjects = _webglObjects[object.id];\r\n\r\n      if (webglObjects && object.castShadow && (object.frustumCulled === false || _frustum.intersectsObject(object) === true)) {\r\n\r\n        for (var i = 0, l = webglObjects.length; i < l; i++) {\r\n\r\n          var webglObject = webglObjects[i];\r\n\r\n          object._modelViewMatrix.multiplyMatrices(shadowCamera.matrixWorldInverse, object.matrixWorld);\r\n          _renderList.push(webglObject);\r\n\r\n        }\r\n\r\n      }\r\n\r\n      for (var i = 0, l = object.children.length; i < l; i++) {\r\n\r\n        projectObject(scene, object.children[i], shadowCamera);\r\n\r\n      }\r\n\r\n    }\r\n\r\n  }\r\n\r\n  function createVirtualLight(light, cascade) {\r\n\r\n    var virtualLight = new THREE.DirectionalLight();\r\n\r\n    virtualLight.isVirtual = true;\r\n\r\n    virtualLight.onlyShadow = true;\r\n    virtualLight.castShadow = true;\r\n\r\n    virtualLight.shadowCameraNear = light.shadowCameraNear;\r\n    virtualLight.shadowCameraFar = light.shadowCameraFar;\r\n\r\n    virtualLight.shadowCameraLeft = light.shadowCameraLeft;\r\n    virtualLight.shadowCameraRight = light.shadowCameraRight;\r\n    virtualLight.shadowCameraBottom = light.shadowCameraBottom;\r\n    virtualLight.shadowCameraTop = light.shadowCameraTop;\r\n\r\n    virtualLight.shadowCameraVisible = light.shadowCameraVisible;\r\n\r\n    virtualLight.shadowDarkness = light.shadowDarkness;\r\n\r\n    virtualLight.shadowBias = light.shadowCascadeBias[cascade];\r\n    virtualLight.shadowMapWidth = light.shadowCascadeWidth[cascade];\r\n    virtualLight.shadowMapHeight = light.shadowCascadeHeight[cascade];\r\n\r\n    virtualLight.pointsWorld = [];\r\n    virtualLight.pointsFrustum = [];\r\n\r\n    var pointsWorld = virtualLight.pointsWorld,\r\n      pointsFrustum = virtualLight.pointsFrustum;\r\n\r\n    for (var i = 0; i < 8; i++) {\r\n\r\n      pointsWorld[i] = new THREE.Vector3();\r\n      pointsFrustum[i] = new THREE.Vector3();\r\n\r\n    }\r\n\r\n    var nearZ = light.shadowCascadeNearZ[cascade];\r\n    var farZ = light.shadowCascadeFarZ[cascade];\r\n\r\n    pointsFrustum[0].set(-1, -1, nearZ);\r\n    pointsFrustum[1].set(1, -1, nearZ);\r\n    pointsFrustum[2].set(-1, 1, nearZ);\r\n    pointsFrustum[3].set(1, 1, nearZ);\r\n\r\n    pointsFrustum[4].set(-1, -1, farZ);\r\n    pointsFrustum[5].set(1, -1, farZ);\r\n    pointsFrustum[6].set(-1, 1, farZ);\r\n    pointsFrustum[7].set(1, 1, farZ);\r\n\r\n    return virtualLight;\r\n\r\n  }\r\n\r\n  // Synchronize virtual light with the original light\r\n\r\n  function updateVirtualLight(light, cascade) {\r\n\r\n    var virtualLight = light.shadowCascadeArray[cascade];\r\n\r\n    virtualLight.position.copy(light.position);\r\n    virtualLight.target.position.copy(light.target.position);\r\n    virtualLight.lookAt(virtualLight.target);\r\n\r\n    virtualLight.shadowCameraVisible = light.shadowCameraVisible;\r\n    virtualLight.shadowDarkness = light.shadowDarkness;\r\n\r\n    virtualLight.shadowBias = light.shadowCascadeBias[cascade];\r\n\r\n    var nearZ = light.shadowCascadeNearZ[cascade];\r\n    var farZ = light.shadowCascadeFarZ[cascade];\r\n\r\n    var pointsFrustum = virtualLight.pointsFrustum;\r\n\r\n    pointsFrustum[0].z = nearZ;\r\n    pointsFrustum[1].z = nearZ;\r\n    pointsFrustum[2].z = nearZ;\r\n    pointsFrustum[3].z = nearZ;\r\n\r\n    pointsFrustum[4].z = farZ;\r\n    pointsFrustum[5].z = farZ;\r\n    pointsFrustum[6].z = farZ;\r\n    pointsFrustum[7].z = farZ;\r\n\r\n  }\r\n\r\n  // Fit shadow camera's ortho frustum to camera frustum\r\n\r\n  function updateShadowCamera(camera, light) {\r\n\r\n    var shadowCamera = light.shadowCamera,\r\n      pointsFrustum = light.pointsFrustum,\r\n      pointsWorld = light.pointsWorld;\r\n\r\n    _min.set(Infinity, Infinity, Infinity);\r\n    _max.set(-Infinity, -Infinity, -Infinity);\r\n\r\n    for (var i = 0; i < 8; i++) {\r\n\r\n      var p = pointsWorld[i];\r\n\r\n      p.copy(pointsFrustum[i]);\r\n      p.unproject(camera);\r\n\r\n      p.applyMatrix4(shadowCamera.matrixWorldInverse);\r\n\r\n      if (p.x < _min.x) _min.x = p.x;\r\n      if (p.x > _max.x) _max.x = p.x;\r\n\r\n      if (p.y < _min.y) _min.y = p.y;\r\n      if (p.y > _max.y) _max.y = p.y;\r\n\r\n      if (p.z < _min.z) _min.z = p.z;\r\n      if (p.z > _max.z) _max.z = p.z;\r\n\r\n    }\r\n\r\n    shadowCamera.left = _min.x;\r\n    shadowCamera.right = _max.x;\r\n    shadowCamera.top = _max.y;\r\n    shadowCamera.bottom = _min.y;\r\n\r\n    // can't really fit near/far\r\n    //shadowCamera.near = _min.z;\r\n    //shadowCamera.far = _max.z;\r\n\r\n    shadowCamera.updateProjectionMatrix();\r\n\r\n  }\r\n\r\n  // For the moment just ignore objects that have multiple materials with different animation methods\r\n  // Only the first material will be taken into account for deciding which depth material to use for shadow maps\r\n\r\n  function getObjectMaterial(object) {\r\n\r\n    return object.material instanceof THREE.MeshFaceMaterial ? object.material.materials[0] : object.material;\r\n\r\n  };\r\n\r\n};\r\n\r\n// File:src/renderers/webgl/plugins/SpritePlugin.js\r\n\r\n/**\r\n * @author mikael emtinger / http://gomo.se/\r\n * @author alteredq / http://alteredqualia.com/\r\n */\r\n\r\nTHREE.SpritePlugin = function(renderer, sprites) {\r\n\r\n  var gl = renderer.context;\r\n\r\n  var vertexBuffer, elementBuffer;\r\n  var program, attributes, uniforms;\r\n\r\n  var texture;\r\n\r\n  // decompose matrixWorld\r\n\r\n  var spritePosition = new THREE.Vector3();\r\n  var spriteRotation = new THREE.Quaternion();\r\n  var spriteScale = new THREE.Vector3();\r\n\r\n  var init = function() {\r\n\r\n    var vertices = new Float32Array([-0.5, -0.5, 0, 0,\r\n      0.5, -0.5, 1, 0,\r\n      0.5, 0.5, 1, 1, -0.5, 0.5, 0, 1\r\n    ]);\r\n\r\n    var faces = new Uint16Array([\r\n      0, 1, 2,\r\n      0, 2, 3\r\n    ]);\r\n\r\n    vertexBuffer = gl.createBuffer();\r\n    elementBuffer = gl.createBuffer();\r\n\r\n    gl.bindBuffer(gl.ARRAY_BUFFER, vertexBuffer);\r\n    gl.bufferData(gl.ARRAY_BUFFER, vertices, gl.STATIC_DRAW);\r\n\r\n    gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, elementBuffer);\r\n    gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, faces, gl.STATIC_DRAW);\r\n\r\n    program = createProgram();\r\n\r\n    attributes = {\r\n      position: gl.getAttribLocation(program, 'position'),\r\n      uv: gl.getAttribLocation(program, 'uv')\r\n    };\r\n\r\n    uniforms = {\r\n      uvOffset: gl.getUniformLocation(program, 'uvOffset'),\r\n      uvScale: gl.getUniformLocation(program, 'uvScale'),\r\n\r\n      rotation: gl.getUniformLocation(program, 'rotation'),\r\n      scale: gl.getUniformLocation(program, 'scale'),\r\n\r\n      color: gl.getUniformLocation(program, 'color'),\r\n      map: gl.getUniformLocation(program, 'map'),\r\n      opacity: gl.getUniformLocation(program, 'opacity'),\r\n\r\n      modelViewMatrix: gl.getUniformLocation(program, 'modelViewMatrix'),\r\n      projectionMatrix: gl.getUniformLocation(program, 'projectionMatrix'),\r\n\r\n      fogType: gl.getUniformLocation(program, 'fogType'),\r\n      fogDensity: gl.getUniformLocation(program, 'fogDensity'),\r\n      fogNear: gl.getUniformLocation(program, 'fogNear'),\r\n      fogFar: gl.getUniformLocation(program, 'fogFar'),\r\n      fogColor: gl.getUniformLocation(program, 'fogColor'),\r\n\r\n      alphaTest: gl.getUniformLocation(program, 'alphaTest')\r\n    };\r\n\r\n    var canvas = document.createElement('canvas');\r\n    canvas.width = 8;\r\n    canvas.height = 8;\r\n\r\n    var context = canvas.getContext('2d');\r\n    context.fillStyle = 'white';\r\n    context.fillRect(0, 0, 8, 8);\r\n\r\n    texture = new THREE.Texture(canvas);\r\n    texture.needsUpdate = true;\r\n\r\n  };\r\n\r\n  this.render = function(scene, camera) {\r\n\r\n    if (sprites.length === 0) return;\r\n\r\n    // setup gl\r\n\r\n    if (program === undefined) {\r\n\r\n      init();\r\n\r\n    }\r\n\r\n    gl.useProgram(program);\r\n\r\n    gl.enableVertexAttribArray(attributes.position);\r\n    gl.enableVertexAttribArray(attributes.uv);\r\n\r\n    gl.disable(gl.CULL_FACE);\r\n    gl.enable(gl.BLEND);\r\n\r\n    gl.bindBuffer(gl.ARRAY_BUFFER, vertexBuffer);\r\n    gl.vertexAttribPointer(attributes.position, 2, gl.FLOAT, false, 2 * 8, 0);\r\n    gl.vertexAttribPointer(attributes.uv, 2, gl.FLOAT, false, 2 * 8, 8);\r\n\r\n    gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, elementBuffer);\r\n\r\n    gl.uniformMatrix4fv(uniforms.projectionMatrix, false, camera.projectionMatrix.elements);\r\n\r\n    gl.activeTexture(gl.TEXTURE0);\r\n    gl.uniform1i(uniforms.map, 0);\r\n\r\n    var oldFogType = 0;\r\n    var sceneFogType = 0;\r\n    var fog = scene.fog;\r\n\r\n    if (fog) {\r\n\r\n      gl.uniform3f(uniforms.fogColor, fog.color.r, fog.color.g, fog.color.b);\r\n\r\n      if (fog instanceof THREE.Fog) {\r\n\r\n        gl.uniform1f(uniforms.fogNear, fog.near);\r\n        gl.uniform1f(uniforms.fogFar, fog.far);\r\n\r\n        gl.uniform1i(uniforms.fogType, 1);\r\n        oldFogType = 1;\r\n        sceneFogType = 1;\r\n\r\n      }\r\n      else if (fog instanceof THREE.FogExp2) {\r\n\r\n        gl.uniform1f(uniforms.fogDensity, fog.density);\r\n\r\n        gl.uniform1i(uniforms.fogType, 2);\r\n        oldFogType = 2;\r\n        sceneFogType = 2;\r\n\r\n      }\r\n\r\n    }\r\n    else {\r\n\r\n      gl.uniform1i(uniforms.fogType, 0);\r\n      oldFogType = 0;\r\n      sceneFogType = 0;\r\n\r\n    }\r\n\r\n\r\n    // update positions and sort\r\n\r\n    for (var i = 0, l = sprites.length; i < l; i++) {\r\n\r\n      var sprite = sprites[i];\r\n\r\n      sprite._modelViewMatrix.multiplyMatrices(camera.matrixWorldInverse, sprite.matrixWorld);\r\n      sprite.z = -sprite._modelViewMatrix.elements[14];\r\n\r\n    }\r\n\r\n    sprites.sort(painterSortStable);\r\n\r\n    // render all sprites\r\n\r\n    var scale = [];\r\n\r\n    for (var i = 0, l = sprites.length; i < l; i++) {\r\n\r\n      var sprite = sprites[i];\r\n      var material = sprite.material;\r\n\r\n      gl.uniform1f(uniforms.alphaTest, material.alphaTest);\r\n      gl.uniformMatrix4fv(uniforms.modelViewMatrix, false, sprite._modelViewMatrix.elements);\r\n\r\n      sprite.matrixWorld.decompose(spritePosition, spriteRotation, spriteScale);\r\n\r\n      scale[0] = spriteScale.x;\r\n      scale[1] = spriteScale.y;\r\n\r\n      var fogType = 0;\r\n\r\n      if (scene.fog && material.fog) {\r\n\r\n        fogType = sceneFogType;\r\n\r\n      }\r\n\r\n      if (oldFogType !== fogType) {\r\n\r\n        gl.uniform1i(uniforms.fogType, fogType);\r\n        oldFogType = fogType;\r\n\r\n      }\r\n\r\n      if (material.map !== null) {\r\n\r\n        gl.uniform2f(uniforms.uvOffset, material.map.offset.x, material.map.offset.y);\r\n        gl.uniform2f(uniforms.uvScale, material.map.repeat.x, material.map.repeat.y);\r\n\r\n      }\r\n      else {\r\n\r\n        gl.uniform2f(uniforms.uvOffset, 0, 0);\r\n        gl.uniform2f(uniforms.uvScale, 1, 1);\r\n\r\n      }\r\n\r\n      gl.uniform1f(uniforms.opacity, material.opacity);\r\n      gl.uniform3f(uniforms.color, material.color.r, material.color.g, material.color.b);\r\n\r\n      gl.uniform1f(uniforms.rotation, material.rotation);\r\n      gl.uniform2fv(uniforms.scale, scale);\r\n\r\n      renderer.state.setBlending(material.blending, material.blendEquation, material.blendSrc, material.blendDst);\r\n      renderer.state.setDepthTest(material.depthTest);\r\n      renderer.state.setDepthWrite(material.depthWrite);\r\n\r\n      if (material.map && material.map.image && material.map.image.width) {\r\n\r\n        renderer.setTexture(material.map, 0);\r\n\r\n      }\r\n      else {\r\n\r\n        renderer.setTexture(texture, 0);\r\n\r\n      }\r\n\r\n      gl.drawElements(gl.TRIANGLES, 6, gl.UNSIGNED_SHORT, 0);\r\n\r\n    }\r\n\r\n    // restore gl\r\n\r\n    gl.enable(gl.CULL_FACE);\r\n\r\n    renderer.resetGLState();\r\n\r\n  };\r\n\r\n  function createProgram() {\r\n\r\n    var program = gl.createProgram();\r\n\r\n    var vertexShader = gl.createShader(gl.VERTEX_SHADER);\r\n    var fragmentShader = gl.createShader(gl.FRAGMENT_SHADER);\r\n\r\n    gl.shaderSource(vertexShader, [\r\n\r\n      'precision ' + renderer.getPrecision() + ' float;',\r\n\r\n      'uniform mat4 modelViewMatrix;',\r\n      'uniform mat4 projectionMatrix;',\r\n      'uniform float rotation;',\r\n      'uniform vec2 scale;',\r\n      'uniform vec2 uvOffset;',\r\n      'uniform vec2 uvScale;',\r\n\r\n      'attribute vec2 position;',\r\n      'attribute vec2 uv;',\r\n\r\n      'varying vec2 vUV;',\r\n\r\n      'void main() {',\r\n\r\n      'vUV = uvOffset + uv * uvScale;',\r\n\r\n      'vec2 alignedPosition = position * scale;',\r\n\r\n      'vec2 rotatedPosition;',\r\n      'rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;',\r\n      'rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;',\r\n\r\n      'vec4 finalPosition;',\r\n\r\n      'finalPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );',\r\n      'finalPosition.xy += rotatedPosition;',\r\n      'finalPosition = projectionMatrix * finalPosition;',\r\n\r\n      'gl_Position = finalPosition;',\r\n\r\n      '}'\r\n\r\n    ].join('\\n'));\r\n\r\n    gl.shaderSource(fragmentShader, [\r\n\r\n      'precision ' + renderer.getPrecision() + ' float;',\r\n\r\n      'uniform vec3 color;',\r\n      'uniform sampler2D map;',\r\n      'uniform float opacity;',\r\n\r\n      'uniform int fogType;',\r\n      'uniform vec3 fogColor;',\r\n      'uniform float fogDensity;',\r\n      'uniform float fogNear;',\r\n      'uniform float fogFar;',\r\n      'uniform float alphaTest;',\r\n\r\n      'varying vec2 vUV;',\r\n\r\n      'void main() {',\r\n\r\n      'vec4 texture = texture2D( map, vUV );',\r\n\r\n      'if ( texture.a < alphaTest ) discard;',\r\n\r\n      'gl_FragColor = vec4( color * texture.xyz, texture.a * opacity );',\r\n\r\n      'if ( fogType > 0 ) {',\r\n\r\n      'float depth = gl_FragCoord.z / gl_FragCoord.w;',\r\n      'float fogFactor = 0.0;',\r\n\r\n      'if ( fogType == 1 ) {',\r\n\r\n      'fogFactor = smoothstep( fogNear, fogFar, depth );',\r\n\r\n      '} else {',\r\n\r\n      'const float LOG2 = 1.442695;',\r\n      'float fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );',\r\n      'fogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );',\r\n\r\n      '}',\r\n\r\n      'gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );',\r\n\r\n      '}',\r\n\r\n      '}'\r\n\r\n    ].join('\\n'));\r\n\r\n    gl.compileShader(vertexShader);\r\n    gl.compileShader(fragmentShader);\r\n\r\n    gl.attachShader(program, vertexShader);\r\n    gl.attachShader(program, fragmentShader);\r\n\r\n    gl.linkProgram(program);\r\n\r\n    return program;\r\n\r\n  };\r\n\r\n  function painterSortStable(a, b) {\r\n\r\n    if (a.z !== b.z) {\r\n\r\n      return b.z - a.z;\r\n\r\n    }\r\n    else {\r\n\r\n      return b.id - a.id;\r\n\r\n    }\r\n\r\n  };\r\n\r\n};\r\n\r\n// File:src/extras/GeometryUtils.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.GeometryUtils = {\r\n\r\n  merge: function(geometry1, geometry2, materialIndexOffset) {\r\n\r\n    THREE.warn('THREE.GeometryUtils: .merge() has been moved to Geometry. Use geometry.merge( geometry2, matrix, materialIndexOffset ) instead.');\r\n\r\n    var matrix;\r\n\r\n    if (geometry2 instanceof THREE.Mesh) {\r\n\r\n      geometry2.matrixAutoUpdate && geometry2.updateMatrix();\r\n\r\n      matrix = geometry2.matrix;\r\n      geometry2 = geometry2.geometry;\r\n\r\n    }\r\n\r\n    geometry1.merge(geometry2, matrix, materialIndexOffset);\r\n\r\n  },\r\n\r\n  center: function(geometry) {\r\n\r\n    THREE.warn('THREE.GeometryUtils: .center() has been moved to Geometry. Use geometry.center() instead.');\r\n    return geometry.center();\r\n\r\n  }\r\n\r\n};\r\n\r\n// File:src/extras/ImageUtils.js\r\n\r\n/**\r\n * @author alteredq / http://alteredqualia.com/\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author Daosheng Mu / https://github.com/DaoshengMu/\r\n */\r\n\r\nTHREE.ImageUtils = {\r\n\r\n  crossOrigin: undefined,\r\n\r\n  loadTexture: function(url, mapping, onLoad, onError) {\r\n\r\n    var loader = new THREE.ImageLoader();\r\n    loader.crossOrigin = this.crossOrigin;\r\n\r\n    var texture = new THREE.Texture(undefined, mapping);\r\n\r\n    loader.load(url, function(image) {\r\n\r\n      texture.image = image;\r\n      texture.needsUpdate = true;\r\n\r\n      if (onLoad) onLoad(texture);\r\n\r\n    }, undefined, function(event) {\r\n\r\n      if (onError) onError(event);\r\n\r\n    });\r\n\r\n    texture.sourceFile = url;\r\n\r\n    return texture;\r\n\r\n  },\r\n\r\n  loadTextureCube: function(array, mapping, onLoad, onError) {\r\n\r\n    var images = [];\r\n\r\n    var loader = new THREE.ImageLoader();\r\n    loader.crossOrigin = this.crossOrigin;\r\n\r\n    var texture = new THREE.CubeTexture(images, mapping);\r\n\r\n    // no flipping needed for cube textures\r\n\r\n    texture.flipY = false;\r\n\r\n    var loaded = 0;\r\n\r\n    var loadTexture = function(i) {\r\n\r\n      loader.load(array[i], function(image) {\r\n\r\n        texture.images[i] = image;\r\n\r\n        loaded += 1;\r\n\r\n        if (loaded === 6) {\r\n\r\n          texture.needsUpdate = true;\r\n\r\n          if (onLoad) onLoad(texture);\r\n\r\n        }\r\n\r\n      }, undefined, onError);\r\n\r\n    }\r\n\r\n    for (var i = 0, il = array.length; i < il; ++i) {\r\n\r\n      loadTexture(i);\r\n\r\n    }\r\n\r\n    return texture;\r\n\r\n  },\r\n\r\n  loadCompressedTexture: function() {\r\n\r\n    THREE.error('THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.')\r\n\r\n  },\r\n\r\n  loadCompressedTextureCube: function() {\r\n\r\n    THREE.error('THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.')\r\n\r\n  },\r\n\r\n  getNormalMap: function(image, depth) {\r\n\r\n    // Adapted from http://www.paulbrunt.co.uk/lab/heightnormal/\r\n\r\n    var cross = function(a, b) {\r\n\r\n      return [a[1] * b[2] - a[2] * b[1], a[2] * b[0] - a[0] * b[2], a[0] * b[1] - a[1] * b[0]];\r\n\r\n    }\r\n\r\n    var subtract = function(a, b) {\r\n\r\n      return [a[0] - b[0], a[1] - b[1], a[2] - b[2]];\r\n\r\n    }\r\n\r\n    var normalize = function(a) {\r\n\r\n      var l = Math.sqrt(a[0] * a[0] + a[1] * a[1] + a[2] * a[2]);\r\n      return [a[0] / l, a[1] / l, a[2] / l];\r\n\r\n    }\r\n\r\n    depth = depth | 1;\r\n\r\n    var width = image.width;\r\n    var height = image.height;\r\n\r\n    var canvas = document.createElement('canvas');\r\n    canvas.width = width;\r\n    canvas.height = height;\r\n\r\n    var context = canvas.getContext('2d');\r\n    context.drawImage(image, 0, 0);\r\n\r\n    var data = context.getImageData(0, 0, width, height).data;\r\n    var imageData = context.createImageData(width, height);\r\n    var output = imageData.data;\r\n\r\n    for (var x = 0; x < width; x++) {\r\n\r\n      for (var y = 0; y < height; y++) {\r\n\r\n        var ly = y - 1 < 0 ? 0 : y - 1;\r\n        var uy = y + 1 > height - 1 ? height - 1 : y + 1;\r\n        var lx = x - 1 < 0 ? 0 : x - 1;\r\n        var ux = x + 1 > width - 1 ? width - 1 : x + 1;\r\n\r\n        var points = [];\r\n        var origin = [0, 0, data[(y * width + x) * 4] / 255 * depth];\r\n        points.push([-1, 0, data[(y * width + lx) * 4] / 255 * depth]);\r\n        points.push([-1, -1, data[(ly * width + lx) * 4] / 255 * depth]);\r\n        points.push([0, -1, data[(ly * width + x) * 4] / 255 * depth]);\r\n        points.push([1, -1, data[(ly * width + ux) * 4] / 255 * depth]);\r\n        points.push([1, 0, data[(y * width + ux) * 4] / 255 * depth]);\r\n        points.push([1, 1, data[(uy * width + ux) * 4] / 255 * depth]);\r\n        points.push([0, 1, data[(uy * width + x) * 4] / 255 * depth]);\r\n        points.push([-1, 1, data[(uy * width + lx) * 4] / 255 * depth]);\r\n\r\n        var normals = [];\r\n        var num_points = points.length;\r\n\r\n        for (var i = 0; i < num_points; i++) {\r\n\r\n          var v1 = points[i];\r\n          var v2 = points[(i + 1) % num_points];\r\n          v1 = subtract(v1, origin);\r\n          v2 = subtract(v2, origin);\r\n          normals.push(normalize(cross(v1, v2)));\r\n\r\n        }\r\n\r\n        var normal = [0, 0, 0];\r\n\r\n        for (var i = 0; i < normals.length; i++) {\r\n\r\n          normal[0] += normals[i][0];\r\n          normal[1] += normals[i][1];\r\n          normal[2] += normals[i][2];\r\n\r\n        }\r\n\r\n        normal[0] /= normals.length;\r\n        normal[1] /= normals.length;\r\n        normal[2] /= normals.length;\r\n\r\n        var idx = (y * width + x) * 4;\r\n\r\n        output[idx] = ((normal[0] + 1.0) / 2.0 * 255) | 0;\r\n        output[idx + 1] = ((normal[1] + 1.0) / 2.0 * 255) | 0;\r\n        output[idx + 2] = (normal[2] * 255) | 0;\r\n        output[idx + 3] = 255;\r\n\r\n      }\r\n\r\n    }\r\n\r\n    context.putImageData(imageData, 0, 0);\r\n\r\n    return canvas;\r\n\r\n  },\r\n\r\n  generateDataTexture: function(width, height, color) {\r\n\r\n    var size = width * height;\r\n    var data = new Uint8Array(3 * size);\r\n\r\n    var r = Math.floor(color.r * 255);\r\n    var g = Math.floor(color.g * 255);\r\n    var b = Math.floor(color.b * 255);\r\n\r\n    for (var i = 0; i < size; i++) {\r\n\r\n      data[i * 3] = r;\r\n      data[i * 3 + 1] = g;\r\n      data[i * 3 + 2] = b;\r\n\r\n    }\r\n\r\n    var texture = new THREE.DataTexture(data, width, height, THREE.RGBFormat);\r\n    texture.needsUpdate = true;\r\n\r\n    return texture;\r\n\r\n  }\r\n\r\n};\r\n\r\n// File:src/extras/SceneUtils.js\r\n\r\n/**\r\n * @author alteredq / http://alteredqualia.com/\r\n */\r\n\r\nTHREE.SceneUtils = {\r\n\r\n  createMultiMaterialObject: function(geometry, materials) {\r\n\r\n    var group = new THREE.Object3D();\r\n\r\n    for (var i = 0, l = materials.length; i < l; i++) {\r\n\r\n      group.add(new THREE.Mesh(geometry, materials[i]));\r\n\r\n    }\r\n\r\n    return group;\r\n\r\n  },\r\n\r\n  detach: function(child, parent, scene) {\r\n\r\n    child.applyMatrix(parent.matrixWorld);\r\n    parent.remove(child);\r\n    scene.add(child);\r\n\r\n  },\r\n\r\n  attach: function(child, scene, parent) {\r\n\r\n    var matrixWorldInverse = new THREE.Matrix4();\r\n    matrixWorldInverse.getInverse(parent.matrixWorld);\r\n    child.applyMatrix(matrixWorldInverse);\r\n\r\n    scene.remove(child);\r\n    parent.add(child);\r\n\r\n  }\r\n\r\n};\r\n\r\n// File:src/extras/FontUtils.js\r\n\r\n/**\r\n * @author zz85 / http://www.lab4games.net/zz85/blog\r\n * @author alteredq / http://alteredqualia.com/\r\n *\r\n * For Text operations in three.js (See TextGeometry)\r\n *\r\n * It uses techniques used in:\r\n *\r\n * \ttypeface.js and canvastext\r\n * \t\tFor converting fonts and rendering with javascript\r\n *\t\thttp://typeface.neocracy.org\r\n *\r\n *\tTriangulation ported from AS3\r\n *\t\tSimple Polygon Triangulation\r\n *\t\thttp://actionsnippet.com/?p=1462\r\n *\r\n * \tA Method to triangulate shapes with holes\r\n *\t\thttp://www.sakri.net/blog/2009/06/12/an-approach-to-triangulating-polygons-with-holes/\r\n *\r\n */\r\n\r\nTHREE.FontUtils = {\r\n\r\n  faces: {},\r\n\r\n  // Just for now. face[weight][style]\r\n\r\n  face: 'helvetiker',\r\n  weight: 'normal',\r\n  style: 'normal',\r\n  size: 150,\r\n  divisions: 10,\r\n\r\n  getFace: function() {\r\n\r\n    try {\r\n\r\n      return this.faces[this.face][this.weight][this.style];\r\n\r\n    }\r\n    catch (e) {\r\n\r\n      throw \"The font \" + this.face + \" with \" + this.weight + \" weight and \" + this.style + \" style is missing.\"\r\n\r\n    };\r\n\r\n  },\r\n\r\n  loadFace: function(data) {\r\n\r\n    var family = data.familyName.toLowerCase();\r\n\r\n    var ThreeFont = this;\r\n\r\n    ThreeFont.faces[family] = ThreeFont.faces[family] || {};\r\n\r\n    ThreeFont.faces[family][data.cssFontWeight] = ThreeFont.faces[family][data.cssFontWeight] || {};\r\n    ThreeFont.faces[family][data.cssFontWeight][data.cssFontStyle] = data;\r\n\r\n    ThreeFont.faces[family][data.cssFontWeight][data.cssFontStyle] = data;\r\n\r\n    return data;\r\n\r\n  },\r\n\r\n  drawText: function(text) {\r\n\r\n    // RenderText\r\n\r\n    var i,\r\n      face = this.getFace(),\r\n      scale = this.size / face.resolution,\r\n      offset = 0,\r\n      chars = String(text).split(''),\r\n      length = chars.length;\r\n\r\n    var fontPaths = [];\r\n\r\n    for (i = 0; i < length; i++) {\r\n\r\n      var path = new THREE.Path();\r\n\r\n      var ret = this.extractGlyphPoints(chars[i], face, scale, offset, path);\r\n      offset += ret.offset;\r\n\r\n      fontPaths.push(ret.path);\r\n\r\n    }\r\n\r\n    // get the width\r\n\r\n    var width = offset / 2;\r\n    //\r\n    // for ( p = 0; p < allPts.length; p++ ) {\r\n    //\r\n    // \tallPts[ p ].x -= width;\r\n    //\r\n    // }\r\n\r\n    //var extract = this.extractPoints( allPts, characterPts );\r\n    //extract.contour = allPts;\r\n\r\n    //extract.paths = fontPaths;\r\n    //extract.offset = width;\r\n\r\n    return {\r\n      paths: fontPaths,\r\n      offset: width\r\n    };\r\n\r\n  },\r\n\r\n\r\n\r\n\r\n  extractGlyphPoints: function(c, face, scale, offset, path) {\r\n\r\n    var pts = [];\r\n\r\n    var i, i2, divisions,\r\n      outline, action, length,\r\n      scaleX, scaleY,\r\n      x, y, cpx, cpy, cpx0, cpy0, cpx1, cpy1, cpx2, cpy2,\r\n      laste,\r\n      glyph = face.glyphs[c] || face.glyphs['?'];\r\n\r\n    if (!glyph) return;\r\n\r\n    if (glyph.o) {\r\n\r\n      outline = glyph._cachedOutline || (glyph._cachedOutline = glyph.o.split(' '));\r\n      length = outline.length;\r\n\r\n      scaleX = scale;\r\n      scaleY = scale;\r\n\r\n      for (i = 0; i < length;) {\r\n\r\n        action = outline[i++];\r\n\r\n        //console.log( action );\r\n\r\n        switch (action) {\r\n\r\n          case 'm':\r\n\r\n            // Move To\r\n\r\n            x = outline[i++] * scaleX + offset;\r\n            y = outline[i++] * scaleY;\r\n\r\n            path.moveTo(x, y);\r\n            break;\r\n\r\n          case 'l':\r\n\r\n            // Line To\r\n\r\n            x = outline[i++] * scaleX + offset;\r\n            y = outline[i++] * scaleY;\r\n            path.lineTo(x, y);\r\n            break;\r\n\r\n          case 'q':\r\n\r\n            // QuadraticCurveTo\r\n\r\n            cpx = outline[i++] * scaleX + offset;\r\n            cpy = outline[i++] * scaleY;\r\n            cpx1 = outline[i++] * scaleX + offset;\r\n            cpy1 = outline[i++] * scaleY;\r\n\r\n            path.quadraticCurveTo(cpx1, cpy1, cpx, cpy);\r\n\r\n            laste = pts[pts.length - 1];\r\n\r\n            if (laste) {\r\n\r\n              cpx0 = laste.x;\r\n              cpy0 = laste.y;\r\n\r\n              for (i2 = 1, divisions = this.divisions; i2 <= divisions; i2++) {\r\n\r\n                var t = i2 / divisions;\r\n                THREE.Shape.Utils.b2(t, cpx0, cpx1, cpx);\r\n                THREE.Shape.Utils.b2(t, cpy0, cpy1, cpy);\r\n              }\r\n\r\n            }\r\n\r\n            break;\r\n\r\n          case 'b':\r\n\r\n            // Cubic Bezier Curve\r\n\r\n            cpx = outline[i++] * scaleX + offset;\r\n            cpy = outline[i++] * scaleY;\r\n            cpx1 = outline[i++] * scaleX + offset;\r\n            cpy1 = outline[i++] * scaleY;\r\n            cpx2 = outline[i++] * scaleX + offset;\r\n            cpy2 = outline[i++] * scaleY;\r\n\r\n            path.bezierCurveTo(cpx1, cpy1, cpx2, cpy2, cpx, cpy);\r\n\r\n            laste = pts[pts.length - 1];\r\n\r\n            if (laste) {\r\n\r\n              cpx0 = laste.x;\r\n              cpy0 = laste.y;\r\n\r\n              for (i2 = 1, divisions = this.divisions; i2 <= divisions; i2++) {\r\n\r\n                var t = i2 / divisions;\r\n                THREE.Shape.Utils.b3(t, cpx0, cpx1, cpx2, cpx);\r\n                THREE.Shape.Utils.b3(t, cpy0, cpy1, cpy2, cpy);\r\n\r\n              }\r\n\r\n            }\r\n\r\n            break;\r\n\r\n        }\r\n\r\n      }\r\n    }\r\n\r\n\r\n\r\n    return {\r\n      offset: glyph.ha * scale,\r\n      path: path\r\n    };\r\n  }\r\n\r\n};\r\n\r\n\r\nTHREE.FontUtils.generateShapes = function(text, parameters) {\r\n\r\n  // Parameters \r\n\r\n  parameters = parameters || {};\r\n\r\n  var size = parameters.size !== undefined ? parameters.size : 100;\r\n  var curveSegments = parameters.curveSegments !== undefined ? parameters.curveSegments : 4;\r\n\r\n  var font = parameters.font !== undefined ? parameters.font : 'helvetiker';\r\n  var weight = parameters.weight !== undefined ? parameters.weight : 'normal';\r\n  var style = parameters.style !== undefined ? parameters.style : 'normal';\r\n\r\n  THREE.FontUtils.size = size;\r\n  THREE.FontUtils.divisions = curveSegments;\r\n\r\n  THREE.FontUtils.face = font;\r\n  THREE.FontUtils.weight = weight;\r\n  THREE.FontUtils.style = style;\r\n\r\n  // Get a Font data json object\r\n\r\n  var data = THREE.FontUtils.drawText(text);\r\n\r\n  var paths = data.paths;\r\n  var shapes = [];\r\n\r\n  for (var p = 0, pl = paths.length; p < pl; p++) {\r\n\r\n    Array.prototype.push.apply(shapes, paths[p].toShapes());\r\n\r\n  }\r\n\r\n  return shapes;\r\n\r\n};\r\n\r\n\r\n/**\r\n * This code is a quick port of code written in C++ which was submitted to\r\n * flipcode.com by John W. Ratcliff  // July 22, 2000\r\n * See original code and more information here:\r\n * http://www.flipcode.com/archives/Efficient_Polygon_Triangulation.shtml\r\n *\r\n * ported to actionscript by Zevan Rosser\r\n * www.actionsnippet.com\r\n *\r\n * ported to javascript by Joshua Koo\r\n * http://www.lab4games.net/zz85/blog\r\n *\r\n */\r\n\r\n\r\n(function(namespace) {\r\n\r\n  var EPSILON = 0.0000000001;\r\n\r\n  // takes in an contour array and returns\r\n\r\n  var process = function(contour, indices) {\r\n\r\n    var n = contour.length;\r\n\r\n    if (n < 3) return null;\r\n\r\n    var result = [],\r\n      verts = [],\r\n      vertIndices = [];\r\n\r\n    /* we want a counter-clockwise polygon in verts */\r\n\r\n    var u, v, w;\r\n\r\n    if (area(contour) > 0.0) {\r\n\r\n      for (v = 0; v < n; v++) verts[v] = v;\r\n\r\n    }\r\n    else {\r\n\r\n      for (v = 0; v < n; v++) verts[v] = (n - 1) - v;\r\n\r\n    }\r\n\r\n    var nv = n;\r\n\r\n    /*  remove nv - 2 vertices, creating 1 triangle every time */\r\n\r\n    var count = 2 * nv; /* error detection */\r\n\r\n    for (v = nv - 1; nv > 2;) {\r\n\r\n      /* if we loop, it is probably a non-simple polygon */\r\n\r\n      if ((count--) <= 0) {\r\n\r\n        //** Triangulate: ERROR - probable bad polygon!\r\n\r\n        //throw ( \"Warning, unable to triangulate polygon!\" );\r\n        //return null;\r\n        // Sometimes warning is fine, especially polygons are triangulated in reverse.\r\n        THREE.warn('THREE.FontUtils: Warning, unable to triangulate polygon! in Triangulate.process()');\r\n\r\n        if (indices) return vertIndices;\r\n        return result;\r\n\r\n      }\r\n\r\n      /* three consecutive vertices in current polygon, <u,v,w> */\r\n\r\n      u = v;\r\n      if (nv <= u) u = 0; /* previous */\r\n      v = u + 1;\r\n      if (nv <= v) v = 0; /* new v    */\r\n      w = v + 1;\r\n      if (nv <= w) w = 0; /* next     */\r\n\r\n      if (snip(contour, u, v, w, nv, verts)) {\r\n\r\n        var a, b, c, s, t;\r\n\r\n        /* true names of the vertices */\r\n\r\n        a = verts[u];\r\n        b = verts[v];\r\n        c = verts[w];\r\n\r\n        /* output Triangle */\r\n\r\n        result.push([contour[a],\r\n          contour[b],\r\n          contour[c]\r\n        ]);\r\n\r\n\r\n        vertIndices.push([verts[u], verts[v], verts[w]]);\r\n\r\n        /* remove v from the remaining polygon */\r\n\r\n        for (s = v, t = v + 1; t < nv; s++, t++) {\r\n\r\n          verts[s] = verts[t];\r\n\r\n        }\r\n\r\n        nv--;\r\n\r\n        /* reset error detection counter */\r\n\r\n        count = 2 * nv;\r\n\r\n      }\r\n\r\n    }\r\n\r\n    if (indices) return vertIndices;\r\n    return result;\r\n\r\n  };\r\n\r\n  // calculate area of the contour polygon\r\n\r\n  var area = function(contour) {\r\n\r\n    var n = contour.length;\r\n    var a = 0.0;\r\n\r\n    for (var p = n - 1, q = 0; q < n; p = q++) {\r\n\r\n      a += contour[p].x * contour[q].y - contour[q].x * contour[p].y;\r\n\r\n    }\r\n\r\n    return a * 0.5;\r\n\r\n  };\r\n\r\n  var snip = function(contour, u, v, w, n, verts) {\r\n\r\n    var p;\r\n    var ax, ay, bx, by;\r\n    var cx, cy, px, py;\r\n\r\n    ax = contour[verts[u]].x;\r\n    ay = contour[verts[u]].y;\r\n\r\n    bx = contour[verts[v]].x;\r\n    by = contour[verts[v]].y;\r\n\r\n    cx = contour[verts[w]].x;\r\n    cy = contour[verts[w]].y;\r\n\r\n    if (EPSILON > (((bx - ax) * (cy - ay)) - ((by - ay) * (cx - ax)))) return false;\r\n\r\n    var aX, aY, bX, bY, cX, cY;\r\n    var apx, apy, bpx, bpy, cpx, cpy;\r\n    var cCROSSap, bCROSScp, aCROSSbp;\r\n\r\n    aX = cx - bx;\r\n    aY = cy - by;\r\n    bX = ax - cx;\r\n    bY = ay - cy;\r\n    cX = bx - ax;\r\n    cY = by - ay;\r\n\r\n    for (p = 0; p < n; p++) {\r\n\r\n      px = contour[verts[p]].x\r\n      py = contour[verts[p]].y\r\n\r\n      if (((px === ax) && (py === ay)) ||\r\n        ((px === bx) && (py === by)) ||\r\n        ((px === cx) && (py === cy))) continue;\r\n\r\n      apx = px - ax;\r\n      apy = py - ay;\r\n      bpx = px - bx;\r\n      bpy = py - by;\r\n      cpx = px - cx;\r\n      cpy = py - cy;\r\n\r\n      // see if p is inside triangle abc\r\n\r\n      aCROSSbp = aX * bpy - aY * bpx;\r\n      cCROSSap = cX * apy - cY * apx;\r\n      bCROSScp = bX * cpy - bY * cpx;\r\n\r\n      if ((aCROSSbp >= -EPSILON) && (bCROSScp >= -EPSILON) && (cCROSSap >= -EPSILON)) return false;\r\n\r\n    }\r\n\r\n    return true;\r\n\r\n  };\r\n\r\n\r\n  namespace.Triangulate = process;\r\n  namespace.Triangulate.area = area;\r\n\r\n  return namespace;\r\n\r\n})(THREE.FontUtils);\r\n\r\n// To use the typeface.js face files, hook up the API\r\nself._typeface_js = {\r\n  faces: THREE.FontUtils.faces,\r\n  loadFace: THREE.FontUtils.loadFace\r\n};\r\nTHREE.typeface_js = self._typeface_js;\r\n\r\n// File:src/extras/audio/Audio.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.Audio = function(listener) {\r\n\r\n  THREE.Object3D.call(this);\r\n\r\n  this.type = 'Audio';\r\n\r\n  this.context = listener.context;\r\n  this.source = this.context.createBufferSource();\r\n  this.source.onended = this.onEnded.bind(this);\r\n\r\n  this.gain = this.context.createGain();\r\n  this.gain.connect(this.context.destination);\r\n\r\n  this.panner = this.context.createPanner();\r\n  this.panner.connect(this.gain);\r\n\r\n  this.autoplay = false;\r\n\r\n  this.startTime = 0;\r\n  this.isPlaying = false;\r\n\r\n};\r\n\r\nTHREE.Audio.prototype = Object.create(THREE.Object3D.prototype);\r\nTHREE.Audio.prototype.constructor = THREE.Audio;\r\n\r\nTHREE.Audio.prototype.load = function(file) {\r\n\r\n  var scope = this;\r\n\r\n  var request = new XMLHttpRequest();\r\n  request.open('GET', file, true);\r\n  request.responseType = 'arraybuffer';\r\n  request.onload = function(e) {\r\n\r\n    scope.context.decodeAudioData(this.response, function(buffer) {\r\n\r\n      scope.source.buffer = buffer;\r\n\r\n      if (scope.autoplay) scope.play();\r\n\r\n    });\r\n\r\n  };\r\n  request.send();\r\n\r\n  return this;\r\n\r\n};\r\n\r\nTHREE.Audio.prototype.play = function() {\r\n\r\n  if (this.isPlaying === true) {\r\n\r\n    THREE.warn('THREE.Audio: Audio is already playing.');\r\n    return;\r\n\r\n  }\r\n\r\n  var source = this.context.createBufferSource();\r\n\r\n  source.buffer = this.source.buffer;\r\n  source.loop = this.source.loop;\r\n  source.onended = this.source.onended;\r\n  source.connect(this.panner);\r\n  source.start(0, this.startTime);\r\n\r\n  this.isPlaying = true;\r\n\r\n  this.source = source;\r\n\r\n};\r\n\r\nTHREE.Audio.prototype.pause = function() {\r\n\r\n  this.source.stop();\r\n  this.startTime = this.context.currentTime;\r\n\r\n};\r\n\r\nTHREE.Audio.prototype.stop = function() {\r\n\r\n  this.source.stop();\r\n  this.startTime = 0;\r\n\r\n};\r\n\r\nTHREE.Audio.prototype.onEnded = function() {\r\n\r\n  this.isPlaying = false;\r\n\r\n};\r\n\r\nTHREE.Audio.prototype.setLoop = function(value) {\r\n\r\n  this.source.loop = value;\r\n\r\n};\r\n\r\nTHREE.Audio.prototype.setRefDistance = function(value) {\r\n\r\n  this.panner.refDistance = value;\r\n\r\n};\r\n\r\nTHREE.Audio.prototype.setRolloffFactor = function(value) {\r\n\r\n  this.panner.rolloffFactor = value;\r\n\r\n};\r\n\r\nTHREE.Audio.prototype.setVolume = function(value) {\r\n\r\n  this.gain.gain.value = value;\r\n\r\n};\r\n\r\nTHREE.Audio.prototype.updateMatrixWorld = (function() {\r\n\r\n  var position = new THREE.Vector3();\r\n\r\n  return function(force) {\r\n\r\n    THREE.Object3D.prototype.updateMatrixWorld.call(this, force);\r\n\r\n    position.setFromMatrixPosition(this.matrixWorld);\r\n\r\n    this.panner.setPosition(position.x, position.y, position.z);\r\n\r\n  };\r\n\r\n})();\r\n\r\n// File:src/extras/audio/AudioListener.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.AudioListener = function() {\r\n\r\n  THREE.Object3D.call(this);\r\n\r\n  this.type = 'AudioListener';\r\n\r\n  this.context = new(window.AudioContext || window.webkitAudioContext)();\r\n\r\n};\r\n\r\nTHREE.AudioListener.prototype = Object.create(THREE.Object3D.prototype);\r\nTHREE.AudioListener.prototype.constructor = THREE.AudioListener;\r\n\r\nTHREE.AudioListener.prototype.updateMatrixWorld = (function() {\r\n\r\n  var position = new THREE.Vector3();\r\n  var quaternion = new THREE.Quaternion();\r\n  var scale = new THREE.Vector3();\r\n\r\n  var orientation = new THREE.Vector3();\r\n  var velocity = new THREE.Vector3();\r\n\r\n  var positionPrev = new THREE.Vector3();\r\n\r\n  return function(force) {\r\n\r\n    THREE.Object3D.prototype.updateMatrixWorld.call(this, force);\r\n\r\n    var listener = this.context.listener;\r\n    var up = this.up;\r\n\r\n    this.matrixWorld.decompose(position, quaternion, scale);\r\n\r\n    orientation.set(0, 0, -1).applyQuaternion(quaternion);\r\n    velocity.subVectors(position, positionPrev);\r\n\r\n    listener.setPosition(position.x, position.y, position.z);\r\n    listener.setOrientation(orientation.x, orientation.y, orientation.z, up.x, up.y, up.z);\r\n    listener.setVelocity(velocity.x, velocity.y, velocity.z);\r\n\r\n    positionPrev.copy(position);\r\n\r\n  };\r\n\r\n})();\r\n\r\n// File:src/extras/core/Curve.js\r\n\r\n/**\r\n * @author zz85 / http://www.lab4games.net/zz85/blog\r\n * Extensible curve object\r\n *\r\n * Some common of Curve methods\r\n * .getPoint(t), getTangent(t)\r\n * .getPointAt(u), getTagentAt(u)\r\n * .getPoints(), .getSpacedPoints()\r\n * .getLength()\r\n * .updateArcLengths()\r\n *\r\n * This following classes subclasses THREE.Curve:\r\n *\r\n * -- 2d classes --\r\n * THREE.LineCurve\r\n * THREE.QuadraticBezierCurve\r\n * THREE.CubicBezierCurve\r\n * THREE.SplineCurve\r\n * THREE.ArcCurve\r\n * THREE.EllipseCurve\r\n *\r\n * -- 3d classes --\r\n * THREE.LineCurve3\r\n * THREE.QuadraticBezierCurve3\r\n * THREE.CubicBezierCurve3\r\n * THREE.SplineCurve3\r\n * THREE.ClosedSplineCurve3\r\n *\r\n * A series of curves can be represented as a THREE.CurvePath\r\n *\r\n **/\r\n\r\n/**************************************************************\r\n *\tAbstract Curve base class\r\n **************************************************************/\r\n\r\nTHREE.Curve = function() {\r\n\r\n};\r\n\r\n// Virtual base class method to overwrite and implement in subclasses\r\n//\t- t [0 .. 1]\r\n\r\nTHREE.Curve.prototype.getPoint = function(t) {\r\n\r\n  THREE.warn(\"THREE.Curve: Warning, getPoint() not implemented!\");\r\n  return null;\r\n\r\n};\r\n\r\n// Get point at relative position in curve according to arc length\r\n// - u [0 .. 1]\r\n\r\nTHREE.Curve.prototype.getPointAt = function(u) {\r\n\r\n  var t = this.getUtoTmapping(u);\r\n  return this.getPoint(t);\r\n\r\n};\r\n\r\n// Get sequence of points using getPoint( t )\r\n\r\nTHREE.Curve.prototype.getPoints = function(divisions) {\r\n\r\n  if (!divisions) divisions = 5;\r\n\r\n  var d, pts = [];\r\n\r\n  for (d = 0; d <= divisions; d++) {\r\n\r\n    pts.push(this.getPoint(d / divisions));\r\n\r\n  }\r\n\r\n  return pts;\r\n\r\n};\r\n\r\n// Get sequence of points using getPointAt( u )\r\n\r\nTHREE.Curve.prototype.getSpacedPoints = function(divisions) {\r\n\r\n  if (!divisions) divisions = 5;\r\n\r\n  var d, pts = [];\r\n\r\n  for (d = 0; d <= divisions; d++) {\r\n\r\n    pts.push(this.getPointAt(d / divisions));\r\n\r\n  }\r\n\r\n  return pts;\r\n\r\n};\r\n\r\n// Get total curve arc length\r\n\r\nTHREE.Curve.prototype.getLength = function() {\r\n\r\n  var lengths = this.getLengths();\r\n  return lengths[lengths.length - 1];\r\n\r\n};\r\n\r\n// Get list of cumulative segment lengths\r\n\r\nTHREE.Curve.prototype.getLengths = function(divisions) {\r\n\r\n  if (!divisions) divisions = (this.__arcLengthDivisions) ? (this.__arcLengthDivisions) : 200;\r\n\r\n  if (this.cacheArcLengths && (this.cacheArcLengths.length == divisions + 1) && !this.needsUpdate) {\r\n\r\n    //console.log( \"cached\", this.cacheArcLengths );\r\n    return this.cacheArcLengths;\r\n\r\n  }\r\n\r\n  this.needsUpdate = false;\r\n\r\n  var cache = [];\r\n  var current, last = this.getPoint(0);\r\n  var p, sum = 0;\r\n\r\n  cache.push(0);\r\n\r\n  for (p = 1; p <= divisions; p++) {\r\n\r\n    current = this.getPoint(p / divisions);\r\n    sum += current.distanceTo(last);\r\n    cache.push(sum);\r\n    last = current;\r\n\r\n  }\r\n\r\n  this.cacheArcLengths = cache;\r\n\r\n  return cache; // { sums: cache, sum:sum }; Sum is in the last element.\r\n\r\n};\r\n\r\n\r\nTHREE.Curve.prototype.updateArcLengths = function() {\r\n  this.needsUpdate = true;\r\n  this.getLengths();\r\n};\r\n\r\n// Given u ( 0 .. 1 ), get a t to find p. This gives you points which are equi distance\r\n\r\nTHREE.Curve.prototype.getUtoTmapping = function(u, distance) {\r\n\r\n  var arcLengths = this.getLengths();\r\n\r\n  var i = 0,\r\n    il = arcLengths.length;\r\n\r\n  var targetArcLength; // The targeted u distance value to get\r\n\r\n  if (distance) {\r\n\r\n    targetArcLength = distance;\r\n\r\n  }\r\n  else {\r\n\r\n    targetArcLength = u * arcLengths[il - 1];\r\n\r\n  }\r\n\r\n  //var time = Date.now();\r\n\r\n  // binary search for the index with largest value smaller than target u distance\r\n\r\n  var low = 0,\r\n    high = il - 1,\r\n    comparison;\r\n\r\n  while (low <= high) {\r\n\r\n    i = Math.floor(low + (high - low) / 2); // less likely to overflow, though probably not issue here, JS doesn't really have integers, all numbers are floats\r\n\r\n    comparison = arcLengths[i] - targetArcLength;\r\n\r\n    if (comparison < 0) {\r\n\r\n      low = i + 1;\r\n\r\n    }\r\n    else if (comparison > 0) {\r\n\r\n      high = i - 1;\r\n\r\n    }\r\n    else {\r\n\r\n      high = i;\r\n      break;\r\n\r\n      // DONE\r\n\r\n    }\r\n\r\n  }\r\n\r\n  i = high;\r\n\r\n  //console.log('b' , i, low, high, Date.now()- time);\r\n\r\n  if (arcLengths[i] == targetArcLength) {\r\n\r\n    var t = i / (il - 1);\r\n    return t;\r\n\r\n  }\r\n\r\n  // we could get finer grain at lengths, or use simple interpolatation between two points\r\n\r\n  var lengthBefore = arcLengths[i];\r\n  var lengthAfter = arcLengths[i + 1];\r\n\r\n  var segmentLength = lengthAfter - lengthBefore;\r\n\r\n  // determine where we are between the 'before' and 'after' points\r\n\r\n  var segmentFraction = (targetArcLength - lengthBefore) / segmentLength;\r\n\r\n  // add that fractional amount to t\r\n\r\n  var t = (i + segmentFraction) / (il - 1);\r\n\r\n  return t;\r\n\r\n};\r\n\r\n// Returns a unit vector tangent at t\r\n// In case any sub curve does not implement its tangent derivation,\r\n// 2 points a small delta apart will be used to find its gradient\r\n// which seems to give a reasonable approximation\r\n\r\nTHREE.Curve.prototype.getTangent = function(t) {\r\n\r\n  var delta = 0.0001;\r\n  var t1 = t - delta;\r\n  var t2 = t + delta;\r\n\r\n  // Capping in case of danger\r\n\r\n  if (t1 < 0) t1 = 0;\r\n  if (t2 > 1) t2 = 1;\r\n\r\n  var pt1 = this.getPoint(t1);\r\n  var pt2 = this.getPoint(t2);\r\n\r\n  var vec = pt2.clone().sub(pt1);\r\n  return vec.normalize();\r\n\r\n};\r\n\r\n\r\nTHREE.Curve.prototype.getTangentAt = function(u) {\r\n\r\n  var t = this.getUtoTmapping(u);\r\n  return this.getTangent(t);\r\n\r\n};\r\n\r\n\r\n\r\n\r\n\r\n/**************************************************************\r\n *\tUtils\r\n **************************************************************/\r\n\r\nTHREE.Curve.Utils = {\r\n\r\n  tangentQuadraticBezier: function(t, p0, p1, p2) {\r\n\r\n    return 2 * (1 - t) * (p1 - p0) + 2 * t * (p2 - p1);\r\n\r\n  },\r\n\r\n  // Puay Bing, thanks for helping with this derivative!\r\n\r\n  tangentCubicBezier: function(t, p0, p1, p2, p3) {\r\n\r\n    return -3 * p0 * (1 - t) * (1 - t) +\r\n      3 * p1 * (1 - t) * (1 - t) - 6 * t * p1 * (1 - t) +\r\n      6 * t * p2 * (1 - t) - 3 * t * t * p2 +\r\n      3 * t * t * p3;\r\n\r\n  },\r\n\r\n  tangentSpline: function(t, p0, p1, p2, p3) {\r\n\r\n    // To check if my formulas are correct\r\n\r\n    var h00 = 6 * t * t - 6 * t; // derived from 2t^3 − 3t^2 + 1\r\n    var h10 = 3 * t * t - 4 * t + 1; // t^3 − 2t^2 + t\r\n    var h01 = -6 * t * t + 6 * t; // − 2t3 + 3t2\r\n    var h11 = 3 * t * t - 2 * t; // t3 − t2\r\n\r\n    return h00 + h10 + h01 + h11;\r\n\r\n  },\r\n\r\n  // Catmull-Rom\r\n\r\n  interpolate: function(p0, p1, p2, p3, t) {\r\n\r\n    var v0 = (p2 - p0) * 0.5;\r\n    var v1 = (p3 - p1) * 0.5;\r\n    var t2 = t * t;\r\n    var t3 = t * t2;\r\n    return (2 * p1 - 2 * p2 + v0 + v1) * t3 + (-3 * p1 + 3 * p2 - 2 * v0 - v1) * t2 + v0 * t + p1;\r\n\r\n  }\r\n\r\n};\r\n\r\n\r\n// TODO: Transformation for Curves?\r\n\r\n/**************************************************************\r\n *\t3D Curves\r\n **************************************************************/\r\n\r\n// A Factory method for creating new curve subclasses\r\n\r\nTHREE.Curve.create = function(constructor, getPointFunc) {\r\n\r\n  constructor.prototype = Object.create(THREE.Curve.prototype);\r\n  constructor.prototype.constructor = constructor;\r\n  constructor.prototype.getPoint = getPointFunc;\r\n\r\n  return constructor;\r\n\r\n};\r\n\r\n// File:src/extras/core/CurvePath.js\r\n\r\n/**\r\n * @author zz85 / http://www.lab4games.net/zz85/blog\r\n *\r\n **/\r\n\r\n/**************************************************************\r\n *\tCurved Path - a curve path is simply a array of connected\r\n *  curves, but retains the api of a curve\r\n **************************************************************/\r\n\r\nTHREE.CurvePath = function() {\r\n\r\n  this.curves = [];\r\n  this.bends = [];\r\n\r\n  this.autoClose = false; // Automatically closes the path\r\n};\r\n\r\nTHREE.CurvePath.prototype = Object.create(THREE.Curve.prototype);\r\nTHREE.CurvePath.prototype.constructor = THREE.CurvePath;\r\n\r\nTHREE.CurvePath.prototype.add = function(curve) {\r\n\r\n  this.curves.push(curve);\r\n\r\n};\r\n\r\nTHREE.CurvePath.prototype.checkConnection = function() {\r\n  // TODO\r\n  // If the ending of curve is not connected to the starting\r\n  // or the next curve, then, this is not a real path\r\n};\r\n\r\nTHREE.CurvePath.prototype.closePath = function() {\r\n  // TODO Test\r\n  // and verify for vector3 (needs to implement equals)\r\n  // Add a line curve if start and end of lines are not connected\r\n  var startPoint = this.curves[0].getPoint(0);\r\n  var endPoint = this.curves[this.curves.length - 1].getPoint(1);\r\n\r\n  if (!startPoint.equals(endPoint)) {\r\n    this.curves.push(new THREE.LineCurve(endPoint, startPoint));\r\n  }\r\n\r\n};\r\n\r\n// To get accurate point with reference to\r\n// entire path distance at time t,\r\n// following has to be done:\r\n\r\n// 1. Length of each sub path have to be known\r\n// 2. Locate and identify type of curve\r\n// 3. Get t for the curve\r\n// 4. Return curve.getPointAt(t')\r\n\r\nTHREE.CurvePath.prototype.getPoint = function(t) {\r\n\r\n  var d = t * this.getLength();\r\n  var curveLengths = this.getCurveLengths();\r\n  var i = 0,\r\n    diff, curve;\r\n\r\n  // To think about boundaries points.\r\n\r\n  while (i < curveLengths.length) {\r\n\r\n    if (curveLengths[i] >= d) {\r\n\r\n      diff = curveLengths[i] - d;\r\n      curve = this.curves[i];\r\n\r\n      var u = 1 - diff / curve.getLength();\r\n\r\n      return curve.getPointAt(u);\r\n\r\n    }\r\n\r\n    i++;\r\n\r\n  }\r\n\r\n  return null;\r\n\r\n  // loop where sum != 0, sum > d , sum+1 <d\r\n\r\n};\r\n\r\n/*\r\nTHREE.CurvePath.prototype.getTangent = function( t ) {\r\n};*/\r\n\r\n\r\n// We cannot use the default THREE.Curve getPoint() with getLength() because in\r\n// THREE.Curve, getLength() depends on getPoint() but in THREE.CurvePath\r\n// getPoint() depends on getLength\r\n\r\nTHREE.CurvePath.prototype.getLength = function() {\r\n\r\n  var lens = this.getCurveLengths();\r\n  return lens[lens.length - 1];\r\n\r\n};\r\n\r\n// Compute lengths and cache them\r\n// We cannot overwrite getLengths() because UtoT mapping uses it.\r\n\r\nTHREE.CurvePath.prototype.getCurveLengths = function() {\r\n\r\n  // We use cache values if curves and cache array are same length\r\n\r\n  if (this.cacheLengths && this.cacheLengths.length == this.curves.length) {\r\n\r\n    return this.cacheLengths;\r\n\r\n  };\r\n\r\n  // Get length of subsurve\r\n  // Push sums into cached array\r\n\r\n  var lengths = [],\r\n    sums = 0;\r\n  var i, il = this.curves.length;\r\n\r\n  for (i = 0; i < il; i++) {\r\n\r\n    sums += this.curves[i].getLength();\r\n    lengths.push(sums);\r\n\r\n  }\r\n\r\n  this.cacheLengths = lengths;\r\n\r\n  return lengths;\r\n\r\n};\r\n\r\n\r\n\r\n// Returns min and max coordinates\r\n\r\nTHREE.CurvePath.prototype.getBoundingBox = function() {\r\n\r\n  var points = this.getPoints();\r\n\r\n  var maxX, maxY, maxZ;\r\n  var minX, minY, minZ;\r\n\r\n  maxX = maxY = Number.NEGATIVE_INFINITY;\r\n  minX = minY = Number.POSITIVE_INFINITY;\r\n\r\n  var p, i, il, sum;\r\n\r\n  var v3 = points[0] instanceof THREE.Vector3;\r\n\r\n  sum = v3 ? new THREE.Vector3() : new THREE.Vector2();\r\n\r\n  for (i = 0, il = points.length; i < il; i++) {\r\n\r\n    p = points[i];\r\n\r\n    if (p.x > maxX) maxX = p.x;\r\n    else if (p.x < minX) minX = p.x;\r\n\r\n    if (p.y > maxY) maxY = p.y;\r\n    else if (p.y < minY) minY = p.y;\r\n\r\n    if (v3) {\r\n\r\n      if (p.z > maxZ) maxZ = p.z;\r\n      else if (p.z < minZ) minZ = p.z;\r\n\r\n    }\r\n\r\n    sum.add(p);\r\n\r\n  }\r\n\r\n  var ret = {\r\n\r\n    minX: minX,\r\n    minY: minY,\r\n    maxX: maxX,\r\n    maxY: maxY\r\n\r\n  };\r\n\r\n  if (v3) {\r\n\r\n    ret.maxZ = maxZ;\r\n    ret.minZ = minZ;\r\n\r\n  }\r\n\r\n  return ret;\r\n\r\n};\r\n\r\n/**************************************************************\r\n *\tCreate Geometries Helpers\r\n **************************************************************/\r\n\r\n/// Generate geometry from path points (for Line or Points objects)\r\n\r\nTHREE.CurvePath.prototype.createPointsGeometry = function(divisions) {\r\n\r\n  var pts = this.getPoints(divisions, true);\r\n  return this.createGeometry(pts);\r\n\r\n};\r\n\r\n// Generate geometry from equidistance sampling along the path\r\n\r\nTHREE.CurvePath.prototype.createSpacedPointsGeometry = function(divisions) {\r\n\r\n  var pts = this.getSpacedPoints(divisions, true);\r\n  return this.createGeometry(pts);\r\n\r\n};\r\n\r\nTHREE.CurvePath.prototype.createGeometry = function(points) {\r\n\r\n  var geometry = new THREE.Geometry();\r\n\r\n  for (var i = 0; i < points.length; i++) {\r\n\r\n    geometry.vertices.push(new THREE.Vector3(points[i].x, points[i].y, points[i].z || 0));\r\n\r\n  }\r\n\r\n  return geometry;\r\n\r\n};\r\n\r\n\r\n/**************************************************************\r\n *\tBend / Wrap Helper Methods\r\n **************************************************************/\r\n\r\n// Wrap path / Bend modifiers?\r\n\r\nTHREE.CurvePath.prototype.addWrapPath = function(bendpath) {\r\n\r\n  this.bends.push(bendpath);\r\n\r\n};\r\n\r\nTHREE.CurvePath.prototype.getTransformedPoints = function(segments, bends) {\r\n\r\n  var oldPts = this.getPoints(segments); // getPoints getSpacedPoints\r\n  var i, il;\r\n\r\n  if (!bends) {\r\n\r\n    bends = this.bends;\r\n\r\n  }\r\n\r\n  for (i = 0, il = bends.length; i < il; i++) {\r\n\r\n    oldPts = this.getWrapPoints(oldPts, bends[i]);\r\n\r\n  }\r\n\r\n  return oldPts;\r\n\r\n};\r\n\r\nTHREE.CurvePath.prototype.getTransformedSpacedPoints = function(segments, bends) {\r\n\r\n  var oldPts = this.getSpacedPoints(segments);\r\n\r\n  var i, il;\r\n\r\n  if (!bends) {\r\n\r\n    bends = this.bends;\r\n\r\n  }\r\n\r\n  for (i = 0, il = bends.length; i < il; i++) {\r\n\r\n    oldPts = this.getWrapPoints(oldPts, bends[i]);\r\n\r\n  }\r\n\r\n  return oldPts;\r\n\r\n};\r\n\r\n// This returns getPoints() bend/wrapped around the contour of a path.\r\n// Read http://www.planetclegg.com/projects/WarpingTextToSplines.html\r\n\r\nTHREE.CurvePath.prototype.getWrapPoints = function(oldPts, path) {\r\n\r\n  var bounds = this.getBoundingBox();\r\n\r\n  var i, il, p, oldX, oldY, xNorm;\r\n\r\n  for (i = 0, il = oldPts.length; i < il; i++) {\r\n\r\n    p = oldPts[i];\r\n\r\n    oldX = p.x;\r\n    oldY = p.y;\r\n\r\n    xNorm = oldX / bounds.maxX;\r\n\r\n    // If using actual distance, for length > path, requires line extrusions\r\n    //xNorm = path.getUtoTmapping(xNorm, oldX); // 3 styles. 1) wrap stretched. 2) wrap stretch by arc length 3) warp by actual distance\r\n\r\n    xNorm = path.getUtoTmapping(xNorm, oldX);\r\n\r\n    // check for out of bounds?\r\n\r\n    var pathPt = path.getPoint(xNorm);\r\n    var normal = path.getTangent(xNorm);\r\n    normal.set(-normal.y, normal.x).multiplyScalar(oldY);\r\n\r\n    p.x = pathPt.x + normal.x;\r\n    p.y = pathPt.y + normal.y;\r\n\r\n  }\r\n\r\n  return oldPts;\r\n\r\n};\r\n\r\n\r\n// File:src/extras/core/Gyroscope.js\r\n\r\n/**\r\n * @author alteredq / http://alteredqualia.com/\r\n */\r\n\r\nTHREE.Gyroscope = function() {\r\n\r\n  THREE.Object3D.call(this);\r\n\r\n};\r\n\r\nTHREE.Gyroscope.prototype = Object.create(THREE.Object3D.prototype);\r\nTHREE.Gyroscope.prototype.constructor = THREE.Gyroscope;\r\n\r\nTHREE.Gyroscope.prototype.updateMatrixWorld = (function() {\r\n\r\n  var translationObject = new THREE.Vector3();\r\n  var quaternionObject = new THREE.Quaternion();\r\n  var scaleObject = new THREE.Vector3();\r\n\r\n  var translationWorld = new THREE.Vector3();\r\n  var quaternionWorld = new THREE.Quaternion();\r\n  var scaleWorld = new THREE.Vector3();\r\n\r\n  return function(force) {\r\n\r\n    this.matrixAutoUpdate && this.updateMatrix();\r\n\r\n    // update matrixWorld\r\n\r\n    if (this.matrixWorldNeedsUpdate || force) {\r\n\r\n      if (this.parent) {\r\n\r\n        this.matrixWorld.multiplyMatrices(this.parent.matrixWorld, this.matrix);\r\n\r\n        this.matrixWorld.decompose(translationWorld, quaternionWorld, scaleWorld);\r\n        this.matrix.decompose(translationObject, quaternionObject, scaleObject);\r\n\r\n        this.matrixWorld.compose(translationWorld, quaternionObject, scaleWorld);\r\n\r\n\r\n      }\r\n      else {\r\n\r\n        this.matrixWorld.copy(this.matrix);\r\n\r\n      }\r\n\r\n\r\n      this.matrixWorldNeedsUpdate = false;\r\n\r\n      force = true;\r\n\r\n    }\r\n\r\n    // update children\r\n\r\n    for (var i = 0, l = this.children.length; i < l; i++) {\r\n\r\n      this.children[i].updateMatrixWorld(force);\r\n\r\n    }\r\n\r\n  };\r\n\r\n}());\r\n\r\n// File:src/extras/core/Path.js\r\n\r\n/**\r\n * @author zz85 / http://www.lab4games.net/zz85/blog\r\n * Creates free form 2d path using series of points, lines or curves.\r\n *\r\n **/\r\n\r\nTHREE.Path = function(points) {\r\n\r\n  THREE.CurvePath.call(this);\r\n\r\n  this.actions = [];\r\n\r\n  if (points) {\r\n\r\n    this.fromPoints(points);\r\n\r\n  }\r\n\r\n};\r\n\r\nTHREE.Path.prototype = Object.create(THREE.CurvePath.prototype);\r\nTHREE.Path.prototype.constructor = THREE.Path;\r\n\r\nTHREE.PathActions = {\r\n\r\n  MOVE_TO: 'moveTo',\r\n  LINE_TO: 'lineTo',\r\n  QUADRATIC_CURVE_TO: 'quadraticCurveTo', // Bezier quadratic curve\r\n  BEZIER_CURVE_TO: 'bezierCurveTo', // Bezier cubic curve\r\n  CSPLINE_THRU: 'splineThru', // Catmull-rom spline\r\n  ARC: 'arc', // Circle\r\n  ELLIPSE: 'ellipse'\r\n};\r\n\r\n// TODO Clean up PATH API\r\n\r\n// Create path using straight lines to connect all points\r\n// - vectors: array of Vector2\r\n\r\nTHREE.Path.prototype.fromPoints = function(vectors) {\r\n\r\n  this.moveTo(vectors[0].x, vectors[0].y);\r\n\r\n  for (var v = 1, vlen = vectors.length; v < vlen; v++) {\r\n\r\n    this.lineTo(vectors[v].x, vectors[v].y);\r\n\r\n  };\r\n\r\n};\r\n\r\n// startPath() endPath()?\r\n\r\nTHREE.Path.prototype.moveTo = function(x, y) {\r\n\r\n  var args = Array.prototype.slice.call(arguments);\r\n  this.actions.push({\r\n    action: THREE.PathActions.MOVE_TO,\r\n    args: args\r\n  });\r\n\r\n};\r\n\r\nTHREE.Path.prototype.lineTo = function(x, y) {\r\n\r\n  var args = Array.prototype.slice.call(arguments);\r\n\r\n  var lastargs = this.actions[this.actions.length - 1].args;\r\n\r\n  var x0 = lastargs[lastargs.length - 2];\r\n  var y0 = lastargs[lastargs.length - 1];\r\n\r\n  var curve = new THREE.LineCurve(new THREE.Vector2(x0, y0), new THREE.Vector2(x, y));\r\n  this.curves.push(curve);\r\n\r\n  this.actions.push({\r\n    action: THREE.PathActions.LINE_TO,\r\n    args: args\r\n  });\r\n\r\n};\r\n\r\nTHREE.Path.prototype.quadraticCurveTo = function(aCPx, aCPy, aX, aY) {\r\n\r\n  var args = Array.prototype.slice.call(arguments);\r\n\r\n  var lastargs = this.actions[this.actions.length - 1].args;\r\n\r\n  var x0 = lastargs[lastargs.length - 2];\r\n  var y0 = lastargs[lastargs.length - 1];\r\n\r\n  var curve = new THREE.QuadraticBezierCurve(new THREE.Vector2(x0, y0),\r\n    new THREE.Vector2(aCPx, aCPy),\r\n    new THREE.Vector2(aX, aY));\r\n  this.curves.push(curve);\r\n\r\n  this.actions.push({\r\n    action: THREE.PathActions.QUADRATIC_CURVE_TO,\r\n    args: args\r\n  });\r\n\r\n};\r\n\r\nTHREE.Path.prototype.bezierCurveTo = function(aCP1x, aCP1y,\r\n  aCP2x, aCP2y,\r\n  aX, aY) {\r\n\r\n  var args = Array.prototype.slice.call(arguments);\r\n\r\n  var lastargs = this.actions[this.actions.length - 1].args;\r\n\r\n  var x0 = lastargs[lastargs.length - 2];\r\n  var y0 = lastargs[lastargs.length - 1];\r\n\r\n  var curve = new THREE.CubicBezierCurve(new THREE.Vector2(x0, y0),\r\n    new THREE.Vector2(aCP1x, aCP1y),\r\n    new THREE.Vector2(aCP2x, aCP2y),\r\n    new THREE.Vector2(aX, aY));\r\n  this.curves.push(curve);\r\n\r\n  this.actions.push({\r\n    action: THREE.PathActions.BEZIER_CURVE_TO,\r\n    args: args\r\n  });\r\n\r\n};\r\n\r\nTHREE.Path.prototype.splineThru = function(pts /*Array of Vector*/ ) {\r\n\r\n  var args = Array.prototype.slice.call(arguments);\r\n  var lastargs = this.actions[this.actions.length - 1].args;\r\n\r\n  var x0 = lastargs[lastargs.length - 2];\r\n  var y0 = lastargs[lastargs.length - 1];\r\n  //---\r\n  var npts = [new THREE.Vector2(x0, y0)];\r\n  Array.prototype.push.apply(npts, pts);\r\n\r\n  var curve = new THREE.SplineCurve(npts);\r\n  this.curves.push(curve);\r\n\r\n  this.actions.push({\r\n    action: THREE.PathActions.CSPLINE_THRU,\r\n    args: args\r\n  });\r\n\r\n};\r\n\r\n// FUTURE: Change the API or follow canvas API?\r\n\r\nTHREE.Path.prototype.arc = function(aX, aY, aRadius,\r\n  aStartAngle, aEndAngle, aClockwise) {\r\n\r\n  var lastargs = this.actions[this.actions.length - 1].args;\r\n  var x0 = lastargs[lastargs.length - 2];\r\n  var y0 = lastargs[lastargs.length - 1];\r\n\r\n  this.absarc(aX + x0, aY + y0, aRadius,\r\n    aStartAngle, aEndAngle, aClockwise);\r\n\r\n};\r\n\r\nTHREE.Path.prototype.absarc = function(aX, aY, aRadius,\r\n  aStartAngle, aEndAngle, aClockwise) {\r\n  this.absellipse(aX, aY, aRadius, aRadius, aStartAngle, aEndAngle, aClockwise);\r\n};\r\n\r\nTHREE.Path.prototype.ellipse = function(aX, aY, xRadius, yRadius,\r\n  aStartAngle, aEndAngle, aClockwise) {\r\n\r\n  var lastargs = this.actions[this.actions.length - 1].args;\r\n  var x0 = lastargs[lastargs.length - 2];\r\n  var y0 = lastargs[lastargs.length - 1];\r\n\r\n  this.absellipse(aX + x0, aY + y0, xRadius, yRadius,\r\n    aStartAngle, aEndAngle, aClockwise);\r\n\r\n};\r\n\r\n\r\nTHREE.Path.prototype.absellipse = function(aX, aY, xRadius, yRadius,\r\n  aStartAngle, aEndAngle, aClockwise) {\r\n\r\n  var args = Array.prototype.slice.call(arguments);\r\n  var curve = new THREE.EllipseCurve(aX, aY, xRadius, yRadius,\r\n    aStartAngle, aEndAngle, aClockwise);\r\n  this.curves.push(curve);\r\n\r\n  var lastPoint = curve.getPoint(1);\r\n  args.push(lastPoint.x);\r\n  args.push(lastPoint.y);\r\n\r\n  this.actions.push({\r\n    action: THREE.PathActions.ELLIPSE,\r\n    args: args\r\n  });\r\n\r\n};\r\n\r\nTHREE.Path.prototype.getSpacedPoints = function(divisions, closedPath) {\r\n\r\n  if (!divisions) divisions = 40;\r\n\r\n  var points = [];\r\n\r\n  for (var i = 0; i < divisions; i++) {\r\n\r\n    points.push(this.getPoint(i / divisions));\r\n\r\n    //if( !this.getPoint( i / divisions ) ) throw \"DIE\";\r\n\r\n  }\r\n\r\n  // if ( closedPath ) {\r\n  //\r\n  // \tpoints.push( points[ 0 ] );\r\n  //\r\n  // }\r\n\r\n  return points;\r\n\r\n};\r\n\r\n/* Return an array of vectors based on contour of the path */\r\n\r\nTHREE.Path.prototype.getPoints = function(divisions, closedPath) {\r\n\r\n  if (this.useSpacedPoints) {\r\n    console.log('tata');\r\n    return this.getSpacedPoints(divisions, closedPath);\r\n  }\r\n\r\n  divisions = divisions || 12;\r\n\r\n  var points = [];\r\n\r\n  var i, il, item, action, args;\r\n  var cpx, cpy, cpx2, cpy2, cpx1, cpy1, cpx0, cpy0,\r\n    laste, j,\r\n    t, tx, ty;\r\n\r\n  for (i = 0, il = this.actions.length; i < il; i++) {\r\n\r\n    item = this.actions[i];\r\n\r\n    action = item.action;\r\n    args = item.args;\r\n\r\n    switch (action) {\r\n\r\n      case THREE.PathActions.MOVE_TO:\r\n\r\n        points.push(new THREE.Vector2(args[0], args[1]));\r\n\r\n        break;\r\n\r\n      case THREE.PathActions.LINE_TO:\r\n\r\n        points.push(new THREE.Vector2(args[0], args[1]));\r\n\r\n        break;\r\n\r\n      case THREE.PathActions.QUADRATIC_CURVE_TO:\r\n\r\n        cpx = args[2];\r\n        cpy = args[3];\r\n\r\n        cpx1 = args[0];\r\n        cpy1 = args[1];\r\n\r\n        if (points.length > 0) {\r\n\r\n          laste = points[points.length - 1];\r\n\r\n          cpx0 = laste.x;\r\n          cpy0 = laste.y;\r\n\r\n        }\r\n        else {\r\n\r\n          laste = this.actions[i - 1].args;\r\n\r\n          cpx0 = laste[laste.length - 2];\r\n          cpy0 = laste[laste.length - 1];\r\n\r\n        }\r\n\r\n        for (j = 1; j <= divisions; j++) {\r\n\r\n          t = j / divisions;\r\n\r\n          tx = THREE.Shape.Utils.b2(t, cpx0, cpx1, cpx);\r\n          ty = THREE.Shape.Utils.b2(t, cpy0, cpy1, cpy);\r\n\r\n          points.push(new THREE.Vector2(tx, ty));\r\n\r\n        }\r\n\r\n        break;\r\n\r\n      case THREE.PathActions.BEZIER_CURVE_TO:\r\n\r\n        cpx = args[4];\r\n        cpy = args[5];\r\n\r\n        cpx1 = args[0];\r\n        cpy1 = args[1];\r\n\r\n        cpx2 = args[2];\r\n        cpy2 = args[3];\r\n\r\n        if (points.length > 0) {\r\n\r\n          laste = points[points.length - 1];\r\n\r\n          cpx0 = laste.x;\r\n          cpy0 = laste.y;\r\n\r\n        }\r\n        else {\r\n\r\n          laste = this.actions[i - 1].args;\r\n\r\n          cpx0 = laste[laste.length - 2];\r\n          cpy0 = laste[laste.length - 1];\r\n\r\n        }\r\n\r\n\r\n        for (j = 1; j <= divisions; j++) {\r\n\r\n          t = j / divisions;\r\n\r\n          tx = THREE.Shape.Utils.b3(t, cpx0, cpx1, cpx2, cpx);\r\n          ty = THREE.Shape.Utils.b3(t, cpy0, cpy1, cpy2, cpy);\r\n\r\n          points.push(new THREE.Vector2(tx, ty));\r\n\r\n        }\r\n\r\n        break;\r\n\r\n      case THREE.PathActions.CSPLINE_THRU:\r\n\r\n        laste = this.actions[i - 1].args;\r\n\r\n        var last = new THREE.Vector2(laste[laste.length - 2], laste[laste.length - 1]);\r\n        var spts = [last];\r\n\r\n        var n = divisions * args[0].length;\r\n\r\n        spts = spts.concat(args[0]);\r\n\r\n        var spline = new THREE.SplineCurve(spts);\r\n\r\n        for (j = 1; j <= n; j++) {\r\n\r\n          points.push(spline.getPointAt(j / n));\r\n\r\n        }\r\n\r\n        break;\r\n\r\n      case THREE.PathActions.ARC:\r\n\r\n        var aX = args[0],\r\n          aY = args[1],\r\n          aRadius = args[2],\r\n          aStartAngle = args[3],\r\n          aEndAngle = args[4],\r\n          aClockwise = !!args[5];\r\n\r\n        var deltaAngle = aEndAngle - aStartAngle;\r\n        var angle;\r\n        var tdivisions = divisions * 2;\r\n\r\n        for (j = 1; j <= tdivisions; j++) {\r\n\r\n          t = j / tdivisions;\r\n\r\n          if (!aClockwise) {\r\n\r\n            t = 1 - t;\r\n\r\n          }\r\n\r\n          angle = aStartAngle + t * deltaAngle;\r\n\r\n          tx = aX + aRadius * Math.cos(angle);\r\n          ty = aY + aRadius * Math.sin(angle);\r\n\r\n          //console.log('t', t, 'angle', angle, 'tx', tx, 'ty', ty);\r\n\r\n          points.push(new THREE.Vector2(tx, ty));\r\n\r\n        }\r\n\r\n        //console.log(points);\r\n\r\n        break;\r\n\r\n      case THREE.PathActions.ELLIPSE:\r\n\r\n        var aX = args[0],\r\n          aY = args[1],\r\n          xRadius = args[2],\r\n          yRadius = args[3],\r\n          aStartAngle = args[4],\r\n          aEndAngle = args[5],\r\n          aClockwise = !!args[6];\r\n\r\n\r\n        var deltaAngle = aEndAngle - aStartAngle;\r\n        var angle;\r\n        var tdivisions = divisions * 2;\r\n\r\n        for (j = 1; j <= tdivisions; j++) {\r\n\r\n          t = j / tdivisions;\r\n\r\n          if (!aClockwise) {\r\n\r\n            t = 1 - t;\r\n\r\n          }\r\n\r\n          angle = aStartAngle + t * deltaAngle;\r\n\r\n          tx = aX + xRadius * Math.cos(angle);\r\n          ty = aY + yRadius * Math.sin(angle);\r\n\r\n          //console.log('t', t, 'angle', angle, 'tx', tx, 'ty', ty);\r\n\r\n          points.push(new THREE.Vector2(tx, ty));\r\n\r\n        }\r\n\r\n        //console.log(points);\r\n\r\n        break;\r\n\r\n    } // end switch\r\n\r\n  }\r\n\r\n\r\n\r\n  // Normalize to remove the closing point by default.\r\n  var lastPoint = points[points.length - 1];\r\n  var EPSILON = 0.0000000001;\r\n  if (Math.abs(lastPoint.x - points[0].x) < EPSILON &&\r\n    Math.abs(lastPoint.y - points[0].y) < EPSILON)\r\n    points.splice(points.length - 1, 1);\r\n  if (closedPath) {\r\n\r\n    points.push(points[0]);\r\n\r\n  }\r\n\r\n  return points;\r\n\r\n};\r\n\r\n//\r\n// Breaks path into shapes\r\n//\r\n//\tAssumptions (if parameter isCCW==true the opposite holds):\r\n//\t- solid shapes are defined clockwise (CW)\r\n//\t- holes are defined counterclockwise (CCW)\r\n//\r\n//\tIf parameter noHoles==true:\r\n//  - all subPaths are regarded as solid shapes\r\n//  - definition order CW/CCW has no relevance\r\n//\r\n\r\nTHREE.Path.prototype.toShapes = function(isCCW, noHoles) {\r\n\r\n  function extractSubpaths(inActions) {\r\n\r\n    var i, il, item, action, args;\r\n\r\n    var subPaths = [],\r\n      lastPath = new THREE.Path();\r\n\r\n    for (i = 0, il = inActions.length; i < il; i++) {\r\n\r\n      item = inActions[i];\r\n\r\n      args = item.args;\r\n      action = item.action;\r\n\r\n      if (action == THREE.PathActions.MOVE_TO) {\r\n\r\n        if (lastPath.actions.length != 0) {\r\n\r\n          subPaths.push(lastPath);\r\n          lastPath = new THREE.Path();\r\n\r\n        }\r\n\r\n      }\r\n\r\n      lastPath[action].apply(lastPath, args);\r\n\r\n    }\r\n\r\n    if (lastPath.actions.length != 0) {\r\n\r\n      subPaths.push(lastPath);\r\n\r\n    }\r\n\r\n    // console.log(subPaths);\r\n\r\n    return subPaths;\r\n  }\r\n\r\n  function toShapesNoHoles(inSubpaths) {\r\n\r\n    var shapes = [];\r\n\r\n    for (var i = 0, il = inSubpaths.length; i < il; i++) {\r\n\r\n      var tmpPath = inSubpaths[i];\r\n\r\n      var tmpShape = new THREE.Shape();\r\n      tmpShape.actions = tmpPath.actions;\r\n      tmpShape.curves = tmpPath.curves;\r\n\r\n      shapes.push(tmpShape);\r\n    }\r\n\r\n    //console.log(\"shape\", shapes);\r\n\r\n    return shapes;\r\n  };\r\n\r\n  function isPointInsidePolygon(inPt, inPolygon) {\r\n    var EPSILON = 0.0000000001;\r\n\r\n    var polyLen = inPolygon.length;\r\n\r\n    // inPt on polygon contour => immediate success    or\r\n    // toggling of inside/outside at every single! intersection point of an edge\r\n    //  with the horizontal line through inPt, left of inPt\r\n    //  not counting lowerY endpoints of edges and whole edges on that line\r\n    var inside = false;\r\n    for (var p = polyLen - 1, q = 0; q < polyLen; p = q++) {\r\n      var edgeLowPt = inPolygon[p];\r\n      var edgeHighPt = inPolygon[q];\r\n\r\n      var edgeDx = edgeHighPt.x - edgeLowPt.x;\r\n      var edgeDy = edgeHighPt.y - edgeLowPt.y;\r\n\r\n      if (Math.abs(edgeDy) > EPSILON) { // not parallel\r\n        if (edgeDy < 0) {\r\n          edgeLowPt = inPolygon[q];\r\n          edgeDx = -edgeDx;\r\n          edgeHighPt = inPolygon[p];\r\n          edgeDy = -edgeDy;\r\n        }\r\n        if ((inPt.y < edgeLowPt.y) || (inPt.y > edgeHighPt.y)) continue;\r\n\r\n        if (inPt.y == edgeLowPt.y) {\r\n          if (inPt.x == edgeLowPt.x) return true; // inPt is on contour ?\r\n          // continue;\t\t\t\t// no intersection or edgeLowPt => doesn't count !!!\r\n        }\r\n        else {\r\n          var perpEdge = edgeDy * (inPt.x - edgeLowPt.x) - edgeDx * (inPt.y - edgeLowPt.y);\r\n          if (perpEdge == 0) return true; // inPt is on contour ?\r\n          if (perpEdge < 0) continue;\r\n          inside = !inside; // true intersection left of inPt\r\n        }\r\n      }\r\n      else { // parallel or colinear\r\n        if (inPt.y != edgeLowPt.y) continue; // parallel\r\n        // egde lies on the same horizontal line as inPt\r\n        if (((edgeHighPt.x <= inPt.x) && (inPt.x <= edgeLowPt.x)) ||\r\n          ((edgeLowPt.x <= inPt.x) && (inPt.x <= edgeHighPt.x))) return true; // inPt: Point on contour !\r\n        // continue;\r\n      }\r\n    }\r\n\r\n    return inside;\r\n  }\r\n\r\n\r\n  var subPaths = extractSubpaths(this.actions);\r\n  if (subPaths.length == 0) return [];\r\n\r\n  if (noHoles === true) return toShapesNoHoles(subPaths);\r\n\r\n\r\n  var solid, tmpPath, tmpShape, shapes = [];\r\n\r\n  if (subPaths.length == 1) {\r\n\r\n    tmpPath = subPaths[0];\r\n    tmpShape = new THREE.Shape();\r\n    tmpShape.actions = tmpPath.actions;\r\n    tmpShape.curves = tmpPath.curves;\r\n    shapes.push(tmpShape);\r\n    return shapes;\r\n\r\n  }\r\n\r\n  var holesFirst = !THREE.Shape.Utils.isClockWise(subPaths[0].getPoints());\r\n  holesFirst = isCCW ? !holesFirst : holesFirst;\r\n\r\n  // console.log(\"Holes first\", holesFirst);\r\n\r\n  var betterShapeHoles = [];\r\n  var newShapes = [];\r\n  var newShapeHoles = [];\r\n  var mainIdx = 0;\r\n  var tmpPoints;\r\n\r\n  newShapes[mainIdx] = undefined;\r\n  newShapeHoles[mainIdx] = [];\r\n\r\n  var i, il;\r\n\r\n  for (i = 0, il = subPaths.length; i < il; i++) {\r\n\r\n    tmpPath = subPaths[i];\r\n    tmpPoints = tmpPath.getPoints();\r\n    solid = THREE.Shape.Utils.isClockWise(tmpPoints);\r\n    solid = isCCW ? !solid : solid;\r\n\r\n    if (solid) {\r\n\r\n      if ((!holesFirst) && (newShapes[mainIdx])) mainIdx++;\r\n\r\n      newShapes[mainIdx] = {\r\n        s: new THREE.Shape(),\r\n        p: tmpPoints\r\n      };\r\n      newShapes[mainIdx].s.actions = tmpPath.actions;\r\n      newShapes[mainIdx].s.curves = tmpPath.curves;\r\n\r\n      if (holesFirst) mainIdx++;\r\n      newShapeHoles[mainIdx] = [];\r\n\r\n      //console.log('cw', i);\r\n\r\n    }\r\n    else {\r\n\r\n      newShapeHoles[mainIdx].push({\r\n        h: tmpPath,\r\n        p: tmpPoints[0]\r\n      });\r\n\r\n      //console.log('ccw', i);\r\n\r\n    }\r\n\r\n  }\r\n\r\n  // only Holes? -> probably all Shapes with wrong orientation\r\n  if (!newShapes[0]) return toShapesNoHoles(subPaths);\r\n\r\n\r\n  if (newShapes.length > 1) {\r\n    var ambigious = false;\r\n    var toChange = [];\r\n\r\n    for (var sIdx = 0, sLen = newShapes.length; sIdx < sLen; sIdx++) {\r\n      betterShapeHoles[sIdx] = [];\r\n    }\r\n    for (var sIdx = 0, sLen = newShapes.length; sIdx < sLen; sIdx++) {\r\n      var sho = newShapeHoles[sIdx];\r\n      for (var hIdx = 0; hIdx < sho.length; hIdx++) {\r\n        var ho = sho[hIdx];\r\n        var hole_unassigned = true;\r\n        for (var s2Idx = 0; s2Idx < newShapes.length; s2Idx++) {\r\n          if (isPointInsidePolygon(ho.p, newShapes[s2Idx].p)) {\r\n            if (sIdx != s2Idx) toChange.push({\r\n              froms: sIdx,\r\n              tos: s2Idx,\r\n              hole: hIdx\r\n            });\r\n            if (hole_unassigned) {\r\n              hole_unassigned = false;\r\n              betterShapeHoles[s2Idx].push(ho);\r\n            }\r\n            else {\r\n              ambigious = true;\r\n            }\r\n          }\r\n        }\r\n        if (hole_unassigned) {\r\n          betterShapeHoles[sIdx].push(ho);\r\n        }\r\n      }\r\n    }\r\n    // console.log(\"ambigious: \", ambigious);\r\n    if (toChange.length > 0) {\r\n      // console.log(\"to change: \", toChange);\r\n      if (!ambigious) newShapeHoles = betterShapeHoles;\r\n    }\r\n  }\r\n\r\n  var tmpHoles, j, jl;\r\n  for (i = 0, il = newShapes.length; i < il; i++) {\r\n    tmpShape = newShapes[i].s;\r\n    shapes.push(tmpShape);\r\n    tmpHoles = newShapeHoles[i];\r\n    for (j = 0, jl = tmpHoles.length; j < jl; j++) {\r\n      tmpShape.holes.push(tmpHoles[j].h);\r\n    }\r\n  }\r\n\r\n  //console.log(\"shape\", shapes);\r\n\r\n  return shapes;\r\n\r\n};\r\n\r\n// File:src/extras/core/Shape.js\r\n\r\n/**\r\n * @author zz85 / http://www.lab4games.net/zz85/blog\r\n * Defines a 2d shape plane using paths.\r\n **/\r\n\r\n// STEP 1 Create a path.\r\n// STEP 2 Turn path into shape.\r\n// STEP 3 ExtrudeGeometry takes in Shape/Shapes\r\n// STEP 3a - Extract points from each shape, turn to vertices\r\n// STEP 3b - Triangulate each shape, add faces.\r\n\r\nTHREE.Shape = function() {\r\n\r\n  THREE.Path.apply(this, arguments);\r\n  this.holes = [];\r\n\r\n};\r\n\r\nTHREE.Shape.prototype = Object.create(THREE.Path.prototype);\r\nTHREE.Shape.prototype.constructor = THREE.Shape;\r\n\r\n// Convenience method to return ExtrudeGeometry\r\n\r\nTHREE.Shape.prototype.extrude = function(options) {\r\n\r\n  var extruded = new THREE.ExtrudeGeometry(this, options);\r\n  return extruded;\r\n\r\n};\r\n\r\n// Convenience method to return ShapeGeometry\r\n\r\nTHREE.Shape.prototype.makeGeometry = function(options) {\r\n\r\n  var geometry = new THREE.ShapeGeometry(this, options);\r\n  return geometry;\r\n\r\n};\r\n\r\n// Get points of holes\r\n\r\nTHREE.Shape.prototype.getPointsHoles = function(divisions) {\r\n\r\n  var i, il = this.holes.length,\r\n    holesPts = [];\r\n\r\n  for (i = 0; i < il; i++) {\r\n\r\n    holesPts[i] = this.holes[i].getTransformedPoints(divisions, this.bends);\r\n\r\n  }\r\n\r\n  return holesPts;\r\n\r\n};\r\n\r\n// Get points of holes (spaced by regular distance)\r\n\r\nTHREE.Shape.prototype.getSpacedPointsHoles = function(divisions) {\r\n\r\n  var i, il = this.holes.length,\r\n    holesPts = [];\r\n\r\n  for (i = 0; i < il; i++) {\r\n\r\n    holesPts[i] = this.holes[i].getTransformedSpacedPoints(divisions, this.bends);\r\n\r\n  }\r\n\r\n  return holesPts;\r\n\r\n};\r\n\r\n\r\n// Get points of shape and holes (keypoints based on segments parameter)\r\n\r\nTHREE.Shape.prototype.extractAllPoints = function(divisions) {\r\n\r\n  return {\r\n\r\n    shape: this.getTransformedPoints(divisions),\r\n    holes: this.getPointsHoles(divisions)\r\n\r\n  };\r\n\r\n};\r\n\r\nTHREE.Shape.prototype.extractPoints = function(divisions) {\r\n\r\n  if (this.useSpacedPoints) {\r\n    return this.extractAllSpacedPoints(divisions);\r\n  }\r\n\r\n  return this.extractAllPoints(divisions);\r\n\r\n};\r\n\r\n//\r\n// THREE.Shape.prototype.extractAllPointsWithBend = function ( divisions, bend ) {\r\n//\r\n// \treturn {\r\n//\r\n// \t\tshape: this.transform( bend, divisions ),\r\n// \t\tholes: this.getPointsHoles( divisions, bend )\r\n//\r\n// \t};\r\n//\r\n// };\r\n\r\n// Get points of shape and holes (spaced by regular distance)\r\n\r\nTHREE.Shape.prototype.extractAllSpacedPoints = function(divisions) {\r\n\r\n  return {\r\n\r\n    shape: this.getTransformedSpacedPoints(divisions),\r\n    holes: this.getSpacedPointsHoles(divisions)\r\n\r\n  };\r\n\r\n};\r\n\r\n/**************************************************************\r\n *\tUtils\r\n **************************************************************/\r\n\r\nTHREE.Shape.Utils = {\r\n\r\n  triangulateShape: function(contour, holes) {\r\n\r\n    function point_in_segment_2D_colin(inSegPt1, inSegPt2, inOtherPt) {\r\n      // inOtherPt needs to be colinear to the inSegment\r\n      if (inSegPt1.x != inSegPt2.x) {\r\n        if (inSegPt1.x < inSegPt2.x) {\r\n          return ((inSegPt1.x <= inOtherPt.x) && (inOtherPt.x <= inSegPt2.x));\r\n        }\r\n        else {\r\n          return ((inSegPt2.x <= inOtherPt.x) && (inOtherPt.x <= inSegPt1.x));\r\n        }\r\n      }\r\n      else {\r\n        if (inSegPt1.y < inSegPt2.y) {\r\n          return ((inSegPt1.y <= inOtherPt.y) && (inOtherPt.y <= inSegPt2.y));\r\n        }\r\n        else {\r\n          return ((inSegPt2.y <= inOtherPt.y) && (inOtherPt.y <= inSegPt1.y));\r\n        }\r\n      }\r\n    }\r\n\r\n    function intersect_segments_2D(inSeg1Pt1, inSeg1Pt2, inSeg2Pt1, inSeg2Pt2, inExcludeAdjacentSegs) {\r\n      var EPSILON = 0.0000000001;\r\n\r\n      var seg1dx = inSeg1Pt2.x - inSeg1Pt1.x,\r\n        seg1dy = inSeg1Pt2.y - inSeg1Pt1.y;\r\n      var seg2dx = inSeg2Pt2.x - inSeg2Pt1.x,\r\n        seg2dy = inSeg2Pt2.y - inSeg2Pt1.y;\r\n\r\n      var seg1seg2dx = inSeg1Pt1.x - inSeg2Pt1.x;\r\n      var seg1seg2dy = inSeg1Pt1.y - inSeg2Pt1.y;\r\n\r\n      var limit = seg1dy * seg2dx - seg1dx * seg2dy;\r\n      var perpSeg1 = seg1dy * seg1seg2dx - seg1dx * seg1seg2dy;\r\n\r\n      if (Math.abs(limit) > EPSILON) { // not parallel\r\n\r\n        var perpSeg2;\r\n        if (limit > 0) {\r\n          if ((perpSeg1 < 0) || (perpSeg1 > limit)) return [];\r\n          perpSeg2 = seg2dy * seg1seg2dx - seg2dx * seg1seg2dy;\r\n          if ((perpSeg2 < 0) || (perpSeg2 > limit)) return [];\r\n        }\r\n        else {\r\n          if ((perpSeg1 > 0) || (perpSeg1 < limit)) return [];\r\n          perpSeg2 = seg2dy * seg1seg2dx - seg2dx * seg1seg2dy;\r\n          if ((perpSeg2 > 0) || (perpSeg2 < limit)) return [];\r\n        }\r\n\r\n        // i.e. to reduce rounding errors\r\n        // intersection at endpoint of segment#1?\r\n        if (perpSeg2 == 0) {\r\n          if ((inExcludeAdjacentSegs) &&\r\n            ((perpSeg1 == 0) || (perpSeg1 == limit))) return [];\r\n          return [inSeg1Pt1];\r\n        }\r\n        if (perpSeg2 == limit) {\r\n          if ((inExcludeAdjacentSegs) &&\r\n            ((perpSeg1 == 0) || (perpSeg1 == limit))) return [];\r\n          return [inSeg1Pt2];\r\n        }\r\n        // intersection at endpoint of segment#2?\r\n        if (perpSeg1 == 0) return [inSeg2Pt1];\r\n        if (perpSeg1 == limit) return [inSeg2Pt2];\r\n\r\n        // return real intersection point\r\n        var factorSeg1 = perpSeg2 / limit;\r\n        return [{\r\n          x: inSeg1Pt1.x + factorSeg1 * seg1dx,\r\n          y: inSeg1Pt1.y + factorSeg1 * seg1dy\r\n        }];\r\n\r\n      }\r\n      else { // parallel or colinear\r\n        if ((perpSeg1 != 0) ||\r\n          (seg2dy * seg1seg2dx != seg2dx * seg1seg2dy)) return [];\r\n\r\n        // they are collinear or degenerate\r\n        var seg1Pt = ((seg1dx == 0) && (seg1dy == 0)); // segment1 ist just a point?\r\n        var seg2Pt = ((seg2dx == 0) && (seg2dy == 0)); // segment2 ist just a point?\r\n        // both segments are points\r\n        if (seg1Pt && seg2Pt) {\r\n          if ((inSeg1Pt1.x != inSeg2Pt1.x) ||\r\n            (inSeg1Pt1.y != inSeg2Pt1.y)) return []; // they are distinct  points\r\n          return [inSeg1Pt1]; // they are the same point\r\n        }\r\n        // segment#1  is a single point\r\n        if (seg1Pt) {\r\n          if (!point_in_segment_2D_colin(inSeg2Pt1, inSeg2Pt2, inSeg1Pt1)) return []; // but not in segment#2\r\n          return [inSeg1Pt1];\r\n        }\r\n        // segment#2  is a single point\r\n        if (seg2Pt) {\r\n          if (!point_in_segment_2D_colin(inSeg1Pt1, inSeg1Pt2, inSeg2Pt1)) return []; // but not in segment#1\r\n          return [inSeg2Pt1];\r\n        }\r\n\r\n        // they are collinear segments, which might overlap\r\n        var seg1min, seg1max, seg1minVal, seg1maxVal;\r\n        var seg2min, seg2max, seg2minVal, seg2maxVal;\r\n        if (seg1dx != 0) { // the segments are NOT on a vertical line\r\n          if (inSeg1Pt1.x < inSeg1Pt2.x) {\r\n            seg1min = inSeg1Pt1;\r\n            seg1minVal = inSeg1Pt1.x;\r\n            seg1max = inSeg1Pt2;\r\n            seg1maxVal = inSeg1Pt2.x;\r\n          }\r\n          else {\r\n            seg1min = inSeg1Pt2;\r\n            seg1minVal = inSeg1Pt2.x;\r\n            seg1max = inSeg1Pt1;\r\n            seg1maxVal = inSeg1Pt1.x;\r\n          }\r\n          if (inSeg2Pt1.x < inSeg2Pt2.x) {\r\n            seg2min = inSeg2Pt1;\r\n            seg2minVal = inSeg2Pt1.x;\r\n            seg2max = inSeg2Pt2;\r\n            seg2maxVal = inSeg2Pt2.x;\r\n          }\r\n          else {\r\n            seg2min = inSeg2Pt2;\r\n            seg2minVal = inSeg2Pt2.x;\r\n            seg2max = inSeg2Pt1;\r\n            seg2maxVal = inSeg2Pt1.x;\r\n          }\r\n        }\r\n        else { // the segments are on a vertical line\r\n          if (inSeg1Pt1.y < inSeg1Pt2.y) {\r\n            seg1min = inSeg1Pt1;\r\n            seg1minVal = inSeg1Pt1.y;\r\n            seg1max = inSeg1Pt2;\r\n            seg1maxVal = inSeg1Pt2.y;\r\n          }\r\n          else {\r\n            seg1min = inSeg1Pt2;\r\n            seg1minVal = inSeg1Pt2.y;\r\n            seg1max = inSeg1Pt1;\r\n            seg1maxVal = inSeg1Pt1.y;\r\n          }\r\n          if (inSeg2Pt1.y < inSeg2Pt2.y) {\r\n            seg2min = inSeg2Pt1;\r\n            seg2minVal = inSeg2Pt1.y;\r\n            seg2max = inSeg2Pt2;\r\n            seg2maxVal = inSeg2Pt2.y;\r\n          }\r\n          else {\r\n            seg2min = inSeg2Pt2;\r\n            seg2minVal = inSeg2Pt2.y;\r\n            seg2max = inSeg2Pt1;\r\n            seg2maxVal = inSeg2Pt1.y;\r\n          }\r\n        }\r\n        if (seg1minVal <= seg2minVal) {\r\n          if (seg1maxVal < seg2minVal) return [];\r\n          if (seg1maxVal == seg2minVal) {\r\n            if (inExcludeAdjacentSegs) return [];\r\n            return [seg2min];\r\n          }\r\n          if (seg1maxVal <= seg2maxVal) return [seg2min, seg1max];\r\n          return [seg2min, seg2max];\r\n        }\r\n        else {\r\n          if (seg1minVal > seg2maxVal) return [];\r\n          if (seg1minVal == seg2maxVal) {\r\n            if (inExcludeAdjacentSegs) return [];\r\n            return [seg1min];\r\n          }\r\n          if (seg1maxVal <= seg2maxVal) return [seg1min, seg1max];\r\n          return [seg1min, seg2max];\r\n        }\r\n      }\r\n    }\r\n\r\n    function isPointInsideAngle(inVertex, inLegFromPt, inLegToPt, inOtherPt) {\r\n      // The order of legs is important\r\n\r\n      var EPSILON = 0.0000000001;\r\n\r\n      // translation of all points, so that Vertex is at (0,0)\r\n      var legFromPtX = inLegFromPt.x - inVertex.x,\r\n        legFromPtY = inLegFromPt.y - inVertex.y;\r\n      var legToPtX = inLegToPt.x - inVertex.x,\r\n        legToPtY = inLegToPt.y - inVertex.y;\r\n      var otherPtX = inOtherPt.x - inVertex.x,\r\n        otherPtY = inOtherPt.y - inVertex.y;\r\n\r\n      // main angle >0: < 180 deg.; 0: 180 deg.; <0: > 180 deg.\r\n      var from2toAngle = legFromPtX * legToPtY - legFromPtY * legToPtX;\r\n      var from2otherAngle = legFromPtX * otherPtY - legFromPtY * otherPtX;\r\n\r\n      if (Math.abs(from2toAngle) > EPSILON) { // angle != 180 deg.\r\n\r\n        var other2toAngle = otherPtX * legToPtY - otherPtY * legToPtX;\r\n        // console.log( \"from2to: \" + from2toAngle + \", from2other: \" + from2otherAngle + \", other2to: \" + other2toAngle );\r\n\r\n        if (from2toAngle > 0) { // main angle < 180 deg.\r\n          return ((from2otherAngle >= 0) && (other2toAngle >= 0));\r\n        }\r\n        else { // main angle > 180 deg.\r\n          return ((from2otherAngle >= 0) || (other2toAngle >= 0));\r\n        }\r\n      }\r\n      else { // angle == 180 deg.\r\n        // console.log( \"from2to: 180 deg., from2other: \" + from2otherAngle  );\r\n        return (from2otherAngle > 0);\r\n      }\r\n    }\r\n\r\n\r\n    function removeHoles(contour, holes) {\r\n\r\n      var shape = contour.concat(); // work on this shape\r\n      var hole;\r\n\r\n      function isCutLineInsideAngles(inShapeIdx, inHoleIdx) {\r\n        // Check if hole point lies within angle around shape point\r\n        var lastShapeIdx = shape.length - 1;\r\n\r\n        var prevShapeIdx = inShapeIdx - 1;\r\n        if (prevShapeIdx < 0) prevShapeIdx = lastShapeIdx;\r\n\r\n        var nextShapeIdx = inShapeIdx + 1;\r\n        if (nextShapeIdx > lastShapeIdx) nextShapeIdx = 0;\r\n\r\n        var insideAngle = isPointInsideAngle(shape[inShapeIdx], shape[prevShapeIdx], shape[nextShapeIdx], hole[inHoleIdx]);\r\n        if (!insideAngle) {\r\n          // console.log( \"Vertex (Shape): \" + inShapeIdx + \", Point: \" + hole[inHoleIdx].x + \"/\" + hole[inHoleIdx].y );\r\n          return false;\r\n        }\r\n\r\n        // Check if shape point lies within angle around hole point\r\n        var lastHoleIdx = hole.length - 1;\r\n\r\n        var prevHoleIdx = inHoleIdx - 1;\r\n        if (prevHoleIdx < 0) prevHoleIdx = lastHoleIdx;\r\n\r\n        var nextHoleIdx = inHoleIdx + 1;\r\n        if (nextHoleIdx > lastHoleIdx) nextHoleIdx = 0;\r\n\r\n        insideAngle = isPointInsideAngle(hole[inHoleIdx], hole[prevHoleIdx], hole[nextHoleIdx], shape[inShapeIdx]);\r\n        if (!insideAngle) {\r\n          // console.log( \"Vertex (Hole): \" + inHoleIdx + \", Point: \" + shape[inShapeIdx].x + \"/\" + shape[inShapeIdx].y );\r\n          return false;\r\n        }\r\n\r\n        return true;\r\n      }\r\n\r\n      function intersectsShapeEdge(inShapePt, inHolePt) {\r\n        // checks for intersections with shape edges\r\n        var sIdx, nextIdx, intersection;\r\n        for (sIdx = 0; sIdx < shape.length; sIdx++) {\r\n          nextIdx = sIdx + 1;\r\n          nextIdx %= shape.length;\r\n          intersection = intersect_segments_2D(inShapePt, inHolePt, shape[sIdx], shape[nextIdx], true);\r\n          if (intersection.length > 0) return true;\r\n        }\r\n\r\n        return false;\r\n      }\r\n\r\n      var indepHoles = [];\r\n\r\n      function intersectsHoleEdge(inShapePt, inHolePt) {\r\n        // checks for intersections with hole edges\r\n        var ihIdx, chkHole,\r\n          hIdx, nextIdx, intersection;\r\n        for (ihIdx = 0; ihIdx < indepHoles.length; ihIdx++) {\r\n          chkHole = holes[indepHoles[ihIdx]];\r\n          for (hIdx = 0; hIdx < chkHole.length; hIdx++) {\r\n            nextIdx = hIdx + 1;\r\n            nextIdx %= chkHole.length;\r\n            intersection = intersect_segments_2D(inShapePt, inHolePt, chkHole[hIdx], chkHole[nextIdx], true);\r\n            if (intersection.length > 0) return true;\r\n          }\r\n        }\r\n        return false;\r\n      }\r\n\r\n      var holeIndex, shapeIndex,\r\n        shapePt, holePt,\r\n        holeIdx, cutKey, failedCuts = [],\r\n        tmpShape1, tmpShape2,\r\n        tmpHole1, tmpHole2;\r\n\r\n      for (var h = 0, hl = holes.length; h < hl; h++) {\r\n\r\n        indepHoles.push(h);\r\n\r\n      }\r\n\r\n      var minShapeIndex = 0;\r\n      var counter = indepHoles.length * 2;\r\n      while (indepHoles.length > 0) {\r\n        counter--;\r\n        if (counter < 0) {\r\n          console.log(\"Infinite Loop! Holes left:\" + indepHoles.length + \", Probably Hole outside Shape!\");\r\n          break;\r\n        }\r\n\r\n        // search for shape-vertex and hole-vertex,\r\n        // which can be connected without intersections\r\n        for (shapeIndex = minShapeIndex; shapeIndex < shape.length; shapeIndex++) {\r\n\r\n          shapePt = shape[shapeIndex];\r\n          holeIndex = -1;\r\n\r\n          // search for hole which can be reached without intersections\r\n          for (var h = 0; h < indepHoles.length; h++) {\r\n            holeIdx = indepHoles[h];\r\n\r\n            // prevent multiple checks\r\n            cutKey = shapePt.x + \":\" + shapePt.y + \":\" + holeIdx;\r\n            if (failedCuts[cutKey] !== undefined) continue;\r\n\r\n            hole = holes[holeIdx];\r\n            for (var h2 = 0; h2 < hole.length; h2++) {\r\n              holePt = hole[h2];\r\n              if (!isCutLineInsideAngles(shapeIndex, h2)) continue;\r\n              if (intersectsShapeEdge(shapePt, holePt)) continue;\r\n              if (intersectsHoleEdge(shapePt, holePt)) continue;\r\n\r\n              holeIndex = h2;\r\n              indepHoles.splice(h, 1);\r\n\r\n              tmpShape1 = shape.slice(0, shapeIndex + 1);\r\n              tmpShape2 = shape.slice(shapeIndex);\r\n              tmpHole1 = hole.slice(holeIndex);\r\n              tmpHole2 = hole.slice(0, holeIndex + 1);\r\n\r\n              shape = tmpShape1.concat(tmpHole1).concat(tmpHole2).concat(tmpShape2);\r\n\r\n              minShapeIndex = shapeIndex;\r\n\r\n              // Debug only, to show the selected cuts\r\n              // glob_CutLines.push( [ shapePt, holePt ] );\r\n\r\n              break;\r\n            }\r\n            if (holeIndex >= 0) break; // hole-vertex found\r\n\r\n            failedCuts[cutKey] = true; // remember failure\r\n          }\r\n          if (holeIndex >= 0) break; // hole-vertex found\r\n        }\r\n      }\r\n\r\n      return shape; /* shape with no holes */\r\n    }\r\n\r\n\r\n    var i, il, f, face,\r\n      key, index,\r\n      allPointsMap = {};\r\n\r\n    // To maintain reference to old shape, one must match coordinates, or offset the indices from original arrays. It's probably easier to do the first.\r\n\r\n    var allpoints = contour.concat();\r\n\r\n    for (var h = 0, hl = holes.length; h < hl; h++) {\r\n\r\n      Array.prototype.push.apply(allpoints, holes[h]);\r\n\r\n    }\r\n\r\n    //console.log( \"allpoints\",allpoints, allpoints.length );\r\n\r\n    // prepare all points map\r\n\r\n    for (i = 0, il = allpoints.length; i < il; i++) {\r\n\r\n      key = allpoints[i].x + \":\" + allpoints[i].y;\r\n\r\n      if (allPointsMap[key] !== undefined) {\r\n\r\n        THREE.warn(\"THREE.Shape: Duplicate point\", key);\r\n\r\n      }\r\n\r\n      allPointsMap[key] = i;\r\n\r\n    }\r\n\r\n    // remove holes by cutting paths to holes and adding them to the shape\r\n    var shapeWithoutHoles = removeHoles(contour, holes);\r\n\r\n    var triangles = THREE.FontUtils.Triangulate(shapeWithoutHoles, false); // True returns indices for points of spooled shape\r\n    //console.log( \"triangles\",triangles, triangles.length );\r\n\r\n    // check all face vertices against all points map\r\n\r\n    for (i = 0, il = triangles.length; i < il; i++) {\r\n\r\n      face = triangles[i];\r\n\r\n      for (f = 0; f < 3; f++) {\r\n\r\n        key = face[f].x + \":\" + face[f].y;\r\n\r\n        index = allPointsMap[key];\r\n\r\n        if (index !== undefined) {\r\n\r\n          face[f] = index;\r\n\r\n        }\r\n\r\n      }\r\n\r\n    }\r\n\r\n    return triangles.concat();\r\n\r\n  },\r\n\r\n  isClockWise: function(pts) {\r\n\r\n    return THREE.FontUtils.Triangulate.area(pts) < 0;\r\n\r\n  },\r\n\r\n  // Bezier Curves formulas obtained from\r\n  // http://en.wikipedia.org/wiki/B%C3%A9zier_curve\r\n\r\n  // Quad Bezier Functions\r\n\r\n  b2p0: function(t, p) {\r\n\r\n    var k = 1 - t;\r\n    return k * k * p;\r\n\r\n  },\r\n\r\n  b2p1: function(t, p) {\r\n\r\n    return 2 * (1 - t) * t * p;\r\n\r\n  },\r\n\r\n  b2p2: function(t, p) {\r\n\r\n    return t * t * p;\r\n\r\n  },\r\n\r\n  b2: function(t, p0, p1, p2) {\r\n\r\n    return this.b2p0(t, p0) + this.b2p1(t, p1) + this.b2p2(t, p2);\r\n\r\n  },\r\n\r\n  // Cubic Bezier Functions\r\n\r\n  b3p0: function(t, p) {\r\n\r\n    var k = 1 - t;\r\n    return k * k * k * p;\r\n\r\n  },\r\n\r\n  b3p1: function(t, p) {\r\n\r\n    var k = 1 - t;\r\n    return 3 * k * k * t * p;\r\n\r\n  },\r\n\r\n  b3p2: function(t, p) {\r\n\r\n    var k = 1 - t;\r\n    return 3 * k * t * t * p;\r\n\r\n  },\r\n\r\n  b3p3: function(t, p) {\r\n\r\n    return t * t * t * p;\r\n\r\n  },\r\n\r\n  b3: function(t, p0, p1, p2, p3) {\r\n\r\n    return this.b3p0(t, p0) + this.b3p1(t, p1) + this.b3p2(t, p2) + this.b3p3(t, p3);\r\n\r\n  }\r\n\r\n};\r\n\r\n\r\n// File:src/extras/curves/LineCurve.js\r\n\r\n/**************************************************************\r\n *\tLine\r\n **************************************************************/\r\n\r\nTHREE.LineCurve = function(v1, v2) {\r\n\r\n  this.v1 = v1;\r\n  this.v2 = v2;\r\n\r\n};\r\n\r\nTHREE.LineCurve.prototype = Object.create(THREE.Curve.prototype);\r\nTHREE.LineCurve.prototype.constructor = THREE.LineCurve;\r\n\r\nTHREE.LineCurve.prototype.getPoint = function(t) {\r\n\r\n  var point = this.v2.clone().sub(this.v1);\r\n  point.multiplyScalar(t).add(this.v1);\r\n\r\n  return point;\r\n\r\n};\r\n\r\n// Line curve is linear, so we can overwrite default getPointAt\r\n\r\nTHREE.LineCurve.prototype.getPointAt = function(u) {\r\n\r\n  return this.getPoint(u);\r\n\r\n};\r\n\r\nTHREE.LineCurve.prototype.getTangent = function(t) {\r\n\r\n  var tangent = this.v2.clone().sub(this.v1);\r\n\r\n  return tangent.normalize();\r\n\r\n};\r\n\r\n// File:src/extras/curves/QuadraticBezierCurve.js\r\n\r\n/**************************************************************\r\n *\tQuadratic Bezier curve\r\n **************************************************************/\r\n\r\n\r\nTHREE.QuadraticBezierCurve = function(v0, v1, v2) {\r\n\r\n  this.v0 = v0;\r\n  this.v1 = v1;\r\n  this.v2 = v2;\r\n\r\n};\r\n\r\nTHREE.QuadraticBezierCurve.prototype = Object.create(THREE.Curve.prototype);\r\nTHREE.QuadraticBezierCurve.prototype.constructor = THREE.QuadraticBezierCurve;\r\n\r\n\r\nTHREE.QuadraticBezierCurve.prototype.getPoint = function(t) {\r\n\r\n  var vector = new THREE.Vector2();\r\n\r\n  vector.x = THREE.Shape.Utils.b2(t, this.v0.x, this.v1.x, this.v2.x);\r\n  vector.y = THREE.Shape.Utils.b2(t, this.v0.y, this.v1.y, this.v2.y);\r\n\r\n  return vector;\r\n\r\n};\r\n\r\n\r\nTHREE.QuadraticBezierCurve.prototype.getTangent = function(t) {\r\n\r\n  var vector = new THREE.Vector2();\r\n\r\n  vector.x = THREE.Curve.Utils.tangentQuadraticBezier(t, this.v0.x, this.v1.x, this.v2.x);\r\n  vector.y = THREE.Curve.Utils.tangentQuadraticBezier(t, this.v0.y, this.v1.y, this.v2.y);\r\n\r\n  // returns unit vector\r\n\r\n  return vector.normalize();\r\n\r\n};\r\n\r\n// File:src/extras/curves/CubicBezierCurve.js\r\n\r\n/**************************************************************\r\n *\tCubic Bezier curve\r\n **************************************************************/\r\n\r\nTHREE.CubicBezierCurve = function(v0, v1, v2, v3) {\r\n\r\n  this.v0 = v0;\r\n  this.v1 = v1;\r\n  this.v2 = v2;\r\n  this.v3 = v3;\r\n\r\n};\r\n\r\nTHREE.CubicBezierCurve.prototype = Object.create(THREE.Curve.prototype);\r\nTHREE.CubicBezierCurve.prototype.constructor = THREE.CubicBezierCurve;\r\n\r\nTHREE.CubicBezierCurve.prototype.getPoint = function(t) {\r\n\r\n  var tx, ty;\r\n\r\n  tx = THREE.Shape.Utils.b3(t, this.v0.x, this.v1.x, this.v2.x, this.v3.x);\r\n  ty = THREE.Shape.Utils.b3(t, this.v0.y, this.v1.y, this.v2.y, this.v3.y);\r\n\r\n  return new THREE.Vector2(tx, ty);\r\n\r\n};\r\n\r\nTHREE.CubicBezierCurve.prototype.getTangent = function(t) {\r\n\r\n  var tx, ty;\r\n\r\n  tx = THREE.Curve.Utils.tangentCubicBezier(t, this.v0.x, this.v1.x, this.v2.x, this.v3.x);\r\n  ty = THREE.Curve.Utils.tangentCubicBezier(t, this.v0.y, this.v1.y, this.v2.y, this.v3.y);\r\n\r\n  var tangent = new THREE.Vector2(tx, ty);\r\n  tangent.normalize();\r\n\r\n  return tangent;\r\n\r\n};\r\n\r\n// File:src/extras/curves/SplineCurve.js\r\n\r\n/**************************************************************\r\n *\tSpline curve\r\n **************************************************************/\r\n\r\nTHREE.SplineCurve = function(points /* array of Vector2 */ ) {\r\n\r\n  this.points = (points == undefined) ? [] : points;\r\n\r\n};\r\n\r\nTHREE.SplineCurve.prototype = Object.create(THREE.Curve.prototype);\r\nTHREE.SplineCurve.prototype.constructor = THREE.SplineCurve;\r\n\r\nTHREE.SplineCurve.prototype.getPoint = function(t) {\r\n\r\n  var points = this.points;\r\n  var point = (points.length - 1) * t;\r\n\r\n  var intPoint = Math.floor(point);\r\n  var weight = point - intPoint;\r\n\r\n  var point0 = points[intPoint == 0 ? intPoint : intPoint - 1]\r\n  var point1 = points[intPoint]\r\n  var point2 = points[intPoint > points.length - 2 ? points.length - 1 : intPoint + 1]\r\n  var point3 = points[intPoint > points.length - 3 ? points.length - 1 : intPoint + 2]\r\n\r\n  var vector = new THREE.Vector2();\r\n\r\n  vector.x = THREE.Curve.Utils.interpolate(point0.x, point1.x, point2.x, point3.x, weight);\r\n  vector.y = THREE.Curve.Utils.interpolate(point0.y, point1.y, point2.y, point3.y, weight);\r\n\r\n  return vector;\r\n\r\n};\r\n\r\n// File:src/extras/curves/EllipseCurve.js\r\n\r\n/**************************************************************\r\n *\tEllipse curve\r\n **************************************************************/\r\n\r\nTHREE.EllipseCurve = function(aX, aY, xRadius, yRadius, aStartAngle, aEndAngle, aClockwise) {\r\n\r\n  this.aX = aX;\r\n  this.aY = aY;\r\n\r\n  this.xRadius = xRadius;\r\n  this.yRadius = yRadius;\r\n\r\n  this.aStartAngle = aStartAngle;\r\n  this.aEndAngle = aEndAngle;\r\n\r\n  this.aClockwise = aClockwise;\r\n\r\n};\r\n\r\nTHREE.EllipseCurve.prototype = Object.create(THREE.Curve.prototype);\r\nTHREE.EllipseCurve.prototype.constructor = THREE.EllipseCurve;\r\n\r\nTHREE.EllipseCurve.prototype.getPoint = function(t) {\r\n\r\n  var deltaAngle = this.aEndAngle - this.aStartAngle;\r\n\r\n  if (deltaAngle < 0) deltaAngle += Math.PI * 2;\r\n  if (deltaAngle > Math.PI * 2) deltaAngle -= Math.PI * 2;\r\n\r\n  var angle;\r\n\r\n  if (this.aClockwise === true) {\r\n\r\n    angle = this.aEndAngle + (1 - t) * (Math.PI * 2 - deltaAngle);\r\n\r\n  }\r\n  else {\r\n\r\n    angle = this.aStartAngle + t * deltaAngle;\r\n\r\n  }\r\n\r\n  var vector = new THREE.Vector2();\r\n\r\n  vector.x = this.aX + this.xRadius * Math.cos(angle);\r\n  vector.y = this.aY + this.yRadius * Math.sin(angle);\r\n\r\n  return vector;\r\n\r\n};\r\n\r\n// File:src/extras/curves/ArcCurve.js\r\n\r\n/**************************************************************\r\n *\tArc curve\r\n **************************************************************/\r\n\r\nTHREE.ArcCurve = function(aX, aY, aRadius, aStartAngle, aEndAngle, aClockwise) {\r\n\r\n  THREE.EllipseCurve.call(this, aX, aY, aRadius, aRadius, aStartAngle, aEndAngle, aClockwise);\r\n};\r\n\r\nTHREE.ArcCurve.prototype = Object.create(THREE.EllipseCurve.prototype);\r\nTHREE.ArcCurve.prototype.constructor = THREE.ArcCurve;\r\n\r\n// File:src/extras/curves/LineCurve3.js\r\n\r\n/**************************************************************\r\n *\tLine3D\r\n **************************************************************/\r\n\r\nTHREE.LineCurve3 = THREE.Curve.create(\r\n\r\n  function(v1, v2) {\r\n\r\n    this.v1 = v1;\r\n    this.v2 = v2;\r\n\r\n  },\r\n\r\n  function(t) {\r\n\r\n    var vector = new THREE.Vector3();\r\n\r\n    vector.subVectors(this.v2, this.v1); // diff\r\n    vector.multiplyScalar(t);\r\n    vector.add(this.v1);\r\n\r\n    return vector;\r\n\r\n  }\r\n\r\n);\r\n\r\n// File:src/extras/curves/QuadraticBezierCurve3.js\r\n\r\n/**************************************************************\r\n *\tQuadratic Bezier 3D curve\r\n **************************************************************/\r\n\r\nTHREE.QuadraticBezierCurve3 = THREE.Curve.create(\r\n\r\n  function(v0, v1, v2) {\r\n\r\n    this.v0 = v0;\r\n    this.v1 = v1;\r\n    this.v2 = v2;\r\n\r\n  },\r\n\r\n  function(t) {\r\n\r\n    var vector = new THREE.Vector3();\r\n\r\n    vector.x = THREE.Shape.Utils.b2(t, this.v0.x, this.v1.x, this.v2.x);\r\n    vector.y = THREE.Shape.Utils.b2(t, this.v0.y, this.v1.y, this.v2.y);\r\n    vector.z = THREE.Shape.Utils.b2(t, this.v0.z, this.v1.z, this.v2.z);\r\n\r\n    return vector;\r\n\r\n  }\r\n\r\n);\r\n\r\n// File:src/extras/curves/CubicBezierCurve3.js\r\n\r\n/**************************************************************\r\n *\tCubic Bezier 3D curve\r\n **************************************************************/\r\n\r\nTHREE.CubicBezierCurve3 = THREE.Curve.create(\r\n\r\n  function(v0, v1, v2, v3) {\r\n\r\n    this.v0 = v0;\r\n    this.v1 = v1;\r\n    this.v2 = v2;\r\n    this.v3 = v3;\r\n\r\n  },\r\n\r\n  function(t) {\r\n\r\n    var vector = new THREE.Vector3();\r\n\r\n    vector.x = THREE.Shape.Utils.b3(t, this.v0.x, this.v1.x, this.v2.x, this.v3.x);\r\n    vector.y = THREE.Shape.Utils.b3(t, this.v0.y, this.v1.y, this.v2.y, this.v3.y);\r\n    vector.z = THREE.Shape.Utils.b3(t, this.v0.z, this.v1.z, this.v2.z, this.v3.z);\r\n\r\n    return vector;\r\n\r\n  }\r\n\r\n);\r\n\r\n// File:src/extras/curves/SplineCurve3.js\r\n\r\n/**************************************************************\r\n *\tSpline 3D curve\r\n **************************************************************/\r\n\r\n\r\nTHREE.SplineCurve3 = THREE.Curve.create(\r\n\r\n  function(points /* array of Vector3 */ ) {\r\n\r\n    this.points = (points == undefined) ? [] : points;\r\n\r\n  },\r\n\r\n  function(t) {\r\n\r\n    var points = this.points;\r\n    var point = (points.length - 1) * t;\r\n\r\n    var intPoint = Math.floor(point);\r\n    var weight = point - intPoint;\r\n\r\n    var point0 = points[intPoint == 0 ? intPoint : intPoint - 1];\r\n    var point1 = points[intPoint];\r\n    var point2 = points[intPoint > points.length - 2 ? points.length - 1 : intPoint + 1];\r\n    var point3 = points[intPoint > points.length - 3 ? points.length - 1 : intPoint + 2];\r\n\r\n    var vector = new THREE.Vector3();\r\n\r\n    vector.x = THREE.Curve.Utils.interpolate(point0.x, point1.x, point2.x, point3.x, weight);\r\n    vector.y = THREE.Curve.Utils.interpolate(point0.y, point1.y, point2.y, point3.y, weight);\r\n    vector.z = THREE.Curve.Utils.interpolate(point0.z, point1.z, point2.z, point3.z, weight);\r\n\r\n    return vector;\r\n\r\n  }\r\n\r\n);\r\n\r\n// File:src/extras/curves/ClosedSplineCurve3.js\r\n\r\n/**************************************************************\r\n *\tClosed Spline 3D curve\r\n **************************************************************/\r\n\r\n\r\nTHREE.ClosedSplineCurve3 = THREE.Curve.create(\r\n\r\n  function(points /* array of Vector3 */ ) {\r\n\r\n    this.points = (points == undefined) ? [] : points;\r\n\r\n  },\r\n\r\n  function(t) {\r\n\r\n    var points = this.points;\r\n    var point = (points.length - 0) * t; // This needs to be from 0-length +1\r\n\r\n    var intPoint = Math.floor(point);\r\n    var weight = point - intPoint;\r\n\r\n    intPoint += intPoint > 0 ? 0 : (Math.floor(Math.abs(intPoint) / points.length) + 1) * points.length;\r\n\r\n    var point0 = points[(intPoint - 1) % points.length];\r\n    var point1 = points[(intPoint) % points.length];\r\n    var point2 = points[(intPoint + 1) % points.length];\r\n    var point3 = points[(intPoint + 2) % points.length];\r\n\r\n    var vector = new THREE.Vector3();\r\n\r\n    vector.x = THREE.Curve.Utils.interpolate(point0.x, point1.x, point2.x, point3.x, weight);\r\n    vector.y = THREE.Curve.Utils.interpolate(point0.y, point1.y, point2.y, point3.y, weight);\r\n    vector.z = THREE.Curve.Utils.interpolate(point0.z, point1.z, point2.z, point3.z, weight);\r\n\r\n    return vector;\r\n\r\n  }\r\n\r\n);\r\n\r\n// File:src/extras/animation/AnimationHandler.js\r\n\r\n/**\r\n * @author mikael emtinger / http://gomo.se/\r\n */\r\n\r\nTHREE.AnimationHandler = {\r\n\r\n  LINEAR: 0,\r\n  CATMULLROM: 1,\r\n  CATMULLROM_FORWARD: 2,\r\n\r\n  //\r\n\r\n  add: function() {\r\n    THREE.warn('THREE.AnimationHandler.add() has been deprecated.');\r\n  },\r\n  get: function() {\r\n    THREE.warn('THREE.AnimationHandler.get() has been deprecated.');\r\n  },\r\n  remove: function() {\r\n    THREE.warn('THREE.AnimationHandler.remove() has been deprecated.');\r\n  },\r\n\r\n  //\r\n\r\n  animations: [],\r\n\r\n  init: function(data) {\r\n\r\n    if (data.initialized === true) return data;\r\n\r\n    // loop through all keys\r\n\r\n    for (var h = 0; h < data.hierarchy.length; h++) {\r\n\r\n      for (var k = 0; k < data.hierarchy[h].keys.length; k++) {\r\n\r\n        // remove minus times\r\n\r\n        if (data.hierarchy[h].keys[k].time < 0) {\r\n\r\n          data.hierarchy[h].keys[k].time = 0;\r\n\r\n        }\r\n\r\n        // create quaternions\r\n\r\n        if (data.hierarchy[h].keys[k].rot !== undefined &&\r\n          !(data.hierarchy[h].keys[k].rot instanceof THREE.Quaternion)) {\r\n\r\n          var quat = data.hierarchy[h].keys[k].rot;\r\n          data.hierarchy[h].keys[k].rot = new THREE.Quaternion().fromArray(quat);\r\n\r\n        }\r\n\r\n      }\r\n\r\n      // prepare morph target keys\r\n\r\n      if (data.hierarchy[h].keys.length && data.hierarchy[h].keys[0].morphTargets !== undefined) {\r\n\r\n        // get all used\r\n\r\n        var usedMorphTargets = {};\r\n\r\n        for (var k = 0; k < data.hierarchy[h].keys.length; k++) {\r\n\r\n          for (var m = 0; m < data.hierarchy[h].keys[k].morphTargets.length; m++) {\r\n\r\n            var morphTargetName = data.hierarchy[h].keys[k].morphTargets[m];\r\n            usedMorphTargets[morphTargetName] = -1;\r\n\r\n          }\r\n\r\n        }\r\n\r\n        data.hierarchy[h].usedMorphTargets = usedMorphTargets;\r\n\r\n\r\n        // set all used on all frames\r\n\r\n        for (var k = 0; k < data.hierarchy[h].keys.length; k++) {\r\n\r\n          var influences = {};\r\n\r\n          for (var morphTargetName in usedMorphTargets) {\r\n\r\n            for (var m = 0; m < data.hierarchy[h].keys[k].morphTargets.length; m++) {\r\n\r\n              if (data.hierarchy[h].keys[k].morphTargets[m] === morphTargetName) {\r\n\r\n                influences[morphTargetName] = data.hierarchy[h].keys[k].morphTargetsInfluences[m];\r\n                break;\r\n\r\n              }\r\n\r\n            }\r\n\r\n            if (m === data.hierarchy[h].keys[k].morphTargets.length) {\r\n\r\n              influences[morphTargetName] = 0;\r\n\r\n            }\r\n\r\n          }\r\n\r\n          data.hierarchy[h].keys[k].morphTargetsInfluences = influences;\r\n\r\n        }\r\n\r\n      }\r\n\r\n\r\n      // remove all keys that are on the same time\r\n\r\n      for (var k = 1; k < data.hierarchy[h].keys.length; k++) {\r\n\r\n        if (data.hierarchy[h].keys[k].time === data.hierarchy[h].keys[k - 1].time) {\r\n\r\n          data.hierarchy[h].keys.splice(k, 1);\r\n          k--;\r\n\r\n        }\r\n\r\n      }\r\n\r\n\r\n      // set index\r\n\r\n      for (var k = 0; k < data.hierarchy[h].keys.length; k++) {\r\n\r\n        data.hierarchy[h].keys[k].index = k;\r\n\r\n      }\r\n\r\n    }\r\n\r\n    data.initialized = true;\r\n\r\n    return data;\r\n\r\n  },\r\n\r\n  parse: function(root) {\r\n\r\n    var parseRecurseHierarchy = function(root, hierarchy) {\r\n\r\n      hierarchy.push(root);\r\n\r\n      for (var c = 0; c < root.children.length; c++)\r\n        parseRecurseHierarchy(root.children[c], hierarchy);\r\n\r\n    };\r\n\r\n    // setup hierarchy\r\n\r\n    var hierarchy = [];\r\n\r\n    if (root instanceof THREE.SkinnedMesh) {\r\n\r\n      for (var b = 0; b < root.skeleton.bones.length; b++) {\r\n\r\n        hierarchy.push(root.skeleton.bones[b]);\r\n\r\n      }\r\n\r\n    }\r\n    else {\r\n\r\n      parseRecurseHierarchy(root, hierarchy);\r\n\r\n    }\r\n\r\n    return hierarchy;\r\n\r\n  },\r\n\r\n  play: function(animation) {\r\n\r\n    if (this.animations.indexOf(animation) === -1) {\r\n\r\n      this.animations.push(animation);\r\n\r\n    }\r\n\r\n  },\r\n\r\n  stop: function(animation) {\r\n\r\n    var index = this.animations.indexOf(animation);\r\n\r\n    if (index !== -1) {\r\n\r\n      this.animations.splice(index, 1);\r\n\r\n    }\r\n\r\n  },\r\n\r\n  update: function(deltaTimeMS) {\r\n\r\n    for (var i = 0; i < this.animations.length; i++) {\r\n\r\n      this.animations[i].resetBlendWeights();\r\n\r\n    }\r\n\r\n    for (var i = 0; i < this.animations.length; i++) {\r\n\r\n      this.animations[i].update(deltaTimeMS);\r\n\r\n    }\r\n\r\n  }\r\n\r\n};\r\n\r\n// File:src/extras/animation/Animation.js\r\n\r\n/**\r\n * @author mikael emtinger / http://gomo.se/\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author alteredq / http://alteredqualia.com/\r\n */\r\n\r\nTHREE.Animation = function(root, data) {\r\n\r\n  this.root = root;\r\n  this.data = THREE.AnimationHandler.init(data);\r\n  this.hierarchy = THREE.AnimationHandler.parse(root);\r\n\r\n  this.currentTime = 0;\r\n  this.timeScale = 1;\r\n\r\n  this.isPlaying = false;\r\n  this.loop = true;\r\n  this.weight = 0;\r\n\r\n  this.interpolationType = THREE.AnimationHandler.LINEAR;\r\n\r\n};\r\n\r\nTHREE.Animation.prototype = {\r\n\r\n  constructor: THREE.Animation,\r\n\r\n  keyTypes: [\"pos\", \"rot\", \"scl\"],\r\n\r\n  play: function(startTime, weight) {\r\n\r\n    this.currentTime = startTime !== undefined ? startTime : 0;\r\n    this.weight = weight !== undefined ? weight : 1;\r\n\r\n    this.isPlaying = true;\r\n\r\n    this.reset();\r\n\r\n    THREE.AnimationHandler.play(this);\r\n\r\n  },\r\n\r\n  stop: function() {\r\n\r\n    this.isPlaying = false;\r\n\r\n    THREE.AnimationHandler.stop(this);\r\n\r\n  },\r\n\r\n  reset: function() {\r\n\r\n    for (var h = 0, hl = this.hierarchy.length; h < hl; h++) {\r\n\r\n      var object = this.hierarchy[h];\r\n\r\n      if (object.animationCache === undefined) {\r\n\r\n        object.animationCache = {\r\n          animations: {},\r\n          blending: {\r\n            positionWeight: 0.0,\r\n            quaternionWeight: 0.0,\r\n            scaleWeight: 0.0\r\n          }\r\n        };\r\n      }\r\n\r\n      var name = this.data.name;\r\n      var animations = object.animationCache.animations;\r\n      var animationCache = animations[name];\r\n\r\n      if (animationCache === undefined) {\r\n\r\n        animationCache = {\r\n          prevKey: {\r\n            pos: 0,\r\n            rot: 0,\r\n            scl: 0\r\n          },\r\n          nextKey: {\r\n            pos: 0,\r\n            rot: 0,\r\n            scl: 0\r\n          },\r\n          originalMatrix: object.matrix\r\n        };\r\n\r\n        animations[name] = animationCache;\r\n\r\n      }\r\n\r\n      // Get keys to match our current time\r\n\r\n      for (var t = 0; t < 3; t++) {\r\n\r\n        var type = this.keyTypes[t];\r\n\r\n        var prevKey = this.data.hierarchy[h].keys[0];\r\n        var nextKey = this.getNextKeyWith(type, h, 1);\r\n\r\n        while (nextKey.time < this.currentTime && nextKey.index > prevKey.index) {\r\n\r\n          prevKey = nextKey;\r\n          nextKey = this.getNextKeyWith(type, h, nextKey.index + 1);\r\n\r\n        }\r\n\r\n        animationCache.prevKey[type] = prevKey;\r\n        animationCache.nextKey[type] = nextKey;\r\n\r\n      }\r\n\r\n    }\r\n\r\n  },\r\n\r\n  resetBlendWeights: function() {\r\n\r\n    for (var h = 0, hl = this.hierarchy.length; h < hl; h++) {\r\n\r\n      var object = this.hierarchy[h];\r\n      var animationCache = object.animationCache;\r\n\r\n      if (animationCache !== undefined) {\r\n\r\n        var blending = animationCache.blending;\r\n\r\n        blending.positionWeight = 0.0;\r\n        blending.quaternionWeight = 0.0;\r\n        blending.scaleWeight = 0.0;\r\n\r\n      }\r\n\r\n    }\r\n\r\n  },\r\n\r\n  update: (function() {\r\n\r\n    var points = [];\r\n    var target = new THREE.Vector3();\r\n    var newVector = new THREE.Vector3();\r\n    var newQuat = new THREE.Quaternion();\r\n\r\n    // Catmull-Rom spline\r\n\r\n    var interpolateCatmullRom = function(points, scale) {\r\n\r\n      var c = [],\r\n        v3 = [],\r\n        point, intPoint, weight, w2, w3,\r\n        pa, pb, pc, pd;\r\n\r\n      point = (points.length - 1) * scale;\r\n      intPoint = Math.floor(point);\r\n      weight = point - intPoint;\r\n\r\n      c[0] = intPoint === 0 ? intPoint : intPoint - 1;\r\n      c[1] = intPoint;\r\n      c[2] = intPoint > points.length - 2 ? intPoint : intPoint + 1;\r\n      c[3] = intPoint > points.length - 3 ? intPoint : intPoint + 2;\r\n\r\n      pa = points[c[0]];\r\n      pb = points[c[1]];\r\n      pc = points[c[2]];\r\n      pd = points[c[3]];\r\n\r\n      w2 = weight * weight;\r\n      w3 = weight * w2;\r\n\r\n      v3[0] = interpolate(pa[0], pb[0], pc[0], pd[0], weight, w2, w3);\r\n      v3[1] = interpolate(pa[1], pb[1], pc[1], pd[1], weight, w2, w3);\r\n      v3[2] = interpolate(pa[2], pb[2], pc[2], pd[2], weight, w2, w3);\r\n\r\n      return v3;\r\n\r\n    };\r\n\r\n    var interpolate = function(p0, p1, p2, p3, t, t2, t3) {\r\n\r\n      var v0 = (p2 - p0) * 0.5,\r\n        v1 = (p3 - p1) * 0.5;\r\n\r\n      return (2 * (p1 - p2) + v0 + v1) * t3 + (-3 * (p1 - p2) - 2 * v0 - v1) * t2 + v0 * t + p1;\r\n\r\n    };\r\n\r\n    return function(delta) {\r\n\r\n      if (this.isPlaying === false) return;\r\n\r\n      this.currentTime += delta * this.timeScale;\r\n\r\n      if (this.weight === 0)\r\n        return;\r\n\r\n      //\r\n\r\n      var duration = this.data.length;\r\n\r\n      if (this.currentTime > duration || this.currentTime < 0) {\r\n\r\n        if (this.loop) {\r\n\r\n          this.currentTime %= duration;\r\n\r\n          if (this.currentTime < 0)\r\n            this.currentTime += duration;\r\n\r\n          this.reset();\r\n\r\n        }\r\n        else {\r\n\r\n          this.stop();\r\n\r\n        }\r\n\r\n      }\r\n\r\n      for (var h = 0, hl = this.hierarchy.length; h < hl; h++) {\r\n\r\n        var object = this.hierarchy[h];\r\n        var animationCache = object.animationCache.animations[this.data.name];\r\n        var blending = object.animationCache.blending;\r\n\r\n        // loop through pos/rot/scl\r\n\r\n        for (var t = 0; t < 3; t++) {\r\n\r\n          // get keys\r\n\r\n          var type = this.keyTypes[t];\r\n          var prevKey = animationCache.prevKey[type];\r\n          var nextKey = animationCache.nextKey[type];\r\n\r\n          if ((this.timeScale > 0 && nextKey.time <= this.currentTime) ||\r\n            (this.timeScale < 0 && prevKey.time >= this.currentTime)) {\r\n\r\n            prevKey = this.data.hierarchy[h].keys[0];\r\n            nextKey = this.getNextKeyWith(type, h, 1);\r\n\r\n            while (nextKey.time < this.currentTime && nextKey.index > prevKey.index) {\r\n\r\n              prevKey = nextKey;\r\n              nextKey = this.getNextKeyWith(type, h, nextKey.index + 1);\r\n\r\n            }\r\n\r\n            animationCache.prevKey[type] = prevKey;\r\n            animationCache.nextKey[type] = nextKey;\r\n\r\n          }\r\n\r\n          var scale = (this.currentTime - prevKey.time) / (nextKey.time - prevKey.time);\r\n\r\n          var prevXYZ = prevKey[type];\r\n          var nextXYZ = nextKey[type];\r\n\r\n          if (scale < 0) scale = 0;\r\n          if (scale > 1) scale = 1;\r\n\r\n          // interpolate\r\n\r\n          if (type === \"pos\") {\r\n\r\n            if (this.interpolationType === THREE.AnimationHandler.LINEAR) {\r\n\r\n              newVector.x = prevXYZ[0] + (nextXYZ[0] - prevXYZ[0]) * scale;\r\n              newVector.y = prevXYZ[1] + (nextXYZ[1] - prevXYZ[1]) * scale;\r\n              newVector.z = prevXYZ[2] + (nextXYZ[2] - prevXYZ[2]) * scale;\r\n\r\n              // blend\r\n              var proportionalWeight = this.weight / (this.weight + blending.positionWeight);\r\n              object.position.lerp(newVector, proportionalWeight);\r\n              blending.positionWeight += this.weight;\r\n\r\n            }\r\n            else if (this.interpolationType === THREE.AnimationHandler.CATMULLROM ||\r\n              this.interpolationType === THREE.AnimationHandler.CATMULLROM_FORWARD) {\r\n\r\n              points[0] = this.getPrevKeyWith(\"pos\", h, prevKey.index - 1)[\"pos\"];\r\n              points[1] = prevXYZ;\r\n              points[2] = nextXYZ;\r\n              points[3] = this.getNextKeyWith(\"pos\", h, nextKey.index + 1)[\"pos\"];\r\n\r\n              scale = scale * 0.33 + 0.33;\r\n\r\n              var currentPoint = interpolateCatmullRom(points, scale);\r\n              var proportionalWeight = this.weight / (this.weight + blending.positionWeight);\r\n              blending.positionWeight += this.weight;\r\n\r\n              // blend\r\n\r\n              var vector = object.position;\r\n\r\n              vector.x = vector.x + (currentPoint[0] - vector.x) * proportionalWeight;\r\n              vector.y = vector.y + (currentPoint[1] - vector.y) * proportionalWeight;\r\n              vector.z = vector.z + (currentPoint[2] - vector.z) * proportionalWeight;\r\n\r\n              if (this.interpolationType === THREE.AnimationHandler.CATMULLROM_FORWARD) {\r\n\r\n                var forwardPoint = interpolateCatmullRom(points, scale * 1.01);\r\n\r\n                target.set(forwardPoint[0], forwardPoint[1], forwardPoint[2]);\r\n                target.sub(vector);\r\n                target.y = 0;\r\n                target.normalize();\r\n\r\n                var angle = Math.atan2(target.x, target.z);\r\n                object.rotation.set(0, angle, 0);\r\n\r\n              }\r\n\r\n            }\r\n\r\n          }\r\n          else if (type === \"rot\") {\r\n\r\n            THREE.Quaternion.slerp(prevXYZ, nextXYZ, newQuat, scale);\r\n\r\n            // Avoid paying the cost of an additional slerp if we don't have to\r\n            if (blending.quaternionWeight === 0) {\r\n\r\n              object.quaternion.copy(newQuat);\r\n              blending.quaternionWeight = this.weight;\r\n\r\n            }\r\n            else {\r\n\r\n              var proportionalWeight = this.weight / (this.weight + blending.quaternionWeight);\r\n              THREE.Quaternion.slerp(object.quaternion, newQuat, object.quaternion, proportionalWeight);\r\n              blending.quaternionWeight += this.weight;\r\n\r\n            }\r\n\r\n          }\r\n          else if (type === \"scl\") {\r\n\r\n            newVector.x = prevXYZ[0] + (nextXYZ[0] - prevXYZ[0]) * scale;\r\n            newVector.y = prevXYZ[1] + (nextXYZ[1] - prevXYZ[1]) * scale;\r\n            newVector.z = prevXYZ[2] + (nextXYZ[2] - prevXYZ[2]) * scale;\r\n\r\n            var proportionalWeight = this.weight / (this.weight + blending.scaleWeight);\r\n            object.scale.lerp(newVector, proportionalWeight);\r\n            blending.scaleWeight += this.weight;\r\n\r\n          }\r\n\r\n        }\r\n\r\n      }\r\n\r\n      return true;\r\n\r\n    };\r\n\r\n  })(),\r\n\r\n  getNextKeyWith: function(type, h, key) {\r\n\r\n    var keys = this.data.hierarchy[h].keys;\r\n\r\n    if (this.interpolationType === THREE.AnimationHandler.CATMULLROM ||\r\n      this.interpolationType === THREE.AnimationHandler.CATMULLROM_FORWARD) {\r\n\r\n      key = key < keys.length - 1 ? key : keys.length - 1;\r\n\r\n    }\r\n    else {\r\n\r\n      key = key % keys.length;\r\n\r\n    }\r\n\r\n    for (; key < keys.length; key++) {\r\n\r\n      if (keys[key][type] !== undefined) {\r\n\r\n        return keys[key];\r\n\r\n      }\r\n\r\n    }\r\n\r\n    return this.data.hierarchy[h].keys[0];\r\n\r\n  },\r\n\r\n  getPrevKeyWith: function(type, h, key) {\r\n\r\n    var keys = this.data.hierarchy[h].keys;\r\n\r\n    if (this.interpolationType === THREE.AnimationHandler.CATMULLROM ||\r\n      this.interpolationType === THREE.AnimationHandler.CATMULLROM_FORWARD) {\r\n\r\n      key = key > 0 ? key : 0;\r\n\r\n    }\r\n    else {\r\n\r\n      key = key >= 0 ? key : key + keys.length;\r\n\r\n    }\r\n\r\n\r\n    for (; key >= 0; key--) {\r\n\r\n      if (keys[key][type] !== undefined) {\r\n\r\n        return keys[key];\r\n\r\n      }\r\n\r\n    }\r\n\r\n    return this.data.hierarchy[h].keys[keys.length - 1];\r\n\r\n  }\r\n\r\n};\r\n\r\n// File:src/extras/animation/KeyFrameAnimation.js\r\n\r\n/**\r\n * @author mikael emtinger / http://gomo.se/\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author alteredq / http://alteredqualia.com/\r\n * @author khang duong\r\n * @author erik kitson\r\n */\r\n\r\nTHREE.KeyFrameAnimation = function(data) {\r\n\r\n  this.root = data.node;\r\n  this.data = THREE.AnimationHandler.init(data);\r\n  this.hierarchy = THREE.AnimationHandler.parse(this.root);\r\n  this.currentTime = 0;\r\n  this.timeScale = 0.001;\r\n  this.isPlaying = false;\r\n  this.isPaused = true;\r\n  this.loop = true;\r\n\r\n  // initialize to first keyframes\r\n\r\n  for (var h = 0, hl = this.hierarchy.length; h < hl; h++) {\r\n\r\n    var keys = this.data.hierarchy[h].keys,\r\n      sids = this.data.hierarchy[h].sids,\r\n      obj = this.hierarchy[h];\r\n\r\n    if (keys.length && sids) {\r\n\r\n      for (var s = 0; s < sids.length; s++) {\r\n\r\n        var sid = sids[s],\r\n          next = this.getNextKeyWith(sid, h, 0);\r\n\r\n        if (next) {\r\n\r\n          next.apply(sid);\r\n\r\n        }\r\n\r\n      }\r\n\r\n      obj.matrixAutoUpdate = false;\r\n      this.data.hierarchy[h].node.updateMatrix();\r\n      obj.matrixWorldNeedsUpdate = true;\r\n\r\n    }\r\n\r\n  }\r\n\r\n};\r\n\r\nTHREE.KeyFrameAnimation.prototype = {\r\n\r\n  constructor: THREE.KeyFrameAnimation,\r\n\r\n  play: function(startTime) {\r\n\r\n    this.currentTime = startTime !== undefined ? startTime : 0;\r\n\r\n    if (this.isPlaying === false) {\r\n\r\n      this.isPlaying = true;\r\n\r\n      // reset key cache\r\n\r\n      var h, hl = this.hierarchy.length,\r\n        object,\r\n        node;\r\n\r\n      for (h = 0; h < hl; h++) {\r\n\r\n        object = this.hierarchy[h];\r\n        node = this.data.hierarchy[h];\r\n\r\n        if (node.animationCache === undefined) {\r\n\r\n          node.animationCache = {};\r\n          node.animationCache.prevKey = null;\r\n          node.animationCache.nextKey = null;\r\n          node.animationCache.originalMatrix = object.matrix;\r\n\r\n        }\r\n\r\n        var keys = this.data.hierarchy[h].keys;\r\n\r\n        if (keys.length) {\r\n\r\n          node.animationCache.prevKey = keys[0];\r\n          node.animationCache.nextKey = keys[1];\r\n\r\n          this.startTime = Math.min(keys[0].time, this.startTime);\r\n          this.endTime = Math.max(keys[keys.length - 1].time, this.endTime);\r\n\r\n        }\r\n\r\n      }\r\n\r\n      this.update(0);\r\n\r\n    }\r\n\r\n    this.isPaused = false;\r\n\r\n    THREE.AnimationHandler.play(this);\r\n\r\n  },\r\n\r\n  stop: function() {\r\n\r\n    this.isPlaying = false;\r\n    this.isPaused = false;\r\n\r\n    THREE.AnimationHandler.stop(this);\r\n\r\n    // reset JIT matrix and remove cache\r\n\r\n    for (var h = 0; h < this.data.hierarchy.length; h++) {\r\n\r\n      var obj = this.hierarchy[h];\r\n      var node = this.data.hierarchy[h];\r\n\r\n      if (node.animationCache !== undefined) {\r\n\r\n        var original = node.animationCache.originalMatrix;\r\n\r\n        original.copy(obj.matrix);\r\n        obj.matrix = original;\r\n\r\n        delete node.animationCache;\r\n\r\n      }\r\n\r\n    }\r\n\r\n  },\r\n\r\n  update: function(delta) {\r\n\r\n    if (this.isPlaying === false) return;\r\n\r\n    this.currentTime += delta * this.timeScale;\r\n\r\n    //\r\n\r\n    var duration = this.data.length;\r\n\r\n    if (this.loop === true && this.currentTime > duration) {\r\n\r\n      this.currentTime %= duration;\r\n\r\n    }\r\n\r\n    this.currentTime = Math.min(this.currentTime, duration);\r\n\r\n    for (var h = 0, hl = this.hierarchy.length; h < hl; h++) {\r\n\r\n      var object = this.hierarchy[h];\r\n      var node = this.data.hierarchy[h];\r\n\r\n      var keys = node.keys,\r\n        animationCache = node.animationCache;\r\n\r\n\r\n      if (keys.length) {\r\n\r\n        var prevKey = animationCache.prevKey;\r\n        var nextKey = animationCache.nextKey;\r\n\r\n        if (nextKey.time <= this.currentTime) {\r\n\r\n          while (nextKey.time < this.currentTime && nextKey.index > prevKey.index) {\r\n\r\n            prevKey = nextKey;\r\n            nextKey = keys[prevKey.index + 1];\r\n\r\n          }\r\n\r\n          animationCache.prevKey = prevKey;\r\n          animationCache.nextKey = nextKey;\r\n\r\n        }\r\n\r\n        if (nextKey.time >= this.currentTime) {\r\n\r\n          prevKey.interpolate(nextKey, this.currentTime);\r\n\r\n        }\r\n        else {\r\n\r\n          prevKey.interpolate(nextKey, nextKey.time);\r\n\r\n        }\r\n\r\n        this.data.hierarchy[h].node.updateMatrix();\r\n        object.matrixWorldNeedsUpdate = true;\r\n\r\n      }\r\n\r\n    }\r\n\r\n  },\r\n\r\n  getNextKeyWith: function(sid, h, key) {\r\n\r\n    var keys = this.data.hierarchy[h].keys;\r\n    key = key % keys.length;\r\n\r\n    for (; key < keys.length; key++) {\r\n\r\n      if (keys[key].hasTarget(sid)) {\r\n\r\n        return keys[key];\r\n\r\n      }\r\n\r\n    }\r\n\r\n    return keys[0];\r\n\r\n  },\r\n\r\n  getPrevKeyWith: function(sid, h, key) {\r\n\r\n    var keys = this.data.hierarchy[h].keys;\r\n    key = key >= 0 ? key : key + keys.length;\r\n\r\n    for (; key >= 0; key--) {\r\n\r\n      if (keys[key].hasTarget(sid)) {\r\n\r\n        return keys[key];\r\n\r\n      }\r\n\r\n    }\r\n\r\n    return keys[keys.length - 1];\r\n\r\n  }\r\n\r\n};\r\n\r\n// File:src/extras/animation/MorphAnimation.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com\r\n * @author willy-vvu / http://willy-vvu.github.io\r\n */\r\n\r\nTHREE.MorphAnimation = function(mesh) {\r\n\r\n  this.mesh = mesh;\r\n  this.frames = mesh.morphTargetInfluences.length;\r\n  this.currentTime = 0;\r\n  this.duration = 1000;\r\n  this.loop = true;\r\n  this.lastFrame = 0;\r\n  this.currentFrame = 0;\r\n\r\n  this.isPlaying = false;\r\n\r\n};\r\n\r\nTHREE.MorphAnimation.prototype = {\r\n\r\n  constructor: THREE.MorphAnimation,\r\n\r\n  play: function() {\r\n\r\n    this.isPlaying = true;\r\n\r\n  },\r\n\r\n  pause: function() {\r\n\r\n    this.isPlaying = false;\r\n\r\n  },\r\n\r\n  update: function(delta) {\r\n\r\n    if (this.isPlaying === false) return;\r\n\r\n    this.currentTime += delta;\r\n\r\n    if (this.loop === true && this.currentTime > this.duration) {\r\n\r\n      this.currentTime %= this.duration;\r\n\r\n    }\r\n\r\n    this.currentTime = Math.min(this.currentTime, this.duration);\r\n\r\n    var interpolation = this.duration / this.frames;\r\n    var frame = Math.floor(this.currentTime / interpolation);\r\n\r\n    var influences = this.mesh.morphTargetInfluences;\r\n\r\n    if (frame != this.currentFrame) {\r\n\r\n      influences[this.lastFrame] = 0;\r\n      influences[this.currentFrame] = 1;\r\n      influences[frame] = 0;\r\n\r\n      this.lastFrame = this.currentFrame;\r\n      this.currentFrame = frame;\r\n\r\n    }\r\n\r\n    influences[frame] = (this.currentTime % interpolation) / interpolation;\r\n    influences[this.lastFrame] = 1 - influences[frame];\r\n\r\n  }\r\n\r\n};\r\n\r\n// File:src/extras/geometries/BoxGeometry.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * based on http://papervision3d.googlecode.com/svn/trunk/as3/trunk/src/org/papervision3d/objects/primitives/Cube.as\r\n */\r\n\r\nTHREE.BoxGeometry = function(width, height, depth, widthSegments, heightSegments, depthSegments) {\r\n\r\n  THREE.Geometry.call(this);\r\n\r\n  this.type = 'BoxGeometry';\r\n\r\n  this.parameters = {\r\n    width: width,\r\n    height: height,\r\n    depth: depth,\r\n    widthSegments: widthSegments,\r\n    heightSegments: heightSegments,\r\n    depthSegments: depthSegments\r\n  };\r\n\r\n  this.widthSegments = widthSegments || 1;\r\n  this.heightSegments = heightSegments || 1;\r\n  this.depthSegments = depthSegments || 1;\r\n\r\n  var scope = this;\r\n\r\n  var width_half = width / 2;\r\n  var height_half = height / 2;\r\n  var depth_half = depth / 2;\r\n\r\n  buildPlane('z', 'y', -1, -1, depth, height, width_half, 0); // px\r\n  buildPlane('z', 'y', 1, -1, depth, height, -width_half, 1); // nx\r\n  buildPlane('x', 'z', 1, 1, width, depth, height_half, 2); // py\r\n  buildPlane('x', 'z', 1, -1, width, depth, -height_half, 3); // ny\r\n  buildPlane('x', 'y', 1, -1, width, height, depth_half, 4); // pz\r\n  buildPlane('x', 'y', -1, -1, width, height, -depth_half, 5); // nz\r\n\r\n  function buildPlane(u, v, udir, vdir, width, height, depth, materialIndex) {\r\n\r\n    var w, ix, iy,\r\n      gridX = scope.widthSegments,\r\n      gridY = scope.heightSegments,\r\n      width_half = width / 2,\r\n      height_half = height / 2,\r\n      offset = scope.vertices.length;\r\n\r\n    if ((u === 'x' && v === 'y') || (u === 'y' && v === 'x')) {\r\n\r\n      w = 'z';\r\n\r\n    }\r\n    else if ((u === 'x' && v === 'z') || (u === 'z' && v === 'x')) {\r\n\r\n      w = 'y';\r\n      gridY = scope.depthSegments;\r\n\r\n    }\r\n    else if ((u === 'z' && v === 'y') || (u === 'y' && v === 'z')) {\r\n\r\n      w = 'x';\r\n      gridX = scope.depthSegments;\r\n\r\n    }\r\n\r\n    var gridX1 = gridX + 1,\r\n      gridY1 = gridY + 1,\r\n      segment_width = width / gridX,\r\n      segment_height = height / gridY,\r\n      normal = new THREE.Vector3();\r\n\r\n    normal[w] = depth > 0 ? 1 : -1;\r\n\r\n    for (iy = 0; iy < gridY1; iy++) {\r\n\r\n      for (ix = 0; ix < gridX1; ix++) {\r\n\r\n        var vector = new THREE.Vector3();\r\n        vector[u] = (ix * segment_width - width_half) * udir;\r\n        vector[v] = (iy * segment_height - height_half) * vdir;\r\n        vector[w] = depth;\r\n\r\n        scope.vertices.push(vector);\r\n\r\n      }\r\n\r\n    }\r\n\r\n    for (iy = 0; iy < gridY; iy++) {\r\n\r\n      for (ix = 0; ix < gridX; ix++) {\r\n\r\n        var a = ix + gridX1 * iy;\r\n        var b = ix + gridX1 * (iy + 1);\r\n        var c = (ix + 1) + gridX1 * (iy + 1);\r\n        var d = (ix + 1) + gridX1 * iy;\r\n\r\n        var uva = new THREE.Vector2(ix / gridX, 1 - iy / gridY);\r\n        var uvb = new THREE.Vector2(ix / gridX, 1 - (iy + 1) / gridY);\r\n        var uvc = new THREE.Vector2((ix + 1) / gridX, 1 - (iy + 1) / gridY);\r\n        var uvd = new THREE.Vector2((ix + 1) / gridX, 1 - iy / gridY);\r\n\r\n        var face = new THREE.Face3(a + offset, b + offset, d + offset);\r\n        face.normal.copy(normal);\r\n        face.vertexNormals.push(normal.clone(), normal.clone(), normal.clone());\r\n        face.materialIndex = materialIndex;\r\n\r\n        scope.faces.push(face);\r\n        scope.faceVertexUvs[0].push([uva, uvb, uvd]);\r\n\r\n        face = new THREE.Face3(b + offset, c + offset, d + offset);\r\n        face.normal.copy(normal);\r\n        face.vertexNormals.push(normal.clone(), normal.clone(), normal.clone());\r\n        face.materialIndex = materialIndex;\r\n\r\n        scope.faces.push(face);\r\n        scope.faceVertexUvs[0].push([uvb.clone(), uvc, uvd.clone()]);\r\n\r\n      }\r\n\r\n    }\r\n\r\n  }\r\n\r\n  this.mergeVertices();\r\n\r\n};\r\n\r\nTHREE.BoxGeometry.prototype = Object.create(THREE.Geometry.prototype);\r\nTHREE.BoxGeometry.prototype.constructor = THREE.BoxGeometry;\r\n\r\n// File:src/extras/geometries/CircleGeometry.js\r\n\r\n/**\r\n * @author hughes\r\n */\r\n\r\nTHREE.CircleGeometry = function(radius, segments, thetaStart, thetaLength) {\r\n\r\n  THREE.Geometry.call(this);\r\n\r\n  this.type = 'CircleGeometry';\r\n\r\n  this.parameters = {\r\n    radius: radius,\r\n    segments: segments,\r\n    thetaStart: thetaStart,\r\n    thetaLength: thetaLength\r\n  };\r\n\r\n  radius = radius || 50;\r\n  segments = segments !== undefined ? Math.max(3, segments) : 8;\r\n\r\n  thetaStart = thetaStart !== undefined ? thetaStart : 0;\r\n  thetaLength = thetaLength !== undefined ? thetaLength : Math.PI * 2;\r\n\r\n  var i, uvs = [],\r\n    center = new THREE.Vector3(),\r\n    centerUV = new THREE.Vector2(0.5, 0.5);\r\n\r\n  this.vertices.push(center);\r\n  uvs.push(centerUV);\r\n\r\n  for (i = 0; i <= segments; i++) {\r\n\r\n    var vertex = new THREE.Vector3();\r\n    var segment = thetaStart + i / segments * thetaLength;\r\n\r\n    vertex.x = radius * Math.cos(segment);\r\n    vertex.y = radius * Math.sin(segment);\r\n\r\n    this.vertices.push(vertex);\r\n    uvs.push(new THREE.Vector2((vertex.x / radius + 1) / 2, (vertex.y / radius + 1) / 2));\r\n\r\n  }\r\n\r\n  var n = new THREE.Vector3(0, 0, 1);\r\n\r\n  for (i = 1; i <= segments; i++) {\r\n\r\n    this.faces.push(new THREE.Face3(i, i + 1, 0, [n.clone(), n.clone(), n.clone()]));\r\n    this.faceVertexUvs[0].push([uvs[i].clone(), uvs[i + 1].clone(), centerUV.clone()]);\r\n\r\n  }\r\n\r\n  this.computeFaceNormals();\r\n\r\n  this.boundingSphere = new THREE.Sphere(new THREE.Vector3(), radius);\r\n\r\n};\r\n\r\nTHREE.CircleGeometry.prototype = Object.create(THREE.Geometry.prototype);\r\nTHREE.CircleGeometry.prototype.constructor = THREE.CircleGeometry;\r\n\r\n// File:src/extras/geometries/CubeGeometry.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\n\r\nTHREE.CubeGeometry = function(width, height, depth, widthSegments, heightSegments, depthSegments) {\r\n\r\n  THREE.warn('THREE.CubeGeometry has been renamed to THREE.BoxGeometry.');\r\n  return new THREE.BoxGeometry(width, height, depth, widthSegments, heightSegments, depthSegments);\r\n\r\n};\r\n\r\n// File:src/extras/geometries/CylinderGeometry.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.CylinderGeometry = function(radiusTop, radiusBottom, height, radialSegments, heightSegments, openEnded, thetaStart, thetaLength) {\r\n\r\n  THREE.Geometry.call(this);\r\n\r\n  this.type = 'CylinderGeometry';\r\n\r\n  this.parameters = {\r\n    radiusTop: radiusTop,\r\n    radiusBottom: radiusBottom,\r\n    height: height,\r\n    radialSegments: radialSegments,\r\n    heightSegments: heightSegments,\r\n    openEnded: openEnded,\r\n    thetaStart: thetaStart,\r\n    thetaLength: thetaLength\r\n  };\r\n\r\n  radiusTop = radiusTop !== undefined ? radiusTop : 20;\r\n  radiusBottom = radiusBottom !== undefined ? radiusBottom : 20;\r\n  height = height !== undefined ? height : 100;\r\n\r\n  radialSegments = radialSegments || 8;\r\n  heightSegments = heightSegments || 1;\r\n\r\n  openEnded = openEnded !== undefined ? openEnded : false;\r\n  thetaStart = thetaStart !== undefined ? thetaStart : 0;\r\n  thetaLength = thetaLength !== undefined ? thetaLength : 2 * Math.PI;\r\n\r\n  var heightHalf = height / 2;\r\n\r\n  var x, y, vertices = [],\r\n    uvs = [];\r\n\r\n  for (y = 0; y <= heightSegments; y++) {\r\n\r\n    var verticesRow = [];\r\n    var uvsRow = [];\r\n\r\n    var v = y / heightSegments;\r\n    var radius = v * (radiusBottom - radiusTop) + radiusTop;\r\n\r\n    for (x = 0; x <= radialSegments; x++) {\r\n\r\n      var u = x / radialSegments;\r\n\r\n      var vertex = new THREE.Vector3();\r\n      vertex.x = radius * Math.sin(u * thetaLength + thetaStart);\r\n      vertex.y = -v * height + heightHalf;\r\n      vertex.z = radius * Math.cos(u * thetaLength + thetaStart);\r\n\r\n      this.vertices.push(vertex);\r\n\r\n      verticesRow.push(this.vertices.length - 1);\r\n      uvsRow.push(new THREE.Vector2(u, 1 - v));\r\n\r\n    }\r\n\r\n    vertices.push(verticesRow);\r\n    uvs.push(uvsRow);\r\n\r\n  }\r\n\r\n  var tanTheta = (radiusBottom - radiusTop) / height;\r\n  var na, nb;\r\n\r\n  for (x = 0; x < radialSegments; x++) {\r\n\r\n    if (radiusTop !== 0) {\r\n\r\n      na = this.vertices[vertices[0][x]].clone();\r\n      nb = this.vertices[vertices[0][x + 1]].clone();\r\n\r\n    }\r\n    else {\r\n\r\n      na = this.vertices[vertices[1][x]].clone();\r\n      nb = this.vertices[vertices[1][x + 1]].clone();\r\n\r\n    }\r\n\r\n    na.setY(Math.sqrt(na.x * na.x + na.z * na.z) * tanTheta).normalize();\r\n    nb.setY(Math.sqrt(nb.x * nb.x + nb.z * nb.z) * tanTheta).normalize();\r\n\r\n    for (y = 0; y < heightSegments; y++) {\r\n\r\n      var v1 = vertices[y][x];\r\n      var v2 = vertices[y + 1][x];\r\n      var v3 = vertices[y + 1][x + 1];\r\n      var v4 = vertices[y][x + 1];\r\n\r\n      var n1 = na.clone();\r\n      var n2 = na.clone();\r\n      var n3 = nb.clone();\r\n      var n4 = nb.clone();\r\n\r\n      var uv1 = uvs[y][x].clone();\r\n      var uv2 = uvs[y + 1][x].clone();\r\n      var uv3 = uvs[y + 1][x + 1].clone();\r\n      var uv4 = uvs[y][x + 1].clone();\r\n\r\n      this.faces.push(new THREE.Face3(v1, v2, v4, [n1, n2, n4]));\r\n      this.faceVertexUvs[0].push([uv1, uv2, uv4]);\r\n\r\n      this.faces.push(new THREE.Face3(v2, v3, v4, [n2.clone(), n3, n4.clone()]));\r\n      this.faceVertexUvs[0].push([uv2.clone(), uv3, uv4.clone()]);\r\n\r\n    }\r\n\r\n  }\r\n\r\n  // top cap\r\n\r\n  if (openEnded === false && radiusTop > 0) {\r\n\r\n    this.vertices.push(new THREE.Vector3(0, heightHalf, 0));\r\n\r\n    for (x = 0; x < radialSegments; x++) {\r\n\r\n      var v1 = vertices[0][x];\r\n      var v2 = vertices[0][x + 1];\r\n      var v3 = this.vertices.length - 1;\r\n\r\n      var n1 = new THREE.Vector3(0, 1, 0);\r\n      var n2 = new THREE.Vector3(0, 1, 0);\r\n      var n3 = new THREE.Vector3(0, 1, 0);\r\n\r\n      var uv1 = uvs[0][x].clone();\r\n      var uv2 = uvs[0][x + 1].clone();\r\n      var uv3 = new THREE.Vector2(uv2.x, 0);\r\n\r\n      this.faces.push(new THREE.Face3(v1, v2, v3, [n1, n2, n3]));\r\n      this.faceVertexUvs[0].push([uv1, uv2, uv3]);\r\n\r\n    }\r\n\r\n  }\r\n\r\n  // bottom cap\r\n\r\n  if (openEnded === false && radiusBottom > 0) {\r\n\r\n    this.vertices.push(new THREE.Vector3(0, -heightHalf, 0));\r\n\r\n    for (x = 0; x < radialSegments; x++) {\r\n\r\n      var v1 = vertices[heightSegments][x + 1];\r\n      var v2 = vertices[heightSegments][x];\r\n      var v3 = this.vertices.length - 1;\r\n\r\n      var n1 = new THREE.Vector3(0, -1, 0);\r\n      var n2 = new THREE.Vector3(0, -1, 0);\r\n      var n3 = new THREE.Vector3(0, -1, 0);\r\n\r\n      var uv1 = uvs[heightSegments][x + 1].clone();\r\n      var uv2 = uvs[heightSegments][x].clone();\r\n      var uv3 = new THREE.Vector2(uv2.x, 1);\r\n\r\n      this.faces.push(new THREE.Face3(v1, v2, v3, [n1, n2, n3]));\r\n      this.faceVertexUvs[0].push([uv1, uv2, uv3]);\r\n\r\n    }\r\n\r\n  }\r\n\r\n  this.computeFaceNormals();\r\n\r\n};\r\n\r\nTHREE.CylinderGeometry.prototype = Object.create(THREE.Geometry.prototype);\r\nTHREE.CylinderGeometry.prototype.constructor = THREE.CylinderGeometry;\r\n\r\n// File:src/extras/geometries/ExtrudeGeometry.js\r\n\r\n/**\r\n * @author zz85 / http://www.lab4games.net/zz85/blog\r\n *\r\n * Creates extruded geometry from a path shape.\r\n *\r\n * parameters = {\r\n *\r\n *  curveSegments: <int>, // number of points on the curves\r\n *  steps: <int>, // number of points for z-side extrusions / used for subdividing segements of extrude spline too\r\n *  amount: <int>, // Depth to extrude the shape\r\n *\r\n *  bevelEnabled: <bool>, // turn on bevel\r\n *  bevelThickness: <float>, // how deep into the original shape bevel goes\r\n *  bevelSize: <float>, // how far from shape outline is bevel\r\n *  bevelSegments: <int>, // number of bevel layers\r\n *\r\n *  extrudePath: <THREE.CurvePath> // 3d spline path to extrude shape along. (creates Frames if .frames aren't defined)\r\n *  frames: <THREE.TubeGeometry.FrenetFrames> // containing arrays of tangents, normals, binormals\r\n *\r\n *  material: <int> // material index for front and back faces\r\n *  extrudeMaterial: <int> // material index for extrusion and beveled faces\r\n *  uvGenerator: <Object> // object that provides UV generator functions\r\n *\r\n * }\r\n **/\r\n\r\nTHREE.ExtrudeGeometry = function(shapes, options) {\r\n\r\n  if (typeof(shapes) === \"undefined\") {\r\n    shapes = [];\r\n    return;\r\n  }\r\n\r\n  THREE.Geometry.call(this);\r\n\r\n  this.type = 'ExtrudeGeometry';\r\n\r\n  shapes = shapes instanceof Array ? shapes : [shapes];\r\n\r\n  this.addShapeList(shapes, options);\r\n\r\n  this.computeFaceNormals();\r\n\r\n  // can't really use automatic vertex normals\r\n  // as then front and back sides get smoothed too\r\n  // should do separate smoothing just for sides\r\n\r\n  //this.computeVertexNormals();\r\n\r\n  //console.log( \"took\", ( Date.now() - startTime ) );\r\n\r\n};\r\n\r\nTHREE.ExtrudeGeometry.prototype = Object.create(THREE.Geometry.prototype);\r\nTHREE.ExtrudeGeometry.prototype.constructor = THREE.ExtrudeGeometry;\r\n\r\nTHREE.ExtrudeGeometry.prototype.addShapeList = function(shapes, options) {\r\n  var sl = shapes.length;\r\n\r\n  for (var s = 0; s < sl; s++) {\r\n    var shape = shapes[s];\r\n    this.addShape(shape, options);\r\n  }\r\n};\r\n\r\nTHREE.ExtrudeGeometry.prototype.addShape = function(shape, options) {\r\n\r\n  var amount = options.amount !== undefined ? options.amount : 100;\r\n\r\n  var bevelThickness = options.bevelThickness !== undefined ? options.bevelThickness : 6; // 10\r\n  var bevelSize = options.bevelSize !== undefined ? options.bevelSize : bevelThickness - 2; // 8\r\n  var bevelSegments = options.bevelSegments !== undefined ? options.bevelSegments : 3;\r\n\r\n  var bevelEnabled = options.bevelEnabled !== undefined ? options.bevelEnabled : true; // false\r\n\r\n  var curveSegments = options.curveSegments !== undefined ? options.curveSegments : 12;\r\n\r\n  var steps = options.steps !== undefined ? options.steps : 1;\r\n\r\n  var extrudePath = options.extrudePath;\r\n  var extrudePts, extrudeByPath = false;\r\n\r\n  var material = options.material;\r\n  var extrudeMaterial = options.extrudeMaterial;\r\n\r\n  // Use default WorldUVGenerator if no UV generators are specified.\r\n  var uvgen = options.UVGenerator !== undefined ? options.UVGenerator : THREE.ExtrudeGeometry.WorldUVGenerator;\r\n\r\n  var splineTube, binormal, normal, position2;\r\n  if (extrudePath) {\r\n\r\n    extrudePts = extrudePath.getSpacedPoints(steps);\r\n\r\n    extrudeByPath = true;\r\n    bevelEnabled = false; // bevels not supported for path extrusion\r\n\r\n    // SETUP TNB variables\r\n\r\n    // Reuse TNB from TubeGeomtry for now.\r\n    // TODO1 - have a .isClosed in spline?\r\n\r\n    splineTube = options.frames !== undefined ? options.frames : new THREE.TubeGeometry.FrenetFrames(extrudePath, steps, false);\r\n\r\n    // console.log(splineTube, 'splineTube', splineTube.normals.length, 'steps', steps, 'extrudePts', extrudePts.length);\r\n\r\n    binormal = new THREE.Vector3();\r\n    normal = new THREE.Vector3();\r\n    position2 = new THREE.Vector3();\r\n\r\n  }\r\n\r\n  // Safeguards if bevels are not enabled\r\n\r\n  if (!bevelEnabled) {\r\n\r\n    bevelSegments = 0;\r\n    bevelThickness = 0;\r\n    bevelSize = 0;\r\n\r\n  }\r\n\r\n  // Variables initalization\r\n\r\n  var ahole, h, hl; // looping of holes\r\n  var scope = this;\r\n\r\n  var shapesOffset = this.vertices.length;\r\n\r\n  var shapePoints = shape.extractPoints(curveSegments);\r\n\r\n  var vertices = shapePoints.shape;\r\n  var holes = shapePoints.holes;\r\n\r\n  var reverse = !THREE.Shape.Utils.isClockWise(vertices);\r\n\r\n  if (reverse) {\r\n\r\n    vertices = vertices.reverse();\r\n\r\n    // Maybe we should also check if holes are in the opposite direction, just to be safe ...\r\n\r\n    for (h = 0, hl = holes.length; h < hl; h++) {\r\n\r\n      ahole = holes[h];\r\n\r\n      if (THREE.Shape.Utils.isClockWise(ahole)) {\r\n\r\n        holes[h] = ahole.reverse();\r\n\r\n      }\r\n\r\n    }\r\n\r\n    reverse = false; // If vertices are in order now, we shouldn't need to worry about them again (hopefully)!\r\n\r\n  }\r\n\r\n\r\n  var faces = THREE.Shape.Utils.triangulateShape(vertices, holes);\r\n\r\n  /* Vertices */\r\n\r\n  var contour = vertices; // vertices has all points but contour has only points of circumference\r\n\r\n  for (h = 0, hl = holes.length; h < hl; h++) {\r\n\r\n    ahole = holes[h];\r\n\r\n    vertices = vertices.concat(ahole);\r\n\r\n  }\r\n\r\n\r\n  function scalePt2(pt, vec, size) {\r\n\r\n    if (!vec) THREE.error(\"THREE.ExtrudeGeometry: vec does not exist\");\r\n\r\n    return vec.clone().multiplyScalar(size).add(pt);\r\n\r\n  }\r\n\r\n  var b, bs, t, z,\r\n    vert, vlen = vertices.length,\r\n    face, flen = faces.length;\r\n\r\n\r\n  // Find directions for point movement\r\n\r\n\r\n  function getBevelVec(inPt, inPrev, inNext) {\r\n\r\n    var EPSILON = 0.0000000001;\r\n\r\n    // computes for inPt the corresponding point inPt' on a new contour\r\n    //   shiftet by 1 unit (length of normalized vector) to the left\r\n    // if we walk along contour clockwise, this new contour is outside the old one\r\n    //\r\n    // inPt' is the intersection of the two lines parallel to the two\r\n    //  adjacent edges of inPt at a distance of 1 unit on the left side.\r\n\r\n    var v_trans_x, v_trans_y, shrink_by = 1; // resulting translation vector for inPt\r\n\r\n    // good reading for geometry algorithms (here: line-line intersection)\r\n    // http://geomalgorithms.com/a05-_intersect-1.html\r\n\r\n    var v_prev_x = inPt.x - inPrev.x,\r\n      v_prev_y = inPt.y - inPrev.y;\r\n    var v_next_x = inNext.x - inPt.x,\r\n      v_next_y = inNext.y - inPt.y;\r\n\r\n    var v_prev_lensq = (v_prev_x * v_prev_x + v_prev_y * v_prev_y);\r\n\r\n    // check for colinear edges\r\n    var colinear0 = (v_prev_x * v_next_y - v_prev_y * v_next_x);\r\n\r\n    if (Math.abs(colinear0) > EPSILON) { // not colinear\r\n\r\n      // length of vectors for normalizing\r\n\r\n      var v_prev_len = Math.sqrt(v_prev_lensq);\r\n      var v_next_len = Math.sqrt(v_next_x * v_next_x + v_next_y * v_next_y);\r\n\r\n      // shift adjacent points by unit vectors to the left\r\n\r\n      var ptPrevShift_x = (inPrev.x - v_prev_y / v_prev_len);\r\n      var ptPrevShift_y = (inPrev.y + v_prev_x / v_prev_len);\r\n\r\n      var ptNextShift_x = (inNext.x - v_next_y / v_next_len);\r\n      var ptNextShift_y = (inNext.y + v_next_x / v_next_len);\r\n\r\n      // scaling factor for v_prev to intersection point\r\n\r\n      var sf = ((ptNextShift_x - ptPrevShift_x) * v_next_y -\r\n          (ptNextShift_y - ptPrevShift_y) * v_next_x) /\r\n        (v_prev_x * v_next_y - v_prev_y * v_next_x);\r\n\r\n      // vector from inPt to intersection point\r\n\r\n      v_trans_x = (ptPrevShift_x + v_prev_x * sf - inPt.x);\r\n      v_trans_y = (ptPrevShift_y + v_prev_y * sf - inPt.y);\r\n\r\n      // Don't normalize!, otherwise sharp corners become ugly\r\n      //  but prevent crazy spikes\r\n      var v_trans_lensq = (v_trans_x * v_trans_x + v_trans_y * v_trans_y)\r\n      if (v_trans_lensq <= 2) {\r\n        return new THREE.Vector2(v_trans_x, v_trans_y);\r\n      }\r\n      else {\r\n        shrink_by = Math.sqrt(v_trans_lensq / 2);\r\n      }\r\n\r\n    }\r\n    else { // handle special case of colinear edges\r\n\r\n      var direction_eq = false; // assumes: opposite\r\n      if (v_prev_x > EPSILON) {\r\n        if (v_next_x > EPSILON) {\r\n          direction_eq = true;\r\n        }\r\n      }\r\n      else {\r\n        if (v_prev_x < -EPSILON) {\r\n          if (v_next_x < -EPSILON) {\r\n            direction_eq = true;\r\n          }\r\n        }\r\n        else {\r\n          if (Math.sign(v_prev_y) == Math.sign(v_next_y)) {\r\n            direction_eq = true;\r\n          }\r\n        }\r\n      }\r\n\r\n      if (direction_eq) {\r\n        // console.log(\"Warning: lines are a straight sequence\");\r\n        v_trans_x = -v_prev_y;\r\n        v_trans_y = v_prev_x;\r\n        shrink_by = Math.sqrt(v_prev_lensq);\r\n      }\r\n      else {\r\n        // console.log(\"Warning: lines are a straight spike\");\r\n        v_trans_x = v_prev_x;\r\n        v_trans_y = v_prev_y;\r\n        shrink_by = Math.sqrt(v_prev_lensq / 2);\r\n      }\r\n\r\n    }\r\n\r\n    return new THREE.Vector2(v_trans_x / shrink_by, v_trans_y / shrink_by);\r\n\r\n  }\r\n\r\n\r\n  var contourMovements = [];\r\n\r\n  for (var i = 0, il = contour.length, j = il - 1, k = i + 1; i < il; i++, j++, k++) {\r\n\r\n    if (j === il) j = 0;\r\n    if (k === il) k = 0;\r\n\r\n    //  (j)---(i)---(k)\r\n    // console.log('i,j,k', i, j , k)\r\n\r\n    contourMovements[i] = getBevelVec(contour[i], contour[j], contour[k]);\r\n\r\n  }\r\n\r\n  var holesMovements = [],\r\n    oneHoleMovements, verticesMovements = contourMovements.concat();\r\n\r\n  for (h = 0, hl = holes.length; h < hl; h++) {\r\n\r\n    ahole = holes[h];\r\n\r\n    oneHoleMovements = [];\r\n\r\n    for (i = 0, il = ahole.length, j = il - 1, k = i + 1; i < il; i++, j++, k++) {\r\n\r\n      if (j === il) j = 0;\r\n      if (k === il) k = 0;\r\n\r\n      //  (j)---(i)---(k)\r\n      oneHoleMovements[i] = getBevelVec(ahole[i], ahole[j], ahole[k]);\r\n\r\n    }\r\n\r\n    holesMovements.push(oneHoleMovements);\r\n    verticesMovements = verticesMovements.concat(oneHoleMovements);\r\n\r\n  }\r\n\r\n\r\n  // Loop bevelSegments, 1 for the front, 1 for the back\r\n\r\n  for (b = 0; b < bevelSegments; b++) {\r\n    //for ( b = bevelSegments; b > 0; b -- ) {\r\n\r\n    t = b / bevelSegments;\r\n    z = bevelThickness * (1 - t);\r\n\r\n    //z = bevelThickness * t;\r\n    bs = bevelSize * (Math.sin(t * Math.PI / 2)); // curved\r\n    //bs = bevelSize * t ; // linear\r\n\r\n    // contract shape\r\n\r\n    for (i = 0, il = contour.length; i < il; i++) {\r\n\r\n      vert = scalePt2(contour[i], contourMovements[i], bs);\r\n\r\n      v(vert.x, vert.y, -z);\r\n\r\n    }\r\n\r\n    // expand holes\r\n\r\n    for (h = 0, hl = holes.length; h < hl; h++) {\r\n\r\n      ahole = holes[h];\r\n      oneHoleMovements = holesMovements[h];\r\n\r\n      for (i = 0, il = ahole.length; i < il; i++) {\r\n\r\n        vert = scalePt2(ahole[i], oneHoleMovements[i], bs);\r\n\r\n        v(vert.x, vert.y, -z);\r\n\r\n      }\r\n\r\n    }\r\n\r\n  }\r\n\r\n  bs = bevelSize;\r\n\r\n  // Back facing vertices\r\n\r\n  for (i = 0; i < vlen; i++) {\r\n\r\n    vert = bevelEnabled ? scalePt2(vertices[i], verticesMovements[i], bs) : vertices[i];\r\n\r\n    if (!extrudeByPath) {\r\n\r\n      v(vert.x, vert.y, 0);\r\n\r\n    }\r\n    else {\r\n\r\n      // v( vert.x, vert.y + extrudePts[ 0 ].y, extrudePts[ 0 ].x );\r\n\r\n      normal.copy(splineTube.normals[0]).multiplyScalar(vert.x);\r\n      binormal.copy(splineTube.binormals[0]).multiplyScalar(vert.y);\r\n\r\n      position2.copy(extrudePts[0]).add(normal).add(binormal);\r\n\r\n      v(position2.x, position2.y, position2.z);\r\n\r\n    }\r\n\r\n  }\r\n\r\n  // Add stepped vertices...\r\n  // Including front facing vertices\r\n\r\n  var s;\r\n\r\n  for (s = 1; s <= steps; s++) {\r\n\r\n    for (i = 0; i < vlen; i++) {\r\n\r\n      vert = bevelEnabled ? scalePt2(vertices[i], verticesMovements[i], bs) : vertices[i];\r\n\r\n      if (!extrudeByPath) {\r\n\r\n        v(vert.x, vert.y, amount / steps * s);\r\n\r\n      }\r\n      else {\r\n\r\n        // v( vert.x, vert.y + extrudePts[ s - 1 ].y, extrudePts[ s - 1 ].x );\r\n\r\n        normal.copy(splineTube.normals[s]).multiplyScalar(vert.x);\r\n        binormal.copy(splineTube.binormals[s]).multiplyScalar(vert.y);\r\n\r\n        position2.copy(extrudePts[s]).add(normal).add(binormal);\r\n\r\n        v(position2.x, position2.y, position2.z);\r\n\r\n      }\r\n\r\n    }\r\n\r\n  }\r\n\r\n\r\n  // Add bevel segments planes\r\n\r\n  //for ( b = 1; b <= bevelSegments; b ++ ) {\r\n  for (b = bevelSegments - 1; b >= 0; b--) {\r\n\r\n    t = b / bevelSegments;\r\n    z = bevelThickness * (1 - t);\r\n    //bs = bevelSize * ( 1-Math.sin ( ( 1 - t ) * Math.PI/2 ) );\r\n    bs = bevelSize * Math.sin(t * Math.PI / 2);\r\n\r\n    // contract shape\r\n\r\n    for (i = 0, il = contour.length; i < il; i++) {\r\n\r\n      vert = scalePt2(contour[i], contourMovements[i], bs);\r\n      v(vert.x, vert.y, amount + z);\r\n\r\n    }\r\n\r\n    // expand holes\r\n\r\n    for (h = 0, hl = holes.length; h < hl; h++) {\r\n\r\n      ahole = holes[h];\r\n      oneHoleMovements = holesMovements[h];\r\n\r\n      for (i = 0, il = ahole.length; i < il; i++) {\r\n\r\n        vert = scalePt2(ahole[i], oneHoleMovements[i], bs);\r\n\r\n        if (!extrudeByPath) {\r\n\r\n          v(vert.x, vert.y, amount + z);\r\n\r\n        }\r\n        else {\r\n\r\n          v(vert.x, vert.y + extrudePts[steps - 1].y, extrudePts[steps - 1].x + z);\r\n\r\n        }\r\n\r\n      }\r\n\r\n    }\r\n\r\n  }\r\n\r\n  /* Faces */\r\n\r\n  // Top and bottom faces\r\n\r\n  buildLidFaces();\r\n\r\n  // Sides faces\r\n\r\n  buildSideFaces();\r\n\r\n\r\n  /////  Internal functions\r\n\r\n  function buildLidFaces() {\r\n\r\n    if (bevelEnabled) {\r\n\r\n      var layer = 0; // steps + 1\r\n      var offset = vlen * layer;\r\n\r\n      // Bottom faces\r\n\r\n      for (i = 0; i < flen; i++) {\r\n\r\n        face = faces[i];\r\n        f3(face[2] + offset, face[1] + offset, face[0] + offset);\r\n\r\n      }\r\n\r\n      layer = steps + bevelSegments * 2;\r\n      offset = vlen * layer;\r\n\r\n      // Top faces\r\n\r\n      for (i = 0; i < flen; i++) {\r\n\r\n        face = faces[i];\r\n        f3(face[0] + offset, face[1] + offset, face[2] + offset);\r\n\r\n      }\r\n\r\n    }\r\n    else {\r\n\r\n      // Bottom faces\r\n\r\n      for (i = 0; i < flen; i++) {\r\n\r\n        face = faces[i];\r\n        f3(face[2], face[1], face[0]);\r\n\r\n      }\r\n\r\n      // Top faces\r\n\r\n      for (i = 0; i < flen; i++) {\r\n\r\n        face = faces[i];\r\n        f3(face[0] + vlen * steps, face[1] + vlen * steps, face[2] + vlen * steps);\r\n\r\n      }\r\n    }\r\n\r\n  }\r\n\r\n  // Create faces for the z-sides of the shape\r\n\r\n  function buildSideFaces() {\r\n\r\n    var layeroffset = 0;\r\n    sidewalls(contour, layeroffset);\r\n    layeroffset += contour.length;\r\n\r\n    for (h = 0, hl = holes.length; h < hl; h++) {\r\n\r\n      ahole = holes[h];\r\n      sidewalls(ahole, layeroffset);\r\n\r\n      //, true\r\n      layeroffset += ahole.length;\r\n\r\n    }\r\n\r\n  }\r\n\r\n  function sidewalls(contour, layeroffset) {\r\n\r\n    var j, k;\r\n    i = contour.length;\r\n\r\n    while (--i >= 0) {\r\n\r\n      j = i;\r\n      k = i - 1;\r\n      if (k < 0) k = contour.length - 1;\r\n\r\n      //console.log('b', i,j, i-1, k,vertices.length);\r\n\r\n      var s = 0,\r\n        sl = steps + bevelSegments * 2;\r\n\r\n      for (s = 0; s < sl; s++) {\r\n\r\n        var slen1 = vlen * s;\r\n        var slen2 = vlen * (s + 1);\r\n\r\n        var a = layeroffset + j + slen1,\r\n          b = layeroffset + k + slen1,\r\n          c = layeroffset + k + slen2,\r\n          d = layeroffset + j + slen2;\r\n\r\n        f4(a, b, c, d, contour, s, sl, j, k);\r\n\r\n      }\r\n    }\r\n\r\n  }\r\n\r\n\r\n  function v(x, y, z) {\r\n\r\n    scope.vertices.push(new THREE.Vector3(x, y, z));\r\n\r\n  }\r\n\r\n  function f3(a, b, c) {\r\n\r\n    a += shapesOffset;\r\n    b += shapesOffset;\r\n    c += shapesOffset;\r\n\r\n    // normal, color, material\r\n    scope.faces.push(new THREE.Face3(a, b, c, null, null, material));\r\n\r\n    var uvs = uvgen.generateTopUV(scope, a, b, c);\r\n\r\n    scope.faceVertexUvs[0].push(uvs);\r\n\r\n  }\r\n\r\n  function f4(a, b, c, d, wallContour, stepIndex, stepsLength, contourIndex1, contourIndex2) {\r\n\r\n    a += shapesOffset;\r\n    b += shapesOffset;\r\n    c += shapesOffset;\r\n    d += shapesOffset;\r\n\r\n    scope.faces.push(new THREE.Face3(a, b, d, null, null, extrudeMaterial));\r\n    scope.faces.push(new THREE.Face3(b, c, d, null, null, extrudeMaterial));\r\n\r\n    var uvs = uvgen.generateSideWallUV(scope, a, b, c, d);\r\n\r\n    scope.faceVertexUvs[0].push([uvs[0], uvs[1], uvs[3]]);\r\n    scope.faceVertexUvs[0].push([uvs[1], uvs[2], uvs[3]]);\r\n\r\n  }\r\n\r\n};\r\n\r\nTHREE.ExtrudeGeometry.WorldUVGenerator = {\r\n\r\n  generateTopUV: function(geometry, indexA, indexB, indexC) {\r\n\r\n    var vertices = geometry.vertices;\r\n\r\n    var a = vertices[indexA];\r\n    var b = vertices[indexB];\r\n    var c = vertices[indexC];\r\n\r\n    return [\r\n      new THREE.Vector2(a.x, a.y),\r\n      new THREE.Vector2(b.x, b.y),\r\n      new THREE.Vector2(c.x, c.y)\r\n    ];\r\n\r\n  },\r\n\r\n  generateSideWallUV: function(geometry, indexA, indexB, indexC, indexD) {\r\n\r\n    var vertices = geometry.vertices;\r\n\r\n    var a = vertices[indexA];\r\n    var b = vertices[indexB];\r\n    var c = vertices[indexC];\r\n    var d = vertices[indexD];\r\n\r\n    if (Math.abs(a.y - b.y) < 0.01) {\r\n      return [\r\n        new THREE.Vector2(a.x, 1 - a.z),\r\n        new THREE.Vector2(b.x, 1 - b.z),\r\n        new THREE.Vector2(c.x, 1 - c.z),\r\n        new THREE.Vector2(d.x, 1 - d.z)\r\n      ];\r\n    }\r\n    else {\r\n      return [\r\n        new THREE.Vector2(a.y, 1 - a.z),\r\n        new THREE.Vector2(b.y, 1 - b.z),\r\n        new THREE.Vector2(c.y, 1 - c.z),\r\n        new THREE.Vector2(d.y, 1 - d.z)\r\n      ];\r\n    }\r\n  }\r\n};\r\n\r\n// File:src/extras/geometries/ShapeGeometry.js\r\n\r\n/**\r\n * @author jonobr1 / http://jonobr1.com\r\n *\r\n * Creates a one-sided polygonal geometry from a path shape. Similar to\r\n * ExtrudeGeometry.\r\n *\r\n * parameters = {\r\n *\r\n *\tcurveSegments: <int>, // number of points on the curves. NOT USED AT THE MOMENT.\r\n *\r\n *\tmaterial: <int> // material index for front and back faces\r\n *\tuvGenerator: <Object> // object that provides UV generator functions\r\n *\r\n * }\r\n **/\r\n\r\nTHREE.ShapeGeometry = function(shapes, options) {\r\n\r\n  THREE.Geometry.call(this);\r\n\r\n  this.type = 'ShapeGeometry';\r\n\r\n  if (shapes instanceof Array === false) shapes = [shapes];\r\n\r\n  this.addShapeList(shapes, options);\r\n\r\n  this.computeFaceNormals();\r\n\r\n};\r\n\r\nTHREE.ShapeGeometry.prototype = Object.create(THREE.Geometry.prototype);\r\nTHREE.ShapeGeometry.prototype.constructor = THREE.ShapeGeometry;\r\n\r\n/**\r\n * Add an array of shapes to THREE.ShapeGeometry.\r\n */\r\nTHREE.ShapeGeometry.prototype.addShapeList = function(shapes, options) {\r\n\r\n  for (var i = 0, l = shapes.length; i < l; i++) {\r\n\r\n    this.addShape(shapes[i], options);\r\n\r\n  }\r\n\r\n  return this;\r\n\r\n};\r\n\r\n/**\r\n * Adds a shape to THREE.ShapeGeometry, based on THREE.ExtrudeGeometry.\r\n */\r\nTHREE.ShapeGeometry.prototype.addShape = function(shape, options) {\r\n\r\n  if (options === undefined) options = {};\r\n  var curveSegments = options.curveSegments !== undefined ? options.curveSegments : 12;\r\n\r\n  var material = options.material;\r\n  var uvgen = options.UVGenerator === undefined ? THREE.ExtrudeGeometry.WorldUVGenerator : options.UVGenerator;\r\n\r\n  //\r\n\r\n  var i, l, hole;\r\n\r\n  var shapesOffset = this.vertices.length;\r\n  var shapePoints = shape.extractPoints(curveSegments);\r\n\r\n  var vertices = shapePoints.shape;\r\n  var holes = shapePoints.holes;\r\n\r\n  var reverse = !THREE.Shape.Utils.isClockWise(vertices);\r\n\r\n  if (reverse) {\r\n\r\n    vertices = vertices.reverse();\r\n\r\n    // Maybe we should also check if holes are in the opposite direction, just to be safe...\r\n\r\n    for (i = 0, l = holes.length; i < l; i++) {\r\n\r\n      hole = holes[i];\r\n\r\n      if (THREE.Shape.Utils.isClockWise(hole)) {\r\n\r\n        holes[i] = hole.reverse();\r\n\r\n      }\r\n\r\n    }\r\n\r\n    reverse = false;\r\n\r\n  }\r\n\r\n  var faces = THREE.Shape.Utils.triangulateShape(vertices, holes);\r\n\r\n  // Vertices\r\n\r\n  var contour = vertices;\r\n\r\n  for (i = 0, l = holes.length; i < l; i++) {\r\n\r\n    hole = holes[i];\r\n    vertices = vertices.concat(hole);\r\n\r\n  }\r\n\r\n  //\r\n\r\n  var vert, vlen = vertices.length;\r\n  var face, flen = faces.length;\r\n\r\n  for (i = 0; i < vlen; i++) {\r\n\r\n    vert = vertices[i];\r\n\r\n    this.vertices.push(new THREE.Vector3(vert.x, vert.y, 0));\r\n\r\n  }\r\n\r\n  for (i = 0; i < flen; i++) {\r\n\r\n    face = faces[i];\r\n\r\n    var a = face[0] + shapesOffset;\r\n    var b = face[1] + shapesOffset;\r\n    var c = face[2] + shapesOffset;\r\n\r\n    this.faces.push(new THREE.Face3(a, b, c, null, null, material));\r\n    this.faceVertexUvs[0].push(uvgen.generateTopUV(this, a, b, c));\r\n\r\n  }\r\n\r\n};\r\n\r\n// File:src/extras/geometries/LatheGeometry.js\r\n\r\n/**\r\n * @author astrodud / http://astrodud.isgreat.org/\r\n * @author zz85 / https://github.com/zz85\r\n * @author bhouston / http://exocortex.com\r\n */\r\n\r\n// points - to create a closed torus, one must use a set of points \r\n//    like so: [ a, b, c, d, a ], see first is the same as last.\r\n// segments - the number of circumference segments to create\r\n// phiStart - the starting radian\r\n// phiLength - the radian (0 to 2*PI) range of the lathed section\r\n//    2*pi is a closed lathe, less than 2PI is a portion.\r\n\r\nTHREE.LatheGeometry = function(points, segments, phiStart, phiLength) {\r\n\r\n  THREE.Geometry.call(this);\r\n\r\n  this.type = 'LatheGeometry';\r\n\r\n  this.parameters = {\r\n    points: points,\r\n    segments: segments,\r\n    phiStart: phiStart,\r\n    phiLength: phiLength\r\n  };\r\n\r\n  segments = segments || 12;\r\n  phiStart = phiStart || 0;\r\n  phiLength = phiLength || 2 * Math.PI;\r\n\r\n  var inversePointLength = 1.0 / (points.length - 1);\r\n  var inverseSegments = 1.0 / segments;\r\n\r\n  for (var i = 0, il = segments; i <= il; i++) {\r\n\r\n    var phi = phiStart + i * inverseSegments * phiLength;\r\n\r\n    var c = Math.cos(phi),\r\n      s = Math.sin(phi);\r\n\r\n    for (var j = 0, jl = points.length; j < jl; j++) {\r\n\r\n      var pt = points[j];\r\n\r\n      var vertex = new THREE.Vector3();\r\n\r\n      vertex.x = c * pt.x - s * pt.y;\r\n      vertex.y = s * pt.x + c * pt.y;\r\n      vertex.z = pt.z;\r\n\r\n      this.vertices.push(vertex);\r\n\r\n    }\r\n\r\n  }\r\n\r\n  var np = points.length;\r\n\r\n  for (var i = 0, il = segments; i < il; i++) {\r\n\r\n    for (var j = 0, jl = points.length - 1; j < jl; j++) {\r\n\r\n      var base = j + np * i;\r\n      var a = base;\r\n      var b = base + np;\r\n      var c = base + 1 + np;\r\n      var d = base + 1;\r\n\r\n      var u0 = i * inverseSegments;\r\n      var v0 = j * inversePointLength;\r\n      var u1 = u0 + inverseSegments;\r\n      var v1 = v0 + inversePointLength;\r\n\r\n      this.faces.push(new THREE.Face3(a, b, d));\r\n\r\n      this.faceVertexUvs[0].push([\r\n\r\n        new THREE.Vector2(u0, v0),\r\n        new THREE.Vector2(u1, v0),\r\n        new THREE.Vector2(u0, v1)\r\n\r\n      ]);\r\n\r\n      this.faces.push(new THREE.Face3(b, c, d));\r\n\r\n      this.faceVertexUvs[0].push([\r\n\r\n        new THREE.Vector2(u1, v0),\r\n        new THREE.Vector2(u1, v1),\r\n        new THREE.Vector2(u0, v1)\r\n\r\n      ]);\r\n\r\n\r\n    }\r\n\r\n  }\r\n\r\n  this.mergeVertices();\r\n  this.computeFaceNormals();\r\n  this.computeVertexNormals();\r\n\r\n};\r\n\r\nTHREE.LatheGeometry.prototype = Object.create(THREE.Geometry.prototype);\r\nTHREE.LatheGeometry.prototype.constructor = THREE.LatheGeometry;\r\n\r\n// File:src/extras/geometries/PlaneGeometry.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * based on http://papervision3d.googlecode.com/svn/trunk/as3/trunk/src/org/papervision3d/objects/primitives/Plane.as\r\n */\r\n\r\nTHREE.PlaneGeometry = function(width, height, widthSegments, heightSegments) {\r\n\r\n  console.info('THREE.PlaneGeometry: Consider using THREE.PlaneBufferGeometry for lower memory footprint.');\r\n\r\n  THREE.Geometry.call(this);\r\n\r\n  this.type = 'PlaneGeometry';\r\n\r\n  this.parameters = {\r\n    width: width,\r\n    height: height,\r\n    widthSegments: widthSegments,\r\n    heightSegments: heightSegments\r\n  };\r\n\r\n  this.fromBufferGeometry(new THREE.PlaneBufferGeometry(width, height, widthSegments, heightSegments));\r\n\r\n};\r\n\r\nTHREE.PlaneGeometry.prototype = Object.create(THREE.Geometry.prototype);\r\nTHREE.PlaneGeometry.prototype.constructor = THREE.PlaneGeometry;\r\n\r\n// File:src/extras/geometries/PlaneBufferGeometry.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * based on http://papervision3d.googlecode.com/svn/trunk/as3/trunk/src/org/papervision3d/objects/primitives/Plane.as\r\n */\r\n\r\nTHREE.PlaneBufferGeometry = function(width, height, widthSegments, heightSegments) {\r\n\r\n  THREE.BufferGeometry.call(this);\r\n\r\n  this.type = 'PlaneBufferGeometry';\r\n\r\n  this.parameters = {\r\n    width: width,\r\n    height: height,\r\n    widthSegments: widthSegments,\r\n    heightSegments: heightSegments\r\n  };\r\n\r\n  var width_half = width / 2;\r\n  var height_half = height / 2;\r\n\r\n  var gridX = widthSegments || 1;\r\n  var gridY = heightSegments || 1;\r\n\r\n  var gridX1 = gridX + 1;\r\n  var gridY1 = gridY + 1;\r\n\r\n  var segment_width = width / gridX;\r\n  var segment_height = height / gridY;\r\n\r\n  var vertices = new Float32Array(gridX1 * gridY1 * 3);\r\n  var normals = new Float32Array(gridX1 * gridY1 * 3);\r\n  var uvs = new Float32Array(gridX1 * gridY1 * 2);\r\n\r\n  var offset = 0;\r\n  var offset2 = 0;\r\n\r\n  for (var iy = 0; iy < gridY1; iy++) {\r\n\r\n    var y = iy * segment_height - height_half;\r\n\r\n    for (var ix = 0; ix < gridX1; ix++) {\r\n\r\n      var x = ix * segment_width - width_half;\r\n\r\n      vertices[offset] = x;\r\n      vertices[offset + 1] = -y;\r\n\r\n      normals[offset + 2] = 1;\r\n\r\n      uvs[offset2] = ix / gridX;\r\n      uvs[offset2 + 1] = 1 - (iy / gridY);\r\n\r\n      offset += 3;\r\n      offset2 += 2;\r\n\r\n    }\r\n\r\n  }\r\n\r\n  offset = 0;\r\n\r\n  var indices = new((vertices.length / 3) > 65535 ? Uint32Array : Uint16Array)(gridX * gridY * 6);\r\n\r\n  for (var iy = 0; iy < gridY; iy++) {\r\n\r\n    for (var ix = 0; ix < gridX; ix++) {\r\n\r\n      var a = ix + gridX1 * iy;\r\n      var b = ix + gridX1 * (iy + 1);\r\n      var c = (ix + 1) + gridX1 * (iy + 1);\r\n      var d = (ix + 1) + gridX1 * iy;\r\n\r\n      indices[offset] = a;\r\n      indices[offset + 1] = b;\r\n      indices[offset + 2] = d;\r\n\r\n      indices[offset + 3] = b;\r\n      indices[offset + 4] = c;\r\n      indices[offset + 5] = d;\r\n\r\n      offset += 6;\r\n\r\n    }\r\n\r\n  }\r\n\r\n  this.addAttribute('index', new THREE.BufferAttribute(indices, 1));\r\n  this.addAttribute('position', new THREE.BufferAttribute(vertices, 3));\r\n  this.addAttribute('normal', new THREE.BufferAttribute(normals, 3));\r\n  this.addAttribute('uv', new THREE.BufferAttribute(uvs, 2));\r\n\r\n};\r\n\r\nTHREE.PlaneBufferGeometry.prototype = Object.create(THREE.BufferGeometry.prototype);\r\nTHREE.PlaneBufferGeometry.prototype.constructor = THREE.PlaneBufferGeometry;\r\n\r\n// File:src/extras/geometries/RingGeometry.js\r\n\r\n/**\r\n * @author Kaleb Murphy\r\n */\r\n\r\nTHREE.RingGeometry = function(innerRadius, outerRadius, thetaSegments, phiSegments, thetaStart, thetaLength) {\r\n\r\n  THREE.Geometry.call(this);\r\n\r\n  this.type = 'RingGeometry';\r\n\r\n  this.parameters = {\r\n    innerRadius: innerRadius,\r\n    outerRadius: outerRadius,\r\n    thetaSegments: thetaSegments,\r\n    phiSegments: phiSegments,\r\n    thetaStart: thetaStart,\r\n    thetaLength: thetaLength\r\n  };\r\n\r\n  innerRadius = innerRadius || 0;\r\n  outerRadius = outerRadius || 50;\r\n\r\n  thetaStart = thetaStart !== undefined ? thetaStart : 0;\r\n  thetaLength = thetaLength !== undefined ? thetaLength : Math.PI * 2;\r\n\r\n  thetaSegments = thetaSegments !== undefined ? Math.max(3, thetaSegments) : 8;\r\n  phiSegments = phiSegments !== undefined ? Math.max(1, phiSegments) : 8;\r\n\r\n  var i, o, uvs = [],\r\n    radius = innerRadius,\r\n    radiusStep = ((outerRadius - innerRadius) / phiSegments);\r\n\r\n  for (i = 0; i < phiSegments + 1; i++) { // concentric circles inside ring\r\n\r\n    for (o = 0; o < thetaSegments + 1; o++) { // number of segments per circle\r\n\r\n      var vertex = new THREE.Vector3();\r\n      var segment = thetaStart + o / thetaSegments * thetaLength;\r\n      vertex.x = radius * Math.cos(segment);\r\n      vertex.y = radius * Math.sin(segment);\r\n\r\n      this.vertices.push(vertex);\r\n      uvs.push(new THREE.Vector2((vertex.x / outerRadius + 1) / 2, (vertex.y / outerRadius + 1) / 2));\r\n    }\r\n\r\n    radius += radiusStep;\r\n\r\n  }\r\n\r\n  var n = new THREE.Vector3(0, 0, 1);\r\n\r\n  for (i = 0; i < phiSegments; i++) { // concentric circles inside ring\r\n\r\n    var thetaSegment = i * (thetaSegments + 1);\r\n\r\n    for (o = 0; o < thetaSegments; o++) { // number of segments per circle\r\n\r\n      var segment = o + thetaSegment;\r\n\r\n      var v1 = segment;\r\n      var v2 = segment + thetaSegments + 1;\r\n      var v3 = segment + thetaSegments + 2;\r\n\r\n      this.faces.push(new THREE.Face3(v1, v2, v3, [n.clone(), n.clone(), n.clone()]));\r\n      this.faceVertexUvs[0].push([uvs[v1].clone(), uvs[v2].clone(), uvs[v3].clone()]);\r\n\r\n      v1 = segment;\r\n      v2 = segment + thetaSegments + 2;\r\n      v3 = segment + 1;\r\n\r\n      this.faces.push(new THREE.Face3(v1, v2, v3, [n.clone(), n.clone(), n.clone()]));\r\n      this.faceVertexUvs[0].push([uvs[v1].clone(), uvs[v2].clone(), uvs[v3].clone()]);\r\n\r\n    }\r\n  }\r\n\r\n  this.computeFaceNormals();\r\n\r\n  this.boundingSphere = new THREE.Sphere(new THREE.Vector3(), radius);\r\n\r\n};\r\n\r\nTHREE.RingGeometry.prototype = Object.create(THREE.Geometry.prototype);\r\nTHREE.RingGeometry.prototype.constructor = THREE.RingGeometry;\r\n\r\n\r\n// File:src/extras/geometries/SphereGeometry.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.SphereGeometry = function(radius, widthSegments, heightSegments, phiStart, phiLength, thetaStart, thetaLength) {\r\n\r\n  THREE.Geometry.call(this);\r\n\r\n  this.type = 'SphereGeometry';\r\n\r\n  this.parameters = {\r\n    radius: radius,\r\n    widthSegments: widthSegments,\r\n    heightSegments: heightSegments,\r\n    phiStart: phiStart,\r\n    phiLength: phiLength,\r\n    thetaStart: thetaStart,\r\n    thetaLength: thetaLength\r\n  };\r\n\r\n  radius = radius || 50;\r\n\r\n  widthSegments = Math.max(3, Math.floor(widthSegments) || 8);\r\n  heightSegments = Math.max(2, Math.floor(heightSegments) || 6);\r\n\r\n  phiStart = phiStart !== undefined ? phiStart : 0;\r\n  phiLength = phiLength !== undefined ? phiLength : Math.PI * 2;\r\n\r\n  thetaStart = thetaStart !== undefined ? thetaStart : 0;\r\n  thetaLength = thetaLength !== undefined ? thetaLength : Math.PI;\r\n\r\n  var x, y, vertices = [],\r\n    uvs = [];\r\n\r\n  for (y = 0; y <= heightSegments; y++) {\r\n\r\n    var verticesRow = [];\r\n    var uvsRow = [];\r\n\r\n    for (x = 0; x <= widthSegments; x++) {\r\n\r\n      var u = x / widthSegments;\r\n      var v = y / heightSegments;\r\n\r\n      var vertex = new THREE.Vector3();\r\n      vertex.x = -radius * Math.cos(phiStart + u * phiLength) * Math.sin(thetaStart + v * thetaLength);\r\n      vertex.y = radius * Math.cos(thetaStart + v * thetaLength);\r\n      vertex.z = radius * Math.sin(phiStart + u * phiLength) * Math.sin(thetaStart + v * thetaLength);\r\n\r\n      this.vertices.push(vertex);\r\n\r\n      verticesRow.push(this.vertices.length - 1);\r\n      uvsRow.push(new THREE.Vector2(u, 1 - v));\r\n\r\n    }\r\n\r\n    vertices.push(verticesRow);\r\n    uvs.push(uvsRow);\r\n\r\n  }\r\n\r\n  for (y = 0; y < heightSegments; y++) {\r\n\r\n    for (x = 0; x < widthSegments; x++) {\r\n\r\n      var v1 = vertices[y][x + 1];\r\n      var v2 = vertices[y][x];\r\n      var v3 = vertices[y + 1][x];\r\n      var v4 = vertices[y + 1][x + 1];\r\n\r\n      var n1 = this.vertices[v1].clone().normalize();\r\n      var n2 = this.vertices[v2].clone().normalize();\r\n      var n3 = this.vertices[v3].clone().normalize();\r\n      var n4 = this.vertices[v4].clone().normalize();\r\n\r\n      var uv1 = uvs[y][x + 1].clone();\r\n      var uv2 = uvs[y][x].clone();\r\n      var uv3 = uvs[y + 1][x].clone();\r\n      var uv4 = uvs[y + 1][x + 1].clone();\r\n\r\n      if (Math.abs(this.vertices[v1].y) === radius) {\r\n\r\n        uv1.x = (uv1.x + uv2.x) / 2;\r\n        this.faces.push(new THREE.Face3(v1, v3, v4, [n1, n3, n4]));\r\n        this.faceVertexUvs[0].push([uv1, uv3, uv4]);\r\n\r\n      }\r\n      else if (Math.abs(this.vertices[v3].y) === radius) {\r\n\r\n        uv3.x = (uv3.x + uv4.x) / 2;\r\n        this.faces.push(new THREE.Face3(v1, v2, v3, [n1, n2, n3]));\r\n        this.faceVertexUvs[0].push([uv1, uv2, uv3]);\r\n\r\n      }\r\n      else {\r\n\r\n        this.faces.push(new THREE.Face3(v1, v2, v4, [n1, n2, n4]));\r\n        this.faceVertexUvs[0].push([uv1, uv2, uv4]);\r\n\r\n        this.faces.push(new THREE.Face3(v2, v3, v4, [n2.clone(), n3, n4.clone()]));\r\n        this.faceVertexUvs[0].push([uv2.clone(), uv3, uv4.clone()]);\r\n\r\n      }\r\n\r\n    }\r\n\r\n  }\r\n\r\n  this.computeFaceNormals();\r\n\r\n  this.boundingSphere = new THREE.Sphere(new THREE.Vector3(), radius);\r\n\r\n};\r\n\r\nTHREE.SphereGeometry.prototype = Object.create(THREE.Geometry.prototype);\r\nTHREE.SphereGeometry.prototype.constructor = THREE.SphereGeometry;\r\n\r\n// File:src/extras/geometries/TextGeometry.js\r\n\r\n/**\r\n * @author zz85 / http://www.lab4games.net/zz85/blog\r\n * @author alteredq / http://alteredqualia.com/\r\n *\r\n * For creating 3D text geometry in three.js\r\n *\r\n * Text = 3D Text\r\n *\r\n * parameters = {\r\n *  size: \t\t\t<float>, \t// size of the text\r\n *  height: \t\t<float>, \t// thickness to extrude text\r\n *  curveSegments: \t<int>,\t\t// number of points on the curves\r\n *\r\n *  font: \t\t\t<string>,\t\t// font name\r\n *  weight: \t\t<string>,\t\t// font weight (normal, bold)\r\n *  style: \t\t\t<string>,\t\t// font style  (normal, italics)\r\n *\r\n *  bevelEnabled:\t<bool>,\t\t\t// turn on bevel\r\n *  bevelThickness: <float>, \t\t// how deep into text bevel goes\r\n *  bevelSize:\t\t<float>, \t\t// how far from text outline is bevel\r\n *  }\r\n *\r\n */\r\n\r\n/*\tUsage Examples\r\n\r\n\t// TextGeometry wrapper\r\n\r\n\tvar text3d = new TextGeometry( text, options );\r\n\r\n\t// Complete manner\r\n\r\n\tvar textShapes = THREE.FontUtils.generateShapes( text, options );\r\n\tvar text3d = new ExtrudeGeometry( textShapes, options );\r\n\r\n*/\r\n\r\n\r\nTHREE.TextGeometry = function(text, parameters) {\r\n\r\n  parameters = parameters || {};\r\n\r\n  var textShapes = THREE.FontUtils.generateShapes(text, parameters);\r\n\r\n  // translate parameters to ExtrudeGeometry API\r\n\r\n  parameters.amount = parameters.height !== undefined ? parameters.height : 50;\r\n\r\n  // defaults\r\n\r\n  if (parameters.bevelThickness === undefined) parameters.bevelThickness = 10;\r\n  if (parameters.bevelSize === undefined) parameters.bevelSize = 8;\r\n  if (parameters.bevelEnabled === undefined) parameters.bevelEnabled = false;\r\n\r\n  THREE.ExtrudeGeometry.call(this, textShapes, parameters);\r\n\r\n  this.type = 'TextGeometry';\r\n\r\n};\r\n\r\nTHREE.TextGeometry.prototype = Object.create(THREE.ExtrudeGeometry.prototype);\r\nTHREE.TextGeometry.prototype.constructor = THREE.TextGeometry;\r\n\r\n// File:src/extras/geometries/TorusGeometry.js\r\n\r\n/**\r\n * @author oosmoxiecode\r\n * @author mrdoob / http://mrdoob.com/\r\n * based on http://code.google.com/p/away3d/source/browse/trunk/fp10/Away3DLite/src/away3dlite/primitives/Torus.as?r=2888\r\n */\r\n\r\nTHREE.TorusGeometry = function(radius, tube, radialSegments, tubularSegments, arc) {\r\n\r\n  THREE.Geometry.call(this);\r\n\r\n  this.type = 'TorusGeometry';\r\n\r\n  this.parameters = {\r\n    radius: radius,\r\n    tube: tube,\r\n    radialSegments: radialSegments,\r\n    tubularSegments: tubularSegments,\r\n    arc: arc\r\n  };\r\n\r\n  radius = radius || 100;\r\n  tube = tube || 40;\r\n  radialSegments = radialSegments || 8;\r\n  tubularSegments = tubularSegments || 6;\r\n  arc = arc || Math.PI * 2;\r\n\r\n  var center = new THREE.Vector3(),\r\n    uvs = [],\r\n    normals = [];\r\n\r\n  for (var j = 0; j <= radialSegments; j++) {\r\n\r\n    for (var i = 0; i <= tubularSegments; i++) {\r\n\r\n      var u = i / tubularSegments * arc;\r\n      var v = j / radialSegments * Math.PI * 2;\r\n\r\n      center.x = radius * Math.cos(u);\r\n      center.y = radius * Math.sin(u);\r\n\r\n      var vertex = new THREE.Vector3();\r\n      vertex.x = (radius + tube * Math.cos(v)) * Math.cos(u);\r\n      vertex.y = (radius + tube * Math.cos(v)) * Math.sin(u);\r\n      vertex.z = tube * Math.sin(v);\r\n\r\n      this.vertices.push(vertex);\r\n\r\n      uvs.push(new THREE.Vector2(i / tubularSegments, j / radialSegments));\r\n      normals.push(vertex.clone().sub(center).normalize());\r\n\r\n    }\r\n\r\n  }\r\n\r\n  for (var j = 1; j <= radialSegments; j++) {\r\n\r\n    for (var i = 1; i <= tubularSegments; i++) {\r\n\r\n      var a = (tubularSegments + 1) * j + i - 1;\r\n      var b = (tubularSegments + 1) * (j - 1) + i - 1;\r\n      var c = (tubularSegments + 1) * (j - 1) + i;\r\n      var d = (tubularSegments + 1) * j + i;\r\n\r\n      var face = new THREE.Face3(a, b, d, [normals[a].clone(), normals[b].clone(), normals[d].clone()]);\r\n      this.faces.push(face);\r\n      this.faceVertexUvs[0].push([uvs[a].clone(), uvs[b].clone(), uvs[d].clone()]);\r\n\r\n      face = new THREE.Face3(b, c, d, [normals[b].clone(), normals[c].clone(), normals[d].clone()]);\r\n      this.faces.push(face);\r\n      this.faceVertexUvs[0].push([uvs[b].clone(), uvs[c].clone(), uvs[d].clone()]);\r\n\r\n    }\r\n\r\n  }\r\n\r\n  this.computeFaceNormals();\r\n\r\n};\r\n\r\nTHREE.TorusGeometry.prototype = Object.create(THREE.Geometry.prototype);\r\nTHREE.TorusGeometry.prototype.constructor = THREE.TorusGeometry;\r\n\r\n// File:src/extras/geometries/TorusKnotGeometry.js\r\n\r\n/**\r\n * @author oosmoxiecode\r\n * based on http://code.google.com/p/away3d/source/browse/trunk/fp10/Away3D/src/away3d/primitives/TorusKnot.as?spec=svn2473&r=2473\r\n */\r\n\r\nTHREE.TorusKnotGeometry = function(radius, tube, radialSegments, tubularSegments, p, q, heightScale) {\r\n\r\n  THREE.Geometry.call(this);\r\n\r\n  this.type = 'TorusKnotGeometry';\r\n\r\n  this.parameters = {\r\n    radius: radius,\r\n    tube: tube,\r\n    radialSegments: radialSegments,\r\n    tubularSegments: tubularSegments,\r\n    p: p,\r\n    q: q,\r\n    heightScale: heightScale\r\n  };\r\n\r\n  radius = radius || 100;\r\n  tube = tube || 40;\r\n  radialSegments = radialSegments || 64;\r\n  tubularSegments = tubularSegments || 8;\r\n  p = p || 2;\r\n  q = q || 3;\r\n  heightScale = heightScale || 1;\r\n\r\n  var grid = new Array(radialSegments);\r\n  var tang = new THREE.Vector3();\r\n  var n = new THREE.Vector3();\r\n  var bitan = new THREE.Vector3();\r\n\r\n  for (var i = 0; i < radialSegments; ++i) {\r\n\r\n    grid[i] = new Array(tubularSegments);\r\n    var u = i / radialSegments * 2 * p * Math.PI;\r\n    var p1 = getPos(u, q, p, radius, heightScale);\r\n    var p2 = getPos(u + 0.01, q, p, radius, heightScale);\r\n    tang.subVectors(p2, p1);\r\n    n.addVectors(p2, p1);\r\n\r\n    bitan.crossVectors(tang, n);\r\n    n.crossVectors(bitan, tang);\r\n    bitan.normalize();\r\n    n.normalize();\r\n\r\n    for (var j = 0; j < tubularSegments; ++j) {\r\n\r\n      var v = j / tubularSegments * 2 * Math.PI;\r\n      var cx = -tube * Math.cos(v); // TODO: Hack: Negating it so it faces outside.\r\n      var cy = tube * Math.sin(v);\r\n\r\n      var pos = new THREE.Vector3();\r\n      pos.x = p1.x + cx * n.x + cy * bitan.x;\r\n      pos.y = p1.y + cx * n.y + cy * bitan.y;\r\n      pos.z = p1.z + cx * n.z + cy * bitan.z;\r\n\r\n      grid[i][j] = this.vertices.push(pos) - 1;\r\n\r\n    }\r\n\r\n  }\r\n\r\n  for (var i = 0; i < radialSegments; ++i) {\r\n\r\n    for (var j = 0; j < tubularSegments; ++j) {\r\n\r\n      var ip = (i + 1) % radialSegments;\r\n      var jp = (j + 1) % tubularSegments;\r\n\r\n      var a = grid[i][j];\r\n      var b = grid[ip][j];\r\n      var c = grid[ip][jp];\r\n      var d = grid[i][jp];\r\n\r\n      var uva = new THREE.Vector2(i / radialSegments, j / tubularSegments);\r\n      var uvb = new THREE.Vector2((i + 1) / radialSegments, j / tubularSegments);\r\n      var uvc = new THREE.Vector2((i + 1) / radialSegments, (j + 1) / tubularSegments);\r\n      var uvd = new THREE.Vector2(i / radialSegments, (j + 1) / tubularSegments);\r\n\r\n      this.faces.push(new THREE.Face3(a, b, d));\r\n      this.faceVertexUvs[0].push([uva, uvb, uvd]);\r\n\r\n      this.faces.push(new THREE.Face3(b, c, d));\r\n      this.faceVertexUvs[0].push([uvb.clone(), uvc, uvd.clone()]);\r\n\r\n    }\r\n  }\r\n\r\n  this.computeFaceNormals();\r\n  this.computeVertexNormals();\r\n\r\n  function getPos(u, in_q, in_p, radius, heightScale) {\r\n\r\n    var cu = Math.cos(u);\r\n    var su = Math.sin(u);\r\n    var quOverP = in_q / in_p * u;\r\n    var cs = Math.cos(quOverP);\r\n\r\n    var tx = radius * (2 + cs) * 0.5 * cu;\r\n    var ty = radius * (2 + cs) * su * 0.5;\r\n    var tz = heightScale * radius * Math.sin(quOverP) * 0.5;\r\n\r\n    return new THREE.Vector3(tx, ty, tz);\r\n\r\n  }\r\n\r\n};\r\n\r\nTHREE.TorusKnotGeometry.prototype = Object.create(THREE.Geometry.prototype);\r\nTHREE.TorusKnotGeometry.prototype.constructor = THREE.TorusKnotGeometry;\r\n\r\n// File:src/extras/geometries/TubeGeometry.js\r\n\r\n/**\r\n * @author WestLangley / https://github.com/WestLangley\r\n * @author zz85 / https://github.com/zz85\r\n * @author miningold / https://github.com/miningold\r\n * @author jonobr1 / https://github.com/jonobr1\r\n *\r\n * Modified from the TorusKnotGeometry by @oosmoxiecode\r\n *\r\n * Creates a tube which extrudes along a 3d spline\r\n *\r\n * Uses parallel transport frames as described in\r\n * http://www.cs.indiana.edu/pub/techreports/TR425.pdf\r\n */\r\n\r\nTHREE.TubeGeometry = function(path, segments, radius, radialSegments, closed, taper) {\r\n\r\n  THREE.Geometry.call(this);\r\n\r\n  this.type = 'TubeGeometry';\r\n\r\n  this.parameters = {\r\n    path: path,\r\n    segments: segments,\r\n    radius: radius,\r\n    radialSegments: radialSegments,\r\n    closed: closed\r\n  };\r\n\r\n  segments = segments || 64;\r\n  radius = radius || 1;\r\n  radialSegments = radialSegments || 8;\r\n  closed = closed || false;\r\n  taper = taper || THREE.TubeGeometry.NoTaper;\r\n\r\n  var grid = [];\r\n\r\n  var scope = this,\r\n\r\n    tangent,\r\n    normal,\r\n    binormal,\r\n\r\n    numpoints = segments + 1,\r\n\r\n    u, v, r,\r\n\r\n    cx, cy,\r\n    pos, pos2 = new THREE.Vector3(),\r\n    i, j,\r\n    ip, jp,\r\n    a, b, c, d,\r\n    uva, uvb, uvc, uvd;\r\n\r\n  var frames = new THREE.TubeGeometry.FrenetFrames(path, segments, closed),\r\n    tangents = frames.tangents,\r\n    normals = frames.normals,\r\n    binormals = frames.binormals;\r\n\r\n  // proxy internals\r\n  this.tangents = tangents;\r\n  this.normals = normals;\r\n  this.binormals = binormals;\r\n\r\n  function vert(x, y, z) {\r\n\r\n    return scope.vertices.push(new THREE.Vector3(x, y, z)) - 1;\r\n\r\n  }\r\n\r\n  // consruct the grid\r\n\r\n  for (i = 0; i < numpoints; i++) {\r\n\r\n    grid[i] = [];\r\n\r\n    u = i / (numpoints - 1);\r\n\r\n    pos = path.getPointAt(u);\r\n\r\n    tangent = tangents[i];\r\n    normal = normals[i];\r\n    binormal = binormals[i];\r\n\r\n    r = radius * taper(u);\r\n\r\n    for (j = 0; j < radialSegments; j++) {\r\n\r\n      v = j / radialSegments * 2 * Math.PI;\r\n\r\n      cx = -r * Math.cos(v); // TODO: Hack: Negating it so it faces outside.\r\n      cy = r * Math.sin(v);\r\n\r\n      pos2.copy(pos);\r\n      pos2.x += cx * normal.x + cy * binormal.x;\r\n      pos2.y += cx * normal.y + cy * binormal.y;\r\n      pos2.z += cx * normal.z + cy * binormal.z;\r\n\r\n      grid[i][j] = vert(pos2.x, pos2.y, pos2.z);\r\n\r\n    }\r\n  }\r\n\r\n\r\n  // construct the mesh\r\n\r\n  for (i = 0; i < segments; i++) {\r\n\r\n    for (j = 0; j < radialSegments; j++) {\r\n\r\n      ip = (closed) ? (i + 1) % segments : i + 1;\r\n      jp = (j + 1) % radialSegments;\r\n\r\n      a = grid[i][j]; // *** NOT NECESSARILY PLANAR ! ***\r\n      b = grid[ip][j];\r\n      c = grid[ip][jp];\r\n      d = grid[i][jp];\r\n\r\n      uva = new THREE.Vector2(i / segments, j / radialSegments);\r\n      uvb = new THREE.Vector2((i + 1) / segments, j / radialSegments);\r\n      uvc = new THREE.Vector2((i + 1) / segments, (j + 1) / radialSegments);\r\n      uvd = new THREE.Vector2(i / segments, (j + 1) / radialSegments);\r\n\r\n      this.faces.push(new THREE.Face3(a, b, d));\r\n      this.faceVertexUvs[0].push([uva, uvb, uvd]);\r\n\r\n      this.faces.push(new THREE.Face3(b, c, d));\r\n      this.faceVertexUvs[0].push([uvb.clone(), uvc, uvd.clone()]);\r\n\r\n    }\r\n  }\r\n\r\n  this.computeFaceNormals();\r\n  this.computeVertexNormals();\r\n\r\n};\r\n\r\nTHREE.TubeGeometry.prototype = Object.create(THREE.Geometry.prototype);\r\nTHREE.TubeGeometry.prototype.constructor = THREE.TubeGeometry;\r\n\r\nTHREE.TubeGeometry.NoTaper = function(u) {\r\n\r\n  return 1;\r\n\r\n};\r\n\r\nTHREE.TubeGeometry.SinusoidalTaper = function(u) {\r\n\r\n  return Math.sin(Math.PI * u);\r\n\r\n};\r\n\r\n// For computing of Frenet frames, exposing the tangents, normals and binormals the spline\r\nTHREE.TubeGeometry.FrenetFrames = function(path, segments, closed) {\r\n\r\n  var normal = new THREE.Vector3(),\r\n\r\n    tangents = [],\r\n    normals = [],\r\n    binormals = [],\r\n\r\n    vec = new THREE.Vector3(),\r\n    mat = new THREE.Matrix4(),\r\n\r\n    numpoints = segments + 1,\r\n    theta,\r\n    epsilon = 0.0001,\r\n    smallest,\r\n\r\n    tx, ty, tz,\r\n    i, u;\r\n\r\n\r\n  // expose internals\r\n  this.tangents = tangents;\r\n  this.normals = normals;\r\n  this.binormals = binormals;\r\n\r\n  // compute the tangent vectors for each segment on the path\r\n\r\n  for (i = 0; i < numpoints; i++) {\r\n\r\n    u = i / (numpoints - 1);\r\n\r\n    tangents[i] = path.getTangentAt(u);\r\n    tangents[i].normalize();\r\n\r\n  }\r\n\r\n  initialNormal3();\r\n\r\n  /*\r\n  function initialNormal1(lastBinormal) {\r\n  \t// fixed start binormal. Has dangers of 0 vectors\r\n  \tnormals[ 0 ] = new THREE.Vector3();\r\n  \tbinormals[ 0 ] = new THREE.Vector3();\r\n  \tif (lastBinormal===undefined) lastBinormal = new THREE.Vector3( 0, 0, 1 );\r\n  \tnormals[ 0 ].crossVectors( lastBinormal, tangents[ 0 ] ).normalize();\r\n  \tbinormals[ 0 ].crossVectors( tangents[ 0 ], normals[ 0 ] ).normalize();\r\n  }\r\n\r\n  function initialNormal2() {\r\n\r\n  \t// This uses the Frenet-Serret formula for deriving binormal\r\n  \tvar t2 = path.getTangentAt( epsilon );\r\n\r\n  \tnormals[ 0 ] = new THREE.Vector3().subVectors( t2, tangents[ 0 ] ).normalize();\r\n  \tbinormals[ 0 ] = new THREE.Vector3().crossVectors( tangents[ 0 ], normals[ 0 ] );\r\n\r\n  \tnormals[ 0 ].crossVectors( binormals[ 0 ], tangents[ 0 ] ).normalize(); // last binormal x tangent\r\n  \tbinormals[ 0 ].crossVectors( tangents[ 0 ], normals[ 0 ] ).normalize();\r\n\r\n  }\r\n  */\r\n\r\n  function initialNormal3() {\r\n    // select an initial normal vector perpenicular to the first tangent vector,\r\n    // and in the direction of the smallest tangent xyz component\r\n\r\n    normals[0] = new THREE.Vector3();\r\n    binormals[0] = new THREE.Vector3();\r\n    smallest = Number.MAX_VALUE;\r\n    tx = Math.abs(tangents[0].x);\r\n    ty = Math.abs(tangents[0].y);\r\n    tz = Math.abs(tangents[0].z);\r\n\r\n    if (tx <= smallest) {\r\n      smallest = tx;\r\n      normal.set(1, 0, 0);\r\n    }\r\n\r\n    if (ty <= smallest) {\r\n      smallest = ty;\r\n      normal.set(0, 1, 0);\r\n    }\r\n\r\n    if (tz <= smallest) {\r\n      normal.set(0, 0, 1);\r\n    }\r\n\r\n    vec.crossVectors(tangents[0], normal).normalize();\r\n\r\n    normals[0].crossVectors(tangents[0], vec);\r\n    binormals[0].crossVectors(tangents[0], normals[0]);\r\n  }\r\n\r\n\r\n  // compute the slowly-varying normal and binormal vectors for each segment on the path\r\n\r\n  for (i = 1; i < numpoints; i++) {\r\n\r\n    normals[i] = normals[i - 1].clone();\r\n\r\n    binormals[i] = binormals[i - 1].clone();\r\n\r\n    vec.crossVectors(tangents[i - 1], tangents[i]);\r\n\r\n    if (vec.length() > epsilon) {\r\n\r\n      vec.normalize();\r\n\r\n      theta = Math.acos(THREE.Math.clamp(tangents[i - 1].dot(tangents[i]), -1, 1)); // clamp for floating pt errors\r\n\r\n      normals[i].applyMatrix4(mat.makeRotationAxis(vec, theta));\r\n\r\n    }\r\n\r\n    binormals[i].crossVectors(tangents[i], normals[i]);\r\n\r\n  }\r\n\r\n\r\n  // if the curve is closed, postprocess the vectors so the first and last normal vectors are the same\r\n\r\n  if (closed) {\r\n\r\n    theta = Math.acos(THREE.Math.clamp(normals[0].dot(normals[numpoints - 1]), -1, 1));\r\n    theta /= (numpoints - 1);\r\n\r\n    if (tangents[0].dot(vec.crossVectors(normals[0], normals[numpoints - 1])) > 0) {\r\n\r\n      theta = -theta;\r\n\r\n    }\r\n\r\n    for (i = 1; i < numpoints; i++) {\r\n\r\n      // twist a little...\r\n      normals[i].applyMatrix4(mat.makeRotationAxis(tangents[i], theta * i));\r\n      binormals[i].crossVectors(tangents[i], normals[i]);\r\n\r\n    }\r\n\r\n  }\r\n};\r\n\r\n// File:src/extras/geometries/PolyhedronGeometry.js\r\n\r\n/**\r\n * @author clockworkgeek / https://github.com/clockworkgeek\r\n * @author timothypratley / https://github.com/timothypratley\r\n * @author WestLangley / http://github.com/WestLangley\r\n */\r\n\r\nTHREE.PolyhedronGeometry = function(vertices, indices, radius, detail) {\r\n\r\n  THREE.Geometry.call(this);\r\n\r\n  this.type = 'PolyhedronGeometry';\r\n\r\n  this.parameters = {\r\n    vertices: vertices,\r\n    indices: indices,\r\n    radius: radius,\r\n    detail: detail\r\n  };\r\n\r\n  radius = radius || 1;\r\n  detail = detail || 0;\r\n\r\n  var that = this;\r\n\r\n  for (var i = 0, l = vertices.length; i < l; i += 3) {\r\n\r\n    prepare(new THREE.Vector3(vertices[i], vertices[i + 1], vertices[i + 2]));\r\n\r\n  }\r\n\r\n  var p = this.vertices;\r\n\r\n  var faces = [];\r\n\r\n  for (var i = 0, j = 0, l = indices.length; i < l; i += 3, j++) {\r\n\r\n    var v1 = p[indices[i]];\r\n    var v2 = p[indices[i + 1]];\r\n    var v3 = p[indices[i + 2]];\r\n\r\n    faces[j] = new THREE.Face3(v1.index, v2.index, v3.index, [v1.clone(), v2.clone(), v3.clone()]);\r\n\r\n  }\r\n\r\n  var centroid = new THREE.Vector3();\r\n\r\n  for (var i = 0, l = faces.length; i < l; i++) {\r\n\r\n    subdivide(faces[i], detail);\r\n\r\n  }\r\n\r\n\r\n  // Handle case when face straddles the seam\r\n\r\n  for (var i = 0, l = this.faceVertexUvs[0].length; i < l; i++) {\r\n\r\n    var uvs = this.faceVertexUvs[0][i];\r\n\r\n    var x0 = uvs[0].x;\r\n    var x1 = uvs[1].x;\r\n    var x2 = uvs[2].x;\r\n\r\n    var max = Math.max(x0, Math.max(x1, x2));\r\n    var min = Math.min(x0, Math.min(x1, x2));\r\n\r\n    if (max > 0.9 && min < 0.1) { // 0.9 is somewhat arbitrary\r\n\r\n      if (x0 < 0.2) uvs[0].x += 1;\r\n      if (x1 < 0.2) uvs[1].x += 1;\r\n      if (x2 < 0.2) uvs[2].x += 1;\r\n\r\n    }\r\n\r\n  }\r\n\r\n\r\n  // Apply radius\r\n\r\n  for (var i = 0, l = this.vertices.length; i < l; i++) {\r\n\r\n    this.vertices[i].multiplyScalar(radius);\r\n\r\n  }\r\n\r\n\r\n  // Merge vertices\r\n\r\n  this.mergeVertices();\r\n\r\n  this.computeFaceNormals();\r\n\r\n  this.boundingSphere = new THREE.Sphere(new THREE.Vector3(), radius);\r\n\r\n\r\n  // Project vector onto sphere's surface\r\n\r\n  function prepare(vector) {\r\n\r\n    var vertex = vector.normalize().clone();\r\n    vertex.index = that.vertices.push(vertex) - 1;\r\n\r\n    // Texture coords are equivalent to map coords, calculate angle and convert to fraction of a circle.\r\n\r\n    var u = azimuth(vector) / 2 / Math.PI + 0.5;\r\n    var v = inclination(vector) / Math.PI + 0.5;\r\n    vertex.uv = new THREE.Vector2(u, 1 - v);\r\n\r\n    return vertex;\r\n\r\n  }\r\n\r\n\r\n  // Approximate a curved face with recursively sub-divided triangles.\r\n\r\n  function make(v1, v2, v3) {\r\n\r\n    var face = new THREE.Face3(v1.index, v2.index, v3.index, [v1.clone(), v2.clone(), v3.clone()]);\r\n    that.faces.push(face);\r\n\r\n    centroid.copy(v1).add(v2).add(v3).divideScalar(3);\r\n\r\n    var azi = azimuth(centroid);\r\n\r\n    that.faceVertexUvs[0].push([\r\n      correctUV(v1.uv, v1, azi),\r\n      correctUV(v2.uv, v2, azi),\r\n      correctUV(v3.uv, v3, azi)\r\n    ]);\r\n\r\n  }\r\n\r\n\r\n  // Analytically subdivide a face to the required detail level.\r\n\r\n  function subdivide(face, detail) {\r\n\r\n    var cols = Math.pow(2, detail);\r\n    var a = prepare(that.vertices[face.a]);\r\n    var b = prepare(that.vertices[face.b]);\r\n    var c = prepare(that.vertices[face.c]);\r\n    var v = [];\r\n\r\n    // Construct all of the vertices for this subdivision.\r\n\r\n    for (var i = 0; i <= cols; i++) {\r\n\r\n      v[i] = [];\r\n\r\n      var aj = prepare(a.clone().lerp(c, i / cols));\r\n      var bj = prepare(b.clone().lerp(c, i / cols));\r\n      var rows = cols - i;\r\n\r\n      for (var j = 0; j <= rows; j++) {\r\n\r\n        if (j == 0 && i == cols) {\r\n\r\n          v[i][j] = aj;\r\n\r\n        }\r\n        else {\r\n\r\n          v[i][j] = prepare(aj.clone().lerp(bj, j / rows));\r\n\r\n        }\r\n\r\n      }\r\n\r\n    }\r\n\r\n    // Construct all of the faces.\r\n\r\n    for (var i = 0; i < cols; i++) {\r\n\r\n      for (var j = 0; j < 2 * (cols - i) - 1; j++) {\r\n\r\n        var k = Math.floor(j / 2);\r\n\r\n        if (j % 2 == 0) {\r\n\r\n          make(\r\n            v[i][k + 1],\r\n            v[i + 1][k],\r\n            v[i][k]\r\n          );\r\n\r\n        }\r\n        else {\r\n\r\n          make(\r\n            v[i][k + 1],\r\n            v[i + 1][k + 1],\r\n            v[i + 1][k]\r\n          );\r\n\r\n        }\r\n\r\n      }\r\n\r\n    }\r\n\r\n  }\r\n\r\n\r\n  // Angle around the Y axis, counter-clockwise when looking from above.\r\n\r\n  function azimuth(vector) {\r\n\r\n    return Math.atan2(vector.z, -vector.x);\r\n\r\n  }\r\n\r\n\r\n  // Angle above the XZ plane.\r\n\r\n  function inclination(vector) {\r\n\r\n    return Math.atan2(-vector.y, Math.sqrt((vector.x * vector.x) + (vector.z * vector.z)));\r\n\r\n  }\r\n\r\n\r\n  // Texture fixing helper. Spheres have some odd behaviours.\r\n\r\n  function correctUV(uv, vector, azimuth) {\r\n\r\n    if ((azimuth < 0) && (uv.x === 1)) uv = new THREE.Vector2(uv.x - 1, uv.y);\r\n    if ((vector.x === 0) && (vector.z === 0)) uv = new THREE.Vector2(azimuth / 2 / Math.PI + 0.5, uv.y);\r\n    return uv.clone();\r\n\r\n  }\r\n\r\n\r\n};\r\n\r\nTHREE.PolyhedronGeometry.prototype = Object.create(THREE.Geometry.prototype);\r\nTHREE.PolyhedronGeometry.prototype.constructor = THREE.PolyhedronGeometry;\r\n\r\n// File:src/extras/geometries/DodecahedronGeometry.js\r\n\r\n/**\r\n * @author Abe Pazos / https://hamoid.com\r\n */\r\n\r\nTHREE.DodecahedronGeometry = function(radius, detail) {\r\n\r\n  this.parameters = {\r\n    radius: radius,\r\n    detail: detail\r\n  };\r\n\r\n  var t = (1 + Math.sqrt(5)) / 2;\r\n  var r = 1 / t;\r\n\r\n  var vertices = [\r\n\r\n    // (±1, ±1, ±1)\r\n    -1, -1, -1, -1, -1, 1, -1, 1, -1, -1, 1, 1,\r\n    1, -1, -1, 1, -1, 1,\r\n    1, 1, -1, 1, 1, 1,\r\n\r\n    // (0, ±1/φ, ±φ)\r\n    0, -r, -t, 0, -r, t,\r\n    0, r, -t, 0, r, t,\r\n\r\n    // (±1/φ, ±φ, 0)\r\n    -r, -t, 0, -r, t, 0,\r\n    r, -t, 0, r, t, 0,\r\n\r\n    // (±φ, 0, ±1/φ)\r\n    -t, 0, -r, t, 0, -r, -t, 0, r, t, 0, r\r\n  ];\r\n\r\n  var indices = [\r\n    3, 11, 7, 3, 7, 15, 3, 15, 13,\r\n    7, 19, 17, 7, 17, 6, 7, 6, 15,\r\n    17, 4, 8, 17, 8, 10, 17, 10, 6,\r\n    8, 0, 16, 8, 16, 2, 8, 2, 10,\r\n    0, 12, 1, 0, 1, 18, 0, 18, 16,\r\n    6, 10, 2, 6, 2, 13, 6, 13, 15,\r\n    2, 16, 18, 2, 18, 3, 2, 3, 13,\r\n    18, 1, 9, 18, 9, 11, 18, 11, 3,\r\n    4, 14, 12, 4, 12, 0, 4, 0, 8,\r\n    11, 9, 5, 11, 5, 19, 11, 19, 7,\r\n    19, 5, 14, 19, 14, 4, 19, 4, 17,\r\n    1, 12, 14, 1, 14, 5, 1, 5, 9\r\n  ];\r\n\r\n  THREE.PolyhedronGeometry.call(this, vertices, indices, radius, detail);\r\n\r\n};\r\n\r\nTHREE.DodecahedronGeometry.prototype = Object.create(THREE.Geometry.prototype);\r\nTHREE.DodecahedronGeometry.prototype.constructor = THREE.DodecahedronGeometry;\r\n\r\n// File:src/extras/geometries/IcosahedronGeometry.js\r\n\r\n/**\r\n * @author timothypratley / https://github.com/timothypratley\r\n */\r\n\r\nTHREE.IcosahedronGeometry = function(radius, detail) {\r\n\r\n  var t = (1 + Math.sqrt(5)) / 2;\r\n\r\n  var vertices = [-1, t, 0, 1, t, 0, -1, -t, 0, 1, -t, 0,\r\n    0, -1, t, 0, 1, t, 0, -1, -t, 0, 1, -t,\r\n    t, 0, -1, t, 0, 1, -t, 0, -1, -t, 0, 1\r\n  ];\r\n\r\n  var indices = [\r\n    0, 11, 5, 0, 5, 1, 0, 1, 7, 0, 7, 10, 0, 10, 11,\r\n    1, 5, 9, 5, 11, 4, 11, 10, 2, 10, 7, 6, 7, 1, 8,\r\n    3, 9, 4, 3, 4, 2, 3, 2, 6, 3, 6, 8, 3, 8, 9,\r\n    4, 9, 5, 2, 4, 11, 6, 2, 10, 8, 6, 7, 9, 8, 1\r\n  ];\r\n\r\n  THREE.PolyhedronGeometry.call(this, vertices, indices, radius, detail);\r\n\r\n  this.type = 'IcosahedronGeometry';\r\n\r\n  this.parameters = {\r\n    radius: radius,\r\n    detail: detail\r\n  };\r\n};\r\n\r\nTHREE.IcosahedronGeometry.prototype = Object.create(THREE.Geometry.prototype);\r\nTHREE.IcosahedronGeometry.prototype.constructor = THREE.IcosahedronGeometry;\r\n\r\n// File:src/extras/geometries/OctahedronGeometry.js\r\n\r\n/**\r\n * @author timothypratley / https://github.com/timothypratley\r\n */\r\n\r\nTHREE.OctahedronGeometry = function(radius, detail) {\r\n\r\n  this.parameters = {\r\n    radius: radius,\r\n    detail: detail\r\n  };\r\n\r\n  var vertices = [\r\n    1, 0, 0, -1, 0, 0, 0, 1, 0, 0, -1, 0, 0, 0, 1, 0, 0, -1\r\n  ];\r\n\r\n  var indices = [\r\n    0, 2, 4, 0, 4, 3, 0, 3, 5, 0, 5, 2, 1, 2, 5, 1, 5, 3, 1, 3, 4, 1, 4, 2\r\n  ];\r\n\r\n  THREE.PolyhedronGeometry.call(this, vertices, indices, radius, detail);\r\n\r\n  this.type = 'OctahedronGeometry';\r\n\r\n  this.parameters = {\r\n    radius: radius,\r\n    detail: detail\r\n  };\r\n};\r\n\r\nTHREE.OctahedronGeometry.prototype = Object.create(THREE.Geometry.prototype);\r\nTHREE.OctahedronGeometry.prototype.constructor = THREE.OctahedronGeometry;\r\n\r\n// File:src/extras/geometries/TetrahedronGeometry.js\r\n\r\n/**\r\n * @author timothypratley / https://github.com/timothypratley\r\n */\r\n\r\nTHREE.TetrahedronGeometry = function(radius, detail) {\r\n\r\n  var vertices = [\r\n    1, 1, 1, -1, -1, 1, -1, 1, -1, 1, -1, -1\r\n  ];\r\n\r\n  var indices = [\r\n    2, 1, 0, 0, 3, 2, 1, 3, 0, 2, 3, 1\r\n  ];\r\n\r\n  THREE.PolyhedronGeometry.call(this, vertices, indices, radius, detail);\r\n\r\n  this.type = 'TetrahedronGeometry';\r\n\r\n  this.parameters = {\r\n    radius: radius,\r\n    detail: detail\r\n  };\r\n\r\n};\r\n\r\nTHREE.TetrahedronGeometry.prototype = Object.create(THREE.Geometry.prototype);\r\nTHREE.TetrahedronGeometry.prototype.constructor = THREE.TetrahedronGeometry;\r\n\r\n// File:src/extras/geometries/ParametricGeometry.js\r\n\r\n/**\r\n * @author zz85 / https://github.com/zz85\r\n * Parametric Surfaces Geometry\r\n * based on the brilliant article by @prideout http://prideout.net/blog/?p=44\r\n *\r\n * new THREE.ParametricGeometry( parametricFunction, uSegments, ySegements );\r\n *\r\n */\r\n\r\nTHREE.ParametricGeometry = function(func, slices, stacks) {\r\n\r\n  THREE.Geometry.call(this);\r\n\r\n  this.type = 'ParametricGeometry';\r\n\r\n  this.parameters = {\r\n    func: func,\r\n    slices: slices,\r\n    stacks: stacks\r\n  };\r\n\r\n  var verts = this.vertices;\r\n  var faces = this.faces;\r\n  var uvs = this.faceVertexUvs[0];\r\n\r\n  var i, j, p;\r\n  var u, v;\r\n\r\n  var sliceCount = slices + 1;\r\n\r\n  for (i = 0; i <= stacks; i++) {\r\n\r\n    v = i / stacks;\r\n\r\n    for (j = 0; j <= slices; j++) {\r\n\r\n      u = j / slices;\r\n\r\n      p = func(u, v);\r\n      verts.push(p);\r\n\r\n    }\r\n  }\r\n\r\n  var a, b, c, d;\r\n  var uva, uvb, uvc, uvd;\r\n\r\n  for (i = 0; i < stacks; i++) {\r\n\r\n    for (j = 0; j < slices; j++) {\r\n\r\n      a = i * sliceCount + j;\r\n      b = i * sliceCount + j + 1;\r\n      c = (i + 1) * sliceCount + j + 1;\r\n      d = (i + 1) * sliceCount + j;\r\n\r\n      uva = new THREE.Vector2(j / slices, i / stacks);\r\n      uvb = new THREE.Vector2((j + 1) / slices, i / stacks);\r\n      uvc = new THREE.Vector2((j + 1) / slices, (i + 1) / stacks);\r\n      uvd = new THREE.Vector2(j / slices, (i + 1) / stacks);\r\n\r\n      faces.push(new THREE.Face3(a, b, d));\r\n      uvs.push([uva, uvb, uvd]);\r\n\r\n      faces.push(new THREE.Face3(b, c, d));\r\n      uvs.push([uvb.clone(), uvc, uvd.clone()]);\r\n\r\n    }\r\n\r\n  }\r\n\r\n  // console.log(this);\r\n\r\n  // magic bullet\r\n  // var diff = this.mergeVertices();\r\n  // console.log('removed ', diff, ' vertices by merging');\r\n\r\n  this.computeFaceNormals();\r\n  this.computeVertexNormals();\r\n\r\n};\r\n\r\nTHREE.ParametricGeometry.prototype = Object.create(THREE.Geometry.prototype);\r\nTHREE.ParametricGeometry.prototype.constructor = THREE.ParametricGeometry;\r\n\r\n// File:src/extras/helpers/AxisHelper.js\r\n\r\n/**\r\n * @author sroucheray / http://sroucheray.org/\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.AxisHelper = function(size) {\r\n\r\n  size = size || 1;\r\n\r\n  var vertices = new Float32Array([\r\n    0, 0, 0, size, 0, 0,\r\n    0, 0, 0, 0, size, 0,\r\n    0, 0, 0, 0, 0, size\r\n  ]);\r\n\r\n  var colors = new Float32Array([\r\n    1, 0, 0, 1, 0.6, 0,\r\n    0, 1, 0, 0.6, 1, 0,\r\n    0, 0, 1, 0, 0.6, 1\r\n  ]);\r\n\r\n  var geometry = new THREE.BufferGeometry();\r\n  geometry.addAttribute('position', new THREE.BufferAttribute(vertices, 3));\r\n  geometry.addAttribute('color', new THREE.BufferAttribute(colors, 3));\r\n\r\n  var material = new THREE.LineBasicMaterial({\r\n    vertexColors: THREE.VertexColors\r\n  });\r\n\r\n  THREE.Line.call(this, geometry, material, THREE.LinePieces);\r\n\r\n};\r\n\r\nTHREE.AxisHelper.prototype = Object.create(THREE.Line.prototype);\r\nTHREE.AxisHelper.prototype.constructor = THREE.AxisHelper;\r\n\r\n// File:src/extras/helpers/ArrowHelper.js\r\n\r\n/**\r\n * @author WestLangley / http://github.com/WestLangley\r\n * @author zz85 / http://github.com/zz85\r\n * @author bhouston / http://exocortex.com\r\n *\r\n * Creates an arrow for visualizing directions\r\n *\r\n * Parameters:\r\n *  dir - Vector3\r\n *  origin - Vector3\r\n *  length - Number\r\n *  color - color in hex value\r\n *  headLength - Number\r\n *  headWidth - Number\r\n */\r\n\r\nTHREE.ArrowHelper = (function() {\r\n\r\n  var lineGeometry = new THREE.Geometry();\r\n  lineGeometry.vertices.push(new THREE.Vector3(0, 0, 0), new THREE.Vector3(0, 1, 0));\r\n\r\n  var coneGeometry = new THREE.CylinderGeometry(0, 0.5, 1, 5, 1);\r\n  coneGeometry.applyMatrix(new THREE.Matrix4().makeTranslation(0, -0.5, 0));\r\n\r\n  return function(dir, origin, length, color, headLength, headWidth) {\r\n\r\n    // dir is assumed to be normalized\r\n\r\n    THREE.Object3D.call(this);\r\n\r\n    if (color === undefined) color = 0xffff00;\r\n    if (length === undefined) length = 1;\r\n    if (headLength === undefined) headLength = 0.2 * length;\r\n    if (headWidth === undefined) headWidth = 0.2 * headLength;\r\n\r\n    this.position.copy(origin);\r\n\r\n    this.line = new THREE.Line(lineGeometry, new THREE.LineBasicMaterial({\r\n      color: color\r\n    }));\r\n    this.line.matrixAutoUpdate = false;\r\n    this.add(this.line);\r\n\r\n    this.cone = new THREE.Mesh(coneGeometry, new THREE.MeshBasicMaterial({\r\n      color: color\r\n    }));\r\n    this.cone.matrixAutoUpdate = false;\r\n    this.add(this.cone);\r\n\r\n    this.setDirection(dir);\r\n    this.setLength(length, headLength, headWidth);\r\n\r\n  }\r\n\r\n}());\r\n\r\nTHREE.ArrowHelper.prototype = Object.create(THREE.Object3D.prototype);\r\nTHREE.ArrowHelper.prototype.constructor = THREE.ArrowHelper;\r\n\r\nTHREE.ArrowHelper.prototype.setDirection = (function() {\r\n\r\n  var axis = new THREE.Vector3();\r\n  var radians;\r\n\r\n  return function(dir) {\r\n\r\n    // dir is assumed to be normalized\r\n\r\n    if (dir.y > 0.99999) {\r\n\r\n      this.quaternion.set(0, 0, 0, 1);\r\n\r\n    }\r\n    else if (dir.y < -0.99999) {\r\n\r\n      this.quaternion.set(1, 0, 0, 0);\r\n\r\n    }\r\n    else {\r\n\r\n      axis.set(dir.z, 0, -dir.x).normalize();\r\n\r\n      radians = Math.acos(dir.y);\r\n\r\n      this.quaternion.setFromAxisAngle(axis, radians);\r\n\r\n    }\r\n\r\n  };\r\n\r\n}());\r\n\r\nTHREE.ArrowHelper.prototype.setLength = function(length, headLength, headWidth) {\r\n\r\n  if (headLength === undefined) headLength = 0.2 * length;\r\n  if (headWidth === undefined) headWidth = 0.2 * headLength;\r\n\r\n  this.line.scale.set(1, length - headLength, 1);\r\n  this.line.updateMatrix();\r\n\r\n  this.cone.scale.set(headWidth, headLength, headWidth);\r\n  this.cone.position.y = length;\r\n  this.cone.updateMatrix();\r\n\r\n};\r\n\r\nTHREE.ArrowHelper.prototype.setColor = function(color) {\r\n\r\n  this.line.material.color.set(color);\r\n  this.cone.material.color.set(color);\r\n\r\n};\r\n\r\n// File:src/extras/helpers/BoxHelper.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.BoxHelper = function(object) {\r\n\r\n  var geometry = new THREE.BufferGeometry();\r\n  geometry.addAttribute('position', new THREE.BufferAttribute(new Float32Array(72), 3));\r\n\r\n  THREE.Line.call(this, geometry, new THREE.LineBasicMaterial({\r\n    color: 0xffff00\r\n  }), THREE.LinePieces);\r\n\r\n  if (object !== undefined) {\r\n\r\n    this.update(object);\r\n\r\n  }\r\n\r\n};\r\n\r\nTHREE.BoxHelper.prototype = Object.create(THREE.Line.prototype);\r\nTHREE.BoxHelper.prototype.constructor = THREE.BoxHelper;\r\n\r\nTHREE.BoxHelper.prototype.update = function(object) {\r\n\r\n  var geometry = object.geometry;\r\n\r\n  if (geometry.boundingBox === null) {\r\n\r\n    geometry.computeBoundingBox();\r\n\r\n  }\r\n\r\n  var min = geometry.boundingBox.min;\r\n  var max = geometry.boundingBox.max;\r\n\r\n  /*\r\n    5____4\r\n  1/___0/|\r\n  | 6__|_7\r\n  2/___3/\r\n\r\n  0: max.x, max.y, max.z\r\n  1: min.x, max.y, max.z\r\n  2: min.x, min.y, max.z\r\n  3: max.x, min.y, max.z\r\n  4: max.x, max.y, min.z\r\n  5: min.x, max.y, min.z\r\n  6: min.x, min.y, min.z\r\n  7: max.x, min.y, min.z\r\n  */\r\n\r\n  var vertices = this.geometry.attributes.position.array;\r\n\r\n  vertices[0] = max.x;\r\n  vertices[1] = max.y;\r\n  vertices[2] = max.z;\r\n  vertices[3] = min.x;\r\n  vertices[4] = max.y;\r\n  vertices[5] = max.z;\r\n\r\n  vertices[6] = min.x;\r\n  vertices[7] = max.y;\r\n  vertices[8] = max.z;\r\n  vertices[9] = min.x;\r\n  vertices[10] = min.y;\r\n  vertices[11] = max.z;\r\n\r\n  vertices[12] = min.x;\r\n  vertices[13] = min.y;\r\n  vertices[14] = max.z;\r\n  vertices[15] = max.x;\r\n  vertices[16] = min.y;\r\n  vertices[17] = max.z;\r\n\r\n  vertices[18] = max.x;\r\n  vertices[19] = min.y;\r\n  vertices[20] = max.z;\r\n  vertices[21] = max.x;\r\n  vertices[22] = max.y;\r\n  vertices[23] = max.z;\r\n\r\n  //\r\n\r\n  vertices[24] = max.x;\r\n  vertices[25] = max.y;\r\n  vertices[26] = min.z;\r\n  vertices[27] = min.x;\r\n  vertices[28] = max.y;\r\n  vertices[29] = min.z;\r\n\r\n  vertices[30] = min.x;\r\n  vertices[31] = max.y;\r\n  vertices[32] = min.z;\r\n  vertices[33] = min.x;\r\n  vertices[34] = min.y;\r\n  vertices[35] = min.z;\r\n\r\n  vertices[36] = min.x;\r\n  vertices[37] = min.y;\r\n  vertices[38] = min.z;\r\n  vertices[39] = max.x;\r\n  vertices[40] = min.y;\r\n  vertices[41] = min.z;\r\n\r\n  vertices[42] = max.x;\r\n  vertices[43] = min.y;\r\n  vertices[44] = min.z;\r\n  vertices[45] = max.x;\r\n  vertices[46] = max.y;\r\n  vertices[47] = min.z;\r\n\r\n  //\r\n\r\n  vertices[48] = max.x;\r\n  vertices[49] = max.y;\r\n  vertices[50] = max.z;\r\n  vertices[51] = max.x;\r\n  vertices[52] = max.y;\r\n  vertices[53] = min.z;\r\n\r\n  vertices[54] = min.x;\r\n  vertices[55] = max.y;\r\n  vertices[56] = max.z;\r\n  vertices[57] = min.x;\r\n  vertices[58] = max.y;\r\n  vertices[59] = min.z;\r\n\r\n  vertices[60] = min.x;\r\n  vertices[61] = min.y;\r\n  vertices[62] = max.z;\r\n  vertices[63] = min.x;\r\n  vertices[64] = min.y;\r\n  vertices[65] = min.z;\r\n\r\n  vertices[66] = max.x;\r\n  vertices[67] = min.y;\r\n  vertices[68] = max.z;\r\n  vertices[69] = max.x;\r\n  vertices[70] = min.y;\r\n  vertices[71] = min.z;\r\n\r\n  this.geometry.attributes.position.needsUpdate = true;\r\n\r\n  this.geometry.computeBoundingSphere();\r\n\r\n  this.matrix = object.matrixWorld;\r\n  this.matrixAutoUpdate = false;\r\n\r\n};\r\n\r\n// File:src/extras/helpers/BoundingBoxHelper.js\r\n\r\n/**\r\n * @author WestLangley / http://github.com/WestLangley\r\n */\r\n\r\n// a helper to show the world-axis-aligned bounding box for an object\r\n\r\nTHREE.BoundingBoxHelper = function(object, hex) {\r\n\r\n  var color = (hex !== undefined) ? hex : 0x888888;\r\n\r\n  this.object = object;\r\n\r\n  this.box = new THREE.Box3();\r\n\r\n  THREE.Mesh.call(this, new THREE.BoxGeometry(1, 1, 1), new THREE.MeshBasicMaterial({\r\n    color: color,\r\n    wireframe: true\r\n  }));\r\n\r\n};\r\n\r\nTHREE.BoundingBoxHelper.prototype = Object.create(THREE.Mesh.prototype);\r\nTHREE.BoundingBoxHelper.prototype.constructor = THREE.BoundingBoxHelper;\r\n\r\nTHREE.BoundingBoxHelper.prototype.update = function() {\r\n\r\n  this.box.setFromObject(this.object);\r\n\r\n  this.box.size(this.scale);\r\n\r\n  this.box.center(this.position);\r\n\r\n};\r\n\r\n// File:src/extras/helpers/CameraHelper.js\r\n\r\n/**\r\n * @author alteredq / http://alteredqualia.com/\r\n *\r\n *\t- shows frustum, line of sight and up of the camera\r\n *\t- suitable for fast updates\r\n * \t- based on frustum visualization in lightgl.js shadowmap example\r\n *\t\thttp://evanw.github.com/lightgl.js/tests/shadowmap.html\r\n */\r\n\r\nTHREE.CameraHelper = function(camera) {\r\n\r\n  var geometry = new THREE.Geometry();\r\n  var material = new THREE.LineBasicMaterial({\r\n    color: 0xffffff,\r\n    vertexColors: THREE.FaceColors\r\n  });\r\n\r\n  var pointMap = {};\r\n\r\n  // colors\r\n\r\n  var hexFrustum = 0xffaa00;\r\n  var hexCone = 0xff0000;\r\n  var hexUp = 0x00aaff;\r\n  var hexTarget = 0xffffff;\r\n  var hexCross = 0x333333;\r\n\r\n  // near\r\n\r\n  addLine(\"n1\", \"n2\", hexFrustum);\r\n  addLine(\"n2\", \"n4\", hexFrustum);\r\n  addLine(\"n4\", \"n3\", hexFrustum);\r\n  addLine(\"n3\", \"n1\", hexFrustum);\r\n\r\n  // far\r\n\r\n  addLine(\"f1\", \"f2\", hexFrustum);\r\n  addLine(\"f2\", \"f4\", hexFrustum);\r\n  addLine(\"f4\", \"f3\", hexFrustum);\r\n  addLine(\"f3\", \"f1\", hexFrustum);\r\n\r\n  // sides\r\n\r\n  addLine(\"n1\", \"f1\", hexFrustum);\r\n  addLine(\"n2\", \"f2\", hexFrustum);\r\n  addLine(\"n3\", \"f3\", hexFrustum);\r\n  addLine(\"n4\", \"f4\", hexFrustum);\r\n\r\n  // cone\r\n\r\n  addLine(\"p\", \"n1\", hexCone);\r\n  addLine(\"p\", \"n2\", hexCone);\r\n  addLine(\"p\", \"n3\", hexCone);\r\n  addLine(\"p\", \"n4\", hexCone);\r\n\r\n  // up\r\n\r\n  addLine(\"u1\", \"u2\", hexUp);\r\n  addLine(\"u2\", \"u3\", hexUp);\r\n  addLine(\"u3\", \"u1\", hexUp);\r\n\r\n  // target\r\n\r\n  addLine(\"c\", \"t\", hexTarget);\r\n  addLine(\"p\", \"c\", hexCross);\r\n\r\n  // cross\r\n\r\n  addLine(\"cn1\", \"cn2\", hexCross);\r\n  addLine(\"cn3\", \"cn4\", hexCross);\r\n\r\n  addLine(\"cf1\", \"cf2\", hexCross);\r\n  addLine(\"cf3\", \"cf4\", hexCross);\r\n\r\n  function addLine(a, b, hex) {\r\n\r\n    addPoint(a, hex);\r\n    addPoint(b, hex);\r\n\r\n  }\r\n\r\n  function addPoint(id, hex) {\r\n\r\n    geometry.vertices.push(new THREE.Vector3());\r\n    geometry.colors.push(new THREE.Color(hex));\r\n\r\n    if (pointMap[id] === undefined) {\r\n\r\n      pointMap[id] = [];\r\n\r\n    }\r\n\r\n    pointMap[id].push(geometry.vertices.length - 1);\r\n\r\n  }\r\n\r\n  THREE.Line.call(this, geometry, material, THREE.LinePieces);\r\n\r\n  this.camera = camera;\r\n  this.matrix = camera.matrixWorld;\r\n  this.matrixAutoUpdate = false;\r\n\r\n  this.pointMap = pointMap;\r\n\r\n  this.update();\r\n\r\n};\r\n\r\nTHREE.CameraHelper.prototype = Object.create(THREE.Line.prototype);\r\nTHREE.CameraHelper.prototype.constructor = THREE.CameraHelper;\r\n\r\nTHREE.CameraHelper.prototype.update = function() {\r\n\r\n  var geometry, pointMap;\r\n\r\n  var vector = new THREE.Vector3();\r\n  var camera = new THREE.Camera();\r\n\r\n  var setPoint = function(point, x, y, z) {\r\n\r\n    vector.set(x, y, z).unproject(camera);\r\n\r\n    var points = pointMap[point];\r\n\r\n    if (points !== undefined) {\r\n\r\n      for (var i = 0, il = points.length; i < il; i++) {\r\n\r\n        geometry.vertices[points[i]].copy(vector);\r\n\r\n      }\r\n\r\n    }\r\n\r\n  };\r\n\r\n  return function() {\r\n\r\n    geometry = this.geometry;\r\n    pointMap = this.pointMap;\r\n\r\n    var w = 1,\r\n      h = 1;\r\n\r\n    // we need just camera projection matrix\r\n    // world matrix must be identity\r\n\r\n    camera.projectionMatrix.copy(this.camera.projectionMatrix);\r\n\r\n    // center / target\r\n\r\n    setPoint(\"c\", 0, 0, -1);\r\n    setPoint(\"t\", 0, 0, 1);\r\n\r\n    // near\r\n\r\n    setPoint(\"n1\", -w, -h, -1);\r\n    setPoint(\"n2\", w, -h, -1);\r\n    setPoint(\"n3\", -w, h, -1);\r\n    setPoint(\"n4\", w, h, -1);\r\n\r\n    // far\r\n\r\n    setPoint(\"f1\", -w, -h, 1);\r\n    setPoint(\"f2\", w, -h, 1);\r\n    setPoint(\"f3\", -w, h, 1);\r\n    setPoint(\"f4\", w, h, 1);\r\n\r\n    // up\r\n\r\n    setPoint(\"u1\", w * 0.7, h * 1.1, -1);\r\n    setPoint(\"u2\", -w * 0.7, h * 1.1, -1);\r\n    setPoint(\"u3\", 0, h * 2, -1);\r\n\r\n    // cross\r\n\r\n    setPoint(\"cf1\", -w, 0, 1);\r\n    setPoint(\"cf2\", w, 0, 1);\r\n    setPoint(\"cf3\", 0, -h, 1);\r\n    setPoint(\"cf4\", 0, h, 1);\r\n\r\n    setPoint(\"cn1\", -w, 0, -1);\r\n    setPoint(\"cn2\", w, 0, -1);\r\n    setPoint(\"cn3\", 0, -h, -1);\r\n    setPoint(\"cn4\", 0, h, -1);\r\n\r\n    geometry.verticesNeedUpdate = true;\r\n\r\n  };\r\n\r\n}();\r\n\r\n// File:src/extras/helpers/DirectionalLightHelper.js\r\n\r\n/**\r\n * @author alteredq / http://alteredqualia.com/\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author WestLangley / http://github.com/WestLangley\r\n */\r\n\r\nTHREE.DirectionalLightHelper = function(light, size) {\r\n\r\n  THREE.Object3D.call(this);\r\n\r\n  this.light = light;\r\n  this.light.updateMatrixWorld();\r\n\r\n  this.matrix = light.matrixWorld;\r\n  this.matrixAutoUpdate = false;\r\n\r\n  size = size || 1;\r\n\r\n  var geometry = new THREE.Geometry();\r\n  geometry.vertices.push(\r\n    new THREE.Vector3(-size, size, 0),\r\n    new THREE.Vector3(size, size, 0),\r\n    new THREE.Vector3(size, -size, 0),\r\n    new THREE.Vector3(-size, -size, 0),\r\n    new THREE.Vector3(-size, size, 0)\r\n  );\r\n\r\n  var material = new THREE.LineBasicMaterial({\r\n    fog: false\r\n  });\r\n  material.color.copy(this.light.color).multiplyScalar(this.light.intensity);\r\n\r\n  this.lightPlane = new THREE.Line(geometry, material);\r\n  this.add(this.lightPlane);\r\n\r\n  geometry = new THREE.Geometry();\r\n  geometry.vertices.push(\r\n    new THREE.Vector3(),\r\n    new THREE.Vector3()\r\n  );\r\n\r\n  material = new THREE.LineBasicMaterial({\r\n    fog: false\r\n  });\r\n  material.color.copy(this.light.color).multiplyScalar(this.light.intensity);\r\n\r\n  this.targetLine = new THREE.Line(geometry, material);\r\n  this.add(this.targetLine);\r\n\r\n  this.update();\r\n\r\n};\r\n\r\nTHREE.DirectionalLightHelper.prototype = Object.create(THREE.Object3D.prototype);\r\nTHREE.DirectionalLightHelper.prototype.constructor = THREE.DirectionalLightHelper;\r\n\r\nTHREE.DirectionalLightHelper.prototype.dispose = function() {\r\n\r\n  this.lightPlane.geometry.dispose();\r\n  this.lightPlane.material.dispose();\r\n  this.targetLine.geometry.dispose();\r\n  this.targetLine.material.dispose();\r\n};\r\n\r\nTHREE.DirectionalLightHelper.prototype.update = function() {\r\n\r\n  var v1 = new THREE.Vector3();\r\n  var v2 = new THREE.Vector3();\r\n  var v3 = new THREE.Vector3();\r\n\r\n  return function() {\r\n\r\n    v1.setFromMatrixPosition(this.light.matrixWorld);\r\n    v2.setFromMatrixPosition(this.light.target.matrixWorld);\r\n    v3.subVectors(v2, v1);\r\n\r\n    this.lightPlane.lookAt(v3);\r\n    this.lightPlane.material.color.copy(this.light.color).multiplyScalar(this.light.intensity);\r\n\r\n    this.targetLine.geometry.vertices[1].copy(v3);\r\n    this.targetLine.geometry.verticesNeedUpdate = true;\r\n    this.targetLine.material.color.copy(this.lightPlane.material.color);\r\n\r\n  };\r\n\r\n}();\r\n\r\n// File:src/extras/helpers/EdgesHelper.js\r\n\r\n/**\r\n * @author WestLangley / http://github.com/WestLangley\r\n * @param object THREE.Mesh whose geometry will be used\r\n * @param hex line color\r\n * @param thresholdAngle the minimim angle (in degrees),\r\n * between the face normals of adjacent faces,\r\n * that is required to render an edge. A value of 10 means\r\n * an edge is only rendered if the angle is at least 10 degrees.\r\n */\r\n\r\nTHREE.EdgesHelper = function(object, hex, thresholdAngle) {\r\n\r\n  var color = (hex !== undefined) ? hex : 0xffffff;\r\n  thresholdAngle = (thresholdAngle !== undefined) ? thresholdAngle : 1;\r\n\r\n  var thresholdDot = Math.cos(THREE.Math.degToRad(thresholdAngle));\r\n\r\n  var edge = [0, 0],\r\n    hash = {};\r\n  var sortFunction = function(a, b) {\r\n    return a - b\r\n  };\r\n\r\n  var keys = ['a', 'b', 'c'];\r\n  var geometry = new THREE.BufferGeometry();\r\n\r\n  var geometry2;\r\n\r\n  if (object.geometry instanceof THREE.BufferGeometry) {\r\n\r\n    geometry2 = new THREE.Geometry();\r\n    geometry2.fromBufferGeometry(object.geometry);\r\n\r\n  }\r\n  else {\r\n\r\n    geometry2 = object.geometry.clone();\r\n\r\n  }\r\n\r\n  geometry2.mergeVertices();\r\n  geometry2.computeFaceNormals();\r\n\r\n  var vertices = geometry2.vertices;\r\n  var faces = geometry2.faces;\r\n  var numEdges = 0;\r\n\r\n  for (var i = 0, l = faces.length; i < l; i++) {\r\n\r\n    var face = faces[i];\r\n\r\n    for (var j = 0; j < 3; j++) {\r\n\r\n      edge[0] = face[keys[j]];\r\n      edge[1] = face[keys[(j + 1) % 3]];\r\n      edge.sort(sortFunction);\r\n\r\n      var key = edge.toString();\r\n\r\n      if (hash[key] === undefined) {\r\n\r\n        hash[key] = {\r\n          vert1: edge[0],\r\n          vert2: edge[1],\r\n          face1: i,\r\n          face2: undefined\r\n        };\r\n        numEdges++;\r\n\r\n      }\r\n      else {\r\n\r\n        hash[key].face2 = i;\r\n\r\n      }\r\n\r\n    }\r\n\r\n  }\r\n\r\n  var coords = new Float32Array(numEdges * 2 * 3);\r\n\r\n  var index = 0;\r\n\r\n  for (var key in hash) {\r\n\r\n    var h = hash[key];\r\n\r\n    if (h.face2 === undefined || faces[h.face1].normal.dot(faces[h.face2].normal) <= thresholdDot) {\r\n\r\n      var vertex = vertices[h.vert1];\r\n      coords[index++] = vertex.x;\r\n      coords[index++] = vertex.y;\r\n      coords[index++] = vertex.z;\r\n\r\n      vertex = vertices[h.vert2];\r\n      coords[index++] = vertex.x;\r\n      coords[index++] = vertex.y;\r\n      coords[index++] = vertex.z;\r\n\r\n    }\r\n\r\n  }\r\n\r\n  geometry.addAttribute('position', new THREE.BufferAttribute(coords, 3));\r\n\r\n  THREE.Line.call(this, geometry, new THREE.LineBasicMaterial({\r\n    color: color\r\n  }), THREE.LinePieces);\r\n\r\n  this.matrix = object.matrixWorld;\r\n  this.matrixAutoUpdate = false;\r\n\r\n};\r\n\r\nTHREE.EdgesHelper.prototype = Object.create(THREE.Line.prototype);\r\nTHREE.EdgesHelper.prototype.constructor = THREE.EdgesHelper;\r\n\r\n// File:src/extras/helpers/FaceNormalsHelper.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author WestLangley / http://github.com/WestLangley\r\n */\r\n\r\nTHREE.FaceNormalsHelper = function(object, size, hex, linewidth) {\r\n\r\n  this.object = object;\r\n\r\n  this.size = (size !== undefined) ? size : 1;\r\n\r\n  var color = (hex !== undefined) ? hex : 0xffff00;\r\n\r\n  var width = (linewidth !== undefined) ? linewidth : 1;\r\n\r\n  var geometry = new THREE.Geometry();\r\n\r\n  var faces = this.object.geometry.faces;\r\n\r\n  for (var i = 0, l = faces.length; i < l; i++) {\r\n\r\n    geometry.vertices.push(new THREE.Vector3(), new THREE.Vector3());\r\n\r\n  }\r\n\r\n  THREE.Line.call(this, geometry, new THREE.LineBasicMaterial({\r\n    color: color,\r\n    linewidth: width\r\n  }), THREE.LinePieces);\r\n\r\n  this.matrixAutoUpdate = false;\r\n\r\n  this.normalMatrix = new THREE.Matrix3();\r\n\r\n  this.update();\r\n\r\n};\r\n\r\nTHREE.FaceNormalsHelper.prototype = Object.create(THREE.Line.prototype);\r\nTHREE.FaceNormalsHelper.prototype.constructor = THREE.FaceNormalsHelper;\r\n\r\nTHREE.FaceNormalsHelper.prototype.update = function() {\r\n\r\n  var vertices = this.geometry.vertices;\r\n\r\n  var object = this.object;\r\n  var objectVertices = object.geometry.vertices;\r\n  var objectFaces = object.geometry.faces;\r\n  var objectWorldMatrix = object.matrixWorld;\r\n\r\n  object.updateMatrixWorld(true);\r\n\r\n  this.normalMatrix.getNormalMatrix(objectWorldMatrix);\r\n\r\n  for (var i = 0, i2 = 0, l = objectFaces.length; i < l; i++, i2 += 2) {\r\n\r\n    var face = objectFaces[i];\r\n\r\n    vertices[i2].copy(objectVertices[face.a])\r\n      .add(objectVertices[face.b])\r\n      .add(objectVertices[face.c])\r\n      .divideScalar(3)\r\n      .applyMatrix4(objectWorldMatrix);\r\n\r\n    vertices[i2 + 1].copy(face.normal)\r\n      .applyMatrix3(this.normalMatrix)\r\n      .normalize()\r\n      .multiplyScalar(this.size)\r\n      .add(vertices[i2]);\r\n\r\n  }\r\n\r\n  this.geometry.verticesNeedUpdate = true;\r\n\r\n  return this;\r\n\r\n};\r\n\r\n\r\n// File:src/extras/helpers/GridHelper.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.GridHelper = function(size, step) {\r\n\r\n  var geometry = new THREE.Geometry();\r\n  var material = new THREE.LineBasicMaterial({\r\n    vertexColors: THREE.VertexColors\r\n  });\r\n\r\n  this.color1 = new THREE.Color(0x444444);\r\n  this.color2 = new THREE.Color(0x888888);\r\n\r\n  for (var i = -size; i <= size; i += step) {\r\n\r\n    geometry.vertices.push(\r\n      new THREE.Vector3(-size, 0, i), new THREE.Vector3(size, 0, i),\r\n      new THREE.Vector3(i, 0, -size), new THREE.Vector3(i, 0, size)\r\n    );\r\n\r\n    var color = i === 0 ? this.color1 : this.color2;\r\n\r\n    geometry.colors.push(color, color, color, color);\r\n\r\n  }\r\n\r\n  THREE.Line.call(this, geometry, material, THREE.LinePieces);\r\n\r\n};\r\n\r\nTHREE.GridHelper.prototype = Object.create(THREE.Line.prototype);\r\nTHREE.GridHelper.prototype.constructor = THREE.GridHelper;\r\n\r\nTHREE.GridHelper.prototype.setColors = function(colorCenterLine, colorGrid) {\r\n\r\n  this.color1.set(colorCenterLine);\r\n  this.color2.set(colorGrid);\r\n\r\n  this.geometry.colorsNeedUpdate = true;\r\n\r\n}\r\n\r\n// File:src/extras/helpers/HemisphereLightHelper.js\r\n\r\n/**\r\n * @author alteredq / http://alteredqualia.com/\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.HemisphereLightHelper = function(light, sphereSize) {\r\n\r\n  THREE.Object3D.call(this);\r\n\r\n  this.light = light;\r\n  this.light.updateMatrixWorld();\r\n\r\n  this.matrix = light.matrixWorld;\r\n  this.matrixAutoUpdate = false;\r\n\r\n  this.colors = [new THREE.Color(), new THREE.Color()];\r\n\r\n  var geometry = new THREE.SphereGeometry(sphereSize, 4, 2);\r\n  geometry.applyMatrix(new THREE.Matrix4().makeRotationX(-Math.PI / 2));\r\n\r\n  for (var i = 0, il = 8; i < il; i++) {\r\n\r\n    geometry.faces[i].color = this.colors[i < 4 ? 0 : 1];\r\n\r\n  }\r\n\r\n  var material = new THREE.MeshBasicMaterial({\r\n    vertexColors: THREE.FaceColors,\r\n    wireframe: true\r\n  });\r\n\r\n  this.lightSphere = new THREE.Mesh(geometry, material);\r\n  this.add(this.lightSphere);\r\n\r\n  this.update();\r\n\r\n};\r\n\r\nTHREE.HemisphereLightHelper.prototype = Object.create(THREE.Object3D.prototype);\r\nTHREE.HemisphereLightHelper.prototype.constructor = THREE.HemisphereLightHelper;\r\n\r\nTHREE.HemisphereLightHelper.prototype.dispose = function() {\r\n  this.lightSphere.geometry.dispose();\r\n  this.lightSphere.material.dispose();\r\n};\r\n\r\nTHREE.HemisphereLightHelper.prototype.update = function() {\r\n\r\n  var vector = new THREE.Vector3();\r\n\r\n  return function() {\r\n\r\n    this.colors[0].copy(this.light.color).multiplyScalar(this.light.intensity);\r\n    this.colors[1].copy(this.light.groundColor).multiplyScalar(this.light.intensity);\r\n\r\n    this.lightSphere.lookAt(vector.setFromMatrixPosition(this.light.matrixWorld).negate());\r\n    this.lightSphere.geometry.colorsNeedUpdate = true;\r\n\r\n  }\r\n\r\n}();\r\n\r\n// File:src/extras/helpers/PointLightHelper.js\r\n\r\n/**\r\n * @author alteredq / http://alteredqualia.com/\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.PointLightHelper = function(light, sphereSize) {\r\n\r\n  this.light = light;\r\n  this.light.updateMatrixWorld();\r\n\r\n  var geometry = new THREE.SphereGeometry(sphereSize, 4, 2);\r\n  var material = new THREE.MeshBasicMaterial({\r\n    wireframe: true,\r\n    fog: false\r\n  });\r\n  material.color.copy(this.light.color).multiplyScalar(this.light.intensity);\r\n\r\n  THREE.Mesh.call(this, geometry, material);\r\n\r\n  this.matrix = this.light.matrixWorld;\r\n  this.matrixAutoUpdate = false;\r\n\r\n  /*\r\n  var distanceGeometry = new THREE.IcosahedronGeometry( 1, 2 );\r\n  var distanceMaterial = new THREE.MeshBasicMaterial( { color: hexColor, fog: false, wireframe: true, opacity: 0.1, transparent: true } );\r\n\r\n  this.lightSphere = new THREE.Mesh( bulbGeometry, bulbMaterial );\r\n  this.lightDistance = new THREE.Mesh( distanceGeometry, distanceMaterial );\r\n\r\n  var d = light.distance;\r\n\r\n  if ( d === 0.0 ) {\r\n\r\n  \tthis.lightDistance.visible = false;\r\n\r\n  } else {\r\n\r\n  \tthis.lightDistance.scale.set( d, d, d );\r\n\r\n  }\r\n\r\n  this.add( this.lightDistance );\r\n  */\r\n\r\n};\r\n\r\nTHREE.PointLightHelper.prototype = Object.create(THREE.Mesh.prototype);\r\nTHREE.PointLightHelper.prototype.constructor = THREE.PointLightHelper;\r\n\r\nTHREE.PointLightHelper.prototype.dispose = function() {\r\n\r\n  this.geometry.dispose();\r\n  this.material.dispose();\r\n};\r\n\r\nTHREE.PointLightHelper.prototype.update = function() {\r\n\r\n  this.material.color.copy(this.light.color).multiplyScalar(this.light.intensity);\r\n\r\n  /*\r\n  var d = this.light.distance;\r\n\r\n  if ( d === 0.0 ) {\r\n\r\n  \tthis.lightDistance.visible = false;\r\n\r\n  } else {\r\n\r\n  \tthis.lightDistance.visible = true;\r\n  \tthis.lightDistance.scale.set( d, d, d );\r\n\r\n  }\r\n  */\r\n\r\n};\r\n\r\n// File:src/extras/helpers/SkeletonHelper.js\r\n\r\n/**\r\n * @author Sean Griffin / http://twitter.com/sgrif\r\n * @author Michael Guerrero / http://realitymeltdown.com\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author ikerr / http://verold.com\r\n */\r\n\r\nTHREE.SkeletonHelper = function(object) {\r\n\r\n  this.bones = this.getBoneList(object);\r\n\r\n  var geometry = new THREE.Geometry();\r\n\r\n  for (var i = 0; i < this.bones.length; i++) {\r\n\r\n    var bone = this.bones[i];\r\n\r\n    if (bone.parent instanceof THREE.Bone) {\r\n\r\n      geometry.vertices.push(new THREE.Vector3());\r\n      geometry.vertices.push(new THREE.Vector3());\r\n      geometry.colors.push(new THREE.Color(0, 0, 1));\r\n      geometry.colors.push(new THREE.Color(0, 1, 0));\r\n\r\n    }\r\n\r\n  }\r\n\r\n  var material = new THREE.LineBasicMaterial({\r\n    vertexColors: THREE.VertexColors,\r\n    depthTest: false,\r\n    depthWrite: false,\r\n    transparent: true\r\n  });\r\n\r\n  THREE.Line.call(this, geometry, material, THREE.LinePieces);\r\n\r\n  this.root = object;\r\n\r\n  this.matrix = object.matrixWorld;\r\n  this.matrixAutoUpdate = false;\r\n\r\n  this.update();\r\n\r\n};\r\n\r\n\r\nTHREE.SkeletonHelper.prototype = Object.create(THREE.Line.prototype);\r\nTHREE.SkeletonHelper.prototype.constructor = THREE.SkeletonHelper;\r\n\r\nTHREE.SkeletonHelper.prototype.getBoneList = function(object) {\r\n\r\n  var boneList = [];\r\n\r\n  if (object instanceof THREE.Bone) {\r\n\r\n    boneList.push(object);\r\n\r\n  }\r\n\r\n  for (var i = 0; i < object.children.length; i++) {\r\n\r\n    boneList.push.apply(boneList, this.getBoneList(object.children[i]));\r\n\r\n  }\r\n\r\n  return boneList;\r\n\r\n};\r\n\r\nTHREE.SkeletonHelper.prototype.update = function() {\r\n\r\n  var geometry = this.geometry;\r\n\r\n  var matrixWorldInv = new THREE.Matrix4().getInverse(this.root.matrixWorld);\r\n\r\n  var boneMatrix = new THREE.Matrix4();\r\n\r\n  var j = 0;\r\n\r\n  for (var i = 0; i < this.bones.length; i++) {\r\n\r\n    var bone = this.bones[i];\r\n\r\n    if (bone.parent instanceof THREE.Bone) {\r\n\r\n      boneMatrix.multiplyMatrices(matrixWorldInv, bone.matrixWorld);\r\n      geometry.vertices[j].setFromMatrixPosition(boneMatrix);\r\n\r\n      boneMatrix.multiplyMatrices(matrixWorldInv, bone.parent.matrixWorld);\r\n      geometry.vertices[j + 1].setFromMatrixPosition(boneMatrix);\r\n\r\n      j += 2;\r\n\r\n    }\r\n\r\n  }\r\n\r\n  geometry.verticesNeedUpdate = true;\r\n\r\n  geometry.computeBoundingSphere();\r\n\r\n};\r\n\r\n// File:src/extras/helpers/SpotLightHelper.js\r\n\r\n/**\r\n * @author alteredq / http://alteredqualia.com/\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author WestLangley / http://github.com/WestLangley\r\n */\r\n\r\nTHREE.SpotLightHelper = function(light) {\r\n\r\n  THREE.Object3D.call(this);\r\n\r\n  this.light = light;\r\n  this.light.updateMatrixWorld();\r\n\r\n  this.matrix = light.matrixWorld;\r\n  this.matrixAutoUpdate = false;\r\n\r\n  var geometry = new THREE.CylinderGeometry(0, 1, 1, 8, 1, true);\r\n\r\n  geometry.applyMatrix(new THREE.Matrix4().makeTranslation(0, -0.5, 0));\r\n  geometry.applyMatrix(new THREE.Matrix4().makeRotationX(-Math.PI / 2));\r\n\r\n  var material = new THREE.MeshBasicMaterial({\r\n    wireframe: true,\r\n    fog: false\r\n  });\r\n\r\n  this.cone = new THREE.Mesh(geometry, material);\r\n  this.add(this.cone);\r\n\r\n  this.update();\r\n\r\n};\r\n\r\nTHREE.SpotLightHelper.prototype = Object.create(THREE.Object3D.prototype);\r\nTHREE.SpotLightHelper.prototype.constructor = THREE.SpotLightHelper;\r\n\r\nTHREE.SpotLightHelper.prototype.dispose = function() {\r\n  this.cone.geometry.dispose();\r\n  this.cone.material.dispose();\r\n};\r\n\r\nTHREE.SpotLightHelper.prototype.update = function() {\r\n\r\n  var vector = new THREE.Vector3();\r\n  var vector2 = new THREE.Vector3();\r\n\r\n  return function() {\r\n\r\n    var coneLength = this.light.distance ? this.light.distance : 10000;\r\n    var coneWidth = coneLength * Math.tan(this.light.angle);\r\n\r\n    this.cone.scale.set(coneWidth, coneWidth, coneLength);\r\n\r\n    vector.setFromMatrixPosition(this.light.matrixWorld);\r\n    vector2.setFromMatrixPosition(this.light.target.matrixWorld);\r\n\r\n    this.cone.lookAt(vector2.sub(vector));\r\n\r\n    this.cone.material.color.copy(this.light.color).multiplyScalar(this.light.intensity);\r\n\r\n  };\r\n\r\n}();\r\n\r\n// File:src/extras/helpers/VertexNormalsHelper.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author WestLangley / http://github.com/WestLangley\r\n */\r\n\r\nTHREE.VertexNormalsHelper = function(object, size, hex, linewidth) {\r\n\r\n  this.object = object;\r\n\r\n  this.size = (size !== undefined) ? size : 1;\r\n\r\n  var color = (hex !== undefined) ? hex : 0xff0000;\r\n\r\n  var width = (linewidth !== undefined) ? linewidth : 1;\r\n\r\n  var geometry = new THREE.Geometry();\r\n\r\n  var faces = object.geometry.faces;\r\n\r\n  for (var i = 0, l = faces.length; i < l; i++) {\r\n\r\n    var face = faces[i];\r\n\r\n    for (var j = 0, jl = face.vertexNormals.length; j < jl; j++) {\r\n\r\n      geometry.vertices.push(new THREE.Vector3(), new THREE.Vector3());\r\n\r\n    }\r\n\r\n  }\r\n\r\n  THREE.Line.call(this, geometry, new THREE.LineBasicMaterial({\r\n    color: color,\r\n    linewidth: width\r\n  }), THREE.LinePieces);\r\n\r\n  this.matrixAutoUpdate = false;\r\n\r\n  this.normalMatrix = new THREE.Matrix3();\r\n\r\n  this.update();\r\n\r\n};\r\n\r\nTHREE.VertexNormalsHelper.prototype = Object.create(THREE.Line.prototype);\r\nTHREE.VertexNormalsHelper.prototype.constructor = THREE.VertexNormalsHelper;\r\n\r\nTHREE.VertexNormalsHelper.prototype.update = (function(object) {\r\n\r\n  var v1 = new THREE.Vector3();\r\n\r\n  return function(object) {\r\n\r\n    var keys = ['a', 'b', 'c', 'd'];\r\n\r\n    this.object.updateMatrixWorld(true);\r\n\r\n    this.normalMatrix.getNormalMatrix(this.object.matrixWorld);\r\n\r\n    var vertices = this.geometry.vertices;\r\n\r\n    var verts = this.object.geometry.vertices;\r\n\r\n    var faces = this.object.geometry.faces;\r\n\r\n    var worldMatrix = this.object.matrixWorld;\r\n\r\n    var idx = 0;\r\n\r\n    for (var i = 0, l = faces.length; i < l; i++) {\r\n\r\n      var face = faces[i];\r\n\r\n      for (var j = 0, jl = face.vertexNormals.length; j < jl; j++) {\r\n\r\n        var vertexId = face[keys[j]];\r\n        var vertex = verts[vertexId];\r\n\r\n        var normal = face.vertexNormals[j];\r\n\r\n        vertices[idx].copy(vertex).applyMatrix4(worldMatrix);\r\n\r\n        v1.copy(normal).applyMatrix3(this.normalMatrix).normalize().multiplyScalar(this.size);\r\n\r\n        v1.add(vertices[idx]);\r\n        idx = idx + 1;\r\n\r\n        vertices[idx].copy(v1);\r\n        idx = idx + 1;\r\n\r\n      }\r\n\r\n    }\r\n\r\n    this.geometry.verticesNeedUpdate = true;\r\n\r\n    return this;\r\n\r\n  }\r\n\r\n}());\r\n\r\n// File:src/extras/helpers/VertexTangentsHelper.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author WestLangley / http://github.com/WestLangley\r\n */\r\n\r\nTHREE.VertexTangentsHelper = function(object, size, hex, linewidth) {\r\n\r\n  this.object = object;\r\n\r\n  this.size = (size !== undefined) ? size : 1;\r\n\r\n  var color = (hex !== undefined) ? hex : 0x0000ff;\r\n\r\n  var width = (linewidth !== undefined) ? linewidth : 1;\r\n\r\n  var geometry = new THREE.Geometry();\r\n\r\n  var faces = object.geometry.faces;\r\n\r\n  for (var i = 0, l = faces.length; i < l; i++) {\r\n\r\n    var face = faces[i];\r\n\r\n    for (var j = 0, jl = face.vertexTangents.length; j < jl; j++) {\r\n\r\n      geometry.vertices.push(new THREE.Vector3());\r\n      geometry.vertices.push(new THREE.Vector3());\r\n\r\n    }\r\n\r\n  }\r\n\r\n  THREE.Line.call(this, geometry, new THREE.LineBasicMaterial({\r\n    color: color,\r\n    linewidth: width\r\n  }), THREE.LinePieces);\r\n\r\n  this.matrixAutoUpdate = false;\r\n\r\n  this.update();\r\n\r\n};\r\n\r\nTHREE.VertexTangentsHelper.prototype = Object.create(THREE.Line.prototype);\r\nTHREE.VertexTangentsHelper.prototype.constructor = THREE.VertexTangentsHelper;\r\n\r\nTHREE.VertexTangentsHelper.prototype.update = (function(object) {\r\n\r\n  var v1 = new THREE.Vector3();\r\n\r\n  return function(object) {\r\n\r\n    var keys = ['a', 'b', 'c', 'd'];\r\n\r\n    this.object.updateMatrixWorld(true);\r\n\r\n    var vertices = this.geometry.vertices;\r\n\r\n    var verts = this.object.geometry.vertices;\r\n\r\n    var faces = this.object.geometry.faces;\r\n\r\n    var worldMatrix = this.object.matrixWorld;\r\n\r\n    var idx = 0;\r\n\r\n    for (var i = 0, l = faces.length; i < l; i++) {\r\n\r\n      var face = faces[i];\r\n\r\n      for (var j = 0, jl = face.vertexTangents.length; j < jl; j++) {\r\n\r\n        var vertexId = face[keys[j]];\r\n        var vertex = verts[vertexId];\r\n\r\n        var tangent = face.vertexTangents[j];\r\n\r\n        vertices[idx].copy(vertex).applyMatrix4(worldMatrix);\r\n\r\n        v1.copy(tangent).transformDirection(worldMatrix).multiplyScalar(this.size);\r\n\r\n        v1.add(vertices[idx]);\r\n        idx = idx + 1;\r\n\r\n        vertices[idx].copy(v1);\r\n        idx = idx + 1;\r\n\r\n      }\r\n\r\n    }\r\n\r\n    this.geometry.verticesNeedUpdate = true;\r\n\r\n    return this;\r\n\r\n  }\r\n\r\n}());\r\n\r\n// File:src/extras/helpers/WireframeHelper.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.WireframeHelper = function(object, hex) {\r\n\r\n  var color = (hex !== undefined) ? hex : 0xffffff;\r\n\r\n  var edge = [0, 0],\r\n    hash = {};\r\n  var sortFunction = function(a, b) {\r\n    return a - b\r\n  };\r\n\r\n  var keys = ['a', 'b', 'c'];\r\n  var geometry = new THREE.BufferGeometry();\r\n\r\n  if (object.geometry instanceof THREE.Geometry) {\r\n\r\n    var vertices = object.geometry.vertices;\r\n    var faces = object.geometry.faces;\r\n    var numEdges = 0;\r\n\r\n    // allocate maximal size\r\n    var edges = new Uint32Array(6 * faces.length);\r\n\r\n    for (var i = 0, l = faces.length; i < l; i++) {\r\n\r\n      var face = faces[i];\r\n\r\n      for (var j = 0; j < 3; j++) {\r\n\r\n        edge[0] = face[keys[j]];\r\n        edge[1] = face[keys[(j + 1) % 3]];\r\n        edge.sort(sortFunction);\r\n\r\n        var key = edge.toString();\r\n\r\n        if (hash[key] === undefined) {\r\n\r\n          edges[2 * numEdges] = edge[0];\r\n          edges[2 * numEdges + 1] = edge[1];\r\n          hash[key] = true;\r\n          numEdges++;\r\n\r\n        }\r\n\r\n      }\r\n\r\n    }\r\n\r\n    var coords = new Float32Array(numEdges * 2 * 3);\r\n\r\n    for (var i = 0, l = numEdges; i < l; i++) {\r\n\r\n      for (var j = 0; j < 2; j++) {\r\n\r\n        var vertex = vertices[edges[2 * i + j]];\r\n\r\n        var index = 6 * i + 3 * j;\r\n        coords[index + 0] = vertex.x;\r\n        coords[index + 1] = vertex.y;\r\n        coords[index + 2] = vertex.z;\r\n\r\n      }\r\n\r\n    }\r\n\r\n    geometry.addAttribute('position', new THREE.BufferAttribute(coords, 3));\r\n\r\n  }\r\n  else if (object.geometry instanceof THREE.BufferGeometry) {\r\n\r\n    if (object.geometry.attributes.index !== undefined) { // Indexed BufferGeometry\r\n\r\n      var vertices = object.geometry.attributes.position.array;\r\n      var indices = object.geometry.attributes.index.array;\r\n      var drawcalls = object.geometry.drawcalls;\r\n      var numEdges = 0;\r\n\r\n      if (drawcalls.length === 0) {\r\n\r\n        drawcalls = [{\r\n          count: indices.length,\r\n          index: 0,\r\n          start: 0\r\n        }];\r\n\r\n      }\r\n\r\n      // allocate maximal size\r\n      var edges = new Uint32Array(2 * indices.length);\r\n\r\n      for (var o = 0, ol = drawcalls.length; o < ol; ++o) {\r\n\r\n        var start = drawcalls[o].start;\r\n        var count = drawcalls[o].count;\r\n        var index = drawcalls[o].index;\r\n\r\n        for (var i = start, il = start + count; i < il; i += 3) {\r\n\r\n          for (var j = 0; j < 3; j++) {\r\n\r\n            edge[0] = index + indices[i + j];\r\n            edge[1] = index + indices[i + (j + 1) % 3];\r\n            edge.sort(sortFunction);\r\n\r\n            var key = edge.toString();\r\n\r\n            if (hash[key] === undefined) {\r\n\r\n              edges[2 * numEdges] = edge[0];\r\n              edges[2 * numEdges + 1] = edge[1];\r\n              hash[key] = true;\r\n              numEdges++;\r\n\r\n            }\r\n\r\n          }\r\n\r\n        }\r\n\r\n      }\r\n\r\n      var coords = new Float32Array(numEdges * 2 * 3);\r\n\r\n      for (var i = 0, l = numEdges; i < l; i++) {\r\n\r\n        for (var j = 0; j < 2; j++) {\r\n\r\n          var index = 6 * i + 3 * j;\r\n          var index2 = 3 * edges[2 * i + j];\r\n          coords[index + 0] = vertices[index2];\r\n          coords[index + 1] = vertices[index2 + 1];\r\n          coords[index + 2] = vertices[index2 + 2];\r\n\r\n        }\r\n\r\n      }\r\n\r\n      geometry.addAttribute('position', new THREE.BufferAttribute(coords, 3));\r\n\r\n    }\r\n    else { // non-indexed BufferGeometry\r\n\r\n      var vertices = object.geometry.attributes.position.array;\r\n      var numEdges = vertices.length / 3;\r\n      var numTris = numEdges / 3;\r\n\r\n      var coords = new Float32Array(numEdges * 2 * 3);\r\n\r\n      for (var i = 0, l = numTris; i < l; i++) {\r\n\r\n        for (var j = 0; j < 3; j++) {\r\n\r\n          var index = 18 * i + 6 * j;\r\n\r\n          var index1 = 9 * i + 3 * j;\r\n          coords[index + 0] = vertices[index1];\r\n          coords[index + 1] = vertices[index1 + 1];\r\n          coords[index + 2] = vertices[index1 + 2];\r\n\r\n          var index2 = 9 * i + 3 * ((j + 1) % 3);\r\n          coords[index + 3] = vertices[index2];\r\n          coords[index + 4] = vertices[index2 + 1];\r\n          coords[index + 5] = vertices[index2 + 2];\r\n\r\n        }\r\n\r\n      }\r\n\r\n      geometry.addAttribute('position', new THREE.BufferAttribute(coords, 3));\r\n\r\n    }\r\n\r\n  }\r\n\r\n  THREE.Line.call(this, geometry, new THREE.LineBasicMaterial({\r\n    color: color\r\n  }), THREE.LinePieces);\r\n\r\n  this.matrix = object.matrixWorld;\r\n  this.matrixAutoUpdate = false;\r\n\r\n};\r\n\r\nTHREE.WireframeHelper.prototype = Object.create(THREE.Line.prototype);\r\nTHREE.WireframeHelper.prototype.constructor = THREE.WireframeHelper;\r\n\r\n// File:src/extras/objects/ImmediateRenderObject.js\r\n\r\n/**\r\n * @author alteredq / http://alteredqualia.com/\r\n */\r\n\r\nTHREE.ImmediateRenderObject = function() {\r\n\r\n  THREE.Object3D.call(this);\r\n\r\n  this.render = function(renderCallback) {};\r\n\r\n};\r\n\r\nTHREE.ImmediateRenderObject.prototype = Object.create(THREE.Object3D.prototype);\r\nTHREE.ImmediateRenderObject.prototype.constructor = THREE.ImmediateRenderObject;\r\n\r\n// File:src/extras/objects/MorphBlendMesh.js\r\n\r\n/**\r\n * @author alteredq / http://alteredqualia.com/\r\n */\r\n\r\nTHREE.MorphBlendMesh = function(geometry, material) {\r\n\r\n  THREE.Mesh.call(this, geometry, material);\r\n\r\n  this.animationsMap = {};\r\n  this.animationsList = [];\r\n\r\n  // prepare default animation\r\n  // (all frames played together in 1 second)\r\n\r\n  var numFrames = this.geometry.morphTargets.length;\r\n\r\n  var name = \"__default\";\r\n\r\n  var startFrame = 0;\r\n  var endFrame = numFrames - 1;\r\n\r\n  var fps = numFrames / 1;\r\n\r\n  this.createAnimation(name, startFrame, endFrame, fps);\r\n  this.setAnimationWeight(name, 1);\r\n\r\n};\r\n\r\nTHREE.MorphBlendMesh.prototype = Object.create(THREE.Mesh.prototype);\r\nTHREE.MorphBlendMesh.prototype.constructor = THREE.MorphBlendMesh;\r\n\r\nTHREE.MorphBlendMesh.prototype.createAnimation = function(name, start, end, fps) {\r\n\r\n  var animation = {\r\n\r\n    startFrame: start,\r\n    endFrame: end,\r\n\r\n    length: end - start + 1,\r\n\r\n    fps: fps,\r\n    duration: (end - start) / fps,\r\n\r\n    lastFrame: 0,\r\n    currentFrame: 0,\r\n\r\n    active: false,\r\n\r\n    time: 0,\r\n    direction: 1,\r\n    weight: 1,\r\n\r\n    directionBackwards: false,\r\n    mirroredLoop: false\r\n\r\n  };\r\n\r\n  this.animationsMap[name] = animation;\r\n  this.animationsList.push(animation);\r\n\r\n};\r\n\r\nTHREE.MorphBlendMesh.prototype.autoCreateAnimations = function(fps) {\r\n\r\n  var pattern = /([a-z]+)_?(\\d+)/;\r\n\r\n  var firstAnimation, frameRanges = {};\r\n\r\n  var geometry = this.geometry;\r\n\r\n  for (var i = 0, il = geometry.morphTargets.length; i < il; i++) {\r\n\r\n    var morph = geometry.morphTargets[i];\r\n    var chunks = morph.name.match(pattern);\r\n\r\n    if (chunks && chunks.length > 1) {\r\n\r\n      var name = chunks[1];\r\n\r\n      if (!frameRanges[name]) frameRanges[name] = {\r\n        start: Infinity,\r\n        end: -Infinity\r\n      };\r\n\r\n      var range = frameRanges[name];\r\n\r\n      if (i < range.start) range.start = i;\r\n      if (i > range.end) range.end = i;\r\n\r\n      if (!firstAnimation) firstAnimation = name;\r\n\r\n    }\r\n\r\n  }\r\n\r\n  for (var name in frameRanges) {\r\n\r\n    var range = frameRanges[name];\r\n    this.createAnimation(name, range.start, range.end, fps);\r\n\r\n  }\r\n\r\n  this.firstAnimation = firstAnimation;\r\n\r\n};\r\n\r\nTHREE.MorphBlendMesh.prototype.setAnimationDirectionForward = function(name) {\r\n\r\n  var animation = this.animationsMap[name];\r\n\r\n  if (animation) {\r\n\r\n    animation.direction = 1;\r\n    animation.directionBackwards = false;\r\n\r\n  }\r\n\r\n};\r\n\r\nTHREE.MorphBlendMesh.prototype.setAnimationDirectionBackward = function(name) {\r\n\r\n  var animation = this.animationsMap[name];\r\n\r\n  if (animation) {\r\n\r\n    animation.direction = -1;\r\n    animation.directionBackwards = true;\r\n\r\n  }\r\n\r\n};\r\n\r\nTHREE.MorphBlendMesh.prototype.setAnimationFPS = function(name, fps) {\r\n\r\n  var animation = this.animationsMap[name];\r\n\r\n  if (animation) {\r\n\r\n    animation.fps = fps;\r\n    animation.duration = (animation.end - animation.start) / animation.fps;\r\n\r\n  }\r\n\r\n};\r\n\r\nTHREE.MorphBlendMesh.prototype.setAnimationDuration = function(name, duration) {\r\n\r\n  var animation = this.animationsMap[name];\r\n\r\n  if (animation) {\r\n\r\n    animation.duration = duration;\r\n    animation.fps = (animation.end - animation.start) / animation.duration;\r\n\r\n  }\r\n\r\n};\r\n\r\nTHREE.MorphBlendMesh.prototype.setAnimationWeight = function(name, weight) {\r\n\r\n  var animation = this.animationsMap[name];\r\n\r\n  if (animation) {\r\n\r\n    animation.weight = weight;\r\n\r\n  }\r\n\r\n};\r\n\r\nTHREE.MorphBlendMesh.prototype.setAnimationTime = function(name, time) {\r\n\r\n  var animation = this.animationsMap[name];\r\n\r\n  if (animation) {\r\n\r\n    animation.time = time;\r\n\r\n  }\r\n\r\n};\r\n\r\nTHREE.MorphBlendMesh.prototype.getAnimationTime = function(name) {\r\n\r\n  var time = 0;\r\n\r\n  var animation = this.animationsMap[name];\r\n\r\n  if (animation) {\r\n\r\n    time = animation.time;\r\n\r\n  }\r\n\r\n  return time;\r\n\r\n};\r\n\r\nTHREE.MorphBlendMesh.prototype.getAnimationDuration = function(name) {\r\n\r\n  var duration = -1;\r\n\r\n  var animation = this.animationsMap[name];\r\n\r\n  if (animation) {\r\n\r\n    duration = animation.duration;\r\n\r\n  }\r\n\r\n  return duration;\r\n\r\n};\r\n\r\nTHREE.MorphBlendMesh.prototype.playAnimation = function(name) {\r\n\r\n  var animation = this.animationsMap[name];\r\n\r\n  if (animation) {\r\n\r\n    animation.time = 0;\r\n    animation.active = true;\r\n\r\n  }\r\n  else {\r\n\r\n    THREE.warn(\"THREE.MorphBlendMesh: animation[\" + name + \"] undefined in .playAnimation()\");\r\n\r\n  }\r\n\r\n};\r\n\r\nTHREE.MorphBlendMesh.prototype.stopAnimation = function(name) {\r\n\r\n  var animation = this.animationsMap[name];\r\n\r\n  if (animation) {\r\n\r\n    animation.active = false;\r\n\r\n  }\r\n\r\n};\r\n\r\nTHREE.MorphBlendMesh.prototype.update = function(delta) {\r\n\r\n  for (var i = 0, il = this.animationsList.length; i < il; i++) {\r\n\r\n    var animation = this.animationsList[i];\r\n\r\n    if (!animation.active) continue;\r\n\r\n    var frameTime = animation.duration / animation.length;\r\n\r\n    animation.time += animation.direction * delta;\r\n\r\n    if (animation.mirroredLoop) {\r\n\r\n      if (animation.time > animation.duration || animation.time < 0) {\r\n\r\n        animation.direction *= -1;\r\n\r\n        if (animation.time > animation.duration) {\r\n\r\n          animation.time = animation.duration;\r\n          animation.directionBackwards = true;\r\n\r\n        }\r\n\r\n        if (animation.time < 0) {\r\n\r\n          animation.time = 0;\r\n          animation.directionBackwards = false;\r\n\r\n        }\r\n\r\n      }\r\n\r\n    }\r\n    else {\r\n\r\n      animation.time = animation.time % animation.duration;\r\n\r\n      if (animation.time < 0) animation.time += animation.duration;\r\n\r\n    }\r\n\r\n    var keyframe = animation.startFrame + THREE.Math.clamp(Math.floor(animation.time / frameTime), 0, animation.length - 1);\r\n    var weight = animation.weight;\r\n\r\n    if (keyframe !== animation.currentFrame) {\r\n\r\n      this.morphTargetInfluences[animation.lastFrame] = 0;\r\n      this.morphTargetInfluences[animation.currentFrame] = 1 * weight;\r\n\r\n      this.morphTargetInfluences[keyframe] = 0;\r\n\r\n      animation.lastFrame = animation.currentFrame;\r\n      animation.currentFrame = keyframe;\r\n\r\n    }\r\n\r\n    var mix = (animation.time % frameTime) / frameTime;\r\n\r\n    if (animation.directionBackwards) mix = 1 - mix;\r\n\r\n    this.morphTargetInfluences[animation.currentFrame] = mix * weight;\r\n    this.morphTargetInfluences[animation.lastFrame] = (1 - mix) * weight;\r\n\r\n  }\r\n\r\n};\r\n\r\n\r\n// Export the THREE object for **Node.js**, with\r\n// backwards-compatibility for the old `require()` API. If we're in\r\n// the browser, add `_` as a global object via a string identifier,\r\n// for Closure Compiler \"advanced\" mode.\r\nif (typeof exports !== 'undefined') {\r\n  if (typeof module !== 'undefined' && module.exports) {\r\n    exports = module.exports = THREE;\r\n  }\r\n  exports.THREE = THREE;\r\n}\r\nelse {\r\n  this['THREE'] = THREE;\r\n}\r\n\r\n","module.exports = {\r\n  Identifier: require('./components/Identifier.js'),\r\n  Position: require('./components/Position.js'),\r\n  Velocity: require('./components/Velocity.js'),\r\n  Jump: require('./components/Jump.js'),\r\n  Drawable: require('./components/Drawable.js'),\r\n  Expirable: require('./components/Expirable.js'),\r\n  CameraFollow: require('./components/CameraFollow.js'),\r\n  ShootDelay: require('./components/ShootDelay.js'),\r\n  OneTimeHit: require('./components/OneTimeHit.js'),\r\n  Hurt: require('./components/Hurt.js'),\r\n  Health: require('./components/Health.js'),\r\n  Bullet: require('./components/Bullet.js'),\r\n  AI: require('./components/Ai.js'),\r\n  Steaming: require('./components/Steaming.js'),\r\n  CameraPitch: require('./components/CameraPitch.js'),\r\n  Gun: require('./components/Gun.js')\r\n};\r\n\r\n","/**\r\n * b3\r\n * \r\n * Copyright (c) 2014 Renato de Pontes Pereira.\r\n *\r\n * Permission is hereby granted, free of charge, to any person obtaining a copy\r\n * of this software and associated documentation files (the \"Software\"), to \r\n * deal in the Software without restriction, including without limitation the \r\n * rights to use, copy, modify, merge, publish, distribute, sublicense, and/or\r\n * sell copies of the Software, and to permit persons to whom the Software is \r\n * furnished to do so, subject to the following conditions:\r\n *\r\n * The above copyright notice and this permission notice shall be included in\r\n * all copies or substantial portions of the Software.\r\n *\r\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, \r\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER \r\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING \r\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS\r\n * IN THE SOFTWARE.\r\n **/\r\n\r\nvar b3 = b3 || {};\r\n\r\nmodule.exports = b3;\r\n\r\n/**\r\n * Behavior3JS\r\n * ===========\r\n *\r\n * * * *\r\n * \r\n * **Behavior3JS** is a Behavior Tree library written in JavaScript. It \r\n * provides structures and algorithms that assist you in the task of creating \r\n * intelligent agents for your game or application. Check it out some features \r\n * of Behavior3JS:\r\n * \r\n * - Based on the work of (Marzinotto et al., 2014), in which they propose a \r\n *   **formal**, **consistent** and **general** definition of Behavior Trees;\r\n * - **Optimized to control multiple agents**: you can use a single behavior \r\n *   tree instance to handle hundreds of agents;\r\n * - It was **designed to load and save trees in a JSON format**, in order to \r\n *   use, edit and test it in multiple environments, tools and languages;\r\n * - A **cool visual editor** which you can access online;\r\n * - Several **composite, decorator and action nodes** available within the \r\n *   library. You still can define your own nodes, including composites and \r\n *   decorators;\r\n * - **Completely free**, the core module and the visual editor are all published\r\n *   under the MIT License, which means that you can use them for your open source\r\n *   and commercial projects;\r\n * - **Lightweight**, only 11.5KB!\r\n * \r\n * Visit http://behavior3js.guineashots.com to know more!\r\n *\r\n * \r\n * Core Classes and Functions\r\n * --------------------------\r\n * \r\n * This library include the following core structures...\r\n *\r\n * **Public:**\r\n * \r\n * - **BehaviorTree**: the structure that represents a Behavior Tree;\r\n * - **Blackboard**: represents a \"memory\" in an agent and is required to to \r\n *   run a `BehaviorTree`;\r\n * - **Composite**: base class for all composite nodes;\r\n * - **Decorator**: base class for all decorator nodes;\r\n * - **Action**: base class for all action nodes;\r\n * - **Condition**: base class for all condition nodes;\r\n *\r\n * **Internal:**\r\n * \r\n * \r\n * - **Tick**: used as container and tracking object through the tree during \r\n *   the tick signal;\r\n * - **BaseNode**: the base class that provide all common node features;\r\n * \r\n * *Some classes are used internally on Behavior3JS, but you may need to access\r\n * its functionalities eventually, specially the `Tick` object.*\r\n *\r\n * \r\n * Nodes Included \r\n * --------------\r\n *\r\n * **Composite Nodes**: \r\n * \r\n * - Sequence;\r\n * - Priority;\r\n * - MemSequence;\r\n * - MemPriority;\r\n * \r\n * \r\n * **Decorators**: \r\n * \r\n * - Inverter;\r\n * - Limiter\r\n * - MaxTime;\r\n * - Repeater;\r\n * - RepeaterUntilFailure;\r\n * - RepeaterUntilSuccess;\r\n *\r\n * \r\n * **Actions**:\r\n * \r\n * - Succeeder;\r\n * - Failer;\r\n * - Error;\r\n * - Runner;\r\n * - Wait.\r\n * \r\n * @module Behavior3JS\r\n * @main Behavior3JS\r\n **/\r\n\r\n(function() {\r\n  \"use strict\";\r\n\r\n  /**\r\n   * List of all constants in Behavior3JS.\r\n   *\r\n   * @class Constants\r\n   **/\r\n\r\n  /**\r\n   * Version of the library.\r\n   * \r\n   * @property VERSION\r\n   * @type {String}\r\n   */\r\n  b3.VERSION = '0.1.0';\r\n\r\n  /**\r\n   * Returned when a criterion has been met by a condition node or an action node\r\n   * has been completed successfully.\r\n   * \r\n   * @property SUCCESS\r\n   * @type {Integer}\r\n   */\r\n  b3.SUCCESS = 1;\r\n\r\n  /**\r\n   * Returned when a criterion has not been met by a condition node or an action \r\n   * node could not finish its execution for any reason.\r\n   * \r\n   * @property FAILURE\r\n   * @type {Integer}\r\n   */\r\n  b3.FAILURE = 2;\r\n\r\n  /**\r\n   * Returned when an action node has been initialized but is still waiting the \r\n   * its resolution.\r\n   * \r\n   * @property FAILURE\r\n   * @type {Integer}\r\n   */\r\n  b3.RUNNING = 3;\r\n\r\n  /**\r\n   * Returned when some unexpected error happened in the tree, probably by a \r\n   * programming error (trying to verify an undefined variable). Its use depends \r\n   * on the final implementation of the leaf nodes.\r\n   * \r\n   * @property ERROR\r\n   * @type {Integer}\r\n   */\r\n  b3.ERROR = 4;\r\n\r\n\r\n  /**\r\n   * Describes the node category as Composite.\r\n   * \r\n   * @property COMPOSITE\r\n   * @type {String}\r\n   */\r\n  b3.COMPOSITE = 'composite';\r\n\r\n  /**\r\n   * Describes the node category as Decorator.\r\n   * \r\n   * @property DECORATOR\r\n   * @type {String}\r\n   */\r\n  b3.DECORATOR = 'decorator';\r\n\r\n  /**\r\n   * Describes the node category as Action.\r\n   * \r\n   * @property ACTION\r\n   * @type {String}\r\n   */\r\n  b3.ACTION = 'action';\r\n\r\n  /**\r\n   * Describes the node category as Condition.\r\n   * \r\n   * @property CONDITION\r\n   * @type {String}\r\n   */\r\n  b3.CONDITION = 'condition';\r\n\r\n\r\n  /**\r\n   * List of internal and helper functions in Behavior3JS.\r\n   * \r\n   * @class Utils\r\n   **/\r\n\r\n\r\n  /**\r\n   * This function is used to create unique IDs for trees and nodes.\r\n   * \r\n   * (consult http://www.ietf.org/rfc/rfc4122.txt).\r\n   *\r\n   * @method createUUID\r\n   * @return {String} A unique ID.\r\n   **/\r\n  b3.createUUID = function() {\r\n    var s = [];\r\n    var hexDigits = \"0123456789abcdef\";\r\n    for (var i = 0; i < 36; i++) {\r\n      s[i] = hexDigits.substr(Math.floor(Math.random() * 0x10), 1);\r\n    }\r\n    // bits 12-15 of the time_hi_and_version field to 0010\r\n    s[14] = \"4\";\r\n\r\n    // bits 6-7 of the clock_seq_hi_and_reserved to 01\r\n    s[19] = hexDigits.substr((s[19] & 0x3) | 0x8, 1);\r\n\r\n    s[8] = s[13] = s[18] = s[23] = \"-\";\r\n\r\n    var uuid = s.join(\"\");\r\n    return uuid;\r\n  }\r\n\r\n  /**\r\n   * Class is a meta-factory function to create classes in JavaScript. It is a\r\n   * shortcut for the CreateJS syntax style. By default, the class created by \r\n   * this function have an initialize function (the constructor). Optionally, you\r\n   * can specify the inheritance by passing another class as parameter.\r\n   *\r\n   * By default, all classes created using this function, may receives only a\r\n   * settings parameter as argument. This pattern is commonly used by jQuery and \r\n   * its plugins.\r\n   *\r\n   * Usage\r\n   * -----\r\n   *\r\n   *     // Creating a simple class\r\n   *     var BaseClass = b3.Class();\r\n   *\r\n   *     // Using inheritance\r\n   *     var ChildClass = b3.Class(BaseClass);\r\n   *\r\n   *     // Defining the constructor\r\n   *     ChildClass.prototype.initialize = function(settings) { ... }\r\n   *\r\n   * @method Class\r\n   * @param {Object} [baseClass] The super class.\r\n   * @return {Object} A new class.\r\n   **/\r\n  b3.Class = function(baseClass) {\r\n    // create a new class\r\n    var cls = function(params) {\r\n      this.initialize(params);\r\n    }\r\n\r\n    // if base class is provided, inherit\r\n    if (baseClass) {\r\n      cls.prototype = new baseClass();\r\n      cls.prototype.constructor = cls;\r\n    }\r\n\r\n    // create initialize if does not exist on baseClass\r\n    cls.prototype.initialize = cls.prototype.initialize || function() {};\r\n\r\n    return cls;\r\n  }\r\n\r\n})();\r\n/**\r\n * Blackboard\r\n *\r\n * Copyright (c) 2014 Renato de Pontes Pereira.\r\n *\r\n * Permission is hereby granted, free of charge, to any person obtaining a copy\r\n * of this software and associated documentation files (the \"Software\"), to \r\n * deal in the Software without restriction, including without limitation the \r\n * rights to use, copy, modify, merge, publish, distribute, sublicense, and/or\r\n * sell copies of the Software, and to permit persons to whom the Software is \r\n * furnished to do so, subject to the following conditions:\r\n *\r\n * The above copyright notice and this permission notice shall be included in\r\n * all copies or substantial portions of the Software.\r\n *\r\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, \r\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER \r\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING \r\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS\r\n * IN THE SOFTWARE.\r\n **/\r\n\r\n/**\r\n * @module Behavior3JS\r\n **/\r\n\r\n// namespace:\r\nthis.b3 = this.b3 || {};\r\n\r\n(function() {\r\n  \"use strict\";\r\n\r\n  /**\r\n   * The Blackboard is the memory structure required by `BehaviorTree` and its \r\n   * nodes. It only have 2 public methods: `set` and `get`. These methods works \r\n   * in 3 different contexts: global, per tree, and per node per tree.\r\n   * \r\n   * Suppose you have two different trees controlling a single object with a \r\n   * single blackboard, then:\r\n   *\r\n   * - In the global context, all nodes will access the stored information. \r\n   * - In per tree context, only nodes sharing the same tree share the stored \r\n   *   information.\r\n   * - In per node per tree context, the information stored in the blackboard can\r\n   *   only be accessed by the same node that wrote the data.\r\n   *   \r\n   * The context is selected indirectly by the parameters provided to these \r\n   * methods, for example:\r\n   * \r\n   *     // getting/setting variable in global context\r\n   *     blackboard.set('testKey', 'value');\r\n   *     var value = blackboard.get('testKey');\r\n   *     \r\n   *     // getting/setting variable in per tree context\r\n   *     blackboard.set('testKey', 'value', tree.id);\r\n   *     var value = blackboard.get('testKey', tree.id);\r\n   *     \r\n   *     // getting/setting variable in per node per tree context\r\n   *     blackboard.set('testKey', 'value', tree.id, node.id);\r\n   *     var value = blackboard.get('testKey', tree.id, node.id);\r\n   * \r\n   * Note: Internally, the blackboard store these memories in different objects,\r\n   *  being the global on `_baseMemory`, the per tree on `_treeMemory` and the \r\n   *  per node per tree dynamically create inside the per tree memory (it is \r\n   *  accessed via `_treeMemory[id].nodeMemory`). Avoid to use these variables \r\n   *  manually, use `get` and `set` instead.\r\n   *  \r\n   * @class Blackboard\r\n   **/\r\n  var Blackboard = b3.Class();\r\n\r\n  var p = Blackboard.prototype;\r\n\r\n  /**\r\n   * Initialization method.\r\n   *\r\n   * @method initialize\r\n   * @constructor\r\n   **/\r\n  p.initialize = function() {\r\n    this._baseMemory = {};\r\n    this._treeMemory = {};\r\n  }\r\n\r\n  /**\r\n   * Internal method to retrieve the tree context memory. If the memory does\r\n   * not exist, this method creates it.\r\n   *\r\n   * @method _getTreeMemory\r\n   * @param {string} treeScope The id of the tree in scope.\r\n   * @returns {Object} The tree memory.\r\n   * @protected\r\n   **/\r\n  p._getTreeMemory = function(treeScope) {\r\n    if (!this._treeMemory[treeScope]) {\r\n      this._treeMemory[treeScope] = {\r\n        'nodeMemory': {},\r\n        'openNodes': [],\r\n        'traversalDepth': 0,\r\n        'traversalCycle': 0,\r\n      };\r\n    }\r\n    return this._treeMemory[treeScope];\r\n  };\r\n\r\n  /**\r\n   * Internal method to retrieve the node context memory, given the tree \r\n   * memory. If the memory does not exist, this method creates is.\r\n   *\r\n   * @method _getNodeMemory\r\n   * @param {String} treeMemory the tree memory.\r\n   * @param {String} nodeScope The id of the node in scope.\r\n   * @returns {Object} The node memory.\r\n   * @protected\r\n   **/\r\n  p._getNodeMemory = function(treeMemory, nodeScope) {\r\n    var memory = treeMemory['nodeMemory'];\r\n    if (!memory[nodeScope]) {\r\n      memory[nodeScope] = {};\r\n    }\r\n\r\n    return memory[nodeScope];\r\n  };\r\n\r\n  /**\r\n   * Internal method to retrieve the context memory. If treeScope and \r\n   * nodeScope are provided, this method returns the per node per tree \r\n   * memory. If only the treeScope is provided, it returns the per tree \r\n   * memory. If no parameter is provided, it returns the global memory. \r\n   * Notice that, if only nodeScope is provided, this method will still \r\n   * return the global memory.\r\n   *\r\n   * @method _getMemory\r\n   * @param {String} treeScope The id of the tree scope.\r\n   * @param {String} nodeScope The id of the node scope.\r\n   * @returns {Object} A memory object.\r\n   * @protected\r\n   **/\r\n  p._getMemory = function(treeScope, nodeScope) {\r\n    var memory = this._baseMemory;\r\n\r\n    if (treeScope) {\r\n      memory = this._getTreeMemory(treeScope);\r\n\r\n      if (nodeScope) {\r\n        memory = this._getNodeMemory(memory, nodeScope);\r\n      }\r\n    }\r\n\r\n    return memory;\r\n  };\r\n\r\n  /**\r\n   * Stores a value in the blackboard. If treeScope and nodeScope are \r\n   * provided, this method will save the value into the per node per tree \r\n   * memory. If only the treeScope is provided, it will save the value into \r\n   * the per tree memory. If no parameter is provided, this method will save \r\n   * the value into the global memory. Notice that, if only nodeScope is \r\n   * provided (but treeScope not), this method will still save the value into\r\n   * the global memory.\r\n   *\r\n   * @method set\r\n   * @param {String} key The key to be stored.\r\n   * @param {String} value The value to be stored.\r\n   * @param {String} treeScope The tree id if accessing the tree or node \r\n   *                           memory.\r\n   * @param {String} nodeScope The node id if accessing the node memory.\r\n   **/\r\n  p.set = function(key, value, treeScope, nodeScope) {\r\n    var memory = this._getMemory(treeScope, nodeScope);\r\n    memory[key] = value;\r\n  };\r\n\r\n  /**\r\n   * Retrieves a value in the blackboard. If treeScope and nodeScope are\r\n   * provided, this method will retrieve the value from the per node per tree\r\n   * memory. If only the treeScope is provided, it will retrieve the value\r\n   * from the per tree memory. If no parameter is provided, this method will\r\n   * retrieve from the global memory. If only nodeScope is provided (but\r\n   * treeScope not), this method will still try to retrieve from the global\r\n   * memory.\r\n   *\r\n   * @method get\r\n   * @param {String} key The key to be retrieved.\r\n   * @param {String} treeScope The tree id if accessing the tree or node \r\n   *                           memory.\r\n   * @param {String} nodeScope The node id if accessing the node memory.\r\n   * @returns {Object} The value stored or undefined.\r\n   **/\r\n  p.get = function(key, treeScope, nodeScope) {\r\n    var memory = this._getMemory(treeScope, nodeScope);\r\n    return memory[key];\r\n  };\r\n\r\n  b3.Blackboard = Blackboard;\r\n\r\n})();\r\n/**\r\n * Tick\r\n *\r\n * Copyright (c) 2014 Renato de Pontes Pereira.\r\n *\r\n * Permission is hereby granted, free of charge, to any person obtaining a copy\r\n * of this software and associated documentation files (the \"Software\"), to \r\n * deal in the Software without restriction, including without limitation the \r\n * rights to use, copy, modify, merge, publish, distribute, sublicense, and/or\r\n * sell copies of the Software, and to permit persons to whom the Software is \r\n * furnished to do so, subject to the following conditions:\r\n *\r\n * The above copyright notice and this permission notice shall be included in\r\n * all copies or substantial portions of the Software.\r\n *\r\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, \r\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER \r\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING \r\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS\r\n * IN THE SOFTWARE.\r\n **/\r\n\r\n/**\r\n * @module Behavior3JS\r\n **/\r\n\r\n// namespace:\r\nthis.b3 = this.b3 || {};\r\n\r\n(function() {\r\n  \"use strict\";\r\n\r\n  /**\r\n   * A new Tick object is instantiated every tick by BehaviorTree. It is passed \r\n   * as parameter to the nodes through the tree during the traversal.\r\n   * \r\n   * The role of the Tick class is to store the instances of tree, debug, target\r\n   * and blackboard. So, all nodes can access these informations.\r\n   * \r\n   * For internal uses, the Tick also is useful to store the open node after the \r\n   * tick signal, in order to let `BehaviorTree` to keep track and close them \r\n   * when necessary.\r\n   *\r\n   * This class also makes a bridge between nodes and the debug, passing the node\r\n   * state to the debug if the last is provided.\r\n   *\r\n   * @class Tick\r\n   **/\r\n  var Tick = b3.Class();\r\n\r\n  var p = Tick.prototype;\r\n\r\n  /**\r\n   * The tree reference.\r\n   * \r\n   * @property tree\r\n   * @type {b3.BehaviorTree}\r\n   * @readOnly\r\n   */\r\n\r\n  /**\r\n   * The debug reference.\r\n   * \r\n   * @property debug\r\n   * @type {Object}\r\n   * @readOnly\r\n   */\r\n\r\n  /**\r\n   * The target object reference.\r\n   * \r\n   * @property target\r\n   * @type {Object}\r\n   * @readOnly\r\n   */\r\n\r\n  /**\r\n   * The blackboard reference.\r\n   * \r\n   * @property blackboard\r\n   * @type {Blackboard}\r\n   * @readOnly\r\n   */\r\n\r\n  /**\r\n   * The list of open nodes. Update during the tree traversal.\r\n   * \r\n   * @property _openNodes\r\n   * @type {Array}\r\n   * @protected\r\n   * @readOnly\r\n   */\r\n\r\n  /**\r\n   * The number of nodes entered during the tick. Update during the tree \r\n   * traversal.\r\n   * \r\n   * @property _nodeCount\r\n   * @type {Integer}\r\n   * @protected\r\n   * @readOnly\r\n   */\r\n\r\n  /**\r\n   * Initialization method.\r\n   *\r\n   * @method initialize\r\n   * @constructor\r\n   **/\r\n  p.initialize = function() {\r\n    // set by BehaviorTree\r\n    this.tree = null;\r\n    this.debug = null;\r\n    this.target = null;\r\n    this.blackboard = null;\r\n\r\n    // updated during the tick signal\r\n    this._openNodes = [];\r\n    this._nodeCount = 0;\r\n  }\r\n\r\n  /**\r\n   * Called when entering a node (called by BaseNode).\r\n   *\r\n   * @method _enterNode\r\n   * @param {Object} node The node that called this method.\r\n   * @protected\r\n   **/\r\n  p._enterNode = function(node) {\r\n    this._nodeCount++;\r\n    this._openNodes.push(node);\r\n\r\n    // TODO: call debug here\r\n  }\r\n\r\n  /**\r\n   * Callback when opening a node (called by BaseNode). \r\n   *\r\n   * @method _openNode\r\n   * @param {Object} node The node that called this method.\r\n   * @protected\r\n   **/\r\n  p._openNode = function(node) {\r\n    // TODO: call debug here\r\n  }\r\n\r\n  /**\r\n   * Callback when ticking a node (called by BaseNode).\r\n   *\r\n   * @method _tickNode\r\n   * @param {Object} node The node that called this method.\r\n   * @protected\r\n   **/\r\n  p._tickNode = function(node) {\r\n    // TODO: call debug here\r\n  }\r\n\r\n  /**\r\n   * Callback when closing a node (called by BaseNode).\r\n   *\r\n   * @method _closeNode\r\n   * @param {Object} node The node that called this method.\r\n   * @protected\r\n   **/\r\n  p._closeNode = function(node) {\r\n    // TODO: call debug here\r\n    this._openNodes.pop();\r\n  }\r\n\r\n  /**\r\n   * Callback when exiting a node (called by BaseNode).\r\n   *\r\n   * @method _exitNode\r\n   * @param {Object} node The node that called this method.\r\n   * @protected\r\n   **/\r\n  p._exitNode = function(node) {\r\n    // TODO: call debug here\r\n  }\r\n\r\n  b3.Tick = Tick;\r\n\r\n})();\r\n/**\r\n * BehaviorTree\r\n *\r\n * Copyright (c) 2014 Renato de Pontes Pereira.\r\n *\r\n * Permission is hereby granted, free of charge, to any person obtaining a copy\r\n * of this software and associated documentation files (the \"Software\"), to \r\n * deal in the Software without restriction, including without limitation the \r\n * rights to use, copy, modify, merge, publish, distribute, sublicense, and/or\r\n * sell copies of the Software, and to permit persons to whom the Software is \r\n * furnished to do so, subject to the following conditions:\r\n *\r\n * The above copyright notice and this permission notice shall be included in\r\n * all copies or substantial portions of the Software.\r\n *\r\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, \r\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER \r\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING \r\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS\r\n * IN THE SOFTWARE.\r\n **/\r\n\r\n/**\r\n * @module Behavior3JS\r\n **/\r\n\r\n// namespace:\r\nthis.b3 = this.b3 || {};\r\n\r\n(function() {\r\n  \"use strict\";\r\n\r\n  /**\r\n   * The BehaviorTree class, as the name implies, represents the Behavior Tree \r\n   * structure.\r\n   * \r\n   * There are two ways to construct a Behavior Tree: by manually setting the \r\n   * root node, or by loading it from a data structure (which can be loaded from \r\n   * a JSON). Both methods are shown in the examples below and better explained \r\n   * in the user guide.\r\n   *\r\n   * The tick method must be called periodically, in order to send the tick \r\n   * signal to all nodes in the tree, starting from the root. The method \r\n   * `BehaviorTree.tick` receives a target object and a blackboard as parameters.\r\n   * The target object can be anything: a game agent, a system, a DOM object, \r\n   * etc. This target is not used by any piece of Behavior3JS, i.e., the target\r\n   * object will only be used by custom nodes.\r\n   * \r\n   * The blackboard is obligatory and must be an instance of `Blackboard`. This \r\n   * requirement is necessary due to the fact that neither `BehaviorTree` or any \r\n   * node will store the execution variables in its own object (e.g., the BT does\r\n   * not store the target, information about opened nodes or number of times the \r\n   * tree was called). But because of this, you only need a single tree instance \r\n   * to control multiple (maybe hundreds) objects.\r\n   * \r\n   * Manual construction of a Behavior Tree\r\n   * --------------------------------------\r\n   * \r\n   *     var tree = new b3.BehaviorTree();\r\n   *  \r\n   *     tree.root = new b3.Sequence({children:[\r\n   *         new b3.Priority({children:[\r\n   *             new MyCustomNode(),\r\n   *             new MyCustomNode()\r\n   *         ]}),\r\n   *         ...\r\n   *     ]});\r\n   *     \r\n   * \r\n   * Loading a Behavior Tree from data structure\r\n   * -------------------------------------------\r\n   * \r\n   *     var tree = new b3.BehaviorTree();\r\n   *\r\n   *     tree.load({\r\n   *         'title'       : 'Behavior Tree title'\r\n   *         'description' : 'My description'\r\n   *         'root'        : 'node-id-1'\r\n   *         'nodes'       : {\r\n   *             'node-id-1' : {\r\n   *                 'name'        : 'Priority', // this is the node type\r\n   *                 'title'       : 'Root Node', \r\n   *                 'description' : 'Description', \r\n   *                 'children'    : ['node-id-2', 'node-id-3'], \r\n   *             },\r\n   *             ...\r\n   *         }\r\n   *     })\r\n   *     \r\n   *\r\n   * @class BehaviorTree\r\n   **/\r\n  var BehaviorTree = b3.Class();\r\n\r\n  var p = BehaviorTree.prototype;\r\n\r\n  /**\r\n   * The tree id, must be unique. By default, created with `b3.createUUID`.\r\n   * \r\n   * @property id\r\n   * @type {String}\r\n   * @readOnly\r\n   */\r\n\r\n  /**\r\n   * The tree title.\r\n   *\r\n   * @property title\r\n   * @type {String}\r\n   */\r\n\r\n  /**\r\n   * Description of the tree.\r\n   *\r\n   * @property description\r\n   * @type {String}\r\n   */\r\n\r\n  /**\r\n   * A dictionary with (key-value) properties. Useful to define custom \r\n   * variables in the visual editor.\r\n   *\r\n   * @property properties\r\n   * @type {Object}\r\n   */\r\n\r\n  /**\r\n   * The reference to the root node. Must be an instance of `b3.BaseNode`.\r\n   *\r\n   * @property root\r\n   * @type {BaseNode}\r\n   */\r\n\r\n  /**\r\n   * The reference to the debug instance.\r\n   *\r\n   * @property debug\r\n   * @type {Object}\r\n   */\r\n\r\n  /**\r\n   * Initialization method.\r\n   *\r\n   * @method initialize\r\n   * @constructor\r\n   **/\r\n  p.initialize = function() {\r\n    this.id = b3.createUUID();\r\n    this.title = 'The behavior tree';\r\n    this.description = 'Default description';\r\n    this.properties = {};\r\n    this.root = null;\r\n    this.debug = null;\r\n  }\r\n\r\n  /**\r\n   * This method loads a Behavior Tree from a data structure, populating this\r\n   * object with the provided data. Notice that, the data structure must \r\n   * follow the format specified by Behavior3JS. Consult the guide to know \r\n   * more about this format.\r\n   *\r\n   * You probably want to use custom nodes in your BTs, thus, you need to \r\n   * provide the `names` object, in which this method can find the nodes by \r\n   * `names[NODE_NAME]`. This variable can be a namespace or a dictionary, \r\n   * as long as this method can find the node by its name, for example:\r\n   *\r\n   *     //json\r\n   *     ...\r\n   *     'node1': {\r\n   *       'name': MyCustomNode,\r\n   *       'title': ...\r\n   *     }\r\n   *     ...\r\n   *     \r\n   *     //code\r\n   *     var bt = new b3.BehaviorTree();\r\n   *     bt.load(data, {'MyCustomNode':MyCustomNode})\r\n   *     \r\n   * \r\n   * @method load\r\n   * @param {Object} data The data structure representing a Behavior Tree.\r\n   * @param {Object} [names] A namespace or dict containing custom nodes.\r\n   **/\r\n  p.load = function(data, names) {\r\n    names = names || {};\r\n\r\n    this.title = data.title || this.title;\r\n    this.description = data.description || this.description;\r\n    this.properties = data.properties || this.properties;\r\n\r\n    var nodes = {};\r\n    // Create the node list (without connection between them)\r\n    for (var id in data.nodes) {\r\n      var spec = data.nodes[id];\r\n\r\n      if (spec.name in names) {\r\n        // Look for the name in custom nodes\r\n        var cls = names[spec.name];\r\n      }\r\n      else if (spec.name in b3) {\r\n        // Look for the name in default nodes\r\n        var cls = b3[spec.name];\r\n      }\r\n      else {\r\n        // Invalid node name\r\n        throw EvalError('BehaviorTree.load: Invalid node name + \"' +\r\n          spec.name + '\".');\r\n      }\r\n\r\n      var node = new cls(spec.parameters);\r\n      node.id = spec.id || node.id;\r\n      node.title = spec.title || node.title;\r\n      node.description = spec.description || node.description;\r\n      node.properties = spec.properties || node.properties;\r\n      node.parameters = spec.parameters || node.parameters;\r\n\r\n      nodes[id] = node;\r\n    }\r\n\r\n    // Connect the nodes\r\n    for (var id in data.nodes) {\r\n      var spec = data.nodes[id];\r\n      var node = nodes[id];\r\n\r\n      if (node.category === b3.COMPOSITE && spec.children) {\r\n        for (var i = 0; i < spec.children.length; i++) {\r\n          var cid = spec.children[i];\r\n          node.children.push(nodes[cid]);\r\n        }\r\n      }\r\n      else if (node.category === b3.DECORATOR && spec.child) {\r\n        node.child = nodes[spec.child];\r\n      }\r\n    }\r\n\r\n    this.root = nodes[data.root];\r\n  };\r\n\r\n  /**\r\n   * This method dump the current BT into a data structure.\r\n   *\r\n   * Note: This method does not record the current node parameters. Thus, \r\n   * it may not be compatible with load for now.\r\n   * \r\n   * @method dump\r\n   * @returns {Object} A data object representing this tree.\r\n   **/\r\n  p.dump = function() {\r\n    var data = {};\r\n\r\n    data.title = this.title;\r\n    data.description = this.description;\r\n    data.root = (this.root) ? this.root.id : null;\r\n    data.properties = this.properties;\r\n    data.nodes = {};\r\n\r\n    if (!this.root) return data;\r\n\r\n    var stack = [this.root];\r\n    while (stack.length > 0) {\r\n      var node = stack.pop();\r\n\r\n      var spec = {};\r\n      spec.id = node.id;\r\n      spec.name = node.name;\r\n      spec.title = node.title;\r\n      spec.description = node.description;\r\n      spec.properties = node.properties;\r\n      spec.parameters = node.parameters;\r\n\r\n      if (node.category === b3.COMPOSITE && node.children) {\r\n        var children = []\r\n        for (var i = node.children.length - 1; i >= 0; i--) {\r\n          children.push(node.children[i].id);\r\n          stack.push(node.children[i]);\r\n        }\r\n        spec.children = children;\r\n      }\r\n      else if (node.category === b3.DECORATOR && node.child) {\r\n        stack.push(node.child);\r\n        spec.child = node.child.id;\r\n      }\r\n\r\n      data.nodes[node.id] = spec;\r\n    }\r\n\r\n    return data;\r\n  };\r\n\r\n  /**\r\n   * Propagates the tick signal through the tree, starting from the root.\r\n   * \r\n   * This method receives a target object of any type (Object, Array, \r\n   * DOMElement, whatever) and a `Blackboard` instance. The target object has\r\n   * no use at all for all Behavior3JS components, but surely is important \r\n   * for custom nodes. The blackboard instance is used by the tree and nodes \r\n   * to store execution variables (e.g., last node running) and is obligatory\r\n   * to be a `Blackboard` instance (or an object with the same interface).\r\n   * \r\n   * Internally, this method creates a Tick object, which will store the \r\n   * target and the blackboard objects.\r\n   * \r\n   * Note: BehaviorTree stores a list of open nodes from last tick, if these \r\n   * nodes weren't called after the current tick, this method will close them \r\n   * automatically.\r\n   * \r\n   * @method tick\r\n   * @param {Object} target A target object.\r\n   * @param {Blackboard} blackboard An instance of blackboard object.\r\n   * @returns {Constant} The tick signal state.\r\n   **/\r\n  p.tick = function(target, blackboard) {\r\n    if (!blackboard) {\r\n      throw 'The blackboard parameter is obligatory and must be an ' +\r\n      'instance of b3.Blackboard';\r\n    }\r\n\r\n    /* CREATE A TICK OBJECT */\r\n    var tick = new b3.Tick();\r\n    tick.debug = this.debug;\r\n    tick.target = target;\r\n    tick.blackboard = blackboard;\r\n    tick.tree = this;\r\n\r\n    /* TICK NODE */\r\n    var state = this.root._execute(tick);\r\n\r\n    /* CLOSE NODES FROM LAST TICK, IF NEEDED */\r\n    var lastOpenNodes = blackboard.get('openNodes', this.id);\r\n    var currOpenNodes = tick._openNodes.slice(0);\r\n\r\n    // does not close if it is still open in this tick\r\n    var start = 0;\r\n    for (var i = 0; i < Math.min(lastOpenNodes.length, currOpenNodes.length); i++) {\r\n      start = i + 1;\r\n      if (lastOpenNodes[i] !== currOpenNodes[i]) {\r\n        break;\r\n      }\r\n    }\r\n\r\n    // close the nodes\r\n    for (var i = lastOpenNodes.length - 1; i >= start; i--) {\r\n      lastOpenNodes[i]._close(tick);\r\n    }\r\n\r\n    /* POPULATE BLACKBOARD */\r\n    blackboard.set('openNodes', currOpenNodes, this.id);\r\n    blackboard.set('nodeCount', tick._nodeCount, this.id);\r\n\r\n    return state;\r\n  };\r\n\r\n\r\n  b3.BehaviorTree = BehaviorTree;\r\n\r\n})();\r\n/**\r\n * BaseNode\r\n *\r\n * Copyright (c) 2014 Renato de Pontes Pereira.\r\n *\r\n * Permission is hereby granted, free of charge, to any person obtaining a copy\r\n * of this software and associated documentation files (the \"Software\"), to \r\n * deal in the Software without restriction, including without limitation the \r\n * rights to use, copy, modify, merge, publish, distribute, sublicense, and/or\r\n * sell copies of the Software, and to permit persons to whom the Software is \r\n * furnished to do so, subject to the following conditions:\r\n *\r\n * The above copyright notice and this permission notice shall be included in\r\n * all copies or substantial portions of the Software.\r\n *\r\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, \r\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER \r\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING \r\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS\r\n * IN THE SOFTWARE.\r\n **/\r\n\r\n/**\r\n * @module Behavior3JS\r\n **/\r\n\r\n// namespace:\r\nthis.b3 = this.b3 || {};\r\n\r\n(function() {\r\n  \"use strict\";\r\n\r\n  /**\r\n   * The BaseNode class is used as super class to all nodes in BehaviorJS. It \r\n   * comprises all common variables and methods that a node must have to execute.\r\n   *\r\n   * **IMPORTANT:** Do not inherit from this class, use `b3.Composite`, \r\n   * `b3.Decorator`, `b3.Action` or `b3.Condition`, instead.\r\n   *\r\n   * The attributes are specially designed to serialization of the node in a JSON\r\n   * format. In special, the `parameters` attribute can be set into the visual \r\n   * editor (thus, in the JSON file), and it will be used as parameter on the \r\n   * node initialization at `BehaviorTree.load`.\r\n   * \r\n   * BaseNode also provide 5 callback methods, which the node implementations can\r\n   * override. They are `enter`, `open`, `tick`, `close` and `exit`. See their \r\n   * documentation to know more. These callbacks are called inside the `_execute`\r\n   * method, which is called in the tree traversal.\r\n   * \r\n   * @class BaseNode\r\n   **/\r\n  var BaseNode = b3.Class();\r\n\r\n  var p = BaseNode.prototype;\r\n\r\n  /**\r\n   * Node ID.\r\n   *\r\n   * @property id\r\n   * @type {String}\r\n   * @readonly\r\n   **/\r\n\r\n  /**\r\n   * Node name. Must be a unique identifier, preferable the same name of the \r\n   * class. You have to set the node name in the prototype.\r\n   *\r\n   * @property name\r\n   * @type {String}\r\n   * @readonly\r\n   **/\r\n  p.name = null;\r\n\r\n  /**\r\n   * Node category. Must be `b3.COMPOSITE`, `b3.DECORATOR`, `b3.ACTION` or \r\n   * `b3.CONDITION`. This is defined automatically be inheriting the \r\n   * correspondent class.\r\n   *\r\n   * @property category\r\n   * @type constant\r\n   * @readonly\r\n   **/\r\n  p.category = null;\r\n\r\n  /**\r\n   * Node title.\r\n   *\r\n   * @property title\r\n   * @type {String}\r\n   * @optional\r\n   * @readonly\r\n   **/\r\n  p.title = null;\r\n\r\n  /**\r\n   * Node description.\r\n   *\r\n   * @property description\r\n   * @type {String}\r\n   * @optional\r\n   * @readonly\r\n   **/\r\n  p.description = null;\r\n\r\n  /**\r\n   * A dictionary (key, value) describing the node parameters. Useful for \r\n   * defining parameter values in the visual editor. Note: this is only \r\n   * useful for nodes when loading trees from JSON files.\r\n   *\r\n   * @property parameters\r\n   * @type {Object}\r\n   * @readonly\r\n   **/\r\n  p.parameters = null;\r\n\r\n  /**\r\n   * A dictionary (key, value) describing the node properties. Useful for \r\n   * defining custom variables inside the visual editor.\r\n   *\r\n   * @property properties\r\n   * @type {Object}\r\n   * @readonly\r\n   **/\r\n  p.properties = null;\r\n\r\n  /**\r\n   * Initialization method.\r\n   *\r\n   * @method initialize\r\n   * @constructor\r\n   **/\r\n  p.initialize = function() {\r\n    this.id = b3.createUUID();\r\n    this.title = this.title || this.name;\r\n    this.description = '';\r\n    this.parameters = {};\r\n    this.properties = {};\r\n  }\r\n\r\n  /**\r\n   * This is the main method to propagate the tick signal to this node. This \r\n   * method calls all callbacks: `enter`, `open`, `tick`, `close`, and \r\n   * `exit`. It only opens a node if it is not already open. In the same \r\n   * way, this method only close a node if the node  returned a status \r\n   * different of `b3.RUNNING`.\r\n   *\r\n   * @method _execute\r\n   * @param {Tick} tick A tick instance.\r\n   * @returns {Constant} The tick state.\r\n   * @protected\r\n   **/\r\n  p._execute = function(tick) {\r\n    /* ENTER */\r\n    this._enter(tick);\r\n\r\n    /* OPEN */\r\n    if (!tick.blackboard.get('isOpen', tick.tree.id, this.id)) {\r\n      this._open(tick);\r\n    }\r\n\r\n    /* TICK */\r\n    var status = this._tick(tick);\r\n\r\n    /* CLOSE */\r\n    if (status !== b3.RUNNING) {\r\n      this._close(tick);\r\n    }\r\n\r\n    /* EXIT */\r\n    this._exit(tick);\r\n\r\n    return status;\r\n  }\r\n\r\n  /**\r\n   * Wrapper for enter method.\r\n   *\r\n   * @method _enter\r\n   * @param {Tick} tick A tick instance.\r\n   * @protected\r\n   **/\r\n  p._enter = function(tick) {\r\n    tick._enterNode(this);\r\n    this.enter(tick);\r\n  }\r\n\r\n  /**\r\n   * Wrapper for open method.\r\n   *\r\n   * @method _open\r\n   * @param {Tick} tick A tick instance.\r\n   * @protected\r\n   **/\r\n  p._open = function(tick) {\r\n    tick._openNode(this);\r\n    tick.blackboard.set('isOpen', true, tick.tree.id, this.id);\r\n    this.open(tick);\r\n  }\r\n\r\n  /**\r\n   * Wrapper for tick method.\r\n   *\r\n   * @method _tick\r\n   * @param {Tick} tick A tick instance.\r\n   * @returns {Constant} A state constant.\r\n   * @protected\r\n   **/\r\n  p._tick = function(tick) {\r\n    tick._tickNode(this);\r\n    return this.tick(tick);\r\n  }\r\n\r\n  /**\r\n   * Wrapper for close method.\r\n   *\r\n   * @method _close\r\n   * @param {Tick} tick A tick instance.\r\n   * @protected\r\n   **/\r\n  p._close = function(tick) {\r\n    tick._closeNode(this);\r\n    tick.blackboard.set('isOpen', false, tick.tree.id, this.id);\r\n    this.close(tick);\r\n  }\r\n\r\n  /**\r\n   * Wrapper for exit method.\r\n   *\r\n   * @method _exit\r\n   * @param {Tick} tick A tick instance.\r\n   * @protected\r\n   **/\r\n  p._exit = function(tick) {\r\n    tick._exitNode(this);\r\n    this.exit(tick);\r\n  }\r\n\r\n  /**\r\n   * Enter method, override this to use. It is called every time a node is \r\n   * asked to execute, before the tick itself.\r\n   *\r\n   * @method enter\r\n   * @param {Tick} tick A tick instance.\r\n   **/\r\n  p.enter = function(tick) {}\r\n\r\n  /**\r\n   * Open method, override this to use. It is called only before the tick \r\n   * callback and only if the not isn't closed.\r\n   *\r\n   * Note: a node will be closed if it returned `b3.RUNNING` in the tick.\r\n   *\r\n   * @method open\r\n   * @param {Tick} tick A tick instance.\r\n   **/\r\n  p.open = function(tick) {}\r\n\r\n  /**\r\n   * Tick method, override this to use. This method must contain the real \r\n   * execution of node (perform a task, call children, etc.). It is called\r\n   * every time a node is asked to execute.\r\n   *\r\n   * @method tick\r\n   * @param {Tick} tick A tick instance.\r\n   **/\r\n  p.tick = function(tick) {}\r\n\r\n  /**\r\n   * Close method, override this to use. This method is called after the tick\r\n   * callback, and only if the tick return a state different from \r\n   * `b3.RUNNING`.\r\n   *\r\n   * @method close\r\n   * @param {Tick} tick A tick instance.\r\n   **/\r\n  p.close = function(tick) {}\r\n\r\n  /**\r\n   * Exit method, override this to use. Called every time in the end of the \r\n   * execution.\r\n   *\r\n   * @method exit\r\n   * @param {Tick} tick A tick instance.\r\n   **/\r\n  p.exit = function(tick) {}\r\n\r\n  b3.BaseNode = BaseNode;\r\n\r\n})();\r\n/**\r\n * Action\r\n *\r\n * Copyright (c) 2014 Renato de Pontes Pereira.\r\n *\r\n * Permission is hereby granted, free of charge, to any person obtaining a copy\r\n * of this software and associated documentation files (the \"Software\"), to \r\n * deal in the Software without restriction, including without limitation the \r\n * rights to use, copy, modify, merge, publish, distribute, sublicense, and/or\r\n * sell copies of the Software, and to permit persons to whom the Software is \r\n * furnished to do so, subject to the following conditions:\r\n *\r\n * The above copyright notice and this permission notice shall be included in\r\n * all copies or substantial portions of the Software.\r\n *\r\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, \r\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER \r\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING \r\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS\r\n * IN THE SOFTWARE.\r\n **/\r\n\r\n/**\r\n * @module Behavior3JS\r\n **/\r\n\r\n// namespace:\r\nthis.b3 = this.b3 || {};\r\n\r\n(function() {\r\n  \"use strict\";\r\n\r\n  /**\r\n   * Action is the base class for all action nodes. Thus, if you want to \r\n   * create new custom action nodes, you need to inherit from this class. \r\n   *\r\n   * For example, take a look at the Runner action:\r\n   * \r\n   *     var Runner = b3.Class(b3.Action);\r\n   *     var p = Runner.prototype;\r\n   *     \r\n   *         p.name = 'Runner';\r\n   *     \r\n   *         p.tick = function(tick) {\r\n   *             return b3.RUNNING;\r\n   *         }\r\n   *\r\n   * @class Action\r\n   * @extends BaseNode\r\n   **/\r\n  var Action = b3.Class(b3.BaseNode);\r\n\r\n  var p = Action.prototype;\r\n\r\n  /**\r\n   * Node category. Default to `b3.ACTION`.\r\n   *\r\n   * @property category\r\n   * @type {String}\r\n   * @readonly\r\n   **/\r\n  p.category = b3.ACTION;\r\n\r\n  p.__BaseNode_initialize = p.initialize;\r\n  /**\r\n   * Initialization method.\r\n   *\r\n   * @method initialize\r\n   * @constructor\r\n   **/\r\n  p.initialize = function() {\r\n    this.__BaseNode_initialize();\r\n  }\r\n\r\n  b3.Action = Action;\r\n\r\n})();\r\n/**\r\n * Composite\r\n *\r\n * Copyright (c) 2014 Renato de Pontes Pereira.\r\n *\r\n * Permission is hereby granted, free of charge, to any person obtaining a copy\r\n * of this software and associated documentation files (the \"Software\"), to \r\n * deal in the Software without restriction, including without limitation the \r\n * rights to use, copy, modify, merge, publish, distribute, sublicense, and/or\r\n * sell copies of the Software, and to permit persons to whom the Software is \r\n * furnished to do so, subject to the following conditions:\r\n *\r\n * The above copyright notice and this permission notice shall be included in\r\n * all copies or substantial portions of the Software.\r\n *\r\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, \r\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER \r\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING \r\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS\r\n * IN THE SOFTWARE.\r\n **/\r\n\r\n/**\r\n * @module Behavior3JS\r\n **/\r\n\r\n// namespace:\r\nthis.b3 = this.b3 || {};\r\n\r\n(function() {\r\n  \"use strict\";\r\n\r\n  /**\r\n   * Composite is the base class for all composite nodes. Thus, if you want to \r\n   * create new custom composite nodes, you need to inherit from this class. \r\n   * \r\n   * When creating composite nodes, you will need to propagate the tick signal to\r\n   * the children nodes manually. To do that, override the `tick` method and call \r\n   * the `_execute` method on all nodes. For instance, take a look at how the \r\n   * Sequence node inherit this class and how it call its children:\r\n   *\r\n   *\r\n   *     // Inherit from Composite, using the util function Class.\r\n   *     var Sequence = b3.Class(b3.Composite);\r\n   *     var p = Sequence.prototype;\r\n   *\r\n   *         // Remember to set the name of the node. \r\n   *         p.name = 'Sequence';\r\n   *         \r\n   *         // Override the tick function\r\n   *         p.tick = function(tick) {\r\n   *\r\n   *             // Iterates over the children\r\n   *             for (var i=0; i<this.children.length; i++) {\r\n   *\r\n   *                 // Propagate the tick\r\n   *                 var status = this.children[i]._execute(tick);\r\n   * \r\n   *                 if (status !== b3.SUCCESS) {\r\n   *                     return status;\r\n   *                 }\r\n   *             }\r\n   *\r\n   *             return b3.SUCCESS;\r\n   *         }\r\n   *\r\n   * @class Composite\r\n   * @extends BaseNode\r\n   **/\r\n  var Composite = b3.Class(b3.BaseNode);\r\n\r\n  var p = Composite.prototype;\r\n\r\n  /**\r\n   * Node category. Default to `b3.COMPOSITE`.\r\n   *\r\n   * @property category\r\n   * @type {String}\r\n   * @readonly\r\n   **/\r\n  p.category = b3.COMPOSITE;\r\n\r\n  p.__BaseNode_initialize = p.initialize;\r\n  /**\r\n   * Initialization method.\r\n   *\r\n   * @method initialize\r\n   * @constructor\r\n   **/\r\n  p.initialize = function(settings) {\r\n    settings = settings || {};\r\n\r\n    this.__BaseNode_initialize();\r\n\r\n    this.children = (settings.children || []).slice(0);\r\n  };\r\n\r\n  b3.Composite = Composite;\r\n\r\n})();\r\n/**\r\n * Decorator\r\n *\r\n * Copyright (c) 2014 Renato de Pontes Pereira.\r\n *\r\n * Permission is hereby granted, free of charge, to any person obtaining a copy\r\n * of this software and associated documentation files (the \"Software\"), to \r\n * deal in the Software without restriction, including without limitation the \r\n * rights to use, copy, modify, merge, publish, distribute, sublicense, and/or\r\n * sell copies of the Software, and to permit persons to whom the Software is \r\n * furnished to do so, subject to the following conditions:\r\n *\r\n * The above copyright notice and this permission notice shall be included in\r\n * all copies or substantial portions of the Software.\r\n *\r\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, \r\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER \r\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING \r\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS\r\n * IN THE SOFTWARE.\r\n **/\r\n\r\n/**\r\n * @module Behavior3JS\r\n **/\r\n\r\n// namespace:\r\nthis.b3 = this.b3 || {};\r\n\r\n(function() {\r\n  \"use strict\";\r\n\r\n  /**\r\n   * Decorator is the base class for all decorator nodes. Thus, if you want to \r\n   * create new custom decorator nodes, you need to inherit from this class. \r\n   * \r\n   * When creating decorator nodes, you will need to propagate the tick signal to\r\n   * the child node manually, just like the composite nodes. To do that, override\r\n   * the `tick` method and call the `_execute` method on the child node. For \r\n   * instance, take a look at how the Inverter node inherit this class and how it\r\n   * call its children:\r\n   *\r\n   *\r\n   *     // Inherit from Decorator, using the util function Class.\r\n   *     var Inverter = b3.Class(b3.Decorator);\r\n   *     var p = Inverter.prototype;\r\n   *     \r\n   *         // Remember to set the name of the node. \r\n   *         p.name = 'Inverter';\r\n   *     \r\n   *         // Override the tick function\r\n   *         p.tick = function(tick) {\r\n   *             if (!this.child) {\r\n   *                 return b3.ERROR;\r\n   *             }\r\n   *     \r\n   *             // Propagate the tick\r\n   *             var status = this.child._execute(tick);\r\n   *     \r\n   *             if (status == b3.SUCCESS)\r\n   *                 status = b3.FAILURE;\r\n   *             else if (status == b3.FAILURE)\r\n   *                 status = b3.SUCCESS;\r\n   *     \r\n   *             return status;\r\n   *         };\r\n   *\r\n   * @class Decorator\r\n   * @extends BaseNode\r\n   **/\r\n  var Decorator = b3.Class(b3.BaseNode);\r\n\r\n  var p = Decorator.prototype;\r\n\r\n  /**\r\n   * Node category. Default to b3.DECORATOR.\r\n   *\r\n   * @property category\r\n   * @type {String}\r\n   * @readonly\r\n   **/\r\n  p.category = b3.DECORATOR;\r\n\r\n  p.__BaseNode_initialize = p.initialize;\r\n  /**\r\n   * Initialization method.\r\n   *\r\n   * @method initialize\r\n   * @constructor\r\n   **/\r\n  p.initialize = function(settings) {\r\n    settings = settings || {};\r\n\r\n    this.__BaseNode_initialize();\r\n\r\n    this.child = settings.child || null;\r\n  };\r\n\r\n  b3.Decorator = Decorator;\r\n\r\n})();\r\n/**\r\n * Condition\r\n *\r\n * Copyright (c) 2014 Renato de Pontes Pereira.\r\n *\r\n * Permission is hereby granted, free of charge, to any person obtaining a copy\r\n * of this software and associated documentation files (the \"Software\"), to \r\n * deal in the Software without restriction, including without limitation the \r\n * rights to use, copy, modify, merge, publish, distribute, sublicense, and/or\r\n * sell copies of the Software, and to permit persons to whom the Software is \r\n * furnished to do so, subject to the following conditions:\r\n *\r\n * The above copyright notice and this permission notice shall be included in\r\n * all copies or substantial portions of the Software.\r\n *\r\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, \r\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER \r\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING \r\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS\r\n * IN THE SOFTWARE.\r\n **/\r\n\r\n/**\r\n * @module Behavior3JS\r\n **/\r\n\r\n// namespace:\r\nthis.b3 = this.b3 || {};\r\n\r\n(function() {\r\n  \"use strict\";\r\n\r\n  /**\r\n   * Condition is the base class for all condition nodes. Thus, if you want to \r\n   * create new custom condition nodes, you need to inherit from this class. \r\n   *\r\n   * @class Condition\r\n   * @extends BaseNode\r\n   **/\r\n  var Condition = b3.Class(b3.BaseNode);\r\n\r\n  var p = Condition.prototype;\r\n\r\n  /**\r\n   * Node category. Default to `b3.CONDITION`.\r\n   *\r\n   * @property category\r\n   * @type {String}\r\n   * @readonly\r\n   **/\r\n  p.category = b3.CONDITION;\r\n\r\n  p.__BaseNode_initialize = p.initialize;\r\n  /**\r\n   * Initialization method.\r\n   *\r\n   * @method initialize\r\n   * @constructor\r\n   **/\r\n  p.initialize = function() {\r\n    this.__BaseNode_initialize();\r\n  }\r\n\r\n  b3.Condition = Condition;\r\n\r\n})();\r\n/**\r\n * Sequence\r\n *\r\n * Copyright (c) 2014 Renato de Pontes Pereira.\r\n *\r\n * Permission is hereby granted, free of charge, to any person obtaining a copy\r\n * of this software and associated documentation files (the \"Software\"), to \r\n * deal in the Software without restriction, including without limitation the \r\n * rights to use, copy, modify, merge, publish, distribute, sublicense, and/or\r\n * sell copies of the Software, and to permit persons to whom the Software is \r\n * furnished to do so, subject to the following conditions:\r\n *\r\n * The above copyright notice and this permission notice shall be included in\r\n * all copies or substantial portions of the Software.\r\n *\r\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, \r\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER \r\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING \r\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS\r\n * IN THE SOFTWARE.\r\n **/\r\n\r\n/**\r\n * @module Behavior3JS\r\n **/\r\n\r\n// namespace:\r\nthis.b3 = this.b3 || {};\r\n\r\n(function() {\r\n  \"use strict\";\r\n\r\n  /**\r\n   * The Sequence node ticks its children sequentially until one of them returns \r\n   * `FAILURE`, `RUNNING` or `ERROR`. If all children return the success state, \r\n   * the sequence also returns `SUCCESS`.\r\n   *\r\n   * @class Sequence\r\n   * @extends Composite\r\n   **/\r\n  var Sequence = b3.Class(b3.Composite);\r\n\r\n  var p = Sequence.prototype;\r\n\r\n  /**\r\n   * Node name. Default to `Sequence`.\r\n   *\r\n   * @property name\r\n   * @type {String}\r\n   * @readonly\r\n   **/\r\n  p.name = 'Sequence';\r\n\r\n  /**\r\n   * Tick method.\r\n   *\r\n   * @method tick\r\n   * @param {b3.Tick} tick A tick instance.\r\n   * @returns {Constant} A state constant.\r\n   **/\r\n  p.tick = function(tick) {\r\n    for (var i = 0; i < this.children.length; i++) {\r\n      var status = this.children[i]._execute(tick);\r\n\r\n      if (status !== b3.SUCCESS) {\r\n        return status;\r\n      }\r\n    }\r\n\r\n    return b3.SUCCESS;\r\n  }\r\n\r\n  b3.Sequence = Sequence;\r\n\r\n})();\r\n/**\r\n * Priority\r\n *\r\n * Copyright (c) 2014 Renato de Pontes Pereira.\r\n *\r\n * Permission is hereby granted, free of charge, to any person obtaining a copy\r\n * of this software and associated documentation files (the \"Software\"), to \r\n * deal in the Software without restriction, including without limitation the \r\n * rights to use, copy, modify, merge, publish, distribute, sublicense, and/or\r\n * sell copies of the Software, and to permit persons to whom the Software is \r\n * furnished to do so, subject to the following conditions:\r\n *\r\n * The above copyright notice and this permission notice shall be included in\r\n * all copies or substantial portions of the Software.\r\n *\r\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, \r\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER \r\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING \r\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS\r\n * IN THE SOFTWARE.\r\n **/\r\n\r\n/**\r\n * @module Behavior3JS\r\n **/\r\n\r\n// namespace:\r\nthis.b3 = this.b3 || {};\r\n\r\n(function() {\r\n  \"use strict\";\r\n\r\n  /**\r\n   * Priority ticks its children sequentially until one of them returns \r\n   * `SUCCESS`, `RUNNING` or `ERROR`. If all children return the failure state, \r\n   * the priority also returns `FAILURE`.\r\n   *\r\n   * @class Priority\r\n   * @extends Composite\r\n   **/\r\n  var Priority = b3.Class(b3.Composite);\r\n\r\n  var p = Priority.prototype\r\n\r\n  /**\r\n   * Node name. Default to `Priority`.\r\n   *\r\n   * @property name\r\n   * @type String\r\n   * @readonly\r\n   **/\r\n  p.name = 'Priority';\r\n\r\n  /**\r\n   * Tick method.\r\n   *\r\n   * @method tick\r\n   * @param {Tick} tick A tick instance.\r\n   * @returns {Constant} A state constant.\r\n   **/\r\n  p.tick = function(tick) {\r\n    for (var i = 0; i < this.children.length; i++) {\r\n      var status = this.children[i]._execute(tick);\r\n\r\n      if (status !== b3.FAILURE) {\r\n        return status;\r\n      }\r\n    }\r\n\r\n    return b3.FAILURE;\r\n  }\r\n\r\n  b3.Priority = Priority;\r\n\r\n})();\r\n/**\r\n * MemSequence\r\n *\r\n * Copyright (c) 2014 Renato de Pontes Pereira.\r\n *\r\n * Permission is hereby granted, free of charge, to any person obtaining a copy\r\n * of this software and associated documentation files (the \"Software\"), to \r\n * deal in the Software without restriction, including without limitation the \r\n * rights to use, copy, modify, merge, publish, distribute, sublicense, and/or\r\n * sell copies of the Software, and to permit persons to whom the Software is \r\n * furnished to do so, subject to the following conditions:\r\n *\r\n * The above copyright notice and this permission notice shall be included in\r\n * all copies or substantial portions of the Software.\r\n *\r\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, \r\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER \r\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING \r\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS\r\n * IN THE SOFTWARE.\r\n **/\r\n\r\n/**\r\n * @module Behavior3JS\r\n **/\r\n\r\n// namespace:\r\nthis.b3 = this.b3 || {};\r\n\r\n(function() {\r\n  \"use strict\";\r\n\r\n  /**\r\n   * MemSequence is similar to Sequence node, but when a child returns a \r\n   * `RUNNING` state, its index is recorded and in the next tick the MemPriority \r\n   * call the child recorded directly, without calling previous children again.\r\n   *\r\n   * @class MemPriority\r\n   * @extends Composite\r\n   **/\r\n  var MemSequence = b3.Class(b3.Composite);\r\n\r\n  var p = MemSequence.prototype\r\n\r\n  /**\r\n   * Node name. Default to `MemSequence`.\r\n   *\r\n   * @property name\r\n   * @type {String}\r\n   * @readonly\r\n   **/\r\n  p.name = 'MemSequence';\r\n\r\n  /**\r\n   * Open method.\r\n   *\r\n   * @method open\r\n   * @param {b3.Tick} tick A tick instance.\r\n   **/\r\n  p.open = function(tick) {\r\n    tick.blackboard.set('runningChild', 0, tick.tree.id, this.id);\r\n  }\r\n\r\n  /**\r\n   * Tick method.\r\n   *\r\n   * @method tick\r\n   * @param {b3.Tick} tick A tick instance.\r\n   * @returns {Constant} A state constant.\r\n   **/\r\n  p.tick = function(tick) {\r\n    var child = tick.blackboard.get('runningChild', tick.tree.id, this.id);\r\n    for (var i = child; i < this.children.length; i++) {\r\n      var status = this.children[i]._execute(tick);\r\n\r\n      if (status !== b3.SUCCESS) {\r\n        if (status === b3.RUNNING) {\r\n          tick.blackboard.set('runningChild', i, tick.tree.id, this.id);\r\n        }\r\n        return status;\r\n      }\r\n    }\r\n\r\n    return b3.SUCCESS;\r\n  }\r\n\r\n  b3.MemSequence = MemSequence;\r\n\r\n})();\r\n/**\r\n * MemPriority\r\n *\r\n * Copyright (c) 2014 Renato de Pontes Pereira.\r\n *\r\n * Permission is hereby granted, free of charge, to any person obtaining a copy\r\n * of this software and associated documentation files (the \"Software\"), to \r\n * deal in the Software without restriction, including without limitation the \r\n * rights to use, copy, modify, merge, publish, distribute, sublicense, and/or\r\n * sell copies of the Software, and to permit persons to whom the Software is \r\n * furnished to do so, subject to the following conditions:\r\n *\r\n * The above copyright notice and this permission notice shall be included in\r\n * all copies or substantial portions of the Software.\r\n *\r\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, \r\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER \r\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING \r\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS\r\n * IN THE SOFTWARE.\r\n **/\r\n\r\n/**\r\n * @module Behavior3JS\r\n **/\r\n\r\n// namespace:\r\nthis.b3 = this.b3 || {};\r\n\r\n(function() {\r\n  \"use strict\";\r\n\r\n  /**\r\n   * MemPriority is similar to Priority node, but when a child returns a \r\n   * `RUNNING` state, its index is recorded and in the next tick the, MemPriority \r\n   * calls the child recorded directly, without calling previous children again.\r\n   *\r\n   * @class MemPriority\r\n   * @extends Composite\r\n   **/\r\n  var MemPriority = b3.Class(b3.Composite);\r\n\r\n  var p = MemPriority.prototype;\r\n\r\n  /**\r\n   * Node name. Default to `MemPriority`.\r\n   *\r\n   * @property name\r\n   * @type {String}\r\n   * @readonly\r\n   **/\r\n  p.name = 'MemPriority';\r\n\r\n  /**\r\n   * Open method.\r\n   *\r\n   * @method open\r\n   * @param {b3.Tick} tick A tick instance.\r\n   **/\r\n  p.open = function(tick) {\r\n    tick.blackboard.set('runningChild', 0, tick.tree.id, this.id);\r\n  }\r\n\r\n  /**\r\n   * Tick method.\r\n   *\r\n   * @method tick\r\n   * @param {b3.Tick} tick A tick instance.\r\n   * @returns {Constant} A state constant.\r\n   **/\r\n  p.tick = function(tick) {\r\n    var child = tick.blackboard.get('runningChild', tick.tree.id, this.id);\r\n    for (var i = child; i < this.children.length; i++) {\r\n      var status = this.children[i]._execute(tick);\r\n\r\n      if (status !== b3.FAILURE) {\r\n        if (status === b3.RUNNING) {\r\n          tick.blackboard.set('runningChild', i, tick.tree.id, this.id);\r\n        }\r\n        return status;\r\n      }\r\n    }\r\n\r\n    return b3.FAILURE;\r\n  }\r\n\r\n  b3.MemPriority = MemPriority;\r\n\r\n})();\r\n/**\r\n * Inverter\r\n *\r\n * Copyright (c) 2014 Renato de Pontes Pereira.\r\n *\r\n * Permission is hereby granted, free of charge, to any person obtaining a copy\r\n * of this software and associated documentation files (the \"Software\"), to \r\n * deal in the Software without restriction, including without limitation the \r\n * rights to use, copy, modify, merge, publish, distribute, sublicense, and/or\r\n * sell copies of the Software, and to permit persons to whom the Software is \r\n * furnished to do so, subject to the following conditions:\r\n *\r\n * The above copyright notice and this permission notice shall be included in\r\n * all copies or substantial portions of the Software.\r\n *\r\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, \r\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER \r\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING \r\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS\r\n * IN THE SOFTWARE.\r\n **/\r\n\r\n/**\r\n * @module Behavior3JS\r\n **/\r\n\r\n// namespace:\r\nthis.b3 = this.b3 || {};\r\n\r\n(function() {\r\n  \"use strict\";\r\n\r\n  /**\r\n   * The Inverter decorator inverts the result of the child, returning `SUCCESS`\r\n   * for `FAILURE` and `FAILURE` for `SUCCESS`.\r\n   *\r\n   * @class Inverter\r\n   * @extends Decorator\r\n   **/\r\n  var Inverter = b3.Class(b3.Decorator);\r\n\r\n  var p = Inverter.prototype;\r\n\r\n  /**\r\n   * Node name. Default to `Inverter`.\r\n   *\r\n   * @property name\r\n   * @type {String}\r\n   * @readonly\r\n   **/\r\n  p.name = 'Inverter';\r\n\r\n  /**\r\n   * Tick method.\r\n   *\r\n   * @method tick\r\n   * @param {Tick} tick A tick instance.\r\n   * @returns {Constant} A state constant.\r\n   **/\r\n  p.tick = function(tick) {\r\n    if (!this.child) {\r\n      return b3.ERROR;\r\n    }\r\n\r\n    var status = this.child._execute(tick);\r\n\r\n    if (status == b3.SUCCESS)\r\n      status = b3.FAILURE;\r\n    else if (status == b3.FAILURE)\r\n      status = b3.SUCCESS;\r\n\r\n    return status;\r\n  };\r\n\r\n  b3.Inverter = Inverter;\r\n\r\n})();\r\n/**\r\n * Limiter\r\n *\r\n * Copyright (c) 2014 Renato de Pontes Pereira.\r\n *\r\n * Permission is hereby granted, free of charge, to any person obtaining a copy\r\n * of this software and associated documentation files (the \"Software\"), to \r\n * deal in the Software without restriction, including without limitation the \r\n * rights to use, copy, modify, merge, publish, distribute, sublicense, and/or\r\n * sell copies of the Software, and to permit persons to whom the Software is \r\n * furnished to do so, subject to the following conditions:\r\n *\r\n * The above copyright notice and this permission notice shall be included in\r\n * all copies or substantial portions of the Software.\r\n *\r\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, \r\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER \r\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING \r\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS\r\n * IN THE SOFTWARE.\r\n **/\r\n\r\n/**\r\n * @module Behavior3JS\r\n **/\r\n\r\n// namespace:\r\nthis.b3 = this.b3 || {};\r\n\r\n(function() {\r\n  \"use strict\";\r\n\r\n  /**\r\n   * This decorator limit the number of times its child can be called. After a\r\n   * certain number of times, the Limiter decorator returns `FAILURE` without \r\n   * executing the child.\r\n   *\r\n   * @class Limiter\r\n   * @extends Decorator\r\n   **/\r\n  var Limiter = b3.Class(b3.Decorator);\r\n\r\n  var p = Limiter.prototype;\r\n\r\n  /**\r\n   * Node name. Default to `Limiter`.\r\n   *\r\n   * @property name\r\n   * @type {String}\r\n   * @readonly\r\n   **/\r\n  p.name = 'Limiter';\r\n\r\n  /**\r\n   * Node parameters.\r\n   *\r\n   * @property parameters\r\n   * @type {String}\r\n   * @readonly\r\n   **/\r\n  p.parameters = {\r\n    'maxLoop': null\r\n  };\r\n\r\n  p.__Decorator_initialize = p.initialize;\r\n  /**\r\n   * Initialization method. \r\n   *\r\n   * Settings parameters:\r\n   *\r\n   * - **maxLoop** (*Integer*) Maximum number of repetitions.\r\n   * - **child** (*BaseNode*) The child node.\r\n   *\r\n   * @method initialize\r\n   * @param {Object} settings Object with parameters.\r\n   * @constructor\r\n   **/\r\n  p.initialize = function(settings) {\r\n    settings = settings || {};\r\n\r\n    this.__Decorator_initialize(settings);\r\n\r\n    if (!settings.maxLoop) {\r\n      throw \"maxLoop parameter in Limiter decorator is an obligatory \" +\r\n      \"parameter\";\r\n    }\r\n\r\n    this.maxLoop = settings.maxLoop;\r\n  }\r\n\r\n  /**\r\n   * Open method.\r\n   *\r\n   * @method open\r\n   * @param {Tick} tick A tick instance.\r\n   **/\r\n  p.open = function(tick) {\r\n    tick.blackboard.set('i', 0, tick.tree.id, this.id);\r\n  }\r\n\r\n  /**\r\n   * Tick method.\r\n   *\r\n   * @method tick\r\n   * @param {Tick} tick A tick instance.\r\n   * @returns {Constant} A state constant.\r\n   **/\r\n  p.tick = function(tick) {\r\n    if (!this.child) {\r\n      return b3.ERROR;\r\n    }\r\n\r\n    var i = tick.blackboard.get('i', tick.tree.id, this.id);\r\n\r\n    if (i < this.maxLoop) {\r\n      var status = this.child._execute(tick);\r\n\r\n      if (status == b3.SUCCESS || status == b3.FAILURE)\r\n        tick.blackboard.set('i', i + 1, tick.tree.id, this.id);\r\n\r\n      return status;\r\n    }\r\n\r\n    return b3.FAILURE;\r\n  }\r\n\r\n  b3.Limiter = Limiter;\r\n\r\n})();\r\n/**\r\n * MaxTime\r\n *\r\n * Copyright (c) 2014 Renato de Pontes Pereira.\r\n *\r\n * Permission is hereby granted, free of charge, to any person obtaining a copy\r\n * of this software and associated documentation files (the \"Software\"), to \r\n * deal in the Software without restriction, including without limitation the \r\n * rights to use, copy, modify, merge, publish, distribute, sublicense, and/or\r\n * sell copies of the Software, and to permit persons to whom the Software is \r\n * furnished to do so, subject to the following conditions:\r\n *\r\n * The above copyright notice and this permission notice shall be included in\r\n * all copies or substantial portions of the Software.\r\n *\r\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, \r\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER \r\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING \r\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS\r\n * IN THE SOFTWARE.\r\n **/\r\n\r\n/**\r\n * @module Behavior3JS\r\n **/\r\n\r\n// namespace:\r\nthis.b3 = this.b3 || {};\r\n\r\n(function() {\r\n  \"use strict\";\r\n\r\n  /**\r\n   * The MaxTime decorator limits the maximum time the node child can execute. \r\n   * Notice that it does not interrupt the execution itself (i.e., the child must\r\n   * be non-preemptive), it only interrupts the node after a `RUNNING` status.\r\n   *\r\n   * @class MaxTime\r\n   * @extends Decorator\r\n   **/\r\n  var MaxTime = b3.Class(b3.Decorator);\r\n\r\n  var p = MaxTime.prototype;\r\n\r\n  /**\r\n   * Node name. Default to `MaxTime`.\r\n   *\r\n   * @property name\r\n   * @type {String}\r\n   * @readonly\r\n   **/\r\n  p.name = 'MaxTime';\r\n\r\n  /**\r\n   * Node title. Default to `Max Time`.\r\n   *\r\n   * @property title\r\n   * @type {String}\r\n   * @readonly\r\n   **/\r\n  p.title = 'Max Time';\r\n\r\n  /**\r\n   * Node parameters.\r\n   *\r\n   * @property parameters\r\n   * @type {String}\r\n   * @readonly\r\n   **/\r\n  p.parameters = {\r\n    'maxTime': null\r\n  };\r\n\r\n  p.__Decorator_initialize = p.initialize;\r\n  /**\r\n   * Initialization method.\r\n   *\r\n   * Settings parameters:\r\n   *\r\n   * - **maxTime** (*Integer*) Maximum time a child can execute.\r\n   * - **child** (*BaseNode*) The child node.\r\n   *\r\n   * @method initialize\r\n   * @param {Object} settings Object with parameters.\r\n   * @constructor\r\n   **/\r\n  p.initialize = function(settings) {\r\n    settings = settings || {};\r\n\r\n    this.__Decorator_initialize(settings);\r\n\r\n    if (!settings.maxTime) {\r\n      throw \"maxTime parameter in MaxTime decorator is an obligatory \" +\r\n      \"parameter\";\r\n    }\r\n\r\n    this.maxTime = settings.maxTime;\r\n  };\r\n\r\n  /**\r\n   * Open method.\r\n   *\r\n   * @method open\r\n   * @param {Tick} tick A tick instance.\r\n   **/\r\n  p.open = function(tick) {\r\n    var startTime = (new Date()).getTime();\r\n    tick.blackboard.set('startTime', startTime, tick.tree.id, this.id);\r\n  };\r\n\r\n  /**\r\n   * Tick method.\r\n   *\r\n   * @method tick\r\n   * @param {Tick} tick A tick instance.\r\n   * @returns {Constant} A state constant.\r\n   **/\r\n  p.tick = function(tick) {\r\n    if (!this.child) {\r\n      return b3.ERROR;\r\n    }\r\n\r\n    var currTime = (new Date()).getTime();\r\n    var startTime = tick.blackboard.get('startTime', tick.tree.id, this.id);\r\n\r\n    var status = this.child._execute(tick);\r\n    if (currTime - startTime > this.maxTime) {\r\n      return b3.FAILURE;\r\n    }\r\n\r\n    return status;\r\n  };\r\n\r\n  b3.MaxTime = MaxTime;\r\n\r\n})();\r\n/**\r\n * Repeater\r\n *\r\n * Copyright (c) 2014 Renato de Pontes Pereira.\r\n *\r\n * Permission is hereby granted, free of charge, to any person obtaining a copy\r\n * of this software and associated documentation files (the \"Software\"), to \r\n * deal in the Software without restriction, including without limitation the \r\n * rights to use, copy, modify, merge, publish, distribute, sublicense, and/or\r\n * sell copies of the Software, and to permit persons to whom the Software is \r\n * furnished to do so, subject to the following conditions:\r\n *\r\n * The above copyright notice and this permission notice shall be included in\r\n * all copies or substantial portions of the Software.\r\n *\r\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, \r\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER \r\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING \r\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS\r\n * IN THE SOFTWARE.\r\n **/\r\n\r\n/**\r\n * @module Behavior3JS\r\n **/\r\n\r\n// namespace:\r\nthis.b3 = this.b3 || {};\r\n\r\n(function() {\r\n  \"use strict\";\r\n\r\n  /**\r\n   * Repeater is a decorator that repeats the tick signal until the child node \r\n   * return `RUNNING` or `ERROR`. Optionally, a maximum number of repetitions \r\n   * can be defined.\r\n   *\r\n   * @class Repeater\r\n   * @extends Decorator\r\n   **/\r\n  var Repeater = b3.Class(b3.Decorator);\r\n\r\n  var p = Repeater.prototype;\r\n\r\n  /**\r\n   * Node name. Default to `Repeater`.\r\n   *\r\n   * @property name\r\n   * @type {String}\r\n   * @readonly\r\n   **/\r\n  p.name = 'Repeater';\r\n\r\n  /**\r\n   * Node parameters.\r\n   *\r\n   * @property parameters\r\n   * @type {String}\r\n   * @readonly\r\n   **/\r\n  p.parameters = {\r\n    'maxLoop': -1\r\n  };\r\n\r\n  p.__Decorator_initialize = p.initialize;\r\n  /**\r\n   * Initialization method.\r\n   *\r\n   * Settings parameters:\r\n   *\r\n   * - **maxLoop** (*Integer*) Maximum number of repetitions. Default to -1 \r\n   *                           (infinite).\r\n   * - **child** (*BaseNode*) The child node.\r\n   * \r\n   * @method initialize\r\n   * @param {Object} settings Object with parameters.\r\n   * @constructor\r\n   **/\r\n  p.initialize = function(settings) {\r\n    settings = settings || {};\r\n\r\n    this.__Decorator_initialize(settings);\r\n\r\n    this.maxLoop = settings.maxLoop || -1;\r\n  };\r\n\r\n  /**\r\n   * Open method.\r\n   *\r\n   * @method open\r\n   * @param {Tick} tick A tick instance.\r\n   **/\r\n  p.open = function(tick) {\r\n    tick.blackboard.set('i', 0, tick.tree.id, this.id);\r\n  };\r\n\r\n  /**\r\n   * Tick method.\r\n   *\r\n   * @method tick\r\n   * @param {Tick} tick A tick instance.\r\n   **/\r\n  p.tick = function(tick) {\r\n    if (!this.child) {\r\n      return b3.ERROR;\r\n    }\r\n\r\n    var i = tick.blackboard.get('i', tick.tree.id, this.id);\r\n    var status = b3.SUCCESS;\r\n\r\n    while (this.maxLoop < 0 || i < this.maxLoop) {\r\n      status = this.child._execute(tick);\r\n\r\n      if (status == b3.SUCCESS || status == b3.FAILURE)\r\n        i++;\r\n      else\r\n        break;\r\n    }\r\n\r\n    i = tick.blackboard.set('i', i, tick.tree.id, this.id);\r\n    return status;\r\n  };\r\n\r\n  b3.Repeater = Repeater;\r\n\r\n})();\r\n/**\r\n * RepeatUntilFailure\r\n *\r\n * Copyright (c) 2014 Renato de Pontes Pereira.\r\n *\r\n * Permission is hereby granted, free of charge, to any person obtaining a copy\r\n * of this software and associated documentation files (the \"Software\"), to \r\n * deal in the Software without restriction, including without limitation the \r\n * rights to use, copy, modify, merge, publish, distribute, sublicense, and/or\r\n * sell copies of the Software, and to permit persons to whom the Software is \r\n * furnished to do so, subject to the following conditions:\r\n *\r\n * The above copyright notice and this permission notice shall be included in\r\n * all copies or substantial portions of the Software.\r\n *\r\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, \r\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER \r\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING \r\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS\r\n * IN THE SOFTWARE.\r\n **/\r\n\r\n/**\r\n * @module Behavior3JS\r\n **/\r\n\r\n// namespace:\r\nthis.b3 = this.b3 || {};\r\n\r\n(function() {\r\n  \"use strict\";\r\n\r\n  /**\r\n   * RepeatUntilFailure is a decorator that repeats the tick signal until the \r\n   * node child returns `FAILURE`, `RUNNING` or `ERROR`. Optionally, a maximum \r\n   * number of repetitions can be defined.\r\n   *\r\n   * @class RepeatUntilFailure\r\n   * @extends Decorator\r\n   **/\r\n  var RepeatUntilFailure = b3.Class(b3.Decorator);\r\n\r\n  var p = RepeatUntilFailure.prototype;\r\n\r\n  /**\r\n   * Node name. Default to `RepeatUntilFailure`.\r\n   *\r\n   * @property name\r\n   * @type {String}\r\n   * @readonly\r\n   **/\r\n  p.name = 'RepeatUntilFailure';\r\n\r\n  /**\r\n   * Node title. Default to `Repeat Until Failure`.\r\n   *\r\n   * @property title\r\n   * @type {String}\r\n   * @readonly\r\n   **/\r\n  p.title = 'Repeat Until Failure';\r\n\r\n  /**\r\n   * Node parameters.\r\n   *\r\n   * @property parameters\r\n   * @type {String}\r\n   * @readonly\r\n   **/\r\n  p.parameters = {\r\n    'maxLoop': -1\r\n  };\r\n\r\n  p.__Decorator_initialize = p.initialize;\r\n  /**\r\n   * Initialization method.\r\n   *\r\n   * Settings parameters:\r\n   *\r\n   * - **maxLoop** (*Integer*) Maximum number of repetitions. Default to -1 \r\n   *                           (infinite).\r\n   * - **child** (*BaseNode*) The child node.\r\n   *\r\n   * @method initialize\r\n   * @param {Object} settings Object with parameters.\r\n   * @constructor\r\n   **/\r\n  p.initialize = function(settings) {\r\n    settings = settings || {};\r\n\r\n    this.__Decorator_initialize(settings);\r\n\r\n    this.maxLoop = settings.maxLoop || -1;\r\n  }\r\n\r\n  /**\r\n   * Open method.\r\n   *\r\n   * @method open\r\n   * @param {Tick} tick A tick instance.\r\n   **/\r\n  p.open = function(tick) {\r\n    tick.blackboard.set('i', 0, tick.tree.id, this.id);\r\n  }\r\n\r\n  /**\r\n   * Tick method.\r\n   *\r\n   * @method tick\r\n   * @param {Tick} tick A tick instance.\r\n   * @returns {Constant} A state constant.\r\n   **/\r\n  p.tick = function(tick) {\r\n    if (!this.child) {\r\n      return b3.ERROR;\r\n    }\r\n\r\n    var i = tick.blackboard.get('i', tick.tree.id, this.id);\r\n\r\n    while (this.maxLoop < 0 || i < this.maxLoop) {\r\n      var status = this.child._execute(tick);\r\n\r\n      if (status == b3.SUCCESS)\r\n        i++;\r\n      else\r\n        break;\r\n    }\r\n\r\n    var i = tick.blackboard.set('i', i, tick.tree.id, this.id);\r\n    return status;\r\n  }\r\n\r\n  b3.RepeatUntilFailure = RepeatUntilFailure;\r\n\r\n})();\r\n/**\r\n * RepeatUntilSuccess\r\n *\r\n * Copyright (c) 2014 Renato de Pontes Pereira.\r\n *\r\n * Permission is hereby granted, free of charge, to any person obtaining a copy\r\n * of this software and associated documentation files (the \"Software\"), to \r\n * deal in the Software without restriction, including without limitation the \r\n * rights to use, copy, modify, merge, publish, distribute, sublicense, and/or\r\n * sell copies of the Software, and to permit persons to whom the Software is \r\n * furnished to do so, subject to the following conditions:\r\n *\r\n * The above copyright notice and this permission notice shall be included in\r\n * all copies or substantial portions of the Software.\r\n *\r\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, \r\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER \r\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING \r\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS\r\n * IN THE SOFTWARE.\r\n **/\r\n\r\n/**\r\n * @module Behavior3JS\r\n **/\r\n\r\n// namespace:\r\nthis.b3 = this.b3 || {};\r\n\r\n(function() {\r\n  \"use strict\";\r\n\r\n  /**\r\n   * RepeatUntilSuccess is a decorator that repeats the tick signal until the \r\n   * node child returns `SUCCESS`, `RUNNING` or `ERROR`. Optionally, a maximum \r\n   * number of repetitions can be defined.\r\n   *\r\n   * @class RepeatUntilSuccess\r\n   * @extends Decorator\r\n   **/\r\n  var RepeatUntilSuccess = b3.Class(b3.Decorator);\r\n\r\n  var p = RepeatUntilSuccess.prototype;\r\n\r\n  /**\r\n   * Node name. Default to `RepeatUntilSuccess`.\r\n   *\r\n   * @property name\r\n   * @type {String}\r\n   * @readonly\r\n   **/\r\n  p.name = 'RepeatUntilSuccess';\r\n\r\n  /**\r\n   * Node title. Default to `Repeat Until Success`.\r\n   *\r\n   * @property title\r\n   * @type {String}\r\n   * @readonly\r\n   **/\r\n  p.title = 'Repeat Until Success';\r\n\r\n  /**\r\n   * Node parameters.\r\n   *\r\n   * @property parameters\r\n   * @type {String}\r\n   * @readonly\r\n   **/\r\n  p.parameters = {\r\n    'maxLoop': -1\r\n  };\r\n\r\n  p.__Decorator_initialize = p.initialize;\r\n  /**\r\n   * Initialization method.\r\n   *\r\n   * Settings parameters:\r\n   *\r\n   * - **maxLoop** (*Integer*) Maximum number of repetitions. Default to -1 \r\n   *                           (infinite).\r\n   * - **child** (*BaseNode*) The child node.\r\n   *\r\n   * @method initialize\r\n   * @param {Object} settings Object with parameters.\r\n   * @constructor\r\n   **/\r\n  p.initialize = function(settings) {\r\n    settings = settings || {};\r\n\r\n    this.__Decorator_initialize(settings);\r\n\r\n    this.maxLoop = settings.maxLoop || -1;\r\n  }\r\n\r\n  /**\r\n   * Open method.\r\n   *\r\n   * @method open\r\n   * @param {Tick} tick A tick instance.\r\n   **/\r\n  p.open = function(tick) {\r\n    tick.blackboard.set('i', 0, tick.tree.id, this.id);\r\n  }\r\n\r\n  /**\r\n   * Tick method.\r\n   *\r\n   * @method tick\r\n   * @param {Tick} tick A tick instance.\r\n   * @returns {Constant} A state constant.\r\n   **/\r\n  p.tick = function(tick) {\r\n    if (!this.child) {\r\n      return b3.ERROR;\r\n    }\r\n\r\n    var i = tick.blackboard.get('i', tick.tree.id, this.id);\r\n\r\n    while (this.maxLoop < 0 || i < this.maxLoop) {\r\n      var status = this.child._execute(tick);\r\n\r\n      if (status == b3.FAILURE)\r\n        i++;\r\n      else\r\n        break;\r\n    }\r\n\r\n    var i = tick.blackboard.set('i', i, tick.tree.id, this.id);\r\n    return status;\r\n  }\r\n\r\n  b3.RepeatUntilSuccess = RepeatUntilSuccess;\r\n\r\n})();\r\n/**\r\n * Error\r\n *\r\n * Copyright (c) 2014 Renato de Pontes Pereira.\r\n *\r\n * Permission is hereby granted, free of charge, to any person obtaining a copy\r\n * of this software and associated documentation files (the \"Software\"), to \r\n * deal in the Software without restriction, including without limitation the \r\n * rights to use, copy, modify, merge, publish, distribute, sublicense, and/or\r\n * sell copies of the Software, and to permit persons to whom the Software is \r\n * furnished to do so, subject to the following conditions:\r\n *\r\n * The above copyright notice and this permission notice shall be included in\r\n * all copies or substantial portions of the Software.\r\n *\r\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, \r\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER \r\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING \r\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS\r\n * IN THE SOFTWARE.\r\n **/\r\n\r\n/**\r\n * @module Behavior3JS\r\n **/\r\n\r\n// namespace:\r\nthis.b3 = this.b3 || {};\r\n\r\n(function() {\r\n  \"use strict\";\r\n\r\n  /**\r\n   * This action node returns `ERROR` always.\r\n   *\r\n   * @class Error\r\n   * @extends Action\r\n   **/\r\n  var Error = b3.Class(b3.Action);\r\n\r\n  var p = Error.prototype;\r\n\r\n  /**\r\n   * Node name. Default to `Error`.\r\n   *\r\n   * @property name\r\n   * @type {String}\r\n   * @readonly\r\n   **/\r\n  p.name = 'Error';\r\n\r\n  /**\r\n   * Tick method.\r\n   *\r\n   * @method tick\r\n   * @param {b3.Tick} tick A tick instance.\r\n   * @returns {Constant} Always return `b3.ERROR`.\r\n   **/\r\n  p.tick = function(tick) {\r\n    return b3.ERROR;\r\n  }\r\n\r\n  b3.Error = Error;\r\n\r\n})();\r\n/**\r\n * Failer\r\n *\r\n * Copyright (c) 2014 Renato de Pontes Pereira.\r\n *\r\n * Permission is hereby granted, free of charge, to any person obtaining a copy\r\n * of this software and associated documentation files (the \"Software\"), to \r\n * deal in the Software without restriction, including without limitation the \r\n * rights to use, copy, modify, merge, publish, distribute, sublicense, and/or\r\n * sell copies of the Software, and to permit persons to whom the Software is \r\n * furnished to do so, subject to the following conditions:\r\n *\r\n * The above copyright notice and this permission notice shall be included in\r\n * all copies or substantial portions of the Software.\r\n *\r\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, \r\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER \r\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING \r\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS\r\n * IN THE SOFTWARE.\r\n **/\r\n\r\n/**\r\n * @module Behavior3JS\r\n **/\r\n\r\n// namespace:\r\nthis.b3 = this.b3 || {};\r\n\r\n(function() {\r\n  \"use strict\";\r\n\r\n  /**\r\n   * This action node returns `FAILURE` always.\r\n   *\r\n   * @class Failer\r\n   * @extends Action\r\n   **/\r\n  var Failer = b3.Class(b3.Action);\r\n\r\n  var p = Failer.prototype;\r\n\r\n  /**\r\n   * Node name. Default to `Failer`.\r\n   *\r\n   * @property name\r\n   * @type {String}\r\n   * @readonly\r\n   **/\r\n  p.name = 'Failer';\r\n\r\n  /**\r\n   * Tick method.\r\n   *\r\n   * @method tick\r\n   * @param {b3.Tick} tick A tick instance.\r\n   * @returns {Constant} Always return `b3.FAILURE`.\r\n   **/\r\n  p.tick = function(tick) {\r\n    return b3.FAILURE;\r\n  }\r\n\r\n  b3.Failer = Failer;\r\n\r\n})();\r\n/**\r\n * Runner\r\n *\r\n * Copyright (c) 2014 Renato de Pontes Pereira.\r\n *\r\n * Permission is hereby granted, free of charge, to any person obtaining a copy\r\n * of this software and associated documentation files (the \"Software\"), to \r\n * deal in the Software without restriction, including without limitation the \r\n * rights to use, copy, modify, merge, publish, distribute, sublicense, and/or\r\n * sell copies of the Software, and to permit persons to whom the Software is \r\n * furnished to do so, subject to the following conditions:\r\n *\r\n * The above copyright notice and this permission notice shall be included in\r\n * all copies or substantial portions of the Software.\r\n *\r\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, \r\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER \r\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING \r\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS\r\n * IN THE SOFTWARE.\r\n **/\r\n\r\n/**\r\n * @module Behavior3JS\r\n **/\r\n\r\n// namespace:\r\nthis.b3 = this.b3 || {};\r\n\r\n(function() {\r\n  \"use strict\";\r\n\r\n  /**\r\n   * This action node returns RUNNING always.\r\n   *\r\n   * @class Runner\r\n   * @extends Action\r\n   **/\r\n  var Runner = b3.Class(b3.Action);\r\n\r\n  var p = Runner.prototype;\r\n\r\n  /**\r\n   * Node name. Default to `Runner`.\r\n   *\r\n   * @property name\r\n   * @type {String}\r\n   * @readonly\r\n   **/\r\n  p.name = 'Runner';\r\n\r\n  /**\r\n   * Tick method.\r\n   *\r\n   * @method tick\r\n   * @param {b3.Tick} tick A tick instance.\r\n   * @returns {Constant} Always return `b3.RUNNING`.\r\n   **/\r\n  p.tick = function(tick) {\r\n    return b3.RUNNING;\r\n  }\r\n\r\n  b3.Runner = Runner;\r\n\r\n})();\r\n/**\r\n * Succeeder\r\n *\r\n * Copyright (c) 2014 Renato de Pontes Pereira.\r\n *\r\n * Permission is hereby granted, free of charge, to any person obtaining a copy\r\n * of this software and associated documentation files (the \"Software\"), to \r\n * deal in the Software without restriction, including without limitation the \r\n * rights to use, copy, modify, merge, publish, distribute, sublicense, and/or\r\n * sell copies of the Software, and to permit persons to whom the Software is \r\n * furnished to do so, subject to the following conditions:\r\n *\r\n * The above copyright notice and this permission notice shall be included in\r\n * all copies or substantial portions of the Software.\r\n *\r\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, \r\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER \r\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING \r\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS\r\n * IN THE SOFTWARE.\r\n **/\r\n\r\n/**\r\n * @module Behavior3JS\r\n **/\r\n\r\n// namespace:\r\nthis.b3 = this.b3 || {};\r\n\r\n(function() {\r\n  \"use strict\";\r\n\r\n  /**\r\n   * This action node returns `SUCCESS` always.\r\n   *\r\n   * @class Succeeder\r\n   * @extends Action\r\n   **/\r\n  var Succeeder = b3.Class(b3.Action);\r\n\r\n  var p = Succeeder.prototype;\r\n\r\n  /**\r\n   * Node name. Default to `Succeeder`.\r\n   *\r\n   * @property name\r\n   * @type String\r\n   * @readonly\r\n   **/\r\n  p.name = 'Succeeder';\r\n\r\n  /**\r\n   * Tick method.\r\n   *\r\n   * @method tick\r\n   * @param {b3.Tick} tick A tick instance.\r\n   * @returns {Constant} Always return `b3.SUCCESS`.\r\n   **/\r\n  p.tick = function(tick) {\r\n    return b3.SUCCESS;\r\n  }\r\n\r\n  b3.Succeeder = Succeeder;\r\n\r\n})();\r\n/**\r\n * Wait\r\n *\r\n * Copyright (c) 2014 Renato de Pontes Pereira.\r\n *\r\n * Permission is hereby granted, free of charge, to any person obtaining a copy\r\n * of this software and associated documentation files (the \"Software\"), to \r\n * deal in the Software without restriction, including without limitation the \r\n * rights to use, copy, modify, merge, publish, distribute, sublicense, and/or\r\n * sell copies of the Software, and to permit persons to whom the Software is \r\n * furnished to do so, subject to the following conditions:\r\n *\r\n * The above copyright notice and this permission notice shall be included in\r\n * all copies or substantial portions of the Software.\r\n *\r\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, \r\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER \r\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING \r\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS\r\n * IN THE SOFTWARE.\r\n **/\r\n\r\n/**\r\n * @module Behavior3JS\r\n **/\r\n\r\n// namespace:\r\nthis.b3 = this.b3 || {};\r\n\r\n(function() {\r\n  \"use strict\";\r\n\r\n  /**\r\n   * Wait a few seconds.\r\n   *\r\n   * @class Wait\r\n   * @extends Action\r\n   **/\r\n  var Wait = b3.Class(b3.Action);\r\n\r\n  var p = Wait.prototype;\r\n\r\n  /**\r\n   * Node name. Default to `Wait`.\r\n   *\r\n   * @property name\r\n   * @type {String}\r\n   * @readonly\r\n   **/\r\n  p.name = 'Wait';\r\n\r\n  /**\r\n   * Node parameters.\r\n   *\r\n   * @property parameters\r\n   * @type {String}\r\n   * @readonly\r\n   **/\r\n  p.parameters = {\r\n    'milliseconds': 0\r\n  };\r\n\r\n  p.__Action_initialize = p.initialize;\r\n  /**\r\n   * Initialization method.\r\n   *\r\n   * Settings parameters:\r\n   *\r\n   * - **milliseconds** (*Integer*) Maximum time, in milliseconds, a child\r\n   *                                can execute.\r\n   *\r\n   * @method initialize\r\n   * @param {Object} settings Object with parameters.\r\n   * @constructor\r\n   **/\r\n  p.initialize = function(settings) {\r\n    settings = settings || {};\r\n\r\n    this.__Action_initialize();\r\n\r\n    this.endTime = settings.milliseconds || 0;\r\n  }\r\n\r\n  /**\r\n   * Open method.\r\n   *\r\n   * @method open\r\n   * @param {Tick} tick A tick instance.\r\n   **/\r\n  p.open = function(tick) {\r\n    var startTime = (new Date()).getTime();\r\n    tick.blackboard.set('startTime', startTime, tick.tree.id, this.id);\r\n  }\r\n\r\n  /**\r\n   * Tick method.\r\n   *\r\n   * @method tick\r\n   * @param {Tick} tick A tick instance.\r\n   * @returns {Constant} A state constant.\r\n   **/\r\n  p.tick = function(tick) {\r\n    var currTime = (new Date()).getTime();\r\n    var startTime = tick.blackboard.get('startTime', tick.tree.id, this.id);\r\n\r\n    if (currTime - startTime > this.endTime) {\r\n      return b3.SUCCESS;\r\n    }\r\n\r\n    return b3.RUNNING;\r\n  }\r\n\r\n  b3.Wait = Wait;\r\n\r\n})();\r\n\r\n","module.exports = {\n\n  Entity         : require('./lib/Entity.js'),\n  EntityManager  : require('./lib/EntityManager.js'),\n  Messanger      : require('./lib/Messanger.js'),\n  ObjectPool     : require('./lib/ObjectPool.js'),\n  QuadTree       : require('./lib/QuadTree.js'),\n  Spatial        : require('./lib/Spatial.js'),\n  Vec2           : require('./lib/Vec2.js')\n\n};\n","module.exports = Jump;\r\n\r\nfunction Jump() {\r\n  this.canJump = true;\r\n}\r\n\r\n","module.exports = Identifier;\r\n\r\nfunction Identifier() {\r\n  this.type = null;\r\n}\r\n\r\n","module.exports = Position;\r\n\r\nfunction Position() {\r\n  this.x = 0;\r\n  this.y = 0;\r\n  this.z = 0;\r\n}\r\n\r\n","module.exports = OneTimeHit;\r\n\r\nfunction OneTimeHit() {\r\n  this.alreadyHit = [];\r\n}\r\n\r\n","module.exports = CameraPitch;\r\n\r\nfunction CameraPitch() {\r\n  this.controls = null;\r\n  this.offset = 0;\r\n}\r\n\r\n","module.exports = Steaming;\r\n\r\nfunction Steaming() {\r\n  this.particles = null;\r\n  this.system = null;\r\n  this.parent = null;\r\n  this.container = null;\r\n}\r\n\r\n","module.exports = Ai;\r\n\r\nfunction Ai() {\r\n  this.tree = null;\r\n  this.target = null;\r\n  this.blackboard = null;\r\n}\r\n\r\n","module.exports = CameraFollow;\r\n\r\nfunction CameraFollow() {\r\n  this.controls = null;\r\n  this.object = null;\r\n  this.offset = new THREE.Vector3();\r\n}\r\n\r\n","module.exports = Velocity;\r\n\r\nfunction Velocity() {\r\n  this.x = 0;\r\n  this.y = 0;\r\n  this.z = 0;\r\n\r\n  this.rotationMatrix = null;\r\n\r\n  this.doMove = true;\r\n}\r\n\r\n","module.exports = Drawable;\r\n\r\nfunction Drawable() {\r\n  this.mesh = null;\r\n  this.scene = null;\r\n}\r\n\r\n","module.exports = Gun;\r\n\r\nfunction Gun() {\r\n  this.entity = null;\r\n  this.mesh = null;\r\n}\r\n\r\n","module.exports = Hurt;\r\n\r\nfunction Hurt() {\r\n  this.timer = 0;\r\n  this.invulnerabilityFrames = 1;\r\n\r\n  this.hurtColor = new THREE.Color(0xdd0000);\r\n  this.originalColor = 0xffffff;\r\n}\r\n\r\n","module.exports = Bullet;\r\n\r\nfunction Bullet() {\r\n  this.isHot = true;\r\n  this.owner = null;\r\n}\r\n\r\n","module.exports = Health;\r\n\r\nfunction Health() {\r\n  this.hp = 3;\r\n  this.maxHP = 3;\r\n\r\n  this.healthBar = null;\r\n\r\n  this.changed = false;\r\n}\r\n\r\n","module.exports = Expirable;\r\n\r\nfunction Expirable() {\r\n  this.age = 0;\r\n  this.maxAge = 5;\r\n}\r\n\r\n","module.exports = ShootDelay;\r\n\r\nfunction ShootDelay() {\r\n  this.canShoot = true;\r\n\r\n  this.timer = 0;\r\n  this.delayTheshold = 0.2;\r\n}\r\n\r\n","module.exports = Messanger;\n\nvar Event = require('./Event.js');\n\n/**\n * General event aggregation with filtering on components or tags.\n * @constructor\n */\nfunction Messanger()\n{\n  this._events = {};\n  this.fired   = 0;\n  this.handled = 0;\n}\n\n/**\n * @param {String} eventName\n * @param {Function} callback\n * @return {Event}\n */\nMessanger.prototype.listenTo = function(eventName, callback)\n{\n  if (!this._events[eventName])\n    this._events[eventName] = [];\n\n  var event = new Event(eventName, callback);\n\n  // Dump and chump\n  this._events[eventName].push(event);\n  return event;\n};\n\n/**\n * @param {String} eventName\n * @param {Object=} entity\n * @param {Option=} option\n */\nMessanger.prototype.trigger = function(eventName, entity, option)\n{\n  this.fired++;\n\n  var events = this._events[eventName];\n  if (!events) return;\n\n  // Try all events\n  for (var n = 0; n < events.length; n++) {\n    var event = events[n];\n    if (event.fire(eventName, entity, option))\n      this.handled++;\n  }\n};\n\n","module.exports = ObjectPool;\n\n/**\n * Minimize garbage collector thrashing by re-using existing objects instead of\n * creating new ones. Requires manually lifecycle management.\n * @constructor\n * @param {Function} T\n */\nfunction ObjectPool(T)\n{\n  this.freeList = [];\n  this.count    = 0;\n  this.T        = T;\n}\n\n/**\n * Get a pooled object\n */\nObjectPool.prototype.aquire = function()\n{\n  // Grow the list by 20%ish if we're out\n  if (this.freeList.length <= 0) {\n    this.expand(Math.round(this.count*0.2) + 1);\n  }\n\n  var item = this.freeList.pop();\n\n  // We can provide explicit initing, otherwise re-call constructor (hackish)\n  if (item.__init)\n    item.__init();\n  else\n    this.T.call(item);\n\n  return item;\n};\n\n/**\n * Return an object back to the pool.\n */\nObjectPool.prototype.release = function(item)\n{\n  this.freeList.push(item);\n};\n\n/**\n * @param {Number} Amount of new objects to allocate for this pool.\n */\nObjectPool.prototype.expand = function(count)\n{\n  for (var n = 0; n < count; n++)\n    this.freeList.push(new this.T());\n  this.count += count;\n};\n\n/**\n * @return {Number} Total amount of allocated objects (available and in-use).\n */\nObjectPool.prototype.totalSize = function()\n{\n  return this.count;\n};\n\n/**\n * @return {Number} Total number of objects currently available.\n */\nObjectPool.prototype.totalFree = function()\n{\n  return this.freeList.length;\n};\n\n/**\n * @return {Number} Total number of objects currently in-use.\n */\nObjectPool.prototype.totalUsed = function()\n{\n  return this.count - this.freeList.length;\n};\n\n","module.exports = QuadTree;\n\nvar ObjectPool = require('./ObjectPool.js');\nvar Spatial    = require('./Spatial.js');\nvar Vec2       = require('./Vec2.js');\n\n/**\n * Effectively store positional and sized objects. Each tree has a position and\n * size, as well as up to 4 child nodes (other trees) and an array of entries.\n * @constructor\n */\nfunction QuadTree()\n{\n  this.level       = 0;\n  this.position    = new Vec2();\n  this.size        = new Vec2();\n  this.maxEntities = 15;\n  this.maxLevels   = 10;\n\n  /**\n   * Pool that is used for all internal quad trees. Only root node has one, all\n   * others have a refence.\n   */\n  this.pool = new ObjectPool(QuadTree);\n\n  /**\n   * @type {Array.<QuadTree>}\n   */\n  this.nodes = [];\n\n  /**\n   * @type {Array.<{spatial: Spatial}>}\n   */\n  this.entities = [];\n}\n\n/**\n * Reset for pool.\n * @private\n */\nQuadTree.prototype.__init = function()\n{\n  this.level = 0;\n  this.position.clear();\n  this.size.clear();\n  this.nodes.length = 0;\n  this.entities.length = 0;\n\n  // Only root node has actual ref to pool\n  this.pool = null;\n};\n\n/**\n * Add an entity to the tree\n * @param {{spatial: Spatial}} entity\n */\nQuadTree.prototype.insert = function(entity)\n{\n  // Recurse if we can\n  if (this.nodes.length) {\n    var index = this._getIndex(entity.spatial.absPosition(),\n      entity.spatial.absHwidth());\n    if (~index) return this.nodes[index].insert(entity);\n  }\n\n  // Actually add the entity\n  this.entities.push(entity);\n  this._splitAndRedistributeIfNeeded();\n  entity.spatial._node = this;\n  return entity;\n};\n\n/**\n * Remove an entity from this tree.\n * @param {{spatial: Spatial}} param\n */\nQuadTree.prototype.remove = function(entity)\n{\n  // Remove if we can\n  var n = this.entities.indexOf(entity);\n  if (~n) {\n    this.entities.splice(n, 1);\n    entity.spatial._node = null;\n    if (!this.totalSize())\n      this.clear();\n    return;\n  }\n\n  // Recuse if we can\n  if (this.nodes.length) {\n    var index = this._getIndex(entity.spatial.absPosition(),\n      entity.spatial.absHwidth());\n    if (~index) return this.nodes[index].remove(entity);\n  }\n};\n\n/**\n * Total recursive size of this tree.\n * @return {Number}\n */\nQuadTree.prototype.totalSize = function()\n{\n  var size = this.entities.length;\n\n  for (var n = 0; n < this.nodes.length; n++) {\n    var node = this.nodes[n];\n    size += node.totalSize();\n  }\n\n  return size;\n};\n\n/**\n * Empty the tree recursively.\n */\nQuadTree.prototype.clear = function()\n{\n  // Clear entity area\n  for (var m = 0; m < this.entities.length; m++) {\n    var entity = this.entities[m];\n    entity.spatial._node = null;\n  }\n  this.entities.length = 0;\n\n  // Recurse, free the node, and wipe out our node length\n  for (var n = 0; n < this.nodes.length; n++) {\n    var node = this.nodes[n];\n    node.clear();\n    this.pool.release(node);\n  }\n  this.nodes.length = 0;\n};\n\n/**\n * Get all tree entries that are interesected by a rectangle defined with\n * position and hwidth.\n * @param {Vec2} position\n * @param {Vec2} hwidth\n * @param {Array.<{spatial: Spatial}>=} out__objects Return objects.\n * @return {Array.<{spatial: Spatial}>} The out__objects parameter (filled up now)\n */\nQuadTree.prototype.queryArea = function(position, hwidth, out__entities)\n{\n  var entities = out__entities || [];\n\n  // If query belongs in ONLY a single node, then recurse\n  var index = this._getIndex(position, hwidth);\n  if (~index && this.nodes.length) {\n    this.nodes[index].queryArea(position, hwidth, entities);\n\n  // Otherwise, we have to add ALL of the nodes as it may be overlapping one\n  } else {\n    for (var j = 0; j < this.nodes.length; j++) {\n      var node = this.nodes[j];\n      node.queryArea(position, hwidth, entities);\n    }\n  }\n\n  // Also add everything from this node itself\n  for (var m = 0; m < this.entities.length; m++) {\n    var entity = this.entities[m];\n\n    var overlapping = Vec2.rectIntersect(\n      entity.spatial.absPosition(),\n      entity.spatial.absHwidth(),\n      position,\n      hwidth);\n\n    if (overlapping) {\n      entities.push(entity);\n    }\n  }\n\n  return entities;\n};\n\n/**\n * Do a complete reset of the tree.\n */\nQuadTree.prototype.reIndex = function()\n{\n  this._combine();\n  this._splitAndRedistributeIfNeeded();\n};\n\nvar tSize = new Vec2();\nvar tPos  = new Vec2();\n\n/**\n * Check to see if an entity is still valid.\n * @param {{spatial: Spatial}} entity\n * @return {Boolean} True if the entity is in this tree (non-recursive) in its\n * correct place. False implies we need to re-add it.\n */\nQuadTree.prototype.validateEntity = function(entity)\n{\n  var pos = entity.spatial.position;\n  var hw  = entity.spatial.hwidth;\n\n  // Check to see if we're still inside this node\n  tSize.assign(this.size).smult(0.5);\n  tPos.assign(tSize).add(this.position);\n  var inside = Vec2.rectContains(pos, hw, tPos, tSize);\n\n  if (!inside) return false;\n\n  // No children nodes, then we're good\n  if (!this.nodes.length)\n    return true;\n\n  // Or if children nodes and we overlap, still good\n  var index = this._getIndex(entity.spatial.absPosition(),\n    entity.spatial.absHwidth());\n  if (this.nodes.length && !~index)\n    return true;\n\n  // Didnt make it\n  return false;\n};\n\n/**\n * Return which of the 4 quandrants of this tree an object would go into.\n * @param {Vec2} position\n * @param {Vec2} hwidth\n * @return {Number} Which quandrant, or -1 if won't fit.\n * @private\n */\nQuadTree.prototype._getIndex = function(position, hwidth)\n{\n  var midX = this.position.x + this.size.x / 2;\n  var midY = this.position.y + this.size.y / 2;\n\n  var left   = position.x - hwidth.x < midX && position.x + hwidth.x < midX;\n  var right  = position.x - hwidth.x > midX && position.x + hwidth.x > midX;\n  var top    = position.y - hwidth.y < midY && position.y + hwidth.y < midY;\n  var bottom = position.y - hwidth.y > midY && position.y + hwidth.y > midY;\n\n  if (top && right) return 0;\n  if (top && left) return 1;\n  if (bottom && left) return 2;\n  if (bottom && right) return 3;\n\n  return -1;\n};\n\n/**\n * If we've overpacked this tree, then split into 4 smaller trees (if we\n * haven't already) and redistribute.\n * @private\n */\nQuadTree.prototype._splitAndRedistributeIfNeeded = function()\n{\n  if (this.entities.length > this.maxEntities &&\n    this.level < this.maxLevels)\n  {\n    this._split();\n    this._redistribute();\n  }\n};\n\n/**\n * Create a sub quad tree\n * @return {QuadTree}\n * @private\n */\nQuadTree.prototype._factory = function()\n{\n  var node = this.pool.aquire();\n\n  node.pool        = this.pool;\n  node.level       = this.level + 1;\n  node.maxEntities = this.maxEntities;\n  node.maxLevels   = this.maxLevels;\n\n  return node;\n};\n\n/**\n * Create 4 sub nodes for the tree (does not populate tho)\n * @private\n */\nQuadTree.prototype._split = function()\n{\n  if (this.nodes.length) return;\n\n  var x = this.position.x;\n  var y = this.position.y;\n\n  var w = this.size.x / 2;\n  var h = this.size.y / 2;\n\n  // Create the seperate nodes\n  for (var n = 0; n < 4; n++) {\n    var node = this._factory();\n    node.size.set(w, h);\n\n    switch(n) {\n      case 0:\n        node.position.set(x + w, y);\n        break;\n      case 1:\n        node.position.set(x, y);\n        break;\n      case 2:\n        node.position.set(x, y + h);\n        break;\n      case 3:\n        node.position.set(x + w, y + h);\n        break;\n    }\n\n    this.nodes.push(node);\n  }\n};\n\n/**\n * Distrubute all entities into child nodes if we can.\n * @private\n */\nQuadTree.prototype._redistribute = function()\n{\n  // Loop through all of our entries and if they can fit into a child node,\n  // move them there\n  var i = 0;\n  while (i < this.entities.length) {\n    var entity = this.entities[i];\n    var index = this._getIndex(entity.spatial.absPosition(),\n      entity.spatial.absHwidth());\n\n    // Insert into child, remove from our array if they belong in another node\n    if (~index) {\n      this.nodes[index].insert(entity);\n      this.entities.splice(i, 1);\n    } else {\n      i++;\n    }\n  }\n};\n\n/**\n * Unwinds this node. Move all child nodes into this node and remove child\n * nodes.\n * @private\n */\nQuadTree.prototype._combine = function()\n{\n  for (var n = 0; n < this.nodes.length; n++) {\n    var node = this.nodes[n];\n\n    // Combine all children first\n    node._combine();\n\n    // All entries combined on node, now add it to US\n    for (var m = 0; m < node.entities.length; m++) {\n      var entity = node.entities[m];\n      this.entities.push(entity);\n    }\n\n    // Clear out and ensure we release it\n    node.entities.length = 0;\n    node.clear();\n    this.pool.release(node);\n  }\n\n  // Clear nodes array\n  this.nodes.length = 0;\n};\n\n","module.exports = EntityManager;\n\nvar Entity     = require('./Entity.js');\nvar ObjectPool = require('./ObjectPool.js');\nvar Messanger  = require('./Messanger.js');\nvar getName    = require('typedef').getName;\n\n/**\n * Manage, create, and destroy entities. Can use methods to mutate entities\n * (tags, components) directly or via the facade on the Entity.\n * @param {Messanger} messanger\n * @constructor\n */\nfunction EntityManager(messanger)\n{\n  this.messanger = messanger;\n  this._tags = {};\n\n  /**\n   * @type {Array.<Entity>}\n   */\n  this._entities = [];\n\n  /**\n   * @type {Array.<Group>}\n   */\n  this._groups = {};\n\n  this._entityPool = new ObjectPool(Entity);\n\n  this._componentPools = {};\n}\n\n/**\n * Fired AFTER an entity has be created.\n * @event\n */\nEntityManager.ENTITY_CREATED = 'EntityManager#ENTITY_CREATED';\n\n/**\n * Fired BEFORE an entity has been removed.\n * @event\n */\nEntityManager.ENTITY_REMOVE = 'EntityManager#ENTITY_REMOVE';\n\n/**\n * Fired AFTER a component has been removed.\n * @event\n */\nEntityManager.COMPONENT_ADDED = 'EntityManager#COMPONENT_ADDED';\n\n/**\n * Fired BEFORE a component has been removedt\n * @event\n */\nEntityManager.COMPONENT_REMOVE = 'EntityManager#COMPONENT_REMOVE';\n\n/**\n * @constructor\n * @param {Array.<Function>} Components\n * @param {Array<Entity>} entities\n */\nfunction Group(Components, entities)\n{\n  this.Components = Components || [];\n  this.entities = entities || [];\n}\n\n/**\n * Get a new entity.\n * @return {Entity}\n */\nEntityManager.prototype.createEntity = function()\n{\n  var entity = this._entityPool.aquire();\n\n  this._entities.push(entity);\n  entity._manager = this;\n  this._trigger(EntityManager.ENTITY_CREATED, entity);\n  return entity;\n};\n\n/**\n * Cleanly remove entities based on tag. Avoids loop issues.\n * @param {String} tag\n */\nEntityManager.prototype.removeEntitiesByTag = function(tag)\n{\n  var entities = this._tags[tag];\n\n  if (!entities) return;\n\n  for (var x = entities.length - 1; x >= 0; x--) {\n    var entity = entities[x];\n    entity.remove();\n  }\n};\n\n/**\n * Dump all entities out of the manager. Avoids loop issues.\n */\nEntityManager.prototype.removeAllEntities = function()\n{\n  for (var x = this._entities.length - 1; x >= 0; x--) {\n    this._entities[x].remove();\n  }\n};\n\n/**\n * Drop an entity. Returns it to the pool and fires all events for removing\n * components as well.\n * @param {Entity} entity\n */\nEntityManager.prototype.removeEntity = function(entity)\n{\n  var index = this._entities.indexOf(entity);\n\n  if (!~index)\n    throw new Error('Tried to remove entity not in list');\n\n  this.entityRemoveAllComponents(entity);\n\n  // Remove from entity list\n  this._trigger(EntityManager.ENTITY_REMOVE, entity);\n  this._entities.splice(index, 1);\n\n  // Remove entity from any tag groups\n  entity._tags = null;\n  for (var tag in this._tags) {\n    var entities = this._tags[tag];\n    var n = entities.indexOf(entity);\n    if (~n) entities.splice(n, 1);\n  }\n\n  // Prevent any acecss and free\n  entity._manager = null;\n  this._entityPool.release(entity);\n};\n\n/**\n * @param {Entity} entity\n * @param {String} tag\n */\nEntityManager.prototype.entityAddTag = function(entity, tag)\n{\n  var entities = this._tags[tag];\n\n  if (!entities)\n    entities = this._tags[tag] = [];\n\n  // Don't add if already there\n  if (~entities.indexOf(entity)) return;\n\n  entities.push(entity);\n  entity._tags.push(tag);\n};\n\n/**\n * @param {Entity} entity\n * @param {String} tag\n */\nEntityManager.prototype.entityRemoveTag = function(entity, tag)\n{\n  var entities = this._tags[tag];\n  if (!entities) return;\n\n  var index = entities.indexOf(entity);\n  if (!~index) return;\n\n  entities.splice(index, 1);\n  entity._tags.splice(entity._tags.indexOf(tag), 1);\n};\n\n/**\n * @param {Entity} entity\n * @param {Function} Component\n */\nEntityManager.prototype.entityAddComponent = function(entity, Component)\n{\n  if (~entity._Components.indexOf(Component)) return;\n\n  entity._Components.push(Component);\n\n  // Create the reference on the entity to this (aquired) component\n  var cName = componentPropertyName(Component);\n  var cPool = this._componentPools[cName];\n  if (!cPool)\n    cPool = this._componentPools[cName] = new ObjectPool(Component);\n  var component = cPool.aquire();\n  entity[cName] = component;\n\n  // Check each indexed group to see if we need to add this entity to the list\n  for (var groupName in this._groups) {\n    var group = this._groups[groupName];\n\n    if (!~group.Components.indexOf(Component))\n      continue;\n    if (!entity.hasAllComponents(group.Components))\n      continue;\n    if (~group.entities.indexOf(entity))\n      continue;\n\n    group.entities.push(entity);\n  }\n\n  this._trigger(EntityManager.COMPONENT_ADDED, entity, Component);\n};\n\n/**\n * Drop all components on an entity.\n * @param {Entity} entity\n */\nEntityManager.prototype.entityRemoveAllComponents = function(entity)\n{\n  var Cs = entity._Components;\n\n  for (var j = Cs.length - 1; j >= 0; j--) {\n    var C = Cs[j];\n    entity.removeComponent(C);\n  }\n};\n\n/**\n * @param {Entity} entity\n * @param {Function} Component\n */\nEntityManager.prototype.entityRemoveComponent = function(entity, Component)\n{\n  var index = entity._Components.indexOf(Component);\n  if (!~index) return;\n\n  this._trigger(EntityManager.COMPONENT_REMOVE, entity, Component);\n\n  // Check each indexed group to see if we need to remove it\n  for (var groupName in this._groups) {\n    var group = this._groups[groupName];\n\n    if (!~group.Components.indexOf(Component))\n      continue;\n    if (!entity.hasAllComponents(group.Components))\n      continue;\n\n    var loc = group.entities.indexOf(entity);\n    if (~loc) {\n      group.entities.splice(loc, 1);\n    }\n  }\n\n  // Remove T listing on entity and property ref, then free the component.\n  var propName = componentPropertyName(Component);\n  entity._Components.splice(index, 1);\n  var component = entity[propName];\n  delete entity[propName];\n  this._componentPools[propName].release(component);\n};\n\n/**\n * @param {Array.<Function>} Components\n * @return {Array.<Entity>}\n */\nEntityManager.prototype.queryComponents = function(Components)\n{\n  var group = this._groups[groupKey(Components)];\n\n  if (!group) {\n    group = this._indexGroup(Components);\n  }\n\n  return group.entities;\n};\n\n/**\n * @param {String} tag\n * @return {Array.<Entity>}\n */\nEntityManager.prototype.queryTag = function(tag)\n{\n  var entities = this._tags[tag];\n\n  if (entities === undefined)\n    entities = this._tags[tag] = [];\n\n  return entities;\n};\n\n/**\n * @return {Number} Total number of entities.\n */\nEntityManager.prototype.count = function()\n{\n  return this._entities.length;\n};\n\n/**\n * Get information about the object pools of the entities and the various\n * components.\n * @return {Object}\n */\nEntityManager.prototype.poolStats = function()\n{\n  var stats = {};\n  var e = this._entityPool;\n  stats.entity = {\n    used: this._entityPool.totalUsed(),\n    size: this._entityPool.count\n  };\n\n  for (var cName in this._componentPools) {\n    var pool = this._componentPools[cName];\n    stats[cName] = {\n      used: pool.totalUsed(),\n      size: pool.count\n    };\n  }\n\n  return stats;\n};\n\n/**\n * Create an index of entities with a set of components.\n * @param {Array.<Function>} Components\n * @private\n */\nEntityManager.prototype._indexGroup = function(Components)\n{\n  var key = groupKey(Components);\n\n  if (this._groups[key]) return;\n\n  var group = this._groups[key] = new Group(Components);\n\n  for (var n = 0; n < this._entities.length; n++) {\n    var entity = this._entities[n];\n    if (entity.hasAllComponents(Components)) {\n      group.entities.push(entity);\n    }\n  }\n\n  return group;\n};\n\n/**\n * Trigger the messanger if we have one.\n * @param {String} event\n * @param {Object=} a\n * @param {Object=} b\n */\nEntityManager.prototype._trigger = function(event, a, b)\n{\n  if (this.messanger)\n    this.messanger.trigger(event, a, b);\n};\n\n/**\n * @param {Function} Component\n * @return {String}\n * @private\n */\nfunction componentPropertyName(Component)\n{\n  var name = getName(Component);\n  return name.charAt(0).toLowerCase() + name.slice(1);\n}\n\n/**\n * @param {Array.<Function>} Components\n * @return {String}\n * @private\n */\nfunction groupKey(Components)\n{\n  var names = [];\n  for (var n = 0; n < Components.length; n++) {\n    var T = Components[n];\n    names.push(getName(T));\n  }\n\n  return names\n    .map(function(x) { return x.toLowerCase(); })\n    .sort()\n    .join('-');\n}\n\n","module.exports = Spatial;\n\nvar Vec2 = require('./Vec2.js');\n\n/**\n * Basic component giving an entity the concept of being located somewhere.\n * Creates basic spatial heirachy, positions, rotation, etc.\n * @constructor\n */\nfunction Spatial()\n{\n  // Alloc our types\n  this.position     = new Vec2();\n  this.scale        = new Vec2();\n  this.hwidth       = new Vec2();\n\n  this._absScale    = new Vec2();\n  this._absPosition = new Vec2();\n  this._absHwidth   = new Vec2();\n\n  // Setup\n  this.__init();\n}\n\n/**\n * Setup called by pool.\n * @private\n */\nSpatial.prototype.__init = function()\n{\n  this.rotation = 0;\n\n  // Ref to quad tree node this component is in\n  this._node = null;\n\n  // Parent component\n  this.parent = null;\n\n  this.position.clear();\n  this.scale.set(1, 1);\n  this.hwidth.clear();\n  this._absPosition.clear();\n  this._absScale.set(1, 1);\n  this._absHwidth.clear();\n};\n\n/**\n * Fired when spatials overlap.\n * @event\n */\nSpatial.COINCIDENT = 'Spatial#COINCIDENT';\n\n/**\n * Attach this component to another entity's Spatial.\n * @param {{spatial: Spatial}} entity An entity with a Spatial component\n */\nSpatial.prototype.attachTo = function(entity)\n{\n  if (this.parent)\n    throw new Error ('Entity already attached');\n\n  if (!entity || !entity.spatial)\n    throw new Error('Invalid / missing entity');\n\n  this.parent = entity.spatial;\n};\n\n/**\n * The absolute world position of this component.\n * @return {Vec2}\n */\nSpatial.prototype.absPosition = function()\n{\n  var v = this._absPosition.assign(this.position);\n\n  // Trivial case, no parent\n  if (!this.parent) {\n    return v;\n  }\n\n  var parent = this.parent;\n\n  // Rotate our angle by parent's angle\n  var r = this.absRotation();\n  v.rotate(parent.absRotation());\n\n  // Scale by parents scale\n  var pScale = parent.absScale();\n  v.set(v.x * pScale.x, v.y * pScale.y);\n\n  // Add parent's position\n  return v.add(parent.absPosition());\n};\n\n/**\n * The absolute world rotation of this component.\n * @return {Number}\n */\nSpatial.prototype.absRotation = function()\n{\n  // Trivial case\n  if (!this.parent)\n    return this.rotation;\n\n  // This + parent\n  var r = this.rotation + this.parent.absRotation();\n\n  return r % (Math.PI*2);\n};\n\n/**\n * The absolute world hwidth for this component.\n * @return {Vec2}\n */\nSpatial.prototype.absHwidth = function()\n{\n  var h = this._absHwidth.assign(this.hwidth);\n\n  if (!this.parent)\n    return h;\n\n  var scale = this.absScale();\n\n  return h.set(h.x * scale.x, h.y * scale.y);\n};\n\n/**\n * The absolute world scale of this component.\n * @return {Vec2}\n */\nSpatial.prototype.absScale = function()\n{\n  var v = this._absScale.assign(this.scale);\n\n  // Trivial case\n  if (!this.parent) {\n    return v;\n  }\n\n  var pScale = this.parent.absScale();\n\n  return v.set(v.x * pScale.x, v.y * pScale.y);\n};\n\n","module.exports = Entity;\n\n/**\n * Basic component-driven object with facade functions for interacting with the\n * injected EntityManager object.\n * @constructor\n */\nfunction Entity()\n{\n  // Injected by EntityManager\n  this._manager    = null;\n\n  /**\n   * @type {Array.<Function>}\n   * @private\n   */\n  this._Components = [];\n\n  /**\n   * @type {Array.<String>}\n   * @private\n   */\n  this._tags       = [];\n}\n\n/**\n * @param {Function} TComponent\n * @return {Entity} This entity.\n */\nEntity.prototype.addComponent = function(TComponent)\n{\n  this._manager.entityAddComponent(this, TComponent);\n  return this;\n};\n\n/**\n * @param {Function} TComponent\n * @return {Entity} This entity.\n */\nEntity.prototype.removeComponent = function(TComponent)\n{\n  this._manager.entityRemoveComponent(this, TComponent);\n  return this;\n};\n\n/**\n * @param {Function} TComponent\n * @return {boolean} True if this entity has TComponent.\n */\nEntity.prototype.hasComponent = function(TComponent)\n{\n  return !!~this._Components.indexOf(TComponent);\n};\n\n/**\n * @param {Array.<Function>} Components\n * @return {boolean} True if entity has all Components.\n */\nEntity.prototype.hasAllComponents = function(Components)\n{\n  var b = true;\n\n  for (var i = 0; i < Components.length; i++) {\n    var C = Components[i];\n    b &= !!~this._Components.indexOf(C);\n  }\n\n  return b;\n};\n\n/**\n * @param {String} tag\n * @return {boolean} True if entity has tag.\n */\nEntity.prototype.hasTag = function(tag)\n{\n  return !!~this._tags.indexOf(tag);\n};\n\n/**\n * @param {String} tag\n * @return {Entity} This entity.\n */\nEntity.prototype.addTag = function(tag)\n{\n  this._manager.entityAddTag(this, tag);\n  return this;\n};\n\n/**\n * @param {String} tag\n * @return {Entity} This entity.\n */\nEntity.prototype.removeTag = function(tag)\n{\n  this._manager.entityRemoveTag(this, tag);\n  return this;\n};\n\n/**\n * @return {void}\n */\nEntity.prototype.remove = function()\n{\n  return this._manager.removeEntity(this);\n};\n\n","module.exports = Vec2;\n\nvar ObjectPool = require('./ObjectPool.js');\n\n/**\n * 2-dimension Cartesian vector with built-in (optional) object pool.\n * @constructor\n * @param {Number} x\n * @param {Number} y\n */\nfunction Vec2(x, y)\n{\n  this.x = +x || 0.0;\n  this.y = +y || 0.0;\n}\n\n/**\n * Reset for pool.\n * @private\n */\nVec2.prototype.__init = function()\n{\n  this.clear();\n};\n\n// Interal static object pool\nvar pool = new ObjectPool(Vec2);\n\n/**\n * Get a vector from the pool.\n * @return {Vec2}\n */\nVec2.aquire = function()\n{\n  return pool.aquire();\n};\n\n/**\n * Return a vector to the pool.\n * @param {Vec2} v\n * @return {Number}\n */\nVec2.release = function(v)\n{\n  if (v) pool.release(v);\n  return pool.count - pool.freeList.length;\n};\n\n/**\n * Reset this vector to (0,0).\n * @return {Vec2} This vector.\n */\nVec2.prototype.clear = function()\n{\n  this.x = this.y = 0.0;\n  return this;\n};\n\n/**\n * Assign this vector the value of another.\n * @param {Vec2} v\n * @return {Vec2} This vector.\n */\nVec2.prototype.assign = function(v)\n{\n  this.x = v.x;\n  this.y = v.y;\n  return this;\n};\n\n/**\n * Determine if this vector is equal to another.\n * @param {Vec2} v\n * @return {Boolean} True if vectors are equal.\n */\nVec2.prototype.equals = function(v)\n{\n  return this.x === v.x && this.y === v.y;\n};\n\n/**\n * Set this vector to a set of coordinates.\n * @param {Number} x\n * @param {Number} y\n * @return {Vec2} This vector.\n */\nVec2.prototype.set = function(x, y)\n{\n  this.x = +x;\n  this.y = +y;\n  return this;\n};\n\n/**\n * Limit this vector to a specific magnitude.\n * @param {Number} size\n * @return {Vec2} This vector.\n */\nVec2.prototype.limit = function(size)\n{\n  size = +size;\n  if (!size)\n    return this;\n  else if (this.magnitude() > size)\n    return this.normalize(size);\n  else\n    return this;\n};\n\n/**\n * Normalize this vector.\n * @param {Number=} m Length.\n * @return {Vec2} This vector.\n */\nVec2.prototype.normalize = function(m)\n{\n  m = m || +1.0;\n  var length = Math.sqrt(this.x * this.x + this.y * this.y);\n  this.x = m * this.x / length;\n  this.y = m * this.y / length;\n  return this;\n};\n\n/**\n * Subtract some vector from this one.\n * @param {Vec2} v\n * @return {Vec2} This vector.\n */\nVec2.prototype.sub = function(v)\n{\n  this.x -= v.x;\n  this.y -= v.y;\n  return this;\n};\n\n/**\n * Add some vector to this one.\n * @param {Vec2} v\n * @return {Vec2} This vector.\n */\nVec2.prototype.add = function(v)\n{\n  this.x += v.x;\n  this.y += v.y;\n  return this;\n};\n\n/**\n * Scalar multiply this vector by a value.\n * @param {Number} n\n * @return {Vec2} This vector.\n */\nVec2.prototype.smult = function(n)\n{\n  n = +n;\n  this.x *= n;\n  this.y *= n;\n  return this;\n};\n\n/**\n * Rotate this vector clockwise about the origin by a certain angle.\n * @param {Number} theta\n * @return {Vec2} This vector.\n */\nVec2.prototype.rotate = function(theta)\n{\n  return this.set(\n    this.x * Math.cos(theta) - this.y * Math.sin(theta),\n    this.x * Math.sin(theta) + this.y * Math.cos(theta)\n  );\n};\n\n/**\n * Get the dot product of this vector and another.\n * @param {Vec2} v\n * @return {Number}\n */\nVec2.prototype.dot = function(v)\n{\n  return +(this.x * v.x + this.y * v.y);\n};\n\n/**\n * Get the determinate of this vector and another.\n * @param {Vec2} v\n * @return {Number}\n */\nVec2.prototype.det = function(v)\n{\n  return +(this.x * v.y - this.y * v.x);\n};\n\n/**\n * Get the magnitude of this vector.\n * @return {Number}\n */\nVec2.prototype.magnitude = function()\n{\n  return Math.sqrt(this.x * this.x + this.y * this.y);\n};\n\n/**\n * Get the squared magnitude of this vector.\n * @return {Number}\n */\nVec2.prototype.magnitude2 = function()\n{\n  return this.x * this.x + this.y * this.y;\n};\n\n/**\n * Get the angle of this vector.\n * @return {Number}\n */\nVec2.prototype.angle = function()\n{\n  return Math.atan2(this.y, this.x);\n};\n\n/**\n * Get the angle between this vector and another.\n * @param {Vec2} v\n * @return {Number}\n */\nVec2.prototype.angleBetween = function(v)\n{\n  return Math.atan2(this.det(v), this.dot(v));\n};\n\n/**\n * Make a pooled copy of this vector\n * @return {Vec2} A new vector.\n */\nVec2.prototype.pcopy = function()\n{\n  return Vec2.aquire().assign(this);\n};\n\n/**\n * Make a copy of this vector.\n * @return {Vec2} A new vector.\n */\nVec2.prototype.copy = function()\n{\n  return new Vec2().assign(this);\n};\n\n/**\n * Create a vector with a specific angle and magnitude.\n * @param {Number} theta\n * @param {Number=} m\n * @return {Vec2} A new vector.\n */\nVec2.fromAngle = function(theta, m)\n{\n  m = +m || 1.0;\n  return new Vec2(Math.cos(theta) * m, Math.sin(theta) * m);\n};\n\n/**\n * Create a pooled vector with a specific angle and magnitude.\n * @param {Number} theta\n * @param {Number} m\n * @return {Vec2} A new vector.\n */\nVec2.pfromAngle = function(theta, m)\n{\n  m = +m || 1.0;\n  return Vec2.aquire().set(\n    Math.cos(theta) * m,\n    Math.sin(theta) * m\n  );\n};\n\n/**\n * Determine if two rectangles, defined by a position and a halfwidth vector,\n * overlap.\n * @param {Vec2} p1 Position of rectangle 1\n * @param {Vec2} r1 Halfwidths of rectangle 1\n * @param {Vec2} p2 Position of rectangle 2\n * @param {Vec2} r2 Halfwidths of rectangle 2\n * @return {Boolean} True if they intersect\n */\nVec2.rectIntersect = function(p1, r1, p2, r2)\n{\n  // Basically, rectangles dont intersect if one's bottom is higher than ones\n  // top, ones left is more left than ones right, etc\n  var a = p1.x + r1.x < p2.x - r2.x;\n  var b = p1.x - r1.x > p2.x + r2.x;\n  var c = p1.y + r1.y < p2.y - r2.y;\n  var d = p1.y - r1.y > p2.y + r2.y;\n\n  // We want if they do\n  return !(a || b || c || d);\n};\n\n/**\n * Determines if rectangle 1 is entirely inside of rectangle 2.\n * @param {Vec2} p1 Position of rectangle 1\n * @param {Vec2} r1 Halfwidths of rectangle 1\n * @param {Vec2} p2 Position of rectangle 2\n * @param {Vec2} r2 Halfwidths of rectangle 2\n * @return {Boolean} True if they rectangle 1 is inside of rectangle 2\n */\nVec2.rectContains = function(p1, r1, p2, r2)\n{\n  if (p1.x - r1.x < p2.x - r2.x) return false;\n  if (p1.x + r1.x > p2.x + r2.x) return false;\n  if (p1.y - r1.y < p2.y - r2.y) return false;\n  if (p1.y + r1.y > p2.y + r2.y) return false;\n\n  return true;\n};\n\n/**\n * Convert a rectangle specified by top-left point + size into center location\n * + halfwidths.\n * @param {Vec2} position\n * @param {Vec2} size\n * @param {Vec2} out__position Output position\n * @param {Vec2} out__hwidth Output hwidths\n */\nVec2.sizeToHwidth = function(position, size, out__position, out__hwidth)\n{\n  out__hwidth.assign(size).smult(0.5);\n  out__position.assign(position).add(out__hwidth);\n};\n\n/**\n * Output this vector.\n */\nVec2.prototype.toString = function()\n{\n  return '' + (this.x.toFixed(2)) + ',' + (this.y.toFixed(2));\n};\n\n","module.exports = Event;\n\n/**\n * @constructor\n */\nfunction Event(name, callback)\n{\n  this._name     = name || 'name';\n  this._callback = callback || null;\n\n  // Additional filters\n  this._Components = [];\n}\n\n/**\n * @param {String} eventName\n * @param {{hasAllComponents:Function}} entity\n * @param {Object=} option\n * @return {Boolean} True if fired.\n */\nEvent.prototype.fire = function(eventName, entity, option)\n{\n  // Name check\n  if (eventName !== this._name)\n    return false;\n\n  // Component filters\n  var Comps = this._Components;\n  if (entity && entity.hasAllComponents && Comps.length) {\n    if (!entity || !entity.hasAllComponents(Comps))\n      return false;\n  }\n\n  // Made it\n  this._callback(entity, option);\n  return true;\n};\n\n/**\n * @param {Function} T\n * @return {Event} This object.\n */\nEvent.prototype.whereComponent = function(T)\n{\n  this._Components.push(T);\n};\n\n/**\n * @param {Array.<Function>} Components\n * @return {Event} This object.\n */\nEvent.prototype.whereComponents = function(Components)\n{\n  this._Components = this._Components.concat(Components);\n  return this;\n};\n\n","module.exports = {\n\n  'extends'      : require('./lib/extends.js'),\n  'mixin'        : require('./lib/mixin.js'),\n  'getArguments' : require('./lib/getArguments.js'),\n  'getName'      : require('./lib/getName.js')\n\n};\n\n\n","module.exports = mixin_;\n\n/**\n * Add all own properties of mixin to the prototype property of class T\n * @param {Function} T Class we want to mix into.\n * @param {Function|Object} mixin Mixin we want to mixt\n */\nfunction mixin_(T, mixin)\n{\n  // If we're mixing in a class (constructor function), then first mix in all\n  // things hanging directly off the mixin as \"statics\", then switch the mixin\n  // ref to point to the prototype\n  if (mixin instanceof Function) {\n    for (var k in mixin) {\n      T[k] = mixin[k];\n    }\n    mixin = mixin.prototype;\n  }\n\n  // Dump everything on the mixin into the prototype of our class\n  for (var key in mixin) {\n    if (mixin.hasOwnProperty(key)) {\n      T.prototype[key] = mixin[key];\n    }\n  }\n}\n\n","module.exports = getArguments;\n\nvar FUNCTION_ARGS = /^\\w*function[^\\(]*\\(([^\\)]+)/;\n\n/**\n * Get the parameter names of a function.\n * @param {Function} f A function.\n * @return {Array.<String>} An array of the argument names of a function.\n */\nfunction getArguments(f)\n{\n  var ret = [];\n  var args = f.toString().match(FUNCTION_ARGS);\n\n  if (args) {\n    args = args[1]\n      .replace(/[ ]*,[ ]*/, ',')\n      .split(',');\n    for (var n = 0; n < args.length; n++) {\n      var a = args[n].replace(/^\\s+|\\s+$/g, '');\n      if (a) ret.push(a);\n    }\n  }\n\n  return ret;\n}\n\n","module.exports = extends_;\n\n/**\n * The well documented, oft-used (Coffeescript, Typescript, ES6... etc) extends\n * pattern to get some sort of single-inheritance in Javascript.  Modify a\n * Child class to have inherited the static members via copying and link the\n * prototypes.\n * @param {Function} Child Child constructor function.\n * @param {Function} Parent Parent contrusctor function.\n * @return {Function} The Child constructor.\n */\nfunction extends_(Child, Parent)\n{\n  // Drop in statics\n  for (var key in Parent) {\n    if (!Child.hasOwnProperty(key) && Parent.hasOwnProperty(key)) {\n      Child[key] = Parent[key];\n    }\n  }\n\n  // Give static to access parent\n  Child.Super = Parent;\n\n  // Child's prototype property is an object with the parent's prototype\n  // property its [[prototype]] + constructor\n  if (Object.create instanceof Function) {\n    Child.prototype = Object.create(Parent.prototype, {\n      constructor: { value: Child }\n    });\n  } else {\n    // IE8 and below shim\n    var T = makeT(Child);\n    T.prototype = Parent.prototype;\n    Child.prototype = new T();\n  }\n\n  return Child;\n}\n\n/**\n * @param {Function} Child\n * @return {Function}\n */\nfunction makeT(Child)\n{\n  return function T() { this.constructor = Child; };\n}\n\n","module.exports = getName;\n\nvar FUNCTION_NAME = /function\\s+([^\\s(]+)/;\n\n/**\n * Get the name of a function (e.g. constructor)\n * @param {Function} f\n * @return {String} The function name.\n */\nfunction getName(f)\n{\n  var name = '';\n\n  if (f instanceof Function) {\n    if (f.name) {\n      return f.name;\n    }\n\n    var match = f.toString().match(FUNCTION_NAME);\n\n    if (match) {\n      name = match[1];\n    }\n  } else if (f && f.constructor instanceof Function) {\n    name = getName(f.constructor);\n  }\n\n  return name;\n}\n"]}