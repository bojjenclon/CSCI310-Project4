{"version":3,"sources":["../../../../AppData/Roaming/npm/node_modules/browserify/node_modules/browser-pack/_prelude.js","main.js","node_modules/js-class/class.js","node_modules/three-pointerlock/index.js","node_modules/tiny-ecs/index.js","node_modules/physijs-browserify/physi.js","node_modules/stats.js/src/Stats.js","node_modules/three/three.js","node_modules/tiny-ecs/lib/Entity.js","node_modules/tiny-ecs/lib/Messanger.js","node_modules/tiny-ecs/lib/EntityManager.js","node_modules/tiny-ecs/lib/QuadTree.js","node_modules/tiny-ecs/lib/ObjectPool.js","node_modules/tiny-ecs/lib/Vec2.js","node_modules/tiny-ecs/lib/Spatial.js","node_modules/tiny-ecs/lib/Event.js","node_modules/tiny-ecs/node_modules/typedef/index.js","node_modules/tiny-ecs/node_modules/typedef/lib/extends.js","node_modules/tiny-ecs/node_modules/typedef/lib/getName.js","node_modules/tiny-ecs/node_modules/typedef/lib/getArguments.js","node_modules/tiny-ecs/node_modules/typedef/lib/mixin.js"],"names":["init","window","addEventListener","onResize","onKeyUp","onkeydown","onKeyDown","app","container","document","getElementById","loadingContainer","blocker","instructions","initThree","renderer","THREE","WebGLRenderer","antialias","setSize","innerWidth","innerHeight","appendChild","domElement","stats","Stats","setMode","style","position","left","top","body","scene","Physijs","Scene","aspectRatio","camera","PerspectiveCamera","set","add","controls","PointerLockControls","getObject","m","Mesh","BoxGeometry","MeshBasicMaterial","color","clock","Clock","visibility","scrollTop","documentElement","initPointerLock","run","paused","getDelta","dt","update","simulate","render","requestAnimationFrame","e","aspect","updateProjectionMatrix","keyCode","event","which","KEY_CODES","space","c","guiMenu","cameraFocus","controlsEnabled","flyControls","setEnabled","havePointerLock","element","pointerlockchange","pointerLockElement","mozPointerLockElement","webkitPointerLockElement","enabled","display","pointerlockerror","requestPointerLock","mozRequestPointerLock","webkitRequestPointerLock","test","navigator","userAgent","fullscreenchange","fullscreenElement","mozFullscreenElement","mozFullScreenElement","removeEventListener","requestFullscreen","mozRequestFullscreen","mozRequestFullScreen","webkitRequestFullscreen","innerHTML","getTexture","path","callback","undefined","textures","ImageUtils","loadTexture","global","Class","require","EntityManager","scripts","worker","ammo","CONSANTS","SpaceRock","constructor","options","this","name","size","parent","children","orbitSpeed","texture","textureWrap","wrapS","RepeatWrapping","wrapT","material","isLambert","map","MeshLambertMaterial","wrapAround","mesh","SphereGeometry","spaceRockSegments","copy","oldPosition","clone","rotation","z","rotateAroundPoint","length","deltaPosition","sub","i","child","center","angle","radians","Math","PI","cos","sin","x","y","Planet","Moon","prototype","call","planetName","isMoon","Orbit","pos","radius","offset","Vector3","Color","random","segments","curve","EllipseCurve","Path","getPoints","geometry","createPointsGeometry","LineBasicMaterial","transparent","opacity","Line","ConnectingLine","startPoint","endPoint","Geometry","vertices","push","verticesNeedUpdate","inherit","dest","src","noParent","Object","getOwnPropertyNames","forEach","hasOwnProperty","desc","getOwnPropertyDescriptor","defineProperty","__proto__","findType","meta","type","implType","implMeta","proto","base","implements","classProto","Array","isArray","implementedType","extend","theClass","apply","arguments","value","enumerable","configurable","writable","statics","object","Checker","typeOf","typeInfo","a","an","is","VERSION","module","exports","scope","pitchObject","Object3D","yawObject","moveForward","moveBackward","moveLeft","moveRight","isOnObject","canJump","prevTime","performance","now","velocity","PI_2","onMouseMove","movementX","mozMovementX","webkitMovementX","movementY","mozMovementY","webkitMovementY","max","min","boolean","getDirection","direction","Euler","v","applyEuler","time","delta","translateX","translateY","translateZ","Entity","Messanger","ObjectPool","QuadTree","Spatial","Vec2","SUPPORT_TRANSFERABLE","Eventable","getObjectId","getEulerXYZFromQuaternion","getQuatertionFromEuler","convertWorldPositionToObject","addObjectChildren","_temp1","_temp2","_is_simulating","_Physijs","_temp_vector3_1","_temp_vector3_2","_temp_matrix4_1","Matrix4","_quaternion_1","Quaternion","MESSAGE_TYPES","WORLDREPORT","COLLISIONREPORT","VEHICLEREPORT","CONSTRAINTREPORT","REPORT_ITEMSIZE","COLLISIONREPORT_ITEMSIZE","VEHICLEREPORT_ITEMSIZE","CONSTRAINTREPORT_ITEMSIZE","_eventListeners","event_name","index","indexOf","splice","dispatchEvent","parameters","make","obj","_id","w","atan2","asin","c1","s1","c2","s2","c3","s3","c1c2","s1s2","identity","makeRotationFromQuaternion","quaternion","getInverse","applyMatrix4","noConflict","createMaterial","friction","restitution","physijs_material","_physijs","id","PointConstraint","objecta","objectb","appliedImpulse","positiona","positionb","getDefinition","HingeConstraint","axis","setLimits","low","high","bias_factor","relaxation_factor","execute","constraint","enableAngularMotor","acceleration","disableMotor","SliderConstraint","lin_lower","lin_upper","ang_lower","ang_upper","setRestitution","linear","angular","enableLinearMotor","disableLinearMotor","disableAngularMotor","ConeTwistConstraint","axisa","axisb","setLimit","enableMotor","setMaxMotorImpulse","max_impulse","setMotorTarget","target","setFromEuler","setFromRotationMatrix","DOFConstraint","setLinearLowerLimit","limit","setLinearUpperLimit","setAngularLowerLimit","setAngularUpperLimit","configureAngularMotor","low_angle","high_angle","max_force","params","self","_worker","Worker","transferableMessage","webkitPostMessage","postMessage","_materials_ref_counts","_objects","_vehicles","_constraints","ab","ArrayBuffer","byteLength","onmessage","_temp","data","Float32Array","_updateScene","_updateCollisions","_updateVehicles","_updateConstraints","cmd","console","debug","dir","fixedTimeStep","rateLimit","num_objects","__dirtyPosition","__dirtyRotation","linearVelocity","angularVelocity","buffer","vehicle","wheel","wheels","extractRotation","matrix","addVectors","j","object2","id1","id2","collisions","normal_offsets","touches","subVectors","getLinearVelocity","getAngularVelocity","normal_offset","addConstraint","show_marker","marker","MeshNormalMaterial","onSimulationResume","removeConstraint","updateMatrix","updateMatrixWorld","setFromMatrixPosition","matrixWorld","position_offset","world","Vehicle","materialId","width","scale","height","depth","remove","pop","setFixedTimeStep","setGravity","gravity","timeStep","maxSubSteps","object_id","quat","mass","boundingBox","computeBoundingBox","__defineGetter__","__defineSetter__","applyCentralImpulse","force","applyImpulse","impulse_x","impulse_y","impulse_z","applyTorque","torque_x","torque_y","torque_z","applyCentralForce","applyForce","force_x","force_y","force_z","setAngularVelocity","setLinearVelocity","setAngularFactor","factor","setLinearFactor","setDamping","setCcdMotionThreshold","threshold","setCcdSweptSphereRadius","PlaneMesh","normal","faces","HeightfieldMesh","xdiv","ydiv","xsize","ysize","xpts","sqrt","ypts","absMaxHeight","abs","b","points","round","BoxMesh","SphereMesh","boundingSphere","computeBoundingSphere","pow","CylinderMesh","CapsuleMesh","ConeMesh","ConcaveMesh","face","triangles","Face3","Face4","d","ConvexMesh","tuning","VehicleTuning","rigidBody","suspension_stiffness","suspension_compression","suspension_damping","max_suspension_travel","friction_slip","max_suspension_force","addWheel","wheel_geometry","wheel_material","connection_point","wheel_direction","wheel_axle","suspension_rest_length","wheel_radius","is_front_wheel","castShadow","receiveShadow","multiplyScalar","setSteering","amount","steering","setBrake","brake","applyEngineForce","startTime","Date","ms","msMin","Infinity","msMax","fps","fpsMin","fpsMax","frames","mode","createElement","preventDefault","cssText","fpsDiv","fpsText","fpsGraph","bar","msDiv","msText","msGraph","updateGraph","dom","firstChild","REVISION","begin","end","textContent","sign","log","warn","error","MOUSE","LEFT","MIDDLE","RIGHT","CullFaceNone","CullFaceBack","CullFaceFront","CullFaceFrontBack","FrontFaceDirectionCW","FrontFaceDirectionCCW","BasicShadowMap","PCFShadowMap","PCFSoftShadowMap","FrontSide","BackSide","DoubleSide","NoShading","FlatShading","SmoothShading","NoColors","FaceColors","VertexColors","NoBlending","NormalBlending","AdditiveBlending","SubtractiveBlending","MultiplyBlending","CustomBlending","AddEquation","SubtractEquation","ReverseSubtractEquation","MinEquation","MaxEquation","ZeroFactor","OneFactor","SrcColorFactor","OneMinusSrcColorFactor","SrcAlphaFactor","OneMinusSrcAlphaFactor","DstAlphaFactor","OneMinusDstAlphaFactor","DstColorFactor","OneMinusDstColorFactor","SrcAlphaSaturateFactor","MultiplyOperation","MixOperation","AddOperation","UVMapping","CubeReflectionMapping","CubeRefractionMapping","EquirectangularReflectionMapping","EquirectangularRefractionMapping","SphericalReflectionMapping","ClampToEdgeWrapping","MirroredRepeatWrapping","NearestFilter","NearestMipMapNearestFilter","NearestMipMapLinearFilter","LinearFilter","LinearMipMapNearestFilter","LinearMipMapLinearFilter","UnsignedByteType","ByteType","ShortType","UnsignedShortType","IntType","UnsignedIntType","FloatType","HalfFloatType","UnsignedShort4444Type","UnsignedShort5551Type","UnsignedShort565Type","AlphaFormat","RGBFormat","RGBAFormat","LuminanceFormat","LuminanceAlphaFormat","RGBEFormat","RGB_S3TC_DXT1_Format","RGBA_S3TC_DXT1_Format","RGBA_S3TC_DXT3_Format","RGBA_S3TC_DXT5_Format","RGB_PVRTC_4BPPV1_Format","RGB_PVRTC_2BPPV1_Format","RGBA_PVRTC_4BPPV1_Format","RGBA_PVRTC_2BPPV1_Format","Projector","projectVector","vector","project","unprojectVector","unproject","pickingRay","CanvasRenderer","clear","setClearColor","setRGB","r","g","setHex","setStyle","hex","floor","setHSL","h","s","l","hue2rgb","p","q","t","exec","parseInt","ColorKeywords","copyGammaToLinear","gammaFactor","copyLinearToGamma","safeInverse","convertGammaToLinear","convertLinearToGamma","getHex","getHexString","toString","slice","getHSL","optionalTarget","hue","saturation","hsl","lightness","getStyle","offsetHSL","addColors","color1","color2","addScalar","multiply","lerp","alpha","equals","fromArray","array","toArray","aliceblue","antiquewhite","aqua","aquamarine","azure","beige","bisque","black","blanchedalmond","blue","blueviolet","brown","burlywood","cadetblue","chartreuse","chocolate","coral","cornflowerblue","cornsilk","crimson","cyan","darkblue","darkcyan","darkgoldenrod","darkgray","darkgreen","darkgrey","darkkhaki","darkmagenta","darkolivegreen","darkorange","darkorchid","darkred","darksalmon","darkseagreen","darkslateblue","darkslategray","darkslategrey","darkturquoise","darkviolet","deeppink","deepskyblue","dimgray","dimgrey","dodgerblue","firebrick","floralwhite","forestgreen","fuchsia","gainsboro","ghostwhite","gold","goldenrod","gray","green","greenyellow","grey","honeydew","hotpink","indianred","indigo","ivory","khaki","lavender","lavenderblush","lawngreen","lemonchiffon","lightblue","lightcoral","lightcyan","lightgoldenrodyellow","lightgray","lightgreen","lightgrey","lightpink","lightsalmon","lightseagreen","lightskyblue","lightslategray","lightslategrey","lightsteelblue","lightyellow","lime","limegreen","linen","magenta","maroon","mediumaquamarine","mediumblue","mediumorchid","mediumpurple","mediumseagreen","mediumslateblue","mediumspringgreen","mediumturquoise","mediumvioletred","midnightblue","mintcream","mistyrose","moccasin","navajowhite","navy","oldlace","olive","olivedrab","orange","orangered","orchid","palegoldenrod","palegreen","paleturquoise","palevioletred","papayawhip","peachpuff","peru","pink","plum","powderblue","purple","red","rosybrown","royalblue","saddlebrown","salmon","sandybrown","seagreen","seashell","sienna","silver","skyblue","slateblue","slategray","slategrey","snow","springgreen","steelblue","tan","teal","thistle","tomato","turquoise","violet","wheat","white","whitesmoke","yellow","yellowgreen","_x","_y","_z","_w",{"end":{"file":"?","comments_before":[],"nlb":false,"endpos":16150,"endcol":6,"endline":683,"pos":16149,"col":5,"line":683,"value":"x","type":"name"},"start":{"file":"?","comments_before":[],"nlb":false,"endpos":16150,"endcol":6,"endline":683,"pos":16149,"col":5,"line":683,"value":"x","type":"name"},"name":"x"},"onChangeCallback","euler","Error","order","setFromAxisAngle","halfAngle","te","elements","m11","m12","m13","m21","m22","m23","m31","m32","m33","trace","setFromUnitVectors","v1","EPS","vFrom","vTo","dot","crossVectors","normalize","inverse","conjugate","lengthSq","multiplyQuaternions","qax","qay","qaz","qaw","qbx","qby","qbz","qbw","multiplyVector3","applyQuaternion","slerp","qb","cosHalfTheta","halfTheta","acos","sinHalfTheta","ratioA","ratioB","onChange","qa","qm","Vector2","setX","setY","setComponent","getComponent","subScalar","divide","divideScalar","scalar","invScalar","clamp","clampScalar","minVal","maxVal","ceil","roundToZero","negate","distanceTo","distanceToSquared","dx","dy","setLength","oldLength","lerpVectors","v2","fromAttribute","attribute","itemSize","setZ","multiplyVectors","applyAxisAngle","applyMatrix3","applyProjection","qx","qy","qz","qw","ix","iy","iz","iw","multiplyMatrices","projectionMatrix","transformDirection","lengthManhattan","cross","ax","ay","az","bx","by","bz","projectOnVector","projectOnPlane","planeNormal","reflect","angleTo","theta","dz","setEulerFromRotationMatrix","setEulerFromQuaternion","getPositionFromMatrix","getScaleFromMatrix","setFromMatrixScale","getColumnFromMatrix","setFromMatrixColumn","sx","sy","sz","me","Vector4","setW","setAxisAngleFromQuaternion","setAxisAngleFromRotationMatrix","epsilon","epsilon2","xx","yy","zz","xy","xz","yz","_order","DefaultOrder","RotationOrders","setFromQuaternion","setFromVector3","reorder","newOrder","toVector3","optionalResult","Line3","start","line","result","distanceSq","distance","at","closestPointToPointParameter","startP","startEnd","point","clampToLine","startEnd2","startEnd_startP","closestPointToPoint","Box2","setFromPoints","makeEmpty","il","expandByPoint","setFromCenterAndSize","halfSize","box","empty","expandByVector","expandByScalar","containsPoint","containsBox","getParameter","isIntersectionBox","clampPoint","distanceToPoint","clampedPoint","intersect","union","translate","Box3","setFromObject","traverse","node","BufferGeometry","attributes","positions","getBoundingSphere","Sphere","Matrix3","n11","n12","n13","n21","n22","n23","n31","n32","n33","multiplyVector3Array","applyToVector3Array","determinant","f","throwOnInvertible","det","msg","transpose","tmp","flattenToArrayOffset","getNormalMatrix","transposeIntoArray","n14","n24","n34","n41","n42","n43","n44","extractPosition","copyPosition","extractBasis","xAxis","yAxis","zAxis","makeBasis","scaleX","scaleY","scaleZ","makeRotationFromEuler","ae","af","be","bf","ce","cf","de","df","ac","ad","bc","bd","setRotationFromQuaternion","x2","y2","z2","wx","wy","wz","lookAt","eye","up","n","a11","a12","a13","a14","a21","a22","a23","a24","a31","a32","a33","a34","a41","a42","a43","a44","b11","b12","b13","b14","b21","b22","b23","b24","b31","b32","b33","b34","b41","b42","b43","b44","multiplyToArray","multiplyVector4","rotateAxis","crossVector","getPosition","setPosition","rotateX","rotateY","rotateZ","rotateByAxis","getMaxScaleOnAxis","scaleXSq","scaleYSq","scaleZSq","makeTranslation","makeRotationX","makeRotationY","makeRotationZ","makeRotationAxis","tx","ty","makeScale","compose","decompose","invSX","invSY","invSZ","makeFrustum","right","bottom","near","far","makePerspective","fov","ymax","degToRad","ymin","xmin","xmax","makeOrthographic","Ray","origin","ray","recast","directionDistance","distanceSqToSegment","segCenter","segDir","diff","v0","optionalPointOnRay","optionalPointOnSegment","s0","sqrDist","extDet","segExtent","a01","b0","b1","invDet","isIntersectionSphere","sphere","intersectSphere","tca","d2","radius2","thc","t0","t1","isIntersectionPlane","plane","distToPoint","denominator","distanceToPlane","constant","intersectPlane","intersectBox","tmin","tmax","tymin","tymax","tzmin","tzmax","invdirx","invdiry","invdirz","intersectTriangle","edge1","edge2","backfaceCulling","DdN","DdQxE2","DdE1xQ","QdN","matrix4","optionalCenter","maxRadiusSq","intersectsSphere","radiusSum","deltaLengthSq","getBoundingBox","Frustum","p0","p1","p2","p3","p4","p5","planes","Plane","frustum","setFromMatrix","me0","me1","me2","me3","me4","me5","me6","me7","me8","me9","me10","me11","me12","me13","me14","me15","setComponents","intersectsObject","negRadius","intersectsBox","d1","setFromNormalAndCoplanarPoint","setFromCoplanarPoints","inverseNormalLength","distanceToSphere","projectPoint","orthoPoint","perpendicularMagnitude","isIntersectionLine","startSign","endSign","intersectLine","coplanarPoint","m1","optionalNormalMatrix","normalMatrix","newNormal","newCoplanarPoint","generateUUID","chars","split","uuid","rnd","join","clampBottom","mapLinear","a1","a2","b2","smoothstep","smootherstep","random16","randInt","randFloat","randFloatSpread","range","degreeToRadiansFactor","degrees","radToDeg","radianToDegreesFactor","isPowerOfTwo","nextPowerOfTwo","Spline","interpolate","t2","t3","intPoint","weight","w2","w3","pa","pb","pc","pd","v3","initFromArray","getPoint","k","getControlPointsArray","coords","getLength","nSubDivisions","nSamples","oldIntPoint","tmpVec","chunkLengths","totalLength","chunks","total","reparametrizeByArcLength","samplingCoef","indexCurrent","indexNext","realDistance","sampling","newpoints","sl","Triangle","resultLengthSq","barycoordFromPoint","dot00","dot01","dot02","dot11","dot12","denom","invDenom","u","setFromPointsAndIndices","i0","i1","i2","triangle","area","midpoint","autoStart","oldTime","elapsedTime","running","stop","getElapsedTime","newTime","EventDispatcher","hasEventListener","listener","_listeners","listeners","listenerArray","Raycaster","Sprite","PointCloud","LOD","descSort","intersectObject","raycaster","intersects","recursive","raycast","precision","linePrecision","setFromCamera","OrthographicCamera","sort","intersectObjects","objects","Object3DIdCount","DefaultUp","onRotationChange","onQuaternionChange","defineProperties","rotationAutoUpdate","matrixAutoUpdate","matrixWorldNeedsUpdate","visible","frustumCulled","renderOrder","userData","eulerOrder","useQuaternion","applyMatrix","setRotationFromAxisAngle","setRotationFromEuler","setRotationFromMatrix","rotateOnAxis","q1","translateOnAxis","localToWorld","worldToLocal","getChildByName","getObjectByName","getObjectById","getObjectByProperty","getWorldPosition","getWorldQuaternion","getWorldRotation","getWorldScale","getWorldDirection","traverseVisible","traverseAncestors","toJSON","output","metadata","version","generator","geometries","parseGeometry","json","materials","parseMaterial","parseObject","JSON","stringify","AmbientLight","DirectionalLight","intensity","PointLight","decay","SpotLight","exponent","HemisphereLight","groundColor","parse","materialIndex","vertexNormals","vertexColors","vertexTangents","BufferAttribute","needsUpdate","copyAt","index1","index2","setXY","setXYZ","setXYZW","Int8Attribute","Uint8Attribute","Uint8ClampedAttribute","Int16Attribute","Uint16Attribute","Int32Attribute","Uint32Attribute","Float32Attribute","Float64Attribute","DynamicBufferAttribute","updateRange","count","create","GeometryIdCount","attributesKeys","drawcalls","offsets","addAttribute","keys","getAttribute","addDrawCall","indexOffset","fromGeometry","settings","faceVertexUvs","hasFaceVertexUv","hasFaceVertexNormals","normals","colors","uvs","i3","na","nb","nc","fc","vca","vcb","vcc","uva","uvb","uvc","bb","isNaN","computeFaceNormals","computeVertexNormals","vA","vB","vC","pA","pB","pC","cb","indices","jl","normalizeNormals","computeTangents","handleTriangle","uvA","uvB","uvC","x1","y1","z1","sdir","tdir","tan1","tan2","handleVertex","n2","tmp2","tangents","uv","nVertices","tangent","iA","iB","iC","computeOffsets","facesCount","sortedIndices","Uint16Array","indexPtr","vertexPtr","duplicatedVertices","newVerticeMaps","faceVertices","Int32Array","vertexMap","revVertexMap","findex","vo","vid","faceMax","new_offset","new_vid","reorderBuffers","merge","key","attribute1","attributeArray1","attribute2","attributeArray2","attributeSize","indexBuffer","indexMap","vertexCount","sortedAttributes","attr","sourceArray","attrArray","attrSize","sortedAttr","numItems","sourceAttr","dispose","morphTargets","morphColors","morphNormals","skinWeights","skinIndices","lineDistances","hasTangents","dynamic","elementsNeedUpdate","uvsNeedUpdate","normalsNeedUpdate","tangentsNeedUpdate","colorsNeedUpdate","lineDistancesNeedUpdate","groupsNeedUpdate","vertex","fromBufferGeometry","tempNormals","tempUVs","addFace","drawcall","fl","areaWeighted","vl","computeMorphNormals","__originalFaceNormal","__originalVertexNormals","tmpGeo","faceNormals","faceNormal","dstNormalsFace","dstNormalsVertex","context","ua","ub","uc","vertexIndex","faceIndex","computeLineDistances","materialIndexOffset","vertexOffset","vertices1","vertices2","faces1","faces2","uvs1","uvs2","vertexCopy","faceCopy","faceVertexNormals","faceVertexColors","uvCopy","mergeMesh","mergeVertices","verticesMap","unique","changes","precisionPoints","faceIndicesToRemove","dupIndex","idx","setBit","getNormalIndex","hash","normalsHash","getColorIndex","colorsHash","getUvIndex","uvsHash","hasMaterial","hasFaceUv","hasFaceNormal","hasFaceVertexNormal","hasFaceColor","hasFaceVertexColor","faceType","uvsCopy","kl","Camera","matrixWorldInverse","CubeCamera","cubeResolution","cameraPX","cameraNX","cameraPY","cameraNY","cameraPZ","cameraNZ","renderTarget","WebGLRenderTargetCube","format","magFilter","minFilter","updateCubeMap","generateMipmaps","activeCubeFace","zoom","cx","cy","setLens","focalLength","frameHeight","atan","setViewOffset","fullWidth","fullHeight","Light","light","AreaLight","constantAttenuation","linearAttenuation","quadraticAttenuation","onlyShadow","shadowCameraNear","shadowCameraFar","shadowCameraLeft","shadowCameraRight","shadowCameraTop","shadowCameraBottom","shadowCameraVisible","shadowBias","shadowDarkness","shadowMapWidth","shadowMapHeight","shadowCascade","shadowCascadeOffset","shadowCascadeCount","shadowCascadeBias","shadowCascadeWidth","shadowCascadeHeight","shadowCascadeNearZ","shadowCascadeFarZ","shadowCascadeArray","shadowMap","shadowMapSize","shadowCamera","shadowMatrix","skyColor","shadowCameraFov","Cache","files","file","get","Loader","showStatus","statusDomElement","addStatusElement","imageLoader","ImageLoader","onLoadStart","onLoadProgress","onLoadComplete","crossOrigin","fontSize","textAlign","background","padding","zIndex","updateProgress","progress","message","loaded","toFixed","extractUrlBase","url","parts","initMaterials","texturePath","needsTangents","ShaderMaterial","nearest_pow2","LN2","create_texture","where","sourceFile","repeat","wrap","anisotropy","fullPath","loader","Handlers","load","Texture","image","canvas","getContext","drawImage","wrapMap","mirror","rgb2hex","rgb","mtype","mpars","lightMap","normalMap","bumpMap","wireframe","shading","toLowerCase","blending","depthTest","depthWrite","flipSided","side","doubleSided","colorDiffuse","DbgColor","colorSpecular","specular","colorEmissive","emissive","transparency","specularCoef","shininess","mapDiffuse","mapDiffuseRepeat","mapDiffuseOffset","mapDiffuseWrap","mapDiffuseAnisotropy","mapLight","mapLightRepeat","mapLightOffset","mapLightWrap","mapLightAnisotropy","mapBump","mapBumpRepeat","mapBumpOffset","mapBumpWrap","mapBumpAnisotropy","mapNormal","mapNormalRepeat","mapNormalOffset","mapNormalWrap","mapNormalAnisotropy","mapSpecular","mapSpecularRepeat","mapSpecularOffset","mapSpecularWrap","mapSpecularAnisotropy","mapAlpha","mapAlphaRepeat","mapAlphaOffset","mapAlphaWrap","mapAlphaAnisotropy","mapBumpScale","bumpScale","mapNormalFactor","normalScale","DbgName","handlers","regex","XHRLoader","manager","DefaultLoadingManager","onLoad","onProgress","onError","cached","request","XMLHttpRequest","open","response","itemEnd","responseType","send","itemStart","setResponseType","setCrossOrigin","JSONLoader","withCredentials","loadAjaxJSON","callbackProgress","xhr","onreadystatechange","readyState","DONE","status","responseText","LOADING","getResponseHeader","HEADERS_RECEIVED","parseModel","isBitSet","fi","zLength","colorIndex","normalIndex","uvIndex","isQuad","faceA","faceB","uvLayer","nUvLayers","parseSkin","influencesPerVertex","bones","animation","animations","parseMorphing","dstVertices","srcVertices","cl","dstColors","srcColors","LoadingManager","BufferGeometryLoader","text","typedArray","MaterialLoader","uniforms","vertexShader","fragmentShader","sizeAttenuation","ObjectLoader","substring","lastIndexOf","setTexturePath","parseGeometries","images","parseImages","parseTextures","parseMaterials","geometryLoader","bufferGeometryLoader","widthSegments","heightSegments","depthSegments","CircleGeometry","CylinderGeometry","radiusTop","radiusBottom","radialSegments","openEnded","phiStart","phiLength","thetaStart","thetaLength","IcosahedronGeometry","detail","TorusGeometry","tube","tubularSegments","arc","TorusKnotGeometry","heightScale","alphaMap","envMap","specularMap","loadImage","getGeometry","getMaterial","Group","TextureLoader","DataTextureLoader","BinaryTextureLoader","_parser","DataTexture","texData","mipmaps","mipmapCount","CompressedTextureLoader","CompressedTexture","texDatas","isCubemap","Material","MaterialIdCount","blendSrc","blendDst","blendEquation","blendSrcAlpha","blendDstAlpha","blendEquationAlpha","colorWrite","polygonOffset","polygonOffsetFactor","polygonOffsetUnits","alphaTest","overdraw","_needsUpdate","setValues","values","newValue","currentValue","Number","MeshPhongMaterial","MeshDepthMaterial","PointCloudMaterial","SpriteMaterial","linewidth","linecap","linejoin","fog","LineDashedMaterial","dashSize","gapSize","combine","reflectivity","refractionRatio","wireframeLinewidth","wireframeLinecap","wireframeLinejoin","skinning","wrapRGB","metal","MeshFaceMaterial","ParticleBasicMaterial","ParticleSystemMaterial","defines","lights","defaultAttributeValues","uv2","index0AttributeName","UniformsUtils","RawShaderMaterial","mapping","TextureIdCount","DEFAULT_IMAGE","DEFAULT_MAPPING","premultiplyAlpha","flipY","unpackAlignment","onUpdate","CubeTexture","VideoTexture","video","HAVE_ENOUGH_DATA","inverseMatrix","localThreshold","testPoint","rayPointDistance","intersectPoint","distanceToRay","oi","ol","pointCount","ParticleSystem","LineStrip","LinePieces","precisionSq","vStart","vEnd","interSegment","interRay","step","distSq","offsetIndex","nbVertices","updateMorphTargets","morphTargetBase","morphTargetForcedOrder","morphTargetInfluences","morphTargetDictionary","ml","getMorphTargetIndexByName","intersectionPoint","isFaceMaterial","objectMaterials","morphInfluences","tl","influence","targets","Bone","skin","Skeleton","boneInverses","useVertexTexture","identityMatrix","boneTextureWidth","boneTextureHeight","boneMatrices","boneTexture","calculateInverses","bl","pose","bone","offsetMatrix","SkinnedMesh","bindMode","bindMatrix","bindMatrixInverse","gbone","rotq","scl","normalizeSkinWeights","bind","skeleton","sw","MorphAnimMesh","duration","mirroredLoop","lastKeyframe","currentKeyframe","directionBackwards","setFrameRange","startKeyframe","endKeyframe","setDirectionForward","setDirectionBackward","parseAnimations","firstAnimation","pattern","morph","match","label","setAnimationLabel","playAnimation","updateAnimation","frameTime","keyframe","mix","interpolateTargets","influences","addLevel","getObjectForDistance","matrixPosition","Particle","LensFlare","lensFlares","positionScreen","customUpdateCallback","updateLensFlares","flare","vecX","vecY","wantedRotation","overrideMaterial","autoUpdate","Fog","FogExp2","density","ShaderChunk","merged","uniforms_src","uniforms_dst","parameter_src","UniformsLib","common","diffuse","offsetRepeat","flipEnvMap","bump","normalmap","fogDensity","fogNear","fogFar","fogColor","ambientLightColor","directionalLightDirection","directionalLightColor","hemisphereLightDirection","hemisphereLightSkyColor","hemisphereLightGroundColor","pointLightColor","pointLightPosition","pointLightDistance","pointLightDecay","spotLightColor","spotLightPosition","spotLightDirection","spotLightDistance","spotLightAngleCos","spotLightExponent","spotLightDecay","particle","psColor","shadowmap","ShaderLib","basic","lambert","phong","particle_basic","dashed","totalSize","mNear","mFar","cube","tCube","tFlip","equirect","tEquirect","depthRGBA","createParticleBuffers","__webglVertexBuffer","_gl","createBuffer","__webglColorBuffer","_this","info","memory","createLineBuffers","__webglLineDistanceBuffer","createMeshBuffers","geometryGroup","__webglNormalBuffer","__webglTangentBuffer","__webglUVBuffer","__webglUV2Buffer","__webglSkinIndicesBuffer","__webglSkinWeightsBuffer","__webglFaceBuffer","__webglLineBuffer","numMorphTargets","__webglMorphTargetsBuffers","numMorphNormals","__webglMorphNormalsBuffers","initCustomAttributes","nvertices","__webglCustomAttributesList","__webglInitialized","createUniqueBuffers","belongsToAttribute","initParticleBuffers","__vertexArray","__colorArray","__webglParticleCount","initLineBuffers","__lineDistanceArray","__webglLineCount","initMeshBuffers","faces3","ntris","nlines","getBufferMaterial","__normalArray","__uvArray","__uv2Array","__tangentArray","__skinIndexArray","__skinWeightArray","UintArray","extensions","Uint32Array","__typeArray","__faceArray","__lineArray","__morphTargetsArrays","__morphNormalsArrays","__webglFaceCount","originalAttribute","property","__original","__inittedArrays","materialNeedsFaceNormals","setParticleBuffers","hint","ca","cal","customAttribute","vertexArray","colorArray","dirtyVertices","dirtyColors","customAttributes","bindBuffer","ARRAY_BUFFER","bufferData","boundTo","setLineBuffers","dl","lineDistanceArray","dirtyLineDistances","setMeshBuffers","faceColor","n1","n3","sw1","sw2","sw3","si1","si2","si3","vn","uvi","uv2i","vk","vkl","vka","nka","chf","needsFaceNormals","offset_uv","offset_uv2","offset_face","offset_normal","offset_tangent","offset_line","offset_color","offset_skin","offset_morphTarget","offset_custom","uvArray","uv2Array","normalArray","tangentArray","skinIndexArray","skinWeightArray","morphTargetsArrays","morphNormalsArrays","faceArray","lineArray","dirtyElements","dirtyUvs","dirtyNormals","dirtyTangents","dirtyMorphTargets","morphTargetsNeedUpdate","chunk_faces3","obj_faces","obj_uvs","obj_uvs2","obj_skinIndices","obj_skinWeights","ELEMENT_ARRAY_BUFFER","pp","setupVertexAttributes","program","startIndex","geometryAttributes","programAttributes","programAttributesKeys","programAttribute","geometryAttribute","state","enableAttribute","vertexAttribPointer","FLOAT","vertexAttrib2fv","vertexAttrib3fv","disableUnusedAttributes","setupMorphTargets","numSupportedMorphTargets","__webglMorphTargetInfluences","activeInfluenceIndices","numericalSort","numSupportedMorphNormals","influenceIndex","uniform1fv","painterSortStable","reversePainterSortStable","projectObject","initObject","sprites","webglObjects","_webglObjects","_frustum","webglObject","unrollBufferMaterial","sortObjects","_vector3","_projScreenMatrix","renderObjects","renderList","setupMatrices","setMaterial","setMaterialFaces","renderBufferDirect","renderBuffer","renderObjectsImmediate","materialType","renderImmediateObject","unrollImmediateBufferMaterial","globject","opaque","transparentObjects","opaqueObjects","__webglInit","_modelViewMatrix","_normalMatrix","onObjectRemoved","onGeometryDispose","initGeometryGroups","__webglActive","addBuffer","geometryGroupsList","geometryGroups","ImmediateRenderObject","immediateRenderCallback","addBufferImmediate","_webglObjectsImmediate","makeGroups","usesFaceMaterial","groupHash","group","maxVerticesInGroup","hash_map","groups","groupsList","counter","geometryGroupCounter","addBuffers","objlist","updateObject","bufferType","DYNAMIC_DRAW","STATIC_DRAW","bufferSubData","BYTES_PER_ELEMENT","subarray","customAttributesDirty","areCustomAttributesDirty","clearCustomAttributes","removeObject","removeInstances","o","initMaterial","onMaterialDispose","shaderID","shaderIDs","shader","__webglShader","maxLightCount","allocateLights","maxShadows","allocateShadows","maxBones","allocateBones","_precision","supportsVertexTextures","_supportsVertexTextures","envMapMode","useFog","fogExp","flatShading","logarithmicDepthBuffer","_logarithmicDepthBuffer","_supportsBoneTextures","maxMorphTargets","maxMorphNormals","maxDirLights","directional","maxPointLights","maxSpotLights","spot","maxHemiLights","hemi","shadowMapEnabled","shadowMapType","shadowMapDebug","shadowMapCascade","code","pl","_programs","programInfo","usedTimes","WebGLProgram","programs","uniformsList","location","setBlending","setDepthTest","setDepthWrite","setColorWrite","setPolygonOffset","setProgram","_usedTextureUnits","deallocateMaterial","refreshProgram","refreshMaterial","refreshLights","p_uniforms","m_uniforms","_currentProgram","useProgram","_currentMaterialId","_currentCamera","uniformMatrix4fv","uniform1f","logDepthBufFC","cameraPosition","uniform3f","viewMatrix","textureUnit","getTextureUnit","uniform1i","setTexture","boneGlobalMatrices","refreshUniformsFog","_lightsNeedUpdate","setupLights","refreshUniformsLights","_lights","markUniformsLightsNeedsUpdate","refreshUniformsCommon","refreshUniformsLine","refreshUniformsDash","refreshUniformsParticle","refreshUniformsPhong","refreshUniformsLambert","_shadowPass","refreshUniformsShadow","loadUniformsGeneric","loadUniformsMatrices","modelMatrix","uvScaleMap","_canvas","ambient","distances","decays","directions","anglesCos","exponents","skyColors","groundColors","modelViewMatrix","uniformMatrix3fv","_maxTextures","uniform","uniform2f","uniform4f","uniform1iv","uniform3iv","uniform2fv","uniform3fv","uniform4fv","_array","setCubeTexture","setCubeTextureDynamic","setColorLinear","ll","zlights","dirColors","dirPositions","pointColors","pointPositions","pointDistances","pointDecays","spotColors","spotPositions","spotDistances","spotDirections","spotAnglesCos","spotExponents","spotDecays","hemiSkyColors","hemiGroundColors","hemiPositions","dirLength","pointLength","spotLength","hemiLength","dirCount","spotCount","hemiCount","dirOffset","pointOffset","spotOffset","hemiOffset","_direction","setTextureParameters","textureType","isImagePowerOfTwo","extension","texParameteri","TEXTURE_WRAP_S","paramThreeToGL","TEXTURE_WRAP_T","TEXTURE_MAG_FILTER","TEXTURE_MIN_FILTER","CLAMP_TO_EDGE","filterFallback","__currentAnisotropy","texParameterf","TEXTURE_MAX_ANISOTROPY_EXT","getMaxAnisotropy","clampToMaxSize","maxSize","slot","__webglTextureCube","onTextureDispose","createTexture","activeTexture","TEXTURE0","bindTexture","TEXTURE_CUBE_MAP","pixelStorei","UNPACK_FLIP_Y_WEBGL","isCompressed","isDataTexture","cubeImage","autoScaleCubemaps","_maxCubemapSize","glFormat","glType","mipmap","getCompressedTextureFormats","compressedTexImage2D","TEXTURE_CUBE_MAP_POSITIVE_X","texImage2D","generateMipmap","__webglTexture","setupFrameBuffer","framebuffer","textureTarget","bindFramebuffer","FRAMEBUFFER","framebufferTexture2D","COLOR_ATTACHMENT0","setupRenderBuffer","renderbuffer","bindRenderbuffer","RENDERBUFFER","depthBuffer","stencilBuffer","renderbufferStorage","DEPTH_COMPONENT16","framebufferRenderbuffer","DEPTH_ATTACHMENT","DEPTH_STENCIL","DEPTH_STENCIL_ATTACHMENT","RGBA4","updateRenderTargetMipmap","TEXTURE_2D","NEAREST","LINEAR","REPEAT","MIRRORED_REPEAT","NEAREST_MIPMAP_NEAREST","NEAREST_MIPMAP_LINEAR","LINEAR_MIPMAP_NEAREST","LINEAR_MIPMAP_LINEAR","UNSIGNED_BYTE","UNSIGNED_SHORT_4_4_4_4","UNSIGNED_SHORT_5_5_5_1","UNSIGNED_SHORT_5_6_5","BYTE","SHORT","UNSIGNED_SHORT","INT","UNSIGNED_INT","HALF_FLOAT_OES","ALPHA","RGB","RGBA","LUMINANCE","LUMINANCE_ALPHA","FUNC_ADD","FUNC_SUBTRACT","FUNC_REVERSE_SUBTRACT","ZERO","ONE","SRC_COLOR","ONE_MINUS_SRC_COLOR","SRC_ALPHA","ONE_MINUS_SRC_ALPHA","DST_ALPHA","ONE_MINUS_DST_ALPHA","DST_COLOR","ONE_MINUS_DST_COLOR","SRC_ALPHA_SATURATE","COMPRESSED_RGB_S3TC_DXT1_EXT","COMPRESSED_RGBA_S3TC_DXT1_EXT","COMPRESSED_RGBA_S3TC_DXT3_EXT","COMPRESSED_RGBA_S3TC_DXT5_EXT","COMPRESSED_RGB_PVRTC_4BPPV1_IMG","COMPRESSED_RGB_PVRTC_2BPPV1_IMG","COMPRESSED_RGBA_PVRTC_4BPPV1_IMG","COMPRESSED_RGBA_PVRTC_2BPPV1_IMG","MIN_EXT","MAX_EXT","nVertexUniforms","MAX_VERTEX_UNIFORM_VECTORS","nVertexMatrices","dirLights","pointLights","spotLights","hemiLights","_context","pixelRatio","_alpha","_depth","_stencil","stencil","_antialias","_premultipliedAlpha","premultipliedAlpha","_preserveDrawingBuffer","preserveDrawingBuffer","_clearColor","_clearAlpha","autoClear","autoClearColor","autoClearDepth","autoClearStencil","gammaInput","gammaOutput","shadowMapCullFace","calls","_currentFramebuffer","_currentGeometryProgram","_viewportX","_viewportY","_viewportWidth","_viewportHeight","_currentWidth","_currentHeight","resetGLState","setDefaultGLState","WebGLState","getShaderPrecisionFormat","rangeMin","rangeMax","WebGLExtensions","glClearColor","clearColor","clearDepth","clearStencil","enable","DEPTH_TEST","depthFunc","LEQUAL","frontFace","CCW","cullFace","BACK","CULL_FACE","BLEND","blendFunc","viewport","reset","MAX_TEXTURE_IMAGE_UNITS","_maxVertexTextures","MAX_VERTEX_TEXTURE_IMAGE_UNITS","_maxTextureSize","MAX_TEXTURE_SIZE","MAX_CUBE_MAP_TEXTURE_SIZE","_vertexShaderPrecisionHighpFloat","VERTEX_SHADER","HIGH_FLOAT","_vertexShaderPrecisionMediumpFloat","MEDIUM_FLOAT","_fragmentShaderPrecisionHighpFloat","FRAGMENT_SHADER","_fragmentShaderPrecisionMediumpFloat","formats","COMPRESSED_TEXTURE_FORMATS","highpAvailable","mediumpAvailable","shadowMapPlugin","ShadowMapPlugin","spritePlugin","SpritePlugin","lensFlarePlugin","LensFlarePlugin","forceContextLoss","loseContext","supportsFloatTextures","supportsHalfFloatTextures","supportsStandardDerivatives","supportsCompressedTextureS3TC","supportsCompressedTexturePVRTC","supportsBlendMinMax","MAX_TEXTURE_MAX_ANISOTROPY_EXT","getPrecision","getPixelRatio","setPixelRatio","updateStyle","setViewport","setScissor","scissor","enableScissorTest","SCISSOR_TEST","disable","getClearColor","getClearAlpha","setClearAlpha","bits","COLOR_BUFFER_BIT","DEPTH_BUFFER_BIT","STENCIL_BUFFER_BIT","clearTarget","setRenderTarget","deallocateGeometry","deallocateTexture","onRenderTargetDispose","deallocateRenderTarget","deleteBuffers","buffers","deleteBuffer","deleteTexture","deleteFramebuffer","__webglFramebuffer","deleteRenderbuffer","__webglRenderbuffer","deleteProgram","newPrograms","renderBufferImmediate","initAttributes","hasPositions","hasNormals","hasUvs","__webglUvBuffer","hasColors","positionArray","nx","ny","nz","nax","nbx","ncx","nay","nby","ncy","naz","nbz","ncz","drawArrays","TRIANGLES","updateBuffers","wireframeBit","geometryProgram","LINES","drawElements","POINTS","LINE_STRIP","setLineWidth","skinIndex","skinWeight","lineDistance","forceClear","setFaceCulling","frontFaceDirection","CW","FRONT","FRONT_AND_BACK","setDoubleSided","setFlipSided","uploadTexture","UNPACK_PREMULTIPLY_ALPHA_WEBGL","UNPACK_ALIGNMENT","isCube","isTargetPowerOfTwo","createFramebuffer","createRenderbuffer","shareDepthFrom","vx","vy","readRenderTargetPixels","WebGLRenderTarget","restore","checkFramebufferStatus","FRAMEBUFFER_COMPLETE","readPixels","addPrePlugin","addPostPlugin","updateShadowMap","gl","getExtension","programIdCount","generateDefines","chunk","cacheUniformLocations","identifiers","getUniformLocation","cacheAttributeLocations","getAttribLocation","shadowMapTypeDefine","envMapTypeDefine","envMapModeDefine","envMapBlendingDefine","prefix_vertex","prefix_fragment","gammaFactorDefine","customDefines","createProgram","glVertexShader","WebGLShader","glFragmentShader","attachShader","bindAttribLocation","linkProgram","programLogInfo","getProgramInfoLog","getProgramParameter","LINK_STATUS","getError","VALIDATE_STATUS","deleteShader","addLineNumbers","string","lines","createShader","shaderSource","compileShader","getShaderParameter","COMPILE_STATUS","getShaderInfoLog","newAttributes","Uint8Array","enabledAttributes","currentBlending","currentBlendEquation","currentBlendSrc","currentBlendDst","currentBlendEquationAlpha","currentBlendSrcAlpha","currentBlendDstAlpha","currentDepthTest","currentDepthWrite","currentColorWrite","currentDoubleSided","currentFlipSided","currentLineWidth","currentPolygonOffset","currentPolygonOffsetFactor","currentPolygonOffsetUnits","enableVertexAttribArray","disableVertexAttribArray","blendEquationSeparate","blendFuncSeparate","depthMask","colorMask","lineWidth","polygonoffset","units","POLYGON_OFFSET_FILL","flares","prefix","vertexBuffer","elementBuffer","hasVertexTexture","tempTexture","occlusionTexture","renderType","occlusionMap","screenPosition","viewportWidth","viewportHeight","tempPosition","invAspect","halfViewportWidth","halfViewportHeight","screenPositionPixels","TEXTURE1","copyTexImage2D","sprite","_renderer","_renderList","createVirtualLight","cascade","virtualLight","isVirtual","pointsWorld","pointsFrustum","nearZ","farZ","updateVirtualLight","updateShadowCamera","_min","_max","getObjectMaterial","_depthMaterial","_depthMaterialMorph","_depthMaterialSkin","_depthMaterialMorphSkin","_matrixPosition","depthShader","depthUniforms","originalCamera","gyro","Gyroscope","shadowFilter","pars","cameraHelper","CameraHelper","objectMaterial","useMorphing","useSkinning","customDepthMaterial","clearAlpha","spritePosition","spriteRotation","spriteScale","uvOffset","uvScale","fogType","fillStyle","fillRect","oldFogType","sceneFogType","GeometryUtils","geometry1","geometry2","loadTextureCube","loadCompressedTexture","loadCompressedTextureCube","getNormalMap","subtract","getImageData","imageData","createImageData","ly","uy","lx","ux","num_points","putImageData","generateDataTexture","SceneUtils","createMultiMaterialObject","detach","attach","FontUtils","divisions","getFace","loadFace","family","familyName","ThreeFont","cssFontWeight","cssFontStyle","drawText","resolution","String","fontPaths","ret","extractGlyphPoints","paths","outline","action","cpx","cpy","cpx0","cpy0","cpx1","cpy1","cpx2","cpy2","laste","pts","glyph","glyphs","_cachedOutline","moveTo","lineTo","quadraticCurveTo","Shape","Utils","bezierCurveTo","b3","ha","generateShapes","curveSegments","font","shapes","toShapes","namespace","EPSILON","process","contour","verts","vertIndices","nv","snip","px","py","aX","aY","bX","bY","cX","cY","apx","apy","bpx","bpy","cCROSSap","bCROSScp","aCROSSbp","Triangulate","_typeface_js","typeface_js","Audio","source","createBufferSource","onended","onEnded","gain","createGain","connect","destination","panner","createPanner","autoplay","isPlaying","onload","decodeAudioData","play","loop","pause","currentTime","setLoop","setRefDistance","refDistance","setRolloffFactor","rolloffFactor","setVolume","AudioListener","AudioContext","webkitAudioContext","orientation","positionPrev","setOrientation","setVelocity","Curve","getPointAt","getUtoTmapping","getSpacedPoints","lengths","getLengths","cacheArcLengths","current","cache","last","sum","updateArcLengths","targetArcLength","arcLengths","comparison","lengthBefore","lengthAfter","segmentLength","segmentFraction","getTangent","pt1","pt2","vec","getTangentAt","tangentQuadraticBezier","tangentCubicBezier","tangentSpline","h00","h10","h01","h11","getPointFunc","CurvePath","curves","bends","autoClose","checkConnection","closePath","LineCurve","curveLengths","getCurveLengths","lens","cacheLengths","sums","maxX","maxY","maxZ","minX","minY","minZ","NEGATIVE_INFINITY","POSITIVE_INFINITY","createGeometry","createSpacedPointsGeometry","addWrapPath","bendpath","getTransformedPoints","oldPts","getWrapPoints","getTransformedSpacedPoints","oldX","oldY","xNorm","bounds","pathPt","translationObject","quaternionObject","scaleObject","translationWorld","quaternionWorld","scaleWorld","actions","fromPoints","PathActions","MOVE_TO","LINE_TO","QUADRATIC_CURVE_TO","BEZIER_CURVE_TO","CSPLINE_THRU","ARC","ELLIPSE","vectors","vlen","args","lastargs","x0","y0","aCPx","aCPy","QuadraticBezierCurve","aCP1x","aCP1y","aCP2x","aCP2y","CubicBezierCurve","splineThru","npts","SplineCurve","aRadius","aStartAngle","aEndAngle","aClockwise","absarc","absellipse","ellipse","xRadius","yRadius","lastPoint","closedPath","useSpacedPoints","item","spts","concat","spline","deltaAngle","tdivisions","isCCW","noHoles","extractSubpaths","inActions","subPaths","lastPath","toShapesNoHoles","inSubpaths","tmpPath","tmpShape","isPointInsidePolygon","inPt","inPolygon","polyLen","inside","edgeLowPt","edgeHighPt","edgeDx","edgeDy","perpEdge","solid","holesFirst","isClockWise","tmpPoints","betterShapeHoles","newShapes","newShapeHoles","mainIdx","ambigious","toChange","sIdx","sLen","sho","hIdx","ho","hole_unassigned","s2Idx","froms","tos","hole","tmpHoles","holes","extrude","extruded","ExtrudeGeometry","makeGeometry","ShapeGeometry","getPointsHoles","holesPts","getSpacedPointsHoles","extractAllPoints","shape","extractPoints","extractAllSpacedPoints","triangulateShape","point_in_segment_2D_colin","inSegPt1","inSegPt2","inOtherPt","intersect_segments_2D","inSeg1Pt1","inSeg1Pt2","inSeg2Pt1","inSeg2Pt2","inExcludeAdjacentSegs","seg1dx","seg1dy","seg2dx","seg2dy","seg1seg2dx","seg1seg2dy","perpSeg1","perpSeg2","factorSeg1","seg1Pt","seg2Pt","seg1min","seg1max","seg1minVal","seg1maxVal","seg2min","seg2max","seg2minVal","seg2maxVal","isPointInsideAngle","inVertex","inLegFromPt","inLegToPt","legFromPtX","legFromPtY","legToPtX","legToPtY","otherPtX","otherPtY","from2toAngle","from2otherAngle","other2toAngle","removeHoles","isCutLineInsideAngles","inShapeIdx","inHoleIdx","lastShapeIdx","prevShapeIdx","nextShapeIdx","insideAngle","lastHoleIdx","prevHoleIdx","nextHoleIdx","intersectsShapeEdge","inShapePt","inHolePt","nextIdx","intersection","intersectsHoleEdge","ihIdx","chkHole","indepHoles","holeIndex","shapeIndex","shapePt","holePt","holeIdx","cutKey","tmpShape1","tmpShape2","tmpHole1","tmpHole2","failedCuts","hl","minShapeIndex","h2","allPointsMap","allpoints","shapeWithoutHoles","b2p0","b2p1","b2p2","b3p0","b3p1","b3p2","b3p3","point0","point1","point2","point3","ArcCurve","LineCurve3","QuadraticBezierCurve3","CubicBezierCurve3","SplineCurve3","ClosedSplineCurve3","AnimationHandler","CATMULLROM","CATMULLROM_FORWARD","initialized","hierarchy","rot","usedMorphTargets","morphTargetName","morphTargetsInfluences","root","parseRecurseHierarchy","deltaTimeMS","resetBlendWeights","Animation","timeScale","interpolationType","keyTypes","animationCache","positionWeight","quaternionWeight","scaleWeight","prevKey","nextKey","originalMatrix","getNextKeyWith","newVector","newQuat","interpolateCatmullRom","prevXYZ","nextXYZ","proportionalWeight","getPrevKeyWith","currentPoint","forwardPoint","KeyFrameAnimation","isPaused","sids","sid","next","endTime","original","hasTarget","MorphAnimation","lastFrame","currentFrame","interpolation","frame","buildPlane","udir","vdir","gridX","gridY","width_half","height_half","gridX1","gridY1","segment_width","segment_height","uvd","depth_half","centerUV","segment","CubeGeometry","heightHalf","verticesRow","uvsRow","tanTheta","v4","n4","uv1","uv3","uv4","addShapeList","addShape","scalePt2","pt","getBevelVec","inPrev","inNext","v_trans_x","v_trans_y","shrink_by","v_prev_x","v_prev_y","v_next_x","v_next_y","v_prev_lensq","colinear0","v_prev_len","v_next_len","ptPrevShift_x","ptPrevShift_y","ptNextShift_x","ptNextShift_y","sf","v_trans_lensq","direction_eq","buildLidFaces","bevelEnabled","layer","flen","f3","steps","bevelSegments","buildSideFaces","layeroffset","sidewalls","ahole","slen1","slen2","f4","shapesOffset","uvgen","generateTopUV","wallContour","stepIndex","stepsLength","contourIndex1","contourIndex2","extrudeMaterial","generateSideWallUV","extrudePts","splineTube","binormal","position2","bevelThickness","bevelSize","extrudePath","extrudeByPath","UVGenerator","WorldUVGenerator","TubeGeometry","FrenetFrames","shapePoints","reverse","bs","vert","contourMovements","oneHoleMovements","holesMovements","verticesMovements","binormals","indexA","indexB","indexC","indexD","LatheGeometry","inversePointLength","inverseSegments","phi","np","u0","u1","PlaneGeometry","PlaneBufferGeometry","offset2","RingGeometry","innerRadius","outerRadius","thetaSegments","phiSegments","radiusStep","thetaSegment","TextGeometry","textShapes","getPos","in_q","in_p","cu","su","quOverP","cs","tz","grid","tang","bitan","ip","jp","closed","taper","NoTaper","numpoints","pos2","SinusoidalTaper","initialNormal3","smallest","MAX_VALUE","mat","PolyhedronGeometry","prepare","that","azimuth","inclination","centroid","azi","correctUV","subdivide","cols","aj","bj","rows","DodecahedronGeometry","OctahedronGeometry","TetrahedronGeometry","ParametricGeometry","func","slices","stacks","sliceCount","AxisHelper","ArrowHelper","lineGeometry","coneGeometry","headLength","headWidth","cone","setDirection","setColor","BoxHelper","BoundingBoxHelper","addLine","addPoint","pointMap","hexFrustum","hexCone","hexUp","hexTarget","hexCross","setPoint","DirectionalLightHelper","lightPlane","targetLine","EdgesHelper","thresholdAngle","thresholdDot","edge","sortFunction","numEdges","vert1","vert2","face1","face2","FaceNormalsHelper","objectVertices","objectFaces","objectWorldMatrix","GridHelper","setColors","colorCenterLine","colorGrid","HemisphereLightHelper","sphereSize","lightSphere","PointLightHelper","SkeletonHelper","getBoneList","boneList","matrixWorldInv","boneMatrix","SpotLightHelper","vector2","coneLength","coneWidth","VertexNormalsHelper","worldMatrix","vertexId","VertexTangentsHelper","WireframeHelper","edges","numTris","renderCallback","MorphBlendMesh","animationsMap","animationsList","numFrames","startFrame","endFrame","createAnimation","setAnimationWeight","active","autoCreateAnimations","frameRanges","setAnimationDirectionForward","setAnimationDirectionBackward","setAnimationFPS","setAnimationDuration","setAnimationTime","getAnimationTime","getAnimationDuration","stopAnimation","_manager","_Components","_tags","addComponent","TComponent","entityAddComponent","removeComponent","entityRemoveComponent","hasComponent","hasAllComponents","Components","C","hasTag","tag","addTag","entityAddTag","removeTag","entityRemoveTag","removeEntity","_events","fired","handled","Event","listenTo","eventName","trigger","entity","option","events","fire","messanger","_entities","_groups","_entityPool","_componentPools","entities","componentPropertyName","Component","getName","charAt","groupKey","names","T","ENTITY_CREATED","ENTITY_REMOVE","COMPONENT_ADDED","COMPONENT_REMOVE","createEntity","aquire","_trigger","removeEntitiesByTag","removeAllEntities","entityRemoveAllComponents","release","cName","cPool","component","groupName","Cs","loc","propName","queryComponents","_indexGroup","queryTag","poolStats","used","totalUsed","pool","level","maxEntities","maxLevels","nodes","__init","insert","_getIndex","spatial","absPosition","absHwidth","_splitAndRedistributeIfNeeded","_node","queryArea","hwidth","out__entities","overlapping","rectIntersect","reIndex","_combine","tSize","tPos","validateEntity","hw","assign","smult","rectContains","midX","midY","_split","_redistribute","_factory","freeList","expand","totalFree","magnitude","rotate","magnitude2","angleBetween","pcopy","fromAngle","pfromAngle","r1","r2","sizeToHwidth","out__position","out__hwidth","_absScale","_absPosition","_absHwidth","COINCIDENT","attachTo","absRotation","pScale","absScale","_name","_callback","Comps","whereComponent","whereComponents","extends","mixin","getArguments","extends_","Child","Parent","Super","Function","makeT","FUNCTION_NAME","FUNCTION_ARGS","replace","mixin_"],"mappings":"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","file":"bundle.js","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})","global.Class = require('js-class');\r\nglobal.THREE = require('three');\r\nglobal.THREE.PointerLockControls = require('three-pointerlock');\r\nglobal.Physijs = require('physijs-browserify')(THREE);\r\nglobal.Stats = require('stats.js');\r\nvar EntityManager = require('tiny-ecs').EntityManager;\r\n\r\nPhysijs.scripts.worker = '/libs/physi-worker.js';\r\nPhysijs.scripts.ammo = '/libs/ammo.js';\r\n\r\n// purpose: simulate our solar system with accurate scale\r\n//\r\n// requires: three.js, RequestAnimationFrame.js, three-fly-controls.js, stats.js, js-class.js, dat-gui.js\r\n//\r\n// author: Cornell Daly\r\n//\r\n// date: September 15, 2015\r\n//\r\n// additional notes: while everything is to scale, the orbits themselves are based off the average radius and are not the true elliptical orbits\r\n//                   all code was written with Node packages and minified for the final page\r\n//\r\n// Total LoC: 886 (including comments, whitespace, and Node requires)\r\n\r\nvar CONSANTS = {};\r\n\r\nvar KEY_CODES = {\r\n  c: 67,\r\n  space: 32\r\n};\r\n\r\n// This class is the underlying object that both planets and moons rely on\r\n// It handles much of the boilerplate required for setting up a planet/moon\r\n// It has a multitude of options to help ensure it is robost enough for most scenarios\r\nSpaceRock = Class({\r\n  constructor: function(options) {\r\n    this.name = options.name || \"Planet\";\r\n    this.size = options.size || 1;\r\n    this.parent = options.parent;\r\n    this.children = [];\r\n    this.orbitSpeed = options.orbitSpeed || 60;\r\n    this.texture = getTexture(options.texture);\r\n\r\n    if (options.textureWrap) {\r\n      this.texture.wrapS = THREE.RepeatWrapping;\r\n      this.texture.wrapT = THREE.RepeatWrapping;\r\n    }\r\n\r\n    var material;\r\n    if (options.isLambert === false) {\r\n      material = new THREE.MeshBasicMaterial({\r\n        map: this.texture\r\n      });\r\n    }\r\n    else {\r\n      material = new THREE.MeshLambertMaterial({\r\n        map: this.texture,\r\n        wrapAround: true\r\n      });\r\n    }\r\n\r\n    this.mesh = new THREE.Mesh(new THREE.SphereGeometry(this.size, CONSANTS.spaceRockSegments, CONSANTS.spaceRockSegments), material);\r\n\r\n    if (options.position) {\r\n      this.mesh.position.copy(options.position);\r\n    }\r\n\r\n    if (options.parent) {\r\n      this.mesh.position.add(options.parent.mesh.position);\r\n    }\r\n\r\n    if (options.scene) {\r\n      options.scene.add(this.mesh);\r\n    }\r\n  },\r\n\r\n  update: function(dt) {\r\n    if (this.parent) {\r\n      var oldPosition = this.mesh.position.clone();\r\n\r\n      this.mesh.rotation.z += dt;\r\n\r\n      this.rotateAroundPoint(this.parent.mesh.position, this.orbitSpeed * dt);\r\n\r\n      if (this.children.length > 0) {\r\n        var deltaPosition = this.mesh.position.clone().sub(oldPosition);\r\n\r\n        for (var i in this.children) {\r\n          var child = this.children[i];\r\n\r\n          child.position.add(deltaPosition);\r\n        }\r\n      }\r\n    }\r\n  },\r\n\r\n  // https://stackoverflow.com/questions/17410809/how-to-calculate-rotation-in-2d-in-javascript\r\n  rotateAroundPoint: function(center, angle) {\r\n    var radians = angle * (Math.PI / 180);\r\n\r\n    var cos = Math.cos(radians);\r\n    var sin = Math.sin(radians);\r\n\r\n    var x = this.mesh.position.x;\r\n    var y = this.mesh.position.y;\r\n\r\n    this.mesh.position.x = (cos * (x - center.x)) + (sin * (y - center.y)) + center.x;\r\n    this.mesh.position.y = (cos * (y - center.y)) - (sin * (x - center.x)) + center.y;\r\n  }\r\n});\r\n\r\n// Subclass for organizational/code clarity purposes\r\nPlanet = Class(SpaceRock, {\r\n\r\n});\r\n\r\n// Simply adds some useful identification information to moons\r\nMoon = Class(SpaceRock, {\r\n  constructor: function(options) {\r\n    SpaceRock.prototype.constructor.call(this, options);\r\n\r\n    this.planetName = options.planetName;\r\n    this.isMoon = options.isMoon || true;\r\n  }\r\n});\r\n\r\n// This class makes it easier to manage and render a planet or moon's orbit (that is, the circle used to represent it)\r\nOrbit = Class({\r\n  constructor: function(options) {\r\n    if (!options.pos || !options.radius) {\r\n      return;\r\n    }\r\n\r\n    this.parent = options.parent || null;\r\n    this.offset = options.offset || new THREE.Vector3(0, 0, 0);\r\n\r\n    var color = options.color || new THREE.Color(Math.random(), Math.random(), Math.random());\r\n    var segments = options.segments || 1000;\r\n\r\n    var curve = new THREE.EllipseCurve(\r\n      options.pos.x, options.pos.y,\r\n      options.radius.x, options.radius.y,\r\n      0, 2 * Math.PI,\r\n      false);\r\n\r\n    var path = new THREE.Path(curve.getPoints(segments));\r\n    var geometry = path.createPointsGeometry(segments);\r\n    var material = new THREE.LineBasicMaterial({\r\n      color: color,\r\n      transparent: true,\r\n      opacity: 0.4\r\n    });\r\n\r\n    this.mesh = new THREE.Line(geometry, material);\r\n\r\n    if (options.scene) {\r\n      options.scene.add(this.mesh);\r\n    }\r\n  },\r\n\r\n  update: function(dt) {\r\n    if (this.parent) {\r\n      this.mesh.position.x = this.offset.x + this.parent.mesh.position.x;\r\n      this.mesh.position.y = this.offset.y + this.parent.mesh.position.y;\r\n    }\r\n  }\r\n});\r\n\r\n// This class is used to help render lines that can \"connect\" two objects\r\n// This is mostly used for showing connections between the Sun and the planets, and between a planet and its moons\r\n// Note: the lines seem to disappear at a certain zoom level; I don't know why\r\nConnectingLine = Class({\r\n  constructor: function(options) {\r\n    this.parent = options.parent;\r\n    this.startPoint = options.startPoint.clone();\r\n    this.endPoint = options.endPoint.clone();\r\n\r\n    var opacity = options.opacity || 0.4;\r\n\r\n    var geometry = new THREE.Geometry();\r\n    geometry.vertices.push(this.startPoint, this.endPoint);\r\n\r\n    var material = new THREE.LineBasicMaterial({\r\n      color: options.color,\r\n      transparent: true,\r\n      opacity: opacity\r\n    });\r\n\r\n    this.mesh = new THREE.Line(geometry, material);\r\n\r\n    if (options.scene) {\r\n      options.scene.add(this.mesh);\r\n    }\r\n  },\r\n\r\n  update: function(dt) {\r\n    this.mesh.geometry.vertices[0] = this.startPoint;\r\n    this.mesh.geometry.vertices[1] = this.endPoint;\r\n    this.mesh.geometry.verticesNeedUpdate = true;\r\n  }\r\n});\r\n\r\n// This object stores all \"global\" app variables (in other words, things that everything in the app relies on)\r\nvar app = {\r\n  container: null,\r\n  renderer: null,\r\n\r\n  loadingContainer: null,\r\n  blocker: null,\r\n  instructions: null,\r\n\r\n  stats: null,\r\n\r\n  clock: null,\r\n\r\n  scene: null,\r\n  camera: null,\r\n\r\n  paused: true,\r\n\r\n  controlsEnabled: false,\r\n  controls: null,\r\n\r\n  textures: {}\r\n};\r\n\r\nfunction init() {\r\n  window.addEventListener('resize', onResize);\r\n  window.addEventListener('keyup', onKeyUp);\r\n  window.onkeydown = onKeyDown; // prevent spacebar from scrolling the page\r\n\r\n  app.container = document.getElementById(\"container\");\r\n\r\n  app.loadingContainer = document.getElementById(\"loadingContainer\");\r\n  app.blocker = document.getElementById(\"blocker\");\r\n  app.instructions = document.getElementById(\"instructions\");\r\n\r\n  initThree();\r\n}\r\n\r\nfunction initThree() {\r\n  app.renderer = new THREE.WebGLRenderer({\r\n    antialias: true\r\n  });\r\n  app.renderer.setSize(window.innerWidth, window.innerHeight);\r\n  app.container.appendChild(app.renderer.domElement);\r\n\r\n  /* Stats.js Setup */\r\n  app.stats = new Stats();\r\n  app.stats.setMode(1);\r\n\r\n  app.stats.domElement.style.position = 'absolute';\r\n  app.stats.domElement.style.left = '10px';\r\n  app.stats.domElement.style.top = '10px';\r\n\r\n  document.body.appendChild(app.stats.domElement);\r\n\r\n  // Create a new Three.js scene\r\n  app.scene = new Physijs.Scene();\r\n\r\n  // Put in a camera\r\n  var aspectRatio = window.innerWidth / window.innerHeight;\r\n  app.camera = new THREE.PerspectiveCamera(45, aspectRatio, 0.1, 1000);\r\n  app.camera.position.set(0, 0, 30);\r\n  app.scene.add(app.camera);\r\n\r\n  /* Camera Controller */\r\n  app.controls = new THREE.PointerLockControls(app.camera);\r\n  app.controls = -50;\r\n  app.scene.add(app.controls.getObject());\r\n\r\n  var m = new Physijs.Mesh(new THREE.BoxGeometry(10, 10, 10), new THREE.MeshBasicMaterial({\r\n    color: 0xff0000\r\n  }));\r\n  app.scene.add(m);\r\n\r\n  app.clock = new THREE.Clock();\r\n\r\n  // hide loading indicator and show instructions\r\n  app.loadingContainer.style.visibility = \"hidden\";\r\n  app.blocker.style.visibility = \"visible\";\r\n  app.instructions.style.visibility = \"visible\";\r\n  // ensure the user is at the top of the page\r\n  document.body.scrollTop = document.documentElement.scrollTop = 0;\r\n  initPointerLock();\r\n\r\n  run();\r\n}\r\n\r\nfunction run() {\r\n  if (!app.paused) {\r\n    var dt = app.clock.getDelta();\r\n\r\n    if (dt > 0.5) {\r\n      dt = 0.5;\r\n    }\r\n\r\n    app.controls.update(dt);\r\n\r\n    app.scene.simulate();\r\n  }\r\n  else {\r\n    app.clock.getDelta();\r\n  }\r\n\r\n  app.renderer.render(app.scene, app.camera);\r\n  app.stats.update();\r\n\r\n  requestAnimationFrame(run);\r\n}\r\n\r\nfunction onResize(e) {\r\n  app.renderer.setSize(window.innerWidth, window.innerHeight);\r\n\r\n  app.camera.aspect = (window.innerWidth / window.innerHeight);\r\n  app.camera.updateProjectionMatrix();\r\n}\r\n\r\nfunction onKeyDown(e) {\r\n  var keyCode = ('which' in event) ? event.which : event.keyCode;\r\n\r\n  return (keyCode !== KEY_CODES.space);\r\n}\r\n\r\nfunction onKeyUp(e) {\r\n  var keyCode = ('which' in event) ? event.which : event.keyCode;\r\n\r\n  // if 'c' is pressed, toggle the fly controls\r\n  if (keyCode === KEY_CODES.c && app.guiMenu.cameraFocus === 'none') {\r\n    app.controlsEnabled = !app.controlsEnabled;\r\n    app.flyControls.setEnabled(app.controlsEnabled);\r\n  }\r\n}\r\n\r\nfunction initPointerLock() {\r\n  var havePointerLock = 'pointerLockElement' in document || 'mozPointerLockElement' in document || 'webkitPointerLockElement' in document;\r\n\r\n  if (havePointerLock) {\r\n\r\n    var element = document.body;\r\n\r\n    var pointerlockchange = function(event) {\r\n\r\n      if (document.pointerLockElement === element || document.mozPointerLockElement === element || document.webkitPointerLockElement === element) {\r\n\r\n        app.controlsEnabled = true;\r\n        app.controls.enabled = true;\r\n\r\n        app.blocker.style.display = 'none';\r\n\r\n        app.paused = false;\r\n\r\n      }\r\n      else {\r\n\r\n        app.controls.enabled = false;\r\n\r\n        app.blocker.style.display = '-webkit-box';\r\n        app.blocker.style.display = '-moz-box';\r\n        app.blocker.style.display = 'box';\r\n\r\n        app.instructions.style.display = '';\r\n\r\n        app.paused = true;\r\n\r\n      }\r\n\r\n    };\r\n\r\n    var pointerlockerror = function(event) {\r\n\r\n      app.instructions.style.display = '';\r\n\r\n    };\r\n\r\n    // Hook pointer lock state change events\r\n    document.addEventListener('pointerlockchange', pointerlockchange, false);\r\n    document.addEventListener('mozpointerlockchange', pointerlockchange, false);\r\n    document.addEventListener('webkitpointerlockchange', pointerlockchange, false);\r\n\r\n    document.addEventListener('pointerlockerror', pointerlockerror, false);\r\n    document.addEventListener('mozpointerlockerror', pointerlockerror, false);\r\n    document.addEventListener('webkitpointerlockerror', pointerlockerror, false);\r\n\r\n    app.instructions.addEventListener('click', function(event) {\r\n\r\n      app.instructions.style.display = 'none';\r\n\r\n      // Ask the browser to lock the pointer\r\n      element.requestPointerLock = element.requestPointerLock || element.mozRequestPointerLock || element.webkitRequestPointerLock;\r\n\r\n      if (/Firefox/i.test(navigator.userAgent)) {\r\n\r\n        var fullscreenchange = function(event) {\r\n\r\n          if (document.fullscreenElement === element || document.mozFullscreenElement === element || document.mozFullScreenElement === element) {\r\n\r\n            document.removeEventListener('fullscreenchange', fullscreenchange);\r\n            document.removeEventListener('mozfullscreenchange', fullscreenchange);\r\n\r\n            element.requestPointerLock();\r\n          }\r\n\r\n        };\r\n\r\n        document.addEventListener('fullscreenchange', fullscreenchange, false);\r\n        document.addEventListener('mozfullscreenchange', fullscreenchange, false);\r\n\r\n        element.requestFullscreen = element.requestFullscreen || element.mozRequestFullscreen || element.mozRequestFullScreen || element.webkitRequestFullscreen;\r\n\r\n        element.requestFullscreen();\r\n\r\n      }\r\n      else {\r\n\r\n        element.requestPointerLock();\r\n\r\n      }\r\n\r\n    }, false);\r\n\r\n  }\r\n  else {\r\n\r\n    app.instructions.innerHTML = 'Your browser doesn\\'t seem to support Pointer Lock API';\r\n\r\n  }\r\n}\r\n\r\n// helper function to make loading/managing textures easier\r\nfunction getTexture(path, callback) {\r\n  if (path === null || path === undefined) {\r\n    return null;\r\n  }\r\n  else if (path in app.textures) {\r\n    return app.textures[path];\r\n  }\r\n\r\n  app.textures[path] = THREE.ImageUtils.loadTexture(path, undefined, callback);\r\n\r\n  return app.textures[path];\r\n}\r\n\r\ninit();","/** @preserve http://github.com/easeway/js-class */\n\n// Class Definition using ECMA5 prototype chain\n\nfunction inherit(dest, src, noParent) {\n    while (src && src !== Object.prototype) {\n        Object.getOwnPropertyNames(src).forEach(function (name) {\n            if (name != '.class' && !dest.hasOwnProperty(name)) {\n                var desc = Object.getOwnPropertyDescriptor(src, name);\n                Object.defineProperty(dest, name, desc);\n            }\n        });\n        if (noParent) {\n            break;\n        }\n        src = src.__proto__;\n    }\n    return dest;\n}\n\nvar Class = function (base, proto, options) {\n    if (typeof(base) != 'function') {\n        options = proto;\n        proto = base;\n        base = Object;\n    }\n    if (!proto) {\n        proto = {};\n    }\n    if (!options) {\n        options = {};\n    }\n    \n    var meta = {\n        name: options.name,\n        base: base,\n        implements: []\n    }\n    var classProto = Class.clone(proto);\n    if (options.implements) {\n        (Array.isArray(options.implements) ? options.implements : [options.implements])\n            .forEach(function (implementedType) {\n                if (typeof(implementedType) == 'function' && implementedType.prototype) {\n                    meta.implements.push(implementedType);\n                    Class.extend(classProto, implementedType.prototype);\n                }\n            });\n    }\n    classProto.__proto__ = base.prototype;\n    var theClass = function () {\n        if (typeof(this.constructor) == 'function') {\n            this.constructor.apply(this, arguments);\n        }\n    };\n    meta.type = theClass;\n    theClass.prototype = classProto;\n    Object.defineProperty(theClass, '.class.meta', { value: meta, enumerable: false, configurable: false, writable: false });\n    Object.defineProperty(classProto, '.class', { value: theClass, enumerable: false, configurable: false, writable: false });\n    if (options.statics) {\n        Class.extend(theClass, options.statics);\n    }\n    return theClass;\n};\n\nClass.extend = inherit;\n\nClass.clone = function (object) {\n    return inherit({}, object);\n};\n\nfunction findType(meta, type) {\n    while (meta) {\n        if (meta.type.prototype === type.prototype) {\n            return true;\n        }\n        for (var i in meta.implements) {\n            var implType = meta.implements[i];\n            var implMeta = implType['.class.meta'];\n            if (implMeta) {\n                if (findType(implMeta, type)) {\n                    return true;\n                }\n            } else {\n                for (var proto = implType.prototype; proto; proto = proto.__proto__) {\n                    if (proto === type.prototype) {\n                        return true;\n                    }\n                }\n            }\n        }\n        meta = meta.base ? meta.base['.class.meta'] : undefined;\n    }\n    return false;\n}\n\nvar Checker = Class({\n    constructor: function (object) {\n        this.object = object;\n    },\n    \n    typeOf: function (type) {\n        if (this.object instanceof type) {\n            return true;\n        }\n        var meta = Class.typeInfo(this.object);\n        return meta && findType(meta, type);\n    }\n});\n\n// aliases\nChecker.prototype.a = Checker.prototype.typeOf;\nChecker.prototype.an = Checker.prototype.typeOf;\n\nClass.is = function (object) {\n    return new Checker(object);\n};\n\nClass.typeInfo = function (object) {\n    var theClass = object.__proto__['.class'];\n    return theClass ? theClass['.class.meta'] : undefined;\n};\n\nClass.VERSION = [0, 0, 2];\n\nif (module) {\n    module.exports = Class;\n} else {\n    global.Class = Class;   // for browser\n}","/**\n * @author mrdoob / http://mrdoob.com/\n * Source: https://github.com/mrdoob/three.js/blob/master/examples/js/controls/PointerLockControls.js\n *\n * Adopted to common js by Javier Zapata\n */\n\nmodule.exports = function(camera) {\n\n  var THREE = window.THREE || require('three');\n\n  var scope = this;\n\n  camera.rotation.set(0, 0, 0);\n\n  var pitchObject = new THREE.Object3D();\n  pitchObject.add(camera);\n\n  var yawObject = new THREE.Object3D();\n  yawObject.position.y = 10;\n  yawObject.add(pitchObject);\n\n  var moveForward = false;\n  var moveBackward = false;\n  var moveLeft = false;\n  var moveRight = false;\n\n  var isOnObject = false;\n  var canJump = false;\n\n  var prevTime = performance.now();\n\n  var velocity = new THREE.Vector3();\n\n  var PI_2 = Math.PI / 2;\n\n  var onMouseMove = function(event) {\n\n    if (scope.enabled === false) return;\n\n    var movementX = event.movementX || event.mozMovementX || event.webkitMovementX || 0;\n    var movementY = event.movementY || event.mozMovementY || event.webkitMovementY || 0;\n\n    yawObject.rotation.y -= movementX * 0.002;\n    pitchObject.rotation.x -= movementY * 0.002;\n\n    pitchObject.rotation.x = Math.max(-PI_2, Math.min(PI_2, pitchObject.rotation.x));\n\n  };\n\n  var onKeyDown = function(event) {\n\n    switch (event.keyCode) {\n\n      case 38: // up\n      case 87: // w\n        moveForward = true;\n        break;\n\n      case 37: // left\n      case 65: // a\n        moveLeft = true;\n        break;\n\n      case 40: // down\n      case 83: // s\n        moveBackward = true;\n        break;\n\n      case 39: // right\n      case 68: // d\n        moveRight = true;\n        break;\n\n      case 32: // space\n        if (canJump === true) velocity.y += 350;\n        canJump = false;\n        break;\n\n    }\n\n  };\n\n  var onKeyUp = function(event) {\n\n    switch (event.keyCode) {\n\n      case 38: // up\n      case 87: // w\n        moveForward = false;\n        break;\n\n      case 37: // left\n      case 65: // a\n        moveLeft = false;\n        break;\n\n      case 40: // down\n      case 83: // s\n        moveBackward = false;\n        break;\n\n      case 39: // right\n      case 68: // d\n        moveRight = false;\n        break;\n\n    }\n\n  };\n\n  document.addEventListener('mousemove', onMouseMove, false);\n  document.addEventListener('keydown', onKeyDown, false);\n  document.addEventListener('keyup', onKeyUp, false);\n\n  this.enabled = false;\n\n  this.getObject = function() {\n\n    return yawObject;\n\n  };\n\n  this.isOnObject = function(boolean) {\n\n    isOnObject = boolean;\n    canJump = boolean;\n\n  };\n\n  this.getDirection = function() {\n\n    // assumes the camera itself is not rotated\n\n    var direction = new THREE.Vector3(0, 0, -1);\n    var rotation = new THREE.Euler(0, 0, 0, \"YXZ\");\n\n    return function(v) {\n\n      rotation.set(pitchObject.rotation.x, yawObject.rotation.y, 0);\n\n      v.copy(direction).applyEuler(rotation);\n\n      return v;\n\n    };\n\n  }();\n\n  this.update = function() {\n\n    if (scope.enabled === false) return;\n\n    var time = performance.now();\n    var delta = (time - prevTime) / 1000;\n\n    velocity.x -= velocity.x * 10.0 * delta;\n    velocity.z -= velocity.z * 10.0 * delta;\n\n    velocity.y -= 9.8 * 100.0 * delta; // 100.0 = mass\n\n    if (moveForward) velocity.z -= 400.0 * delta;\n    if (moveBackward) velocity.z += 400.0 * delta;\n\n    if (moveLeft) velocity.x -= 400.0 * delta;\n    if (moveRight) velocity.x += 400.0 * delta;\n\n    if (isOnObject === true) {\n      velocity.y = Math.max(0, velocity.y);\n    }\n\n    yawObject.translateX(velocity.x * delta);\n    yawObject.translateY(velocity.y * delta);\n    yawObject.translateZ(velocity.z * delta);\n\n    if (yawObject.position.y < 10) {\n\n      velocity.y = 0;\n      yawObject.position.y = 10;\n\n      canJump = true;\n    }\n\n    prevTime = time;\n  };\n};","module.exports = {\n\n  Entity         : require('./lib/Entity.js'),\n  EntityManager  : require('./lib/EntityManager.js'),\n  Messanger      : require('./lib/Messanger.js'),\n  ObjectPool     : require('./lib/ObjectPool.js'),\n  QuadTree       : require('./lib/QuadTree.js'),\n  Spatial        : require('./lib/Spatial.js'),\n  Vec2           : require('./lib/Vec2.js')\n\n};\n","module.exports = function(THREE) {\n  'use strict';\n\n  var SUPPORT_TRANSFERABLE,\n    _is_simulating = false,\n    _Physijs = Physijs, // used for noConflict method\n    Physijs = {}, // object assigned to window.Physijs\n    Eventable, // class to provide simple event methods\n    getObjectId, // returns a unique ID for a Physijs mesh object\n    getEulerXYZFromQuaternion, getQuatertionFromEuler,\n    convertWorldPositionToObject, // Converts a world-space position to object-space\n    addObjectChildren,\n\n    _temp1, _temp2,\n    _temp_vector3_1 = new THREE.Vector3,\n    _temp_vector3_2 = new THREE.Vector3,\n    _temp_matrix4_1 = new THREE.Matrix4,\n    _quaternion_1 = new THREE.Quaternion,\n\n    // constants\n    MESSAGE_TYPES = {\n      WORLDREPORT: 0,\n      COLLISIONREPORT: 1,\n      VEHICLEREPORT: 2,\n      CONSTRAINTREPORT: 3\n    },\n    REPORT_ITEMSIZE = 14,\n    COLLISIONREPORT_ITEMSIZE = 5,\n    VEHICLEREPORT_ITEMSIZE = 9,\n    CONSTRAINTREPORT_ITEMSIZE = 6;\n\n  Physijs.scripts = {};\n\n  Eventable = function() {\n    this._eventListeners = {};\n  };\n  Eventable.prototype.addEventListener = function(event_name, callback) {\n    if (!this._eventListeners.hasOwnProperty(event_name)) {\n      this._eventListeners[event_name] = [];\n    }\n    this._eventListeners[event_name].push(callback);\n  };\n  Eventable.prototype.removeEventListener = function(event_name, callback) {\n    var index;\n\n    if (!this._eventListeners.hasOwnProperty(event_name)) return false;\n\n    if ((index = this._eventListeners[event_name].indexOf(callback)) >= 0) {\n      this._eventListeners[event_name].splice(index, 1);\n      return true;\n    }\n\n    return false;\n  };\n  Eventable.prototype.dispatchEvent = function(event_name) {\n    var i,\n      parameters = Array.prototype.splice.call(arguments, 1);\n\n    if (this._eventListeners.hasOwnProperty(event_name)) {\n      for (i = 0; i < this._eventListeners[event_name].length; i++) {\n        this._eventListeners[event_name][i].apply(this, parameters);\n      }\n    }\n  };\n  Eventable.make = function(obj) {\n    obj.prototype.addEventListener = Eventable.prototype.addEventListener;\n    obj.prototype.removeEventListener = Eventable.prototype.removeEventListener;\n    obj.prototype.dispatchEvent = Eventable.prototype.dispatchEvent;\n  };\n\n  getObjectId = (function() {\n    var _id = 1;\n    return function() {\n      return _id++;\n    };\n  })();\n\n  getEulerXYZFromQuaternion = function(x, y, z, w) {\n    return new THREE.Vector3(\n      Math.atan2(2 * (x * w - y * z), (w * w - x * x - y * y + z * z)),\n      Math.asin(2 * (x * z + y * w)),\n      Math.atan2(2 * (z * w - x * y), (w * w + x * x - y * y - z * z))\n    );\n  };\n\n  getQuatertionFromEuler = function(x, y, z) {\n    var c1, s1, c2, s2, c3, s3, c1c2, s1s2;\n    c1 = Math.cos(y);\n    s1 = Math.sin(y);\n    c2 = Math.cos(-z);\n    s2 = Math.sin(-z);\n    c3 = Math.cos(x);\n    s3 = Math.sin(x);\n\n    c1c2 = c1 * c2;\n    s1s2 = s1 * s2;\n\n    return {\n      w: c1c2 * c3 - s1s2 * s3,\n      x: c1c2 * s3 + s1s2 * c3,\n      y: s1 * c2 * c3 + c1 * s2 * s3,\n      z: c1 * s2 * c3 - s1 * c2 * s3\n    };\n  };\n\n  convertWorldPositionToObject = function(position, object) {\n    _temp_matrix4_1.identity(); // reset temp matrix\n\n    // Set the temp matrix's rotation to the object's rotation\n    _temp_matrix4_1.identity().makeRotationFromQuaternion(object.quaternion);\n\n    // Invert rotation matrix in order to \"unrotate\" a point back to object space\n    _temp_matrix4_1.getInverse(_temp_matrix4_1);\n\n    // Yay! Temp vars!\n    _temp_vector3_1.copy(position);\n    _temp_vector3_2.copy(object.position);\n\n    // Apply the rotation\n\n    return _temp_vector3_1.sub(_temp_vector3_2).applyMatrix4(_temp_matrix4_1);\n  };\n\n\n\n  // Physijs.noConflict\n  Physijs.noConflict = function() {\n    window.Physijs = _Physijs;\n    return Physijs;\n  };\n\n\n  // Physijs.createMaterial\n  Physijs.createMaterial = function(material, friction, restitution) {\n    var physijs_material = function() {};\n    physijs_material.prototype = material;\n    physijs_material = new physijs_material;\n\n    physijs_material._physijs = {\n      id: material.id,\n      friction: friction === undefined ? .8 : friction,\n      restitution: restitution === undefined ? .2 : restitution\n    };\n\n    return physijs_material;\n  };\n\n\n  // Constraints\n  Physijs.PointConstraint = function(objecta, objectb, position) {\n    if (position === undefined) {\n      position = objectb;\n      objectb = undefined;\n    }\n\n    this.type = 'point';\n    this.appliedImpulse = 0;\n    this.id = getObjectId();\n    this.objecta = objecta._physijs.id;\n    this.positiona = convertWorldPositionToObject(position, objecta).clone();\n\n    if (objectb) {\n      this.objectb = objectb._physijs.id;\n      this.positionb = convertWorldPositionToObject(position, objectb).clone();\n    }\n  };\n  Physijs.PointConstraint.prototype.getDefinition = function() {\n    return {\n      type: this.type,\n      id: this.id,\n      objecta: this.objecta,\n      objectb: this.objectb,\n      positiona: this.positiona,\n      positionb: this.positionb\n    };\n  };\n\n  Physijs.HingeConstraint = function(objecta, objectb, position, axis) {\n    if (axis === undefined) {\n      axis = position;\n      position = objectb;\n      objectb = undefined;\n    }\n\n    this.type = 'hinge';\n    this.appliedImpulse = 0;\n    this.id = getObjectId();\n    this.scene = objecta.parent;\n    this.objecta = objecta._physijs.id;\n    this.positiona = convertWorldPositionToObject(position, objecta).clone();\n    this.position = position.clone();\n    this.axis = axis;\n\n    if (objectb) {\n      this.objectb = objectb._physijs.id;\n      this.positionb = convertWorldPositionToObject(position, objectb).clone();\n    }\n  };\n  Physijs.HingeConstraint.prototype.getDefinition = function() {\n    return {\n      type: this.type,\n      id: this.id,\n      objecta: this.objecta,\n      objectb: this.objectb,\n      positiona: this.positiona,\n      positionb: this.positionb,\n      axis: this.axis\n    };\n  };\n  /*\n   * low = minimum angle in radians\n   * high = maximum angle in radians\n   * bias_factor = applied as a factor to constraint error\n   * relaxation_factor = controls bounce (0.0 == no bounce)\n   */\n  Physijs.HingeConstraint.prototype.setLimits = function(low, high, bias_factor, relaxation_factor) {\n    this.scene.execute('hinge_setLimits', {\n      constraint: this.id,\n      low: low,\n      high: high,\n      bias_factor: bias_factor,\n      relaxation_factor: relaxation_factor\n    });\n  };\n  Physijs.HingeConstraint.prototype.enableAngularMotor = function(velocity, acceleration) {\n    this.scene.execute('hinge_enableAngularMotor', {\n      constraint: this.id,\n      velocity: velocity,\n      acceleration: acceleration\n    });\n  };\n  Physijs.HingeConstraint.prototype.disableMotor = function(velocity, acceleration) {\n    this.scene.execute('hinge_disableMotor', {\n      constraint: this.id\n    });\n  };\n\n  Physijs.SliderConstraint = function(objecta, objectb, position, axis) {\n    if (axis === undefined) {\n      axis = position;\n      position = objectb;\n      objectb = undefined;\n    }\n\n    this.type = 'slider';\n    this.appliedImpulse = 0;\n    this.id = getObjectId();\n    this.scene = objecta.parent;\n    this.objecta = objecta._physijs.id;\n    this.positiona = convertWorldPositionToObject(position, objecta).clone();\n    this.axis = axis;\n\n    if (objectb) {\n      this.objectb = objectb._physijs.id;\n      this.positionb = convertWorldPositionToObject(position, objectb).clone();\n    }\n  };\n  Physijs.SliderConstraint.prototype.getDefinition = function() {\n    return {\n      type: this.type,\n      id: this.id,\n      objecta: this.objecta,\n      objectb: this.objectb,\n      positiona: this.positiona,\n      positionb: this.positionb,\n      axis: this.axis\n    };\n  };\n  Physijs.SliderConstraint.prototype.setLimits = function(lin_lower, lin_upper, ang_lower, ang_upper) {\n    this.scene.execute('slider_setLimits', {\n      constraint: this.id,\n      lin_lower: lin_lower,\n      lin_upper: lin_upper,\n      ang_lower: ang_lower,\n      ang_upper: ang_upper\n    });\n  };\n  Physijs.SliderConstraint.prototype.setRestitution = function(linear, angular) {\n    this.scene.execute(\n      'slider_setRestitution', {\n        constraint: this.id,\n        linear: linear,\n        angular: angular\n      }\n    );\n  };\n  Physijs.SliderConstraint.prototype.enableLinearMotor = function(velocity, acceleration) {\n    this.scene.execute('slider_enableLinearMotor', {\n      constraint: this.id,\n      velocity: velocity,\n      acceleration: acceleration\n    });\n  };\n  Physijs.SliderConstraint.prototype.disableLinearMotor = function() {\n    this.scene.execute('slider_disableLinearMotor', {\n      constraint: this.id\n    });\n  };\n  Physijs.SliderConstraint.prototype.enableAngularMotor = function(velocity, acceleration) {\n    this.scene.execute('slider_enableAngularMotor', {\n      constraint: this.id,\n      velocity: velocity,\n      acceleration: acceleration\n    });\n  };\n  Physijs.SliderConstraint.prototype.disableAngularMotor = function() {\n    this.scene.execute('slider_disableAngularMotor', {\n      constraint: this.id\n    });\n  };\n\n  Physijs.ConeTwistConstraint = function(objecta, objectb, position) {\n    if (position === undefined) {\n      throw 'Both objects must be defined in a ConeTwistConstraint.';\n    }\n    this.type = 'conetwist';\n    this.appliedImpulse = 0;\n    this.id = getObjectId();\n    this.scene = objecta.parent;\n    this.objecta = objecta._physijs.id;\n    this.positiona = convertWorldPositionToObject(position, objecta).clone();\n    this.objectb = objectb._physijs.id;\n    this.positionb = convertWorldPositionToObject(position, objectb).clone();\n    this.axisa = {\n      x: objecta.rotation.x,\n      y: objecta.rotation.y,\n      z: objecta.rotation.z\n    };\n    this.axisb = {\n      x: objectb.rotation.x,\n      y: objectb.rotation.y,\n      z: objectb.rotation.z\n    };\n  };\n  Physijs.ConeTwistConstraint.prototype.getDefinition = function() {\n    return {\n      type: this.type,\n      id: this.id,\n      objecta: this.objecta,\n      objectb: this.objectb,\n      positiona: this.positiona,\n      positionb: this.positionb,\n      axisa: this.axisa,\n      axisb: this.axisb\n    };\n  };\n  Physijs.ConeTwistConstraint.prototype.setLimit = function(x, y, z) {\n    this.scene.execute('conetwist_setLimit', {\n      constraint: this.id,\n      x: x,\n      y: y,\n      z: z\n    });\n  };\n  Physijs.ConeTwistConstraint.prototype.enableMotor = function() {\n    this.scene.execute('conetwist_enableMotor', {\n      constraint: this.id\n    });\n  };\n  Physijs.ConeTwistConstraint.prototype.setMaxMotorImpulse = function(max_impulse) {\n    this.scene.execute('conetwist_setMaxMotorImpulse', {\n      constraint: this.id,\n      max_impulse: max_impulse\n    });\n  };\n  Physijs.ConeTwistConstraint.prototype.setMotorTarget = function(target) {\n    if (target instanceof THREE.Vector3) {\n      target = new THREE.Quaternion().setFromEuler(new THREE.Euler(target.x, target.y, target.z));\n    }\n    else if (target instanceof THREE.Euler) {\n      target = new THREE.Quaternion().setFromEuler(target);\n    }\n    else if (target instanceof THREE.Matrix4) {\n      target = new THREE.Quaternion().setFromRotationMatrix(target);\n    }\n    this.scene.execute('conetwist_setMotorTarget', {\n      constraint: this.id,\n      x: target.x,\n      y: target.y,\n      z: target.z,\n      w: target.w\n    });\n  };\n  Physijs.ConeTwistConstraint.prototype.disableMotor = function() {\n    this.scene.execute('conetwist_disableMotor', {\n      constraint: this.id\n    });\n  };\n\n  Physijs.DOFConstraint = function(objecta, objectb, position) {\n    if (position === undefined) {\n      position = objectb;\n      objectb = undefined;\n    }\n    this.type = 'dof';\n    this.appliedImpulse = 0;\n    this.id = getObjectId();\n    this.scene = objecta.parent;\n    this.objecta = objecta._physijs.id;\n    this.positiona = convertWorldPositionToObject(position, objecta).clone();\n    this.axisa = {\n      x: objecta.rotation.x,\n      y: objecta.rotation.y,\n      z: objecta.rotation.z\n    };\n\n    if (objectb) {\n      this.objectb = objectb._physijs.id;\n      this.positionb = convertWorldPositionToObject(position, objectb).clone();\n      this.axisb = {\n        x: objectb.rotation.x,\n        y: objectb.rotation.y,\n        z: objectb.rotation.z\n      };\n    }\n  };\n  Physijs.DOFConstraint.prototype.getDefinition = function() {\n    return {\n      type: this.type,\n      id: this.id,\n      objecta: this.objecta,\n      objectb: this.objectb,\n      positiona: this.positiona,\n      positionb: this.positionb,\n      axisa: this.axisa,\n      axisb: this.axisb\n    };\n  };\n  Physijs.DOFConstraint.prototype.setLinearLowerLimit = function(limit) {\n    this.scene.execute('dof_setLinearLowerLimit', {\n      constraint: this.id,\n      x: limit.x,\n      y: limit.y,\n      z: limit.z\n    });\n  };\n  Physijs.DOFConstraint.prototype.setLinearUpperLimit = function(limit) {\n    this.scene.execute('dof_setLinearUpperLimit', {\n      constraint: this.id,\n      x: limit.x,\n      y: limit.y,\n      z: limit.z\n    });\n  };\n  Physijs.DOFConstraint.prototype.setAngularLowerLimit = function(limit) {\n    this.scene.execute('dof_setAngularLowerLimit', {\n      constraint: this.id,\n      x: limit.x,\n      y: limit.y,\n      z: limit.z\n    });\n  };\n  Physijs.DOFConstraint.prototype.setAngularUpperLimit = function(limit) {\n    this.scene.execute('dof_setAngularUpperLimit', {\n      constraint: this.id,\n      x: limit.x,\n      y: limit.y,\n      z: limit.z\n    });\n  };\n  Physijs.DOFConstraint.prototype.enableAngularMotor = function(which) {\n    this.scene.execute('dof_enableAngularMotor', {\n      constraint: this.id,\n      which: which\n    });\n  };\n  Physijs.DOFConstraint.prototype.configureAngularMotor = function(which, low_angle, high_angle, velocity, max_force) {\n    this.scene.execute('dof_configureAngularMotor', {\n      constraint: this.id,\n      which: which,\n      low_angle: low_angle,\n      high_angle: high_angle,\n      velocity: velocity,\n      max_force: max_force\n    });\n  };\n  Physijs.DOFConstraint.prototype.disableAngularMotor = function(which) {\n    this.scene.execute('dof_disableAngularMotor', {\n      constraint: this.id,\n      which: which\n    });\n  };\n\n  // Physijs.Scene\n  Physijs.Scene = function(params) {\n    var self = this;\n\n    Eventable.call(this);\n    THREE.Scene.call(this);\n\n    this._worker = new Worker(Physijs.scripts.worker || 'physijs_worker.js');\n    this._worker.transferableMessage = this._worker.webkitPostMessage || this._worker.postMessage;\n    this._materials_ref_counts = {};\n    this._objects = {};\n    this._vehicles = {};\n    this._constraints = {};\n\n    var ab = new ArrayBuffer(1);\n    this._worker.transferableMessage(ab, [ab]);\n    SUPPORT_TRANSFERABLE = (ab.byteLength === 0);\n\n    this._worker.onmessage = function(event) {\n      var _temp,\n        data = event.data;\n\n      if (data instanceof ArrayBuffer && data.byteLength !== 1) { // byteLength === 1 is the worker making a SUPPORT_TRANSFERABLE test\n        data = new Float32Array(data);\n      }\n\n      if (data instanceof Float32Array) {\n\n        // transferable object\n        switch (data[0]) {\n          case MESSAGE_TYPES.WORLDREPORT:\n            self._updateScene(data);\n            break;\n\n          case MESSAGE_TYPES.COLLISIONREPORT:\n            self._updateCollisions(data);\n            break;\n\n          case MESSAGE_TYPES.VEHICLEREPORT:\n            self._updateVehicles(data);\n            break;\n\n          case MESSAGE_TYPES.CONSTRAINTREPORT:\n            self._updateConstraints(data);\n            break;\n        }\n\n      }\n      else {\n\n        if (data.cmd) {\n\n          // non-transferable object\n          switch (data.cmd) {\n            case 'objectReady':\n              _temp = data.params;\n              if (self._objects[_temp]) {\n                self._objects[_temp].dispatchEvent('ready');\n              }\n              break;\n\n            case 'worldReady':\n              self.dispatchEvent('ready');\n              break;\n\n            case 'vehicle':\n              window.test = data;\n              break;\n\n            default:\n              // Do nothing, just show the message\n              console.debug('Received: ' + data.cmd);\n              console.dir(data.params);\n              break;\n          }\n\n        }\n        else {\n\n          switch (data[0]) {\n            case MESSAGE_TYPES.WORLDREPORT:\n              self._updateScene(data);\n              break;\n\n            case MESSAGE_TYPES.COLLISIONREPORT:\n              self._updateCollisions(data);\n              break;\n\n            case MESSAGE_TYPES.VEHICLEREPORT:\n              self._updateVehicles(data);\n              break;\n\n            case MESSAGE_TYPES.CONSTRAINTREPORT:\n              self._updateConstraints(data);\n              break;\n          }\n\n        }\n\n      }\n    };\n\n\n    params = params || {};\n    params.ammo = Physijs.scripts.ammo || 'ammo.js';\n    params.fixedTimeStep = params.fixedTimeStep || 1 / 60;\n    params.rateLimit = params.rateLimit || true;\n    this.execute('init', params);\n  };\n  Physijs.Scene.prototype = new THREE.Scene;\n  Physijs.Scene.prototype.constructor = Physijs.Scene;\n  Eventable.make(Physijs.Scene);\n\n  Physijs.Scene.prototype._updateScene = function(data) {\n    var num_objects = data[1],\n      object,\n      i, offset;\n\n    for (i = 0; i < num_objects; i++) {\n      offset = 2 + i * REPORT_ITEMSIZE;\n      object = this._objects[data[offset]];\n\n      if (object === undefined) {\n        continue;\n      }\n\n      if (object.__dirtyPosition === false) {\n        object.position.set(\n          data[offset + 1],\n          data[offset + 2],\n          data[offset + 3]\n        );\n      }\n\n      if (object.__dirtyRotation === false) {\n        object.quaternion.set(\n          data[offset + 4],\n          data[offset + 5],\n          data[offset + 6],\n          data[offset + 7]\n        );\n      }\n\n      object._physijs.linearVelocity.set(\n        data[offset + 8],\n        data[offset + 9],\n        data[offset + 10]\n      );\n\n      object._physijs.angularVelocity.set(\n        data[offset + 11],\n        data[offset + 12],\n        data[offset + 13]\n      );\n\n    }\n\n    if (SUPPORT_TRANSFERABLE) {\n      // Give the typed array back to the worker\n      this._worker.transferableMessage(data.buffer, [data.buffer]);\n    }\n\n    _is_simulating = false;\n    this.dispatchEvent('update');\n  };\n\n  Physijs.Scene.prototype._updateVehicles = function(data) {\n    var vehicle, wheel,\n      i, offset;\n\n    for (i = 0; i < (data.length - 1) / VEHICLEREPORT_ITEMSIZE; i++) {\n      offset = 1 + i * VEHICLEREPORT_ITEMSIZE;\n      vehicle = this._vehicles[data[offset]];\n\n      if (vehicle === undefined) {\n        continue;\n      }\n\n      wheel = vehicle.wheels[data[offset + 1]];\n\n      wheel.position.set(\n        data[offset + 2],\n        data[offset + 3],\n        data[offset + 4]\n      );\n\n      wheel.quaternion.set(\n        data[offset + 5],\n        data[offset + 6],\n        data[offset + 7],\n        data[offset + 8]\n      );\n    }\n\n    if (SUPPORT_TRANSFERABLE) {\n      // Give the typed array back to the worker\n      this._worker.transferableMessage(data.buffer, [data.buffer]);\n    }\n  };\n\n  Physijs.Scene.prototype._updateConstraints = function(data) {\n    var constraint, object,\n      i, offset;\n\n    for (i = 0; i < (data.length - 1) / CONSTRAINTREPORT_ITEMSIZE; i++) {\n      offset = 1 + i * CONSTRAINTREPORT_ITEMSIZE;\n      constraint = this._constraints[data[offset]];\n      object = this._objects[data[offset + 1]];\n\n      if (constraint === undefined || object === undefined) {\n        continue;\n      }\n\n      _temp_vector3_1.set(\n        data[offset + 2],\n        data[offset + 3],\n        data[offset + 4]\n      );\n      _temp_matrix4_1.extractRotation(object.matrix);\n      _temp_vector3_1.applyMatrix4(_temp_matrix4_1);\n\n      constraint.positiona.addVectors(object.position, _temp_vector3_1);\n      constraint.appliedImpulse = data[offset + 5];\n    }\n\n    if (SUPPORT_TRANSFERABLE) {\n      // Give the typed array back to the worker\n      this._worker.transferableMessage(data.buffer, [data.buffer]);\n    }\n  };\n\n  Physijs.Scene.prototype._updateCollisions = function(data) {\n    /**\n     * #TODO\n     * This is probably the worst way ever to handle collisions. The inherent evilness is a residual\n     * effect from the previous version's evilness which mutated when switching to transferable objects.\n     *\n     * If you feel inclined to make this better, please do so.\n     */\n\n    var i, j, offset, object, object2, id1, id2,\n      collisions = {},\n      normal_offsets = {};\n\n    // Build collision manifest\n    for (i = 0; i < data[1]; i++) {\n      offset = 2 + i * COLLISIONREPORT_ITEMSIZE;\n      object = data[offset];\n      object2 = data[offset + 1];\n\n      normal_offsets[object + '-' + object2] = offset + 2;\n      normal_offsets[object2 + '-' + object] = -1 * (offset + 2);\n\n      // Register collisions for both the object colliding and the object being collided with\n      if (!collisions[object]) collisions[object] = [];\n      collisions[object].push(object2);\n\n      if (!collisions[object2]) collisions[object2] = [];\n      collisions[object2].push(object);\n    }\n\n    // Deal with collisions\n    for (id1 in this._objects) {\n      if (!this._objects.hasOwnProperty(id1)) continue;\n      object = this._objects[id1];\n\n      // If object touches anything, ...\n      if (collisions[id1]) {\n\n        // Clean up touches array\n        for (j = 0; j < object._physijs.touches.length; j++) {\n          if (collisions[id1].indexOf(object._physijs.touches[j]) === -1) {\n            object._physijs.touches.splice(j--, 1);\n          }\n        }\n\n        // Handle each colliding object\n        for (j = 0; j < collisions[id1].length; j++) {\n          id2 = collisions[id1][j];\n          object2 = this._objects[id2];\n\n          if (object2) {\n            // If object was not already touching object2, notify object\n            if (object._physijs.touches.indexOf(id2) === -1) {\n              object._physijs.touches.push(id2);\n\n              _temp_vector3_1.subVectors(object.getLinearVelocity(), object2.getLinearVelocity());\n              _temp1 = _temp_vector3_1.clone();\n\n              _temp_vector3_1.subVectors(object.getAngularVelocity(), object2.getAngularVelocity());\n              _temp2 = _temp_vector3_1.clone();\n\n              var normal_offset = normal_offsets[object._physijs.id + '-' + object2._physijs.id];\n              if (normal_offset > 0) {\n                _temp_vector3_1.set(-data[normal_offset], -data[normal_offset + 1], -data[normal_offset + 2]);\n              }\n              else {\n                normal_offset *= -1;\n                _temp_vector3_1.set(\n                  data[normal_offset],\n                  data[normal_offset + 1],\n                  data[normal_offset + 2]\n                );\n              }\n\n              object.dispatchEvent('collision', object2, _temp1, _temp2, _temp_vector3_1);\n            }\n          }\n        }\n\n      }\n      else {\n\n        // not touching other objects\n        object._physijs.touches.length = 0;\n\n      }\n\n    }\n\n    this.collisions = collisions;\n\n    if (SUPPORT_TRANSFERABLE) {\n      // Give the typed array back to the worker\n      this._worker.transferableMessage(data.buffer, [data.buffer]);\n    }\n  };\n\n  Physijs.Scene.prototype.addConstraint = function(constraint, show_marker) {\n    this._constraints[constraint.id] = constraint;\n    this.execute('addConstraint', constraint.getDefinition());\n\n    if (show_marker) {\n      var marker;\n\n      switch (constraint.type) {\n        case 'point':\n          marker = new THREE.Mesh(\n            new THREE.SphereGeometry(1.5),\n            new THREE.MeshNormalMaterial\n          );\n          marker.position.copy(constraint.positiona);\n          this._objects[constraint.objecta].add(marker);\n          break;\n\n        case 'hinge':\n          marker = new THREE.Mesh(\n            new THREE.SphereGeometry(1.5),\n            new THREE.MeshNormalMaterial\n          );\n          marker.position.copy(constraint.positiona);\n          this._objects[constraint.objecta].add(marker);\n          break;\n\n        case 'slider':\n          marker = new THREE.Mesh(\n            new THREE.BoxGeometry(10, 1, 1),\n            new THREE.MeshNormalMaterial\n          );\n          marker.position.copy(constraint.positiona);\n          // This rotation isn't right if all three axis are non-0 values\n          // TODO: change marker's rotation order to ZYX\n          marker.rotation.set(\n            constraint.axis.y, // yes, y and\n            constraint.axis.x, // x axis are swapped\n            constraint.axis.z\n          );\n          this._objects[constraint.objecta].add(marker);\n          break;\n\n        case 'conetwist':\n          marker = new THREE.Mesh(\n            new THREE.SphereGeometry(1.5),\n            new THREE.MeshNormalMaterial\n          );\n          marker.position.copy(constraint.positiona);\n          this._objects[constraint.objecta].add(marker);\n          break;\n\n        case 'dof':\n          marker = new THREE.Mesh(\n            new THREE.SphereGeometry(1.5),\n            new THREE.MeshNormalMaterial\n          );\n          marker.position.copy(constraint.positiona);\n          this._objects[constraint.objecta].add(marker);\n          break;\n      }\n    }\n\n    return constraint;\n  };\n\n  Physijs.Scene.prototype.onSimulationResume = function() {\n    this.execute('onSimulationResume', {});\n  };\n\n  Physijs.Scene.prototype.removeConstraint = function(constraint) {\n    if (this._constraints[constraint.id] !== undefined) {\n      this.execute('removeConstraint', {\n        id: constraint.id\n      });\n      delete this._constraints[constraint.id];\n    }\n  };\n\n  Physijs.Scene.prototype.execute = function(cmd, params) {\n    this._worker.postMessage({\n      cmd: cmd,\n      params: params\n    });\n  };\n\n  addObjectChildren = function(parent, object) {\n    var i;\n\n    for (i = 0; i < object.children.length; i++) {\n      if (object.children[i]._physijs) {\n        object.children[i].updateMatrix();\n        object.children[i].updateMatrixWorld();\n\n        _temp_vector3_1.setFromMatrixPosition(object.children[i].matrixWorld);\n        _quaternion_1.setFromRotationMatrix(object.children[i].matrixWorld);\n\n        object.children[i]._physijs.position_offset = {\n          x: _temp_vector3_1.x,\n          y: _temp_vector3_1.y,\n          z: _temp_vector3_1.z\n        };\n\n        object.children[i]._physijs.rotation = {\n          x: _quaternion_1.x,\n          y: _quaternion_1.y,\n          z: _quaternion_1.z,\n          w: _quaternion_1.w\n        };\n\n        parent._physijs.children.push(object.children[i]._physijs);\n      }\n\n      addObjectChildren(parent, object.children[i]);\n    }\n  };\n\n  Physijs.Scene.prototype.add = function(object) {\n    THREE.Mesh.prototype.add.call(this, object);\n\n    if (object._physijs) {\n\n      object.world = this;\n\n      if (object instanceof Physijs.Vehicle) {\n\n        this.add(object.mesh);\n        this._vehicles[object._physijs.id] = object;\n        this.execute('addVehicle', object._physijs);\n\n      }\n      else {\n\n        object.__dirtyPosition = false;\n        object.__dirtyRotation = false;\n        this._objects[object._physijs.id] = object;\n\n        if (object.children.length) {\n          object._physijs.children = [];\n          addObjectChildren(object, object);\n        }\n\n        if (object.material._physijs) {\n          if (!this._materials_ref_counts.hasOwnProperty(object.material._physijs.id)) {\n            this.execute('registerMaterial', object.material._physijs);\n            object._physijs.materialId = object.material._physijs.id;\n            this._materials_ref_counts[object.material._physijs.id] = 1;\n          }\n          else {\n            this._materials_ref_counts[object.material._physijs.id]++;\n          }\n        }\n\n        // Object starting position + rotation\n        object._physijs.position = {\n          x: object.position.x,\n          y: object.position.y,\n          z: object.position.z\n        };\n        object._physijs.rotation = {\n          x: object.quaternion.x,\n          y: object.quaternion.y,\n          z: object.quaternion.z,\n          w: object.quaternion.w\n        };\n\n        // Check for scaling\n        var mass_scaling = new THREE.Vector3(1, 1, 1);\n        if (object._physijs.width) {\n          object._physijs.width *= object.scale.x;\n        }\n        if (object._physijs.height) {\n          object._physijs.height *= object.scale.y;\n        }\n        if (object._physijs.depth) {\n          object._physijs.depth *= object.scale.z;\n        }\n\n        this.execute('addObject', object._physijs);\n\n      }\n    }\n  };\n\n  Physijs.Scene.prototype.remove = function(object) {\n    if (object instanceof Physijs.Vehicle) {\n      this.execute('removeVehicle', {\n        id: object._physijs.id\n      });\n      while (object.wheels.length) {\n        this.remove(object.wheels.pop());\n      }\n      this.remove(object.mesh);\n      delete this._vehicles[object._physijs.id];\n    }\n    else {\n      THREE.Mesh.prototype.remove.call(this, object);\n      if (object._physijs) {\n        delete this._objects[object._physijs.id];\n        this.execute('removeObject', {\n          id: object._physijs.id\n        });\n      }\n    }\n    if (object.material && object.material._physijs && this._materials_ref_counts.hasOwnProperty(object.material._physijs.id)) {\n      this._materials_ref_counts[object.material._physijs.id]--;\n      if (this._materials_ref_counts[object.material._physijs.id] == 0) {\n        this.execute('unRegisterMaterial', object.material._physijs);\n        delete this._materials_ref_counts[object.material._physijs.id];\n      }\n    }\n  };\n\n  Physijs.Scene.prototype.setFixedTimeStep = function(fixedTimeStep) {\n    if (fixedTimeStep) {\n      this.execute('setFixedTimeStep', fixedTimeStep);\n    }\n  };\n\n  Physijs.Scene.prototype.setGravity = function(gravity) {\n    if (gravity) {\n      this.execute('setGravity', gravity);\n    }\n  };\n\n  Physijs.Scene.prototype.simulate = function(timeStep, maxSubSteps) {\n    var object_id, object, update;\n\n    if (_is_simulating) {\n      return false;\n    }\n\n    _is_simulating = true;\n\n    for (object_id in this._objects) {\n      if (!this._objects.hasOwnProperty(object_id)) continue;\n\n      object = this._objects[object_id];\n\n      if (object.__dirtyPosition || object.__dirtyRotation) {\n        update = {\n          id: object._physijs.id\n        };\n\n        if (object.__dirtyPosition) {\n          update.pos = {\n            x: object.position.x,\n            y: object.position.y,\n            z: object.position.z\n          };\n          object.__dirtyPosition = false;\n        }\n\n        if (object.__dirtyRotation) {\n          update.quat = {\n            x: object.quaternion.x,\n            y: object.quaternion.y,\n            z: object.quaternion.z,\n            w: object.quaternion.w\n          };\n          object.__dirtyRotation = false;\n        }\n\n        this.execute('updateTransform', update);\n      }\n    }\n\n    this.execute('simulate', {\n      timeStep: timeStep,\n      maxSubSteps: maxSubSteps\n    });\n\n    return true;\n  };\n\n\n  // Phsijs.Mesh\n  Physijs.Mesh = function(geometry, material, mass) {\n    var index;\n\n    if (!geometry) {\n      return;\n    }\n\n    Eventable.call(this);\n    THREE.Mesh.call(this, geometry, material);\n\n    if (!geometry.boundingBox) {\n      geometry.computeBoundingBox();\n    }\n\n    this._physijs = {\n      type: null,\n      id: getObjectId(),\n      mass: mass || 0,\n      touches: [],\n      linearVelocity: new THREE.Vector3,\n      angularVelocity: new THREE.Vector3\n    };\n  };\n  Physijs.Mesh.prototype = new THREE.Mesh;\n  Physijs.Mesh.prototype.constructor = Physijs.Mesh;\n  Eventable.make(Physijs.Mesh);\n\n  // Physijs.Mesh.mass\n  Physijs.Mesh.prototype.__defineGetter__('mass', function() {\n    return this._physijs.mass;\n  });\n  Physijs.Mesh.prototype.__defineSetter__('mass', function(mass) {\n    this._physijs.mass = mass;\n    if (this.world) {\n      this.world.execute('updateMass', {\n        id: this._physijs.id,\n        mass: mass\n      });\n    }\n  });\n\n  // Physijs.Mesh.applyCentralImpulse\n  Physijs.Mesh.prototype.applyCentralImpulse = function(force) {\n    if (this.world) {\n      this.world.execute('applyCentralImpulse', {\n        id: this._physijs.id,\n        x: force.x,\n        y: force.y,\n        z: force.z\n      });\n    }\n  };\n\n  // Physijs.Mesh.applyImpulse\n  Physijs.Mesh.prototype.applyImpulse = function(force, offset) {\n    if (this.world) {\n      this.world.execute('applyImpulse', {\n        id: this._physijs.id,\n        impulse_x: force.x,\n        impulse_y: force.y,\n        impulse_z: force.z,\n        x: offset.x,\n        y: offset.y,\n        z: offset.z\n      });\n    }\n  };\n\n  // Physijs.Mesh.applyTorque\n  Physijs.Mesh.prototype.applyTorque = function(force) {\n    if (this.world) {\n      this.world.execute('applyTorque', {\n        id: this._physijs.id,\n        torque_x: force.x,\n        torque_y: force.y,\n        torque_z: force.z\n      });\n    }\n  };\n\n  // Physijs.Mesh.applyCentralForce\n  Physijs.Mesh.prototype.applyCentralForce = function(force) {\n    if (this.world) {\n      this.world.execute('applyCentralForce', {\n        id: this._physijs.id,\n        x: force.x,\n        y: force.y,\n        z: force.z\n      });\n    }\n  };\n\n  // Physijs.Mesh.applyForce\n  Physijs.Mesh.prototype.applyForce = function(force, offset) {\n    if (this.world) {\n      this.world.execute('applyForce', {\n        id: this._physijs.id,\n        force_x: force.x,\n        force_y: force.y,\n        force_z: force.z,\n        x: offset.x,\n        y: offset.y,\n        z: offset.z\n      });\n    }\n  };\n\n  // Physijs.Mesh.getAngularVelocity\n  Physijs.Mesh.prototype.getAngularVelocity = function() {\n    return this._physijs.angularVelocity;\n  };\n\n  // Physijs.Mesh.setAngularVelocity\n  Physijs.Mesh.prototype.setAngularVelocity = function(velocity) {\n    if (this.world) {\n      this.world.execute('setAngularVelocity', {\n        id: this._physijs.id,\n        x: velocity.x,\n        y: velocity.y,\n        z: velocity.z\n      });\n    }\n  };\n\n  // Physijs.Mesh.getLinearVelocity\n  Physijs.Mesh.prototype.getLinearVelocity = function() {\n    return this._physijs.linearVelocity;\n  };\n\n  // Physijs.Mesh.setLinearVelocity\n  Physijs.Mesh.prototype.setLinearVelocity = function(velocity) {\n    if (this.world) {\n      this.world.execute('setLinearVelocity', {\n        id: this._physijs.id,\n        x: velocity.x,\n        y: velocity.y,\n        z: velocity.z\n      });\n    }\n  };\n\n  // Physijs.Mesh.setAngularFactor\n  Physijs.Mesh.prototype.setAngularFactor = function(factor) {\n    if (this.world) {\n      this.world.execute('setAngularFactor', {\n        id: this._physijs.id,\n        x: factor.x,\n        y: factor.y,\n        z: factor.z\n      });\n    }\n  };\n\n  // Physijs.Mesh.setLinearFactor\n  Physijs.Mesh.prototype.setLinearFactor = function(factor) {\n    if (this.world) {\n      this.world.execute('setLinearFactor', {\n        id: this._physijs.id,\n        x: factor.x,\n        y: factor.y,\n        z: factor.z\n      });\n    }\n  };\n\n  // Physijs.Mesh.setDamping\n  Physijs.Mesh.prototype.setDamping = function(linear, angular) {\n    if (this.world) {\n      this.world.execute('setDamping', {\n        id: this._physijs.id,\n        linear: linear,\n        angular: angular\n      });\n    }\n  };\n\n  // Physijs.Mesh.setCcdMotionThreshold\n  Physijs.Mesh.prototype.setCcdMotionThreshold = function(threshold) {\n    if (this.world) {\n      this.world.execute('setCcdMotionThreshold', {\n        id: this._physijs.id,\n        threshold: threshold\n      });\n    }\n  };\n\n  // Physijs.Mesh.setCcdSweptSphereRadius\n  Physijs.Mesh.prototype.setCcdSweptSphereRadius = function(radius) {\n    if (this.world) {\n      this.world.execute('setCcdSweptSphereRadius', {\n        id: this._physijs.id,\n        radius: radius\n      });\n    }\n  };\n\n\n  // Physijs.PlaneMesh\n  Physijs.PlaneMesh = function(geometry, material, mass) {\n    var width, height;\n\n    Physijs.Mesh.call(this, geometry, material, mass);\n\n    if (!geometry.boundingBox) {\n      geometry.computeBoundingBox();\n    }\n\n    width = geometry.boundingBox.max.x - geometry.boundingBox.min.x;\n    height = geometry.boundingBox.max.y - geometry.boundingBox.min.y;\n\n    this._physijs.type = 'plane';\n    this._physijs.normal = geometry.faces[0].normal.clone();\n    this._physijs.mass = (typeof mass === 'undefined') ? width * height : mass;\n  };\n  Physijs.PlaneMesh.prototype = new Physijs.Mesh;\n  Physijs.PlaneMesh.prototype.constructor = Physijs.PlaneMesh;\n\n  // Physijs.HeightfieldMesh\n  Physijs.HeightfieldMesh = function(geometry, material, mass, xdiv, ydiv) {\n    Physijs.Mesh.call(this, geometry, material, mass);\n\n    this._physijs.type = 'heightfield';\n    this._physijs.xsize = geometry.boundingBox.max.x - geometry.boundingBox.min.x;\n    this._physijs.ysize = geometry.boundingBox.max.y - geometry.boundingBox.min.y;\n    this._physijs.xpts = (typeof xdiv === 'undefined') ? Math.sqrt(geometry.vertices.length) : xdiv + 1;\n    this._physijs.ypts = (typeof ydiv === 'undefined') ? Math.sqrt(geometry.vertices.length) : ydiv + 1;\n    // note - this assumes our plane geometry is square, unless we pass in specific xdiv and ydiv\n    this._physijs.absMaxHeight = Math.max(geometry.boundingBox.max.z, Math.abs(geometry.boundingBox.min.z));\n\n    var points = [];\n\n    var a, b;\n    for (var i = 0; i < geometry.vertices.length; i++) {\n\n      a = i % this._physijs.xpts;\n      b = Math.round((i / this._physijs.xpts) - ((i % this._physijs.xpts) / this._physijs.xpts));\n      points[i] = geometry.vertices[a + ((this._physijs.ypts - b - 1) * this._physijs.ypts)].z;\n\n      //points[i] = geometry.vertices[i];\n    }\n\n    this._physijs.points = points;\n  };\n  Physijs.HeightfieldMesh.prototype = new Physijs.Mesh;\n  Physijs.HeightfieldMesh.prototype.constructor = Physijs.HeightfieldMesh;\n\n  // Physijs.BoxMesh\n  Physijs.BoxMesh = function(geometry, material, mass) {\n    var width, height, depth;\n\n    Physijs.Mesh.call(this, geometry, material, mass);\n\n    if (!geometry.boundingBox) {\n      geometry.computeBoundingBox();\n    }\n\n    width = geometry.boundingBox.max.x - geometry.boundingBox.min.x;\n    height = geometry.boundingBox.max.y - geometry.boundingBox.min.y;\n    depth = geometry.boundingBox.max.z - geometry.boundingBox.min.z;\n\n    this._physijs.type = 'box';\n    this._physijs.width = width;\n    this._physijs.height = height;\n    this._physijs.depth = depth;\n    this._physijs.mass = (typeof mass === 'undefined') ? width * height * depth : mass;\n  };\n  Physijs.BoxMesh.prototype = new Physijs.Mesh;\n  Physijs.BoxMesh.prototype.constructor = Physijs.BoxMesh;\n\n\n  // Physijs.SphereMesh\n  Physijs.SphereMesh = function(geometry, material, mass) {\n    Physijs.Mesh.call(this, geometry, material, mass);\n\n    if (!geometry.boundingSphere) {\n      geometry.computeBoundingSphere();\n    }\n\n    this._physijs.type = 'sphere';\n    this._physijs.radius = geometry.boundingSphere.radius;\n    this._physijs.mass = (typeof mass === 'undefined') ? (4 / 3) * Math.PI * Math.pow(this._physijs.radius, 3) : mass;\n  };\n  Physijs.SphereMesh.prototype = new Physijs.Mesh;\n  Physijs.SphereMesh.prototype.constructor = Physijs.SphereMesh;\n\n\n  // Physijs.CylinderMesh\n  Physijs.CylinderMesh = function(geometry, material, mass) {\n    var width, height, depth;\n\n    Physijs.Mesh.call(this, geometry, material, mass);\n\n    if (!geometry.boundingBox) {\n      geometry.computeBoundingBox();\n    }\n\n    width = geometry.boundingBox.max.x - geometry.boundingBox.min.x;\n    height = geometry.boundingBox.max.y - geometry.boundingBox.min.y;\n    depth = geometry.boundingBox.max.z - geometry.boundingBox.min.z;\n\n    this._physijs.type = 'cylinder';\n    this._physijs.width = width;\n    this._physijs.height = height;\n    this._physijs.depth = depth;\n    this._physijs.mass = (typeof mass === 'undefined') ? width * height * depth : mass;\n  };\n  Physijs.CylinderMesh.prototype = new Physijs.Mesh;\n  Physijs.CylinderMesh.prototype.constructor = Physijs.CylinderMesh;\n\n\n  // Physijs.CapsuleMesh\n  Physijs.CapsuleMesh = function(geometry, material, mass) {\n    var width, height, depth;\n\n    Physijs.Mesh.call(this, geometry, material, mass);\n\n    if (!geometry.boundingBox) {\n      geometry.computeBoundingBox();\n    }\n\n    width = geometry.boundingBox.max.x - geometry.boundingBox.min.x;\n    height = geometry.boundingBox.max.y - geometry.boundingBox.min.y;\n    depth = geometry.boundingBox.max.z - geometry.boundingBox.min.z;\n\n    this._physijs.type = 'capsule';\n    this._physijs.radius = Math.max(width / 2, depth / 2);\n    this._physijs.height = height;\n    this._physijs.mass = (typeof mass === 'undefined') ? width * height * depth : mass;\n  };\n  Physijs.CapsuleMesh.prototype = new Physijs.Mesh;\n  Physijs.CapsuleMesh.prototype.constructor = Physijs.CapsuleMesh;\n\n\n  // Physijs.ConeMesh\n  Physijs.ConeMesh = function(geometry, material, mass) {\n    var width, height, depth;\n\n    Physijs.Mesh.call(this, geometry, material, mass);\n\n    if (!geometry.boundingBox) {\n      geometry.computeBoundingBox();\n    }\n\n    width = geometry.boundingBox.max.x - geometry.boundingBox.min.x;\n    height = geometry.boundingBox.max.y - geometry.boundingBox.min.y;\n\n    this._physijs.type = 'cone';\n    this._physijs.radius = width / 2;\n    this._physijs.height = height;\n    this._physijs.mass = (typeof mass === 'undefined') ? width * height : mass;\n  };\n  Physijs.ConeMesh.prototype = new Physijs.Mesh;\n  Physijs.ConeMesh.prototype.constructor = Physijs.ConeMesh;\n\n\n  // Physijs.ConcaveMesh\n  Physijs.ConcaveMesh = function(geometry, material, mass) {\n    var i,\n      width, height, depth,\n      vertices, face, triangles = [];\n\n    Physijs.Mesh.call(this, geometry, material, mass);\n\n    if (!geometry.boundingBox) {\n      geometry.computeBoundingBox();\n    }\n\n    vertices = geometry.vertices;\n\n    for (i = 0; i < geometry.faces.length; i++) {\n      face = geometry.faces[i];\n      if (face instanceof THREE.Face3) {\n\n        triangles.push([\n          {\n            x: vertices[face.a].x,\n            y: vertices[face.a].y,\n            z: vertices[face.a].z\n          },\n          {\n            x: vertices[face.b].x,\n            y: vertices[face.b].y,\n            z: vertices[face.b].z\n          },\n          {\n            x: vertices[face.c].x,\n            y: vertices[face.c].y,\n            z: vertices[face.c].z\n          }\n    ]);\n\n      }\n      else if (face instanceof THREE.Face4) {\n\n        triangles.push([\n          {\n            x: vertices[face.a].x,\n            y: vertices[face.a].y,\n            z: vertices[face.a].z\n          },\n          {\n            x: vertices[face.b].x,\n            y: vertices[face.b].y,\n            z: vertices[face.b].z\n          },\n          {\n            x: vertices[face.d].x,\n            y: vertices[face.d].y,\n            z: vertices[face.d].z\n          }\n    ]);\n        triangles.push([\n          {\n            x: vertices[face.b].x,\n            y: vertices[face.b].y,\n            z: vertices[face.b].z\n          },\n          {\n            x: vertices[face.c].x,\n            y: vertices[face.c].y,\n            z: vertices[face.c].z\n          },\n          {\n            x: vertices[face.d].x,\n            y: vertices[face.d].y,\n            z: vertices[face.d].z\n          }\n    ]);\n\n      }\n    }\n\n    width = geometry.boundingBox.max.x - geometry.boundingBox.min.x;\n    height = geometry.boundingBox.max.y - geometry.boundingBox.min.y;\n    depth = geometry.boundingBox.max.z - geometry.boundingBox.min.z;\n\n    this._physijs.type = 'concave';\n    this._physijs.triangles = triangles;\n    this._physijs.mass = (typeof mass === 'undefined') ? width * height * depth : mass;\n  };\n  Physijs.ConcaveMesh.prototype = new Physijs.Mesh;\n  Physijs.ConcaveMesh.prototype.constructor = Physijs.ConcaveMesh;\n\n\n  // Physijs.ConvexMesh\n  Physijs.ConvexMesh = function(geometry, material, mass) {\n    var i,\n      width, height, depth,\n      points = [];\n\n    Physijs.Mesh.call(this, geometry, material, mass);\n\n    if (!geometry.boundingBox) {\n      geometry.computeBoundingBox();\n    }\n\n    for (i = 0; i < geometry.vertices.length; i++) {\n      points.push({\n        x: geometry.vertices[i].x,\n        y: geometry.vertices[i].y,\n        z: geometry.vertices[i].z\n      });\n    }\n\n\n    width = geometry.boundingBox.max.x - geometry.boundingBox.min.x;\n    height = geometry.boundingBox.max.y - geometry.boundingBox.min.y;\n    depth = geometry.boundingBox.max.z - geometry.boundingBox.min.z;\n\n    this._physijs.type = 'convex';\n    this._physijs.points = points;\n    this._physijs.mass = (typeof mass === 'undefined') ? width * height * depth : mass;\n  };\n  Physijs.ConvexMesh.prototype = new Physijs.Mesh;\n  Physijs.ConvexMesh.prototype.constructor = Physijs.ConvexMesh;\n\n\n  // Physijs.Vehicle\n  Physijs.Vehicle = function(mesh, tuning) {\n    tuning = tuning || new Physijs.VehicleTuning;\n    this.mesh = mesh;\n    this.wheels = [];\n    this._physijs = {\n      id: getObjectId(),\n      rigidBody: mesh._physijs.id,\n      suspension_stiffness: tuning.suspension_stiffness,\n      suspension_compression: tuning.suspension_compression,\n      suspension_damping: tuning.suspension_damping,\n      max_suspension_travel: tuning.max_suspension_travel,\n      friction_slip: tuning.friction_slip,\n      max_suspension_force: tuning.max_suspension_force\n    };\n  };\n  Physijs.Vehicle.prototype.addWheel = function(wheel_geometry, wheel_material, connection_point, wheel_direction, wheel_axle, suspension_rest_length, wheel_radius, is_front_wheel, tuning) {\n    var wheel = new THREE.Mesh(wheel_geometry, wheel_material);\n    wheel.castShadow = wheel.receiveShadow = true;\n    wheel.position.copy(wheel_direction).multiplyScalar(suspension_rest_length / 100).add(connection_point);\n    this.world.add(wheel);\n    this.wheels.push(wheel);\n\n    this.world.execute('addWheel', {\n      id: this._physijs.id,\n      connection_point: {\n        x: connection_point.x,\n        y: connection_point.y,\n        z: connection_point.z\n      },\n      wheel_direction: {\n        x: wheel_direction.x,\n        y: wheel_direction.y,\n        z: wheel_direction.z\n      },\n      wheel_axle: {\n        x: wheel_axle.x,\n        y: wheel_axle.y,\n        z: wheel_axle.z\n      },\n      suspension_rest_length: suspension_rest_length,\n      wheel_radius: wheel_radius,\n      is_front_wheel: is_front_wheel,\n      tuning: tuning\n    });\n  };\n  Physijs.Vehicle.prototype.setSteering = function(amount, wheel) {\n    if (wheel !== undefined && this.wheels[wheel] !== undefined) {\n      this.world.execute('setSteering', {\n        id: this._physijs.id,\n        wheel: wheel,\n        steering: amount\n      });\n    }\n    else if (this.wheels.length > 0) {\n      for (var i = 0; i < this.wheels.length; i++) {\n        this.world.execute('setSteering', {\n          id: this._physijs.id,\n          wheel: i,\n          steering: amount\n        });\n      }\n    }\n  };\n  Physijs.Vehicle.prototype.setBrake = function(amount, wheel) {\n    if (wheel !== undefined && this.wheels[wheel] !== undefined) {\n      this.world.execute('setBrake', {\n        id: this._physijs.id,\n        wheel: wheel,\n        brake: amount\n      });\n    }\n    else if (this.wheels.length > 0) {\n      for (var i = 0; i < this.wheels.length; i++) {\n        this.world.execute('setBrake', {\n          id: this._physijs.id,\n          wheel: i,\n          brake: amount\n        });\n      }\n    }\n  };\n  Physijs.Vehicle.prototype.applyEngineForce = function(amount, wheel) {\n    if (wheel !== undefined && this.wheels[wheel] !== undefined) {\n      this.world.execute('applyEngineForce', {\n        id: this._physijs.id,\n        wheel: wheel,\n        force: amount\n      });\n    }\n    else if (this.wheels.length > 0) {\n      for (var i = 0; i < this.wheels.length; i++) {\n        this.world.execute('applyEngineForce', {\n          id: this._physijs.id,\n          wheel: i,\n          force: amount\n        });\n      }\n    }\n  };\n\n  // Physijs.VehicleTuning\n  Physijs.VehicleTuning = function(suspension_stiffness, suspension_compression, suspension_damping, max_suspension_travel, friction_slip, max_suspension_force) {\n    this.suspension_stiffness = suspension_stiffness !== undefined ? suspension_stiffness : 5.88;\n    this.suspension_compression = suspension_compression !== undefined ? suspension_compression : 0.83;\n    this.suspension_damping = suspension_damping !== undefined ? suspension_damping : 0.88;\n    this.max_suspension_travel = max_suspension_travel !== undefined ? max_suspension_travel : 500;\n    this.friction_slip = friction_slip !== undefined ? friction_slip : 10.5;\n    this.max_suspension_force = max_suspension_force !== undefined ? max_suspension_force : 6000;\n  };\n\n  return Physijs;\n}","/**\n * @author mrdoob / http://mrdoob.com/\n */\n\nvar Stats = function () {\n\n\tvar startTime = Date.now(), prevTime = startTime;\n\tvar ms = 0, msMin = Infinity, msMax = 0;\n\tvar fps = 0, fpsMin = Infinity, fpsMax = 0;\n\tvar frames = 0, mode = 0;\n\n\tvar container = document.createElement( 'div' );\n\tcontainer.id = 'stats';\n\tcontainer.addEventListener( 'mousedown', function ( event ) { event.preventDefault(); setMode( ++ mode % 2 ) }, false );\n\tcontainer.style.cssText = 'width:80px;opacity:0.9;cursor:pointer';\n\n\tvar fpsDiv = document.createElement( 'div' );\n\tfpsDiv.id = 'fps';\n\tfpsDiv.style.cssText = 'padding:0 0 3px 3px;text-align:left;background-color:#002';\n\tcontainer.appendChild( fpsDiv );\n\n\tvar fpsText = document.createElement( 'div' );\n\tfpsText.id = 'fpsText';\n\tfpsText.style.cssText = 'color:#0ff;font-family:Helvetica,Arial,sans-serif;font-size:9px;font-weight:bold;line-height:15px';\n\tfpsText.innerHTML = 'FPS';\n\tfpsDiv.appendChild( fpsText );\n\n\tvar fpsGraph = document.createElement( 'div' );\n\tfpsGraph.id = 'fpsGraph';\n\tfpsGraph.style.cssText = 'position:relative;width:74px;height:30px;background-color:#0ff';\n\tfpsDiv.appendChild( fpsGraph );\n\n\twhile ( fpsGraph.children.length < 74 ) {\n\n\t\tvar bar = document.createElement( 'span' );\n\t\tbar.style.cssText = 'width:1px;height:30px;float:left;background-color:#113';\n\t\tfpsGraph.appendChild( bar );\n\n\t}\n\n\tvar msDiv = document.createElement( 'div' );\n\tmsDiv.id = 'ms';\n\tmsDiv.style.cssText = 'padding:0 0 3px 3px;text-align:left;background-color:#020;display:none';\n\tcontainer.appendChild( msDiv );\n\n\tvar msText = document.createElement( 'div' );\n\tmsText.id = 'msText';\n\tmsText.style.cssText = 'color:#0f0;font-family:Helvetica,Arial,sans-serif;font-size:9px;font-weight:bold;line-height:15px';\n\tmsText.innerHTML = 'MS';\n\tmsDiv.appendChild( msText );\n\n\tvar msGraph = document.createElement( 'div' );\n\tmsGraph.id = 'msGraph';\n\tmsGraph.style.cssText = 'position:relative;width:74px;height:30px;background-color:#0f0';\n\tmsDiv.appendChild( msGraph );\n\n\twhile ( msGraph.children.length < 74 ) {\n\n\t\tvar bar = document.createElement( 'span' );\n\t\tbar.style.cssText = 'width:1px;height:30px;float:left;background-color:#131';\n\t\tmsGraph.appendChild( bar );\n\n\t}\n\n\tvar setMode = function ( value ) {\n\n\t\tmode = value;\n\n\t\tswitch ( mode ) {\n\n\t\t\tcase 0:\n\t\t\t\tfpsDiv.style.display = 'block';\n\t\t\t\tmsDiv.style.display = 'none';\n\t\t\t\tbreak;\n\t\t\tcase 1:\n\t\t\t\tfpsDiv.style.display = 'none';\n\t\t\t\tmsDiv.style.display = 'block';\n\t\t\t\tbreak;\n\t\t}\n\n\t};\n\n\tvar updateGraph = function ( dom, value ) {\n\n\t\tvar child = dom.appendChild( dom.firstChild );\n\t\tchild.style.height = value + 'px';\n\n\t};\n\n\treturn {\n\n\t\tREVISION: 12,\n\n\t\tdomElement: container,\n\n\t\tsetMode: setMode,\n\n\t\tbegin: function () {\n\n\t\t\tstartTime = Date.now();\n\n\t\t},\n\n\t\tend: function () {\n\n\t\t\tvar time = Date.now();\n\n\t\t\tms = time - startTime;\n\t\t\tmsMin = Math.min( msMin, ms );\n\t\t\tmsMax = Math.max( msMax, ms );\n\n\t\t\tmsText.textContent = ms + ' MS (' + msMin + '-' + msMax + ')';\n\t\t\tupdateGraph( msGraph, Math.min( 30, 30 - ( ms / 200 ) * 30 ) );\n\n\t\t\tframes ++;\n\n\t\t\tif ( time > prevTime + 1000 ) {\n\n\t\t\t\tfps = Math.round( ( frames * 1000 ) / ( time - prevTime ) );\n\t\t\t\tfpsMin = Math.min( fpsMin, fps );\n\t\t\t\tfpsMax = Math.max( fpsMax, fps );\n\n\t\t\t\tfpsText.textContent = fps + ' FPS (' + fpsMin + '-' + fpsMax + ')';\n\t\t\t\tupdateGraph( fpsGraph, Math.min( 30, 30 - ( fps / 100 ) * 30 ) );\n\n\t\t\t\tprevTime = time;\n\t\t\t\tframes = 0;\n\n\t\t\t}\n\n\t\t\treturn time;\n\n\t\t},\n\n\t\tupdate: function () {\n\n\t\t\tstartTime = this.end();\n\n\t\t}\n\n\t}\n\n};\n\nif ( typeof module === 'object' ) {\n\n\tmodule.exports = Stats;\n\n}","var self = self || {};// File:src/Three.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nvar THREE = { REVISION: '71' };\r\n\r\n// browserify support\r\n\r\nif ( typeof module === 'object' ) {\r\n\r\n\tmodule.exports = THREE;\r\n\r\n}\r\n\r\n// polyfills\r\n\r\nif ( Math.sign === undefined ) {\r\n\r\n\t// https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Math/sign\r\n\r\n\tMath.sign = function ( x ) {\r\n\r\n\t\treturn ( x < 0 ) ? - 1 : ( x > 0 ) ? 1 : +x;\r\n\r\n\t};\r\n\r\n}\r\n\r\n\r\n// set the default log handlers\r\nTHREE.log = function() { console.log.apply( console, arguments ); }\r\nTHREE.warn = function() { console.warn.apply( console, arguments ); }\r\nTHREE.error = function() { console.error.apply( console, arguments ); }\r\n\r\n\r\n// https://developer.mozilla.org/en-US/docs/Web/API/MouseEvent.button\r\n\r\nTHREE.MOUSE = { LEFT: 0, MIDDLE: 1, RIGHT: 2 };\r\n\r\n// GL STATE CONSTANTS\r\n\r\nTHREE.CullFaceNone = 0;\r\nTHREE.CullFaceBack = 1;\r\nTHREE.CullFaceFront = 2;\r\nTHREE.CullFaceFrontBack = 3;\r\n\r\nTHREE.FrontFaceDirectionCW = 0;\r\nTHREE.FrontFaceDirectionCCW = 1;\r\n\r\n// SHADOWING TYPES\r\n\r\nTHREE.BasicShadowMap = 0;\r\nTHREE.PCFShadowMap = 1;\r\nTHREE.PCFSoftShadowMap = 2;\r\n\r\n// MATERIAL CONSTANTS\r\n\r\n// side\r\n\r\nTHREE.FrontSide = 0;\r\nTHREE.BackSide = 1;\r\nTHREE.DoubleSide = 2;\r\n\r\n// shading\r\n\r\nTHREE.NoShading = 0;\r\nTHREE.FlatShading = 1;\r\nTHREE.SmoothShading = 2;\r\n\r\n// colors\r\n\r\nTHREE.NoColors = 0;\r\nTHREE.FaceColors = 1;\r\nTHREE.VertexColors = 2;\r\n\r\n// blending modes\r\n\r\nTHREE.NoBlending = 0;\r\nTHREE.NormalBlending = 1;\r\nTHREE.AdditiveBlending = 2;\r\nTHREE.SubtractiveBlending = 3;\r\nTHREE.MultiplyBlending = 4;\r\nTHREE.CustomBlending = 5;\r\n\r\n// custom blending equations\r\n// (numbers start from 100 not to clash with other\r\n//  mappings to OpenGL constants defined in Texture.js)\r\n\r\nTHREE.AddEquation = 100;\r\nTHREE.SubtractEquation = 101;\r\nTHREE.ReverseSubtractEquation = 102;\r\nTHREE.MinEquation = 103;\r\nTHREE.MaxEquation = 104;\r\n\r\n// custom blending destination factors\r\n\r\nTHREE.ZeroFactor = 200;\r\nTHREE.OneFactor = 201;\r\nTHREE.SrcColorFactor = 202;\r\nTHREE.OneMinusSrcColorFactor = 203;\r\nTHREE.SrcAlphaFactor = 204;\r\nTHREE.OneMinusSrcAlphaFactor = 205;\r\nTHREE.DstAlphaFactor = 206;\r\nTHREE.OneMinusDstAlphaFactor = 207;\r\n\r\n// custom blending source factors\r\n\r\n//THREE.ZeroFactor = 200;\r\n//THREE.OneFactor = 201;\r\n//THREE.SrcAlphaFactor = 204;\r\n//THREE.OneMinusSrcAlphaFactor = 205;\r\n//THREE.DstAlphaFactor = 206;\r\n//THREE.OneMinusDstAlphaFactor = 207;\r\nTHREE.DstColorFactor = 208;\r\nTHREE.OneMinusDstColorFactor = 209;\r\nTHREE.SrcAlphaSaturateFactor = 210;\r\n\r\n\r\n// TEXTURE CONSTANTS\r\n\r\nTHREE.MultiplyOperation = 0;\r\nTHREE.MixOperation = 1;\r\nTHREE.AddOperation = 2;\r\n\r\n// Mapping modes\r\n\r\nTHREE.UVMapping = 300;\r\n\r\nTHREE.CubeReflectionMapping = 301;\r\nTHREE.CubeRefractionMapping = 302;\r\n\r\nTHREE.EquirectangularReflectionMapping = 303;\r\nTHREE.EquirectangularRefractionMapping = 304;\r\n\r\nTHREE.SphericalReflectionMapping = 305;\r\n\r\n// Wrapping modes\r\n\r\nTHREE.RepeatWrapping = 1000;\r\nTHREE.ClampToEdgeWrapping = 1001;\r\nTHREE.MirroredRepeatWrapping = 1002;\r\n\r\n// Filters\r\n\r\nTHREE.NearestFilter = 1003;\r\nTHREE.NearestMipMapNearestFilter = 1004;\r\nTHREE.NearestMipMapLinearFilter = 1005;\r\nTHREE.LinearFilter = 1006;\r\nTHREE.LinearMipMapNearestFilter = 1007;\r\nTHREE.LinearMipMapLinearFilter = 1008;\r\n\r\n// Data types\r\n\r\nTHREE.UnsignedByteType = 1009;\r\nTHREE.ByteType = 1010;\r\nTHREE.ShortType = 1011;\r\nTHREE.UnsignedShortType = 1012;\r\nTHREE.IntType = 1013;\r\nTHREE.UnsignedIntType = 1014;\r\nTHREE.FloatType = 1015;\r\nTHREE.HalfFloatType = 1025;\r\n\r\n// Pixel types\r\n\r\n//THREE.UnsignedByteType = 1009;\r\nTHREE.UnsignedShort4444Type = 1016;\r\nTHREE.UnsignedShort5551Type = 1017;\r\nTHREE.UnsignedShort565Type = 1018;\r\n\r\n// Pixel formats\r\n\r\nTHREE.AlphaFormat = 1019;\r\nTHREE.RGBFormat = 1020;\r\nTHREE.RGBAFormat = 1021;\r\nTHREE.LuminanceFormat = 1022;\r\nTHREE.LuminanceAlphaFormat = 1023;\r\n// THREE.RGBEFormat handled as THREE.RGBAFormat in shaders\r\nTHREE.RGBEFormat = THREE.RGBAFormat; //1024;\r\n\r\n// DDS / ST3C Compressed texture formats\r\n\r\nTHREE.RGB_S3TC_DXT1_Format = 2001;\r\nTHREE.RGBA_S3TC_DXT1_Format = 2002;\r\nTHREE.RGBA_S3TC_DXT3_Format = 2003;\r\nTHREE.RGBA_S3TC_DXT5_Format = 2004;\r\n\r\n\r\n// PVRTC compressed texture formats\r\n\r\nTHREE.RGB_PVRTC_4BPPV1_Format = 2100;\r\nTHREE.RGB_PVRTC_2BPPV1_Format = 2101;\r\nTHREE.RGBA_PVRTC_4BPPV1_Format = 2102;\r\nTHREE.RGBA_PVRTC_2BPPV1_Format = 2103;\r\n\r\n\r\n// DEPRECATED\r\n\r\nTHREE.Projector = function () {\r\n\r\n\tTHREE.error( 'THREE.Projector has been moved to /examples/js/renderers/Projector.js.' );\r\n\r\n\tthis.projectVector = function ( vector, camera ) {\r\n\r\n\t\tTHREE.warn( 'THREE.Projector: .projectVector() is now vector.project().' );\r\n\t\tvector.project( camera );\r\n\r\n\t};\r\n\r\n\tthis.unprojectVector = function ( vector, camera ) {\r\n\r\n\t\tTHREE.warn( 'THREE.Projector: .unprojectVector() is now vector.unproject().' );\r\n\t\tvector.unproject( camera );\r\n\r\n\t};\r\n\r\n\tthis.pickingRay = function ( vector, camera ) {\r\n\r\n\t\tTHREE.error( 'THREE.Projector: .pickingRay() is now raycaster.setFromCamera().' );\r\n\r\n\t};\r\n\r\n};\r\n\r\nTHREE.CanvasRenderer = function () {\r\n\r\n\tTHREE.error( 'THREE.CanvasRenderer has been moved to /examples/js/renderers/CanvasRenderer.js' );\r\n\r\n\tthis.domElement = document.createElement( 'canvas' );\r\n\tthis.clear = function () {};\r\n\tthis.render = function () {};\r\n\tthis.setClearColor = function () {};\r\n\tthis.setSize = function () {};\r\n\r\n};\r\n\r\n// File:src/math/Color.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.Color = function ( color ) {\r\n\r\n\tif ( arguments.length === 3 ) {\r\n\r\n\t\treturn this.setRGB( arguments[ 0 ], arguments[ 1 ], arguments[ 2 ] );\r\n\r\n\t}\r\n\r\n\treturn this.set( color )\r\n\r\n};\r\n\r\nTHREE.Color.prototype = {\r\n\r\n\tconstructor: THREE.Color,\r\n\r\n\tr: 1, g: 1, b: 1,\r\n\r\n\tset: function ( value ) {\r\n\r\n\t\tif ( value instanceof THREE.Color ) {\r\n\r\n\t\t\tthis.copy( value );\r\n\r\n\t\t} else if ( typeof value === 'number' ) {\r\n\r\n\t\t\tthis.setHex( value );\r\n\r\n\t\t} else if ( typeof value === 'string' ) {\r\n\r\n\t\t\tthis.setStyle( value );\r\n\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tsetHex: function ( hex ) {\r\n\r\n\t\thex = Math.floor( hex );\r\n\r\n\t\tthis.r = ( hex >> 16 & 255 ) / 255;\r\n\t\tthis.g = ( hex >> 8 & 255 ) / 255;\r\n\t\tthis.b = ( hex & 255 ) / 255;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tsetRGB: function ( r, g, b ) {\r\n\r\n\t\tthis.r = r;\r\n\t\tthis.g = g;\r\n\t\tthis.b = b;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tsetHSL: function ( h, s, l ) {\r\n\r\n\t\t// h,s,l ranges are in 0.0 - 1.0\r\n\r\n\t\tif ( s === 0 ) {\r\n\r\n\t\t\tthis.r = this.g = this.b = l;\r\n\r\n\t\t} else {\r\n\r\n\t\t\tvar hue2rgb = function ( p, q, t ) {\r\n\r\n\t\t\t\tif ( t < 0 ) t += 1;\r\n\t\t\t\tif ( t > 1 ) t -= 1;\r\n\t\t\t\tif ( t < 1 / 6 ) return p + ( q - p ) * 6 * t;\r\n\t\t\t\tif ( t < 1 / 2 ) return q;\r\n\t\t\t\tif ( t < 2 / 3 ) return p + ( q - p ) * 6 * ( 2 / 3 - t );\r\n\t\t\t\treturn p;\r\n\r\n\t\t\t};\r\n\r\n\t\t\tvar p = l <= 0.5 ? l * ( 1 + s ) : l + s - ( l * s );\r\n\t\t\tvar q = ( 2 * l ) - p;\r\n\r\n\t\t\tthis.r = hue2rgb( q, p, h + 1 / 3 );\r\n\t\t\tthis.g = hue2rgb( q, p, h );\r\n\t\t\tthis.b = hue2rgb( q, p, h - 1 / 3 );\r\n\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tsetStyle: function ( style ) {\r\n\r\n\t\t// rgb(255,0,0)\r\n\r\n\t\tif ( /^rgb\\((\\d+), ?(\\d+), ?(\\d+)\\)$/i.test( style ) ) {\r\n\r\n\t\t\tvar color = /^rgb\\((\\d+), ?(\\d+), ?(\\d+)\\)$/i.exec( style );\r\n\r\n\t\t\tthis.r = Math.min( 255, parseInt( color[ 1 ], 10 ) ) / 255;\r\n\t\t\tthis.g = Math.min( 255, parseInt( color[ 2 ], 10 ) ) / 255;\r\n\t\t\tthis.b = Math.min( 255, parseInt( color[ 3 ], 10 ) ) / 255;\r\n\r\n\t\t\treturn this;\r\n\r\n\t\t}\r\n\r\n\t\t// rgb(100%,0%,0%)\r\n\r\n\t\tif ( /^rgb\\((\\d+)\\%, ?(\\d+)\\%, ?(\\d+)\\%\\)$/i.test( style ) ) {\r\n\r\n\t\t\tvar color = /^rgb\\((\\d+)\\%, ?(\\d+)\\%, ?(\\d+)\\%\\)$/i.exec( style );\r\n\r\n\t\t\tthis.r = Math.min( 100, parseInt( color[ 1 ], 10 ) ) / 100;\r\n\t\t\tthis.g = Math.min( 100, parseInt( color[ 2 ], 10 ) ) / 100;\r\n\t\t\tthis.b = Math.min( 100, parseInt( color[ 3 ], 10 ) ) / 100;\r\n\r\n\t\t\treturn this;\r\n\r\n\t\t}\r\n\r\n\t\t// #ff0000\r\n\r\n\t\tif ( /^\\#([0-9a-f]{6})$/i.test( style ) ) {\r\n\r\n\t\t\tvar color = /^\\#([0-9a-f]{6})$/i.exec( style );\r\n\r\n\t\t\tthis.setHex( parseInt( color[ 1 ], 16 ) );\r\n\r\n\t\t\treturn this;\r\n\r\n\t\t}\r\n\r\n\t\t// #f00\r\n\r\n\t\tif ( /^\\#([0-9a-f])([0-9a-f])([0-9a-f])$/i.test( style ) ) {\r\n\r\n\t\t\tvar color = /^\\#([0-9a-f])([0-9a-f])([0-9a-f])$/i.exec( style );\r\n\r\n\t\t\tthis.setHex( parseInt( color[ 1 ] + color[ 1 ] + color[ 2 ] + color[ 2 ] + color[ 3 ] + color[ 3 ], 16 ) );\r\n\r\n\t\t\treturn this;\r\n\r\n\t\t}\r\n\r\n\t\t// red\r\n\r\n\t\tif ( /^(\\w+)$/i.test( style ) ) {\r\n\r\n\t\t\tthis.setHex( THREE.ColorKeywords[ style ] );\r\n\r\n\t\t\treturn this;\r\n\r\n\t\t}\r\n\r\n\r\n\t},\r\n\r\n\tcopy: function ( color ) {\r\n\r\n\t\tthis.r = color.r;\r\n\t\tthis.g = color.g;\r\n\t\tthis.b = color.b;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tcopyGammaToLinear: function ( color, gammaFactor ) {\r\n\r\n\t\tif ( gammaFactor === undefined ) gammaFactor = 2.0;\r\n\r\n\t\tthis.r = Math.pow( color.r, gammaFactor );\r\n\t\tthis.g = Math.pow( color.g, gammaFactor );\r\n\t\tthis.b = Math.pow( color.b, gammaFactor );\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tcopyLinearToGamma: function ( color, gammaFactor ) {\r\n\r\n\t\tif ( gammaFactor === undefined ) gammaFactor = 2.0;\r\n\r\n\t\tvar safeInverse = ( gammaFactor > 0 ) ? ( 1.0 / gammaFactor ) : 1.0;\r\n\r\n\t\tthis.r = Math.pow( color.r, safeInverse );\r\n\t\tthis.g = Math.pow( color.g, safeInverse );\r\n\t\tthis.b = Math.pow( color.b, safeInverse );\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tconvertGammaToLinear: function () {\r\n\r\n\t\tvar r = this.r, g = this.g, b = this.b;\r\n\r\n\t\tthis.r = r * r;\r\n\t\tthis.g = g * g;\r\n\t\tthis.b = b * b;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tconvertLinearToGamma: function () {\r\n\r\n\t\tthis.r = Math.sqrt( this.r );\r\n\t\tthis.g = Math.sqrt( this.g );\r\n\t\tthis.b = Math.sqrt( this.b );\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tgetHex: function () {\r\n\r\n\t\treturn ( this.r * 255 ) << 16 ^ ( this.g * 255 ) << 8 ^ ( this.b * 255 ) << 0;\r\n\r\n\t},\r\n\r\n\tgetHexString: function () {\r\n\r\n\t\treturn ( '000000' + this.getHex().toString( 16 ) ).slice( - 6 );\r\n\r\n\t},\r\n\r\n\tgetHSL: function ( optionalTarget ) {\r\n\r\n\t\t// h,s,l ranges are in 0.0 - 1.0\r\n\r\n\t\tvar hsl = optionalTarget || { h: 0, s: 0, l: 0 };\r\n\r\n\t\tvar r = this.r, g = this.g, b = this.b;\r\n\r\n\t\tvar max = Math.max( r, g, b );\r\n\t\tvar min = Math.min( r, g, b );\r\n\r\n\t\tvar hue, saturation;\r\n\t\tvar lightness = ( min + max ) / 2.0;\r\n\r\n\t\tif ( min === max ) {\r\n\r\n\t\t\thue = 0;\r\n\t\t\tsaturation = 0;\r\n\r\n\t\t} else {\r\n\r\n\t\t\tvar delta = max - min;\r\n\r\n\t\t\tsaturation = lightness <= 0.5 ? delta / ( max + min ) : delta / ( 2 - max - min );\r\n\r\n\t\t\tswitch ( max ) {\r\n\r\n\t\t\t\tcase r: hue = ( g - b ) / delta + ( g < b ? 6 : 0 ); break;\r\n\t\t\t\tcase g: hue = ( b - r ) / delta + 2; break;\r\n\t\t\t\tcase b: hue = ( r - g ) / delta + 4; break;\r\n\r\n\t\t\t}\r\n\r\n\t\t\thue /= 6;\r\n\r\n\t\t}\r\n\r\n\t\thsl.h = hue;\r\n\t\thsl.s = saturation;\r\n\t\thsl.l = lightness;\r\n\r\n\t\treturn hsl;\r\n\r\n\t},\r\n\r\n\tgetStyle: function () {\r\n\r\n\t\treturn 'rgb(' + ( ( this.r * 255 ) | 0 ) + ',' + ( ( this.g * 255 ) | 0 ) + ',' + ( ( this.b * 255 ) | 0 ) + ')';\r\n\r\n\t},\r\n\r\n\toffsetHSL: function ( h, s, l ) {\r\n\r\n\t\tvar hsl = this.getHSL();\r\n\r\n\t\thsl.h += h; hsl.s += s; hsl.l += l;\r\n\r\n\t\tthis.setHSL( hsl.h, hsl.s, hsl.l );\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tadd: function ( color ) {\r\n\r\n\t\tthis.r += color.r;\r\n\t\tthis.g += color.g;\r\n\t\tthis.b += color.b;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\taddColors: function ( color1, color2 ) {\r\n\r\n\t\tthis.r = color1.r + color2.r;\r\n\t\tthis.g = color1.g + color2.g;\r\n\t\tthis.b = color1.b + color2.b;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\taddScalar: function ( s ) {\r\n\r\n\t\tthis.r += s;\r\n\t\tthis.g += s;\r\n\t\tthis.b += s;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tmultiply: function ( color ) {\r\n\r\n\t\tthis.r *= color.r;\r\n\t\tthis.g *= color.g;\r\n\t\tthis.b *= color.b;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tmultiplyScalar: function ( s ) {\r\n\r\n\t\tthis.r *= s;\r\n\t\tthis.g *= s;\r\n\t\tthis.b *= s;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tlerp: function ( color, alpha ) {\r\n\r\n\t\tthis.r += ( color.r - this.r ) * alpha;\r\n\t\tthis.g += ( color.g - this.g ) * alpha;\r\n\t\tthis.b += ( color.b - this.b ) * alpha;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tequals: function ( c ) {\r\n\r\n\t\treturn ( c.r === this.r ) && ( c.g === this.g ) && ( c.b === this.b );\r\n\r\n\t},\r\n\r\n\tfromArray: function ( array ) {\r\n\r\n\t\tthis.r = array[ 0 ];\r\n\t\tthis.g = array[ 1 ];\r\n\t\tthis.b = array[ 2 ];\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\ttoArray: function ( array, offset ) {\r\n\r\n\t\tif ( array === undefined ) array = [];\r\n\t\tif ( offset === undefined ) offset = 0;\r\n\r\n\t\tarray[ offset ] = this.r;\r\n\t\tarray[ offset + 1 ] = this.g;\r\n\t\tarray[ offset + 2 ] = this.b;\r\n\r\n\t\treturn array;\r\n\t},\r\n\r\n\tclone: function () {\r\n\r\n\t\treturn new THREE.Color().setRGB( this.r, this.g, this.b );\r\n\r\n\t}\r\n\r\n};\r\n\r\nTHREE.ColorKeywords = { 'aliceblue': 0xF0F8FF, 'antiquewhite': 0xFAEBD7, 'aqua': 0x00FFFF, 'aquamarine': 0x7FFFD4, 'azure': 0xF0FFFF,\r\n'beige': 0xF5F5DC, 'bisque': 0xFFE4C4, 'black': 0x000000, 'blanchedalmond': 0xFFEBCD, 'blue': 0x0000FF, 'blueviolet': 0x8A2BE2,\r\n'brown': 0xA52A2A, 'burlywood': 0xDEB887, 'cadetblue': 0x5F9EA0, 'chartreuse': 0x7FFF00, 'chocolate': 0xD2691E, 'coral': 0xFF7F50,\r\n'cornflowerblue': 0x6495ED, 'cornsilk': 0xFFF8DC, 'crimson': 0xDC143C, 'cyan': 0x00FFFF, 'darkblue': 0x00008B, 'darkcyan': 0x008B8B,\r\n'darkgoldenrod': 0xB8860B, 'darkgray': 0xA9A9A9, 'darkgreen': 0x006400, 'darkgrey': 0xA9A9A9, 'darkkhaki': 0xBDB76B, 'darkmagenta': 0x8B008B,\r\n'darkolivegreen': 0x556B2F, 'darkorange': 0xFF8C00, 'darkorchid': 0x9932CC, 'darkred': 0x8B0000, 'darksalmon': 0xE9967A, 'darkseagreen': 0x8FBC8F,\r\n'darkslateblue': 0x483D8B, 'darkslategray': 0x2F4F4F, 'darkslategrey': 0x2F4F4F, 'darkturquoise': 0x00CED1, 'darkviolet': 0x9400D3,\r\n'deeppink': 0xFF1493, 'deepskyblue': 0x00BFFF, 'dimgray': 0x696969, 'dimgrey': 0x696969, 'dodgerblue': 0x1E90FF, 'firebrick': 0xB22222,\r\n'floralwhite': 0xFFFAF0, 'forestgreen': 0x228B22, 'fuchsia': 0xFF00FF, 'gainsboro': 0xDCDCDC, 'ghostwhite': 0xF8F8FF, 'gold': 0xFFD700,\r\n'goldenrod': 0xDAA520, 'gray': 0x808080, 'green': 0x008000, 'greenyellow': 0xADFF2F, 'grey': 0x808080, 'honeydew': 0xF0FFF0, 'hotpink': 0xFF69B4,\r\n'indianred': 0xCD5C5C, 'indigo': 0x4B0082, 'ivory': 0xFFFFF0, 'khaki': 0xF0E68C, 'lavender': 0xE6E6FA, 'lavenderblush': 0xFFF0F5, 'lawngreen': 0x7CFC00,\r\n'lemonchiffon': 0xFFFACD, 'lightblue': 0xADD8E6, 'lightcoral': 0xF08080, 'lightcyan': 0xE0FFFF, 'lightgoldenrodyellow': 0xFAFAD2, 'lightgray': 0xD3D3D3,\r\n'lightgreen': 0x90EE90, 'lightgrey': 0xD3D3D3, 'lightpink': 0xFFB6C1, 'lightsalmon': 0xFFA07A, 'lightseagreen': 0x20B2AA, 'lightskyblue': 0x87CEFA,\r\n'lightslategray': 0x778899, 'lightslategrey': 0x778899, 'lightsteelblue': 0xB0C4DE, 'lightyellow': 0xFFFFE0, 'lime': 0x00FF00, 'limegreen': 0x32CD32,\r\n'linen': 0xFAF0E6, 'magenta': 0xFF00FF, 'maroon': 0x800000, 'mediumaquamarine': 0x66CDAA, 'mediumblue': 0x0000CD, 'mediumorchid': 0xBA55D3,\r\n'mediumpurple': 0x9370DB, 'mediumseagreen': 0x3CB371, 'mediumslateblue': 0x7B68EE, 'mediumspringgreen': 0x00FA9A, 'mediumturquoise': 0x48D1CC,\r\n'mediumvioletred': 0xC71585, 'midnightblue': 0x191970, 'mintcream': 0xF5FFFA, 'mistyrose': 0xFFE4E1, 'moccasin': 0xFFE4B5, 'navajowhite': 0xFFDEAD,\r\n'navy': 0x000080, 'oldlace': 0xFDF5E6, 'olive': 0x808000, 'olivedrab': 0x6B8E23, 'orange': 0xFFA500, 'orangered': 0xFF4500, 'orchid': 0xDA70D6,\r\n'palegoldenrod': 0xEEE8AA, 'palegreen': 0x98FB98, 'paleturquoise': 0xAFEEEE, 'palevioletred': 0xDB7093, 'papayawhip': 0xFFEFD5, 'peachpuff': 0xFFDAB9,\r\n'peru': 0xCD853F, 'pink': 0xFFC0CB, 'plum': 0xDDA0DD, 'powderblue': 0xB0E0E6, 'purple': 0x800080, 'red': 0xFF0000, 'rosybrown': 0xBC8F8F,\r\n'royalblue': 0x4169E1, 'saddlebrown': 0x8B4513, 'salmon': 0xFA8072, 'sandybrown': 0xF4A460, 'seagreen': 0x2E8B57, 'seashell': 0xFFF5EE,\r\n'sienna': 0xA0522D, 'silver': 0xC0C0C0, 'skyblue': 0x87CEEB, 'slateblue': 0x6A5ACD, 'slategray': 0x708090, 'slategrey': 0x708090, 'snow': 0xFFFAFA,\r\n'springgreen': 0x00FF7F, 'steelblue': 0x4682B4, 'tan': 0xD2B48C, 'teal': 0x008080, 'thistle': 0xD8BFD8, 'tomato': 0xFF6347, 'turquoise': 0x40E0D0,\r\n'violet': 0xEE82EE, 'wheat': 0xF5DEB3, 'white': 0xFFFFFF, 'whitesmoke': 0xF5F5F5, 'yellow': 0xFFFF00, 'yellowgreen': 0x9ACD32 };\r\n\r\n// File:src/math/Quaternion.js\r\n\r\n/**\r\n * @author mikael emtinger / http://gomo.se/\r\n * @author alteredq / http://alteredqualia.com/\r\n * @author WestLangley / http://github.com/WestLangley\r\n * @author bhouston / http://exocortex.com\r\n */\r\n\r\nTHREE.Quaternion = function ( x, y, z, w ) {\r\n\r\n\tthis._x = x || 0;\r\n\tthis._y = y || 0;\r\n\tthis._z = z || 0;\r\n\tthis._w = ( w !== undefined ) ? w : 1;\r\n\r\n};\r\n\r\nTHREE.Quaternion.prototype = {\r\n\r\n\tconstructor: THREE.Quaternion,\r\n\r\n\t_x: 0,_y: 0, _z: 0, _w: 0,\r\n\r\n\tget x () {\r\n\r\n\t\treturn this._x;\r\n\r\n\t},\r\n\r\n\tset x ( value ) {\r\n\r\n\t\tthis._x = value;\r\n\t\tthis.onChangeCallback();\r\n\r\n\t},\r\n\r\n\tget y () {\r\n\r\n\t\treturn this._y;\r\n\r\n\t},\r\n\r\n\tset y ( value ) {\r\n\r\n\t\tthis._y = value;\r\n\t\tthis.onChangeCallback();\r\n\r\n\t},\r\n\r\n\tget z () {\r\n\r\n\t\treturn this._z;\r\n\r\n\t},\r\n\r\n\tset z ( value ) {\r\n\r\n\t\tthis._z = value;\r\n\t\tthis.onChangeCallback();\r\n\r\n\t},\r\n\r\n\tget w () {\r\n\r\n\t\treturn this._w;\r\n\r\n\t},\r\n\r\n\tset w ( value ) {\r\n\r\n\t\tthis._w = value;\r\n\t\tthis.onChangeCallback();\r\n\r\n\t},\r\n\r\n\tset: function ( x, y, z, w ) {\r\n\r\n\t\tthis._x = x;\r\n\t\tthis._y = y;\r\n\t\tthis._z = z;\r\n\t\tthis._w = w;\r\n\r\n\t\tthis.onChangeCallback();\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tcopy: function ( quaternion ) {\r\n\r\n\t\tthis._x = quaternion.x;\r\n\t\tthis._y = quaternion.y;\r\n\t\tthis._z = quaternion.z;\r\n\t\tthis._w = quaternion.w;\r\n\r\n\t\tthis.onChangeCallback();\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tsetFromEuler: function ( euler, update ) {\r\n\r\n\t\tif ( euler instanceof THREE.Euler === false ) {\r\n\r\n\t\t\tthrow new Error( 'THREE.Quaternion: .setFromEuler() now expects a Euler rotation rather than a Vector3 and order.' );\r\n\t\t}\r\n\r\n\t\t// http://www.mathworks.com/matlabcentral/fileexchange/\r\n\t\t// \t20696-function-to-convert-between-dcm-euler-angles-quaternions-and-euler-vectors/\r\n\t\t//\tcontent/SpinCalc.m\r\n\r\n\t\tvar c1 = Math.cos( euler._x / 2 );\r\n\t\tvar c2 = Math.cos( euler._y / 2 );\r\n\t\tvar c3 = Math.cos( euler._z / 2 );\r\n\t\tvar s1 = Math.sin( euler._x / 2 );\r\n\t\tvar s2 = Math.sin( euler._y / 2 );\r\n\t\tvar s3 = Math.sin( euler._z / 2 );\r\n\r\n\t\tif ( euler.order === 'XYZ' ) {\r\n\r\n\t\t\tthis._x = s1 * c2 * c3 + c1 * s2 * s3;\r\n\t\t\tthis._y = c1 * s2 * c3 - s1 * c2 * s3;\r\n\t\t\tthis._z = c1 * c2 * s3 + s1 * s2 * c3;\r\n\t\t\tthis._w = c1 * c2 * c3 - s1 * s2 * s3;\r\n\r\n\t\t} else if ( euler.order === 'YXZ' ) {\r\n\r\n\t\t\tthis._x = s1 * c2 * c3 + c1 * s2 * s3;\r\n\t\t\tthis._y = c1 * s2 * c3 - s1 * c2 * s3;\r\n\t\t\tthis._z = c1 * c2 * s3 - s1 * s2 * c3;\r\n\t\t\tthis._w = c1 * c2 * c3 + s1 * s2 * s3;\r\n\r\n\t\t} else if ( euler.order === 'ZXY' ) {\r\n\r\n\t\t\tthis._x = s1 * c2 * c3 - c1 * s2 * s3;\r\n\t\t\tthis._y = c1 * s2 * c3 + s1 * c2 * s3;\r\n\t\t\tthis._z = c1 * c2 * s3 + s1 * s2 * c3;\r\n\t\t\tthis._w = c1 * c2 * c3 - s1 * s2 * s3;\r\n\r\n\t\t} else if ( euler.order === 'ZYX' ) {\r\n\r\n\t\t\tthis._x = s1 * c2 * c3 - c1 * s2 * s3;\r\n\t\t\tthis._y = c1 * s2 * c3 + s1 * c2 * s3;\r\n\t\t\tthis._z = c1 * c2 * s3 - s1 * s2 * c3;\r\n\t\t\tthis._w = c1 * c2 * c3 + s1 * s2 * s3;\r\n\r\n\t\t} else if ( euler.order === 'YZX' ) {\r\n\r\n\t\t\tthis._x = s1 * c2 * c3 + c1 * s2 * s3;\r\n\t\t\tthis._y = c1 * s2 * c3 + s1 * c2 * s3;\r\n\t\t\tthis._z = c1 * c2 * s3 - s1 * s2 * c3;\r\n\t\t\tthis._w = c1 * c2 * c3 - s1 * s2 * s3;\r\n\r\n\t\t} else if ( euler.order === 'XZY' ) {\r\n\r\n\t\t\tthis._x = s1 * c2 * c3 - c1 * s2 * s3;\r\n\t\t\tthis._y = c1 * s2 * c3 - s1 * c2 * s3;\r\n\t\t\tthis._z = c1 * c2 * s3 + s1 * s2 * c3;\r\n\t\t\tthis._w = c1 * c2 * c3 + s1 * s2 * s3;\r\n\r\n\t\t}\r\n\r\n\t\tif ( update !== false ) this.onChangeCallback();\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tsetFromAxisAngle: function ( axis, angle ) {\r\n\r\n\t\t// http://www.euclideanspace.com/maths/geometry/rotations/conversions/angleToQuaternion/index.htm\r\n\r\n\t\t// assumes axis is normalized\r\n\r\n\t\tvar halfAngle = angle / 2, s = Math.sin( halfAngle );\r\n\r\n\t\tthis._x = axis.x * s;\r\n\t\tthis._y = axis.y * s;\r\n\t\tthis._z = axis.z * s;\r\n\t\tthis._w = Math.cos( halfAngle );\r\n\r\n\t\tthis.onChangeCallback();\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tsetFromRotationMatrix: function ( m ) {\r\n\r\n\t\t// http://www.euclideanspace.com/maths/geometry/rotations/conversions/matrixToQuaternion/index.htm\r\n\r\n\t\t// assumes the upper 3x3 of m is a pure rotation matrix (i.e, unscaled)\r\n\r\n\t\tvar te = m.elements,\r\n\r\n\t\t\tm11 = te[ 0 ], m12 = te[ 4 ], m13 = te[ 8 ],\r\n\t\t\tm21 = te[ 1 ], m22 = te[ 5 ], m23 = te[ 9 ],\r\n\t\t\tm31 = te[ 2 ], m32 = te[ 6 ], m33 = te[ 10 ],\r\n\r\n\t\t\ttrace = m11 + m22 + m33,\r\n\t\t\ts;\r\n\r\n\t\tif ( trace > 0 ) {\r\n\r\n\t\t\ts = 0.5 / Math.sqrt( trace + 1.0 );\r\n\r\n\t\t\tthis._w = 0.25 / s;\r\n\t\t\tthis._x = ( m32 - m23 ) * s;\r\n\t\t\tthis._y = ( m13 - m31 ) * s;\r\n\t\t\tthis._z = ( m21 - m12 ) * s;\r\n\r\n\t\t} else if ( m11 > m22 && m11 > m33 ) {\r\n\r\n\t\t\ts = 2.0 * Math.sqrt( 1.0 + m11 - m22 - m33 );\r\n\r\n\t\t\tthis._w = ( m32 - m23 ) / s;\r\n\t\t\tthis._x = 0.25 * s;\r\n\t\t\tthis._y = ( m12 + m21 ) / s;\r\n\t\t\tthis._z = ( m13 + m31 ) / s;\r\n\r\n\t\t} else if ( m22 > m33 ) {\r\n\r\n\t\t\ts = 2.0 * Math.sqrt( 1.0 + m22 - m11 - m33 );\r\n\r\n\t\t\tthis._w = ( m13 - m31 ) / s;\r\n\t\t\tthis._x = ( m12 + m21 ) / s;\r\n\t\t\tthis._y = 0.25 * s;\r\n\t\t\tthis._z = ( m23 + m32 ) / s;\r\n\r\n\t\t} else {\r\n\r\n\t\t\ts = 2.0 * Math.sqrt( 1.0 + m33 - m11 - m22 );\r\n\r\n\t\t\tthis._w = ( m21 - m12 ) / s;\r\n\t\t\tthis._x = ( m13 + m31 ) / s;\r\n\t\t\tthis._y = ( m23 + m32 ) / s;\r\n\t\t\tthis._z = 0.25 * s;\r\n\r\n\t\t}\r\n\r\n\t\tthis.onChangeCallback();\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tsetFromUnitVectors: function () {\r\n\r\n\t\t// http://lolengine.net/blog/2014/02/24/quaternion-from-two-vectors-final\r\n\r\n\t\t// assumes direction vectors vFrom and vTo are normalized\r\n\r\n\t\tvar v1, r;\r\n\r\n\t\tvar EPS = 0.000001;\r\n\r\n\t\treturn function ( vFrom, vTo ) {\r\n\r\n\t\t\tif ( v1 === undefined ) v1 = new THREE.Vector3();\r\n\r\n\t\t\tr = vFrom.dot( vTo ) + 1;\r\n\r\n\t\t\tif ( r < EPS ) {\r\n\r\n\t\t\t\tr = 0;\r\n\r\n\t\t\t\tif ( Math.abs( vFrom.x ) > Math.abs( vFrom.z ) ) {\r\n\r\n\t\t\t\t\tv1.set( - vFrom.y, vFrom.x, 0 );\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\tv1.set( 0, - vFrom.z, vFrom.y );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tv1.crossVectors( vFrom, vTo );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tthis._x = v1.x;\r\n\t\t\tthis._y = v1.y;\r\n\t\t\tthis._z = v1.z;\r\n\t\t\tthis._w = r;\r\n\r\n\t\t\tthis.normalize();\r\n\r\n\t\t\treturn this;\r\n\r\n\t\t}\r\n\r\n\t}(),\r\n\r\n\tinverse: function () {\r\n\r\n\t\tthis.conjugate().normalize();\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tconjugate: function () {\r\n\r\n\t\tthis._x *= - 1;\r\n\t\tthis._y *= - 1;\r\n\t\tthis._z *= - 1;\r\n\r\n\t\tthis.onChangeCallback();\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tdot: function ( v ) {\r\n\r\n\t\treturn this._x * v._x + this._y * v._y + this._z * v._z + this._w * v._w;\r\n\r\n\t},\r\n\r\n\tlengthSq: function () {\r\n\r\n\t\treturn this._x * this._x + this._y * this._y + this._z * this._z + this._w * this._w;\r\n\r\n\t},\r\n\r\n\tlength: function () {\r\n\r\n\t\treturn Math.sqrt( this._x * this._x + this._y * this._y + this._z * this._z + this._w * this._w );\r\n\r\n\t},\r\n\r\n\tnormalize: function () {\r\n\r\n\t\tvar l = this.length();\r\n\r\n\t\tif ( l === 0 ) {\r\n\r\n\t\t\tthis._x = 0;\r\n\t\t\tthis._y = 0;\r\n\t\t\tthis._z = 0;\r\n\t\t\tthis._w = 1;\r\n\r\n\t\t} else {\r\n\r\n\t\t\tl = 1 / l;\r\n\r\n\t\t\tthis._x = this._x * l;\r\n\t\t\tthis._y = this._y * l;\r\n\t\t\tthis._z = this._z * l;\r\n\t\t\tthis._w = this._w * l;\r\n\r\n\t\t}\r\n\r\n\t\tthis.onChangeCallback();\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tmultiply: function ( q, p ) {\r\n\r\n\t\tif ( p !== undefined ) {\r\n\r\n\t\t\tTHREE.warn( 'THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead.' );\r\n\t\t\treturn this.multiplyQuaternions( q, p );\r\n\r\n\t\t}\r\n\r\n\t\treturn this.multiplyQuaternions( this, q );\r\n\r\n\t},\r\n\r\n\tmultiplyQuaternions: function ( a, b ) {\r\n\r\n\t\t// from http://www.euclideanspace.com/maths/algebra/realNormedAlgebra/quaternions/code/index.htm\r\n\r\n\t\tvar qax = a._x, qay = a._y, qaz = a._z, qaw = a._w;\r\n\t\tvar qbx = b._x, qby = b._y, qbz = b._z, qbw = b._w;\r\n\r\n\t\tthis._x = qax * qbw + qaw * qbx + qay * qbz - qaz * qby;\r\n\t\tthis._y = qay * qbw + qaw * qby + qaz * qbx - qax * qbz;\r\n\t\tthis._z = qaz * qbw + qaw * qbz + qax * qby - qay * qbx;\r\n\t\tthis._w = qaw * qbw - qax * qbx - qay * qby - qaz * qbz;\r\n\r\n\t\tthis.onChangeCallback();\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tmultiplyVector3: function ( vector ) {\r\n\r\n\t\tTHREE.warn( 'THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead.' );\r\n\t\treturn vector.applyQuaternion( this );\r\n\r\n\t},\r\n\r\n\tslerp: function ( qb, t ) {\r\n\r\n\t\tif ( t === 0 ) return this;\r\n\t\tif ( t === 1 ) return this.copy( qb );\r\n\r\n\t\tvar x = this._x, y = this._y, z = this._z, w = this._w;\r\n\r\n\t\t// http://www.euclideanspace.com/maths/algebra/realNormedAlgebra/quaternions/slerp/\r\n\r\n\t\tvar cosHalfTheta = w * qb._w + x * qb._x + y * qb._y + z * qb._z;\r\n\r\n\t\tif ( cosHalfTheta < 0 ) {\r\n\r\n\t\t\tthis._w = - qb._w;\r\n\t\t\tthis._x = - qb._x;\r\n\t\t\tthis._y = - qb._y;\r\n\t\t\tthis._z = - qb._z;\r\n\r\n\t\t\tcosHalfTheta = - cosHalfTheta;\r\n\r\n\t\t} else {\r\n\r\n\t\t\tthis.copy( qb );\r\n\r\n\t\t}\r\n\r\n\t\tif ( cosHalfTheta >= 1.0 ) {\r\n\r\n\t\t\tthis._w = w;\r\n\t\t\tthis._x = x;\r\n\t\t\tthis._y = y;\r\n\t\t\tthis._z = z;\r\n\r\n\t\t\treturn this;\r\n\r\n\t\t}\r\n\r\n\t\tvar halfTheta = Math.acos( cosHalfTheta );\r\n\t\tvar sinHalfTheta = Math.sqrt( 1.0 - cosHalfTheta * cosHalfTheta );\r\n\r\n\t\tif ( Math.abs( sinHalfTheta ) < 0.001 ) {\r\n\r\n\t\t\tthis._w = 0.5 * ( w + this._w );\r\n\t\t\tthis._x = 0.5 * ( x + this._x );\r\n\t\t\tthis._y = 0.5 * ( y + this._y );\r\n\t\t\tthis._z = 0.5 * ( z + this._z );\r\n\r\n\t\t\treturn this;\r\n\r\n\t\t}\r\n\r\n\t\tvar ratioA = Math.sin( ( 1 - t ) * halfTheta ) / sinHalfTheta,\r\n\t\tratioB = Math.sin( t * halfTheta ) / sinHalfTheta;\r\n\r\n\t\tthis._w = ( w * ratioA + this._w * ratioB );\r\n\t\tthis._x = ( x * ratioA + this._x * ratioB );\r\n\t\tthis._y = ( y * ratioA + this._y * ratioB );\r\n\t\tthis._z = ( z * ratioA + this._z * ratioB );\r\n\r\n\t\tthis.onChangeCallback();\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tequals: function ( quaternion ) {\r\n\r\n\t\treturn ( quaternion._x === this._x ) && ( quaternion._y === this._y ) && ( quaternion._z === this._z ) && ( quaternion._w === this._w );\r\n\r\n\t},\r\n\r\n\tfromArray: function ( array, offset ) {\r\n\r\n\t\tif ( offset === undefined ) offset = 0;\r\n\r\n\t\tthis._x = array[ offset ];\r\n\t\tthis._y = array[ offset + 1 ];\r\n\t\tthis._z = array[ offset + 2 ];\r\n\t\tthis._w = array[ offset + 3 ];\r\n\r\n\t\tthis.onChangeCallback();\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\ttoArray: function ( array, offset ) {\r\n\r\n\t\tif ( array === undefined ) array = [];\r\n\t\tif ( offset === undefined ) offset = 0;\r\n\r\n\t\tarray[ offset ] = this._x;\r\n\t\tarray[ offset + 1 ] = this._y;\r\n\t\tarray[ offset + 2 ] = this._z;\r\n\t\tarray[ offset + 3 ] = this._w;\r\n\r\n\t\treturn array;\r\n\r\n\t},\r\n\r\n\tonChange: function ( callback ) {\r\n\r\n\t\tthis.onChangeCallback = callback;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tonChangeCallback: function () {},\r\n\r\n\tclone: function () {\r\n\r\n\t\treturn new THREE.Quaternion( this._x, this._y, this._z, this._w );\r\n\r\n\t}\r\n\r\n};\r\n\r\nTHREE.Quaternion.slerp = function ( qa, qb, qm, t ) {\r\n\r\n\treturn qm.copy( qa ).slerp( qb, t );\r\n\r\n}\r\n\r\n// File:src/math/Vector2.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author philogb / http://blog.thejit.org/\r\n * @author egraether / http://egraether.com/\r\n * @author zz85 / http://www.lab4games.net/zz85/blog\r\n */\r\n\r\nTHREE.Vector2 = function ( x, y ) {\r\n\r\n\tthis.x = x || 0;\r\n\tthis.y = y || 0;\r\n\r\n};\r\n\r\nTHREE.Vector2.prototype = {\r\n\r\n\tconstructor: THREE.Vector2,\r\n\r\n\tset: function ( x, y ) {\r\n\r\n\t\tthis.x = x;\r\n\t\tthis.y = y;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tsetX: function ( x ) {\r\n\r\n\t\tthis.x = x;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tsetY: function ( y ) {\r\n\r\n\t\tthis.y = y;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tsetComponent: function ( index, value ) {\r\n\r\n\t\tswitch ( index ) {\r\n\r\n\t\t\tcase 0: this.x = value; break;\r\n\t\t\tcase 1: this.y = value; break;\r\n\t\t\tdefault: throw new Error( 'index is out of range: ' + index );\r\n\r\n\t\t}\r\n\r\n\t},\r\n\r\n\tgetComponent: function ( index ) {\r\n\r\n\t\tswitch ( index ) {\r\n\r\n\t\t\tcase 0: return this.x;\r\n\t\t\tcase 1: return this.y;\r\n\t\t\tdefault: throw new Error( 'index is out of range: ' + index );\r\n\r\n\t\t}\r\n\r\n\t},\r\n\r\n\tcopy: function ( v ) {\r\n\r\n\t\tthis.x = v.x;\r\n\t\tthis.y = v.y;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tadd: function ( v, w ) {\r\n\r\n\t\tif ( w !== undefined ) {\r\n\r\n\t\t\tTHREE.warn( 'THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead.' );\r\n\t\t\treturn this.addVectors( v, w );\r\n\r\n\t\t}\r\n\r\n\t\tthis.x += v.x;\r\n\t\tthis.y += v.y;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\taddScalar: function ( s ) {\r\n\r\n\t\tthis.x += s;\r\n\t\tthis.y += s;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\taddVectors: function ( a, b ) {\r\n\r\n\t\tthis.x = a.x + b.x;\r\n\t\tthis.y = a.y + b.y;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tsub: function ( v, w ) {\r\n\r\n\t\tif ( w !== undefined ) {\r\n\r\n\t\t\tTHREE.warn( 'THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead.' );\r\n\t\t\treturn this.subVectors( v, w );\r\n\r\n\t\t}\r\n\r\n\t\tthis.x -= v.x;\r\n\t\tthis.y -= v.y;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tsubScalar: function ( s ) {\r\n\r\n\t\tthis.x -= s;\r\n\t\tthis.y -= s;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tsubVectors: function ( a, b ) {\r\n\r\n\t\tthis.x = a.x - b.x;\r\n\t\tthis.y = a.y - b.y;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tmultiply: function ( v ) {\r\n\r\n\t\tthis.x *= v.x;\r\n\t\tthis.y *= v.y;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tmultiplyScalar: function ( s ) {\r\n\r\n\t\tthis.x *= s;\r\n\t\tthis.y *= s;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tdivide: function ( v ) {\r\n\r\n\t\tthis.x /= v.x;\r\n\t\tthis.y /= v.y;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tdivideScalar: function ( scalar ) {\r\n\r\n\t\tif ( scalar !== 0 ) {\r\n\r\n\t\t\tvar invScalar = 1 / scalar;\r\n\r\n\t\t\tthis.x *= invScalar;\r\n\t\t\tthis.y *= invScalar;\r\n\r\n\t\t} else {\r\n\r\n\t\t\tthis.x = 0;\r\n\t\t\tthis.y = 0;\r\n\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tmin: function ( v ) {\r\n\r\n\t\tif ( this.x > v.x ) {\r\n\r\n\t\t\tthis.x = v.x;\r\n\r\n\t\t}\r\n\r\n\t\tif ( this.y > v.y ) {\r\n\r\n\t\t\tthis.y = v.y;\r\n\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tmax: function ( v ) {\r\n\r\n\t\tif ( this.x < v.x ) {\r\n\r\n\t\t\tthis.x = v.x;\r\n\r\n\t\t}\r\n\r\n\t\tif ( this.y < v.y ) {\r\n\r\n\t\t\tthis.y = v.y;\r\n\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tclamp: function ( min, max ) {\r\n\r\n\t\t// This function assumes min < max, if this assumption isn't true it will not operate correctly\r\n\r\n\t\tif ( this.x < min.x ) {\r\n\r\n\t\t\tthis.x = min.x;\r\n\r\n\t\t} else if ( this.x > max.x ) {\r\n\r\n\t\t\tthis.x = max.x;\r\n\r\n\t\t}\r\n\r\n\t\tif ( this.y < min.y ) {\r\n\r\n\t\t\tthis.y = min.y;\r\n\r\n\t\t} else if ( this.y > max.y ) {\r\n\r\n\t\t\tthis.y = max.y;\r\n\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\tclampScalar: ( function () {\r\n\r\n\t\tvar min, max;\r\n\r\n\t\treturn function ( minVal, maxVal ) {\r\n\r\n\t\t\tif ( min === undefined ) {\r\n\r\n\t\t\t\tmin = new THREE.Vector2();\r\n\t\t\t\tmax = new THREE.Vector2();\r\n\r\n\t\t\t}\r\n\r\n\t\t\tmin.set( minVal, minVal );\r\n\t\t\tmax.set( maxVal, maxVal );\r\n\r\n\t\t\treturn this.clamp( min, max );\r\n\r\n\t\t};\r\n\r\n\t} )(),\r\n\r\n\tfloor: function () {\r\n\r\n\t\tthis.x = Math.floor( this.x );\r\n\t\tthis.y = Math.floor( this.y );\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tceil: function () {\r\n\r\n\t\tthis.x = Math.ceil( this.x );\r\n\t\tthis.y = Math.ceil( this.y );\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tround: function () {\r\n\r\n\t\tthis.x = Math.round( this.x );\r\n\t\tthis.y = Math.round( this.y );\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\troundToZero: function () {\r\n\r\n\t\tthis.x = ( this.x < 0 ) ? Math.ceil( this.x ) : Math.floor( this.x );\r\n\t\tthis.y = ( this.y < 0 ) ? Math.ceil( this.y ) : Math.floor( this.y );\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tnegate: function () {\r\n\r\n\t\tthis.x = - this.x;\r\n\t\tthis.y = - this.y;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tdot: function ( v ) {\r\n\r\n\t\treturn this.x * v.x + this.y * v.y;\r\n\r\n\t},\r\n\r\n\tlengthSq: function () {\r\n\r\n\t\treturn this.x * this.x + this.y * this.y;\r\n\r\n\t},\r\n\r\n\tlength: function () {\r\n\r\n\t\treturn Math.sqrt( this.x * this.x + this.y * this.y );\r\n\r\n\t},\r\n\r\n\tnormalize: function () {\r\n\r\n\t\treturn this.divideScalar( this.length() );\r\n\r\n\t},\r\n\r\n\tdistanceTo: function ( v ) {\r\n\r\n\t\treturn Math.sqrt( this.distanceToSquared( v ) );\r\n\r\n\t},\r\n\r\n\tdistanceToSquared: function ( v ) {\r\n\r\n\t\tvar dx = this.x - v.x, dy = this.y - v.y;\r\n\t\treturn dx * dx + dy * dy;\r\n\r\n\t},\r\n\r\n\tsetLength: function ( l ) {\r\n\r\n\t\tvar oldLength = this.length();\r\n\r\n\t\tif ( oldLength !== 0 && l !== oldLength ) {\r\n\r\n\t\t\tthis.multiplyScalar( l / oldLength );\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tlerp: function ( v, alpha ) {\r\n\r\n\t\tthis.x += ( v.x - this.x ) * alpha;\r\n\t\tthis.y += ( v.y - this.y ) * alpha;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tlerpVectors: function ( v1, v2, alpha ) {\r\n\r\n\t\tthis.subVectors( v2, v1 ).multiplyScalar( alpha ).add( v1 );\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tequals: function ( v ) {\r\n\r\n\t\treturn ( ( v.x === this.x ) && ( v.y === this.y ) );\r\n\r\n\t},\r\n\r\n\tfromArray: function ( array, offset ) {\r\n\r\n\t\tif ( offset === undefined ) offset = 0;\r\n\r\n\t\tthis.x = array[ offset ];\r\n\t\tthis.y = array[ offset + 1 ];\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\ttoArray: function ( array, offset ) {\r\n\r\n\t\tif ( array === undefined ) array = [];\r\n\t\tif ( offset === undefined ) offset = 0;\r\n\r\n\t\tarray[ offset ] = this.x;\r\n\t\tarray[ offset + 1 ] = this.y;\r\n\r\n\t\treturn array;\r\n\r\n\t},\r\n\r\n\tfromAttribute: function ( attribute, index, offset ) {\r\n\r\n\t\tif ( offset === undefined ) offset = 0;\r\n\r\n\t\tindex = index * attribute.itemSize + offset;\r\n\r\n\t\tthis.x = attribute.array[ index ];\r\n\t\tthis.y = attribute.array[ index + 1 ];\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tclone: function () {\r\n\r\n\t\treturn new THREE.Vector2( this.x, this.y );\r\n\r\n\t}\r\n\r\n};\r\n\r\n// File:src/math/Vector3.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author *kile / http://kile.stravaganza.org/\r\n * @author philogb / http://blog.thejit.org/\r\n * @author mikael emtinger / http://gomo.se/\r\n * @author egraether / http://egraether.com/\r\n * @author WestLangley / http://github.com/WestLangley\r\n */\r\n\r\nTHREE.Vector3 = function ( x, y, z ) {\r\n\r\n\tthis.x = x || 0;\r\n\tthis.y = y || 0;\r\n\tthis.z = z || 0;\r\n\r\n};\r\n\r\nTHREE.Vector3.prototype = {\r\n\r\n\tconstructor: THREE.Vector3,\r\n\r\n\tset: function ( x, y, z ) {\r\n\r\n\t\tthis.x = x;\r\n\t\tthis.y = y;\r\n\t\tthis.z = z;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tsetX: function ( x ) {\r\n\r\n\t\tthis.x = x;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tsetY: function ( y ) {\r\n\r\n\t\tthis.y = y;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tsetZ: function ( z ) {\r\n\r\n\t\tthis.z = z;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tsetComponent: function ( index, value ) {\r\n\r\n\t\tswitch ( index ) {\r\n\r\n\t\t\tcase 0: this.x = value; break;\r\n\t\t\tcase 1: this.y = value; break;\r\n\t\t\tcase 2: this.z = value; break;\r\n\t\t\tdefault: throw new Error( 'index is out of range: ' + index );\r\n\r\n\t\t}\r\n\r\n\t},\r\n\r\n\tgetComponent: function ( index ) {\r\n\r\n\t\tswitch ( index ) {\r\n\r\n\t\t\tcase 0: return this.x;\r\n\t\t\tcase 1: return this.y;\r\n\t\t\tcase 2: return this.z;\r\n\t\t\tdefault: throw new Error( 'index is out of range: ' + index );\r\n\r\n\t\t}\r\n\r\n\t},\r\n\r\n\tcopy: function ( v ) {\r\n\r\n\t\tthis.x = v.x;\r\n\t\tthis.y = v.y;\r\n\t\tthis.z = v.z;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tadd: function ( v, w ) {\r\n\r\n\t\tif ( w !== undefined ) {\r\n\r\n\t\t\tTHREE.warn( 'THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead.' );\r\n\t\t\treturn this.addVectors( v, w );\r\n\r\n\t\t}\r\n\r\n\t\tthis.x += v.x;\r\n\t\tthis.y += v.y;\r\n\t\tthis.z += v.z;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\taddScalar: function ( s ) {\r\n\r\n\t\tthis.x += s;\r\n\t\tthis.y += s;\r\n\t\tthis.z += s;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\taddVectors: function ( a, b ) {\r\n\r\n\t\tthis.x = a.x + b.x;\r\n\t\tthis.y = a.y + b.y;\r\n\t\tthis.z = a.z + b.z;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tsub: function ( v, w ) {\r\n\r\n\t\tif ( w !== undefined ) {\r\n\r\n\t\t\tTHREE.warn( 'THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead.' );\r\n\t\t\treturn this.subVectors( v, w );\r\n\r\n\t\t}\r\n\r\n\t\tthis.x -= v.x;\r\n\t\tthis.y -= v.y;\r\n\t\tthis.z -= v.z;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\t\r\n\tsubScalar: function ( s ) {\r\n\r\n\t\tthis.x -= s;\r\n\t\tthis.y -= s;\r\n\t\tthis.z -= s;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tsubVectors: function ( a, b ) {\r\n\r\n\t\tthis.x = a.x - b.x;\r\n\t\tthis.y = a.y - b.y;\r\n\t\tthis.z = a.z - b.z;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tmultiply: function ( v, w ) {\r\n\r\n\t\tif ( w !== undefined ) {\r\n\r\n\t\t\tTHREE.warn( 'THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead.' );\r\n\t\t\treturn this.multiplyVectors( v, w );\r\n\r\n\t\t}\r\n\r\n\t\tthis.x *= v.x;\r\n\t\tthis.y *= v.y;\r\n\t\tthis.z *= v.z;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tmultiplyScalar: function ( scalar ) {\r\n\r\n\t\tthis.x *= scalar;\r\n\t\tthis.y *= scalar;\r\n\t\tthis.z *= scalar;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tmultiplyVectors: function ( a, b ) {\r\n\r\n\t\tthis.x = a.x * b.x;\r\n\t\tthis.y = a.y * b.y;\r\n\t\tthis.z = a.z * b.z;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tapplyEuler: function () {\r\n\r\n\t\tvar quaternion;\r\n\r\n\t\treturn function ( euler ) {\r\n\r\n\t\t\tif ( euler instanceof THREE.Euler === false ) {\r\n\r\n\t\t\t\tTHREE.error( 'THREE.Vector3: .applyEuler() now expects a Euler rotation rather than a Vector3 and order.' );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( quaternion === undefined ) quaternion = new THREE.Quaternion();\r\n\r\n\t\t\tthis.applyQuaternion( quaternion.setFromEuler( euler ) );\r\n\r\n\t\t\treturn this;\r\n\r\n\t\t};\r\n\r\n\t}(),\r\n\r\n\tapplyAxisAngle: function () {\r\n\r\n\t\tvar quaternion;\r\n\r\n\t\treturn function ( axis, angle ) {\r\n\r\n\t\t\tif ( quaternion === undefined ) quaternion = new THREE.Quaternion();\r\n\r\n\t\t\tthis.applyQuaternion( quaternion.setFromAxisAngle( axis, angle ) );\r\n\r\n\t\t\treturn this;\r\n\r\n\t\t};\r\n\r\n\t}(),\r\n\r\n\tapplyMatrix3: function ( m ) {\r\n\r\n\t\tvar x = this.x;\r\n\t\tvar y = this.y;\r\n\t\tvar z = this.z;\r\n\r\n\t\tvar e = m.elements;\r\n\r\n\t\tthis.x = e[ 0 ] * x + e[ 3 ] * y + e[ 6 ] * z;\r\n\t\tthis.y = e[ 1 ] * x + e[ 4 ] * y + e[ 7 ] * z;\r\n\t\tthis.z = e[ 2 ] * x + e[ 5 ] * y + e[ 8 ] * z;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tapplyMatrix4: function ( m ) {\r\n\r\n\t\t// input: THREE.Matrix4 affine matrix\r\n\r\n\t\tvar x = this.x, y = this.y, z = this.z;\r\n\r\n\t\tvar e = m.elements;\r\n\r\n\t\tthis.x = e[ 0 ] * x + e[ 4 ] * y + e[ 8 ]  * z + e[ 12 ];\r\n\t\tthis.y = e[ 1 ] * x + e[ 5 ] * y + e[ 9 ]  * z + e[ 13 ];\r\n\t\tthis.z = e[ 2 ] * x + e[ 6 ] * y + e[ 10 ] * z + e[ 14 ];\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tapplyProjection: function ( m ) {\r\n\r\n\t\t// input: THREE.Matrix4 projection matrix\r\n\r\n\t\tvar x = this.x, y = this.y, z = this.z;\r\n\r\n\t\tvar e = m.elements;\r\n\t\tvar d = 1 / ( e[ 3 ] * x + e[ 7 ] * y + e[ 11 ] * z + e[ 15 ] ); // perspective divide\r\n\r\n\t\tthis.x = ( e[ 0 ] * x + e[ 4 ] * y + e[ 8 ]  * z + e[ 12 ] ) * d;\r\n\t\tthis.y = ( e[ 1 ] * x + e[ 5 ] * y + e[ 9 ]  * z + e[ 13 ] ) * d;\r\n\t\tthis.z = ( e[ 2 ] * x + e[ 6 ] * y + e[ 10 ] * z + e[ 14 ] ) * d;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tapplyQuaternion: function ( q ) {\r\n\r\n\t\tvar x = this.x;\r\n\t\tvar y = this.y;\r\n\t\tvar z = this.z;\r\n\r\n\t\tvar qx = q.x;\r\n\t\tvar qy = q.y;\r\n\t\tvar qz = q.z;\r\n\t\tvar qw = q.w;\r\n\r\n\t\t// calculate quat * vector\r\n\r\n\t\tvar ix =  qw * x + qy * z - qz * y;\r\n\t\tvar iy =  qw * y + qz * x - qx * z;\r\n\t\tvar iz =  qw * z + qx * y - qy * x;\r\n\t\tvar iw = - qx * x - qy * y - qz * z;\r\n\r\n\t\t// calculate result * inverse quat\r\n\r\n\t\tthis.x = ix * qw + iw * - qx + iy * - qz - iz * - qy;\r\n\t\tthis.y = iy * qw + iw * - qy + iz * - qx - ix * - qz;\r\n\t\tthis.z = iz * qw + iw * - qz + ix * - qy - iy * - qx;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tproject: function () {\r\n\r\n\t\tvar matrix;\r\n\r\n\t\treturn function ( camera ) {\r\n\r\n\t\t\tif ( matrix === undefined ) matrix = new THREE.Matrix4();\r\n\r\n\t\t\tmatrix.multiplyMatrices( camera.projectionMatrix, matrix.getInverse( camera.matrixWorld ) );\r\n\t\t\treturn this.applyProjection( matrix );\r\n\r\n\t\t};\r\n\r\n\t}(),\r\n\r\n\tunproject: function () {\r\n\r\n\t\tvar matrix;\r\n\r\n\t\treturn function ( camera ) {\r\n\r\n\t\t\tif ( matrix === undefined ) matrix = new THREE.Matrix4();\r\n\r\n\t\t\tmatrix.multiplyMatrices( camera.matrixWorld, matrix.getInverse( camera.projectionMatrix ) );\r\n\t\t\treturn this.applyProjection( matrix );\r\n\r\n\t\t};\r\n\r\n\t}(),\r\n\r\n\ttransformDirection: function ( m ) {\r\n\r\n\t\t// input: THREE.Matrix4 affine matrix\r\n\t\t// vector interpreted as a direction\r\n\r\n\t\tvar x = this.x, y = this.y, z = this.z;\r\n\r\n\t\tvar e = m.elements;\r\n\r\n\t\tthis.x = e[ 0 ] * x + e[ 4 ] * y + e[ 8 ]  * z;\r\n\t\tthis.y = e[ 1 ] * x + e[ 5 ] * y + e[ 9 ]  * z;\r\n\t\tthis.z = e[ 2 ] * x + e[ 6 ] * y + e[ 10 ] * z;\r\n\r\n\t\tthis.normalize();\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tdivide: function ( v ) {\r\n\r\n\t\tthis.x /= v.x;\r\n\t\tthis.y /= v.y;\r\n\t\tthis.z /= v.z;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tdivideScalar: function ( scalar ) {\r\n\r\n\t\tif ( scalar !== 0 ) {\r\n\r\n\t\t\tvar invScalar = 1 / scalar;\r\n\r\n\t\t\tthis.x *= invScalar;\r\n\t\t\tthis.y *= invScalar;\r\n\t\t\tthis.z *= invScalar;\r\n\r\n\t\t} else {\r\n\r\n\t\t\tthis.x = 0;\r\n\t\t\tthis.y = 0;\r\n\t\t\tthis.z = 0;\r\n\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tmin: function ( v ) {\r\n\r\n\t\tif ( this.x > v.x ) {\r\n\r\n\t\t\tthis.x = v.x;\r\n\r\n\t\t}\r\n\r\n\t\tif ( this.y > v.y ) {\r\n\r\n\t\t\tthis.y = v.y;\r\n\r\n\t\t}\r\n\r\n\t\tif ( this.z > v.z ) {\r\n\r\n\t\t\tthis.z = v.z;\r\n\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tmax: function ( v ) {\r\n\r\n\t\tif ( this.x < v.x ) {\r\n\r\n\t\t\tthis.x = v.x;\r\n\r\n\t\t}\r\n\r\n\t\tif ( this.y < v.y ) {\r\n\r\n\t\t\tthis.y = v.y;\r\n\r\n\t\t}\r\n\r\n\t\tif ( this.z < v.z ) {\r\n\r\n\t\t\tthis.z = v.z;\r\n\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tclamp: function ( min, max ) {\r\n\r\n\t\t// This function assumes min < max, if this assumption isn't true it will not operate correctly\r\n\r\n\t\tif ( this.x < min.x ) {\r\n\r\n\t\t\tthis.x = min.x;\r\n\r\n\t\t} else if ( this.x > max.x ) {\r\n\r\n\t\t\tthis.x = max.x;\r\n\r\n\t\t}\r\n\r\n\t\tif ( this.y < min.y ) {\r\n\r\n\t\t\tthis.y = min.y;\r\n\r\n\t\t} else if ( this.y > max.y ) {\r\n\r\n\t\t\tthis.y = max.y;\r\n\r\n\t\t}\r\n\r\n\t\tif ( this.z < min.z ) {\r\n\r\n\t\t\tthis.z = min.z;\r\n\r\n\t\t} else if ( this.z > max.z ) {\r\n\r\n\t\t\tthis.z = max.z;\r\n\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tclampScalar: ( function () {\r\n\r\n\t\tvar min, max;\r\n\r\n\t\treturn function ( minVal, maxVal ) {\r\n\r\n\t\t\tif ( min === undefined ) {\r\n\r\n\t\t\t\tmin = new THREE.Vector3();\r\n\t\t\t\tmax = new THREE.Vector3();\r\n\r\n\t\t\t}\r\n\r\n\t\t\tmin.set( minVal, minVal, minVal );\r\n\t\t\tmax.set( maxVal, maxVal, maxVal );\r\n\r\n\t\t\treturn this.clamp( min, max );\r\n\r\n\t\t};\r\n\r\n\t} )(),\r\n\r\n\tfloor: function () {\r\n\r\n\t\tthis.x = Math.floor( this.x );\r\n\t\tthis.y = Math.floor( this.y );\r\n\t\tthis.z = Math.floor( this.z );\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tceil: function () {\r\n\r\n\t\tthis.x = Math.ceil( this.x );\r\n\t\tthis.y = Math.ceil( this.y );\r\n\t\tthis.z = Math.ceil( this.z );\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tround: function () {\r\n\r\n\t\tthis.x = Math.round( this.x );\r\n\t\tthis.y = Math.round( this.y );\r\n\t\tthis.z = Math.round( this.z );\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\troundToZero: function () {\r\n\r\n\t\tthis.x = ( this.x < 0 ) ? Math.ceil( this.x ) : Math.floor( this.x );\r\n\t\tthis.y = ( this.y < 0 ) ? Math.ceil( this.y ) : Math.floor( this.y );\r\n\t\tthis.z = ( this.z < 0 ) ? Math.ceil( this.z ) : Math.floor( this.z );\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tnegate: function () {\r\n\r\n\t\tthis.x = - this.x;\r\n\t\tthis.y = - this.y;\r\n\t\tthis.z = - this.z;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tdot: function ( v ) {\r\n\r\n\t\treturn this.x * v.x + this.y * v.y + this.z * v.z;\r\n\r\n\t},\r\n\r\n\tlengthSq: function () {\r\n\r\n\t\treturn this.x * this.x + this.y * this.y + this.z * this.z;\r\n\r\n\t},\r\n\r\n\tlength: function () {\r\n\r\n\t\treturn Math.sqrt( this.x * this.x + this.y * this.y + this.z * this.z );\r\n\r\n\t},\r\n\r\n\tlengthManhattan: function () {\r\n\r\n\t\treturn Math.abs( this.x ) + Math.abs( this.y ) + Math.abs( this.z );\r\n\r\n\t},\r\n\r\n\tnormalize: function () {\r\n\r\n\t\treturn this.divideScalar( this.length() );\r\n\r\n\t},\r\n\r\n\tsetLength: function ( l ) {\r\n\r\n\t\tvar oldLength = this.length();\r\n\r\n\t\tif ( oldLength !== 0 && l !== oldLength  ) {\r\n\r\n\t\t\tthis.multiplyScalar( l / oldLength );\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tlerp: function ( v, alpha ) {\r\n\r\n\t\tthis.x += ( v.x - this.x ) * alpha;\r\n\t\tthis.y += ( v.y - this.y ) * alpha;\r\n\t\tthis.z += ( v.z - this.z ) * alpha;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tlerpVectors: function ( v1, v2, alpha ) {\r\n\r\n\t\tthis.subVectors( v2, v1 ).multiplyScalar( alpha ).add( v1 );\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tcross: function ( v, w ) {\r\n\r\n\t\tif ( w !== undefined ) {\r\n\r\n\t\t\tTHREE.warn( 'THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead.' );\r\n\t\t\treturn this.crossVectors( v, w );\r\n\r\n\t\t}\r\n\r\n\t\tvar x = this.x, y = this.y, z = this.z;\r\n\r\n\t\tthis.x = y * v.z - z * v.y;\r\n\t\tthis.y = z * v.x - x * v.z;\r\n\t\tthis.z = x * v.y - y * v.x;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tcrossVectors: function ( a, b ) {\r\n\r\n\t\tvar ax = a.x, ay = a.y, az = a.z;\r\n\t\tvar bx = b.x, by = b.y, bz = b.z;\r\n\r\n\t\tthis.x = ay * bz - az * by;\r\n\t\tthis.y = az * bx - ax * bz;\r\n\t\tthis.z = ax * by - ay * bx;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tprojectOnVector: function () {\r\n\r\n\t\tvar v1, dot;\r\n\r\n\t\treturn function ( vector ) {\r\n\r\n\t\t\tif ( v1 === undefined ) v1 = new THREE.Vector3();\r\n\r\n\t\t\tv1.copy( vector ).normalize();\r\n\r\n\t\t\tdot = this.dot( v1 );\r\n\r\n\t\t\treturn this.copy( v1 ).multiplyScalar( dot );\r\n\r\n\t\t};\r\n\r\n\t}(),\r\n\r\n\tprojectOnPlane: function () {\r\n\r\n\t\tvar v1;\r\n\r\n\t\treturn function ( planeNormal ) {\r\n\r\n\t\t\tif ( v1 === undefined ) v1 = new THREE.Vector3();\r\n\r\n\t\t\tv1.copy( this ).projectOnVector( planeNormal );\r\n\r\n\t\t\treturn this.sub( v1 );\r\n\r\n\t\t}\r\n\r\n\t}(),\r\n\r\n\treflect: function () {\r\n\r\n\t\t// reflect incident vector off plane orthogonal to normal\r\n\t\t// normal is assumed to have unit length\r\n\r\n\t\tvar v1;\r\n\r\n\t\treturn function ( normal ) {\r\n\r\n\t\t\tif ( v1 === undefined ) v1 = new THREE.Vector3();\r\n\r\n\t\t\treturn this.sub( v1.copy( normal ).multiplyScalar( 2 * this.dot( normal ) ) );\r\n\r\n\t\t}\r\n\r\n\t}(),\r\n\r\n\tangleTo: function ( v ) {\r\n\r\n\t\tvar theta = this.dot( v ) / ( this.length() * v.length() );\r\n\r\n\t\t// clamp, to handle numerical problems\r\n\r\n\t\treturn Math.acos( THREE.Math.clamp( theta, - 1, 1 ) );\r\n\r\n\t},\r\n\r\n\tdistanceTo: function ( v ) {\r\n\r\n\t\treturn Math.sqrt( this.distanceToSquared( v ) );\r\n\r\n\t},\r\n\r\n\tdistanceToSquared: function ( v ) {\r\n\r\n\t\tvar dx = this.x - v.x;\r\n\t\tvar dy = this.y - v.y;\r\n\t\tvar dz = this.z - v.z;\r\n\r\n\t\treturn dx * dx + dy * dy + dz * dz;\r\n\r\n\t},\r\n\r\n\tsetEulerFromRotationMatrix: function ( m, order ) {\r\n\r\n\t\tTHREE.error( 'THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.' );\r\n\r\n\t},\r\n\r\n\tsetEulerFromQuaternion: function ( q, order ) {\r\n\r\n\t\tTHREE.error( 'THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.' );\r\n\r\n\t},\r\n\r\n\tgetPositionFromMatrix: function ( m ) {\r\n\r\n\t\tTHREE.warn( 'THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition().' );\r\n\r\n\t\treturn this.setFromMatrixPosition( m );\r\n\r\n\t},\r\n\r\n\tgetScaleFromMatrix: function ( m ) {\r\n\r\n\t\tTHREE.warn( 'THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale().' );\r\n\r\n\t\treturn this.setFromMatrixScale( m );\r\n\t},\r\n\r\n\tgetColumnFromMatrix: function ( index, matrix ) {\r\n\r\n\t\tTHREE.warn( 'THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn().' );\r\n\r\n\t\treturn this.setFromMatrixColumn( index, matrix );\r\n\r\n\t},\r\n\r\n\tsetFromMatrixPosition: function ( m ) {\r\n\r\n\t\tthis.x = m.elements[ 12 ];\r\n\t\tthis.y = m.elements[ 13 ];\r\n\t\tthis.z = m.elements[ 14 ];\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tsetFromMatrixScale: function ( m ) {\r\n\r\n\t\tvar sx = this.set( m.elements[ 0 ], m.elements[ 1 ], m.elements[  2 ] ).length();\r\n\t\tvar sy = this.set( m.elements[ 4 ], m.elements[ 5 ], m.elements[  6 ] ).length();\r\n\t\tvar sz = this.set( m.elements[ 8 ], m.elements[ 9 ], m.elements[ 10 ] ).length();\r\n\r\n\t\tthis.x = sx;\r\n\t\tthis.y = sy;\r\n\t\tthis.z = sz;\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\tsetFromMatrixColumn: function ( index, matrix ) {\r\n\t\t\r\n\t\tvar offset = index * 4;\r\n\r\n\t\tvar me = matrix.elements;\r\n\r\n\t\tthis.x = me[ offset ];\r\n\t\tthis.y = me[ offset + 1 ];\r\n\t\tthis.z = me[ offset + 2 ];\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tequals: function ( v ) {\r\n\r\n\t\treturn ( ( v.x === this.x ) && ( v.y === this.y ) && ( v.z === this.z ) );\r\n\r\n\t},\r\n\r\n\tfromArray: function ( array, offset ) {\r\n\r\n\t\tif ( offset === undefined ) offset = 0;\r\n\r\n\t\tthis.x = array[ offset ];\r\n\t\tthis.y = array[ offset + 1 ];\r\n\t\tthis.z = array[ offset + 2 ];\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\ttoArray: function ( array, offset ) {\r\n\r\n\t\tif ( array === undefined ) array = [];\r\n\t\tif ( offset === undefined ) offset = 0;\r\n\r\n\t\tarray[ offset ] = this.x;\r\n\t\tarray[ offset + 1 ] = this.y;\r\n\t\tarray[ offset + 2 ] = this.z;\r\n\r\n\t\treturn array;\r\n\r\n\t},\r\n\r\n\tfromAttribute: function ( attribute, index, offset ) {\r\n\r\n\t\tif ( offset === undefined ) offset = 0;\r\n\r\n\t\tindex = index * attribute.itemSize + offset;\r\n\r\n\t\tthis.x = attribute.array[ index ];\r\n\t\tthis.y = attribute.array[ index + 1 ];\r\n\t\tthis.z = attribute.array[ index + 2 ];\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tclone: function () {\r\n\r\n\t\treturn new THREE.Vector3( this.x, this.y, this.z );\r\n\r\n\t}\r\n\r\n};\r\n\r\n// File:src/math/Vector4.js\r\n\r\n/**\r\n * @author supereggbert / http://www.paulbrunt.co.uk/\r\n * @author philogb / http://blog.thejit.org/\r\n * @author mikael emtinger / http://gomo.se/\r\n * @author egraether / http://egraether.com/\r\n * @author WestLangley / http://github.com/WestLangley\r\n */\r\n\r\nTHREE.Vector4 = function ( x, y, z, w ) {\r\n\r\n\tthis.x = x || 0;\r\n\tthis.y = y || 0;\r\n\tthis.z = z || 0;\r\n\tthis.w = ( w !== undefined ) ? w : 1;\r\n\r\n};\r\n\r\nTHREE.Vector4.prototype = {\r\n\r\n\tconstructor: THREE.Vector4,\r\n\r\n\tset: function ( x, y, z, w ) {\r\n\r\n\t\tthis.x = x;\r\n\t\tthis.y = y;\r\n\t\tthis.z = z;\r\n\t\tthis.w = w;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tsetX: function ( x ) {\r\n\r\n\t\tthis.x = x;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tsetY: function ( y ) {\r\n\r\n\t\tthis.y = y;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tsetZ: function ( z ) {\r\n\r\n\t\tthis.z = z;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tsetW: function ( w ) {\r\n\r\n\t\tthis.w = w;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tsetComponent: function ( index, value ) {\r\n\r\n\t\tswitch ( index ) {\r\n\r\n\t\t\tcase 0: this.x = value; break;\r\n\t\t\tcase 1: this.y = value; break;\r\n\t\t\tcase 2: this.z = value; break;\r\n\t\t\tcase 3: this.w = value; break;\r\n\t\t\tdefault: throw new Error( 'index is out of range: ' + index );\r\n\r\n\t\t}\r\n\r\n\t},\r\n\r\n\tgetComponent: function ( index ) {\r\n\r\n\t\tswitch ( index ) {\r\n\r\n\t\t\tcase 0: return this.x;\r\n\t\t\tcase 1: return this.y;\r\n\t\t\tcase 2: return this.z;\r\n\t\t\tcase 3: return this.w;\r\n\t\t\tdefault: throw new Error( 'index is out of range: ' + index );\r\n\r\n\t\t}\r\n\r\n\t},\r\n\r\n\tcopy: function ( v ) {\r\n\r\n\t\tthis.x = v.x;\r\n\t\tthis.y = v.y;\r\n\t\tthis.z = v.z;\r\n\t\tthis.w = ( v.w !== undefined ) ? v.w : 1;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tadd: function ( v, w ) {\r\n\r\n\t\tif ( w !== undefined ) {\r\n\r\n\t\t\tTHREE.warn( 'THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead.' );\r\n\t\t\treturn this.addVectors( v, w );\r\n\r\n\t\t}\r\n\r\n\t\tthis.x += v.x;\r\n\t\tthis.y += v.y;\r\n\t\tthis.z += v.z;\r\n\t\tthis.w += v.w;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\taddScalar: function ( s ) {\r\n\r\n\t\tthis.x += s;\r\n\t\tthis.y += s;\r\n\t\tthis.z += s;\r\n\t\tthis.w += s;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\taddVectors: function ( a, b ) {\r\n\r\n\t\tthis.x = a.x + b.x;\r\n\t\tthis.y = a.y + b.y;\r\n\t\tthis.z = a.z + b.z;\r\n\t\tthis.w = a.w + b.w;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tsub: function ( v, w ) {\r\n\r\n\t\tif ( w !== undefined ) {\r\n\r\n\t\t\tTHREE.warn( 'THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead.' );\r\n\t\t\treturn this.subVectors( v, w );\r\n\r\n\t\t}\r\n\r\n\t\tthis.x -= v.x;\r\n\t\tthis.y -= v.y;\r\n\t\tthis.z -= v.z;\r\n\t\tthis.w -= v.w;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tsubScalar: function ( s ) {\r\n\r\n\t\tthis.x -= s;\r\n\t\tthis.y -= s;\r\n\t\tthis.z -= s;\r\n\t\tthis.w -= s;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tsubVectors: function ( a, b ) {\r\n\r\n\t\tthis.x = a.x - b.x;\r\n\t\tthis.y = a.y - b.y;\r\n\t\tthis.z = a.z - b.z;\r\n\t\tthis.w = a.w - b.w;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tmultiplyScalar: function ( scalar ) {\r\n\r\n\t\tthis.x *= scalar;\r\n\t\tthis.y *= scalar;\r\n\t\tthis.z *= scalar;\r\n\t\tthis.w *= scalar;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tapplyMatrix4: function ( m ) {\r\n\r\n\t\tvar x = this.x;\r\n\t\tvar y = this.y;\r\n\t\tvar z = this.z;\r\n\t\tvar w = this.w;\r\n\r\n\t\tvar e = m.elements;\r\n\r\n\t\tthis.x = e[ 0 ] * x + e[ 4 ] * y + e[ 8 ] * z + e[ 12 ] * w;\r\n\t\tthis.y = e[ 1 ] * x + e[ 5 ] * y + e[ 9 ] * z + e[ 13 ] * w;\r\n\t\tthis.z = e[ 2 ] * x + e[ 6 ] * y + e[ 10 ] * z + e[ 14 ] * w;\r\n\t\tthis.w = e[ 3 ] * x + e[ 7 ] * y + e[ 11 ] * z + e[ 15 ] * w;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tdivideScalar: function ( scalar ) {\r\n\r\n\t\tif ( scalar !== 0 ) {\r\n\r\n\t\t\tvar invScalar = 1 / scalar;\r\n\r\n\t\t\tthis.x *= invScalar;\r\n\t\t\tthis.y *= invScalar;\r\n\t\t\tthis.z *= invScalar;\r\n\t\t\tthis.w *= invScalar;\r\n\r\n\t\t} else {\r\n\r\n\t\t\tthis.x = 0;\r\n\t\t\tthis.y = 0;\r\n\t\t\tthis.z = 0;\r\n\t\t\tthis.w = 1;\r\n\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tsetAxisAngleFromQuaternion: function ( q ) {\r\n\r\n\t\t// http://www.euclideanspace.com/maths/geometry/rotations/conversions/quaternionToAngle/index.htm\r\n\r\n\t\t// q is assumed to be normalized\r\n\r\n\t\tthis.w = 2 * Math.acos( q.w );\r\n\r\n\t\tvar s = Math.sqrt( 1 - q.w * q.w );\r\n\r\n\t\tif ( s < 0.0001 ) {\r\n\r\n\t\t\t this.x = 1;\r\n\t\t\t this.y = 0;\r\n\t\t\t this.z = 0;\r\n\r\n\t\t} else {\r\n\r\n\t\t\t this.x = q.x / s;\r\n\t\t\t this.y = q.y / s;\r\n\t\t\t this.z = q.z / s;\r\n\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tsetAxisAngleFromRotationMatrix: function ( m ) {\r\n\r\n\t\t// http://www.euclideanspace.com/maths/geometry/rotations/conversions/matrixToAngle/index.htm\r\n\r\n\t\t// assumes the upper 3x3 of m is a pure rotation matrix (i.e, unscaled)\r\n\r\n\t\tvar angle, x, y, z,\t\t// variables for result\r\n\t\t\tepsilon = 0.01,\t\t// margin to allow for rounding errors\r\n\t\t\tepsilon2 = 0.1,\t\t// margin to distinguish between 0 and 180 degrees\r\n\r\n\t\t\tte = m.elements,\r\n\r\n\t\t\tm11 = te[ 0 ], m12 = te[ 4 ], m13 = te[ 8 ],\r\n\t\t\tm21 = te[ 1 ], m22 = te[ 5 ], m23 = te[ 9 ],\r\n\t\t\tm31 = te[ 2 ], m32 = te[ 6 ], m33 = te[ 10 ];\r\n\r\n\t\tif ( ( Math.abs( m12 - m21 ) < epsilon )\r\n\t\t   && ( Math.abs( m13 - m31 ) < epsilon )\r\n\t\t   && ( Math.abs( m23 - m32 ) < epsilon ) ) {\r\n\r\n\t\t\t// singularity found\r\n\t\t\t// first check for identity matrix which must have +1 for all terms\r\n\t\t\t// in leading diagonal and zero in other terms\r\n\r\n\t\t\tif ( ( Math.abs( m12 + m21 ) < epsilon2 )\r\n\t\t\t   && ( Math.abs( m13 + m31 ) < epsilon2 )\r\n\t\t\t   && ( Math.abs( m23 + m32 ) < epsilon2 )\r\n\t\t\t   && ( Math.abs( m11 + m22 + m33 - 3 ) < epsilon2 ) ) {\r\n\r\n\t\t\t\t// this singularity is identity matrix so angle = 0\r\n\r\n\t\t\t\tthis.set( 1, 0, 0, 0 );\r\n\r\n\t\t\t\treturn this; // zero angle, arbitrary axis\r\n\r\n\t\t\t}\r\n\r\n\t\t\t// otherwise this singularity is angle = 180\r\n\r\n\t\t\tangle = Math.PI;\r\n\r\n\t\t\tvar xx = ( m11 + 1 ) / 2;\r\n\t\t\tvar yy = ( m22 + 1 ) / 2;\r\n\t\t\tvar zz = ( m33 + 1 ) / 2;\r\n\t\t\tvar xy = ( m12 + m21 ) / 4;\r\n\t\t\tvar xz = ( m13 + m31 ) / 4;\r\n\t\t\tvar yz = ( m23 + m32 ) / 4;\r\n\r\n\t\t\tif ( ( xx > yy ) && ( xx > zz ) ) { // m11 is the largest diagonal term\r\n\r\n\t\t\t\tif ( xx < epsilon ) {\r\n\r\n\t\t\t\t\tx = 0;\r\n\t\t\t\t\ty = 0.707106781;\r\n\t\t\t\t\tz = 0.707106781;\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\tx = Math.sqrt( xx );\r\n\t\t\t\t\ty = xy / x;\r\n\t\t\t\t\tz = xz / x;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t} else if ( yy > zz ) { // m22 is the largest diagonal term\r\n\r\n\t\t\t\tif ( yy < epsilon ) {\r\n\r\n\t\t\t\t\tx = 0.707106781;\r\n\t\t\t\t\ty = 0;\r\n\t\t\t\t\tz = 0.707106781;\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\ty = Math.sqrt( yy );\r\n\t\t\t\t\tx = xy / y;\r\n\t\t\t\t\tz = yz / y;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t} else { // m33 is the largest diagonal term so base result on this\r\n\r\n\t\t\t\tif ( zz < epsilon ) {\r\n\r\n\t\t\t\t\tx = 0.707106781;\r\n\t\t\t\t\ty = 0.707106781;\r\n\t\t\t\t\tz = 0;\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\tz = Math.sqrt( zz );\r\n\t\t\t\t\tx = xz / z;\r\n\t\t\t\t\ty = yz / z;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\tthis.set( x, y, z, angle );\r\n\r\n\t\t\treturn this; // return 180 deg rotation\r\n\r\n\t\t}\r\n\r\n\t\t// as we have reached here there are no singularities so we can handle normally\r\n\r\n\t\tvar s = Math.sqrt( ( m32 - m23 ) * ( m32 - m23 )\r\n\t\t\t\t\t\t  + ( m13 - m31 ) * ( m13 - m31 )\r\n\t\t\t\t\t\t  + ( m21 - m12 ) * ( m21 - m12 ) ); // used to normalize\r\n\r\n\t\tif ( Math.abs( s ) < 0.001 ) s = 1;\r\n\r\n\t\t// prevent divide by zero, should not happen if matrix is orthogonal and should be\r\n\t\t// caught by singularity test above, but I've left it in just in case\r\n\r\n\t\tthis.x = ( m32 - m23 ) / s;\r\n\t\tthis.y = ( m13 - m31 ) / s;\r\n\t\tthis.z = ( m21 - m12 ) / s;\r\n\t\tthis.w = Math.acos( ( m11 + m22 + m33 - 1 ) / 2 );\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tmin: function ( v ) {\r\n\r\n\t\tif ( this.x > v.x ) {\r\n\r\n\t\t\tthis.x = v.x;\r\n\r\n\t\t}\r\n\r\n\t\tif ( this.y > v.y ) {\r\n\r\n\t\t\tthis.y = v.y;\r\n\r\n\t\t}\r\n\r\n\t\tif ( this.z > v.z ) {\r\n\r\n\t\t\tthis.z = v.z;\r\n\r\n\t\t}\r\n\r\n\t\tif ( this.w > v.w ) {\r\n\r\n\t\t\tthis.w = v.w;\r\n\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tmax: function ( v ) {\r\n\r\n\t\tif ( this.x < v.x ) {\r\n\r\n\t\t\tthis.x = v.x;\r\n\r\n\t\t}\r\n\r\n\t\tif ( this.y < v.y ) {\r\n\r\n\t\t\tthis.y = v.y;\r\n\r\n\t\t}\r\n\r\n\t\tif ( this.z < v.z ) {\r\n\r\n\t\t\tthis.z = v.z;\r\n\r\n\t\t}\r\n\r\n\t\tif ( this.w < v.w ) {\r\n\r\n\t\t\tthis.w = v.w;\r\n\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tclamp: function ( min, max ) {\r\n\r\n\t\t// This function assumes min < max, if this assumption isn't true it will not operate correctly\r\n\r\n\t\tif ( this.x < min.x ) {\r\n\r\n\t\t\tthis.x = min.x;\r\n\r\n\t\t} else if ( this.x > max.x ) {\r\n\r\n\t\t\tthis.x = max.x;\r\n\r\n\t\t}\r\n\r\n\t\tif ( this.y < min.y ) {\r\n\r\n\t\t\tthis.y = min.y;\r\n\r\n\t\t} else if ( this.y > max.y ) {\r\n\r\n\t\t\tthis.y = max.y;\r\n\r\n\t\t}\r\n\r\n\t\tif ( this.z < min.z ) {\r\n\r\n\t\t\tthis.z = min.z;\r\n\r\n\t\t} else if ( this.z > max.z ) {\r\n\r\n\t\t\tthis.z = max.z;\r\n\r\n\t\t}\r\n\r\n\t\tif ( this.w < min.w ) {\r\n\r\n\t\t\tthis.w = min.w;\r\n\r\n\t\t} else if ( this.w > max.w ) {\r\n\r\n\t\t\tthis.w = max.w;\r\n\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tclampScalar: ( function () {\r\n\r\n\t\tvar min, max;\r\n\r\n\t\treturn function ( minVal, maxVal ) {\r\n\r\n\t\t\tif ( min === undefined ) {\r\n\r\n\t\t\t\tmin = new THREE.Vector4();\r\n\t\t\t\tmax = new THREE.Vector4();\r\n\r\n\t\t\t}\r\n\r\n\t\t\tmin.set( minVal, minVal, minVal, minVal );\r\n\t\t\tmax.set( maxVal, maxVal, maxVal, maxVal );\r\n\r\n\t\t\treturn this.clamp( min, max );\r\n\r\n\t\t};\r\n\r\n\t} )(),\r\n\r\n  floor: function () {\r\n\r\n\t\tthis.x = Math.floor( this.x );\r\n\t\tthis.y = Math.floor( this.y );\r\n\t\tthis.z = Math.floor( this.z );\r\n\t\tthis.w = Math.floor( this.w );\r\n\r\n\t\treturn this;\r\n\r\n  },\r\n\r\n  ceil: function () {\r\n\r\n\t\tthis.x = Math.ceil( this.x );\r\n\t\tthis.y = Math.ceil( this.y );\r\n\t\tthis.z = Math.ceil( this.z );\r\n\t\tthis.w = Math.ceil( this.w );\r\n\r\n\t\treturn this;\r\n\r\n  },\r\n\r\n  round: function () {\r\n\r\n\t\tthis.x = Math.round( this.x );\r\n\t\tthis.y = Math.round( this.y );\r\n\t\tthis.z = Math.round( this.z );\r\n\t\tthis.w = Math.round( this.w );\r\n\r\n\t\treturn this;\r\n\r\n  },\r\n\r\n  roundToZero: function () {\r\n\r\n\t\tthis.x = ( this.x < 0 ) ? Math.ceil( this.x ) : Math.floor( this.x );\r\n\t\tthis.y = ( this.y < 0 ) ? Math.ceil( this.y ) : Math.floor( this.y );\r\n\t\tthis.z = ( this.z < 0 ) ? Math.ceil( this.z ) : Math.floor( this.z );\r\n\t\tthis.w = ( this.w < 0 ) ? Math.ceil( this.w ) : Math.floor( this.w );\r\n\r\n\t\treturn this;\r\n\r\n  },\r\n\r\n\tnegate: function () {\r\n\r\n\t\tthis.x = - this.x;\r\n\t\tthis.y = - this.y;\r\n\t\tthis.z = - this.z;\r\n\t\tthis.w = - this.w;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tdot: function ( v ) {\r\n\r\n\t\treturn this.x * v.x + this.y * v.y + this.z * v.z + this.w * v.w;\r\n\r\n\t},\r\n\r\n\tlengthSq: function () {\r\n\r\n\t\treturn this.x * this.x + this.y * this.y + this.z * this.z + this.w * this.w;\r\n\r\n\t},\r\n\r\n\tlength: function () {\r\n\r\n\t\treturn Math.sqrt( this.x * this.x + this.y * this.y + this.z * this.z + this.w * this.w );\r\n\r\n\t},\r\n\r\n\tlengthManhattan: function () {\r\n\r\n\t\treturn Math.abs( this.x ) + Math.abs( this.y ) + Math.abs( this.z ) + Math.abs( this.w );\r\n\r\n\t},\r\n\r\n\tnormalize: function () {\r\n\r\n\t\treturn this.divideScalar( this.length() );\r\n\r\n\t},\r\n\r\n\tsetLength: function ( l ) {\r\n\r\n\t\tvar oldLength = this.length();\r\n\r\n\t\tif ( oldLength !== 0 && l !== oldLength ) {\r\n\r\n\t\t\tthis.multiplyScalar( l / oldLength );\r\n\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tlerp: function ( v, alpha ) {\r\n\r\n\t\tthis.x += ( v.x - this.x ) * alpha;\r\n\t\tthis.y += ( v.y - this.y ) * alpha;\r\n\t\tthis.z += ( v.z - this.z ) * alpha;\r\n\t\tthis.w += ( v.w - this.w ) * alpha;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tlerpVectors: function ( v1, v2, alpha ) {\r\n\r\n\t\tthis.subVectors( v2, v1 ).multiplyScalar( alpha ).add( v1 );\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tequals: function ( v ) {\r\n\r\n\t\treturn ( ( v.x === this.x ) && ( v.y === this.y ) && ( v.z === this.z ) && ( v.w === this.w ) );\r\n\r\n\t},\r\n\r\n\tfromArray: function ( array, offset ) {\r\n\r\n\t\tif ( offset === undefined ) offset = 0;\r\n\r\n\t\tthis.x = array[ offset ];\r\n\t\tthis.y = array[ offset + 1 ];\r\n\t\tthis.z = array[ offset + 2 ];\r\n\t\tthis.w = array[ offset + 3 ];\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\ttoArray: function ( array, offset ) {\r\n\r\n\t\tif ( array === undefined ) array = [];\r\n\t\tif ( offset === undefined ) offset = 0;\r\n\r\n\t\tarray[ offset ] = this.x;\r\n\t\tarray[ offset + 1 ] = this.y;\r\n\t\tarray[ offset + 2 ] = this.z;\r\n\t\tarray[ offset + 3 ] = this.w;\r\n\r\n\t\treturn array;\r\n\r\n\t},\r\n\r\n\tfromAttribute: function ( attribute, index, offset ) {\r\n\r\n\t\tif ( offset === undefined ) offset = 0;\r\n\r\n\t\tindex = index * attribute.itemSize + offset;\r\n\r\n\t\tthis.x = attribute.array[ index ];\r\n\t\tthis.y = attribute.array[ index + 1 ];\r\n\t\tthis.z = attribute.array[ index + 2 ];\r\n\t\tthis.w = attribute.array[ index + 3 ];\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tclone: function () {\r\n\r\n\t\treturn new THREE.Vector4( this.x, this.y, this.z, this.w );\r\n\r\n\t}\r\n\r\n};\r\n\r\n// File:src/math/Euler.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author WestLangley / http://github.com/WestLangley\r\n * @author bhouston / http://exocortex.com\r\n */\r\n\r\nTHREE.Euler = function ( x, y, z, order ) {\r\n\r\n\tthis._x = x || 0;\r\n\tthis._y = y || 0;\r\n\tthis._z = z || 0;\r\n\tthis._order = order || THREE.Euler.DefaultOrder;\r\n\r\n};\r\n\r\nTHREE.Euler.RotationOrders = [ 'XYZ', 'YZX', 'ZXY', 'XZY', 'YXZ', 'ZYX' ];\r\n\r\nTHREE.Euler.DefaultOrder = 'XYZ';\r\n\r\nTHREE.Euler.prototype = {\r\n\r\n\tconstructor: THREE.Euler,\r\n\r\n\t_x: 0, _y: 0, _z: 0, _order: THREE.Euler.DefaultOrder,\r\n\r\n\tget x () {\r\n\r\n\t\treturn this._x;\r\n\r\n\t},\r\n\r\n\tset x ( value ) {\r\n\r\n\t\tthis._x = value;\r\n\t\tthis.onChangeCallback();\r\n\r\n\t},\r\n\r\n\tget y () {\r\n\r\n\t\treturn this._y;\r\n\r\n\t},\r\n\r\n\tset y ( value ) {\r\n\r\n\t\tthis._y = value;\r\n\t\tthis.onChangeCallback();\r\n\r\n\t},\r\n\r\n\tget z () {\r\n\r\n\t\treturn this._z;\r\n\r\n\t},\r\n\r\n\tset z ( value ) {\r\n\r\n\t\tthis._z = value;\r\n\t\tthis.onChangeCallback();\r\n\r\n\t},\r\n\r\n\tget order () {\r\n\r\n\t\treturn this._order;\r\n\r\n\t},\r\n\r\n\tset order ( value ) {\r\n\r\n\t\tthis._order = value;\r\n\t\tthis.onChangeCallback();\r\n\r\n\t},\r\n\r\n\tset: function ( x, y, z, order ) {\r\n\r\n\t\tthis._x = x;\r\n\t\tthis._y = y;\r\n\t\tthis._z = z;\r\n\t\tthis._order = order || this._order;\r\n\r\n\t\tthis.onChangeCallback();\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tcopy: function ( euler ) {\r\n\r\n\t\tthis._x = euler._x;\r\n\t\tthis._y = euler._y;\r\n\t\tthis._z = euler._z;\r\n\t\tthis._order = euler._order;\r\n\r\n\t\tthis.onChangeCallback();\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tsetFromRotationMatrix: function ( m, order, update ) {\r\n\r\n\t\tvar clamp = THREE.Math.clamp;\r\n\r\n\t\t// assumes the upper 3x3 of m is a pure rotation matrix (i.e, unscaled)\r\n\r\n\t\tvar te = m.elements;\r\n\t\tvar m11 = te[ 0 ], m12 = te[ 4 ], m13 = te[ 8 ];\r\n\t\tvar m21 = te[ 1 ], m22 = te[ 5 ], m23 = te[ 9 ];\r\n\t\tvar m31 = te[ 2 ], m32 = te[ 6 ], m33 = te[ 10 ];\r\n\r\n\t\torder = order || this._order;\r\n\r\n\t\tif ( order === 'XYZ' ) {\r\n\r\n\t\t\tthis._y = Math.asin( clamp( m13, - 1, 1 ) );\r\n\r\n\t\t\tif ( Math.abs( m13 ) < 0.99999 ) {\r\n\r\n\t\t\t\tthis._x = Math.atan2( - m23, m33 );\r\n\t\t\t\tthis._z = Math.atan2( - m12, m11 );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tthis._x = Math.atan2( m32, m22 );\r\n\t\t\t\tthis._z = 0;\r\n\r\n\t\t\t}\r\n\r\n\t\t} else if ( order === 'YXZ' ) {\r\n\r\n\t\t\tthis._x = Math.asin( - clamp( m23, - 1, 1 ) );\r\n\r\n\t\t\tif ( Math.abs( m23 ) < 0.99999 ) {\r\n\r\n\t\t\t\tthis._y = Math.atan2( m13, m33 );\r\n\t\t\t\tthis._z = Math.atan2( m21, m22 );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tthis._y = Math.atan2( - m31, m11 );\r\n\t\t\t\tthis._z = 0;\r\n\r\n\t\t\t}\r\n\r\n\t\t} else if ( order === 'ZXY' ) {\r\n\r\n\t\t\tthis._x = Math.asin( clamp( m32, - 1, 1 ) );\r\n\r\n\t\t\tif ( Math.abs( m32 ) < 0.99999 ) {\r\n\r\n\t\t\t\tthis._y = Math.atan2( - m31, m33 );\r\n\t\t\t\tthis._z = Math.atan2( - m12, m22 );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tthis._y = 0;\r\n\t\t\t\tthis._z = Math.atan2( m21, m11 );\r\n\r\n\t\t\t}\r\n\r\n\t\t} else if ( order === 'ZYX' ) {\r\n\r\n\t\t\tthis._y = Math.asin( - clamp( m31, - 1, 1 ) );\r\n\r\n\t\t\tif ( Math.abs( m31 ) < 0.99999 ) {\r\n\r\n\t\t\t\tthis._x = Math.atan2( m32, m33 );\r\n\t\t\t\tthis._z = Math.atan2( m21, m11 );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tthis._x = 0;\r\n\t\t\t\tthis._z = Math.atan2( - m12, m22 );\r\n\r\n\t\t\t}\r\n\r\n\t\t} else if ( order === 'YZX' ) {\r\n\r\n\t\t\tthis._z = Math.asin( clamp( m21, - 1, 1 ) );\r\n\r\n\t\t\tif ( Math.abs( m21 ) < 0.99999 ) {\r\n\r\n\t\t\t\tthis._x = Math.atan2( - m23, m22 );\r\n\t\t\t\tthis._y = Math.atan2( - m31, m11 );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tthis._x = 0;\r\n\t\t\t\tthis._y = Math.atan2( m13, m33 );\r\n\r\n\t\t\t}\r\n\r\n\t\t} else if ( order === 'XZY' ) {\r\n\r\n\t\t\tthis._z = Math.asin( - clamp( m12, - 1, 1 ) );\r\n\r\n\t\t\tif ( Math.abs( m12 ) < 0.99999 ) {\r\n\r\n\t\t\t\tthis._x = Math.atan2( m32, m22 );\r\n\t\t\t\tthis._y = Math.atan2( m13, m11 );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tthis._x = Math.atan2( - m23, m33 );\r\n\t\t\t\tthis._y = 0;\r\n\r\n\t\t\t}\r\n\r\n\t\t} else {\r\n\r\n\t\t\tTHREE.warn( 'THREE.Euler: .setFromRotationMatrix() given unsupported order: ' + order )\r\n\r\n\t\t}\r\n\r\n\t\tthis._order = order;\r\n\r\n\t\tif ( update !== false ) this.onChangeCallback();\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tsetFromQuaternion: function () {\r\n\r\n\t\tvar matrix;\r\n\r\n\t\treturn function ( q, order, update ) {\r\n\r\n\t\t\tif ( matrix === undefined ) matrix = new THREE.Matrix4();\r\n\t\t\tmatrix.makeRotationFromQuaternion( q );\r\n\t\t\tthis.setFromRotationMatrix( matrix, order, update );\r\n\r\n\t\t\treturn this;\r\n\r\n\t\t};\r\n\r\n\t}(),\r\n\r\n\tsetFromVector3: function ( v, order ) {\r\n\r\n\t\treturn this.set( v.x, v.y, v.z, order || this._order );\r\n\r\n\t},\r\n\r\n\treorder: function () {\r\n\r\n\t\t// WARNING: this discards revolution information -bhouston\r\n\r\n\t\tvar q = new THREE.Quaternion();\r\n\r\n\t\treturn function ( newOrder ) {\r\n\r\n\t\t\tq.setFromEuler( this );\r\n\t\t\tthis.setFromQuaternion( q, newOrder );\r\n\r\n\t\t};\r\n\r\n\t}(),\r\n\r\n\tequals: function ( euler ) {\r\n\r\n\t\treturn ( euler._x === this._x ) && ( euler._y === this._y ) && ( euler._z === this._z ) && ( euler._order === this._order );\r\n\r\n\t},\r\n\r\n\tfromArray: function ( array ) {\r\n\r\n\t\tthis._x = array[ 0 ];\r\n\t\tthis._y = array[ 1 ];\r\n\t\tthis._z = array[ 2 ];\r\n\t\tif ( array[ 3 ] !== undefined ) this._order = array[ 3 ];\r\n\r\n\t\tthis.onChangeCallback();\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\ttoArray: function ( array, offset ) {\r\n\r\n\t\tif ( array === undefined ) array = [];\r\n\t\tif ( offset === undefined ) offset = 0;\r\n\r\n\t\tarray[ offset ] = this._x;\r\n\t\tarray[ offset + 1 ] = this._y;\r\n\t\tarray[ offset + 2 ] = this._z;\r\n\t\tarray[ offset + 3 ] = this._order;\r\n\r\n\t\treturn array;\r\n\t},\r\n\r\n\ttoVector3: function ( optionalResult ) {\r\n\r\n\t\tif ( optionalResult ) {\r\n\r\n\t\t\treturn optionalResult.set( this._x, this._y, this._z );\r\n\r\n\t\t} else {\r\n\r\n\t\t\treturn new THREE.Vector3( this._x, this._y, this._z );\r\n\r\n\t\t}\r\n\r\n\t},\r\n\r\n\tonChange: function ( callback ) {\r\n\r\n\t\tthis.onChangeCallback = callback;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tonChangeCallback: function () {},\r\n\r\n\tclone: function () {\r\n\r\n\t\treturn new THREE.Euler( this._x, this._y, this._z, this._order );\r\n\r\n\t}\r\n\r\n};\r\n\r\n// File:src/math/Line3.js\r\n\r\n/**\r\n * @author bhouston / http://exocortex.com\r\n */\r\n\r\nTHREE.Line3 = function ( start, end ) {\r\n\r\n\tthis.start = ( start !== undefined ) ? start : new THREE.Vector3();\r\n\tthis.end = ( end !== undefined ) ? end : new THREE.Vector3();\r\n\r\n};\r\n\r\nTHREE.Line3.prototype = {\r\n\r\n\tconstructor: THREE.Line3,\r\n\r\n\tset: function ( start, end ) {\r\n\r\n\t\tthis.start.copy( start );\r\n\t\tthis.end.copy( end );\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tcopy: function ( line ) {\r\n\r\n\t\tthis.start.copy( line.start );\r\n\t\tthis.end.copy( line.end );\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tcenter: function ( optionalTarget ) {\r\n\r\n\t\tvar result = optionalTarget || new THREE.Vector3();\r\n\t\treturn result.addVectors( this.start, this.end ).multiplyScalar( 0.5 );\r\n\r\n\t},\r\n\r\n\tdelta: function ( optionalTarget ) {\r\n\r\n\t\tvar result = optionalTarget || new THREE.Vector3();\r\n\t\treturn result.subVectors( this.end, this.start );\r\n\r\n\t},\r\n\r\n\tdistanceSq: function () {\r\n\r\n\t\treturn this.start.distanceToSquared( this.end );\r\n\r\n\t},\r\n\r\n\tdistance: function () {\r\n\r\n\t\treturn this.start.distanceTo( this.end );\r\n\r\n\t},\r\n\r\n\tat: function ( t, optionalTarget ) {\r\n\r\n\t\tvar result = optionalTarget || new THREE.Vector3();\r\n\r\n\t\treturn this.delta( result ).multiplyScalar( t ).add( this.start );\r\n\r\n\t},\r\n\r\n\tclosestPointToPointParameter: function () {\r\n\r\n\t\tvar startP = new THREE.Vector3();\r\n\t\tvar startEnd = new THREE.Vector3();\r\n\r\n\t\treturn function ( point, clampToLine ) {\r\n\r\n\t\t\tstartP.subVectors( point, this.start );\r\n\t\t\tstartEnd.subVectors( this.end, this.start );\r\n\r\n\t\t\tvar startEnd2 = startEnd.dot( startEnd );\r\n\t\t\tvar startEnd_startP = startEnd.dot( startP );\r\n\r\n\t\t\tvar t = startEnd_startP / startEnd2;\r\n\r\n\t\t\tif ( clampToLine ) {\r\n\r\n\t\t\t\tt = THREE.Math.clamp( t, 0, 1 );\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn t;\r\n\r\n\t\t};\r\n\r\n\t}(),\r\n\r\n\tclosestPointToPoint: function ( point, clampToLine, optionalTarget ) {\r\n\r\n\t\tvar t = this.closestPointToPointParameter( point, clampToLine );\r\n\r\n\t\tvar result = optionalTarget || new THREE.Vector3();\r\n\r\n\t\treturn this.delta( result ).multiplyScalar( t ).add( this.start );\r\n\r\n\t},\r\n\r\n\tapplyMatrix4: function ( matrix ) {\r\n\r\n\t\tthis.start.applyMatrix4( matrix );\r\n\t\tthis.end.applyMatrix4( matrix );\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tequals: function ( line ) {\r\n\r\n\t\treturn line.start.equals( this.start ) && line.end.equals( this.end );\r\n\r\n\t},\r\n\r\n\tclone: function () {\r\n\r\n\t\treturn new THREE.Line3().copy( this );\r\n\r\n\t}\r\n\r\n};\r\n\r\n// File:src/math/Box2.js\r\n\r\n/**\r\n * @author bhouston / http://exocortex.com\r\n */\r\n\r\nTHREE.Box2 = function ( min, max ) {\r\n\r\n\tthis.min = ( min !== undefined ) ? min : new THREE.Vector2( Infinity, Infinity );\r\n\tthis.max = ( max !== undefined ) ? max : new THREE.Vector2( - Infinity, - Infinity );\r\n\r\n};\r\n\r\nTHREE.Box2.prototype = {\r\n\r\n\tconstructor: THREE.Box2,\r\n\r\n\tset: function ( min, max ) {\r\n\r\n\t\tthis.min.copy( min );\r\n\t\tthis.max.copy( max );\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tsetFromPoints: function ( points ) {\r\n\r\n\t\tthis.makeEmpty();\r\n\r\n\t\tfor ( var i = 0, il = points.length; i < il; i ++ ) {\r\n\r\n\t\t\tthis.expandByPoint( points[ i ] )\r\n\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tsetFromCenterAndSize: function () {\r\n\r\n\t\tvar v1 = new THREE.Vector2();\r\n\r\n\t\treturn function ( center, size ) {\r\n\r\n\t\t\tvar halfSize = v1.copy( size ).multiplyScalar( 0.5 );\r\n\t\t\tthis.min.copy( center ).sub( halfSize );\r\n\t\t\tthis.max.copy( center ).add( halfSize );\r\n\r\n\t\t\treturn this;\r\n\r\n\t\t};\r\n\r\n\t}(),\r\n\r\n\tcopy: function ( box ) {\r\n\r\n\t\tthis.min.copy( box.min );\r\n\t\tthis.max.copy( box.max );\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tmakeEmpty: function () {\r\n\r\n\t\tthis.min.x = this.min.y = Infinity;\r\n\t\tthis.max.x = this.max.y = - Infinity;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tempty: function () {\r\n\r\n\t\t// this is a more robust check for empty than ( volume <= 0 ) because volume can get positive with two negative axes\r\n\r\n\t\treturn ( this.max.x < this.min.x ) || ( this.max.y < this.min.y );\r\n\r\n\t},\r\n\r\n\tcenter: function ( optionalTarget ) {\r\n\r\n\t\tvar result = optionalTarget || new THREE.Vector2();\r\n\t\treturn result.addVectors( this.min, this.max ).multiplyScalar( 0.5 );\r\n\r\n\t},\r\n\r\n\tsize: function ( optionalTarget ) {\r\n\r\n\t\tvar result = optionalTarget || new THREE.Vector2();\r\n\t\treturn result.subVectors( this.max, this.min );\r\n\r\n\t},\r\n\r\n\texpandByPoint: function ( point ) {\r\n\r\n\t\tthis.min.min( point );\r\n\t\tthis.max.max( point );\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\texpandByVector: function ( vector ) {\r\n\r\n\t\tthis.min.sub( vector );\r\n\t\tthis.max.add( vector );\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\texpandByScalar: function ( scalar ) {\r\n\r\n\t\tthis.min.addScalar( - scalar );\r\n\t\tthis.max.addScalar( scalar );\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\tcontainsPoint: function ( point ) {\r\n\r\n\t\tif ( point.x < this.min.x || point.x > this.max.x ||\r\n\t\t     point.y < this.min.y || point.y > this.max.y ) {\r\n\r\n\t\t\treturn false;\r\n\r\n\t\t}\r\n\r\n\t\treturn true;\r\n\r\n\t},\r\n\r\n\tcontainsBox: function ( box ) {\r\n\r\n\t\tif ( ( this.min.x <= box.min.x ) && ( box.max.x <= this.max.x ) &&\r\n\t\t     ( this.min.y <= box.min.y ) && ( box.max.y <= this.max.y ) ) {\r\n\r\n\t\t\treturn true;\r\n\r\n\t\t}\r\n\r\n\t\treturn false;\r\n\r\n\t},\r\n\r\n\tgetParameter: function ( point, optionalTarget ) {\r\n\r\n\t\t// This can potentially have a divide by zero if the box\r\n\t\t// has a size dimension of 0.\r\n\r\n\t\tvar result = optionalTarget || new THREE.Vector2();\r\n\r\n\t\treturn result.set(\r\n\t\t\t( point.x - this.min.x ) / ( this.max.x - this.min.x ),\r\n\t\t\t( point.y - this.min.y ) / ( this.max.y - this.min.y )\r\n\t\t);\r\n\r\n\t},\r\n\r\n\tisIntersectionBox: function ( box ) {\r\n\r\n\t\t// using 6 splitting planes to rule out intersections.\r\n\r\n\t\tif ( box.max.x < this.min.x || box.min.x > this.max.x ||\r\n\t\t     box.max.y < this.min.y || box.min.y > this.max.y ) {\r\n\r\n\t\t\treturn false;\r\n\r\n\t\t}\r\n\r\n\t\treturn true;\r\n\r\n\t},\r\n\r\n\tclampPoint: function ( point, optionalTarget ) {\r\n\r\n\t\tvar result = optionalTarget || new THREE.Vector2();\r\n\t\treturn result.copy( point ).clamp( this.min, this.max );\r\n\r\n\t},\r\n\r\n\tdistanceToPoint: function () {\r\n\r\n\t\tvar v1 = new THREE.Vector2();\r\n\r\n\t\treturn function ( point ) {\r\n\r\n\t\t\tvar clampedPoint = v1.copy( point ).clamp( this.min, this.max );\r\n\t\t\treturn clampedPoint.sub( point ).length();\r\n\r\n\t\t};\r\n\r\n\t}(),\r\n\r\n\tintersect: function ( box ) {\r\n\r\n\t\tthis.min.max( box.min );\r\n\t\tthis.max.min( box.max );\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tunion: function ( box ) {\r\n\r\n\t\tthis.min.min( box.min );\r\n\t\tthis.max.max( box.max );\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\ttranslate: function ( offset ) {\r\n\r\n\t\tthis.min.add( offset );\r\n\t\tthis.max.add( offset );\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tequals: function ( box ) {\r\n\r\n\t\treturn box.min.equals( this.min ) && box.max.equals( this.max );\r\n\r\n\t},\r\n\r\n\tclone: function () {\r\n\r\n\t\treturn new THREE.Box2().copy( this );\r\n\r\n\t}\r\n\r\n};\r\n\r\n// File:src/math/Box3.js\r\n\r\n/**\r\n * @author bhouston / http://exocortex.com\r\n * @author WestLangley / http://github.com/WestLangley\r\n */\r\n\r\nTHREE.Box3 = function ( min, max ) {\r\n\r\n\tthis.min = ( min !== undefined ) ? min : new THREE.Vector3( Infinity, Infinity, Infinity );\r\n\tthis.max = ( max !== undefined ) ? max : new THREE.Vector3( - Infinity, - Infinity, - Infinity );\r\n\r\n};\r\n\r\nTHREE.Box3.prototype = {\r\n\r\n\tconstructor: THREE.Box3,\r\n\r\n\tset: function ( min, max ) {\r\n\r\n\t\tthis.min.copy( min );\r\n\t\tthis.max.copy( max );\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tsetFromPoints: function ( points ) {\r\n\r\n\t\tthis.makeEmpty();\r\n\r\n\t\tfor ( var i = 0, il = points.length; i < il; i ++ ) {\r\n\r\n\t\t\tthis.expandByPoint( points[ i ] )\r\n\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tsetFromCenterAndSize: function () {\r\n\r\n\t\tvar v1 = new THREE.Vector3();\r\n\r\n\t\treturn function ( center, size ) {\r\n\r\n\t\t\tvar halfSize = v1.copy( size ).multiplyScalar( 0.5 );\r\n\r\n\t\t\tthis.min.copy( center ).sub( halfSize );\r\n\t\t\tthis.max.copy( center ).add( halfSize );\r\n\r\n\t\t\treturn this;\r\n\r\n\t\t};\r\n\r\n\t}(),\r\n\r\n\tsetFromObject: function () {\r\n\r\n\t\t// Computes the world-axis-aligned bounding box of an object (including its children),\r\n\t\t// accounting for both the object's, and childrens', world transforms\r\n\r\n\t\tvar v1 = new THREE.Vector3();\r\n\r\n\t\treturn function ( object ) {\r\n\r\n\t\t\tvar scope = this;\r\n\r\n\t\t\tobject.updateMatrixWorld( true );\r\n\r\n\t\t\tthis.makeEmpty();\r\n\r\n\t\t\tobject.traverse( function ( node ) {\r\n\r\n\t\t\t\tvar geometry = node.geometry;\r\n\r\n\t\t\t\tif ( geometry !== undefined ) {\r\n\r\n\t\t\t\t\tif ( geometry instanceof THREE.Geometry ) {\r\n\r\n\t\t\t\t\t\tvar vertices = geometry.vertices;\r\n\r\n\t\t\t\t\t\tfor ( var i = 0, il = vertices.length; i < il; i ++ ) {\r\n\r\n\t\t\t\t\t\t\tv1.copy( vertices[ i ] );\r\n\r\n\t\t\t\t\t\t\tv1.applyMatrix4( node.matrixWorld );\r\n\r\n\t\t\t\t\t\t\tscope.expandByPoint( v1 );\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t} else if ( geometry instanceof THREE.BufferGeometry && geometry.attributes[ 'position' ] !== undefined ) {\r\n\r\n\t\t\t\t\t\tvar positions = geometry.attributes[ 'position' ].array;\r\n\r\n\t\t\t\t\t\tfor ( var i = 0, il = positions.length; i < il; i += 3 ) {\r\n\r\n\t\t\t\t\t\t\tv1.set( positions[ i ], positions[ i + 1 ], positions[ i + 2 ] );\r\n\r\n\t\t\t\t\t\t\tv1.applyMatrix4( node.matrixWorld );\r\n\r\n\t\t\t\t\t\t\tscope.expandByPoint( v1 );\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t} );\r\n\r\n\t\t\treturn this;\r\n\r\n\t\t};\r\n\r\n\t}(),\r\n\r\n\tcopy: function ( box ) {\r\n\r\n\t\tthis.min.copy( box.min );\r\n\t\tthis.max.copy( box.max );\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tmakeEmpty: function () {\r\n\r\n\t\tthis.min.x = this.min.y = this.min.z = Infinity;\r\n\t\tthis.max.x = this.max.y = this.max.z = - Infinity;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tempty: function () {\r\n\r\n\t\t// this is a more robust check for empty than ( volume <= 0 ) because volume can get positive with two negative axes\r\n\r\n\t\treturn ( this.max.x < this.min.x ) || ( this.max.y < this.min.y ) || ( this.max.z < this.min.z );\r\n\r\n\t},\r\n\r\n\tcenter: function ( optionalTarget ) {\r\n\r\n\t\tvar result = optionalTarget || new THREE.Vector3();\r\n\t\treturn result.addVectors( this.min, this.max ).multiplyScalar( 0.5 );\r\n\r\n\t},\r\n\r\n\tsize: function ( optionalTarget ) {\r\n\r\n\t\tvar result = optionalTarget || new THREE.Vector3();\r\n\t\treturn result.subVectors( this.max, this.min );\r\n\r\n\t},\r\n\r\n\texpandByPoint: function ( point ) {\r\n\r\n\t\tthis.min.min( point );\r\n\t\tthis.max.max( point );\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\texpandByVector: function ( vector ) {\r\n\r\n\t\tthis.min.sub( vector );\r\n\t\tthis.max.add( vector );\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\texpandByScalar: function ( scalar ) {\r\n\r\n\t\tthis.min.addScalar( - scalar );\r\n\t\tthis.max.addScalar( scalar );\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tcontainsPoint: function ( point ) {\r\n\r\n\t\tif ( point.x < this.min.x || point.x > this.max.x ||\r\n\t\t     point.y < this.min.y || point.y > this.max.y ||\r\n\t\t     point.z < this.min.z || point.z > this.max.z ) {\r\n\r\n\t\t\treturn false;\r\n\r\n\t\t}\r\n\r\n\t\treturn true;\r\n\r\n\t},\r\n\r\n\tcontainsBox: function ( box ) {\r\n\r\n\t\tif ( ( this.min.x <= box.min.x ) && ( box.max.x <= this.max.x ) &&\r\n\t\t\t ( this.min.y <= box.min.y ) && ( box.max.y <= this.max.y ) &&\r\n\t\t\t ( this.min.z <= box.min.z ) && ( box.max.z <= this.max.z ) ) {\r\n\r\n\t\t\treturn true;\r\n\r\n\t\t}\r\n\r\n\t\treturn false;\r\n\r\n\t},\r\n\r\n\tgetParameter: function ( point, optionalTarget ) {\r\n\r\n\t\t// This can potentially have a divide by zero if the box\r\n\t\t// has a size dimension of 0.\r\n\r\n\t\tvar result = optionalTarget || new THREE.Vector3();\r\n\r\n\t\treturn result.set(\r\n\t\t\t( point.x - this.min.x ) / ( this.max.x - this.min.x ),\r\n\t\t\t( point.y - this.min.y ) / ( this.max.y - this.min.y ),\r\n\t\t\t( point.z - this.min.z ) / ( this.max.z - this.min.z )\r\n\t\t);\r\n\r\n\t},\r\n\r\n\tisIntersectionBox: function ( box ) {\r\n\r\n\t\t// using 6 splitting planes to rule out intersections.\r\n\r\n\t\tif ( box.max.x < this.min.x || box.min.x > this.max.x ||\r\n\t\t     box.max.y < this.min.y || box.min.y > this.max.y ||\r\n\t\t     box.max.z < this.min.z || box.min.z > this.max.z ) {\r\n\r\n\t\t\treturn false;\r\n\r\n\t\t}\r\n\r\n\t\treturn true;\r\n\r\n\t},\r\n\r\n\tclampPoint: function ( point, optionalTarget ) {\r\n\r\n\t\tvar result = optionalTarget || new THREE.Vector3();\r\n\t\treturn result.copy( point ).clamp( this.min, this.max );\r\n\r\n\t},\r\n\r\n\tdistanceToPoint: function () {\r\n\r\n\t\tvar v1 = new THREE.Vector3();\r\n\r\n\t\treturn function ( point ) {\r\n\r\n\t\t\tvar clampedPoint = v1.copy( point ).clamp( this.min, this.max );\r\n\t\t\treturn clampedPoint.sub( point ).length();\r\n\r\n\t\t};\r\n\r\n\t}(),\r\n\r\n\tgetBoundingSphere: function () {\r\n\r\n\t\tvar v1 = new THREE.Vector3();\r\n\r\n\t\treturn function ( optionalTarget ) {\r\n\r\n\t\t\tvar result = optionalTarget || new THREE.Sphere();\r\n\r\n\t\t\tresult.center = this.center();\r\n\t\t\tresult.radius = this.size( v1 ).length() * 0.5;\r\n\r\n\t\t\treturn result;\r\n\r\n\t\t};\r\n\r\n\t}(),\r\n\r\n\tintersect: function ( box ) {\r\n\r\n\t\tthis.min.max( box.min );\r\n\t\tthis.max.min( box.max );\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tunion: function ( box ) {\r\n\r\n\t\tthis.min.min( box.min );\r\n\t\tthis.max.max( box.max );\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tapplyMatrix4: function () {\r\n\r\n\t\tvar points = [\r\n\t\t\tnew THREE.Vector3(),\r\n\t\t\tnew THREE.Vector3(),\r\n\t\t\tnew THREE.Vector3(),\r\n\t\t\tnew THREE.Vector3(),\r\n\t\t\tnew THREE.Vector3(),\r\n\t\t\tnew THREE.Vector3(),\r\n\t\t\tnew THREE.Vector3(),\r\n\t\t\tnew THREE.Vector3()\r\n\t\t];\r\n\r\n\t\treturn function ( matrix ) {\r\n\r\n\t\t\t// NOTE: I am using a binary pattern to specify all 2^3 combinations below\r\n\t\t\tpoints[ 0 ].set( this.min.x, this.min.y, this.min.z ).applyMatrix4( matrix ); // 000\r\n\t\t\tpoints[ 1 ].set( this.min.x, this.min.y, this.max.z ).applyMatrix4( matrix ); // 001\r\n\t\t\tpoints[ 2 ].set( this.min.x, this.max.y, this.min.z ).applyMatrix4( matrix ); // 010\r\n\t\t\tpoints[ 3 ].set( this.min.x, this.max.y, this.max.z ).applyMatrix4( matrix ); // 011\r\n\t\t\tpoints[ 4 ].set( this.max.x, this.min.y, this.min.z ).applyMatrix4( matrix ); // 100\r\n\t\t\tpoints[ 5 ].set( this.max.x, this.min.y, this.max.z ).applyMatrix4( matrix ); // 101\r\n\t\t\tpoints[ 6 ].set( this.max.x, this.max.y, this.min.z ).applyMatrix4( matrix ); // 110\r\n\t\t\tpoints[ 7 ].set( this.max.x, this.max.y, this.max.z ).applyMatrix4( matrix );  // 111\r\n\r\n\t\t\tthis.makeEmpty();\r\n\t\t\tthis.setFromPoints( points );\r\n\r\n\t\t\treturn this;\r\n\r\n\t\t};\r\n\r\n\t}(),\r\n\r\n\ttranslate: function ( offset ) {\r\n\r\n\t\tthis.min.add( offset );\r\n\t\tthis.max.add( offset );\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tequals: function ( box ) {\r\n\r\n\t\treturn box.min.equals( this.min ) && box.max.equals( this.max );\r\n\r\n\t},\r\n\r\n\tclone: function () {\r\n\r\n\t\treturn new THREE.Box3().copy( this );\r\n\r\n\t}\r\n\r\n};\r\n\r\n// File:src/math/Matrix3.js\r\n\r\n/**\r\n * @author alteredq / http://alteredqualia.com/\r\n * @author WestLangley / http://github.com/WestLangley\r\n * @author bhouston / http://exocortex.com\r\n */\r\n\r\nTHREE.Matrix3 = function () {\r\n\r\n\tthis.elements = new Float32Array( [\r\n\r\n\t\t1, 0, 0,\r\n\t\t0, 1, 0,\r\n\t\t0, 0, 1\r\n\r\n\t] );\r\n\r\n\tif ( arguments.length > 0 ) {\r\n\r\n\t\tTHREE.error( 'THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.' );\r\n\r\n\t}\r\n\r\n};\r\n\r\nTHREE.Matrix3.prototype = {\r\n\r\n\tconstructor: THREE.Matrix3,\r\n\r\n\tset: function ( n11, n12, n13, n21, n22, n23, n31, n32, n33 ) {\r\n\r\n\t\tvar te = this.elements;\r\n\r\n\t\tte[ 0 ] = n11; te[ 3 ] = n12; te[ 6 ] = n13;\r\n\t\tte[ 1 ] = n21; te[ 4 ] = n22; te[ 7 ] = n23;\r\n\t\tte[ 2 ] = n31; te[ 5 ] = n32; te[ 8 ] = n33;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tidentity: function () {\r\n\r\n\t\tthis.set(\r\n\r\n\t\t\t1, 0, 0,\r\n\t\t\t0, 1, 0,\r\n\t\t\t0, 0, 1\r\n\r\n\t\t);\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tcopy: function ( m ) {\r\n\r\n\t\tvar me = m.elements;\r\n\r\n\t\tthis.set(\r\n\r\n\t\t\tme[ 0 ], me[ 3 ], me[ 6 ],\r\n\t\t\tme[ 1 ], me[ 4 ], me[ 7 ],\r\n\t\t\tme[ 2 ], me[ 5 ], me[ 8 ]\r\n\r\n\t\t);\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tmultiplyVector3: function ( vector ) {\r\n\r\n\t\tTHREE.warn( 'THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead.' );\r\n\t\treturn vector.applyMatrix3( this );\r\n\r\n\t},\r\n\r\n\tmultiplyVector3Array: function ( a ) {\r\n\r\n\t\tTHREE.warn( 'THREE.Matrix3: .multiplyVector3Array() has been renamed. Use matrix.applyToVector3Array( array ) instead.' );\r\n\t\treturn this.applyToVector3Array( a );\r\n\r\n\t},\r\n\r\n\tapplyToVector3Array: function () {\r\n\r\n\t\tvar v1 = new THREE.Vector3();\r\n\r\n\t\treturn function ( array, offset, length ) {\r\n\r\n\t\t\tif ( offset === undefined ) offset = 0;\r\n\t\t\tif ( length === undefined ) length = array.length;\r\n\r\n\t\t\tfor ( var i = 0, j = offset; i < length; i += 3, j += 3 ) {\r\n\r\n\t\t\t\tv1.x = array[ j ];\r\n\t\t\t\tv1.y = array[ j + 1 ];\r\n\t\t\t\tv1.z = array[ j + 2 ];\r\n\r\n\t\t\t\tv1.applyMatrix3( this );\r\n\r\n\t\t\t\tarray[ j ]     = v1.x;\r\n\t\t\t\tarray[ j + 1 ] = v1.y;\r\n\t\t\t\tarray[ j + 2 ] = v1.z;\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn array;\r\n\r\n\t\t};\r\n\r\n\t}(),\r\n\r\n\tmultiplyScalar: function ( s ) {\r\n\r\n\t\tvar te = this.elements;\r\n\r\n\t\tte[ 0 ] *= s; te[ 3 ] *= s; te[ 6 ] *= s;\r\n\t\tte[ 1 ] *= s; te[ 4 ] *= s; te[ 7 ] *= s;\r\n\t\tte[ 2 ] *= s; te[ 5 ] *= s; te[ 8 ] *= s;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tdeterminant: function () {\r\n\r\n\t\tvar te = this.elements;\r\n\r\n\t\tvar a = te[ 0 ], b = te[ 1 ], c = te[ 2 ],\r\n\t\t\td = te[ 3 ], e = te[ 4 ], f = te[ 5 ],\r\n\t\t\tg = te[ 6 ], h = te[ 7 ], i = te[ 8 ];\r\n\r\n\t\treturn a * e * i - a * f * h - b * d * i + b * f * g + c * d * h - c * e * g;\r\n\r\n\t},\r\n\r\n\tgetInverse: function ( matrix, throwOnInvertible ) {\r\n\r\n\t\t// input: THREE.Matrix4\r\n\t\t// ( based on http://code.google.com/p/webgl-mjs/ )\r\n\r\n\t\tvar me = matrix.elements;\r\n\t\tvar te = this.elements;\r\n\r\n\t\tte[ 0 ] =   me[ 10 ] * me[ 5 ] - me[ 6 ] * me[ 9 ];\r\n\t\tte[ 1 ] = - me[ 10 ] * me[ 1 ] + me[ 2 ] * me[ 9 ];\r\n\t\tte[ 2 ] =   me[ 6 ] * me[ 1 ] - me[ 2 ] * me[ 5 ];\r\n\t\tte[ 3 ] = - me[ 10 ] * me[ 4 ] + me[ 6 ] * me[ 8 ];\r\n\t\tte[ 4 ] =   me[ 10 ] * me[ 0 ] - me[ 2 ] * me[ 8 ];\r\n\t\tte[ 5 ] = - me[ 6 ] * me[ 0 ] + me[ 2 ] * me[ 4 ];\r\n\t\tte[ 6 ] =   me[ 9 ] * me[ 4 ] - me[ 5 ] * me[ 8 ];\r\n\t\tte[ 7 ] = - me[ 9 ] * me[ 0 ] + me[ 1 ] * me[ 8 ];\r\n\t\tte[ 8 ] =   me[ 5 ] * me[ 0 ] - me[ 1 ] * me[ 4 ];\r\n\r\n\t\tvar det = me[ 0 ] * te[ 0 ] + me[ 1 ] * te[ 3 ] + me[ 2 ] * te[ 6 ];\r\n\r\n\t\t// no inverse\r\n\r\n\t\tif ( det === 0 ) {\r\n\r\n\t\t\tvar msg = \"Matrix3.getInverse(): can't invert matrix, determinant is 0\";\r\n\r\n\t\t\tif ( throwOnInvertible || false ) {\r\n\r\n\t\t\t\tthrow new Error( msg );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tTHREE.warn( msg );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tthis.identity();\r\n\r\n\t\t\treturn this;\r\n\r\n\t\t}\r\n\r\n\t\tthis.multiplyScalar( 1.0 / det );\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\ttranspose: function () {\r\n\r\n\t\tvar tmp, m = this.elements;\r\n\r\n\t\ttmp = m[ 1 ]; m[ 1 ] = m[ 3 ]; m[ 3 ] = tmp;\r\n\t\ttmp = m[ 2 ]; m[ 2 ] = m[ 6 ]; m[ 6 ] = tmp;\r\n\t\ttmp = m[ 5 ]; m[ 5 ] = m[ 7 ]; m[ 7 ] = tmp;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tflattenToArrayOffset: function ( array, offset ) {\r\n\r\n\t\tvar te = this.elements;\r\n\r\n\t\tarray[ offset     ] = te[ 0 ];\r\n\t\tarray[ offset + 1 ] = te[ 1 ];\r\n\t\tarray[ offset + 2 ] = te[ 2 ];\r\n\r\n\t\tarray[ offset + 3 ] = te[ 3 ];\r\n\t\tarray[ offset + 4 ] = te[ 4 ];\r\n\t\tarray[ offset + 5 ] = te[ 5 ];\r\n\r\n\t\tarray[ offset + 6 ] = te[ 6 ];\r\n\t\tarray[ offset + 7 ] = te[ 7 ];\r\n\t\tarray[ offset + 8 ]  = te[ 8 ];\r\n\r\n\t\treturn array;\r\n\r\n\t},\r\n\r\n\tgetNormalMatrix: function ( m ) {\r\n\r\n\t\t// input: THREE.Matrix4\r\n\r\n\t\tthis.getInverse( m ).transpose();\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\ttransposeIntoArray: function ( r ) {\r\n\r\n\t\tvar m = this.elements;\r\n\r\n\t\tr[ 0 ] = m[ 0 ];\r\n\t\tr[ 1 ] = m[ 3 ];\r\n\t\tr[ 2 ] = m[ 6 ];\r\n\t\tr[ 3 ] = m[ 1 ];\r\n\t\tr[ 4 ] = m[ 4 ];\r\n\t\tr[ 5 ] = m[ 7 ];\r\n\t\tr[ 6 ] = m[ 2 ];\r\n\t\tr[ 7 ] = m[ 5 ];\r\n\t\tr[ 8 ] = m[ 8 ];\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tfromArray: function ( array ) {\r\n\r\n\t\tthis.elements.set( array );\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\ttoArray: function () {\r\n\r\n\t\tvar te = this.elements;\r\n\r\n\t\treturn [\r\n\t\t\tte[ 0 ], te[ 1 ], te[ 2 ],\r\n\t\t\tte[ 3 ], te[ 4 ], te[ 5 ],\r\n\t\t\tte[ 6 ], te[ 7 ], te[ 8 ]\r\n\t\t];\r\n\r\n\t},\r\n\r\n\tclone: function () {\r\n\r\n\t\treturn new THREE.Matrix3().fromArray( this.elements );\r\n\r\n\t}\r\n\r\n};\r\n\r\n// File:src/math/Matrix4.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author supereggbert / http://www.paulbrunt.co.uk/\r\n * @author philogb / http://blog.thejit.org/\r\n * @author jordi_ros / http://plattsoft.com\r\n * @author D1plo1d / http://github.com/D1plo1d\r\n * @author alteredq / http://alteredqualia.com/\r\n * @author mikael emtinger / http://gomo.se/\r\n * @author timknip / http://www.floorplanner.com/\r\n * @author bhouston / http://exocortex.com\r\n * @author WestLangley / http://github.com/WestLangley\r\n */\r\n\r\nTHREE.Matrix4 = function () {\r\n\r\n\tthis.elements = new Float32Array( [\r\n\r\n\t\t1, 0, 0, 0,\r\n\t\t0, 1, 0, 0,\r\n\t\t0, 0, 1, 0,\r\n\t\t0, 0, 0, 1\r\n\r\n\t] );\r\n\r\n\tif ( arguments.length > 0 ) {\r\n\r\n\t\tTHREE.error( 'THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.' );\r\n\r\n\t}\r\n\r\n};\r\n\r\nTHREE.Matrix4.prototype = {\r\n\r\n\tconstructor: THREE.Matrix4,\r\n\r\n\tset: function ( n11, n12, n13, n14, n21, n22, n23, n24, n31, n32, n33, n34, n41, n42, n43, n44 ) {\r\n\r\n\t\tvar te = this.elements;\r\n\r\n\t\tte[ 0 ] = n11; te[ 4 ] = n12; te[ 8 ] = n13; te[ 12 ] = n14;\r\n\t\tte[ 1 ] = n21; te[ 5 ] = n22; te[ 9 ] = n23; te[ 13 ] = n24;\r\n\t\tte[ 2 ] = n31; te[ 6 ] = n32; te[ 10 ] = n33; te[ 14 ] = n34;\r\n\t\tte[ 3 ] = n41; te[ 7 ] = n42; te[ 11 ] = n43; te[ 15 ] = n44;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tidentity: function () {\r\n\r\n\t\tthis.set(\r\n\r\n\t\t\t1, 0, 0, 0,\r\n\t\t\t0, 1, 0, 0,\r\n\t\t\t0, 0, 1, 0,\r\n\t\t\t0, 0, 0, 1\r\n\r\n\t\t);\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tcopy: function ( m ) {\r\n\r\n\t\tthis.elements.set( m.elements );\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\textractPosition: function ( m ) {\r\n\r\n\t\tTHREE.warn( 'THREE.Matrix4: .extractPosition() has been renamed to .copyPosition().' );\r\n\t\treturn this.copyPosition( m );\r\n\r\n\t},\r\n\r\n\tcopyPosition: function ( m ) {\r\n\r\n\t\tvar te = this.elements;\r\n\t\tvar me = m.elements;\r\n\r\n\t\tte[ 12 ] = me[ 12 ];\r\n\t\tte[ 13 ] = me[ 13 ];\r\n\t\tte[ 14 ] = me[ 14 ];\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\textractBasis: function ( xAxis, yAxis, zAxis ) {\r\n \r\n\t\tvar te = this.elements;\r\n \r\n\t\txAxis.set( te[ 0 ], te[ 1 ], te[ 2 ] );\r\n\t\tyAxis.set( te[ 4 ], te[ 5 ], te[ 6 ] );\r\n\t\tzAxis.set( te[ 8 ], te[ 9 ], te[ 10 ] );\r\n \r\n\t\treturn this;\r\n \t\t\r\n\t},\r\n \r\n\tmakeBasis: function ( xAxis, yAxis, zAxis ) {\r\n\r\n\t\tthis.set(\r\n\t\t\txAxis.x, yAxis.x, zAxis.x, 0,\r\n\t\t\txAxis.y, yAxis.y, zAxis.y, 0,\r\n\t\t\txAxis.z, yAxis.z, zAxis.z, 0,\r\n\t\t\t0,       0,       0,       1\r\n\t\t);\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\textractRotation: function () {\r\n\r\n\t\tvar v1 = new THREE.Vector3();\r\n\r\n\t\treturn function ( m ) {\r\n\r\n\t\t\tvar te = this.elements;\r\n\t\t\tvar me = m.elements;\r\n\r\n\t\t\tvar scaleX = 1 / v1.set( me[ 0 ], me[ 1 ], me[ 2 ] ).length();\r\n\t\t\tvar scaleY = 1 / v1.set( me[ 4 ], me[ 5 ], me[ 6 ] ).length();\r\n\t\t\tvar scaleZ = 1 / v1.set( me[ 8 ], me[ 9 ], me[ 10 ] ).length();\r\n\r\n\t\t\tte[ 0 ] = me[ 0 ] * scaleX;\r\n\t\t\tte[ 1 ] = me[ 1 ] * scaleX;\r\n\t\t\tte[ 2 ] = me[ 2 ] * scaleX;\r\n\r\n\t\t\tte[ 4 ] = me[ 4 ] * scaleY;\r\n\t\t\tte[ 5 ] = me[ 5 ] * scaleY;\r\n\t\t\tte[ 6 ] = me[ 6 ] * scaleY;\r\n\r\n\t\t\tte[ 8 ] = me[ 8 ] * scaleZ;\r\n\t\t\tte[ 9 ] = me[ 9 ] * scaleZ;\r\n\t\t\tte[ 10 ] = me[ 10 ] * scaleZ;\r\n\r\n\t\t\treturn this;\r\n\r\n\t\t};\r\n\r\n\t}(),\r\n\r\n\tmakeRotationFromEuler: function ( euler ) {\r\n\r\n\t\tif ( euler instanceof THREE.Euler === false ) {\r\n\r\n\t\t\tTHREE.error( 'THREE.Matrix: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.' );\r\n\r\n\t\t}\r\n\r\n\t\tvar te = this.elements;\r\n\r\n\t\tvar x = euler.x, y = euler.y, z = euler.z;\r\n\t\tvar a = Math.cos( x ), b = Math.sin( x );\r\n\t\tvar c = Math.cos( y ), d = Math.sin( y );\r\n\t\tvar e = Math.cos( z ), f = Math.sin( z );\r\n\r\n\t\tif ( euler.order === 'XYZ' ) {\r\n\r\n\t\t\tvar ae = a * e, af = a * f, be = b * e, bf = b * f;\r\n\r\n\t\t\tte[ 0 ] = c * e;\r\n\t\t\tte[ 4 ] = - c * f;\r\n\t\t\tte[ 8 ] = d;\r\n\r\n\t\t\tte[ 1 ] = af + be * d;\r\n\t\t\tte[ 5 ] = ae - bf * d;\r\n\t\t\tte[ 9 ] = - b * c;\r\n\r\n\t\t\tte[ 2 ] = bf - ae * d;\r\n\t\t\tte[ 6 ] = be + af * d;\r\n\t\t\tte[ 10 ] = a * c;\r\n\r\n\t\t} else if ( euler.order === 'YXZ' ) {\r\n\r\n\t\t\tvar ce = c * e, cf = c * f, de = d * e, df = d * f;\r\n\r\n\t\t\tte[ 0 ] = ce + df * b;\r\n\t\t\tte[ 4 ] = de * b - cf;\r\n\t\t\tte[ 8 ] = a * d;\r\n\r\n\t\t\tte[ 1 ] = a * f;\r\n\t\t\tte[ 5 ] = a * e;\r\n\t\t\tte[ 9 ] = - b;\r\n\r\n\t\t\tte[ 2 ] = cf * b - de;\r\n\t\t\tte[ 6 ] = df + ce * b;\r\n\t\t\tte[ 10 ] = a * c;\r\n\r\n\t\t} else if ( euler.order === 'ZXY' ) {\r\n\r\n\t\t\tvar ce = c * e, cf = c * f, de = d * e, df = d * f;\r\n\r\n\t\t\tte[ 0 ] = ce - df * b;\r\n\t\t\tte[ 4 ] = - a * f;\r\n\t\t\tte[ 8 ] = de + cf * b;\r\n\r\n\t\t\tte[ 1 ] = cf + de * b;\r\n\t\t\tte[ 5 ] = a * e;\r\n\t\t\tte[ 9 ] = df - ce * b;\r\n\r\n\t\t\tte[ 2 ] = - a * d;\r\n\t\t\tte[ 6 ] = b;\r\n\t\t\tte[ 10 ] = a * c;\r\n\r\n\t\t} else if ( euler.order === 'ZYX' ) {\r\n\r\n\t\t\tvar ae = a * e, af = a * f, be = b * e, bf = b * f;\r\n\r\n\t\t\tte[ 0 ] = c * e;\r\n\t\t\tte[ 4 ] = be * d - af;\r\n\t\t\tte[ 8 ] = ae * d + bf;\r\n\r\n\t\t\tte[ 1 ] = c * f;\r\n\t\t\tte[ 5 ] = bf * d + ae;\r\n\t\t\tte[ 9 ] = af * d - be;\r\n\r\n\t\t\tte[ 2 ] = - d;\r\n\t\t\tte[ 6 ] = b * c;\r\n\t\t\tte[ 10 ] = a * c;\r\n\r\n\t\t} else if ( euler.order === 'YZX' ) {\r\n\r\n\t\t\tvar ac = a * c, ad = a * d, bc = b * c, bd = b * d;\r\n\r\n\t\t\tte[ 0 ] = c * e;\r\n\t\t\tte[ 4 ] = bd - ac * f;\r\n\t\t\tte[ 8 ] = bc * f + ad;\r\n\r\n\t\t\tte[ 1 ] = f;\r\n\t\t\tte[ 5 ] = a * e;\r\n\t\t\tte[ 9 ] = - b * e;\r\n\r\n\t\t\tte[ 2 ] = - d * e;\r\n\t\t\tte[ 6 ] = ad * f + bc;\r\n\t\t\tte[ 10 ] = ac - bd * f;\r\n\r\n\t\t} else if ( euler.order === 'XZY' ) {\r\n\r\n\t\t\tvar ac = a * c, ad = a * d, bc = b * c, bd = b * d;\r\n\r\n\t\t\tte[ 0 ] = c * e;\r\n\t\t\tte[ 4 ] = - f;\r\n\t\t\tte[ 8 ] = d * e;\r\n\r\n\t\t\tte[ 1 ] = ac * f + bd;\r\n\t\t\tte[ 5 ] = a * e;\r\n\t\t\tte[ 9 ] = ad * f - bc;\r\n\r\n\t\t\tte[ 2 ] = bc * f - ad;\r\n\t\t\tte[ 6 ] = b * e;\r\n\t\t\tte[ 10 ] = bd * f + ac;\r\n\r\n\t\t}\r\n\r\n\t\t// last column\r\n\t\tte[ 3 ] = 0;\r\n\t\tte[ 7 ] = 0;\r\n\t\tte[ 11 ] = 0;\r\n\r\n\t\t// bottom row\r\n\t\tte[ 12 ] = 0;\r\n\t\tte[ 13 ] = 0;\r\n\t\tte[ 14 ] = 0;\r\n\t\tte[ 15 ] = 1;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tsetRotationFromQuaternion: function ( q ) {\r\n\r\n\t\tTHREE.warn( 'THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion().' );\r\n\r\n\t\treturn this.makeRotationFromQuaternion( q );\r\n\r\n\t},\r\n\r\n\tmakeRotationFromQuaternion: function ( q ) {\r\n\r\n\t\tvar te = this.elements;\r\n\r\n\t\tvar x = q.x, y = q.y, z = q.z, w = q.w;\r\n\t\tvar x2 = x + x, y2 = y + y, z2 = z + z;\r\n\t\tvar xx = x * x2, xy = x * y2, xz = x * z2;\r\n\t\tvar yy = y * y2, yz = y * z2, zz = z * z2;\r\n\t\tvar wx = w * x2, wy = w * y2, wz = w * z2;\r\n\r\n\t\tte[ 0 ] = 1 - ( yy + zz );\r\n\t\tte[ 4 ] = xy - wz;\r\n\t\tte[ 8 ] = xz + wy;\r\n\r\n\t\tte[ 1 ] = xy + wz;\r\n\t\tte[ 5 ] = 1 - ( xx + zz );\r\n\t\tte[ 9 ] = yz - wx;\r\n\r\n\t\tte[ 2 ] = xz - wy;\r\n\t\tte[ 6 ] = yz + wx;\r\n\t\tte[ 10 ] = 1 - ( xx + yy );\r\n\r\n\t\t// last column\r\n\t\tte[ 3 ] = 0;\r\n\t\tte[ 7 ] = 0;\r\n\t\tte[ 11 ] = 0;\r\n\r\n\t\t// bottom row\r\n\t\tte[ 12 ] = 0;\r\n\t\tte[ 13 ] = 0;\r\n\t\tte[ 14 ] = 0;\r\n\t\tte[ 15 ] = 1;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tlookAt: function () {\r\n\r\n\t\tvar x = new THREE.Vector3();\r\n\t\tvar y = new THREE.Vector3();\r\n\t\tvar z = new THREE.Vector3();\r\n\r\n\t\treturn function ( eye, target, up ) {\r\n\r\n\t\t\tvar te = this.elements;\r\n\r\n\t\t\tz.subVectors( eye, target ).normalize();\r\n\r\n\t\t\tif ( z.length() === 0 ) {\r\n\r\n\t\t\t\tz.z = 1;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tx.crossVectors( up, z ).normalize();\r\n\r\n\t\t\tif ( x.length() === 0 ) {\r\n\r\n\t\t\t\tz.x += 0.0001;\r\n\t\t\t\tx.crossVectors( up, z ).normalize();\r\n\r\n\t\t\t}\r\n\r\n\t\t\ty.crossVectors( z, x );\r\n\r\n\r\n\t\t\tte[ 0 ] = x.x; te[ 4 ] = y.x; te[ 8 ] = z.x;\r\n\t\t\tte[ 1 ] = x.y; te[ 5 ] = y.y; te[ 9 ] = z.y;\r\n\t\t\tte[ 2 ] = x.z; te[ 6 ] = y.z; te[ 10 ] = z.z;\r\n\r\n\t\t\treturn this;\r\n\r\n\t\t};\r\n\r\n\t}(),\r\n\r\n\tmultiply: function ( m, n ) {\r\n\r\n\t\tif ( n !== undefined ) {\r\n\r\n\t\t\tTHREE.warn( 'THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead.' );\r\n\t\t\treturn this.multiplyMatrices( m, n );\r\n\r\n\t\t}\r\n\r\n\t\treturn this.multiplyMatrices( this, m );\r\n\r\n\t},\r\n\r\n\tmultiplyMatrices: function ( a, b ) {\r\n\r\n\t\tvar ae = a.elements;\r\n\t\tvar be = b.elements;\r\n\t\tvar te = this.elements;\r\n\r\n\t\tvar a11 = ae[ 0 ], a12 = ae[ 4 ], a13 = ae[ 8 ], a14 = ae[ 12 ];\r\n\t\tvar a21 = ae[ 1 ], a22 = ae[ 5 ], a23 = ae[ 9 ], a24 = ae[ 13 ];\r\n\t\tvar a31 = ae[ 2 ], a32 = ae[ 6 ], a33 = ae[ 10 ], a34 = ae[ 14 ];\r\n\t\tvar a41 = ae[ 3 ], a42 = ae[ 7 ], a43 = ae[ 11 ], a44 = ae[ 15 ];\r\n\r\n\t\tvar b11 = be[ 0 ], b12 = be[ 4 ], b13 = be[ 8 ], b14 = be[ 12 ];\r\n\t\tvar b21 = be[ 1 ], b22 = be[ 5 ], b23 = be[ 9 ], b24 = be[ 13 ];\r\n\t\tvar b31 = be[ 2 ], b32 = be[ 6 ], b33 = be[ 10 ], b34 = be[ 14 ];\r\n\t\tvar b41 = be[ 3 ], b42 = be[ 7 ], b43 = be[ 11 ], b44 = be[ 15 ];\r\n\r\n\t\tte[ 0 ] = a11 * b11 + a12 * b21 + a13 * b31 + a14 * b41;\r\n\t\tte[ 4 ] = a11 * b12 + a12 * b22 + a13 * b32 + a14 * b42;\r\n\t\tte[ 8 ] = a11 * b13 + a12 * b23 + a13 * b33 + a14 * b43;\r\n\t\tte[ 12 ] = a11 * b14 + a12 * b24 + a13 * b34 + a14 * b44;\r\n\r\n\t\tte[ 1 ] = a21 * b11 + a22 * b21 + a23 * b31 + a24 * b41;\r\n\t\tte[ 5 ] = a21 * b12 + a22 * b22 + a23 * b32 + a24 * b42;\r\n\t\tte[ 9 ] = a21 * b13 + a22 * b23 + a23 * b33 + a24 * b43;\r\n\t\tte[ 13 ] = a21 * b14 + a22 * b24 + a23 * b34 + a24 * b44;\r\n\r\n\t\tte[ 2 ] = a31 * b11 + a32 * b21 + a33 * b31 + a34 * b41;\r\n\t\tte[ 6 ] = a31 * b12 + a32 * b22 + a33 * b32 + a34 * b42;\r\n\t\tte[ 10 ] = a31 * b13 + a32 * b23 + a33 * b33 + a34 * b43;\r\n\t\tte[ 14 ] = a31 * b14 + a32 * b24 + a33 * b34 + a34 * b44;\r\n\r\n\t\tte[ 3 ] = a41 * b11 + a42 * b21 + a43 * b31 + a44 * b41;\r\n\t\tte[ 7 ] = a41 * b12 + a42 * b22 + a43 * b32 + a44 * b42;\r\n\t\tte[ 11 ] = a41 * b13 + a42 * b23 + a43 * b33 + a44 * b43;\r\n\t\tte[ 15 ] = a41 * b14 + a42 * b24 + a43 * b34 + a44 * b44;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tmultiplyToArray: function ( a, b, r ) {\r\n\r\n\t\tvar te = this.elements;\r\n\r\n\t\tthis.multiplyMatrices( a, b );\r\n\r\n\t\tr[ 0 ] = te[ 0 ]; r[ 1 ] = te[ 1 ]; r[ 2 ] = te[ 2 ]; r[ 3 ] = te[ 3 ];\r\n\t\tr[ 4 ] = te[ 4 ]; r[ 5 ] = te[ 5 ]; r[ 6 ] = te[ 6 ]; r[ 7 ] = te[ 7 ];\r\n\t\tr[ 8 ]  = te[ 8 ]; r[ 9 ]  = te[ 9 ]; r[ 10 ] = te[ 10 ]; r[ 11 ] = te[ 11 ];\r\n\t\tr[ 12 ] = te[ 12 ]; r[ 13 ] = te[ 13 ]; r[ 14 ] = te[ 14 ]; r[ 15 ] = te[ 15 ];\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tmultiplyScalar: function ( s ) {\r\n\r\n\t\tvar te = this.elements;\r\n\r\n\t\tte[ 0 ] *= s; te[ 4 ] *= s; te[ 8 ] *= s; te[ 12 ] *= s;\r\n\t\tte[ 1 ] *= s; te[ 5 ] *= s; te[ 9 ] *= s; te[ 13 ] *= s;\r\n\t\tte[ 2 ] *= s; te[ 6 ] *= s; te[ 10 ] *= s; te[ 14 ] *= s;\r\n\t\tte[ 3 ] *= s; te[ 7 ] *= s; te[ 11 ] *= s; te[ 15 ] *= s;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tmultiplyVector3: function ( vector ) {\r\n\r\n\t\tTHREE.warn( 'THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) or vector.applyProjection( matrix ) instead.' );\r\n\t\treturn vector.applyProjection( this );\r\n\r\n\t},\r\n\r\n\tmultiplyVector4: function ( vector ) {\r\n\r\n\t\tTHREE.warn( 'THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead.' );\r\n\t\treturn vector.applyMatrix4( this );\r\n\r\n\t},\r\n\r\n\tmultiplyVector3Array: function ( a ) {\r\n\r\n\t\tTHREE.warn( 'THREE.Matrix4: .multiplyVector3Array() has been renamed. Use matrix.applyToVector3Array( array ) instead.' );\r\n\t\treturn this.applyToVector3Array( a );\r\n\r\n\t},\r\n\r\n\tapplyToVector3Array: function () {\r\n\r\n\t\tvar v1 = new THREE.Vector3();\r\n\r\n\t\treturn function ( array, offset, length ) {\r\n\r\n\t\t\tif ( offset === undefined ) offset = 0;\r\n\t\t\tif ( length === undefined ) length = array.length;\r\n\r\n\t\t\tfor ( var i = 0, j = offset; i < length; i += 3, j += 3 ) {\r\n\r\n\t\t\t\tv1.x = array[ j ];\r\n\t\t\t\tv1.y = array[ j + 1 ];\r\n\t\t\t\tv1.z = array[ j + 2 ];\r\n\r\n\t\t\t\tv1.applyMatrix4( this );\r\n\r\n\t\t\t\tarray[ j ]     = v1.x;\r\n\t\t\t\tarray[ j + 1 ] = v1.y;\r\n\t\t\t\tarray[ j + 2 ] = v1.z;\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn array;\r\n\r\n\t\t};\r\n\r\n\t}(),\r\n\r\n\trotateAxis: function ( v ) {\r\n\r\n\t\tTHREE.warn( 'THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead.' );\r\n\r\n\t\tv.transformDirection( this );\r\n\r\n\t},\r\n\r\n\tcrossVector: function ( vector ) {\r\n\r\n\t\tTHREE.warn( 'THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead.' );\r\n\t\treturn vector.applyMatrix4( this );\r\n\r\n\t},\r\n\r\n\tdeterminant: function () {\r\n\r\n\t\tvar te = this.elements;\r\n\r\n\t\tvar n11 = te[ 0 ], n12 = te[ 4 ], n13 = te[ 8 ], n14 = te[ 12 ];\r\n\t\tvar n21 = te[ 1 ], n22 = te[ 5 ], n23 = te[ 9 ], n24 = te[ 13 ];\r\n\t\tvar n31 = te[ 2 ], n32 = te[ 6 ], n33 = te[ 10 ], n34 = te[ 14 ];\r\n\t\tvar n41 = te[ 3 ], n42 = te[ 7 ], n43 = te[ 11 ], n44 = te[ 15 ];\r\n\r\n\t\t//TODO: make this more efficient\r\n\t\t//( based on http://www.euclideanspace.com/maths/algebra/matrix/functions/inverse/fourD/index.htm )\r\n\r\n\t\treturn (\r\n\t\t\tn41 * (\r\n\t\t\t\t+ n14 * n23 * n32\r\n\t\t\t\t - n13 * n24 * n32\r\n\t\t\t\t - n14 * n22 * n33\r\n\t\t\t\t + n12 * n24 * n33\r\n\t\t\t\t + n13 * n22 * n34\r\n\t\t\t\t - n12 * n23 * n34\r\n\t\t\t) +\r\n\t\t\tn42 * (\r\n\t\t\t\t+ n11 * n23 * n34\r\n\t\t\t\t - n11 * n24 * n33\r\n\t\t\t\t + n14 * n21 * n33\r\n\t\t\t\t - n13 * n21 * n34\r\n\t\t\t\t + n13 * n24 * n31\r\n\t\t\t\t - n14 * n23 * n31\r\n\t\t\t) +\r\n\t\t\tn43 * (\r\n\t\t\t\t+ n11 * n24 * n32\r\n\t\t\t\t - n11 * n22 * n34\r\n\t\t\t\t - n14 * n21 * n32\r\n\t\t\t\t + n12 * n21 * n34\r\n\t\t\t\t + n14 * n22 * n31\r\n\t\t\t\t - n12 * n24 * n31\r\n\t\t\t) +\r\n\t\t\tn44 * (\r\n\t\t\t\t- n13 * n22 * n31\r\n\t\t\t\t - n11 * n23 * n32\r\n\t\t\t\t + n11 * n22 * n33\r\n\t\t\t\t + n13 * n21 * n32\r\n\t\t\t\t - n12 * n21 * n33\r\n\t\t\t\t + n12 * n23 * n31\r\n\t\t\t)\r\n\r\n\t\t);\r\n\r\n\t},\r\n\r\n\ttranspose: function () {\r\n\r\n\t\tvar te = this.elements;\r\n\t\tvar tmp;\r\n\r\n\t\ttmp = te[ 1 ]; te[ 1 ] = te[ 4 ]; te[ 4 ] = tmp;\r\n\t\ttmp = te[ 2 ]; te[ 2 ] = te[ 8 ]; te[ 8 ] = tmp;\r\n\t\ttmp = te[ 6 ]; te[ 6 ] = te[ 9 ]; te[ 9 ] = tmp;\r\n\r\n\t\ttmp = te[ 3 ]; te[ 3 ] = te[ 12 ]; te[ 12 ] = tmp;\r\n\t\ttmp = te[ 7 ]; te[ 7 ] = te[ 13 ]; te[ 13 ] = tmp;\r\n\t\ttmp = te[ 11 ]; te[ 11 ] = te[ 14 ]; te[ 14 ] = tmp;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tflattenToArrayOffset: function ( array, offset ) {\r\n\r\n\t\tvar te = this.elements;\r\n\r\n\t\tarray[ offset     ] = te[ 0 ];\r\n\t\tarray[ offset + 1 ] = te[ 1 ];\r\n\t\tarray[ offset + 2 ] = te[ 2 ];\r\n\t\tarray[ offset + 3 ] = te[ 3 ];\r\n\r\n\t\tarray[ offset + 4 ] = te[ 4 ];\r\n\t\tarray[ offset + 5 ] = te[ 5 ];\r\n\t\tarray[ offset + 6 ] = te[ 6 ];\r\n\t\tarray[ offset + 7 ] = te[ 7 ];\r\n\r\n\t\tarray[ offset + 8 ]  = te[ 8 ];\r\n\t\tarray[ offset + 9 ]  = te[ 9 ];\r\n\t\tarray[ offset + 10 ] = te[ 10 ];\r\n\t\tarray[ offset + 11 ] = te[ 11 ];\r\n\r\n\t\tarray[ offset + 12 ] = te[ 12 ];\r\n\t\tarray[ offset + 13 ] = te[ 13 ];\r\n\t\tarray[ offset + 14 ] = te[ 14 ];\r\n\t\tarray[ offset + 15 ] = te[ 15 ];\r\n\r\n\t\treturn array;\r\n\r\n\t},\r\n\r\n\tgetPosition: function () {\r\n\r\n\t\tvar v1 = new THREE.Vector3();\r\n\r\n\t\treturn function () {\r\n\r\n\t\t\tTHREE.warn( 'THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead.' );\r\n\r\n\t\t\tvar te = this.elements;\r\n\t\t\treturn v1.set( te[ 12 ], te[ 13 ], te[ 14 ] );\r\n\r\n\t\t};\r\n\r\n\t}(),\r\n\r\n\tsetPosition: function ( v ) {\r\n\r\n\t\tvar te = this.elements;\r\n\r\n\t\tte[ 12 ] = v.x;\r\n\t\tte[ 13 ] = v.y;\r\n\t\tte[ 14 ] = v.z;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tgetInverse: function ( m, throwOnInvertible ) {\r\n\r\n\t\t// based on http://www.euclideanspace.com/maths/algebra/matrix/functions/inverse/fourD/index.htm\r\n\t\tvar te = this.elements;\r\n\t\tvar me = m.elements;\r\n\r\n\t\tvar n11 = me[ 0 ], n12 = me[ 4 ], n13 = me[ 8 ], n14 = me[ 12 ];\r\n\t\tvar n21 = me[ 1 ], n22 = me[ 5 ], n23 = me[ 9 ], n24 = me[ 13 ];\r\n\t\tvar n31 = me[ 2 ], n32 = me[ 6 ], n33 = me[ 10 ], n34 = me[ 14 ];\r\n\t\tvar n41 = me[ 3 ], n42 = me[ 7 ], n43 = me[ 11 ], n44 = me[ 15 ];\r\n\r\n\t\tte[ 0 ] = n23 * n34 * n42 - n24 * n33 * n42 + n24 * n32 * n43 - n22 * n34 * n43 - n23 * n32 * n44 + n22 * n33 * n44;\r\n\t\tte[ 4 ] = n14 * n33 * n42 - n13 * n34 * n42 - n14 * n32 * n43 + n12 * n34 * n43 + n13 * n32 * n44 - n12 * n33 * n44;\r\n\t\tte[ 8 ] = n13 * n24 * n42 - n14 * n23 * n42 + n14 * n22 * n43 - n12 * n24 * n43 - n13 * n22 * n44 + n12 * n23 * n44;\r\n\t\tte[ 12 ] = n14 * n23 * n32 - n13 * n24 * n32 - n14 * n22 * n33 + n12 * n24 * n33 + n13 * n22 * n34 - n12 * n23 * n34;\r\n\t\tte[ 1 ] = n24 * n33 * n41 - n23 * n34 * n41 - n24 * n31 * n43 + n21 * n34 * n43 + n23 * n31 * n44 - n21 * n33 * n44;\r\n\t\tte[ 5 ] = n13 * n34 * n41 - n14 * n33 * n41 + n14 * n31 * n43 - n11 * n34 * n43 - n13 * n31 * n44 + n11 * n33 * n44;\r\n\t\tte[ 9 ] = n14 * n23 * n41 - n13 * n24 * n41 - n14 * n21 * n43 + n11 * n24 * n43 + n13 * n21 * n44 - n11 * n23 * n44;\r\n\t\tte[ 13 ] = n13 * n24 * n31 - n14 * n23 * n31 + n14 * n21 * n33 - n11 * n24 * n33 - n13 * n21 * n34 + n11 * n23 * n34;\r\n\t\tte[ 2 ] = n22 * n34 * n41 - n24 * n32 * n41 + n24 * n31 * n42 - n21 * n34 * n42 - n22 * n31 * n44 + n21 * n32 * n44;\r\n\t\tte[ 6 ] = n14 * n32 * n41 - n12 * n34 * n41 - n14 * n31 * n42 + n11 * n34 * n42 + n12 * n31 * n44 - n11 * n32 * n44;\r\n\t\tte[ 10 ] = n12 * n24 * n41 - n14 * n22 * n41 + n14 * n21 * n42 - n11 * n24 * n42 - n12 * n21 * n44 + n11 * n22 * n44;\r\n\t\tte[ 14 ] = n14 * n22 * n31 - n12 * n24 * n31 - n14 * n21 * n32 + n11 * n24 * n32 + n12 * n21 * n34 - n11 * n22 * n34;\r\n\t\tte[ 3 ] = n23 * n32 * n41 - n22 * n33 * n41 - n23 * n31 * n42 + n21 * n33 * n42 + n22 * n31 * n43 - n21 * n32 * n43;\r\n\t\tte[ 7 ] = n12 * n33 * n41 - n13 * n32 * n41 + n13 * n31 * n42 - n11 * n33 * n42 - n12 * n31 * n43 + n11 * n32 * n43;\r\n\t\tte[ 11 ] = n13 * n22 * n41 - n12 * n23 * n41 - n13 * n21 * n42 + n11 * n23 * n42 + n12 * n21 * n43 - n11 * n22 * n43;\r\n\t\tte[ 15 ] = n12 * n23 * n31 - n13 * n22 * n31 + n13 * n21 * n32 - n11 * n23 * n32 - n12 * n21 * n33 + n11 * n22 * n33;\r\n\r\n\t\tvar det = n11 * te[ 0 ] + n21 * te[ 4 ] + n31 * te[ 8 ] + n41 * te[ 12 ];\r\n\r\n\t\tif ( det == 0 ) {\r\n\r\n\t\t\tvar msg = \"THREE.Matrix4.getInverse(): can't invert matrix, determinant is 0\";\r\n\r\n\t\t\tif ( throwOnInvertible || false ) {\r\n\r\n\t\t\t\tthrow new Error( msg );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tTHREE.warn( msg );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tthis.identity();\r\n\r\n\t\t\treturn this;\r\n\t\t}\r\n\r\n\t\tthis.multiplyScalar( 1 / det );\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\ttranslate: function ( v ) {\r\n\r\n\t\tTHREE.error( 'THREE.Matrix4: .translate() has been removed.' );\r\n\r\n\t},\r\n\r\n\trotateX: function ( angle ) {\r\n\r\n\t\tTHREE.error( 'THREE.Matrix4: .rotateX() has been removed.' );\r\n\r\n\t},\r\n\r\n\trotateY: function ( angle ) {\r\n\r\n\t\tTHREE.error( 'THREE.Matrix4: .rotateY() has been removed.' );\r\n\r\n\t},\r\n\r\n\trotateZ: function ( angle ) {\r\n\r\n\t\tTHREE.error( 'THREE.Matrix4: .rotateZ() has been removed.' );\r\n\r\n\t},\r\n\r\n\trotateByAxis: function ( axis, angle ) {\r\n\r\n\t\tTHREE.error( 'THREE.Matrix4: .rotateByAxis() has been removed.' );\r\n\r\n\t},\r\n\r\n\tscale: function ( v ) {\r\n\r\n\t\tvar te = this.elements;\r\n\t\tvar x = v.x, y = v.y, z = v.z;\r\n\r\n\t\tte[ 0 ] *= x; te[ 4 ] *= y; te[ 8 ] *= z;\r\n\t\tte[ 1 ] *= x; te[ 5 ] *= y; te[ 9 ] *= z;\r\n\t\tte[ 2 ] *= x; te[ 6 ] *= y; te[ 10 ] *= z;\r\n\t\tte[ 3 ] *= x; te[ 7 ] *= y; te[ 11 ] *= z;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tgetMaxScaleOnAxis: function () {\r\n\r\n\t\tvar te = this.elements;\r\n\r\n\t\tvar scaleXSq = te[ 0 ] * te[ 0 ] + te[ 1 ] * te[ 1 ] + te[ 2 ] * te[ 2 ];\r\n\t\tvar scaleYSq = te[ 4 ] * te[ 4 ] + te[ 5 ] * te[ 5 ] + te[ 6 ] * te[ 6 ];\r\n\t\tvar scaleZSq = te[ 8 ] * te[ 8 ] + te[ 9 ] * te[ 9 ] + te[ 10 ] * te[ 10 ];\r\n\r\n\t\treturn Math.sqrt( Math.max( scaleXSq, Math.max( scaleYSq, scaleZSq ) ) );\r\n\r\n\t},\r\n\r\n\tmakeTranslation: function ( x, y, z ) {\r\n\r\n\t\tthis.set(\r\n\r\n\t\t\t1, 0, 0, x,\r\n\t\t\t0, 1, 0, y,\r\n\t\t\t0, 0, 1, z,\r\n\t\t\t0, 0, 0, 1\r\n\r\n\t\t);\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tmakeRotationX: function ( theta ) {\r\n\r\n\t\tvar c = Math.cos( theta ), s = Math.sin( theta );\r\n\r\n\t\tthis.set(\r\n\r\n\t\t\t1, 0,  0, 0,\r\n\t\t\t0, c, - s, 0,\r\n\t\t\t0, s,  c, 0,\r\n\t\t\t0, 0,  0, 1\r\n\r\n\t\t);\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tmakeRotationY: function ( theta ) {\r\n\r\n\t\tvar c = Math.cos( theta ), s = Math.sin( theta );\r\n\r\n\t\tthis.set(\r\n\r\n\t\t\t c, 0, s, 0,\r\n\t\t\t 0, 1, 0, 0,\r\n\t\t\t- s, 0, c, 0,\r\n\t\t\t 0, 0, 0, 1\r\n\r\n\t\t);\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tmakeRotationZ: function ( theta ) {\r\n\r\n\t\tvar c = Math.cos( theta ), s = Math.sin( theta );\r\n\r\n\t\tthis.set(\r\n\r\n\t\t\tc, - s, 0, 0,\r\n\t\t\ts,  c, 0, 0,\r\n\t\t\t0,  0, 1, 0,\r\n\t\t\t0,  0, 0, 1\r\n\r\n\t\t);\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tmakeRotationAxis: function ( axis, angle ) {\r\n\r\n\t\t// Based on http://www.gamedev.net/reference/articles/article1199.asp\r\n\r\n\t\tvar c = Math.cos( angle );\r\n\t\tvar s = Math.sin( angle );\r\n\t\tvar t = 1 - c;\r\n\t\tvar x = axis.x, y = axis.y, z = axis.z;\r\n\t\tvar tx = t * x, ty = t * y;\r\n\r\n\t\tthis.set(\r\n\r\n\t\t\ttx * x + c, tx * y - s * z, tx * z + s * y, 0,\r\n\t\t\ttx * y + s * z, ty * y + c, ty * z - s * x, 0,\r\n\t\t\ttx * z - s * y, ty * z + s * x, t * z * z + c, 0,\r\n\t\t\t0, 0, 0, 1\r\n\r\n\t\t);\r\n\r\n\t\t return this;\r\n\r\n\t},\r\n\r\n\tmakeScale: function ( x, y, z ) {\r\n\r\n\t\tthis.set(\r\n\r\n\t\t\tx, 0, 0, 0,\r\n\t\t\t0, y, 0, 0,\r\n\t\t\t0, 0, z, 0,\r\n\t\t\t0, 0, 0, 1\r\n\r\n\t\t);\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tcompose: function ( position, quaternion, scale ) {\r\n\r\n\t\tthis.makeRotationFromQuaternion( quaternion );\r\n\t\tthis.scale( scale );\r\n\t\tthis.setPosition( position );\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tdecompose: function () {\r\n\r\n\t\tvar vector = new THREE.Vector3();\r\n\t\tvar matrix = new THREE.Matrix4();\r\n\r\n\t\treturn function ( position, quaternion, scale ) {\r\n\r\n\t\t\tvar te = this.elements;\r\n\r\n\t\t\tvar sx = vector.set( te[ 0 ], te[ 1 ], te[ 2 ] ).length();\r\n\t\t\tvar sy = vector.set( te[ 4 ], te[ 5 ], te[ 6 ] ).length();\r\n\t\t\tvar sz = vector.set( te[ 8 ], te[ 9 ], te[ 10 ] ).length();\r\n\r\n\t\t\t// if determine is negative, we need to invert one scale\r\n\t\t\tvar det = this.determinant();\r\n\t\t\tif ( det < 0 ) {\r\n\t\t\t\tsx = - sx;\r\n\t\t\t}\r\n\r\n\t\t\tposition.x = te[ 12 ];\r\n\t\t\tposition.y = te[ 13 ];\r\n\t\t\tposition.z = te[ 14 ];\r\n\r\n\t\t\t// scale the rotation part\r\n\r\n\t\t\tmatrix.elements.set( this.elements ); // at this point matrix is incomplete so we can't use .copy()\r\n\r\n\t\t\tvar invSX = 1 / sx;\r\n\t\t\tvar invSY = 1 / sy;\r\n\t\t\tvar invSZ = 1 / sz;\r\n\r\n\t\t\tmatrix.elements[ 0 ] *= invSX;\r\n\t\t\tmatrix.elements[ 1 ] *= invSX;\r\n\t\t\tmatrix.elements[ 2 ] *= invSX;\r\n\r\n\t\t\tmatrix.elements[ 4 ] *= invSY;\r\n\t\t\tmatrix.elements[ 5 ] *= invSY;\r\n\t\t\tmatrix.elements[ 6 ] *= invSY;\r\n\r\n\t\t\tmatrix.elements[ 8 ] *= invSZ;\r\n\t\t\tmatrix.elements[ 9 ] *= invSZ;\r\n\t\t\tmatrix.elements[ 10 ] *= invSZ;\r\n\r\n\t\t\tquaternion.setFromRotationMatrix( matrix );\r\n\r\n\t\t\tscale.x = sx;\r\n\t\t\tscale.y = sy;\r\n\t\t\tscale.z = sz;\r\n\r\n\t\t\treturn this;\r\n\r\n\t\t};\r\n\r\n\t}(),\r\n\r\n\tmakeFrustum: function ( left, right, bottom, top, near, far ) {\r\n\r\n\t\tvar te = this.elements;\r\n\t\tvar x = 2 * near / ( right - left );\r\n\t\tvar y = 2 * near / ( top - bottom );\r\n\r\n\t\tvar a = ( right + left ) / ( right - left );\r\n\t\tvar b = ( top + bottom ) / ( top - bottom );\r\n\t\tvar c = - ( far + near ) / ( far - near );\r\n\t\tvar d = - 2 * far * near / ( far - near );\r\n\r\n\t\tte[ 0 ] = x;\tte[ 4 ] = 0;\tte[ 8 ] = a;\tte[ 12 ] = 0;\r\n\t\tte[ 1 ] = 0;\tte[ 5 ] = y;\tte[ 9 ] = b;\tte[ 13 ] = 0;\r\n\t\tte[ 2 ] = 0;\tte[ 6 ] = 0;\tte[ 10 ] = c;\tte[ 14 ] = d;\r\n\t\tte[ 3 ] = 0;\tte[ 7 ] = 0;\tte[ 11 ] = - 1;\tte[ 15 ] = 0;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tmakePerspective: function ( fov, aspect, near, far ) {\r\n\r\n\t\tvar ymax = near * Math.tan( THREE.Math.degToRad( fov * 0.5 ) );\r\n\t\tvar ymin = - ymax;\r\n\t\tvar xmin = ymin * aspect;\r\n\t\tvar xmax = ymax * aspect;\r\n\r\n\t\treturn this.makeFrustum( xmin, xmax, ymin, ymax, near, far );\r\n\r\n\t},\r\n\r\n\tmakeOrthographic: function ( left, right, top, bottom, near, far ) {\r\n\r\n\t\tvar te = this.elements;\r\n\t\tvar w = right - left;\r\n\t\tvar h = top - bottom;\r\n\t\tvar p = far - near;\r\n\r\n\t\tvar x = ( right + left ) / w;\r\n\t\tvar y = ( top + bottom ) / h;\r\n\t\tvar z = ( far + near ) / p;\r\n\r\n\t\tte[ 0 ] = 2 / w;\tte[ 4 ] = 0;\tte[ 8 ] = 0;\tte[ 12 ] = - x;\r\n\t\tte[ 1 ] = 0;\tte[ 5 ] = 2 / h;\tte[ 9 ] = 0;\tte[ 13 ] = - y;\r\n\t\tte[ 2 ] = 0;\tte[ 6 ] = 0;\tte[ 10 ] = - 2 / p;\tte[ 14 ] = - z;\r\n\t\tte[ 3 ] = 0;\tte[ 7 ] = 0;\tte[ 11 ] = 0;\tte[ 15 ] = 1;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tfromArray: function ( array ) {\r\n\r\n\t\tthis.elements.set( array );\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\ttoArray: function () {\r\n\r\n\t\tvar te = this.elements;\r\n\r\n\t\treturn [\r\n\t\t\tte[ 0 ], te[ 1 ], te[ 2 ], te[ 3 ],\r\n\t\t\tte[ 4 ], te[ 5 ], te[ 6 ], te[ 7 ],\r\n\t\t\tte[ 8 ], te[ 9 ], te[ 10 ], te[ 11 ],\r\n\t\t\tte[ 12 ], te[ 13 ], te[ 14 ], te[ 15 ]\r\n\t\t];\r\n\r\n\t},\r\n\r\n\tclone: function () {\r\n\r\n\t\treturn new THREE.Matrix4().fromArray( this.elements );\r\n\r\n\t}\r\n\r\n};\r\n\r\n// File:src/math/Ray.js\r\n\r\n/**\r\n * @author bhouston / http://exocortex.com\r\n */\r\n\r\nTHREE.Ray = function ( origin, direction ) {\r\n\r\n\tthis.origin = ( origin !== undefined ) ? origin : new THREE.Vector3();\r\n\tthis.direction = ( direction !== undefined ) ? direction : new THREE.Vector3();\r\n\r\n};\r\n\r\nTHREE.Ray.prototype = {\r\n\r\n\tconstructor: THREE.Ray,\r\n\r\n\tset: function ( origin, direction ) {\r\n\r\n\t\tthis.origin.copy( origin );\r\n\t\tthis.direction.copy( direction );\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tcopy: function ( ray ) {\r\n\r\n\t\tthis.origin.copy( ray.origin );\r\n\t\tthis.direction.copy( ray.direction );\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tat: function ( t, optionalTarget ) {\r\n\r\n\t\tvar result = optionalTarget || new THREE.Vector3();\r\n\r\n\t\treturn result.copy( this.direction ).multiplyScalar( t ).add( this.origin );\r\n\r\n\t},\r\n\r\n\trecast: function () {\r\n\r\n\t\tvar v1 = new THREE.Vector3();\r\n\r\n\t\treturn function ( t ) {\r\n\r\n\t\t\tthis.origin.copy( this.at( t, v1 ) );\r\n\r\n\t\t\treturn this;\r\n\r\n\t\t};\r\n\r\n\t}(),\r\n\r\n\tclosestPointToPoint: function ( point, optionalTarget ) {\r\n\r\n\t\tvar result = optionalTarget || new THREE.Vector3();\r\n\t\tresult.subVectors( point, this.origin );\r\n\t\tvar directionDistance = result.dot( this.direction );\r\n\r\n\t\tif ( directionDistance < 0 ) {\r\n\r\n\t\t\treturn result.copy( this.origin );\r\n\r\n\t\t}\r\n\r\n\t\treturn result.copy( this.direction ).multiplyScalar( directionDistance ).add( this.origin );\r\n\r\n\t},\r\n\r\n\tdistanceToPoint: function () {\r\n\r\n\t\tvar v1 = new THREE.Vector3();\r\n\r\n\t\treturn function ( point ) {\r\n\r\n\t\t\tvar directionDistance = v1.subVectors( point, this.origin ).dot( this.direction );\r\n\r\n\t\t\t// point behind the ray\r\n\r\n\t\t\tif ( directionDistance < 0 ) {\r\n\r\n\t\t\t\treturn this.origin.distanceTo( point );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tv1.copy( this.direction ).multiplyScalar( directionDistance ).add( this.origin );\r\n\r\n\t\t\treturn v1.distanceTo( point );\r\n\r\n\t\t};\r\n\r\n\t}(),\r\n\r\n\tdistanceSqToSegment: function () {\r\n\r\n\t\tvar segCenter = new THREE.Vector3();\r\n\t\tvar segDir = new THREE.Vector3();\r\n\t\tvar diff = new THREE.Vector3();\r\n\r\n\t\treturn function ( v0, v1, optionalPointOnRay, optionalPointOnSegment ) {\r\n\r\n\t\t\t// from http://www.geometrictools.com/LibMathematics/Distance/Wm5DistRay3Segment3.cpp\r\n\t\t\t// It returns the min distance between the ray and the segment\r\n\t\t\t// defined by v0 and v1\r\n\t\t\t// It can also set two optional targets :\r\n\t\t\t// - The closest point on the ray\r\n\t\t\t// - The closest point on the segment\r\n\r\n\t\t\tsegCenter.copy( v0 ).add( v1 ).multiplyScalar( 0.5 );\r\n\t\t\tsegDir.copy( v1 ).sub( v0 ).normalize();\r\n\t\t\tdiff.copy( this.origin ).sub( segCenter );\r\n\r\n\t\t\tvar segExtent = v0.distanceTo( v1 ) * 0.5;\r\n\t\t\tvar a01 = - this.direction.dot( segDir );\r\n\t\t\tvar b0 = diff.dot( this.direction );\r\n\t\t\tvar b1 = - diff.dot( segDir );\r\n\t\t\tvar c = diff.lengthSq();\r\n\t\t\tvar det = Math.abs( 1 - a01 * a01 );\r\n\t\t\tvar s0, s1, sqrDist, extDet;\r\n\r\n\t\t\tif ( det > 0 ) {\r\n\r\n\t\t\t\t// The ray and segment are not parallel.\r\n\r\n\t\t\t\ts0 = a01 * b1 - b0;\r\n\t\t\t\ts1 = a01 * b0 - b1;\r\n\t\t\t\textDet = segExtent * det;\r\n\r\n\t\t\t\tif ( s0 >= 0 ) {\r\n\r\n\t\t\t\t\tif ( s1 >= - extDet ) {\r\n\r\n\t\t\t\t\t\tif ( s1 <= extDet ) {\r\n\r\n\t\t\t\t\t\t\t// region 0\r\n\t\t\t\t\t\t\t// Minimum at interior points of ray and segment.\r\n\r\n\t\t\t\t\t\t\tvar invDet = 1 / det;\r\n\t\t\t\t\t\t\ts0 *= invDet;\r\n\t\t\t\t\t\t\ts1 *= invDet;\r\n\t\t\t\t\t\t\tsqrDist = s0 * ( s0 + a01 * s1 + 2 * b0 ) + s1 * ( a01 * s0 + s1 + 2 * b1 ) + c;\r\n\r\n\t\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\t\t// region 1\r\n\r\n\t\t\t\t\t\t\ts1 = segExtent;\r\n\t\t\t\t\t\t\ts0 = Math.max( 0, - ( a01 * s1 + b0 ) );\r\n\t\t\t\t\t\t\tsqrDist = - s0 * s0 + s1 * ( s1 + 2 * b1 ) + c;\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\t// region 5\r\n\r\n\t\t\t\t\t\ts1 = - segExtent;\r\n\t\t\t\t\t\ts0 = Math.max( 0, - ( a01 * s1 + b0 ) );\r\n\t\t\t\t\t\tsqrDist = - s0 * s0 + s1 * ( s1 + 2 * b1 ) + c;\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\tif ( s1 <= - extDet ) {\r\n\r\n\t\t\t\t\t\t// region 4\r\n\r\n\t\t\t\t\t\ts0 = Math.max( 0, - ( - a01 * segExtent + b0 ) );\r\n\t\t\t\t\t\ts1 = ( s0 > 0 ) ? - segExtent : Math.min( Math.max( - segExtent, - b1 ), segExtent );\r\n\t\t\t\t\t\tsqrDist = - s0 * s0 + s1 * ( s1 + 2 * b1 ) + c;\r\n\r\n\t\t\t\t\t} else if ( s1 <= extDet ) {\r\n\r\n\t\t\t\t\t\t// region 3\r\n\r\n\t\t\t\t\t\ts0 = 0;\r\n\t\t\t\t\t\ts1 = Math.min( Math.max( - segExtent, - b1 ), segExtent );\r\n\t\t\t\t\t\tsqrDist = s1 * ( s1 + 2 * b1 ) + c;\r\n\r\n\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\t// region 2\r\n\r\n\t\t\t\t\t\ts0 = Math.max( 0, - ( a01 * segExtent + b0 ) );\r\n\t\t\t\t\t\ts1 = ( s0 > 0 ) ? segExtent : Math.min( Math.max( - segExtent, - b1 ), segExtent );\r\n\t\t\t\t\t\tsqrDist = - s0 * s0 + s1 * ( s1 + 2 * b1 ) + c;\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\t// Ray and segment are parallel.\r\n\r\n\t\t\t\ts1 = ( a01 > 0 ) ? - segExtent : segExtent;\r\n\t\t\t\ts0 = Math.max( 0, - ( a01 * s1 + b0 ) );\r\n\t\t\t\tsqrDist = - s0 * s0 + s1 * ( s1 + 2 * b1 ) + c;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( optionalPointOnRay ) {\r\n\r\n\t\t\t\toptionalPointOnRay.copy( this.direction ).multiplyScalar( s0 ).add( this.origin );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( optionalPointOnSegment ) {\r\n\r\n\t\t\t\toptionalPointOnSegment.copy( segDir ).multiplyScalar( s1 ).add( segCenter );\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn sqrDist;\r\n\r\n\t\t};\r\n\r\n\t}(),\r\n\r\n\r\n\tisIntersectionSphere: function ( sphere ) {\r\n\r\n\t\treturn this.distanceToPoint( sphere.center ) <= sphere.radius;\r\n\r\n\t},\r\n\r\n\tintersectSphere: function () {\r\n\r\n\t\t// from http://www.scratchapixel.com/lessons/3d-basic-lessons/lesson-7-intersecting-simple-shapes/ray-sphere-intersection/\r\n\r\n\t\tvar v1 = new THREE.Vector3();\r\n\r\n\t\treturn function ( sphere, optionalTarget ) {\r\n\r\n\t\t\tv1.subVectors( sphere.center, this.origin );\r\n\r\n\t\t\tvar tca = v1.dot( this.direction );\r\n\r\n\t\t\tvar d2 = v1.dot( v1 ) - tca * tca;\r\n\r\n\t\t\tvar radius2 = sphere.radius * sphere.radius;\r\n\r\n\t\t\tif ( d2 > radius2 ) return null;\r\n\r\n\t\t\tvar thc = Math.sqrt( radius2 - d2 );\r\n\r\n\t\t\t// t0 = first intersect point - entrance on front of sphere\r\n\t\t\tvar t0 = tca - thc;\r\n\r\n\t\t\t// t1 = second intersect point - exit point on back of sphere\r\n\t\t\tvar t1 = tca + thc;\r\n\r\n\t\t\t// test to see if both t0 and t1 are behind the ray - if so, return null\r\n\t\t\tif ( t0 < 0 && t1 < 0 ) return null;\r\n\r\n\t\t\t// test to see if t0 is behind the ray:\r\n\t\t\t// if it is, the ray is inside the sphere, so return the second exit point scaled by t1,\r\n\t\t\t// in order to always return an intersect point that is in front of the ray.\r\n\t\t\tif ( t0 < 0 ) return this.at( t1, optionalTarget );\r\n\r\n\t\t\t// else t0 is in front of the ray, so return the first collision point scaled by t0 \r\n\t\t\treturn this.at( t0, optionalTarget );\r\n\r\n\t\t}\r\n\r\n\t}(),\r\n\r\n\tisIntersectionPlane: function ( plane ) {\r\n\r\n\t\t// check if the ray lies on the plane first\r\n\r\n\t\tvar distToPoint = plane.distanceToPoint( this.origin );\r\n\r\n\t\tif ( distToPoint === 0 ) {\r\n\r\n\t\t\treturn true;\r\n\r\n\t\t}\r\n\r\n\t\tvar denominator = plane.normal.dot( this.direction );\r\n\r\n\t\tif ( denominator * distToPoint < 0 ) {\r\n\r\n\t\t\treturn true;\r\n\r\n\t\t}\r\n\r\n\t\t// ray origin is behind the plane (and is pointing behind it)\r\n\r\n\t\treturn false;\r\n\r\n\t},\r\n\r\n\tdistanceToPlane: function ( plane ) {\r\n\r\n\t\tvar denominator = plane.normal.dot( this.direction );\r\n\t\tif ( denominator == 0 ) {\r\n\r\n\t\t\t// line is coplanar, return origin\r\n\t\t\tif ( plane.distanceToPoint( this.origin ) == 0 ) {\r\n\r\n\t\t\t\treturn 0;\r\n\r\n\t\t\t}\r\n\r\n\t\t\t// Null is preferable to undefined since undefined means.... it is undefined\r\n\r\n\t\t\treturn null;\r\n\r\n\t\t}\r\n\r\n\t\tvar t = - ( this.origin.dot( plane.normal ) + plane.constant ) / denominator;\r\n\r\n\t\t// Return if the ray never intersects the plane\r\n\r\n\t\treturn t >= 0 ? t :  null;\r\n\r\n\t},\r\n\r\n\tintersectPlane: function ( plane, optionalTarget ) {\r\n\r\n\t\tvar t = this.distanceToPlane( plane );\r\n\r\n\t\tif ( t === null ) {\r\n\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\treturn this.at( t, optionalTarget );\r\n\r\n\t},\r\n\r\n\tisIntersectionBox: function () {\r\n\r\n\t\tvar v = new THREE.Vector3();\r\n\r\n\t\treturn function ( box ) {\r\n\r\n\t\t\treturn this.intersectBox( box, v ) !== null;\r\n\r\n\t\t};\r\n\r\n\t}(),\r\n\r\n\tintersectBox: function ( box, optionalTarget ) {\r\n\r\n\t\t// http://www.scratchapixel.com/lessons/3d-basic-lessons/lesson-7-intersecting-simple-shapes/ray-box-intersection/\r\n\r\n\t\tvar tmin,tmax,tymin,tymax,tzmin,tzmax;\r\n\r\n\t\tvar invdirx = 1 / this.direction.x,\r\n\t\t\tinvdiry = 1 / this.direction.y,\r\n\t\t\tinvdirz = 1 / this.direction.z;\r\n\r\n\t\tvar origin = this.origin;\r\n\r\n\t\tif ( invdirx >= 0 ) {\r\n\r\n\t\t\ttmin = ( box.min.x - origin.x ) * invdirx;\r\n\t\t\ttmax = ( box.max.x - origin.x ) * invdirx;\r\n\r\n\t\t} else {\r\n\r\n\t\t\ttmin = ( box.max.x - origin.x ) * invdirx;\r\n\t\t\ttmax = ( box.min.x - origin.x ) * invdirx;\r\n\t\t}\r\n\r\n\t\tif ( invdiry >= 0 ) {\r\n\r\n\t\t\ttymin = ( box.min.y - origin.y ) * invdiry;\r\n\t\t\ttymax = ( box.max.y - origin.y ) * invdiry;\r\n\r\n\t\t} else {\r\n\r\n\t\t\ttymin = ( box.max.y - origin.y ) * invdiry;\r\n\t\t\ttymax = ( box.min.y - origin.y ) * invdiry;\r\n\t\t}\r\n\r\n\t\tif ( ( tmin > tymax ) || ( tymin > tmax ) ) return null;\r\n\r\n\t\t// These lines also handle the case where tmin or tmax is NaN\r\n\t\t// (result of 0 * Infinity). x !== x returns true if x is NaN\r\n\r\n\t\tif ( tymin > tmin || tmin !== tmin ) tmin = tymin;\r\n\r\n\t\tif ( tymax < tmax || tmax !== tmax ) tmax = tymax;\r\n\r\n\t\tif ( invdirz >= 0 ) {\r\n\r\n\t\t\ttzmin = ( box.min.z - origin.z ) * invdirz;\r\n\t\t\ttzmax = ( box.max.z - origin.z ) * invdirz;\r\n\r\n\t\t} else {\r\n\r\n\t\t\ttzmin = ( box.max.z - origin.z ) * invdirz;\r\n\t\t\ttzmax = ( box.min.z - origin.z ) * invdirz;\r\n\t\t}\r\n\r\n\t\tif ( ( tmin > tzmax ) || ( tzmin > tmax ) ) return null;\r\n\r\n\t\tif ( tzmin > tmin || tmin !== tmin ) tmin = tzmin;\r\n\r\n\t\tif ( tzmax < tmax || tmax !== tmax ) tmax = tzmax;\r\n\r\n\t\t//return point closest to the ray (positive side)\r\n\r\n\t\tif ( tmax < 0 ) return null;\r\n\r\n\t\treturn this.at( tmin >= 0 ? tmin : tmax, optionalTarget );\r\n\r\n\t},\r\n\r\n\tintersectTriangle: function () {\r\n\r\n\t\t// Compute the offset origin, edges, and normal.\r\n\t\tvar diff = new THREE.Vector3();\r\n\t\tvar edge1 = new THREE.Vector3();\r\n\t\tvar edge2 = new THREE.Vector3();\r\n\t\tvar normal = new THREE.Vector3();\r\n\r\n\t\treturn function ( a, b, c, backfaceCulling, optionalTarget ) {\r\n\r\n\t\t\t// from http://www.geometrictools.com/LibMathematics/Intersection/Wm5IntrRay3Triangle3.cpp\r\n\r\n\t\t\tedge1.subVectors( b, a );\r\n\t\t\tedge2.subVectors( c, a );\r\n\t\t\tnormal.crossVectors( edge1, edge2 );\r\n\r\n\t\t\t// Solve Q + t*D = b1*E1 + b2*E2 (Q = kDiff, D = ray direction,\r\n\t\t\t// E1 = kEdge1, E2 = kEdge2, N = Cross(E1,E2)) by\r\n\t\t\t//   |Dot(D,N)|*b1 = sign(Dot(D,N))*Dot(D,Cross(Q,E2))\r\n\t\t\t//   |Dot(D,N)|*b2 = sign(Dot(D,N))*Dot(D,Cross(E1,Q))\r\n\t\t\t//   |Dot(D,N)|*t = -sign(Dot(D,N))*Dot(Q,N)\r\n\t\t\tvar DdN = this.direction.dot( normal );\r\n\t\t\tvar sign;\r\n\r\n\t\t\tif ( DdN > 0 ) {\r\n\r\n\t\t\t\tif ( backfaceCulling ) return null;\r\n\t\t\t\tsign = 1;\r\n\r\n\t\t\t} else if ( DdN < 0 ) {\r\n\r\n\t\t\t\tsign = - 1;\r\n\t\t\t\tDdN = - DdN;\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\treturn null;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tdiff.subVectors( this.origin, a );\r\n\t\t\tvar DdQxE2 = sign * this.direction.dot( edge2.crossVectors( diff, edge2 ) );\r\n\r\n\t\t\t// b1 < 0, no intersection\r\n\t\t\tif ( DdQxE2 < 0 ) {\r\n\r\n\t\t\t\treturn null;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tvar DdE1xQ = sign * this.direction.dot( edge1.cross( diff ) );\r\n\r\n\t\t\t// b2 < 0, no intersection\r\n\t\t\tif ( DdE1xQ < 0 ) {\r\n\r\n\t\t\t\treturn null;\r\n\r\n\t\t\t}\r\n\r\n\t\t\t// b1+b2 > 1, no intersection\r\n\t\t\tif ( DdQxE2 + DdE1xQ > DdN ) {\r\n\r\n\t\t\t\treturn null;\r\n\r\n\t\t\t}\r\n\r\n\t\t\t// Line intersects triangle, check if ray does.\r\n\t\t\tvar QdN = - sign * diff.dot( normal );\r\n\r\n\t\t\t// t < 0, no intersection\r\n\t\t\tif ( QdN < 0 ) {\r\n\r\n\t\t\t\treturn null;\r\n\r\n\t\t\t}\r\n\r\n\t\t\t// Ray intersects triangle.\r\n\t\t\treturn this.at( QdN / DdN, optionalTarget );\r\n\r\n\t\t};\r\n\r\n\t}(),\r\n\r\n\tapplyMatrix4: function ( matrix4 ) {\r\n\r\n\t\tthis.direction.add( this.origin ).applyMatrix4( matrix4 );\r\n\t\tthis.origin.applyMatrix4( matrix4 );\r\n\t\tthis.direction.sub( this.origin );\r\n\t\tthis.direction.normalize();\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\tequals: function ( ray ) {\r\n\r\n\t\treturn ray.origin.equals( this.origin ) && ray.direction.equals( this.direction );\r\n\r\n\t},\r\n\r\n\tclone: function () {\r\n\r\n\t\treturn new THREE.Ray().copy( this );\r\n\r\n\t}\r\n\r\n};\r\n\r\n// File:src/math/Sphere.js\r\n\r\n/**\r\n * @author bhouston / http://exocortex.com\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.Sphere = function ( center, radius ) {\r\n\r\n\tthis.center = ( center !== undefined ) ? center : new THREE.Vector3();\r\n\tthis.radius = ( radius !== undefined ) ? radius : 0;\r\n\r\n};\r\n\r\nTHREE.Sphere.prototype = {\r\n\r\n\tconstructor: THREE.Sphere,\r\n\r\n\tset: function ( center, radius ) {\r\n\r\n\t\tthis.center.copy( center );\r\n\t\tthis.radius = radius;\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\tsetFromPoints: function () {\r\n\r\n\t\tvar box = new THREE.Box3();\r\n\r\n\t\treturn function ( points, optionalCenter ) {\r\n\r\n\t\t\tvar center = this.center;\r\n\r\n\t\t\tif ( optionalCenter !== undefined ) {\r\n\r\n\t\t\t\tcenter.copy( optionalCenter );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tbox.setFromPoints( points ).center( center );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tvar maxRadiusSq = 0;\r\n\r\n\t\t\tfor ( var i = 0, il = points.length; i < il; i ++ ) {\r\n\r\n\t\t\t\tmaxRadiusSq = Math.max( maxRadiusSq, center.distanceToSquared( points[ i ] ) );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tthis.radius = Math.sqrt( maxRadiusSq );\r\n\r\n\t\t\treturn this;\r\n\r\n\t\t};\r\n\r\n\t}(),\r\n\r\n\tcopy: function ( sphere ) {\r\n\r\n\t\tthis.center.copy( sphere.center );\r\n\t\tthis.radius = sphere.radius;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tempty: function () {\r\n\r\n\t\treturn ( this.radius <= 0 );\r\n\r\n\t},\r\n\r\n\tcontainsPoint: function ( point ) {\r\n\r\n\t\treturn ( point.distanceToSquared( this.center ) <= ( this.radius * this.radius ) );\r\n\r\n\t},\r\n\r\n\tdistanceToPoint: function ( point ) {\r\n\r\n\t\treturn ( point.distanceTo( this.center ) - this.radius );\r\n\r\n\t},\r\n\r\n\tintersectsSphere: function ( sphere ) {\r\n\r\n\t\tvar radiusSum = this.radius + sphere.radius;\r\n\r\n\t\treturn sphere.center.distanceToSquared( this.center ) <= ( radiusSum * radiusSum );\r\n\r\n\t},\r\n\r\n\tclampPoint: function ( point, optionalTarget ) {\r\n\r\n\t\tvar deltaLengthSq = this.center.distanceToSquared( point );\r\n\r\n\t\tvar result = optionalTarget || new THREE.Vector3();\r\n\t\tresult.copy( point );\r\n\r\n\t\tif ( deltaLengthSq > ( this.radius * this.radius ) ) {\r\n\r\n\t\t\tresult.sub( this.center ).normalize();\r\n\t\t\tresult.multiplyScalar( this.radius ).add( this.center );\r\n\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\r\n\t},\r\n\r\n\tgetBoundingBox: function ( optionalTarget ) {\r\n\r\n\t\tvar box = optionalTarget || new THREE.Box3();\r\n\r\n\t\tbox.set( this.center, this.center );\r\n\t\tbox.expandByScalar( this.radius );\r\n\r\n\t\treturn box;\r\n\r\n\t},\r\n\r\n\tapplyMatrix4: function ( matrix ) {\r\n\r\n\t\tthis.center.applyMatrix4( matrix );\r\n\t\tthis.radius = this.radius * matrix.getMaxScaleOnAxis();\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\ttranslate: function ( offset ) {\r\n\r\n\t\tthis.center.add( offset );\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tequals: function ( sphere ) {\r\n\r\n\t\treturn sphere.center.equals( this.center ) && ( sphere.radius === this.radius );\r\n\r\n\t},\r\n\r\n\tclone: function () {\r\n\r\n\t\treturn new THREE.Sphere().copy( this );\r\n\r\n\t}\r\n\r\n};\r\n\r\n// File:src/math/Frustum.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author alteredq / http://alteredqualia.com/\r\n * @author bhouston / http://exocortex.com\r\n */\r\n\r\nTHREE.Frustum = function ( p0, p1, p2, p3, p4, p5 ) {\r\n\r\n\tthis.planes = [\r\n\r\n\t\t( p0 !== undefined ) ? p0 : new THREE.Plane(),\r\n\t\t( p1 !== undefined ) ? p1 : new THREE.Plane(),\r\n\t\t( p2 !== undefined ) ? p2 : new THREE.Plane(),\r\n\t\t( p3 !== undefined ) ? p3 : new THREE.Plane(),\r\n\t\t( p4 !== undefined ) ? p4 : new THREE.Plane(),\r\n\t\t( p5 !== undefined ) ? p5 : new THREE.Plane()\r\n\r\n\t];\r\n\r\n};\r\n\r\nTHREE.Frustum.prototype = {\r\n\r\n\tconstructor: THREE.Frustum,\r\n\r\n\tset: function ( p0, p1, p2, p3, p4, p5 ) {\r\n\r\n\t\tvar planes = this.planes;\r\n\r\n\t\tplanes[ 0 ].copy( p0 );\r\n\t\tplanes[ 1 ].copy( p1 );\r\n\t\tplanes[ 2 ].copy( p2 );\r\n\t\tplanes[ 3 ].copy( p3 );\r\n\t\tplanes[ 4 ].copy( p4 );\r\n\t\tplanes[ 5 ].copy( p5 );\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tcopy: function ( frustum ) {\r\n\r\n\t\tvar planes = this.planes;\r\n\r\n\t\tfor ( var i = 0; i < 6; i ++ ) {\r\n\r\n\t\t\tplanes[ i ].copy( frustum.planes[ i ] );\r\n\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tsetFromMatrix: function ( m ) {\r\n\r\n\t\tvar planes = this.planes;\r\n\t\tvar me = m.elements;\r\n\t\tvar me0 = me[ 0 ], me1 = me[ 1 ], me2 = me[ 2 ], me3 = me[ 3 ];\r\n\t\tvar me4 = me[ 4 ], me5 = me[ 5 ], me6 = me[ 6 ], me7 = me[ 7 ];\r\n\t\tvar me8 = me[ 8 ], me9 = me[ 9 ], me10 = me[ 10 ], me11 = me[ 11 ];\r\n\t\tvar me12 = me[ 12 ], me13 = me[ 13 ], me14 = me[ 14 ], me15 = me[ 15 ];\r\n\r\n\t\tplanes[ 0 ].setComponents( me3 - me0, me7 - me4, me11 - me8, me15 - me12 ).normalize();\r\n\t\tplanes[ 1 ].setComponents( me3 + me0, me7 + me4, me11 + me8, me15 + me12 ).normalize();\r\n\t\tplanes[ 2 ].setComponents( me3 + me1, me7 + me5, me11 + me9, me15 + me13 ).normalize();\r\n\t\tplanes[ 3 ].setComponents( me3 - me1, me7 - me5, me11 - me9, me15 - me13 ).normalize();\r\n\t\tplanes[ 4 ].setComponents( me3 - me2, me7 - me6, me11 - me10, me15 - me14 ).normalize();\r\n\t\tplanes[ 5 ].setComponents( me3 + me2, me7 + me6, me11 + me10, me15 + me14 ).normalize();\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tintersectsObject: function () {\r\n\r\n\t\tvar sphere = new THREE.Sphere();\r\n\r\n\t\treturn function ( object ) {\r\n\r\n\t\t\tvar geometry = object.geometry;\r\n\r\n\t\t\tif ( geometry.boundingSphere === null ) geometry.computeBoundingSphere();\r\n\r\n\t\t\tsphere.copy( geometry.boundingSphere );\r\n\t\t\tsphere.applyMatrix4( object.matrixWorld );\r\n\r\n\t\t\treturn this.intersectsSphere( sphere );\r\n\r\n\t\t};\r\n\r\n\t}(),\r\n\r\n\tintersectsSphere: function ( sphere ) {\r\n\r\n\t\tvar planes = this.planes;\r\n\t\tvar center = sphere.center;\r\n\t\tvar negRadius = - sphere.radius;\r\n\r\n\t\tfor ( var i = 0; i < 6; i ++ ) {\r\n\r\n\t\t\tvar distance = planes[ i ].distanceToPoint( center );\r\n\r\n\t\t\tif ( distance < negRadius ) {\r\n\r\n\t\t\t\treturn false;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\treturn true;\r\n\r\n\t},\r\n\r\n\tintersectsBox: function () {\r\n\r\n\t\tvar p1 = new THREE.Vector3(),\r\n\t\t\tp2 = new THREE.Vector3();\r\n\r\n\t\treturn function ( box ) {\r\n\r\n\t\t\tvar planes = this.planes;\r\n\r\n\t\t\tfor ( var i = 0; i < 6 ; i ++ ) {\r\n\r\n\t\t\t\tvar plane = planes[ i ];\r\n\r\n\t\t\t\tp1.x = plane.normal.x > 0 ? box.min.x : box.max.x;\r\n\t\t\t\tp2.x = plane.normal.x > 0 ? box.max.x : box.min.x;\r\n\t\t\t\tp1.y = plane.normal.y > 0 ? box.min.y : box.max.y;\r\n\t\t\t\tp2.y = plane.normal.y > 0 ? box.max.y : box.min.y;\r\n\t\t\t\tp1.z = plane.normal.z > 0 ? box.min.z : box.max.z;\r\n\t\t\t\tp2.z = plane.normal.z > 0 ? box.max.z : box.min.z;\r\n\r\n\t\t\t\tvar d1 = plane.distanceToPoint( p1 );\r\n\t\t\t\tvar d2 = plane.distanceToPoint( p2 );\r\n\r\n\t\t\t\t// if both outside plane, no intersection\r\n\r\n\t\t\t\tif ( d1 < 0 && d2 < 0 ) {\r\n\r\n\t\t\t\t\treturn false;\r\n\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn true;\r\n\t\t};\r\n\r\n\t}(),\r\n\r\n\r\n\tcontainsPoint: function ( point ) {\r\n\r\n\t\tvar planes = this.planes;\r\n\r\n\t\tfor ( var i = 0; i < 6; i ++ ) {\r\n\r\n\t\t\tif ( planes[ i ].distanceToPoint( point ) < 0 ) {\r\n\r\n\t\t\t\treturn false;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\treturn true;\r\n\r\n\t},\r\n\r\n\tclone: function () {\r\n\r\n\t\treturn new THREE.Frustum().copy( this );\r\n\r\n\t}\r\n\r\n};\r\n\r\n// File:src/math/Plane.js\r\n\r\n/**\r\n * @author bhouston / http://exocortex.com\r\n */\r\n\r\nTHREE.Plane = function ( normal, constant ) {\r\n\r\n\tthis.normal = ( normal !== undefined ) ? normal : new THREE.Vector3( 1, 0, 0 );\r\n\tthis.constant = ( constant !== undefined ) ? constant : 0;\r\n\r\n};\r\n\r\nTHREE.Plane.prototype = {\r\n\r\n\tconstructor: THREE.Plane,\r\n\r\n\tset: function ( normal, constant ) {\r\n\r\n\t\tthis.normal.copy( normal );\r\n\t\tthis.constant = constant;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tsetComponents: function ( x, y, z, w ) {\r\n\r\n\t\tthis.normal.set( x, y, z );\r\n\t\tthis.constant = w;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tsetFromNormalAndCoplanarPoint: function ( normal, point ) {\r\n\r\n\t\tthis.normal.copy( normal );\r\n\t\tthis.constant = - point.dot( this.normal );\t// must be this.normal, not normal, as this.normal is normalized\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tsetFromCoplanarPoints: function () {\r\n\r\n\t\tvar v1 = new THREE.Vector3();\r\n\t\tvar v2 = new THREE.Vector3();\r\n\r\n\t\treturn function ( a, b, c ) {\r\n\r\n\t\t\tvar normal = v1.subVectors( c, b ).cross( v2.subVectors( a, b ) ).normalize();\r\n\r\n\t\t\t// Q: should an error be thrown if normal is zero (e.g. degenerate plane)?\r\n\r\n\t\t\tthis.setFromNormalAndCoplanarPoint( normal, a );\r\n\r\n\t\t\treturn this;\r\n\r\n\t\t};\r\n\r\n\t}(),\r\n\r\n\r\n\tcopy: function ( plane ) {\r\n\r\n\t\tthis.normal.copy( plane.normal );\r\n\t\tthis.constant = plane.constant;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tnormalize: function () {\r\n\r\n\t\t// Note: will lead to a divide by zero if the plane is invalid.\r\n\r\n\t\tvar inverseNormalLength = 1.0 / this.normal.length();\r\n\t\tthis.normal.multiplyScalar( inverseNormalLength );\r\n\t\tthis.constant *= inverseNormalLength;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tnegate: function () {\r\n\r\n\t\tthis.constant *= - 1;\r\n\t\tthis.normal.negate();\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tdistanceToPoint: function ( point ) {\r\n\r\n\t\treturn this.normal.dot( point ) + this.constant;\r\n\r\n\t},\r\n\r\n\tdistanceToSphere: function ( sphere ) {\r\n\r\n\t\treturn this.distanceToPoint( sphere.center ) - sphere.radius;\r\n\r\n\t},\r\n\r\n\tprojectPoint: function ( point, optionalTarget ) {\r\n\r\n\t\treturn this.orthoPoint( point, optionalTarget ).sub( point ).negate();\r\n\r\n\t},\r\n\r\n\torthoPoint: function ( point, optionalTarget ) {\r\n\r\n\t\tvar perpendicularMagnitude = this.distanceToPoint( point );\r\n\r\n\t\tvar result = optionalTarget || new THREE.Vector3();\r\n\t\treturn result.copy( this.normal ).multiplyScalar( perpendicularMagnitude );\r\n\r\n\t},\r\n\r\n\tisIntersectionLine: function ( line ) {\r\n\r\n\t\t// Note: this tests if a line intersects the plane, not whether it (or its end-points) are coplanar with it.\r\n\r\n\t\tvar startSign = this.distanceToPoint( line.start );\r\n\t\tvar endSign = this.distanceToPoint( line.end );\r\n\r\n\t\treturn ( startSign < 0 && endSign > 0 ) || ( endSign < 0 && startSign > 0 );\r\n\r\n\t},\r\n\r\n\tintersectLine: function () {\r\n\r\n\t\tvar v1 = new THREE.Vector3();\r\n\r\n\t\treturn function ( line, optionalTarget ) {\r\n\r\n\t\t\tvar result = optionalTarget || new THREE.Vector3();\r\n\r\n\t\t\tvar direction = line.delta( v1 );\r\n\r\n\t\t\tvar denominator = this.normal.dot( direction );\r\n\r\n\t\t\tif ( denominator == 0 ) {\r\n\r\n\t\t\t\t// line is coplanar, return origin\r\n\t\t\t\tif ( this.distanceToPoint( line.start ) == 0 ) {\r\n\r\n\t\t\t\t\treturn result.copy( line.start );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Unsure if this is the correct method to handle this case.\r\n\t\t\t\treturn undefined;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tvar t = - ( line.start.dot( this.normal ) + this.constant ) / denominator;\r\n\r\n\t\t\tif ( t < 0 || t > 1 ) {\r\n\r\n\t\t\t\treturn undefined;\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn result.copy( direction ).multiplyScalar( t ).add( line.start );\r\n\r\n\t\t};\r\n\r\n\t}(),\r\n\r\n\r\n\tcoplanarPoint: function ( optionalTarget ) {\r\n\r\n\t\tvar result = optionalTarget || new THREE.Vector3();\r\n\t\treturn result.copy( this.normal ).multiplyScalar( - this.constant );\r\n\r\n\t},\r\n\r\n\tapplyMatrix4: function () {\r\n\r\n\t\tvar v1 = new THREE.Vector3();\r\n\t\tvar v2 = new THREE.Vector3();\r\n\t\tvar m1 = new THREE.Matrix3();\r\n\r\n\t\treturn function ( matrix, optionalNormalMatrix ) {\r\n\r\n\t\t\t// compute new normal based on theory here:\r\n\t\t\t// http://www.songho.ca/opengl/gl_normaltransform.html\r\n\t\t\tvar normalMatrix = optionalNormalMatrix || m1.getNormalMatrix( matrix );\r\n\t\t\tvar newNormal = v1.copy( this.normal ).applyMatrix3( normalMatrix );\r\n\r\n\t\t\tvar newCoplanarPoint = this.coplanarPoint( v2 );\r\n\t\t\tnewCoplanarPoint.applyMatrix4( matrix );\r\n\r\n\t\t\tthis.setFromNormalAndCoplanarPoint( newNormal, newCoplanarPoint );\r\n\r\n\t\t\treturn this;\r\n\r\n\t\t};\r\n\r\n\t}(),\r\n\r\n\ttranslate: function ( offset ) {\r\n\r\n\t\tthis.constant = this.constant - offset.dot( this.normal );\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tequals: function ( plane ) {\r\n\r\n\t\treturn plane.normal.equals( this.normal ) && ( plane.constant == this.constant );\r\n\r\n\t},\r\n\r\n\tclone: function () {\r\n\r\n\t\treturn new THREE.Plane().copy( this );\r\n\r\n\t}\r\n\r\n};\r\n\r\n// File:src/math/Math.js\r\n\r\n/**\r\n * @author alteredq / http://alteredqualia.com/\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.Math = {\r\n\r\n\tgenerateUUID: function () {\r\n\r\n\t\t// http://www.broofa.com/Tools/Math.uuid.htm\r\n\r\n\t\tvar chars = '0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz'.split( '' );\r\n\t\tvar uuid = new Array( 36 );\r\n\t\tvar rnd = 0, r;\r\n\r\n\t\treturn function () {\r\n\r\n\t\t\tfor ( var i = 0; i < 36; i ++ ) {\r\n\r\n\t\t\t\tif ( i == 8 || i == 13 || i == 18 || i == 23 ) {\r\n\r\n\t\t\t\t\tuuid[ i ] = '-';\r\n\r\n\t\t\t\t} else if ( i == 14 ) {\r\n\r\n\t\t\t\t\tuuid[ i ] = '4';\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\tif ( rnd <= 0x02 ) rnd = 0x2000000 + ( Math.random() * 0x1000000 ) | 0;\r\n\t\t\t\t\tr = rnd & 0xf;\r\n\t\t\t\t\trnd = rnd >> 4;\r\n\t\t\t\t\tuuid[ i ] = chars[ ( i == 19 ) ? ( r & 0x3 ) | 0x8 : r ];\r\n\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn uuid.join( '' );\r\n\r\n\t\t};\r\n\r\n\t}(),\r\n\r\n\t// Clamp value to range <a, b>\r\n\r\n\tclamp: function ( x, a, b ) {\r\n\r\n\t\treturn ( x < a ) ? a : ( ( x > b ) ? b : x );\r\n\r\n\t},\r\n\r\n\t// Clamp value to range <a, inf)\r\n\r\n\tclampBottom: function ( x, a ) {\r\n\r\n\t\treturn x < a ? a : x;\r\n\r\n\t},\r\n\r\n\t// Linear mapping from range <a1, a2> to range <b1, b2>\r\n\r\n\tmapLinear: function ( x, a1, a2, b1, b2 ) {\r\n\r\n\t\treturn b1 + ( x - a1 ) * ( b2 - b1 ) / ( a2 - a1 );\r\n\r\n\t},\r\n\r\n\t// http://en.wikipedia.org/wiki/Smoothstep\r\n\r\n\tsmoothstep: function ( x, min, max ) {\r\n\r\n\t\tif ( x <= min ) return 0;\r\n\t\tif ( x >= max ) return 1;\r\n\r\n\t\tx = ( x - min ) / ( max - min );\r\n\r\n\t\treturn x * x * ( 3 - 2 * x );\r\n\r\n\t},\r\n\r\n\tsmootherstep: function ( x, min, max ) {\r\n\r\n\t\tif ( x <= min ) return 0;\r\n\t\tif ( x >= max ) return 1;\r\n\r\n\t\tx = ( x - min ) / ( max - min );\r\n\r\n\t\treturn x * x * x * ( x * ( x * 6 - 15 ) + 10 );\r\n\r\n\t},\r\n\r\n\t// Random float from <0, 1> with 16 bits of randomness\r\n\t// (standard Math.random() creates repetitive patterns when applied over larger space)\r\n\r\n\trandom16: function () {\r\n\r\n\t\treturn ( 65280 * Math.random() + 255 * Math.random() ) / 65535;\r\n\r\n\t},\r\n\r\n\t// Random integer from <low, high> interval\r\n\r\n\trandInt: function ( low, high ) {\r\n\r\n\t\treturn Math.floor( this.randFloat( low, high ) );\r\n\r\n\t},\r\n\r\n\t// Random float from <low, high> interval\r\n\r\n\trandFloat: function ( low, high ) {\r\n\r\n\t\treturn low + Math.random() * ( high - low );\r\n\r\n\t},\r\n\r\n\t// Random float from <-range/2, range/2> interval\r\n\r\n\trandFloatSpread: function ( range ) {\r\n\r\n\t\treturn range * ( 0.5 - Math.random() );\r\n\r\n\t},\r\n\r\n\tdegToRad: function () {\r\n\r\n\t\tvar degreeToRadiansFactor = Math.PI / 180;\r\n\r\n\t\treturn function ( degrees ) {\r\n\r\n\t\t\treturn degrees * degreeToRadiansFactor;\r\n\r\n\t\t};\r\n\r\n\t}(),\r\n\r\n\tradToDeg: function () {\r\n\r\n\t\tvar radianToDegreesFactor = 180 / Math.PI;\r\n\r\n\t\treturn function ( radians ) {\r\n\r\n\t\t\treturn radians * radianToDegreesFactor;\r\n\r\n\t\t};\r\n\r\n\t}(),\r\n\r\n\tisPowerOfTwo: function ( value ) {\r\n\r\n\t\treturn ( value & ( value - 1 ) ) === 0 && value !== 0;\r\n\r\n\t},\r\n\r\n\tnextPowerOfTwo: function ( value ) {\r\n\r\n\t\tvalue --;\r\n\t\tvalue |= value >> 1;\r\n\t\tvalue |= value >> 2;\r\n\t\tvalue |= value >> 4;\r\n\t\tvalue |= value >> 8;\r\n\t\tvalue |= value >> 16;\r\n\t\tvalue ++;\r\n\r\n\t\treturn value;\r\n\r\n\t}\r\n\r\n};\r\n\r\n// File:src/math/Spline.js\r\n\r\n/**\r\n * Spline from Tween.js, slightly optimized (and trashed)\r\n * http://sole.github.com/tween.js/examples/05_spline.html\r\n *\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author alteredq / http://alteredqualia.com/\r\n */\r\n\r\nTHREE.Spline = function ( points ) {\r\n\r\n\tthis.points = points;\r\n\r\n\tvar c = [], v3 = { x: 0, y: 0, z: 0 },\r\n\tpoint, intPoint, weight, w2, w3,\r\n\tpa, pb, pc, pd;\r\n\r\n\tthis.initFromArray = function ( a ) {\r\n\r\n\t\tthis.points = [];\r\n\r\n\t\tfor ( var i = 0; i < a.length; i ++ ) {\r\n\r\n\t\t\tthis.points[ i ] = { x: a[ i ][ 0 ], y: a[ i ][ 1 ], z: a[ i ][ 2 ] };\r\n\r\n\t\t}\r\n\r\n\t};\r\n\r\n\tthis.getPoint = function ( k ) {\r\n\r\n\t\tpoint = ( this.points.length - 1 ) * k;\r\n\t\tintPoint = Math.floor( point );\r\n\t\tweight = point - intPoint;\r\n\r\n\t\tc[ 0 ] = intPoint === 0 ? intPoint : intPoint - 1;\r\n\t\tc[ 1 ] = intPoint;\r\n\t\tc[ 2 ] = intPoint  > this.points.length - 2 ? this.points.length - 1 : intPoint + 1;\r\n\t\tc[ 3 ] = intPoint  > this.points.length - 3 ? this.points.length - 1 : intPoint + 2;\r\n\r\n\t\tpa = this.points[ c[ 0 ] ];\r\n\t\tpb = this.points[ c[ 1 ] ];\r\n\t\tpc = this.points[ c[ 2 ] ];\r\n\t\tpd = this.points[ c[ 3 ] ];\r\n\r\n\t\tw2 = weight * weight;\r\n\t\tw3 = weight * w2;\r\n\r\n\t\tv3.x = interpolate( pa.x, pb.x, pc.x, pd.x, weight, w2, w3 );\r\n\t\tv3.y = interpolate( pa.y, pb.y, pc.y, pd.y, weight, w2, w3 );\r\n\t\tv3.z = interpolate( pa.z, pb.z, pc.z, pd.z, weight, w2, w3 );\r\n\r\n\t\treturn v3;\r\n\r\n\t};\r\n\r\n\tthis.getControlPointsArray = function () {\r\n\r\n\t\tvar i, p, l = this.points.length,\r\n\t\t\tcoords = [];\r\n\r\n\t\tfor ( i = 0; i < l; i ++ ) {\r\n\r\n\t\t\tp = this.points[ i ];\r\n\t\t\tcoords[ i ] = [ p.x, p.y, p.z ];\r\n\r\n\t\t}\r\n\r\n\t\treturn coords;\r\n\r\n\t};\r\n\r\n\t// approximate length by summing linear segments\r\n\r\n\tthis.getLength = function ( nSubDivisions ) {\r\n\r\n\t\tvar i, index, nSamples, position,\r\n\t\t\tpoint = 0, intPoint = 0, oldIntPoint = 0,\r\n\t\t\toldPosition = new THREE.Vector3(),\r\n\t\t\ttmpVec = new THREE.Vector3(),\r\n\t\t\tchunkLengths = [],\r\n\t\t\ttotalLength = 0;\r\n\r\n\t\t// first point has 0 length\r\n\r\n\t\tchunkLengths[ 0 ] = 0;\r\n\r\n\t\tif ( ! nSubDivisions ) nSubDivisions = 100;\r\n\r\n\t\tnSamples = this.points.length * nSubDivisions;\r\n\r\n\t\toldPosition.copy( this.points[ 0 ] );\r\n\r\n\t\tfor ( i = 1; i < nSamples; i ++ ) {\r\n\r\n\t\t\tindex = i / nSamples;\r\n\r\n\t\t\tposition = this.getPoint( index );\r\n\t\t\ttmpVec.copy( position );\r\n\r\n\t\t\ttotalLength += tmpVec.distanceTo( oldPosition );\r\n\r\n\t\t\toldPosition.copy( position );\r\n\r\n\t\t\tpoint = ( this.points.length - 1 ) * index;\r\n\t\t\tintPoint = Math.floor( point );\r\n\r\n\t\t\tif ( intPoint != oldIntPoint ) {\r\n\r\n\t\t\t\tchunkLengths[ intPoint ] = totalLength;\r\n\t\t\t\toldIntPoint = intPoint;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\t// last point ends with total length\r\n\r\n\t\tchunkLengths[ chunkLengths.length ] = totalLength;\r\n\r\n\t\treturn { chunks: chunkLengths, total: totalLength };\r\n\r\n\t};\r\n\r\n\tthis.reparametrizeByArcLength = function ( samplingCoef ) {\r\n\r\n\t\tvar i, j,\r\n\t\t\tindex, indexCurrent, indexNext,\r\n\t\t\trealDistance,\r\n\t\t\tsampling, position,\r\n\t\t\tnewpoints = [],\r\n\t\t\ttmpVec = new THREE.Vector3(),\r\n\t\t\tsl = this.getLength();\r\n\r\n\t\tnewpoints.push( tmpVec.copy( this.points[ 0 ] ).clone() );\r\n\r\n\t\tfor ( i = 1; i < this.points.length; i ++ ) {\r\n\r\n\t\t\t//tmpVec.copy( this.points[ i - 1 ] );\r\n\t\t\t//linearDistance = tmpVec.distanceTo( this.points[ i ] );\r\n\r\n\t\t\trealDistance = sl.chunks[ i ] - sl.chunks[ i - 1 ];\r\n\r\n\t\t\tsampling = Math.ceil( samplingCoef * realDistance / sl.total );\r\n\r\n\t\t\tindexCurrent = ( i - 1 ) / ( this.points.length - 1 );\r\n\t\t\tindexNext = i / ( this.points.length - 1 );\r\n\r\n\t\t\tfor ( j = 1; j < sampling - 1; j ++ ) {\r\n\r\n\t\t\t\tindex = indexCurrent + j * ( 1 / sampling ) * ( indexNext - indexCurrent );\r\n\r\n\t\t\t\tposition = this.getPoint( index );\r\n\t\t\t\tnewpoints.push( tmpVec.copy( position ).clone() );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tnewpoints.push( tmpVec.copy( this.points[ i ] ).clone() );\r\n\r\n\t\t}\r\n\r\n\t\tthis.points = newpoints;\r\n\r\n\t};\r\n\r\n\t// Catmull-Rom\r\n\r\n\tfunction interpolate( p0, p1, p2, p3, t, t2, t3 ) {\r\n\r\n\t\tvar v0 = ( p2 - p0 ) * 0.5,\r\n\t\t\tv1 = ( p3 - p1 ) * 0.5;\r\n\r\n\t\treturn ( 2 * ( p1 - p2 ) + v0 + v1 ) * t3 + ( - 3 * ( p1 - p2 ) - 2 * v0 - v1 ) * t2 + v0 * t + p1;\r\n\r\n\t};\r\n\r\n};\r\n\r\n// File:src/math/Triangle.js\r\n\r\n/**\r\n * @author bhouston / http://exocortex.com\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.Triangle = function ( a, b, c ) {\r\n\r\n\tthis.a = ( a !== undefined ) ? a : new THREE.Vector3();\r\n\tthis.b = ( b !== undefined ) ? b : new THREE.Vector3();\r\n\tthis.c = ( c !== undefined ) ? c : new THREE.Vector3();\r\n\r\n};\r\n\r\nTHREE.Triangle.normal = function () {\r\n\r\n\tvar v0 = new THREE.Vector3();\r\n\r\n\treturn function ( a, b, c, optionalTarget ) {\r\n\r\n\t\tvar result = optionalTarget || new THREE.Vector3();\r\n\r\n\t\tresult.subVectors( c, b );\r\n\t\tv0.subVectors( a, b );\r\n\t\tresult.cross( v0 );\r\n\r\n\t\tvar resultLengthSq = result.lengthSq();\r\n\t\tif ( resultLengthSq > 0 ) {\r\n\r\n\t\t\treturn result.multiplyScalar( 1 / Math.sqrt( resultLengthSq ) );\r\n\r\n\t\t}\r\n\r\n\t\treturn result.set( 0, 0, 0 );\r\n\r\n\t};\r\n\r\n}();\r\n\r\n// static/instance method to calculate barycoordinates\r\n// based on: http://www.blackpawn.com/texts/pointinpoly/default.html\r\nTHREE.Triangle.barycoordFromPoint = function () {\r\n\r\n\tvar v0 = new THREE.Vector3();\r\n\tvar v1 = new THREE.Vector3();\r\n\tvar v2 = new THREE.Vector3();\r\n\r\n\treturn function ( point, a, b, c, optionalTarget ) {\r\n\r\n\t\tv0.subVectors( c, a );\r\n\t\tv1.subVectors( b, a );\r\n\t\tv2.subVectors( point, a );\r\n\r\n\t\tvar dot00 = v0.dot( v0 );\r\n\t\tvar dot01 = v0.dot( v1 );\r\n\t\tvar dot02 = v0.dot( v2 );\r\n\t\tvar dot11 = v1.dot( v1 );\r\n\t\tvar dot12 = v1.dot( v2 );\r\n\r\n\t\tvar denom = ( dot00 * dot11 - dot01 * dot01 );\r\n\r\n\t\tvar result = optionalTarget || new THREE.Vector3();\r\n\r\n\t\t// colinear or singular triangle\r\n\t\tif ( denom == 0 ) {\r\n\t\t\t// arbitrary location outside of triangle?\r\n\t\t\t// not sure if this is the best idea, maybe should be returning undefined\r\n\t\t\treturn result.set( - 2, - 1, - 1 );\r\n\t\t}\r\n\r\n\t\tvar invDenom = 1 / denom;\r\n\t\tvar u = ( dot11 * dot02 - dot01 * dot12 ) * invDenom;\r\n\t\tvar v = ( dot00 * dot12 - dot01 * dot02 ) * invDenom;\r\n\r\n\t\t// barycoordinates must always sum to 1\r\n\t\treturn result.set( 1 - u - v, v, u );\r\n\r\n\t};\r\n\r\n}();\r\n\r\nTHREE.Triangle.containsPoint = function () {\r\n\r\n\tvar v1 = new THREE.Vector3();\r\n\r\n\treturn function ( point, a, b, c ) {\r\n\r\n\t\tvar result = THREE.Triangle.barycoordFromPoint( point, a, b, c, v1 );\r\n\r\n\t\treturn ( result.x >= 0 ) && ( result.y >= 0 ) && ( ( result.x + result.y ) <= 1 );\r\n\r\n\t};\r\n\r\n}();\r\n\r\nTHREE.Triangle.prototype = {\r\n\r\n\tconstructor: THREE.Triangle,\r\n\r\n\tset: function ( a, b, c ) {\r\n\r\n\t\tthis.a.copy( a );\r\n\t\tthis.b.copy( b );\r\n\t\tthis.c.copy( c );\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tsetFromPointsAndIndices: function ( points, i0, i1, i2 ) {\r\n\r\n\t\tthis.a.copy( points[ i0 ] );\r\n\t\tthis.b.copy( points[ i1 ] );\r\n\t\tthis.c.copy( points[ i2 ] );\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tcopy: function ( triangle ) {\r\n\r\n\t\tthis.a.copy( triangle.a );\r\n\t\tthis.b.copy( triangle.b );\r\n\t\tthis.c.copy( triangle.c );\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tarea: function () {\r\n\r\n\t\tvar v0 = new THREE.Vector3();\r\n\t\tvar v1 = new THREE.Vector3();\r\n\r\n\t\treturn function () {\r\n\r\n\t\t\tv0.subVectors( this.c, this.b );\r\n\t\t\tv1.subVectors( this.a, this.b );\r\n\r\n\t\t\treturn v0.cross( v1 ).length() * 0.5;\r\n\r\n\t\t};\r\n\r\n\t}(),\r\n\r\n\tmidpoint: function ( optionalTarget ) {\r\n\r\n\t\tvar result = optionalTarget || new THREE.Vector3();\r\n\t\treturn result.addVectors( this.a, this.b ).add( this.c ).multiplyScalar( 1 / 3 );\r\n\r\n\t},\r\n\r\n\tnormal: function ( optionalTarget ) {\r\n\r\n\t\treturn THREE.Triangle.normal( this.a, this.b, this.c, optionalTarget );\r\n\r\n\t},\r\n\r\n\tplane: function ( optionalTarget ) {\r\n\r\n\t\tvar result = optionalTarget || new THREE.Plane();\r\n\r\n\t\treturn result.setFromCoplanarPoints( this.a, this.b, this.c );\r\n\r\n\t},\r\n\r\n\tbarycoordFromPoint: function ( point, optionalTarget ) {\r\n\r\n\t\treturn THREE.Triangle.barycoordFromPoint( point, this.a, this.b, this.c, optionalTarget );\r\n\r\n\t},\r\n\r\n\tcontainsPoint: function ( point ) {\r\n\r\n\t\treturn THREE.Triangle.containsPoint( point, this.a, this.b, this.c );\r\n\r\n\t},\r\n\r\n\tequals: function ( triangle ) {\r\n\r\n\t\treturn triangle.a.equals( this.a ) && triangle.b.equals( this.b ) && triangle.c.equals( this.c );\r\n\r\n\t},\r\n\r\n\tclone: function () {\r\n\r\n\t\treturn new THREE.Triangle().copy( this );\r\n\r\n\t}\r\n\r\n};\r\n\r\n// File:src/core/Clock.js\r\n\r\n/**\r\n * @author alteredq / http://alteredqualia.com/\r\n */\r\n\r\nTHREE.Clock = function ( autoStart ) {\r\n\r\n\tthis.autoStart = ( autoStart !== undefined ) ? autoStart : true;\r\n\r\n\tthis.startTime = 0;\r\n\tthis.oldTime = 0;\r\n\tthis.elapsedTime = 0;\r\n\r\n\tthis.running = false;\r\n\r\n};\r\n\r\nTHREE.Clock.prototype = {\r\n\r\n\tconstructor: THREE.Clock,\r\n\r\n\tstart: function () {\r\n\r\n\t\tthis.startTime = self.performance !== undefined && self.performance.now !== undefined\r\n\t\t\t\t\t ? self.performance.now()\r\n\t\t\t\t\t : Date.now();\r\n\r\n\t\tthis.oldTime = this.startTime;\r\n\t\tthis.running = true;\r\n\t},\r\n\r\n\tstop: function () {\r\n\r\n\t\tthis.getElapsedTime();\r\n\t\tthis.running = false;\r\n\r\n\t},\r\n\r\n\tgetElapsedTime: function () {\r\n\r\n\t\tthis.getDelta();\r\n\t\treturn this.elapsedTime;\r\n\r\n\t},\r\n\r\n\tgetDelta: function () {\r\n\r\n\t\tvar diff = 0;\r\n\r\n\t\tif ( this.autoStart && ! this.running ) {\r\n\r\n\t\t\tthis.start();\r\n\r\n\t\t}\r\n\r\n\t\tif ( this.running ) {\r\n\r\n\t\t\tvar newTime = self.performance !== undefined && self.performance.now !== undefined\r\n\t\t\t\t\t ? self.performance.now()\r\n\t\t\t\t\t : Date.now();\r\n\r\n\t\t\tdiff = 0.001 * ( newTime - this.oldTime );\r\n\t\t\tthis.oldTime = newTime;\r\n\r\n\t\t\tthis.elapsedTime += diff;\r\n\r\n\t\t}\r\n\r\n\t\treturn diff;\r\n\r\n\t}\r\n\r\n};\r\n\r\n// File:src/core/EventDispatcher.js\r\n\r\n/**\r\n * https://github.com/mrdoob/eventdispatcher.js/\r\n */\r\n\r\nTHREE.EventDispatcher = function () {}\r\n\r\nTHREE.EventDispatcher.prototype = {\r\n\r\n\tconstructor: THREE.EventDispatcher,\r\n\r\n\tapply: function ( object ) {\r\n\r\n\t\tobject.addEventListener = THREE.EventDispatcher.prototype.addEventListener;\r\n\t\tobject.hasEventListener = THREE.EventDispatcher.prototype.hasEventListener;\r\n\t\tobject.removeEventListener = THREE.EventDispatcher.prototype.removeEventListener;\r\n\t\tobject.dispatchEvent = THREE.EventDispatcher.prototype.dispatchEvent;\r\n\r\n\t},\r\n\r\n\taddEventListener: function ( type, listener ) {\r\n\r\n\t\tif ( this._listeners === undefined ) this._listeners = {};\r\n\r\n\t\tvar listeners = this._listeners;\r\n\r\n\t\tif ( listeners[ type ] === undefined ) {\r\n\r\n\t\t\tlisteners[ type ] = [];\r\n\r\n\t\t}\r\n\r\n\t\tif ( listeners[ type ].indexOf( listener ) === - 1 ) {\r\n\r\n\t\t\tlisteners[ type ].push( listener );\r\n\r\n\t\t}\r\n\r\n\t},\r\n\r\n\thasEventListener: function ( type, listener ) {\r\n\r\n\t\tif ( this._listeners === undefined ) return false;\r\n\r\n\t\tvar listeners = this._listeners;\r\n\r\n\t\tif ( listeners[ type ] !== undefined && listeners[ type ].indexOf( listener ) !== - 1 ) {\r\n\r\n\t\t\treturn true;\r\n\r\n\t\t}\r\n\r\n\t\treturn false;\r\n\r\n\t},\r\n\r\n\tremoveEventListener: function ( type, listener ) {\r\n\r\n\t\tif ( this._listeners === undefined ) return;\r\n\r\n\t\tvar listeners = this._listeners;\r\n\t\tvar listenerArray = listeners[ type ];\r\n\r\n\t\tif ( listenerArray !== undefined ) {\r\n\r\n\t\t\tvar index = listenerArray.indexOf( listener );\r\n\r\n\t\t\tif ( index !== - 1 ) {\r\n\r\n\t\t\t\tlistenerArray.splice( index, 1 );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t},\r\n\r\n\tdispatchEvent: function ( event ) {\r\n\r\n\t\tif ( this._listeners === undefined ) return;\r\n\r\n\t\tvar listeners = this._listeners;\r\n\t\tvar listenerArray = listeners[ event.type ];\r\n\r\n\t\tif ( listenerArray !== undefined ) {\r\n\r\n\t\t\tevent.target = this;\r\n\r\n\t\t\tvar array = [];\r\n\t\t\tvar length = listenerArray.length;\r\n\r\n\t\t\tfor ( var i = 0; i < length; i ++ ) {\r\n\r\n\t\t\t\tarray[ i ] = listenerArray[ i ];\r\n\r\n\t\t\t}\r\n\r\n\t\t\tfor ( var i = 0; i < length; i ++ ) {\r\n\r\n\t\t\t\tarray[ i ].call( this, event );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n};\r\n\r\n// File:src/core/Raycaster.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author bhouston / http://exocortex.com/\r\n * @author stephomi / http://stephaneginier.com/\r\n */\r\n\r\n( function ( THREE ) {\r\n\r\n\tTHREE.Raycaster = function ( origin, direction, near, far ) {\r\n\r\n\t\tthis.ray = new THREE.Ray( origin, direction );\r\n\t\t// direction is assumed to be normalized (for accurate distance calculations)\r\n\r\n\t\tthis.near = near || 0;\r\n\t\tthis.far = far || Infinity;\r\n\r\n\t\tthis.params = {\r\n\t\t\tSprite: {},\r\n\t\t\tMesh: {},\r\n\t\t\tPointCloud: { threshold: 1 },\r\n\t\t\tLOD: {},\r\n\t\t\tLine: {}\r\n\t\t};\r\n\r\n\t};\r\n\r\n\tvar descSort = function ( a, b ) {\r\n\r\n\t\treturn a.distance - b.distance;\r\n\r\n\t};\r\n\r\n\tvar intersectObject = function ( object, raycaster, intersects, recursive ) {\r\n\r\n\t\tobject.raycast( raycaster, intersects );\r\n\r\n\t\tif ( recursive === true ) {\r\n\r\n\t\t\tvar children = object.children;\r\n\r\n\t\t\tfor ( var i = 0, l = children.length; i < l; i ++ ) {\r\n\r\n\t\t\t\tintersectObject( children[ i ], raycaster, intersects, true );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t};\r\n\r\n\t//\r\n\r\n\tTHREE.Raycaster.prototype = {\r\n\r\n\t\tconstructor: THREE.Raycaster,\r\n\r\n\t\tprecision: 0.0001,\r\n\t\tlinePrecision: 1,\r\n\r\n\t\tset: function ( origin, direction ) {\r\n\r\n\t\t\t// direction is assumed to be normalized (for accurate distance calculations)\r\n\r\n\t\t\tthis.ray.set( origin, direction );\r\n\r\n\t\t},\r\n\r\n\t\tsetFromCamera: function ( coords, camera ) {\r\n\r\n\t\t\t// camera is assumed _not_ to be a child of a transformed object\r\n\r\n\t\t\tif ( camera instanceof THREE.PerspectiveCamera ) {\r\n\r\n\t\t\t\tthis.ray.origin.copy( camera.position );\r\n\t\t\t\tthis.ray.direction.set( coords.x, coords.y, 0.5 ).unproject( camera ).sub( camera.position ).normalize();\r\n\r\n\t\t\t} else if ( camera instanceof THREE.OrthographicCamera ) {\r\n\r\n\t\t\t\tthis.ray.origin.set( coords.x, coords.y, - 1 ).unproject( camera );\r\n\t\t\t\tthis.ray.direction.set( 0, 0, - 1 ).transformDirection( camera.matrixWorld );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tTHREE.error( 'THREE.Raycaster: Unsupported camera type.' );\r\n\r\n\t\t\t}\r\n\r\n\t\t},\r\n\r\n\t\tintersectObject: function ( object, recursive ) {\r\n\r\n\t\t\tvar intersects = [];\r\n\r\n\t\t\tintersectObject( object, this, intersects, recursive );\r\n\r\n\t\t\tintersects.sort( descSort );\r\n\r\n\t\t\treturn intersects;\r\n\r\n\t\t},\r\n\r\n\t\tintersectObjects: function ( objects, recursive ) {\r\n\r\n\t\t\tvar intersects = [];\r\n\r\n\t\t\tif ( objects instanceof Array === false ) {\r\n\r\n\t\t\t\tTHREE.warn( 'THREE.Raycaster.intersectObjects: objects is not an Array.' );\r\n\t\t\t\treturn intersects;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tfor ( var i = 0, l = objects.length; i < l; i ++ ) {\r\n\r\n\t\t\t\tintersectObject( objects[ i ], this, intersects, recursive );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tintersects.sort( descSort );\r\n\r\n\t\t\treturn intersects;\r\n\r\n\t\t}\r\n\r\n\t};\r\n\r\n}( THREE ) );\r\n\r\n// File:src/core/Object3D.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author mikael emtinger / http://gomo.se/\r\n * @author alteredq / http://alteredqualia.com/\r\n * @author WestLangley / http://github.com/WestLangley\r\n */\r\n\r\nTHREE.Object3D = function () {\r\n\r\n\tObject.defineProperty( this, 'id', { value: THREE.Object3DIdCount ++ } );\r\n\r\n\tthis.uuid = THREE.Math.generateUUID();\r\n\r\n\tthis.name = '';\r\n\tthis.type = 'Object3D';\r\n\r\n\tthis.parent = undefined;\r\n\tthis.children = [];\r\n\r\n\tthis.up = THREE.Object3D.DefaultUp.clone();\r\n\r\n\tvar position = new THREE.Vector3();\r\n\tvar rotation = new THREE.Euler();\r\n\tvar quaternion = new THREE.Quaternion();\r\n\tvar scale = new THREE.Vector3( 1, 1, 1 );\r\n\r\n\tvar onRotationChange = function () {\r\n\t\tquaternion.setFromEuler( rotation, false );\r\n\t};\r\n\r\n\tvar onQuaternionChange = function () {\r\n\t\trotation.setFromQuaternion( quaternion, undefined, false );\r\n\t};\r\n\r\n\trotation.onChange( onRotationChange );\r\n\tquaternion.onChange( onQuaternionChange );\r\n\r\n\tObject.defineProperties( this, {\r\n\t\tposition: {\r\n\t\t\tenumerable: true,\r\n\t\t\tvalue: position\r\n\t\t},\r\n\t\trotation: {\r\n\t\t\tenumerable: true,\r\n\t\t\tvalue: rotation\r\n\t\t},\r\n\t\tquaternion: {\r\n\t\t\tenumerable: true,\r\n\t\t\tvalue: quaternion\r\n\t\t},\r\n\t\tscale: {\r\n\t\t\tenumerable: true,\r\n\t\t\tvalue: scale\r\n\t\t}\r\n\t} );\r\n\r\n\tthis.rotationAutoUpdate = true;\r\n\r\n\tthis.matrix = new THREE.Matrix4();\r\n\tthis.matrixWorld = new THREE.Matrix4();\r\n\r\n\tthis.matrixAutoUpdate = true;\r\n\tthis.matrixWorldNeedsUpdate = false;\r\n\r\n\tthis.visible = true;\r\n\r\n\tthis.castShadow = false;\r\n\tthis.receiveShadow = false;\r\n\r\n\tthis.frustumCulled = true;\r\n\tthis.renderOrder = 0;\r\n\r\n\tthis.userData = {};\r\n\r\n};\r\n\r\nTHREE.Object3D.DefaultUp = new THREE.Vector3( 0, 1, 0 );\r\n\r\nTHREE.Object3D.prototype = {\r\n\r\n\tconstructor: THREE.Object3D,\r\n\r\n\tget eulerOrder () {\r\n\r\n\t\tTHREE.warn( 'THREE.Object3D: .eulerOrder has been moved to .rotation.order.' );\r\n\r\n\t\treturn this.rotation.order;\r\n\r\n\t},\r\n\r\n\tset eulerOrder ( value ) {\r\n\r\n\t\tTHREE.warn( 'THREE.Object3D: .eulerOrder has been moved to .rotation.order.' );\r\n\r\n\t\tthis.rotation.order = value;\r\n\r\n\t},\r\n\r\n\tget useQuaternion () {\r\n\r\n\t\tTHREE.warn( 'THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.' );\r\n\r\n\t},\r\n\r\n\tset useQuaternion ( value ) {\r\n\r\n\t\tTHREE.warn( 'THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.' );\r\n\r\n\t},\r\n\r\n\tapplyMatrix: function ( matrix ) {\r\n\r\n\t\tthis.matrix.multiplyMatrices( matrix, this.matrix );\r\n\r\n\t\tthis.matrix.decompose( this.position, this.quaternion, this.scale );\r\n\r\n\t},\r\n\r\n\tsetRotationFromAxisAngle: function ( axis, angle ) {\r\n\r\n\t\t// assumes axis is normalized\r\n\r\n\t\tthis.quaternion.setFromAxisAngle( axis, angle );\r\n\r\n\t},\r\n\r\n\tsetRotationFromEuler: function ( euler ) {\r\n\r\n\t\tthis.quaternion.setFromEuler( euler, true );\r\n\r\n\t},\r\n\r\n\tsetRotationFromMatrix: function ( m ) {\r\n\r\n\t\t// assumes the upper 3x3 of m is a pure rotation matrix (i.e, unscaled)\r\n\r\n\t\tthis.quaternion.setFromRotationMatrix( m );\r\n\r\n\t},\r\n\r\n\tsetRotationFromQuaternion: function ( q ) {\r\n\r\n\t\t// assumes q is normalized\r\n\r\n\t\tthis.quaternion.copy( q );\r\n\r\n\t},\r\n\r\n\trotateOnAxis: function () {\r\n\r\n\t\t// rotate object on axis in object space\r\n\t\t// axis is assumed to be normalized\r\n\r\n\t\tvar q1 = new THREE.Quaternion();\r\n\r\n\t\treturn function ( axis, angle ) {\r\n\r\n\t\t\tq1.setFromAxisAngle( axis, angle );\r\n\r\n\t\t\tthis.quaternion.multiply( q1 );\r\n\r\n\t\t\treturn this;\r\n\r\n\t\t}\r\n\r\n\t}(),\r\n\r\n\trotateX: function () {\r\n\r\n\t\tvar v1 = new THREE.Vector3( 1, 0, 0 );\r\n\r\n\t\treturn function ( angle ) {\r\n\r\n\t\t\treturn this.rotateOnAxis( v1, angle );\r\n\r\n\t\t};\r\n\r\n\t}(),\r\n\r\n\trotateY: function () {\r\n\r\n\t\tvar v1 = new THREE.Vector3( 0, 1, 0 );\r\n\r\n\t\treturn function ( angle ) {\r\n\r\n\t\t\treturn this.rotateOnAxis( v1, angle );\r\n\r\n\t\t};\r\n\r\n\t}(),\r\n\r\n\trotateZ: function () {\r\n\r\n\t\tvar v1 = new THREE.Vector3( 0, 0, 1 );\r\n\r\n\t\treturn function ( angle ) {\r\n\r\n\t\t\treturn this.rotateOnAxis( v1, angle );\r\n\r\n\t\t};\r\n\r\n\t}(),\r\n\r\n\ttranslateOnAxis: function () {\r\n\r\n\t\t// translate object by distance along axis in object space\r\n\t\t// axis is assumed to be normalized\r\n\r\n\t\tvar v1 = new THREE.Vector3();\r\n\r\n\t\treturn function ( axis, distance ) {\r\n\r\n\t\t\tv1.copy( axis ).applyQuaternion( this.quaternion );\r\n\r\n\t\t\tthis.position.add( v1.multiplyScalar( distance ) );\r\n\r\n\t\t\treturn this;\r\n\r\n\t\t}\r\n\r\n\t}(),\r\n\r\n\ttranslate: function ( distance, axis ) {\r\n\r\n\t\tTHREE.warn( 'THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead.' );\r\n\t\treturn this.translateOnAxis( axis, distance );\r\n\r\n\t},\r\n\r\n\ttranslateX: function () {\r\n\r\n\t\tvar v1 = new THREE.Vector3( 1, 0, 0 );\r\n\r\n\t\treturn function ( distance ) {\r\n\r\n\t\t\treturn this.translateOnAxis( v1, distance );\r\n\r\n\t\t};\r\n\r\n\t}(),\r\n\r\n\ttranslateY: function () {\r\n\r\n\t\tvar v1 = new THREE.Vector3( 0, 1, 0 );\r\n\r\n\t\treturn function ( distance ) {\r\n\r\n\t\t\treturn this.translateOnAxis( v1, distance );\r\n\r\n\t\t};\r\n\r\n\t}(),\r\n\r\n\ttranslateZ: function () {\r\n\r\n\t\tvar v1 = new THREE.Vector3( 0, 0, 1 );\r\n\r\n\t\treturn function ( distance ) {\r\n\r\n\t\t\treturn this.translateOnAxis( v1, distance );\r\n\r\n\t\t};\r\n\r\n\t}(),\r\n\r\n\tlocalToWorld: function ( vector ) {\r\n\r\n\t\treturn vector.applyMatrix4( this.matrixWorld );\r\n\r\n\t},\r\n\r\n\tworldToLocal: function () {\r\n\r\n\t\tvar m1 = new THREE.Matrix4();\r\n\r\n\t\treturn function ( vector ) {\r\n\r\n\t\t\treturn vector.applyMatrix4( m1.getInverse( this.matrixWorld ) );\r\n\r\n\t\t};\r\n\r\n\t}(),\r\n\r\n\tlookAt: function () {\r\n\r\n\t\t// This routine does not support objects with rotated and/or translated parent(s)\r\n\r\n\t\tvar m1 = new THREE.Matrix4();\r\n\r\n\t\treturn function ( vector ) {\r\n\r\n\t\t\tm1.lookAt( vector, this.position, this.up );\r\n\r\n\t\t\tthis.quaternion.setFromRotationMatrix( m1 );\r\n\r\n\t\t};\r\n\r\n\t}(),\r\n\r\n\tadd: function ( object ) {\r\n\r\n\t\tif ( arguments.length > 1 ) {\r\n\r\n\t\t\tfor ( var i = 0; i < arguments.length; i ++ ) {\r\n\r\n\t\t\t\tthis.add( arguments[ i ] );\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn this;\r\n\r\n\t\t};\r\n\r\n\t\tif ( object === this ) {\r\n\r\n\t\t\tTHREE.error( \"THREE.Object3D.add: object can't be added as a child of itself.\", object );\r\n\t\t\treturn this;\r\n\r\n\t\t}\r\n\r\n\t\tif ( object instanceof THREE.Object3D ) {\r\n\r\n\t\t\tif ( object.parent !== undefined ) {\r\n\r\n\t\t\t\tobject.parent.remove( object );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tobject.parent = this;\r\n\t\t\tobject.dispatchEvent( { type: 'added' } );\r\n\r\n\t\t\tthis.children.push( object );\r\n\r\n\t\t} else {\r\n\r\n\t\t\tTHREE.error( \"THREE.Object3D.add: object not an instance of THREE.Object3D.\", object );\r\n\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tremove: function ( object ) {\r\n\r\n\t\tif ( arguments.length > 1 ) {\r\n\r\n\t\t\tfor ( var i = 0; i < arguments.length; i ++ ) {\r\n\r\n\t\t\t\tthis.remove( arguments[ i ] );\r\n\r\n\t\t\t}\r\n\r\n\t\t};\r\n\r\n\t\tvar index = this.children.indexOf( object );\r\n\r\n\t\tif ( index !== - 1 ) {\r\n\r\n\t\t\tobject.parent = undefined;\r\n\r\n\t\t\tobject.dispatchEvent( { type: 'removed' } );\r\n\r\n\t\t\tthis.children.splice( index, 1 );\r\n\r\n\t\t}\r\n\r\n\t},\r\n\r\n\tgetChildByName: function ( name ) {\r\n\r\n\t\tTHREE.warn( 'THREE.Object3D: .getChildByName() has been renamed to .getObjectByName().' );\r\n\t\treturn this.getObjectByName( name );\r\n\r\n\t},\r\n\r\n\tgetObjectById: function ( id ) {\r\n\r\n\t\treturn this.getObjectByProperty( 'id', id );\r\n\r\n\t},\r\n\r\n\tgetObjectByName: function ( name ) {\r\n\r\n\t\treturn this.getObjectByProperty( 'name', name );\r\n\r\n\t},\r\n\r\n\tgetObjectByProperty: function ( name, value ) {\r\n\r\n\t\tif ( this[ name ] === value ) return this;\r\n\r\n\t\tfor ( var i = 0, l = this.children.length; i < l; i ++ ) {\r\n\r\n\t\t\tvar child = this.children[ i ];\r\n\t\t\tvar object = child.getObjectByProperty( name, value );\r\n\r\n\t\t\tif ( object !== undefined ) {\r\n\r\n\t\t\t\treturn object;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\treturn undefined;\r\n\r\n\t},\r\n\r\n\tgetWorldPosition: function ( optionalTarget ) {\r\n\r\n\t\tvar result = optionalTarget || new THREE.Vector3();\r\n\r\n\t\tthis.updateMatrixWorld( true );\r\n\r\n\t\treturn result.setFromMatrixPosition( this.matrixWorld );\r\n\r\n\t},\r\n\r\n\tgetWorldQuaternion: function () {\r\n\r\n\t\tvar position = new THREE.Vector3();\r\n\t\tvar scale = new THREE.Vector3();\r\n\r\n\t\treturn function ( optionalTarget ) {\r\n\r\n\t\t\tvar result = optionalTarget || new THREE.Quaternion();\r\n\r\n\t\t\tthis.updateMatrixWorld( true );\r\n\r\n\t\t\tthis.matrixWorld.decompose( position, result, scale );\r\n\r\n\t\t\treturn result;\r\n\r\n\t\t}\r\n\r\n\t}(),\r\n\r\n\tgetWorldRotation: function () {\r\n\r\n\t\tvar quaternion = new THREE.Quaternion();\r\n\r\n\t\treturn function ( optionalTarget ) {\r\n\r\n\t\t\tvar result = optionalTarget || new THREE.Euler();\r\n\r\n\t\t\tthis.getWorldQuaternion( quaternion );\r\n\r\n\t\t\treturn result.setFromQuaternion( quaternion, this.rotation.order, false );\r\n\r\n\t\t}\r\n\r\n\t}(),\r\n\r\n\tgetWorldScale: function () {\r\n\r\n\t\tvar position = new THREE.Vector3();\r\n\t\tvar quaternion = new THREE.Quaternion();\r\n\r\n\t\treturn function ( optionalTarget ) {\r\n\r\n\t\t\tvar result = optionalTarget || new THREE.Vector3();\r\n\r\n\t\t\tthis.updateMatrixWorld( true );\r\n\r\n\t\t\tthis.matrixWorld.decompose( position, quaternion, result );\r\n\r\n\t\t\treturn result;\r\n\r\n\t\t}\r\n\r\n\t}(),\r\n\r\n\tgetWorldDirection: function () {\r\n\r\n\t\tvar quaternion = new THREE.Quaternion();\r\n\r\n\t\treturn function ( optionalTarget ) {\r\n\r\n\t\t\tvar result = optionalTarget || new THREE.Vector3();\r\n\r\n\t\t\tthis.getWorldQuaternion( quaternion );\r\n\r\n\t\t\treturn result.set( 0, 0, 1 ).applyQuaternion( quaternion );\r\n\r\n\t\t}\r\n\r\n\t}(),\r\n\r\n\traycast: function () {},\r\n\r\n\ttraverse: function ( callback ) {\r\n\r\n\t\tcallback( this );\r\n\r\n\t\tfor ( var i = 0, l = this.children.length; i < l; i ++ ) {\r\n\r\n\t\t\tthis.children[ i ].traverse( callback );\r\n\r\n\t\t}\r\n\r\n\t},\r\n\r\n\ttraverseVisible: function ( callback ) {\r\n\r\n\t\tif ( this.visible === false ) return;\r\n\r\n\t\tcallback( this );\r\n\r\n\t\tfor ( var i = 0, l = this.children.length; i < l; i ++ ) {\r\n\r\n\t\t\tthis.children[ i ].traverseVisible( callback );\r\n\r\n\t\t}\r\n\r\n\t},\r\n\r\n\ttraverseAncestors: function ( callback ) {\r\n\r\n\t\tif ( this.parent ) {\r\n\r\n\t\t\tcallback( this.parent );\r\n\r\n\t\t\tthis.parent.traverseAncestors( callback );\r\n\r\n\t\t}\r\n\r\n\t},\r\n\r\n\tupdateMatrix: function () {\r\n\r\n\t\tthis.matrix.compose( this.position, this.quaternion, this.scale );\r\n\r\n\t\tthis.matrixWorldNeedsUpdate = true;\r\n\r\n\t},\r\n\r\n\tupdateMatrixWorld: function ( force ) {\r\n\r\n\t\tif ( this.matrixAutoUpdate === true ) this.updateMatrix();\r\n\r\n\t\tif ( this.matrixWorldNeedsUpdate === true || force === true ) {\r\n\r\n\t\t\tif ( this.parent === undefined ) {\r\n\r\n\t\t\t\tthis.matrixWorld.copy( this.matrix );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tthis.matrixWorld.multiplyMatrices( this.parent.matrixWorld, this.matrix );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tthis.matrixWorldNeedsUpdate = false;\r\n\r\n\t\t\tforce = true;\r\n\r\n\t\t}\r\n\r\n\t\t// update children\r\n\r\n\t\tfor ( var i = 0, l = this.children.length; i < l; i ++ ) {\r\n\r\n\t\t\tthis.children[ i ].updateMatrixWorld( force );\r\n\r\n\t\t}\r\n\r\n\t},\r\n\r\n\ttoJSON: function () {\r\n\r\n\t\tvar output = {\r\n\t\t\tmetadata: {\r\n\t\t\t\tversion: 4.3,\r\n\t\t\t\ttype: 'Object',\r\n\t\t\t\tgenerator: 'ObjectExporter'\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\t//\r\n\r\n\t\tvar geometries = {};\r\n\r\n\t\tvar parseGeometry = function ( geometry ) {\r\n\r\n\t\t\tif ( output.geometries === undefined ) {\r\n\r\n\t\t\t\toutput.geometries = [];\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( geometries[ geometry.uuid ] === undefined ) {\r\n\r\n\t\t\t\tvar json = geometry.toJSON();\r\n\r\n\t\t\t\tdelete json.metadata;\r\n\r\n\t\t\t\tgeometries[ geometry.uuid ] = json;\r\n\r\n\t\t\t\toutput.geometries.push( json );\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn geometry.uuid;\r\n\r\n\t\t};\r\n\r\n\t\t//\r\n\r\n\t\tvar materials = {};\r\n\r\n\t\tvar parseMaterial = function ( material ) {\r\n\r\n\t\t\tif ( output.materials === undefined ) {\r\n\r\n\t\t\t\toutput.materials = [];\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( materials[ material.uuid ] === undefined ) {\r\n\r\n\t\t\t\tvar json = material.toJSON();\r\n\r\n\t\t\t\tdelete json.metadata;\r\n\r\n\t\t\t\tmaterials[ material.uuid ] = json;\r\n\r\n\t\t\t\toutput.materials.push( json );\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn material.uuid;\r\n\r\n\t\t};\r\n\r\n\t\t//\r\n\r\n\t\tvar parseObject = function ( object ) {\r\n\r\n\t\t\tvar data = {};\r\n\r\n\t\t\tdata.uuid = object.uuid;\r\n\t\t\tdata.type = object.type;\r\n\r\n\t\t\tif ( object.name !== '' ) data.name = object.name;\r\n\t\t\tif ( JSON.stringify( object.userData ) !== '{}' ) data.userData = object.userData;\r\n\t\t\tif ( object.visible !== true ) data.visible = object.visible;\r\n\r\n\t\t\tif ( object instanceof THREE.PerspectiveCamera ) {\r\n\r\n\t\t\t\tdata.fov = object.fov;\r\n\t\t\t\tdata.aspect = object.aspect;\r\n\t\t\t\tdata.near = object.near;\r\n\t\t\t\tdata.far = object.far;\r\n\r\n\t\t\t} else if ( object instanceof THREE.OrthographicCamera ) {\r\n\r\n\t\t\t\tdata.left = object.left;\r\n\t\t\t\tdata.right = object.right;\r\n\t\t\t\tdata.top = object.top;\r\n\t\t\t\tdata.bottom = object.bottom;\r\n\t\t\t\tdata.near = object.near;\r\n\t\t\t\tdata.far = object.far;\r\n\r\n\t\t\t} else if ( object instanceof THREE.AmbientLight ) {\r\n\r\n\t\t\t\tdata.color = object.color.getHex();\r\n\r\n\t\t\t} else if ( object instanceof THREE.DirectionalLight ) {\r\n\r\n\t\t\t\tdata.color = object.color.getHex();\r\n\t\t\t\tdata.intensity = object.intensity;\r\n\r\n\t\t\t} else if ( object instanceof THREE.PointLight ) {\r\n\r\n\t\t\t\tdata.color = object.color.getHex();\r\n\t\t\t\tdata.intensity = object.intensity;\r\n\t\t\t\tdata.distance = object.distance;\r\n\t\t\t\tdata.decay = object.decay;\r\n\r\n\t\t\t} else if ( object instanceof THREE.SpotLight ) {\r\n\r\n\t\t\t\tdata.color = object.color.getHex();\r\n\t\t\t\tdata.intensity = object.intensity;\r\n\t\t\t\tdata.distance = object.distance;\r\n\t\t\t\tdata.angle = object.angle;\r\n\t\t\t\tdata.exponent = object.exponent;\r\n\t\t\t\tdata.decay = object.decay;\r\n\r\n\t\t\t} else if ( object instanceof THREE.HemisphereLight ) {\r\n\r\n\t\t\t\tdata.color = object.color.getHex();\r\n\t\t\t\tdata.groundColor = object.groundColor.getHex();\r\n\r\n\t\t\t} else if ( object instanceof THREE.Mesh || object instanceof THREE.Line || object instanceof THREE.PointCloud ) {\r\n\r\n\t\t\t\tdata.geometry = parseGeometry( object.geometry );\r\n\t\t\t\tdata.material = parseMaterial( object.material );\r\n\r\n\t\t\t\tif ( object instanceof THREE.Line ) data.mode = object.mode;\r\n\r\n\t\t\t} else if ( object instanceof THREE.Sprite ) {\r\n\r\n\t\t\t\tdata.material = parseMaterial( object.material );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tdata.matrix = object.matrix.toArray();\r\n\r\n\t\t\tif ( object.children.length > 0 ) {\r\n\r\n\t\t\t\tdata.children = [];\r\n\r\n\t\t\t\tfor ( var i = 0; i < object.children.length; i ++ ) {\r\n\r\n\t\t\t\t\tdata.children.push( parseObject( object.children[ i ] ) );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn data;\r\n\r\n\t\t}\r\n\r\n\t\toutput.object = parseObject( this );\r\n\r\n\t\treturn output;\r\n\r\n\t},\r\n\r\n\tclone: function ( object, recursive ) {\r\n\r\n\t\tif ( object === undefined ) object = new THREE.Object3D();\r\n\t\tif ( recursive === undefined ) recursive = true;\r\n\r\n\t\tobject.name = this.name;\r\n\r\n\t\tobject.up.copy( this.up );\r\n\r\n\t\tobject.position.copy( this.position );\r\n\t\tobject.quaternion.copy( this.quaternion );\r\n\t\tobject.scale.copy( this.scale );\r\n\r\n\t\tobject.rotationAutoUpdate = this.rotationAutoUpdate;\r\n\r\n\t\tobject.matrix.copy( this.matrix );\r\n\t\tobject.matrixWorld.copy( this.matrixWorld );\r\n\r\n\t\tobject.matrixAutoUpdate = this.matrixAutoUpdate;\r\n\t\tobject.matrixWorldNeedsUpdate = this.matrixWorldNeedsUpdate;\r\n\r\n\t\tobject.visible = this.visible;\r\n\r\n\t\tobject.castShadow = this.castShadow;\r\n\t\tobject.receiveShadow = this.receiveShadow;\r\n\r\n\t\tobject.frustumCulled = this.frustumCulled;\r\n\r\n\t\tobject.userData = JSON.parse( JSON.stringify( this.userData ) );\r\n\r\n\t\tif ( recursive === true ) {\r\n\r\n\t\t\tfor ( var i = 0; i < this.children.length; i ++ ) {\r\n\r\n\t\t\t\tvar child = this.children[ i ];\r\n\t\t\t\tobject.add( child.clone() );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\treturn object;\r\n\r\n\t}\r\n\r\n};\r\n\r\nTHREE.EventDispatcher.prototype.apply( THREE.Object3D.prototype );\r\n\r\nTHREE.Object3DIdCount = 0;\r\n\r\n// File:src/core/Face3.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author alteredq / http://alteredqualia.com/\r\n */\r\n\r\nTHREE.Face3 = function ( a, b, c, normal, color, materialIndex ) {\r\n\r\n\tthis.a = a;\r\n\tthis.b = b;\r\n\tthis.c = c;\r\n\r\n\tthis.normal = normal instanceof THREE.Vector3 ? normal : new THREE.Vector3();\r\n\tthis.vertexNormals = normal instanceof Array ? normal : [];\r\n\r\n\tthis.color = color instanceof THREE.Color ? color : new THREE.Color();\r\n\tthis.vertexColors = color instanceof Array ? color : [];\r\n\r\n\tthis.vertexTangents = [];\r\n\r\n\tthis.materialIndex = materialIndex !== undefined ? materialIndex : 0;\r\n\r\n};\r\n\r\nTHREE.Face3.prototype = {\r\n\r\n\tconstructor: THREE.Face3,\r\n\r\n\tclone: function () {\r\n\r\n\t\tvar face = new THREE.Face3( this.a, this.b, this.c );\r\n\r\n\t\tface.normal.copy( this.normal );\r\n\t\tface.color.copy( this.color );\r\n\r\n\t\tface.materialIndex = this.materialIndex;\r\n\r\n\t\tfor ( var i = 0, il = this.vertexNormals.length; i < il; i ++ ) {\r\n\r\n\t\t\tface.vertexNormals[ i ] = this.vertexNormals[ i ].clone();\r\n\r\n\t\t}\r\n\r\n\t\tfor ( var i = 0, il = this.vertexColors.length; i < il; i ++ ) {\r\n\r\n\t\t\tface.vertexColors[ i ] = this.vertexColors[ i ].clone();\r\n\r\n\t\t}\r\n\r\n\t\tfor ( var i = 0, il = this.vertexTangents.length; i < il; i ++ ) {\r\n\r\n\t\t\tface.vertexTangents[ i ] = this.vertexTangents[ i ].clone();\r\n\r\n\t\t}\r\n\r\n\t\treturn face;\r\n\r\n\t}\r\n\r\n};\r\n\r\n// File:src/core/Face4.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.Face4 = function ( a, b, c, d, normal, color, materialIndex ) {\r\n\r\n\tTHREE.warn( 'THREE.Face4 has been removed. A THREE.Face3 will be created instead.' )\r\n\treturn new THREE.Face3( a, b, c, normal, color, materialIndex );\r\n\r\n};\r\n\r\n// File:src/core/BufferAttribute.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.BufferAttribute = function ( array, itemSize ) {\r\n\r\n\tthis.array = array;\r\n\tthis.itemSize = itemSize;\r\n\r\n\tthis.needsUpdate = false;\r\n\r\n};\r\n\r\nTHREE.BufferAttribute.prototype = {\r\n\r\n\tconstructor: THREE.BufferAttribute,\r\n\r\n\tget length () {\r\n\r\n\t\treturn this.array.length;\r\n\r\n\t},\r\n\r\n\tcopyAt: function ( index1, attribute, index2 ) {\r\n\r\n\t\tindex1 *= this.itemSize;\r\n\t\tindex2 *= attribute.itemSize;\r\n\r\n\t\tfor ( var i = 0, l = this.itemSize; i < l; i ++ ) {\r\n\r\n\t\t\tthis.array[ index1 + i ] = attribute.array[ index2 + i ];\r\n\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tset: function ( value, offset ) {\r\n\r\n\t\tif ( offset === undefined ) offset = 0;\r\n\r\n\t\tthis.array.set( value, offset );\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tsetX: function ( index, x ) {\r\n\r\n\t\tthis.array[ index * this.itemSize ] = x;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tsetY: function ( index, y ) {\r\n\r\n\t\tthis.array[ index * this.itemSize + 1 ] = y;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tsetZ: function ( index, z ) {\r\n\r\n\t\tthis.array[ index * this.itemSize + 2 ] = z;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tsetXY: function ( index, x, y ) {\r\n\r\n\t\tindex *= this.itemSize;\r\n\r\n\t\tthis.array[ index     ] = x;\r\n\t\tthis.array[ index + 1 ] = y;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tsetXYZ: function ( index, x, y, z ) {\r\n\r\n\t\tindex *= this.itemSize;\r\n\r\n\t\tthis.array[ index     ] = x;\r\n\t\tthis.array[ index + 1 ] = y;\r\n\t\tthis.array[ index + 2 ] = z;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tsetXYZW: function ( index, x, y, z, w ) {\r\n\r\n\t\tindex *= this.itemSize;\r\n\r\n\t\tthis.array[ index     ] = x;\r\n\t\tthis.array[ index + 1 ] = y;\r\n\t\tthis.array[ index + 2 ] = z;\r\n\t\tthis.array[ index + 3 ] = w;\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tclone: function () {\r\n\r\n\t\treturn new THREE.BufferAttribute( new this.array.constructor( this.array ), this.itemSize );\r\n\r\n\t}\r\n\r\n};\r\n\r\n//\r\n\r\nTHREE.Int8Attribute = function ( data, itemSize ) {\r\n\r\n\tTHREE.warn( 'THREE.Int8Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead.' );\r\n\treturn new THREE.BufferAttribute( data, itemSize );\r\n\r\n};\r\n\r\nTHREE.Uint8Attribute = function ( data, itemSize ) {\r\n\r\n\tTHREE.warn( 'THREE.Uint8Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead.' );\r\n\treturn new THREE.BufferAttribute( data, itemSize );\r\n\r\n};\r\n\r\nTHREE.Uint8ClampedAttribute = function ( data, itemSize ) {\r\n\r\n\tTHREE.warn( 'THREE.Uint8ClampedAttribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead.' );\r\n\treturn new THREE.BufferAttribute( data, itemSize );\r\n\r\n\r\n};\r\n\r\nTHREE.Int16Attribute = function ( data, itemSize ) {\r\n\r\n\tTHREE.warn( 'THREE.Int16Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead.' );\r\n\treturn new THREE.BufferAttribute( data, itemSize );\r\n\r\n};\r\n\r\nTHREE.Uint16Attribute = function ( data, itemSize ) {\r\n\r\n\tTHREE.warn( 'THREE.Uint16Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead.' );\r\n\treturn new THREE.BufferAttribute( data, itemSize );\r\n\r\n};\r\n\r\nTHREE.Int32Attribute = function ( data, itemSize ) {\r\n\r\n\tTHREE.warn( 'THREE.Int32Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead.' );\r\n\treturn new THREE.BufferAttribute( data, itemSize );\r\n\r\n};\r\n\r\nTHREE.Uint32Attribute = function ( data, itemSize ) {\r\n\r\n\tTHREE.warn( 'THREE.Uint32Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead.' );\r\n\treturn new THREE.BufferAttribute( data, itemSize );\r\n\r\n};\r\n\r\nTHREE.Float32Attribute = function ( data, itemSize ) {\r\n\r\n\tTHREE.warn( 'THREE.Float32Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead.' );\r\n\treturn new THREE.BufferAttribute( data, itemSize );\r\n\r\n};\r\n\r\nTHREE.Float64Attribute = function ( data, itemSize ) {\r\n\r\n\tTHREE.warn( 'THREE.Float64Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead.' );\r\n\treturn new THREE.BufferAttribute( data, itemSize );\r\n\r\n};\r\n\r\n// File:src/core/DynamicBufferAttribute.js\r\n\r\n/**\r\n * @author benaadams / https://twitter.com/ben_a_adams\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.DynamicBufferAttribute = function ( array, itemSize ) {\r\n\r\n\tTHREE.BufferAttribute.call( this, array, itemSize );\r\n\r\n\tthis.updateRange = { offset: 0, count: -1 };\r\n\r\n};\r\n\r\nTHREE.DynamicBufferAttribute.prototype = Object.create( THREE.BufferAttribute.prototype );\r\nTHREE.DynamicBufferAttribute.prototype.constructor = THREE.DynamicBufferAttribute;\r\n\r\nTHREE.DynamicBufferAttribute.prototype.clone = function () {\r\n\r\n\treturn new THREE.DynamicBufferAttribute( new this.array.constructor( this.array ), this.itemSize );\r\n\r\n};\r\n\r\n// File:src/core/BufferGeometry.js\r\n\r\n/**\r\n * @author alteredq / http://alteredqualia.com/\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.BufferGeometry = function () {\r\n\r\n\tObject.defineProperty( this, 'id', { value: THREE.GeometryIdCount ++ } );\r\n\r\n\tthis.uuid = THREE.Math.generateUUID();\r\n\r\n\tthis.name = '';\r\n\tthis.type = 'BufferGeometry';\r\n\r\n\tthis.attributes = {};\r\n\tthis.attributesKeys = [];\r\n\r\n\tthis.drawcalls = [];\r\n\tthis.offsets = this.drawcalls; // backwards compatibility\r\n\r\n\tthis.boundingBox = null;\r\n\tthis.boundingSphere = null;\r\n\r\n};\r\n\r\nTHREE.BufferGeometry.prototype = {\r\n\r\n\tconstructor: THREE.BufferGeometry,\r\n\r\n\taddAttribute: function ( name, attribute ) {\r\n\r\n\t\tif ( attribute instanceof THREE.BufferAttribute === false ) {\r\n\r\n\t\t\tTHREE.warn( 'THREE.BufferGeometry: .addAttribute() now expects ( name, attribute ).' );\r\n\r\n\t\t\tthis.attributes[ name ] = { array: arguments[ 1 ], itemSize: arguments[ 2 ] };\r\n\r\n\t\t\treturn;\r\n\r\n\t\t}\r\n\r\n\t\tthis.attributes[ name ] = attribute;\r\n\t\tthis.attributesKeys = Object.keys( this.attributes );\r\n\r\n\t},\r\n\r\n\tgetAttribute: function ( name ) {\r\n\r\n\t\treturn this.attributes[ name ];\r\n\r\n\t},\r\n\r\n\taddDrawCall: function ( start, count, indexOffset ) {\r\n\r\n\t\tthis.drawcalls.push( {\r\n\r\n\t\t\tstart: start,\r\n\t\t\tcount: count,\r\n\t\t\tindex: indexOffset !== undefined ? indexOffset : 0\r\n\r\n\t\t} );\r\n\r\n\t},\r\n\r\n\tapplyMatrix: function ( matrix ) {\r\n\r\n\t\tvar position = this.attributes.position;\r\n\r\n\t\tif ( position !== undefined ) {\r\n\r\n\t\t\tmatrix.applyToVector3Array( position.array );\r\n\t\t\tposition.needsUpdate = true;\r\n\r\n\t\t}\r\n\r\n\t\tvar normal = this.attributes.normal;\r\n\r\n\t\tif ( normal !== undefined ) {\r\n\r\n\t\t\tvar normalMatrix = new THREE.Matrix3().getNormalMatrix( matrix );\r\n\r\n\t\t\tnormalMatrix.applyToVector3Array( normal.array );\r\n\t\t\tnormal.needsUpdate = true;\r\n\r\n\t\t}\r\n\r\n\t\tif ( this.boundingBox !== null ) {\r\n\r\n\t\t\tthis.computeBoundingBox();\r\n\r\n\t\t}\r\n\r\n\t\tif ( this.boundingSphere !== null ) {\r\n\r\n\t\t\tthis.computeBoundingSphere();\r\n\r\n\t\t}\r\n\r\n\t},\r\n\r\n\tcenter: function () {\r\n\r\n\t\tthis.computeBoundingBox();\r\n\r\n\t\tvar offset = this.boundingBox.center().negate();\r\n\r\n\t\tthis.applyMatrix( new THREE.Matrix4().setPosition( offset ) );\r\n\r\n\t\treturn offset;\r\n\r\n\t},\r\n\r\n\tfromGeometry: function ( geometry, settings ) {\r\n\r\n\t\tsettings = settings || { 'vertexColors': THREE.NoColors };\r\n\r\n\t\tvar vertices = geometry.vertices;\r\n\t\tvar faces = geometry.faces;\r\n\t\tvar faceVertexUvs = geometry.faceVertexUvs;\r\n\t\tvar vertexColors = settings.vertexColors;\r\n\t\tvar hasFaceVertexUv = faceVertexUvs[ 0 ].length > 0;\r\n\t\tvar hasFaceVertexNormals = faces[ 0 ].vertexNormals.length == 3;\r\n\r\n\t\tvar positions = new Float32Array( faces.length * 3 * 3 );\r\n\t\tthis.addAttribute( 'position', new THREE.BufferAttribute( positions, 3 ) );\r\n\r\n\t\tvar normals = new Float32Array( faces.length * 3 * 3 );\r\n\t\tthis.addAttribute( 'normal', new THREE.BufferAttribute( normals, 3 ) );\r\n\r\n\t\tif ( vertexColors !== THREE.NoColors ) {\r\n\r\n\t\t\tvar colors = new Float32Array( faces.length * 3 * 3 );\r\n\t\t\tthis.addAttribute( 'color', new THREE.BufferAttribute( colors, 3 ) );\r\n\r\n\t\t}\r\n\r\n\t\tif ( hasFaceVertexUv === true ) {\r\n\r\n\t\t\tvar uvs = new Float32Array( faces.length * 3 * 2 );\r\n\t\t\tthis.addAttribute( 'uv', new THREE.BufferAttribute( uvs, 2 ) );\r\n\r\n\t\t}\r\n\r\n\t\tfor ( var i = 0, i2 = 0, i3 = 0; i < faces.length; i ++, i2 += 6, i3 += 9 ) {\r\n\r\n\t\t\tvar face = faces[ i ];\r\n\r\n\t\t\tvar a = vertices[ face.a ];\r\n\t\t\tvar b = vertices[ face.b ];\r\n\t\t\tvar c = vertices[ face.c ];\r\n\r\n\t\t\tpositions[ i3     ] = a.x;\r\n\t\t\tpositions[ i3 + 1 ] = a.y;\r\n\t\t\tpositions[ i3 + 2 ] = a.z;\r\n\r\n\t\t\tpositions[ i3 + 3 ] = b.x;\r\n\t\t\tpositions[ i3 + 4 ] = b.y;\r\n\t\t\tpositions[ i3 + 5 ] = b.z;\r\n\r\n\t\t\tpositions[ i3 + 6 ] = c.x;\r\n\t\t\tpositions[ i3 + 7 ] = c.y;\r\n\t\t\tpositions[ i3 + 8 ] = c.z;\r\n\r\n\t\t\tif ( hasFaceVertexNormals === true ) {\r\n\r\n\t\t\t\tvar na = face.vertexNormals[ 0 ];\r\n\t\t\t\tvar nb = face.vertexNormals[ 1 ];\r\n\t\t\t\tvar nc = face.vertexNormals[ 2 ];\r\n\r\n\t\t\t\tnormals[ i3     ] = na.x;\r\n\t\t\t\tnormals[ i3 + 1 ] = na.y;\r\n\t\t\t\tnormals[ i3 + 2 ] = na.z;\r\n\r\n\t\t\t\tnormals[ i3 + 3 ] = nb.x;\r\n\t\t\t\tnormals[ i3 + 4 ] = nb.y;\r\n\t\t\t\tnormals[ i3 + 5 ] = nb.z;\r\n\r\n\t\t\t\tnormals[ i3 + 6 ] = nc.x;\r\n\t\t\t\tnormals[ i3 + 7 ] = nc.y;\r\n\t\t\t\tnormals[ i3 + 8 ] = nc.z;\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tvar n = face.normal;\r\n\r\n\t\t\t\tnormals[ i3     ] = n.x;\r\n\t\t\t\tnormals[ i3 + 1 ] = n.y;\r\n\t\t\t\tnormals[ i3 + 2 ] = n.z;\r\n\r\n\t\t\t\tnormals[ i3 + 3 ] = n.x;\r\n\t\t\t\tnormals[ i3 + 4 ] = n.y;\r\n\t\t\t\tnormals[ i3 + 5 ] = n.z;\r\n\r\n\t\t\t\tnormals[ i3 + 6 ] = n.x;\r\n\t\t\t\tnormals[ i3 + 7 ] = n.y;\r\n\t\t\t\tnormals[ i3 + 8 ] = n.z;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( vertexColors === THREE.FaceColors ) {\r\n\r\n\t\t\t\tvar fc = face.color;\r\n\r\n\t\t\t\tcolors[ i3     ] = fc.r;\r\n\t\t\t\tcolors[ i3 + 1 ] = fc.g;\r\n\t\t\t\tcolors[ i3 + 2 ] = fc.b;\r\n\r\n\t\t\t\tcolors[ i3 + 3 ] = fc.r;\r\n\t\t\t\tcolors[ i3 + 4 ] = fc.g;\r\n\t\t\t\tcolors[ i3 + 5 ] = fc.b;\r\n\r\n\t\t\t\tcolors[ i3 + 6 ] = fc.r;\r\n\t\t\t\tcolors[ i3 + 7 ] = fc.g;\r\n\t\t\t\tcolors[ i3 + 8 ] = fc.b;\r\n\r\n\t\t\t} else if ( vertexColors === THREE.VertexColors ) {\r\n\r\n\t\t\t\tvar vca = face.vertexColors[ 0 ];\r\n\t\t\t\tvar vcb = face.vertexColors[ 1 ];\r\n\t\t\t\tvar vcc = face.vertexColors[ 2 ];\r\n\r\n\t\t\t\tcolors[ i3     ] = vca.r;\r\n\t\t\t\tcolors[ i3 + 1 ] = vca.g;\r\n\t\t\t\tcolors[ i3 + 2 ] = vca.b;\r\n\r\n\t\t\t\tcolors[ i3 + 3 ] = vcb.r;\r\n\t\t\t\tcolors[ i3 + 4 ] = vcb.g;\r\n\t\t\t\tcolors[ i3 + 5 ] = vcb.b;\r\n\r\n\t\t\t\tcolors[ i3 + 6 ] = vcc.r;\r\n\t\t\t\tcolors[ i3 + 7 ] = vcc.g;\r\n\t\t\t\tcolors[ i3 + 8 ] = vcc.b;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( hasFaceVertexUv === true ) {\r\n\r\n\t\t\t\tvar uva = faceVertexUvs[ 0 ][ i ][ 0 ];\r\n\t\t\t\tvar uvb = faceVertexUvs[ 0 ][ i ][ 1 ];\r\n\t\t\t\tvar uvc = faceVertexUvs[ 0 ][ i ][ 2 ];\r\n\r\n\t\t\t\tuvs[ i2     ] = uva.x;\r\n\t\t\t\tuvs[ i2 + 1 ] = uva.y;\r\n\r\n\t\t\t\tuvs[ i2 + 2 ] = uvb.x;\r\n\t\t\t\tuvs[ i2 + 3 ] = uvb.y;\r\n\r\n\t\t\t\tuvs[ i2 + 4 ] = uvc.x;\r\n\t\t\t\tuvs[ i2 + 5 ] = uvc.y;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tthis.computeBoundingSphere()\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tcomputeBoundingBox: function () {\r\n\r\n\t\tvar vector = new THREE.Vector3();\r\n\r\n\t\treturn function () {\r\n\r\n\t\t\tif ( this.boundingBox === null ) {\r\n\r\n\t\t\t\tthis.boundingBox = new THREE.Box3();\r\n\r\n\t\t\t}\r\n\r\n\t\t\tvar positions = this.attributes.position.array;\r\n\r\n\t\t\tif ( positions ) {\r\n\r\n\t\t\t\tvar bb = this.boundingBox;\r\n\t\t\t\tbb.makeEmpty();\r\n\r\n\t\t\t\tfor ( var i = 0, il = positions.length; i < il; i += 3 ) {\r\n\r\n\t\t\t\t\tvector.set( positions[ i ], positions[ i + 1 ], positions[ i + 2 ] );\r\n\t\t\t\t\tbb.expandByPoint( vector );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( positions === undefined || positions.length === 0 ) {\r\n\r\n\t\t\t\tthis.boundingBox.min.set( 0, 0, 0 );\r\n\t\t\t\tthis.boundingBox.max.set( 0, 0, 0 );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( isNaN( this.boundingBox.min.x ) || isNaN( this.boundingBox.min.y ) || isNaN( this.boundingBox.min.z ) ) {\r\n\r\n\t\t\t\tTHREE.error( 'THREE.BufferGeometry.computeBoundingBox: Computed min/max have NaN values. The \"position\" attribute is likely to have NaN values.' );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t}(),\r\n\r\n\tcomputeBoundingSphere: function () {\r\n\r\n\t\tvar box = new THREE.Box3();\r\n\t\tvar vector = new THREE.Vector3();\r\n\r\n\t\treturn function () {\r\n\r\n\t\t\tif ( this.boundingSphere === null ) {\r\n\r\n\t\t\t\tthis.boundingSphere = new THREE.Sphere();\r\n\r\n\t\t\t}\r\n\r\n\t\t\tvar positions = this.attributes.position.array;\r\n\r\n\t\t\tif ( positions ) {\r\n\r\n\t\t\t\tbox.makeEmpty();\r\n\r\n\t\t\t\tvar center = this.boundingSphere.center;\r\n\r\n\t\t\t\tfor ( var i = 0, il = positions.length; i < il; i += 3 ) {\r\n\r\n\t\t\t\t\tvector.set( positions[ i ], positions[ i + 1 ], positions[ i + 2 ] );\r\n\t\t\t\t\tbox.expandByPoint( vector );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tbox.center( center );\r\n\r\n\t\t\t\t// hoping to find a boundingSphere with a radius smaller than the\r\n\t\t\t\t// boundingSphere of the boundingBox:  sqrt(3) smaller in the best case\r\n\r\n\t\t\t\tvar maxRadiusSq = 0;\r\n\r\n\t\t\t\tfor ( var i = 0, il = positions.length; i < il; i += 3 ) {\r\n\r\n\t\t\t\t\tvector.set( positions[ i ], positions[ i + 1 ], positions[ i + 2 ] );\r\n\t\t\t\t\tmaxRadiusSq = Math.max( maxRadiusSq, center.distanceToSquared( vector ) );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis.boundingSphere.radius = Math.sqrt( maxRadiusSq );\r\n\r\n\t\t\t\tif ( isNaN( this.boundingSphere.radius ) ) {\r\n\r\n\t\t\t\t\tTHREE.error( 'THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The \"position\" attribute is likely to have NaN values.' );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t}(),\r\n\r\n\tcomputeFaceNormals: function () {\r\n\r\n\t\t// backwards compatibility\r\n\r\n\t},\r\n\r\n\tcomputeVertexNormals: function () {\r\n\r\n\t\tvar attributes = this.attributes;\r\n\r\n\t\tif ( attributes.position ) {\r\n\r\n\t\t\tvar positions = attributes.position.array;\r\n\r\n\t\t\tif ( attributes.normal === undefined ) {\r\n\r\n\t\t\t\tthis.addAttribute( 'normal', new THREE.BufferAttribute( new Float32Array( positions.length ), 3 ) );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\t// reset existing normals to zero\r\n\r\n\t\t\t\tvar normals = attributes.normal.array;\r\n\r\n\t\t\t\tfor ( var i = 0, il = normals.length; i < il; i ++ ) {\r\n\r\n\t\t\t\t\tnormals[ i ] = 0;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\tvar normals = attributes.normal.array;\r\n\r\n\t\t\tvar vA, vB, vC,\r\n\r\n\t\t\tpA = new THREE.Vector3(),\r\n\t\t\tpB = new THREE.Vector3(),\r\n\t\t\tpC = new THREE.Vector3(),\r\n\r\n\t\t\tcb = new THREE.Vector3(),\r\n\t\t\tab = new THREE.Vector3();\r\n\r\n\t\t\t// indexed elements\r\n\r\n\t\t\tif ( attributes.index ) {\r\n\r\n\t\t\t\tvar indices = attributes.index.array;\r\n\r\n\t\t\t\tvar offsets = ( this.offsets.length > 0 ? this.offsets : [ { start: 0, count: indices.length, index: 0 } ] );\r\n\r\n\t\t\t\tfor ( var j = 0, jl = offsets.length; j < jl; ++ j ) {\r\n\r\n\t\t\t\t\tvar start = offsets[ j ].start;\r\n\t\t\t\t\tvar count = offsets[ j ].count;\r\n\t\t\t\t\tvar index = offsets[ j ].index;\r\n\r\n\t\t\t\t\tfor ( var i = start, il = start + count; i < il; i += 3 ) {\r\n\r\n\t\t\t\t\t\tvA = ( index + indices[ i     ] ) * 3;\r\n\t\t\t\t\t\tvB = ( index + indices[ i + 1 ] ) * 3;\r\n\t\t\t\t\t\tvC = ( index + indices[ i + 2 ] ) * 3;\r\n\r\n\t\t\t\t\t\tpA.fromArray( positions, vA );\r\n\t\t\t\t\t\tpB.fromArray( positions, vB );\r\n\t\t\t\t\t\tpC.fromArray( positions, vC );\r\n\r\n\t\t\t\t\t\tcb.subVectors( pC, pB );\r\n\t\t\t\t\t\tab.subVectors( pA, pB );\r\n\t\t\t\t\t\tcb.cross( ab );\r\n\r\n\t\t\t\t\t\tnormals[ vA     ] += cb.x;\r\n\t\t\t\t\t\tnormals[ vA + 1 ] += cb.y;\r\n\t\t\t\t\t\tnormals[ vA + 2 ] += cb.z;\r\n\r\n\t\t\t\t\t\tnormals[ vB     ] += cb.x;\r\n\t\t\t\t\t\tnormals[ vB + 1 ] += cb.y;\r\n\t\t\t\t\t\tnormals[ vB + 2 ] += cb.z;\r\n\r\n\t\t\t\t\t\tnormals[ vC     ] += cb.x;\r\n\t\t\t\t\t\tnormals[ vC + 1 ] += cb.y;\r\n\t\t\t\t\t\tnormals[ vC + 2 ] += cb.z;\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\t// non-indexed elements (unconnected triangle soup)\r\n\r\n\t\t\t\tfor ( var i = 0, il = positions.length; i < il; i += 9 ) {\r\n\r\n\t\t\t\t\tpA.fromArray( positions, i );\r\n\t\t\t\t\tpB.fromArray( positions, i + 3 );\r\n\t\t\t\t\tpC.fromArray( positions, i + 6 );\r\n\r\n\t\t\t\t\tcb.subVectors( pC, pB );\r\n\t\t\t\t\tab.subVectors( pA, pB );\r\n\t\t\t\t\tcb.cross( ab );\r\n\r\n\t\t\t\t\tnormals[ i     ] = cb.x;\r\n\t\t\t\t\tnormals[ i + 1 ] = cb.y;\r\n\t\t\t\t\tnormals[ i + 2 ] = cb.z;\r\n\r\n\t\t\t\t\tnormals[ i + 3 ] = cb.x;\r\n\t\t\t\t\tnormals[ i + 4 ] = cb.y;\r\n\t\t\t\t\tnormals[ i + 5 ] = cb.z;\r\n\r\n\t\t\t\t\tnormals[ i + 6 ] = cb.x;\r\n\t\t\t\t\tnormals[ i + 7 ] = cb.y;\r\n\t\t\t\t\tnormals[ i + 8 ] = cb.z;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\tthis.normalizeNormals();\r\n\r\n\t\t\tattributes.normal.needsUpdate = true;\r\n\r\n\t\t}\r\n\r\n\t},\r\n\r\n\tcomputeTangents: function () {\r\n\r\n\t\t// based on http://www.terathon.com/code/tangent.html\r\n\t\t// (per vertex tangents)\r\n\r\n\t\tif ( this.attributes.index === undefined ||\r\n\t\t\t this.attributes.position === undefined ||\r\n\t\t\t this.attributes.normal === undefined ||\r\n\t\t\t this.attributes.uv === undefined ) {\r\n\r\n\t\t\tTHREE.warn( 'THREE.BufferGeometry: Missing required attributes (index, position, normal or uv) in BufferGeometry.computeTangents()' );\r\n\t\t\treturn;\r\n\r\n\t\t}\r\n\r\n\t\tvar indices = this.attributes.index.array;\r\n\t\tvar positions = this.attributes.position.array;\r\n\t\tvar normals = this.attributes.normal.array;\r\n\t\tvar uvs = this.attributes.uv.array;\r\n\r\n\t\tvar nVertices = positions.length / 3;\r\n\r\n\t\tif ( this.attributes.tangent === undefined ) {\r\n\r\n\t\t\tthis.addAttribute( 'tangent', new THREE.BufferAttribute( new Float32Array( 4 * nVertices ), 4 ) );\r\n\r\n\t\t}\r\n\r\n\t\tvar tangents = this.attributes.tangent.array;\r\n\r\n\t\tvar tan1 = [], tan2 = [];\r\n\r\n\t\tfor ( var k = 0; k < nVertices; k ++ ) {\r\n\r\n\t\t\ttan1[ k ] = new THREE.Vector3();\r\n\t\t\ttan2[ k ] = new THREE.Vector3();\r\n\r\n\t\t}\r\n\r\n\t\tvar vA = new THREE.Vector3(),\r\n\t\t\tvB = new THREE.Vector3(),\r\n\t\t\tvC = new THREE.Vector3(),\r\n\r\n\t\t\tuvA = new THREE.Vector2(),\r\n\t\t\tuvB = new THREE.Vector2(),\r\n\t\t\tuvC = new THREE.Vector2(),\r\n\r\n\t\t\tx1, x2, y1, y2, z1, z2,\r\n\t\t\ts1, s2, t1, t2, r;\r\n\r\n\t\tvar sdir = new THREE.Vector3(), tdir = new THREE.Vector3();\r\n\r\n\t\tfunction handleTriangle( a, b, c ) {\r\n\r\n\t\t\tvA.fromArray( positions, a * 3 );\r\n\t\t\tvB.fromArray( positions, b * 3 );\r\n\t\t\tvC.fromArray( positions, c * 3 );\r\n\r\n\t\t\tuvA.fromArray( uvs, a * 2 );\r\n\t\t\tuvB.fromArray( uvs, b * 2 );\r\n\t\t\tuvC.fromArray( uvs, c * 2 );\r\n\r\n\t\t\tx1 = vB.x - vA.x;\r\n\t\t\tx2 = vC.x - vA.x;\r\n\r\n\t\t\ty1 = vB.y - vA.y;\r\n\t\t\ty2 = vC.y - vA.y;\r\n\r\n\t\t\tz1 = vB.z - vA.z;\r\n\t\t\tz2 = vC.z - vA.z;\r\n\r\n\t\t\ts1 = uvB.x - uvA.x;\r\n\t\t\ts2 = uvC.x - uvA.x;\r\n\r\n\t\t\tt1 = uvB.y - uvA.y;\r\n\t\t\tt2 = uvC.y - uvA.y;\r\n\r\n\t\t\tr = 1.0 / ( s1 * t2 - s2 * t1 );\r\n\r\n\t\t\tsdir.set(\r\n\t\t\t\t( t2 * x1 - t1 * x2 ) * r,\r\n\t\t\t\t( t2 * y1 - t1 * y2 ) * r,\r\n\t\t\t\t( t2 * z1 - t1 * z2 ) * r\r\n\t\t\t);\r\n\r\n\t\t\ttdir.set(\r\n\t\t\t\t( s1 * x2 - s2 * x1 ) * r,\r\n\t\t\t\t( s1 * y2 - s2 * y1 ) * r,\r\n\t\t\t\t( s1 * z2 - s2 * z1 ) * r\r\n\t\t\t);\r\n\r\n\t\t\ttan1[ a ].add( sdir );\r\n\t\t\ttan1[ b ].add( sdir );\r\n\t\t\ttan1[ c ].add( sdir );\r\n\r\n\t\t\ttan2[ a ].add( tdir );\r\n\t\t\ttan2[ b ].add( tdir );\r\n\t\t\ttan2[ c ].add( tdir );\r\n\r\n\t\t}\r\n\r\n\t\tvar i, il;\r\n\t\tvar j, jl;\r\n\t\tvar iA, iB, iC;\r\n\r\n\t\tif ( this.drawcalls.length === 0 ) {\r\n\r\n\t\t\tthis.addDrawCall( 0, indices.length, 0 );\r\n\r\n\t\t}\r\n\r\n\t\tvar drawcalls = this.drawcalls;\r\n\r\n\t\tfor ( j = 0, jl = drawcalls.length; j < jl; ++ j ) {\r\n\r\n\t\t\tvar start = drawcalls[ j ].start;\r\n\t\t\tvar count = drawcalls[ j ].count;\r\n\t\t\tvar index = drawcalls[ j ].index;\r\n\r\n\t\t\tfor ( i = start, il = start + count; i < il; i += 3 ) {\r\n\r\n\t\t\t\tiA = index + indices[ i ];\r\n\t\t\t\tiB = index + indices[ i + 1 ];\r\n\t\t\t\tiC = index + indices[ i + 2 ];\r\n\r\n\t\t\t\thandleTriangle( iA, iB, iC );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tvar tmp = new THREE.Vector3(), tmp2 = new THREE.Vector3();\r\n\t\tvar n = new THREE.Vector3(), n2 = new THREE.Vector3();\r\n\t\tvar w, t, test;\r\n\r\n\t\tfunction handleVertex( v ) {\r\n\r\n\t\t\tn.fromArray( normals, v * 3 );\r\n\t\t\tn2.copy( n );\r\n\r\n\t\t\tt = tan1[ v ];\r\n\r\n\t\t\t// Gram-Schmidt orthogonalize\r\n\r\n\t\t\ttmp.copy( t );\r\n\t\t\ttmp.sub( n.multiplyScalar( n.dot( t ) ) ).normalize();\r\n\r\n\t\t\t// Calculate handedness\r\n\r\n\t\t\ttmp2.crossVectors( n2, t );\r\n\t\t\ttest = tmp2.dot( tan2[ v ] );\r\n\t\t\tw = ( test < 0.0 ) ? - 1.0 : 1.0;\r\n\r\n\t\t\ttangents[ v * 4     ] = tmp.x;\r\n\t\t\ttangents[ v * 4 + 1 ] = tmp.y;\r\n\t\t\ttangents[ v * 4 + 2 ] = tmp.z;\r\n\t\t\ttangents[ v * 4 + 3 ] = w;\r\n\r\n\t\t}\r\n\r\n\t\tfor ( j = 0, jl = drawcalls.length; j < jl; ++ j ) {\r\n\r\n\t\t\tvar start = drawcalls[ j ].start;\r\n\t\t\tvar count = drawcalls[ j ].count;\r\n\t\t\tvar index = drawcalls[ j ].index;\r\n\r\n\t\t\tfor ( i = start, il = start + count; i < il; i += 3 ) {\r\n\r\n\t\t\t\tiA = index + indices[ i ];\r\n\t\t\t\tiB = index + indices[ i + 1 ];\r\n\t\t\t\tiC = index + indices[ i + 2 ];\r\n\r\n\t\t\t\thandleVertex( iA );\r\n\t\t\t\thandleVertex( iB );\r\n\t\t\t\thandleVertex( iC );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t},\r\n\r\n\t/*\r\n\tCompute the draw offset for large models by chunking the index buffer into chunks of 65k addressable vertices.\r\n\tThis method will effectively rewrite the index buffer and remap all attributes to match the new indices.\r\n\tWARNING: This method will also expand the vertex count to prevent sprawled triangles across draw offsets.\r\n\tsize - Defaults to 65535, but allows for larger or smaller chunks.\r\n\t*/\r\n\tcomputeOffsets: function ( size ) {\r\n\r\n\t\tif ( size === undefined ) size = 65535; // WebGL limits type of index buffer values to 16-bit.\r\n\r\n\t\tvar indices = this.attributes.index.array;\r\n\t\tvar vertices = this.attributes.position.array;\r\n\r\n\t\tvar facesCount = ( indices.length / 3 );\r\n\r\n\t\t/*\r\n\t\tconsole.log(\"Computing buffers in offsets of \"+size+\" -> indices:\"+indices.length+\" vertices:\"+vertices.length);\r\n\t\tconsole.log(\"Faces to process: \"+(indices.length/3));\r\n\t\tconsole.log(\"Reordering \"+verticesCount+\" vertices.\");\r\n\t\t*/\r\n\r\n\t\tvar sortedIndices = new Uint16Array( indices.length ); //16-bit buffers\r\n\t\tvar indexPtr = 0;\r\n\t\tvar vertexPtr = 0;\r\n\r\n\t\tvar offsets = [ { start:0, count:0, index:0 } ];\r\n\t\tvar offset = offsets[ 0 ];\r\n\r\n\t\tvar duplicatedVertices = 0;\r\n\t\tvar newVerticeMaps = 0;\r\n\t\tvar faceVertices = new Int32Array( 6 );\r\n\t\tvar vertexMap = new Int32Array( vertices.length );\r\n\t\tvar revVertexMap = new Int32Array( vertices.length );\r\n\t\tfor ( var j = 0; j < vertices.length; j ++ ) { vertexMap[ j ] = - 1; revVertexMap[ j ] = - 1; }\r\n\r\n\t\t/*\r\n\t\t\tTraverse every face and reorder vertices in the proper offsets of 65k.\r\n\t\t\tWe can have more than 65k entries in the index buffer per offset, but only reference 65k values.\r\n\t\t*/\r\n\t\tfor ( var findex = 0; findex < facesCount; findex ++ ) {\r\n\t\t\tnewVerticeMaps = 0;\r\n\r\n\t\t\tfor ( var vo = 0; vo < 3; vo ++ ) {\r\n\t\t\t\tvar vid = indices[ findex * 3 + vo ];\r\n\t\t\t\tif ( vertexMap[ vid ] == - 1 ) {\r\n\t\t\t\t\t//Unmapped vertice\r\n\t\t\t\t\tfaceVertices[ vo * 2 ] = vid;\r\n\t\t\t\t\tfaceVertices[ vo * 2 + 1 ] = - 1;\r\n\t\t\t\t\tnewVerticeMaps ++;\r\n\t\t\t\t} else if ( vertexMap[ vid ] < offset.index ) {\r\n\t\t\t\t\t//Reused vertices from previous block (duplicate)\r\n\t\t\t\t\tfaceVertices[ vo * 2 ] = vid;\r\n\t\t\t\t\tfaceVertices[ vo * 2 + 1 ] = - 1;\r\n\t\t\t\t\tduplicatedVertices ++;\r\n\t\t\t\t} else {\r\n\t\t\t\t\t//Reused vertice in the current block\r\n\t\t\t\t\tfaceVertices[ vo * 2 ] = vid;\r\n\t\t\t\t\tfaceVertices[ vo * 2 + 1 ] = vertexMap[ vid ];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tvar faceMax = vertexPtr + newVerticeMaps;\r\n\t\t\tif ( faceMax > ( offset.index + size ) ) {\r\n\t\t\t\tvar new_offset = { start:indexPtr, count:0, index:vertexPtr };\r\n\t\t\t\toffsets.push( new_offset );\r\n\t\t\t\toffset = new_offset;\r\n\r\n\t\t\t\t//Re-evaluate reused vertices in light of new offset.\r\n\t\t\t\tfor ( var v = 0; v < 6; v += 2 ) {\r\n\t\t\t\t\tvar new_vid = faceVertices[ v + 1 ];\r\n\t\t\t\t\tif ( new_vid > - 1 && new_vid < offset.index )\r\n\t\t\t\t\t\tfaceVertices[ v + 1 ] = - 1;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t//Reindex the face.\r\n\t\t\tfor ( var v = 0; v < 6; v += 2 ) {\r\n\t\t\t\tvar vid = faceVertices[ v ];\r\n\t\t\t\tvar new_vid = faceVertices[ v + 1 ];\r\n\r\n\t\t\t\tif ( new_vid === - 1 )\r\n\t\t\t\t\tnew_vid = vertexPtr ++;\r\n\r\n\t\t\t\tvertexMap[ vid ] = new_vid;\r\n\t\t\t\trevVertexMap[ new_vid ] = vid;\r\n\t\t\t\tsortedIndices[ indexPtr ++ ] = new_vid - offset.index; //XXX overflows at 16bit\r\n\t\t\t\toffset.count ++;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t/* Move all attribute values to map to the new computed indices , also expand the vertice stack to match our new vertexPtr. */\r\n\t\tthis.reorderBuffers( sortedIndices, revVertexMap, vertexPtr );\r\n\t\tthis.offsets = offsets; // TODO: Deprecate\r\n\t\tthis.drawcalls = offsets;\r\n\r\n\t\t/*\r\n\t\tvar orderTime = Date.now();\r\n\t\tconsole.log(\"Reorder time: \"+(orderTime-s)+\"ms\");\r\n\t\tconsole.log(\"Duplicated \"+duplicatedVertices+\" vertices.\");\r\n\t\tconsole.log(\"Compute Buffers time: \"+(Date.now()-s)+\"ms\");\r\n\t\tconsole.log(\"Draw offsets: \"+offsets.length);\r\n\t\t*/\r\n\r\n\t\treturn offsets;\r\n\r\n\t},\r\n\r\n\tmerge: function ( geometry, offset ) {\r\n\r\n\t\tif ( geometry instanceof THREE.BufferGeometry === false ) {\r\n\r\n\t\t\tTHREE.error( 'THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.', geometry );\r\n\t\t\treturn;\r\n\r\n\t\t}\r\n\r\n\t\tif ( offset === undefined ) offset = 0;\r\n\r\n\t\tvar attributes = this.attributes;\r\n\r\n\t\tfor ( var key in attributes ) {\r\n\r\n\t\t\tif ( geometry.attributes[ key ] === undefined ) continue;\r\n\r\n\t\t\tvar attribute1 = attributes[ key ];\r\n\t\t\tvar attributeArray1 = attribute1.array;\r\n\r\n\t\t\tvar attribute2 = geometry.attributes[ key ];\r\n\t\t\tvar attributeArray2 = attribute2.array;\r\n\r\n\t\t\tvar attributeSize = attribute2.itemSize;\r\n\r\n\t\t\tfor ( var i = 0, j = attributeSize * offset; i < attributeArray2.length; i ++, j ++ ) {\r\n\r\n\t\t\t\tattributeArray1[ j ] = attributeArray2[ i ];\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tnormalizeNormals: function () {\r\n\r\n\t\tvar normals = this.attributes.normal.array;\r\n\r\n\t\tvar x, y, z, n;\r\n\r\n\t\tfor ( var i = 0, il = normals.length; i < il; i += 3 ) {\r\n\r\n\t\t\tx = normals[ i ];\r\n\t\t\ty = normals[ i + 1 ];\r\n\t\t\tz = normals[ i + 2 ];\r\n\r\n\t\t\tn = 1.0 / Math.sqrt( x * x + y * y + z * z );\r\n\r\n\t\t\tnormals[ i     ] *= n;\r\n\t\t\tnormals[ i + 1 ] *= n;\r\n\t\t\tnormals[ i + 2 ] *= n;\r\n\r\n\t\t}\r\n\r\n\t},\r\n\r\n\t/*\r\n\t\treoderBuffers:\r\n\t\tReorder attributes based on a new indexBuffer and indexMap.\r\n\t\tindexBuffer - Uint16Array of the new ordered indices.\r\n\t\tindexMap - Int32Array where the position is the new vertex ID and the value the old vertex ID for each vertex.\r\n\t\tvertexCount - Amount of total vertices considered in this reordering (in case you want to grow the vertice stack).\r\n\t*/\r\n\treorderBuffers: function ( indexBuffer, indexMap, vertexCount ) {\r\n\r\n\t\t/* Create a copy of all attributes for reordering. */\r\n\t\tvar sortedAttributes = {};\r\n\t\tfor ( var attr in this.attributes ) {\r\n\t\t\tif ( attr == 'index' )\r\n\t\t\t\tcontinue;\r\n\t\t\tvar sourceArray = this.attributes[ attr ].array;\r\n\t\t\tsortedAttributes[ attr ] = new sourceArray.constructor( this.attributes[ attr ].itemSize * vertexCount );\r\n\t\t}\r\n\r\n\t\t/* Move attribute positions based on the new index map */\r\n\t\tfor ( var new_vid = 0; new_vid < vertexCount; new_vid ++ ) {\r\n\t\t\tvar vid = indexMap[ new_vid ];\r\n\t\t\tfor ( var attr in this.attributes ) {\r\n\t\t\t\tif ( attr == 'index' )\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\tvar attrArray = this.attributes[ attr ].array;\r\n\t\t\t\tvar attrSize = this.attributes[ attr ].itemSize;\r\n\t\t\t\tvar sortedAttr = sortedAttributes[ attr ];\r\n\t\t\t\tfor ( var k = 0; k < attrSize; k ++ )\r\n\t\t\t\t\tsortedAttr[ new_vid * attrSize + k ] = attrArray[ vid * attrSize + k ];\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t/* Carry the new sorted buffers locally */\r\n\t\tthis.attributes[ 'index' ].array = indexBuffer;\r\n\t\tfor ( var attr in this.attributes ) {\r\n\t\t\tif ( attr == 'index' )\r\n\t\t\t\tcontinue;\r\n\t\t\tthis.attributes[ attr ].array = sortedAttributes[ attr ];\r\n\t\t\tthis.attributes[ attr ].numItems = this.attributes[ attr ].itemSize * vertexCount;\r\n\t\t}\r\n\t},\r\n\r\n\ttoJSON: function () {\r\n\r\n\t\tvar output = {\r\n\t\t\tmetadata: {\r\n\t\t\t\tversion: 4.0,\r\n\t\t\t\ttype: 'BufferGeometry',\r\n\t\t\t\tgenerator: 'BufferGeometryExporter'\r\n\t\t\t},\r\n\t\t\tuuid: this.uuid,\r\n\t\t\ttype: this.type,\r\n\t\t\tdata: {\r\n\t\t\t\tattributes: {}\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tvar attributes = this.attributes;\r\n\t\tvar offsets = this.offsets;\r\n\t\tvar boundingSphere = this.boundingSphere;\r\n\r\n\t\tfor ( var key in attributes ) {\r\n\r\n\t\t\tvar attribute = attributes[ key ];\r\n\r\n\t\t\tvar array = Array.prototype.slice.call( attribute.array );\r\n\r\n\t\t\toutput.data.attributes[ key ] = {\r\n\t\t\t\titemSize: attribute.itemSize,\r\n\t\t\t\ttype: attribute.array.constructor.name,\r\n\t\t\t\tarray: array\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tif ( offsets.length > 0 ) {\r\n\r\n\t\t\toutput.data.offsets = JSON.parse( JSON.stringify( offsets ) );\r\n\r\n\t\t}\r\n\r\n\t\tif ( boundingSphere !== null ) {\r\n\r\n\t\t\toutput.data.boundingSphere = {\r\n\t\t\t\tcenter: boundingSphere.center.toArray(),\r\n\t\t\t\tradius: boundingSphere.radius\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\treturn output;\r\n\r\n\t},\r\n\r\n\tclone: function () {\r\n\r\n\t\tvar geometry = new THREE.BufferGeometry();\r\n\r\n\t\tfor ( var attr in this.attributes ) {\r\n\r\n\t\t\tvar sourceAttr = this.attributes[ attr ];\r\n\t\t\tgeometry.addAttribute( attr, sourceAttr.clone() );\r\n\r\n\t\t}\r\n\r\n\t\tfor ( var i = 0, il = this.offsets.length; i < il; i ++ ) {\r\n\r\n\t\t\tvar offset = this.offsets[ i ];\r\n\r\n\t\t\tgeometry.offsets.push( {\r\n\r\n\t\t\t\tstart: offset.start,\r\n\t\t\t\tindex: offset.index,\r\n\t\t\t\tcount: offset.count\r\n\r\n\t\t\t} );\r\n\r\n\t\t}\r\n\r\n\t\treturn geometry;\r\n\r\n\t},\r\n\r\n\tdispose: function () {\r\n\r\n\t\tthis.dispatchEvent( { type: 'dispose' } );\r\n\r\n\t}\r\n\r\n};\r\n\r\nTHREE.EventDispatcher.prototype.apply( THREE.BufferGeometry.prototype );\r\n\r\n// File:src/core/Geometry.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author kile / http://kile.stravaganza.org/\r\n * @author alteredq / http://alteredqualia.com/\r\n * @author mikael emtinger / http://gomo.se/\r\n * @author zz85 / http://www.lab4games.net/zz85/blog\r\n * @author bhouston / http://exocortex.com\r\n */\r\n\r\nTHREE.Geometry = function () {\r\n\r\n\tObject.defineProperty( this, 'id', { value: THREE.GeometryIdCount ++ } );\r\n\r\n\tthis.uuid = THREE.Math.generateUUID();\r\n\r\n\tthis.name = '';\r\n\tthis.type = 'Geometry';\r\n\r\n\tthis.vertices = [];\r\n\tthis.colors = [];  // one-to-one vertex colors, used in Points and Line\r\n\r\n\tthis.faces = [];\r\n\r\n\tthis.faceVertexUvs = [ [] ];\r\n\r\n\tthis.morphTargets = [];\r\n\tthis.morphColors = [];\r\n\tthis.morphNormals = [];\r\n\r\n\tthis.skinWeights = [];\r\n\tthis.skinIndices = [];\r\n\r\n\tthis.lineDistances = [];\r\n\r\n\tthis.boundingBox = null;\r\n\tthis.boundingSphere = null;\r\n\r\n\tthis.hasTangents = false;\r\n\r\n\tthis.dynamic = true; // the intermediate typed arrays will be deleted when set to false\r\n\r\n\t// update flags\r\n\r\n\tthis.verticesNeedUpdate = false;\r\n\tthis.elementsNeedUpdate = false;\r\n\tthis.uvsNeedUpdate = false;\r\n\tthis.normalsNeedUpdate = false;\r\n\tthis.tangentsNeedUpdate = false;\r\n\tthis.colorsNeedUpdate = false;\r\n\tthis.lineDistancesNeedUpdate = false;\r\n\r\n\tthis.groupsNeedUpdate = false;\r\n\r\n};\r\n\r\nTHREE.Geometry.prototype = {\r\n\r\n\tconstructor: THREE.Geometry,\r\n\r\n\tapplyMatrix: function ( matrix ) {\r\n\r\n\t\tvar normalMatrix = new THREE.Matrix3().getNormalMatrix( matrix );\r\n\r\n\t\tfor ( var i = 0, il = this.vertices.length; i < il; i ++ ) {\r\n\r\n\t\t\tvar vertex = this.vertices[ i ];\r\n\t\t\tvertex.applyMatrix4( matrix );\r\n\r\n\t\t}\r\n\r\n\t\tfor ( var i = 0, il = this.faces.length; i < il; i ++ ) {\r\n\r\n\t\t\tvar face = this.faces[ i ];\r\n\t\t\tface.normal.applyMatrix3( normalMatrix ).normalize();\r\n\r\n\t\t\tfor ( var j = 0, jl = face.vertexNormals.length; j < jl; j ++ ) {\r\n\r\n\t\t\t\tface.vertexNormals[ j ].applyMatrix3( normalMatrix ).normalize();\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tif ( this.boundingBox !== null ) {\r\n\r\n\t\t\tthis.computeBoundingBox();\r\n\r\n\t\t}\r\n\r\n\t\tif ( this.boundingSphere !== null ) {\r\n\r\n\t\t\tthis.computeBoundingSphere();\r\n\r\n\t\t}\r\n\r\n\t\tthis.verticesNeedUpdate = true;\r\n\t\tthis.normalsNeedUpdate = true;\r\n\r\n\t},\r\n\r\n\tfromBufferGeometry: function ( geometry ) {\r\n\r\n\t\tvar scope = this;\r\n\r\n\t\tvar attributes = geometry.attributes;\r\n\r\n\t\tvar vertices = attributes.position.array;\r\n\t\tvar indices = attributes.index !== undefined ? attributes.index.array : undefined;\r\n\t\tvar normals = attributes.normal !== undefined ? attributes.normal.array : undefined;\r\n\t\tvar colors = attributes.color !== undefined ? attributes.color.array : undefined;\r\n\t\tvar uvs = attributes.uv !== undefined ? attributes.uv.array : undefined;\r\n\r\n\t\tvar tempNormals = [];\r\n\t\tvar tempUVs = [];\r\n\r\n\t\tfor ( var i = 0, j = 0; i < vertices.length; i += 3, j += 2 ) {\r\n\r\n\t\t\tscope.vertices.push( new THREE.Vector3( vertices[ i ], vertices[ i + 1 ], vertices[ i + 2 ] ) );\r\n\r\n\t\t\tif ( normals !== undefined ) {\r\n\r\n\t\t\t\ttempNormals.push( new THREE.Vector3( normals[ i ], normals[ i + 1 ], normals[ i + 2 ] ) );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( colors !== undefined ) {\r\n\r\n\t\t\t\tscope.colors.push( new THREE.Color( colors[ i ], colors[ i + 1 ], colors[ i + 2 ] ) );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( uvs !== undefined ) {\r\n\r\n\t\t\t\ttempUVs.push( new THREE.Vector2( uvs[ j ], uvs[ j + 1 ] ) );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tvar addFace = function ( a, b, c ) {\r\n\r\n\t\t\tvar vertexNormals = normals !== undefined ? [ tempNormals[ a ].clone(), tempNormals[ b ].clone(), tempNormals[ c ].clone() ] : [];\r\n\t\t\tvar vertexColors = colors !== undefined ? [ scope.colors[ a ].clone(), scope.colors[ b ].clone(), scope.colors[ c ].clone() ] : [];\r\n\r\n\t\t\tscope.faces.push( new THREE.Face3( a, b, c, vertexNormals, vertexColors ) );\r\n\r\n\t\t\tif ( uvs !== undefined ) {\r\n\r\n\t\t\t\tscope.faceVertexUvs[ 0 ].push( [ tempUVs[ a ].clone(), tempUVs[ b ].clone(), tempUVs[ c ].clone() ] );\r\n\r\n\t\t\t}\r\n\r\n\t\t};\r\n\r\n\t\tif ( indices !== undefined ) {\r\n\r\n\t\t\tvar drawcalls = geometry.drawcalls;\r\n\r\n\t\t\tif ( drawcalls.length > 0 ) {\r\n\r\n\t\t\t\tfor ( var i = 0; i < drawcalls.length; i ++ ) {\r\n\r\n\t\t\t\t\tvar drawcall = drawcalls[ i ];\r\n\r\n\t\t\t\t\tvar start = drawcall.start;\r\n\t\t\t\t\tvar count = drawcall.count;\r\n\t\t\t\t\tvar index = drawcall.index;\r\n\r\n\t\t\t\t\tfor ( var j = start, jl = start + count; j < jl; j += 3 ) {\r\n\r\n\t\t\t\t\t\taddFace( index + indices[ j ], index + indices[ j + 1 ], index + indices[ j + 2 ] );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tfor ( var i = 0; i < indices.length; i += 3 ) {\r\n\r\n\t\t\t\t\taddFace( indices[ i ], indices[ i + 1 ], indices[ i + 2 ] );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t} else {\r\n\r\n\t\t\tfor ( var i = 0; i < vertices.length / 3; i += 3 ) {\r\n\r\n\t\t\t\taddFace( i, i + 1, i + 2 );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tthis.computeFaceNormals();\r\n\r\n\t\tif ( geometry.boundingBox !== null ) {\r\n\r\n\t\t\tthis.boundingBox = geometry.boundingBox.clone();\r\n\r\n\t\t}\r\n\r\n\t\tif ( geometry.boundingSphere !== null ) {\r\n\r\n\t\t\tthis.boundingSphere = geometry.boundingSphere.clone();\r\n\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\r\n\t},\r\n\r\n\tcenter: function () {\r\n\r\n\t\tthis.computeBoundingBox();\r\n\r\n\t\tvar offset = this.boundingBox.center().negate();\r\n\r\n\t\tthis.applyMatrix( new THREE.Matrix4().setPosition( offset ) );\r\n\r\n\t\treturn offset;\r\n\r\n\t},\r\n\r\n\tcomputeFaceNormals: function () {\r\n\r\n\t\tvar cb = new THREE.Vector3(), ab = new THREE.Vector3();\r\n\r\n\t\tfor ( var f = 0, fl = this.faces.length; f < fl; f ++ ) {\r\n\r\n\t\t\tvar face = this.faces[ f ];\r\n\r\n\t\t\tvar vA = this.vertices[ face.a ];\r\n\t\t\tvar vB = this.vertices[ face.b ];\r\n\t\t\tvar vC = this.vertices[ face.c ];\r\n\r\n\t\t\tcb.subVectors( vC, vB );\r\n\t\t\tab.subVectors( vA, vB );\r\n\t\t\tcb.cross( ab );\r\n\r\n\t\t\tcb.normalize();\r\n\r\n\t\t\tface.normal.copy( cb );\r\n\r\n\t\t}\r\n\r\n\t},\r\n\r\n\tcomputeVertexNormals: function ( areaWeighted ) {\r\n\r\n\t\tvar v, vl, f, fl, face, vertices;\r\n\r\n\t\tvertices = new Array( this.vertices.length );\r\n\r\n\t\tfor ( v = 0, vl = this.vertices.length; v < vl; v ++ ) {\r\n\r\n\t\t\tvertices[ v ] = new THREE.Vector3();\r\n\r\n\t\t}\r\n\r\n\t\tif ( areaWeighted ) {\r\n\r\n\t\t\t// vertex normals weighted by triangle areas\r\n\t\t\t// http://www.iquilezles.org/www/articles/normals/normals.htm\r\n\r\n\t\t\tvar vA, vB, vC;\r\n\t\t\tvar cb = new THREE.Vector3(), ab = new THREE.Vector3();\r\n\r\n\t\t\tfor ( f = 0, fl = this.faces.length; f < fl; f ++ ) {\r\n\r\n\t\t\t\tface = this.faces[ f ];\r\n\r\n\t\t\t\tvA = this.vertices[ face.a ];\r\n\t\t\t\tvB = this.vertices[ face.b ];\r\n\t\t\t\tvC = this.vertices[ face.c ];\r\n\r\n\t\t\t\tcb.subVectors( vC, vB );\r\n\t\t\t\tab.subVectors( vA, vB );\r\n\t\t\t\tcb.cross( ab );\r\n\r\n\t\t\t\tvertices[ face.a ].add( cb );\r\n\t\t\t\tvertices[ face.b ].add( cb );\r\n\t\t\t\tvertices[ face.c ].add( cb );\r\n\r\n\t\t\t}\r\n\r\n\t\t} else {\r\n\r\n\t\t\tfor ( f = 0, fl = this.faces.length; f < fl; f ++ ) {\r\n\r\n\t\t\t\tface = this.faces[ f ];\r\n\r\n\t\t\t\tvertices[ face.a ].add( face.normal );\r\n\t\t\t\tvertices[ face.b ].add( face.normal );\r\n\t\t\t\tvertices[ face.c ].add( face.normal );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tfor ( v = 0, vl = this.vertices.length; v < vl; v ++ ) {\r\n\r\n\t\t\tvertices[ v ].normalize();\r\n\r\n\t\t}\r\n\r\n\t\tfor ( f = 0, fl = this.faces.length; f < fl; f ++ ) {\r\n\r\n\t\t\tface = this.faces[ f ];\r\n\r\n\t\t\tface.vertexNormals[ 0 ] = vertices[ face.a ].clone();\r\n\t\t\tface.vertexNormals[ 1 ] = vertices[ face.b ].clone();\r\n\t\t\tface.vertexNormals[ 2 ] = vertices[ face.c ].clone();\r\n\r\n\t\t}\r\n\r\n\t},\r\n\r\n\tcomputeMorphNormals: function () {\r\n\r\n\t\tvar i, il, f, fl, face;\r\n\r\n\t\t// save original normals\r\n\t\t// - create temp variables on first access\r\n\t\t//   otherwise just copy (for faster repeated calls)\r\n\r\n\t\tfor ( f = 0, fl = this.faces.length; f < fl; f ++ ) {\r\n\r\n\t\t\tface = this.faces[ f ];\r\n\r\n\t\t\tif ( ! face.__originalFaceNormal ) {\r\n\r\n\t\t\t\tface.__originalFaceNormal = face.normal.clone();\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tface.__originalFaceNormal.copy( face.normal );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( ! face.__originalVertexNormals ) face.__originalVertexNormals = [];\r\n\r\n\t\t\tfor ( i = 0, il = face.vertexNormals.length; i < il; i ++ ) {\r\n\r\n\t\t\t\tif ( ! face.__originalVertexNormals[ i ] ) {\r\n\r\n\t\t\t\t\tface.__originalVertexNormals[ i ] = face.vertexNormals[ i ].clone();\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\tface.__originalVertexNormals[ i ].copy( face.vertexNormals[ i ] );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\t// use temp geometry to compute face and vertex normals for each morph\r\n\r\n\t\tvar tmpGeo = new THREE.Geometry();\r\n\t\ttmpGeo.faces = this.faces;\r\n\r\n\t\tfor ( i = 0, il = this.morphTargets.length; i < il; i ++ ) {\r\n\r\n\t\t\t// create on first access\r\n\r\n\t\t\tif ( ! this.morphNormals[ i ] ) {\r\n\r\n\t\t\t\tthis.morphNormals[ i ] = {};\r\n\t\t\t\tthis.morphNormals[ i ].faceNormals = [];\r\n\t\t\t\tthis.morphNormals[ i ].vertexNormals = [];\r\n\r\n\t\t\t\tvar dstNormalsFace = this.morphNormals[ i ].faceNormals;\r\n\t\t\t\tvar dstNormalsVertex = this.morphNormals[ i ].vertexNormals;\r\n\r\n\t\t\t\tvar faceNormal, vertexNormals;\r\n\r\n\t\t\t\tfor ( f = 0, fl = this.faces.length; f < fl; f ++ ) {\r\n\r\n\t\t\t\t\tfaceNormal = new THREE.Vector3();\r\n\t\t\t\t\tvertexNormals = { a: new THREE.Vector3(), b: new THREE.Vector3(), c: new THREE.Vector3() };\r\n\r\n\t\t\t\t\tdstNormalsFace.push( faceNormal );\r\n\t\t\t\t\tdstNormalsVertex.push( vertexNormals );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\tvar morphNormals = this.morphNormals[ i ];\r\n\r\n\t\t\t// set vertices to morph target\r\n\r\n\t\t\ttmpGeo.vertices = this.morphTargets[ i ].vertices;\r\n\r\n\t\t\t// compute morph normals\r\n\r\n\t\t\ttmpGeo.computeFaceNormals();\r\n\t\t\ttmpGeo.computeVertexNormals();\r\n\r\n\t\t\t// store morph normals\r\n\r\n\t\t\tvar faceNormal, vertexNormals;\r\n\r\n\t\t\tfor ( f = 0, fl = this.faces.length; f < fl; f ++ ) {\r\n\r\n\t\t\t\tface = this.faces[ f ];\r\n\r\n\t\t\t\tfaceNormal = morphNormals.faceNormals[ f ];\r\n\t\t\t\tvertexNormals = morphNormals.vertexNormals[ f ];\r\n\r\n\t\t\t\tfaceNormal.copy( face.normal );\r\n\r\n\t\t\t\tvertexNormals.a.copy( face.vertexNormals[ 0 ] );\r\n\t\t\t\tvertexNormals.b.copy( face.vertexNormals[ 1 ] );\r\n\t\t\t\tvertexNormals.c.copy( face.vertexNormals[ 2 ] );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\t// restore original normals\r\n\r\n\t\tfor ( f = 0, fl = this.faces.length; f < fl; f ++ ) {\r\n\r\n\t\t\tface = this.faces[ f ];\r\n\r\n\t\t\tface.normal = face.__originalFaceNormal;\r\n\t\t\tface.vertexNormals = face.__originalVertexNormals;\r\n\r\n\t\t}\r\n\r\n\t},\r\n\r\n\tcomputeTangents: function () {\r\n\r\n\t\t// based on http://www.terathon.com/code/tangent.html\r\n\t\t// tangents go to vertices\r\n\r\n\t\tvar f, fl, v, vl, i, vertexIndex,\r\n\t\t\tface, uv, vA, vB, vC, uvA, uvB, uvC,\r\n\t\t\tx1, x2, y1, y2, z1, z2,\r\n\t\t\ts1, s2, t1, t2, r, t, test,\r\n\t\t\ttan1 = [], tan2 = [],\r\n\t\t\tsdir = new THREE.Vector3(), tdir = new THREE.Vector3(),\r\n\t\t\ttmp = new THREE.Vector3(), tmp2 = new THREE.Vector3(),\r\n\t\t\tn = new THREE.Vector3(), w;\r\n\r\n\t\tfor ( v = 0, vl = this.vertices.length; v < vl; v ++ ) {\r\n\r\n\t\t\ttan1[ v ] = new THREE.Vector3();\r\n\t\t\ttan2[ v ] = new THREE.Vector3();\r\n\r\n\t\t}\r\n\r\n\t\tfunction handleTriangle( context, a, b, c, ua, ub, uc ) {\r\n\r\n\t\t\tvA = context.vertices[ a ];\r\n\t\t\tvB = context.vertices[ b ];\r\n\t\t\tvC = context.vertices[ c ];\r\n\r\n\t\t\tuvA = uv[ ua ];\r\n\t\t\tuvB = uv[ ub ];\r\n\t\t\tuvC = uv[ uc ];\r\n\r\n\t\t\tx1 = vB.x - vA.x;\r\n\t\t\tx2 = vC.x - vA.x;\r\n\t\t\ty1 = vB.y - vA.y;\r\n\t\t\ty2 = vC.y - vA.y;\r\n\t\t\tz1 = vB.z - vA.z;\r\n\t\t\tz2 = vC.z - vA.z;\r\n\r\n\t\t\ts1 = uvB.x - uvA.x;\r\n\t\t\ts2 = uvC.x - uvA.x;\r\n\t\t\tt1 = uvB.y - uvA.y;\r\n\t\t\tt2 = uvC.y - uvA.y;\r\n\r\n\t\t\tr = 1.0 / ( s1 * t2 - s2 * t1 );\r\n\t\t\tsdir.set( ( t2 * x1 - t1 * x2 ) * r,\r\n\t\t\t\t\t  ( t2 * y1 - t1 * y2 ) * r,\r\n\t\t\t\t\t  ( t2 * z1 - t1 * z2 ) * r );\r\n\t\t\ttdir.set( ( s1 * x2 - s2 * x1 ) * r,\r\n\t\t\t\t\t  ( s1 * y2 - s2 * y1 ) * r,\r\n\t\t\t\t\t  ( s1 * z2 - s2 * z1 ) * r );\r\n\r\n\t\t\ttan1[ a ].add( sdir );\r\n\t\t\ttan1[ b ].add( sdir );\r\n\t\t\ttan1[ c ].add( sdir );\r\n\r\n\t\t\ttan2[ a ].add( tdir );\r\n\t\t\ttan2[ b ].add( tdir );\r\n\t\t\ttan2[ c ].add( tdir );\r\n\r\n\t\t}\r\n\r\n\t\tfor ( f = 0, fl = this.faces.length; f < fl; f ++ ) {\r\n\r\n\t\t\tface = this.faces[ f ];\r\n\t\t\tuv = this.faceVertexUvs[ 0 ][ f ]; // use UV layer 0 for tangents\r\n\r\n\t\t\thandleTriangle( this, face.a, face.b, face.c, 0, 1, 2 );\r\n\r\n\t\t}\r\n\r\n\t\tvar faceIndex = [ 'a', 'b', 'c', 'd' ];\r\n\r\n\t\tfor ( f = 0, fl = this.faces.length; f < fl; f ++ ) {\r\n\r\n\t\t\tface = this.faces[ f ];\r\n\r\n\t\t\tfor ( i = 0; i < Math.min( face.vertexNormals.length, 3 ); i ++ ) {\r\n\r\n\t\t\t\tn.copy( face.vertexNormals[ i ] );\r\n\r\n\t\t\t\tvertexIndex = face[ faceIndex[ i ] ];\r\n\r\n\t\t\t\tt = tan1[ vertexIndex ];\r\n\r\n\t\t\t\t// Gram-Schmidt orthogonalize\r\n\r\n\t\t\t\ttmp.copy( t );\r\n\t\t\t\ttmp.sub( n.multiplyScalar( n.dot( t ) ) ).normalize();\r\n\r\n\t\t\t\t// Calculate handedness\r\n\r\n\t\t\t\ttmp2.crossVectors( face.vertexNormals[ i ], t );\r\n\t\t\t\ttest = tmp2.dot( tan2[ vertexIndex ] );\r\n\t\t\t\tw = ( test < 0.0 ) ? - 1.0 : 1.0;\r\n\r\n\t\t\t\tface.vertexTangents[ i ] = new THREE.Vector4( tmp.x, tmp.y, tmp.z, w );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tthis.hasTangents = true;\r\n\r\n\t},\r\n\r\n\tcomputeLineDistances: function () {\r\n\r\n\t\tvar d = 0;\r\n\t\tvar vertices = this.vertices;\r\n\r\n\t\tfor ( var i = 0, il = vertices.length; i < il; i ++ ) {\r\n\r\n\t\t\tif ( i > 0 ) {\r\n\r\n\t\t\t\td += vertices[ i ].distanceTo( vertices[ i - 1 ] );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tthis.lineDistances[ i ] = d;\r\n\r\n\t\t}\r\n\r\n\t},\r\n\r\n\tcomputeBoundingBox: function () {\r\n\r\n\t\tif ( this.boundingBox === null ) {\r\n\r\n\t\t\tthis.boundingBox = new THREE.Box3();\r\n\r\n\t\t}\r\n\r\n\t\tthis.boundingBox.setFromPoints( this.vertices );\r\n\r\n\t},\r\n\r\n\tcomputeBoundingSphere: function () {\r\n\r\n\t\tif ( this.boundingSphere === null ) {\r\n\r\n\t\t\tthis.boundingSphere = new THREE.Sphere();\r\n\r\n\t\t}\r\n\r\n\t\tthis.boundingSphere.setFromPoints( this.vertices );\r\n\r\n\t},\r\n\r\n\tmerge: function ( geometry, matrix, materialIndexOffset ) {\r\n\r\n\t\tif ( geometry instanceof THREE.Geometry === false ) {\r\n\r\n\t\t\tTHREE.error( 'THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.', geometry );\r\n\t\t\treturn;\r\n\r\n\t\t}\r\n\r\n\t\tvar normalMatrix,\r\n\t\tvertexOffset = this.vertices.length,\r\n\t\tvertices1 = this.vertices,\r\n\t\tvertices2 = geometry.vertices,\r\n\t\tfaces1 = this.faces,\r\n\t\tfaces2 = geometry.faces,\r\n\t\tuvs1 = this.faceVertexUvs[ 0 ],\r\n\t\tuvs2 = geometry.faceVertexUvs[ 0 ];\r\n\r\n\t\tif ( materialIndexOffset === undefined ) materialIndexOffset = 0;\r\n\r\n\t\tif ( matrix !== undefined ) {\r\n\r\n\t\t\tnormalMatrix = new THREE.Matrix3().getNormalMatrix( matrix );\r\n\r\n\t\t}\r\n\r\n\t\t// vertices\r\n\r\n\t\tfor ( var i = 0, il = vertices2.length; i < il; i ++ ) {\r\n\r\n\t\t\tvar vertex = vertices2[ i ];\r\n\r\n\t\t\tvar vertexCopy = vertex.clone();\r\n\r\n\t\t\tif ( matrix !== undefined ) vertexCopy.applyMatrix4( matrix );\r\n\r\n\t\t\tvertices1.push( vertexCopy );\r\n\r\n\t\t}\r\n\r\n\t\t// faces\r\n\r\n\t\tfor ( i = 0, il = faces2.length; i < il; i ++ ) {\r\n\r\n\t\t\tvar face = faces2[ i ], faceCopy, normal, color,\r\n\t\t\tfaceVertexNormals = face.vertexNormals,\r\n\t\t\tfaceVertexColors = face.vertexColors;\r\n\r\n\t\t\tfaceCopy = new THREE.Face3( face.a + vertexOffset, face.b + vertexOffset, face.c + vertexOffset );\r\n\t\t\tfaceCopy.normal.copy( face.normal );\r\n\r\n\t\t\tif ( normalMatrix !== undefined ) {\r\n\r\n\t\t\t\tfaceCopy.normal.applyMatrix3( normalMatrix ).normalize();\r\n\r\n\t\t\t}\r\n\r\n\t\t\tfor ( var j = 0, jl = faceVertexNormals.length; j < jl; j ++ ) {\r\n\r\n\t\t\t\tnormal = faceVertexNormals[ j ].clone();\r\n\r\n\t\t\t\tif ( normalMatrix !== undefined ) {\r\n\r\n\t\t\t\t\tnormal.applyMatrix3( normalMatrix ).normalize();\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfaceCopy.vertexNormals.push( normal );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tfaceCopy.color.copy( face.color );\r\n\r\n\t\t\tfor ( var j = 0, jl = faceVertexColors.length; j < jl; j ++ ) {\r\n\r\n\t\t\t\tcolor = faceVertexColors[ j ];\r\n\t\t\t\tfaceCopy.vertexColors.push( color.clone() );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tfaceCopy.materialIndex = face.materialIndex + materialIndexOffset;\r\n\r\n\t\t\tfaces1.push( faceCopy );\r\n\r\n\t\t}\r\n\r\n\t\t// uvs\r\n\r\n\t\tfor ( i = 0, il = uvs2.length; i < il; i ++ ) {\r\n\r\n\t\t\tvar uv = uvs2[ i ], uvCopy = [];\r\n\r\n\t\t\tif ( uv === undefined ) {\r\n\r\n\t\t\t\tcontinue;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tfor ( var j = 0, jl = uv.length; j < jl; j ++ ) {\r\n\r\n\t\t\t\tuvCopy.push( uv[ j ].clone() );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tuvs1.push( uvCopy );\r\n\r\n\t\t}\r\n\r\n\t},\r\n\r\n\tmergeMesh: function ( mesh ) {\r\n\r\n\t\tif ( mesh instanceof THREE.Mesh === false ) {\r\n\r\n\t\t\tTHREE.error( 'THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.', mesh );\r\n\t\t\treturn;\r\n\r\n\t\t}\r\n\r\n\t\tmesh.matrixAutoUpdate && mesh.updateMatrix();\r\n\r\n\t\tthis.merge( mesh.geometry, mesh.matrix );\r\n\r\n\t},\r\n\r\n\t/*\r\n\t * Checks for duplicate vertices with hashmap.\r\n\t * Duplicated vertices are removed\r\n\t * and faces' vertices are updated.\r\n\t */\r\n\r\n\tmergeVertices: function () {\r\n\r\n\t\tvar verticesMap = {}; // Hashmap for looking up vertice by position coordinates (and making sure they are unique)\r\n\t\tvar unique = [], changes = [];\r\n\r\n\t\tvar v, key;\r\n\t\tvar precisionPoints = 4; // number of decimal points, eg. 4 for epsilon of 0.0001\r\n\t\tvar precision = Math.pow( 10, precisionPoints );\r\n\t\tvar i, il, face;\r\n\t\tvar indices, j, jl;\r\n\r\n\t\tfor ( i = 0, il = this.vertices.length; i < il; i ++ ) {\r\n\r\n\t\t\tv = this.vertices[ i ];\r\n\t\t\tkey = Math.round( v.x * precision ) + '_' + Math.round( v.y * precision ) + '_' + Math.round( v.z * precision );\r\n\r\n\t\t\tif ( verticesMap[ key ] === undefined ) {\r\n\r\n\t\t\t\tverticesMap[ key ] = i;\r\n\t\t\t\tunique.push( this.vertices[ i ] );\r\n\t\t\t\tchanges[ i ] = unique.length - 1;\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\t//console.log('Duplicate vertex found. ', i, ' could be using ', verticesMap[key]);\r\n\t\t\t\tchanges[ i ] = changes[ verticesMap[ key ] ];\r\n\r\n\t\t\t}\r\n\r\n\t\t};\r\n\r\n\r\n\t\t// if faces are completely degenerate after merging vertices, we\r\n\t\t// have to remove them from the geometry.\r\n\t\tvar faceIndicesToRemove = [];\r\n\r\n\t\tfor ( i = 0, il = this.faces.length; i < il; i ++ ) {\r\n\r\n\t\t\tface = this.faces[ i ];\r\n\r\n\t\t\tface.a = changes[ face.a ];\r\n\t\t\tface.b = changes[ face.b ];\r\n\t\t\tface.c = changes[ face.c ];\r\n\r\n\t\t\tindices = [ face.a, face.b, face.c ];\r\n\r\n\t\t\tvar dupIndex = - 1;\r\n\r\n\t\t\t// if any duplicate vertices are found in a Face3\r\n\t\t\t// we have to remove the face as nothing can be saved\r\n\t\t\tfor ( var n = 0; n < 3; n ++ ) {\r\n\t\t\t\tif ( indices[ n ] == indices[ ( n + 1 ) % 3 ] ) {\r\n\r\n\t\t\t\t\tdupIndex = n;\r\n\t\t\t\t\tfaceIndicesToRemove.push( i );\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tfor ( i = faceIndicesToRemove.length - 1; i >= 0; i -- ) {\r\n\t\t\tvar idx = faceIndicesToRemove[ i ];\r\n\r\n\t\t\tthis.faces.splice( idx, 1 );\r\n\r\n\t\t\tfor ( j = 0, jl = this.faceVertexUvs.length; j < jl; j ++ ) {\r\n\r\n\t\t\t\tthis.faceVertexUvs[ j ].splice( idx, 1 );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\t// Use unique set of vertices\r\n\r\n\t\tvar diff = this.vertices.length - unique.length;\r\n\t\tthis.vertices = unique;\r\n\t\treturn diff;\r\n\r\n\t},\r\n\r\n\ttoJSON: function () {\r\n\r\n\t\tvar output = {\r\n\t\t\tmetadata: {\r\n\t\t\t\tversion: 4.0,\r\n\t\t\t\ttype: 'BufferGeometry',\r\n\t\t\t\tgenerator: 'BufferGeometryExporter'\r\n\t\t\t},\r\n\t\t\tuuid: this.uuid,\r\n\t\t\ttype: this.type\r\n\t\t};\r\n\r\n\t\tif ( this.name !== \"\" ) output.name = this.name;\r\n\r\n\t\tif ( this.parameters !== undefined ) {\r\n\r\n\t\t\tvar parameters = this.parameters;\r\n\r\n\t\t\tfor ( var key in parameters ) {\r\n\r\n\t\t\t\tif ( parameters[ key ] !== undefined ) output[ key ] = parameters[ key ];\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn output;\r\n\r\n\t\t}\r\n\r\n\t\tvar vertices = [];\r\n\r\n\t\tfor ( var i = 0; i < this.vertices.length; i ++ ) {\r\n\r\n\t\t\tvar vertex = this.vertices[ i ];\r\n\t\t\tvertices.push( vertex.x, vertex.y, vertex.z );\r\n\r\n\t\t}\r\n\r\n\t\tvar faces = [];\r\n\t\tvar normals = [];\r\n\t\tvar normalsHash = {};\r\n\t\tvar colors = [];\r\n\t\tvar colorsHash = {};\r\n\t\tvar uvs = [];\r\n\t\tvar uvsHash = {};\r\n\r\n\t\tfor ( var i = 0; i < this.faces.length; i ++ ) {\r\n\r\n\t\t\tvar face = this.faces[ i ];\r\n\r\n\t\t\tvar hasMaterial = false; // face.materialIndex !== undefined;\r\n\t\t\tvar hasFaceUv = false; // deprecated\r\n\t\t\tvar hasFaceVertexUv = this.faceVertexUvs[ 0 ][ i ] !== undefined;\r\n\t\t\tvar hasFaceNormal = face.normal.length() > 0;\r\n\t\t\tvar hasFaceVertexNormal = face.vertexNormals.length > 0;\r\n\t\t\tvar hasFaceColor = face.color.r !== 1 || face.color.g !== 1 || face.color.b !== 1;\r\n\t\t\tvar hasFaceVertexColor = face.vertexColors.length > 0;\r\n\r\n\t\t\tvar faceType = 0;\r\n\r\n\t\t\tfaceType = setBit( faceType, 0, 0 );\r\n\t\t\tfaceType = setBit( faceType, 1, hasMaterial );\r\n\t\t\tfaceType = setBit( faceType, 2, hasFaceUv );\r\n\t\t\tfaceType = setBit( faceType, 3, hasFaceVertexUv );\r\n\t\t\tfaceType = setBit( faceType, 4, hasFaceNormal );\r\n\t\t\tfaceType = setBit( faceType, 5, hasFaceVertexNormal );\r\n\t\t\tfaceType = setBit( faceType, 6, hasFaceColor );\r\n\t\t\tfaceType = setBit( faceType, 7, hasFaceVertexColor );\r\n\r\n\t\t\tfaces.push( faceType );\r\n\t\t\tfaces.push( face.a, face.b, face.c );\r\n\r\n\r\n\t\t\t/*\r\n\t\t\tif ( hasMaterial ) {\r\n\r\n\t\t\t\tfaces.push( face.materialIndex );\r\n\r\n\t\t\t}\r\n\t\t\t*/\r\n\r\n\t\t\tif ( hasFaceVertexUv ) {\r\n\r\n\t\t\t\tvar faceVertexUvs = this.faceVertexUvs[ 0 ][ i ];\r\n\r\n\t\t\t\tfaces.push(\r\n\t\t\t\t\tgetUvIndex( faceVertexUvs[ 0 ] ),\r\n\t\t\t\t\tgetUvIndex( faceVertexUvs[ 1 ] ),\r\n\t\t\t\t\tgetUvIndex( faceVertexUvs[ 2 ] )\r\n\t\t\t\t);\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( hasFaceNormal ) {\r\n\r\n\t\t\t\tfaces.push( getNormalIndex( face.normal ) );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( hasFaceVertexNormal ) {\r\n\r\n\t\t\t\tvar vertexNormals = face.vertexNormals;\r\n\r\n\t\t\t\tfaces.push(\r\n\t\t\t\t\tgetNormalIndex( vertexNormals[ 0 ] ),\r\n\t\t\t\t\tgetNormalIndex( vertexNormals[ 1 ] ),\r\n\t\t\t\t\tgetNormalIndex( vertexNormals[ 2 ] )\r\n\t\t\t\t);\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( hasFaceColor ) {\r\n\r\n\t\t\t\tfaces.push( getColorIndex( face.color ) );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( hasFaceVertexColor ) {\r\n\r\n\t\t\t\tvar vertexColors = face.vertexColors;\r\n\r\n\t\t\t\tfaces.push(\r\n\t\t\t\t\tgetColorIndex( vertexColors[ 0 ] ),\r\n\t\t\t\t\tgetColorIndex( vertexColors[ 1 ] ),\r\n\t\t\t\t\tgetColorIndex( vertexColors[ 2 ] )\r\n\t\t\t\t);\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tfunction setBit( value, position, enabled ) {\r\n\r\n\t\t\treturn enabled ? value | ( 1 << position ) : value & ( ~ ( 1 << position) );\r\n\r\n\t\t}\r\n\r\n\t\tfunction getNormalIndex( normal ) {\r\n\r\n\t\t\tvar hash = normal.x.toString() + normal.y.toString() + normal.z.toString();\r\n\r\n\t\t\tif ( normalsHash[ hash ] !== undefined ) {\r\n\r\n\t\t\t\treturn normalsHash[ hash ];\r\n\r\n\t\t\t}\r\n\r\n\t\t\tnormalsHash[ hash ] = normals.length / 3;\r\n\t\t\tnormals.push( normal.x, normal.y, normal.z );\r\n\r\n\t\t\treturn normalsHash[ hash ];\r\n\r\n\t\t}\r\n\r\n\t\tfunction getColorIndex( color ) {\r\n\r\n\t\t\tvar hash = color.r.toString() + color.g.toString() + color.b.toString();\r\n\r\n\t\t\tif ( colorsHash[ hash ] !== undefined ) {\r\n\r\n\t\t\t\treturn colorsHash[ hash ];\r\n\r\n\t\t\t}\r\n\r\n\t\t\tcolorsHash[ hash ] = colors.length;\r\n\t\t\tcolors.push( color.getHex() );\r\n\r\n\t\t\treturn colorsHash[ hash ];\r\n\r\n\t\t}\r\n\r\n\t\tfunction getUvIndex( uv ) {\r\n\r\n\t\t\tvar hash = uv.x.toString() + uv.y.toString();\r\n\r\n\t\t\tif ( uvsHash[ hash ] !== undefined ) {\r\n\r\n\t\t\t\treturn uvsHash[ hash ];\r\n\r\n\t\t\t}\r\n\r\n\t\t\tuvsHash[ hash ] = uvs.length / 2;\r\n\t\t\tuvs.push( uv.x, uv.y );\r\n\r\n\t\t\treturn uvsHash[ hash ];\r\n\r\n\t\t}\r\n\r\n\t\toutput.data = {};\r\n\r\n\t\toutput.data.vertices = vertices;\r\n\t\toutput.data.normals = normals;\r\n\t\tif ( colors.length > 0 ) output.data.colors = colors;\r\n\t\tif ( uvs.length > 0 ) output.data.uvs = [ uvs ]; // temporal backward compatibility\r\n\t\toutput.data.faces = faces;\r\n\r\n\t\t//\r\n\r\n\t\treturn output;\r\n\r\n\t},\r\n\r\n\tclone: function () {\r\n\r\n\t\tvar geometry = new THREE.Geometry();\r\n\r\n\t\tvar vertices = this.vertices;\r\n\r\n\t\tfor ( var i = 0, il = vertices.length; i < il; i ++ ) {\r\n\r\n\t\t\tgeometry.vertices.push( vertices[ i ].clone() );\r\n\r\n\t\t}\r\n\r\n\t\tvar faces = this.faces;\r\n\r\n\t\tfor ( var i = 0, il = faces.length; i < il; i ++ ) {\r\n\r\n\t\t\tgeometry.faces.push( faces[ i ].clone() );\r\n\r\n\t\t}\r\n\r\n\t\tfor ( var i = 0, il = this.faceVertexUvs.length; i < il; i ++ ) {\r\n\r\n\t\t\tvar faceVertexUvs = this.faceVertexUvs[ i ];\r\n\r\n\t\t\tif ( geometry.faceVertexUvs[ i ] === undefined ) {\r\n\r\n\t\t\t\tgeometry.faceVertexUvs[ i ] = [];\r\n\r\n\t\t\t}\r\n\r\n\t\t\tfor ( var j = 0, jl = faceVertexUvs.length; j < jl; j ++ ) {\r\n\r\n\t\t\t\tvar uvs = faceVertexUvs[ j ], uvsCopy = [];\r\n\r\n\t\t\t\tfor ( var k = 0, kl = uvs.length; k < kl; k ++ ) {\r\n\r\n\t\t\t\t\tvar uv = uvs[ k ];\r\n\r\n\t\t\t\t\tuvsCopy.push( uv.clone() );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tgeometry.faceVertexUvs[ i ].push( uvsCopy );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\treturn geometry;\r\n\r\n\t},\r\n\r\n\tdispose: function () {\r\n\r\n\t\tthis.dispatchEvent( { type: 'dispose' } );\r\n\r\n\t}\r\n\r\n};\r\n\r\nTHREE.EventDispatcher.prototype.apply( THREE.Geometry.prototype );\r\n\r\nTHREE.GeometryIdCount = 0;\r\n\r\n// File:src/cameras/Camera.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author mikael emtinger / http://gomo.se/\r\n * @author WestLangley / http://github.com/WestLangley\r\n*/\r\n\r\nTHREE.Camera = function () {\r\n\r\n\tTHREE.Object3D.call( this );\r\n\r\n\tthis.type = 'Camera';\r\n\r\n\tthis.matrixWorldInverse = new THREE.Matrix4();\r\n\tthis.projectionMatrix = new THREE.Matrix4();\r\n\r\n};\r\n\r\nTHREE.Camera.prototype = Object.create( THREE.Object3D.prototype );\r\nTHREE.Camera.prototype.constructor = THREE.Camera;\r\n\r\nTHREE.Camera.prototype.getWorldDirection = function () {\r\n\r\n\tvar quaternion = new THREE.Quaternion();\r\n\r\n\treturn function ( optionalTarget ) {\r\n\r\n\t\tvar result = optionalTarget || new THREE.Vector3();\r\n\r\n\t\tthis.getWorldQuaternion( quaternion );\r\n\r\n\t\treturn result.set( 0, 0, - 1 ).applyQuaternion( quaternion );\r\n\r\n\t}\r\n\r\n}();\r\n\r\nTHREE.Camera.prototype.lookAt = function () {\r\n\r\n\t// This routine does not support cameras with rotated and/or translated parent(s)\r\n\r\n\tvar m1 = new THREE.Matrix4();\r\n\r\n\treturn function ( vector ) {\r\n\r\n\t\tm1.lookAt( this.position, vector, this.up );\r\n\r\n\t\tthis.quaternion.setFromRotationMatrix( m1 );\r\n\r\n\t};\r\n\r\n}();\r\n\r\nTHREE.Camera.prototype.clone = function ( camera ) {\r\n\r\n\tif ( camera === undefined ) camera = new THREE.Camera();\r\n\r\n\tTHREE.Object3D.prototype.clone.call( this, camera );\r\n\r\n\tcamera.matrixWorldInverse.copy( this.matrixWorldInverse );\r\n\tcamera.projectionMatrix.copy( this.projectionMatrix );\r\n\r\n\treturn camera;\r\n};\r\n\r\n// File:src/cameras/CubeCamera.js\r\n\r\n/**\r\n * Camera for rendering cube maps\r\n *\t- renders scene into axis-aligned cube\r\n *\r\n * @author alteredq / http://alteredqualia.com/\r\n */\r\n\r\nTHREE.CubeCamera = function ( near, far, cubeResolution ) {\r\n\r\n\tTHREE.Object3D.call( this );\r\n\r\n\tthis.type = 'CubeCamera';\r\n\r\n\tvar fov = 90, aspect = 1;\r\n\r\n\tvar cameraPX = new THREE.PerspectiveCamera( fov, aspect, near, far );\r\n\tcameraPX.up.set( 0, - 1, 0 );\r\n\tcameraPX.lookAt( new THREE.Vector3( 1, 0, 0 ) );\r\n\tthis.add( cameraPX );\r\n\r\n\tvar cameraNX = new THREE.PerspectiveCamera( fov, aspect, near, far );\r\n\tcameraNX.up.set( 0, - 1, 0 );\r\n\tcameraNX.lookAt( new THREE.Vector3( - 1, 0, 0 ) );\r\n\tthis.add( cameraNX );\r\n\r\n\tvar cameraPY = new THREE.PerspectiveCamera( fov, aspect, near, far );\r\n\tcameraPY.up.set( 0, 0, 1 );\r\n\tcameraPY.lookAt( new THREE.Vector3( 0, 1, 0 ) );\r\n\tthis.add( cameraPY );\r\n\r\n\tvar cameraNY = new THREE.PerspectiveCamera( fov, aspect, near, far );\r\n\tcameraNY.up.set( 0, 0, - 1 );\r\n\tcameraNY.lookAt( new THREE.Vector3( 0, - 1, 0 ) );\r\n\tthis.add( cameraNY );\r\n\r\n\tvar cameraPZ = new THREE.PerspectiveCamera( fov, aspect, near, far );\r\n\tcameraPZ.up.set( 0, - 1, 0 );\r\n\tcameraPZ.lookAt( new THREE.Vector3( 0, 0, 1 ) );\r\n\tthis.add( cameraPZ );\r\n\r\n\tvar cameraNZ = new THREE.PerspectiveCamera( fov, aspect, near, far );\r\n\tcameraNZ.up.set( 0, - 1, 0 );\r\n\tcameraNZ.lookAt( new THREE.Vector3( 0, 0, - 1 ) );\r\n\tthis.add( cameraNZ );\r\n\r\n\tthis.renderTarget = new THREE.WebGLRenderTargetCube( cubeResolution, cubeResolution, { format: THREE.RGBFormat, magFilter: THREE.LinearFilter, minFilter: THREE.LinearFilter } );\r\n\r\n\tthis.updateCubeMap = function ( renderer, scene ) {\r\n\r\n\t\tvar renderTarget = this.renderTarget;\r\n\t\tvar generateMipmaps = renderTarget.generateMipmaps;\r\n\r\n\t\trenderTarget.generateMipmaps = false;\r\n\r\n\t\trenderTarget.activeCubeFace = 0;\r\n\t\trenderer.render( scene, cameraPX, renderTarget );\r\n\r\n\t\trenderTarget.activeCubeFace = 1;\r\n\t\trenderer.render( scene, cameraNX, renderTarget );\r\n\r\n\t\trenderTarget.activeCubeFace = 2;\r\n\t\trenderer.render( scene, cameraPY, renderTarget );\r\n\r\n\t\trenderTarget.activeCubeFace = 3;\r\n\t\trenderer.render( scene, cameraNY, renderTarget );\r\n\r\n\t\trenderTarget.activeCubeFace = 4;\r\n\t\trenderer.render( scene, cameraPZ, renderTarget );\r\n\r\n\t\trenderTarget.generateMipmaps = generateMipmaps;\r\n\r\n\t\trenderTarget.activeCubeFace = 5;\r\n\t\trenderer.render( scene, cameraNZ, renderTarget );\r\n\r\n\t};\r\n\r\n};\r\n\r\nTHREE.CubeCamera.prototype = Object.create( THREE.Object3D.prototype );\r\nTHREE.CubeCamera.prototype.constructor = THREE.CubeCamera;\r\n\r\n// File:src/cameras/OrthographicCamera.js\r\n\r\n/**\r\n * @author alteredq / http://alteredqualia.com/\r\n */\r\n\r\nTHREE.OrthographicCamera = function ( left, right, top, bottom, near, far ) {\r\n\r\n\tTHREE.Camera.call( this );\r\n\r\n\tthis.type = 'OrthographicCamera';\r\n\r\n\tthis.zoom = 1;\r\n\r\n\tthis.left = left;\r\n\tthis.right = right;\r\n\tthis.top = top;\r\n\tthis.bottom = bottom;\r\n\r\n\tthis.near = ( near !== undefined ) ? near : 0.1;\r\n\tthis.far = ( far !== undefined ) ? far : 2000;\r\n\r\n\tthis.updateProjectionMatrix();\r\n\r\n};\r\n\r\nTHREE.OrthographicCamera.prototype = Object.create( THREE.Camera.prototype );\r\nTHREE.OrthographicCamera.prototype.constructor = THREE.OrthographicCamera;\r\n\r\nTHREE.OrthographicCamera.prototype.updateProjectionMatrix = function () {\r\n\r\n\tvar dx = ( this.right - this.left ) / ( 2 * this.zoom );\r\n\tvar dy = ( this.top - this.bottom ) / ( 2 * this.zoom );\r\n\tvar cx = ( this.right + this.left ) / 2;\r\n\tvar cy = ( this.top + this.bottom ) / 2;\r\n\r\n\tthis.projectionMatrix.makeOrthographic( cx - dx, cx + dx, cy + dy, cy - dy, this.near, this.far );\r\n\r\n};\r\n\r\nTHREE.OrthographicCamera.prototype.clone = function () {\r\n\r\n\tvar camera = new THREE.OrthographicCamera();\r\n\r\n\tTHREE.Camera.prototype.clone.call( this, camera );\r\n\r\n\tcamera.zoom = this.zoom;\r\n\r\n\tcamera.left = this.left;\r\n\tcamera.right = this.right;\r\n\tcamera.top = this.top;\r\n\tcamera.bottom = this.bottom;\r\n\r\n\tcamera.near = this.near;\r\n\tcamera.far = this.far;\r\n\r\n\tcamera.projectionMatrix.copy( this.projectionMatrix );\r\n\r\n\treturn camera;\r\n};\r\n\r\n// File:src/cameras/PerspectiveCamera.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author greggman / http://games.greggman.com/\r\n * @author zz85 / http://www.lab4games.net/zz85/blog\r\n */\r\n\r\nTHREE.PerspectiveCamera = function ( fov, aspect, near, far ) {\r\n\r\n\tTHREE.Camera.call( this );\r\n\r\n\tthis.type = 'PerspectiveCamera';\r\n\r\n\tthis.zoom = 1;\r\n\r\n\tthis.fov = fov !== undefined ? fov : 50;\r\n\tthis.aspect = aspect !== undefined ? aspect : 1;\r\n\tthis.near = near !== undefined ? near : 0.1;\r\n\tthis.far = far !== undefined ? far : 2000;\r\n\r\n\tthis.updateProjectionMatrix();\r\n\r\n};\r\n\r\nTHREE.PerspectiveCamera.prototype = Object.create( THREE.Camera.prototype );\r\nTHREE.PerspectiveCamera.prototype.constructor = THREE.PerspectiveCamera;\r\n\r\n\r\n/**\r\n * Uses Focal Length (in mm) to estimate and set FOV\r\n * 35mm (fullframe) camera is used if frame size is not specified;\r\n * Formula based on http://www.bobatkins.com/photography/technical/field_of_view.html\r\n */\r\n\r\nTHREE.PerspectiveCamera.prototype.setLens = function ( focalLength, frameHeight ) {\r\n\r\n\tif ( frameHeight === undefined ) frameHeight = 24;\r\n\r\n\tthis.fov = 2 * THREE.Math.radToDeg( Math.atan( frameHeight / ( focalLength * 2 ) ) );\r\n\tthis.updateProjectionMatrix();\r\n\r\n}\r\n\r\n\r\n/**\r\n * Sets an offset in a larger frustum. This is useful for multi-window or\r\n * multi-monitor/multi-machine setups.\r\n *\r\n * For example, if you have 3x2 monitors and each monitor is 1920x1080 and\r\n * the monitors are in grid like this\r\n *\r\n *   +---+---+---+\r\n *   | A | B | C |\r\n *   +---+---+---+\r\n *   | D | E | F |\r\n *   +---+---+---+\r\n *\r\n * then for each monitor you would call it like this\r\n *\r\n *   var w = 1920;\r\n *   var h = 1080;\r\n *   var fullWidth = w * 3;\r\n *   var fullHeight = h * 2;\r\n *\r\n *   --A--\r\n *   camera.setOffset( fullWidth, fullHeight, w * 0, h * 0, w, h );\r\n *   --B--\r\n *   camera.setOffset( fullWidth, fullHeight, w * 1, h * 0, w, h );\r\n *   --C--\r\n *   camera.setOffset( fullWidth, fullHeight, w * 2, h * 0, w, h );\r\n *   --D--\r\n *   camera.setOffset( fullWidth, fullHeight, w * 0, h * 1, w, h );\r\n *   --E--\r\n *   camera.setOffset( fullWidth, fullHeight, w * 1, h * 1, w, h );\r\n *   --F--\r\n *   camera.setOffset( fullWidth, fullHeight, w * 2, h * 1, w, h );\r\n *\r\n *   Note there is no reason monitors have to be the same size or in a grid.\r\n */\r\n\r\nTHREE.PerspectiveCamera.prototype.setViewOffset = function ( fullWidth, fullHeight, x, y, width, height ) {\r\n\r\n\tthis.fullWidth = fullWidth;\r\n\tthis.fullHeight = fullHeight;\r\n\tthis.x = x;\r\n\tthis.y = y;\r\n\tthis.width = width;\r\n\tthis.height = height;\r\n\r\n\tthis.updateProjectionMatrix();\r\n\r\n};\r\n\r\n\r\nTHREE.PerspectiveCamera.prototype.updateProjectionMatrix = function () {\r\n\r\n\tvar fov = THREE.Math.radToDeg( 2 * Math.atan( Math.tan( THREE.Math.degToRad( this.fov ) * 0.5 ) / this.zoom ) );\r\n\r\n\tif ( this.fullWidth ) {\r\n\r\n\t\tvar aspect = this.fullWidth / this.fullHeight;\r\n\t\tvar top = Math.tan( THREE.Math.degToRad( fov * 0.5 ) ) * this.near;\r\n\t\tvar bottom = - top;\r\n\t\tvar left = aspect * bottom;\r\n\t\tvar right = aspect * top;\r\n\t\tvar width = Math.abs( right - left );\r\n\t\tvar height = Math.abs( top - bottom );\r\n\r\n\t\tthis.projectionMatrix.makeFrustum(\r\n\t\t\tleft + this.x * width / this.fullWidth,\r\n\t\t\tleft + ( this.x + this.width ) * width / this.fullWidth,\r\n\t\t\ttop - ( this.y + this.height ) * height / this.fullHeight,\r\n\t\t\ttop - this.y * height / this.fullHeight,\r\n\t\t\tthis.near,\r\n\t\t\tthis.far\r\n\t\t);\r\n\r\n\t} else {\r\n\r\n\t\tthis.projectionMatrix.makePerspective( fov, this.aspect, this.near, this.far );\r\n\r\n\t}\r\n\r\n};\r\n\r\nTHREE.PerspectiveCamera.prototype.clone = function () {\r\n\r\n\tvar camera = new THREE.PerspectiveCamera();\r\n\r\n\tTHREE.Camera.prototype.clone.call( this, camera );\r\n\r\n\tcamera.zoom = this.zoom;\r\n\r\n\tcamera.fov = this.fov;\r\n\tcamera.aspect = this.aspect;\r\n\tcamera.near = this.near;\r\n\tcamera.far = this.far;\r\n\r\n\tcamera.projectionMatrix.copy( this.projectionMatrix );\r\n\r\n\treturn camera;\r\n\r\n};\r\n\r\n// File:src/lights/Light.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author alteredq / http://alteredqualia.com/\r\n */\r\n\r\nTHREE.Light = function ( color ) {\r\n\r\n\tTHREE.Object3D.call( this );\r\n\r\n\tthis.type = 'Light';\r\n\t\r\n\tthis.color = new THREE.Color( color );\r\n\r\n};\r\n\r\nTHREE.Light.prototype = Object.create( THREE.Object3D.prototype );\r\nTHREE.Light.prototype.constructor = THREE.Light;\r\n\r\nTHREE.Light.prototype.clone = function ( light ) {\r\n\r\n\tif ( light === undefined ) light = new THREE.Light();\r\n\r\n\tTHREE.Object3D.prototype.clone.call( this, light );\r\n\r\n\tlight.color.copy( this.color );\r\n\r\n\treturn light;\r\n\r\n};\r\n\r\n// File:src/lights/AmbientLight.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.AmbientLight = function ( color ) {\r\n\r\n\tTHREE.Light.call( this, color );\r\n\r\n\tthis.type = 'AmbientLight';\r\n\r\n};\r\n\r\nTHREE.AmbientLight.prototype = Object.create( THREE.Light.prototype );\r\nTHREE.AmbientLight.prototype.constructor = THREE.AmbientLight;\r\n\r\nTHREE.AmbientLight.prototype.clone = function () {\r\n\r\n\tvar light = new THREE.AmbientLight();\r\n\r\n\tTHREE.Light.prototype.clone.call( this, light );\r\n\r\n\treturn light;\r\n\r\n};\r\n\r\n// File:src/lights/AreaLight.js\r\n\r\n/**\r\n * @author MPanknin / http://www.redplant.de/\r\n * @author alteredq / http://alteredqualia.com/\r\n */\r\n\r\nTHREE.AreaLight = function ( color, intensity ) {\r\n\r\n\tTHREE.Light.call( this, color );\r\n\r\n\tthis.type = 'AreaLight';\r\n\r\n\tthis.normal = new THREE.Vector3( 0, - 1, 0 );\r\n\tthis.right = new THREE.Vector3( 1, 0, 0 );\r\n\r\n\tthis.intensity = ( intensity !== undefined ) ? intensity : 1;\r\n\r\n\tthis.width = 1.0;\r\n\tthis.height = 1.0;\r\n\r\n\tthis.constantAttenuation = 1.5;\r\n\tthis.linearAttenuation = 0.5;\r\n\tthis.quadraticAttenuation = 0.1;\r\n\r\n};\r\n\r\nTHREE.AreaLight.prototype = Object.create( THREE.Light.prototype );\r\nTHREE.AreaLight.prototype.constructor = THREE.AreaLight;\r\n\r\n\r\n// File:src/lights/DirectionalLight.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author alteredq / http://alteredqualia.com/\r\n */\r\n\r\nTHREE.DirectionalLight = function ( color, intensity ) {\r\n\r\n\tTHREE.Light.call( this, color );\r\n\r\n\tthis.type = 'DirectionalLight';\r\n\r\n\tthis.position.set( 0, 1, 0 );\r\n\tthis.target = new THREE.Object3D();\r\n\r\n\tthis.intensity = ( intensity !== undefined ) ? intensity : 1;\r\n\r\n\tthis.castShadow = false;\r\n\tthis.onlyShadow = false;\r\n\r\n\t//\r\n\r\n\tthis.shadowCameraNear = 50;\r\n\tthis.shadowCameraFar = 5000;\r\n\r\n\tthis.shadowCameraLeft = - 500;\r\n\tthis.shadowCameraRight = 500;\r\n\tthis.shadowCameraTop = 500;\r\n\tthis.shadowCameraBottom = - 500;\r\n\r\n\tthis.shadowCameraVisible = false;\r\n\r\n\tthis.shadowBias = 0;\r\n\tthis.shadowDarkness = 0.5;\r\n\r\n\tthis.shadowMapWidth = 512;\r\n\tthis.shadowMapHeight = 512;\r\n\r\n\t//\r\n\r\n\tthis.shadowCascade = false;\r\n\r\n\tthis.shadowCascadeOffset = new THREE.Vector3( 0, 0, - 1000 );\r\n\tthis.shadowCascadeCount = 2;\r\n\r\n\tthis.shadowCascadeBias = [ 0, 0, 0 ];\r\n\tthis.shadowCascadeWidth = [ 512, 512, 512 ];\r\n\tthis.shadowCascadeHeight = [ 512, 512, 512 ];\r\n\r\n\tthis.shadowCascadeNearZ = [ - 1.000, 0.990, 0.998 ];\r\n\tthis.shadowCascadeFarZ  = [ 0.990, 0.998, 1.000 ];\r\n\r\n\tthis.shadowCascadeArray = [];\r\n\r\n\t//\r\n\r\n\tthis.shadowMap = null;\r\n\tthis.shadowMapSize = null;\r\n\tthis.shadowCamera = null;\r\n\tthis.shadowMatrix = null;\r\n\r\n};\r\n\r\nTHREE.DirectionalLight.prototype = Object.create( THREE.Light.prototype );\r\nTHREE.DirectionalLight.prototype.constructor = THREE.DirectionalLight;\r\n\r\nTHREE.DirectionalLight.prototype.clone = function () {\r\n\r\n\tvar light = new THREE.DirectionalLight();\r\n\r\n\tTHREE.Light.prototype.clone.call( this, light );\r\n\r\n\tlight.target = this.target.clone();\r\n\r\n\tlight.intensity = this.intensity;\r\n\r\n\tlight.castShadow = this.castShadow;\r\n\tlight.onlyShadow = this.onlyShadow;\r\n\r\n\t//\r\n\r\n\tlight.shadowCameraNear = this.shadowCameraNear;\r\n\tlight.shadowCameraFar = this.shadowCameraFar;\r\n\r\n\tlight.shadowCameraLeft = this.shadowCameraLeft;\r\n\tlight.shadowCameraRight = this.shadowCameraRight;\r\n\tlight.shadowCameraTop = this.shadowCameraTop;\r\n\tlight.shadowCameraBottom = this.shadowCameraBottom;\r\n\r\n\tlight.shadowCameraVisible = this.shadowCameraVisible;\r\n\r\n\tlight.shadowBias = this.shadowBias;\r\n\tlight.shadowDarkness = this.shadowDarkness;\r\n\r\n\tlight.shadowMapWidth = this.shadowMapWidth;\r\n\tlight.shadowMapHeight = this.shadowMapHeight;\r\n\r\n\t//\r\n\r\n\tlight.shadowCascade = this.shadowCascade;\r\n\r\n\tlight.shadowCascadeOffset.copy( this.shadowCascadeOffset );\r\n\tlight.shadowCascadeCount = this.shadowCascadeCount;\r\n\r\n\tlight.shadowCascadeBias = this.shadowCascadeBias.slice( 0 );\r\n\tlight.shadowCascadeWidth = this.shadowCascadeWidth.slice( 0 );\r\n\tlight.shadowCascadeHeight = this.shadowCascadeHeight.slice( 0 );\r\n\r\n\tlight.shadowCascadeNearZ = this.shadowCascadeNearZ.slice( 0 );\r\n\tlight.shadowCascadeFarZ  = this.shadowCascadeFarZ.slice( 0 );\r\n\r\n\treturn light;\r\n\r\n};\r\n\r\n// File:src/lights/HemisphereLight.js\r\n\r\n/**\r\n * @author alteredq / http://alteredqualia.com/\r\n */\r\n\r\nTHREE.HemisphereLight = function ( skyColor, groundColor, intensity ) {\r\n\r\n\tTHREE.Light.call( this, skyColor );\r\n\r\n\tthis.type = 'HemisphereLight';\r\n\r\n\tthis.position.set( 0, 100, 0 );\r\n\r\n\tthis.groundColor = new THREE.Color( groundColor );\r\n\tthis.intensity = ( intensity !== undefined ) ? intensity : 1;\r\n\r\n};\r\n\r\nTHREE.HemisphereLight.prototype = Object.create( THREE.Light.prototype );\r\nTHREE.HemisphereLight.prototype.constructor = THREE.HemisphereLight;\r\n\r\nTHREE.HemisphereLight.prototype.clone = function () {\r\n\r\n\tvar light = new THREE.HemisphereLight();\r\n\r\n\tTHREE.Light.prototype.clone.call( this, light );\r\n\r\n\tlight.groundColor.copy( this.groundColor );\r\n\tlight.intensity = this.intensity;\r\n\r\n\treturn light;\r\n\r\n};\r\n\r\n// File:src/lights/PointLight.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.PointLight = function ( color, intensity, distance, decay ) {\r\n\r\n\tTHREE.Light.call( this, color );\r\n\r\n\tthis.type = 'PointLight';\r\n\r\n\tthis.intensity = ( intensity !== undefined ) ? intensity : 1;\r\n\tthis.distance = ( distance !== undefined ) ? distance : 0;\r\n\tthis.decay = ( decay !== undefined ) ? decay : 1;\t// for physically correct lights, should be 2.\r\n\r\n};\r\n\r\nTHREE.PointLight.prototype = Object.create( THREE.Light.prototype );\r\nTHREE.PointLight.prototype.constructor = THREE.PointLight;\r\n\r\nTHREE.PointLight.prototype.clone = function () {\r\n\r\n\tvar light = new THREE.PointLight();\r\n\r\n\tTHREE.Light.prototype.clone.call( this, light );\r\n\r\n\tlight.intensity = this.intensity;\r\n\tlight.distance = this.distance;\r\n\tlight.decay = this.decay;\r\n\r\n\treturn light;\r\n\r\n};\r\n\r\n// File:src/lights/SpotLight.js\r\n\r\n/**\r\n * @author alteredq / http://alteredqualia.com/\r\n */\r\n\r\nTHREE.SpotLight = function ( color, intensity, distance, angle, exponent, decay ) {\r\n\r\n\tTHREE.Light.call( this, color );\r\n\r\n\tthis.type = 'SpotLight';\r\n\r\n\tthis.position.set( 0, 1, 0 );\r\n\tthis.target = new THREE.Object3D();\r\n\r\n\tthis.intensity = ( intensity !== undefined ) ? intensity : 1;\r\n\tthis.distance = ( distance !== undefined ) ? distance : 0;\r\n\tthis.angle = ( angle !== undefined ) ? angle : Math.PI / 3;\r\n\tthis.exponent = ( exponent !== undefined ) ? exponent : 10;\r\n\tthis.decay = ( decay !== undefined ) ? decay : 1;\t// for physically correct lights, should be 2.\r\n\r\n\tthis.castShadow = false;\r\n\tthis.onlyShadow = false;\r\n\r\n\t//\r\n\r\n\tthis.shadowCameraNear = 50;\r\n\tthis.shadowCameraFar = 5000;\r\n\tthis.shadowCameraFov = 50;\r\n\r\n\tthis.shadowCameraVisible = false;\r\n\r\n\tthis.shadowBias = 0;\r\n\tthis.shadowDarkness = 0.5;\r\n\r\n\tthis.shadowMapWidth = 512;\r\n\tthis.shadowMapHeight = 512;\r\n\r\n\t//\r\n\r\n\tthis.shadowMap = null;\r\n\tthis.shadowMapSize = null;\r\n\tthis.shadowCamera = null;\r\n\tthis.shadowMatrix = null;\r\n\r\n};\r\n\r\nTHREE.SpotLight.prototype = Object.create( THREE.Light.prototype );\r\nTHREE.SpotLight.prototype.constructor = THREE.SpotLight;\r\n\r\nTHREE.SpotLight.prototype.clone = function () {\r\n\r\n\tvar light = new THREE.SpotLight();\r\n\r\n\tTHREE.Light.prototype.clone.call( this, light );\r\n\r\n\tlight.target = this.target.clone();\r\n\r\n\tlight.intensity = this.intensity;\r\n\tlight.distance = this.distance;\r\n\tlight.angle = this.angle;\r\n\tlight.exponent = this.exponent;\r\n\tlight.decay = this.decay;\r\n\r\n\tlight.castShadow = this.castShadow;\r\n\tlight.onlyShadow = this.onlyShadow;\r\n\r\n\t//\r\n\r\n\tlight.shadowCameraNear = this.shadowCameraNear;\r\n\tlight.shadowCameraFar = this.shadowCameraFar;\r\n\tlight.shadowCameraFov = this.shadowCameraFov;\r\n\r\n\tlight.shadowCameraVisible = this.shadowCameraVisible;\r\n\r\n\tlight.shadowBias = this.shadowBias;\r\n\tlight.shadowDarkness = this.shadowDarkness;\r\n\r\n\tlight.shadowMapWidth = this.shadowMapWidth;\r\n\tlight.shadowMapHeight = this.shadowMapHeight;\r\n\r\n\treturn light;\r\n\r\n};\r\n\r\n// File:src/loaders/Cache.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.Cache = {\r\n\r\n\tfiles: {},\r\n\r\n\tadd: function ( key, file ) {\r\n\r\n\t\t// console.log( 'THREE.Cache', 'Adding key:', key );\r\n\r\n\t\tthis.files[ key ] = file;\r\n\r\n\t},\r\n\r\n\tget: function ( key ) {\r\n\r\n\t\t// console.log( 'THREE.Cache', 'Checking key:', key );\r\n\r\n\t\treturn this.files[ key ];\r\n\r\n\t},\r\n\r\n\tremove: function ( key ) {\r\n\r\n\t\tdelete this.files[ key ];\r\n\r\n\t},\r\n\r\n\tclear: function () {\r\n\r\n\t\tthis.files = {}\r\n\r\n\t}\r\n\r\n};\r\n\r\n// File:src/loaders/Loader.js\r\n\r\n/**\r\n * @author alteredq / http://alteredqualia.com/\r\n */\r\n\r\nTHREE.Loader = function ( showStatus ) {\r\n\r\n\tthis.showStatus = showStatus;\r\n\tthis.statusDomElement = showStatus ? THREE.Loader.prototype.addStatusElement() : null;\r\n\r\n\tthis.imageLoader = new THREE.ImageLoader();\r\n\r\n\tthis.onLoadStart = function () {};\r\n\tthis.onLoadProgress = function () {};\r\n\tthis.onLoadComplete = function () {};\r\n\r\n};\r\n\r\nTHREE.Loader.prototype = {\r\n\r\n\tconstructor: THREE.Loader,\r\n\r\n\tcrossOrigin: undefined,\r\n\r\n\taddStatusElement: function () {\r\n\r\n\t\tvar e = document.createElement( 'div' );\r\n\r\n\t\te.style.position = 'absolute';\r\n\t\te.style.right = '0px';\r\n\t\te.style.top = '0px';\r\n\t\te.style.fontSize = '0.8em';\r\n\t\te.style.textAlign = 'left';\r\n\t\te.style.background = 'rgba(0,0,0,0.25)';\r\n\t\te.style.color = '#fff';\r\n\t\te.style.width = '120px';\r\n\t\te.style.padding = '0.5em 0.5em 0.5em 0.5em';\r\n\t\te.style.zIndex = 1000;\r\n\r\n\t\te.innerHTML = 'Loading ...';\r\n\r\n\t\treturn e;\r\n\r\n\t},\r\n\r\n\tupdateProgress: function ( progress ) {\r\n\r\n\t\tvar message = 'Loaded ';\r\n\r\n\t\tif ( progress.total ) {\r\n\r\n\t\t\tmessage += ( 100 * progress.loaded / progress.total ).toFixed( 0 ) + '%';\r\n\r\n\r\n\t\t} else {\r\n\r\n\t\t\tmessage += ( progress.loaded / 1024 ).toFixed( 2 ) + ' KB';\r\n\r\n\t\t}\r\n\r\n\t\tthis.statusDomElement.innerHTML = message;\r\n\r\n\t},\r\n\r\n\textractUrlBase: function ( url ) {\r\n\r\n\t\tvar parts = url.split( '/' );\r\n\r\n\t\tif ( parts.length === 1 ) return './';\r\n\r\n\t\tparts.pop();\r\n\r\n\t\treturn parts.join( '/' ) + '/';\r\n\r\n\t},\r\n\r\n\tinitMaterials: function ( materials, texturePath ) {\r\n\r\n\t\tvar array = [];\r\n\r\n\t\tfor ( var i = 0; i < materials.length; ++ i ) {\r\n\r\n\t\t\tarray[ i ] = this.createMaterial( materials[ i ], texturePath );\r\n\r\n\t\t}\r\n\r\n\t\treturn array;\r\n\r\n\t},\r\n\r\n\tneedsTangents: function ( materials ) {\r\n\r\n\t\tfor ( var i = 0, il = materials.length; i < il; i ++ ) {\r\n\r\n\t\t\tvar m = materials[ i ];\r\n\r\n\t\t\tif ( m instanceof THREE.ShaderMaterial ) return true;\r\n\r\n\t\t}\r\n\r\n\t\treturn false;\r\n\r\n\t},\r\n\r\n\tcreateMaterial: function ( m, texturePath ) {\r\n\r\n\t\tvar scope = this;\r\n\r\n\t\tfunction nearest_pow2( n ) {\r\n\r\n\t\t\tvar l = Math.log( n ) / Math.LN2;\r\n\t\t\treturn Math.pow( 2, Math.round(  l ) );\r\n\r\n\t\t}\r\n\r\n\t\tfunction create_texture( where, name, sourceFile, repeat, offset, wrap, anisotropy ) {\r\n\r\n\t\t\tvar fullPath = texturePath + sourceFile;\r\n\r\n\t\t\tvar texture;\r\n\r\n\t\t\tvar loader = THREE.Loader.Handlers.get( fullPath );\r\n\r\n\t\t\tif ( loader !== null ) {\r\n\r\n\t\t\t\ttexture = loader.load( fullPath );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\ttexture = new THREE.Texture();\r\n\r\n\t\t\t\tloader = scope.imageLoader;\r\n\t\t\t\tloader.crossOrigin = scope.crossOrigin;\r\n\t\t\t\tloader.load( fullPath, function ( image ) {\r\n\r\n\t\t\t\t\tif ( THREE.Math.isPowerOfTwo( image.width ) === false ||\r\n\t\t\t\t\t\t THREE.Math.isPowerOfTwo( image.height ) === false ) {\r\n\r\n\t\t\t\t\t\tvar width = nearest_pow2( image.width );\r\n\t\t\t\t\t\tvar height = nearest_pow2( image.height );\r\n\r\n\t\t\t\t\t\tvar canvas = document.createElement( 'canvas' );\r\n\t\t\t\t\t\tcanvas.width = width;\r\n\t\t\t\t\t\tcanvas.height = height;\r\n\r\n\t\t\t\t\t\tvar context = canvas.getContext( '2d' );\r\n\t\t\t\t\t\tcontext.drawImage( image, 0, 0, width, height );\r\n\r\n\t\t\t\t\t\ttexture.image = canvas;\r\n\r\n\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\ttexture.image = image;\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\ttexture.needsUpdate = true;\r\n\r\n\t\t\t\t} );\r\n\r\n\t\t\t}\r\n\r\n\t\t\ttexture.sourceFile = sourceFile;\r\n\r\n\t\t\tif ( repeat ) {\r\n\r\n\t\t\t\ttexture.repeat.set( repeat[ 0 ], repeat[ 1 ] );\r\n\r\n\t\t\t\tif ( repeat[ 0 ] !== 1 ) texture.wrapS = THREE.RepeatWrapping;\r\n\t\t\t\tif ( repeat[ 1 ] !== 1 ) texture.wrapT = THREE.RepeatWrapping;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( offset ) {\r\n\r\n\t\t\t\ttexture.offset.set( offset[ 0 ], offset[ 1 ] );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( wrap ) {\r\n\r\n\t\t\t\tvar wrapMap = {\r\n\t\t\t\t\t'repeat': THREE.RepeatWrapping,\r\n\t\t\t\t\t'mirror': THREE.MirroredRepeatWrapping\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( wrapMap[ wrap[ 0 ] ] !== undefined ) texture.wrapS = wrapMap[ wrap[ 0 ] ];\r\n\t\t\t\tif ( wrapMap[ wrap[ 1 ] ] !== undefined ) texture.wrapT = wrapMap[ wrap[ 1 ] ];\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( anisotropy ) {\r\n\r\n\t\t\t\ttexture.anisotropy = anisotropy;\r\n\r\n\t\t\t}\r\n\r\n\t\t\twhere[ name ] = texture;\r\n\r\n\t\t}\r\n\r\n\t\tfunction rgb2hex( rgb ) {\r\n\r\n\t\t\treturn ( rgb[ 0 ] * 255 << 16 ) + ( rgb[ 1 ] * 255 << 8 ) + rgb[ 2 ] * 255;\r\n\r\n\t\t}\r\n\r\n\t\t// defaults\r\n\r\n\t\tvar mtype = 'MeshLambertMaterial';\r\n\t\tvar mpars = { color: 0xeeeeee, opacity: 1.0, map: null, lightMap: null, normalMap: null, bumpMap: null, wireframe: false };\r\n\r\n\t\t// parameters from model file\r\n\r\n\t\tif ( m.shading ) {\r\n\r\n\t\t\tvar shading = m.shading.toLowerCase();\r\n\r\n\t\t\tif ( shading === 'phong' ) mtype = 'MeshPhongMaterial';\r\n\t\t\telse if ( shading === 'basic' ) mtype = 'MeshBasicMaterial';\r\n\r\n\t\t}\r\n\r\n\t\tif ( m.blending !== undefined && THREE[ m.blending ] !== undefined ) {\r\n\r\n\t\t\tmpars.blending = THREE[ m.blending ];\r\n\r\n\t\t}\r\n\r\n\t\tif ( m.transparent !== undefined ) {\r\n\r\n\t\t\tmpars.transparent = m.transparent;\r\n\r\n\t\t}\r\n\r\n\t\tif ( m.opacity !== undefined && m.opacity < 1.0 ) {\r\n\r\n\t\t\tmpars.transparent = true;\r\n\r\n\t\t}\r\n\r\n\t\tif ( m.depthTest !== undefined ) {\r\n\r\n\t\t\tmpars.depthTest = m.depthTest;\r\n\r\n\t\t}\r\n\r\n\t\tif ( m.depthWrite !== undefined ) {\r\n\r\n\t\t\tmpars.depthWrite = m.depthWrite;\r\n\r\n\t\t}\r\n\r\n\t\tif ( m.visible !== undefined ) {\r\n\r\n\t\t\tmpars.visible = m.visible;\r\n\r\n\t\t}\r\n\r\n\t\tif ( m.flipSided !== undefined ) {\r\n\r\n\t\t\tmpars.side = THREE.BackSide;\r\n\r\n\t\t}\r\n\r\n\t\tif ( m.doubleSided !== undefined ) {\r\n\r\n\t\t\tmpars.side = THREE.DoubleSide;\r\n\r\n\t\t}\r\n\r\n\t\tif ( m.wireframe !== undefined ) {\r\n\r\n\t\t\tmpars.wireframe = m.wireframe;\r\n\r\n\t\t}\r\n\r\n\t\tif ( m.vertexColors !== undefined ) {\r\n\r\n\t\t\tif ( m.vertexColors === 'face' ) {\r\n\r\n\t\t\t\tmpars.vertexColors = THREE.FaceColors;\r\n\r\n\t\t\t} else if ( m.vertexColors ) {\r\n\r\n\t\t\t\tmpars.vertexColors = THREE.VertexColors;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\t// colors\r\n\r\n\t\tif ( m.colorDiffuse ) {\r\n\r\n\t\t\tmpars.color = rgb2hex( m.colorDiffuse );\r\n\r\n\t\t} else if ( m.DbgColor ) {\r\n\r\n\t\t\tmpars.color = m.DbgColor;\r\n\r\n\t\t}\r\n\r\n\t\tif ( m.colorSpecular ) {\r\n\r\n\t\t\tmpars.specular = rgb2hex( m.colorSpecular );\r\n\r\n\t\t}\r\n\r\n\t\tif ( m.colorEmissive ) {\r\n\r\n\t\t\tmpars.emissive = rgb2hex( m.colorEmissive );\r\n\r\n\t\t}\r\n\r\n\t\t// modifiers\r\n\r\n\t\tif ( m.transparency !== undefined ) {\r\n\r\n\t\t\tconsole.warn( 'THREE.Loader: transparency has been renamed to opacity' );\r\n\t\t\tm.opacity = m.transparency;\r\n\r\n\t\t}\r\n\r\n\t\tif ( m.opacity !== undefined ) {\r\n\r\n\t\t\tmpars.opacity = m.opacity;\r\n\r\n\t\t}\r\n\r\n\t\tif ( m.specularCoef ) {\r\n\r\n\t\t\tmpars.shininess = m.specularCoef;\r\n\r\n\t\t}\r\n\r\n\t\t// textures\r\n\r\n\t\tif ( m.mapDiffuse && texturePath ) {\r\n\r\n\t\t\tcreate_texture( mpars, 'map', m.mapDiffuse, m.mapDiffuseRepeat, m.mapDiffuseOffset, m.mapDiffuseWrap, m.mapDiffuseAnisotropy );\r\n\r\n\t\t}\r\n\r\n\t\tif ( m.mapLight && texturePath ) {\r\n\r\n\t\t\tcreate_texture( mpars, 'lightMap', m.mapLight, m.mapLightRepeat, m.mapLightOffset, m.mapLightWrap, m.mapLightAnisotropy );\r\n\r\n\t\t}\r\n\r\n\t\tif ( m.mapBump && texturePath ) {\r\n\r\n\t\t\tcreate_texture( mpars, 'bumpMap', m.mapBump, m.mapBumpRepeat, m.mapBumpOffset, m.mapBumpWrap, m.mapBumpAnisotropy );\r\n\r\n\t\t}\r\n\r\n\t\tif ( m.mapNormal && texturePath ) {\r\n\r\n\t\t\tcreate_texture( mpars, 'normalMap', m.mapNormal, m.mapNormalRepeat, m.mapNormalOffset, m.mapNormalWrap, m.mapNormalAnisotropy );\r\n\r\n\t\t}\r\n\r\n\t\tif ( m.mapSpecular && texturePath ) {\r\n\r\n\t\t\tcreate_texture( mpars, 'specularMap', m.mapSpecular, m.mapSpecularRepeat, m.mapSpecularOffset, m.mapSpecularWrap, m.mapSpecularAnisotropy );\r\n\r\n\t\t}\r\n\r\n\t\tif ( m.mapAlpha && texturePath ) {\r\n\r\n\t\t\tcreate_texture( mpars, 'alphaMap', m.mapAlpha, m.mapAlphaRepeat, m.mapAlphaOffset, m.mapAlphaWrap, m.mapAlphaAnisotropy );\r\n\r\n\t\t}\r\n\r\n\t\t//\r\n\r\n\t\tif ( m.mapBumpScale ) {\r\n\r\n\t\t\tmpars.bumpScale = m.mapBumpScale;\r\n\r\n\t\t}\r\n\r\n\t\tif ( m.mapNormalFactor ) {\r\n\r\n\t\t\tmpars.normalScale = new THREE.Vector2( m.mapNormalFactor, m.mapNormalFactor );\r\n\r\n\t\t}\r\n\r\n\t\tvar material = new THREE[ mtype ]( mpars );\r\n\r\n\t\tif ( m.DbgName !== undefined ) material.name = m.DbgName;\r\n\r\n\t\treturn material;\r\n\r\n\t}\r\n\r\n};\r\n\r\nTHREE.Loader.Handlers = {\r\n\r\n\thandlers: [],\r\n\r\n\tadd: function ( regex, loader ) {\r\n\r\n\t\tthis.handlers.push( regex, loader );\r\n\r\n\t},\r\n\r\n\tget: function ( file ) {\r\n\r\n\t\tfor ( var i = 0, l = this.handlers.length; i < l; i += 2 ) {\r\n\r\n\t\t\tvar regex = this.handlers[ i ];\r\n\t\t\tvar loader  = this.handlers[ i + 1 ];\r\n\r\n\t\t\tif ( regex.test( file ) ) {\r\n\r\n\t\t\t\treturn loader;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\treturn null;\r\n\r\n\t}\r\n\r\n};\r\n\r\n// File:src/loaders/XHRLoader.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.XHRLoader = function ( manager ) {\r\n\r\n\tthis.manager = ( manager !== undefined ) ? manager : THREE.DefaultLoadingManager;\r\n\r\n};\r\n\r\nTHREE.XHRLoader.prototype = {\r\n\r\n\tconstructor: THREE.XHRLoader,\r\n\r\n\tload: function ( url, onLoad, onProgress, onError ) {\r\n\r\n\t\tvar scope = this;\r\n\r\n\t\tvar cached = THREE.Cache.get( url );\r\n\r\n\t\tif ( cached !== undefined ) {\r\n\r\n\t\t\tif ( onLoad ) onLoad( cached );\r\n\t\t\treturn;\r\n\r\n\t\t}\r\n\r\n\t\tvar request = new XMLHttpRequest();\r\n\t\trequest.open( 'GET', url, true );\r\n\r\n\t\trequest.addEventListener( 'load', function ( event ) {\r\n\r\n\t\t\tTHREE.Cache.add( url, this.response );\r\n\r\n\t\t\tif ( onLoad ) onLoad( this.response );\r\n\r\n\t\t\tscope.manager.itemEnd( url );\r\n\r\n\t\t}, false );\r\n\r\n\t\tif ( onProgress !== undefined ) {\r\n\r\n\t\t\trequest.addEventListener( 'progress', function ( event ) {\r\n\r\n\t\t\t\tonProgress( event );\r\n\r\n\t\t\t}, false );\r\n\r\n\t\t}\r\n\r\n\t\tif ( onError !== undefined ) {\r\n\r\n\t\t\trequest.addEventListener( 'error', function ( event ) {\r\n\r\n\t\t\t\tonError( event );\r\n\r\n\t\t\t}, false );\r\n\r\n\t\t}\r\n\r\n\t\tif ( this.crossOrigin !== undefined ) request.crossOrigin = this.crossOrigin;\r\n\t\tif ( this.responseType !== undefined ) request.responseType = this.responseType;\r\n\r\n\t\trequest.send( null );\r\n\r\n\t\tscope.manager.itemStart( url );\r\n\r\n\t},\r\n\r\n\tsetResponseType: function ( value ) {\r\n\r\n\t\tthis.responseType = value;\r\n\r\n\t},\r\n\r\n\tsetCrossOrigin: function ( value ) {\r\n\r\n\t\tthis.crossOrigin = value;\r\n\r\n\t}\r\n\r\n};\r\n\r\n// File:src/loaders/ImageLoader.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.ImageLoader = function ( manager ) {\r\n\r\n\tthis.manager = ( manager !== undefined ) ? manager : THREE.DefaultLoadingManager;\r\n\r\n};\r\n\r\nTHREE.ImageLoader.prototype = {\r\n\r\n\tconstructor: THREE.ImageLoader,\r\n\r\n\tload: function ( url, onLoad, onProgress, onError ) {\r\n\r\n\t\tvar scope = this;\r\n\r\n\t\tvar cached = THREE.Cache.get( url );\r\n\r\n\t\tif ( cached !== undefined ) {\r\n\r\n\t\t\tonLoad( cached );\r\n\t\t\treturn;\r\n\r\n\t\t}\r\n\r\n\t\tvar image = document.createElement( 'img' );\r\n\r\n\t\timage.addEventListener( 'load', function ( event ) {\r\n\r\n\t\t\tTHREE.Cache.add( url, this );\r\n\r\n\t\t\tif ( onLoad ) onLoad( this );\r\n\t\t\t\r\n\t\t\tscope.manager.itemEnd( url );\r\n\r\n\t\t}, false );\r\n\r\n\t\tif ( onProgress !== undefined ) {\r\n\r\n\t\t\timage.addEventListener( 'progress', function ( event ) {\r\n\r\n\t\t\t\tonProgress( event );\r\n\r\n\t\t\t}, false );\r\n\r\n\t\t}\r\n\r\n\t\tif ( onError !== undefined ) {\r\n\r\n\t\t\timage.addEventListener( 'error', function ( event ) {\r\n\r\n\t\t\t\tonError( event );\r\n\r\n\t\t\t}, false );\r\n\r\n\t\t}\r\n\r\n\t\tif ( this.crossOrigin !== undefined ) image.crossOrigin = this.crossOrigin;\r\n\r\n\t\timage.src = url;\r\n\r\n\t\tscope.manager.itemStart( url );\r\n\r\n\t\treturn image;\r\n\r\n\t},\r\n\r\n\tsetCrossOrigin: function ( value ) {\r\n\r\n\t\tthis.crossOrigin = value;\r\n\r\n\t}\r\n\r\n}\r\n\r\n// File:src/loaders/JSONLoader.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author alteredq / http://alteredqualia.com/\r\n */\r\n\r\nTHREE.JSONLoader = function ( showStatus ) {\r\n\r\n\tTHREE.Loader.call( this, showStatus );\r\n\r\n\tthis.withCredentials = false;\r\n\r\n};\r\n\r\nTHREE.JSONLoader.prototype = Object.create( THREE.Loader.prototype );\r\nTHREE.JSONLoader.prototype.constructor = THREE.JSONLoader;\r\n\r\nTHREE.JSONLoader.prototype.load = function ( url, callback, texturePath ) {\r\n\r\n\t// todo: unify load API to for easier SceneLoader use\r\n\r\n\ttexturePath = texturePath && ( typeof texturePath === 'string' ) ? texturePath : this.extractUrlBase( url );\r\n\r\n\tthis.onLoadStart();\r\n\tthis.loadAjaxJSON( this, url, callback, texturePath );\r\n\r\n};\r\n\r\nTHREE.JSONLoader.prototype.loadAjaxJSON = function ( context, url, callback, texturePath, callbackProgress ) {\r\n\r\n\tvar xhr = new XMLHttpRequest();\r\n\r\n\tvar length = 0;\r\n\r\n\txhr.onreadystatechange = function () {\r\n\r\n\t\tif ( xhr.readyState === xhr.DONE ) {\r\n\r\n\t\t\tif ( xhr.status === 200 || xhr.status === 0 ) {\r\n\r\n\t\t\t\tif ( xhr.responseText ) {\r\n\r\n\t\t\t\t\tvar json = JSON.parse( xhr.responseText );\r\n\t\t\t\t\tvar metadata = json.metadata;\r\n\r\n\t\t\t\t\tif ( metadata !== undefined ) {\r\n\r\n\t\t\t\t\t\tif ( metadata.type === 'object' ) {\r\n\r\n\t\t\t\t\t\t\tTHREE.error( 'THREE.JSONLoader: ' + url + ' should be loaded with THREE.ObjectLoader instead.' );\r\n\t\t\t\t\t\t\treturn;\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tif ( metadata.type === 'scene' ) {\r\n\r\n\t\t\t\t\t\t\tTHREE.error( 'THREE.JSONLoader: ' + url + ' seems to be a Scene. Use THREE.SceneLoader instead.' );\r\n\t\t\t\t\t\t\treturn;\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tvar result = context.parse( json, texturePath );\r\n\t\t\t\t\tcallback( result.geometry, result.materials );\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\tTHREE.error( 'THREE.JSONLoader: ' + url + ' seems to be unreachable or the file is empty.' );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// in context of more complex asset initialization\r\n\t\t\t\t// do not block on single failed file\r\n\t\t\t\t// maybe should go even one more level up\r\n\r\n\t\t\t\tcontext.onLoadComplete();\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tTHREE.error( 'THREE.JSONLoader: Couldn\\'t load ' + url + ' (' + xhr.status + ')' );\r\n\r\n\t\t\t}\r\n\r\n\t\t} else if ( xhr.readyState === xhr.LOADING ) {\r\n\r\n\t\t\tif ( callbackProgress ) {\r\n\r\n\t\t\t\tif ( length === 0 ) {\r\n\r\n\t\t\t\t\tlength = xhr.getResponseHeader( 'Content-Length' );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tcallbackProgress( { total: length, loaded: xhr.responseText.length } );\r\n\r\n\t\t\t}\r\n\r\n\t\t} else if ( xhr.readyState === xhr.HEADERS_RECEIVED ) {\r\n\r\n\t\t\tif ( callbackProgress !== undefined ) {\r\n\r\n\t\t\t\tlength = xhr.getResponseHeader( 'Content-Length' );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t};\r\n\r\n\txhr.open( 'GET', url, true );\r\n\txhr.withCredentials = this.withCredentials;\r\n\txhr.send( null );\r\n\r\n};\r\n\r\nTHREE.JSONLoader.prototype.parse = function ( json, texturePath ) {\r\n\r\n\tvar geometry = new THREE.Geometry(),\r\n\tscale = ( json.scale !== undefined ) ? 1.0 / json.scale : 1.0;\r\n\r\n\tparseModel( scale );\r\n\r\n\tparseSkin();\r\n\tparseMorphing( scale );\r\n\r\n\tgeometry.computeFaceNormals();\r\n\tgeometry.computeBoundingSphere();\r\n\r\n\tfunction parseModel( scale ) {\r\n\r\n\t\tfunction isBitSet( value, position ) {\r\n\r\n\t\t\treturn value & ( 1 << position );\r\n\r\n\t\t}\r\n\r\n\t\tvar i, j, fi,\r\n\r\n\t\toffset, zLength,\r\n\r\n\t\tcolorIndex, normalIndex, uvIndex, materialIndex,\r\n\r\n\t\ttype,\r\n\t\tisQuad,\r\n\t\thasMaterial,\r\n\t\thasFaceVertexUv,\r\n\t\thasFaceNormal, hasFaceVertexNormal,\r\n\t\thasFaceColor, hasFaceVertexColor,\r\n\r\n\t\tvertex, face, faceA, faceB, hex, normal,\r\n\r\n\t\tuvLayer, uv, u, v,\r\n\r\n\t\tfaces = json.faces,\r\n\t\tvertices = json.vertices,\r\n\t\tnormals = json.normals,\r\n\t\tcolors = json.colors,\r\n\r\n\t\tnUvLayers = 0;\r\n\r\n\t\tif ( json.uvs !== undefined ) {\r\n\r\n\t\t\t// disregard empty arrays\r\n\r\n\t\t\tfor ( i = 0; i < json.uvs.length; i ++ ) {\r\n\r\n\t\t\t\tif ( json.uvs[ i ].length ) nUvLayers ++;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tfor ( i = 0; i < nUvLayers; i ++ ) {\r\n\r\n\t\t\t\tgeometry.faceVertexUvs[ i ] = [];\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\toffset = 0;\r\n\t\tzLength = vertices.length;\r\n\r\n\t\twhile ( offset < zLength ) {\r\n\r\n\t\t\tvertex = new THREE.Vector3();\r\n\r\n\t\t\tvertex.x = vertices[ offset ++ ] * scale;\r\n\t\t\tvertex.y = vertices[ offset ++ ] * scale;\r\n\t\t\tvertex.z = vertices[ offset ++ ] * scale;\r\n\r\n\t\t\tgeometry.vertices.push( vertex );\r\n\r\n\t\t}\r\n\r\n\t\toffset = 0;\r\n\t\tzLength = faces.length;\r\n\r\n\t\twhile ( offset < zLength ) {\r\n\r\n\t\t\ttype = faces[ offset ++ ];\r\n\r\n\r\n\t\t\tisQuad              = isBitSet( type, 0 );\r\n\t\t\thasMaterial         = isBitSet( type, 1 );\r\n\t\t\thasFaceVertexUv     = isBitSet( type, 3 );\r\n\t\t\thasFaceNormal       = isBitSet( type, 4 );\r\n\t\t\thasFaceVertexNormal = isBitSet( type, 5 );\r\n\t\t\thasFaceColor\t     = isBitSet( type, 6 );\r\n\t\t\thasFaceVertexColor  = isBitSet( type, 7 );\r\n\r\n\t\t\t// console.log(\"type\", type, \"bits\", isQuad, hasMaterial, hasFaceVertexUv, hasFaceNormal, hasFaceVertexNormal, hasFaceColor, hasFaceVertexColor);\r\n\r\n\t\t\tif ( isQuad ) {\r\n\r\n\t\t\t\tfaceA = new THREE.Face3();\r\n\t\t\t\tfaceA.a = faces[ offset ];\r\n\t\t\t\tfaceA.b = faces[ offset + 1 ];\r\n\t\t\t\tfaceA.c = faces[ offset + 3 ];\r\n\r\n\t\t\t\tfaceB = new THREE.Face3();\r\n\t\t\t\tfaceB.a = faces[ offset + 1 ];\r\n\t\t\t\tfaceB.b = faces[ offset + 2 ];\r\n\t\t\t\tfaceB.c = faces[ offset + 3 ];\r\n\r\n\t\t\t\toffset += 4;\r\n\r\n\t\t\t\tif ( hasMaterial ) {\r\n\r\n\t\t\t\t\tmaterialIndex = faces[ offset ++ ];\r\n\t\t\t\t\tfaceA.materialIndex = materialIndex;\r\n\t\t\t\t\tfaceB.materialIndex = materialIndex;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// to get face <=> uv index correspondence\r\n\r\n\t\t\t\tfi = geometry.faces.length;\r\n\r\n\t\t\t\tif ( hasFaceVertexUv ) {\r\n\r\n\t\t\t\t\tfor ( i = 0; i < nUvLayers; i ++ ) {\r\n\r\n\t\t\t\t\t\tuvLayer = json.uvs[ i ];\r\n\r\n\t\t\t\t\t\tgeometry.faceVertexUvs[ i ][ fi ] = [];\r\n\t\t\t\t\t\tgeometry.faceVertexUvs[ i ][ fi + 1 ] = []\r\n\r\n\t\t\t\t\t\tfor ( j = 0; j < 4; j ++ ) {\r\n\r\n\t\t\t\t\t\t\tuvIndex = faces[ offset ++ ];\r\n\r\n\t\t\t\t\t\t\tu = uvLayer[ uvIndex * 2 ];\r\n\t\t\t\t\t\t\tv = uvLayer[ uvIndex * 2 + 1 ];\r\n\r\n\t\t\t\t\t\t\tuv = new THREE.Vector2( u, v );\r\n\r\n\t\t\t\t\t\t\tif ( j !== 2 ) geometry.faceVertexUvs[ i ][ fi ].push( uv );\r\n\t\t\t\t\t\t\tif ( j !== 0 ) geometry.faceVertexUvs[ i ][ fi + 1 ].push( uv );\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( hasFaceNormal ) {\r\n\r\n\t\t\t\t\tnormalIndex = faces[ offset ++ ] * 3;\r\n\r\n\t\t\t\t\tfaceA.normal.set(\r\n\t\t\t\t\t\tnormals[ normalIndex ++ ],\r\n\t\t\t\t\t\tnormals[ normalIndex ++ ],\r\n\t\t\t\t\t\tnormals[ normalIndex ]\r\n\t\t\t\t\t);\r\n\r\n\t\t\t\t\tfaceB.normal.copy( faceA.normal );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( hasFaceVertexNormal ) {\r\n\r\n\t\t\t\t\tfor ( i = 0; i < 4; i ++ ) {\r\n\r\n\t\t\t\t\t\tnormalIndex = faces[ offset ++ ] * 3;\r\n\r\n\t\t\t\t\t\tnormal = new THREE.Vector3(\r\n\t\t\t\t\t\t\tnormals[ normalIndex ++ ],\r\n\t\t\t\t\t\t\tnormals[ normalIndex ++ ],\r\n\t\t\t\t\t\t\tnormals[ normalIndex ]\r\n\t\t\t\t\t\t);\r\n\r\n\r\n\t\t\t\t\t\tif ( i !== 2 ) faceA.vertexNormals.push( normal );\r\n\t\t\t\t\t\tif ( i !== 0 ) faceB.vertexNormals.push( normal );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\r\n\r\n\t\t\t\tif ( hasFaceColor ) {\r\n\r\n\t\t\t\t\tcolorIndex = faces[ offset ++ ];\r\n\t\t\t\t\thex = colors[ colorIndex ];\r\n\r\n\t\t\t\t\tfaceA.color.setHex( hex );\r\n\t\t\t\t\tfaceB.color.setHex( hex );\r\n\r\n\t\t\t\t}\r\n\r\n\r\n\t\t\t\tif ( hasFaceVertexColor ) {\r\n\r\n\t\t\t\t\tfor ( i = 0; i < 4; i ++ ) {\r\n\r\n\t\t\t\t\t\tcolorIndex = faces[ offset ++ ];\r\n\t\t\t\t\t\thex = colors[ colorIndex ];\r\n\r\n\t\t\t\t\t\tif ( i !== 2 ) faceA.vertexColors.push( new THREE.Color( hex ) );\r\n\t\t\t\t\t\tif ( i !== 0 ) faceB.vertexColors.push( new THREE.Color( hex ) );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tgeometry.faces.push( faceA );\r\n\t\t\t\tgeometry.faces.push( faceB );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tface = new THREE.Face3();\r\n\t\t\t\tface.a = faces[ offset ++ ];\r\n\t\t\t\tface.b = faces[ offset ++ ];\r\n\t\t\t\tface.c = faces[ offset ++ ];\r\n\r\n\t\t\t\tif ( hasMaterial ) {\r\n\r\n\t\t\t\t\tmaterialIndex = faces[ offset ++ ];\r\n\t\t\t\t\tface.materialIndex = materialIndex;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// to get face <=> uv index correspondence\r\n\r\n\t\t\t\tfi = geometry.faces.length;\r\n\r\n\t\t\t\tif ( hasFaceVertexUv ) {\r\n\r\n\t\t\t\t\tfor ( i = 0; i < nUvLayers; i ++ ) {\r\n\r\n\t\t\t\t\t\tuvLayer = json.uvs[ i ];\r\n\r\n\t\t\t\t\t\tgeometry.faceVertexUvs[ i ][ fi ] = [];\r\n\r\n\t\t\t\t\t\tfor ( j = 0; j < 3; j ++ ) {\r\n\r\n\t\t\t\t\t\t\tuvIndex = faces[ offset ++ ];\r\n\r\n\t\t\t\t\t\t\tu = uvLayer[ uvIndex * 2 ];\r\n\t\t\t\t\t\t\tv = uvLayer[ uvIndex * 2 + 1 ];\r\n\r\n\t\t\t\t\t\t\tuv = new THREE.Vector2( u, v );\r\n\r\n\t\t\t\t\t\t\tgeometry.faceVertexUvs[ i ][ fi ].push( uv );\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( hasFaceNormal ) {\r\n\r\n\t\t\t\t\tnormalIndex = faces[ offset ++ ] * 3;\r\n\r\n\t\t\t\t\tface.normal.set(\r\n\t\t\t\t\t\tnormals[ normalIndex ++ ],\r\n\t\t\t\t\t\tnormals[ normalIndex ++ ],\r\n\t\t\t\t\t\tnormals[ normalIndex ]\r\n\t\t\t\t\t);\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( hasFaceVertexNormal ) {\r\n\r\n\t\t\t\t\tfor ( i = 0; i < 3; i ++ ) {\r\n\r\n\t\t\t\t\t\tnormalIndex = faces[ offset ++ ] * 3;\r\n\r\n\t\t\t\t\t\tnormal = new THREE.Vector3(\r\n\t\t\t\t\t\t\tnormals[ normalIndex ++ ],\r\n\t\t\t\t\t\t\tnormals[ normalIndex ++ ],\r\n\t\t\t\t\t\t\tnormals[ normalIndex ]\r\n\t\t\t\t\t\t);\r\n\r\n\t\t\t\t\t\tface.vertexNormals.push( normal );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\r\n\r\n\t\t\t\tif ( hasFaceColor ) {\r\n\r\n\t\t\t\t\tcolorIndex = faces[ offset ++ ];\r\n\t\t\t\t\tface.color.setHex( colors[ colorIndex ] );\r\n\r\n\t\t\t\t}\r\n\r\n\r\n\t\t\t\tif ( hasFaceVertexColor ) {\r\n\r\n\t\t\t\t\tfor ( i = 0; i < 3; i ++ ) {\r\n\r\n\t\t\t\t\t\tcolorIndex = faces[ offset ++ ];\r\n\t\t\t\t\t\tface.vertexColors.push( new THREE.Color( colors[ colorIndex ] ) );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tgeometry.faces.push( face );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t};\r\n\r\n\tfunction parseSkin() {\r\n\t\tvar influencesPerVertex = ( json.influencesPerVertex !== undefined ) ? json.influencesPerVertex : 2;\r\n\r\n\t\tif ( json.skinWeights ) {\r\n\r\n\t\t\tfor ( var i = 0, l = json.skinWeights.length; i < l; i += influencesPerVertex ) {\r\n\r\n\t\t\t\tvar x =                               json.skinWeights[ i     ];\r\n\t\t\t\tvar y = ( influencesPerVertex > 1 ) ? json.skinWeights[ i + 1 ] : 0;\r\n\t\t\t\tvar z = ( influencesPerVertex > 2 ) ? json.skinWeights[ i + 2 ] : 0;\r\n\t\t\t\tvar w = ( influencesPerVertex > 3 ) ? json.skinWeights[ i + 3 ] : 0;\r\n\r\n\t\t\t\tgeometry.skinWeights.push( new THREE.Vector4( x, y, z, w ) );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tif ( json.skinIndices ) {\r\n\r\n\t\t\tfor ( var i = 0, l = json.skinIndices.length; i < l; i += influencesPerVertex ) {\r\n\r\n\t\t\t\tvar a =                               json.skinIndices[ i     ];\r\n\t\t\t\tvar b = ( influencesPerVertex > 1 ) ? json.skinIndices[ i + 1 ] : 0;\r\n\t\t\t\tvar c = ( influencesPerVertex > 2 ) ? json.skinIndices[ i + 2 ] : 0;\r\n\t\t\t\tvar d = ( influencesPerVertex > 3 ) ? json.skinIndices[ i + 3 ] : 0;\r\n\r\n\t\t\t\tgeometry.skinIndices.push( new THREE.Vector4( a, b, c, d ) );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tgeometry.bones = json.bones;\r\n\r\n\t\tif ( geometry.bones && geometry.bones.length > 0 && ( geometry.skinWeights.length !== geometry.skinIndices.length || geometry.skinIndices.length !== geometry.vertices.length ) ) {\r\n\r\n\t\t\tTHREE.warn( 'THREE.JSONLoader: When skinning, number of vertices (' + geometry.vertices.length + '), skinIndices (' +\r\n\t\t\t\t\tgeometry.skinIndices.length + '), and skinWeights (' + geometry.skinWeights.length + ') should match.' );\r\n\r\n\t\t}\r\n\r\n\r\n\t\t// could change this to json.animations[0] or remove completely\r\n\r\n\t\tgeometry.animation = json.animation;\r\n\t\tgeometry.animations = json.animations;\r\n\r\n\t};\r\n\r\n\tfunction parseMorphing( scale ) {\r\n\r\n\t\tif ( json.morphTargets !== undefined ) {\r\n\r\n\t\t\tvar i, l, v, vl, dstVertices, srcVertices;\r\n\r\n\t\t\tfor ( i = 0, l = json.morphTargets.length; i < l; i ++ ) {\r\n\r\n\t\t\t\tgeometry.morphTargets[ i ] = {};\r\n\t\t\t\tgeometry.morphTargets[ i ].name = json.morphTargets[ i ].name;\r\n\t\t\t\tgeometry.morphTargets[ i ].vertices = [];\r\n\r\n\t\t\t\tdstVertices = geometry.morphTargets[ i ].vertices;\r\n\t\t\t\tsrcVertices = json.morphTargets [ i ].vertices;\r\n\r\n\t\t\t\tfor ( v = 0, vl = srcVertices.length; v < vl; v += 3 ) {\r\n\r\n\t\t\t\t\tvar vertex = new THREE.Vector3();\r\n\t\t\t\t\tvertex.x = srcVertices[ v ] * scale;\r\n\t\t\t\t\tvertex.y = srcVertices[ v + 1 ] * scale;\r\n\t\t\t\t\tvertex.z = srcVertices[ v + 2 ] * scale;\r\n\r\n\t\t\t\t\tdstVertices.push( vertex );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tif ( json.morphColors !== undefined ) {\r\n\r\n\t\t\tvar i, l, c, cl, dstColors, srcColors, color;\r\n\r\n\t\t\tfor ( i = 0, l = json.morphColors.length; i < l; i ++ ) {\r\n\r\n\t\t\t\tgeometry.morphColors[ i ] = {};\r\n\t\t\t\tgeometry.morphColors[ i ].name = json.morphColors[ i ].name;\r\n\t\t\t\tgeometry.morphColors[ i ].colors = [];\r\n\r\n\t\t\t\tdstColors = geometry.morphColors[ i ].colors;\r\n\t\t\t\tsrcColors = json.morphColors [ i ].colors;\r\n\r\n\t\t\t\tfor ( c = 0, cl = srcColors.length; c < cl; c += 3 ) {\r\n\r\n\t\t\t\t\tcolor = new THREE.Color( 0xffaa00 );\r\n\t\t\t\t\tcolor.setRGB( srcColors[ c ], srcColors[ c + 1 ], srcColors[ c + 2 ] );\r\n\t\t\t\t\tdstColors.push( color );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t};\r\n\r\n\tif ( json.materials === undefined || json.materials.length === 0 ) {\r\n\r\n\t\treturn { geometry: geometry };\r\n\r\n\t} else {\r\n\r\n\t\tvar materials = this.initMaterials( json.materials, texturePath );\r\n\r\n\t\tif ( this.needsTangents( materials ) ) {\r\n\r\n\t\t\tgeometry.computeTangents();\r\n\r\n\t\t}\r\n\r\n\t\treturn { geometry: geometry, materials: materials };\r\n\r\n\t}\r\n\r\n};\r\n\r\n// File:src/loaders/LoadingManager.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.LoadingManager = function ( onLoad, onProgress, onError ) {\r\n\r\n\tvar scope = this;\r\n\r\n\tvar loaded = 0, total = 0;\r\n\r\n\tthis.onLoad = onLoad;\r\n\tthis.onProgress = onProgress;\r\n\tthis.onError = onError;\r\n\r\n\tthis.itemStart = function ( url ) {\r\n\r\n\t\ttotal ++;\r\n\r\n\t};\r\n\r\n\tthis.itemEnd = function ( url ) {\r\n\r\n\t\tloaded ++;\r\n\r\n\t\tif ( scope.onProgress !== undefined ) {\r\n\r\n\t\t\tscope.onProgress( url, loaded, total );\r\n\r\n\t\t}\r\n\r\n\t\tif ( loaded === total && scope.onLoad !== undefined ) {\r\n\r\n\t\t\tscope.onLoad();\r\n\r\n\t\t}\r\n\r\n\t};\r\n\r\n};\r\n\r\nTHREE.DefaultLoadingManager = new THREE.LoadingManager();\r\n\r\n// File:src/loaders/BufferGeometryLoader.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.BufferGeometryLoader = function ( manager ) {\r\n\r\n\tthis.manager = ( manager !== undefined ) ? manager : THREE.DefaultLoadingManager;\r\n\r\n};\r\n\r\nTHREE.BufferGeometryLoader.prototype = {\r\n\r\n\tconstructor: THREE.BufferGeometryLoader,\r\n\r\n\tload: function ( url, onLoad, onProgress, onError ) {\r\n\r\n\t\tvar scope = this;\r\n\r\n\t\tvar loader = new THREE.XHRLoader( scope.manager );\r\n\t\tloader.setCrossOrigin( this.crossOrigin );\r\n\t\tloader.load( url, function ( text ) {\r\n\r\n\t\t\tonLoad( scope.parse( JSON.parse( text ) ) );\r\n\r\n\t\t}, onProgress, onError );\r\n\r\n\t},\r\n\r\n\tsetCrossOrigin: function ( value ) {\r\n\r\n\t\tthis.crossOrigin = value;\r\n\r\n\t},\r\n\r\n\tparse: function ( json ) {\r\n\r\n\t\tvar geometry = new THREE.BufferGeometry();\r\n\r\n\t\tvar attributes = json.data.attributes;\r\n\r\n\t\tfor ( var key in attributes ) {\r\n\r\n\t\t\tvar attribute = attributes[ key ];\r\n\t\t\tvar typedArray = new self[ attribute.type ]( attribute.array );\r\n\r\n\t\t\tgeometry.addAttribute( key, new THREE.BufferAttribute( typedArray, attribute.itemSize ) );\r\n\r\n\t\t}\r\n\r\n\t\tvar offsets = json.data.offsets;\r\n\r\n\t\tif ( offsets !== undefined ) {\r\n\r\n\t\t\tgeometry.offsets = JSON.parse( JSON.stringify( offsets ) );\r\n\r\n\t\t}\r\n\r\n\t\tvar boundingSphere = json.data.boundingSphere;\r\n\r\n\t\tif ( boundingSphere !== undefined ) {\r\n\r\n\t\t\tvar center = new THREE.Vector3();\r\n\r\n\t\t\tif ( boundingSphere.center !== undefined ) {\r\n\r\n\t\t\t\tcenter.fromArray( boundingSphere.center );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tgeometry.boundingSphere = new THREE.Sphere( center, boundingSphere.radius );\r\n\r\n\t\t}\r\n\r\n\t\treturn geometry;\r\n\r\n\t}\r\n\r\n};\r\n\r\n// File:src/loaders/MaterialLoader.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.MaterialLoader = function ( manager ) {\r\n\r\n\tthis.manager = ( manager !== undefined ) ? manager : THREE.DefaultLoadingManager;\r\n\r\n};\r\n\r\nTHREE.MaterialLoader.prototype = {\r\n\r\n\tconstructor: THREE.MaterialLoader,\r\n\r\n\tload: function ( url, onLoad, onProgress, onError ) {\r\n\r\n\t\tvar scope = this;\r\n\r\n\t\tvar loader = new THREE.XHRLoader( scope.manager );\r\n\t\tloader.setCrossOrigin( this.crossOrigin );\r\n\t\tloader.load( url, function ( text ) {\r\n\r\n\t\t\tonLoad( scope.parse( JSON.parse( text ) ) );\r\n\r\n\t\t}, onProgress, onError );\r\n\r\n\t},\r\n\r\n\tsetCrossOrigin: function ( value ) {\r\n\r\n\t\tthis.crossOrigin = value;\r\n\r\n\t},\r\n\r\n\tparse: function ( json ) {\r\n\r\n\t\tvar material = new THREE[ json.type ];\r\n\r\n\t\tif ( json.color !== undefined ) material.color.setHex( json.color );\r\n\t\tif ( json.emissive !== undefined ) material.emissive.setHex( json.emissive );\r\n\t\tif ( json.specular !== undefined ) material.specular.setHex( json.specular );\r\n\t\tif ( json.shininess !== undefined ) material.shininess = json.shininess;\r\n\t\tif ( json.uniforms !== undefined ) material.uniforms = json.uniforms;\r\n\t\tif ( json.vertexShader !== undefined ) material.vertexShader = json.vertexShader;\r\n\t\tif ( json.fragmentShader !== undefined ) material.fragmentShader = json.fragmentShader;\r\n\t\tif ( json.vertexColors !== undefined ) material.vertexColors = json.vertexColors;\r\n\t\tif ( json.shading !== undefined ) material.shading = json.shading;\r\n\t\tif ( json.blending !== undefined ) material.blending = json.blending;\r\n\t\tif ( json.side !== undefined ) material.side = json.side;\r\n\t\tif ( json.opacity !== undefined ) material.opacity = json.opacity;\r\n\t\tif ( json.transparent !== undefined ) material.transparent = json.transparent;\r\n\t\tif ( json.wireframe !== undefined ) material.wireframe = json.wireframe;\r\n\r\n\t\t// for PointCloudMaterial\r\n\t\tif ( json.size !== undefined ) material.size = json.size;\r\n\t\tif ( json.sizeAttenuation !== undefined ) material.sizeAttenuation = json.sizeAttenuation;\r\n\r\n\t\tif ( json.materials !== undefined ) {\r\n\r\n\t\t\tfor ( var i = 0, l = json.materials.length; i < l; i ++ ) {\r\n\r\n\t\t\t\tmaterial.materials.push( this.parse( json.materials[ i ] ) );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\treturn material;\r\n\r\n\t}\r\n\r\n};\r\n\r\n// File:src/loaders/ObjectLoader.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.ObjectLoader = function ( manager ) {\r\n\r\n\tthis.manager = ( manager !== undefined ) ? manager : THREE.DefaultLoadingManager;\r\n\tthis.texturePath = '';\r\n\r\n};\r\n\r\nTHREE.ObjectLoader.prototype = {\r\n\r\n\tconstructor: THREE.ObjectLoader,\r\n\r\n\tload: function ( url, onLoad, onProgress, onError ) {\r\n\r\n\t\tif ( this.texturePath === '' ) {\r\n\r\n\t\t\tthis.texturePath = url.substring( 0, url.lastIndexOf( '/' ) + 1 );\r\n\r\n\t\t}\r\n\r\n\t\tvar scope = this;\r\n\r\n\t\tvar loader = new THREE.XHRLoader( scope.manager );\r\n\t\tloader.setCrossOrigin( this.crossOrigin );\r\n\t\tloader.load( url, function ( text ) {\r\n\r\n\t\t\tscope.parse( JSON.parse( text ), onLoad );\r\n\r\n\t\t}, onProgress, onError );\r\n\r\n\t},\r\n\r\n\tsetTexturePath: function ( value ) {\r\n\r\n\t\tthis.texturePath = value;\r\n\r\n\t},\r\n\r\n\tsetCrossOrigin: function ( value ) {\r\n\r\n\t\tthis.crossOrigin = value;\r\n\r\n\t},\r\n\r\n\tparse: function ( json, onLoad ) {\r\n\r\n\t\tvar geometries = this.parseGeometries( json.geometries );\r\n\r\n\t\tvar images = this.parseImages( json.images, function () {\r\n\r\n\t\t\tif ( onLoad !== undefined ) onLoad( object );\r\n\r\n\t\t} );\r\n\t\tvar textures  = this.parseTextures( json.textures, images );\r\n\t\tvar materials = this.parseMaterials( json.materials, textures );\r\n\t\tvar object = this.parseObject( json.object, geometries, materials );\r\n\r\n\t\tif ( json.images === undefined || json.images.length === 0 ) {\r\n\r\n\t\t\tif ( onLoad !== undefined ) onLoad( object );\r\n\r\n\t\t}\r\n\r\n\t\treturn object;\r\n\r\n\t},\r\n\r\n\tparseGeometries: function ( json ) {\r\n\r\n\t\tvar geometries = {};\r\n\r\n\t\tif ( json !== undefined ) {\r\n\r\n\t\t\tvar geometryLoader = new THREE.JSONLoader();\r\n\t\t\tvar bufferGeometryLoader = new THREE.BufferGeometryLoader();\r\n\r\n\t\t\tfor ( var i = 0, l = json.length; i < l; i ++ ) {\r\n\r\n\t\t\t\tvar geometry;\r\n\t\t\t\tvar data = json[ i ];\r\n\r\n\t\t\t\tswitch ( data.type ) {\r\n\r\n\t\t\t\t\tcase 'PlaneGeometry':\r\n\t\t\t\t\tcase 'PlaneBufferGeometry':\r\n\r\n\t\t\t\t\t\tgeometry = new THREE[ data.type ](\r\n\t\t\t\t\t\t\tdata.width,\r\n\t\t\t\t\t\t\tdata.height,\r\n\t\t\t\t\t\t\tdata.widthSegments,\r\n\t\t\t\t\t\t\tdata.heightSegments\r\n\t\t\t\t\t\t);\r\n\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase 'BoxGeometry':\r\n\t\t\t\t\tcase 'CubeGeometry': // backwards compatible\r\n\r\n\t\t\t\t\t\tgeometry = new THREE.BoxGeometry(\r\n\t\t\t\t\t\t\tdata.width,\r\n\t\t\t\t\t\t\tdata.height,\r\n\t\t\t\t\t\t\tdata.depth,\r\n\t\t\t\t\t\t\tdata.widthSegments,\r\n\t\t\t\t\t\t\tdata.heightSegments,\r\n\t\t\t\t\t\t\tdata.depthSegments\r\n\t\t\t\t\t\t);\r\n\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase 'CircleGeometry':\r\n\r\n\t\t\t\t\t\tgeometry = new THREE.CircleGeometry(\r\n\t\t\t\t\t\t\tdata.radius,\r\n\t\t\t\t\t\t\tdata.segments\r\n\t\t\t\t\t\t);\r\n\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase 'CylinderGeometry':\r\n\r\n\t\t\t\t\t\tgeometry = new THREE.CylinderGeometry(\r\n\t\t\t\t\t\t\tdata.radiusTop,\r\n\t\t\t\t\t\t\tdata.radiusBottom,\r\n\t\t\t\t\t\t\tdata.height,\r\n\t\t\t\t\t\t\tdata.radialSegments,\r\n\t\t\t\t\t\t\tdata.heightSegments,\r\n\t\t\t\t\t\t\tdata.openEnded\r\n\t\t\t\t\t\t);\r\n\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase 'SphereGeometry':\r\n\r\n\t\t\t\t\t\tgeometry = new THREE.SphereGeometry(\r\n\t\t\t\t\t\t\tdata.radius,\r\n\t\t\t\t\t\t\tdata.widthSegments,\r\n\t\t\t\t\t\t\tdata.heightSegments,\r\n\t\t\t\t\t\t\tdata.phiStart,\r\n\t\t\t\t\t\t\tdata.phiLength,\r\n\t\t\t\t\t\t\tdata.thetaStart,\r\n\t\t\t\t\t\t\tdata.thetaLength\r\n\t\t\t\t\t\t);\r\n\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase 'IcosahedronGeometry':\r\n\r\n\t\t\t\t\t\tgeometry = new THREE.IcosahedronGeometry(\r\n\t\t\t\t\t\t\tdata.radius,\r\n\t\t\t\t\t\t\tdata.detail\r\n\t\t\t\t\t\t);\r\n\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase 'TorusGeometry':\r\n\r\n\t\t\t\t\t\tgeometry = new THREE.TorusGeometry(\r\n\t\t\t\t\t\t\tdata.radius,\r\n\t\t\t\t\t\t\tdata.tube,\r\n\t\t\t\t\t\t\tdata.radialSegments,\r\n\t\t\t\t\t\t\tdata.tubularSegments,\r\n\t\t\t\t\t\t\tdata.arc\r\n\t\t\t\t\t\t);\r\n\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase 'TorusKnotGeometry':\r\n\r\n\t\t\t\t\t\tgeometry = new THREE.TorusKnotGeometry(\r\n\t\t\t\t\t\t\tdata.radius,\r\n\t\t\t\t\t\t\tdata.tube,\r\n\t\t\t\t\t\t\tdata.radialSegments,\r\n\t\t\t\t\t\t\tdata.tubularSegments,\r\n\t\t\t\t\t\t\tdata.p,\r\n\t\t\t\t\t\t\tdata.q,\r\n\t\t\t\t\t\t\tdata.heightScale\r\n\t\t\t\t\t\t);\r\n\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase 'BufferGeometry':\r\n\r\n\t\t\t\t\t\tgeometry = bufferGeometryLoader.parse( data );\r\n\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase 'Geometry':\r\n\r\n\t\t\t\t\t\tgeometry = geometryLoader.parse( data.data ).geometry;\r\n\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tgeometry.uuid = data.uuid;\r\n\r\n\t\t\t\tif ( data.name !== undefined ) geometry.name = data.name;\r\n\r\n\t\t\t\tgeometries[ data.uuid ] = geometry;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\treturn geometries;\r\n\r\n\t},\r\n\r\n\tparseMaterials: function ( json, textures ) {\r\n\r\n\t\tvar materials = {};\r\n\r\n\t\tif ( json !== undefined ) {\r\n\r\n\t\t\tvar getTexture = function ( name ) {\r\n\r\n\t\t\t\tif ( textures[ name ] === undefined ) {\r\n\r\n\t\t\t\t\tTHREE.warn( 'THREE.ObjectLoader: Undefined texture', name );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn textures[ name ];\r\n\r\n\t\t\t};\r\n\r\n\t\t\tvar loader = new THREE.MaterialLoader();\r\n\r\n\t\t\tfor ( var i = 0, l = json.length; i < l; i ++ ) {\r\n\r\n\t\t\t\tvar data = json[ i ];\r\n\t\t\t\tvar material = loader.parse( data );\r\n\r\n\t\t\t\tmaterial.uuid = data.uuid;\r\n\r\n\t\t\t\tif ( data.name !== undefined ) material.name = data.name;\r\n\r\n\t\t\t\tif ( data.map !== undefined ) {\r\n\r\n\t\t\t\t\tmaterial.map = getTexture( data.map );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( data.bumpMap !== undefined ) {\r\n\r\n\t\t\t\t\tmaterial.bumpMap = getTexture( data.bumpMap );\r\n\t\t\t\t\tif ( data.bumpScale ) {\r\n\t\t\t\t\t\tmaterial.bumpScale = new THREE.Vector2( data.bumpScale, data.bumpScale );\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( data.alphaMap !== undefined ) {\r\n\r\n\t\t\t\t\tmaterial.alphaMap = getTexture( data.alphaMap );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( data.envMap !== undefined ) {\r\n\r\n\t\t\t\t\tmaterial.envMap = getTexture( data.envMap );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( data.normalMap !== undefined ) {\r\n\r\n\t\t\t\t\tmaterial.normalMap = getTexture( data.normalMap );\r\n\t\t\t\t\tif ( data.normalScale ) {\r\n\t\t\t\t\t\tmaterial.normalScale = new THREE.Vector2( data.normalScale, data.normalScale );\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( data.lightMap !== undefined ) {\r\n\r\n\t\t\t\t\tmaterial.lightMap = getTexture( data.lightMap );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( data.specularMap !== undefined ) {\r\n\r\n\t\t\t\t\tmaterial.specularMap = getTexture( data.specularMap );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tmaterials[ data.uuid ] = material;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\treturn materials;\r\n\r\n\t},\r\n\r\n\tparseImages: function ( json, onLoad ) {\r\n\r\n\t\tvar scope = this;\r\n\t\tvar images = {};\r\n\r\n\t\tif ( json !== undefined && json.length > 0 ) {\r\n\r\n\t\t\tvar manager = new THREE.LoadingManager( onLoad );\r\n\r\n\t\t\tvar loader = new THREE.ImageLoader( manager );\r\n\t\t\tloader.setCrossOrigin( this.crossOrigin );\r\n\r\n\t\t\tvar loadImage = function ( url ) {\r\n\r\n\t\t\t\tscope.manager.itemStart( url );\r\n\r\n\t\t\t\treturn loader.load( url, function () {\r\n\r\n\t\t\t\t\tscope.manager.itemEnd( url );\r\n\r\n\t\t\t\t} );\r\n\r\n\t\t\t};\r\n\r\n\t\t\tfor ( var i = 0, l = json.length; i < l; i ++ ) {\r\n\r\n\t\t\t\tvar image = json[ i ];\r\n\t\t\t\tvar path = /^(\\/\\/)|([a-z]+:(\\/\\/)?)/i.test( image.url ) ? image.url : scope.texturePath + image.url;\r\n\r\n\t\t\t\timages[ image.uuid ] = loadImage( path );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\treturn images;\r\n\r\n\t},\r\n\r\n\tparseTextures: function ( json, images ) {\r\n\r\n\t\tvar textures = {};\r\n\r\n\t\tif ( json !== undefined ) {\r\n\r\n\t\t\tfor ( var i = 0, l = json.length; i < l; i ++ ) {\r\n\r\n\t\t\t\tvar data = json[ i ];\r\n\r\n\t\t\t\tif ( data.image === undefined ) {\r\n\r\n\t\t\t\t\tTHREE.warn( 'THREE.ObjectLoader: No \"image\" speficied for', data.uuid );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( images[ data.image ] === undefined ) {\r\n\r\n\t\t\t\t\tTHREE.warn( 'THREE.ObjectLoader: Undefined image', data.image );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar texture = new THREE.Texture( images[ data.image ] );\r\n\t\t\t\ttexture.needsUpdate = true;\r\n\r\n\t\t\t\ttexture.uuid = data.uuid;\r\n\r\n\t\t\t\tif ( data.name !== undefined ) texture.name = data.name;\r\n\t\t\t\tif ( data.repeat !== undefined ) texture.repeat = new THREE.Vector2( data.repeat[ 0 ], data.repeat[ 1 ] );\r\n\t\t\t\tif ( data.minFilter !== undefined ) texture.minFilter = THREE[ data.minFilter ];\r\n\t\t\t\tif ( data.magFilter !== undefined ) texture.magFilter = THREE[ data.magFilter ];\r\n\t\t\t\tif ( data.anisotropy !== undefined ) texture.anisotropy = data.anisotropy;\r\n\t\t\t\tif ( data.wrap instanceof Array ) {\r\n\r\n\t\t\t\t\ttexture.wrapS = THREE[ data.wrap[ 0 ] ];\r\n\t\t\t\t\ttexture.wrapT = THREE[ data.wrap[ 1 ] ];\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\ttextures[ data.uuid ] = texture;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\treturn textures;\r\n\r\n\t},\r\n\r\n\tparseObject: function () {\r\n\r\n\t\tvar matrix = new THREE.Matrix4();\r\n\r\n\t\treturn function ( data, geometries, materials ) {\r\n\r\n\t\t\tvar object;\r\n\r\n\t\t\tvar getGeometry = function ( name ) {\r\n\r\n\t\t\t\tif ( geometries[ name ] === undefined ) {\r\n\r\n\t\t\t\t\tTHREE.warn( 'THREE.ObjectLoader: Undefined geometry', name );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn geometries[ name ];\r\n\r\n\t\t\t};\r\n\r\n\t\t\tvar getMaterial = function ( name ) {\r\n\r\n\t\t\t\tif ( materials[ name ] === undefined ) {\r\n\r\n\t\t\t\t\tTHREE.warn( 'THREE.ObjectLoader: Undefined material', name );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn materials[ name ];\r\n\r\n\t\t\t};\r\n\r\n\t\t\tswitch ( data.type ) {\r\n\r\n\t\t\t\tcase 'Scene':\r\n\r\n\t\t\t\t\tobject = new THREE.Scene();\r\n\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'PerspectiveCamera':\r\n\r\n\t\t\t\t\tobject = new THREE.PerspectiveCamera( data.fov, data.aspect, data.near, data.far );\r\n\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'OrthographicCamera':\r\n\r\n\t\t\t\t\tobject = new THREE.OrthographicCamera( data.left, data.right, data.top, data.bottom, data.near, data.far );\r\n\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'AmbientLight':\r\n\r\n\t\t\t\t\tobject = new THREE.AmbientLight( data.color );\r\n\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'DirectionalLight':\r\n\r\n\t\t\t\t\tobject = new THREE.DirectionalLight( data.color, data.intensity );\r\n\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'PointLight':\r\n\r\n\t\t\t\t\tobject = new THREE.PointLight( data.color, data.intensity, data.distance, data.decay );\r\n\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'SpotLight':\r\n\r\n\t\t\t\t\tobject = new THREE.SpotLight( data.color, data.intensity, data.distance, data.angle, data.exponent, data.decay );\r\n\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'HemisphereLight':\r\n\r\n\t\t\t\t\tobject = new THREE.HemisphereLight( data.color, data.groundColor, data.intensity );\r\n\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'Mesh':\r\n\r\n\t\t\t\t\tobject = new THREE.Mesh( getGeometry( data.geometry ), getMaterial( data.material ) );\r\n\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'Line':\r\n\r\n\t\t\t\t\tobject = new THREE.Line( getGeometry( data.geometry ), getMaterial( data.material ), data.mode );\r\n\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'PointCloud':\r\n\r\n\t\t\t\t\tobject = new THREE.PointCloud( getGeometry( data.geometry ), getMaterial( data.material ) );\r\n\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'Sprite':\r\n\r\n\t\t\t\t\tobject = new THREE.Sprite( getMaterial( data.material ) );\r\n\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'Group':\r\n\r\n\t\t\t\t\tobject = new THREE.Group();\r\n\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tdefault:\r\n\r\n\t\t\t\t\tobject = new THREE.Object3D();\r\n\r\n\t\t\t}\r\n\r\n\t\t\tobject.uuid = data.uuid;\r\n\r\n\t\t\tif ( data.name !== undefined ) object.name = data.name;\r\n\t\t\tif ( data.matrix !== undefined ) {\r\n\r\n\t\t\t\tmatrix.fromArray( data.matrix );\r\n\t\t\t\tmatrix.decompose( object.position, object.quaternion, object.scale );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tif ( data.position !== undefined ) object.position.fromArray( data.position );\r\n\t\t\t\tif ( data.rotation !== undefined ) object.rotation.fromArray( data.rotation );\r\n\t\t\t\tif ( data.scale !== undefined ) object.scale.fromArray( data.scale );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( data.visible !== undefined ) object.visible = data.visible;\r\n\t\t\tif ( data.userData !== undefined ) object.userData = data.userData;\r\n\r\n\t\t\tif ( data.children !== undefined ) {\r\n\r\n\t\t\t\tfor ( var child in data.children ) {\r\n\r\n\t\t\t\t\tobject.add( this.parseObject( data.children[ child ], geometries, materials ) );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn object;\r\n\r\n\t\t}\r\n\r\n\t}()\r\n\r\n};\r\n\r\n// File:src/loaders/TextureLoader.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.TextureLoader = function ( manager ) {\r\n\r\n\tthis.manager = ( manager !== undefined ) ? manager : THREE.DefaultLoadingManager;\r\n\r\n};\r\n\r\nTHREE.TextureLoader.prototype = {\r\n\r\n\tconstructor: THREE.TextureLoader,\r\n\r\n\tload: function ( url, onLoad, onProgress, onError ) {\r\n\r\n\t\tvar scope = this;\r\n\r\n\t\tvar loader = new THREE.ImageLoader( scope.manager );\r\n\t\tloader.setCrossOrigin( this.crossOrigin );\r\n\t\tloader.load( url, function ( image ) {\r\n\r\n\t\t\tvar texture = new THREE.Texture( image );\r\n\t\t\ttexture.needsUpdate = true;\r\n\r\n\t\t\tif ( onLoad !== undefined ) {\r\n\r\n\t\t\t\tonLoad( texture );\r\n\r\n\t\t\t}\r\n\r\n\t\t}, onProgress, onError );\r\n\r\n\t},\r\n\r\n\tsetCrossOrigin: function ( value ) {\r\n\r\n\t\tthis.crossOrigin = value;\r\n\r\n\t}\r\n\r\n};\r\n\r\n// File:src/loaders/BinaryTextureLoader.js\r\n\r\n/**\r\n * @author Nikos M. / https://github.com/foo123/\r\n *\r\n * Abstract Base class to load generic binary textures formats (rgbe, hdr, ...)\r\n */\r\n\r\nTHREE.DataTextureLoader = THREE.BinaryTextureLoader = function () {\r\n\r\n\t// override in sub classes\r\n\tthis._parser = null;\r\n\r\n};\r\n\r\nTHREE.BinaryTextureLoader.prototype = {\r\n\r\n\tconstructor: THREE.BinaryTextureLoader,\r\n\r\n\tload: function ( url, onLoad, onProgress, onError ) {\r\n\r\n\t\tvar scope = this;\r\n\r\n\t\tvar texture = new THREE.DataTexture( );\r\n\r\n\t\tvar loader = new THREE.XHRLoader();\r\n\t\tloader.setResponseType( 'arraybuffer' );\r\n\r\n\t\tloader.load( url, function ( buffer ) {\r\n\r\n\t\t\tvar texData = scope._parser( buffer );\r\n\r\n\t\t\tif ( !texData ) return;\r\n\r\n\t\t\tif ( undefined !== texData.image ) {\r\n\r\n\t\t\t\ttexture.image = texData.image;\r\n\r\n\t\t\t} else if ( undefined !== texData.data ) {\r\n\r\n\t\t\t\ttexture.image.width = texData.width;\r\n\t\t\t\ttexture.image.height = texData.height;\r\n\t\t\t\ttexture.image.data = texData.data;\r\n\r\n\t\t\t}\r\n\r\n\t\t\ttexture.wrapS = undefined !== texData.wrapS ? texData.wrapS : THREE.ClampToEdgeWrapping;\r\n\t\t\ttexture.wrapT = undefined !== texData.wrapT ? texData.wrapT : THREE.ClampToEdgeWrapping;\r\n\r\n\t\t\ttexture.magFilter = undefined !== texData.magFilter ? texData.magFilter : THREE.LinearFilter;\r\n\t\t\ttexture.minFilter = undefined !== texData.minFilter ? texData.minFilter : THREE.LinearMipMapLinearFilter;\r\n\r\n\t\t\ttexture.anisotropy = undefined !== texData.anisotropy ? texData.anisotropy : 1;\r\n\r\n\t\t\tif ( undefined !== texData.format ) {\r\n\r\n\t\t\t\ttexture.format = texData.format;\r\n\r\n\t\t\t}\r\n\t\t\tif ( undefined !== texData.type ) {\r\n\r\n\t\t\t\ttexture.type = texData.type;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( undefined !== texData.mipmaps ) {\r\n\r\n\t\t\t\ttexture.mipmaps = texData.mipmaps;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( 1 === texData.mipmapCount ) {\r\n\r\n\t\t\t\ttexture.minFilter = THREE.LinearFilter;\r\n\r\n\t\t\t}\r\n\r\n\t\t\ttexture.needsUpdate = true;\r\n\r\n\t\t\tif ( onLoad ) onLoad( texture, texData );\r\n\r\n\t\t}, onProgress, onError );\r\n\r\n\r\n\t\treturn texture;\r\n\r\n\t}\r\n\r\n};\r\n\r\n// File:src/loaders/CompressedTextureLoader.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n *\r\n * Abstract Base class to block based textures loader (dds, pvr, ...)\r\n */\r\n\r\nTHREE.CompressedTextureLoader = function () {\r\n\r\n\t// override in sub classes\r\n\tthis._parser = null;\r\n\r\n};\r\n\r\n\r\nTHREE.CompressedTextureLoader.prototype = {\r\n\r\n\tconstructor: THREE.CompressedTextureLoader,\r\n\r\n\tload: function ( url, onLoad, onError ) {\r\n\r\n\t\tvar scope = this;\r\n\r\n\t\tvar images = [];\r\n\r\n\t\tvar texture = new THREE.CompressedTexture();\r\n\t\ttexture.image = images;\r\n\r\n\t\tvar loader = new THREE.XHRLoader();\r\n\t\tloader.setResponseType( 'arraybuffer' );\r\n\r\n\t\tif ( url instanceof Array ) {\r\n\r\n\t\t\tvar loaded = 0;\r\n\r\n\t\t\tvar loadTexture = function ( i ) {\r\n\r\n\t\t\t\tloader.load( url[ i ], function ( buffer ) {\r\n\r\n\t\t\t\t\tvar texDatas = scope._parser( buffer, true );\r\n\r\n\t\t\t\t\timages[ i ] = {\r\n\t\t\t\t\t\twidth: texDatas.width,\r\n\t\t\t\t\t\theight: texDatas.height,\r\n\t\t\t\t\t\tformat: texDatas.format,\r\n\t\t\t\t\t\tmipmaps: texDatas.mipmaps\r\n\t\t\t\t\t};\r\n\r\n\t\t\t\t\tloaded += 1;\r\n\r\n\t\t\t\t\tif ( loaded === 6 ) {\r\n\r\n\t\t\t\t\t\tif (texDatas.mipmapCount == 1)\r\n \t\t\t\t\t\t\ttexture.minFilter = THREE.LinearFilter;\r\n\r\n\t\t\t\t\t\ttexture.format = texDatas.format;\r\n\t\t\t\t\t\ttexture.needsUpdate = true;\r\n\r\n\t\t\t\t\t\tif ( onLoad ) onLoad( texture );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t} );\r\n\r\n\t\t\t};\r\n\r\n\t\t\tfor ( var i = 0, il = url.length; i < il; ++ i ) {\r\n\r\n\t\t\t\tloadTexture( i );\r\n\r\n\t\t\t}\r\n\r\n\t\t} else {\r\n\r\n\t\t\t// compressed cubemap texture stored in a single DDS file\r\n\r\n\t\t\tloader.load( url, function ( buffer ) {\r\n\r\n\t\t\t\tvar texDatas = scope._parser( buffer, true );\r\n\r\n\t\t\t\tif ( texDatas.isCubemap ) {\r\n\r\n\t\t\t\t\tvar faces = texDatas.mipmaps.length / texDatas.mipmapCount;\r\n\r\n\t\t\t\t\tfor ( var f = 0; f < faces; f ++ ) {\r\n\r\n\t\t\t\t\t\timages[ f ] = { mipmaps : [] };\r\n\r\n\t\t\t\t\t\tfor ( var i = 0; i < texDatas.mipmapCount; i ++ ) {\r\n\r\n\t\t\t\t\t\t\timages[ f ].mipmaps.push( texDatas.mipmaps[ f * texDatas.mipmapCount + i ] );\r\n\t\t\t\t\t\t\timages[ f ].format = texDatas.format;\r\n\t\t\t\t\t\t\timages[ f ].width = texDatas.width;\r\n\t\t\t\t\t\t\timages[ f ].height = texDatas.height;\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\ttexture.image.width = texDatas.width;\r\n\t\t\t\t\ttexture.image.height = texDatas.height;\r\n\t\t\t\t\ttexture.mipmaps = texDatas.mipmaps;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( texDatas.mipmapCount === 1 ) {\r\n\r\n\t\t\t\t\ttexture.minFilter = THREE.LinearFilter;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\ttexture.format = texDatas.format;\r\n\t\t\t\ttexture.needsUpdate = true;\r\n\r\n\t\t\t\tif ( onLoad ) onLoad( texture );\r\n\r\n\t\t\t} );\r\n\r\n\t\t}\r\n\r\n\t\treturn texture;\r\n\r\n\t}\r\n\r\n};\r\n\r\n// File:src/materials/Material.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author alteredq / http://alteredqualia.com/\r\n */\r\n\r\nTHREE.Material = function () {\r\n\r\n\tObject.defineProperty( this, 'id', { value: THREE.MaterialIdCount ++ } );\r\n\r\n\tthis.uuid = THREE.Math.generateUUID();\r\n\r\n\tthis.name = '';\r\n\tthis.type = 'Material';\r\n\r\n\tthis.side = THREE.FrontSide;\r\n\r\n\tthis.opacity = 1;\r\n\tthis.transparent = false;\r\n\r\n\tthis.blending = THREE.NormalBlending;\r\n\r\n\tthis.blendSrc = THREE.SrcAlphaFactor;\r\n\tthis.blendDst = THREE.OneMinusSrcAlphaFactor;\r\n\tthis.blendEquation = THREE.AddEquation;\r\n\tthis.blendSrcAlpha = null;\r\n\tthis.blendDstAlpha = null;\r\n\tthis.blendEquationAlpha = null;\r\n\r\n\tthis.depthTest = true;\r\n\tthis.depthWrite = true;\r\n\r\n\tthis.colorWrite = true;\r\n\r\n\tthis.polygonOffset = false;\r\n\tthis.polygonOffsetFactor = 0;\r\n\tthis.polygonOffsetUnits = 0;\r\n\r\n\tthis.alphaTest = 0;\r\n\r\n\tthis.overdraw = 0; // Overdrawn pixels (typically between 0 and 1) for fixing antialiasing gaps in CanvasRenderer\r\n\r\n\tthis.visible = true;\r\n\r\n\tthis._needsUpdate = true;\r\n\r\n};\r\n\r\nTHREE.Material.prototype = {\r\n\r\n\tconstructor: THREE.Material,\r\n\r\n\tget needsUpdate () {\r\n\r\n\t\treturn this._needsUpdate;\r\n\r\n\t},\r\n\r\n\tset needsUpdate ( value ) {\r\n\r\n\t\tif ( value === true ) this.update();\r\n\r\n\t\tthis._needsUpdate = value;\r\n\r\n\t},\r\n\r\n\tsetValues: function ( values ) {\r\n\r\n\t\tif ( values === undefined ) return;\r\n\r\n\t\tfor ( var key in values ) {\r\n\r\n\t\t\tvar newValue = values[ key ];\r\n\r\n\t\t\tif ( newValue === undefined ) {\r\n\r\n\t\t\t\tTHREE.warn( \"THREE.Material: '\" + key + \"' parameter is undefined.\" );\r\n\t\t\t\tcontinue;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( key in this ) {\r\n\r\n\t\t\t\tvar currentValue = this[ key ];\r\n\r\n\t\t\t\tif ( currentValue instanceof THREE.Color ) {\r\n\r\n\t\t\t\t\tcurrentValue.set( newValue );\r\n\r\n\t\t\t\t} else if ( currentValue instanceof THREE.Vector3 && newValue instanceof THREE.Vector3 ) {\r\n\r\n\t\t\t\t\tcurrentValue.copy( newValue );\r\n\r\n\t\t\t\t} else if ( key == 'overdraw' ) {\r\n\r\n\t\t\t\t\t// ensure overdraw is backwards-compatable with legacy boolean type\r\n\t\t\t\t\tthis[ key ] = Number( newValue );\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\tthis[ key ] = newValue;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t},\r\n\r\n\ttoJSON: function () {\r\n\r\n\t\tvar output = {\r\n\t\t\tmetadata: {\r\n\t\t\t\tversion: 4.2,\r\n\t\t\t\ttype: 'material',\r\n\t\t\t\tgenerator: 'MaterialExporter'\r\n\t\t\t},\r\n\t\t\tuuid: this.uuid,\r\n\t\t\ttype: this.type\r\n\t\t};\r\n\r\n\t\tif ( this.name !== \"\" ) output.name = this.name;\r\n\r\n\t\tif ( this instanceof THREE.MeshBasicMaterial ) {\r\n\r\n\t\t\toutput.color = this.color.getHex();\r\n\t\t\tif ( this.vertexColors !== THREE.NoColors ) output.vertexColors = this.vertexColors;\r\n\t\t\tif ( this.blending !== THREE.NormalBlending ) output.blending = this.blending;\r\n\t\t\tif ( this.side !== THREE.FrontSide ) output.side = this.side;\r\n\r\n\t\t} else if ( this instanceof THREE.MeshLambertMaterial ) {\r\n\r\n\t\t\toutput.color = this.color.getHex();\r\n\t\t\toutput.emissive = this.emissive.getHex();\r\n\t\t\tif ( this.vertexColors !== THREE.NoColors ) output.vertexColors = this.vertexColors;\r\n\t\t\tif ( this.shading !== THREE.SmoothShading ) output.shading = this.shading;\r\n\t\t\tif ( this.blending !== THREE.NormalBlending ) output.blending = this.blending;\r\n\t\t\tif ( this.side !== THREE.FrontSide ) output.side = this.side;\r\n\r\n\t\t} else if ( this instanceof THREE.MeshPhongMaterial ) {\r\n\r\n\t\t\toutput.color = this.color.getHex();\r\n\t\t\toutput.emissive = this.emissive.getHex();\r\n\t\t\toutput.specular = this.specular.getHex();\r\n\t\t\toutput.shininess = this.shininess;\r\n\t\t\tif ( this.vertexColors !== THREE.NoColors ) output.vertexColors = this.vertexColors;\r\n\t\t\tif ( this.shading !== THREE.SmoothShading ) output.shading = this.shading;\r\n\t\t\tif ( this.blending !== THREE.NormalBlending ) output.blending = this.blending;\r\n\t\t\tif ( this.side !== THREE.FrontSide ) output.side = this.side;\r\n\r\n\t\t} else if ( this instanceof THREE.MeshNormalMaterial ) {\r\n\r\n\t\t\tif ( this.blending !== THREE.NormalBlending ) output.blending = this.blending;\r\n\t\t\tif ( this.side !== THREE.FrontSide ) output.side = this.side;\r\n\r\n\t\t} else if ( this instanceof THREE.MeshDepthMaterial ) {\r\n\r\n\t\t\tif ( this.blending !== THREE.NormalBlending ) output.blending = this.blending;\r\n\t\t\tif ( this.side !== THREE.FrontSide ) output.side = this.side;\r\n\r\n\t\t} else if ( this instanceof THREE.PointCloudMaterial ) {\r\n\r\n\t\t\toutput.size  = this.size;\r\n\t\t\toutput.sizeAttenuation = this.sizeAttenuation;\r\n\t\t\toutput.color = this.color.getHex();\r\n\r\n\t\t\tif ( this.vertexColors !== THREE.NoColors ) output.vertexColors = this.vertexColors;\r\n\t\t\tif ( this.blending !== THREE.NormalBlending ) output.blending = this.blending;\r\n\r\n\t\t} else if ( this instanceof THREE.ShaderMaterial ) {\r\n\r\n\t\t\toutput.uniforms = this.uniforms;\r\n\t\t\toutput.vertexShader = this.vertexShader;\r\n\t\t\toutput.fragmentShader = this.fragmentShader;\r\n\r\n\t\t} else if ( this instanceof THREE.SpriteMaterial ) {\r\n\r\n\t\t\toutput.color = this.color.getHex();\r\n\r\n\t\t}\r\n\r\n\t\tif ( this.opacity < 1 ) output.opacity = this.opacity;\r\n\t\tif ( this.transparent !== false ) output.transparent = this.transparent;\r\n\t\tif ( this.wireframe !== false ) output.wireframe = this.wireframe;\r\n\r\n\t\treturn output;\r\n\r\n\t},\r\n\r\n\tclone: function ( material ) {\r\n\r\n\t\tif ( material === undefined ) material = new THREE.Material();\r\n\r\n\t\tmaterial.name = this.name;\r\n\r\n\t\tmaterial.side = this.side;\r\n\r\n\t\tmaterial.opacity = this.opacity;\r\n\t\tmaterial.transparent = this.transparent;\r\n\r\n\t\tmaterial.blending = this.blending;\r\n\r\n\t\tmaterial.blendSrc = this.blendSrc;\r\n\t\tmaterial.blendDst = this.blendDst;\r\n\t\tmaterial.blendEquation = this.blendEquation;\r\n\t\tmaterial.blendSrcAlpha = this.blendSrcAlpha;\r\n\t\tmaterial.blendDstAlpha = this.blendDstAlpha;\r\n\t\tmaterial.blendEquationAlpha = this.blendEquationAlpha;\r\n\r\n\t\tmaterial.depthTest = this.depthTest;\r\n\t\tmaterial.depthWrite = this.depthWrite;\r\n\r\n\t\tmaterial.polygonOffset = this.polygonOffset;\r\n\t\tmaterial.polygonOffsetFactor = this.polygonOffsetFactor;\r\n\t\tmaterial.polygonOffsetUnits = this.polygonOffsetUnits;\r\n\r\n\t\tmaterial.alphaTest = this.alphaTest;\r\n\r\n\t\tmaterial.overdraw = this.overdraw;\r\n\r\n\t\tmaterial.visible = this.visible;\r\n\r\n\t\treturn material;\r\n\r\n\t},\r\n\r\n\tupdate: function () {\r\n\r\n\t\tthis.dispatchEvent( { type: 'update' } );\r\n\r\n\t},\r\n\r\n\tdispose: function () {\r\n\r\n\t\tthis.dispatchEvent( { type: 'dispose' } );\r\n\r\n\t}\r\n\r\n};\r\n\r\nTHREE.EventDispatcher.prototype.apply( THREE.Material.prototype );\r\n\r\nTHREE.MaterialIdCount = 0;\r\n\r\n// File:src/materials/LineBasicMaterial.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author alteredq / http://alteredqualia.com/\r\n *\r\n * parameters = {\r\n *  color: <hex>,\r\n *  opacity: <float>,\r\n *\r\n *  blending: THREE.NormalBlending,\r\n *  depthTest: <bool>,\r\n *  depthWrite: <bool>,\r\n *\r\n *  linewidth: <float>,\r\n *  linecap: \"round\",\r\n *  linejoin: \"round\",\r\n *\r\n *  vertexColors: <bool>\r\n *\r\n *  fog: <bool>\r\n * }\r\n */\r\n\r\nTHREE.LineBasicMaterial = function ( parameters ) {\r\n\r\n\tTHREE.Material.call( this );\r\n\r\n\tthis.type = 'LineBasicMaterial';\r\n\r\n\tthis.color = new THREE.Color( 0xffffff );\r\n\r\n\tthis.linewidth = 1;\r\n\tthis.linecap = 'round';\r\n\tthis.linejoin = 'round';\r\n\r\n\tthis.vertexColors = THREE.NoColors;\r\n\r\n\tthis.fog = true;\r\n\r\n\tthis.setValues( parameters );\r\n\r\n};\r\n\r\nTHREE.LineBasicMaterial.prototype = Object.create( THREE.Material.prototype );\r\nTHREE.LineBasicMaterial.prototype.constructor = THREE.LineBasicMaterial;\r\n\r\nTHREE.LineBasicMaterial.prototype.clone = function () {\r\n\r\n\tvar material = new THREE.LineBasicMaterial();\r\n\r\n\tTHREE.Material.prototype.clone.call( this, material );\r\n\r\n\tmaterial.color.copy( this.color );\r\n\r\n\tmaterial.linewidth = this.linewidth;\r\n\tmaterial.linecap = this.linecap;\r\n\tmaterial.linejoin = this.linejoin;\r\n\r\n\tmaterial.vertexColors = this.vertexColors;\r\n\r\n\tmaterial.fog = this.fog;\r\n\r\n\treturn material;\r\n\r\n};\r\n\r\n// File:src/materials/LineDashedMaterial.js\r\n\r\n/**\r\n * @author alteredq / http://alteredqualia.com/\r\n *\r\n * parameters = {\r\n *  color: <hex>,\r\n *  opacity: <float>,\r\n *\r\n *  blending: THREE.NormalBlending,\r\n *  depthTest: <bool>,\r\n *  depthWrite: <bool>,\r\n *\r\n *  linewidth: <float>,\r\n *\r\n *  scale: <float>,\r\n *  dashSize: <float>,\r\n *  gapSize: <float>,\r\n *\r\n *  vertexColors: <bool>\r\n *\r\n *  fog: <bool>\r\n * }\r\n */\r\n\r\nTHREE.LineDashedMaterial = function ( parameters ) {\r\n\r\n\tTHREE.Material.call( this );\r\n\r\n\tthis.type = 'LineDashedMaterial';\r\n\r\n\tthis.color = new THREE.Color( 0xffffff );\r\n\r\n\tthis.linewidth = 1;\r\n\r\n\tthis.scale = 1;\r\n\tthis.dashSize = 3;\r\n\tthis.gapSize = 1;\r\n\r\n\tthis.vertexColors = false;\r\n\r\n\tthis.fog = true;\r\n\r\n\tthis.setValues( parameters );\r\n\r\n};\r\n\r\nTHREE.LineDashedMaterial.prototype = Object.create( THREE.Material.prototype );\r\nTHREE.LineDashedMaterial.prototype.constructor = THREE.LineDashedMaterial;\r\n\r\nTHREE.LineDashedMaterial.prototype.clone = function () {\r\n\r\n\tvar material = new THREE.LineDashedMaterial();\r\n\r\n\tTHREE.Material.prototype.clone.call( this, material );\r\n\r\n\tmaterial.color.copy( this.color );\r\n\r\n\tmaterial.linewidth = this.linewidth;\r\n\r\n\tmaterial.scale = this.scale;\r\n\tmaterial.dashSize = this.dashSize;\r\n\tmaterial.gapSize = this.gapSize;\r\n\r\n\tmaterial.vertexColors = this.vertexColors;\r\n\r\n\tmaterial.fog = this.fog;\r\n\r\n\treturn material;\r\n\r\n};\r\n\r\n// File:src/materials/MeshBasicMaterial.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author alteredq / http://alteredqualia.com/\r\n *\r\n * parameters = {\r\n *  color: <hex>,\r\n *  opacity: <float>,\r\n *  map: new THREE.Texture( <Image> ),\r\n *\r\n *  lightMap: new THREE.Texture( <Image> ),\r\n *\r\n *  specularMap: new THREE.Texture( <Image> ),\r\n *\r\n *  alphaMap: new THREE.Texture( <Image> ),\r\n *\r\n *  envMap: new THREE.TextureCube( [posx, negx, posy, negy, posz, negz] ),\r\n *  combine: THREE.Multiply,\r\n *  reflectivity: <float>,\r\n *  refractionRatio: <float>,\r\n *\r\n *  shading: THREE.SmoothShading,\r\n *  blending: THREE.NormalBlending,\r\n *  depthTest: <bool>,\r\n *  depthWrite: <bool>,\r\n *\r\n *  wireframe: <boolean>,\r\n *  wireframeLinewidth: <float>,\r\n *\r\n *  vertexColors: THREE.NoColors / THREE.VertexColors / THREE.FaceColors,\r\n *\r\n *  skinning: <bool>,\r\n *  morphTargets: <bool>,\r\n *\r\n *  fog: <bool>\r\n * }\r\n */\r\n\r\nTHREE.MeshBasicMaterial = function ( parameters ) {\r\n\r\n\tTHREE.Material.call( this );\r\n\r\n\tthis.type = 'MeshBasicMaterial';\r\n\r\n\tthis.color = new THREE.Color( 0xffffff ); // emissive\r\n\r\n\tthis.map = null;\r\n\r\n\tthis.lightMap = null;\r\n\r\n\tthis.specularMap = null;\r\n\r\n\tthis.alphaMap = null;\r\n\r\n\tthis.envMap = null;\r\n\tthis.combine = THREE.MultiplyOperation;\r\n\tthis.reflectivity = 1;\r\n\tthis.refractionRatio = 0.98;\r\n\r\n\tthis.fog = true;\r\n\r\n\tthis.shading = THREE.SmoothShading;\r\n\r\n\tthis.wireframe = false;\r\n\tthis.wireframeLinewidth = 1;\r\n\tthis.wireframeLinecap = 'round';\r\n\tthis.wireframeLinejoin = 'round';\r\n\r\n\tthis.vertexColors = THREE.NoColors;\r\n\r\n\tthis.skinning = false;\r\n\tthis.morphTargets = false;\r\n\r\n\tthis.setValues( parameters );\r\n\r\n};\r\n\r\nTHREE.MeshBasicMaterial.prototype = Object.create( THREE.Material.prototype );\r\nTHREE.MeshBasicMaterial.prototype.constructor = THREE.MeshBasicMaterial;\r\n\r\nTHREE.MeshBasicMaterial.prototype.clone = function () {\r\n\r\n\tvar material = new THREE.MeshBasicMaterial();\r\n\r\n\tTHREE.Material.prototype.clone.call( this, material );\r\n\r\n\tmaterial.color.copy( this.color );\r\n\r\n\tmaterial.map = this.map;\r\n\r\n\tmaterial.lightMap = this.lightMap;\r\n\r\n\tmaterial.specularMap = this.specularMap;\r\n\r\n\tmaterial.alphaMap = this.alphaMap;\r\n\r\n\tmaterial.envMap = this.envMap;\r\n\tmaterial.combine = this.combine;\r\n\tmaterial.reflectivity = this.reflectivity;\r\n\tmaterial.refractionRatio = this.refractionRatio;\r\n\r\n\tmaterial.fog = this.fog;\r\n\r\n\tmaterial.shading = this.shading;\r\n\r\n\tmaterial.wireframe = this.wireframe;\r\n\tmaterial.wireframeLinewidth = this.wireframeLinewidth;\r\n\tmaterial.wireframeLinecap = this.wireframeLinecap;\r\n\tmaterial.wireframeLinejoin = this.wireframeLinejoin;\r\n\r\n\tmaterial.vertexColors = this.vertexColors;\r\n\r\n\tmaterial.skinning = this.skinning;\r\n\tmaterial.morphTargets = this.morphTargets;\r\n\r\n\treturn material;\r\n\r\n};\r\n\r\n// File:src/materials/MeshLambertMaterial.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author alteredq / http://alteredqualia.com/\r\n *\r\n * parameters = {\r\n *  color: <hex>,\r\n *  emissive: <hex>,\r\n *  opacity: <float>,\r\n *\r\n *  map: new THREE.Texture( <Image> ),\r\n *\r\n *  lightMap: new THREE.Texture( <Image> ),\r\n *\r\n *  specularMap: new THREE.Texture( <Image> ),\r\n *\r\n *  alphaMap: new THREE.Texture( <Image> ),\r\n *\r\n *  envMap: new THREE.TextureCube( [posx, negx, posy, negy, posz, negz] ),\r\n *  combine: THREE.Multiply,\r\n *  reflectivity: <float>,\r\n *  refractionRatio: <float>,\r\n *\r\n *  shading: THREE.SmoothShading,\r\n *  blending: THREE.NormalBlending,\r\n *  depthTest: <bool>,\r\n *  depthWrite: <bool>,\r\n *\r\n *  wireframe: <boolean>,\r\n *  wireframeLinewidth: <float>,\r\n *\r\n *  vertexColors: THREE.NoColors / THREE.VertexColors / THREE.FaceColors,\r\n *\r\n *  skinning: <bool>,\r\n *  morphTargets: <bool>,\r\n *  morphNormals: <bool>,\r\n *\r\n *\tfog: <bool>\r\n * }\r\n */\r\n\r\nTHREE.MeshLambertMaterial = function ( parameters ) {\r\n\r\n\tTHREE.Material.call( this );\r\n\r\n\tthis.type = 'MeshLambertMaterial';\r\n\r\n\tthis.color = new THREE.Color( 0xffffff ); // diffuse\r\n\tthis.emissive = new THREE.Color( 0x000000 );\r\n\r\n\tthis.wrapAround = false;\r\n\tthis.wrapRGB = new THREE.Vector3( 1, 1, 1 );\r\n\r\n\tthis.map = null;\r\n\r\n\tthis.lightMap = null;\r\n\r\n\tthis.specularMap = null;\r\n\r\n\tthis.alphaMap = null;\r\n\r\n\tthis.envMap = null;\r\n\tthis.combine = THREE.MultiplyOperation;\r\n\tthis.reflectivity = 1;\r\n\tthis.refractionRatio = 0.98;\r\n\r\n\tthis.fog = true;\r\n\r\n\tthis.shading = THREE.SmoothShading;\r\n\r\n\tthis.wireframe = false;\r\n\tthis.wireframeLinewidth = 1;\r\n\tthis.wireframeLinecap = 'round';\r\n\tthis.wireframeLinejoin = 'round';\r\n\r\n\tthis.vertexColors = THREE.NoColors;\r\n\r\n\tthis.skinning = false;\r\n\tthis.morphTargets = false;\r\n\tthis.morphNormals = false;\r\n\r\n\tthis.setValues( parameters );\r\n\r\n};\r\n\r\nTHREE.MeshLambertMaterial.prototype = Object.create( THREE.Material.prototype );\r\nTHREE.MeshLambertMaterial.prototype.constructor = THREE.MeshLambertMaterial;\r\n\r\nTHREE.MeshLambertMaterial.prototype.clone = function () {\r\n\r\n\tvar material = new THREE.MeshLambertMaterial();\r\n\r\n\tTHREE.Material.prototype.clone.call( this, material );\r\n\r\n\tmaterial.color.copy( this.color );\r\n\tmaterial.emissive.copy( this.emissive );\r\n\r\n\tmaterial.wrapAround = this.wrapAround;\r\n\tmaterial.wrapRGB.copy( this.wrapRGB );\r\n\r\n\tmaterial.map = this.map;\r\n\r\n\tmaterial.lightMap = this.lightMap;\r\n\r\n\tmaterial.specularMap = this.specularMap;\r\n\r\n\tmaterial.alphaMap = this.alphaMap;\r\n\r\n\tmaterial.envMap = this.envMap;\r\n\tmaterial.combine = this.combine;\r\n\tmaterial.reflectivity = this.reflectivity;\r\n\tmaterial.refractionRatio = this.refractionRatio;\r\n\r\n\tmaterial.fog = this.fog;\r\n\r\n\tmaterial.shading = this.shading;\r\n\r\n\tmaterial.wireframe = this.wireframe;\r\n\tmaterial.wireframeLinewidth = this.wireframeLinewidth;\r\n\tmaterial.wireframeLinecap = this.wireframeLinecap;\r\n\tmaterial.wireframeLinejoin = this.wireframeLinejoin;\r\n\r\n\tmaterial.vertexColors = this.vertexColors;\r\n\r\n\tmaterial.skinning = this.skinning;\r\n\tmaterial.morphTargets = this.morphTargets;\r\n\tmaterial.morphNormals = this.morphNormals;\r\n\r\n\treturn material;\r\n\r\n};\r\n\r\n// File:src/materials/MeshPhongMaterial.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author alteredq / http://alteredqualia.com/\r\n *\r\n * parameters = {\r\n *  color: <hex>,\r\n *  emissive: <hex>,\r\n *  specular: <hex>,\r\n *  shininess: <float>,\r\n *  opacity: <float>,\r\n *\r\n *  map: new THREE.Texture( <Image> ),\r\n *\r\n *  lightMap: new THREE.Texture( <Image> ),\r\n *\r\n *  bumpMap: new THREE.Texture( <Image> ),\r\n *  bumpScale: <float>,\r\n *\r\n *  normalMap: new THREE.Texture( <Image> ),\r\n *  normalScale: <Vector2>,\r\n *\r\n *  specularMap: new THREE.Texture( <Image> ),\r\n *\r\n *  alphaMap: new THREE.Texture( <Image> ),\r\n *\r\n *  envMap: new THREE.TextureCube( [posx, negx, posy, negy, posz, negz] ),\r\n *  combine: THREE.Multiply,\r\n *  reflectivity: <float>,\r\n *  refractionRatio: <float>,\r\n *\r\n *  shading: THREE.SmoothShading,\r\n *  blending: THREE.NormalBlending,\r\n *  depthTest: <bool>,\r\n *  depthWrite: <bool>,\r\n *\r\n *  wireframe: <boolean>,\r\n *  wireframeLinewidth: <float>,\r\n *\r\n *  vertexColors: THREE.NoColors / THREE.VertexColors / THREE.FaceColors,\r\n *\r\n *  skinning: <bool>,\r\n *  morphTargets: <bool>,\r\n *  morphNormals: <bool>,\r\n *\r\n *\tfog: <bool>\r\n * }\r\n */\r\n\r\nTHREE.MeshPhongMaterial = function ( parameters ) {\r\n\r\n\tTHREE.Material.call( this );\r\n\r\n\tthis.type = 'MeshPhongMaterial';\r\n\r\n\tthis.color = new THREE.Color( 0xffffff ); // diffuse\r\n\tthis.emissive = new THREE.Color( 0x000000 );\r\n\tthis.specular = new THREE.Color( 0x111111 );\r\n\tthis.shininess = 30;\r\n\r\n\tthis.metal = false;\r\n\r\n\tthis.wrapAround = false;\r\n\tthis.wrapRGB = new THREE.Vector3( 1, 1, 1 );\r\n\r\n\tthis.map = null;\r\n\r\n\tthis.lightMap = null;\r\n\r\n\tthis.bumpMap = null;\r\n\tthis.bumpScale = 1;\r\n\r\n\tthis.normalMap = null;\r\n\tthis.normalScale = new THREE.Vector2( 1, 1 );\r\n\r\n\tthis.specularMap = null;\r\n\r\n\tthis.alphaMap = null;\r\n\r\n\tthis.envMap = null;\r\n\tthis.combine = THREE.MultiplyOperation;\r\n\tthis.reflectivity = 1;\r\n\tthis.refractionRatio = 0.98;\r\n\r\n\tthis.fog = true;\r\n\r\n\tthis.shading = THREE.SmoothShading;\r\n\r\n\tthis.wireframe = false;\r\n\tthis.wireframeLinewidth = 1;\r\n\tthis.wireframeLinecap = 'round';\r\n\tthis.wireframeLinejoin = 'round';\r\n\r\n\tthis.vertexColors = THREE.NoColors;\r\n\r\n\tthis.skinning = false;\r\n\tthis.morphTargets = false;\r\n\tthis.morphNormals = false;\r\n\r\n\tthis.setValues( parameters );\r\n\r\n};\r\n\r\nTHREE.MeshPhongMaterial.prototype = Object.create( THREE.Material.prototype );\r\nTHREE.MeshPhongMaterial.prototype.constructor = THREE.MeshPhongMaterial;\r\n\r\nTHREE.MeshPhongMaterial.prototype.clone = function () {\r\n\r\n\tvar material = new THREE.MeshPhongMaterial();\r\n\r\n\tTHREE.Material.prototype.clone.call( this, material );\r\n\r\n\tmaterial.color.copy( this.color );\r\n\tmaterial.emissive.copy( this.emissive );\r\n\tmaterial.specular.copy( this.specular );\r\n\tmaterial.shininess = this.shininess;\r\n\r\n\tmaterial.metal = this.metal;\r\n\r\n\tmaterial.wrapAround = this.wrapAround;\r\n\tmaterial.wrapRGB.copy( this.wrapRGB );\r\n\r\n\tmaterial.map = this.map;\r\n\r\n\tmaterial.lightMap = this.lightMap;\r\n\r\n\tmaterial.bumpMap = this.bumpMap;\r\n\tmaterial.bumpScale = this.bumpScale;\r\n\r\n\tmaterial.normalMap = this.normalMap;\r\n\tmaterial.normalScale.copy( this.normalScale );\r\n\r\n\tmaterial.specularMap = this.specularMap;\r\n\r\n\tmaterial.alphaMap = this.alphaMap;\r\n\r\n\tmaterial.envMap = this.envMap;\r\n\tmaterial.combine = this.combine;\r\n\tmaterial.reflectivity = this.reflectivity;\r\n\tmaterial.refractionRatio = this.refractionRatio;\r\n\r\n\tmaterial.fog = this.fog;\r\n\r\n\tmaterial.shading = this.shading;\r\n\r\n\tmaterial.wireframe = this.wireframe;\r\n\tmaterial.wireframeLinewidth = this.wireframeLinewidth;\r\n\tmaterial.wireframeLinecap = this.wireframeLinecap;\r\n\tmaterial.wireframeLinejoin = this.wireframeLinejoin;\r\n\r\n\tmaterial.vertexColors = this.vertexColors;\r\n\r\n\tmaterial.skinning = this.skinning;\r\n\tmaterial.morphTargets = this.morphTargets;\r\n\tmaterial.morphNormals = this.morphNormals;\r\n\r\n\treturn material;\r\n\r\n};\r\n\r\n// File:src/materials/MeshDepthMaterial.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author alteredq / http://alteredqualia.com/\r\n *\r\n * parameters = {\r\n *  opacity: <float>,\r\n *\r\n *  blending: THREE.NormalBlending,\r\n *  depthTest: <bool>,\r\n *  depthWrite: <bool>,\r\n *\r\n *  wireframe: <boolean>,\r\n *  wireframeLinewidth: <float>\r\n * }\r\n */\r\n\r\nTHREE.MeshDepthMaterial = function ( parameters ) {\r\n\r\n\tTHREE.Material.call( this );\r\n\r\n\tthis.type = 'MeshDepthMaterial';\r\n\r\n\tthis.morphTargets = false;\r\n\tthis.wireframe = false;\r\n\tthis.wireframeLinewidth = 1;\r\n\r\n\tthis.setValues( parameters );\r\n\r\n};\r\n\r\nTHREE.MeshDepthMaterial.prototype = Object.create( THREE.Material.prototype );\r\nTHREE.MeshDepthMaterial.prototype.constructor = THREE.MeshDepthMaterial;\r\n\r\nTHREE.MeshDepthMaterial.prototype.clone = function () {\r\n\r\n\tvar material = new THREE.MeshDepthMaterial();\r\n\r\n\tTHREE.Material.prototype.clone.call( this, material );\r\n\r\n\tmaterial.wireframe = this.wireframe;\r\n\tmaterial.wireframeLinewidth = this.wireframeLinewidth;\r\n\r\n\treturn material;\r\n\r\n};\r\n\r\n// File:src/materials/MeshNormalMaterial.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n *\r\n * parameters = {\r\n *  opacity: <float>,\r\n *\r\n *  shading: THREE.FlatShading,\r\n *  blending: THREE.NormalBlending,\r\n *  depthTest: <bool>,\r\n *  depthWrite: <bool>,\r\n *\r\n *  wireframe: <boolean>,\r\n *  wireframeLinewidth: <float>\r\n * }\r\n */\r\n\r\nTHREE.MeshNormalMaterial = function ( parameters ) {\r\n\r\n\tTHREE.Material.call( this, parameters );\r\n\r\n\tthis.type = 'MeshNormalMaterial';\r\n\r\n\tthis.wireframe = false;\r\n\tthis.wireframeLinewidth = 1;\r\n\r\n\tthis.morphTargets = false;\r\n\r\n\tthis.setValues( parameters );\r\n\r\n};\r\n\r\nTHREE.MeshNormalMaterial.prototype = Object.create( THREE.Material.prototype );\r\nTHREE.MeshNormalMaterial.prototype.constructor = THREE.MeshNormalMaterial;\r\n\r\nTHREE.MeshNormalMaterial.prototype.clone = function () {\r\n\r\n\tvar material = new THREE.MeshNormalMaterial();\r\n\r\n\tTHREE.Material.prototype.clone.call( this, material );\r\n\r\n\tmaterial.wireframe = this.wireframe;\r\n\tmaterial.wireframeLinewidth = this.wireframeLinewidth;\r\n\r\n\treturn material;\r\n\r\n};\r\n\r\n// File:src/materials/MeshFaceMaterial.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.MeshFaceMaterial = function ( materials ) {\r\n\r\n\tthis.uuid = THREE.Math.generateUUID();\r\n\r\n\tthis.type = 'MeshFaceMaterial';\r\n\t\r\n\tthis.materials = materials instanceof Array ? materials : [];\r\n\r\n};\r\n\r\nTHREE.MeshFaceMaterial.prototype = {\r\n\r\n\tconstructor: THREE.MeshFaceMaterial,\r\n\r\n\ttoJSON: function () {\r\n\r\n\t\tvar output = {\r\n\t\t\tmetadata: {\r\n\t\t\t\tversion: 4.2,\r\n\t\t\t\ttype: 'material',\r\n\t\t\t\tgenerator: 'MaterialExporter'\r\n\t\t\t},\r\n\t\t\tuuid: this.uuid,\r\n\t\t\ttype: this.type,\r\n\t\t\tmaterials: []\r\n\t\t};\r\n\r\n\t\tfor ( var i = 0, l = this.materials.length; i < l; i ++ ) {\r\n\r\n\t\t\toutput.materials.push( this.materials[ i ].toJSON() );\r\n\r\n\t\t}\r\n\r\n\t\treturn output;\r\n\r\n\t},\r\n\r\n\tclone: function () {\r\n\r\n\t\tvar material = new THREE.MeshFaceMaterial();\r\n\r\n\t\tfor ( var i = 0; i < this.materials.length; i ++ ) {\r\n\r\n\t\t\tmaterial.materials.push( this.materials[ i ].clone() );\r\n\r\n\t\t}\r\n\r\n\t\treturn material;\r\n\r\n\t}\r\n\r\n};\r\n\r\n// File:src/materials/PointCloudMaterial.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author alteredq / http://alteredqualia.com/\r\n *\r\n * parameters = {\r\n *  color: <hex>,\r\n *  opacity: <float>,\r\n *  map: new THREE.Texture( <Image> ),\r\n *\r\n *  size: <float>,\r\n *  sizeAttenuation: <bool>,\r\n *\r\n *  blending: THREE.NormalBlending,\r\n *  depthTest: <bool>,\r\n *  depthWrite: <bool>,\r\n *\r\n *  vertexColors: <bool>,\r\n *\r\n *  fog: <bool>\r\n * }\r\n */\r\n\r\nTHREE.PointCloudMaterial = function ( parameters ) {\r\n\r\n\tTHREE.Material.call( this );\r\n\r\n\tthis.type = 'PointCloudMaterial';\r\n\r\n\tthis.color = new THREE.Color( 0xffffff );\r\n\r\n\tthis.map = null;\r\n\r\n\tthis.size = 1;\r\n\tthis.sizeAttenuation = true;\r\n\r\n\tthis.vertexColors = THREE.NoColors;\r\n\r\n\tthis.fog = true;\r\n\r\n\tthis.setValues( parameters );\r\n\r\n};\r\n\r\nTHREE.PointCloudMaterial.prototype = Object.create( THREE.Material.prototype );\r\nTHREE.PointCloudMaterial.prototype.constructor = THREE.PointCloudMaterial;\r\n\r\nTHREE.PointCloudMaterial.prototype.clone = function () {\r\n\r\n\tvar material = new THREE.PointCloudMaterial();\r\n\r\n\tTHREE.Material.prototype.clone.call( this, material );\r\n\r\n\tmaterial.color.copy( this.color );\r\n\r\n\tmaterial.map = this.map;\r\n\r\n\tmaterial.size = this.size;\r\n\tmaterial.sizeAttenuation = this.sizeAttenuation;\r\n\r\n\tmaterial.vertexColors = this.vertexColors;\r\n\r\n\tmaterial.fog = this.fog;\r\n\r\n\treturn material;\r\n\r\n};\r\n\r\n// backwards compatibility\r\n\r\nTHREE.ParticleBasicMaterial = function ( parameters ) {\r\n\r\n\tTHREE.warn( 'THREE.ParticleBasicMaterial has been renamed to THREE.PointCloudMaterial.' );\r\n\treturn new THREE.PointCloudMaterial( parameters );\r\n\r\n};\r\n\r\nTHREE.ParticleSystemMaterial = function ( parameters ) {\r\n\r\n\tTHREE.warn( 'THREE.ParticleSystemMaterial has been renamed to THREE.PointCloudMaterial.' );\r\n\treturn new THREE.PointCloudMaterial( parameters );\r\n\r\n};\r\n\r\n// File:src/materials/ShaderMaterial.js\r\n\r\n/**\r\n * @author alteredq / http://alteredqualia.com/\r\n *\r\n * parameters = {\r\n *  defines: { \"label\" : \"value\" },\r\n *  uniforms: { \"parameter1\": { type: \"f\", value: 1.0 }, \"parameter2\": { type: \"i\" value2: 2 } },\r\n *\r\n *  fragmentShader: <string>,\r\n *  vertexShader: <string>,\r\n *\r\n *  shading: THREE.SmoothShading,\r\n *  blending: THREE.NormalBlending,\r\n *  depthTest: <bool>,\r\n *  depthWrite: <bool>,\r\n *\r\n *  wireframe: <boolean>,\r\n *  wireframeLinewidth: <float>,\r\n *\r\n *  lights: <bool>,\r\n *\r\n *  vertexColors: THREE.NoColors / THREE.VertexColors / THREE.FaceColors,\r\n *\r\n *  skinning: <bool>,\r\n *  morphTargets: <bool>,\r\n *  morphNormals: <bool>,\r\n *\r\n *\tfog: <bool>\r\n * }\r\n */\r\n\r\nTHREE.ShaderMaterial = function ( parameters ) {\r\n\r\n\tTHREE.Material.call( this );\r\n\r\n\tthis.type = 'ShaderMaterial';\r\n\r\n\tthis.defines = {};\r\n\tthis.uniforms = {};\r\n\tthis.attributes = null;\r\n\r\n\tthis.vertexShader = 'void main() {\\n\\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\\n}';\r\n\tthis.fragmentShader = 'void main() {\\n\\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\\n}';\r\n\r\n\tthis.shading = THREE.SmoothShading;\r\n\r\n\tthis.linewidth = 1;\r\n\r\n\tthis.wireframe = false;\r\n\tthis.wireframeLinewidth = 1;\r\n\r\n\tthis.fog = false; // set to use scene fog\r\n\r\n\tthis.lights = false; // set to use scene lights\r\n\r\n\tthis.vertexColors = THREE.NoColors; // set to use \"color\" attribute stream\r\n\r\n\tthis.skinning = false; // set to use skinning attribute streams\r\n\r\n\tthis.morphTargets = false; // set to use morph targets\r\n\tthis.morphNormals = false; // set to use morph normals\r\n\r\n\t// When rendered geometry doesn't include these attributes but the material does,\r\n\t// use these default values in WebGL. This avoids errors when buffer data is missing.\r\n\tthis.defaultAttributeValues = {\r\n\t\t'color': [ 1, 1, 1 ],\r\n\t\t'uv': [ 0, 0 ],\r\n\t\t'uv2': [ 0, 0 ]\r\n\t};\r\n\r\n\tthis.index0AttributeName = undefined;\r\n\r\n\tthis.setValues( parameters );\r\n\r\n};\r\n\r\nTHREE.ShaderMaterial.prototype = Object.create( THREE.Material.prototype );\r\nTHREE.ShaderMaterial.prototype.constructor = THREE.ShaderMaterial;\r\n\r\nTHREE.ShaderMaterial.prototype.clone = function () {\r\n\r\n\tvar material = new THREE.ShaderMaterial();\r\n\r\n\tTHREE.Material.prototype.clone.call( this, material );\r\n\r\n\tmaterial.fragmentShader = this.fragmentShader;\r\n\tmaterial.vertexShader = this.vertexShader;\r\n\r\n\tmaterial.uniforms = THREE.UniformsUtils.clone( this.uniforms );\r\n\r\n\tmaterial.attributes = this.attributes;\r\n\tmaterial.defines = this.defines;\r\n\r\n\tmaterial.shading = this.shading;\r\n\r\n\tmaterial.wireframe = this.wireframe;\r\n\tmaterial.wireframeLinewidth = this.wireframeLinewidth;\r\n\r\n\tmaterial.fog = this.fog;\r\n\r\n\tmaterial.lights = this.lights;\r\n\r\n\tmaterial.vertexColors = this.vertexColors;\r\n\r\n\tmaterial.skinning = this.skinning;\r\n\r\n\tmaterial.morphTargets = this.morphTargets;\r\n\tmaterial.morphNormals = this.morphNormals;\r\n\r\n\treturn material;\r\n\r\n};\r\n\r\n// File:src/materials/RawShaderMaterial.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.RawShaderMaterial = function ( parameters ) {\r\n\r\n\tTHREE.ShaderMaterial.call( this, parameters );\r\n\r\n\tthis.type = 'RawShaderMaterial';\r\n\r\n};\r\n\r\nTHREE.RawShaderMaterial.prototype = Object.create( THREE.ShaderMaterial.prototype );\r\nTHREE.RawShaderMaterial.prototype.constructor = THREE.RawShaderMaterial;\r\n\r\nTHREE.RawShaderMaterial.prototype.clone = function () {\r\n\r\n\tvar material = new THREE.RawShaderMaterial();\r\n\r\n\tTHREE.ShaderMaterial.prototype.clone.call( this, material );\r\n\r\n\treturn material;\r\n\r\n};\r\n\r\n// File:src/materials/SpriteMaterial.js\r\n\r\n/**\r\n * @author alteredq / http://alteredqualia.com/\r\n *\r\n * parameters = {\r\n *  color: <hex>,\r\n *  opacity: <float>,\r\n *  map: new THREE.Texture( <Image> ),\r\n *\r\n *  blending: THREE.NormalBlending,\r\n *  depthTest: <bool>,\r\n *  depthWrite: <bool>,\r\n *\r\n *\tuvOffset: new THREE.Vector2(),\r\n *\tuvScale: new THREE.Vector2(),\r\n *\r\n *  fog: <bool>\r\n * }\r\n */\r\n\r\nTHREE.SpriteMaterial = function ( parameters ) {\r\n\r\n\tTHREE.Material.call( this );\r\n\r\n\tthis.type = 'SpriteMaterial';\r\n\r\n\tthis.color = new THREE.Color( 0xffffff );\r\n\tthis.map = null;\r\n\r\n\tthis.rotation = 0;\r\n\r\n\tthis.fog = false;\r\n\r\n\t// set parameters\r\n\r\n\tthis.setValues( parameters );\r\n\r\n};\r\n\r\nTHREE.SpriteMaterial.prototype = Object.create( THREE.Material.prototype );\r\nTHREE.SpriteMaterial.prototype.constructor = THREE.SpriteMaterial;\r\n\r\nTHREE.SpriteMaterial.prototype.clone = function () {\r\n\r\n\tvar material = new THREE.SpriteMaterial();\r\n\r\n\tTHREE.Material.prototype.clone.call( this, material );\r\n\r\n\tmaterial.color.copy( this.color );\r\n\tmaterial.map = this.map;\r\n\r\n\tmaterial.rotation = this.rotation;\r\n\r\n\tmaterial.fog = this.fog;\r\n\r\n\treturn material;\r\n\r\n};\r\n\r\n// File:src/textures/Texture.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author alteredq / http://alteredqualia.com/\r\n * @author szimek / https://github.com/szimek/\r\n */\r\n\r\nTHREE.Texture = function ( image, mapping, wrapS, wrapT, magFilter, minFilter, format, type, anisotropy ) {\r\n\r\n\tObject.defineProperty( this, 'id', { value: THREE.TextureIdCount ++ } );\r\n\r\n\tthis.uuid = THREE.Math.generateUUID();\r\n\r\n\tthis.name = '';\r\n\tthis.sourceFile = '';\r\n\r\n\tthis.image = image !== undefined ? image : THREE.Texture.DEFAULT_IMAGE;\r\n\tthis.mipmaps = [];\r\n\r\n\tthis.mapping = mapping !== undefined ? mapping : THREE.Texture.DEFAULT_MAPPING;\r\n\r\n\tthis.wrapS = wrapS !== undefined ? wrapS : THREE.ClampToEdgeWrapping;\r\n\tthis.wrapT = wrapT !== undefined ? wrapT : THREE.ClampToEdgeWrapping;\r\n\r\n\tthis.magFilter = magFilter !== undefined ? magFilter : THREE.LinearFilter;\r\n\tthis.minFilter = minFilter !== undefined ? minFilter : THREE.LinearMipMapLinearFilter;\r\n\r\n\tthis.anisotropy = anisotropy !== undefined ? anisotropy : 1;\r\n\r\n\tthis.format = format !== undefined ? format : THREE.RGBAFormat;\r\n\tthis.type = type !== undefined ? type : THREE.UnsignedByteType;\r\n\r\n\tthis.offset = new THREE.Vector2( 0, 0 );\r\n\tthis.repeat = new THREE.Vector2( 1, 1 );\r\n\r\n\tthis.generateMipmaps = true;\r\n\tthis.premultiplyAlpha = false;\r\n\tthis.flipY = true;\r\n\tthis.unpackAlignment = 4; // valid values: 1, 2, 4, 8 (see http://www.khronos.org/opengles/sdk/docs/man/xhtml/glPixelStorei.xml)\r\n\r\n\tthis._needsUpdate = false;\r\n\tthis.onUpdate = null;\r\n\r\n};\r\n\r\nTHREE.Texture.DEFAULT_IMAGE = undefined;\r\nTHREE.Texture.DEFAULT_MAPPING = THREE.UVMapping;\r\n\r\nTHREE.Texture.prototype = {\r\n\r\n\tconstructor: THREE.Texture,\r\n\r\n\tget needsUpdate () {\r\n\r\n\t\treturn this._needsUpdate;\r\n\r\n\t},\r\n\r\n\tset needsUpdate ( value ) {\r\n\r\n\t\tif ( value === true ) this.update();\r\n\r\n\t\tthis._needsUpdate = value;\r\n\r\n\t},\r\n\r\n\tclone: function ( texture ) {\r\n\r\n\t\tif ( texture === undefined ) texture = new THREE.Texture();\r\n\r\n\t\ttexture.image = this.image;\r\n\t\ttexture.mipmaps = this.mipmaps.slice( 0 );\r\n\r\n\t\ttexture.mapping = this.mapping;\r\n\r\n\t\ttexture.wrapS = this.wrapS;\r\n\t\ttexture.wrapT = this.wrapT;\r\n\r\n\t\ttexture.magFilter = this.magFilter;\r\n\t\ttexture.minFilter = this.minFilter;\r\n\r\n\t\ttexture.anisotropy = this.anisotropy;\r\n\r\n\t\ttexture.format = this.format;\r\n\t\ttexture.type = this.type;\r\n\r\n\t\ttexture.offset.copy( this.offset );\r\n\t\ttexture.repeat.copy( this.repeat );\r\n\r\n\t\ttexture.generateMipmaps = this.generateMipmaps;\r\n\t\ttexture.premultiplyAlpha = this.premultiplyAlpha;\r\n\t\ttexture.flipY = this.flipY;\r\n\t\ttexture.unpackAlignment = this.unpackAlignment;\r\n\r\n\t\treturn texture;\r\n\r\n\t},\r\n\r\n\tupdate: function () {\r\n\r\n\t\tthis.dispatchEvent( { type: 'update' } );\r\n\r\n\t},\r\n\r\n\tdispose: function () {\r\n\r\n\t\tthis.dispatchEvent( { type: 'dispose' } );\r\n\r\n\t}\r\n\r\n};\r\n\r\nTHREE.EventDispatcher.prototype.apply( THREE.Texture.prototype );\r\n\r\nTHREE.TextureIdCount = 0;\r\n\r\n// File:src/textures/CubeTexture.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.CubeTexture = function ( images, mapping, wrapS, wrapT, magFilter, minFilter, format, type, anisotropy ) {\r\n\r\n\tmapping = mapping !== undefined ? mapping : THREE.CubeReflectionMapping;\r\n\t\r\n\tTHREE.Texture.call( this, images, mapping, wrapS, wrapT, magFilter, minFilter, format, type, anisotropy );\r\n\r\n\tthis.images = images;\r\n\r\n};\r\n\r\nTHREE.CubeTexture.prototype = Object.create( THREE.Texture.prototype );\r\nTHREE.CubeTexture.prototype.constructor = THREE.CubeTexture;\r\n\r\nTHREE.CubeTexture.clone = function ( texture ) {\r\n\r\n\tif ( texture === undefined ) texture = new THREE.CubeTexture();\r\n\r\n\tTHREE.Texture.prototype.clone.call( this, texture );\r\n\r\n\ttexture.images = this.images;\r\n\r\n\treturn texture;\r\n\r\n};\r\n\r\n// File:src/textures/CompressedTexture.js\r\n\r\n/**\r\n * @author alteredq / http://alteredqualia.com/\r\n */\r\n\r\nTHREE.CompressedTexture = function ( mipmaps, width, height, format, type, mapping, wrapS, wrapT, magFilter, minFilter, anisotropy ) {\r\n\r\n\tTHREE.Texture.call( this, null, mapping, wrapS, wrapT, magFilter, minFilter, format, type, anisotropy );\r\n\r\n\tthis.image = { width: width, height: height };\r\n\tthis.mipmaps = mipmaps;\r\n\r\n\t// no flipping for cube textures\r\n\t// (also flipping doesn't work for compressed textures )\r\n\r\n\tthis.flipY = false;\r\n\r\n\t// can't generate mipmaps for compressed textures\r\n\t// mips must be embedded in DDS files\r\n\r\n\tthis.generateMipmaps = false;\r\n\r\n};\r\n\r\nTHREE.CompressedTexture.prototype = Object.create( THREE.Texture.prototype );\r\nTHREE.CompressedTexture.prototype.constructor = THREE.CompressedTexture;\r\n\r\nTHREE.CompressedTexture.prototype.clone = function () {\r\n\r\n\tvar texture = new THREE.CompressedTexture();\r\n\r\n\tTHREE.Texture.prototype.clone.call( this, texture );\r\n\r\n\treturn texture;\r\n\r\n};\r\n\r\n// File:src/textures/DataTexture.js\r\n\r\n/**\r\n * @author alteredq / http://alteredqualia.com/\r\n */\r\n\r\nTHREE.DataTexture = function ( data, width, height, format, type, mapping, wrapS, wrapT, magFilter, minFilter, anisotropy ) {\r\n\r\n\tTHREE.Texture.call( this, null, mapping, wrapS, wrapT, magFilter, minFilter, format, type, anisotropy );\r\n\r\n\tthis.image = { data: data, width: width, height: height };\r\n\r\n};\r\n\r\nTHREE.DataTexture.prototype = Object.create( THREE.Texture.prototype );\r\nTHREE.DataTexture.prototype.constructor = THREE.DataTexture;\r\n\r\nTHREE.DataTexture.prototype.clone = function () {\r\n\r\n\tvar texture = new THREE.DataTexture();\r\n\r\n\tTHREE.Texture.prototype.clone.call( this, texture );\r\n\r\n\treturn texture;\r\n\r\n};\r\n\r\n// File:src/textures/VideoTexture.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.VideoTexture = function ( video, mapping, wrapS, wrapT, magFilter, minFilter, format, type, anisotropy ) {\r\n\r\n\tTHREE.Texture.call( this, video, mapping, wrapS, wrapT, magFilter, minFilter, format, type, anisotropy );\r\n\r\n\tthis.generateMipmaps = false;\r\n\r\n\tvar scope = this;\r\n\r\n\tvar update = function () {\r\n\r\n\t\trequestAnimationFrame( update );\r\n\r\n\t\tif ( video.readyState === video.HAVE_ENOUGH_DATA ) {\r\n\r\n\t\t\tscope.needsUpdate = true;\r\n\r\n\t\t}\r\n\r\n\t};\r\n\r\n\tupdate();\r\n\r\n};\r\n\r\nTHREE.VideoTexture.prototype = Object.create( THREE.Texture.prototype );\r\nTHREE.VideoTexture.prototype.constructor = THREE.VideoTexture;\r\n\r\n// File:src/objects/Group.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.Group = function () {\r\n\r\n\tTHREE.Object3D.call( this );\r\n\r\n\tthis.type = 'Group';\r\n\r\n};\r\n\r\nTHREE.Group.prototype = Object.create( THREE.Object3D.prototype );\r\nTHREE.Group.prototype.constructor = THREE.Group;\r\n\r\n// File:src/objects/PointCloud.js\r\n\r\n/**\r\n * @author alteredq / http://alteredqualia.com/\r\n */\r\n\r\nTHREE.PointCloud = function ( geometry, material ) {\r\n\r\n\tTHREE.Object3D.call( this );\r\n\r\n\tthis.type = 'PointCloud';\r\n\r\n\tthis.geometry = geometry !== undefined ? geometry : new THREE.Geometry();\r\n\tthis.material = material !== undefined ? material : new THREE.PointCloudMaterial( { color: Math.random() * 0xffffff } );\r\n\r\n};\r\n\r\nTHREE.PointCloud.prototype = Object.create( THREE.Object3D.prototype );\r\nTHREE.PointCloud.prototype.constructor = THREE.PointCloud;\r\n\r\nTHREE.PointCloud.prototype.raycast = ( function () {\r\n\r\n\tvar inverseMatrix = new THREE.Matrix4();\r\n\tvar ray = new THREE.Ray();\r\n\r\n\treturn function ( raycaster, intersects ) {\r\n\r\n\t\tvar object = this;\r\n\t\tvar geometry = object.geometry;\r\n\t\tvar threshold = raycaster.params.PointCloud.threshold;\r\n\r\n\t\tinverseMatrix.getInverse( this.matrixWorld );\r\n\t\tray.copy( raycaster.ray ).applyMatrix4( inverseMatrix );\r\n\r\n\t\tif ( geometry.boundingBox !== null ) {\r\n\r\n\t\t\tif ( ray.isIntersectionBox( geometry.boundingBox ) === false ) {\r\n\r\n\t\t\t\treturn;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tvar localThreshold = threshold / ( ( this.scale.x + this.scale.y + this.scale.z ) / 3 );\r\n\t\tvar position = new THREE.Vector3();\r\n\r\n\t\tvar testPoint = function ( point, index ) {\r\n\r\n\t\t\tvar rayPointDistance = ray.distanceToPoint( point );\r\n\r\n\t\t\tif ( rayPointDistance < localThreshold ) {\r\n\r\n\t\t\t\tvar intersectPoint = ray.closestPointToPoint( point );\r\n\t\t\t\tintersectPoint.applyMatrix4( object.matrixWorld );\r\n\r\n\t\t\t\tvar distance = raycaster.ray.origin.distanceTo( intersectPoint );\r\n\r\n\t\t\t\tintersects.push( {\r\n\r\n\t\t\t\t\tdistance: distance,\r\n\t\t\t\t\tdistanceToRay: rayPointDistance,\r\n\t\t\t\t\tpoint: intersectPoint.clone(),\r\n\t\t\t\t\tindex: index,\r\n\t\t\t\t\tface: null,\r\n\t\t\t\t\tobject: object\r\n\r\n\t\t\t\t} );\r\n\r\n\t\t\t}\r\n\r\n\t\t};\r\n\r\n\t\tif ( geometry instanceof THREE.BufferGeometry ) {\r\n\r\n\t\t\tvar attributes = geometry.attributes;\r\n\t\t\tvar positions = attributes.position.array;\r\n\r\n\t\t\tif ( attributes.index !== undefined ) {\r\n\r\n\t\t\t\tvar indices = attributes.index.array;\r\n\t\t\t\tvar offsets = geometry.offsets;\r\n\r\n\t\t\t\tif ( offsets.length === 0 ) {\r\n\r\n\t\t\t\t\tvar offset = {\r\n\t\t\t\t\t\tstart: 0,\r\n\t\t\t\t\t\tcount: indices.length,\r\n\t\t\t\t\t\tindex: 0\r\n\t\t\t\t\t};\r\n\r\n\t\t\t\t\toffsets = [ offset ];\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfor ( var oi = 0, ol = offsets.length; oi < ol; ++ oi ) {\r\n\r\n\t\t\t\t\tvar start = offsets[ oi ].start;\r\n\t\t\t\t\tvar count = offsets[ oi ].count;\r\n\t\t\t\t\tvar index = offsets[ oi ].index;\r\n\r\n\t\t\t\t\tfor ( var i = start, il = start + count; i < il; i ++ ) {\r\n\r\n\t\t\t\t\t\tvar a = index + indices[ i ];\r\n\r\n\t\t\t\t\t\tposition.fromArray( positions, a * 3 );\r\n\r\n\t\t\t\t\t\ttestPoint( position, a );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tvar pointCount = positions.length / 3;\r\n\r\n\t\t\t\tfor ( var i = 0; i < pointCount; i ++ ) {\r\n\r\n\t\t\t\t\tposition.set(\r\n\t\t\t\t\t\tpositions[ 3 * i ],\r\n\t\t\t\t\t\tpositions[ 3 * i + 1 ],\r\n\t\t\t\t\t\tpositions[ 3 * i + 2 ]\r\n\t\t\t\t\t);\r\n\r\n\t\t\t\t\ttestPoint( position, i );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t} else {\r\n\r\n\t\t\tvar vertices = this.geometry.vertices;\r\n\r\n\t\t\tfor ( var i = 0; i < vertices.length; i ++ ) {\r\n\r\n\t\t\t\ttestPoint( vertices[ i ], i );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t};\r\n\r\n}() );\r\n\r\nTHREE.PointCloud.prototype.clone = function ( object ) {\r\n\r\n\tif ( object === undefined ) object = new THREE.PointCloud( this.geometry, this.material );\r\n\r\n\tTHREE.Object3D.prototype.clone.call( this, object );\r\n\r\n\treturn object;\r\n\r\n};\r\n\r\n// Backwards compatibility\r\n\r\nTHREE.ParticleSystem = function ( geometry, material ) {\r\n\r\n\tTHREE.warn( 'THREE.ParticleSystem has been renamed to THREE.PointCloud.' );\r\n\treturn new THREE.PointCloud( geometry, material );\r\n\r\n};\r\n\r\n// File:src/objects/Line.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.Line = function ( geometry, material, mode ) {\r\n\r\n\tTHREE.Object3D.call( this );\r\n\r\n\tthis.type = 'Line';\r\n\r\n\tthis.geometry = geometry !== undefined ? geometry : new THREE.Geometry();\r\n\tthis.material = material !== undefined ? material : new THREE.LineBasicMaterial( { color: Math.random() * 0xffffff } );\r\n\r\n\tthis.mode = mode !== undefined ? mode : THREE.LineStrip;\r\n\r\n};\r\n\r\nTHREE.LineStrip = 0;\r\nTHREE.LinePieces = 1;\r\n\r\nTHREE.Line.prototype = Object.create( THREE.Object3D.prototype );\r\nTHREE.Line.prototype.constructor = THREE.Line;\r\n\r\nTHREE.Line.prototype.raycast = ( function () {\r\n\r\n\tvar inverseMatrix = new THREE.Matrix4();\r\n\tvar ray = new THREE.Ray();\r\n\tvar sphere = new THREE.Sphere();\r\n\r\n\treturn function ( raycaster, intersects ) {\r\n\r\n\t\tvar precision = raycaster.linePrecision;\r\n\t\tvar precisionSq = precision * precision;\r\n\r\n\t\tvar geometry = this.geometry;\r\n\r\n\t\tif ( geometry.boundingSphere === null ) geometry.computeBoundingSphere();\r\n\r\n\t\t// Checking boundingSphere distance to ray\r\n\r\n\t\tsphere.copy( geometry.boundingSphere );\r\n\t\tsphere.applyMatrix4( this.matrixWorld );\r\n\r\n\t\tif ( raycaster.ray.isIntersectionSphere( sphere ) === false ) {\r\n\r\n\t\t\treturn;\r\n\r\n\t\t}\r\n\r\n\t\tinverseMatrix.getInverse( this.matrixWorld );\r\n\t\tray.copy( raycaster.ray ).applyMatrix4( inverseMatrix );\r\n\r\n\t\tvar vStart = new THREE.Vector3();\r\n\t\tvar vEnd = new THREE.Vector3();\r\n\t\tvar interSegment = new THREE.Vector3();\r\n\t\tvar interRay = new THREE.Vector3();\r\n\t\tvar step = this.mode === THREE.LineStrip ? 1 : 2;\r\n\r\n\t\tif ( geometry instanceof THREE.BufferGeometry ) {\r\n\r\n\t\t\tvar attributes = geometry.attributes;\r\n\r\n\t\t\tif ( attributes.index !== undefined ) {\r\n\r\n\t\t\t\tvar indices = attributes.index.array;\r\n\t\t\t\tvar positions = attributes.position.array;\r\n\t\t\t\tvar offsets = geometry.offsets;\r\n\r\n\t\t\t\tif ( offsets.length === 0 ) {\r\n\r\n\t\t\t\t\toffsets = [ { start: 0, count: indices.length, index: 0 } ];\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfor ( var oi = 0; oi < offsets.length; oi ++) {\r\n\r\n\t\t\t\t\tvar start = offsets[ oi ].start;\r\n\t\t\t\t\tvar count = offsets[ oi ].count;\r\n\t\t\t\t\tvar index = offsets[ oi ].index;\r\n\r\n\t\t\t\t\tfor ( var i = start; i < start + count - 1; i += step ) {\r\n\r\n\t\t\t\t\t\tvar a = index + indices[ i ];\r\n\t\t\t\t\t\tvar b = index + indices[ i + 1 ];\r\n\r\n\t\t\t\t\t\tvStart.fromArray( positions, a * 3 );\r\n\t\t\t\t\t\tvEnd.fromArray( positions, b * 3 );\r\n\r\n\t\t\t\t\t\tvar distSq = ray.distanceSqToSegment( vStart, vEnd, interRay, interSegment );\r\n\r\n\t\t\t\t\t\tif ( distSq > precisionSq ) continue;\r\n\r\n\t\t\t\t\t\tvar distance = ray.origin.distanceTo( interRay );\r\n\r\n\t\t\t\t\t\tif ( distance < raycaster.near || distance > raycaster.far ) continue;\r\n\r\n\t\t\t\t\t\tintersects.push( {\r\n\r\n\t\t\t\t\t\t\tdistance: distance,\r\n\t\t\t\t\t\t\t// What do we want? intersection point on the ray or on the segment??\r\n\t\t\t\t\t\t\t// point: raycaster.ray.at( distance ),\r\n\t\t\t\t\t\t\tpoint: interSegment.clone().applyMatrix4( this.matrixWorld ),\r\n\t\t\t\t\t\t\tindex: i,\r\n\t\t\t\t\t\t\toffsetIndex: oi,\r\n\t\t\t\t\t\t\tface: null,\r\n\t\t\t\t\t\t\tfaceIndex: null,\r\n\t\t\t\t\t\t\tobject: this\r\n\r\n\t\t\t\t\t\t} );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tvar positions = attributes.position.array;\r\n\r\n\t\t\t\tfor ( var i = 0; i < positions.length / 3 - 1; i += step ) {\r\n\r\n\t\t\t\t\tvStart.fromArray( positions, 3 * i );\r\n\t\t\t\t\tvEnd.fromArray( positions, 3 * i + 3 );\r\n\r\n\t\t\t\t\tvar distSq = ray.distanceSqToSegment( vStart, vEnd, interRay, interSegment );\r\n\r\n\t\t\t\t\tif ( distSq > precisionSq ) continue;\r\n\r\n\t\t\t\t\tvar distance = ray.origin.distanceTo( interRay );\r\n\r\n\t\t\t\t\tif ( distance < raycaster.near || distance > raycaster.far ) continue;\r\n\r\n\t\t\t\t\tintersects.push( {\r\n\r\n\t\t\t\t\t\tdistance: distance,\r\n\t\t\t\t\t\t// What do we want? intersection point on the ray or on the segment??\r\n\t\t\t\t\t\t// point: raycaster.ray.at( distance ),\r\n\t\t\t\t\t\tpoint: interSegment.clone().applyMatrix4( this.matrixWorld ),\r\n\t\t\t\t\t\tindex: i,\r\n\t\t\t\t\t\tface: null,\r\n\t\t\t\t\t\tfaceIndex: null,\r\n\t\t\t\t\t\tobject: this\r\n\r\n\t\t\t\t\t} );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t} else if ( geometry instanceof THREE.Geometry ) {\r\n\r\n\t\t\tvar vertices = geometry.vertices;\r\n\t\t\tvar nbVertices = vertices.length;\r\n\r\n\t\t\tfor ( var i = 0; i < nbVertices - 1; i += step ) {\r\n\r\n\t\t\t\tvar distSq = ray.distanceSqToSegment( vertices[ i ], vertices[ i + 1 ], interRay, interSegment );\r\n\r\n\t\t\t\tif ( distSq > precisionSq ) continue;\r\n\r\n\t\t\t\tvar distance = ray.origin.distanceTo( interRay );\r\n\r\n\t\t\t\tif ( distance < raycaster.near || distance > raycaster.far ) continue;\r\n\r\n\t\t\t\tintersects.push( {\r\n\r\n\t\t\t\t\tdistance: distance,\r\n\t\t\t\t\t// What do we want? intersection point on the ray or on the segment??\r\n\t\t\t\t\t// point: raycaster.ray.at( distance ),\r\n\t\t\t\t\tpoint: interSegment.clone().applyMatrix4( this.matrixWorld ),\r\n\t\t\t\t\tindex: i,\r\n\t\t\t\t\tface: null,\r\n\t\t\t\t\tfaceIndex: null,\r\n\t\t\t\t\tobject: this\r\n\r\n\t\t\t\t} );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t};\r\n\r\n}() );\r\n\r\nTHREE.Line.prototype.clone = function ( object ) {\r\n\r\n\tif ( object === undefined ) object = new THREE.Line( this.geometry, this.material, this.mode );\r\n\r\n\tTHREE.Object3D.prototype.clone.call( this, object );\r\n\r\n\treturn object;\r\n\r\n};\r\n\r\n// File:src/objects/Mesh.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author alteredq / http://alteredqualia.com/\r\n * @author mikael emtinger / http://gomo.se/\r\n * @author jonobr1 / http://jonobr1.com/\r\n */\r\n\r\nTHREE.Mesh = function ( geometry, material ) {\r\n\r\n\tTHREE.Object3D.call( this );\r\n\r\n\tthis.type = 'Mesh';\r\n\t\r\n\tthis.geometry = geometry !== undefined ? geometry : new THREE.Geometry();\r\n\tthis.material = material !== undefined ? material : new THREE.MeshBasicMaterial( { color: Math.random() * 0xffffff } );\r\n\r\n\tthis.updateMorphTargets();\r\n\r\n};\r\n\r\nTHREE.Mesh.prototype = Object.create( THREE.Object3D.prototype );\r\nTHREE.Mesh.prototype.constructor = THREE.Mesh;\r\n\r\nTHREE.Mesh.prototype.updateMorphTargets = function () {\r\n\r\n\tif ( this.geometry.morphTargets !== undefined && this.geometry.morphTargets.length > 0 ) {\r\n\r\n\t\tthis.morphTargetBase = - 1;\r\n\t\tthis.morphTargetForcedOrder = [];\r\n\t\tthis.morphTargetInfluences = [];\r\n\t\tthis.morphTargetDictionary = {};\r\n\r\n\t\tfor ( var m = 0, ml = this.geometry.morphTargets.length; m < ml; m ++ ) {\r\n\r\n\t\t\tthis.morphTargetInfluences.push( 0 );\r\n\t\t\tthis.morphTargetDictionary[ this.geometry.morphTargets[ m ].name ] = m;\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n};\r\n\r\nTHREE.Mesh.prototype.getMorphTargetIndexByName = function ( name ) {\r\n\r\n\tif ( this.morphTargetDictionary[ name ] !== undefined ) {\r\n\r\n\t\treturn this.morphTargetDictionary[ name ];\r\n\r\n\t}\r\n\r\n\tTHREE.warn( 'THREE.Mesh.getMorphTargetIndexByName: morph target ' + name + ' does not exist. Returning 0.' );\r\n\r\n\treturn 0;\r\n\r\n};\r\n\r\n\r\nTHREE.Mesh.prototype.raycast = ( function () {\r\n\r\n\tvar inverseMatrix = new THREE.Matrix4();\r\n\tvar ray = new THREE.Ray();\r\n\tvar sphere = new THREE.Sphere();\r\n\r\n\tvar vA = new THREE.Vector3();\r\n\tvar vB = new THREE.Vector3();\r\n\tvar vC = new THREE.Vector3();\r\n\r\n\treturn function ( raycaster, intersects ) {\r\n\r\n\t\tvar geometry = this.geometry;\r\n\r\n\t\t// Checking boundingSphere distance to ray\r\n\r\n\t\tif ( geometry.boundingSphere === null ) geometry.computeBoundingSphere();\r\n\r\n\t\tsphere.copy( geometry.boundingSphere );\r\n\t\tsphere.applyMatrix4( this.matrixWorld );\r\n\r\n\t\tif ( raycaster.ray.isIntersectionSphere( sphere ) === false ) {\r\n\r\n\t\t\treturn;\r\n\r\n\t\t}\r\n\r\n\t\t// Check boundingBox before continuing\r\n\r\n\t\tinverseMatrix.getInverse( this.matrixWorld );\r\n\t\tray.copy( raycaster.ray ).applyMatrix4( inverseMatrix );\r\n\r\n\t\tif ( geometry.boundingBox !== null ) {\r\n\r\n\t\t\tif ( ray.isIntersectionBox( geometry.boundingBox ) === false ) {\r\n\r\n\t\t\t\treturn;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tif ( geometry instanceof THREE.BufferGeometry ) {\r\n\r\n\t\t\tvar material = this.material;\r\n\r\n\t\t\tif ( material === undefined ) return;\r\n\r\n\t\t\tvar attributes = geometry.attributes;\r\n\r\n\t\t\tvar a, b, c;\r\n\t\t\tvar precision = raycaster.precision;\r\n\r\n\t\t\tif ( attributes.index !== undefined ) {\r\n\r\n\t\t\t\tvar indices = attributes.index.array;\r\n\t\t\t\tvar positions = attributes.position.array;\r\n\t\t\t\tvar offsets = geometry.offsets;\r\n\r\n\t\t\t\tif ( offsets.length === 0 ) {\r\n\r\n\t\t\t\t\toffsets = [ { start: 0, count: indices.length, index: 0 } ];\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfor ( var oi = 0, ol = offsets.length; oi < ol; ++ oi ) {\r\n\r\n\t\t\t\t\tvar start = offsets[ oi ].start;\r\n\t\t\t\t\tvar count = offsets[ oi ].count;\r\n\t\t\t\t\tvar index = offsets[ oi ].index;\r\n\r\n\t\t\t\t\tfor ( var i = start, il = start + count; i < il; i += 3 ) {\r\n\r\n\t\t\t\t\t\ta = index + indices[ i ];\r\n\t\t\t\t\t\tb = index + indices[ i + 1 ];\r\n\t\t\t\t\t\tc = index + indices[ i + 2 ];\r\n\r\n\t\t\t\t\t\tvA.fromArray( positions, a * 3 );\r\n\t\t\t\t\t\tvB.fromArray( positions, b * 3 );\r\n\t\t\t\t\t\tvC.fromArray( positions, c * 3 );\r\n\r\n\t\t\t\t\t\tif ( material.side === THREE.BackSide ) {\r\n\r\n\t\t\t\t\t\t\tvar intersectionPoint = ray.intersectTriangle( vC, vB, vA, true );\r\n\r\n\t\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\t\tvar intersectionPoint = ray.intersectTriangle( vA, vB, vC, material.side !== THREE.DoubleSide );\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tif ( intersectionPoint === null ) continue;\r\n\r\n\t\t\t\t\t\tintersectionPoint.applyMatrix4( this.matrixWorld );\r\n\r\n\t\t\t\t\t\tvar distance = raycaster.ray.origin.distanceTo( intersectionPoint );\r\n\r\n\t\t\t\t\t\tif ( distance < precision || distance < raycaster.near || distance > raycaster.far ) continue;\r\n\r\n\t\t\t\t\t\tintersects.push( {\r\n\r\n\t\t\t\t\t\t\tdistance: distance,\r\n\t\t\t\t\t\t\tpoint: intersectionPoint,\r\n\t\t\t\t\t\t\tface: new THREE.Face3( a, b, c, THREE.Triangle.normal( vA, vB, vC ) ),\r\n\t\t\t\t\t\t\tfaceIndex: null,\r\n\t\t\t\t\t\t\tobject: this\r\n\r\n\t\t\t\t\t\t} );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tvar positions = attributes.position.array;\r\n\r\n\t\t\t\tfor ( var i = 0, j = 0, il = positions.length; i < il; i += 3, j += 9 ) {\r\n\r\n\t\t\t\t\ta = i;\r\n\t\t\t\t\tb = i + 1;\r\n\t\t\t\t\tc = i + 2;\r\n\r\n\t\t\t\t\tvA.fromArray( positions, j );\r\n\t\t\t\t\tvB.fromArray( positions, j + 3 );\r\n\t\t\t\t\tvC.fromArray( positions, j + 6 );\r\n\r\n\t\t\t\t\tif ( material.side === THREE.BackSide ) {\r\n\r\n\t\t\t\t\t\tvar intersectionPoint = ray.intersectTriangle( vC, vB, vA, true );\r\n\r\n\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\tvar intersectionPoint = ray.intersectTriangle( vA, vB, vC, material.side !== THREE.DoubleSide );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif ( intersectionPoint === null ) continue;\r\n\r\n\t\t\t\t\tintersectionPoint.applyMatrix4( this.matrixWorld );\r\n\r\n\t\t\t\t\tvar distance = raycaster.ray.origin.distanceTo( intersectionPoint );\r\n\r\n\t\t\t\t\tif ( distance < precision || distance < raycaster.near || distance > raycaster.far ) continue;\r\n\r\n\t\t\t\t\tintersects.push( {\r\n\r\n\t\t\t\t\t\tdistance: distance,\r\n\t\t\t\t\t\tpoint: intersectionPoint,\r\n\t\t\t\t\t\tface: new THREE.Face3( a, b, c, THREE.Triangle.normal( vA, vB, vC ) ),\r\n\t\t\t\t\t\tfaceIndex: null,\r\n\t\t\t\t\t\tobject: this\r\n\r\n\t\t\t\t\t} );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t} else if ( geometry instanceof THREE.Geometry ) {\r\n\r\n\t\t\tvar isFaceMaterial = this.material instanceof THREE.MeshFaceMaterial;\r\n\t\t\tvar objectMaterials = isFaceMaterial === true ? this.material.materials : null;\r\n\r\n\t\t\tvar a, b, c;\r\n\t\t\tvar precision = raycaster.precision;\r\n\r\n\t\t\tvar vertices = geometry.vertices;\r\n\r\n\t\t\tfor ( var f = 0, fl = geometry.faces.length; f < fl; f ++ ) {\r\n\r\n\t\t\t\tvar face = geometry.faces[ f ];\r\n\r\n\t\t\t\tvar material = isFaceMaterial === true ? objectMaterials[ face.materialIndex ] : this.material;\r\n\r\n\t\t\t\tif ( material === undefined ) continue;\r\n\r\n\t\t\t\ta = vertices[ face.a ];\r\n\t\t\t\tb = vertices[ face.b ];\r\n\t\t\t\tc = vertices[ face.c ];\r\n\r\n\t\t\t\tif ( material.morphTargets === true ) {\r\n\r\n\t\t\t\t\tvar morphTargets = geometry.morphTargets;\r\n\t\t\t\t\tvar morphInfluences = this.morphTargetInfluences;\r\n\r\n\t\t\t\t\tvA.set( 0, 0, 0 );\r\n\t\t\t\t\tvB.set( 0, 0, 0 );\r\n\t\t\t\t\tvC.set( 0, 0, 0 );\r\n\r\n\t\t\t\t\tfor ( var t = 0, tl = morphTargets.length; t < tl; t ++ ) {\r\n\r\n\t\t\t\t\t\tvar influence = morphInfluences[ t ];\r\n\r\n\t\t\t\t\t\tif ( influence === 0 ) continue;\r\n\r\n\t\t\t\t\t\tvar targets = morphTargets[ t ].vertices;\r\n\r\n\t\t\t\t\t\tvA.x += ( targets[ face.a ].x - a.x ) * influence;\r\n\t\t\t\t\t\tvA.y += ( targets[ face.a ].y - a.y ) * influence;\r\n\t\t\t\t\t\tvA.z += ( targets[ face.a ].z - a.z ) * influence;\r\n\r\n\t\t\t\t\t\tvB.x += ( targets[ face.b ].x - b.x ) * influence;\r\n\t\t\t\t\t\tvB.y += ( targets[ face.b ].y - b.y ) * influence;\r\n\t\t\t\t\t\tvB.z += ( targets[ face.b ].z - b.z ) * influence;\r\n\r\n\t\t\t\t\t\tvC.x += ( targets[ face.c ].x - c.x ) * influence;\r\n\t\t\t\t\t\tvC.y += ( targets[ face.c ].y - c.y ) * influence;\r\n\t\t\t\t\t\tvC.z += ( targets[ face.c ].z - c.z ) * influence;\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tvA.add( a );\r\n\t\t\t\t\tvB.add( b );\r\n\t\t\t\t\tvC.add( c );\r\n\r\n\t\t\t\t\ta = vA;\r\n\t\t\t\t\tb = vB;\r\n\t\t\t\t\tc = vC;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( material.side === THREE.BackSide ) {\r\n\r\n\t\t\t\t\tvar intersectionPoint = ray.intersectTriangle( c, b, a, true );\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\tvar intersectionPoint = ray.intersectTriangle( a, b, c, material.side !== THREE.DoubleSide );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( intersectionPoint === null ) continue;\r\n\r\n\t\t\t\tintersectionPoint.applyMatrix4( this.matrixWorld );\r\n\r\n\t\t\t\tvar distance = raycaster.ray.origin.distanceTo( intersectionPoint );\r\n\r\n\t\t\t\tif ( distance < precision || distance < raycaster.near || distance > raycaster.far ) continue;\r\n\r\n\t\t\t\tintersects.push( {\r\n\r\n\t\t\t\t\tdistance: distance,\r\n\t\t\t\t\tpoint: intersectionPoint,\r\n\t\t\t\t\tface: face,\r\n\t\t\t\t\tfaceIndex: f,\r\n\t\t\t\t\tobject: this\r\n\r\n\t\t\t\t} );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t};\r\n\r\n}() );\r\n\r\nTHREE.Mesh.prototype.clone = function ( object, recursive ) {\r\n\r\n\tif ( object === undefined ) object = new THREE.Mesh( this.geometry, this.material );\r\n\r\n\tTHREE.Object3D.prototype.clone.call( this, object, recursive );\r\n\r\n\treturn object;\r\n\r\n};\r\n\r\n// File:src/objects/Bone.js\r\n\r\n/**\r\n * @author mikael emtinger / http://gomo.se/\r\n * @author alteredq / http://alteredqualia.com/\r\n * @author ikerr / http://verold.com\r\n */\r\n\r\nTHREE.Bone = function ( skin ) {\r\n\r\n\tTHREE.Object3D.call( this );\r\n\r\n\tthis.type = 'Bone';\r\n\r\n\tthis.skin = skin;\r\n\r\n};\r\n\r\nTHREE.Bone.prototype = Object.create( THREE.Object3D.prototype );\r\nTHREE.Bone.prototype.constructor = THREE.Bone;\r\n\r\n// File:src/objects/Skeleton.js\r\n\r\n/**\r\n * @author mikael emtinger / http://gomo.se/\r\n * @author alteredq / http://alteredqualia.com/\r\n * @author michael guerrero / http://realitymeltdown.com\r\n * @author ikerr / http://verold.com\r\n */\r\n\r\nTHREE.Skeleton = function ( bones, boneInverses, useVertexTexture ) {\r\n\r\n\tthis.useVertexTexture = useVertexTexture !== undefined ? useVertexTexture : true;\r\n\r\n\tthis.identityMatrix = new THREE.Matrix4();\r\n\r\n\t// copy the bone array\r\n\r\n\tbones = bones || [];\r\n\r\n\tthis.bones = bones.slice( 0 );\r\n\r\n\t// create a bone texture or an array of floats\r\n\r\n\tif ( this.useVertexTexture ) {\r\n\r\n\t\t// layout (1 matrix = 4 pixels)\r\n\t\t//      RGBA RGBA RGBA RGBA (=> column1, column2, column3, column4)\r\n\t\t//  with  8x8  pixel texture max   16 bones  (8 * 8  / 4)\r\n\t\t//       16x16 pixel texture max   64 bones (16 * 16 / 4)\r\n\t\t//       32x32 pixel texture max  256 bones (32 * 32 / 4)\r\n\t\t//       64x64 pixel texture max 1024 bones (64 * 64 / 4)\r\n\r\n\t\tvar size;\r\n\r\n\t\tif ( this.bones.length > 256 )\r\n\t\t\tsize = 64;\r\n\t\telse if ( this.bones.length > 64 )\r\n\t\t\tsize = 32;\r\n\t\telse if ( this.bones.length > 16 )\r\n\t\t\tsize = 16;\r\n\t\telse\r\n\t\t\tsize = 8;\r\n\r\n\t\tthis.boneTextureWidth = size;\r\n\t\tthis.boneTextureHeight = size;\r\n\r\n\t\tthis.boneMatrices = new Float32Array( this.boneTextureWidth * this.boneTextureHeight * 4 ); // 4 floats per RGBA pixel\r\n\t\tthis.boneTexture = new THREE.DataTexture( this.boneMatrices, this.boneTextureWidth, this.boneTextureHeight, THREE.RGBAFormat, THREE.FloatType );\r\n\t\tthis.boneTexture.minFilter = THREE.NearestFilter;\r\n\t\tthis.boneTexture.magFilter = THREE.NearestFilter;\r\n\t\tthis.boneTexture.generateMipmaps = false;\r\n\t\tthis.boneTexture.flipY = false;\r\n\r\n\t} else {\r\n\r\n\t\tthis.boneMatrices = new Float32Array( 16 * this.bones.length );\r\n\r\n\t}\r\n\r\n\t// use the supplied bone inverses or calculate the inverses\r\n\r\n\tif ( boneInverses === undefined ) {\r\n\r\n\t\tthis.calculateInverses();\r\n\r\n\t} else {\r\n\r\n\t\tif ( this.bones.length === boneInverses.length ) {\r\n\r\n\t\t\tthis.boneInverses = boneInverses.slice( 0 );\r\n\r\n\t\t} else {\r\n\r\n\t\t\tTHREE.warn( 'THREE.Skeleton bonInverses is the wrong length.' );\r\n\r\n\t\t\tthis.boneInverses = [];\r\n\r\n\t\t\tfor ( var b = 0, bl = this.bones.length; b < bl; b ++ ) {\r\n\r\n\t\t\t\tthis.boneInverses.push( new THREE.Matrix4() );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n};\r\n\r\nTHREE.Skeleton.prototype.calculateInverses = function () {\r\n\r\n\tthis.boneInverses = [];\r\n\r\n\tfor ( var b = 0, bl = this.bones.length; b < bl; b ++ ) {\r\n\r\n\t\tvar inverse = new THREE.Matrix4();\r\n\r\n\t\tif ( this.bones[ b ] ) {\r\n\r\n\t\t\tinverse.getInverse( this.bones[ b ].matrixWorld );\r\n\r\n\t\t}\r\n\r\n\t\tthis.boneInverses.push( inverse );\r\n\r\n\t}\r\n\r\n};\r\n\r\nTHREE.Skeleton.prototype.pose = function () {\r\n\r\n\tvar bone;\r\n\r\n\t// recover the bind-time world matrices\r\n\r\n\tfor ( var b = 0, bl = this.bones.length; b < bl; b ++ ) {\r\n\r\n\t\tbone = this.bones[ b ];\r\n\r\n\t\tif ( bone ) {\r\n\r\n\t\t\tbone.matrixWorld.getInverse( this.boneInverses[ b ] );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\t// compute the local matrices, positions, rotations and scales\r\n\r\n\tfor ( var b = 0, bl = this.bones.length; b < bl; b ++ ) {\r\n\r\n\t\tbone = this.bones[ b ];\r\n\r\n\t\tif ( bone ) {\r\n\r\n\t\t\tif ( bone.parent ) {\r\n\r\n\t\t\t\tbone.matrix.getInverse( bone.parent.matrixWorld );\r\n\t\t\t\tbone.matrix.multiply( bone.matrixWorld );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tbone.matrix.copy( bone.matrixWorld );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tbone.matrix.decompose( bone.position, bone.quaternion, bone.scale );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n};\r\n\r\nTHREE.Skeleton.prototype.update = ( function () {\r\n\r\n\tvar offsetMatrix = new THREE.Matrix4();\r\n\t\r\n\treturn function () {\r\n\r\n\t\t// flatten bone matrices to array\r\n\r\n\t\tfor ( var b = 0, bl = this.bones.length; b < bl; b ++ ) {\r\n\r\n\t\t\t// compute the offset between the current and the original transform\r\n\r\n\t\t\tvar matrix = this.bones[ b ] ? this.bones[ b ].matrixWorld : this.identityMatrix;\r\n\r\n\t\t\toffsetMatrix.multiplyMatrices( matrix, this.boneInverses[ b ] );\r\n\t\t\toffsetMatrix.flattenToArrayOffset( this.boneMatrices, b * 16 );\r\n\r\n\t\t}\r\n\r\n\t\tif ( this.useVertexTexture ) {\r\n\r\n\t\t\tthis.boneTexture.needsUpdate = true;\r\n\r\n\t\t}\r\n\t\t\r\n\t};\r\n\r\n} )();\r\n\r\n\r\n// File:src/objects/SkinnedMesh.js\r\n\r\n/**\r\n * @author mikael emtinger / http://gomo.se/\r\n * @author alteredq / http://alteredqualia.com/\r\n * @author ikerr / http://verold.com\r\n */\r\n\r\nTHREE.SkinnedMesh = function ( geometry, material, useVertexTexture ) {\r\n\r\n\tTHREE.Mesh.call( this, geometry, material );\r\n\r\n\tthis.type = 'SkinnedMesh';\r\n\r\n\tthis.bindMode = \"attached\";\r\n\tthis.bindMatrix = new THREE.Matrix4();\r\n\tthis.bindMatrixInverse = new THREE.Matrix4();\r\n\r\n\t// init bones\r\n\r\n\t// TODO: remove bone creation as there is no reason (other than\r\n\t// convenience) for THREE.SkinnedMesh to do this.\r\n\r\n\tvar bones = [];\r\n\r\n\tif ( this.geometry && this.geometry.bones !== undefined ) {\r\n\r\n\t\tvar bone, gbone, p, q, s;\r\n\r\n\t\tfor ( var b = 0, bl = this.geometry.bones.length; b < bl; ++ b ) {\r\n\r\n\t\t\tgbone = this.geometry.bones[ b ];\r\n\r\n\t\t\tp = gbone.pos;\r\n\t\t\tq = gbone.rotq;\r\n\t\t\ts = gbone.scl;\r\n\r\n\t\t\tbone = new THREE.Bone( this );\r\n\t\t\tbones.push( bone );\r\n\r\n\t\t\tbone.name = gbone.name;\r\n\t\t\tbone.position.set( p[ 0 ], p[ 1 ], p[ 2 ] );\r\n\t\t\tbone.quaternion.set( q[ 0 ], q[ 1 ], q[ 2 ], q[ 3 ] );\r\n\r\n\t\t\tif ( s !== undefined ) {\r\n\r\n\t\t\t\tbone.scale.set( s[ 0 ], s[ 1 ], s[ 2 ] );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tbone.scale.set( 1, 1, 1 );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tfor ( var b = 0, bl = this.geometry.bones.length; b < bl; ++ b ) {\r\n\r\n\t\t\tgbone = this.geometry.bones[ b ];\r\n\r\n\t\t\tif ( gbone.parent !== - 1 ) {\r\n\r\n\t\t\t\tbones[ gbone.parent ].add( bones[ b ] );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tthis.add( bones[ b ] );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tthis.normalizeSkinWeights();\r\n\r\n\tthis.updateMatrixWorld( true );\r\n\tthis.bind( new THREE.Skeleton( bones, undefined, useVertexTexture ) );\r\n\r\n};\r\n\r\n\r\nTHREE.SkinnedMesh.prototype = Object.create( THREE.Mesh.prototype );\r\nTHREE.SkinnedMesh.prototype.constructor = THREE.SkinnedMesh;\r\n\r\nTHREE.SkinnedMesh.prototype.bind = function( skeleton, bindMatrix ) {\r\n\r\n\tthis.skeleton = skeleton;\r\n\r\n\tif ( bindMatrix === undefined ) {\r\n\r\n\t\tthis.updateMatrixWorld( true );\r\n\r\n\t\tbindMatrix = this.matrixWorld;\r\n\r\n\t}\r\n\r\n\tthis.bindMatrix.copy( bindMatrix );\r\n\tthis.bindMatrixInverse.getInverse( bindMatrix );\r\n\r\n};\r\n\r\nTHREE.SkinnedMesh.prototype.pose = function () {\r\n\r\n\tthis.skeleton.pose();\r\n\r\n};\r\n\r\nTHREE.SkinnedMesh.prototype.normalizeSkinWeights = function () {\r\n\r\n\tif ( this.geometry instanceof THREE.Geometry ) {\r\n\r\n\t\tfor ( var i = 0; i < this.geometry.skinIndices.length; i ++ ) {\r\n\r\n\t\t\tvar sw = this.geometry.skinWeights[ i ];\r\n\r\n\t\t\tvar scale = 1.0 / sw.lengthManhattan();\r\n\r\n\t\t\tif ( scale !== Infinity ) {\r\n\r\n\t\t\t\tsw.multiplyScalar( scale );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tsw.set( 1 ); // this will be normalized by the shader anyway\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t} else {\r\n\r\n\t\t// skinning weights assumed to be normalized for THREE.BufferGeometry\r\n\r\n\t}\r\n\r\n};\r\n\r\nTHREE.SkinnedMesh.prototype.updateMatrixWorld = function( force ) {\r\n\r\n\tTHREE.Mesh.prototype.updateMatrixWorld.call( this, true );\r\n\r\n\tif ( this.bindMode === \"attached\" ) {\r\n\r\n\t\tthis.bindMatrixInverse.getInverse( this.matrixWorld );\r\n\r\n\t} else if ( this.bindMode === \"detached\" ) {\r\n\r\n\t\tthis.bindMatrixInverse.getInverse( this.bindMatrix );\r\n\r\n\t} else {\r\n\r\n\t\tTHREE.warn( 'THREE.SkinnedMesh unreckognized bindMode: ' + this.bindMode );\r\n\r\n\t}\r\n\r\n};\r\n\r\nTHREE.SkinnedMesh.prototype.clone = function( object ) {\r\n\r\n\tif ( object === undefined ) {\r\n\r\n\t\tobject = new THREE.SkinnedMesh( this.geometry, this.material, this.useVertexTexture );\r\n\r\n\t}\r\n\r\n\tTHREE.Mesh.prototype.clone.call( this, object );\r\n\r\n\treturn object;\r\n\r\n};\r\n\r\n\r\n// File:src/objects/MorphAnimMesh.js\r\n\r\n/**\r\n * @author alteredq / http://alteredqualia.com/\r\n */\r\n\r\nTHREE.MorphAnimMesh = function ( geometry, material ) {\r\n\r\n\tTHREE.Mesh.call( this, geometry, material );\r\n\r\n\tthis.type = 'MorphAnimMesh';\r\n\r\n\t// API\r\n\r\n\tthis.duration = 1000; // milliseconds\r\n\tthis.mirroredLoop = false;\r\n\tthis.time = 0;\r\n\r\n\t// internals\r\n\r\n\tthis.lastKeyframe = 0;\r\n\tthis.currentKeyframe = 0;\r\n\r\n\tthis.direction = 1;\r\n\tthis.directionBackwards = false;\r\n\r\n\tthis.setFrameRange( 0, this.geometry.morphTargets.length - 1 );\r\n\r\n};\r\n\r\nTHREE.MorphAnimMesh.prototype = Object.create( THREE.Mesh.prototype );\r\nTHREE.MorphAnimMesh.prototype.constructor = THREE.MorphAnimMesh;\r\n\r\nTHREE.MorphAnimMesh.prototype.setFrameRange = function ( start, end ) {\r\n\r\n\tthis.startKeyframe = start;\r\n\tthis.endKeyframe = end;\r\n\r\n\tthis.length = this.endKeyframe - this.startKeyframe + 1;\r\n\r\n};\r\n\r\nTHREE.MorphAnimMesh.prototype.setDirectionForward = function () {\r\n\r\n\tthis.direction = 1;\r\n\tthis.directionBackwards = false;\r\n\r\n};\r\n\r\nTHREE.MorphAnimMesh.prototype.setDirectionBackward = function () {\r\n\r\n\tthis.direction = - 1;\r\n\tthis.directionBackwards = true;\r\n\r\n};\r\n\r\nTHREE.MorphAnimMesh.prototype.parseAnimations = function () {\r\n\r\n\tvar geometry = this.geometry;\r\n\r\n\tif ( ! geometry.animations ) geometry.animations = {};\r\n\r\n\tvar firstAnimation, animations = geometry.animations;\r\n\r\n\tvar pattern = /([a-z]+)_?(\\d+)/;\r\n\r\n\tfor ( var i = 0, il = geometry.morphTargets.length; i < il; i ++ ) {\r\n\r\n\t\tvar morph = geometry.morphTargets[ i ];\r\n\t\tvar parts = morph.name.match( pattern );\r\n\r\n\t\tif ( parts && parts.length > 1 ) {\r\n\r\n\t\t\tvar label = parts[ 1 ];\r\n\r\n\t\t\tif ( ! animations[ label ] ) animations[ label ] = { start: Infinity, end: - Infinity };\r\n\r\n\t\t\tvar animation = animations[ label ];\r\n\r\n\t\t\tif ( i < animation.start ) animation.start = i;\r\n\t\t\tif ( i > animation.end ) animation.end = i;\r\n\r\n\t\t\tif ( ! firstAnimation ) firstAnimation = label;\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tgeometry.firstAnimation = firstAnimation;\r\n\r\n};\r\n\r\nTHREE.MorphAnimMesh.prototype.setAnimationLabel = function ( label, start, end ) {\r\n\r\n\tif ( ! this.geometry.animations ) this.geometry.animations = {};\r\n\r\n\tthis.geometry.animations[ label ] = { start: start, end: end };\r\n\r\n};\r\n\r\nTHREE.MorphAnimMesh.prototype.playAnimation = function ( label, fps ) {\r\n\r\n\tvar animation = this.geometry.animations[ label ];\r\n\r\n\tif ( animation ) {\r\n\r\n\t\tthis.setFrameRange( animation.start, animation.end );\r\n\t\tthis.duration = 1000 * ( ( animation.end - animation.start ) / fps );\r\n\t\tthis.time = 0;\r\n\r\n\t} else {\r\n\r\n\t\tTHREE.warn( 'THREE.MorphAnimMesh: animation[' + label + '] undefined in .playAnimation()' );\r\n\r\n\t}\r\n\r\n};\r\n\r\nTHREE.MorphAnimMesh.prototype.updateAnimation = function ( delta ) {\r\n\r\n\tvar frameTime = this.duration / this.length;\r\n\r\n\tthis.time += this.direction * delta;\r\n\r\n\tif ( this.mirroredLoop ) {\r\n\r\n\t\tif ( this.time > this.duration || this.time < 0 ) {\r\n\r\n\t\t\tthis.direction *= - 1;\r\n\r\n\t\t\tif ( this.time > this.duration ) {\r\n\r\n\t\t\t\tthis.time = this.duration;\r\n\t\t\t\tthis.directionBackwards = true;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( this.time < 0 ) {\r\n\r\n\t\t\t\tthis.time = 0;\r\n\t\t\t\tthis.directionBackwards = false;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t} else {\r\n\r\n\t\tthis.time = this.time % this.duration;\r\n\r\n\t\tif ( this.time < 0 ) this.time += this.duration;\r\n\r\n\t}\r\n\r\n\tvar keyframe = this.startKeyframe + THREE.Math.clamp( Math.floor( this.time / frameTime ), 0, this.length - 1 );\r\n\r\n\tif ( keyframe !== this.currentKeyframe ) {\r\n\r\n\t\tthis.morphTargetInfluences[ this.lastKeyframe ] = 0;\r\n\t\tthis.morphTargetInfluences[ this.currentKeyframe ] = 1;\r\n\r\n\t\tthis.morphTargetInfluences[ keyframe ] = 0;\r\n\r\n\t\tthis.lastKeyframe = this.currentKeyframe;\r\n\t\tthis.currentKeyframe = keyframe;\r\n\r\n\t}\r\n\r\n\tvar mix = ( this.time % frameTime ) / frameTime;\r\n\r\n\tif ( this.directionBackwards ) {\r\n\r\n\t\tmix = 1 - mix;\r\n\r\n\t}\r\n\r\n\tthis.morphTargetInfluences[ this.currentKeyframe ] = mix;\r\n\tthis.morphTargetInfluences[ this.lastKeyframe ] = 1 - mix;\r\n\r\n};\r\n\r\nTHREE.MorphAnimMesh.prototype.interpolateTargets = function ( a, b, t ) {\r\n\r\n\tvar influences = this.morphTargetInfluences;\r\n\r\n\tfor ( var i = 0, l = influences.length; i < l; i ++ ) {\r\n\r\n\t\tinfluences[ i ] = 0;\r\n\r\n\t}\r\n\r\n\tif ( a > -1 ) influences[ a ] = 1 - t;\r\n\tif ( b > -1 ) influences[ b ] = t;\r\n\r\n};\r\n\r\nTHREE.MorphAnimMesh.prototype.clone = function ( object ) {\r\n\r\n\tif ( object === undefined ) object = new THREE.MorphAnimMesh( this.geometry, this.material );\r\n\r\n\tobject.duration = this.duration;\r\n\tobject.mirroredLoop = this.mirroredLoop;\r\n\tobject.time = this.time;\r\n\r\n\tobject.lastKeyframe = this.lastKeyframe;\r\n\tobject.currentKeyframe = this.currentKeyframe;\r\n\r\n\tobject.direction = this.direction;\r\n\tobject.directionBackwards = this.directionBackwards;\r\n\r\n\tTHREE.Mesh.prototype.clone.call( this, object );\r\n\r\n\treturn object;\r\n\r\n};\r\n\r\n// File:src/objects/LOD.js\r\n\r\n/**\r\n * @author mikael emtinger / http://gomo.se/\r\n * @author alteredq / http://alteredqualia.com/\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.LOD = function () {\r\n\r\n\tTHREE.Object3D.call( this );\r\n\r\n\tthis.objects = [];\r\n\r\n};\r\n\r\n\r\nTHREE.LOD.prototype = Object.create( THREE.Object3D.prototype );\r\nTHREE.LOD.prototype.constructor = THREE.LOD;\r\n\r\nTHREE.LOD.prototype.addLevel = function ( object, distance ) {\r\n\r\n\tif ( distance === undefined ) distance = 0;\r\n\r\n\tdistance = Math.abs( distance );\r\n\r\n\tfor ( var l = 0; l < this.objects.length; l ++ ) {\r\n\r\n\t\tif ( distance < this.objects[ l ].distance ) {\r\n\r\n\t\t\tbreak;\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tthis.objects.splice( l, 0, { distance: distance, object: object } );\r\n\tthis.add( object );\r\n\r\n};\r\n\r\nTHREE.LOD.prototype.getObjectForDistance = function ( distance ) {\r\n\r\n\tfor ( var i = 1, l = this.objects.length; i < l; i ++ ) {\r\n\r\n\t\tif ( distance < this.objects[ i ].distance ) {\r\n\r\n\t\t\tbreak;\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\treturn this.objects[ i - 1 ].object;\r\n\r\n};\r\n\r\nTHREE.LOD.prototype.raycast = ( function () {\r\n\r\n\tvar matrixPosition = new THREE.Vector3();\r\n\r\n\treturn function ( raycaster, intersects ) {\r\n\r\n\t\tmatrixPosition.setFromMatrixPosition( this.matrixWorld );\r\n\r\n\t\tvar distance = raycaster.ray.origin.distanceTo( matrixPosition );\r\n\r\n\t\tthis.getObjectForDistance( distance ).raycast( raycaster, intersects );\r\n\r\n\t};\r\n\r\n}() );\r\n\r\nTHREE.LOD.prototype.update = function () {\r\n\r\n\tvar v1 = new THREE.Vector3();\r\n\tvar v2 = new THREE.Vector3();\r\n\r\n\treturn function ( camera ) {\r\n\r\n\t\tif ( this.objects.length > 1 ) {\r\n\r\n\t\t\tv1.setFromMatrixPosition( camera.matrixWorld );\r\n\t\t\tv2.setFromMatrixPosition( this.matrixWorld );\r\n\r\n\t\t\tvar distance = v1.distanceTo( v2 );\r\n\r\n\t\t\tthis.objects[ 0 ].object.visible = true;\r\n\r\n\t\t\tfor ( var i = 1, l = this.objects.length; i < l; i ++ ) {\r\n\r\n\t\t\t\tif ( distance >= this.objects[ i ].distance ) {\r\n\r\n\t\t\t\t\tthis.objects[ i - 1 ].object.visible = false;\r\n\t\t\t\t\tthis.objects[ i     ].object.visible = true;\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\tfor ( ; i < l; i ++ ) {\r\n\r\n\t\t\t\tthis.objects[ i ].object.visible = false;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t};\r\n\r\n}();\r\n\r\nTHREE.LOD.prototype.clone = function ( object ) {\r\n\r\n\tif ( object === undefined ) object = new THREE.LOD();\r\n\r\n\tTHREE.Object3D.prototype.clone.call( this, object );\r\n\r\n\tfor ( var i = 0, l = this.objects.length; i < l; i ++ ) {\r\n\t\tvar x = this.objects[ i ].object.clone();\r\n\t\tx.visible = i === 0;\r\n\t\tobject.addLevel( x, this.objects[ i ].distance );\r\n\t}\r\n\r\n\treturn object;\r\n\r\n};\r\n\r\n// File:src/objects/Sprite.js\r\n\r\n/**\r\n * @author mikael emtinger / http://gomo.se/\r\n * @author alteredq / http://alteredqualia.com/\r\n */\r\n\r\nTHREE.Sprite = ( function () {\r\n\r\n\tvar indices = new Uint16Array( [ 0, 1, 2,  0, 2, 3 ] );\r\n\tvar vertices = new Float32Array( [ - 0.5, - 0.5, 0,   0.5, - 0.5, 0,   0.5, 0.5, 0,   - 0.5, 0.5, 0 ] );\r\n\tvar uvs = new Float32Array( [ 0, 0,   1, 0,   1, 1,   0, 1 ] );\r\n\r\n\tvar geometry = new THREE.BufferGeometry();\r\n\tgeometry.addAttribute( 'index', new THREE.BufferAttribute( indices, 1 ) );\r\n\tgeometry.addAttribute( 'position', new THREE.BufferAttribute( vertices, 3 ) );\r\n\tgeometry.addAttribute( 'uv', new THREE.BufferAttribute( uvs, 2 ) );\r\n\r\n\treturn function ( material ) {\r\n\r\n\t\tTHREE.Object3D.call( this );\r\n\r\n\t\tthis.type = 'Sprite';\r\n\r\n\t\tthis.geometry = geometry;\r\n\t\tthis.material = ( material !== undefined ) ? material : new THREE.SpriteMaterial();\r\n\r\n\t};\r\n\r\n} )();\r\n\r\nTHREE.Sprite.prototype = Object.create( THREE.Object3D.prototype );\r\nTHREE.Sprite.prototype.constructor = THREE.Sprite;\r\n\r\nTHREE.Sprite.prototype.raycast = ( function () {\r\n\r\n\tvar matrixPosition = new THREE.Vector3();\r\n\r\n\treturn function ( raycaster, intersects ) {\r\n\r\n\t\tmatrixPosition.setFromMatrixPosition( this.matrixWorld );\r\n\r\n\t\tvar distance = raycaster.ray.distanceToPoint( matrixPosition );\r\n\r\n\t\tif ( distance > this.scale.x ) {\r\n\r\n\t\t\treturn;\r\n\r\n\t\t}\r\n\r\n\t\tintersects.push( {\r\n\r\n\t\t\tdistance: distance,\r\n\t\t\tpoint: this.position,\r\n\t\t\tface: null,\r\n\t\t\tobject: this\r\n\r\n\t\t} );\r\n\r\n\t};\r\n\r\n}() );\r\n\r\nTHREE.Sprite.prototype.clone = function ( object ) {\r\n\r\n\tif ( object === undefined ) object = new THREE.Sprite( this.material );\r\n\r\n\tTHREE.Object3D.prototype.clone.call( this, object );\r\n\r\n\treturn object;\r\n\r\n};\r\n\r\n// Backwards compatibility\r\n\r\nTHREE.Particle = THREE.Sprite;\r\n\r\n// File:src/objects/LensFlare.js\r\n\r\n/**\r\n * @author mikael emtinger / http://gomo.se/\r\n * @author alteredq / http://alteredqualia.com/\r\n */\r\n\r\nTHREE.LensFlare = function ( texture, size, distance, blending, color ) {\r\n\r\n\tTHREE.Object3D.call( this );\r\n\r\n\tthis.lensFlares = [];\r\n\r\n\tthis.positionScreen = new THREE.Vector3();\r\n\tthis.customUpdateCallback = undefined;\r\n\r\n\tif ( texture !== undefined ) {\r\n\r\n\t\tthis.add( texture, size, distance, blending, color );\r\n\r\n\t}\r\n\r\n};\r\n\r\nTHREE.LensFlare.prototype = Object.create( THREE.Object3D.prototype );\r\nTHREE.LensFlare.prototype.constructor = THREE.LensFlare;\r\n\r\n\r\n/*\r\n * Add: adds another flare\r\n */\r\n\r\nTHREE.LensFlare.prototype.add = function ( texture, size, distance, blending, color, opacity ) {\r\n\r\n\tif ( size === undefined ) size = - 1;\r\n\tif ( distance === undefined ) distance = 0;\r\n\tif ( opacity === undefined ) opacity = 1;\r\n\tif ( color === undefined ) color = new THREE.Color( 0xffffff );\r\n\tif ( blending === undefined ) blending = THREE.NormalBlending;\r\n\r\n\tdistance = Math.min( distance, Math.max( 0, distance ) );\r\n\r\n\tthis.lensFlares.push( {\r\n\t\ttexture: texture, \t\t\t// THREE.Texture\r\n\t\tsize: size, \t\t\t\t// size in pixels (-1 = use texture.width)\r\n\t\tdistance: distance, \t\t// distance (0-1) from light source (0=at light source)\r\n\t\tx: 0, y: 0, z: 0,\t\t\t// screen position (-1 => 1) z = 0 is ontop z = 1 is back\r\n\t\tscale: 1, \t\t\t\t\t// scale\r\n\t\trotation: 1, \t\t\t\t// rotation\r\n\t\topacity: opacity,\t\t\t// opacity\r\n\t\tcolor: color,\t\t\t\t// color\r\n\t\tblending: blending\t\t\t// blending\r\n\t} );\r\n\r\n};\r\n\r\n/*\r\n * Update lens flares update positions on all flares based on the screen position\r\n * Set myLensFlare.customUpdateCallback to alter the flares in your project specific way.\r\n */\r\n\r\nTHREE.LensFlare.prototype.updateLensFlares = function () {\r\n\r\n\tvar f, fl = this.lensFlares.length;\r\n\tvar flare;\r\n\tvar vecX = - this.positionScreen.x * 2;\r\n\tvar vecY = - this.positionScreen.y * 2;\r\n\r\n\tfor ( f = 0; f < fl; f ++ ) {\r\n\r\n\t\tflare = this.lensFlares[ f ];\r\n\r\n\t\tflare.x = this.positionScreen.x + vecX * flare.distance;\r\n\t\tflare.y = this.positionScreen.y + vecY * flare.distance;\r\n\r\n\t\tflare.wantedRotation = flare.x * Math.PI * 0.25;\r\n\t\tflare.rotation += ( flare.wantedRotation - flare.rotation ) * 0.25;\r\n\r\n\t}\r\n\r\n};\r\n\r\n\r\n// File:src/scenes/Scene.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.Scene = function () {\r\n\r\n\tTHREE.Object3D.call( this );\r\n\r\n\tthis.type = 'Scene';\r\n\r\n\tthis.fog = null;\r\n\tthis.overrideMaterial = null;\r\n\r\n\tthis.autoUpdate = true; // checked by the renderer\r\n\r\n};\r\n\r\nTHREE.Scene.prototype = Object.create( THREE.Object3D.prototype );\r\nTHREE.Scene.prototype.constructor = THREE.Scene;\r\n\r\nTHREE.Scene.prototype.clone = function ( object ) {\r\n\r\n\tif ( object === undefined ) object = new THREE.Scene();\r\n\r\n\tTHREE.Object3D.prototype.clone.call( this, object );\r\n\r\n\tif ( this.fog !== null ) object.fog = this.fog.clone();\r\n\tif ( this.overrideMaterial !== null ) object.overrideMaterial = this.overrideMaterial.clone();\r\n\r\n\tobject.autoUpdate = this.autoUpdate;\r\n\tobject.matrixAutoUpdate = this.matrixAutoUpdate;\r\n\r\n\treturn object;\r\n\r\n};\r\n\r\n// File:src/scenes/Fog.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author alteredq / http://alteredqualia.com/\r\n */\r\n\r\nTHREE.Fog = function ( color, near, far ) {\r\n\r\n\tthis.name = '';\r\n\r\n\tthis.color = new THREE.Color( color );\r\n\r\n\tthis.near = ( near !== undefined ) ? near : 1;\r\n\tthis.far = ( far !== undefined ) ? far : 1000;\r\n\r\n};\r\n\r\nTHREE.Fog.prototype.clone = function () {\r\n\r\n\treturn new THREE.Fog( this.color.getHex(), this.near, this.far );\r\n\r\n};\r\n\r\n// File:src/scenes/FogExp2.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author alteredq / http://alteredqualia.com/\r\n */\r\n\r\nTHREE.FogExp2 = function ( color, density ) {\r\n\r\n\tthis.name = '';\r\n\r\n\tthis.color = new THREE.Color( color );\r\n\tthis.density = ( density !== undefined ) ? density : 0.00025;\r\n\r\n};\r\n\r\nTHREE.FogExp2.prototype.clone = function () {\r\n\r\n\treturn new THREE.FogExp2( this.color.getHex(), this.density );\r\n\r\n};\r\n\r\n// File:src/renderers/shaders/ShaderChunk.js\r\n\r\nTHREE.ShaderChunk = {};\r\n\r\n// File:src/renderers/shaders/ShaderChunk/common.glsl\r\n\r\nTHREE.ShaderChunk[ 'common'] = \"#define PI 3.14159\\n#define PI2 6.28318\\n#define RECIPROCAL_PI2 0.15915494\\n#define LOG2 1.442695\\n#define EPSILON 1e-6\\n\\nfloat square( in float a ) { return a*a; }\\nvec2  square( in vec2 a )  { return vec2( a.x*a.x, a.y*a.y ); }\\nvec3  square( in vec3 a )  { return vec3( a.x*a.x, a.y*a.y, a.z*a.z ); }\\nvec4  square( in vec4 a )  { return vec4( a.x*a.x, a.y*a.y, a.z*a.z, a.w*a.w ); }\\nfloat saturate( in float a ) { return clamp( a, 0.0, 1.0 ); }\\nvec2  saturate( in vec2 a )  { return clamp( a, 0.0, 1.0 ); }\\nvec3  saturate( in vec3 a )  { return clamp( a, 0.0, 1.0 ); }\\nvec4  saturate( in vec4 a )  { return clamp( a, 0.0, 1.0 ); }\\nfloat average( in float a ) { return a; }\\nfloat average( in vec2 a )  { return ( a.x + a.y) * 0.5; }\\nfloat average( in vec3 a )  { return ( a.x + a.y + a.z) / 3.0; }\\nfloat average( in vec4 a )  { return ( a.x + a.y + a.z + a.w) * 0.25; }\\nfloat whiteCompliment( in float a ) { return saturate( 1.0 - a ); }\\nvec2  whiteCompliment( in vec2 a )  { return saturate( vec2(1.0) - a ); }\\nvec3  whiteCompliment( in vec3 a )  { return saturate( vec3(1.0) - a ); }\\nvec4  whiteCompliment( in vec4 a )  { return saturate( vec4(1.0) - a ); }\\nvec3 transformDirection( in vec3 normal, in mat4 matrix ) {\\n\treturn normalize( ( matrix * vec4( normal, 0.0 ) ).xyz );\\n}\\n// http://en.wikibooks.org/wiki/GLSL_Programming/Applying_Matrix_Transformations\\nvec3 inverseTransformDirection( in vec3 normal, in mat4 matrix ) {\\n\treturn normalize( ( vec4( normal, 0.0 ) * matrix ).xyz );\\n}\\nvec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal) {\\n\tfloat distance = dot( planeNormal, point-pointOnPlane );\\n\treturn point - distance * planeNormal;\\n}\\nfloat sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\\n\treturn sign( dot( point - pointOnPlane, planeNormal ) );\\n}\\nvec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {\\n\treturn pointOnLine + lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) );\\n}\\nfloat calcLightAttenuation( float lightDistance, float cutoffDistance, float decayExponent ) {\\n\tif ( decayExponent > 0.0 ) {\\n\t  return pow( saturate( 1.0 - lightDistance / cutoffDistance ), decayExponent );\\n\t}\\n\treturn 1.0;\\n}\\n\\nvec3 inputToLinear( in vec3 a ) {\\n#ifdef GAMMA_INPUT\\n\treturn pow( a, vec3( float( GAMMA_FACTOR ) ) );\\n#else\\n\treturn a;\\n#endif\\n}\\nvec3 linearToOutput( in vec3 a ) {\\n#ifdef GAMMA_OUTPUT\\n\treturn pow( a, vec3( 1.0 / float( GAMMA_FACTOR ) ) );\\n#else\\n\treturn a;\\n#endif\\n}\\n\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/alphatest_fragment.glsl\r\n\r\nTHREE.ShaderChunk[ 'alphatest_fragment'] = \"#ifdef ALPHATEST\\n\\n\tif ( diffuseColor.a < ALPHATEST ) discard;\\n\\n#endif\\n\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/lights_lambert_vertex.glsl\r\n\r\nTHREE.ShaderChunk[ 'lights_lambert_vertex'] = \"vLightFront = vec3( 0.0 );\\n\\n#ifdef DOUBLE_SIDED\\n\\n\tvLightBack = vec3( 0.0 );\\n\\n#endif\\n\\ntransformedNormal = normalize( transformedNormal );\\n\\n#if MAX_DIR_LIGHTS > 0\\n\\nfor( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {\\n\\n\tvec3 dirVector = transformDirection( directionalLightDirection[ i ], viewMatrix );\\n\\n\tfloat dotProduct = dot( transformedNormal, dirVector );\\n\tvec3 directionalLightWeighting = vec3( max( dotProduct, 0.0 ) );\\n\\n\t#ifdef DOUBLE_SIDED\\n\\n\t\tvec3 directionalLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );\\n\\n\t\t#ifdef WRAP_AROUND\\n\\n\t\t\tvec3 directionalLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );\\n\\n\t\t#endif\\n\\n\t#endif\\n\\n\t#ifdef WRAP_AROUND\\n\\n\t\tvec3 directionalLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );\\n\t\tdirectionalLightWeighting = mix( directionalLightWeighting, directionalLightWeightingHalf, wrapRGB );\\n\\n\t\t#ifdef DOUBLE_SIDED\\n\\n\t\t\tdirectionalLightWeightingBack = mix( directionalLightWeightingBack, directionalLightWeightingHalfBack, wrapRGB );\\n\\n\t\t#endif\\n\\n\t#endif\\n\\n\tvLightFront += directionalLightColor[ i ] * directionalLightWeighting;\\n\\n\t#ifdef DOUBLE_SIDED\\n\\n\t\tvLightBack += directionalLightColor[ i ] * directionalLightWeightingBack;\\n\\n\t#endif\\n\\n}\\n\\n#endif\\n\\n#if MAX_POINT_LIGHTS > 0\\n\\n\tfor( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\\n\\n\t\tvec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\\n\t\tvec3 lVector = lPosition.xyz - mvPosition.xyz;\\n\\n\t\tfloat attenuation = calcLightAttenuation( length( lVector ), pointLightDistance[ i ], pointLightDecay[ i ] );\\n\\n\t\tlVector = normalize( lVector );\\n\t\tfloat dotProduct = dot( transformedNormal, lVector );\\n\\n\t\tvec3 pointLightWeighting = vec3( max( dotProduct, 0.0 ) );\\n\\n\t\t#ifdef DOUBLE_SIDED\\n\\n\t\t\tvec3 pointLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );\\n\\n\t\t\t#ifdef WRAP_AROUND\\n\\n\t\t\t\tvec3 pointLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );\\n\\n\t\t\t#endif\\n\\n\t\t#endif\\n\\n\t\t#ifdef WRAP_AROUND\\n\\n\t\t\tvec3 pointLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );\\n\t\t\tpointLightWeighting = mix( pointLightWeighting, pointLightWeightingHalf, wrapRGB );\\n\\n\t\t\t#ifdef DOUBLE_SIDED\\n\\n\t\t\t\tpointLightWeightingBack = mix( pointLightWeightingBack, pointLightWeightingHalfBack, wrapRGB );\\n\\n\t\t\t#endif\\n\\n\t\t#endif\\n\\n\t\tvLightFront += pointLightColor[ i ] * pointLightWeighting * attenuation;\\n\\n\t\t#ifdef DOUBLE_SIDED\\n\\n\t\t\tvLightBack += pointLightColor[ i ] * pointLightWeightingBack * attenuation;\\n\\n\t\t#endif\\n\\n\t}\\n\\n#endif\\n\\n#if MAX_SPOT_LIGHTS > 0\\n\\n\tfor( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {\\n\\n\t\tvec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );\\n\t\tvec3 lVector = lPosition.xyz - mvPosition.xyz;\\n\\n\t\tfloat spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - worldPosition.xyz ) );\\n\\n\t\tif ( spotEffect > spotLightAngleCos[ i ] ) {\\n\\n\t\t\tspotEffect = max( pow( max( spotEffect, 0.0 ), spotLightExponent[ i ] ), 0.0 );\\n\\n\t\t\tfloat attenuation = calcLightAttenuation( length( lVector ), spotLightDistance[ i ], spotLightDecay[ i ] );\\n\\n\t\t\tlVector = normalize( lVector );\\n\\n\t\t\tfloat dotProduct = dot( transformedNormal, lVector );\\n\t\t\tvec3 spotLightWeighting = vec3( max( dotProduct, 0.0 ) );\\n\\n\t\t\t#ifdef DOUBLE_SIDED\\n\\n\t\t\t\tvec3 spotLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );\\n\\n\t\t\t\t#ifdef WRAP_AROUND\\n\\n\t\t\t\t\tvec3 spotLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );\\n\\n\t\t\t\t#endif\\n\\n\t\t\t#endif\\n\\n\t\t\t#ifdef WRAP_AROUND\\n\\n\t\t\t\tvec3 spotLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );\\n\t\t\t\tspotLightWeighting = mix( spotLightWeighting, spotLightWeightingHalf, wrapRGB );\\n\\n\t\t\t\t#ifdef DOUBLE_SIDED\\n\\n\t\t\t\t\tspotLightWeightingBack = mix( spotLightWeightingBack, spotLightWeightingHalfBack, wrapRGB );\\n\\n\t\t\t\t#endif\\n\\n\t\t\t#endif\\n\\n\t\t\tvLightFront += spotLightColor[ i ] * spotLightWeighting * attenuation * spotEffect;\\n\\n\t\t\t#ifdef DOUBLE_SIDED\\n\\n\t\t\t\tvLightBack += spotLightColor[ i ] * spotLightWeightingBack * attenuation * spotEffect;\\n\\n\t\t\t#endif\\n\\n\t\t}\\n\\n\t}\\n\\n#endif\\n\\n#if MAX_HEMI_LIGHTS > 0\\n\\n\tfor( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {\\n\\n\t\tvec3 lVector = transformDirection( hemisphereLightDirection[ i ], viewMatrix );\\n\\n\t\tfloat dotProduct = dot( transformedNormal, lVector );\\n\\n\t\tfloat hemiDiffuseWeight = 0.5 * dotProduct + 0.5;\\n\t\tfloat hemiDiffuseWeightBack = -0.5 * dotProduct + 0.5;\\n\\n\t\tvLightFront += mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );\\n\\n\t\t#ifdef DOUBLE_SIDED\\n\\n\t\t\tvLightBack += mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeightBack );\\n\\n\t\t#endif\\n\\n\t}\\n\\n#endif\\n\\nvLightFront += ambientLightColor;\\n\\n#ifdef DOUBLE_SIDED\\n\\n\tvLightBack += ambientLightColor;\\n\\n#endif\\n\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/map_particle_pars_fragment.glsl\r\n\r\nTHREE.ShaderChunk[ 'map_particle_pars_fragment'] = \"#ifdef USE_MAP\\n\\n\tuniform vec4 offsetRepeat;\\n\tuniform sampler2D map;\\n\\n#endif\\n\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/default_vertex.glsl\r\n\r\nTHREE.ShaderChunk[ 'default_vertex'] = \"#ifdef USE_SKINNING\\n\\n\tvec4 mvPosition = modelViewMatrix * skinned;\\n\\n#elif defined( USE_MORPHTARGETS )\\n\\n\tvec4 mvPosition = modelViewMatrix * vec4( morphed, 1.0 );\\n\\n#else\\n\\n\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\\n\\n#endif\\n\\ngl_Position = projectionMatrix * mvPosition;\\n\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/map_pars_fragment.glsl\r\n\r\nTHREE.ShaderChunk[ 'map_pars_fragment'] = \"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP )\\n\\n\tvarying vec2 vUv;\\n\\n#endif\\n\\n#ifdef USE_MAP\\n\\n\tuniform sampler2D map;\\n\\n#endif\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/skinnormal_vertex.glsl\r\n\r\nTHREE.ShaderChunk[ 'skinnormal_vertex'] = \"#ifdef USE_SKINNING\\n\\n\tmat4 skinMatrix = mat4( 0.0 );\\n\tskinMatrix += skinWeight.x * boneMatX;\\n\tskinMatrix += skinWeight.y * boneMatY;\\n\tskinMatrix += skinWeight.z * boneMatZ;\\n\tskinMatrix += skinWeight.w * boneMatW;\\n\tskinMatrix  = bindMatrixInverse * skinMatrix * bindMatrix;\\n\\n\t#ifdef USE_MORPHNORMALS\\n\\n\tvec4 skinnedNormal = skinMatrix * vec4( morphedNormal, 0.0 );\\n\\n\t#else\\n\\n\tvec4 skinnedNormal = skinMatrix * vec4( normal, 0.0 );\\n\\n\t#endif\\n\\n#endif\\n\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/logdepthbuf_pars_vertex.glsl\r\n\r\nTHREE.ShaderChunk[ 'logdepthbuf_pars_vertex'] = \"#ifdef USE_LOGDEPTHBUF\\n\\n\t#ifdef USE_LOGDEPTHBUF_EXT\\n\\n\t\tvarying float vFragDepth;\\n\\n\t#endif\\n\\n\tuniform float logDepthBufFC;\\n\\n#endif\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/lightmap_pars_vertex.glsl\r\n\r\nTHREE.ShaderChunk[ 'lightmap_pars_vertex'] = \"#ifdef USE_LIGHTMAP\\n\\n\tvarying vec2 vUv2;\\n\\n#endif\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/lights_phong_fragment.glsl\r\n\r\nTHREE.ShaderChunk[ 'lights_phong_fragment'] = \"#ifndef FLAT_SHADED\\n\\n\tvec3 normal = normalize( vNormal );\\n\\n\t#ifdef DOUBLE_SIDED\\n\\n\t\tnormal = normal * ( -1.0 + 2.0 * float( gl_FrontFacing ) );\\n\\n\t#endif\\n\\n#else\\n\\n\tvec3 fdx = dFdx( vViewPosition );\\n\tvec3 fdy = dFdy( vViewPosition );\\n\tvec3 normal = normalize( cross( fdx, fdy ) );\\n\\n#endif\\n\\nvec3 viewPosition = normalize( vViewPosition );\\n\\n#ifdef USE_NORMALMAP\\n\\n\tnormal = perturbNormal2Arb( -vViewPosition, normal );\\n\\n#elif defined( USE_BUMPMAP )\\n\\n\tnormal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );\\n\\n#endif\\n\\nvec3 totalDiffuseLight = vec3( 0.0 );\\nvec3 totalSpecularLight = vec3( 0.0 );\\n\\n#if MAX_POINT_LIGHTS > 0\\n\\n\tfor ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\\n\\n\t\tvec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\\n\t\tvec3 lVector = lPosition.xyz + vViewPosition.xyz;\\n\\n\t\tfloat attenuation = calcLightAttenuation( length( lVector ), pointLightDistance[ i ], pointLightDecay[ i ] );\\n\\n\t\tlVector = normalize( lVector );\\n\\n\t\t// diffuse\\n\\n\t\tfloat dotProduct = dot( normal, lVector );\\n\\n\t\t#ifdef WRAP_AROUND\\n\\n\t\t\tfloat pointDiffuseWeightFull = max( dotProduct, 0.0 );\\n\t\t\tfloat pointDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );\\n\\n\t\t\tvec3 pointDiffuseWeight = mix( vec3( pointDiffuseWeightFull ), vec3( pointDiffuseWeightHalf ), wrapRGB );\\n\\n\t\t#else\\n\\n\t\t\tfloat pointDiffuseWeight = max( dotProduct, 0.0 );\\n\\n\t\t#endif\\n\\n\t\ttotalDiffuseLight += pointLightColor[ i ] * pointDiffuseWeight * attenuation;\\n\\n\t\t\t\t// specular\\n\\n\t\tvec3 pointHalfVector = normalize( lVector + viewPosition );\\n\t\tfloat pointDotNormalHalf = max( dot( normal, pointHalfVector ), 0.0 );\\n\t\tfloat pointSpecularWeight = specularStrength * max( pow( pointDotNormalHalf, shininess ), 0.0 );\\n\\n\t\tfloat specularNormalization = ( shininess + 2.0 ) / 8.0;\\n\\n\t\tvec3 schlick = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVector, pointHalfVector ), 0.0 ), 5.0 );\\n\t\ttotalSpecularLight += schlick * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * attenuation * specularNormalization;\\n\\n\t}\\n\\n#endif\\n\\n#if MAX_SPOT_LIGHTS > 0\\n\\n\tfor ( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {\\n\\n\t\tvec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );\\n\t\tvec3 lVector = lPosition.xyz + vViewPosition.xyz;\\n\\n\t\tfloat attenuation = calcLightAttenuation( length( lVector ), spotLightDistance[ i ], spotLightDecay[ i ] );\\n\\n\t\tlVector = normalize( lVector );\\n\\n\t\tfloat spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - vWorldPosition ) );\\n\\n\t\tif ( spotEffect > spotLightAngleCos[ i ] ) {\\n\\n\t\t\tspotEffect = max( pow( max( spotEffect, 0.0 ), spotLightExponent[ i ] ), 0.0 );\\n\\n\t\t\t// diffuse\\n\\n\t\t\tfloat dotProduct = dot( normal, lVector );\\n\\n\t\t\t#ifdef WRAP_AROUND\\n\\n\t\t\t\tfloat spotDiffuseWeightFull = max( dotProduct, 0.0 );\\n\t\t\t\tfloat spotDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );\\n\\n\t\t\t\tvec3 spotDiffuseWeight = mix( vec3( spotDiffuseWeightFull ), vec3( spotDiffuseWeightHalf ), wrapRGB );\\n\\n\t\t\t#else\\n\\n\t\t\t\tfloat spotDiffuseWeight = max( dotProduct, 0.0 );\\n\\n\t\t\t#endif\\n\\n\t\t\ttotalDiffuseLight += spotLightColor[ i ] * spotDiffuseWeight * attenuation * spotEffect;\\n\\n\t\t\t// specular\\n\\n\t\t\tvec3 spotHalfVector = normalize( lVector + viewPosition );\\n\t\t\tfloat spotDotNormalHalf = max( dot( normal, spotHalfVector ), 0.0 );\\n\t\t\tfloat spotSpecularWeight = specularStrength * max( pow( spotDotNormalHalf, shininess ), 0.0 );\\n\\n\t\t\tfloat specularNormalization = ( shininess + 2.0 ) / 8.0;\\n\\n\t\t\tvec3 schlick = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVector, spotHalfVector ), 0.0 ), 5.0 );\\n\t\t\ttotalSpecularLight += schlick * spotLightColor[ i ] * spotSpecularWeight * spotDiffuseWeight * attenuation * specularNormalization * spotEffect;\\n\\n\t\t}\\n\\n\t}\\n\\n#endif\\n\\n#if MAX_DIR_LIGHTS > 0\\n\\n\tfor( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {\\n\\n\t\tvec3 dirVector = transformDirection( directionalLightDirection[ i ], viewMatrix );\\n\\n\t\t// diffuse\\n\\n\t\tfloat dotProduct = dot( normal, dirVector );\\n\\n\t\t#ifdef WRAP_AROUND\\n\\n\t\t\tfloat dirDiffuseWeightFull = max( dotProduct, 0.0 );\\n\t\t\tfloat dirDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );\\n\\n\t\t\tvec3 dirDiffuseWeight = mix( vec3( dirDiffuseWeightFull ), vec3( dirDiffuseWeightHalf ), wrapRGB );\\n\\n\t\t#else\\n\\n\t\t\tfloat dirDiffuseWeight = max( dotProduct, 0.0 );\\n\\n\t\t#endif\\n\\n\t\ttotalDiffuseLight += directionalLightColor[ i ] * dirDiffuseWeight;\\n\\n\t\t// specular\\n\\n\t\tvec3 dirHalfVector = normalize( dirVector + viewPosition );\\n\t\tfloat dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );\\n\t\tfloat dirSpecularWeight = specularStrength * max( pow( dirDotNormalHalf, shininess ), 0.0 );\\n\\n\t\t/*\\n\t\t// fresnel term from skin shader\\n\t\tconst float F0 = 0.128;\\n\\n\t\tfloat base = 1.0 - dot( viewPosition, dirHalfVector );\\n\t\tfloat exponential = pow( base, 5.0 );\\n\\n\t\tfloat fresnel = exponential + F0 * ( 1.0 - exponential );\\n\t\t*/\\n\\n\t\t/*\\n\t\t// fresnel term from fresnel shader\\n\t\tconst float mFresnelBias = 0.08;\\n\t\tconst float mFresnelScale = 0.3;\\n\t\tconst float mFresnelPower = 5.0;\\n\\n\t\tfloat fresnel = mFresnelBias + mFresnelScale * pow( 1.0 + dot( normalize( -viewPosition ), normal ), mFresnelPower );\\n\t\t*/\\n\\n\t\tfloat specularNormalization = ( shininess + 2.0 ) / 8.0;\\n\\n\t\t// \t\tdirSpecular += specular * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight * specularNormalization * fresnel;\\n\\n\t\tvec3 schlick = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( dirVector, dirHalfVector ), 0.0 ), 5.0 );\\n\t\ttotalSpecularLight += schlick * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight * specularNormalization;\\n\\n\\n\t}\\n\\n#endif\\n\\n#if MAX_HEMI_LIGHTS > 0\\n\\n\tfor( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {\\n\\n\t\tvec3 lVector = transformDirection( hemisphereLightDirection[ i ], viewMatrix );\\n\\n\t\t// diffuse\\n\\n\t\tfloat dotProduct = dot( normal, lVector );\\n\t\tfloat hemiDiffuseWeight = 0.5 * dotProduct + 0.5;\\n\\n\t\tvec3 hemiColor = mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );\\n\\n\t\ttotalDiffuseLight += hemiColor;\\n\\n\t\t// specular (sky light)\\n\\n\t\tvec3 hemiHalfVectorSky = normalize( lVector + viewPosition );\\n\t\tfloat hemiDotNormalHalfSky = 0.5 * dot( normal, hemiHalfVectorSky ) + 0.5;\\n\t\tfloat hemiSpecularWeightSky = specularStrength * max( pow( max( hemiDotNormalHalfSky, 0.0 ), shininess ), 0.0 );\\n\\n\t\t// specular (ground light)\\n\\n\t\tvec3 lVectorGround = -lVector;\\n\\n\t\tvec3 hemiHalfVectorGround = normalize( lVectorGround + viewPosition );\\n\t\tfloat hemiDotNormalHalfGround = 0.5 * dot( normal, hemiHalfVectorGround ) + 0.5;\\n\t\tfloat hemiSpecularWeightGround = specularStrength * max( pow( max( hemiDotNormalHalfGround, 0.0 ), shininess ), 0.0 );\\n\\n\t\tfloat dotProductGround = dot( normal, lVectorGround );\\n\\n\t\tfloat specularNormalization = ( shininess + 2.0 ) / 8.0;\\n\\n\t\tvec3 schlickSky = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVector, hemiHalfVectorSky ), 0.0 ), 5.0 );\\n\t\tvec3 schlickGround = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVectorGround, hemiHalfVectorGround ), 0.0 ), 5.0 );\\n\t\ttotalSpecularLight += hemiColor * specularNormalization * ( schlickSky * hemiSpecularWeightSky * max( dotProduct, 0.0 ) + schlickGround * hemiSpecularWeightGround * max( dotProductGround, 0.0 ) );\\n\\n\t}\\n\\n#endif\\n\\n#ifdef METAL\\n\\n\toutgoingLight += diffuseColor.rgb * ( totalDiffuseLight + ambientLightColor ) * specular + totalSpecularLight + emissive;\\n\\n#else\\n\\n\toutgoingLight += diffuseColor.rgb * ( totalDiffuseLight + ambientLightColor ) + totalSpecularLight + emissive;\\n\\n#endif\\n\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/fog_pars_fragment.glsl\r\n\r\nTHREE.ShaderChunk[ 'fog_pars_fragment'] = \"#ifdef USE_FOG\\n\\n\tuniform vec3 fogColor;\\n\\n\t#ifdef FOG_EXP2\\n\\n\t\tuniform float fogDensity;\\n\\n\t#else\\n\\n\t\tuniform float fogNear;\\n\t\tuniform float fogFar;\\n\t#endif\\n\\n#endif\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/morphnormal_vertex.glsl\r\n\r\nTHREE.ShaderChunk[ 'morphnormal_vertex'] = \"#ifdef USE_MORPHNORMALS\\n\\n\tvec3 morphedNormal = vec3( 0.0 );\\n\\n\tmorphedNormal += ( morphNormal0 - normal ) * morphTargetInfluences[ 0 ];\\n\tmorphedNormal += ( morphNormal1 - normal ) * morphTargetInfluences[ 1 ];\\n\tmorphedNormal += ( morphNormal2 - normal ) * morphTargetInfluences[ 2 ];\\n\tmorphedNormal += ( morphNormal3 - normal ) * morphTargetInfluences[ 3 ];\\n\\n\tmorphedNormal += normal;\\n\\n#endif\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/envmap_pars_fragment.glsl\r\n\r\nTHREE.ShaderChunk[ 'envmap_pars_fragment'] = \"#ifdef USE_ENVMAP\\n\\n\tuniform float reflectivity;\\n\t#ifdef ENVMAP_TYPE_CUBE\\n\t\tuniform samplerCube envMap;\\n\t#else\\n\t\tuniform sampler2D envMap;\\n\t#endif\\n\tuniform float flipEnvMap;\\n\\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\\n\\n\t\tuniform float refractionRatio;\\n\\n\t#else\\n\\n\t\tvarying vec3 vReflect;\\n\\n\t#endif\\n\\n#endif\\n\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/logdepthbuf_fragment.glsl\r\n\r\nTHREE.ShaderChunk[ 'logdepthbuf_fragment'] = \"#if defined(USE_LOGDEPTHBUF) && defined(USE_LOGDEPTHBUF_EXT)\\n\\n\tgl_FragDepthEXT = log2(vFragDepth) * logDepthBufFC * 0.5;\\n\\n#endif\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/normalmap_pars_fragment.glsl\r\n\r\nTHREE.ShaderChunk[ 'normalmap_pars_fragment'] = \"#ifdef USE_NORMALMAP\\n\\n\tuniform sampler2D normalMap;\\n\tuniform vec2 normalScale;\\n\\n\t// Per-Pixel Tangent Space Normal Mapping\\n\t// http://hacksoflife.blogspot.ch/2009/11/per-pixel-tangent-space-normal-mapping.html\\n\\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm ) {\\n\\n\t\tvec3 q0 = dFdx( eye_pos.xyz );\\n\t\tvec3 q1 = dFdy( eye_pos.xyz );\\n\t\tvec2 st0 = dFdx( vUv.st );\\n\t\tvec2 st1 = dFdy( vUv.st );\\n\\n\t\tvec3 S = normalize( q0 * st1.t - q1 * st0.t );\\n\t\tvec3 T = normalize( -q0 * st1.s + q1 * st0.s );\\n\t\tvec3 N = normalize( surf_norm );\\n\\n\t\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\\n\t\tmapN.xy = normalScale * mapN.xy;\\n\t\tmat3 tsn = mat3( S, T, N );\\n\t\treturn normalize( tsn * mapN );\\n\\n\t}\\n\\n#endif\\n\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/lights_phong_pars_vertex.glsl\r\n\r\nTHREE.ShaderChunk[ 'lights_phong_pars_vertex'] = \"#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP ) || defined( USE_ENVMAP )\\n\\n\tvarying vec3 vWorldPosition;\\n\\n#endif\\n\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/lightmap_pars_fragment.glsl\r\n\r\nTHREE.ShaderChunk[ 'lightmap_pars_fragment'] = \"#ifdef USE_LIGHTMAP\\n\\n\tvarying vec2 vUv2;\\n\tuniform sampler2D lightMap;\\n\\n#endif\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/shadowmap_vertex.glsl\r\n\r\nTHREE.ShaderChunk[ 'shadowmap_vertex'] = \"#ifdef USE_SHADOWMAP\\n\\n\tfor( int i = 0; i < MAX_SHADOWS; i ++ ) {\\n\\n\t\tvShadowCoord[ i ] = shadowMatrix[ i ] * worldPosition;\\n\\n\t}\\n\\n#endif\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/lights_phong_vertex.glsl\r\n\r\nTHREE.ShaderChunk[ 'lights_phong_vertex'] = \"#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP ) || defined( USE_ENVMAP )\\n\\n\tvWorldPosition = worldPosition.xyz;\\n\\n#endif\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/map_fragment.glsl\r\n\r\nTHREE.ShaderChunk[ 'map_fragment'] = \"#ifdef USE_MAP\\n\\n\tvec4 texelColor = texture2D( map, vUv );\\n\\n\ttexelColor.xyz = inputToLinear( texelColor.xyz );\\n\\n\tdiffuseColor *= texelColor;\\n\\n#endif\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/lightmap_vertex.glsl\r\n\r\nTHREE.ShaderChunk[ 'lightmap_vertex'] = \"#ifdef USE_LIGHTMAP\\n\\n\tvUv2 = uv2;\\n\\n#endif\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/map_particle_fragment.glsl\r\n\r\nTHREE.ShaderChunk[ 'map_particle_fragment'] = \"#ifdef USE_MAP\\n\\n\tdiffuseColor *= texture2D( map, vec2( gl_PointCoord.x, 1.0 - gl_PointCoord.y ) * offsetRepeat.zw + offsetRepeat.xy );\\n\\n#endif\\n\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/color_pars_fragment.glsl\r\n\r\nTHREE.ShaderChunk[ 'color_pars_fragment'] = \"#ifdef USE_COLOR\\n\\n\tvarying vec3 vColor;\\n\\n#endif\\n\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/color_vertex.glsl\r\n\r\nTHREE.ShaderChunk[ 'color_vertex'] = \"#ifdef USE_COLOR\\n\\n\tvColor.xyz = inputToLinear( color.xyz );\\n\\n#endif\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/skinning_vertex.glsl\r\n\r\nTHREE.ShaderChunk[ 'skinning_vertex'] = \"#ifdef USE_SKINNING\\n\\n\t#ifdef USE_MORPHTARGETS\\n\\n\tvec4 skinVertex = bindMatrix * vec4( morphed, 1.0 );\\n\\n\t#else\\n\\n\tvec4 skinVertex = bindMatrix * vec4( position, 1.0 );\\n\\n\t#endif\\n\\n\tvec4 skinned = vec4( 0.0 );\\n\tskinned += boneMatX * skinVertex * skinWeight.x;\\n\tskinned += boneMatY * skinVertex * skinWeight.y;\\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\\n\tskinned += boneMatW * skinVertex * skinWeight.w;\\n\tskinned  = bindMatrixInverse * skinned;\\n\\n#endif\\n\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/envmap_pars_vertex.glsl\r\n\r\nTHREE.ShaderChunk[ 'envmap_pars_vertex'] = \"#if defined( USE_ENVMAP ) && ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP ) && ! defined( PHONG )\\n\\n\tvarying vec3 vReflect;\\n\\n\tuniform float refractionRatio;\\n\\n#endif\\n\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/linear_to_gamma_fragment.glsl\r\n\r\nTHREE.ShaderChunk[ 'linear_to_gamma_fragment'] = \"\\n\toutgoingLight = linearToOutput( outgoingLight );\\n\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/color_pars_vertex.glsl\r\n\r\nTHREE.ShaderChunk[ 'color_pars_vertex'] = \"#ifdef USE_COLOR\\n\\n\tvarying vec3 vColor;\\n\\n#endif\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/lights_lambert_pars_vertex.glsl\r\n\r\nTHREE.ShaderChunk[ 'lights_lambert_pars_vertex'] = \"uniform vec3 ambientLightColor;\\n\\n#if MAX_DIR_LIGHTS > 0\\n\\n\tuniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\\n\tuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\\n\\n#endif\\n\\n#if MAX_HEMI_LIGHTS > 0\\n\\n\tuniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];\\n\tuniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];\\n\tuniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];\\n\\n#endif\\n\\n#if MAX_POINT_LIGHTS > 0\\n\\n\tuniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\\n\tuniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\\n\tuniform float pointLightDistance[ MAX_POINT_LIGHTS ];\\n\tuniform float pointLightDecay[ MAX_POINT_LIGHTS ];\\n\\n#endif\\n\\n#if MAX_SPOT_LIGHTS > 0\\n\\n\tuniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];\\n\tuniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];\\n\tuniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];\\n\tuniform float spotLightDistance[ MAX_SPOT_LIGHTS ];\\n\tuniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];\\n\tuniform float spotLightExponent[ MAX_SPOT_LIGHTS ];\\n\tuniform float spotLightDecay[ MAX_SPOT_LIGHTS ];\\n\\n#endif\\n\\n#ifdef WRAP_AROUND\\n\\n\tuniform vec3 wrapRGB;\\n\\n#endif\\n\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/map_pars_vertex.glsl\r\n\r\nTHREE.ShaderChunk[ 'map_pars_vertex'] = \"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP )\\n\\n\tvarying vec2 vUv;\\n\tuniform vec4 offsetRepeat;\\n\\n#endif\\n\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/envmap_fragment.glsl\r\n\r\nTHREE.ShaderChunk[ 'envmap_fragment'] = \"#ifdef USE_ENVMAP\\n\\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\\n\\n\t\tvec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );\\n\\n\t\t// Transforming Normal Vectors with the Inverse Transformation\\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\\n\\n\t\t#ifdef ENVMAP_MODE_REFLECTION\\n\\n\t\t\tvec3 reflectVec = reflect( cameraToVertex, worldNormal );\\n\\n\t\t#else\\n\\n\t\t\tvec3 reflectVec = refract( cameraToVertex, worldNormal, refractionRatio );\\n\\n\t\t#endif\\n\\n\t#else\\n\\n\t\tvec3 reflectVec = vReflect;\\n\\n\t#endif\\n\\n\t#ifdef DOUBLE_SIDED\\n\t\tfloat flipNormal = ( -1.0 + 2.0 * float( gl_FrontFacing ) );\\n\t#else\\n\t\tfloat flipNormal = 1.0;\\n\t#endif\\n\\n\t#ifdef ENVMAP_TYPE_CUBE\\n\t\tvec4 envColor = textureCube( envMap, flipNormal * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\\n\\n\t#elif defined( ENVMAP_TYPE_EQUIREC )\\n\t\tvec2 sampleUV;\\n\t\tsampleUV.y = saturate( flipNormal * reflectVec.y * 0.5 + 0.5 );\\n\t\tsampleUV.x = atan( flipNormal * reflectVec.z, flipNormal * reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\\n\t\tvec4 envColor = texture2D( envMap, sampleUV );\\n\\n\t#elif defined( ENVMAP_TYPE_SPHERE )\\n\t\tvec3 reflectView = flipNormal * normalize((viewMatrix * vec4( reflectVec, 0.0 )).xyz + vec3(0.0,0.0,1.0));\\n\t\tvec4 envColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5 );\\n\t#endif\\n\\n\tenvColor.xyz = inputToLinear( envColor.xyz );\\n\\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\\n\\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\\n\\n\t#elif defined( ENVMAP_BLENDING_MIX )\\n\\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\\n\\n\t#elif defined( ENVMAP_BLENDING_ADD )\\n\\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\\n\\n\t#endif\\n\\n#endif\\n\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/specularmap_pars_fragment.glsl\r\n\r\nTHREE.ShaderChunk[ 'specularmap_pars_fragment'] = \"#ifdef USE_SPECULARMAP\\n\\n\tuniform sampler2D specularMap;\\n\\n#endif\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/logdepthbuf_vertex.glsl\r\n\r\nTHREE.ShaderChunk[ 'logdepthbuf_vertex'] = \"#ifdef USE_LOGDEPTHBUF\\n\\n\tgl_Position.z = log2(max( EPSILON, gl_Position.w + 1.0 )) * logDepthBufFC;\\n\\n\t#ifdef USE_LOGDEPTHBUF_EXT\\n\\n\t\tvFragDepth = 1.0 + gl_Position.w;\\n\\n#else\\n\\n\t\tgl_Position.z = (gl_Position.z - 1.0) * gl_Position.w;\\n\\n\t#endif\\n\\n#endif\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/morphtarget_pars_vertex.glsl\r\n\r\nTHREE.ShaderChunk[ 'morphtarget_pars_vertex'] = \"#ifdef USE_MORPHTARGETS\\n\\n\t#ifndef USE_MORPHNORMALS\\n\\n\tuniform float morphTargetInfluences[ 8 ];\\n\\n\t#else\\n\\n\tuniform float morphTargetInfluences[ 4 ];\\n\\n\t#endif\\n\\n#endif\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/specularmap_fragment.glsl\r\n\r\nTHREE.ShaderChunk[ 'specularmap_fragment'] = \"float specularStrength;\\n\\n#ifdef USE_SPECULARMAP\\n\\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\\n\tspecularStrength = texelSpecular.r;\\n\\n#else\\n\\n\tspecularStrength = 1.0;\\n\\n#endif\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/fog_fragment.glsl\r\n\r\nTHREE.ShaderChunk[ 'fog_fragment'] = \"#ifdef USE_FOG\\n\\n\t#ifdef USE_LOGDEPTHBUF_EXT\\n\\n\t\tfloat depth = gl_FragDepthEXT / gl_FragCoord.w;\\n\\n\t#else\\n\\n\t\tfloat depth = gl_FragCoord.z / gl_FragCoord.w;\\n\\n\t#endif\\n\\n\t#ifdef FOG_EXP2\\n\\n\t\tfloat fogFactor = exp2( - square( fogDensity ) * square( depth ) * LOG2 );\\n\t\tfogFactor = whiteCompliment( fogFactor );\\n\\n\t#else\\n\\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, depth );\\n\\n\t#endif\\n\t\\n\toutgoingLight = mix( outgoingLight, fogColor, fogFactor );\\n\\n#endif\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/bumpmap_pars_fragment.glsl\r\n\r\nTHREE.ShaderChunk[ 'bumpmap_pars_fragment'] = \"#ifdef USE_BUMPMAP\\n\\n\tuniform sampler2D bumpMap;\\n\tuniform float bumpScale;\\n\\n\t// Derivative maps - bump mapping unparametrized surfaces by Morten Mikkelsen\\n\t// http://mmikkelsen3d.blogspot.sk/2011/07/derivative-maps.html\\n\\n\t// Evaluate the derivative of the height w.r.t. screen-space using forward differencing (listing 2)\\n\\n\tvec2 dHdxy_fwd() {\\n\\n\t\tvec2 dSTdx = dFdx( vUv );\\n\t\tvec2 dSTdy = dFdy( vUv );\\n\\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\\n\\n\t\treturn vec2( dBx, dBy );\\n\\n\t}\\n\\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\\n\\n\t\tvec3 vSigmaX = dFdx( surf_pos );\\n\t\tvec3 vSigmaY = dFdy( surf_pos );\\n\t\tvec3 vN = surf_norm;\t\t// normalized\\n\\n\t\tvec3 R1 = cross( vSigmaY, vN );\\n\t\tvec3 R2 = cross( vN, vSigmaX );\\n\\n\t\tfloat fDet = dot( vSigmaX, R1 );\\n\\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\\n\\n\t}\\n\\n#endif\\n\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/defaultnormal_vertex.glsl\r\n\r\nTHREE.ShaderChunk[ 'defaultnormal_vertex'] = \"#ifdef USE_SKINNING\\n\\n\tvec3 objectNormal = skinnedNormal.xyz;\\n\\n#elif defined( USE_MORPHNORMALS )\\n\\n\tvec3 objectNormal = morphedNormal;\\n\\n#else\\n\\n\tvec3 objectNormal = normal;\\n\\n#endif\\n\\n#ifdef FLIP_SIDED\\n\\n\tobjectNormal = -objectNormal;\\n\\n#endif\\n\\nvec3 transformedNormal = normalMatrix * objectNormal;\\n\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/lights_phong_pars_fragment.glsl\r\n\r\nTHREE.ShaderChunk[ 'lights_phong_pars_fragment'] = \"uniform vec3 ambientLightColor;\\n\\n#if MAX_DIR_LIGHTS > 0\\n\\n\tuniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\\n\tuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\\n\\n#endif\\n\\n#if MAX_HEMI_LIGHTS > 0\\n\\n\tuniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];\\n\tuniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];\\n\tuniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];\\n\\n#endif\\n\\n#if MAX_POINT_LIGHTS > 0\\n\\n\tuniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\\n\\n\tuniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\\n\tuniform float pointLightDistance[ MAX_POINT_LIGHTS ];\\n\tuniform float pointLightDecay[ MAX_POINT_LIGHTS ];\\n\\n#endif\\n\\n#if MAX_SPOT_LIGHTS > 0\\n\\n\tuniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];\\n\tuniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];\\n\tuniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];\\n\tuniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];\\n\tuniform float spotLightExponent[ MAX_SPOT_LIGHTS ];\\n\tuniform float spotLightDistance[ MAX_SPOT_LIGHTS ];\\n\tuniform float spotLightDecay[ MAX_SPOT_LIGHTS ];\\n\\n#endif\\n\\n#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP ) || defined( USE_ENVMAP )\\n\\n\tvarying vec3 vWorldPosition;\\n\\n#endif\\n\\n#ifdef WRAP_AROUND\\n\\n\tuniform vec3 wrapRGB;\\n\\n#endif\\n\\nvarying vec3 vViewPosition;\\n\\n#ifndef FLAT_SHADED\\n\\n\tvarying vec3 vNormal;\\n\\n#endif\\n\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/skinbase_vertex.glsl\r\n\r\nTHREE.ShaderChunk[ 'skinbase_vertex'] = \"#ifdef USE_SKINNING\\n\\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\\n\\n#endif\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/map_vertex.glsl\r\n\r\nTHREE.ShaderChunk[ 'map_vertex'] = \"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP )\\n\\n\tvUv = uv * offsetRepeat.zw + offsetRepeat.xy;\\n\\n#endif\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/lightmap_fragment.glsl\r\n\r\nTHREE.ShaderChunk[ 'lightmap_fragment'] = \"#ifdef USE_LIGHTMAP\\n\\n\toutgoingLight *= diffuseColor.xyz * texture2D( lightMap, vUv2 ).xyz;\\n\\n#endif\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/shadowmap_pars_vertex.glsl\r\n\r\nTHREE.ShaderChunk[ 'shadowmap_pars_vertex'] = \"#ifdef USE_SHADOWMAP\\n\\n\tvarying vec4 vShadowCoord[ MAX_SHADOWS ];\\n\tuniform mat4 shadowMatrix[ MAX_SHADOWS ];\\n\\n#endif\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/color_fragment.glsl\r\n\r\nTHREE.ShaderChunk[ 'color_fragment'] = \"#ifdef USE_COLOR\\n\\n\tdiffuseColor.rgb *= vColor;\\n\\n#endif\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/morphtarget_vertex.glsl\r\n\r\nTHREE.ShaderChunk[ 'morphtarget_vertex'] = \"#ifdef USE_MORPHTARGETS\\n\\n\tvec3 morphed = vec3( 0.0 );\\n\tmorphed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];\\n\tmorphed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];\\n\tmorphed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];\\n\tmorphed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];\\n\\n\t#ifndef USE_MORPHNORMALS\\n\\n\tmorphed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];\\n\tmorphed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];\\n\tmorphed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];\\n\tmorphed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];\\n\\n\t#endif\\n\\n\tmorphed += position;\\n\\n#endif\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/envmap_vertex.glsl\r\n\r\nTHREE.ShaderChunk[ 'envmap_vertex'] = \"#if defined( USE_ENVMAP ) && ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP ) && ! defined( PHONG )\\n\\n\tvec3 worldNormal = transformDirection( objectNormal, modelMatrix );\\n\\n\tvec3 cameraToVertex = normalize( worldPosition.xyz - cameraPosition );\\n\\n\t#ifdef ENVMAP_MODE_REFLECTION\\n\\n\t\tvReflect = reflect( cameraToVertex, worldNormal );\\n\\n\t#else\\n\\n\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\\n\\n\t#endif\\n\\n#endif\\n\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/shadowmap_fragment.glsl\r\n\r\nTHREE.ShaderChunk[ 'shadowmap_fragment'] = \"#ifdef USE_SHADOWMAP\\n\\n\t#ifdef SHADOWMAP_DEBUG\\n\\n\t\tvec3 frustumColors[3];\\n\t\tfrustumColors[0] = vec3( 1.0, 0.5, 0.0 );\\n\t\tfrustumColors[1] = vec3( 0.0, 1.0, 0.8 );\\n\t\tfrustumColors[2] = vec3( 0.0, 0.5, 1.0 );\\n\\n\t#endif\\n\\n\t#ifdef SHADOWMAP_CASCADE\\n\\n\t\tint inFrustumCount = 0;\\n\\n\t#endif\\n\\n\tfloat fDepth;\\n\tvec3 shadowColor = vec3( 1.0 );\\n\\n\tfor( int i = 0; i < MAX_SHADOWS; i ++ ) {\\n\\n\t\tvec3 shadowCoord = vShadowCoord[ i ].xyz / vShadowCoord[ i ].w;\\n\\n\t\t\t\t// if ( something && something ) breaks ATI OpenGL shader compiler\\n\t\t\t\t// if ( all( something, something ) ) using this instead\\n\\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\\n\t\tbool inFrustum = all( inFrustumVec );\\n\\n\t\t\t\t// don't shadow pixels outside of light frustum\\n\t\t\t\t// use just first frustum (for cascades)\\n\t\t\t\t// don't shadow pixels behind far plane of light frustum\\n\\n\t\t#ifdef SHADOWMAP_CASCADE\\n\\n\t\t\tinFrustumCount += int( inFrustum );\\n\t\t\tbvec3 frustumTestVec = bvec3( inFrustum, inFrustumCount == 1, shadowCoord.z <= 1.0 );\\n\\n\t\t#else\\n\\n\t\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\\n\\n\t\t#endif\\n\\n\t\tbool frustumTest = all( frustumTestVec );\\n\\n\t\tif ( frustumTest ) {\\n\\n\t\t\tshadowCoord.z += shadowBias[ i ];\\n\\n\t\t\t#if defined( SHADOWMAP_TYPE_PCF )\\n\\n\t\t\t\t\t\t// Percentage-close filtering\\n\t\t\t\t\t\t// (9 pixel kernel)\\n\t\t\t\t\t\t// http://fabiensanglard.net/shadowmappingPCF/\\n\\n\t\t\t\tfloat shadow = 0.0;\\n\\n\t\t/*\\n\t\t\t\t\t\t// nested loops breaks shader compiler / validator on some ATI cards when using OpenGL\\n\t\t\t\t\t\t// must enroll loop manually\\n\\n\t\t\t\tfor ( float y = -1.25; y <= 1.25; y += 1.25 )\\n\t\t\t\t\tfor ( float x = -1.25; x <= 1.25; x += 1.25 ) {\\n\\n\t\t\t\t\t\tvec4 rgbaDepth = texture2D( shadowMap[ i ], vec2( x * xPixelOffset, y * yPixelOffset ) + shadowCoord.xy );\\n\\n\t\t\t\t\t\t\t\t// doesn't seem to produce any noticeable visual difference compared to simple texture2D lookup\\n\t\t\t\t\t\t\t\t//vec4 rgbaDepth = texture2DProj( shadowMap[ i ], vec4( vShadowCoord[ i ].w * ( vec2( x * xPixelOffset, y * yPixelOffset ) + shadowCoord.xy ), 0.05, vShadowCoord[ i ].w ) );\\n\\n\t\t\t\t\t\tfloat fDepth = unpackDepth( rgbaDepth );\\n\\n\t\t\t\t\t\tif ( fDepth < shadowCoord.z )\\n\t\t\t\t\t\t\tshadow += 1.0;\\n\\n\t\t\t\t}\\n\\n\t\t\t\tshadow /= 9.0;\\n\\n\t\t*/\\n\\n\t\t\t\tconst float shadowDelta = 1.0 / 9.0;\\n\\n\t\t\t\tfloat xPixelOffset = 1.0 / shadowMapSize[ i ].x;\\n\t\t\t\tfloat yPixelOffset = 1.0 / shadowMapSize[ i ].y;\\n\\n\t\t\t\tfloat dx0 = -1.25 * xPixelOffset;\\n\t\t\t\tfloat dy0 = -1.25 * yPixelOffset;\\n\t\t\t\tfloat dx1 = 1.25 * xPixelOffset;\\n\t\t\t\tfloat dy1 = 1.25 * yPixelOffset;\\n\\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy0 ) ) );\\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\\n\\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy0 ) ) );\\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\\n\\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy0 ) ) );\\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\\n\\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, 0.0 ) ) );\\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\\n\\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy ) );\\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\\n\\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, 0.0 ) ) );\\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\\n\\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy1 ) ) );\\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\\n\\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy1 ) ) );\\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\\n\\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy1 ) ) );\\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\\n\\n\t\t\t\tshadowColor = shadowColor * vec3( ( 1.0 - shadowDarkness[ i ] * shadow ) );\\n\\n\t\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\\n\\n\t\t\t\t\t\t// Percentage-close filtering\\n\t\t\t\t\t\t// (9 pixel kernel)\\n\t\t\t\t\t\t// http://fabiensanglard.net/shadowmappingPCF/\\n\\n\t\t\t\tfloat shadow = 0.0;\\n\\n\t\t\t\tfloat xPixelOffset = 1.0 / shadowMapSize[ i ].x;\\n\t\t\t\tfloat yPixelOffset = 1.0 / shadowMapSize[ i ].y;\\n\\n\t\t\t\tfloat dx0 = -1.0 * xPixelOffset;\\n\t\t\t\tfloat dy0 = -1.0 * yPixelOffset;\\n\t\t\t\tfloat dx1 = 1.0 * xPixelOffset;\\n\t\t\t\tfloat dy1 = 1.0 * yPixelOffset;\\n\\n\t\t\t\tmat3 shadowKernel;\\n\t\t\t\tmat3 depthKernel;\\n\\n\t\t\t\tdepthKernel[0][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy0 ) ) );\\n\t\t\t\tdepthKernel[0][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, 0.0 ) ) );\\n\t\t\t\tdepthKernel[0][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy1 ) ) );\\n\t\t\t\tdepthKernel[1][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy0 ) ) );\\n\t\t\t\tdepthKernel[1][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy ) );\\n\t\t\t\tdepthKernel[1][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy1 ) ) );\\n\t\t\t\tdepthKernel[2][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy0 ) ) );\\n\t\t\t\tdepthKernel[2][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, 0.0 ) ) );\\n\t\t\t\tdepthKernel[2][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy1 ) ) );\\n\\n\t\t\t\tvec3 shadowZ = vec3( shadowCoord.z );\\n\t\t\t\tshadowKernel[0] = vec3(lessThan(depthKernel[0], shadowZ ));\\n\t\t\t\tshadowKernel[0] *= vec3(0.25);\\n\\n\t\t\t\tshadowKernel[1] = vec3(lessThan(depthKernel[1], shadowZ ));\\n\t\t\t\tshadowKernel[1] *= vec3(0.25);\\n\\n\t\t\t\tshadowKernel[2] = vec3(lessThan(depthKernel[2], shadowZ ));\\n\t\t\t\tshadowKernel[2] *= vec3(0.25);\\n\\n\t\t\t\tvec2 fractionalCoord = 1.0 - fract( shadowCoord.xy * shadowMapSize[i].xy );\\n\\n\t\t\t\tshadowKernel[0] = mix( shadowKernel[1], shadowKernel[0], fractionalCoord.x );\\n\t\t\t\tshadowKernel[1] = mix( shadowKernel[2], shadowKernel[1], fractionalCoord.x );\\n\\n\t\t\t\tvec4 shadowValues;\\n\t\t\t\tshadowValues.x = mix( shadowKernel[0][1], shadowKernel[0][0], fractionalCoord.y );\\n\t\t\t\tshadowValues.y = mix( shadowKernel[0][2], shadowKernel[0][1], fractionalCoord.y );\\n\t\t\t\tshadowValues.z = mix( shadowKernel[1][1], shadowKernel[1][0], fractionalCoord.y );\\n\t\t\t\tshadowValues.w = mix( shadowKernel[1][2], shadowKernel[1][1], fractionalCoord.y );\\n\\n\t\t\t\tshadow = dot( shadowValues, vec4( 1.0 ) );\\n\\n\t\t\t\tshadowColor = shadowColor * vec3( ( 1.0 - shadowDarkness[ i ] * shadow ) );\\n\\n\t\t\t#else\\n\\n\t\t\t\tvec4 rgbaDepth = texture2D( shadowMap[ i ], shadowCoord.xy );\\n\t\t\t\tfloat fDepth = unpackDepth( rgbaDepth );\\n\\n\t\t\t\tif ( fDepth < shadowCoord.z )\\n\\n\t\t// spot with multiple shadows is darker\\n\\n\t\t\t\t\tshadowColor = shadowColor * vec3( 1.0 - shadowDarkness[ i ] );\\n\\n\t\t// spot with multiple shadows has the same color as single shadow spot\\n\\n\t\t// \t\t\t\t\tshadowColor = min( shadowColor, vec3( shadowDarkness[ i ] ) );\\n\\n\t\t\t#endif\\n\\n\t\t}\\n\\n\\n\t\t#ifdef SHADOWMAP_DEBUG\\n\\n\t\t\t#ifdef SHADOWMAP_CASCADE\\n\\n\t\t\t\tif ( inFrustum && inFrustumCount == 1 ) outgoingLight *= frustumColors[ i ];\\n\\n\t\t\t#else\\n\\n\t\t\t\tif ( inFrustum ) outgoingLight *= frustumColors[ i ];\\n\\n\t\t\t#endif\\n\\n\t\t#endif\\n\\n\t}\\n\\n\t// NOTE: I am unsure if this is correct in linear space.  -bhouston, Dec 29, 2014\\n\tshadowColor = inputToLinear( shadowColor );\\n\\n\toutgoingLight = outgoingLight * shadowColor;\\n\\n#endif\\n\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/worldpos_vertex.glsl\r\n\r\nTHREE.ShaderChunk[ 'worldpos_vertex'] = \"#if defined( USE_ENVMAP ) || defined( PHONG ) || defined( LAMBERT ) || defined ( USE_SHADOWMAP )\\n\\n\t#ifdef USE_SKINNING\\n\\n\t\tvec4 worldPosition = modelMatrix * skinned;\\n\\n\t#elif defined( USE_MORPHTARGETS )\\n\\n\t\tvec4 worldPosition = modelMatrix * vec4( morphed, 1.0 );\\n\\n\t#else\\n\\n\t\tvec4 worldPosition = modelMatrix * vec4( position, 1.0 );\\n\\n\t#endif\\n\\n#endif\\n\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/shadowmap_pars_fragment.glsl\r\n\r\nTHREE.ShaderChunk[ 'shadowmap_pars_fragment'] = \"#ifdef USE_SHADOWMAP\\n\\n\tuniform sampler2D shadowMap[ MAX_SHADOWS ];\\n\tuniform vec2 shadowMapSize[ MAX_SHADOWS ];\\n\\n\tuniform float shadowDarkness[ MAX_SHADOWS ];\\n\tuniform float shadowBias[ MAX_SHADOWS ];\\n\\n\tvarying vec4 vShadowCoord[ MAX_SHADOWS ];\\n\\n\tfloat unpackDepth( const in vec4 rgba_depth ) {\\n\\n\t\tconst vec4 bit_shift = vec4( 1.0 / ( 256.0 * 256.0 * 256.0 ), 1.0 / ( 256.0 * 256.0 ), 1.0 / 256.0, 1.0 );\\n\t\tfloat depth = dot( rgba_depth, bit_shift );\\n\t\treturn depth;\\n\\n\t}\\n\\n#endif\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/skinning_pars_vertex.glsl\r\n\r\nTHREE.ShaderChunk[ 'skinning_pars_vertex'] = \"#ifdef USE_SKINNING\\n\\n\tuniform mat4 bindMatrix;\\n\tuniform mat4 bindMatrixInverse;\\n\\n\t#ifdef BONE_TEXTURE\\n\\n\t\tuniform sampler2D boneTexture;\\n\t\tuniform int boneTextureWidth;\\n\t\tuniform int boneTextureHeight;\\n\\n\t\tmat4 getBoneMatrix( const in float i ) {\\n\\n\t\t\tfloat j = i * 4.0;\\n\t\t\tfloat x = mod( j, float( boneTextureWidth ) );\\n\t\t\tfloat y = floor( j / float( boneTextureWidth ) );\\n\\n\t\t\tfloat dx = 1.0 / float( boneTextureWidth );\\n\t\t\tfloat dy = 1.0 / float( boneTextureHeight );\\n\\n\t\t\ty = dy * ( y + 0.5 );\\n\\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\\n\\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\\n\\n\t\t\treturn bone;\\n\\n\t\t}\\n\\n\t#else\\n\\n\t\tuniform mat4 boneGlobalMatrices[ MAX_BONES ];\\n\\n\t\tmat4 getBoneMatrix( const in float i ) {\\n\\n\t\t\tmat4 bone = boneGlobalMatrices[ int(i) ];\\n\t\t\treturn bone;\\n\\n\t\t}\\n\\n\t#endif\\n\\n#endif\\n\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/logdepthbuf_pars_fragment.glsl\r\n\r\nTHREE.ShaderChunk[ 'logdepthbuf_pars_fragment'] = \"#ifdef USE_LOGDEPTHBUF\\n\\n\tuniform float logDepthBufFC;\\n\\n\t#ifdef USE_LOGDEPTHBUF_EXT\\n\\n\t\t#extension GL_EXT_frag_depth : enable\\n\t\tvarying float vFragDepth;\\n\\n\t#endif\\n\\n#endif\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/alphamap_fragment.glsl\r\n\r\nTHREE.ShaderChunk[ 'alphamap_fragment'] = \"#ifdef USE_ALPHAMAP\\n\\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\\n\\n#endif\\n\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/alphamap_pars_fragment.glsl\r\n\r\nTHREE.ShaderChunk[ 'alphamap_pars_fragment'] = \"#ifdef USE_ALPHAMAP\\n\\n\tuniform sampler2D alphaMap;\\n\\n#endif\\n\";\r\n\r\n// File:src/renderers/shaders/UniformsUtils.js\r\n\r\n/**\r\n * Uniform Utilities\r\n */\r\n\r\nTHREE.UniformsUtils = {\r\n\r\n\tmerge: function ( uniforms ) {\r\n\r\n\t\tvar merged = {};\r\n\r\n\t\tfor ( var u = 0; u < uniforms.length; u ++ ) {\r\n\r\n\t\t\tvar tmp = this.clone( uniforms[ u ] );\r\n\r\n\t\t\tfor ( var p in tmp ) {\r\n\r\n\t\t\t\tmerged[ p ] = tmp[ p ];\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\treturn merged;\r\n\r\n\t},\r\n\r\n\tclone: function ( uniforms_src ) {\r\n\r\n\t\tvar uniforms_dst = {};\r\n\r\n\t\tfor ( var u in uniforms_src ) {\r\n\r\n\t\t\tuniforms_dst[ u ] = {};\r\n\r\n\t\t\tfor ( var p in uniforms_src[ u ] ) {\r\n\r\n\t\t\t\tvar parameter_src = uniforms_src[ u ][ p ];\r\n\r\n\t\t\t\tif ( parameter_src instanceof THREE.Color ||\r\n\t\t\t\t\t parameter_src instanceof THREE.Vector2 ||\r\n\t\t\t\t\t parameter_src instanceof THREE.Vector3 ||\r\n\t\t\t\t\t parameter_src instanceof THREE.Vector4 ||\r\n\t\t\t\t\t parameter_src instanceof THREE.Matrix4 ||\r\n\t\t\t\t\t parameter_src instanceof THREE.Texture ) {\r\n\r\n\t\t\t\t\tuniforms_dst[ u ][ p ] = parameter_src.clone();\r\n\r\n\t\t\t\t} else if ( parameter_src instanceof Array ) {\r\n\r\n\t\t\t\t\tuniforms_dst[ u ][ p ] = parameter_src.slice();\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\tuniforms_dst[ u ][ p ] = parameter_src;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\treturn uniforms_dst;\r\n\r\n\t}\r\n\r\n};\r\n\r\n// File:src/renderers/shaders/UniformsLib.js\r\n\r\n/**\r\n * Uniforms library for shared webgl shaders\r\n */\r\n\r\nTHREE.UniformsLib = {\r\n\r\n\tcommon: {\r\n\r\n\t\t\"diffuse\" : { type: \"c\", value: new THREE.Color( 0xeeeeee ) },\r\n\t\t\"opacity\" : { type: \"f\", value: 1.0 },\r\n\r\n\t\t\"map\" : { type: \"t\", value: null },\r\n\t\t\"offsetRepeat\" : { type: \"v4\", value: new THREE.Vector4( 0, 0, 1, 1 ) },\r\n\r\n\t\t\"lightMap\" : { type: \"t\", value: null },\r\n\t\t\"specularMap\" : { type: \"t\", value: null },\r\n\t\t\"alphaMap\" : { type: \"t\", value: null },\r\n\r\n\t\t\"envMap\" : { type: \"t\", value: null },\r\n\t\t\"flipEnvMap\" : { type: \"f\", value: - 1 },\r\n\t\t\"reflectivity\" : { type: \"f\", value: 1.0 },\r\n\t\t\"refractionRatio\" : { type: \"f\", value: 0.98 },\r\n\r\n\t\t\"morphTargetInfluences\" : { type: \"f\", value: 0 }\r\n\r\n\t},\r\n\r\n\tbump: {\r\n\r\n\t\t\"bumpMap\" : { type: \"t\", value: null },\r\n\t\t\"bumpScale\" : { type: \"f\", value: 1 }\r\n\r\n\t},\r\n\r\n\tnormalmap: {\r\n\r\n\t\t\"normalMap\" : { type: \"t\", value: null },\r\n\t\t\"normalScale\" : { type: \"v2\", value: new THREE.Vector2( 1, 1 ) }\r\n\t},\r\n\r\n\tfog : {\r\n\r\n\t\t\"fogDensity\" : { type: \"f\", value: 0.00025 },\r\n\t\t\"fogNear\" : { type: \"f\", value: 1 },\r\n\t\t\"fogFar\" : { type: \"f\", value: 2000 },\r\n\t\t\"fogColor\" : { type: \"c\", value: new THREE.Color( 0xffffff ) }\r\n\r\n\t},\r\n\r\n\tlights: {\r\n\r\n\t\t\"ambientLightColor\" : { type: \"fv\", value: [] },\r\n\r\n\t\t\"directionalLightDirection\" : { type: \"fv\", value: [] },\r\n\t\t\"directionalLightColor\" : { type: \"fv\", value: [] },\r\n\r\n\t\t\"hemisphereLightDirection\" : { type: \"fv\", value: [] },\r\n\t\t\"hemisphereLightSkyColor\" : { type: \"fv\", value: [] },\r\n\t\t\"hemisphereLightGroundColor\" : { type: \"fv\", value: [] },\r\n\r\n\t\t\"pointLightColor\" : { type: \"fv\", value: [] },\r\n\t\t\"pointLightPosition\" : { type: \"fv\", value: [] },\r\n\t\t\"pointLightDistance\" : { type: \"fv1\", value: [] },\r\n\t\t\"pointLightDecay\" : { type: \"fv1\", value: [] },\r\n\r\n\t\t\"spotLightColor\" : { type: \"fv\", value: [] },\r\n\t\t\"spotLightPosition\" : { type: \"fv\", value: [] },\r\n\t\t\"spotLightDirection\" : { type: \"fv\", value: [] },\r\n\t\t\"spotLightDistance\" : { type: \"fv1\", value: [] },\r\n\t\t\"spotLightAngleCos\" : { type: \"fv1\", value: [] },\r\n\t\t\"spotLightExponent\" : { type: \"fv1\", value: [] },\r\n\t\t\"spotLightDecay\" : { type: \"fv1\", value: [] }\r\n\r\n\t},\r\n\r\n\tparticle: {\r\n\r\n\t\t\"psColor\" : { type: \"c\", value: new THREE.Color( 0xeeeeee ) },\r\n\t\t\"opacity\" : { type: \"f\", value: 1.0 },\r\n\t\t\"size\" : { type: \"f\", value: 1.0 },\r\n\t\t\"scale\" : { type: \"f\", value: 1.0 },\r\n\t\t\"map\" : { type: \"t\", value: null },\r\n\t\t\"offsetRepeat\" : { type: \"v4\", value: new THREE.Vector4( 0, 0, 1, 1 ) },\r\n\r\n\t\t\"fogDensity\" : { type: \"f\", value: 0.00025 },\r\n\t\t\"fogNear\" : { type: \"f\", value: 1 },\r\n\t\t\"fogFar\" : { type: \"f\", value: 2000 },\r\n\t\t\"fogColor\" : { type: \"c\", value: new THREE.Color( 0xffffff ) }\r\n\r\n\t},\r\n\r\n\tshadowmap: {\r\n\r\n\t\t\"shadowMap\": { type: \"tv\", value: [] },\r\n\t\t\"shadowMapSize\": { type: \"v2v\", value: [] },\r\n\r\n\t\t\"shadowBias\" : { type: \"fv1\", value: [] },\r\n\t\t\"shadowDarkness\": { type: \"fv1\", value: [] },\r\n\r\n\t\t\"shadowMatrix\" : { type: \"m4v\", value: [] }\r\n\r\n\t}\r\n\r\n};\r\n\r\n// File:src/renderers/shaders/ShaderLib.js\r\n\r\n/**\r\n * Webgl Shader Library for three.js\r\n *\r\n * @author alteredq / http://alteredqualia.com/\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author mikael emtinger / http://gomo.se/\r\n */\r\n\r\n\r\nTHREE.ShaderLib = {\r\n\r\n\t'basic': {\r\n\r\n\t\tuniforms: THREE.UniformsUtils.merge( [\r\n\r\n\t\t\tTHREE.UniformsLib[ \"common\" ],\r\n\t\t\tTHREE.UniformsLib[ \"fog\" ],\r\n\t\t\tTHREE.UniformsLib[ \"shadowmap\" ]\r\n\r\n\t\t] ),\r\n\r\n\t\tvertexShader: [\r\n\r\n\t\t\tTHREE.ShaderChunk[ \"common\" ],\r\n\t\t\tTHREE.ShaderChunk[ \"map_pars_vertex\" ],\r\n\t\t\tTHREE.ShaderChunk[ \"lightmap_pars_vertex\" ],\r\n\t\t\tTHREE.ShaderChunk[ \"envmap_pars_vertex\" ],\r\n\t\t\tTHREE.ShaderChunk[ \"color_pars_vertex\" ],\r\n\t\t\tTHREE.ShaderChunk[ \"morphtarget_pars_vertex\" ],\r\n\t\t\tTHREE.ShaderChunk[ \"skinning_pars_vertex\" ],\r\n\t\t\tTHREE.ShaderChunk[ \"shadowmap_pars_vertex\" ],\r\n\t\t\tTHREE.ShaderChunk[ \"logdepthbuf_pars_vertex\" ],\r\n\r\n\t\t\t\"void main() {\",\r\n\r\n\t\t\t\tTHREE.ShaderChunk[ \"map_vertex\" ],\r\n\t\t\t\tTHREE.ShaderChunk[ \"lightmap_vertex\" ],\r\n\t\t\t\tTHREE.ShaderChunk[ \"color_vertex\" ],\r\n\t\t\t\tTHREE.ShaderChunk[ \"skinbase_vertex\" ],\r\n\r\n\t\t\t\"\t#ifdef USE_ENVMAP\",\r\n\r\n\t\t\t\tTHREE.ShaderChunk[ \"morphnormal_vertex\" ],\r\n\t\t\t\tTHREE.ShaderChunk[ \"skinnormal_vertex\" ],\r\n\t\t\t\tTHREE.ShaderChunk[ \"defaultnormal_vertex\" ],\r\n\r\n\t\t\t\"\t#endif\",\r\n\r\n\t\t\t\tTHREE.ShaderChunk[ \"morphtarget_vertex\" ],\r\n\t\t\t\tTHREE.ShaderChunk[ \"skinning_vertex\" ],\r\n\t\t\t\tTHREE.ShaderChunk[ \"default_vertex\" ],\r\n\t\t\t\tTHREE.ShaderChunk[ \"logdepthbuf_vertex\" ],\r\n\r\n\t\t\t\tTHREE.ShaderChunk[ \"worldpos_vertex\" ],\r\n\t\t\t\tTHREE.ShaderChunk[ \"envmap_vertex\" ],\r\n\t\t\t\tTHREE.ShaderChunk[ \"shadowmap_vertex\" ],\r\n\r\n\t\t\t\"}\"\r\n\r\n\t\t].join(\"\\n\"),\r\n\r\n\t\tfragmentShader: [\r\n\r\n\t\t\t\"uniform vec3 diffuse;\",\r\n\t\t\t\"uniform float opacity;\",\r\n\r\n\t\t\tTHREE.ShaderChunk[ \"common\" ],\r\n\t\t\tTHREE.ShaderChunk[ \"color_pars_fragment\" ],\r\n\t\t\tTHREE.ShaderChunk[ \"map_pars_fragment\" ],\r\n\t\t\tTHREE.ShaderChunk[ \"alphamap_pars_fragment\" ],\r\n\t\t\tTHREE.ShaderChunk[ \"lightmap_pars_fragment\" ],\r\n\t\t\tTHREE.ShaderChunk[ \"envmap_pars_fragment\" ],\r\n\t\t\tTHREE.ShaderChunk[ \"fog_pars_fragment\" ],\r\n\t\t\tTHREE.ShaderChunk[ \"shadowmap_pars_fragment\" ],\r\n\t\t\tTHREE.ShaderChunk[ \"specularmap_pars_fragment\" ],\r\n\t\t\tTHREE.ShaderChunk[ \"logdepthbuf_pars_fragment\" ],\r\n\r\n\t\t\t\"void main() {\",\r\n\r\n\t\t\t\"\tvec3 outgoingLight = vec3( 0.0 );\",\t// outgoing light does not have an alpha, the surface does\r\n\t\t\t\"\tvec4 diffuseColor = vec4( diffuse, opacity );\",\r\n\r\n\t\t\t\tTHREE.ShaderChunk[ \"logdepthbuf_fragment\" ],\r\n\t\t\t\tTHREE.ShaderChunk[ \"map_fragment\" ],\r\n\t\t\t\tTHREE.ShaderChunk[ \"color_fragment\" ],\r\n\t\t\t\tTHREE.ShaderChunk[ \"alphamap_fragment\" ],\r\n\t\t\t\tTHREE.ShaderChunk[ \"alphatest_fragment\" ],\r\n\t\t\t\tTHREE.ShaderChunk[ \"specularmap_fragment\" ],\r\n\r\n\t\t\t\"\toutgoingLight = diffuseColor.rgb;\", // simple shader\r\n\r\n\t\t\t\tTHREE.ShaderChunk[ \"lightmap_fragment\" ],\t\t// TODO: Light map on an otherwise unlit surface doesn't make sense.\r\n\t\t\t\tTHREE.ShaderChunk[ \"envmap_fragment\" ],\r\n\t\t\t\tTHREE.ShaderChunk[ \"shadowmap_fragment\" ],\t\t// TODO: Shadows on an otherwise unlit surface doesn't make sense.\r\n\r\n\t\t\t\tTHREE.ShaderChunk[ \"linear_to_gamma_fragment\" ],\r\n\r\n\t\t\t\tTHREE.ShaderChunk[ \"fog_fragment\" ],\r\n\r\n\t\t\t\"\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\",\t// TODO, this should be pre-multiplied to allow for bright highlights on very transparent objects\r\n\r\n\t\t\t\"}\"\r\n\r\n\t\t].join(\"\\n\")\r\n\r\n\t},\r\n\r\n\t'lambert': {\r\n\r\n\t\tuniforms: THREE.UniformsUtils.merge( [\r\n\r\n\t\t\tTHREE.UniformsLib[ \"common\" ],\r\n\t\t\tTHREE.UniformsLib[ \"fog\" ],\r\n\t\t\tTHREE.UniformsLib[ \"lights\" ],\r\n\t\t\tTHREE.UniformsLib[ \"shadowmap\" ],\r\n\r\n\t\t\t{\r\n\t\t\t\t\"emissive\" : { type: \"c\", value: new THREE.Color( 0x000000 ) },\r\n\t\t\t\t\"wrapRGB\"  : { type: \"v3\", value: new THREE.Vector3( 1, 1, 1 ) }\r\n\t\t\t}\r\n\r\n\t\t] ),\r\n\r\n\t\tvertexShader: [\r\n\r\n\t\t\t\"#define LAMBERT\",\r\n\r\n\t\t\t\"varying vec3 vLightFront;\",\r\n\r\n\t\t\t\"#ifdef DOUBLE_SIDED\",\r\n\r\n\t\t\t\"\tvarying vec3 vLightBack;\",\r\n\r\n\t\t\t\"#endif\",\r\n\r\n\t\t\tTHREE.ShaderChunk[ \"common\" ],\r\n\t\t\tTHREE.ShaderChunk[ \"map_pars_vertex\" ],\r\n\t\t\tTHREE.ShaderChunk[ \"lightmap_pars_vertex\" ],\r\n\t\t\tTHREE.ShaderChunk[ \"envmap_pars_vertex\" ],\r\n\t\t\tTHREE.ShaderChunk[ \"lights_lambert_pars_vertex\" ],\r\n\t\t\tTHREE.ShaderChunk[ \"color_pars_vertex\" ],\r\n\t\t\tTHREE.ShaderChunk[ \"morphtarget_pars_vertex\" ],\r\n\t\t\tTHREE.ShaderChunk[ \"skinning_pars_vertex\" ],\r\n\t\t\tTHREE.ShaderChunk[ \"shadowmap_pars_vertex\" ],\r\n\t\t\tTHREE.ShaderChunk[ \"logdepthbuf_pars_vertex\" ],\r\n\r\n\t\t\t\"void main() {\",\r\n\r\n\t\t\t\tTHREE.ShaderChunk[ \"map_vertex\" ],\r\n\t\t\t\tTHREE.ShaderChunk[ \"lightmap_vertex\" ],\r\n\t\t\t\tTHREE.ShaderChunk[ \"color_vertex\" ],\r\n\r\n\t\t\t\tTHREE.ShaderChunk[ \"morphnormal_vertex\" ],\r\n\t\t\t\tTHREE.ShaderChunk[ \"skinbase_vertex\" ],\r\n\t\t\t\tTHREE.ShaderChunk[ \"skinnormal_vertex\" ],\r\n\t\t\t\tTHREE.ShaderChunk[ \"defaultnormal_vertex\" ],\r\n\r\n\t\t\t\tTHREE.ShaderChunk[ \"morphtarget_vertex\" ],\r\n\t\t\t\tTHREE.ShaderChunk[ \"skinning_vertex\" ],\r\n\t\t\t\tTHREE.ShaderChunk[ \"default_vertex\" ],\r\n\t\t\t\tTHREE.ShaderChunk[ \"logdepthbuf_vertex\" ],\r\n\r\n\t\t\t\tTHREE.ShaderChunk[ \"worldpos_vertex\" ],\r\n\t\t\t\tTHREE.ShaderChunk[ \"envmap_vertex\" ],\r\n\t\t\t\tTHREE.ShaderChunk[ \"lights_lambert_vertex\" ],\r\n\t\t\t\tTHREE.ShaderChunk[ \"shadowmap_vertex\" ],\r\n\r\n\t\t\t\"}\"\r\n\r\n\t\t].join(\"\\n\"),\r\n\r\n\t\tfragmentShader: [\r\n\r\n\t\t\t\"uniform vec3 diffuse;\",\r\n\t\t\t\"uniform vec3 emissive;\",\r\n\t\t\t\"uniform float opacity;\",\r\n\r\n\t\t\t\"varying vec3 vLightFront;\",\r\n\r\n\t\t\t\"#ifdef DOUBLE_SIDED\",\r\n\r\n\t\t\t\"\tvarying vec3 vLightBack;\",\r\n\r\n\t\t\t\"#endif\",\r\n\r\n\t\t\tTHREE.ShaderChunk[ \"common\" ],\r\n\t\t\tTHREE.ShaderChunk[ \"color_pars_fragment\" ],\r\n\t\t\tTHREE.ShaderChunk[ \"map_pars_fragment\" ],\r\n\t\t\tTHREE.ShaderChunk[ \"alphamap_pars_fragment\" ],\r\n\t\t\tTHREE.ShaderChunk[ \"lightmap_pars_fragment\" ],\r\n\t\t\tTHREE.ShaderChunk[ \"envmap_pars_fragment\" ],\r\n\t\t\tTHREE.ShaderChunk[ \"fog_pars_fragment\" ],\r\n\t\t\tTHREE.ShaderChunk[ \"shadowmap_pars_fragment\" ],\r\n\t\t\tTHREE.ShaderChunk[ \"specularmap_pars_fragment\" ],\r\n\t\t\tTHREE.ShaderChunk[ \"logdepthbuf_pars_fragment\" ],\r\n\r\n\t\t\t\"void main() {\",\r\n\r\n\t\t\t\"\tvec3 outgoingLight = vec3( 0.0 );\",\t// outgoing light does not have an alpha, the surface does\r\n\t\t\t\"\tvec4 diffuseColor = vec4( diffuse, opacity );\",\r\n\r\n\t\t\t\tTHREE.ShaderChunk[ \"logdepthbuf_fragment\" ],\r\n\t\t\t\tTHREE.ShaderChunk[ \"map_fragment\" ],\r\n\t\t\t\tTHREE.ShaderChunk[ \"color_fragment\" ],\r\n\t\t\t\tTHREE.ShaderChunk[ \"alphamap_fragment\" ],\r\n\t\t\t\tTHREE.ShaderChunk[ \"alphatest_fragment\" ],\r\n\t\t\t\tTHREE.ShaderChunk[ \"specularmap_fragment\" ],\r\n\r\n\t\t\t\"\t#ifdef DOUBLE_SIDED\",\r\n\r\n\t\t\t\t\t//\"float isFront = float( gl_FrontFacing );\",\r\n\t\t\t\t\t//\"gl_FragColor.xyz *= isFront * vLightFront + ( 1.0 - isFront ) * vLightBack;\",\r\n\r\n\t\t\t\"\t\tif ( gl_FrontFacing )\",\r\n\t\t\t\"\t\t\toutgoingLight += diffuseColor.rgb * vLightFront + emissive;\",\r\n\t\t\t\"\t\telse\",\r\n\t\t\t\"\t\t\toutgoingLight += diffuseColor.rgb * vLightBack + emissive;\",\r\n\r\n\t\t\t\"\t#else\",\r\n\r\n\t\t\t\"\t\toutgoingLight += diffuseColor.rgb * vLightFront + emissive;\",\r\n\r\n\t\t\t\"\t#endif\",\r\n\r\n\t\t\t\tTHREE.ShaderChunk[ \"lightmap_fragment\" ],\r\n\t\t\t\tTHREE.ShaderChunk[ \"envmap_fragment\" ],\r\n\t\t\t\tTHREE.ShaderChunk[ \"shadowmap_fragment\" ],\r\n\r\n\t\t\t\tTHREE.ShaderChunk[ \"linear_to_gamma_fragment\" ],\r\n\r\n\t\t\t\tTHREE.ShaderChunk[ \"fog_fragment\" ],\r\n\r\n\t\t\t\"\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\",\t// TODO, this should be pre-multiplied to allow for bright highlights on very transparent objects\r\n\r\n\t\t\t\"}\"\r\n\r\n\t\t].join(\"\\n\")\r\n\r\n\t},\r\n\r\n\t'phong': {\r\n\r\n\t\tuniforms: THREE.UniformsUtils.merge( [\r\n\r\n\t\t\tTHREE.UniformsLib[ \"common\" ],\r\n\t\t\tTHREE.UniformsLib[ \"bump\" ],\r\n\t\t\tTHREE.UniformsLib[ \"normalmap\" ],\r\n\t\t\tTHREE.UniformsLib[ \"fog\" ],\r\n\t\t\tTHREE.UniformsLib[ \"lights\" ],\r\n\t\t\tTHREE.UniformsLib[ \"shadowmap\" ],\r\n\r\n\t\t\t{\r\n\t\t\t\t\"emissive\" : { type: \"c\", value: new THREE.Color( 0x000000 ) },\r\n\t\t\t\t\"specular\" : { type: \"c\", value: new THREE.Color( 0x111111 ) },\r\n\t\t\t\t\"shininess\": { type: \"f\", value: 30 },\r\n\t\t\t\t\"wrapRGB\"  : { type: \"v3\", value: new THREE.Vector3( 1, 1, 1 ) }\r\n\t\t\t}\r\n\r\n\t\t] ),\r\n\r\n\t\tvertexShader: [\r\n\r\n\t\t\t\"#define PHONG\",\r\n\r\n\t\t\t\"varying vec3 vViewPosition;\",\r\n\r\n\t\t\t\"#ifndef FLAT_SHADED\",\r\n\r\n\t\t\t\"\tvarying vec3 vNormal;\",\r\n\r\n\t\t\t\"#endif\",\r\n\r\n\t\t\tTHREE.ShaderChunk[ \"common\" ],\r\n\t\t\tTHREE.ShaderChunk[ \"map_pars_vertex\" ],\r\n\t\t\tTHREE.ShaderChunk[ \"lightmap_pars_vertex\" ],\r\n\t\t\tTHREE.ShaderChunk[ \"envmap_pars_vertex\" ],\r\n\t\t\tTHREE.ShaderChunk[ \"lights_phong_pars_vertex\" ],\r\n\t\t\tTHREE.ShaderChunk[ \"color_pars_vertex\" ],\r\n\t\t\tTHREE.ShaderChunk[ \"morphtarget_pars_vertex\" ],\r\n\t\t\tTHREE.ShaderChunk[ \"skinning_pars_vertex\" ],\r\n\t\t\tTHREE.ShaderChunk[ \"shadowmap_pars_vertex\" ],\r\n\t\t\tTHREE.ShaderChunk[ \"logdepthbuf_pars_vertex\" ],\r\n\r\n\t\t\t\"void main() {\",\r\n\r\n\t\t\t\tTHREE.ShaderChunk[ \"map_vertex\" ],\r\n\t\t\t\tTHREE.ShaderChunk[ \"lightmap_vertex\" ],\r\n\t\t\t\tTHREE.ShaderChunk[ \"color_vertex\" ],\r\n\r\n\t\t\t\tTHREE.ShaderChunk[ \"morphnormal_vertex\" ],\r\n\t\t\t\tTHREE.ShaderChunk[ \"skinbase_vertex\" ],\r\n\t\t\t\tTHREE.ShaderChunk[ \"skinnormal_vertex\" ],\r\n\t\t\t\tTHREE.ShaderChunk[ \"defaultnormal_vertex\" ],\r\n\r\n\t\t\t\"#ifndef FLAT_SHADED\", // Normal computed with derivatives when FLAT_SHADED\r\n\r\n\t\t\t\"\tvNormal = normalize( transformedNormal );\",\r\n\r\n\t\t\t\"#endif\",\r\n\r\n\t\t\t\tTHREE.ShaderChunk[ \"morphtarget_vertex\" ],\r\n\t\t\t\tTHREE.ShaderChunk[ \"skinning_vertex\" ],\r\n\t\t\t\tTHREE.ShaderChunk[ \"default_vertex\" ],\r\n\t\t\t\tTHREE.ShaderChunk[ \"logdepthbuf_vertex\" ],\r\n\r\n\t\t\t\"\tvViewPosition = -mvPosition.xyz;\",\r\n\r\n\t\t\t\tTHREE.ShaderChunk[ \"worldpos_vertex\" ],\r\n\t\t\t\tTHREE.ShaderChunk[ \"envmap_vertex\" ],\r\n\t\t\t\tTHREE.ShaderChunk[ \"lights_phong_vertex\" ],\r\n\t\t\t\tTHREE.ShaderChunk[ \"shadowmap_vertex\" ],\r\n\r\n\t\t\t\"}\"\r\n\r\n\t\t].join(\"\\n\"),\r\n\r\n\t\tfragmentShader: [\r\n\r\n\t\t\t\"#define PHONG\",\r\n\r\n\t\t\t\"uniform vec3 diffuse;\",\r\n\t\t\t\"uniform vec3 emissive;\",\r\n\t\t\t\"uniform vec3 specular;\",\r\n\t\t\t\"uniform float shininess;\",\r\n\t\t\t\"uniform float opacity;\",\r\n\r\n\t\t\tTHREE.ShaderChunk[ \"common\" ],\r\n\t\t\tTHREE.ShaderChunk[ \"color_pars_fragment\" ],\r\n\t\t\tTHREE.ShaderChunk[ \"map_pars_fragment\" ],\r\n\t\t\tTHREE.ShaderChunk[ \"alphamap_pars_fragment\" ],\r\n\t\t\tTHREE.ShaderChunk[ \"lightmap_pars_fragment\" ],\r\n\t\t\tTHREE.ShaderChunk[ \"envmap_pars_fragment\" ],\r\n\t\t\tTHREE.ShaderChunk[ \"fog_pars_fragment\" ],\r\n\t\t\tTHREE.ShaderChunk[ \"lights_phong_pars_fragment\" ],\r\n\t\t\tTHREE.ShaderChunk[ \"shadowmap_pars_fragment\" ],\r\n\t\t\tTHREE.ShaderChunk[ \"bumpmap_pars_fragment\" ],\r\n\t\t\tTHREE.ShaderChunk[ \"normalmap_pars_fragment\" ],\r\n\t\t\tTHREE.ShaderChunk[ \"specularmap_pars_fragment\" ],\r\n\t\t\tTHREE.ShaderChunk[ \"logdepthbuf_pars_fragment\" ],\r\n\r\n\t\t\t\"void main() {\",\r\n\r\n\t\t\t\"\tvec3 outgoingLight = vec3( 0.0 );\",\t// outgoing light does not have an alpha, the surface does\r\n\t\t\t\"\tvec4 diffuseColor = vec4( diffuse, opacity );\",\r\n\r\n\t\t\t\tTHREE.ShaderChunk[ \"logdepthbuf_fragment\" ],\r\n\t\t\t\tTHREE.ShaderChunk[ \"map_fragment\" ],\r\n\t\t\t\tTHREE.ShaderChunk[ \"color_fragment\" ],\r\n\t\t\t\tTHREE.ShaderChunk[ \"alphamap_fragment\" ],\r\n\t\t\t\tTHREE.ShaderChunk[ \"alphatest_fragment\" ],\r\n\t\t\t\tTHREE.ShaderChunk[ \"specularmap_fragment\" ],\r\n\r\n\t\t\t\tTHREE.ShaderChunk[ \"lights_phong_fragment\" ],\r\n\r\n\t\t\t\tTHREE.ShaderChunk[ \"lightmap_fragment\" ],\r\n\t\t\t\tTHREE.ShaderChunk[ \"envmap_fragment\" ],\r\n\t\t\t\tTHREE.ShaderChunk[ \"shadowmap_fragment\" ],\r\n\r\n\t\t\t\tTHREE.ShaderChunk[ \"linear_to_gamma_fragment\" ],\r\n\r\n\t\t\t\tTHREE.ShaderChunk[ \"fog_fragment\" ],\r\n\r\n\t\t\t\"\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\",\t// TODO, this should be pre-multiplied to allow for bright highlights on very transparent objects\r\n\r\n\t\t\t\"}\"\r\n\r\n\t\t].join(\"\\n\")\r\n\r\n\t},\r\n\r\n\t'particle_basic': {\r\n\r\n\t\tuniforms: THREE.UniformsUtils.merge( [\r\n\r\n\t\t\tTHREE.UniformsLib[ \"particle\" ],\r\n\t\t\tTHREE.UniformsLib[ \"shadowmap\" ]\r\n\r\n\t\t] ),\r\n\r\n\t\tvertexShader: [\r\n\r\n\t\t\t\"uniform float size;\",\r\n\t\t\t\"uniform float scale;\",\r\n\r\n\t\t\tTHREE.ShaderChunk[ \"common\" ],\r\n\t\t\tTHREE.ShaderChunk[ \"color_pars_vertex\" ],\r\n\t\t\tTHREE.ShaderChunk[ \"shadowmap_pars_vertex\" ],\r\n\t\t\tTHREE.ShaderChunk[ \"logdepthbuf_pars_vertex\" ],\r\n\r\n\t\t\t\"void main() {\",\r\n\r\n\t\t\t\tTHREE.ShaderChunk[ \"color_vertex\" ],\r\n\r\n\t\t\t\"\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\",\r\n\r\n\t\t\t\"\t#ifdef USE_SIZEATTENUATION\",\r\n\t\t\t\"\t\tgl_PointSize = size * ( scale / length( mvPosition.xyz ) );\",\r\n\t\t\t\"\t#else\",\r\n\t\t\t\"\t\tgl_PointSize = size;\",\r\n\t\t\t\"\t#endif\",\r\n\r\n\t\t\t\"\tgl_Position = projectionMatrix * mvPosition;\",\r\n\r\n\t\t\t\tTHREE.ShaderChunk[ \"logdepthbuf_vertex\" ],\r\n\t\t\t\tTHREE.ShaderChunk[ \"worldpos_vertex\" ],\r\n\t\t\t\tTHREE.ShaderChunk[ \"shadowmap_vertex\" ],\r\n\r\n\t\t\t\"}\"\r\n\r\n\t\t].join(\"\\n\"),\r\n\r\n\t\tfragmentShader: [\r\n\r\n\t\t\t\"uniform vec3 psColor;\",\r\n\t\t\t\"uniform float opacity;\",\r\n\r\n\t\t\tTHREE.ShaderChunk[ \"common\" ],\r\n\t\t\tTHREE.ShaderChunk[ \"color_pars_fragment\" ],\r\n\t\t\tTHREE.ShaderChunk[ \"map_particle_pars_fragment\" ],\r\n\t\t\tTHREE.ShaderChunk[ \"fog_pars_fragment\" ],\r\n\t\t\tTHREE.ShaderChunk[ \"shadowmap_pars_fragment\" ],\r\n\t\t\tTHREE.ShaderChunk[ \"logdepthbuf_pars_fragment\" ],\r\n\r\n\t\t\t\"void main() {\",\r\n\r\n\t\t\t\"\tvec3 outgoingLight = vec3( 0.0 );\",\t// outgoing light does not have an alpha, the surface does\r\n\t\t\t\"\tvec4 diffuseColor = vec4( psColor, opacity );\",\r\n\r\n\t\t\t\tTHREE.ShaderChunk[ \"logdepthbuf_fragment\" ],\r\n\t\t\t\tTHREE.ShaderChunk[ \"map_particle_fragment\" ],\r\n\t\t\t\tTHREE.ShaderChunk[ \"color_fragment\" ],\r\n\t\t\t\tTHREE.ShaderChunk[ \"alphatest_fragment\" ],\r\n\r\n\t\t\t\"\toutgoingLight = diffuseColor.rgb;\", // simple shader\r\n\r\n\t\t\t\tTHREE.ShaderChunk[ \"shadowmap_fragment\" ],\r\n\t\t\t\tTHREE.ShaderChunk[ \"fog_fragment\" ],\r\n\r\n\t\t\t\"\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\",\t// TODO, this should be pre-multiplied to allow for bright highlights on very transparent objects\r\n\r\n\t\t\t\"}\"\r\n\r\n\t\t].join(\"\\n\")\r\n\r\n\t},\r\n\r\n\t'dashed': {\r\n\r\n\t\tuniforms: THREE.UniformsUtils.merge( [\r\n\r\n\t\t\tTHREE.UniformsLib[ \"common\" ],\r\n\t\t\tTHREE.UniformsLib[ \"fog\" ],\r\n\r\n\t\t\t{\r\n\t\t\t\t\"scale\"    : { type: \"f\", value: 1 },\r\n\t\t\t\t\"dashSize\" : { type: \"f\", value: 1 },\r\n\t\t\t\t\"totalSize\": { type: \"f\", value: 2 }\r\n\t\t\t}\r\n\r\n\t\t] ),\r\n\r\n\t\tvertexShader: [\r\n\r\n\t\t\t\"uniform float scale;\",\r\n\t\t\t\"attribute float lineDistance;\",\r\n\r\n\t\t\t\"varying float vLineDistance;\",\r\n\r\n\t\t\tTHREE.ShaderChunk[ \"common\" ],\r\n\t\t\tTHREE.ShaderChunk[ \"color_pars_vertex\" ],\r\n\t\t\tTHREE.ShaderChunk[ \"logdepthbuf_pars_vertex\" ],\r\n\r\n\t\t\t\"void main() {\",\r\n\r\n\t\t\t\tTHREE.ShaderChunk[ \"color_vertex\" ],\r\n\r\n\t\t\t\"\tvLineDistance = scale * lineDistance;\",\r\n\r\n\t\t\t\"\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\",\r\n\t\t\t\"\tgl_Position = projectionMatrix * mvPosition;\",\r\n\r\n\t\t\t\tTHREE.ShaderChunk[ \"logdepthbuf_vertex\" ],\r\n\r\n\t\t\t\"}\"\r\n\r\n\t\t].join(\"\\n\"),\r\n\r\n\t\tfragmentShader: [\r\n\r\n\t\t\t\"uniform vec3 diffuse;\",\r\n\t\t\t\"uniform float opacity;\",\r\n\r\n\t\t\t\"uniform float dashSize;\",\r\n\t\t\t\"uniform float totalSize;\",\r\n\r\n\t\t\t\"varying float vLineDistance;\",\r\n\r\n\t\t\tTHREE.ShaderChunk[ \"common\" ],\r\n\t\t\tTHREE.ShaderChunk[ \"color_pars_fragment\" ],\r\n\t\t\tTHREE.ShaderChunk[ \"fog_pars_fragment\" ],\r\n\t\t\tTHREE.ShaderChunk[ \"logdepthbuf_pars_fragment\" ],\r\n\r\n\t\t\t\"void main() {\",\r\n\r\n\t\t\t\"\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\",\r\n\r\n\t\t\t\"\t\tdiscard;\",\r\n\r\n\t\t\t\"\t}\",\r\n\r\n\t\t\t\"\tvec3 outgoingLight = vec3( 0.0 );\",\t// outgoing light does not have an alpha, the surface does\r\n\t\t\t\"\tvec4 diffuseColor = vec4( diffuse, opacity );\",\r\n\r\n\t\t\t\tTHREE.ShaderChunk[ \"logdepthbuf_fragment\" ],\r\n\t\t\t\tTHREE.ShaderChunk[ \"color_fragment\" ],\r\n\r\n\t\t\t\"\toutgoingLight = diffuseColor.rgb;\", // simple shader\r\n\r\n\t\t\t\tTHREE.ShaderChunk[ \"fog_fragment\" ],\r\n\r\n\t\t\t\"\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\",\t// TODO, this should be pre-multiplied to allow for bright highlights on very transparent objects\r\n\r\n\t\t\t\"}\"\r\n\r\n\t\t].join(\"\\n\")\r\n\r\n\t},\r\n\r\n\t'depth': {\r\n\r\n\t\tuniforms: {\r\n\r\n\t\t\t\"mNear\": { type: \"f\", value: 1.0 },\r\n\t\t\t\"mFar\" : { type: \"f\", value: 2000.0 },\r\n\t\t\t\"opacity\" : { type: \"f\", value: 1.0 }\r\n\r\n\t\t},\r\n\r\n\t\tvertexShader: [\r\n\r\n\t\t\tTHREE.ShaderChunk[ \"common\" ],\r\n\t\t\tTHREE.ShaderChunk[ \"morphtarget_pars_vertex\" ],\r\n\t\t\tTHREE.ShaderChunk[ \"logdepthbuf_pars_vertex\" ],\r\n\r\n\t\t\t\"void main() {\",\r\n\r\n\t\t\t\tTHREE.ShaderChunk[ \"morphtarget_vertex\" ],\r\n\t\t\t\tTHREE.ShaderChunk[ \"default_vertex\" ],\r\n\t\t\t\tTHREE.ShaderChunk[ \"logdepthbuf_vertex\" ],\r\n\r\n\t\t\t\"}\"\r\n\r\n\t\t].join(\"\\n\"),\r\n\r\n\t\tfragmentShader: [\r\n\r\n\t\t\t\"uniform float mNear;\",\r\n\t\t\t\"uniform float mFar;\",\r\n\t\t\t\"uniform float opacity;\",\r\n\r\n\t\t\tTHREE.ShaderChunk[ \"common\" ],\r\n\t\t\tTHREE.ShaderChunk[ \"logdepthbuf_pars_fragment\" ],\r\n\r\n\t\t\t\"void main() {\",\r\n\r\n\t\t\t\tTHREE.ShaderChunk[ \"logdepthbuf_fragment\" ],\r\n\r\n\t\t\t\"\t#ifdef USE_LOGDEPTHBUF_EXT\",\r\n\r\n\t\t\t\"\t\tfloat depth = gl_FragDepthEXT / gl_FragCoord.w;\",\r\n\r\n\t\t\t\"\t#else\",\r\n\r\n\t\t\t\"\t\tfloat depth = gl_FragCoord.z / gl_FragCoord.w;\",\r\n\r\n\t\t\t\"\t#endif\",\r\n\r\n\t\t\t\"\tfloat color = 1.0 - smoothstep( mNear, mFar, depth );\",\r\n\t\t\t\"\tgl_FragColor = vec4( vec3( color ), opacity );\",   // TODO, this should be pre-multiplied to allow for bright highlights on very transparent objects\r\n\r\n\t\t\t\"}\"\r\n\r\n\t\t].join(\"\\n\")\r\n\r\n\t},\r\n\r\n\t'normal': {\r\n\r\n\t\tuniforms: {\r\n\r\n\t\t\t\"opacity\" : { type: \"f\", value: 1.0 }\r\n\r\n\t\t},\r\n\r\n\t\tvertexShader: [\r\n\r\n\t\t\t\"varying vec3 vNormal;\",\r\n\r\n\t\t\tTHREE.ShaderChunk[ \"common\" ],\r\n\t\t\tTHREE.ShaderChunk[ \"morphtarget_pars_vertex\" ],\r\n\t\t\tTHREE.ShaderChunk[ \"logdepthbuf_pars_vertex\" ],\r\n\r\n\t\t\t\"void main() {\",\r\n\r\n\t\t\t\"\tvNormal = normalize( normalMatrix * normal );\",\r\n\r\n\t\t\t\tTHREE.ShaderChunk[ \"morphtarget_vertex\" ],\r\n\t\t\t\tTHREE.ShaderChunk[ \"default_vertex\" ],\r\n\t\t\t\tTHREE.ShaderChunk[ \"logdepthbuf_vertex\" ],\r\n\r\n\t\t\t\"}\"\r\n\r\n\t\t].join(\"\\n\"),\r\n\r\n\t\tfragmentShader: [\r\n\r\n\t\t\t\"uniform float opacity;\",\r\n\t\t\t\"varying vec3 vNormal;\",\r\n\r\n\t\t\tTHREE.ShaderChunk[ \"common\" ],\r\n\t\t\tTHREE.ShaderChunk[ \"logdepthbuf_pars_fragment\" ],\r\n\r\n\t\t\t\"void main() {\",\r\n\r\n\t\t\t\"\tgl_FragColor = vec4( 0.5 * normalize( vNormal ) + 0.5, opacity );\",\r\n\r\n\t\t\t\tTHREE.ShaderChunk[ \"logdepthbuf_fragment\" ],\r\n\r\n\t\t\t\"}\"\r\n\r\n\t\t].join(\"\\n\")\r\n\r\n\t},\r\n\r\n\t/* -------------------------------------------------------------------------\r\n\t//\tCube map shader\r\n\t ------------------------------------------------------------------------- */\r\n\r\n\t'cube': {\r\n\r\n\t\tuniforms: { \"tCube\": { type: \"t\", value: null },\r\n\t\t\t\t\t\"tFlip\": { type: \"f\", value: - 1 } },\r\n\r\n\t\tvertexShader: [\r\n\r\n\t\t\t\"varying vec3 vWorldPosition;\",\r\n\r\n\t\t\tTHREE.ShaderChunk[ \"common\" ],\r\n\t\t\tTHREE.ShaderChunk[ \"logdepthbuf_pars_vertex\" ],\r\n\r\n\t\t\t\"void main() {\",\r\n\r\n\t\t\t\"\tvWorldPosition = transformDirection( position, modelMatrix );\",\r\n\r\n\t\t\t\"\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\",\r\n\r\n\t\t\t\tTHREE.ShaderChunk[ \"logdepthbuf_vertex\" ],\r\n\r\n\t\t\t\"}\"\r\n\r\n\t\t].join(\"\\n\"),\r\n\r\n\t\tfragmentShader: [\r\n\r\n\t\t\t\"uniform samplerCube tCube;\",\r\n\t\t\t\"uniform float tFlip;\",\r\n\r\n\t\t\t\"varying vec3 vWorldPosition;\",\r\n\r\n\t\t\tTHREE.ShaderChunk[ \"common\" ],\r\n\t\t\tTHREE.ShaderChunk[ \"logdepthbuf_pars_fragment\" ],\r\n\r\n\t\t\t\"void main() {\",\r\n\r\n\t\t\t\"\tgl_FragColor = textureCube( tCube, vec3( tFlip * vWorldPosition.x, vWorldPosition.yz ) );\",\r\n\r\n\t\t\t\tTHREE.ShaderChunk[ \"logdepthbuf_fragment\" ],\r\n\r\n\t\t\t\"}\"\r\n\r\n\t\t].join(\"\\n\")\r\n\r\n\t},\r\n\r\n\t/* -------------------------------------------------------------------------\r\n\t//\tCube map shader\r\n\t ------------------------------------------------------------------------- */\r\n\r\n\t'equirect': {\r\n\r\n\t\tuniforms: { \"tEquirect\": { type: \"t\", value: null },\r\n\t\t\t\t\t\"tFlip\": { type: \"f\", value: - 1 } },\r\n\r\n\t\tvertexShader: [\r\n\r\n\t\t\t\"varying vec3 vWorldPosition;\",\r\n\r\n\t\t\tTHREE.ShaderChunk[ \"common\" ],\r\n\t\t\tTHREE.ShaderChunk[ \"logdepthbuf_pars_vertex\" ],\r\n\r\n\t\t\t\"void main() {\",\r\n\r\n\t\t\t\"\tvWorldPosition = transformDirection( position, modelMatrix );\",\r\n\r\n\t\t\t\"\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\",\r\n\r\n\t\t\t\tTHREE.ShaderChunk[ \"logdepthbuf_vertex\" ],\r\n\r\n\t\t\t\"}\"\r\n\r\n\t\t].join(\"\\n\"),\r\n\r\n\t\tfragmentShader: [\r\n\r\n\t\t\t\"uniform sampler2D tEquirect;\",\r\n\t\t\t\"uniform float tFlip;\",\r\n\r\n\t\t\t\"varying vec3 vWorldPosition;\",\r\n\r\n\t\t\tTHREE.ShaderChunk[ \"common\" ],\r\n\t\t\tTHREE.ShaderChunk[ \"logdepthbuf_pars_fragment\" ],\r\n\r\n\t\t\t\"void main() {\",\r\n\r\n\t\t\t\t// \"\tgl_FragColor = textureCube( tCube, vec3( tFlip * vWorldPosition.x, vWorldPosition.yz ) );\",\r\n\t\t\t\t\"vec3 direction = normalize( vWorldPosition );\",\r\n\t\t\t\t\"vec2 sampleUV;\",\r\n\t\t\t\t\"sampleUV.y = saturate( tFlip * direction.y * -0.5 + 0.5 );\",\r\n\t\t\t\t\"sampleUV.x = atan( direction.z, direction.x ) * RECIPROCAL_PI2 + 0.5;\",\r\n\t\t\t\t\"gl_FragColor = texture2D( tEquirect, sampleUV );\",\r\n\r\n\t\t\t\tTHREE.ShaderChunk[ \"logdepthbuf_fragment\" ],\r\n\r\n\t\t\t\"}\"\r\n\r\n\t\t].join(\"\\n\")\r\n\r\n\t},\r\n\r\n\t/* Depth encoding into RGBA texture\r\n\t *\r\n\t * based on SpiderGL shadow map example\r\n\t * http://spidergl.org/example.php?id=6\r\n\t *\r\n\t * originally from\r\n\t * http://www.gamedev.net/topic/442138-packing-a-float-into-a-a8r8g8b8-texture-shader/page__whichpage__1%25EF%25BF%25BD\r\n\t *\r\n\t * see also\r\n\t * http://aras-p.info/blog/2009/07/30/encoding-floats-to-rgba-the-final/\r\n\t */\r\n\r\n\t'depthRGBA': {\r\n\r\n\t\tuniforms: {},\r\n\r\n\t\tvertexShader: [\r\n\r\n\t\t\tTHREE.ShaderChunk[ \"common\" ],\r\n\t\t\tTHREE.ShaderChunk[ \"morphtarget_pars_vertex\" ],\r\n\t\t\tTHREE.ShaderChunk[ \"skinning_pars_vertex\" ],\r\n\t\t\tTHREE.ShaderChunk[ \"logdepthbuf_pars_vertex\" ],\r\n\r\n\t\t\t\"void main() {\",\r\n\r\n\t\t\t\tTHREE.ShaderChunk[ \"skinbase_vertex\" ],\r\n\t\t\t\tTHREE.ShaderChunk[ \"morphtarget_vertex\" ],\r\n\t\t\t\tTHREE.ShaderChunk[ \"skinning_vertex\" ],\r\n\t\t\t\tTHREE.ShaderChunk[ \"default_vertex\" ],\r\n\t\t\t\tTHREE.ShaderChunk[ \"logdepthbuf_vertex\" ],\r\n\r\n\t\t\t\"}\"\r\n\r\n\t\t].join(\"\\n\"),\r\n\r\n\t\tfragmentShader: [\r\n\r\n\t\t\tTHREE.ShaderChunk[ \"common\" ],\r\n\t\t\tTHREE.ShaderChunk[ \"logdepthbuf_pars_fragment\" ],\r\n\r\n\t\t\t\"vec4 pack_depth( const in float depth ) {\",\r\n\r\n\t\t\t\"\tconst vec4 bit_shift = vec4( 256.0 * 256.0 * 256.0, 256.0 * 256.0, 256.0, 1.0 );\",\r\n\t\t\t\"\tconst vec4 bit_mask = vec4( 0.0, 1.0 / 256.0, 1.0 / 256.0, 1.0 / 256.0 );\",\r\n\t\t\t\"\tvec4 res = mod( depth * bit_shift * vec4( 255 ), vec4( 256 ) ) / vec4( 255 );\", // \"\tvec4 res = fract( depth * bit_shift );\",\r\n\t\t\t\"\tres -= res.xxyz * bit_mask;\",\r\n\t\t\t\"\treturn res;\",\r\n\r\n\t\t\t\"}\",\r\n\r\n\t\t\t\"void main() {\",\r\n\r\n\t\t\t\tTHREE.ShaderChunk[ \"logdepthbuf_fragment\" ],\r\n\r\n\t\t\t\"\t#ifdef USE_LOGDEPTHBUF_EXT\",\r\n\r\n\t\t\t\"\t\tgl_FragData[ 0 ] = pack_depth( gl_FragDepthEXT );\",\r\n\r\n\t\t\t\"\t#else\",\r\n\r\n\t\t\t\"\t\tgl_FragData[ 0 ] = pack_depth( gl_FragCoord.z );\",\r\n\r\n\t\t\t\"\t#endif\",\r\n\r\n\t\t\t\t//\"gl_FragData[ 0 ] = pack_depth( gl_FragCoord.z / gl_FragCoord.w );\",\r\n\t\t\t\t//\"float z = ( ( gl_FragCoord.z / gl_FragCoord.w ) - 3.0 ) / ( 4000.0 - 3.0 );\",\r\n\t\t\t\t//\"gl_FragData[ 0 ] = pack_depth( z );\",\r\n\t\t\t\t//\"gl_FragData[ 0 ] = vec4( z, z, z, 1.0 );\",\r\n\r\n\t\t\t\"}\"\r\n\r\n\t\t].join(\"\\n\")\r\n\r\n\t}\r\n\r\n};\r\n\r\n// File:src/renderers/WebGLRenderer.js\r\n\r\n/**\r\n * @author supereggbert / http://www.paulbrunt.co.uk/\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author alteredq / http://alteredqualia.com/\r\n * @author szimek / https://github.com/szimek/\r\n */\r\n\r\nTHREE.WebGLRenderer = function ( parameters ) {\r\n\r\n\tconsole.log( 'THREE.WebGLRenderer', THREE.REVISION );\r\n\r\n\tparameters = parameters || {};\r\n\r\n\tvar _canvas = parameters.canvas !== undefined ? parameters.canvas : document.createElement( 'canvas' ),\r\n\t_context = parameters.context !== undefined ? parameters.context : null,\r\n\r\n\tpixelRatio = 1,\r\n\r\n\t_precision = parameters.precision !== undefined ? parameters.precision : 'highp',\r\n\r\n\t_alpha = parameters.alpha !== undefined ? parameters.alpha : false,\r\n\t_depth = parameters.depth !== undefined ? parameters.depth : true,\r\n\t_stencil = parameters.stencil !== undefined ? parameters.stencil : true,\r\n\t_antialias = parameters.antialias !== undefined ? parameters.antialias : false,\r\n\t_premultipliedAlpha = parameters.premultipliedAlpha !== undefined ? parameters.premultipliedAlpha : true,\r\n\t_preserveDrawingBuffer = parameters.preserveDrawingBuffer !== undefined ? parameters.preserveDrawingBuffer : false,\r\n\t_logarithmicDepthBuffer = parameters.logarithmicDepthBuffer !== undefined ? parameters.logarithmicDepthBuffer : false,\r\n\r\n\t_clearColor = new THREE.Color( 0x000000 ),\r\n\t_clearAlpha = 0;\r\n\r\n\tvar lights = [];\r\n\r\n\tvar _webglObjects = {};\r\n\tvar _webglObjectsImmediate = [];\r\n\r\n\tvar opaqueObjects = [];\r\n\tvar transparentObjects = [];\r\n\r\n\tvar sprites = [];\r\n\tvar lensFlares = [];\r\n\r\n\t// public properties\r\n\r\n\tthis.domElement = _canvas;\r\n\tthis.context = null;\r\n\r\n\t// clearing\r\n\r\n\tthis.autoClear = true;\r\n\tthis.autoClearColor = true;\r\n\tthis.autoClearDepth = true;\r\n\tthis.autoClearStencil = true;\r\n\r\n\t// scene graph\r\n\r\n\tthis.sortObjects = true;\r\n\r\n\t// physically based shading\r\n\r\n\tthis.gammaFactor = 2.0;\t// for backwards compatibility\r\n\tthis.gammaInput = false;\r\n\tthis.gammaOutput = false;\r\n\r\n\t// shadow map\r\n\r\n\tthis.shadowMapEnabled = false;\r\n\tthis.shadowMapType = THREE.PCFShadowMap;\r\n\tthis.shadowMapCullFace = THREE.CullFaceFront;\r\n\tthis.shadowMapDebug = false;\r\n\tthis.shadowMapCascade = false;\r\n\r\n\t// morphs\r\n\r\n\tthis.maxMorphTargets = 8;\r\n\tthis.maxMorphNormals = 4;\r\n\r\n\t// flags\r\n\r\n\tthis.autoScaleCubemaps = true;\r\n\r\n\t// info\r\n\r\n\tthis.info = {\r\n\r\n\t\tmemory: {\r\n\r\n\t\t\tprograms: 0,\r\n\t\t\tgeometries: 0,\r\n\t\t\ttextures: 0\r\n\r\n\t\t},\r\n\r\n\t\trender: {\r\n\r\n\t\t\tcalls: 0,\r\n\t\t\tvertices: 0,\r\n\t\t\tfaces: 0,\r\n\t\t\tpoints: 0\r\n\r\n\t\t}\r\n\r\n\t};\r\n\r\n\t// internal properties\r\n\r\n\tvar _this = this,\r\n\r\n\t_programs = [],\r\n\r\n\t// internal state cache\r\n\r\n\t_currentProgram = null,\r\n\t_currentFramebuffer = null,\r\n\t_currentMaterialId = - 1,\r\n\t_currentGeometryProgram = '',\r\n\t_currentCamera = null,\r\n\r\n\t_usedTextureUnits = 0,\r\n\r\n\t_viewportX = 0,\r\n\t_viewportY = 0,\r\n\t_viewportWidth = _canvas.width,\r\n\t_viewportHeight = _canvas.height,\r\n\t_currentWidth = 0,\r\n\t_currentHeight = 0,\r\n\r\n\t// frustum\r\n\r\n\t_frustum = new THREE.Frustum(),\r\n\r\n\t // camera matrices cache\r\n\r\n\t_projScreenMatrix = new THREE.Matrix4(),\r\n\r\n\t_vector3 = new THREE.Vector3(),\r\n\r\n\t// light arrays cache\r\n\r\n\t_direction = new THREE.Vector3(),\r\n\r\n\t_lightsNeedUpdate = true,\r\n\r\n\t_lights = {\r\n\r\n\t\tambient: [ 0, 0, 0 ],\r\n\t\tdirectional: { length: 0, colors:[], positions: [] },\r\n\t\tpoint: { length: 0, colors: [], positions: [], distances: [], decays: [] },\r\n\t\tspot: { length: 0, colors: [], positions: [], distances: [], directions: [], anglesCos: [], exponents: [], decays: [] },\r\n\t\themi: { length: 0, skyColors: [], groundColors: [], positions: [] }\r\n\r\n\t};\r\n\r\n\t// initialize\r\n\r\n\tvar _gl;\r\n\r\n\ttry {\r\n\r\n\t\tvar attributes = {\r\n\t\t\talpha: _alpha,\r\n\t\t\tdepth: _depth,\r\n\t\t\tstencil: _stencil,\r\n\t\t\tantialias: _antialias,\r\n\t\t\tpremultipliedAlpha: _premultipliedAlpha,\r\n\t\t\tpreserveDrawingBuffer: _preserveDrawingBuffer\r\n\t\t};\r\n\r\n\t\t_gl = _context || _canvas.getContext( 'webgl', attributes ) || _canvas.getContext( 'experimental-webgl', attributes );\r\n\r\n\t\tif ( _gl === null ) {\r\n\r\n\t\t\tif ( _canvas.getContext( 'webgl') !== null ) {\r\n\r\n\t\t\t\tthrow 'Error creating WebGL context with your selected attributes.';\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tthrow 'Error creating WebGL context.';\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\t_canvas.addEventListener( 'webglcontextlost', function ( event ) {\r\n\r\n\t\t\tevent.preventDefault();\r\n\r\n\t\t\tresetGLState();\r\n\t\t\tsetDefaultGLState();\r\n\r\n\t\t\t_webglObjects = {};\r\n\r\n\t\t}, false);\r\n\r\n\t} catch ( error ) {\r\n\r\n\t\tTHREE.error( 'THREE.WebGLRenderer: ' + error );\r\n\r\n\t}\r\n\r\n\tvar state = new THREE.WebGLState( _gl, paramThreeToGL );\r\n\r\n\tif ( _gl.getShaderPrecisionFormat === undefined ) {\r\n\r\n\t\t_gl.getShaderPrecisionFormat = function () {\r\n\r\n\t\t\treturn {\r\n\t\t\t\t'rangeMin': 1,\r\n\t\t\t\t'rangeMax': 1,\r\n\t\t\t\t'precision': 1\r\n\t\t\t};\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tvar extensions = new THREE.WebGLExtensions( _gl );\r\n\r\n\textensions.get( 'OES_texture_float' );\r\n\textensions.get( 'OES_texture_float_linear' );\r\n\textensions.get( 'OES_texture_half_float' );\r\n\textensions.get( 'OES_texture_half_float_linear' );\r\n\textensions.get( 'OES_standard_derivatives' );\r\n\r\n\tif ( _logarithmicDepthBuffer ) {\r\n\r\n\t\textensions.get( 'EXT_frag_depth' );\r\n\r\n\t}\r\n\r\n\t//\r\n\r\n\tvar glClearColor = function ( r, g, b, a ) {\r\n\r\n\t\tif ( _premultipliedAlpha === true ) {\r\n\r\n\t\t\tr *= a; g *= a; b *= a;\r\n\r\n\t\t}\r\n\r\n\t\t_gl.clearColor( r, g, b, a );\r\n\r\n\t};\r\n\r\n\tvar setDefaultGLState = function () {\r\n\r\n\t\t_gl.clearColor( 0, 0, 0, 1 );\r\n\t\t_gl.clearDepth( 1 );\r\n\t\t_gl.clearStencil( 0 );\r\n\r\n\t\t_gl.enable( _gl.DEPTH_TEST );\r\n\t\t_gl.depthFunc( _gl.LEQUAL );\r\n\r\n\t\t_gl.frontFace( _gl.CCW );\r\n\t\t_gl.cullFace( _gl.BACK );\r\n\t\t_gl.enable( _gl.CULL_FACE );\r\n\r\n\t\t_gl.enable( _gl.BLEND );\r\n\t\t_gl.blendEquation( _gl.FUNC_ADD );\r\n\t\t_gl.blendFunc( _gl.SRC_ALPHA, _gl.ONE_MINUS_SRC_ALPHA );\r\n\r\n\t\t_gl.viewport( _viewportX, _viewportY, _viewportWidth, _viewportHeight );\r\n\r\n\t\tglClearColor( _clearColor.r, _clearColor.g, _clearColor.b, _clearAlpha );\r\n\r\n\t};\r\n\r\n\tvar resetGLState = function () {\r\n\r\n\t\t_currentProgram = null;\r\n\t\t_currentCamera = null;\r\n\r\n\t\t_currentGeometryProgram = '';\r\n\t\t_currentMaterialId = - 1;\r\n\r\n\t\t_lightsNeedUpdate = true;\r\n\r\n\t\tstate.reset();\r\n\r\n\t};\r\n\r\n\tsetDefaultGLState();\r\n\r\n\tthis.context = _gl;\r\n\tthis.state = state;\r\n\r\n\t// GPU capabilities\r\n\r\n\tvar _maxTextures = _gl.getParameter( _gl.MAX_TEXTURE_IMAGE_UNITS );\r\n\tvar _maxVertexTextures = _gl.getParameter( _gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS );\r\n\tvar _maxTextureSize = _gl.getParameter( _gl.MAX_TEXTURE_SIZE );\r\n\tvar _maxCubemapSize = _gl.getParameter( _gl.MAX_CUBE_MAP_TEXTURE_SIZE );\r\n\r\n\tvar _supportsVertexTextures = _maxVertexTextures > 0;\r\n\tvar _supportsBoneTextures = _supportsVertexTextures && extensions.get( 'OES_texture_float' );\r\n\r\n\t//\r\n\r\n\tvar _vertexShaderPrecisionHighpFloat = _gl.getShaderPrecisionFormat( _gl.VERTEX_SHADER, _gl.HIGH_FLOAT );\r\n\tvar _vertexShaderPrecisionMediumpFloat = _gl.getShaderPrecisionFormat( _gl.VERTEX_SHADER, _gl.MEDIUM_FLOAT );\r\n\r\n\tvar _fragmentShaderPrecisionHighpFloat = _gl.getShaderPrecisionFormat( _gl.FRAGMENT_SHADER, _gl.HIGH_FLOAT );\r\n\tvar _fragmentShaderPrecisionMediumpFloat = _gl.getShaderPrecisionFormat( _gl.FRAGMENT_SHADER, _gl.MEDIUM_FLOAT );\r\n\r\n\tvar getCompressedTextureFormats = ( function () {\r\n\r\n\t\tvar array;\r\n\r\n\t\treturn function () {\r\n\r\n\t\t\tif ( array !== undefined ) {\r\n\r\n\t\t\t\treturn array;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tarray = [];\r\n\r\n\t\t\tif ( extensions.get( 'WEBGL_compressed_texture_pvrtc' ) || extensions.get( 'WEBGL_compressed_texture_s3tc' ) ) {\r\n\r\n\t\t\t\tvar formats = _gl.getParameter( _gl.COMPRESSED_TEXTURE_FORMATS );\r\n\r\n\t\t\t\tfor ( var i = 0; i < formats.length; i ++ ) {\r\n\r\n\t\t\t\t\tarray.push( formats[ i ] );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn array;\r\n\r\n\t\t};\r\n\r\n\t} )();\r\n\r\n\t// clamp precision to maximum available\r\n\r\n\tvar highpAvailable = _vertexShaderPrecisionHighpFloat.precision > 0 && _fragmentShaderPrecisionHighpFloat.precision > 0;\r\n\tvar mediumpAvailable = _vertexShaderPrecisionMediumpFloat.precision > 0 && _fragmentShaderPrecisionMediumpFloat.precision > 0;\r\n\r\n\tif ( _precision === 'highp' && ! highpAvailable ) {\r\n\r\n\t\tif ( mediumpAvailable ) {\r\n\r\n\t\t\t_precision = 'mediump';\r\n\t\t\tTHREE.warn( 'THREE.WebGLRenderer: highp not supported, using mediump.' );\r\n\r\n\t\t} else {\r\n\r\n\t\t\t_precision = 'lowp';\r\n\t\t\tTHREE.warn( 'THREE.WebGLRenderer: highp and mediump not supported, using lowp.' );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tif ( _precision === 'mediump' && ! mediumpAvailable ) {\r\n\r\n\t\t_precision = 'lowp';\r\n\t\tTHREE.warn( 'THREE.WebGLRenderer: mediump not supported, using lowp.' );\r\n\r\n\t}\r\n\r\n\t// Plugins\r\n\r\n\tvar shadowMapPlugin = new THREE.ShadowMapPlugin( this, lights, _webglObjects, _webglObjectsImmediate );\r\n\r\n\tvar spritePlugin = new THREE.SpritePlugin( this, sprites );\r\n\tvar lensFlarePlugin = new THREE.LensFlarePlugin( this, lensFlares );\r\n\r\n\t// API\r\n\r\n\tthis.getContext = function () {\r\n\r\n\t\treturn _gl;\r\n\r\n\t};\r\n\r\n\tthis.forceContextLoss = function () {\r\n\r\n\t\textensions.get( 'WEBGL_lose_context' ).loseContext();\r\n\r\n\t};\r\n\r\n\tthis.supportsVertexTextures = function () {\r\n\r\n\t\treturn _supportsVertexTextures;\r\n\r\n\t};\r\n\r\n\tthis.supportsFloatTextures = function () {\r\n\r\n\t\treturn extensions.get( 'OES_texture_float' );\r\n\r\n\t};\r\n\r\n\tthis.supportsHalfFloatTextures = function () {\r\n\r\n\t\treturn extensions.get( 'OES_texture_half_float' );\r\n\r\n\t};\r\n\r\n\tthis.supportsStandardDerivatives = function () {\r\n\r\n\t\treturn extensions.get( 'OES_standard_derivatives' );\r\n\r\n\t};\r\n\r\n\tthis.supportsCompressedTextureS3TC = function () {\r\n\r\n\t\treturn extensions.get( 'WEBGL_compressed_texture_s3tc' );\r\n\r\n\t};\r\n\r\n\tthis.supportsCompressedTexturePVRTC = function () {\r\n\r\n\t\treturn extensions.get( 'WEBGL_compressed_texture_pvrtc' );\r\n\r\n\t};\r\n\r\n\tthis.supportsBlendMinMax = function () {\r\n\r\n\t\treturn extensions.get( 'EXT_blend_minmax' );\r\n\r\n\t};\r\n\r\n\tthis.getMaxAnisotropy = ( function () {\r\n\r\n\t\tvar value;\r\n\r\n\t\treturn function () {\r\n\r\n\t\t\tif ( value !== undefined ) {\r\n\r\n\t\t\t\treturn value;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tvar extension = extensions.get( 'EXT_texture_filter_anisotropic' );\r\n\r\n\t\t\tvalue = extension !== null ? _gl.getParameter( extension.MAX_TEXTURE_MAX_ANISOTROPY_EXT ) : 0;\r\n\r\n\t\t\treturn value;\r\n\r\n\t\t}\r\n\r\n\t} )();\r\n\r\n\tthis.getPrecision = function () {\r\n\r\n\t\treturn _precision;\r\n\r\n\t};\r\n\r\n\tthis.getPixelRatio = function () {\r\n\r\n\t\treturn pixelRatio;\r\n\r\n\t};\r\n\r\n\tthis.setPixelRatio = function ( value ) {\r\n\r\n\t\tpixelRatio = value;\r\n\r\n\t};\r\n\r\n\tthis.setSize = function ( width, height, updateStyle ) {\r\n\r\n\t\t_canvas.width = width * pixelRatio;\r\n\t\t_canvas.height = height * pixelRatio;\r\n\r\n\t\tif ( updateStyle !== false ) {\r\n\r\n\t\t\t_canvas.style.width = width + 'px';\r\n\t\t\t_canvas.style.height = height + 'px';\r\n\r\n\t\t}\r\n\r\n\t\tthis.setViewport( 0, 0, width, height );\r\n\r\n\t};\r\n\r\n\tthis.setViewport = function ( x, y, width, height ) {\r\n\r\n\t\t_viewportX = x * pixelRatio;\r\n\t\t_viewportY = y * pixelRatio;\r\n\r\n\t\t_viewportWidth = width * pixelRatio;\r\n\t\t_viewportHeight = height * pixelRatio;\r\n\r\n\t\t_gl.viewport( _viewportX, _viewportY, _viewportWidth, _viewportHeight );\r\n\r\n\t};\r\n\r\n\tthis.setScissor = function ( x, y, width, height ) {\r\n\r\n\t\t_gl.scissor(\r\n\t\t\tx * pixelRatio,\r\n\t\t\ty * pixelRatio,\r\n\t\t\twidth * pixelRatio,\r\n\t\t\theight * pixelRatio\r\n\t\t);\r\n\r\n\t};\r\n\r\n\tthis.enableScissorTest = function ( enable ) {\r\n\r\n\t\tenable ? _gl.enable( _gl.SCISSOR_TEST ) : _gl.disable( _gl.SCISSOR_TEST );\r\n\r\n\t};\r\n\r\n\t// Clearing\r\n\r\n\tthis.getClearColor = function () {\r\n\r\n\t\treturn _clearColor;\r\n\r\n\t};\r\n\r\n\tthis.setClearColor = function ( color, alpha ) {\r\n\r\n\t\t_clearColor.set( color );\r\n\r\n\t\t_clearAlpha = alpha !== undefined ? alpha : 1;\r\n\r\n\t\tglClearColor( _clearColor.r, _clearColor.g, _clearColor.b, _clearAlpha );\r\n\r\n\t};\r\n\r\n\tthis.getClearAlpha = function () {\r\n\r\n\t\treturn _clearAlpha;\r\n\r\n\t};\r\n\r\n\tthis.setClearAlpha = function ( alpha ) {\r\n\r\n\t\t_clearAlpha = alpha;\r\n\r\n\t\tglClearColor( _clearColor.r, _clearColor.g, _clearColor.b, _clearAlpha );\r\n\r\n\t};\r\n\r\n\tthis.clear = function ( color, depth, stencil ) {\r\n\r\n\t\tvar bits = 0;\r\n\r\n\t\tif ( color === undefined || color ) bits |= _gl.COLOR_BUFFER_BIT;\r\n\t\tif ( depth === undefined || depth ) bits |= _gl.DEPTH_BUFFER_BIT;\r\n\t\tif ( stencil === undefined || stencil ) bits |= _gl.STENCIL_BUFFER_BIT;\r\n\r\n\t\t_gl.clear( bits );\r\n\r\n\t};\r\n\r\n\tthis.clearColor = function () {\r\n\r\n\t\t_gl.clear( _gl.COLOR_BUFFER_BIT );\r\n\r\n\t};\r\n\r\n\tthis.clearDepth = function () {\r\n\r\n\t\t_gl.clear( _gl.DEPTH_BUFFER_BIT );\r\n\r\n\t};\r\n\r\n\tthis.clearStencil = function () {\r\n\r\n\t\t_gl.clear( _gl.STENCIL_BUFFER_BIT );\r\n\r\n\t};\r\n\r\n\tthis.clearTarget = function ( renderTarget, color, depth, stencil ) {\r\n\r\n\t\tthis.setRenderTarget( renderTarget );\r\n\t\tthis.clear( color, depth, stencil );\r\n\r\n\t};\r\n\r\n\t// Reset\r\n\r\n\tthis.resetGLState = resetGLState;\r\n\r\n\t// Buffer allocation\r\n\r\n\tfunction createParticleBuffers ( geometry ) {\r\n\r\n\t\tgeometry.__webglVertexBuffer = _gl.createBuffer();\r\n\t\tgeometry.__webglColorBuffer = _gl.createBuffer();\r\n\r\n\t\t_this.info.memory.geometries ++;\r\n\r\n\t};\r\n\r\n\tfunction createLineBuffers ( geometry ) {\r\n\r\n\t\tgeometry.__webglVertexBuffer = _gl.createBuffer();\r\n\t\tgeometry.__webglColorBuffer = _gl.createBuffer();\r\n\t\tgeometry.__webglLineDistanceBuffer = _gl.createBuffer();\r\n\r\n\t\t_this.info.memory.geometries ++;\r\n\r\n\t};\r\n\r\n\tfunction createMeshBuffers ( geometryGroup ) {\r\n\r\n\t\tgeometryGroup.__webglVertexBuffer = _gl.createBuffer();\r\n\t\tgeometryGroup.__webglNormalBuffer = _gl.createBuffer();\r\n\t\tgeometryGroup.__webglTangentBuffer = _gl.createBuffer();\r\n\t\tgeometryGroup.__webglColorBuffer = _gl.createBuffer();\r\n\t\tgeometryGroup.__webglUVBuffer = _gl.createBuffer();\r\n\t\tgeometryGroup.__webglUV2Buffer = _gl.createBuffer();\r\n\r\n\t\tgeometryGroup.__webglSkinIndicesBuffer = _gl.createBuffer();\r\n\t\tgeometryGroup.__webglSkinWeightsBuffer = _gl.createBuffer();\r\n\r\n\t\tgeometryGroup.__webglFaceBuffer = _gl.createBuffer();\r\n\t\tgeometryGroup.__webglLineBuffer = _gl.createBuffer();\r\n\r\n\t\tvar numMorphTargets = geometryGroup.numMorphTargets;\r\n\r\n\t\tif ( numMorphTargets ) {\r\n\r\n\t\t\tgeometryGroup.__webglMorphTargetsBuffers = [];\r\n\r\n\t\t\tfor ( var m = 0, ml = numMorphTargets; m < ml; m ++ ) {\r\n\r\n\t\t\t\tgeometryGroup.__webglMorphTargetsBuffers.push( _gl.createBuffer() );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tvar numMorphNormals = geometryGroup.numMorphNormals;\r\n\r\n\t\tif ( numMorphNormals ) {\r\n\r\n\t\t\tgeometryGroup.__webglMorphNormalsBuffers = [];\r\n\r\n\t\t\tfor ( var m = 0, ml = numMorphNormals; m < ml; m ++ ) {\r\n\r\n\t\t\t\tgeometryGroup.__webglMorphNormalsBuffers.push( _gl.createBuffer() );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\t_this.info.memory.geometries ++;\r\n\r\n\t};\r\n\r\n\t// Events\r\n\r\n\tvar onObjectRemoved = function ( event ) {\r\n\r\n\t\tvar object = event.target;\r\n\r\n\t\tobject.traverse( function ( child ) {\r\n\r\n\t\t\tchild.removeEventListener( 'remove', onObjectRemoved );\r\n\r\n\t\t\tremoveObject( child );\r\n\r\n\t\t} );\r\n\r\n\t};\r\n\r\n\tvar onGeometryDispose = function ( event ) {\r\n\r\n\t\tvar geometry = event.target;\r\n\r\n\t\tgeometry.removeEventListener( 'dispose', onGeometryDispose );\r\n\r\n\t\tdeallocateGeometry( geometry );\r\n\r\n\t};\r\n\r\n\tvar onTextureDispose = function ( event ) {\r\n\r\n\t\tvar texture = event.target;\r\n\r\n\t\ttexture.removeEventListener( 'dispose', onTextureDispose );\r\n\r\n\t\tdeallocateTexture( texture );\r\n\r\n\t\t_this.info.memory.textures --;\r\n\r\n\r\n\t};\r\n\r\n\tvar onRenderTargetDispose = function ( event ) {\r\n\r\n\t\tvar renderTarget = event.target;\r\n\r\n\t\trenderTarget.removeEventListener( 'dispose', onRenderTargetDispose );\r\n\r\n\t\tdeallocateRenderTarget( renderTarget );\r\n\r\n\t\t_this.info.memory.textures --;\r\n\r\n\t};\r\n\r\n\tvar onMaterialDispose = function ( event ) {\r\n\r\n\t\tvar material = event.target;\r\n\r\n\t\tmaterial.removeEventListener( 'dispose', onMaterialDispose );\r\n\r\n\t\tdeallocateMaterial( material );\r\n\r\n\t};\r\n\r\n\t// Buffer deallocation\r\n\r\n\tvar deleteBuffers = function ( geometry ) {\r\n\r\n\t\tvar buffers = [\r\n\t\t\t'__webglVertexBuffer',\r\n\t\t\t'__webglNormalBuffer',\r\n\t\t\t'__webglTangentBuffer',\r\n\t\t\t'__webglColorBuffer',\r\n\t\t\t'__webglUVBuffer',\r\n\t\t\t'__webglUV2Buffer',\r\n\r\n\t\t\t'__webglSkinIndicesBuffer',\r\n\t\t\t'__webglSkinWeightsBuffer',\r\n\r\n\t\t\t'__webglFaceBuffer',\r\n\t\t\t'__webglLineBuffer',\r\n\r\n\t\t\t'__webglLineDistanceBuffer'\r\n\t\t];\r\n\r\n\t\tfor ( var i = 0, l = buffers.length; i < l; i ++ ) {\r\n\r\n\t\t\tvar name = buffers[ i ];\r\n\r\n\t\t\tif ( geometry[ name ] !== undefined ) {\r\n\r\n\t\t\t\t_gl.deleteBuffer( geometry[ name ] );\r\n\r\n\t\t\t\tdelete geometry[ name ];\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\t// custom attributes\r\n\r\n\t\tif ( geometry.__webglCustomAttributesList !== undefined ) {\r\n\r\n\t\t\tfor ( var name in geometry.__webglCustomAttributesList ) {\r\n\r\n\t\t\t\t_gl.deleteBuffer( geometry.__webglCustomAttributesList[ name ].buffer );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tdelete geometry.__webglCustomAttributesList;\r\n\r\n\t\t}\r\n\r\n\t\t_this.info.memory.geometries --;\r\n\r\n\t};\r\n\r\n\tvar deallocateGeometry = function ( geometry ) {\r\n\r\n\t\tdelete geometry.__webglInit;\r\n\r\n\t\tif ( geometry instanceof THREE.BufferGeometry ) {\r\n\r\n\t\t\tfor ( var name in geometry.attributes ) {\r\n\r\n\t\t\t\tvar attribute = geometry.attributes[ name ];\r\n\r\n\t\t\t\tif ( attribute.buffer !== undefined ) {\r\n\r\n\t\t\t\t\t_gl.deleteBuffer( attribute.buffer );\r\n\r\n\t\t\t\t\tdelete attribute.buffer;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\t_this.info.memory.geometries --;\r\n\r\n\t\t} else {\r\n\r\n\t\t\tvar geometryGroupsList = geometryGroups[ geometry.id ];\r\n\r\n\t\t\tif ( geometryGroupsList !== undefined ) {\r\n\r\n\t\t\t\tfor ( var i = 0, l = geometryGroupsList.length; i < l; i ++ ) {\r\n\r\n\t\t\t\t\tvar geometryGroup = geometryGroupsList[ i ];\r\n\r\n\t\t\t\t\tif ( geometryGroup.numMorphTargets !== undefined ) {\r\n\r\n\t\t\t\t\t\tfor ( var m = 0, ml = geometryGroup.numMorphTargets; m < ml; m ++ ) {\r\n\r\n\t\t\t\t\t\t\t_gl.deleteBuffer( geometryGroup.__webglMorphTargetsBuffers[ m ] );\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tdelete geometryGroup.__webglMorphTargetsBuffers;\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif ( geometryGroup.numMorphNormals !== undefined ) {\r\n\r\n\t\t\t\t\t\tfor ( var m = 0, ml = geometryGroup.numMorphNormals; m < ml; m ++ ) {\r\n\r\n\t\t\t\t\t\t\t_gl.deleteBuffer( geometryGroup.__webglMorphNormalsBuffers[ m ] );\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tdelete geometryGroup.__webglMorphNormalsBuffers;\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tdeleteBuffers( geometryGroup );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tdelete geometryGroups[ geometry.id ];\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tdeleteBuffers( geometry );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\t// TOFIX: Workaround for deleted geometry being currently bound\r\n\r\n\t\t_currentGeometryProgram = '';\r\n\r\n\t};\r\n\r\n\tvar deallocateTexture = function ( texture ) {\r\n\r\n\t\tif ( texture.image && texture.image.__webglTextureCube ) {\r\n\r\n\t\t\t// cube texture\r\n\r\n\t\t\t_gl.deleteTexture( texture.image.__webglTextureCube );\r\n\r\n\t\t\tdelete texture.image.__webglTextureCube;\r\n\r\n\t\t} else {\r\n\r\n\t\t\t// 2D texture\r\n\r\n\t\t\tif ( texture.__webglInit === undefined ) return;\r\n\r\n\t\t\t_gl.deleteTexture( texture.__webglTexture );\r\n\r\n\t\t\tdelete texture.__webglTexture;\r\n\t\t\tdelete texture.__webglInit;\r\n\r\n\t\t}\r\n\r\n\t};\r\n\r\n\tvar deallocateRenderTarget = function ( renderTarget ) {\r\n\r\n\t\tif ( ! renderTarget || renderTarget.__webglTexture === undefined ) return;\r\n\r\n\t\t_gl.deleteTexture( renderTarget.__webglTexture );\r\n\r\n\t\tdelete renderTarget.__webglTexture;\r\n\r\n\t\tif ( renderTarget instanceof THREE.WebGLRenderTargetCube ) {\r\n\r\n\t\t\tfor ( var i = 0; i < 6; i ++ ) {\r\n\r\n\t\t\t\t_gl.deleteFramebuffer( renderTarget.__webglFramebuffer[ i ] );\r\n\t\t\t\t_gl.deleteRenderbuffer( renderTarget.__webglRenderbuffer[ i ] );\r\n\r\n\t\t\t}\r\n\r\n\t\t} else {\r\n\r\n\t\t\t_gl.deleteFramebuffer( renderTarget.__webglFramebuffer );\r\n\t\t\t_gl.deleteRenderbuffer( renderTarget.__webglRenderbuffer );\r\n\r\n\t\t}\r\n\r\n\t\tdelete renderTarget.__webglFramebuffer;\r\n\t\tdelete renderTarget.__webglRenderbuffer;\r\n\r\n\t};\r\n\r\n\tvar deallocateMaterial = function ( material ) {\r\n\r\n\t\tvar program = material.program.program;\r\n\r\n\t\tif ( program === undefined ) return;\r\n\r\n\t\tmaterial.program = undefined;\r\n\r\n\t\t// only deallocate GL program if this was the last use of shared program\r\n\t\t// assumed there is only single copy of any program in the _programs list\r\n\t\t// (that's how it's constructed)\r\n\r\n\t\tvar i, il, programInfo;\r\n\t\tvar deleteProgram = false;\r\n\r\n\t\tfor ( i = 0, il = _programs.length; i < il; i ++ ) {\r\n\r\n\t\t\tprogramInfo = _programs[ i ];\r\n\r\n\t\t\tif ( programInfo.program === program ) {\r\n\r\n\t\t\t\tprogramInfo.usedTimes --;\r\n\r\n\t\t\t\tif ( programInfo.usedTimes === 0 ) {\r\n\r\n\t\t\t\t\tdeleteProgram = true;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tbreak;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tif ( deleteProgram === true ) {\r\n\r\n\t\t\t// avoid using array.splice, this is costlier than creating new array from scratch\r\n\r\n\t\t\tvar newPrograms = [];\r\n\r\n\t\t\tfor ( i = 0, il = _programs.length; i < il; i ++ ) {\r\n\r\n\t\t\t\tprogramInfo = _programs[ i ];\r\n\r\n\t\t\t\tif ( programInfo.program !== program ) {\r\n\r\n\t\t\t\t\tnewPrograms.push( programInfo );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\t_programs = newPrograms;\r\n\r\n\t\t\t_gl.deleteProgram( program );\r\n\r\n\t\t\t_this.info.memory.programs --;\r\n\r\n\t\t}\r\n\r\n\t};\r\n\r\n\t// Buffer initialization\r\n\r\n\tfunction initCustomAttributes ( object ) {\r\n\r\n\t\tvar geometry = object.geometry;\r\n\t\tvar material = object.material;\r\n\r\n\t\tvar nvertices = geometry.vertices.length;\r\n\r\n\t\tif ( material.attributes ) {\r\n\r\n\t\t\tif ( geometry.__webglCustomAttributesList === undefined ) {\r\n\r\n\t\t\t\tgeometry.__webglCustomAttributesList = [];\r\n\r\n\t\t\t}\r\n\r\n\t\t\tfor ( var name in material.attributes ) {\r\n\r\n\t\t\t\tvar attribute = material.attributes[ name ];\r\n\r\n\t\t\t\tif ( ! attribute.__webglInitialized || attribute.createUniqueBuffers ) {\r\n\r\n\t\t\t\t\tattribute.__webglInitialized = true;\r\n\r\n\t\t\t\t\tvar size = 1;   // \"f\" and \"i\"\r\n\r\n\t\t\t\t\tif ( attribute.type === 'v2' ) size = 2;\r\n\t\t\t\t\telse if ( attribute.type === 'v3' ) size = 3;\r\n\t\t\t\t\telse if ( attribute.type === 'v4' ) size = 4;\r\n\t\t\t\t\telse if ( attribute.type === 'c'  ) size = 3;\r\n\r\n\t\t\t\t\tattribute.size = size;\r\n\r\n\t\t\t\t\tattribute.array = new Float32Array( nvertices * size );\r\n\r\n\t\t\t\t\tattribute.buffer = _gl.createBuffer();\r\n\t\t\t\t\tattribute.buffer.belongsToAttribute = name;\r\n\r\n\t\t\t\t\tattribute.needsUpdate = true;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tgeometry.__webglCustomAttributesList.push( attribute );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t};\r\n\r\n\tfunction initParticleBuffers ( geometry, object ) {\r\n\r\n\t\tvar nvertices = geometry.vertices.length;\r\n\r\n\t\tgeometry.__vertexArray = new Float32Array( nvertices * 3 );\r\n\t\tgeometry.__colorArray = new Float32Array( nvertices * 3 );\r\n\r\n\t\tgeometry.__webglParticleCount = nvertices;\r\n\r\n\t\tinitCustomAttributes( object );\r\n\r\n\t};\r\n\r\n\tfunction initLineBuffers ( geometry, object ) {\r\n\r\n\t\tvar nvertices = geometry.vertices.length;\r\n\r\n\t\tgeometry.__vertexArray = new Float32Array( nvertices * 3 );\r\n\t\tgeometry.__colorArray = new Float32Array( nvertices * 3 );\r\n\t\tgeometry.__lineDistanceArray = new Float32Array( nvertices * 1 );\r\n\r\n\t\tgeometry.__webglLineCount = nvertices;\r\n\r\n\t\tinitCustomAttributes( object );\r\n\r\n\t};\r\n\r\n\tfunction initMeshBuffers ( geometryGroup, object ) {\r\n\r\n\t\tvar geometry = object.geometry,\r\n\t\t\tfaces3 = geometryGroup.faces3,\r\n\r\n\t\t\tnvertices = faces3.length * 3,\r\n\t\t\tntris     = faces3.length * 1,\r\n\t\t\tnlines    = faces3.length * 3,\r\n\r\n\t\t\tmaterial = getBufferMaterial( object, geometryGroup );\r\n\r\n\t\tgeometryGroup.__vertexArray = new Float32Array( nvertices * 3 );\r\n\t\tgeometryGroup.__normalArray = new Float32Array( nvertices * 3 );\r\n\t\tgeometryGroup.__colorArray = new Float32Array( nvertices * 3 );\r\n\t\tgeometryGroup.__uvArray = new Float32Array( nvertices * 2 );\r\n\r\n\t\tif ( geometry.faceVertexUvs.length > 1 ) {\r\n\r\n\t\t\tgeometryGroup.__uv2Array = new Float32Array( nvertices * 2 );\r\n\r\n\t\t}\r\n\r\n\t\tif ( geometry.hasTangents ) {\r\n\r\n\t\t\tgeometryGroup.__tangentArray = new Float32Array( nvertices * 4 );\r\n\r\n\t\t}\r\n\r\n\t\tif ( object.geometry.skinWeights.length && object.geometry.skinIndices.length ) {\r\n\r\n\t\t\tgeometryGroup.__skinIndexArray = new Float32Array( nvertices * 4 );\r\n\t\t\tgeometryGroup.__skinWeightArray = new Float32Array( nvertices * 4 );\r\n\r\n\t\t}\r\n\r\n\t\tvar UintArray = extensions.get( 'OES_element_index_uint' ) !== null && ntris > 21845 ? Uint32Array : Uint16Array; // 65535 / 3\r\n\r\n\t\tgeometryGroup.__typeArray = UintArray;\r\n\t\tgeometryGroup.__faceArray = new UintArray( ntris * 3 );\r\n\t\tgeometryGroup.__lineArray = new UintArray( nlines * 2 );\r\n\r\n\t\tvar numMorphTargets = geometryGroup.numMorphTargets;\r\n\r\n\t\tif ( numMorphTargets ) {\r\n\r\n\t\t\tgeometryGroup.__morphTargetsArrays = [];\r\n\r\n\t\t\tfor ( var m = 0, ml = numMorphTargets; m < ml; m ++ ) {\r\n\r\n\t\t\t\tgeometryGroup.__morphTargetsArrays.push( new Float32Array( nvertices * 3 ) );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tvar numMorphNormals = geometryGroup.numMorphNormals;\r\n\r\n\t\tif ( numMorphNormals ) {\r\n\r\n\t\t\tgeometryGroup.__morphNormalsArrays = [];\r\n\r\n\t\t\tfor ( var m = 0, ml = numMorphNormals; m < ml; m ++ ) {\r\n\r\n\t\t\t\tgeometryGroup.__morphNormalsArrays.push( new Float32Array( nvertices * 3 ) );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tgeometryGroup.__webglFaceCount = ntris * 3;\r\n\t\tgeometryGroup.__webglLineCount = nlines * 2;\r\n\r\n\r\n\t\t// custom attributes\r\n\r\n\t\tif ( material.attributes ) {\r\n\r\n\t\t\tif ( geometryGroup.__webglCustomAttributesList === undefined ) {\r\n\r\n\t\t\t\tgeometryGroup.__webglCustomAttributesList = [];\r\n\r\n\t\t\t}\r\n\r\n\t\t\tfor ( var name in material.attributes ) {\r\n\r\n\t\t\t\t// Do a shallow copy of the attribute object so different geometryGroup chunks use different\r\n\t\t\t\t// attribute buffers which are correctly indexed in the setMeshBuffers function\r\n\r\n\t\t\t\tvar originalAttribute = material.attributes[ name ];\r\n\r\n\t\t\t\tvar attribute = {};\r\n\r\n\t\t\t\tfor ( var property in originalAttribute ) {\r\n\r\n\t\t\t\t\tattribute[ property ] = originalAttribute[ property ];\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( ! attribute.__webglInitialized || attribute.createUniqueBuffers ) {\r\n\r\n\t\t\t\t\tattribute.__webglInitialized = true;\r\n\r\n\t\t\t\t\tvar size = 1;   // \"f\" and \"i\"\r\n\r\n\t\t\t\t\tif ( attribute.type === 'v2' ) size = 2;\r\n\t\t\t\t\telse if ( attribute.type === 'v3' ) size = 3;\r\n\t\t\t\t\telse if ( attribute.type === 'v4' ) size = 4;\r\n\t\t\t\t\telse if ( attribute.type === 'c'  ) size = 3;\r\n\r\n\t\t\t\t\tattribute.size = size;\r\n\r\n\t\t\t\t\tattribute.array = new Float32Array( nvertices * size );\r\n\r\n\t\t\t\t\tattribute.buffer = _gl.createBuffer();\r\n\t\t\t\t\tattribute.buffer.belongsToAttribute = name;\r\n\r\n\t\t\t\t\toriginalAttribute.needsUpdate = true;\r\n\t\t\t\t\tattribute.__original = originalAttribute;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tgeometryGroup.__webglCustomAttributesList.push( attribute );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tgeometryGroup.__inittedArrays = true;\r\n\r\n\t};\r\n\r\n\tfunction getBufferMaterial( object, geometryGroup ) {\r\n\r\n\t\treturn object.material instanceof THREE.MeshFaceMaterial\r\n\t\t\t ? object.material.materials[ geometryGroup.materialIndex ]\r\n\t\t\t : object.material;\r\n\r\n\t}\r\n\r\n\tfunction materialNeedsFaceNormals ( material ) {\r\n\r\n\t\treturn material instanceof THREE.MeshPhongMaterial === false && material.shading === THREE.FlatShading;\r\n\r\n\t}\r\n\r\n\t// Buffer setting\r\n\r\n\tfunction setParticleBuffers ( geometry, hint, object ) {\r\n\r\n\t\tvar v, c, vertex, offset, color,\r\n\r\n\t\tvertices = geometry.vertices,\r\n\t\tvl = vertices.length,\r\n\r\n\t\tcolors = geometry.colors,\r\n\t\tcl = colors.length,\r\n\r\n\t\tvertexArray = geometry.__vertexArray,\r\n\t\tcolorArray = geometry.__colorArray,\r\n\r\n\t\tdirtyVertices = geometry.verticesNeedUpdate,\r\n\t\tdirtyColors = geometry.colorsNeedUpdate,\r\n\r\n\t\tcustomAttributes = geometry.__webglCustomAttributesList,\r\n\t\ti, il,\r\n\t\tca, cal, value,\r\n\t\tcustomAttribute;\r\n\r\n\t\tif ( dirtyVertices ) {\r\n\r\n\t\t\tfor ( v = 0; v < vl; v ++ ) {\r\n\r\n\t\t\t\tvertex = vertices[ v ];\r\n\r\n\t\t\t\toffset = v * 3;\r\n\r\n\t\t\t\tvertexArray[ offset ]     = vertex.x;\r\n\t\t\t\tvertexArray[ offset + 1 ] = vertex.y;\r\n\t\t\t\tvertexArray[ offset + 2 ] = vertex.z;\r\n\r\n\t\t\t}\r\n\r\n\t\t\t_gl.bindBuffer( _gl.ARRAY_BUFFER, geometry.__webglVertexBuffer );\r\n\t\t\t_gl.bufferData( _gl.ARRAY_BUFFER, vertexArray, hint );\r\n\r\n\t\t}\r\n\r\n\t\tif ( dirtyColors ) {\r\n\r\n\t\t\tfor ( c = 0; c < cl; c ++ ) {\r\n\r\n\t\t\t\tcolor = colors[ c ];\r\n\r\n\t\t\t\toffset = c * 3;\r\n\r\n\t\t\t\tcolorArray[ offset ]     = color.r;\r\n\t\t\t\tcolorArray[ offset + 1 ] = color.g;\r\n\t\t\t\tcolorArray[ offset + 2 ] = color.b;\r\n\r\n\t\t\t}\r\n\r\n\t\t\t_gl.bindBuffer( _gl.ARRAY_BUFFER, geometry.__webglColorBuffer );\r\n\t\t\t_gl.bufferData( _gl.ARRAY_BUFFER, colorArray, hint );\r\n\r\n\t\t}\r\n\r\n\t\tif ( customAttributes ) {\r\n\r\n\t\t\tfor ( i = 0, il = customAttributes.length; i < il; i ++ ) {\r\n\r\n\t\t\t\tcustomAttribute = customAttributes[ i ];\r\n\r\n\t\t\t\tif ( customAttribute.needsUpdate && ( customAttribute.boundTo === undefined ||  customAttribute.boundTo === 'vertices' ) ) {\r\n\r\n\t\t\t\t\tcal = customAttribute.value.length;\r\n\r\n\t\t\t\t\toffset = 0;\r\n\r\n\t\t\t\t\tif ( customAttribute.size === 1 ) {\r\n\r\n\t\t\t\t\t\tfor ( ca = 0; ca < cal; ca ++ ) {\r\n\r\n\t\t\t\t\t\t\tcustomAttribute.array[ ca ] = customAttribute.value[ ca ];\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t} else if ( customAttribute.size === 2 ) {\r\n\r\n\t\t\t\t\t\tfor ( ca = 0; ca < cal; ca ++ ) {\r\n\r\n\t\t\t\t\t\t\tvalue = customAttribute.value[ ca ];\r\n\r\n\t\t\t\t\t\t\tcustomAttribute.array[ offset ]   = value.x;\r\n\t\t\t\t\t\t\tcustomAttribute.array[ offset + 1 ] = value.y;\r\n\r\n\t\t\t\t\t\t\toffset += 2;\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t} else if ( customAttribute.size === 3 ) {\r\n\r\n\t\t\t\t\t\tif ( customAttribute.type === 'c' ) {\r\n\r\n\t\t\t\t\t\t\tfor ( ca = 0; ca < cal; ca ++ ) {\r\n\r\n\t\t\t\t\t\t\t\tvalue = customAttribute.value[ ca ];\r\n\r\n\t\t\t\t\t\t\t\tcustomAttribute.array[ offset ]   = value.r;\r\n\t\t\t\t\t\t\t\tcustomAttribute.array[ offset + 1 ] = value.g;\r\n\t\t\t\t\t\t\t\tcustomAttribute.array[ offset + 2 ] = value.b;\r\n\r\n\t\t\t\t\t\t\t\toffset += 3;\r\n\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\t\tfor ( ca = 0; ca < cal; ca ++ ) {\r\n\r\n\t\t\t\t\t\t\t\tvalue = customAttribute.value[ ca ];\r\n\r\n\t\t\t\t\t\t\t\tcustomAttribute.array[ offset ]   = value.x;\r\n\t\t\t\t\t\t\t\tcustomAttribute.array[ offset + 1 ] = value.y;\r\n\t\t\t\t\t\t\t\tcustomAttribute.array[ offset + 2 ] = value.z;\r\n\r\n\t\t\t\t\t\t\t\toffset += 3;\r\n\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t} else if ( customAttribute.size === 4 ) {\r\n\r\n\t\t\t\t\t\tfor ( ca = 0; ca < cal; ca ++ ) {\r\n\r\n\t\t\t\t\t\t\tvalue = customAttribute.value[ ca ];\r\n\r\n\t\t\t\t\t\t\tcustomAttribute.array[ offset ]      = value.x;\r\n\t\t\t\t\t\t\tcustomAttribute.array[ offset + 1  ] = value.y;\r\n\t\t\t\t\t\t\tcustomAttribute.array[ offset + 2  ] = value.z;\r\n\t\t\t\t\t\t\tcustomAttribute.array[ offset + 3  ] = value.w;\r\n\r\n\t\t\t\t\t\t\toffset += 4;\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\t_gl.bindBuffer( _gl.ARRAY_BUFFER, customAttribute.buffer );\r\n\t\t\t\t_gl.bufferData( _gl.ARRAY_BUFFER, customAttribute.array, hint );\r\n\r\n\t\t\t\tcustomAttribute.needsUpdate = false;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tfunction setLineBuffers ( geometry, hint ) {\r\n\r\n\t\tvar v, c, d, vertex, offset, color,\r\n\r\n\t\tvertices = geometry.vertices,\r\n\t\tcolors = geometry.colors,\r\n\t\tlineDistances = geometry.lineDistances,\r\n\r\n\t\tvl = vertices.length,\r\n\t\tcl = colors.length,\r\n\t\tdl = lineDistances.length,\r\n\r\n\t\tvertexArray = geometry.__vertexArray,\r\n\t\tcolorArray = geometry.__colorArray,\r\n\t\tlineDistanceArray = geometry.__lineDistanceArray,\r\n\r\n\t\tdirtyVertices = geometry.verticesNeedUpdate,\r\n\t\tdirtyColors = geometry.colorsNeedUpdate,\r\n\t\tdirtyLineDistances = geometry.lineDistancesNeedUpdate,\r\n\r\n\t\tcustomAttributes = geometry.__webglCustomAttributesList,\r\n\r\n\t\ti, il,\r\n\t\tca, cal, value,\r\n\t\tcustomAttribute;\r\n\r\n\t\tif ( dirtyVertices ) {\r\n\r\n\t\t\tfor ( v = 0; v < vl; v ++ ) {\r\n\r\n\t\t\t\tvertex = vertices[ v ];\r\n\r\n\t\t\t\toffset = v * 3;\r\n\r\n\t\t\t\tvertexArray[ offset ]     = vertex.x;\r\n\t\t\t\tvertexArray[ offset + 1 ] = vertex.y;\r\n\t\t\t\tvertexArray[ offset + 2 ] = vertex.z;\r\n\r\n\t\t\t}\r\n\r\n\t\t\t_gl.bindBuffer( _gl.ARRAY_BUFFER, geometry.__webglVertexBuffer );\r\n\t\t\t_gl.bufferData( _gl.ARRAY_BUFFER, vertexArray, hint );\r\n\r\n\t\t}\r\n\r\n\t\tif ( dirtyColors ) {\r\n\r\n\t\t\tfor ( c = 0; c < cl; c ++ ) {\r\n\r\n\t\t\t\tcolor = colors[ c ];\r\n\r\n\t\t\t\toffset = c * 3;\r\n\r\n\t\t\t\tcolorArray[ offset ]     = color.r;\r\n\t\t\t\tcolorArray[ offset + 1 ] = color.g;\r\n\t\t\t\tcolorArray[ offset + 2 ] = color.b;\r\n\r\n\t\t\t}\r\n\r\n\t\t\t_gl.bindBuffer( _gl.ARRAY_BUFFER, geometry.__webglColorBuffer );\r\n\t\t\t_gl.bufferData( _gl.ARRAY_BUFFER, colorArray, hint );\r\n\r\n\t\t}\r\n\r\n\t\tif ( dirtyLineDistances ) {\r\n\r\n\t\t\tfor ( d = 0; d < dl; d ++ ) {\r\n\r\n\t\t\t\tlineDistanceArray[ d ] = lineDistances[ d ];\r\n\r\n\t\t\t}\r\n\r\n\t\t\t_gl.bindBuffer( _gl.ARRAY_BUFFER, geometry.__webglLineDistanceBuffer );\r\n\t\t\t_gl.bufferData( _gl.ARRAY_BUFFER, lineDistanceArray, hint );\r\n\r\n\t\t}\r\n\r\n\t\tif ( customAttributes ) {\r\n\r\n\t\t\tfor ( i = 0, il = customAttributes.length; i < il; i ++ ) {\r\n\r\n\t\t\t\tcustomAttribute = customAttributes[ i ];\r\n\r\n\t\t\t\tif ( customAttribute.needsUpdate && ( customAttribute.boundTo === undefined || customAttribute.boundTo === 'vertices' ) ) {\r\n\r\n\t\t\t\t\toffset = 0;\r\n\r\n\t\t\t\t\tcal = customAttribute.value.length;\r\n\r\n\t\t\t\t\tif ( customAttribute.size === 1 ) {\r\n\r\n\t\t\t\t\t\tfor ( ca = 0; ca < cal; ca ++ ) {\r\n\r\n\t\t\t\t\t\t\tcustomAttribute.array[ ca ] = customAttribute.value[ ca ];\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t} else if ( customAttribute.size === 2 ) {\r\n\r\n\t\t\t\t\t\tfor ( ca = 0; ca < cal; ca ++ ) {\r\n\r\n\t\t\t\t\t\t\tvalue = customAttribute.value[ ca ];\r\n\r\n\t\t\t\t\t\t\tcustomAttribute.array[ offset ]   = value.x;\r\n\t\t\t\t\t\t\tcustomAttribute.array[ offset + 1 ] = value.y;\r\n\r\n\t\t\t\t\t\t\toffset += 2;\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t} else if ( customAttribute.size === 3 ) {\r\n\r\n\t\t\t\t\t\tif ( customAttribute.type === 'c' ) {\r\n\r\n\t\t\t\t\t\t\tfor ( ca = 0; ca < cal; ca ++ ) {\r\n\r\n\t\t\t\t\t\t\t\tvalue = customAttribute.value[ ca ];\r\n\r\n\t\t\t\t\t\t\t\tcustomAttribute.array[ offset ]   = value.r;\r\n\t\t\t\t\t\t\t\tcustomAttribute.array[ offset + 1 ] = value.g;\r\n\t\t\t\t\t\t\t\tcustomAttribute.array[ offset + 2 ] = value.b;\r\n\r\n\t\t\t\t\t\t\t\toffset += 3;\r\n\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\t\tfor ( ca = 0; ca < cal; ca ++ ) {\r\n\r\n\t\t\t\t\t\t\t\tvalue = customAttribute.value[ ca ];\r\n\r\n\t\t\t\t\t\t\t\tcustomAttribute.array[ offset ]   = value.x;\r\n\t\t\t\t\t\t\t\tcustomAttribute.array[ offset + 1 ] = value.y;\r\n\t\t\t\t\t\t\t\tcustomAttribute.array[ offset + 2 ] = value.z;\r\n\r\n\t\t\t\t\t\t\t\toffset += 3;\r\n\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t} else if ( customAttribute.size === 4 ) {\r\n\r\n\t\t\t\t\t\tfor ( ca = 0; ca < cal; ca ++ ) {\r\n\r\n\t\t\t\t\t\t\tvalue = customAttribute.value[ ca ];\r\n\r\n\t\t\t\t\t\t\tcustomAttribute.array[ offset ]    = value.x;\r\n\t\t\t\t\t\t\tcustomAttribute.array[ offset + 1  ] = value.y;\r\n\t\t\t\t\t\t\tcustomAttribute.array[ offset + 2  ] = value.z;\r\n\t\t\t\t\t\t\tcustomAttribute.array[ offset + 3  ] = value.w;\r\n\r\n\t\t\t\t\t\t\toffset += 4;\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t_gl.bindBuffer( _gl.ARRAY_BUFFER, customAttribute.buffer );\r\n\t\t\t\t\t_gl.bufferData( _gl.ARRAY_BUFFER, customAttribute.array, hint );\r\n\r\n\t\t\t\t\tcustomAttribute.needsUpdate = false;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tfunction setMeshBuffers( geometryGroup, object, hint, dispose, material ) {\r\n\r\n\t\tif ( ! geometryGroup.__inittedArrays ) {\r\n\r\n\t\t\treturn;\r\n\r\n\t\t}\r\n\r\n\t\tvar needsFaceNormals = materialNeedsFaceNormals( material );\r\n\r\n\t\tvar f, fl, fi, face,\r\n\t\tvertexNormals, faceNormal,\r\n\t\tvertexColors, faceColor,\r\n\t\tvertexTangents,\r\n\t\tuv, uv2, v1, v2, v3, t1, t2, t3, n1, n2, n3,\r\n\t\tc1, c2, c3,\r\n\t\tsw1, sw2, sw3,\r\n\t\tsi1, si2, si3,\r\n\t\ti, il,\r\n\t\tvn, uvi, uv2i,\r\n\t\tvk, vkl, vka,\r\n\t\tnka, chf, faceVertexNormals,\r\n\r\n\t\tvertexIndex = 0,\r\n\r\n\t\toffset = 0,\r\n\t\toffset_uv = 0,\r\n\t\toffset_uv2 = 0,\r\n\t\toffset_face = 0,\r\n\t\toffset_normal = 0,\r\n\t\toffset_tangent = 0,\r\n\t\toffset_line = 0,\r\n\t\toffset_color = 0,\r\n\t\toffset_skin = 0,\r\n\t\toffset_morphTarget = 0,\r\n\t\toffset_custom = 0,\r\n\r\n\t\tvalue,\r\n\r\n\t\tvertexArray = geometryGroup.__vertexArray,\r\n\t\tuvArray = geometryGroup.__uvArray,\r\n\t\tuv2Array = geometryGroup.__uv2Array,\r\n\t\tnormalArray = geometryGroup.__normalArray,\r\n\t\ttangentArray = geometryGroup.__tangentArray,\r\n\t\tcolorArray = geometryGroup.__colorArray,\r\n\r\n\t\tskinIndexArray = geometryGroup.__skinIndexArray,\r\n\t\tskinWeightArray = geometryGroup.__skinWeightArray,\r\n\r\n\t\tmorphTargetsArrays = geometryGroup.__morphTargetsArrays,\r\n\t\tmorphNormalsArrays = geometryGroup.__morphNormalsArrays,\r\n\r\n\t\tcustomAttributes = geometryGroup.__webglCustomAttributesList,\r\n\t\tcustomAttribute,\r\n\r\n\t\tfaceArray = geometryGroup.__faceArray,\r\n\t\tlineArray = geometryGroup.__lineArray,\r\n\r\n\t\tgeometry = object.geometry, // this is shared for all chunks\r\n\r\n\t\tdirtyVertices = geometry.verticesNeedUpdate,\r\n\t\tdirtyElements = geometry.elementsNeedUpdate,\r\n\t\tdirtyUvs = geometry.uvsNeedUpdate,\r\n\t\tdirtyNormals = geometry.normalsNeedUpdate,\r\n\t\tdirtyTangents = geometry.tangentsNeedUpdate,\r\n\t\tdirtyColors = geometry.colorsNeedUpdate,\r\n\t\tdirtyMorphTargets = geometry.morphTargetsNeedUpdate,\r\n\r\n\t\tvertices = geometry.vertices,\r\n\t\tchunk_faces3 = geometryGroup.faces3,\r\n\t\tobj_faces = geometry.faces,\r\n\r\n\t\tobj_uvs  = geometry.faceVertexUvs[ 0 ],\r\n\t\tobj_uvs2 = geometry.faceVertexUvs[ 1 ],\r\n\r\n\t\tobj_skinIndices = geometry.skinIndices,\r\n\t\tobj_skinWeights = geometry.skinWeights,\r\n\r\n\t\tmorphTargets = geometry.morphTargets,\r\n\t\tmorphNormals = geometry.morphNormals;\r\n\r\n\t\tif ( dirtyVertices ) {\r\n\r\n\t\t\tfor ( f = 0, fl = chunk_faces3.length; f < fl; f ++ ) {\r\n\r\n\t\t\t\tface = obj_faces[ chunk_faces3[ f ] ];\r\n\r\n\t\t\t\tv1 = vertices[ face.a ];\r\n\t\t\t\tv2 = vertices[ face.b ];\r\n\t\t\t\tv3 = vertices[ face.c ];\r\n\r\n\t\t\t\tvertexArray[ offset ]     = v1.x;\r\n\t\t\t\tvertexArray[ offset + 1 ] = v1.y;\r\n\t\t\t\tvertexArray[ offset + 2 ] = v1.z;\r\n\r\n\t\t\t\tvertexArray[ offset + 3 ] = v2.x;\r\n\t\t\t\tvertexArray[ offset + 4 ] = v2.y;\r\n\t\t\t\tvertexArray[ offset + 5 ] = v2.z;\r\n\r\n\t\t\t\tvertexArray[ offset + 6 ] = v3.x;\r\n\t\t\t\tvertexArray[ offset + 7 ] = v3.y;\r\n\t\t\t\tvertexArray[ offset + 8 ] = v3.z;\r\n\r\n\t\t\t\toffset += 9;\r\n\r\n\t\t\t}\r\n\r\n\t\t\t_gl.bindBuffer( _gl.ARRAY_BUFFER, geometryGroup.__webglVertexBuffer );\r\n\t\t\t_gl.bufferData( _gl.ARRAY_BUFFER, vertexArray, hint );\r\n\r\n\t\t}\r\n\r\n\t\tif ( dirtyMorphTargets ) {\r\n\r\n\t\t\tfor ( vk = 0, vkl = morphTargets.length; vk < vkl; vk ++ ) {\r\n\r\n\t\t\t\toffset_morphTarget = 0;\r\n\r\n\t\t\t\tfor ( f = 0, fl = chunk_faces3.length; f < fl; f ++ ) {\r\n\r\n\t\t\t\t\tchf = chunk_faces3[ f ];\r\n\t\t\t\t\tface = obj_faces[ chf ];\r\n\r\n\t\t\t\t\t// morph positions\r\n\r\n\t\t\t\t\tv1 = morphTargets[ vk ].vertices[ face.a ];\r\n\t\t\t\t\tv2 = morphTargets[ vk ].vertices[ face.b ];\r\n\t\t\t\t\tv3 = morphTargets[ vk ].vertices[ face.c ];\r\n\r\n\t\t\t\t\tvka = morphTargetsArrays[ vk ];\r\n\r\n\t\t\t\t\tvka[ offset_morphTarget ]     = v1.x;\r\n\t\t\t\t\tvka[ offset_morphTarget + 1 ] = v1.y;\r\n\t\t\t\t\tvka[ offset_morphTarget + 2 ] = v1.z;\r\n\r\n\t\t\t\t\tvka[ offset_morphTarget + 3 ] = v2.x;\r\n\t\t\t\t\tvka[ offset_morphTarget + 4 ] = v2.y;\r\n\t\t\t\t\tvka[ offset_morphTarget + 5 ] = v2.z;\r\n\r\n\t\t\t\t\tvka[ offset_morphTarget + 6 ] = v3.x;\r\n\t\t\t\t\tvka[ offset_morphTarget + 7 ] = v3.y;\r\n\t\t\t\t\tvka[ offset_morphTarget + 8 ] = v3.z;\r\n\r\n\t\t\t\t\t// morph normals\r\n\r\n\t\t\t\t\tif ( material.morphNormals ) {\r\n\r\n\t\t\t\t\t\tif ( needsFaceNormals ) {\r\n\r\n\t\t\t\t\t\t\tn1 = morphNormals[ vk ].faceNormals[ chf ];\r\n\t\t\t\t\t\t\tn2 = n1;\r\n\t\t\t\t\t\t\tn3 = n1;\r\n\r\n\t\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\t\tfaceVertexNormals = morphNormals[ vk ].vertexNormals[ chf ];\r\n\r\n\t\t\t\t\t\t\tn1 = faceVertexNormals.a;\r\n\t\t\t\t\t\t\tn2 = faceVertexNormals.b;\r\n\t\t\t\t\t\t\tn3 = faceVertexNormals.c;\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tnka = morphNormalsArrays[ vk ];\r\n\r\n\t\t\t\t\t\tnka[ offset_morphTarget ]     = n1.x;\r\n\t\t\t\t\t\tnka[ offset_morphTarget + 1 ] = n1.y;\r\n\t\t\t\t\t\tnka[ offset_morphTarget + 2 ] = n1.z;\r\n\r\n\t\t\t\t\t\tnka[ offset_morphTarget + 3 ] = n2.x;\r\n\t\t\t\t\t\tnka[ offset_morphTarget + 4 ] = n2.y;\r\n\t\t\t\t\t\tnka[ offset_morphTarget + 5 ] = n2.z;\r\n\r\n\t\t\t\t\t\tnka[ offset_morphTarget + 6 ] = n3.x;\r\n\t\t\t\t\t\tnka[ offset_morphTarget + 7 ] = n3.y;\r\n\t\t\t\t\t\tnka[ offset_morphTarget + 8 ] = n3.z;\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t//\r\n\r\n\t\t\t\t\toffset_morphTarget += 9;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\t_gl.bindBuffer( _gl.ARRAY_BUFFER, geometryGroup.__webglMorphTargetsBuffers[ vk ] );\r\n\t\t\t\t_gl.bufferData( _gl.ARRAY_BUFFER, morphTargetsArrays[ vk ], hint );\r\n\r\n\t\t\t\tif ( material.morphNormals ) {\r\n\r\n\t\t\t\t\t_gl.bindBuffer( _gl.ARRAY_BUFFER, geometryGroup.__webglMorphNormalsBuffers[ vk ] );\r\n\t\t\t\t\t_gl.bufferData( _gl.ARRAY_BUFFER, morphNormalsArrays[ vk ], hint );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tif ( obj_skinWeights.length ) {\r\n\r\n\t\t\tfor ( f = 0, fl = chunk_faces3.length; f < fl; f ++ ) {\r\n\r\n\t\t\t\tface = obj_faces[ chunk_faces3[ f ] ];\r\n\r\n\t\t\t\t// weights\r\n\r\n\t\t\t\tsw1 = obj_skinWeights[ face.a ];\r\n\t\t\t\tsw2 = obj_skinWeights[ face.b ];\r\n\t\t\t\tsw3 = obj_skinWeights[ face.c ];\r\n\r\n\t\t\t\tskinWeightArray[ offset_skin ]     = sw1.x;\r\n\t\t\t\tskinWeightArray[ offset_skin + 1 ] = sw1.y;\r\n\t\t\t\tskinWeightArray[ offset_skin + 2 ] = sw1.z;\r\n\t\t\t\tskinWeightArray[ offset_skin + 3 ] = sw1.w;\r\n\r\n\t\t\t\tskinWeightArray[ offset_skin + 4 ] = sw2.x;\r\n\t\t\t\tskinWeightArray[ offset_skin + 5 ] = sw2.y;\r\n\t\t\t\tskinWeightArray[ offset_skin + 6 ] = sw2.z;\r\n\t\t\t\tskinWeightArray[ offset_skin + 7 ] = sw2.w;\r\n\r\n\t\t\t\tskinWeightArray[ offset_skin + 8 ]  = sw3.x;\r\n\t\t\t\tskinWeightArray[ offset_skin + 9 ]  = sw3.y;\r\n\t\t\t\tskinWeightArray[ offset_skin + 10 ] = sw3.z;\r\n\t\t\t\tskinWeightArray[ offset_skin + 11 ] = sw3.w;\r\n\r\n\t\t\t\t// indices\r\n\r\n\t\t\t\tsi1 = obj_skinIndices[ face.a ];\r\n\t\t\t\tsi2 = obj_skinIndices[ face.b ];\r\n\t\t\t\tsi3 = obj_skinIndices[ face.c ];\r\n\r\n\t\t\t\tskinIndexArray[ offset_skin ]     = si1.x;\r\n\t\t\t\tskinIndexArray[ offset_skin + 1 ] = si1.y;\r\n\t\t\t\tskinIndexArray[ offset_skin + 2 ] = si1.z;\r\n\t\t\t\tskinIndexArray[ offset_skin + 3 ] = si1.w;\r\n\r\n\t\t\t\tskinIndexArray[ offset_skin + 4 ] = si2.x;\r\n\t\t\t\tskinIndexArray[ offset_skin + 5 ] = si2.y;\r\n\t\t\t\tskinIndexArray[ offset_skin + 6 ] = si2.z;\r\n\t\t\t\tskinIndexArray[ offset_skin + 7 ] = si2.w;\r\n\r\n\t\t\t\tskinIndexArray[ offset_skin + 8 ]  = si3.x;\r\n\t\t\t\tskinIndexArray[ offset_skin + 9 ]  = si3.y;\r\n\t\t\t\tskinIndexArray[ offset_skin + 10 ] = si3.z;\r\n\t\t\t\tskinIndexArray[ offset_skin + 11 ] = si3.w;\r\n\r\n\t\t\t\toffset_skin += 12;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( offset_skin > 0 ) {\r\n\r\n\t\t\t\t_gl.bindBuffer( _gl.ARRAY_BUFFER, geometryGroup.__webglSkinIndicesBuffer );\r\n\t\t\t\t_gl.bufferData( _gl.ARRAY_BUFFER, skinIndexArray, hint );\r\n\r\n\t\t\t\t_gl.bindBuffer( _gl.ARRAY_BUFFER, geometryGroup.__webglSkinWeightsBuffer );\r\n\t\t\t\t_gl.bufferData( _gl.ARRAY_BUFFER, skinWeightArray, hint );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tif ( dirtyColors ) {\r\n\r\n\t\t\tfor ( f = 0, fl = chunk_faces3.length; f < fl; f ++ ) {\r\n\r\n\t\t\t\tface = obj_faces[ chunk_faces3[ f ] ];\r\n\r\n\t\t\t\tvertexColors = face.vertexColors;\r\n\t\t\t\tfaceColor = face.color;\r\n\r\n\t\t\t\tif ( vertexColors.length === 3 && material.vertexColors === THREE.VertexColors ) {\r\n\r\n\t\t\t\t\tc1 = vertexColors[ 0 ];\r\n\t\t\t\t\tc2 = vertexColors[ 1 ];\r\n\t\t\t\t\tc3 = vertexColors[ 2 ];\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\tc1 = faceColor;\r\n\t\t\t\t\tc2 = faceColor;\r\n\t\t\t\t\tc3 = faceColor;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tcolorArray[ offset_color ]     = c1.r;\r\n\t\t\t\tcolorArray[ offset_color + 1 ] = c1.g;\r\n\t\t\t\tcolorArray[ offset_color + 2 ] = c1.b;\r\n\r\n\t\t\t\tcolorArray[ offset_color + 3 ] = c2.r;\r\n\t\t\t\tcolorArray[ offset_color + 4 ] = c2.g;\r\n\t\t\t\tcolorArray[ offset_color + 5 ] = c2.b;\r\n\r\n\t\t\t\tcolorArray[ offset_color + 6 ] = c3.r;\r\n\t\t\t\tcolorArray[ offset_color + 7 ] = c3.g;\r\n\t\t\t\tcolorArray[ offset_color + 8 ] = c3.b;\r\n\r\n\t\t\t\toffset_color += 9;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( offset_color > 0 ) {\r\n\r\n\t\t\t\t_gl.bindBuffer( _gl.ARRAY_BUFFER, geometryGroup.__webglColorBuffer );\r\n\t\t\t\t_gl.bufferData( _gl.ARRAY_BUFFER, colorArray, hint );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tif ( dirtyTangents && geometry.hasTangents ) {\r\n\r\n\t\t\tfor ( f = 0, fl = chunk_faces3.length; f < fl; f ++ ) {\r\n\r\n\t\t\t\tface = obj_faces[ chunk_faces3[ f ] ];\r\n\r\n\t\t\t\tvertexTangents = face.vertexTangents;\r\n\r\n\t\t\t\tt1 = vertexTangents[ 0 ];\r\n\t\t\t\tt2 = vertexTangents[ 1 ];\r\n\t\t\t\tt3 = vertexTangents[ 2 ];\r\n\r\n\t\t\t\ttangentArray[ offset_tangent ]     = t1.x;\r\n\t\t\t\ttangentArray[ offset_tangent + 1 ] = t1.y;\r\n\t\t\t\ttangentArray[ offset_tangent + 2 ] = t1.z;\r\n\t\t\t\ttangentArray[ offset_tangent + 3 ] = t1.w;\r\n\r\n\t\t\t\ttangentArray[ offset_tangent + 4 ] = t2.x;\r\n\t\t\t\ttangentArray[ offset_tangent + 5 ] = t2.y;\r\n\t\t\t\ttangentArray[ offset_tangent + 6 ] = t2.z;\r\n\t\t\t\ttangentArray[ offset_tangent + 7 ] = t2.w;\r\n\r\n\t\t\t\ttangentArray[ offset_tangent + 8 ]  = t3.x;\r\n\t\t\t\ttangentArray[ offset_tangent + 9 ]  = t3.y;\r\n\t\t\t\ttangentArray[ offset_tangent + 10 ] = t3.z;\r\n\t\t\t\ttangentArray[ offset_tangent + 11 ] = t3.w;\r\n\r\n\t\t\t\toffset_tangent += 12;\r\n\r\n\t\t\t}\r\n\r\n\t\t\t_gl.bindBuffer( _gl.ARRAY_BUFFER, geometryGroup.__webglTangentBuffer );\r\n\t\t\t_gl.bufferData( _gl.ARRAY_BUFFER, tangentArray, hint );\r\n\r\n\t\t}\r\n\r\n\t\tif ( dirtyNormals ) {\r\n\r\n\t\t\tfor ( f = 0, fl = chunk_faces3.length; f < fl; f ++ ) {\r\n\r\n\t\t\t\tface = obj_faces[ chunk_faces3[ f ] ];\r\n\r\n\t\t\t\tvertexNormals = face.vertexNormals;\r\n\t\t\t\tfaceNormal = face.normal;\r\n\r\n\t\t\t\tif ( vertexNormals.length === 3 && needsFaceNormals === false ) {\r\n\r\n\t\t\t\t\tfor ( i = 0; i < 3; i ++ ) {\r\n\r\n\t\t\t\t\t\tvn = vertexNormals[ i ];\r\n\r\n\t\t\t\t\t\tnormalArray[ offset_normal ]     = vn.x;\r\n\t\t\t\t\t\tnormalArray[ offset_normal + 1 ] = vn.y;\r\n\t\t\t\t\t\tnormalArray[ offset_normal + 2 ] = vn.z;\r\n\r\n\t\t\t\t\t\toffset_normal += 3;\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\tfor ( i = 0; i < 3; i ++ ) {\r\n\r\n\t\t\t\t\t\tnormalArray[ offset_normal ]     = faceNormal.x;\r\n\t\t\t\t\t\tnormalArray[ offset_normal + 1 ] = faceNormal.y;\r\n\t\t\t\t\t\tnormalArray[ offset_normal + 2 ] = faceNormal.z;\r\n\r\n\t\t\t\t\t\toffset_normal += 3;\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\t_gl.bindBuffer( _gl.ARRAY_BUFFER, geometryGroup.__webglNormalBuffer );\r\n\t\t\t_gl.bufferData( _gl.ARRAY_BUFFER, normalArray, hint );\r\n\r\n\t\t}\r\n\r\n\t\tif ( dirtyUvs && obj_uvs ) {\r\n\r\n\t\t\tfor ( f = 0, fl = chunk_faces3.length; f < fl; f ++ ) {\r\n\r\n\t\t\t\tfi = chunk_faces3[ f ];\r\n\r\n\t\t\t\tuv = obj_uvs[ fi ];\r\n\r\n\t\t\t\tif ( uv === undefined ) continue;\r\n\r\n\t\t\t\tfor ( i = 0; i < 3; i ++ ) {\r\n\r\n\t\t\t\t\tuvi = uv[ i ];\r\n\r\n\t\t\t\t\tuvArray[ offset_uv ]     = uvi.x;\r\n\t\t\t\t\tuvArray[ offset_uv + 1 ] = uvi.y;\r\n\r\n\t\t\t\t\toffset_uv += 2;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( offset_uv > 0 ) {\r\n\r\n\t\t\t\t_gl.bindBuffer( _gl.ARRAY_BUFFER, geometryGroup.__webglUVBuffer );\r\n\t\t\t\t_gl.bufferData( _gl.ARRAY_BUFFER, uvArray, hint );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tif ( dirtyUvs && obj_uvs2 ) {\r\n\r\n\t\t\tfor ( f = 0, fl = chunk_faces3.length; f < fl; f ++ ) {\r\n\r\n\t\t\t\tfi = chunk_faces3[ f ];\r\n\r\n\t\t\t\tuv2 = obj_uvs2[ fi ];\r\n\r\n\t\t\t\tif ( uv2 === undefined ) continue;\r\n\r\n\t\t\t\tfor ( i = 0; i < 3; i ++ ) {\r\n\r\n\t\t\t\t\tuv2i = uv2[ i ];\r\n\r\n\t\t\t\t\tuv2Array[ offset_uv2 ]     = uv2i.x;\r\n\t\t\t\t\tuv2Array[ offset_uv2 + 1 ] = uv2i.y;\r\n\r\n\t\t\t\t\toffset_uv2 += 2;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( offset_uv2 > 0 ) {\r\n\r\n\t\t\t\t_gl.bindBuffer( _gl.ARRAY_BUFFER, geometryGroup.__webglUV2Buffer );\r\n\t\t\t\t_gl.bufferData( _gl.ARRAY_BUFFER, uv2Array, hint );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tif ( dirtyElements ) {\r\n\r\n\t\t\tfor ( f = 0, fl = chunk_faces3.length; f < fl; f ++ ) {\r\n\r\n\t\t\t\tfaceArray[ offset_face ]   = vertexIndex;\r\n\t\t\t\tfaceArray[ offset_face + 1 ] = vertexIndex + 1;\r\n\t\t\t\tfaceArray[ offset_face + 2 ] = vertexIndex + 2;\r\n\r\n\t\t\t\toffset_face += 3;\r\n\r\n\t\t\t\tlineArray[ offset_line ]     = vertexIndex;\r\n\t\t\t\tlineArray[ offset_line + 1 ] = vertexIndex + 1;\r\n\r\n\t\t\t\tlineArray[ offset_line + 2 ] = vertexIndex;\r\n\t\t\t\tlineArray[ offset_line + 3 ] = vertexIndex + 2;\r\n\r\n\t\t\t\tlineArray[ offset_line + 4 ] = vertexIndex + 1;\r\n\t\t\t\tlineArray[ offset_line + 5 ] = vertexIndex + 2;\r\n\r\n\t\t\t\toffset_line += 6;\r\n\r\n\t\t\t\tvertexIndex += 3;\r\n\r\n\t\t\t}\r\n\r\n\t\t\t_gl.bindBuffer( _gl.ELEMENT_ARRAY_BUFFER, geometryGroup.__webglFaceBuffer );\r\n\t\t\t_gl.bufferData( _gl.ELEMENT_ARRAY_BUFFER, faceArray, hint );\r\n\r\n\t\t\t_gl.bindBuffer( _gl.ELEMENT_ARRAY_BUFFER, geometryGroup.__webglLineBuffer );\r\n\t\t\t_gl.bufferData( _gl.ELEMENT_ARRAY_BUFFER, lineArray, hint );\r\n\r\n\t\t}\r\n\r\n\t\tif ( customAttributes ) {\r\n\r\n\t\t\tfor ( i = 0, il = customAttributes.length; i < il; i ++ ) {\r\n\r\n\t\t\t\tcustomAttribute = customAttributes[ i ];\r\n\r\n\t\t\t\tif ( ! customAttribute.__original.needsUpdate ) continue;\r\n\r\n\t\t\t\toffset_custom = 0;\r\n\r\n\t\t\t\tif ( customAttribute.size === 1 ) {\r\n\r\n\t\t\t\t\tif ( customAttribute.boundTo === undefined || customAttribute.boundTo === 'vertices' ) {\r\n\r\n\t\t\t\t\t\tfor ( f = 0, fl = chunk_faces3.length; f < fl; f ++ ) {\r\n\r\n\t\t\t\t\t\t\tface = obj_faces[ chunk_faces3[ f ] ];\r\n\r\n\t\t\t\t\t\t\tcustomAttribute.array[ offset_custom ]     = customAttribute.value[ face.a ];\r\n\t\t\t\t\t\t\tcustomAttribute.array[ offset_custom + 1 ] = customAttribute.value[ face.b ];\r\n\t\t\t\t\t\t\tcustomAttribute.array[ offset_custom + 2 ] = customAttribute.value[ face.c ];\r\n\r\n\t\t\t\t\t\t\toffset_custom += 3;\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t} else if ( customAttribute.boundTo === 'faces' ) {\r\n\r\n\t\t\t\t\t\tfor ( f = 0, fl = chunk_faces3.length; f < fl; f ++ ) {\r\n\r\n\t\t\t\t\t\t\tvalue = customAttribute.value[ chunk_faces3[ f ] ];\r\n\r\n\t\t\t\t\t\t\tcustomAttribute.array[ offset_custom ]     = value;\r\n\t\t\t\t\t\t\tcustomAttribute.array[ offset_custom + 1 ] = value;\r\n\t\t\t\t\t\t\tcustomAttribute.array[ offset_custom + 2 ] = value;\r\n\r\n\t\t\t\t\t\t\toffset_custom += 3;\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t} else if ( customAttribute.size === 2 ) {\r\n\r\n\t\t\t\t\tif ( customAttribute.boundTo === undefined || customAttribute.boundTo === 'vertices' ) {\r\n\r\n\t\t\t\t\t\tfor ( f = 0, fl = chunk_faces3.length; f < fl; f ++ ) {\r\n\r\n\t\t\t\t\t\t\tface = obj_faces[ chunk_faces3[ f ] ];\r\n\r\n\t\t\t\t\t\t\tv1 = customAttribute.value[ face.a ];\r\n\t\t\t\t\t\t\tv2 = customAttribute.value[ face.b ];\r\n\t\t\t\t\t\t\tv3 = customAttribute.value[ face.c ];\r\n\r\n\t\t\t\t\t\t\tcustomAttribute.array[ offset_custom ]     = v1.x;\r\n\t\t\t\t\t\t\tcustomAttribute.array[ offset_custom + 1 ] = v1.y;\r\n\r\n\t\t\t\t\t\t\tcustomAttribute.array[ offset_custom + 2 ] = v2.x;\r\n\t\t\t\t\t\t\tcustomAttribute.array[ offset_custom + 3 ] = v2.y;\r\n\r\n\t\t\t\t\t\t\tcustomAttribute.array[ offset_custom + 4 ] = v3.x;\r\n\t\t\t\t\t\t\tcustomAttribute.array[ offset_custom + 5 ] = v3.y;\r\n\r\n\t\t\t\t\t\t\toffset_custom += 6;\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t} else if ( customAttribute.boundTo === 'faces' ) {\r\n\r\n\t\t\t\t\t\tfor ( f = 0, fl = chunk_faces3.length; f < fl; f ++ ) {\r\n\r\n\t\t\t\t\t\t\tvalue = customAttribute.value[ chunk_faces3[ f ] ];\r\n\r\n\t\t\t\t\t\t\tv1 = value;\r\n\t\t\t\t\t\t\tv2 = value;\r\n\t\t\t\t\t\t\tv3 = value;\r\n\r\n\t\t\t\t\t\t\tcustomAttribute.array[ offset_custom ]     = v1.x;\r\n\t\t\t\t\t\t\tcustomAttribute.array[ offset_custom + 1 ] = v1.y;\r\n\r\n\t\t\t\t\t\t\tcustomAttribute.array[ offset_custom + 2 ] = v2.x;\r\n\t\t\t\t\t\t\tcustomAttribute.array[ offset_custom + 3 ] = v2.y;\r\n\r\n\t\t\t\t\t\t\tcustomAttribute.array[ offset_custom + 4 ] = v3.x;\r\n\t\t\t\t\t\t\tcustomAttribute.array[ offset_custom + 5 ] = v3.y;\r\n\r\n\t\t\t\t\t\t\toffset_custom += 6;\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t} else if ( customAttribute.size === 3 ) {\r\n\r\n\t\t\t\t\tvar pp;\r\n\r\n\t\t\t\t\tif ( customAttribute.type === 'c' ) {\r\n\r\n\t\t\t\t\t\tpp = [ 'r', 'g', 'b' ];\r\n\r\n\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\tpp = [ 'x', 'y', 'z' ];\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif ( customAttribute.boundTo === undefined || customAttribute.boundTo === 'vertices' ) {\r\n\r\n\t\t\t\t\t\tfor ( f = 0, fl = chunk_faces3.length; f < fl; f ++ ) {\r\n\r\n\t\t\t\t\t\t\tface = obj_faces[ chunk_faces3[ f ] ];\r\n\r\n\t\t\t\t\t\t\tv1 = customAttribute.value[ face.a ];\r\n\t\t\t\t\t\t\tv2 = customAttribute.value[ face.b ];\r\n\t\t\t\t\t\t\tv3 = customAttribute.value[ face.c ];\r\n\r\n\t\t\t\t\t\t\tcustomAttribute.array[ offset_custom ]     = v1[ pp[ 0 ] ];\r\n\t\t\t\t\t\t\tcustomAttribute.array[ offset_custom + 1 ] = v1[ pp[ 1 ] ];\r\n\t\t\t\t\t\t\tcustomAttribute.array[ offset_custom + 2 ] = v1[ pp[ 2 ] ];\r\n\r\n\t\t\t\t\t\t\tcustomAttribute.array[ offset_custom + 3 ] = v2[ pp[ 0 ] ];\r\n\t\t\t\t\t\t\tcustomAttribute.array[ offset_custom + 4 ] = v2[ pp[ 1 ] ];\r\n\t\t\t\t\t\t\tcustomAttribute.array[ offset_custom + 5 ] = v2[ pp[ 2 ] ];\r\n\r\n\t\t\t\t\t\t\tcustomAttribute.array[ offset_custom + 6 ] = v3[ pp[ 0 ] ];\r\n\t\t\t\t\t\t\tcustomAttribute.array[ offset_custom + 7 ] = v3[ pp[ 1 ] ];\r\n\t\t\t\t\t\t\tcustomAttribute.array[ offset_custom + 8 ] = v3[ pp[ 2 ] ];\r\n\r\n\t\t\t\t\t\t\toffset_custom += 9;\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t} else if ( customAttribute.boundTo === 'faces' ) {\r\n\r\n\t\t\t\t\t\tfor ( f = 0, fl = chunk_faces3.length; f < fl; f ++ ) {\r\n\r\n\t\t\t\t\t\t\tvalue = customAttribute.value[ chunk_faces3[ f ] ];\r\n\r\n\t\t\t\t\t\t\tv1 = value;\r\n\t\t\t\t\t\t\tv2 = value;\r\n\t\t\t\t\t\t\tv3 = value;\r\n\r\n\t\t\t\t\t\t\tcustomAttribute.array[ offset_custom ]     = v1[ pp[ 0 ] ];\r\n\t\t\t\t\t\t\tcustomAttribute.array[ offset_custom + 1 ] = v1[ pp[ 1 ] ];\r\n\t\t\t\t\t\t\tcustomAttribute.array[ offset_custom + 2 ] = v1[ pp[ 2 ] ];\r\n\r\n\t\t\t\t\t\t\tcustomAttribute.array[ offset_custom + 3 ] = v2[ pp[ 0 ] ];\r\n\t\t\t\t\t\t\tcustomAttribute.array[ offset_custom + 4 ] = v2[ pp[ 1 ] ];\r\n\t\t\t\t\t\t\tcustomAttribute.array[ offset_custom + 5 ] = v2[ pp[ 2 ] ];\r\n\r\n\t\t\t\t\t\t\tcustomAttribute.array[ offset_custom + 6 ] = v3[ pp[ 0 ] ];\r\n\t\t\t\t\t\t\tcustomAttribute.array[ offset_custom + 7 ] = v3[ pp[ 1 ] ];\r\n\t\t\t\t\t\t\tcustomAttribute.array[ offset_custom + 8 ] = v3[ pp[ 2 ] ];\r\n\r\n\t\t\t\t\t\t\toffset_custom += 9;\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t} else if ( customAttribute.boundTo === 'faceVertices' ) {\r\n\r\n\t\t\t\t\t\tfor ( f = 0, fl = chunk_faces3.length; f < fl; f ++ ) {\r\n\r\n\t\t\t\t\t\t\tvalue = customAttribute.value[ chunk_faces3[ f ] ];\r\n\r\n\t\t\t\t\t\t\tv1 = value[ 0 ];\r\n\t\t\t\t\t\t\tv2 = value[ 1 ];\r\n\t\t\t\t\t\t\tv3 = value[ 2 ];\r\n\r\n\t\t\t\t\t\t\tcustomAttribute.array[ offset_custom ]     = v1[ pp[ 0 ] ];\r\n\t\t\t\t\t\t\tcustomAttribute.array[ offset_custom + 1 ] = v1[ pp[ 1 ] ];\r\n\t\t\t\t\t\t\tcustomAttribute.array[ offset_custom + 2 ] = v1[ pp[ 2 ] ];\r\n\r\n\t\t\t\t\t\t\tcustomAttribute.array[ offset_custom + 3 ] = v2[ pp[ 0 ] ];\r\n\t\t\t\t\t\t\tcustomAttribute.array[ offset_custom + 4 ] = v2[ pp[ 1 ] ];\r\n\t\t\t\t\t\t\tcustomAttribute.array[ offset_custom + 5 ] = v2[ pp[ 2 ] ];\r\n\r\n\t\t\t\t\t\t\tcustomAttribute.array[ offset_custom + 6 ] = v3[ pp[ 0 ] ];\r\n\t\t\t\t\t\t\tcustomAttribute.array[ offset_custom + 7 ] = v3[ pp[ 1 ] ];\r\n\t\t\t\t\t\t\tcustomAttribute.array[ offset_custom + 8 ] = v3[ pp[ 2 ] ];\r\n\r\n\t\t\t\t\t\t\toffset_custom += 9;\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t} else if ( customAttribute.size === 4 ) {\r\n\r\n\t\t\t\t\tif ( customAttribute.boundTo === undefined || customAttribute.boundTo === 'vertices' ) {\r\n\r\n\t\t\t\t\t\tfor ( f = 0, fl = chunk_faces3.length; f < fl; f ++ ) {\r\n\r\n\t\t\t\t\t\t\tface = obj_faces[ chunk_faces3[ f ] ];\r\n\r\n\t\t\t\t\t\t\tv1 = customAttribute.value[ face.a ];\r\n\t\t\t\t\t\t\tv2 = customAttribute.value[ face.b ];\r\n\t\t\t\t\t\t\tv3 = customAttribute.value[ face.c ];\r\n\r\n\t\t\t\t\t\t\tcustomAttribute.array[ offset_custom  ]   = v1.x;\r\n\t\t\t\t\t\t\tcustomAttribute.array[ offset_custom + 1  ] = v1.y;\r\n\t\t\t\t\t\t\tcustomAttribute.array[ offset_custom + 2  ] = v1.z;\r\n\t\t\t\t\t\t\tcustomAttribute.array[ offset_custom + 3  ] = v1.w;\r\n\r\n\t\t\t\t\t\t\tcustomAttribute.array[ offset_custom + 4  ] = v2.x;\r\n\t\t\t\t\t\t\tcustomAttribute.array[ offset_custom + 5  ] = v2.y;\r\n\t\t\t\t\t\t\tcustomAttribute.array[ offset_custom + 6  ] = v2.z;\r\n\t\t\t\t\t\t\tcustomAttribute.array[ offset_custom + 7  ] = v2.w;\r\n\r\n\t\t\t\t\t\t\tcustomAttribute.array[ offset_custom + 8  ] = v3.x;\r\n\t\t\t\t\t\t\tcustomAttribute.array[ offset_custom + 9  ] = v3.y;\r\n\t\t\t\t\t\t\tcustomAttribute.array[ offset_custom + 10 ] = v3.z;\r\n\t\t\t\t\t\t\tcustomAttribute.array[ offset_custom + 11 ] = v3.w;\r\n\r\n\t\t\t\t\t\t\toffset_custom += 12;\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t} else if ( customAttribute.boundTo === 'faces' ) {\r\n\r\n\t\t\t\t\t\tfor ( f = 0, fl = chunk_faces3.length; f < fl; f ++ ) {\r\n\r\n\t\t\t\t\t\t\tvalue = customAttribute.value[ chunk_faces3[ f ] ];\r\n\r\n\t\t\t\t\t\t\tv1 = value;\r\n\t\t\t\t\t\t\tv2 = value;\r\n\t\t\t\t\t\t\tv3 = value;\r\n\r\n\t\t\t\t\t\t\tcustomAttribute.array[ offset_custom  ]   = v1.x;\r\n\t\t\t\t\t\t\tcustomAttribute.array[ offset_custom + 1  ] = v1.y;\r\n\t\t\t\t\t\t\tcustomAttribute.array[ offset_custom + 2  ] = v1.z;\r\n\t\t\t\t\t\t\tcustomAttribute.array[ offset_custom + 3  ] = v1.w;\r\n\r\n\t\t\t\t\t\t\tcustomAttribute.array[ offset_custom + 4  ] = v2.x;\r\n\t\t\t\t\t\t\tcustomAttribute.array[ offset_custom + 5  ] = v2.y;\r\n\t\t\t\t\t\t\tcustomAttribute.array[ offset_custom + 6  ] = v2.z;\r\n\t\t\t\t\t\t\tcustomAttribute.array[ offset_custom + 7  ] = v2.w;\r\n\r\n\t\t\t\t\t\t\tcustomAttribute.array[ offset_custom + 8  ] = v3.x;\r\n\t\t\t\t\t\t\tcustomAttribute.array[ offset_custom + 9  ] = v3.y;\r\n\t\t\t\t\t\t\tcustomAttribute.array[ offset_custom + 10 ] = v3.z;\r\n\t\t\t\t\t\t\tcustomAttribute.array[ offset_custom + 11 ] = v3.w;\r\n\r\n\t\t\t\t\t\t\toffset_custom += 12;\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t} else if ( customAttribute.boundTo === 'faceVertices' ) {\r\n\r\n\t\t\t\t\t\tfor ( f = 0, fl = chunk_faces3.length; f < fl; f ++ ) {\r\n\r\n\t\t\t\t\t\t\tvalue = customAttribute.value[ chunk_faces3[ f ] ];\r\n\r\n\t\t\t\t\t\t\tv1 = value[ 0 ];\r\n\t\t\t\t\t\t\tv2 = value[ 1 ];\r\n\t\t\t\t\t\t\tv3 = value[ 2 ];\r\n\r\n\t\t\t\t\t\t\tcustomAttribute.array[ offset_custom  ]   = v1.x;\r\n\t\t\t\t\t\t\tcustomAttribute.array[ offset_custom + 1  ] = v1.y;\r\n\t\t\t\t\t\t\tcustomAttribute.array[ offset_custom + 2  ] = v1.z;\r\n\t\t\t\t\t\t\tcustomAttribute.array[ offset_custom + 3  ] = v1.w;\r\n\r\n\t\t\t\t\t\t\tcustomAttribute.array[ offset_custom + 4  ] = v2.x;\r\n\t\t\t\t\t\t\tcustomAttribute.array[ offset_custom + 5  ] = v2.y;\r\n\t\t\t\t\t\t\tcustomAttribute.array[ offset_custom + 6  ] = v2.z;\r\n\t\t\t\t\t\t\tcustomAttribute.array[ offset_custom + 7  ] = v2.w;\r\n\r\n\t\t\t\t\t\t\tcustomAttribute.array[ offset_custom + 8  ] = v3.x;\r\n\t\t\t\t\t\t\tcustomAttribute.array[ offset_custom + 9  ] = v3.y;\r\n\t\t\t\t\t\t\tcustomAttribute.array[ offset_custom + 10 ] = v3.z;\r\n\t\t\t\t\t\t\tcustomAttribute.array[ offset_custom + 11 ] = v3.w;\r\n\r\n\t\t\t\t\t\t\toffset_custom += 12;\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\t_gl.bindBuffer( _gl.ARRAY_BUFFER, customAttribute.buffer );\r\n\t\t\t\t_gl.bufferData( _gl.ARRAY_BUFFER, customAttribute.array, hint );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tif ( dispose ) {\r\n\r\n\t\t\tdelete geometryGroup.__inittedArrays;\r\n\t\t\tdelete geometryGroup.__colorArray;\r\n\t\t\tdelete geometryGroup.__normalArray;\r\n\t\t\tdelete geometryGroup.__tangentArray;\r\n\t\t\tdelete geometryGroup.__uvArray;\r\n\t\t\tdelete geometryGroup.__uv2Array;\r\n\t\t\tdelete geometryGroup.__faceArray;\r\n\t\t\tdelete geometryGroup.__vertexArray;\r\n\t\t\tdelete geometryGroup.__lineArray;\r\n\t\t\tdelete geometryGroup.__skinIndexArray;\r\n\t\t\tdelete geometryGroup.__skinWeightArray;\r\n\r\n\t\t}\r\n\r\n\t};\r\n\r\n\t// Buffer rendering\r\n\r\n\tthis.renderBufferImmediate = function ( object, program, material ) {\r\n\r\n\t\tstate.initAttributes();\r\n\r\n\t\tif ( object.hasPositions && ! object.__webglVertexBuffer ) object.__webglVertexBuffer = _gl.createBuffer();\r\n\t\tif ( object.hasNormals && ! object.__webglNormalBuffer ) object.__webglNormalBuffer = _gl.createBuffer();\r\n\t\tif ( object.hasUvs && ! object.__webglUvBuffer ) object.__webglUvBuffer = _gl.createBuffer();\r\n\t\tif ( object.hasColors && ! object.__webglColorBuffer ) object.__webglColorBuffer = _gl.createBuffer();\r\n\r\n\t\tif ( object.hasPositions ) {\r\n\r\n\t\t\t_gl.bindBuffer( _gl.ARRAY_BUFFER, object.__webglVertexBuffer );\r\n\t\t\t_gl.bufferData( _gl.ARRAY_BUFFER, object.positionArray, _gl.DYNAMIC_DRAW );\r\n\r\n\t\t\tstate.enableAttribute( program.attributes.position );\r\n\r\n\t\t\t_gl.vertexAttribPointer( program.attributes.position, 3, _gl.FLOAT, false, 0, 0 );\r\n\r\n\t\t}\r\n\r\n\t\tif ( object.hasNormals ) {\r\n\r\n\t\t\t_gl.bindBuffer( _gl.ARRAY_BUFFER, object.__webglNormalBuffer );\r\n\r\n\t\t\tif ( material instanceof THREE.MeshPhongMaterial === false &&\r\n\t\t\t\t   material.shading === THREE.FlatShading ) {\r\n\r\n\t\t\t\tvar nx, ny, nz,\r\n\t\t\t\t\tnax, nbx, ncx, nay, nby, ncy, naz, nbz, ncz,\r\n\t\t\t\t\tnormalArray,\r\n\t\t\t\t\ti, il = object.count * 3;\r\n\r\n\t\t\t\tfor ( i = 0; i < il; i += 9 ) {\r\n\r\n\t\t\t\t\tnormalArray = object.normalArray;\r\n\r\n\t\t\t\t\tnax  = normalArray[ i ];\r\n\t\t\t\t\tnay  = normalArray[ i + 1 ];\r\n\t\t\t\t\tnaz  = normalArray[ i + 2 ];\r\n\r\n\t\t\t\t\tnbx  = normalArray[ i + 3 ];\r\n\t\t\t\t\tnby  = normalArray[ i + 4 ];\r\n\t\t\t\t\tnbz  = normalArray[ i + 5 ];\r\n\r\n\t\t\t\t\tncx  = normalArray[ i + 6 ];\r\n\t\t\t\t\tncy  = normalArray[ i + 7 ];\r\n\t\t\t\t\tncz  = normalArray[ i + 8 ];\r\n\r\n\t\t\t\t\tnx = ( nax + nbx + ncx ) / 3;\r\n\t\t\t\t\tny = ( nay + nby + ncy ) / 3;\r\n\t\t\t\t\tnz = ( naz + nbz + ncz ) / 3;\r\n\r\n\t\t\t\t\tnormalArray[ i ]   = nx;\r\n\t\t\t\t\tnormalArray[ i + 1 ] = ny;\r\n\t\t\t\t\tnormalArray[ i + 2 ] = nz;\r\n\r\n\t\t\t\t\tnormalArray[ i + 3 ] = nx;\r\n\t\t\t\t\tnormalArray[ i + 4 ] = ny;\r\n\t\t\t\t\tnormalArray[ i + 5 ] = nz;\r\n\r\n\t\t\t\t\tnormalArray[ i + 6 ] = nx;\r\n\t\t\t\t\tnormalArray[ i + 7 ] = ny;\r\n\t\t\t\t\tnormalArray[ i + 8 ] = nz;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\t_gl.bufferData( _gl.ARRAY_BUFFER, object.normalArray, _gl.DYNAMIC_DRAW );\r\n\r\n\t\t\tstate.enableAttribute( program.attributes.normal );\r\n\r\n\t\t\t_gl.vertexAttribPointer( program.attributes.normal, 3, _gl.FLOAT, false, 0, 0 );\r\n\r\n\t\t}\r\n\r\n\t\tif ( object.hasUvs && material.map ) {\r\n\r\n\t\t\t_gl.bindBuffer( _gl.ARRAY_BUFFER, object.__webglUvBuffer );\r\n\t\t\t_gl.bufferData( _gl.ARRAY_BUFFER, object.uvArray, _gl.DYNAMIC_DRAW );\r\n\r\n\t\t\tstate.enableAttribute( program.attributes.uv );\r\n\r\n\t\t\t_gl.vertexAttribPointer( program.attributes.uv, 2, _gl.FLOAT, false, 0, 0 );\r\n\r\n\t\t}\r\n\r\n\t\tif ( object.hasColors && material.vertexColors !== THREE.NoColors ) {\r\n\r\n\t\t\t_gl.bindBuffer( _gl.ARRAY_BUFFER, object.__webglColorBuffer );\r\n\t\t\t_gl.bufferData( _gl.ARRAY_BUFFER, object.colorArray, _gl.DYNAMIC_DRAW );\r\n\r\n\t\t\tstate.enableAttribute( program.attributes.color );\r\n\r\n\t\t\t_gl.vertexAttribPointer( program.attributes.color, 3, _gl.FLOAT, false, 0, 0 );\r\n\r\n\t\t}\r\n\r\n\t\tstate.disableUnusedAttributes();\r\n\r\n\t\t_gl.drawArrays( _gl.TRIANGLES, 0, object.count );\r\n\r\n\t\tobject.count = 0;\r\n\r\n\t};\r\n\r\n\tfunction setupVertexAttributes( material, program, geometry, startIndex ) {\r\n\r\n\t\tvar geometryAttributes = geometry.attributes;\r\n\r\n\t\tvar programAttributes = program.attributes;\r\n\t\tvar programAttributesKeys = program.attributesKeys;\r\n\r\n\t\tfor ( var i = 0, l = programAttributesKeys.length; i < l; i ++ ) {\r\n\r\n\t\t\tvar key = programAttributesKeys[ i ];\r\n\t\t\tvar programAttribute = programAttributes[ key ];\r\n\r\n\t\t\tif ( programAttribute >= 0 ) {\r\n\r\n\t\t\t\tvar geometryAttribute = geometryAttributes[ key ];\r\n\r\n\t\t\t\tif ( geometryAttribute !== undefined ) {\r\n\r\n\t\t\t\t\tvar size = geometryAttribute.itemSize;\r\n\r\n\t\t\t\t\t_gl.bindBuffer( _gl.ARRAY_BUFFER, geometryAttribute.buffer );\r\n\r\n\t\t\t\t\tstate.enableAttribute( programAttribute );\r\n\r\n\t\t\t\t\t_gl.vertexAttribPointer( programAttribute, size, _gl.FLOAT, false, 0, startIndex * size * 4 ); // 4 bytes per Float32\r\n\r\n\t\t\t\t} else if ( material.defaultAttributeValues !== undefined ) {\r\n\r\n\t\t\t\t\tif ( material.defaultAttributeValues[ key ].length === 2 ) {\r\n\r\n\t\t\t\t\t\t_gl.vertexAttrib2fv( programAttribute, material.defaultAttributeValues[ key ] );\r\n\r\n\t\t\t\t\t} else if ( material.defaultAttributeValues[ key ].length === 3 ) {\r\n\r\n\t\t\t\t\t\t_gl.vertexAttrib3fv( programAttribute, material.defaultAttributeValues[ key ] );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tstate.disableUnusedAttributes();\r\n\r\n\t}\r\n\r\n\tthis.renderBufferDirect = function ( camera, lights, fog, material, geometry, object ) {\r\n\r\n\t\tif ( material.visible === false ) return;\r\n\r\n\t\tupdateObject( object );\r\n\r\n\t\tvar program = setProgram( camera, lights, fog, material, object );\r\n\r\n\t\tvar updateBuffers = false,\r\n\t\t\twireframeBit = material.wireframe ? 1 : 0,\r\n\t\t\tgeometryProgram = 'direct_' + geometry.id + '_' + program.id + '_' + wireframeBit;\r\n\r\n\t\tif ( geometryProgram !== _currentGeometryProgram ) {\r\n\r\n\t\t\t_currentGeometryProgram = geometryProgram;\r\n\t\t\tupdateBuffers = true;\r\n\r\n\t\t}\r\n\r\n\t\tif ( updateBuffers ) {\r\n\r\n\t\t\tstate.initAttributes();\r\n\r\n\t\t}\r\n\r\n\t\t// render mesh\r\n\r\n\t\tif ( object instanceof THREE.Mesh ) {\r\n\r\n\t\t\tvar mode = material.wireframe === true ? _gl.LINES : _gl.TRIANGLES;\r\n\r\n\t\t\tvar index = geometry.attributes.index;\r\n\r\n\t\t\tif ( index ) {\r\n\r\n\t\t\t\t// indexed triangles\r\n\r\n\t\t\t\tvar type, size;\r\n\r\n\t\t\t\tif ( index.array instanceof Uint32Array && extensions.get( 'OES_element_index_uint' ) ) {\r\n\r\n\t\t\t\t\ttype = _gl.UNSIGNED_INT;\r\n\t\t\t\t\tsize = 4;\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\ttype = _gl.UNSIGNED_SHORT;\r\n\t\t\t\t\tsize = 2;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar offsets = geometry.offsets;\r\n\r\n\t\t\t\tif ( offsets.length === 0 ) {\r\n\r\n\t\t\t\t\tif ( updateBuffers ) {\r\n\r\n\t\t\t\t\t\tsetupVertexAttributes( material, program, geometry, 0 );\r\n\t\t\t\t\t\t_gl.bindBuffer( _gl.ELEMENT_ARRAY_BUFFER, index.buffer );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t_gl.drawElements( mode, index.array.length, type, 0 );\r\n\r\n\t\t\t\t\t_this.info.render.calls ++;\r\n\t\t\t\t\t_this.info.render.vertices += index.array.length; // not really true, here vertices can be shared\r\n\t\t\t\t\t_this.info.render.faces += index.array.length / 3;\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\t// if there is more than 1 chunk\r\n\t\t\t\t\t// must set attribute pointers to use new offsets for each chunk\r\n\t\t\t\t\t// even if geometry and materials didn't change\r\n\r\n\t\t\t\t\tupdateBuffers = true;\r\n\r\n\t\t\t\t\tfor ( var i = 0, il = offsets.length; i < il; i ++ ) {\r\n\r\n\t\t\t\t\t\tvar startIndex = offsets[ i ].index;\r\n\r\n\t\t\t\t\t\tif ( updateBuffers ) {\r\n\r\n\t\t\t\t\t\t\tsetupVertexAttributes( material, program, geometry, startIndex );\r\n\t\t\t\t\t\t\t_gl.bindBuffer( _gl.ELEMENT_ARRAY_BUFFER, index.buffer );\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t// render indexed triangles\r\n\r\n\t\t\t\t\t\t_gl.drawElements( mode, offsets[ i ].count, type, offsets[ i ].start * size );\r\n\r\n\t\t\t\t\t\t_this.info.render.calls ++;\r\n\t\t\t\t\t\t_this.info.render.vertices += offsets[ i ].count; // not really true, here vertices can be shared\r\n\t\t\t\t\t\t_this.info.render.faces += offsets[ i ].count / 3;\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\t// non-indexed triangles\r\n\r\n\t\t\t\tif ( updateBuffers ) {\r\n\r\n\t\t\t\t\tsetupVertexAttributes( material, program, geometry, 0 );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar position = geometry.attributes[ 'position' ];\r\n\r\n\t\t\t\t// render non-indexed triangles\r\n\r\n\t\t\t\t_gl.drawArrays( mode, 0, position.array.length / position.itemSize );\r\n\r\n\t\t\t\t_this.info.render.calls ++;\r\n\t\t\t\t_this.info.render.vertices += position.array.length / position.itemSize;\r\n\t\t\t\t_this.info.render.faces += position.array.length / ( 3 * position.itemSize );\r\n\r\n\t\t\t}\r\n\r\n\t\t} else if ( object instanceof THREE.PointCloud ) {\r\n\r\n\t\t\t// render particles\r\n\r\n\t\t\tvar mode = _gl.POINTS;\r\n\r\n\t\t\tvar index = geometry.attributes.index;\r\n\r\n\t\t\tif ( index ) {\r\n\r\n\t\t\t\t// indexed points\r\n\r\n\t\t\t\tvar type, size;\r\n\r\n\t\t\t\tif ( index.array instanceof Uint32Array && extensions.get( 'OES_element_index_uint' ) ) {\r\n\r\n\t\t\t\t\ttype = _gl.UNSIGNED_INT;\r\n\t\t\t\t\tsize = 4;\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\ttype = _gl.UNSIGNED_SHORT;\r\n\t\t\t\t\tsize = 2;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar offsets = geometry.offsets;\r\n\r\n\t\t\t\tif ( offsets.length === 0 ) {\r\n\r\n\t\t\t\t\tif ( updateBuffers ) {\r\n\r\n\t\t\t\t\t\tsetupVertexAttributes( material, program, geometry, 0 );\r\n\t\t\t\t\t\t_gl.bindBuffer( _gl.ELEMENT_ARRAY_BUFFER, index.buffer );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t_gl.drawElements( mode, index.array.length, type, 0);\r\n\r\n\t\t\t\t\t_this.info.render.calls ++;\r\n\t\t\t\t\t_this.info.render.points += index.array.length;\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\t// if there is more than 1 chunk\r\n\t\t\t\t\t// must set attribute pointers to use new offsets for each chunk\r\n\t\t\t\t\t// even if geometry and materials didn't change\r\n\r\n\t\t\t\t\tif ( offsets.length > 1 ) updateBuffers = true;\r\n\r\n\t\t\t\t\tfor ( var i = 0, il = offsets.length; i < il; i ++ ) {\r\n\r\n\t\t\t\t\t\tvar startIndex = offsets[ i ].index;\r\n\r\n\t\t\t\t\t\tif ( updateBuffers ) {\r\n\r\n\t\t\t\t\t\t\tsetupVertexAttributes( material, program, geometry, startIndex );\r\n\t\t\t\t\t\t\t_gl.bindBuffer( _gl.ELEMENT_ARRAY_BUFFER, index.buffer );\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t// render indexed points\r\n\r\n\t\t\t\t\t\t_gl.drawElements( mode, offsets[ i ].count, type, offsets[ i ].start * size );\r\n\r\n\t\t\t\t\t\t_this.info.render.calls ++;\r\n\t\t\t\t\t\t_this.info.render.points += offsets[ i ].count;\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\t// non-indexed points\r\n\r\n\t\t\t\tif ( updateBuffers ) {\r\n\r\n\t\t\t\t\tsetupVertexAttributes( material, program, geometry, 0 );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar position = geometry.attributes.position;\r\n\t\t\t\tvar offsets = geometry.offsets;\r\n\r\n\t\t\t\tif ( offsets.length === 0 ) {\r\n\r\n\t\t\t\t\t_gl.drawArrays( mode, 0, position.array.length / 3 );\r\n\r\n\t\t\t\t\t_this.info.render.calls ++;\r\n\t\t\t\t\t_this.info.render.points += position.array.length / 3;\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\tfor ( var i = 0, il = offsets.length; i < il; i ++ ) {\r\n\r\n\t\t\t\t\t\t_gl.drawArrays( mode, offsets[ i ].index, offsets[ i ].count );\r\n\r\n\t\t\t\t\t\t_this.info.render.calls ++;\r\n\t\t\t\t\t\t_this.info.render.points += offsets[ i ].count;\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t} else if ( object instanceof THREE.Line ) {\r\n\r\n\t\t\tvar mode = ( object.mode === THREE.LineStrip ) ? _gl.LINE_STRIP : _gl.LINES;\r\n\r\n\t\t\tstate.setLineWidth( material.linewidth * pixelRatio );\r\n\r\n\t\t\tvar index = geometry.attributes.index;\r\n\r\n\t\t\tif ( index ) {\r\n\r\n\t\t\t\t// indexed lines\r\n\r\n\t\t\t\tvar type, size;\r\n\r\n\t\t\t\tif ( index.array instanceof Uint32Array ) {\r\n\r\n\t\t\t\t\ttype = _gl.UNSIGNED_INT;\r\n\t\t\t\t\tsize = 4;\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\ttype = _gl.UNSIGNED_SHORT;\r\n\t\t\t\t\tsize = 2;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar offsets = geometry.offsets;\r\n\r\n\t\t\t\tif ( offsets.length === 0 ) {\r\n\r\n\t\t\t\t\tif ( updateBuffers ) {\r\n\r\n\t\t\t\t\t\tsetupVertexAttributes( material, program, geometry, 0 );\r\n\t\t\t\t\t\t_gl.bindBuffer( _gl.ELEMENT_ARRAY_BUFFER, index.buffer );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t_gl.drawElements( mode, index.array.length, type, 0 ); // 2 bytes per Uint16Array\r\n\r\n\t\t\t\t\t_this.info.render.calls ++;\r\n\t\t\t\t\t_this.info.render.vertices += index.array.length; // not really true, here vertices can be shared\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\t// if there is more than 1 chunk\r\n\t\t\t\t\t// must set attribute pointers to use new offsets for each chunk\r\n\t\t\t\t\t// even if geometry and materials didn't change\r\n\r\n\t\t\t\t\tif ( offsets.length > 1 ) updateBuffers = true;\r\n\r\n\t\t\t\t\tfor ( var i = 0, il = offsets.length; i < il; i ++ ) {\r\n\r\n\t\t\t\t\t\tvar startIndex = offsets[ i ].index;\r\n\r\n\t\t\t\t\t\tif ( updateBuffers ) {\r\n\r\n\t\t\t\t\t\t\tsetupVertexAttributes( material, program, geometry, startIndex );\r\n\t\t\t\t\t\t\t_gl.bindBuffer( _gl.ELEMENT_ARRAY_BUFFER, index.buffer );\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t// render indexed lines\r\n\r\n\t\t\t\t\t\t_gl.drawElements( mode, offsets[ i ].count, type, offsets[ i ].start * size ); // 2 bytes per Uint16Array\r\n\r\n\t\t\t\t\t\t_this.info.render.calls ++;\r\n\t\t\t\t\t\t_this.info.render.vertices += offsets[ i ].count; // not really true, here vertices can be shared\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\t// non-indexed lines\r\n\r\n\t\t\t\tif ( updateBuffers ) {\r\n\r\n\t\t\t\t\tsetupVertexAttributes( material, program, geometry, 0 );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar position = geometry.attributes.position;\r\n\t\t\t\tvar offsets = geometry.offsets;\r\n\r\n\t\t\t\tif ( offsets.length === 0 ) {\r\n\r\n\t\t\t\t\t_gl.drawArrays( mode, 0, position.array.length / 3 );\r\n\r\n\t\t\t\t\t_this.info.render.calls ++;\r\n\t\t\t\t\t_this.info.render.vertices += position.array.length / 3;\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\tfor ( var i = 0, il = offsets.length; i < il; i ++ ) {\r\n\r\n\t\t\t\t\t\t_gl.drawArrays( mode, offsets[ i ].index, offsets[ i ].count );\r\n\r\n\t\t\t\t\t\t_this.info.render.calls ++;\r\n\t\t\t\t\t\t_this.info.render.vertices += offsets[ i ].count;\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t};\r\n\r\n\tthis.renderBuffer = function ( camera, lights, fog, material, geometryGroup, object ) {\r\n\r\n\t\tif ( material.visible === false ) return;\r\n\r\n\t\tupdateObject( object );\r\n\r\n\t\tvar program = setProgram( camera, lights, fog, material, object );\r\n\r\n\t\tvar attributes = program.attributes;\r\n\r\n\t\tvar updateBuffers = false,\r\n\t\t\twireframeBit = material.wireframe ? 1 : 0,\r\n\t\t\tgeometryProgram = geometryGroup.id + '_' + program.id + '_' + wireframeBit;\r\n\r\n\t\tif ( geometryProgram !== _currentGeometryProgram ) {\r\n\r\n\t\t\t_currentGeometryProgram = geometryProgram;\r\n\t\t\tupdateBuffers = true;\r\n\r\n\t\t}\r\n\r\n\t\tif ( updateBuffers ) {\r\n\r\n\t\t\tstate.initAttributes();\r\n\r\n\t\t}\r\n\r\n\t\t// vertices\r\n\r\n\t\tif ( ! material.morphTargets && attributes.position >= 0 ) {\r\n\r\n\t\t\tif ( updateBuffers ) {\r\n\r\n\t\t\t\t_gl.bindBuffer( _gl.ARRAY_BUFFER, geometryGroup.__webglVertexBuffer );\r\n\r\n\t\t\t\tstate.enableAttribute( attributes.position );\r\n\r\n\t\t\t\t_gl.vertexAttribPointer( attributes.position, 3, _gl.FLOAT, false, 0, 0 );\r\n\r\n\t\t\t}\r\n\r\n\t\t} else {\r\n\r\n\t\t\tif ( object.morphTargetBase ) {\r\n\r\n\t\t\t\tsetupMorphTargets( material, geometryGroup, object );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\r\n\t\tif ( updateBuffers ) {\r\n\r\n\t\t\t// custom attributes\r\n\r\n\t\t\t// Use the per-geometryGroup custom attribute arrays which are setup in initMeshBuffers\r\n\r\n\t\t\tif ( geometryGroup.__webglCustomAttributesList ) {\r\n\r\n\t\t\t\tfor ( var i = 0, il = geometryGroup.__webglCustomAttributesList.length; i < il; i ++ ) {\r\n\r\n\t\t\t\t\tvar attribute = geometryGroup.__webglCustomAttributesList[ i ];\r\n\r\n\t\t\t\t\tif ( attributes[ attribute.buffer.belongsToAttribute ] >= 0 ) {\r\n\r\n\t\t\t\t\t\t_gl.bindBuffer( _gl.ARRAY_BUFFER, attribute.buffer );\r\n\r\n\t\t\t\t\t\tstate.enableAttribute( attributes[ attribute.buffer.belongsToAttribute ] );\r\n\r\n\t\t\t\t\t\t_gl.vertexAttribPointer( attributes[ attribute.buffer.belongsToAttribute ], attribute.size, _gl.FLOAT, false, 0, 0 );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\r\n\t\t\t// colors\r\n\r\n\t\t\tif ( attributes.color >= 0 ) {\r\n\r\n\t\t\t\tif ( object.geometry.colors.length > 0 || object.geometry.faces.length > 0 ) {\r\n\r\n\t\t\t\t\t_gl.bindBuffer( _gl.ARRAY_BUFFER, geometryGroup.__webglColorBuffer );\r\n\r\n\t\t\t\t\tstate.enableAttribute( attributes.color );\r\n\r\n\t\t\t\t\t_gl.vertexAttribPointer( attributes.color, 3, _gl.FLOAT, false, 0, 0 );\r\n\r\n\t\t\t\t} else if ( material.defaultAttributeValues !== undefined ) {\r\n\r\n\r\n\t\t\t\t\t_gl.vertexAttrib3fv( attributes.color, material.defaultAttributeValues.color );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\t// normals\r\n\r\n\t\t\tif ( attributes.normal >= 0 ) {\r\n\r\n\t\t\t\t_gl.bindBuffer( _gl.ARRAY_BUFFER, geometryGroup.__webglNormalBuffer );\r\n\r\n\t\t\t\tstate.enableAttribute( attributes.normal );\r\n\r\n\t\t\t\t_gl.vertexAttribPointer( attributes.normal, 3, _gl.FLOAT, false, 0, 0 );\r\n\r\n\t\t\t}\r\n\r\n\t\t\t// tangents\r\n\r\n\t\t\tif ( attributes.tangent >= 0 ) {\r\n\r\n\t\t\t\t_gl.bindBuffer( _gl.ARRAY_BUFFER, geometryGroup.__webglTangentBuffer );\r\n\r\n\t\t\t\tstate.enableAttribute( attributes.tangent );\r\n\r\n\t\t\t\t_gl.vertexAttribPointer( attributes.tangent, 4, _gl.FLOAT, false, 0, 0 );\r\n\r\n\t\t\t}\r\n\r\n\t\t\t// uvs\r\n\r\n\t\t\tif ( attributes.uv >= 0 ) {\r\n\r\n\t\t\t\tif ( object.geometry.faceVertexUvs[ 0 ] ) {\r\n\r\n\t\t\t\t\t_gl.bindBuffer( _gl.ARRAY_BUFFER, geometryGroup.__webglUVBuffer );\r\n\r\n\t\t\t\t\tstate.enableAttribute( attributes.uv );\r\n\r\n\t\t\t\t\t_gl.vertexAttribPointer( attributes.uv, 2, _gl.FLOAT, false, 0, 0 );\r\n\r\n\t\t\t\t} else if ( material.defaultAttributeValues !== undefined ) {\r\n\r\n\r\n\t\t\t\t\t_gl.vertexAttrib2fv( attributes.uv, material.defaultAttributeValues.uv );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( attributes.uv2 >= 0 ) {\r\n\r\n\t\t\t\tif ( object.geometry.faceVertexUvs[ 1 ] ) {\r\n\r\n\t\t\t\t\t_gl.bindBuffer( _gl.ARRAY_BUFFER, geometryGroup.__webglUV2Buffer );\r\n\r\n\t\t\t\t\tstate.enableAttribute( attributes.uv2 );\r\n\r\n\t\t\t\t\t_gl.vertexAttribPointer( attributes.uv2, 2, _gl.FLOAT, false, 0, 0 );\r\n\r\n\t\t\t\t} else if ( material.defaultAttributeValues !== undefined ) {\r\n\r\n\r\n\t\t\t\t\t_gl.vertexAttrib2fv( attributes.uv2, material.defaultAttributeValues.uv2 );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( material.skinning &&\r\n\t\t\t\t attributes.skinIndex >= 0 && attributes.skinWeight >= 0 ) {\r\n\r\n\t\t\t\t_gl.bindBuffer( _gl.ARRAY_BUFFER, geometryGroup.__webglSkinIndicesBuffer );\r\n\r\n\t\t\t\tstate.enableAttribute( attributes.skinIndex );\r\n\r\n\t\t\t\t_gl.vertexAttribPointer( attributes.skinIndex, 4, _gl.FLOAT, false, 0, 0 );\r\n\r\n\t\t\t\t_gl.bindBuffer( _gl.ARRAY_BUFFER, geometryGroup.__webglSkinWeightsBuffer );\r\n\r\n\t\t\t\tstate.enableAttribute( attributes.skinWeight );\r\n\r\n\t\t\t\t_gl.vertexAttribPointer( attributes.skinWeight, 4, _gl.FLOAT, false, 0, 0 );\r\n\r\n\t\t\t}\r\n\r\n\t\t\t// line distances\r\n\r\n\t\t\tif ( attributes.lineDistance >= 0 ) {\r\n\r\n\t\t\t\t_gl.bindBuffer( _gl.ARRAY_BUFFER, geometryGroup.__webglLineDistanceBuffer );\r\n\r\n\t\t\t\tstate.enableAttribute( attributes.lineDistance );\r\n\r\n\t\t\t\t_gl.vertexAttribPointer( attributes.lineDistance, 1, _gl.FLOAT, false, 0, 0 );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tstate.disableUnusedAttributes();\r\n\r\n\t\t// render mesh\r\n\r\n\t\tif ( object instanceof THREE.Mesh ) {\r\n\r\n\t\t\tvar type = geometryGroup.__typeArray === Uint32Array ? _gl.UNSIGNED_INT : _gl.UNSIGNED_SHORT;\r\n\r\n\t\t\t// wireframe\r\n\r\n\t\t\tif ( material.wireframe ) {\r\n\r\n\t\t\t\tstate.setLineWidth( material.wireframeLinewidth * pixelRatio );\r\n\r\n\t\t\t\tif ( updateBuffers ) _gl.bindBuffer( _gl.ELEMENT_ARRAY_BUFFER, geometryGroup.__webglLineBuffer );\r\n\t\t\t\t_gl.drawElements( _gl.LINES, geometryGroup.__webglLineCount, type, 0 );\r\n\r\n\t\t\t// triangles\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tif ( updateBuffers ) _gl.bindBuffer( _gl.ELEMENT_ARRAY_BUFFER, geometryGroup.__webglFaceBuffer );\r\n\t\t\t\t_gl.drawElements( _gl.TRIANGLES, geometryGroup.__webglFaceCount, type, 0 );\r\n\r\n\t\t\t}\r\n\r\n\t\t\t_this.info.render.calls ++;\r\n\t\t\t_this.info.render.vertices += geometryGroup.__webglFaceCount;\r\n\t\t\t_this.info.render.faces += geometryGroup.__webglFaceCount / 3;\r\n\r\n\t\t// render lines\r\n\r\n\t\t} else if ( object instanceof THREE.Line ) {\r\n\r\n\t\t\tvar mode = ( object.mode === THREE.LineStrip ) ? _gl.LINE_STRIP : _gl.LINES;\r\n\r\n\t\t\tstate.setLineWidth( material.linewidth * pixelRatio );\r\n\r\n\t\t\t_gl.drawArrays( mode, 0, geometryGroup.__webglLineCount );\r\n\r\n\t\t\t_this.info.render.calls ++;\r\n\r\n\t\t// render particles\r\n\r\n\t\t} else if ( object instanceof THREE.PointCloud ) {\r\n\r\n\t\t\t_gl.drawArrays( _gl.POINTS, 0, geometryGroup.__webglParticleCount );\r\n\r\n\t\t\t_this.info.render.calls ++;\r\n\t\t\t_this.info.render.points += geometryGroup.__webglParticleCount;\r\n\r\n\t\t}\r\n\r\n\t};\r\n\r\n\tfunction setupMorphTargets ( material, geometryGroup, object ) {\r\n\r\n\t\t// set base\r\n\r\n\t\tvar attributes = material.program.attributes;\r\n\r\n\t\tif ( object.morphTargetBase !== - 1 && attributes.position >= 0 ) {\r\n\r\n\t\t\t_gl.bindBuffer( _gl.ARRAY_BUFFER, geometryGroup.__webglMorphTargetsBuffers[ object.morphTargetBase ] );\r\n\r\n\t\t\tstate.enableAttribute( attributes.position );\r\n\r\n\t\t\t_gl.vertexAttribPointer( attributes.position, 3, _gl.FLOAT, false, 0, 0 );\r\n\r\n\t\t} else if ( attributes.position >= 0 ) {\r\n\r\n\t\t\t_gl.bindBuffer( _gl.ARRAY_BUFFER, geometryGroup.__webglVertexBuffer );\r\n\r\n\t\t\tstate.enableAttribute( attributes.position );\r\n\r\n\t\t\t_gl.vertexAttribPointer( attributes.position, 3, _gl.FLOAT, false, 0, 0 );\r\n\r\n\t\t}\r\n\r\n\t\tif ( object.morphTargetForcedOrder.length ) {\r\n\r\n\t\t\t// set forced order\r\n\r\n\t\t\tvar m = 0;\r\n\t\t\tvar order = object.morphTargetForcedOrder;\r\n\t\t\tvar influences = object.morphTargetInfluences;\r\n\r\n\t\t\tvar attribute;\r\n\r\n\t\t\twhile ( m < material.numSupportedMorphTargets && m < order.length ) {\r\n\r\n\t\t\t\tattribute = attributes[ 'morphTarget' + m ];\r\n\r\n\t\t\t\tif ( attribute >= 0 ) {\r\n\r\n\t\t\t\t\t_gl.bindBuffer( _gl.ARRAY_BUFFER, geometryGroup.__webglMorphTargetsBuffers[ order[ m ] ] );\r\n\r\n\t\t\t\t\tstate.enableAttribute( attribute );\r\n\r\n\t\t\t\t\t_gl.vertexAttribPointer( attribute, 3, _gl.FLOAT, false, 0, 0 );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tattribute = attributes[ 'morphNormal' + m ];\r\n\r\n\t\t\t\tif ( attribute >= 0 && material.morphNormals ) {\r\n\r\n\t\t\t\t\t_gl.bindBuffer( _gl.ARRAY_BUFFER, geometryGroup.__webglMorphNormalsBuffers[ order[ m ] ] );\r\n\r\n\t\t\t\t\tstate.enableAttribute( attribute );\r\n\r\n\t\t\t\t\t_gl.vertexAttribPointer( attribute, 3, _gl.FLOAT, false, 0, 0 );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tobject.__webglMorphTargetInfluences[ m ] = influences[ order[ m ] ];\r\n\r\n\t\t\t\tm ++;\r\n\r\n\t\t\t}\r\n\r\n\t\t} else {\r\n\r\n\t\t\t// find the most influencing\r\n\r\n\t\t\tvar activeInfluenceIndices = [];\r\n\t\t\tvar influences = object.morphTargetInfluences;\r\n\t\t\tvar morphTargets = object.geometry.morphTargets;\r\n\r\n\t\t\tif ( influences.length > morphTargets.length ) {\r\n\r\n\t\t\t\tconsole.warn( 'THREE.WebGLRenderer: Influences array is bigger than morphTargets array.' );\r\n\t\t\t\tinfluences.length = morphTargets.length;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tfor ( var i = 0, il = influences.length; i < il; i ++ ) {\r\n\r\n\t\t\t\tvar influence = influences[ i ];\r\n\r\n\t\t\t\tactiveInfluenceIndices.push( [ influence, i ] );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( activeInfluenceIndices.length > material.numSupportedMorphTargets ) {\r\n\r\n\t\t\t\tactiveInfluenceIndices.sort( numericalSort );\r\n\t\t\t\tactiveInfluenceIndices.length = material.numSupportedMorphTargets;\r\n\r\n\t\t\t} else if ( activeInfluenceIndices.length > material.numSupportedMorphNormals ) {\r\n\r\n\t\t\t\tactiveInfluenceIndices.sort( numericalSort );\r\n\r\n\t\t\t} else if ( activeInfluenceIndices.length === 0 ) {\r\n\r\n\t\t\t\tactiveInfluenceIndices.push( [ 0, 0 ] );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tvar attribute;\r\n\r\n\t\t\tfor ( var m = 0, ml = material.numSupportedMorphTargets; m < ml; m ++ ) {\r\n\r\n\t\t\t\tif ( activeInfluenceIndices[ m ] ) {\r\n\r\n\t\t\t\t\tvar influenceIndex = activeInfluenceIndices[ m ][ 1 ];\r\n\r\n\t\t\t\t\tattribute = attributes[ 'morphTarget' + m ];\r\n\r\n\t\t\t\t\tif ( attribute >= 0 ) {\r\n\r\n\t\t\t\t\t\t_gl.bindBuffer( _gl.ARRAY_BUFFER, geometryGroup.__webglMorphTargetsBuffers[ influenceIndex ] );\r\n\r\n\t\t\t\t\t\tstate.enableAttribute( attribute );\r\n\r\n\t\t\t\t\t\t_gl.vertexAttribPointer( attribute, 3, _gl.FLOAT, false, 0, 0 );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tattribute = attributes[ 'morphNormal' + m ];\r\n\r\n\t\t\t\t\tif ( attribute >= 0 && material.morphNormals ) {\r\n\r\n\t\t\t\t\t\t_gl.bindBuffer( _gl.ARRAY_BUFFER, geometryGroup.__webglMorphNormalsBuffers[ influenceIndex ] );\r\n\r\n\t\t\t\t\t\tstate.enableAttribute( attribute );\r\n\r\n\t\t\t\t\t\t_gl.vertexAttribPointer( attribute, 3, _gl.FLOAT, false, 0, 0 );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tobject.__webglMorphTargetInfluences[ m ] = influences[ influenceIndex ];\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\t/*\r\n\t\t\t\t\t_gl.vertexAttribPointer( attributes[ \"morphTarget\" + m ], 3, _gl.FLOAT, false, 0, 0 );\r\n\r\n\t\t\t\t\tif ( material.morphNormals ) {\r\n\r\n\t\t\t\t\t\t_gl.vertexAttribPointer( attributes[ \"morphNormal\" + m ], 3, _gl.FLOAT, false, 0, 0 );\r\n\r\n\t\t\t\t\t}\r\n\t\t\t\t\t*/\r\n\r\n\t\t\t\t\tobject.__webglMorphTargetInfluences[ m ] = 0;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\t// load updated influences uniform\r\n\r\n\t\tif ( material.program.uniforms.morphTargetInfluences !== null ) {\r\n\r\n\t\t\t_gl.uniform1fv( material.program.uniforms.morphTargetInfluences, object.__webglMorphTargetInfluences );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\t// Sorting\r\n\r\n\tfunction painterSortStable ( a, b ) {\r\n\r\n\t\tif ( a.object.renderOrder !== b.object.renderOrder ) {\r\n\r\n\t\t\treturn a.object.renderOrder - b.object.renderOrder;\r\n\r\n\t\t} else if ( a.material.id !== b.material.id ) {\r\n\r\n\t\t\treturn a.material.id - b.material.id;\r\n\r\n\t\t} else if ( a.z !== b.z ) {\r\n\r\n\t\t\treturn a.z - b.z;\r\n\r\n\t\t} else {\r\n\r\n\t\t\treturn a.id - b.id;\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tfunction reversePainterSortStable ( a, b ) {\r\n\r\n\t\tif ( a.object.renderOrder !== b.object.renderOrder ) {\r\n\r\n\t\t\treturn a.object.renderOrder - b.object.renderOrder;\r\n\r\n\t\t} if ( a.z !== b.z ) {\r\n\r\n\t\t\treturn b.z - a.z;\r\n\r\n\t\t} else {\r\n\r\n\t\t\treturn a.id - b.id;\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tfunction numericalSort ( a, b ) {\r\n\r\n\t\treturn b[ 0 ] - a[ 0 ];\r\n\r\n\t}\r\n\r\n\t// Rendering\r\n\r\n\tthis.render = function ( scene, camera, renderTarget, forceClear ) {\r\n\r\n\t\tif ( camera instanceof THREE.Camera === false ) {\r\n\r\n\t\t\tTHREE.error( 'THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.' );\r\n\t\t\treturn;\r\n\r\n\t\t}\r\n\r\n\t\tvar fog = scene.fog;\r\n\r\n\t\t// reset caching for this frame\r\n\r\n\t\t_currentGeometryProgram = '';\r\n\t\t_currentMaterialId = - 1;\r\n\t\t_currentCamera = null;\r\n\t\t_lightsNeedUpdate = true;\r\n\r\n\t\t// update scene graph\r\n\r\n\t\tif ( scene.autoUpdate === true ) scene.updateMatrixWorld();\r\n\r\n\t\t// update camera matrices and frustum\r\n\r\n\t\tif ( camera.parent === undefined ) camera.updateMatrixWorld();\r\n\r\n\t\t// update Skeleton objects\r\n\r\n\t\tscene.traverse( function ( object ) {\r\n\r\n\t\t\tif ( object instanceof THREE.SkinnedMesh ) {\r\n\r\n\t\t\t\tobject.skeleton.update();\r\n\r\n\t\t\t}\r\n\r\n\t\t} );\r\n\r\n\t\tcamera.matrixWorldInverse.getInverse( camera.matrixWorld );\r\n\r\n\t\t_projScreenMatrix.multiplyMatrices( camera.projectionMatrix, camera.matrixWorldInverse );\r\n\t\t_frustum.setFromMatrix( _projScreenMatrix );\r\n\r\n\t\tlights.length = 0;\r\n\t\topaqueObjects.length = 0;\r\n\t\ttransparentObjects.length = 0;\r\n\r\n\t\tsprites.length = 0;\r\n\t\tlensFlares.length = 0;\r\n\r\n\t\tprojectObject( scene );\r\n\r\n\t\tif ( _this.sortObjects === true ) {\r\n\r\n\t\t\topaqueObjects.sort( painterSortStable );\r\n\t\t\ttransparentObjects.sort( reversePainterSortStable );\r\n\r\n\t\t}\r\n\r\n\t\t// custom render plugins (pre pass)\r\n\r\n\t\tshadowMapPlugin.render( scene, camera );\r\n\r\n\t\t//\r\n\r\n\t\t_this.info.render.calls = 0;\r\n\t\t_this.info.render.vertices = 0;\r\n\t\t_this.info.render.faces = 0;\r\n\t\t_this.info.render.points = 0;\r\n\r\n\t\tthis.setRenderTarget( renderTarget );\r\n\r\n\t\tif ( this.autoClear || forceClear ) {\r\n\r\n\t\t\tthis.clear( this.autoClearColor, this.autoClearDepth, this.autoClearStencil );\r\n\r\n\t\t}\r\n\r\n\t\t// set matrices for immediate objects\r\n\r\n\t\tfor ( var i = 0, il = _webglObjectsImmediate.length; i < il; i ++ ) {\r\n\r\n\t\t\tvar webglObject = _webglObjectsImmediate[ i ];\r\n\t\t\tvar object = webglObject.object;\r\n\r\n\t\t\tif ( object.visible ) {\r\n\r\n\t\t\t\tsetupMatrices( object, camera );\r\n\r\n\t\t\t\tunrollImmediateBufferMaterial( webglObject );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tif ( scene.overrideMaterial ) {\r\n\r\n\t\t\tvar overrideMaterial = scene.overrideMaterial;\r\n\r\n\t\t\tsetMaterial( overrideMaterial );\r\n\r\n\t\t\trenderObjects( opaqueObjects, camera, lights, fog, overrideMaterial );\r\n\t\t\trenderObjects( transparentObjects, camera, lights, fog, overrideMaterial );\r\n\t\t\trenderObjectsImmediate( _webglObjectsImmediate, '', camera, lights, fog, overrideMaterial );\r\n\r\n\t\t} else {\r\n\r\n\t\t\t// opaque pass (front-to-back order)\r\n\r\n\t\t\tstate.setBlending( THREE.NoBlending );\r\n\r\n\t\t\trenderObjects( opaqueObjects, camera, lights, fog, null );\r\n\t\t\trenderObjectsImmediate( _webglObjectsImmediate, 'opaque', camera, lights, fog, null );\r\n\r\n\t\t\t// transparent pass (back-to-front order)\r\n\r\n\t\t\trenderObjects( transparentObjects, camera, lights, fog, null );\r\n\t\t\trenderObjectsImmediate( _webglObjectsImmediate, 'transparent', camera, lights, fog, null );\r\n\r\n\t\t}\r\n\r\n\t\t// custom render plugins (post pass)\r\n\r\n\t\tspritePlugin.render( scene, camera );\r\n\t\tlensFlarePlugin.render( scene, camera, _currentWidth, _currentHeight );\r\n\r\n\t\t// Generate mipmap if we're using any kind of mipmap filtering\r\n\r\n\t\tif ( renderTarget && renderTarget.generateMipmaps && renderTarget.minFilter !== THREE.NearestFilter && renderTarget.minFilter !== THREE.LinearFilter ) {\r\n\r\n\t\t\tupdateRenderTargetMipmap( renderTarget );\r\n\r\n\t\t}\r\n\r\n\t\t// Ensure depth buffer writing is enabled so it can be cleared on next render\r\n\r\n\t\tstate.setDepthTest( true );\r\n\t\tstate.setDepthWrite( true );\r\n\t\tstate.setColorWrite( true );\r\n\r\n\t\t// _gl.finish();\r\n\r\n\t};\r\n\r\n\tfunction projectObject( object ) {\r\n\r\n\t\tif ( object.visible === false ) return;\r\n\r\n\t\tif ( object instanceof THREE.Scene || object instanceof THREE.Group ) {\r\n\r\n\t\t\t// skip\r\n\r\n\t\t} else {\r\n\r\n\t\t\tinitObject( object );\r\n\r\n\t\t\tif ( object instanceof THREE.Light ) {\r\n\r\n\t\t\t\tlights.push( object );\r\n\r\n\t\t\t} else if ( object instanceof THREE.Sprite ) {\r\n\r\n\t\t\t\tsprites.push( object );\r\n\r\n\t\t\t} else if ( object instanceof THREE.LensFlare ) {\r\n\r\n\t\t\t\tlensFlares.push( object );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tvar webglObjects = _webglObjects[ object.id ];\r\n\r\n\t\t\t\tif ( webglObjects && ( object.frustumCulled === false || _frustum.intersectsObject( object ) === true ) ) {\r\n\r\n\t\t\t\t\tfor ( var i = 0, l = webglObjects.length; i < l; i ++ ) {\r\n\r\n\t\t\t\t\t\tvar webglObject = webglObjects[ i ];\r\n\r\n\t\t\t\t\t\tunrollBufferMaterial( webglObject );\r\n\r\n\t\t\t\t\t\twebglObject.render = true;\r\n\r\n\t\t\t\t\t\tif ( _this.sortObjects === true ) {\r\n\r\n\t\t\t\t\t\t\t_vector3.setFromMatrixPosition( object.matrixWorld );\r\n\t\t\t\t\t\t\t_vector3.applyProjection( _projScreenMatrix );\r\n\r\n\t\t\t\t\t\t\twebglObject.z = _vector3.z;\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tfor ( var i = 0, l = object.children.length; i < l; i ++ ) {\r\n\r\n\t\t\tprojectObject( object.children[ i ] );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tfunction renderObjects( renderList, camera, lights, fog, overrideMaterial ) {\r\n\r\n\t\tvar material;\r\n\r\n\t\tfor ( var i = 0, l = renderList.length; i < l; i ++ ) {\r\n\r\n\t\t\tvar webglObject = renderList[ i ];\r\n\r\n\t\t\tvar object = webglObject.object;\r\n\t\t\tvar buffer = webglObject.buffer;\r\n\r\n\t\t\tsetupMatrices( object, camera );\r\n\r\n\t\t\tif ( overrideMaterial ) {\r\n\r\n\t\t\t\tmaterial = overrideMaterial;\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tmaterial = webglObject.material;\r\n\r\n\t\t\t\tif ( ! material ) continue;\r\n\r\n\t\t\t\tsetMaterial( material );\r\n\r\n\t\t\t}\r\n\r\n\t\t\t_this.setMaterialFaces( material );\r\n\r\n\t\t\tif ( buffer instanceof THREE.BufferGeometry ) {\r\n\r\n\t\t\t\t_this.renderBufferDirect( camera, lights, fog, material, buffer, object );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\t_this.renderBuffer( camera, lights, fog, material, buffer, object );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tfunction renderObjectsImmediate ( renderList, materialType, camera, lights, fog, overrideMaterial ) {\r\n\r\n\t\tvar material;\r\n\r\n\t\tfor ( var i = 0, l = renderList.length; i < l; i ++ ) {\r\n\r\n\t\t\tvar webglObject = renderList[ i ];\r\n\t\t\tvar object = webglObject.object;\r\n\r\n\t\t\tif ( object.visible ) {\r\n\r\n\t\t\t\tif ( overrideMaterial ) {\r\n\r\n\t\t\t\t\tmaterial = overrideMaterial;\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\tmaterial = webglObject[ materialType ];\r\n\r\n\t\t\t\t\tif ( ! material ) continue;\r\n\r\n\t\t\t\t\tsetMaterial( material );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\t_this.renderImmediateObject( camera, lights, fog, material, object );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tthis.renderImmediateObject = function ( camera, lights, fog, material, object ) {\r\n\r\n\t\tvar program = setProgram( camera, lights, fog, material, object );\r\n\r\n\t\t_currentGeometryProgram = '';\r\n\r\n\t\t_this.setMaterialFaces( material );\r\n\r\n\t\tif ( object.immediateRenderCallback ) {\r\n\r\n\t\t\tobject.immediateRenderCallback( program, _gl, _frustum );\r\n\r\n\t\t} else {\r\n\r\n\t\t\tobject.render( function ( object ) { _this.renderBufferImmediate( object, program, material ); } );\r\n\r\n\t\t}\r\n\r\n\t};\r\n\r\n\tfunction unrollImmediateBufferMaterial ( globject ) {\r\n\r\n\t\tvar object = globject.object,\r\n\t\t\tmaterial = object.material;\r\n\r\n\t\tif ( material.transparent ) {\r\n\r\n\t\t\tglobject.transparent = material;\r\n\t\t\tglobject.opaque = null;\r\n\r\n\t\t} else {\r\n\r\n\t\t\tglobject.opaque = material;\r\n\t\t\tglobject.transparent = null;\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tfunction unrollBufferMaterial ( globject ) {\r\n\r\n\t\tvar object = globject.object;\r\n\t\tvar buffer = globject.buffer;\r\n\r\n\t\tvar geometry = object.geometry;\r\n\t\tvar material = object.material;\r\n\r\n\t\tif ( material instanceof THREE.MeshFaceMaterial ) {\r\n\r\n\t\t\tvar materialIndex = geometry instanceof THREE.BufferGeometry ? 0 : buffer.materialIndex;\r\n\r\n\t\t\tmaterial = material.materials[ materialIndex ];\r\n\r\n\t\t\tglobject.material = material;\r\n\r\n\t\t\tif ( material.transparent ) {\r\n\r\n\t\t\t\ttransparentObjects.push( globject );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\topaqueObjects.push( globject );\r\n\r\n\t\t\t}\r\n\r\n\t\t} else if ( material ) {\r\n\r\n\t\t\tglobject.material = material;\r\n\r\n\t\t\tif ( material.transparent ) {\r\n\r\n\t\t\t\ttransparentObjects.push( globject );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\topaqueObjects.push( globject );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tfunction initObject( object ) {\r\n\r\n\t\tif ( object.__webglInit === undefined ) {\r\n\r\n\t\t\tobject.__webglInit = true;\r\n\t\t\tobject._modelViewMatrix = new THREE.Matrix4();\r\n\t\t\tobject._normalMatrix = new THREE.Matrix3();\r\n\r\n\t\t\tobject.addEventListener( 'removed', onObjectRemoved );\r\n\r\n\t\t}\r\n\r\n\t\tvar geometry = object.geometry;\r\n\r\n\t\tif ( geometry === undefined ) {\r\n\r\n\t\t\t// ImmediateRenderObject\r\n\r\n\t\t} else if ( geometry.__webglInit === undefined ) {\r\n\r\n\t\t\tgeometry.__webglInit = true;\r\n\t\t\tgeometry.addEventListener( 'dispose', onGeometryDispose );\r\n\r\n\t\t\tif ( geometry instanceof THREE.BufferGeometry ) {\r\n\r\n\t\t\t\t_this.info.memory.geometries ++;\r\n\r\n\t\t\t} else if ( object instanceof THREE.Mesh ) {\r\n\r\n\t\t\t\tinitGeometryGroups( object, geometry );\r\n\r\n\t\t\t} else if ( object instanceof THREE.Line ) {\r\n\r\n\t\t\t\tif ( geometry.__webglVertexBuffer === undefined ) {\r\n\r\n\t\t\t\t\tcreateLineBuffers( geometry );\r\n\t\t\t\t\tinitLineBuffers( geometry, object );\r\n\r\n\t\t\t\t\tgeometry.verticesNeedUpdate = true;\r\n\t\t\t\t\tgeometry.colorsNeedUpdate = true;\r\n\t\t\t\t\tgeometry.lineDistancesNeedUpdate = true;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t} else if ( object instanceof THREE.PointCloud ) {\r\n\r\n\t\t\t\tif ( geometry.__webglVertexBuffer === undefined ) {\r\n\r\n\t\t\t\t\tcreateParticleBuffers( geometry );\r\n\t\t\t\t\tinitParticleBuffers( geometry, object );\r\n\r\n\t\t\t\t\tgeometry.verticesNeedUpdate = true;\r\n\t\t\t\t\tgeometry.colorsNeedUpdate = true;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tif ( object.__webglActive === undefined) {\r\n\r\n\t\t\tobject.__webglActive = true;\r\n\r\n\t\t\tif ( object instanceof THREE.Mesh ) {\r\n\r\n\t\t\t\tif ( geometry instanceof THREE.BufferGeometry ) {\r\n\r\n\t\t\t\t\taddBuffer( _webglObjects, geometry, object );\r\n\r\n\t\t\t\t} else if ( geometry instanceof THREE.Geometry ) {\r\n\r\n\t\t\t\t\tvar geometryGroupsList = geometryGroups[ geometry.id ];\r\n\r\n\t\t\t\t\tfor ( var i = 0,l = geometryGroupsList.length; i < l; i ++ ) {\r\n\r\n\t\t\t\t\t\taddBuffer( _webglObjects, geometryGroupsList[ i ], object );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t} else if ( object instanceof THREE.Line || object instanceof THREE.PointCloud ) {\r\n\r\n\t\t\t\taddBuffer( _webglObjects, geometry, object );\r\n\r\n\t\t\t} else if ( object instanceof THREE.ImmediateRenderObject || object.immediateRenderCallback ) {\r\n\r\n\t\t\t\taddBufferImmediate( _webglObjectsImmediate, object );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\t// Geometry splitting\r\n\r\n\tvar geometryGroups = {};\r\n\tvar geometryGroupCounter = 0;\r\n\r\n\tfunction makeGroups( geometry, usesFaceMaterial ) {\r\n\r\n\t\tvar maxVerticesInGroup = extensions.get( 'OES_element_index_uint' ) ? 4294967296 : 65535;\r\n\r\n\t\tvar groupHash, hash_map = {};\r\n\r\n\t\tvar numMorphTargets = geometry.morphTargets.length;\r\n\t\tvar numMorphNormals = geometry.morphNormals.length;\r\n\r\n\t\tvar group;\r\n\t\tvar groups = {};\r\n\t\tvar groupsList = [];\r\n\r\n\t\tfor ( var f = 0, fl = geometry.faces.length; f < fl; f ++ ) {\r\n\r\n\t\t\tvar face = geometry.faces[ f ];\r\n\t\t\tvar materialIndex = usesFaceMaterial ? face.materialIndex : 0;\r\n\r\n\t\t\tif ( ! ( materialIndex in hash_map ) ) {\r\n\r\n\t\t\t\thash_map[ materialIndex ] = { hash: materialIndex, counter: 0 };\r\n\r\n\t\t\t}\r\n\r\n\t\t\tgroupHash = hash_map[ materialIndex ].hash + '_' + hash_map[ materialIndex ].counter;\r\n\r\n\t\t\tif ( ! ( groupHash in groups ) ) {\r\n\r\n\t\t\t\tgroup = {\r\n\t\t\t\t\tid: geometryGroupCounter ++,\r\n\t\t\t\t\tfaces3: [],\r\n\t\t\t\t\tmaterialIndex: materialIndex,\r\n\t\t\t\t\tvertices: 0,\r\n\t\t\t\t\tnumMorphTargets: numMorphTargets,\r\n\t\t\t\t\tnumMorphNormals: numMorphNormals\r\n\t\t\t\t};\r\n\r\n\t\t\t\tgroups[ groupHash ] = group;\r\n\t\t\t\tgroupsList.push( group );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( groups[ groupHash ].vertices + 3 > maxVerticesInGroup ) {\r\n\r\n\t\t\t\thash_map[ materialIndex ].counter += 1;\r\n\t\t\t\tgroupHash = hash_map[ materialIndex ].hash + '_' + hash_map[ materialIndex ].counter;\r\n\r\n\t\t\t\tif ( ! ( groupHash in groups ) ) {\r\n\r\n\t\t\t\t\tgroup = {\r\n\t\t\t\t\t\tid: geometryGroupCounter ++,\r\n\t\t\t\t\t\tfaces3: [],\r\n\t\t\t\t\t\tmaterialIndex: materialIndex,\r\n\t\t\t\t\t\tvertices: 0,\r\n\t\t\t\t\t\tnumMorphTargets: numMorphTargets,\r\n\t\t\t\t\t\tnumMorphNormals: numMorphNormals\r\n\t\t\t\t\t};\r\n\r\n\t\t\t\t\tgroups[ groupHash ] = group;\r\n\t\t\t\t\tgroupsList.push( group );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\tgroups[ groupHash ].faces3.push( f );\r\n\t\t\tgroups[ groupHash ].vertices += 3;\r\n\r\n\t\t}\r\n\r\n\t\treturn groupsList;\r\n\r\n\t}\r\n\r\n\tfunction initGeometryGroups( object, geometry ) {\r\n\r\n\t\tvar material = object.material, addBuffers = false;\r\n\r\n\t\tif ( geometryGroups[ geometry.id ] === undefined || geometry.groupsNeedUpdate === true ) {\r\n\r\n\t\t\tdelete _webglObjects[ object.id ];\r\n\r\n\t\t\tgeometryGroups[ geometry.id ] = makeGroups( geometry, material instanceof THREE.MeshFaceMaterial );\r\n\r\n\t\t\tgeometry.groupsNeedUpdate = false;\r\n\r\n\t\t}\r\n\r\n\t\tvar geometryGroupsList = geometryGroups[ geometry.id ];\r\n\r\n\t\t// create separate VBOs per geometry chunk\r\n\r\n\t\tfor ( var i = 0, il = geometryGroupsList.length; i < il; i ++ ) {\r\n\r\n\t\t\tvar geometryGroup = geometryGroupsList[ i ];\r\n\r\n\t\t\t// initialise VBO on the first access\r\n\r\n\t\t\tif ( geometryGroup.__webglVertexBuffer === undefined ) {\r\n\r\n\t\t\t\tcreateMeshBuffers( geometryGroup );\r\n\t\t\t\tinitMeshBuffers( geometryGroup, object );\r\n\r\n\t\t\t\tgeometry.verticesNeedUpdate = true;\r\n\t\t\t\tgeometry.morphTargetsNeedUpdate = true;\r\n\t\t\t\tgeometry.elementsNeedUpdate = true;\r\n\t\t\t\tgeometry.uvsNeedUpdate = true;\r\n\t\t\t\tgeometry.normalsNeedUpdate = true;\r\n\t\t\t\tgeometry.tangentsNeedUpdate = true;\r\n\t\t\t\tgeometry.colorsNeedUpdate = true;\r\n\r\n\t\t\t\taddBuffers = true;\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\taddBuffers = false;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( addBuffers || object.__webglActive === undefined ) {\r\n\r\n\t\t\t\taddBuffer( _webglObjects, geometryGroup, object );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tobject.__webglActive = true;\r\n\r\n\t}\r\n\r\n\tfunction addBuffer( objlist, buffer, object ) {\r\n\r\n\t\tvar id = object.id;\r\n\t\tobjlist[id] = objlist[id] || [];\r\n\t\tobjlist[id].push(\r\n\t\t\t{\r\n\t\t\t\tid: id,\r\n\t\t\t\tbuffer: buffer,\r\n\t\t\t\tobject: object,\r\n\t\t\t\tmaterial: null,\r\n\t\t\t\tz: 0\r\n\t\t\t}\r\n\t\t);\r\n\r\n\t};\r\n\r\n\tfunction addBufferImmediate( objlist, object ) {\r\n\r\n\t\tobjlist.push(\r\n\t\t\t{\r\n\t\t\t\tid: null,\r\n\t\t\t\tobject: object,\r\n\t\t\t\topaque: null,\r\n\t\t\t\ttransparent: null,\r\n\t\t\t\tz: 0\r\n\t\t\t}\r\n\t\t);\r\n\r\n\t};\r\n\r\n\t// Objects updates\r\n\r\n\tfunction updateObject( object ) {\r\n\r\n\t\tvar geometry = object.geometry;\r\n\r\n\t\tif ( geometry instanceof THREE.BufferGeometry ) {\r\n\r\n\t\t\tvar attributes = geometry.attributes;\r\n\t\t\tvar attributesKeys = geometry.attributesKeys;\r\n\r\n\t\t\tfor ( var i = 0, l = attributesKeys.length; i < l; i ++ ) {\r\n\r\n\t\t\t\tvar key = attributesKeys[ i ];\r\n\t\t\t\tvar attribute = attributes[ key ];\r\n\t\t\t\tvar bufferType = ( key === 'index' ) ? _gl.ELEMENT_ARRAY_BUFFER : _gl.ARRAY_BUFFER;\r\n\r\n\t\t\t\tif ( attribute.buffer === undefined ) {\r\n\r\n\t\t\t\t\tattribute.buffer = _gl.createBuffer();\r\n\t\t\t\t\t_gl.bindBuffer( bufferType, attribute.buffer );\r\n\t\t\t\t\t_gl.bufferData( bufferType, attribute.array, ( attribute instanceof THREE.DynamicBufferAttribute ) ? _gl.DYNAMIC_DRAW : _gl.STATIC_DRAW );\r\n\r\n\t\t\t\t\tattribute.needsUpdate = false;\r\n\r\n\t\t\t\t} else if ( attribute.needsUpdate === true ) {\r\n\r\n\t\t\t\t\t_gl.bindBuffer( bufferType, attribute.buffer );\r\n\r\n\t\t\t\t\tif ( attribute.updateRange === undefined || attribute.updateRange.count === -1 ) { // Not using update ranges\r\n\r\n\t\t\t\t\t\t_gl.bufferSubData( bufferType, 0, attribute.array );\r\n\r\n\t\t\t\t\t} else if ( attribute.updateRange.count === 0 ) {\r\n\r\n\t\t\t\t\t\tconsole.error( 'THREE.WebGLRenderer.updateObject: using updateRange for THREE.DynamicBufferAttribute and marked as needsUpdate but count is 0, ensure you are using set methods or updating manually.' );\r\n\r\n\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\t_gl.bufferSubData( bufferType, attribute.updateRange.offset * attribute.array.BYTES_PER_ELEMENT,\r\n\t\t\t\t\t\t\t\t\t\t   attribute.array.subarray( attribute.updateRange.offset, attribute.updateRange.offset + attribute.updateRange.count ) );\r\n\r\n\t\t\t\t\t\tattribute.updateRange.count = 0; // reset range\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tattribute.needsUpdate = false;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t} else if ( object instanceof THREE.Mesh ) {\r\n\r\n\t\t\t// check all geometry groups\r\n\r\n\t\t\tif ( geometry.groupsNeedUpdate === true ) {\r\n\r\n\t\t\t\tinitGeometryGroups( object, geometry );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tvar geometryGroupsList = geometryGroups[ geometry.id ];\r\n\r\n\t\t\tfor ( var i = 0, il = geometryGroupsList.length; i < il; i ++ ) {\r\n\r\n\t\t\t\tvar geometryGroup = geometryGroupsList[ i ];\r\n\t\t\t\tvar material = getBufferMaterial( object, geometryGroup );\r\n\r\n\t\t\t\tvar customAttributesDirty = material.attributes && areCustomAttributesDirty( material );\r\n\r\n\t\t\t\tif ( geometry.verticesNeedUpdate || geometry.morphTargetsNeedUpdate || geometry.elementsNeedUpdate ||\r\n\t\t\t\t\t geometry.uvsNeedUpdate || geometry.normalsNeedUpdate ||\r\n\t\t\t\t\t geometry.colorsNeedUpdate || geometry.tangentsNeedUpdate || customAttributesDirty ) {\r\n\r\n\t\t\t\t\tsetMeshBuffers( geometryGroup, object, _gl.DYNAMIC_DRAW, ! geometry.dynamic, material );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\tgeometry.verticesNeedUpdate = false;\r\n\t\t\tgeometry.morphTargetsNeedUpdate = false;\r\n\t\t\tgeometry.elementsNeedUpdate = false;\r\n\t\t\tgeometry.uvsNeedUpdate = false;\r\n\t\t\tgeometry.normalsNeedUpdate = false;\r\n\t\t\tgeometry.colorsNeedUpdate = false;\r\n\t\t\tgeometry.tangentsNeedUpdate = false;\r\n\r\n\t\t\tmaterial.attributes && clearCustomAttributes( material );\r\n\r\n\t\t} else if ( object instanceof THREE.Line ) {\r\n\r\n\t\t\tvar material = getBufferMaterial( object, geometry );\r\n\t\t\tvar customAttributesDirty = material.attributes && areCustomAttributesDirty( material );\r\n\r\n\t\t\tif ( geometry.verticesNeedUpdate || geometry.colorsNeedUpdate || geometry.lineDistancesNeedUpdate || customAttributesDirty ) {\r\n\r\n\t\t\t\tsetLineBuffers( geometry, _gl.DYNAMIC_DRAW );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tgeometry.verticesNeedUpdate = false;\r\n\t\t\tgeometry.colorsNeedUpdate = false;\r\n\t\t\tgeometry.lineDistancesNeedUpdate = false;\r\n\r\n\t\t\tmaterial.attributes && clearCustomAttributes( material );\r\n\r\n\t\t} else if ( object instanceof THREE.PointCloud ) {\r\n\r\n\t\t\tvar material = getBufferMaterial( object, geometry );\r\n\t\t\tvar customAttributesDirty = material.attributes && areCustomAttributesDirty( material );\r\n\r\n\t\t\tif ( geometry.verticesNeedUpdate || geometry.colorsNeedUpdate || customAttributesDirty ) {\r\n\r\n\t\t\t\tsetParticleBuffers( geometry, _gl.DYNAMIC_DRAW, object );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tgeometry.verticesNeedUpdate = false;\r\n\t\t\tgeometry.colorsNeedUpdate = false;\r\n\r\n\t\t\tmaterial.attributes && clearCustomAttributes( material );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\t// Objects updates - custom attributes check\r\n\r\n\tfunction areCustomAttributesDirty( material ) {\r\n\r\n\t\tfor ( var name in material.attributes ) {\r\n\r\n\t\t\tif ( material.attributes[ name ].needsUpdate ) return true;\r\n\r\n\t\t}\r\n\r\n\t\treturn false;\r\n\r\n\t}\r\n\r\n\tfunction clearCustomAttributes( material ) {\r\n\r\n\t\tfor ( var name in material.attributes ) {\r\n\r\n\t\t\tmaterial.attributes[ name ].needsUpdate = false;\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\t// Objects removal\r\n\r\n\tfunction removeObject( object ) {\r\n\r\n\t\tif ( object instanceof THREE.Mesh  ||\r\n\t\t\t object instanceof THREE.PointCloud ||\r\n\t\t\t object instanceof THREE.Line ) {\r\n\r\n\t\t\tdelete _webglObjects[ object.id ];\r\n\r\n\t\t} else if ( object instanceof THREE.ImmediateRenderObject || object.immediateRenderCallback ) {\r\n\r\n\t\t\tremoveInstances( _webglObjectsImmediate, object );\r\n\r\n\t\t}\r\n\r\n\t\tdelete object.__webglInit;\r\n\t\tdelete object._modelViewMatrix;\r\n\t\tdelete object._normalMatrix;\r\n\r\n\t\tdelete object.__webglActive;\r\n\r\n\t}\r\n\r\n\tfunction removeInstances( objlist, object ) {\r\n\r\n\t\tfor ( var o = objlist.length - 1; o >= 0; o -- ) {\r\n\r\n\t\t\tif ( objlist[ o ].object === object ) {\r\n\r\n\t\t\t\tobjlist.splice( o, 1 );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\t// Materials\r\n\r\n\tvar shaderIDs = {\r\n\t\tMeshDepthMaterial: 'depth',\r\n\t\tMeshNormalMaterial: 'normal',\r\n\t\tMeshBasicMaterial: 'basic',\r\n\t\tMeshLambertMaterial: 'lambert',\r\n\t\tMeshPhongMaterial: 'phong',\r\n\t\tLineBasicMaterial: 'basic',\r\n\t\tLineDashedMaterial: 'dashed',\r\n\t\tPointCloudMaterial: 'particle_basic'\r\n\t};\r\n\r\n\tfunction initMaterial( material, lights, fog, object ) {\r\n\r\n\t\tmaterial.addEventListener( 'dispose', onMaterialDispose );\r\n\r\n\t\tvar shaderID = shaderIDs[ material.type ];\r\n\r\n\t\tif ( shaderID ) {\r\n\r\n\t\t\tvar shader = THREE.ShaderLib[ shaderID ];\r\n\r\n\t\t\tmaterial.__webglShader = {\r\n\t\t\t\tuniforms: THREE.UniformsUtils.clone( shader.uniforms ),\r\n\t\t\t\tvertexShader: shader.vertexShader,\r\n\t\t\t\tfragmentShader: shader.fragmentShader\r\n\t\t\t}\r\n\r\n\t\t} else {\r\n\r\n\t\t\tmaterial.__webglShader = {\r\n\t\t\t\tuniforms: material.uniforms,\r\n\t\t\t\tvertexShader: material.vertexShader,\r\n\t\t\t\tfragmentShader: material.fragmentShader\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\t// heuristics to create shader parameters according to lights in the scene\r\n\t\t// (not to blow over maxLights budget)\r\n\r\n\t\tvar maxLightCount = allocateLights( lights );\r\n\t\tvar maxShadows = allocateShadows( lights );\r\n\t\tvar maxBones = allocateBones( object );\r\n\r\n\t\tvar parameters = {\r\n\r\n\t\t\tprecision: _precision,\r\n\t\t\tsupportsVertexTextures: _supportsVertexTextures,\r\n\r\n\t\t\tmap: !! material.map,\r\n\t\t\tenvMap: !! material.envMap,\r\n\t\t\tenvMapMode: material.envMap && material.envMap.mapping,\r\n\t\t\tlightMap: !! material.lightMap,\r\n\t\t\tbumpMap: !! material.bumpMap,\r\n\t\t\tnormalMap: !! material.normalMap,\r\n\t\t\tspecularMap: !! material.specularMap,\r\n\t\t\talphaMap: !! material.alphaMap,\r\n\r\n\t\t\tcombine: material.combine,\r\n\r\n\t\t\tvertexColors: material.vertexColors,\r\n\r\n\t\t\tfog: fog,\r\n\t\t\tuseFog: material.fog,\r\n\t\t\tfogExp: fog instanceof THREE.FogExp2,\r\n\r\n\t\t\tflatShading: material.shading === THREE.FlatShading,\r\n\r\n\t\t\tsizeAttenuation: material.sizeAttenuation,\r\n\t\t\tlogarithmicDepthBuffer: _logarithmicDepthBuffer,\r\n\r\n\t\t\tskinning: material.skinning,\r\n\t\t\tmaxBones: maxBones,\r\n\t\t\tuseVertexTexture: _supportsBoneTextures && object && object.skeleton && object.skeleton.useVertexTexture,\r\n\r\n\t\t\tmorphTargets: material.morphTargets,\r\n\t\t\tmorphNormals: material.morphNormals,\r\n\t\t\tmaxMorphTargets: _this.maxMorphTargets,\r\n\t\t\tmaxMorphNormals: _this.maxMorphNormals,\r\n\r\n\t\t\tmaxDirLights: maxLightCount.directional,\r\n\t\t\tmaxPointLights: maxLightCount.point,\r\n\t\t\tmaxSpotLights: maxLightCount.spot,\r\n\t\t\tmaxHemiLights: maxLightCount.hemi,\r\n\r\n\t\t\tmaxShadows: maxShadows,\r\n\t\t\tshadowMapEnabled: _this.shadowMapEnabled && object.receiveShadow && maxShadows > 0,\r\n\t\t\tshadowMapType: _this.shadowMapType,\r\n\t\t\tshadowMapDebug: _this.shadowMapDebug,\r\n\t\t\tshadowMapCascade: _this.shadowMapCascade,\r\n\r\n\t\t\talphaTest: material.alphaTest,\r\n\t\t\tmetal: material.metal,\r\n\t\t\twrapAround: material.wrapAround,\r\n\t\t\tdoubleSided: material.side === THREE.DoubleSide,\r\n\t\t\tflipSided: material.side === THREE.BackSide\r\n\r\n\t\t};\r\n\r\n\t\t// Generate code\r\n\r\n\t\tvar chunks = [];\r\n\r\n\t\tif ( shaderID ) {\r\n\r\n\t\t\tchunks.push( shaderID );\r\n\r\n\t\t} else {\r\n\r\n\t\t\tchunks.push( material.fragmentShader );\r\n\t\t\tchunks.push( material.vertexShader );\r\n\r\n\t\t}\r\n\r\n\t\tif ( material.defines !== undefined ) {\r\n\r\n\t\t\tfor ( var name in material.defines ) {\r\n\r\n\t\t\t\tchunks.push( name );\r\n\t\t\t\tchunks.push( material.defines[ name ] );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tfor ( var name in parameters ) {\r\n\r\n\t\t\tchunks.push( name );\r\n\t\t\tchunks.push( parameters[ name ] );\r\n\r\n\t\t}\r\n\r\n\t\tvar code = chunks.join();\r\n\r\n\t\tvar program;\r\n\r\n\t\t// Check if code has been already compiled\r\n\r\n\t\tfor ( var p = 0, pl = _programs.length; p < pl; p ++ ) {\r\n\r\n\t\t\tvar programInfo = _programs[ p ];\r\n\r\n\t\t\tif ( programInfo.code === code ) {\r\n\r\n\t\t\t\tprogram = programInfo;\r\n\t\t\t\tprogram.usedTimes ++;\r\n\r\n\t\t\t\tbreak;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tif ( program === undefined ) {\r\n\r\n\t\t\tprogram = new THREE.WebGLProgram( _this, code, material, parameters );\r\n\t\t\t_programs.push( program );\r\n\r\n\t\t\t_this.info.memory.programs = _programs.length;\r\n\r\n\t\t}\r\n\r\n\t\tmaterial.program = program;\r\n\r\n\t\tvar attributes = program.attributes;\r\n\r\n\t\tif ( material.morphTargets ) {\r\n\r\n\t\t\tmaterial.numSupportedMorphTargets = 0;\r\n\r\n\t\t\tvar id, base = 'morphTarget';\r\n\r\n\t\t\tfor ( var i = 0; i < _this.maxMorphTargets; i ++ ) {\r\n\r\n\t\t\t\tid = base + i;\r\n\r\n\t\t\t\tif ( attributes[ id ] >= 0 ) {\r\n\r\n\t\t\t\t\tmaterial.numSupportedMorphTargets ++;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tif ( material.morphNormals ) {\r\n\r\n\t\t\tmaterial.numSupportedMorphNormals = 0;\r\n\r\n\t\t\tvar id, base = 'morphNormal';\r\n\r\n\t\t\tfor ( i = 0; i < _this.maxMorphNormals; i ++ ) {\r\n\r\n\t\t\t\tid = base + i;\r\n\r\n\t\t\t\tif ( attributes[ id ] >= 0 ) {\r\n\r\n\t\t\t\t\tmaterial.numSupportedMorphNormals ++;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tmaterial.uniformsList = [];\r\n\r\n\t\tfor ( var u in material.__webglShader.uniforms ) {\r\n\r\n\t\t\tvar location = material.program.uniforms[ u ];\r\n\r\n\t\t\tif ( location ) {\r\n\t\t\t\tmaterial.uniformsList.push( [ material.__webglShader.uniforms[ u ], location ] );\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tfunction setMaterial( material ) {\r\n\r\n\t\tif ( material.transparent === true ) {\r\n\r\n\t\t\tstate.setBlending( material.blending, material.blendEquation, material.blendSrc, material.blendDst, material.blendEquationAlpha, material.blendSrcAlpha, material.blendDstAlpha );\r\n\r\n\t\t} else {\r\n\r\n\t\t\tstate.setBlending( THREE.NoBlending );\r\n\r\n\t\t}\r\n\r\n\t\tstate.setDepthTest( material.depthTest );\r\n\t\tstate.setDepthWrite( material.depthWrite );\r\n\t\tstate.setColorWrite( material.colorWrite );\r\n\t\tstate.setPolygonOffset( material.polygonOffset, material.polygonOffsetFactor, material.polygonOffsetUnits );\r\n\r\n\t}\r\n\r\n\tfunction setProgram( camera, lights, fog, material, object ) {\r\n\r\n\t\t_usedTextureUnits = 0;\r\n\r\n\t\tif ( material.needsUpdate ) {\r\n\r\n\t\t\tif ( material.program ) deallocateMaterial( material );\r\n\r\n\t\t\tinitMaterial( material, lights, fog, object );\r\n\t\t\tmaterial.needsUpdate = false;\r\n\r\n\t\t}\r\n\r\n\t\tif ( material.morphTargets ) {\r\n\r\n\t\t\tif ( ! object.__webglMorphTargetInfluences ) {\r\n\r\n\t\t\t\tobject.__webglMorphTargetInfluences = new Float32Array( _this.maxMorphTargets );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tvar refreshProgram = false;\r\n\t\tvar refreshMaterial = false;\r\n\t\tvar refreshLights = false;\r\n\r\n\t\tvar program = material.program,\r\n\t\t\tp_uniforms = program.uniforms,\r\n\t\t\tm_uniforms = material.__webglShader.uniforms;\r\n\r\n\t\tif ( program.id !== _currentProgram ) {\r\n\r\n\t\t\t_gl.useProgram( program.program );\r\n\t\t\t_currentProgram = program.id;\r\n\r\n\t\t\trefreshProgram = true;\r\n\t\t\trefreshMaterial = true;\r\n\t\t\trefreshLights = true;\r\n\r\n\t\t}\r\n\r\n\t\tif ( material.id !== _currentMaterialId ) {\r\n\r\n\t\t\tif ( _currentMaterialId === -1 ) refreshLights = true;\r\n\t\t\t_currentMaterialId = material.id;\r\n\r\n\t\t\trefreshMaterial = true;\r\n\r\n\t\t}\r\n\r\n\t\tif ( refreshProgram || camera !== _currentCamera ) {\r\n\r\n\t\t\t_gl.uniformMatrix4fv( p_uniforms.projectionMatrix, false, camera.projectionMatrix.elements );\r\n\r\n\t\t\tif ( _logarithmicDepthBuffer ) {\r\n\r\n\t\t\t\t_gl.uniform1f( p_uniforms.logDepthBufFC, 2.0 / ( Math.log( camera.far + 1.0 ) / Math.LN2 ) );\r\n\r\n\t\t\t}\r\n\r\n\r\n\t\t\tif ( camera !== _currentCamera ) _currentCamera = camera;\r\n\r\n\t\t\t// load material specific uniforms\r\n\t\t\t// (shader material also gets them for the sake of genericity)\r\n\r\n\t\t\tif ( material instanceof THREE.ShaderMaterial ||\r\n\t\t\t\t material instanceof THREE.MeshPhongMaterial ||\r\n\t\t\t\t material.envMap ) {\r\n\r\n\t\t\t\tif ( p_uniforms.cameraPosition !== null ) {\r\n\r\n\t\t\t\t\t_vector3.setFromMatrixPosition( camera.matrixWorld );\r\n\t\t\t\t\t_gl.uniform3f( p_uniforms.cameraPosition, _vector3.x, _vector3.y, _vector3.z );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( material instanceof THREE.MeshPhongMaterial ||\r\n\t\t\t\t material instanceof THREE.MeshLambertMaterial ||\r\n\t\t\t\t material instanceof THREE.MeshBasicMaterial ||\r\n\t\t\t\t material instanceof THREE.ShaderMaterial ||\r\n\t\t\t\t material.skinning ) {\r\n\r\n\t\t\t\tif ( p_uniforms.viewMatrix !== null ) {\r\n\r\n\t\t\t\t\t_gl.uniformMatrix4fv( p_uniforms.viewMatrix, false, camera.matrixWorldInverse.elements );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\t// skinning uniforms must be set even if material didn't change\r\n\t\t// auto-setting of texture unit for bone texture must go before other textures\r\n\t\t// not sure why, but otherwise weird things happen\r\n\r\n\t\tif ( material.skinning ) {\r\n\r\n\t\t\tif ( object.bindMatrix && p_uniforms.bindMatrix !== null ) {\r\n\r\n\t\t\t\t_gl.uniformMatrix4fv( p_uniforms.bindMatrix, false, object.bindMatrix.elements );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( object.bindMatrixInverse && p_uniforms.bindMatrixInverse !== null ) {\r\n\r\n\t\t\t\t_gl.uniformMatrix4fv( p_uniforms.bindMatrixInverse, false, object.bindMatrixInverse.elements );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( _supportsBoneTextures && object.skeleton && object.skeleton.useVertexTexture ) {\r\n\r\n\t\t\t\tif ( p_uniforms.boneTexture !== null ) {\r\n\r\n\t\t\t\t\tvar textureUnit = getTextureUnit();\r\n\r\n\t\t\t\t\t_gl.uniform1i( p_uniforms.boneTexture, textureUnit );\r\n\t\t\t\t\t_this.setTexture( object.skeleton.boneTexture, textureUnit );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( p_uniforms.boneTextureWidth !== null ) {\r\n\r\n\t\t\t\t\t_gl.uniform1i( p_uniforms.boneTextureWidth, object.skeleton.boneTextureWidth );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( p_uniforms.boneTextureHeight !== null ) {\r\n\r\n\t\t\t\t\t_gl.uniform1i( p_uniforms.boneTextureHeight, object.skeleton.boneTextureHeight );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t} else if ( object.skeleton && object.skeleton.boneMatrices ) {\r\n\r\n\t\t\t\tif ( p_uniforms.boneGlobalMatrices !== null ) {\r\n\r\n\t\t\t\t\t_gl.uniformMatrix4fv( p_uniforms.boneGlobalMatrices, false, object.skeleton.boneMatrices );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tif ( refreshMaterial ) {\r\n\r\n\t\t\t// refresh uniforms common to several materials\r\n\r\n\t\t\tif ( fog && material.fog ) {\r\n\r\n\t\t\t\trefreshUniformsFog( m_uniforms, fog );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( material instanceof THREE.MeshPhongMaterial ||\r\n\t\t\t\t material instanceof THREE.MeshLambertMaterial ||\r\n\t\t\t\t material.lights ) {\r\n\r\n\t\t\t\tif ( _lightsNeedUpdate ) {\r\n\r\n\t\t\t\t\trefreshLights = true;\r\n\t\t\t\t\tsetupLights( lights );\r\n\t\t\t\t\t_lightsNeedUpdate = false;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( refreshLights ) {\r\n\t\t\t\t\trefreshUniformsLights( m_uniforms, _lights );\r\n\t\t\t\t\tmarkUniformsLightsNeedsUpdate( m_uniforms, true );\r\n\t\t\t\t} else {\r\n\t\t\t\t\tmarkUniformsLightsNeedsUpdate( m_uniforms, false );\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( material instanceof THREE.MeshBasicMaterial ||\r\n\t\t\t\t material instanceof THREE.MeshLambertMaterial ||\r\n\t\t\t\t material instanceof THREE.MeshPhongMaterial ) {\r\n\r\n\t\t\t\trefreshUniformsCommon( m_uniforms, material );\r\n\r\n\t\t\t}\r\n\r\n\t\t\t// refresh single material specific uniforms\r\n\r\n\t\t\tif ( material instanceof THREE.LineBasicMaterial ) {\r\n\r\n\t\t\t\trefreshUniformsLine( m_uniforms, material );\r\n\r\n\t\t\t} else if ( material instanceof THREE.LineDashedMaterial ) {\r\n\r\n\t\t\t\trefreshUniformsLine( m_uniforms, material );\r\n\t\t\t\trefreshUniformsDash( m_uniforms, material );\r\n\r\n\t\t\t} else if ( material instanceof THREE.PointCloudMaterial ) {\r\n\r\n\t\t\t\trefreshUniformsParticle( m_uniforms, material );\r\n\r\n\t\t\t} else if ( material instanceof THREE.MeshPhongMaterial ) {\r\n\r\n\t\t\t\trefreshUniformsPhong( m_uniforms, material );\r\n\r\n\t\t\t} else if ( material instanceof THREE.MeshLambertMaterial ) {\r\n\r\n\t\t\t\trefreshUniformsLambert( m_uniforms, material );\r\n\r\n\t\t\t} else if ( material instanceof THREE.MeshDepthMaterial ) {\r\n\r\n\t\t\t\tm_uniforms.mNear.value = camera.near;\r\n\t\t\t\tm_uniforms.mFar.value = camera.far;\r\n\t\t\t\tm_uniforms.opacity.value = material.opacity;\r\n\r\n\t\t\t} else if ( material instanceof THREE.MeshNormalMaterial ) {\r\n\r\n\t\t\t\tm_uniforms.opacity.value = material.opacity;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( object.receiveShadow && ! material._shadowPass ) {\r\n\r\n\t\t\t\trefreshUniformsShadow( m_uniforms, lights );\r\n\r\n\t\t\t}\r\n\r\n\t\t\t// load common uniforms\r\n\r\n\t\t\tloadUniformsGeneric( material.uniformsList );\r\n\r\n\t\t}\r\n\r\n\t\tloadUniformsMatrices( p_uniforms, object );\r\n\r\n\t\tif ( p_uniforms.modelMatrix !== null ) {\r\n\r\n\t\t\t_gl.uniformMatrix4fv( p_uniforms.modelMatrix, false, object.matrixWorld.elements );\r\n\r\n\t\t}\r\n\r\n\t\treturn program;\r\n\r\n\t}\r\n\r\n\t// Uniforms (refresh uniforms objects)\r\n\r\n\tfunction refreshUniformsCommon ( uniforms, material ) {\r\n\r\n\t\tuniforms.opacity.value = material.opacity;\r\n\r\n\t\tuniforms.diffuse.value = material.color;\r\n\r\n\t\tuniforms.map.value = material.map;\r\n\t\tuniforms.lightMap.value = material.lightMap;\r\n\t\tuniforms.specularMap.value = material.specularMap;\r\n\t\tuniforms.alphaMap.value = material.alphaMap;\r\n\r\n\t\tif ( material.bumpMap ) {\r\n\r\n\t\t\tuniforms.bumpMap.value = material.bumpMap;\r\n\t\t\tuniforms.bumpScale.value = material.bumpScale;\r\n\r\n\t\t}\r\n\r\n\t\tif ( material.normalMap ) {\r\n\r\n\t\t\tuniforms.normalMap.value = material.normalMap;\r\n\t\t\tuniforms.normalScale.value.copy( material.normalScale );\r\n\r\n\t\t}\r\n\r\n\t\t// uv repeat and offset setting priorities\r\n\t\t//  1. color map\r\n\t\t//  2. specular map\r\n\t\t//  3. normal map\r\n\t\t//  4. bump map\r\n\t\t//  5. alpha map\r\n\r\n\t\tvar uvScaleMap;\r\n\r\n\t\tif ( material.map ) {\r\n\r\n\t\t\tuvScaleMap = material.map;\r\n\r\n\t\t} else if ( material.specularMap ) {\r\n\r\n\t\t\tuvScaleMap = material.specularMap;\r\n\r\n\t\t} else if ( material.normalMap ) {\r\n\r\n\t\t\tuvScaleMap = material.normalMap;\r\n\r\n\t\t} else if ( material.bumpMap ) {\r\n\r\n\t\t\tuvScaleMap = material.bumpMap;\r\n\r\n\t\t} else if ( material.alphaMap ) {\r\n\r\n\t\t\tuvScaleMap = material.alphaMap;\r\n\r\n\t\t}\r\n\r\n\t\tif ( uvScaleMap !== undefined ) {\r\n\r\n\t\t\tvar offset = uvScaleMap.offset;\r\n\t\t\tvar repeat = uvScaleMap.repeat;\r\n\r\n\t\t\tuniforms.offsetRepeat.value.set( offset.x, offset.y, repeat.x, repeat.y );\r\n\r\n\t\t}\r\n\r\n\t\tuniforms.envMap.value = material.envMap;\r\n\t\tuniforms.flipEnvMap.value = ( material.envMap instanceof THREE.WebGLRenderTargetCube ) ? 1 : - 1;\r\n\r\n\t\tuniforms.reflectivity.value = material.reflectivity;\r\n\t\tuniforms.refractionRatio.value = material.refractionRatio;\r\n\r\n\t}\r\n\r\n\tfunction refreshUniformsLine ( uniforms, material ) {\r\n\r\n\t\tuniforms.diffuse.value = material.color;\r\n\t\tuniforms.opacity.value = material.opacity;\r\n\r\n\t}\r\n\r\n\tfunction refreshUniformsDash ( uniforms, material ) {\r\n\r\n\t\tuniforms.dashSize.value = material.dashSize;\r\n\t\tuniforms.totalSize.value = material.dashSize + material.gapSize;\r\n\t\tuniforms.scale.value = material.scale;\r\n\r\n\t}\r\n\r\n\tfunction refreshUniformsParticle ( uniforms, material ) {\r\n\r\n\t\tuniforms.psColor.value = material.color;\r\n\t\tuniforms.opacity.value = material.opacity;\r\n\t\tuniforms.size.value = material.size;\r\n\t\tuniforms.scale.value = _canvas.height / 2.0; // TODO: Cache this.\r\n\r\n\t\tuniforms.map.value = material.map;\r\n\r\n\t\tif ( material.map !== null ) {\r\n\r\n\t\t\tvar offset = material.map.offset;\r\n\t\t\tvar repeat = material.map.repeat;\r\n\r\n\t\t\tuniforms.offsetRepeat.value.set( offset.x, offset.y, repeat.x, repeat.y );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tfunction refreshUniformsFog ( uniforms, fog ) {\r\n\r\n\t\tuniforms.fogColor.value = fog.color;\r\n\r\n\t\tif ( fog instanceof THREE.Fog ) {\r\n\r\n\t\t\tuniforms.fogNear.value = fog.near;\r\n\t\t\tuniforms.fogFar.value = fog.far;\r\n\r\n\t\t} else if ( fog instanceof THREE.FogExp2 ) {\r\n\r\n\t\t\tuniforms.fogDensity.value = fog.density;\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tfunction refreshUniformsPhong ( uniforms, material ) {\r\n\r\n\t\tuniforms.shininess.value = material.shininess;\r\n\r\n\t\tuniforms.emissive.value = material.emissive;\r\n\t\tuniforms.specular.value = material.specular;\r\n\r\n\t\tif ( material.wrapAround ) {\r\n\r\n\t\t\tuniforms.wrapRGB.value.copy( material.wrapRGB );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tfunction refreshUniformsLambert ( uniforms, material ) {\r\n\r\n\t\tuniforms.emissive.value = material.emissive;\r\n\r\n\t\tif ( material.wrapAround ) {\r\n\r\n\t\t\tuniforms.wrapRGB.value.copy( material.wrapRGB );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tfunction refreshUniformsLights ( uniforms, lights ) {\r\n\r\n\t\tuniforms.ambientLightColor.value = lights.ambient;\r\n\r\n\t\tuniforms.directionalLightColor.value = lights.directional.colors;\r\n\t\tuniforms.directionalLightDirection.value = lights.directional.positions;\r\n\r\n\t\tuniforms.pointLightColor.value = lights.point.colors;\r\n\t\tuniforms.pointLightPosition.value = lights.point.positions;\r\n\t\tuniforms.pointLightDistance.value = lights.point.distances;\r\n\t\tuniforms.pointLightDecay.value = lights.point.decays;\r\n\r\n\t\tuniforms.spotLightColor.value = lights.spot.colors;\r\n\t\tuniforms.spotLightPosition.value = lights.spot.positions;\r\n\t\tuniforms.spotLightDistance.value = lights.spot.distances;\r\n\t\tuniforms.spotLightDirection.value = lights.spot.directions;\r\n\t\tuniforms.spotLightAngleCos.value = lights.spot.anglesCos;\r\n\t\tuniforms.spotLightExponent.value = lights.spot.exponents;\r\n\t\tuniforms.spotLightDecay.value = lights.spot.decays;\r\n\r\n\t\tuniforms.hemisphereLightSkyColor.value = lights.hemi.skyColors;\r\n\t\tuniforms.hemisphereLightGroundColor.value = lights.hemi.groundColors;\r\n\t\tuniforms.hemisphereLightDirection.value = lights.hemi.positions;\r\n\r\n\t}\r\n\r\n\t// If uniforms are marked as clean, they don't need to be loaded to the GPU.\r\n\r\n\tfunction markUniformsLightsNeedsUpdate ( uniforms, value ) {\r\n\r\n\t\tuniforms.ambientLightColor.needsUpdate = value;\r\n\r\n\t\tuniforms.directionalLightColor.needsUpdate = value;\r\n\t\tuniforms.directionalLightDirection.needsUpdate = value;\r\n\r\n\t\tuniforms.pointLightColor.needsUpdate = value;\r\n\t\tuniforms.pointLightPosition.needsUpdate = value;\r\n\t\tuniforms.pointLightDistance.needsUpdate = value;\r\n\t\tuniforms.pointLightDecay.needsUpdate = value;\r\n\r\n\t\tuniforms.spotLightColor.needsUpdate = value;\r\n\t\tuniforms.spotLightPosition.needsUpdate = value;\r\n\t\tuniforms.spotLightDistance.needsUpdate = value;\r\n\t\tuniforms.spotLightDirection.needsUpdate = value;\r\n\t\tuniforms.spotLightAngleCos.needsUpdate = value;\r\n\t\tuniforms.spotLightExponent.needsUpdate = value;\r\n\t\tuniforms.spotLightDecay.needsUpdate = value;\r\n\r\n\t\tuniforms.hemisphereLightSkyColor.needsUpdate = value;\r\n\t\tuniforms.hemisphereLightGroundColor.needsUpdate = value;\r\n\t\tuniforms.hemisphereLightDirection.needsUpdate = value;\r\n\r\n\t}\r\n\r\n\tfunction refreshUniformsShadow ( uniforms, lights ) {\r\n\r\n\t\tif ( uniforms.shadowMatrix ) {\r\n\r\n\t\t\tvar j = 0;\r\n\r\n\t\t\tfor ( var i = 0, il = lights.length; i < il; i ++ ) {\r\n\r\n\t\t\t\tvar light = lights[ i ];\r\n\r\n\t\t\t\tif ( ! light.castShadow ) continue;\r\n\r\n\t\t\t\tif ( light instanceof THREE.SpotLight || ( light instanceof THREE.DirectionalLight && ! light.shadowCascade ) ) {\r\n\r\n\t\t\t\t\tuniforms.shadowMap.value[ j ] = light.shadowMap;\r\n\t\t\t\t\tuniforms.shadowMapSize.value[ j ] = light.shadowMapSize;\r\n\r\n\t\t\t\t\tuniforms.shadowMatrix.value[ j ] = light.shadowMatrix;\r\n\r\n\t\t\t\t\tuniforms.shadowDarkness.value[ j ] = light.shadowDarkness;\r\n\t\t\t\t\tuniforms.shadowBias.value[ j ] = light.shadowBias;\r\n\r\n\t\t\t\t\tj ++;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\t// Uniforms (load to GPU)\r\n\r\n\tfunction loadUniformsMatrices ( uniforms, object ) {\r\n\r\n\t\t_gl.uniformMatrix4fv( uniforms.modelViewMatrix, false, object._modelViewMatrix.elements );\r\n\r\n\t\tif ( uniforms.normalMatrix ) {\r\n\r\n\t\t\t_gl.uniformMatrix3fv( uniforms.normalMatrix, false, object._normalMatrix.elements );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tfunction getTextureUnit() {\r\n\r\n\t\tvar textureUnit = _usedTextureUnits;\r\n\r\n\t\tif ( textureUnit >= _maxTextures ) {\r\n\r\n\t\t\tTHREE.warn( 'WebGLRenderer: trying to use ' + textureUnit + ' texture units while this GPU supports only ' + _maxTextures );\r\n\r\n\t\t}\r\n\r\n\t\t_usedTextureUnits += 1;\r\n\r\n\t\treturn textureUnit;\r\n\r\n\t}\r\n\r\n\tfunction loadUniformsGeneric ( uniforms ) {\r\n\r\n\t\tvar texture, textureUnit, offset;\r\n\r\n\t\tfor ( var j = 0, jl = uniforms.length; j < jl; j ++ ) {\r\n\r\n\t\t\tvar uniform = uniforms[ j ][ 0 ];\r\n\r\n\t\t\t// needsUpdate property is not added to all uniforms.\r\n\t\t\tif ( uniform.needsUpdate === false ) continue;\r\n\r\n\t\t\tvar type = uniform.type;\r\n\t\t\tvar value = uniform.value;\r\n\t\t\tvar location = uniforms[ j ][ 1 ];\r\n\r\n\t\t\tswitch ( type ) {\r\n\r\n\t\t\t\tcase '1i':\r\n\t\t\t\t\t_gl.uniform1i( location, value );\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase '1f':\r\n\t\t\t\t\t_gl.uniform1f( location, value );\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase '2f':\r\n\t\t\t\t\t_gl.uniform2f( location, value[ 0 ], value[ 1 ] );\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase '3f':\r\n\t\t\t\t\t_gl.uniform3f( location, value[ 0 ], value[ 1 ], value[ 2 ] );\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase '4f':\r\n\t\t\t\t\t_gl.uniform4f( location, value[ 0 ], value[ 1 ], value[ 2 ], value[ 3 ] );\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase '1iv':\r\n\t\t\t\t\t_gl.uniform1iv( location, value );\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase '3iv':\r\n\t\t\t\t\t_gl.uniform3iv( location, value );\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase '1fv':\r\n\t\t\t\t\t_gl.uniform1fv( location, value );\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase '2fv':\r\n\t\t\t\t\t_gl.uniform2fv( location, value );\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase '3fv':\r\n\t\t\t\t\t_gl.uniform3fv( location, value );\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase '4fv':\r\n\t\t\t\t\t_gl.uniform4fv( location, value );\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'Matrix3fv':\r\n\t\t\t\t\t_gl.uniformMatrix3fv( location, false, value );\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'Matrix4fv':\r\n\t\t\t\t\t_gl.uniformMatrix4fv( location, false, value );\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t//\r\n\r\n\t\t\t\tcase 'i':\r\n\r\n\t\t\t\t\t// single integer\r\n\t\t\t\t\t_gl.uniform1i( location, value );\r\n\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'f':\r\n\r\n\t\t\t\t\t// single float\r\n\t\t\t\t\t_gl.uniform1f( location, value );\r\n\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'v2':\r\n\r\n\t\t\t\t\t// single THREE.Vector2\r\n\t\t\t\t\t_gl.uniform2f( location, value.x, value.y );\r\n\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'v3':\r\n\r\n\t\t\t\t\t// single THREE.Vector3\r\n\t\t\t\t\t_gl.uniform3f( location, value.x, value.y, value.z );\r\n\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'v4':\r\n\r\n\t\t\t\t\t// single THREE.Vector4\r\n\t\t\t\t\t_gl.uniform4f( location, value.x, value.y, value.z, value.w );\r\n\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'c':\r\n\r\n\t\t\t\t\t// single THREE.Color\r\n\t\t\t\t\t_gl.uniform3f( location, value.r, value.g, value.b );\r\n\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'iv1':\r\n\r\n\t\t\t\t\t// flat array of integers (JS or typed array)\r\n\t\t\t\t\t_gl.uniform1iv( location, value );\r\n\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'iv':\r\n\r\n\t\t\t\t\t// flat array of integers with 3 x N size (JS or typed array)\r\n\t\t\t\t\t_gl.uniform3iv( location, value );\r\n\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'fv1':\r\n\r\n\t\t\t\t\t// flat array of floats (JS or typed array)\r\n\t\t\t\t\t_gl.uniform1fv( location, value );\r\n\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'fv':\r\n\r\n\t\t\t\t\t// flat array of floats with 3 x N size (JS or typed array)\r\n\t\t\t\t\t_gl.uniform3fv( location, value );\r\n\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'v2v':\r\n\r\n\t\t\t\t\t// array of THREE.Vector2\r\n\r\n\t\t\t\t\tif ( uniform._array === undefined ) {\r\n\r\n\t\t\t\t\t\tuniform._array = new Float32Array( 2 * value.length );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tfor ( var i = 0, il = value.length; i < il; i ++ ) {\r\n\r\n\t\t\t\t\t\toffset = i * 2;\r\n\r\n\t\t\t\t\t\tuniform._array[ offset ]   = value[ i ].x;\r\n\t\t\t\t\t\tuniform._array[ offset + 1 ] = value[ i ].y;\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t_gl.uniform2fv( location, uniform._array );\r\n\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'v3v':\r\n\r\n\t\t\t\t\t// array of THREE.Vector3\r\n\r\n\t\t\t\t\tif ( uniform._array === undefined ) {\r\n\r\n\t\t\t\t\t\tuniform._array = new Float32Array( 3 * value.length );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tfor ( var i = 0, il = value.length; i < il; i ++ ) {\r\n\r\n\t\t\t\t\t\toffset = i * 3;\r\n\r\n\t\t\t\t\t\tuniform._array[ offset ]   = value[ i ].x;\r\n\t\t\t\t\t\tuniform._array[ offset + 1 ] = value[ i ].y;\r\n\t\t\t\t\t\tuniform._array[ offset + 2 ] = value[ i ].z;\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t_gl.uniform3fv( location, uniform._array );\r\n\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'v4v':\r\n\r\n\t\t\t\t\t// array of THREE.Vector4\r\n\r\n\t\t\t\t\tif ( uniform._array === undefined ) {\r\n\r\n\t\t\t\t\t\tuniform._array = new Float32Array( 4 * value.length );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tfor ( var i = 0, il = value.length; i < il; i ++ ) {\r\n\r\n\t\t\t\t\t\toffset = i * 4;\r\n\r\n\t\t\t\t\t\tuniform._array[ offset ]   = value[ i ].x;\r\n\t\t\t\t\t\tuniform._array[ offset + 1 ] = value[ i ].y;\r\n\t\t\t\t\t\tuniform._array[ offset + 2 ] = value[ i ].z;\r\n\t\t\t\t\t\tuniform._array[ offset + 3 ] = value[ i ].w;\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t_gl.uniform4fv( location, uniform._array );\r\n\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'm3':\r\n\r\n\t\t\t\t\t// single THREE.Matrix3\r\n\t\t\t\t\t_gl.uniformMatrix3fv( location, false, value.elements );\r\n\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'm3v':\r\n\r\n\t\t\t\t\t// array of THREE.Matrix3\r\n\r\n\t\t\t\t\tif ( uniform._array === undefined ) {\r\n\r\n\t\t\t\t\t\tuniform._array = new Float32Array( 9 * value.length );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tfor ( var i = 0, il = value.length; i < il; i ++ ) {\r\n\r\n\t\t\t\t\t\tvalue[ i ].flattenToArrayOffset( uniform._array, i * 9 );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t_gl.uniformMatrix3fv( location, false, uniform._array );\r\n\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'm4':\r\n\r\n\t\t\t\t\t// single THREE.Matrix4\r\n\t\t\t\t\t_gl.uniformMatrix4fv( location, false, value.elements );\r\n\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'm4v':\r\n\r\n\t\t\t\t\t// array of THREE.Matrix4\r\n\r\n\t\t\t\t\tif ( uniform._array === undefined ) {\r\n\r\n\t\t\t\t\t\tuniform._array = new Float32Array( 16 * value.length );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tfor ( var i = 0, il = value.length; i < il; i ++ ) {\r\n\r\n\t\t\t\t\t\tvalue[ i ].flattenToArrayOffset( uniform._array, i * 16 );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t_gl.uniformMatrix4fv( location, false, uniform._array );\r\n\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 't':\r\n\r\n\t\t\t\t\t// single THREE.Texture (2d or cube)\r\n\r\n\t\t\t\t\ttexture = value;\r\n\t\t\t\t\ttextureUnit = getTextureUnit();\r\n\r\n\t\t\t\t\t_gl.uniform1i( location, textureUnit );\r\n\r\n\t\t\t\t\tif ( ! texture ) continue;\r\n\r\n\t\t\t\t\tif ( texture instanceof THREE.CubeTexture ||\r\n\t\t\t\t\t   ( texture.image instanceof Array && texture.image.length === 6 ) ) { // CompressedTexture can have Array in image :/\r\n\r\n\t\t\t\t\t\tsetCubeTexture( texture, textureUnit );\r\n\r\n\t\t\t\t\t} else if ( texture instanceof THREE.WebGLRenderTargetCube ) {\r\n\r\n\t\t\t\t\t\tsetCubeTextureDynamic( texture, textureUnit );\r\n\r\n\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\t_this.setTexture( texture, textureUnit );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'tv':\r\n\r\n\t\t\t\t\t// array of THREE.Texture (2d)\r\n\r\n\t\t\t\t\tif ( uniform._array === undefined ) {\r\n\r\n\t\t\t\t\t\tuniform._array = [];\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tfor ( var i = 0, il = uniform.value.length; i < il; i ++ ) {\r\n\r\n\t\t\t\t\t\tuniform._array[ i ] = getTextureUnit();\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t_gl.uniform1iv( location, uniform._array );\r\n\r\n\t\t\t\t\tfor ( var i = 0, il = uniform.value.length; i < il; i ++ ) {\r\n\r\n\t\t\t\t\t\ttexture = uniform.value[ i ];\r\n\t\t\t\t\t\ttextureUnit = uniform._array[ i ];\r\n\r\n\t\t\t\t\t\tif ( ! texture ) continue;\r\n\r\n\t\t\t\t\t\t_this.setTexture( texture, textureUnit );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tdefault:\r\n\r\n\t\t\t\t\tTHREE.warn( 'THREE.WebGLRenderer: Unknown uniform type: ' + type );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tfunction setupMatrices ( object, camera ) {\r\n\r\n\t\tobject._modelViewMatrix.multiplyMatrices( camera.matrixWorldInverse, object.matrixWorld );\r\n\t\tobject._normalMatrix.getNormalMatrix( object._modelViewMatrix );\r\n\r\n\t}\r\n\r\n\tfunction setColorLinear( array, offset, color, intensity ) {\r\n\r\n\t\tarray[ offset ]     = color.r * intensity;\r\n\t\tarray[ offset + 1 ] = color.g * intensity;\r\n\t\tarray[ offset + 2 ] = color.b * intensity;\r\n\r\n\t}\r\n\r\n\tfunction setupLights ( lights ) {\r\n\r\n\t\tvar l, ll, light,\r\n\t\tr = 0, g = 0, b = 0,\r\n\t\tcolor, skyColor, groundColor,\r\n\t\tintensity,\r\n\t\tdistance,\r\n\r\n\t\tzlights = _lights,\r\n\r\n\t\tdirColors = zlights.directional.colors,\r\n\t\tdirPositions = zlights.directional.positions,\r\n\r\n\t\tpointColors = zlights.point.colors,\r\n\t\tpointPositions = zlights.point.positions,\r\n\t\tpointDistances = zlights.point.distances,\r\n\t\tpointDecays = zlights.point.decays,\r\n\r\n\t\tspotColors = zlights.spot.colors,\r\n\t\tspotPositions = zlights.spot.positions,\r\n\t\tspotDistances = zlights.spot.distances,\r\n\t\tspotDirections = zlights.spot.directions,\r\n\t\tspotAnglesCos = zlights.spot.anglesCos,\r\n\t\tspotExponents = zlights.spot.exponents,\r\n\t\tspotDecays = zlights.spot.decays,\r\n\r\n\t\themiSkyColors = zlights.hemi.skyColors,\r\n\t\themiGroundColors = zlights.hemi.groundColors,\r\n\t\themiPositions = zlights.hemi.positions,\r\n\r\n\t\tdirLength = 0,\r\n\t\tpointLength = 0,\r\n\t\tspotLength = 0,\r\n\t\themiLength = 0,\r\n\r\n\t\tdirCount = 0,\r\n\t\tpointCount = 0,\r\n\t\tspotCount = 0,\r\n\t\themiCount = 0,\r\n\r\n\t\tdirOffset = 0,\r\n\t\tpointOffset = 0,\r\n\t\tspotOffset = 0,\r\n\t\themiOffset = 0;\r\n\r\n\t\tfor ( l = 0, ll = lights.length; l < ll; l ++ ) {\r\n\r\n\t\t\tlight = lights[ l ];\r\n\r\n\t\t\tif ( light.onlyShadow ) continue;\r\n\r\n\t\t\tcolor = light.color;\r\n\t\t\tintensity = light.intensity;\r\n\t\t\tdistance = light.distance;\r\n\r\n\t\t\tif ( light instanceof THREE.AmbientLight ) {\r\n\r\n\t\t\t\tif ( ! light.visible ) continue;\r\n\r\n\t\t\t\tr += color.r;\r\n\t\t\t\tg += color.g;\r\n\t\t\t\tb += color.b;\r\n\r\n\t\t\t} else if ( light instanceof THREE.DirectionalLight ) {\r\n\r\n\t\t\t\tdirCount += 1;\r\n\r\n\t\t\t\tif ( ! light.visible ) continue;\r\n\r\n\t\t\t\t_direction.setFromMatrixPosition( light.matrixWorld );\r\n\t\t\t\t_vector3.setFromMatrixPosition( light.target.matrixWorld );\r\n\t\t\t\t_direction.sub( _vector3 );\r\n\t\t\t\t_direction.normalize();\r\n\r\n\t\t\t\tdirOffset = dirLength * 3;\r\n\r\n\t\t\t\tdirPositions[ dirOffset ]     = _direction.x;\r\n\t\t\t\tdirPositions[ dirOffset + 1 ] = _direction.y;\r\n\t\t\t\tdirPositions[ dirOffset + 2 ] = _direction.z;\r\n\r\n\t\t\t\tsetColorLinear( dirColors, dirOffset, color, intensity );\r\n\r\n\t\t\t\tdirLength += 1;\r\n\r\n\t\t\t} else if ( light instanceof THREE.PointLight ) {\r\n\r\n\t\t\t\tpointCount += 1;\r\n\r\n\t\t\t\tif ( ! light.visible ) continue;\r\n\r\n\t\t\t\tpointOffset = pointLength * 3;\r\n\r\n\t\t\t\tsetColorLinear( pointColors, pointOffset, color, intensity );\r\n\r\n\t\t\t\t_vector3.setFromMatrixPosition( light.matrixWorld );\r\n\r\n\t\t\t\tpointPositions[ pointOffset ]     = _vector3.x;\r\n\t\t\t\tpointPositions[ pointOffset + 1 ] = _vector3.y;\r\n\t\t\t\tpointPositions[ pointOffset + 2 ] = _vector3.z;\r\n\r\n\t\t\t\t// distance is 0 if decay is 0, because there is no attenuation at all.\r\n\t\t\t\tpointDistances[ pointLength ] = distance;\r\n\t\t\t\tpointDecays[ pointLength ] = ( light.distance === 0 ) ? 0.0 : light.decay;\r\n\r\n\t\t\t\tpointLength += 1;\r\n\r\n\t\t\t} else if ( light instanceof THREE.SpotLight ) {\r\n\r\n\t\t\t\tspotCount += 1;\r\n\r\n\t\t\t\tif ( ! light.visible ) continue;\r\n\r\n\t\t\t\tspotOffset = spotLength * 3;\r\n\r\n\t\t\t\tsetColorLinear( spotColors, spotOffset, color, intensity );\r\n\r\n\t\t\t\t_direction.setFromMatrixPosition( light.matrixWorld );\r\n\r\n\t\t\t\tspotPositions[ spotOffset ]     = _direction.x;\r\n\t\t\t\tspotPositions[ spotOffset + 1 ] = _direction.y;\r\n\t\t\t\tspotPositions[ spotOffset + 2 ] = _direction.z;\r\n\r\n\t\t\t\tspotDistances[ spotLength ] = distance;\r\n\r\n\t\t\t\t_vector3.setFromMatrixPosition( light.target.matrixWorld );\r\n\t\t\t\t_direction.sub( _vector3 );\r\n\t\t\t\t_direction.normalize();\r\n\r\n\t\t\t\tspotDirections[ spotOffset ]     = _direction.x;\r\n\t\t\t\tspotDirections[ spotOffset + 1 ] = _direction.y;\r\n\t\t\t\tspotDirections[ spotOffset + 2 ] = _direction.z;\r\n\r\n\t\t\t\tspotAnglesCos[ spotLength ] = Math.cos( light.angle );\r\n\t\t\t\tspotExponents[ spotLength ] = light.exponent;\r\n\t\t\t\tspotDecays[ spotLength ] = ( light.distance === 0 ) ? 0.0 : light.decay;\r\n\r\n\t\t\t\tspotLength += 1;\r\n\r\n\t\t\t} else if ( light instanceof THREE.HemisphereLight ) {\r\n\r\n\t\t\t\themiCount += 1;\r\n\r\n\t\t\t\tif ( ! light.visible ) continue;\r\n\r\n\t\t\t\t_direction.setFromMatrixPosition( light.matrixWorld );\r\n\t\t\t\t_direction.normalize();\r\n\r\n\t\t\t\themiOffset = hemiLength * 3;\r\n\r\n\t\t\t\themiPositions[ hemiOffset ]     = _direction.x;\r\n\t\t\t\themiPositions[ hemiOffset + 1 ] = _direction.y;\r\n\t\t\t\themiPositions[ hemiOffset + 2 ] = _direction.z;\r\n\r\n\t\t\t\tskyColor = light.color;\r\n\t\t\t\tgroundColor = light.groundColor;\r\n\r\n\t\t\t\tsetColorLinear( hemiSkyColors, hemiOffset, skyColor, intensity );\r\n\t\t\t\tsetColorLinear( hemiGroundColors, hemiOffset, groundColor, intensity );\r\n\r\n\t\t\t\themiLength += 1;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\t// null eventual remains from removed lights\r\n\t\t// (this is to avoid if in shader)\r\n\r\n\t\tfor ( l = dirLength * 3, ll = Math.max( dirColors.length, dirCount * 3 ); l < ll; l ++ ) dirColors[ l ] = 0.0;\r\n\t\tfor ( l = pointLength * 3, ll = Math.max( pointColors.length, pointCount * 3 ); l < ll; l ++ ) pointColors[ l ] = 0.0;\r\n\t\tfor ( l = spotLength * 3, ll = Math.max( spotColors.length, spotCount * 3 ); l < ll; l ++ ) spotColors[ l ] = 0.0;\r\n\t\tfor ( l = hemiLength * 3, ll = Math.max( hemiSkyColors.length, hemiCount * 3 ); l < ll; l ++ ) hemiSkyColors[ l ] = 0.0;\r\n\t\tfor ( l = hemiLength * 3, ll = Math.max( hemiGroundColors.length, hemiCount * 3 ); l < ll; l ++ ) hemiGroundColors[ l ] = 0.0;\r\n\r\n\t\tzlights.directional.length = dirLength;\r\n\t\tzlights.point.length = pointLength;\r\n\t\tzlights.spot.length = spotLength;\r\n\t\tzlights.hemi.length = hemiLength;\r\n\r\n\t\tzlights.ambient[ 0 ] = r;\r\n\t\tzlights.ambient[ 1 ] = g;\r\n\t\tzlights.ambient[ 2 ] = b;\r\n\r\n\t}\r\n\r\n\t// GL state setting\r\n\r\n\tthis.setFaceCulling = function ( cullFace, frontFaceDirection ) {\r\n\r\n\t\tif ( cullFace === THREE.CullFaceNone ) {\r\n\r\n\t\t\t_gl.disable( _gl.CULL_FACE );\r\n\r\n\t\t} else {\r\n\r\n\t\t\tif ( frontFaceDirection === THREE.FrontFaceDirectionCW ) {\r\n\r\n\t\t\t\t_gl.frontFace( _gl.CW );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\t_gl.frontFace( _gl.CCW );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( cullFace === THREE.CullFaceBack ) {\r\n\r\n\t\t\t\t_gl.cullFace( _gl.BACK );\r\n\r\n\t\t\t} else if ( cullFace === THREE.CullFaceFront ) {\r\n\r\n\t\t\t\t_gl.cullFace( _gl.FRONT );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\t_gl.cullFace( _gl.FRONT_AND_BACK );\r\n\r\n\t\t\t}\r\n\r\n\t\t\t_gl.enable( _gl.CULL_FACE );\r\n\r\n\t\t}\r\n\r\n\t};\r\n\r\n\tthis.setMaterialFaces = function ( material ) {\r\n\r\n\t\tstate.setDoubleSided( material.side === THREE.DoubleSide );\r\n\t\tstate.setFlipSided( material.side === THREE.BackSide );\r\n\r\n\t};\r\n\r\n\t// Textures\r\n\r\n\tfunction setTextureParameters ( textureType, texture, isImagePowerOfTwo ) {\r\n\r\n\t\tvar extension;\r\n\r\n\t\tif ( isImagePowerOfTwo ) {\r\n\r\n\t\t\t_gl.texParameteri( textureType, _gl.TEXTURE_WRAP_S, paramThreeToGL( texture.wrapS ) );\r\n\t\t\t_gl.texParameteri( textureType, _gl.TEXTURE_WRAP_T, paramThreeToGL( texture.wrapT ) );\r\n\r\n\t\t\t_gl.texParameteri( textureType, _gl.TEXTURE_MAG_FILTER, paramThreeToGL( texture.magFilter ) );\r\n\t\t\t_gl.texParameteri( textureType, _gl.TEXTURE_MIN_FILTER, paramThreeToGL( texture.minFilter ) );\r\n\r\n\t\t} else {\r\n\r\n\t\t\t_gl.texParameteri( textureType, _gl.TEXTURE_WRAP_S, _gl.CLAMP_TO_EDGE );\r\n\t\t\t_gl.texParameteri( textureType, _gl.TEXTURE_WRAP_T, _gl.CLAMP_TO_EDGE );\r\n\r\n\t\t\tif ( texture.wrapS !== THREE.ClampToEdgeWrapping || texture.wrapT !== THREE.ClampToEdgeWrapping ) {\r\n\r\n\t\t\t\tTHREE.warn( 'THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping. ( ' + texture.sourceFile + ' )' );\r\n\r\n\t\t\t}\r\n\r\n\t\t\t_gl.texParameteri( textureType, _gl.TEXTURE_MAG_FILTER, filterFallback( texture.magFilter ) );\r\n\t\t\t_gl.texParameteri( textureType, _gl.TEXTURE_MIN_FILTER, filterFallback( texture.minFilter ) );\r\n\r\n\t\t\tif ( texture.minFilter !== THREE.NearestFilter && texture.minFilter !== THREE.LinearFilter ) {\r\n\r\n\t\t\t\tTHREE.warn( 'THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter. ( ' + texture.sourceFile + ' )' );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\textension = extensions.get( 'EXT_texture_filter_anisotropic' );\r\n\r\n\t\tif ( extension && texture.type !== THREE.FloatType && texture.type !== THREE.HalfFloatType ) {\r\n\r\n\t\t\tif ( texture.anisotropy > 1 || texture.__currentAnisotropy ) {\r\n\r\n\t\t\t\t_gl.texParameterf( textureType, extension.TEXTURE_MAX_ANISOTROPY_EXT, Math.min( texture.anisotropy, _this.getMaxAnisotropy() ) );\r\n\t\t\t\ttexture.__currentAnisotropy = texture.anisotropy;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tthis.uploadTexture = function ( texture ) {\r\n\r\n\t\tif ( texture.__webglInit === undefined ) {\r\n\r\n\t\t\ttexture.__webglInit = true;\r\n\r\n\t\t\ttexture.addEventListener( 'dispose', onTextureDispose );\r\n\r\n\t\t\ttexture.__webglTexture = _gl.createTexture();\r\n\r\n\t\t\t_this.info.memory.textures ++;\r\n\r\n\t\t}\r\n\r\n\t\t_gl.bindTexture( _gl.TEXTURE_2D, texture.__webglTexture );\r\n\r\n\t\t_gl.pixelStorei( _gl.UNPACK_FLIP_Y_WEBGL, texture.flipY );\r\n\t\t_gl.pixelStorei( _gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL, texture.premultiplyAlpha );\r\n\t\t_gl.pixelStorei( _gl.UNPACK_ALIGNMENT, texture.unpackAlignment );\r\n\r\n\t\ttexture.image = clampToMaxSize( texture.image, _maxTextureSize );\r\n\r\n\t\tvar image = texture.image,\r\n\t\tisImagePowerOfTwo = THREE.Math.isPowerOfTwo( image.width ) && THREE.Math.isPowerOfTwo( image.height ),\r\n\t\tglFormat = paramThreeToGL( texture.format ),\r\n\t\tglType = paramThreeToGL( texture.type );\r\n\r\n\t\tsetTextureParameters( _gl.TEXTURE_2D, texture, isImagePowerOfTwo );\r\n\r\n\t\tvar mipmap, mipmaps = texture.mipmaps;\r\n\r\n\t\tif ( texture instanceof THREE.DataTexture ) {\r\n\r\n\t\t\t// use manually created mipmaps if available\r\n\t\t\t// if there are no manual mipmaps\r\n\t\t\t// set 0 level mipmap and then use GL to generate other mipmap levels\r\n\r\n\t\t\tif ( mipmaps.length > 0 && isImagePowerOfTwo ) {\r\n\r\n\t\t\t\tfor ( var i = 0, il = mipmaps.length; i < il; i ++ ) {\r\n\r\n\t\t\t\t\tmipmap = mipmaps[ i ];\r\n\t\t\t\t\t_gl.texImage2D( _gl.TEXTURE_2D, i, glFormat, mipmap.width, mipmap.height, 0, glFormat, glType, mipmap.data );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\ttexture.generateMipmaps = false;\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\t_gl.texImage2D( _gl.TEXTURE_2D, 0, glFormat, image.width, image.height, 0, glFormat, glType, image.data );\r\n\r\n\t\t\t}\r\n\r\n\t\t} else if ( texture instanceof THREE.CompressedTexture ) {\r\n\r\n\t\t\tfor ( var i = 0, il = mipmaps.length; i < il; i ++ ) {\r\n\r\n\t\t\t\tmipmap = mipmaps[ i ];\r\n\r\n\t\t\t\tif ( texture.format !== THREE.RGBAFormat && texture.format !== THREE.RGBFormat ) {\r\n\r\n\t\t\t\t\tif ( getCompressedTextureFormats().indexOf( glFormat ) > -1 ) {\r\n\r\n\t\t\t\t\t\t_gl.compressedTexImage2D( _gl.TEXTURE_2D, i, glFormat, mipmap.width, mipmap.height, 0, mipmap.data );\r\n\r\n\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\tTHREE.warn( \"THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()\" );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\t_gl.texImage2D( _gl.TEXTURE_2D, i, glFormat, mipmap.width, mipmap.height, 0, glFormat, glType, mipmap.data );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t} else { // regular Texture (image, video, canvas)\r\n\r\n\t\t\t// use manually created mipmaps if available\r\n\t\t\t// if there are no manual mipmaps\r\n\t\t\t// set 0 level mipmap and then use GL to generate other mipmap levels\r\n\r\n\t\t\tif ( mipmaps.length > 0 && isImagePowerOfTwo ) {\r\n\r\n\t\t\t\tfor ( var i = 0, il = mipmaps.length; i < il; i ++ ) {\r\n\r\n\t\t\t\t\tmipmap = mipmaps[ i ];\r\n\t\t\t\t\t_gl.texImage2D( _gl.TEXTURE_2D, i, glFormat, glFormat, glType, mipmap );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\ttexture.generateMipmaps = false;\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\t_gl.texImage2D( _gl.TEXTURE_2D, 0, glFormat, glFormat, glType, texture.image );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tif ( texture.generateMipmaps && isImagePowerOfTwo ) _gl.generateMipmap( _gl.TEXTURE_2D );\r\n\r\n\t\ttexture.needsUpdate = false;\r\n\r\n\t\tif ( texture.onUpdate ) texture.onUpdate();\r\n\r\n\t};\r\n\r\n\tthis.setTexture = function ( texture, slot ) {\r\n\r\n\t\t_gl.activeTexture( _gl.TEXTURE0 + slot );\r\n\r\n\t\tif ( texture.needsUpdate ) {\r\n\r\n\t\t\t_this.uploadTexture( texture );\r\n\r\n\t\t} else {\r\n\r\n\t\t\t_gl.bindTexture( _gl.TEXTURE_2D, texture.__webglTexture );\r\n\r\n\t\t}\r\n\r\n\t};\r\n\r\n\tfunction clampToMaxSize ( image, maxSize ) {\r\n\r\n\t\tif ( image.width > maxSize || image.height > maxSize ) {\r\n\r\n\t\t\t// Warning: Scaling through the canvas will only work with images that use\r\n\t\t\t// premultiplied alpha.\r\n\r\n\t\t\tvar scale = maxSize / Math.max( image.width, image.height );\r\n\r\n\t\t\tvar canvas = document.createElement( 'canvas' );\r\n\t\t\tcanvas.width = Math.floor( image.width * scale );\r\n\t\t\tcanvas.height = Math.floor( image.height * scale );\r\n\r\n\t\t\tvar context = canvas.getContext( '2d' );\r\n\t\t\tcontext.drawImage( image, 0, 0, image.width, image.height, 0, 0, canvas.width, canvas.height );\r\n\r\n\t\t\tTHREE.warn( 'THREE.WebGLRenderer: image is too big (' + image.width + 'x' + image.height + '). Resized to ' + canvas.width + 'x' + canvas.height, image );\r\n\r\n\t\t\treturn canvas;\r\n\r\n\t\t}\r\n\r\n\t\treturn image;\r\n\r\n\t}\r\n\r\n\tfunction setCubeTexture ( texture, slot ) {\r\n\r\n\t\tif ( texture.image.length === 6 ) {\r\n\r\n\t\t\tif ( texture.needsUpdate ) {\r\n\r\n\t\t\t\tif ( ! texture.image.__webglTextureCube ) {\r\n\r\n\t\t\t\t\ttexture.addEventListener( 'dispose', onTextureDispose );\r\n\r\n\t\t\t\t\ttexture.image.__webglTextureCube = _gl.createTexture();\r\n\r\n\t\t\t\t\t_this.info.memory.textures ++;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\t_gl.activeTexture( _gl.TEXTURE0 + slot );\r\n\t\t\t\t_gl.bindTexture( _gl.TEXTURE_CUBE_MAP, texture.image.__webglTextureCube );\r\n\r\n\t\t\t\t_gl.pixelStorei( _gl.UNPACK_FLIP_Y_WEBGL, texture.flipY );\r\n\r\n\t\t\t\tvar isCompressed = texture instanceof THREE.CompressedTexture;\r\n\t\t\t\tvar isDataTexture = texture.image[ 0 ] instanceof THREE.DataTexture;\r\n\r\n\t\t\t\tvar cubeImage = [];\r\n\r\n\t\t\t\tfor ( var i = 0; i < 6; i ++ ) {\r\n\r\n\t\t\t\t\tif ( _this.autoScaleCubemaps && ! isCompressed && ! isDataTexture ) {\r\n\r\n\t\t\t\t\t\tcubeImage[ i ] = clampToMaxSize( texture.image[ i ], _maxCubemapSize );\r\n\r\n\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\tcubeImage[ i ] = isDataTexture ? texture.image[ i ].image : texture.image[ i ];\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar image = cubeImage[ 0 ],\r\n\t\t\t\tisImagePowerOfTwo = THREE.Math.isPowerOfTwo( image.width ) && THREE.Math.isPowerOfTwo( image.height ),\r\n\t\t\t\tglFormat = paramThreeToGL( texture.format ),\r\n\t\t\t\tglType = paramThreeToGL( texture.type );\r\n\r\n\t\t\t\tsetTextureParameters( _gl.TEXTURE_CUBE_MAP, texture, isImagePowerOfTwo );\r\n\r\n\t\t\t\tfor ( var i = 0; i < 6; i ++ ) {\r\n\r\n\t\t\t\t\tif ( ! isCompressed ) {\r\n\r\n\t\t\t\t\t\tif ( isDataTexture ) {\r\n\r\n\t\t\t\t\t\t\t_gl.texImage2D( _gl.TEXTURE_CUBE_MAP_POSITIVE_X + i, 0, glFormat, cubeImage[ i ].width, cubeImage[ i ].height, 0, glFormat, glType, cubeImage[ i ].data );\r\n\r\n\t\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\t\t_gl.texImage2D( _gl.TEXTURE_CUBE_MAP_POSITIVE_X + i, 0, glFormat, glFormat, glType, cubeImage[ i ] );\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\tvar mipmap, mipmaps = cubeImage[ i ].mipmaps;\r\n\r\n\t\t\t\t\t\tfor ( var j = 0, jl = mipmaps.length; j < jl; j ++ ) {\r\n\r\n\t\t\t\t\t\t\tmipmap = mipmaps[ j ];\r\n\r\n\t\t\t\t\t\t\tif ( texture.format !== THREE.RGBAFormat && texture.format !== THREE.RGBFormat ) {\r\n\r\n\t\t\t\t\t\t\t\tif ( getCompressedTextureFormats().indexOf( glFormat ) > -1 ) {\r\n\r\n\t\t\t\t\t\t\t\t\t_gl.compressedTexImage2D( _gl.TEXTURE_CUBE_MAP_POSITIVE_X + i, j, glFormat, mipmap.width, mipmap.height, 0, mipmap.data );\r\n\r\n\t\t\t\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\t\t\t\tTHREE.warn( \"THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setCubeTexture()\" );\r\n\r\n\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\t\t\t_gl.texImage2D( _gl.TEXTURE_CUBE_MAP_POSITIVE_X + i, j, glFormat, mipmap.width, mipmap.height, 0, glFormat, glType, mipmap.data );\r\n\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( texture.generateMipmaps && isImagePowerOfTwo ) {\r\n\r\n\t\t\t\t\t_gl.generateMipmap( _gl.TEXTURE_CUBE_MAP );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\ttexture.needsUpdate = false;\r\n\r\n\t\t\t\tif ( texture.onUpdate ) texture.onUpdate();\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\t_gl.activeTexture( _gl.TEXTURE0 + slot );\r\n\t\t\t\t_gl.bindTexture( _gl.TEXTURE_CUBE_MAP, texture.image.__webglTextureCube );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tfunction setCubeTextureDynamic ( texture, slot ) {\r\n\r\n\t\t_gl.activeTexture( _gl.TEXTURE0 + slot );\r\n\t\t_gl.bindTexture( _gl.TEXTURE_CUBE_MAP, texture.__webglTexture );\r\n\r\n\t}\r\n\r\n\t// Render targets\r\n\r\n\tfunction setupFrameBuffer ( framebuffer, renderTarget, textureTarget ) {\r\n\r\n\t\t_gl.bindFramebuffer( _gl.FRAMEBUFFER, framebuffer );\r\n\t\t_gl.framebufferTexture2D( _gl.FRAMEBUFFER, _gl.COLOR_ATTACHMENT0, textureTarget, renderTarget.__webglTexture, 0 );\r\n\r\n\t}\r\n\r\n\tfunction setupRenderBuffer ( renderbuffer, renderTarget  ) {\r\n\r\n\t\t_gl.bindRenderbuffer( _gl.RENDERBUFFER, renderbuffer );\r\n\r\n\t\tif ( renderTarget.depthBuffer && ! renderTarget.stencilBuffer ) {\r\n\r\n\t\t\t_gl.renderbufferStorage( _gl.RENDERBUFFER, _gl.DEPTH_COMPONENT16, renderTarget.width, renderTarget.height );\r\n\t\t\t_gl.framebufferRenderbuffer( _gl.FRAMEBUFFER, _gl.DEPTH_ATTACHMENT, _gl.RENDERBUFFER, renderbuffer );\r\n\r\n\t\t/* For some reason this is not working. Defaulting to RGBA4.\r\n\t\t} else if ( ! renderTarget.depthBuffer && renderTarget.stencilBuffer ) {\r\n\r\n\t\t\t_gl.renderbufferStorage( _gl.RENDERBUFFER, _gl.STENCIL_INDEX8, renderTarget.width, renderTarget.height );\r\n\t\t\t_gl.framebufferRenderbuffer( _gl.FRAMEBUFFER, _gl.STENCIL_ATTACHMENT, _gl.RENDERBUFFER, renderbuffer );\r\n\t\t*/\r\n\t\t} else if ( renderTarget.depthBuffer && renderTarget.stencilBuffer ) {\r\n\r\n\t\t\t_gl.renderbufferStorage( _gl.RENDERBUFFER, _gl.DEPTH_STENCIL, renderTarget.width, renderTarget.height );\r\n\t\t\t_gl.framebufferRenderbuffer( _gl.FRAMEBUFFER, _gl.DEPTH_STENCIL_ATTACHMENT, _gl.RENDERBUFFER, renderbuffer );\r\n\r\n\t\t} else {\r\n\r\n\t\t\t_gl.renderbufferStorage( _gl.RENDERBUFFER, _gl.RGBA4, renderTarget.width, renderTarget.height );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tthis.setRenderTarget = function ( renderTarget ) {\r\n\r\n\t\tvar isCube = ( renderTarget instanceof THREE.WebGLRenderTargetCube );\r\n\r\n\t\tif ( renderTarget && renderTarget.__webglFramebuffer === undefined ) {\r\n\r\n\t\t\tif ( renderTarget.depthBuffer === undefined ) renderTarget.depthBuffer = true;\r\n\t\t\tif ( renderTarget.stencilBuffer === undefined ) renderTarget.stencilBuffer = true;\r\n\r\n\t\t\trenderTarget.addEventListener( 'dispose', onRenderTargetDispose );\r\n\r\n\t\t\trenderTarget.__webglTexture = _gl.createTexture();\r\n\r\n\t\t\t_this.info.memory.textures ++;\r\n\r\n\t\t\t// Setup texture, create render and frame buffers\r\n\r\n\t\t\tvar isTargetPowerOfTwo = THREE.Math.isPowerOfTwo( renderTarget.width ) && THREE.Math.isPowerOfTwo( renderTarget.height ),\r\n\t\t\t\tglFormat = paramThreeToGL( renderTarget.format ),\r\n\t\t\t\tglType = paramThreeToGL( renderTarget.type );\r\n\r\n\t\t\tif ( isCube ) {\r\n\r\n\t\t\t\trenderTarget.__webglFramebuffer = [];\r\n\t\t\t\trenderTarget.__webglRenderbuffer = [];\r\n\r\n\t\t\t\t_gl.bindTexture( _gl.TEXTURE_CUBE_MAP, renderTarget.__webglTexture );\r\n\t\t\t\tsetTextureParameters( _gl.TEXTURE_CUBE_MAP, renderTarget, isTargetPowerOfTwo );\r\n\r\n\t\t\t\tfor ( var i = 0; i < 6; i ++ ) {\r\n\r\n\t\t\t\t\trenderTarget.__webglFramebuffer[ i ] = _gl.createFramebuffer();\r\n\t\t\t\t\trenderTarget.__webglRenderbuffer[ i ] = _gl.createRenderbuffer();\r\n\r\n\t\t\t\t\t_gl.texImage2D( _gl.TEXTURE_CUBE_MAP_POSITIVE_X + i, 0, glFormat, renderTarget.width, renderTarget.height, 0, glFormat, glType, null );\r\n\r\n\t\t\t\t\tsetupFrameBuffer( renderTarget.__webglFramebuffer[ i ], renderTarget, _gl.TEXTURE_CUBE_MAP_POSITIVE_X + i );\r\n\t\t\t\t\tsetupRenderBuffer( renderTarget.__webglRenderbuffer[ i ], renderTarget );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( isTargetPowerOfTwo ) _gl.generateMipmap( _gl.TEXTURE_CUBE_MAP );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\trenderTarget.__webglFramebuffer = _gl.createFramebuffer();\r\n\r\n\t\t\t\tif ( renderTarget.shareDepthFrom ) {\r\n\r\n\t\t\t\t\trenderTarget.__webglRenderbuffer = renderTarget.shareDepthFrom.__webglRenderbuffer;\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\trenderTarget.__webglRenderbuffer = _gl.createRenderbuffer();\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\t_gl.bindTexture( _gl.TEXTURE_2D, renderTarget.__webglTexture );\r\n\t\t\t\tsetTextureParameters( _gl.TEXTURE_2D, renderTarget, isTargetPowerOfTwo );\r\n\r\n\t\t\t\t_gl.texImage2D( _gl.TEXTURE_2D, 0, glFormat, renderTarget.width, renderTarget.height, 0, glFormat, glType, null );\r\n\r\n\t\t\t\tsetupFrameBuffer( renderTarget.__webglFramebuffer, renderTarget, _gl.TEXTURE_2D );\r\n\r\n\t\t\t\tif ( renderTarget.shareDepthFrom ) {\r\n\r\n\t\t\t\t\tif ( renderTarget.depthBuffer && ! renderTarget.stencilBuffer ) {\r\n\r\n\t\t\t\t\t\t_gl.framebufferRenderbuffer( _gl.FRAMEBUFFER, _gl.DEPTH_ATTACHMENT, _gl.RENDERBUFFER, renderTarget.__webglRenderbuffer );\r\n\r\n\t\t\t\t\t} else if ( renderTarget.depthBuffer && renderTarget.stencilBuffer ) {\r\n\r\n\t\t\t\t\t\t_gl.framebufferRenderbuffer( _gl.FRAMEBUFFER, _gl.DEPTH_STENCIL_ATTACHMENT, _gl.RENDERBUFFER, renderTarget.__webglRenderbuffer );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\tsetupRenderBuffer( renderTarget.__webglRenderbuffer, renderTarget );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( isTargetPowerOfTwo ) _gl.generateMipmap( _gl.TEXTURE_2D );\r\n\r\n\t\t\t}\r\n\r\n\t\t\t// Release everything\r\n\r\n\t\t\tif ( isCube ) {\r\n\r\n\t\t\t\t_gl.bindTexture( _gl.TEXTURE_CUBE_MAP, null );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\t_gl.bindTexture( _gl.TEXTURE_2D, null );\r\n\r\n\t\t\t}\r\n\r\n\t\t\t_gl.bindRenderbuffer( _gl.RENDERBUFFER, null );\r\n\t\t\t_gl.bindFramebuffer( _gl.FRAMEBUFFER, null );\r\n\r\n\t\t}\r\n\r\n\t\tvar framebuffer, width, height, vx, vy;\r\n\r\n\t\tif ( renderTarget ) {\r\n\r\n\t\t\tif ( isCube ) {\r\n\r\n\t\t\t\tframebuffer = renderTarget.__webglFramebuffer[ renderTarget.activeCubeFace ];\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tframebuffer = renderTarget.__webglFramebuffer;\r\n\r\n\t\t\t}\r\n\r\n\t\t\twidth = renderTarget.width;\r\n\t\t\theight = renderTarget.height;\r\n\r\n\t\t\tvx = 0;\r\n\t\t\tvy = 0;\r\n\r\n\t\t} else {\r\n\r\n\t\t\tframebuffer = null;\r\n\r\n\t\t\twidth = _viewportWidth;\r\n\t\t\theight = _viewportHeight;\r\n\r\n\t\t\tvx = _viewportX;\r\n\t\t\tvy = _viewportY;\r\n\r\n\t\t}\r\n\r\n\t\tif ( framebuffer !== _currentFramebuffer ) {\r\n\r\n\t\t\t_gl.bindFramebuffer( _gl.FRAMEBUFFER, framebuffer );\r\n\t\t\t_gl.viewport( vx, vy, width, height );\r\n\r\n\t\t\t_currentFramebuffer = framebuffer;\r\n\r\n\t\t}\r\n\r\n\t\t_currentWidth = width;\r\n\t\t_currentHeight = height;\r\n\r\n\t};\r\n\r\n\tthis.readRenderTargetPixels = function( renderTarget, x, y, width, height, buffer ) {\r\n\r\n\t\tif ( ! ( renderTarget instanceof THREE.WebGLRenderTarget ) ) {\r\n\r\n\t\t\tconsole.error( 'THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.' );\r\n\t\t\treturn;\r\n\r\n\t\t}\r\n\r\n\t\tif ( renderTarget.__webglFramebuffer ) {\r\n\r\n\t\t\tif ( renderTarget.format !== THREE.RGBAFormat ) {\r\n\r\n\t\t\t\tconsole.error( 'THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA format. readPixels can read only RGBA format.' );\r\n\t\t\t\treturn;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tvar restore = false;\r\n\r\n\t\t\tif ( renderTarget.__webglFramebuffer !== _currentFramebuffer ) {\r\n\r\n\t\t\t\t_gl.bindFramebuffer( _gl.FRAMEBUFFER, renderTarget.__webglFramebuffer );\r\n\r\n\t\t\t\trestore = true;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( _gl.checkFramebufferStatus( _gl.FRAMEBUFFER ) === _gl.FRAMEBUFFER_COMPLETE ) {\r\n\r\n\t\t\t\t_gl.readPixels( x, y, width, height, _gl.RGBA, _gl.UNSIGNED_BYTE, buffer );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tconsole.error( 'THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.' );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( restore ) {\r\n\r\n\t\t\t\t_gl.bindFramebuffer( _gl.FRAMEBUFFER, _currentFramebuffer );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t};\r\n\r\n\tfunction updateRenderTargetMipmap ( renderTarget ) {\r\n\r\n\t\tif ( renderTarget instanceof THREE.WebGLRenderTargetCube ) {\r\n\r\n\t\t\t_gl.bindTexture( _gl.TEXTURE_CUBE_MAP, renderTarget.__webglTexture );\r\n\t\t\t_gl.generateMipmap( _gl.TEXTURE_CUBE_MAP );\r\n\t\t\t_gl.bindTexture( _gl.TEXTURE_CUBE_MAP, null );\r\n\r\n\t\t} else {\r\n\r\n\t\t\t_gl.bindTexture( _gl.TEXTURE_2D, renderTarget.__webglTexture );\r\n\t\t\t_gl.generateMipmap( _gl.TEXTURE_2D );\r\n\t\t\t_gl.bindTexture( _gl.TEXTURE_2D, null );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\t// Fallback filters for non-power-of-2 textures\r\n\r\n\tfunction filterFallback ( f ) {\r\n\r\n\t\tif ( f === THREE.NearestFilter || f === THREE.NearestMipMapNearestFilter || f === THREE.NearestMipMapLinearFilter ) {\r\n\r\n\t\t\treturn _gl.NEAREST;\r\n\r\n\t\t}\r\n\r\n\t\treturn _gl.LINEAR;\r\n\r\n\t}\r\n\r\n\t// Map three.js constants to WebGL constants\r\n\r\n\tfunction paramThreeToGL ( p ) {\r\n\r\n\t\tvar extension;\r\n\r\n\t\tif ( p === THREE.RepeatWrapping ) return _gl.REPEAT;\r\n\t\tif ( p === THREE.ClampToEdgeWrapping ) return _gl.CLAMP_TO_EDGE;\r\n\t\tif ( p === THREE.MirroredRepeatWrapping ) return _gl.MIRRORED_REPEAT;\r\n\r\n\t\tif ( p === THREE.NearestFilter ) return _gl.NEAREST;\r\n\t\tif ( p === THREE.NearestMipMapNearestFilter ) return _gl.NEAREST_MIPMAP_NEAREST;\r\n\t\tif ( p === THREE.NearestMipMapLinearFilter ) return _gl.NEAREST_MIPMAP_LINEAR;\r\n\r\n\t\tif ( p === THREE.LinearFilter ) return _gl.LINEAR;\r\n\t\tif ( p === THREE.LinearMipMapNearestFilter ) return _gl.LINEAR_MIPMAP_NEAREST;\r\n\t\tif ( p === THREE.LinearMipMapLinearFilter ) return _gl.LINEAR_MIPMAP_LINEAR;\r\n\r\n\t\tif ( p === THREE.UnsignedByteType ) return _gl.UNSIGNED_BYTE;\r\n\t\tif ( p === THREE.UnsignedShort4444Type ) return _gl.UNSIGNED_SHORT_4_4_4_4;\r\n\t\tif ( p === THREE.UnsignedShort5551Type ) return _gl.UNSIGNED_SHORT_5_5_5_1;\r\n\t\tif ( p === THREE.UnsignedShort565Type ) return _gl.UNSIGNED_SHORT_5_6_5;\r\n\r\n\t\tif ( p === THREE.ByteType ) return _gl.BYTE;\r\n\t\tif ( p === THREE.ShortType ) return _gl.SHORT;\r\n\t\tif ( p === THREE.UnsignedShortType ) return _gl.UNSIGNED_SHORT;\r\n\t\tif ( p === THREE.IntType ) return _gl.INT;\r\n\t\tif ( p === THREE.UnsignedIntType ) return _gl.UNSIGNED_INT;\r\n\t\tif ( p === THREE.FloatType ) return _gl.FLOAT;\r\n\r\n\t\textension = extensions.get( 'OES_texture_half_float' );\r\n\r\n\t\tif ( extension !== null ) {\r\n\r\n\t\t\tif ( p === THREE.HalfFloatType ) return extension.HALF_FLOAT_OES;\r\n\r\n\t\t}\r\n\r\n\t\tif ( p === THREE.AlphaFormat ) return _gl.ALPHA;\r\n\t\tif ( p === THREE.RGBFormat ) return _gl.RGB;\r\n\t\tif ( p === THREE.RGBAFormat ) return _gl.RGBA;\r\n\t\tif ( p === THREE.LuminanceFormat ) return _gl.LUMINANCE;\r\n\t\tif ( p === THREE.LuminanceAlphaFormat ) return _gl.LUMINANCE_ALPHA;\r\n\r\n\t\tif ( p === THREE.AddEquation ) return _gl.FUNC_ADD;\r\n\t\tif ( p === THREE.SubtractEquation ) return _gl.FUNC_SUBTRACT;\r\n\t\tif ( p === THREE.ReverseSubtractEquation ) return _gl.FUNC_REVERSE_SUBTRACT;\r\n\r\n\t\tif ( p === THREE.ZeroFactor ) return _gl.ZERO;\r\n\t\tif ( p === THREE.OneFactor ) return _gl.ONE;\r\n\t\tif ( p === THREE.SrcColorFactor ) return _gl.SRC_COLOR;\r\n\t\tif ( p === THREE.OneMinusSrcColorFactor ) return _gl.ONE_MINUS_SRC_COLOR;\r\n\t\tif ( p === THREE.SrcAlphaFactor ) return _gl.SRC_ALPHA;\r\n\t\tif ( p === THREE.OneMinusSrcAlphaFactor ) return _gl.ONE_MINUS_SRC_ALPHA;\r\n\t\tif ( p === THREE.DstAlphaFactor ) return _gl.DST_ALPHA;\r\n\t\tif ( p === THREE.OneMinusDstAlphaFactor ) return _gl.ONE_MINUS_DST_ALPHA;\r\n\r\n\t\tif ( p === THREE.DstColorFactor ) return _gl.DST_COLOR;\r\n\t\tif ( p === THREE.OneMinusDstColorFactor ) return _gl.ONE_MINUS_DST_COLOR;\r\n\t\tif ( p === THREE.SrcAlphaSaturateFactor ) return _gl.SRC_ALPHA_SATURATE;\r\n\r\n\t\textension = extensions.get( 'WEBGL_compressed_texture_s3tc' );\r\n\r\n\t\tif ( extension !== null ) {\r\n\r\n\t\t\tif ( p === THREE.RGB_S3TC_DXT1_Format ) return extension.COMPRESSED_RGB_S3TC_DXT1_EXT;\r\n\t\t\tif ( p === THREE.RGBA_S3TC_DXT1_Format ) return extension.COMPRESSED_RGBA_S3TC_DXT1_EXT;\r\n\t\t\tif ( p === THREE.RGBA_S3TC_DXT3_Format ) return extension.COMPRESSED_RGBA_S3TC_DXT3_EXT;\r\n\t\t\tif ( p === THREE.RGBA_S3TC_DXT5_Format ) return extension.COMPRESSED_RGBA_S3TC_DXT5_EXT;\r\n\r\n\t\t}\r\n\r\n\t\textension = extensions.get( 'WEBGL_compressed_texture_pvrtc' );\r\n\r\n\t\tif ( extension !== null ) {\r\n\r\n\t\t\tif ( p === THREE.RGB_PVRTC_4BPPV1_Format ) return extension.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;\r\n\t\t\tif ( p === THREE.RGB_PVRTC_2BPPV1_Format ) return extension.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;\r\n\t\t\tif ( p === THREE.RGBA_PVRTC_4BPPV1_Format ) return extension.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;\r\n\t\t\tif ( p === THREE.RGBA_PVRTC_2BPPV1_Format ) return extension.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG;\r\n\r\n\t\t}\r\n\r\n\t\textension = extensions.get( 'EXT_blend_minmax' );\r\n\r\n\t\tif ( extension !== null ) {\r\n\r\n\t\t\tif ( p === THREE.MinEquation ) return extension.MIN_EXT;\r\n\t\t\tif ( p === THREE.MaxEquation ) return extension.MAX_EXT;\r\n\r\n\t\t}\r\n\r\n\t\treturn 0;\r\n\r\n\t}\r\n\r\n\t// Allocations\r\n\r\n\tfunction allocateBones ( object ) {\r\n\r\n\t\tif ( _supportsBoneTextures && object && object.skeleton && object.skeleton.useVertexTexture ) {\r\n\r\n\t\t\treturn 1024;\r\n\r\n\t\t} else {\r\n\r\n\t\t\t// default for when object is not specified\r\n\t\t\t// ( for example when prebuilding shader\r\n\t\t\t//   to be used with multiple objects )\r\n\t\t\t//\r\n\t\t\t//  - leave some extra space for other uniforms\r\n\t\t\t//  - limit here is ANGLE's 254 max uniform vectors\r\n\t\t\t//    (up to 54 should be safe)\r\n\r\n\t\t\tvar nVertexUniforms = _gl.getParameter( _gl.MAX_VERTEX_UNIFORM_VECTORS );\r\n\t\t\tvar nVertexMatrices = Math.floor( ( nVertexUniforms - 20 ) / 4 );\r\n\r\n\t\t\tvar maxBones = nVertexMatrices;\r\n\r\n\t\t\tif ( object !== undefined && object instanceof THREE.SkinnedMesh ) {\r\n\r\n\t\t\t\tmaxBones = Math.min( object.skeleton.bones.length, maxBones );\r\n\r\n\t\t\t\tif ( maxBones < object.skeleton.bones.length ) {\r\n\r\n\t\t\t\t\tTHREE.warn( 'WebGLRenderer: too many bones - ' + object.skeleton.bones.length + ', this GPU supports just ' + maxBones + ' (try OpenGL instead of ANGLE)' );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn maxBones;\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tfunction allocateLights( lights ) {\r\n\r\n\t\tvar dirLights = 0;\r\n\t\tvar pointLights = 0;\r\n\t\tvar spotLights = 0;\r\n\t\tvar hemiLights = 0;\r\n\r\n\t\tfor ( var l = 0, ll = lights.length; l < ll; l ++ ) {\r\n\r\n\t\t\tvar light = lights[ l ];\r\n\r\n\t\t\tif ( light.onlyShadow || light.visible === false ) continue;\r\n\r\n\t\t\tif ( light instanceof THREE.DirectionalLight ) dirLights ++;\r\n\t\t\tif ( light instanceof THREE.PointLight ) pointLights ++;\r\n\t\t\tif ( light instanceof THREE.SpotLight ) spotLights ++;\r\n\t\t\tif ( light instanceof THREE.HemisphereLight ) hemiLights ++;\r\n\r\n\t\t}\r\n\r\n\t\treturn { 'directional': dirLights, 'point': pointLights, 'spot': spotLights, 'hemi': hemiLights };\r\n\r\n\t}\r\n\r\n\tfunction allocateShadows( lights ) {\r\n\r\n\t\tvar maxShadows = 0;\r\n\r\n\t\tfor ( var l = 0, ll = lights.length; l < ll; l ++ ) {\r\n\r\n\t\t\tvar light = lights[ l ];\r\n\r\n\t\t\tif ( ! light.castShadow ) continue;\r\n\r\n\t\t\tif ( light instanceof THREE.SpotLight ) maxShadows ++;\r\n\t\t\tif ( light instanceof THREE.DirectionalLight && ! light.shadowCascade ) maxShadows ++;\r\n\r\n\t\t}\r\n\r\n\t\treturn maxShadows;\r\n\r\n\t}\r\n\r\n\t// DEPRECATED\r\n\r\n\tthis.initMaterial = function () {\r\n\r\n\t\tTHREE.warn( 'THREE.WebGLRenderer: .initMaterial() has been removed.' );\r\n\r\n\t};\r\n\r\n\tthis.addPrePlugin = function () {\r\n\r\n\t\tTHREE.warn( 'THREE.WebGLRenderer: .addPrePlugin() has been removed.' );\r\n\r\n\t};\r\n\r\n\tthis.addPostPlugin = function () {\r\n\r\n\t\tTHREE.warn( 'THREE.WebGLRenderer: .addPostPlugin() has been removed.' );\r\n\r\n\t};\r\n\r\n\tthis.updateShadowMap = function () {\r\n\r\n\t\tTHREE.warn( 'THREE.WebGLRenderer: .updateShadowMap() has been removed.' );\r\n\r\n\t};\r\n\r\n};\r\n\r\n// File:src/renderers/WebGLRenderTarget.js\r\n\r\n/**\r\n * @author szimek / https://github.com/szimek/\r\n * @author alteredq / http://alteredqualia.com/\r\n */\r\n\r\nTHREE.WebGLRenderTarget = function ( width, height, options ) {\r\n\r\n\tthis.width = width;\r\n\tthis.height = height;\r\n\r\n\toptions = options || {};\r\n\r\n\tthis.wrapS = options.wrapS !== undefined ? options.wrapS : THREE.ClampToEdgeWrapping;\r\n\tthis.wrapT = options.wrapT !== undefined ? options.wrapT : THREE.ClampToEdgeWrapping;\r\n\r\n\tthis.magFilter = options.magFilter !== undefined ? options.magFilter : THREE.LinearFilter;\r\n\tthis.minFilter = options.minFilter !== undefined ? options.minFilter : THREE.LinearMipMapLinearFilter;\r\n\r\n\tthis.anisotropy = options.anisotropy !== undefined ? options.anisotropy : 1;\r\n\r\n\tthis.offset = new THREE.Vector2( 0, 0 );\r\n\tthis.repeat = new THREE.Vector2( 1, 1 );\r\n\r\n\tthis.format = options.format !== undefined ? options.format : THREE.RGBAFormat;\r\n\tthis.type = options.type !== undefined ? options.type : THREE.UnsignedByteType;\r\n\r\n\tthis.depthBuffer = options.depthBuffer !== undefined ? options.depthBuffer : true;\r\n\tthis.stencilBuffer = options.stencilBuffer !== undefined ? options.stencilBuffer : true;\r\n\r\n\tthis.generateMipmaps = true;\r\n\r\n\tthis.shareDepthFrom = options.shareDepthFrom !== undefined ? options.shareDepthFrom : null;\r\n\r\n};\r\n\r\nTHREE.WebGLRenderTarget.prototype = {\r\n\r\n\tconstructor: THREE.WebGLRenderTarget,\r\n\r\n\tsetSize: function ( width, height ) {\r\n\r\n\t\tthis.width = width;\r\n\t\tthis.height = height;\r\n\r\n\t},\r\n\r\n\tclone: function () {\r\n\r\n\t\tvar tmp = new THREE.WebGLRenderTarget( this.width, this.height );\r\n\r\n\t\ttmp.wrapS = this.wrapS;\r\n\t\ttmp.wrapT = this.wrapT;\r\n\r\n\t\ttmp.magFilter = this.magFilter;\r\n\t\ttmp.minFilter = this.minFilter;\r\n\r\n\t\ttmp.anisotropy = this.anisotropy;\r\n\r\n\t\ttmp.offset.copy( this.offset );\r\n\t\ttmp.repeat.copy( this.repeat );\r\n\r\n\t\ttmp.format = this.format;\r\n\t\ttmp.type = this.type;\r\n\r\n\t\ttmp.depthBuffer = this.depthBuffer;\r\n\t\ttmp.stencilBuffer = this.stencilBuffer;\r\n\r\n\t\ttmp.generateMipmaps = this.generateMipmaps;\r\n\r\n\t\ttmp.shareDepthFrom = this.shareDepthFrom;\r\n\r\n\t\treturn tmp;\r\n\r\n\t},\r\n\r\n\tdispose: function () {\r\n\r\n\t\tthis.dispatchEvent( { type: 'dispose' } );\r\n\r\n\t}\r\n\r\n};\r\n\r\nTHREE.EventDispatcher.prototype.apply( THREE.WebGLRenderTarget.prototype );\r\n\r\n// File:src/renderers/WebGLRenderTargetCube.js\r\n\r\n/**\r\n * @author alteredq / http://alteredqualia.com\r\n */\r\n\r\nTHREE.WebGLRenderTargetCube = function ( width, height, options ) {\r\n\r\n\tTHREE.WebGLRenderTarget.call( this, width, height, options );\r\n\r\n\tthis.activeCubeFace = 0; // PX 0, NX 1, PY 2, NY 3, PZ 4, NZ 5\r\n\r\n};\r\n\r\nTHREE.WebGLRenderTargetCube.prototype = Object.create( THREE.WebGLRenderTarget.prototype );\r\nTHREE.WebGLRenderTargetCube.prototype.constructor = THREE.WebGLRenderTargetCube;\r\n\r\n// File:src/renderers/webgl/WebGLExtensions.js\r\n\r\n/**\r\n* @author mrdoob / http://mrdoob.com/\r\n*/\r\n\r\nTHREE.WebGLExtensions = function ( gl ) {\r\n\r\n\tvar extensions = {};\r\n\r\n\tthis.get = function ( name ) {\r\n\r\n\t\tif ( extensions[ name ] !== undefined ) {\r\n\r\n\t\t\treturn extensions[ name ];\r\n\r\n\t\t}\r\n\r\n\t\tvar extension;\r\n\r\n\t\tswitch ( name ) {\r\n\r\n\t\t\tcase 'EXT_texture_filter_anisotropic':\r\n\t\t\t\textension = gl.getExtension( 'EXT_texture_filter_anisotropic' ) || gl.getExtension( 'MOZ_EXT_texture_filter_anisotropic' ) || gl.getExtension( 'WEBKIT_EXT_texture_filter_anisotropic' );\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'WEBGL_compressed_texture_s3tc':\r\n\t\t\t\textension = gl.getExtension( 'WEBGL_compressed_texture_s3tc' ) || gl.getExtension( 'MOZ_WEBGL_compressed_texture_s3tc' ) || gl.getExtension( 'WEBKIT_WEBGL_compressed_texture_s3tc' );\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'WEBGL_compressed_texture_pvrtc':\r\n\t\t\t\textension = gl.getExtension( 'WEBGL_compressed_texture_pvrtc' ) || gl.getExtension( 'WEBKIT_WEBGL_compressed_texture_pvrtc' );\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tdefault:\r\n\t\t\t\textension = gl.getExtension( name );\r\n\r\n\t\t}\r\n\r\n\t\tif ( extension === null ) {\r\n\r\n\t\t\tTHREE.warn( 'THREE.WebGLRenderer: ' + name + ' extension not supported.' );\r\n\r\n\t\t}\r\n\r\n\t\textensions[ name ] = extension;\r\n\r\n\t\treturn extension;\r\n\r\n\t};\r\n\r\n};\r\n\r\n// File:src/renderers/webgl/WebGLProgram.js\r\n\r\nTHREE.WebGLProgram = ( function () {\r\n\r\n\tvar programIdCount = 0;\r\n\r\n\tvar generateDefines = function ( defines ) {\r\n\r\n\t\tvar value, chunk, chunks = [];\r\n\r\n\t\tfor ( var d in defines ) {\r\n\r\n\t\t\tvalue = defines[ d ];\r\n\t\t\tif ( value === false ) continue;\r\n\r\n\t\t\tchunk = '#define ' + d + ' ' + value;\r\n\t\t\tchunks.push( chunk );\r\n\r\n\t\t}\r\n\r\n\t\treturn chunks.join( '\\n' );\r\n\r\n\t};\r\n\r\n\tvar cacheUniformLocations = function ( gl, program, identifiers ) {\r\n\r\n\t\tvar uniforms = {};\r\n\r\n\t\tfor ( var i = 0, l = identifiers.length; i < l; i ++ ) {\r\n\r\n\t\t\tvar id = identifiers[ i ];\r\n\t\t\tuniforms[ id ] = gl.getUniformLocation( program, id );\r\n\r\n\t\t}\r\n\r\n\t\treturn uniforms;\r\n\r\n\t};\r\n\r\n\tvar cacheAttributeLocations = function ( gl, program, identifiers ) {\r\n\r\n\t\tvar attributes = {};\r\n\r\n\t\tfor ( var i = 0, l = identifiers.length; i < l; i ++ ) {\r\n\r\n\t\t\tvar id = identifiers[ i ];\r\n\t\t\tattributes[ id ] = gl.getAttribLocation( program, id );\r\n\r\n\t\t}\r\n\r\n\t\treturn attributes;\r\n\r\n\t};\r\n\r\n\treturn function ( renderer, code, material, parameters ) {\r\n\r\n\t\tvar _this = renderer;\r\n\t\tvar _gl = _this.context;\r\n\r\n\t\tvar defines = material.defines;\r\n\t\tvar uniforms = material.__webglShader.uniforms;\r\n\t\tvar attributes = material.attributes;\r\n\r\n\t\tvar vertexShader = material.__webglShader.vertexShader;\r\n\t\tvar fragmentShader = material.__webglShader.fragmentShader;\r\n\r\n\t\tvar index0AttributeName = material.index0AttributeName;\r\n\r\n\t\tif ( index0AttributeName === undefined && parameters.morphTargets === true ) {\r\n\r\n\t\t\t// programs with morphTargets displace position out of attribute 0\r\n\r\n\t\t\tindex0AttributeName = 'position';\r\n\r\n\t\t}\r\n\r\n\t\tvar shadowMapTypeDefine = 'SHADOWMAP_TYPE_BASIC';\r\n\r\n\t\tif ( parameters.shadowMapType === THREE.PCFShadowMap ) {\r\n\r\n\t\t\tshadowMapTypeDefine = 'SHADOWMAP_TYPE_PCF';\r\n\r\n\t\t} else if ( parameters.shadowMapType === THREE.PCFSoftShadowMap ) {\r\n\r\n\t\t\tshadowMapTypeDefine = 'SHADOWMAP_TYPE_PCF_SOFT';\r\n\r\n\t\t}\r\n\r\n\t\tvar envMapTypeDefine = 'ENVMAP_TYPE_CUBE';\r\n\t\tvar envMapModeDefine = 'ENVMAP_MODE_REFLECTION';\r\n\t\tvar envMapBlendingDefine = 'ENVMAP_BLENDING_MULTIPLY';\r\n\r\n\t\tif ( parameters.envMap ) {\r\n\r\n\t\t\tswitch ( material.envMap.mapping ) {\r\n\r\n\t\t\t\tcase THREE.CubeReflectionMapping:\r\n\t\t\t\tcase THREE.CubeRefractionMapping:\r\n\t\t\t\t\tenvMapTypeDefine = 'ENVMAP_TYPE_CUBE';\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase THREE.EquirectangularReflectionMapping:\r\n\t\t\t\tcase THREE.EquirectangularRefractionMapping:\r\n\t\t\t\t\tenvMapTypeDefine = 'ENVMAP_TYPE_EQUIREC';\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase THREE.SphericalReflectionMapping:\r\n\t\t\t\t\tenvMapTypeDefine = 'ENVMAP_TYPE_SPHERE';\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tswitch ( material.envMap.mapping ) {\r\n\r\n\t\t\t\tcase THREE.CubeRefractionMapping:\r\n\t\t\t\tcase THREE.EquirectangularRefractionMapping:\r\n\t\t\t\t\tenvMapModeDefine = 'ENVMAP_MODE_REFRACTION';\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tswitch ( material.combine ) {\r\n\r\n\t\t\t\tcase THREE.MultiplyOperation:\r\n\t\t\t\t\tenvMapBlendingDefine = 'ENVMAP_BLENDING_MULTIPLY';\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase THREE.MixOperation:\r\n\t\t\t\t\tenvMapBlendingDefine = 'ENVMAP_BLENDING_MIX';\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase THREE.AddOperation:\r\n\t\t\t\t\tenvMapBlendingDefine = 'ENVMAP_BLENDING_ADD';\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tvar gammaFactorDefine = ( renderer.gammaFactor > 0 ) ? renderer.gammaFactor : 1.0;\r\n\r\n\t\t// console.log( 'building new program ' );\r\n\r\n\t\t//\r\n\r\n\t\tvar customDefines = generateDefines( defines );\r\n\r\n\t\t//\r\n\r\n\t\tvar program = _gl.createProgram();\r\n\r\n\t\tvar prefix_vertex, prefix_fragment;\r\n\r\n\t\tif ( material instanceof THREE.RawShaderMaterial ) {\r\n\r\n\t\t\tprefix_vertex = '';\r\n\t\t\tprefix_fragment = '';\r\n\r\n\t\t} else {\r\n\r\n\t\t\tprefix_vertex = [\r\n\r\n\t\t\t\t'precision ' + parameters.precision + ' float;',\r\n\t\t\t\t'precision ' + parameters.precision + ' int;',\r\n\r\n\t\t\t\tcustomDefines,\r\n\r\n\t\t\t\tparameters.supportsVertexTextures ? '#define VERTEX_TEXTURES' : '',\r\n\r\n\t\t\t\t_this.gammaInput ? '#define GAMMA_INPUT' : '',\r\n\t\t\t\t_this.gammaOutput ? '#define GAMMA_OUTPUT' : '',\r\n\t\t\t\t'#define GAMMA_FACTOR ' + gammaFactorDefine,\r\n\r\n\t\t\t\t'#define MAX_DIR_LIGHTS ' + parameters.maxDirLights,\r\n\t\t\t\t'#define MAX_POINT_LIGHTS ' + parameters.maxPointLights,\r\n\t\t\t\t'#define MAX_SPOT_LIGHTS ' + parameters.maxSpotLights,\r\n\t\t\t\t'#define MAX_HEMI_LIGHTS ' + parameters.maxHemiLights,\r\n\r\n\t\t\t\t'#define MAX_SHADOWS ' + parameters.maxShadows,\r\n\r\n\t\t\t\t'#define MAX_BONES ' + parameters.maxBones,\r\n\r\n\t\t\t\tparameters.map ? '#define USE_MAP' : '',\r\n\t\t\t\tparameters.envMap ? '#define USE_ENVMAP' : '',\r\n\t\t\t\tparameters.envMap ? '#define ' + envMapModeDefine : '',\r\n\t\t\t\tparameters.lightMap ? '#define USE_LIGHTMAP' : '',\r\n\t\t\t\tparameters.bumpMap ? '#define USE_BUMPMAP' : '',\r\n\t\t\t\tparameters.normalMap ? '#define USE_NORMALMAP' : '',\r\n\t\t\t\tparameters.specularMap ? '#define USE_SPECULARMAP' : '',\r\n\t\t\t\tparameters.alphaMap ? '#define USE_ALPHAMAP' : '',\r\n\t\t\t\tparameters.vertexColors ? '#define USE_COLOR' : '',\r\n\r\n\t\t\t\tparameters.flatShading ? '#define FLAT_SHADED': '',\r\n\r\n\t\t\t\tparameters.skinning ? '#define USE_SKINNING' : '',\r\n\t\t\t\tparameters.useVertexTexture ? '#define BONE_TEXTURE' : '',\r\n\r\n\t\t\t\tparameters.morphTargets ? '#define USE_MORPHTARGETS' : '',\r\n\t\t\t\tparameters.morphNormals ? '#define USE_MORPHNORMALS' : '',\r\n\t\t\t\tparameters.wrapAround ? '#define WRAP_AROUND' : '',\r\n\t\t\t\tparameters.doubleSided ? '#define DOUBLE_SIDED' : '',\r\n\t\t\t\tparameters.flipSided ? '#define FLIP_SIDED' : '',\r\n\r\n\t\t\t\tparameters.shadowMapEnabled ? '#define USE_SHADOWMAP' : '',\r\n\t\t\t\tparameters.shadowMapEnabled ? '#define ' + shadowMapTypeDefine : '',\r\n\t\t\t\tparameters.shadowMapDebug ? '#define SHADOWMAP_DEBUG' : '',\r\n\t\t\t\tparameters.shadowMapCascade ? '#define SHADOWMAP_CASCADE' : '',\r\n\r\n\t\t\t\tparameters.sizeAttenuation ? '#define USE_SIZEATTENUATION' : '',\r\n\r\n\t\t\t\tparameters.logarithmicDepthBuffer ? '#define USE_LOGDEPTHBUF' : '',\r\n\t\t\t\t//_this._glExtensionFragDepth ? '#define USE_LOGDEPTHBUF_EXT' : '',\r\n\r\n\r\n\t\t\t\t'uniform mat4 modelMatrix;',\r\n\t\t\t\t'uniform mat4 modelViewMatrix;',\r\n\t\t\t\t'uniform mat4 projectionMatrix;',\r\n\t\t\t\t'uniform mat4 viewMatrix;',\r\n\t\t\t\t'uniform mat3 normalMatrix;',\r\n\t\t\t\t'uniform vec3 cameraPosition;',\r\n\r\n\t\t\t\t'attribute vec3 position;',\r\n\t\t\t\t'attribute vec3 normal;',\r\n\t\t\t\t'attribute vec2 uv;',\r\n\t\t\t\t'attribute vec2 uv2;',\r\n\r\n\t\t\t\t'#ifdef USE_COLOR',\r\n\r\n\t\t\t\t'\tattribute vec3 color;',\r\n\r\n\t\t\t\t'#endif',\r\n\r\n\t\t\t\t'#ifdef USE_MORPHTARGETS',\r\n\r\n\t\t\t\t'\tattribute vec3 morphTarget0;',\r\n\t\t\t\t'\tattribute vec3 morphTarget1;',\r\n\t\t\t\t'\tattribute vec3 morphTarget2;',\r\n\t\t\t\t'\tattribute vec3 morphTarget3;',\r\n\r\n\t\t\t\t'\t#ifdef USE_MORPHNORMALS',\r\n\r\n\t\t\t\t'\t\tattribute vec3 morphNormal0;',\r\n\t\t\t\t'\t\tattribute vec3 morphNormal1;',\r\n\t\t\t\t'\t\tattribute vec3 morphNormal2;',\r\n\t\t\t\t'\t\tattribute vec3 morphNormal3;',\r\n\r\n\t\t\t\t'\t#else',\r\n\r\n\t\t\t\t'\t\tattribute vec3 morphTarget4;',\r\n\t\t\t\t'\t\tattribute vec3 morphTarget5;',\r\n\t\t\t\t'\t\tattribute vec3 morphTarget6;',\r\n\t\t\t\t'\t\tattribute vec3 morphTarget7;',\r\n\r\n\t\t\t\t'\t#endif',\r\n\r\n\t\t\t\t'#endif',\r\n\r\n\t\t\t\t'#ifdef USE_SKINNING',\r\n\r\n\t\t\t\t'\tattribute vec4 skinIndex;',\r\n\t\t\t\t'\tattribute vec4 skinWeight;',\r\n\r\n\t\t\t\t'#endif',\r\n\r\n\t\t\t\t''\r\n\r\n\t\t\t].join( '\\n' );\r\n\r\n\t\t\tprefix_fragment = [\r\n\r\n\t\t\t\t'precision ' + parameters.precision + ' float;',\r\n\t\t\t\t'precision ' + parameters.precision + ' int;',\r\n\r\n\t\t\t\t( parameters.bumpMap || parameters.normalMap || parameters.flatShading ) ? '#extension GL_OES_standard_derivatives : enable' : '',\r\n\r\n\t\t\t\tcustomDefines,\r\n\r\n\t\t\t\t'#define MAX_DIR_LIGHTS ' + parameters.maxDirLights,\r\n\t\t\t\t'#define MAX_POINT_LIGHTS ' + parameters.maxPointLights,\r\n\t\t\t\t'#define MAX_SPOT_LIGHTS ' + parameters.maxSpotLights,\r\n\t\t\t\t'#define MAX_HEMI_LIGHTS ' + parameters.maxHemiLights,\r\n\r\n\t\t\t\t'#define MAX_SHADOWS ' + parameters.maxShadows,\r\n\r\n\t\t\t\tparameters.alphaTest ? '#define ALPHATEST ' + parameters.alphaTest : '',\r\n\r\n\t\t\t\t_this.gammaInput ? '#define GAMMA_INPUT' : '',\r\n\t\t\t\t_this.gammaOutput ? '#define GAMMA_OUTPUT' : '',\r\n\t\t\t\t'#define GAMMA_FACTOR ' + gammaFactorDefine,\r\n\r\n\t\t\t\t( parameters.useFog && parameters.fog ) ? '#define USE_FOG' : '',\r\n\t\t\t\t( parameters.useFog && parameters.fogExp ) ? '#define FOG_EXP2' : '',\r\n\r\n\t\t\t\tparameters.map ? '#define USE_MAP' : '',\r\n\t\t\t\tparameters.envMap ? '#define USE_ENVMAP' : '',\r\n\t\t\t\tparameters.envMap ? '#define ' + envMapTypeDefine : '',\r\n\t\t\t\tparameters.envMap ? '#define ' + envMapModeDefine : '',\r\n\t\t\t\tparameters.envMap ? '#define ' + envMapBlendingDefine : '',\r\n\t\t\t\tparameters.lightMap ? '#define USE_LIGHTMAP' : '',\r\n\t\t\t\tparameters.bumpMap ? '#define USE_BUMPMAP' : '',\r\n\t\t\t\tparameters.normalMap ? '#define USE_NORMALMAP' : '',\r\n\t\t\t\tparameters.specularMap ? '#define USE_SPECULARMAP' : '',\r\n\t\t\t\tparameters.alphaMap ? '#define USE_ALPHAMAP' : '',\r\n\t\t\t\tparameters.vertexColors ? '#define USE_COLOR' : '',\r\n\r\n\t\t\t\tparameters.flatShading ? '#define FLAT_SHADED': '',\r\n\r\n\t\t\t\tparameters.metal ? '#define METAL' : '',\r\n\t\t\t\tparameters.wrapAround ? '#define WRAP_AROUND' : '',\r\n\t\t\t\tparameters.doubleSided ? '#define DOUBLE_SIDED' : '',\r\n\t\t\t\tparameters.flipSided ? '#define FLIP_SIDED' : '',\r\n\r\n\t\t\t\tparameters.shadowMapEnabled ? '#define USE_SHADOWMAP' : '',\r\n\t\t\t\tparameters.shadowMapEnabled ? '#define ' + shadowMapTypeDefine : '',\r\n\t\t\t\tparameters.shadowMapDebug ? '#define SHADOWMAP_DEBUG' : '',\r\n\t\t\t\tparameters.shadowMapCascade ? '#define SHADOWMAP_CASCADE' : '',\r\n\r\n\t\t\t\tparameters.logarithmicDepthBuffer ? '#define USE_LOGDEPTHBUF' : '',\r\n\t\t\t\t//_this._glExtensionFragDepth ? '#define USE_LOGDEPTHBUF_EXT' : '',\r\n\r\n\t\t\t\t'uniform mat4 viewMatrix;',\r\n\t\t\t\t'uniform vec3 cameraPosition;',\r\n\t\t\t\t''\r\n\r\n\t\t\t].join( '\\n' );\r\n\r\n\t\t}\r\n\r\n\t\tvar glVertexShader = new THREE.WebGLShader( _gl, _gl.VERTEX_SHADER, prefix_vertex + vertexShader );\r\n\t\tvar glFragmentShader = new THREE.WebGLShader( _gl, _gl.FRAGMENT_SHADER, prefix_fragment + fragmentShader );\r\n\r\n\t\t_gl.attachShader( program, glVertexShader );\r\n\t\t_gl.attachShader( program, glFragmentShader );\r\n\r\n\t\tif ( index0AttributeName !== undefined ) {\r\n\r\n\t\t\t// Force a particular attribute to index 0.\r\n\t\t\t// because potentially expensive emulation is done by browser if attribute 0 is disabled.\r\n\t\t\t// And, color, for example is often automatically bound to index 0 so disabling it\r\n\r\n\t\t\t_gl.bindAttribLocation( program, 0, index0AttributeName );\r\n\r\n\t\t}\r\n\r\n\t\t_gl.linkProgram( program );\r\n\r\n\t\tvar programLogInfo = _gl.getProgramInfoLog( program );\r\n\r\n\t\tif ( _gl.getProgramParameter( program, _gl.LINK_STATUS ) === false ) {\r\n\r\n\t\t\tTHREE.error( 'THREE.WebGLProgram: shader error: ' + _gl.getError(), 'gl.VALIDATE_STATUS', _gl.getProgramParameter( program, _gl.VALIDATE_STATUS ), 'gl.getPRogramInfoLog', programLogInfo );\r\n\r\n\t\t}\r\n\r\n\t\tif ( programLogInfo !== '' ) {\r\n\r\n\t\t\tTHREE.warn( 'THREE.WebGLProgram: gl.getProgramInfoLog()' + programLogInfo );\r\n\t\t\t// THREE.warn( _gl.getExtension( 'WEBGL_debug_shaders' ).getTranslatedShaderSource( glVertexShader ) );\r\n\t\t\t// THREE.warn( _gl.getExtension( 'WEBGL_debug_shaders' ).getTranslatedShaderSource( glFragmentShader ) );\r\n\r\n\t\t}\r\n\r\n\t\t// clean up\r\n\r\n\t\t_gl.deleteShader( glVertexShader );\r\n\t\t_gl.deleteShader( glFragmentShader );\r\n\r\n\t\t// cache uniform locations\r\n\r\n\t\tvar identifiers = [\r\n\r\n\t\t\t'viewMatrix',\r\n\t\t\t'modelViewMatrix',\r\n\t\t\t'projectionMatrix',\r\n\t\t\t'normalMatrix',\r\n\t\t\t'modelMatrix',\r\n\t\t\t'cameraPosition',\r\n\t\t\t'morphTargetInfluences',\r\n\t\t\t'bindMatrix',\r\n\t\t\t'bindMatrixInverse'\r\n\r\n\t\t];\r\n\r\n\t\tif ( parameters.useVertexTexture ) {\r\n\r\n\t\t\tidentifiers.push( 'boneTexture' );\r\n\t\t\tidentifiers.push( 'boneTextureWidth' );\r\n\t\t\tidentifiers.push( 'boneTextureHeight' );\r\n\r\n\t\t} else {\r\n\r\n\t\t\tidentifiers.push( 'boneGlobalMatrices' );\r\n\r\n\t\t}\r\n\r\n\t\tif ( parameters.logarithmicDepthBuffer ) {\r\n\r\n\t\t\tidentifiers.push('logDepthBufFC');\r\n\r\n\t\t}\r\n\r\n\r\n\t\tfor ( var u in uniforms ) {\r\n\r\n\t\t\tidentifiers.push( u );\r\n\r\n\t\t}\r\n\r\n\t\tthis.uniforms = cacheUniformLocations( _gl, program, identifiers );\r\n\r\n\t\t// cache attributes locations\r\n\r\n\t\tidentifiers = [\r\n\r\n\t\t\t'position',\r\n\t\t\t'normal',\r\n\t\t\t'uv',\r\n\t\t\t'uv2',\r\n\t\t\t'tangent',\r\n\t\t\t'color',\r\n\t\t\t'skinIndex',\r\n\t\t\t'skinWeight',\r\n\t\t\t'lineDistance'\r\n\r\n\t\t];\r\n\r\n\t\tfor ( var i = 0; i < parameters.maxMorphTargets; i ++ ) {\r\n\r\n\t\t\tidentifiers.push( 'morphTarget' + i );\r\n\r\n\t\t}\r\n\r\n\t\tfor ( var i = 0; i < parameters.maxMorphNormals; i ++ ) {\r\n\r\n\t\t\tidentifiers.push( 'morphNormal' + i );\r\n\r\n\t\t}\r\n\r\n\t\tfor ( var a in attributes ) {\r\n\r\n\t\t\tidentifiers.push( a );\r\n\r\n\t\t}\r\n\r\n\t\tthis.attributes = cacheAttributeLocations( _gl, program, identifiers );\r\n\t\tthis.attributesKeys = Object.keys( this.attributes );\r\n\r\n\t\t//\r\n\r\n\t\tthis.id = programIdCount ++;\r\n\t\tthis.code = code;\r\n\t\tthis.usedTimes = 1;\r\n\t\tthis.program = program;\r\n\t\tthis.vertexShader = glVertexShader;\r\n\t\tthis.fragmentShader = glFragmentShader;\r\n\r\n\t\treturn this;\r\n\r\n\t};\r\n\r\n} )();\r\n\r\n// File:src/renderers/webgl/WebGLShader.js\r\n\r\nTHREE.WebGLShader = ( function () {\r\n\r\n\tvar addLineNumbers = function ( string ) {\r\n\r\n\t\tvar lines = string.split( '\\n' );\r\n\r\n\t\tfor ( var i = 0; i < lines.length; i ++ ) {\r\n\r\n\t\t\tlines[ i ] = ( i + 1 ) + ': ' + lines[ i ];\r\n\r\n\t\t}\r\n\r\n\t\treturn lines.join( '\\n' );\r\n\r\n\t};\r\n\r\n\treturn function ( gl, type, string ) {\r\n\r\n\t\tvar shader = gl.createShader( type ); \r\n\r\n\t\tgl.shaderSource( shader, string );\r\n\t\tgl.compileShader( shader );\r\n\r\n\t\tif ( gl.getShaderParameter( shader, gl.COMPILE_STATUS ) === false ) {\r\n\r\n\t\t\tTHREE.error( 'THREE.WebGLShader: Shader couldn\\'t compile.' );\r\n\r\n\t\t}\r\n\r\n\t\tif ( gl.getShaderInfoLog( shader ) !== '' ) {\r\n\r\n\t\t\tTHREE.warn( 'THREE.WebGLShader: gl.getShaderInfoLog()', gl.getShaderInfoLog( shader ), addLineNumbers( string ) );\r\n\r\n\t\t}\r\n\r\n\t\t// --enable-privileged-webgl-extension\r\n\t\t// console.log( type, gl.getExtension( 'WEBGL_debug_shaders' ).getTranslatedShaderSource( shader ) );\r\n\r\n\t\treturn shader;\r\n\r\n\t};\r\n\r\n} )();\r\n\r\n// File:src/renderers/webgl/WebGLState.js\r\n\r\n/**\r\n* @author mrdoob / http://mrdoob.com/\r\n*/\r\n\r\nTHREE.WebGLState = function ( gl, paramThreeToGL ) {\r\n\r\n\tvar newAttributes = new Uint8Array( 16 );\r\n\tvar enabledAttributes = new Uint8Array( 16 );\r\n\r\n\tvar currentBlending = null;\r\n\tvar currentBlendEquation = null;\r\n\tvar currentBlendSrc = null;\r\n\tvar currentBlendDst = null;\r\n\tvar currentBlendEquationAlpha = null;\r\n\tvar currentBlendSrcAlpha = null;\r\n\tvar currentBlendDstAlpha = null;\r\n\r\n\tvar currentDepthTest = null;\r\n\tvar currentDepthWrite = null;\r\n\r\n\tvar currentColorWrite = null;\r\n\r\n\tvar currentDoubleSided = null;\r\n\tvar currentFlipSided = null;\r\n\r\n\tvar currentLineWidth = null;\r\n\r\n\tvar currentPolygonOffset = null;\r\n\tvar currentPolygonOffsetFactor = null;\r\n\tvar currentPolygonOffsetUnits = null;\r\n\r\n\tthis.initAttributes = function () {\r\n\r\n\t\tfor ( var i = 0, l = newAttributes.length; i < l; i ++ ) {\r\n\r\n\t\t\tnewAttributes[ i ] = 0;\r\n\r\n\t\t}\r\n\r\n\t};\r\n\r\n\tthis.enableAttribute = function ( attribute ) {\r\n\r\n\t\tnewAttributes[ attribute ] = 1;\r\n\r\n\t\tif ( enabledAttributes[ attribute ] === 0 ) {\r\n\r\n\t\t\tgl.enableVertexAttribArray( attribute );\r\n\t\t\tenabledAttributes[ attribute ] = 1;\r\n\r\n\t\t}\r\n\r\n\t};\r\n\r\n\tthis.disableUnusedAttributes = function () {\r\n\r\n\t\tfor ( var i = 0, l = enabledAttributes.length; i < l; i ++ ) {\r\n\r\n\t\t\tif ( enabledAttributes[ i ] !== newAttributes[ i ] ) {\r\n\r\n\t\t\t\tgl.disableVertexAttribArray( i );\r\n\t\t\t\tenabledAttributes[ i ] = 0;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t};\r\n\r\n\tthis.setBlending = function ( blending, blendEquation, blendSrc, blendDst, blendEquationAlpha, blendSrcAlpha, blendDstAlpha ) {\r\n\r\n\t\tif ( blending !== currentBlending ) {\r\n\r\n\t\t\tif ( blending === THREE.NoBlending ) {\r\n\r\n\t\t\t\tgl.disable( gl.BLEND );\r\n\r\n\t\t\t} else if ( blending === THREE.AdditiveBlending ) {\r\n\r\n\t\t\t\tgl.enable( gl.BLEND );\r\n\t\t\t\tgl.blendEquation( gl.FUNC_ADD );\r\n\t\t\t\tgl.blendFunc( gl.SRC_ALPHA, gl.ONE );\r\n\r\n\t\t\t} else if ( blending === THREE.SubtractiveBlending ) {\r\n\r\n\t\t\t\t// TODO: Find blendFuncSeparate() combination\r\n\t\t\t\tgl.enable( gl.BLEND );\r\n\t\t\t\tgl.blendEquation( gl.FUNC_ADD );\r\n\t\t\t\tgl.blendFunc( gl.ZERO, gl.ONE_MINUS_SRC_COLOR );\r\n\r\n\t\t\t} else if ( blending === THREE.MultiplyBlending ) {\r\n\r\n\t\t\t\t// TODO: Find blendFuncSeparate() combination\r\n\t\t\t\tgl.enable( gl.BLEND );\r\n\t\t\t\tgl.blendEquation( gl.FUNC_ADD );\r\n\t\t\t\tgl.blendFunc( gl.ZERO, gl.SRC_COLOR );\r\n\r\n\t\t\t} else if ( blending === THREE.CustomBlending ) {\r\n\r\n\t\t\t\tgl.enable( gl.BLEND );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tgl.enable( gl.BLEND );\r\n\t\t\t\tgl.blendEquationSeparate( gl.FUNC_ADD, gl.FUNC_ADD );\r\n\t\t\t\tgl.blendFuncSeparate( gl.SRC_ALPHA, gl.ONE_MINUS_SRC_ALPHA, gl.ONE, gl.ONE_MINUS_SRC_ALPHA );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tcurrentBlending = blending;\r\n\r\n\t\t}\r\n\r\n\t\tif ( blending === THREE.CustomBlending ) {\r\n\r\n\t\t\tblendEquationAlpha = blendEquationAlpha || blendEquation;\r\n\t\t\tblendSrcAlpha = blendSrcAlpha || blendSrc;\r\n\t\t\tblendDstAlpha = blendDstAlpha || blendDst;\r\n\r\n\t\t\tif ( blendEquation !== currentBlendEquation || blendEquationAlpha !== currentBlendEquationAlpha ) {\r\n\r\n\t\t\t\tgl.blendEquationSeparate( paramThreeToGL( blendEquation ), paramThreeToGL( blendEquationAlpha ) );\r\n\r\n\t\t\t\tcurrentBlendEquation = blendEquation;\r\n\t\t\t\tcurrentBlendEquationAlpha = blendEquationAlpha;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( blendSrc !== currentBlendSrc || blendDst !== currentBlendDst || blendSrcAlpha !== currentBlendSrcAlpha || blendDstAlpha !== currentBlendDstAlpha ) {\r\n\r\n\t\t\t\tgl.blendFuncSeparate( paramThreeToGL( blendSrc ), paramThreeToGL( blendDst ), paramThreeToGL( blendSrcAlpha ), paramThreeToGL( blendDstAlpha ) );\r\n\r\n\t\t\t\tcurrentBlendSrc = blendSrc;\r\n\t\t\t\tcurrentBlendDst = blendDst;\r\n\t\t\t\tcurrentBlendSrcAlpha = blendSrcAlpha;\r\n\t\t\t\tcurrentBlendDstAlpha = blendDstAlpha;\r\n\r\n\t\t\t}\r\n\r\n\t\t} else {\r\n\r\n\t\t\tcurrentBlendEquation = null;\r\n\t\t\tcurrentBlendSrc = null;\r\n\t\t\tcurrentBlendDst = null;\r\n\t\t\tcurrentBlendEquationAlpha = null;\r\n\t\t\tcurrentBlendSrcAlpha = null;\r\n\t\t\tcurrentBlendDstAlpha = null;\r\n\r\n\t\t}\r\n\r\n\t};\r\n\r\n\tthis.setDepthTest = function ( depthTest ) {\r\n\r\n\t\tif ( currentDepthTest !== depthTest ) {\r\n\r\n\t\t\tif ( depthTest ) {\r\n\r\n\t\t\t\tgl.enable( gl.DEPTH_TEST );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tgl.disable( gl.DEPTH_TEST );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tcurrentDepthTest = depthTest;\r\n\r\n\t\t}\r\n\r\n\t};\r\n\r\n\tthis.setDepthWrite = function ( depthWrite ) {\r\n\r\n\t\tif ( currentDepthWrite !== depthWrite ) {\r\n\r\n\t\t\tgl.depthMask( depthWrite );\r\n\t\t\tcurrentDepthWrite = depthWrite;\r\n\r\n\t\t}\r\n\r\n\t};\r\n\r\n\tthis.setColorWrite = function ( colorWrite ) {\r\n\r\n\t\tif ( currentColorWrite !== colorWrite ) {\r\n\r\n\t\t\tgl.colorMask( colorWrite, colorWrite, colorWrite, colorWrite );\r\n\t\t\tcurrentColorWrite = colorWrite;\r\n\r\n\t\t}\r\n\r\n\t};\r\n\r\n\tthis.setDoubleSided = function ( doubleSided ) {\r\n\r\n\t\tif ( currentDoubleSided !== doubleSided ) {\r\n\r\n\t\t\tif ( doubleSided ) {\r\n\r\n\t\t\t\tgl.disable( gl.CULL_FACE );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tgl.enable( gl.CULL_FACE );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tcurrentDoubleSided = doubleSided;\r\n\r\n\t\t}\r\n\r\n\t};\r\n\r\n\tthis.setFlipSided = function ( flipSided ) {\r\n\r\n\t\tif ( currentFlipSided !== flipSided ) {\r\n\r\n\t\t\tif ( flipSided ) {\r\n\r\n\t\t\t\tgl.frontFace( gl.CW );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tgl.frontFace( gl.CCW );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tcurrentFlipSided = flipSided;\r\n\r\n\t\t}\r\n\r\n\t};\r\n\r\n\tthis.setLineWidth = function ( width ) {\r\n\r\n\t\tif ( width !== currentLineWidth ) {\r\n\r\n\t\t\tgl.lineWidth( width );\r\n\r\n\t\t\tcurrentLineWidth = width;\r\n\r\n\t\t}\r\n\r\n\t};\r\n\r\n\tthis.setPolygonOffset = function ( polygonoffset, factor, units ) {\r\n\r\n\t\tif ( currentPolygonOffset !== polygonoffset ) {\r\n\r\n\t\t\tif ( polygonoffset ) {\r\n\r\n\t\t\t\tgl.enable( gl.POLYGON_OFFSET_FILL );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tgl.disable( gl.POLYGON_OFFSET_FILL );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tcurrentPolygonOffset = polygonoffset;\r\n\r\n\t\t}\r\n\r\n\t\tif ( polygonoffset && ( currentPolygonOffsetFactor !== factor || currentPolygonOffsetUnits !== units ) ) {\r\n\r\n\t\t\tgl.polygonOffset( factor, units );\r\n\r\n\t\t\tcurrentPolygonOffsetFactor = factor;\r\n\t\t\tcurrentPolygonOffsetUnits = units;\r\n\r\n\t\t}\r\n\r\n\t};\r\n\r\n\tthis.reset = function () {\r\n\r\n\t\tfor ( var i = 0; i < enabledAttributes.length; i ++ ) {\r\n\r\n\t\t\tenabledAttributes[ i ] = 0;\r\n\r\n\t\t}\r\n\r\n\t\tcurrentBlending = null;\r\n\t\tcurrentDepthTest = null;\r\n\t\tcurrentDepthWrite = null;\r\n\t\tcurrentColorWrite = null;\r\n\t\tcurrentDoubleSided = null;\r\n\t\tcurrentFlipSided = null;\r\n\r\n\t};\r\n\r\n};\r\n\r\n// File:src/renderers/webgl/plugins/LensFlarePlugin.js\r\n\r\n/**\r\n * @author mikael emtinger / http://gomo.se/\r\n * @author alteredq / http://alteredqualia.com/\r\n */\r\n\r\nTHREE.LensFlarePlugin = function ( renderer, flares ) {\r\n\r\n\tvar gl = renderer.context;\r\n\r\n\tvar vertexBuffer, elementBuffer;\r\n\tvar program, attributes, uniforms;\r\n\tvar hasVertexTexture;\r\n\r\n\tvar tempTexture, occlusionTexture;\r\n\r\n\tvar init = function () {\r\n\r\n\t\tvar vertices = new Float32Array( [\r\n\t\t\t-1, -1,  0, 0,\r\n\t\t\t 1, -1,  1, 0,\r\n\t\t\t 1,  1,  1, 1,\r\n\t\t\t-1,  1,  0, 1\r\n\t\t] );\r\n\r\n\t\tvar faces = new Uint16Array( [\r\n\t\t\t0, 1, 2,\r\n\t\t\t0, 2, 3\r\n\t\t] );\r\n\r\n\t\t// buffers\r\n\r\n\t\tvertexBuffer     = gl.createBuffer();\r\n\t\telementBuffer    = gl.createBuffer();\r\n\r\n\t\tgl.bindBuffer( gl.ARRAY_BUFFER, vertexBuffer );\r\n\t\tgl.bufferData( gl.ARRAY_BUFFER, vertices, gl.STATIC_DRAW );\r\n\r\n\t\tgl.bindBuffer( gl.ELEMENT_ARRAY_BUFFER, elementBuffer );\r\n\t\tgl.bufferData( gl.ELEMENT_ARRAY_BUFFER, faces, gl.STATIC_DRAW );\r\n\r\n\t\t// textures\r\n\r\n\t\ttempTexture      = gl.createTexture();\r\n\t\tocclusionTexture = gl.createTexture();\r\n\r\n\t\tgl.bindTexture( gl.TEXTURE_2D, tempTexture );\r\n\t\tgl.texImage2D( gl.TEXTURE_2D, 0, gl.RGB, 16, 16, 0, gl.RGB, gl.UNSIGNED_BYTE, null );\r\n\t\tgl.texParameteri( gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE );\r\n\t\tgl.texParameteri( gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE );\r\n\t\tgl.texParameteri( gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST );\r\n\t\tgl.texParameteri( gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST );\r\n\r\n\t\tgl.bindTexture( gl.TEXTURE_2D, occlusionTexture );\r\n\t\tgl.texImage2D( gl.TEXTURE_2D, 0, gl.RGBA, 16, 16, 0, gl.RGBA, gl.UNSIGNED_BYTE, null );\r\n\t\tgl.texParameteri( gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE );\r\n\t\tgl.texParameteri( gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE );\r\n\t\tgl.texParameteri( gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST );\r\n\t\tgl.texParameteri( gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST );\r\n\r\n\t\thasVertexTexture = gl.getParameter( gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS ) > 0;\r\n\r\n\t\tvar shader;\r\n\r\n\t\tif ( hasVertexTexture ) {\r\n\r\n\t\t\tshader = {\r\n\r\n\t\t\t\tvertexShader: [\r\n\r\n\t\t\t\t\t\"uniform lowp int renderType;\",\r\n\r\n\t\t\t\t\t\"uniform vec3 screenPosition;\",\r\n\t\t\t\t\t\"uniform vec2 scale;\",\r\n\t\t\t\t\t\"uniform float rotation;\",\r\n\r\n\t\t\t\t\t\"uniform sampler2D occlusionMap;\",\r\n\r\n\t\t\t\t\t\"attribute vec2 position;\",\r\n\t\t\t\t\t\"attribute vec2 uv;\",\r\n\r\n\t\t\t\t\t\"varying vec2 vUV;\",\r\n\t\t\t\t\t\"varying float vVisibility;\",\r\n\r\n\t\t\t\t\t\"void main() {\",\r\n\r\n\t\t\t\t\t\t\"vUV = uv;\",\r\n\r\n\t\t\t\t\t\t\"vec2 pos = position;\",\r\n\r\n\t\t\t\t\t\t\"if( renderType == 2 ) {\",\r\n\r\n\t\t\t\t\t\t\t\"vec4 visibility = texture2D( occlusionMap, vec2( 0.1, 0.1 ) );\",\r\n\t\t\t\t\t\t\t\"visibility += texture2D( occlusionMap, vec2( 0.5, 0.1 ) );\",\r\n\t\t\t\t\t\t\t\"visibility += texture2D( occlusionMap, vec2( 0.9, 0.1 ) );\",\r\n\t\t\t\t\t\t\t\"visibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) );\",\r\n\t\t\t\t\t\t\t\"visibility += texture2D( occlusionMap, vec2( 0.9, 0.9 ) );\",\r\n\t\t\t\t\t\t\t\"visibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) );\",\r\n\t\t\t\t\t\t\t\"visibility += texture2D( occlusionMap, vec2( 0.1, 0.9 ) );\",\r\n\t\t\t\t\t\t\t\"visibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) );\",\r\n\t\t\t\t\t\t\t\"visibility += texture2D( occlusionMap, vec2( 0.5, 0.5 ) );\",\r\n\r\n\t\t\t\t\t\t\t\"vVisibility =        visibility.r / 9.0;\",\r\n\t\t\t\t\t\t\t\"vVisibility *= 1.0 - visibility.g / 9.0;\",\r\n\t\t\t\t\t\t\t\"vVisibility *=       visibility.b / 9.0;\",\r\n\t\t\t\t\t\t\t\"vVisibility *= 1.0 - visibility.a / 9.0;\",\r\n\r\n\t\t\t\t\t\t\t\"pos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;\",\r\n\t\t\t\t\t\t\t\"pos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;\",\r\n\r\n\t\t\t\t\t\t\"}\",\r\n\r\n\t\t\t\t\t\t\"gl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );\",\r\n\r\n\t\t\t\t\t\"}\"\r\n\r\n\t\t\t\t].join( \"\\n\" ),\r\n\r\n\t\t\t\tfragmentShader: [\r\n\r\n\t\t\t\t\t\"uniform lowp int renderType;\",\r\n\r\n\t\t\t\t\t\"uniform sampler2D map;\",\r\n\t\t\t\t\t\"uniform float opacity;\",\r\n\t\t\t\t\t\"uniform vec3 color;\",\r\n\r\n\t\t\t\t\t\"varying vec2 vUV;\",\r\n\t\t\t\t\t\"varying float vVisibility;\",\r\n\r\n\t\t\t\t\t\"void main() {\",\r\n\r\n\t\t\t\t\t\t// pink square\r\n\r\n\t\t\t\t\t\t\"if( renderType == 0 ) {\",\r\n\r\n\t\t\t\t\t\t\t\"gl_FragColor = vec4( 1.0, 0.0, 1.0, 0.0 );\",\r\n\r\n\t\t\t\t\t\t// restore\r\n\r\n\t\t\t\t\t\t\"} else if( renderType == 1 ) {\",\r\n\r\n\t\t\t\t\t\t\t\"gl_FragColor = texture2D( map, vUV );\",\r\n\r\n\t\t\t\t\t\t// flare\r\n\r\n\t\t\t\t\t\t\"} else {\",\r\n\r\n\t\t\t\t\t\t\t\"vec4 texture = texture2D( map, vUV );\",\r\n\t\t\t\t\t\t\t\"texture.a *= opacity * vVisibility;\",\r\n\t\t\t\t\t\t\t\"gl_FragColor = texture;\",\r\n\t\t\t\t\t\t\t\"gl_FragColor.rgb *= color;\",\r\n\r\n\t\t\t\t\t\t\"}\",\r\n\r\n\t\t\t\t\t\"}\"\r\n\r\n\t\t\t\t].join( \"\\n\" )\r\n\r\n\t\t\t};\r\n\r\n\t\t} else {\r\n\r\n\t\t\tshader = {\r\n\r\n\t\t\t\tvertexShader: [\r\n\r\n\t\t\t\t\t\"uniform lowp int renderType;\",\r\n\r\n\t\t\t\t\t\"uniform vec3 screenPosition;\",\r\n\t\t\t\t\t\"uniform vec2 scale;\",\r\n\t\t\t\t\t\"uniform float rotation;\",\r\n\r\n\t\t\t\t\t\"attribute vec2 position;\",\r\n\t\t\t\t\t\"attribute vec2 uv;\",\r\n\r\n\t\t\t\t\t\"varying vec2 vUV;\",\r\n\r\n\t\t\t\t\t\"void main() {\",\r\n\r\n\t\t\t\t\t\t\"vUV = uv;\",\r\n\r\n\t\t\t\t\t\t\"vec2 pos = position;\",\r\n\r\n\t\t\t\t\t\t\"if( renderType == 2 ) {\",\r\n\r\n\t\t\t\t\t\t\t\"pos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;\",\r\n\t\t\t\t\t\t\t\"pos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;\",\r\n\r\n\t\t\t\t\t\t\"}\",\r\n\r\n\t\t\t\t\t\t\"gl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );\",\r\n\r\n\t\t\t\t\t\"}\"\r\n\r\n\t\t\t\t].join( \"\\n\" ),\r\n\r\n\t\t\t\tfragmentShader: [\r\n\r\n\t\t\t\t\t\"precision mediump float;\",\r\n\r\n\t\t\t\t\t\"uniform lowp int renderType;\",\r\n\r\n\t\t\t\t\t\"uniform sampler2D map;\",\r\n\t\t\t\t\t\"uniform sampler2D occlusionMap;\",\r\n\t\t\t\t\t\"uniform float opacity;\",\r\n\t\t\t\t\t\"uniform vec3 color;\",\r\n\r\n\t\t\t\t\t\"varying vec2 vUV;\",\r\n\r\n\t\t\t\t\t\"void main() {\",\r\n\r\n\t\t\t\t\t\t// pink square\r\n\r\n\t\t\t\t\t\t\"if( renderType == 0 ) {\",\r\n\r\n\t\t\t\t\t\t\t\"gl_FragColor = vec4( texture2D( map, vUV ).rgb, 0.0 );\",\r\n\r\n\t\t\t\t\t\t// restore\r\n\r\n\t\t\t\t\t\t\"} else if( renderType == 1 ) {\",\r\n\r\n\t\t\t\t\t\t\t\"gl_FragColor = texture2D( map, vUV );\",\r\n\r\n\t\t\t\t\t\t// flare\r\n\r\n\t\t\t\t\t\t\"} else {\",\r\n\r\n\t\t\t\t\t\t\t\"float visibility = texture2D( occlusionMap, vec2( 0.5, 0.1 ) ).a;\",\r\n\t\t\t\t\t\t\t\"visibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) ).a;\",\r\n\t\t\t\t\t\t\t\"visibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) ).a;\",\r\n\t\t\t\t\t\t\t\"visibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) ).a;\",\r\n\t\t\t\t\t\t\t\"visibility = ( 1.0 - visibility / 4.0 );\",\r\n\r\n\t\t\t\t\t\t\t\"vec4 texture = texture2D( map, vUV );\",\r\n\t\t\t\t\t\t\t\"texture.a *= opacity * visibility;\",\r\n\t\t\t\t\t\t\t\"gl_FragColor = texture;\",\r\n\t\t\t\t\t\t\t\"gl_FragColor.rgb *= color;\",\r\n\r\n\t\t\t\t\t\t\"}\",\r\n\r\n\t\t\t\t\t\"}\"\r\n\r\n\t\t\t\t].join( \"\\n\" )\r\n\r\n\t\t\t};\r\n\r\n\t\t}\r\n\r\n\t\tprogram = createProgram( shader );\r\n\r\n\t\tattributes = {\r\n\t\t\tvertex: gl.getAttribLocation ( program, \"position\" ),\r\n\t\t\tuv:     gl.getAttribLocation ( program, \"uv\" )\r\n\t\t}\r\n\r\n\t\tuniforms = {\r\n\t\t\trenderType:     gl.getUniformLocation( program, \"renderType\" ),\r\n\t\t\tmap:            gl.getUniformLocation( program, \"map\" ),\r\n\t\t\tocclusionMap:   gl.getUniformLocation( program, \"occlusionMap\" ),\r\n\t\t\topacity:        gl.getUniformLocation( program, \"opacity\" ),\r\n\t\t\tcolor:          gl.getUniformLocation( program, \"color\" ),\r\n\t\t\tscale:          gl.getUniformLocation( program, \"scale\" ),\r\n\t\t\trotation:       gl.getUniformLocation( program, \"rotation\" ),\r\n\t\t\tscreenPosition: gl.getUniformLocation( program, \"screenPosition\" )\r\n\t\t};\r\n\r\n\t};\r\n\r\n\t/*\r\n\t * Render lens flares\r\n\t * Method: renders 16x16 0xff00ff-colored points scattered over the light source area,\r\n\t *         reads these back and calculates occlusion.\r\n\t */\r\n\r\n\tthis.render = function ( scene, camera, viewportWidth, viewportHeight ) {\r\n\r\n\t\tif ( flares.length === 0 ) return;\r\n\r\n\t\tvar tempPosition = new THREE.Vector3();\r\n\r\n\t\tvar invAspect = viewportHeight / viewportWidth,\r\n\t\t\thalfViewportWidth = viewportWidth * 0.5,\r\n\t\t\thalfViewportHeight = viewportHeight * 0.5;\r\n\r\n\t\tvar size = 16 / viewportHeight,\r\n\t\t\tscale = new THREE.Vector2( size * invAspect, size );\r\n\r\n\t\tvar screenPosition = new THREE.Vector3( 1, 1, 0 ),\r\n\t\t\tscreenPositionPixels = new THREE.Vector2( 1, 1 );\r\n\r\n\t\tif ( program === undefined ) {\r\n\r\n\t\t\tinit();\r\n\r\n\t\t}\r\n\r\n\t\tgl.useProgram( program );\r\n\r\n\t\tgl.enableVertexAttribArray( attributes.vertex );\r\n\t\tgl.enableVertexAttribArray( attributes.uv );\r\n\r\n\t\t// loop through all lens flares to update their occlusion and positions\r\n\t\t// setup gl and common used attribs/unforms\r\n\r\n\t\tgl.uniform1i( uniforms.occlusionMap, 0 );\r\n\t\tgl.uniform1i( uniforms.map, 1 );\r\n\r\n\t\tgl.bindBuffer( gl.ARRAY_BUFFER, vertexBuffer );\r\n\t\tgl.vertexAttribPointer( attributes.vertex, 2, gl.FLOAT, false, 2 * 8, 0 );\r\n\t\tgl.vertexAttribPointer( attributes.uv, 2, gl.FLOAT, false, 2 * 8, 8 );\r\n\r\n\t\tgl.bindBuffer( gl.ELEMENT_ARRAY_BUFFER, elementBuffer );\r\n\r\n\t\tgl.disable( gl.CULL_FACE );\r\n\t\tgl.depthMask( false );\r\n\r\n\t\tfor ( var i = 0, l = flares.length; i < l; i ++ ) {\r\n\r\n\t\t\tsize = 16 / viewportHeight;\r\n\t\t\tscale.set( size * invAspect, size );\r\n\r\n\t\t\t// calc object screen position\r\n\r\n\t\t\tvar flare = flares[ i ];\r\n\r\n\t\t\ttempPosition.set( flare.matrixWorld.elements[12], flare.matrixWorld.elements[13], flare.matrixWorld.elements[14] );\r\n\r\n\t\t\ttempPosition.applyMatrix4( camera.matrixWorldInverse );\r\n\t\t\ttempPosition.applyProjection( camera.projectionMatrix );\r\n\r\n\t\t\t// setup arrays for gl programs\r\n\r\n\t\t\tscreenPosition.copy( tempPosition )\r\n\r\n\t\t\tscreenPositionPixels.x = screenPosition.x * halfViewportWidth + halfViewportWidth;\r\n\t\t\tscreenPositionPixels.y = screenPosition.y * halfViewportHeight + halfViewportHeight;\r\n\r\n\t\t\t// screen cull\r\n\r\n\t\t\tif ( hasVertexTexture || (\r\n\t\t\t\tscreenPositionPixels.x > 0 &&\r\n\t\t\t\tscreenPositionPixels.x < viewportWidth &&\r\n\t\t\t\tscreenPositionPixels.y > 0 &&\r\n\t\t\t\tscreenPositionPixels.y < viewportHeight ) ) {\r\n\r\n\t\t\t\t// save current RGB to temp texture\r\n\r\n\t\t\t\tgl.activeTexture( gl.TEXTURE1 );\r\n\t\t\t\tgl.bindTexture( gl.TEXTURE_2D, tempTexture );\r\n\t\t\t\tgl.copyTexImage2D( gl.TEXTURE_2D, 0, gl.RGB, screenPositionPixels.x - 8, screenPositionPixels.y - 8, 16, 16, 0 );\r\n\r\n\r\n\t\t\t\t// render pink quad\r\n\r\n\t\t\t\tgl.uniform1i( uniforms.renderType, 0 );\r\n\t\t\t\tgl.uniform2f( uniforms.scale, scale.x, scale.y );\r\n\t\t\t\tgl.uniform3f( uniforms.screenPosition, screenPosition.x, screenPosition.y, screenPosition.z );\r\n\r\n\t\t\t\tgl.disable( gl.BLEND );\r\n\t\t\t\tgl.enable( gl.DEPTH_TEST );\r\n\r\n\t\t\t\tgl.drawElements( gl.TRIANGLES, 6, gl.UNSIGNED_SHORT, 0 );\r\n\r\n\r\n\t\t\t\t// copy result to occlusionMap\r\n\r\n\t\t\t\tgl.activeTexture( gl.TEXTURE0 );\r\n\t\t\t\tgl.bindTexture( gl.TEXTURE_2D, occlusionTexture );\r\n\t\t\t\tgl.copyTexImage2D( gl.TEXTURE_2D, 0, gl.RGBA, screenPositionPixels.x - 8, screenPositionPixels.y - 8, 16, 16, 0 );\r\n\r\n\r\n\t\t\t\t// restore graphics\r\n\r\n\t\t\t\tgl.uniform1i( uniforms.renderType, 1 );\r\n\t\t\t\tgl.disable( gl.DEPTH_TEST );\r\n\r\n\t\t\t\tgl.activeTexture( gl.TEXTURE1 );\r\n\t\t\t\tgl.bindTexture( gl.TEXTURE_2D, tempTexture );\r\n\t\t\t\tgl.drawElements( gl.TRIANGLES, 6, gl.UNSIGNED_SHORT, 0 );\r\n\r\n\r\n\t\t\t\t// update object positions\r\n\r\n\t\t\t\tflare.positionScreen.copy( screenPosition )\r\n\r\n\t\t\t\tif ( flare.customUpdateCallback ) {\r\n\r\n\t\t\t\t\tflare.customUpdateCallback( flare );\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\tflare.updateLensFlares();\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// render flares\r\n\r\n\t\t\t\tgl.uniform1i( uniforms.renderType, 2 );\r\n\t\t\t\tgl.enable( gl.BLEND );\r\n\r\n\t\t\t\tfor ( var j = 0, jl = flare.lensFlares.length; j < jl; j ++ ) {\r\n\r\n\t\t\t\t\tvar sprite = flare.lensFlares[ j ];\r\n\r\n\t\t\t\t\tif ( sprite.opacity > 0.001 && sprite.scale > 0.001 ) {\r\n\r\n\t\t\t\t\t\tscreenPosition.x = sprite.x;\r\n\t\t\t\t\t\tscreenPosition.y = sprite.y;\r\n\t\t\t\t\t\tscreenPosition.z = sprite.z;\r\n\r\n\t\t\t\t\t\tsize = sprite.size * sprite.scale / viewportHeight;\r\n\r\n\t\t\t\t\t\tscale.x = size * invAspect;\r\n\t\t\t\t\t\tscale.y = size;\r\n\r\n\t\t\t\t\t\tgl.uniform3f( uniforms.screenPosition, screenPosition.x, screenPosition.y, screenPosition.z );\r\n\t\t\t\t\t\tgl.uniform2f( uniforms.scale, scale.x, scale.y );\r\n\t\t\t\t\t\tgl.uniform1f( uniforms.rotation, sprite.rotation );\r\n\r\n\t\t\t\t\t\tgl.uniform1f( uniforms.opacity, sprite.opacity );\r\n\t\t\t\t\t\tgl.uniform3f( uniforms.color, sprite.color.r, sprite.color.g, sprite.color.b );\r\n\r\n\t\t\t\t\t\trenderer.state.setBlending( sprite.blending, sprite.blendEquation, sprite.blendSrc, sprite.blendDst );\r\n\t\t\t\t\t\trenderer.setTexture( sprite.texture, 1 );\r\n\r\n\t\t\t\t\t\tgl.drawElements( gl.TRIANGLES, 6, gl.UNSIGNED_SHORT, 0 );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\t// restore gl\r\n\r\n\t\tgl.enable( gl.CULL_FACE );\r\n\t\tgl.enable( gl.DEPTH_TEST );\r\n\t\tgl.depthMask( true );\r\n\r\n\t\trenderer.resetGLState();\r\n\r\n\t};\r\n\r\n\tfunction createProgram ( shader ) {\r\n\r\n\t\tvar program = gl.createProgram();\r\n\r\n\t\tvar fragmentShader = gl.createShader( gl.FRAGMENT_SHADER );\r\n\t\tvar vertexShader = gl.createShader( gl.VERTEX_SHADER );\r\n\r\n\t\tvar prefix = \"precision \" + renderer.getPrecision() + \" float;\\n\";\r\n\r\n\t\tgl.shaderSource( fragmentShader, prefix + shader.fragmentShader );\r\n\t\tgl.shaderSource( vertexShader, prefix + shader.vertexShader );\r\n\r\n\t\tgl.compileShader( fragmentShader );\r\n\t\tgl.compileShader( vertexShader );\r\n\r\n\t\tgl.attachShader( program, fragmentShader );\r\n\t\tgl.attachShader( program, vertexShader );\r\n\r\n\t\tgl.linkProgram( program );\r\n\r\n\t\treturn program;\r\n\r\n\t}\r\n\r\n};\r\n\r\n// File:src/renderers/webgl/plugins/ShadowMapPlugin.js\r\n\r\n/**\r\n * @author alteredq / http://alteredqualia.com/\r\n */\r\n\r\nTHREE.ShadowMapPlugin = function ( _renderer, _lights, _webglObjects, _webglObjectsImmediate ) {\r\n\r\n\tvar _gl = _renderer.context;\r\n\r\n\tvar _depthMaterial, _depthMaterialMorph, _depthMaterialSkin, _depthMaterialMorphSkin,\r\n\r\n\t_frustum = new THREE.Frustum(),\r\n\t_projScreenMatrix = new THREE.Matrix4(),\r\n\r\n\t_min = new THREE.Vector3(),\r\n\t_max = new THREE.Vector3(),\r\n\r\n\t_matrixPosition = new THREE.Vector3(),\r\n\r\n\t_renderList = [];\r\n\r\n\t// init\r\n\r\n\tvar depthShader = THREE.ShaderLib[ \"depthRGBA\" ];\r\n\tvar depthUniforms = THREE.UniformsUtils.clone( depthShader.uniforms );\r\n\r\n\t_depthMaterial = new THREE.ShaderMaterial( {\r\n\t\tuniforms: depthUniforms,\r\n\t\tvertexShader: depthShader.vertexShader,\r\n\t\tfragmentShader: depthShader.fragmentShader\r\n\t } );\r\n\r\n\t_depthMaterialMorph = new THREE.ShaderMaterial( {\r\n\t\tuniforms: depthUniforms,\r\n\t\tvertexShader: depthShader.vertexShader,\r\n\t\tfragmentShader: depthShader.fragmentShader,\r\n\t\tmorphTargets: true\r\n\t} );\r\n\r\n\t_depthMaterialSkin = new THREE.ShaderMaterial( {\r\n\t\tuniforms: depthUniforms,\r\n\t\tvertexShader: depthShader.vertexShader,\r\n\t\tfragmentShader: depthShader.fragmentShader,\r\n\t\tskinning: true\r\n\t} );\r\n\r\n\t_depthMaterialMorphSkin = new THREE.ShaderMaterial( {\r\n\t\tuniforms: depthUniforms,\r\n\t\tvertexShader: depthShader.vertexShader,\r\n\t\tfragmentShader: depthShader.fragmentShader,\r\n\t\tmorphTargets: true,\r\n\t\tskinning: true\r\n\t} );\r\n\r\n\t_depthMaterial._shadowPass = true;\r\n\t_depthMaterialMorph._shadowPass = true;\r\n\t_depthMaterialSkin._shadowPass = true;\r\n\t_depthMaterialMorphSkin._shadowPass = true;\r\n\r\n\tthis.render = function ( scene, camera ) {\r\n\r\n\t\tif ( _renderer.shadowMapEnabled === false ) return;\r\n\r\n\t\tvar i, il, j, jl, n,\r\n\r\n\t\tshadowMap, shadowMatrix, shadowCamera,\r\n\t\tbuffer, material,\r\n\t\twebglObject, object, light,\r\n\r\n\t\tlights = [],\r\n\t\tk = 0,\r\n\r\n\t\tfog = null;\r\n\r\n\t\t// set GL state for depth map\r\n\r\n\t\t_gl.clearColor( 1, 1, 1, 1 );\r\n\t\t_gl.disable( _gl.BLEND );\r\n\r\n\t\t_gl.enable( _gl.CULL_FACE );\r\n\t\t_gl.frontFace( _gl.CCW );\r\n\r\n\t\tif ( _renderer.shadowMapCullFace === THREE.CullFaceFront ) {\r\n\r\n\t\t\t_gl.cullFace( _gl.FRONT );\r\n\r\n\t\t} else {\r\n\r\n\t\t\t_gl.cullFace( _gl.BACK );\r\n\r\n\t\t}\r\n\r\n\t\t_renderer.state.setDepthTest( true );\r\n\r\n\t\t// preprocess lights\r\n\t\t// \t- skip lights that are not casting shadows\r\n\t\t//\t- create virtual lights for cascaded shadow maps\r\n\r\n\t\tfor ( i = 0, il = _lights.length; i < il; i ++ ) {\r\n\r\n\t\t\tlight = _lights[ i ];\r\n\r\n\t\t\tif ( ! light.castShadow ) continue;\r\n\r\n\t\t\tif ( ( light instanceof THREE.DirectionalLight ) && light.shadowCascade ) {\r\n\r\n\t\t\t\tfor ( n = 0; n < light.shadowCascadeCount; n ++ ) {\r\n\r\n\t\t\t\t\tvar virtualLight;\r\n\r\n\t\t\t\t\tif ( ! light.shadowCascadeArray[ n ] ) {\r\n\r\n\t\t\t\t\t\tvirtualLight = createVirtualLight( light, n );\r\n\t\t\t\t\t\tvirtualLight.originalCamera = camera;\r\n\r\n\t\t\t\t\t\tvar gyro = new THREE.Gyroscope();\r\n\t\t\t\t\t\tgyro.position.copy( light.shadowCascadeOffset );\r\n\r\n\t\t\t\t\t\tgyro.add( virtualLight );\r\n\t\t\t\t\t\tgyro.add( virtualLight.target );\r\n\r\n\t\t\t\t\t\tcamera.add( gyro );\r\n\r\n\t\t\t\t\t\tlight.shadowCascadeArray[ n ] = virtualLight;\r\n\r\n\t\t\t\t\t\t//console.log( \"Created virtualLight\", virtualLight );\r\n\r\n\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\tvirtualLight = light.shadowCascadeArray[ n ];\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tupdateVirtualLight( light, n );\r\n\r\n\t\t\t\t\tlights[ k ] = virtualLight;\r\n\t\t\t\t\tk ++;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tlights[ k ] = light;\r\n\t\t\t\tk ++;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\t// render depth map\r\n\r\n\t\tfor ( i = 0, il = lights.length; i < il; i ++ ) {\r\n\r\n\t\t\tlight = lights[ i ];\r\n\r\n\t\t\tif ( ! light.shadowMap ) {\r\n\r\n\t\t\t\tvar shadowFilter = THREE.LinearFilter;\r\n\r\n\t\t\t\tif ( _renderer.shadowMapType === THREE.PCFSoftShadowMap ) {\r\n\r\n\t\t\t\t\tshadowFilter = THREE.NearestFilter;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar pars = { minFilter: shadowFilter, magFilter: shadowFilter, format: THREE.RGBAFormat };\r\n\r\n\t\t\t\tlight.shadowMap = new THREE.WebGLRenderTarget( light.shadowMapWidth, light.shadowMapHeight, pars );\r\n\t\t\t\tlight.shadowMapSize = new THREE.Vector2( light.shadowMapWidth, light.shadowMapHeight );\r\n\r\n\t\t\t\tlight.shadowMatrix = new THREE.Matrix4();\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( ! light.shadowCamera ) {\r\n\r\n\t\t\t\tif ( light instanceof THREE.SpotLight ) {\r\n\r\n\t\t\t\t\tlight.shadowCamera = new THREE.PerspectiveCamera( light.shadowCameraFov, light.shadowMapWidth / light.shadowMapHeight, light.shadowCameraNear, light.shadowCameraFar );\r\n\r\n\t\t\t\t} else if ( light instanceof THREE.DirectionalLight ) {\r\n\r\n\t\t\t\t\tlight.shadowCamera = new THREE.OrthographicCamera( light.shadowCameraLeft, light.shadowCameraRight, light.shadowCameraTop, light.shadowCameraBottom, light.shadowCameraNear, light.shadowCameraFar );\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\tTHREE.error( \"THREE.ShadowMapPlugin: Unsupported light type for shadow\", light );\r\n\t\t\t\t\tcontinue;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tscene.add( light.shadowCamera );\r\n\r\n\t\t\t\tif ( scene.autoUpdate === true ) scene.updateMatrixWorld();\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( light.shadowCameraVisible && ! light.cameraHelper ) {\r\n\r\n\t\t\t\tlight.cameraHelper = new THREE.CameraHelper( light.shadowCamera );\r\n\t\t\t\tscene.add( light.cameraHelper );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( light.isVirtual && virtualLight.originalCamera == camera ) {\r\n\r\n\t\t\t\tupdateShadowCamera( camera, light );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tshadowMap = light.shadowMap;\r\n\t\t\tshadowMatrix = light.shadowMatrix;\r\n\t\t\tshadowCamera = light.shadowCamera;\r\n\r\n\t\t\t//\r\n\r\n\t\t\tshadowCamera.position.setFromMatrixPosition( light.matrixWorld );\r\n\t\t\t_matrixPosition.setFromMatrixPosition( light.target.matrixWorld );\r\n\t\t\tshadowCamera.lookAt( _matrixPosition );\r\n\t\t\tshadowCamera.updateMatrixWorld();\r\n\r\n\t\t\tshadowCamera.matrixWorldInverse.getInverse( shadowCamera.matrixWorld );\r\n\r\n\t\t\t//\r\n\r\n\t\t\tif ( light.cameraHelper ) light.cameraHelper.visible = light.shadowCameraVisible;\r\n\t\t\tif ( light.shadowCameraVisible ) light.cameraHelper.update();\r\n\r\n\t\t\t// compute shadow matrix\r\n\r\n\t\t\tshadowMatrix.set(\r\n\t\t\t\t0.5, 0.0, 0.0, 0.5,\r\n\t\t\t\t0.0, 0.5, 0.0, 0.5,\r\n\t\t\t\t0.0, 0.0, 0.5, 0.5,\r\n\t\t\t\t0.0, 0.0, 0.0, 1.0\r\n\t\t\t);\r\n\r\n\t\t\tshadowMatrix.multiply( shadowCamera.projectionMatrix );\r\n\t\t\tshadowMatrix.multiply( shadowCamera.matrixWorldInverse );\r\n\r\n\t\t\t// update camera matrices and frustum\r\n\r\n\t\t\t_projScreenMatrix.multiplyMatrices( shadowCamera.projectionMatrix, shadowCamera.matrixWorldInverse );\r\n\t\t\t_frustum.setFromMatrix( _projScreenMatrix );\r\n\r\n\t\t\t// render shadow map\r\n\r\n\t\t\t_renderer.setRenderTarget( shadowMap );\r\n\t\t\t_renderer.clear();\r\n\r\n\t\t\t// set object matrices & frustum culling\r\n\r\n\t\t\t_renderList.length = 0;\r\n\r\n\t\t\tprojectObject( scene, scene, shadowCamera );\r\n\r\n\r\n\t\t\t// render regular objects\r\n\r\n\t\t\tvar objectMaterial, useMorphing, useSkinning;\r\n\r\n\t\t\tfor ( j = 0, jl = _renderList.length; j < jl; j ++ ) {\r\n\r\n\t\t\t\twebglObject = _renderList[ j ];\r\n\r\n\t\t\t\tobject = webglObject.object;\r\n\t\t\t\tbuffer = webglObject.buffer;\r\n\r\n\t\t\t\t// culling is overriden globally for all objects\r\n\t\t\t\t// while rendering depth map\r\n\r\n\t\t\t\t// need to deal with MeshFaceMaterial somehow\r\n\t\t\t\t// in that case just use the first of material.materials for now\r\n\t\t\t\t// (proper solution would require to break objects by materials\r\n\t\t\t\t//  similarly to regular rendering and then set corresponding\r\n\t\t\t\t//  depth materials per each chunk instead of just once per object)\r\n\r\n\t\t\t\tobjectMaterial = getObjectMaterial( object );\r\n\r\n\t\t\t\tuseMorphing = object.geometry.morphTargets !== undefined && object.geometry.morphTargets.length > 0 && objectMaterial.morphTargets;\r\n\t\t\t\tuseSkinning = object instanceof THREE.SkinnedMesh && objectMaterial.skinning;\r\n\r\n\t\t\t\tif ( object.customDepthMaterial ) {\r\n\r\n\t\t\t\t\tmaterial = object.customDepthMaterial;\r\n\r\n\t\t\t\t} else if ( useSkinning ) {\r\n\r\n\t\t\t\t\tmaterial = useMorphing ? _depthMaterialMorphSkin : _depthMaterialSkin;\r\n\r\n\t\t\t\t} else if ( useMorphing ) {\r\n\r\n\t\t\t\t\tmaterial = _depthMaterialMorph;\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\tmaterial = _depthMaterial;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\t_renderer.setMaterialFaces( objectMaterial );\r\n\r\n\t\t\t\tif ( buffer instanceof THREE.BufferGeometry ) {\r\n\r\n\t\t\t\t\t_renderer.renderBufferDirect( shadowCamera, _lights, fog, material, buffer, object );\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\t_renderer.renderBuffer( shadowCamera, _lights, fog, material, buffer, object );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\t// set matrices and render immediate objects\r\n\r\n\t\t\tfor ( j = 0, jl = _webglObjectsImmediate.length; j < jl; j ++ ) {\r\n\r\n\t\t\t\twebglObject = _webglObjectsImmediate[ j ];\r\n\t\t\t\tobject = webglObject.object;\r\n\r\n\t\t\t\tif ( object.visible && object.castShadow ) {\r\n\r\n\t\t\t\t\tobject._modelViewMatrix.multiplyMatrices( shadowCamera.matrixWorldInverse, object.matrixWorld );\r\n\r\n\t\t\t\t\t_renderer.renderImmediateObject( shadowCamera, _lights, fog, _depthMaterial, object );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\t// restore GL state\r\n\r\n\t\tvar clearColor = _renderer.getClearColor(),\r\n\t\tclearAlpha = _renderer.getClearAlpha();\r\n\r\n\t\t_gl.clearColor( clearColor.r, clearColor.g, clearColor.b, clearAlpha );\r\n\t\t_gl.enable( _gl.BLEND );\r\n\r\n\t\tif ( _renderer.shadowMapCullFace === THREE.CullFaceFront ) {\r\n\r\n\t\t\t_gl.cullFace( _gl.BACK );\r\n\r\n\t\t}\r\n\r\n\t\t_renderer.resetGLState();\r\n\r\n\t};\r\n\r\n\tfunction projectObject( scene, object, shadowCamera ) {\r\n\r\n\t\tif ( object.visible ) {\r\n\r\n\t\t\tvar webglObjects = _webglObjects[ object.id ];\r\n\r\n\t\t\tif ( webglObjects && object.castShadow && (object.frustumCulled === false || _frustum.intersectsObject( object ) === true) ) {\r\n\r\n\t\t\t\tfor ( var i = 0, l = webglObjects.length; i < l; i ++ ) {\r\n\r\n\t\t\t\t\tvar webglObject = webglObjects[ i ];\r\n\r\n\t\t\t\t\tobject._modelViewMatrix.multiplyMatrices( shadowCamera.matrixWorldInverse, object.matrixWorld );\r\n\t\t\t\t\t_renderList.push( webglObject );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\tfor ( var i = 0, l = object.children.length; i < l; i ++ ) {\r\n\r\n\t\t\t\tprojectObject( scene, object.children[ i ], shadowCamera );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tfunction createVirtualLight( light, cascade ) {\r\n\r\n\t\tvar virtualLight = new THREE.DirectionalLight();\r\n\r\n\t\tvirtualLight.isVirtual = true;\r\n\r\n\t\tvirtualLight.onlyShadow = true;\r\n\t\tvirtualLight.castShadow = true;\r\n\r\n\t\tvirtualLight.shadowCameraNear = light.shadowCameraNear;\r\n\t\tvirtualLight.shadowCameraFar = light.shadowCameraFar;\r\n\r\n\t\tvirtualLight.shadowCameraLeft = light.shadowCameraLeft;\r\n\t\tvirtualLight.shadowCameraRight = light.shadowCameraRight;\r\n\t\tvirtualLight.shadowCameraBottom = light.shadowCameraBottom;\r\n\t\tvirtualLight.shadowCameraTop = light.shadowCameraTop;\r\n\r\n\t\tvirtualLight.shadowCameraVisible = light.shadowCameraVisible;\r\n\r\n\t\tvirtualLight.shadowDarkness = light.shadowDarkness;\r\n\r\n\t\tvirtualLight.shadowBias = light.shadowCascadeBias[ cascade ];\r\n\t\tvirtualLight.shadowMapWidth = light.shadowCascadeWidth[ cascade ];\r\n\t\tvirtualLight.shadowMapHeight = light.shadowCascadeHeight[ cascade ];\r\n\r\n\t\tvirtualLight.pointsWorld = [];\r\n\t\tvirtualLight.pointsFrustum = [];\r\n\r\n\t\tvar pointsWorld = virtualLight.pointsWorld,\r\n\t\t\tpointsFrustum = virtualLight.pointsFrustum;\r\n\r\n\t\tfor ( var i = 0; i < 8; i ++ ) {\r\n\r\n\t\t\tpointsWorld[ i ] = new THREE.Vector3();\r\n\t\t\tpointsFrustum[ i ] = new THREE.Vector3();\r\n\r\n\t\t}\r\n\r\n\t\tvar nearZ = light.shadowCascadeNearZ[ cascade ];\r\n\t\tvar farZ = light.shadowCascadeFarZ[ cascade ];\r\n\r\n\t\tpointsFrustum[ 0 ].set( - 1, - 1, nearZ );\r\n\t\tpointsFrustum[ 1 ].set(  1, - 1, nearZ );\r\n\t\tpointsFrustum[ 2 ].set( - 1,  1, nearZ );\r\n\t\tpointsFrustum[ 3 ].set(  1,  1, nearZ );\r\n\r\n\t\tpointsFrustum[ 4 ].set( - 1, - 1, farZ );\r\n\t\tpointsFrustum[ 5 ].set(  1, - 1, farZ );\r\n\t\tpointsFrustum[ 6 ].set( - 1,  1, farZ );\r\n\t\tpointsFrustum[ 7 ].set(  1,  1, farZ );\r\n\r\n\t\treturn virtualLight;\r\n\r\n\t}\r\n\r\n\t// Synchronize virtual light with the original light\r\n\r\n\tfunction updateVirtualLight( light, cascade ) {\r\n\r\n\t\tvar virtualLight = light.shadowCascadeArray[ cascade ];\r\n\r\n\t\tvirtualLight.position.copy( light.position );\r\n\t\tvirtualLight.target.position.copy( light.target.position );\r\n\t\tvirtualLight.lookAt( virtualLight.target );\r\n\r\n\t\tvirtualLight.shadowCameraVisible = light.shadowCameraVisible;\r\n\t\tvirtualLight.shadowDarkness = light.shadowDarkness;\r\n\r\n\t\tvirtualLight.shadowBias = light.shadowCascadeBias[ cascade ];\r\n\r\n\t\tvar nearZ = light.shadowCascadeNearZ[ cascade ];\r\n\t\tvar farZ = light.shadowCascadeFarZ[ cascade ];\r\n\r\n\t\tvar pointsFrustum = virtualLight.pointsFrustum;\r\n\r\n\t\tpointsFrustum[ 0 ].z = nearZ;\r\n\t\tpointsFrustum[ 1 ].z = nearZ;\r\n\t\tpointsFrustum[ 2 ].z = nearZ;\r\n\t\tpointsFrustum[ 3 ].z = nearZ;\r\n\r\n\t\tpointsFrustum[ 4 ].z = farZ;\r\n\t\tpointsFrustum[ 5 ].z = farZ;\r\n\t\tpointsFrustum[ 6 ].z = farZ;\r\n\t\tpointsFrustum[ 7 ].z = farZ;\r\n\r\n\t}\r\n\r\n\t// Fit shadow camera's ortho frustum to camera frustum\r\n\r\n\tfunction updateShadowCamera( camera, light ) {\r\n\r\n\t\tvar shadowCamera = light.shadowCamera,\r\n\t\t\tpointsFrustum = light.pointsFrustum,\r\n\t\t\tpointsWorld = light.pointsWorld;\r\n\r\n\t\t_min.set( Infinity, Infinity, Infinity );\r\n\t\t_max.set( - Infinity, - Infinity, - Infinity );\r\n\r\n\t\tfor ( var i = 0; i < 8; i ++ ) {\r\n\r\n\t\t\tvar p = pointsWorld[ i ];\r\n\r\n\t\t\tp.copy( pointsFrustum[ i ] );\r\n\t\t\tp.unproject( camera );\r\n\r\n\t\t\tp.applyMatrix4( shadowCamera.matrixWorldInverse );\r\n\r\n\t\t\tif ( p.x < _min.x ) _min.x = p.x;\r\n\t\t\tif ( p.x > _max.x ) _max.x = p.x;\r\n\r\n\t\t\tif ( p.y < _min.y ) _min.y = p.y;\r\n\t\t\tif ( p.y > _max.y ) _max.y = p.y;\r\n\r\n\t\t\tif ( p.z < _min.z ) _min.z = p.z;\r\n\t\t\tif ( p.z > _max.z ) _max.z = p.z;\r\n\r\n\t\t}\r\n\r\n\t\tshadowCamera.left = _min.x;\r\n\t\tshadowCamera.right = _max.x;\r\n\t\tshadowCamera.top = _max.y;\r\n\t\tshadowCamera.bottom = _min.y;\r\n\r\n\t\t// can't really fit near/far\r\n\t\t//shadowCamera.near = _min.z;\r\n\t\t//shadowCamera.far = _max.z;\r\n\r\n\t\tshadowCamera.updateProjectionMatrix();\r\n\r\n\t}\r\n\r\n\t// For the moment just ignore objects that have multiple materials with different animation methods\r\n\t// Only the first material will be taken into account for deciding which depth material to use for shadow maps\r\n\r\n\tfunction getObjectMaterial( object ) {\r\n\r\n\t\treturn object.material instanceof THREE.MeshFaceMaterial\r\n\t\t\t? object.material.materials[ 0 ]\r\n\t\t\t: object.material;\r\n\r\n\t};\r\n\r\n};\r\n\r\n// File:src/renderers/webgl/plugins/SpritePlugin.js\r\n\r\n/**\r\n * @author mikael emtinger / http://gomo.se/\r\n * @author alteredq / http://alteredqualia.com/\r\n */\r\n\r\nTHREE.SpritePlugin = function ( renderer, sprites ) {\r\n\r\n\tvar gl = renderer.context;\r\n\r\n\tvar vertexBuffer, elementBuffer;\r\n\tvar program, attributes, uniforms;\r\n\r\n\tvar texture;\r\n\r\n\t// decompose matrixWorld\r\n\r\n\tvar spritePosition = new THREE.Vector3();\r\n\tvar spriteRotation = new THREE.Quaternion();\r\n\tvar spriteScale = new THREE.Vector3();\r\n\r\n\tvar init = function () {\r\n\r\n\t\tvar vertices = new Float32Array( [\r\n\t\t\t- 0.5, - 0.5,  0, 0,\r\n\t\t\t  0.5, - 0.5,  1, 0,\r\n\t\t\t  0.5,   0.5,  1, 1,\r\n\t\t\t- 0.5,   0.5,  0, 1\r\n\t\t] );\r\n\r\n\t\tvar faces = new Uint16Array( [\r\n\t\t\t0, 1, 2,\r\n\t\t\t0, 2, 3\r\n\t\t] );\r\n\r\n\t\tvertexBuffer  = gl.createBuffer();\r\n\t\telementBuffer = gl.createBuffer();\r\n\r\n\t\tgl.bindBuffer( gl.ARRAY_BUFFER, vertexBuffer );\r\n\t\tgl.bufferData( gl.ARRAY_BUFFER, vertices, gl.STATIC_DRAW );\r\n\r\n\t\tgl.bindBuffer( gl.ELEMENT_ARRAY_BUFFER, elementBuffer );\r\n\t\tgl.bufferData( gl.ELEMENT_ARRAY_BUFFER, faces, gl.STATIC_DRAW );\r\n\r\n\t\tprogram = createProgram();\r\n\r\n\t\tattributes = {\r\n\t\t\tposition:\t\t\tgl.getAttribLocation ( program, 'position' ),\r\n\t\t\tuv:\t\t\t\t\tgl.getAttribLocation ( program, 'uv' )\r\n\t\t};\r\n\r\n\t\tuniforms = {\r\n\t\t\tuvOffset:\t\t\tgl.getUniformLocation( program, 'uvOffset' ),\r\n\t\t\tuvScale:\t\t\tgl.getUniformLocation( program, 'uvScale' ),\r\n\r\n\t\t\trotation:\t\t\tgl.getUniformLocation( program, 'rotation' ),\r\n\t\t\tscale:\t\t\t\tgl.getUniformLocation( program, 'scale' ),\r\n\r\n\t\t\tcolor:\t\t\t\tgl.getUniformLocation( program, 'color' ),\r\n\t\t\tmap:\t\t\t\tgl.getUniformLocation( program, 'map' ),\r\n\t\t\topacity:\t\t\tgl.getUniformLocation( program, 'opacity' ),\r\n\r\n\t\t\tmodelViewMatrix: \tgl.getUniformLocation( program, 'modelViewMatrix' ),\r\n\t\t\tprojectionMatrix:\tgl.getUniformLocation( program, 'projectionMatrix' ),\r\n\r\n\t\t\tfogType:\t\t\tgl.getUniformLocation( program, 'fogType' ),\r\n\t\t\tfogDensity:\t\t\tgl.getUniformLocation( program, 'fogDensity' ),\r\n\t\t\tfogNear:\t\t\tgl.getUniformLocation( program, 'fogNear' ),\r\n\t\t\tfogFar:\t\t\t\tgl.getUniformLocation( program, 'fogFar' ),\r\n\t\t\tfogColor:\t\t\tgl.getUniformLocation( program, 'fogColor' ),\r\n\r\n\t\t\talphaTest:\t\t\tgl.getUniformLocation( program, 'alphaTest' )\r\n\t\t};\r\n\r\n\t\tvar canvas = document.createElement( 'canvas' );\r\n\t\tcanvas.width = 8;\r\n\t\tcanvas.height = 8;\r\n\r\n\t\tvar context = canvas.getContext( '2d' );\r\n\t\tcontext.fillStyle = 'white';\r\n\t\tcontext.fillRect( 0, 0, 8, 8 );\r\n\r\n\t\ttexture = new THREE.Texture( canvas );\r\n\t\ttexture.needsUpdate = true;\r\n\r\n\t};\r\n\r\n\tthis.render = function ( scene, camera ) {\r\n\r\n\t\tif ( sprites.length === 0 ) return;\r\n\r\n\t\t// setup gl\r\n\r\n\t\tif ( program === undefined ) {\r\n\r\n\t\t\tinit();\r\n\r\n\t\t}\r\n\r\n\t\tgl.useProgram( program );\r\n\r\n\t\tgl.enableVertexAttribArray( attributes.position );\r\n\t\tgl.enableVertexAttribArray( attributes.uv );\r\n\r\n\t\tgl.disable( gl.CULL_FACE );\r\n\t\tgl.enable( gl.BLEND );\r\n\r\n\t\tgl.bindBuffer( gl.ARRAY_BUFFER, vertexBuffer );\r\n\t\tgl.vertexAttribPointer( attributes.position, 2, gl.FLOAT, false, 2 * 8, 0 );\r\n\t\tgl.vertexAttribPointer( attributes.uv, 2, gl.FLOAT, false, 2 * 8, 8 );\r\n\r\n\t\tgl.bindBuffer( gl.ELEMENT_ARRAY_BUFFER, elementBuffer );\r\n\r\n\t\tgl.uniformMatrix4fv( uniforms.projectionMatrix, false, camera.projectionMatrix.elements );\r\n\r\n\t\tgl.activeTexture( gl.TEXTURE0 );\r\n\t\tgl.uniform1i( uniforms.map, 0 );\r\n\r\n\t\tvar oldFogType = 0;\r\n\t\tvar sceneFogType = 0;\r\n\t\tvar fog = scene.fog;\r\n\r\n\t\tif ( fog ) {\r\n\r\n\t\t\tgl.uniform3f( uniforms.fogColor, fog.color.r, fog.color.g, fog.color.b );\r\n\r\n\t\t\tif ( fog instanceof THREE.Fog ) {\r\n\r\n\t\t\t\tgl.uniform1f( uniforms.fogNear, fog.near );\r\n\t\t\t\tgl.uniform1f( uniforms.fogFar, fog.far );\r\n\r\n\t\t\t\tgl.uniform1i( uniforms.fogType, 1 );\r\n\t\t\t\toldFogType = 1;\r\n\t\t\t\tsceneFogType = 1;\r\n\r\n\t\t\t} else if ( fog instanceof THREE.FogExp2 ) {\r\n\r\n\t\t\t\tgl.uniform1f( uniforms.fogDensity, fog.density );\r\n\r\n\t\t\t\tgl.uniform1i( uniforms.fogType, 2 );\r\n\t\t\t\toldFogType = 2;\r\n\t\t\t\tsceneFogType = 2;\r\n\r\n\t\t\t}\r\n\r\n\t\t} else {\r\n\r\n\t\t\tgl.uniform1i( uniforms.fogType, 0 );\r\n\t\t\toldFogType = 0;\r\n\t\t\tsceneFogType = 0;\r\n\r\n\t\t}\r\n\r\n\r\n\t\t// update positions and sort\r\n\r\n\t\tfor ( var i = 0, l = sprites.length; i < l; i ++ ) {\r\n\r\n\t\t\tvar sprite = sprites[ i ];\r\n\r\n\t\t\tsprite._modelViewMatrix.multiplyMatrices( camera.matrixWorldInverse, sprite.matrixWorld );\r\n\t\t\tsprite.z = - sprite._modelViewMatrix.elements[ 14 ];\r\n\r\n\t\t}\r\n\r\n\t\tsprites.sort( painterSortStable );\r\n\r\n\t\t// render all sprites\r\n\r\n\t\tvar scale = [];\r\n\r\n\t\tfor ( var i = 0, l = sprites.length; i < l; i ++ ) {\r\n\r\n\t\t\tvar sprite = sprites[ i ];\r\n\t\t\tvar material = sprite.material;\r\n\r\n\t\t\tgl.uniform1f( uniforms.alphaTest, material.alphaTest );\r\n\t\t\tgl.uniformMatrix4fv( uniforms.modelViewMatrix, false, sprite._modelViewMatrix.elements );\r\n\r\n\t\t\tsprite.matrixWorld.decompose( spritePosition, spriteRotation, spriteScale );\r\n\r\n\t\t\tscale[ 0 ] = spriteScale.x;\r\n\t\t\tscale[ 1 ] = spriteScale.y;\r\n\r\n\t\t\tvar fogType = 0;\r\n\r\n\t\t\tif ( scene.fog && material.fog ) {\r\n\r\n\t\t\t\tfogType = sceneFogType;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( oldFogType !== fogType ) {\r\n\r\n\t\t\t\tgl.uniform1i( uniforms.fogType, fogType );\r\n\t\t\t\toldFogType = fogType;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( material.map !== null ) {\r\n\r\n\t\t\t\tgl.uniform2f( uniforms.uvOffset, material.map.offset.x, material.map.offset.y );\r\n\t\t\t\tgl.uniform2f( uniforms.uvScale, material.map.repeat.x, material.map.repeat.y );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tgl.uniform2f( uniforms.uvOffset, 0, 0 );\r\n\t\t\t\tgl.uniform2f( uniforms.uvScale, 1, 1 );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tgl.uniform1f( uniforms.opacity, material.opacity );\r\n\t\t\tgl.uniform3f( uniforms.color, material.color.r, material.color.g, material.color.b );\r\n\r\n\t\t\tgl.uniform1f( uniforms.rotation, material.rotation );\r\n\t\t\tgl.uniform2fv( uniforms.scale, scale );\r\n\r\n\t\t\trenderer.state.setBlending( material.blending, material.blendEquation, material.blendSrc, material.blendDst );\r\n\t\t\trenderer.state.setDepthTest( material.depthTest );\r\n\t\t\trenderer.state.setDepthWrite( material.depthWrite );\r\n\r\n\t\t\tif ( material.map && material.map.image && material.map.image.width ) {\r\n\r\n\t\t\t\trenderer.setTexture( material.map, 0 );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\trenderer.setTexture( texture, 0 );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tgl.drawElements( gl.TRIANGLES, 6, gl.UNSIGNED_SHORT, 0 );\r\n\r\n\t\t}\r\n\r\n\t\t// restore gl\r\n\r\n\t\tgl.enable( gl.CULL_FACE );\r\n\r\n\t\trenderer.resetGLState();\r\n\r\n\t};\r\n\r\n\tfunction createProgram () {\r\n\r\n\t\tvar program = gl.createProgram();\r\n\r\n\t\tvar vertexShader = gl.createShader( gl.VERTEX_SHADER );\r\n\t\tvar fragmentShader = gl.createShader( gl.FRAGMENT_SHADER );\r\n\r\n\t\tgl.shaderSource( vertexShader, [\r\n\r\n\t\t\t'precision ' + renderer.getPrecision() + ' float;',\r\n\r\n\t\t\t'uniform mat4 modelViewMatrix;',\r\n\t\t\t'uniform mat4 projectionMatrix;',\r\n\t\t\t'uniform float rotation;',\r\n\t\t\t'uniform vec2 scale;',\r\n\t\t\t'uniform vec2 uvOffset;',\r\n\t\t\t'uniform vec2 uvScale;',\r\n\r\n\t\t\t'attribute vec2 position;',\r\n\t\t\t'attribute vec2 uv;',\r\n\r\n\t\t\t'varying vec2 vUV;',\r\n\r\n\t\t\t'void main() {',\r\n\r\n\t\t\t\t'vUV = uvOffset + uv * uvScale;',\r\n\r\n\t\t\t\t'vec2 alignedPosition = position * scale;',\r\n\r\n\t\t\t\t'vec2 rotatedPosition;',\r\n\t\t\t\t'rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;',\r\n\t\t\t\t'rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;',\r\n\r\n\t\t\t\t'vec4 finalPosition;',\r\n\r\n\t\t\t\t'finalPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );',\r\n\t\t\t\t'finalPosition.xy += rotatedPosition;',\r\n\t\t\t\t'finalPosition = projectionMatrix * finalPosition;',\r\n\r\n\t\t\t\t'gl_Position = finalPosition;',\r\n\r\n\t\t\t'}'\r\n\r\n\t\t].join( '\\n' ) );\r\n\r\n\t\tgl.shaderSource( fragmentShader, [\r\n\r\n\t\t\t'precision ' + renderer.getPrecision() + ' float;',\r\n\r\n\t\t\t'uniform vec3 color;',\r\n\t\t\t'uniform sampler2D map;',\r\n\t\t\t'uniform float opacity;',\r\n\r\n\t\t\t'uniform int fogType;',\r\n\t\t\t'uniform vec3 fogColor;',\r\n\t\t\t'uniform float fogDensity;',\r\n\t\t\t'uniform float fogNear;',\r\n\t\t\t'uniform float fogFar;',\r\n\t\t\t'uniform float alphaTest;',\r\n\r\n\t\t\t'varying vec2 vUV;',\r\n\r\n\t\t\t'void main() {',\r\n\r\n\t\t\t\t'vec4 texture = texture2D( map, vUV );',\r\n\r\n\t\t\t\t'if ( texture.a < alphaTest ) discard;',\r\n\r\n\t\t\t\t'gl_FragColor = vec4( color * texture.xyz, texture.a * opacity );',\r\n\r\n\t\t\t\t'if ( fogType > 0 ) {',\r\n\r\n\t\t\t\t\t'float depth = gl_FragCoord.z / gl_FragCoord.w;',\r\n\t\t\t\t\t'float fogFactor = 0.0;',\r\n\r\n\t\t\t\t\t'if ( fogType == 1 ) {',\r\n\r\n\t\t\t\t\t\t'fogFactor = smoothstep( fogNear, fogFar, depth );',\r\n\r\n\t\t\t\t\t'} else {',\r\n\r\n\t\t\t\t\t\t'const float LOG2 = 1.442695;',\r\n\t\t\t\t\t\t'float fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );',\r\n\t\t\t\t\t\t'fogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );',\r\n\r\n\t\t\t\t\t'}',\r\n\r\n\t\t\t\t\t'gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );',\r\n\r\n\t\t\t\t'}',\r\n\r\n\t\t\t'}'\r\n\r\n\t\t].join( '\\n' ) );\r\n\r\n\t\tgl.compileShader( vertexShader );\r\n\t\tgl.compileShader( fragmentShader );\r\n\r\n\t\tgl.attachShader( program, vertexShader );\r\n\t\tgl.attachShader( program, fragmentShader );\r\n\r\n\t\tgl.linkProgram( program );\r\n\r\n\t\treturn program;\r\n\r\n\t};\r\n\r\n\tfunction painterSortStable ( a, b ) {\r\n\r\n\t\tif ( a.z !== b.z ) {\r\n\r\n\t\t\treturn b.z - a.z;\r\n\r\n\t\t} else {\r\n\r\n\t\t\treturn b.id - a.id;\r\n\r\n\t\t}\r\n\r\n\t};\r\n\r\n};\r\n\r\n// File:src/extras/GeometryUtils.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.GeometryUtils = {\r\n\r\n\tmerge: function ( geometry1, geometry2, materialIndexOffset ) {\r\n\r\n\t\tTHREE.warn( 'THREE.GeometryUtils: .merge() has been moved to Geometry. Use geometry.merge( geometry2, matrix, materialIndexOffset ) instead.' );\r\n\r\n\t\tvar matrix;\r\n\r\n\t\tif ( geometry2 instanceof THREE.Mesh ) {\r\n\r\n\t\t\tgeometry2.matrixAutoUpdate && geometry2.updateMatrix();\r\n\r\n\t\t\tmatrix = geometry2.matrix;\r\n\t\t\tgeometry2 = geometry2.geometry;\r\n\r\n\t\t}\r\n\r\n\t\tgeometry1.merge( geometry2, matrix, materialIndexOffset );\r\n\r\n\t},\r\n\r\n\tcenter: function ( geometry ) {\r\n\r\n\t\tTHREE.warn( 'THREE.GeometryUtils: .center() has been moved to Geometry. Use geometry.center() instead.' );\r\n\t\treturn geometry.center();\r\n\r\n\t}\r\n\r\n};\r\n\r\n// File:src/extras/ImageUtils.js\r\n\r\n/**\r\n * @author alteredq / http://alteredqualia.com/\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author Daosheng Mu / https://github.com/DaoshengMu/\r\n */\r\n\r\nTHREE.ImageUtils = {\r\n\r\n\tcrossOrigin: undefined,\r\n\r\n\tloadTexture: function ( url, mapping, onLoad, onError ) {\r\n\r\n\t\tvar loader = new THREE.ImageLoader();\r\n\t\tloader.crossOrigin = this.crossOrigin;\r\n\r\n\t\tvar texture = new THREE.Texture( undefined, mapping );\r\n\r\n\t\tloader.load( url, function ( image ) {\r\n\r\n\t\t\ttexture.image = image;\r\n\t\t\ttexture.needsUpdate = true;\r\n\r\n\t\t\tif ( onLoad ) onLoad( texture );\r\n\r\n\t\t}, undefined, function ( event ) {\r\n\r\n\t\t\tif ( onError ) onError( event );\r\n\r\n\t\t} );\r\n\r\n\t\ttexture.sourceFile = url;\r\n\r\n\t\treturn texture;\r\n\r\n\t},\r\n\r\n\tloadTextureCube: function ( array, mapping, onLoad, onError ) {\r\n\r\n\t\tvar images = [];\r\n\r\n\t\tvar loader = new THREE.ImageLoader();\r\n\t\tloader.crossOrigin = this.crossOrigin;\r\n\r\n\t\tvar texture = new THREE.CubeTexture( images, mapping );\r\n\r\n\t\t// no flipping needed for cube textures\r\n\r\n\t\ttexture.flipY = false;\r\n\r\n\t\tvar loaded = 0;\r\n\r\n\t\tvar loadTexture = function ( i ) {\r\n\r\n\t\t\tloader.load( array[ i ], function ( image ) {\r\n\r\n\t\t\t\ttexture.images[ i ] = image;\r\n\r\n\t\t\t\tloaded += 1;\r\n\r\n\t\t\t\tif ( loaded === 6 ) {\r\n\r\n\t\t\t\t\ttexture.needsUpdate = true;\r\n\r\n\t\t\t\t\tif ( onLoad ) onLoad( texture );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}, undefined, onError );\r\n\r\n\t\t}\r\n\r\n\t\tfor ( var i = 0, il = array.length; i < il; ++ i ) {\r\n\r\n\t\t\tloadTexture( i );\r\n\r\n\t\t}\r\n\r\n\t\treturn texture;\r\n\r\n\t},\r\n\r\n\tloadCompressedTexture: function () {\r\n\r\n\t\tTHREE.error( 'THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.' )\r\n\r\n\t},\r\n\r\n\tloadCompressedTextureCube: function () {\r\n\r\n\t\tTHREE.error( 'THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.' )\r\n\r\n\t},\r\n\r\n\tgetNormalMap: function ( image, depth ) {\r\n\r\n\t\t// Adapted from http://www.paulbrunt.co.uk/lab/heightnormal/\r\n\r\n\t\tvar cross = function ( a, b ) {\r\n\r\n\t\t\treturn [ a[ 1 ] * b[ 2 ] - a[ 2 ] * b[ 1 ], a[ 2 ] * b[ 0 ] - a[ 0 ] * b[ 2 ], a[ 0 ] * b[ 1 ] - a[ 1 ] * b[ 0 ] ];\r\n\r\n\t\t}\r\n\r\n\t\tvar subtract = function ( a, b ) {\r\n\r\n\t\t\treturn [ a[ 0 ] - b[ 0 ], a[ 1 ] - b[ 1 ], a[ 2 ] - b[ 2 ] ];\r\n\r\n\t\t}\r\n\r\n\t\tvar normalize = function ( a ) {\r\n\r\n\t\t\tvar l = Math.sqrt( a[ 0 ] * a[ 0 ] + a[ 1 ] * a[ 1 ] + a[ 2 ] * a[ 2 ] );\r\n\t\t\treturn [ a[ 0 ] / l, a[ 1 ] / l, a[ 2 ] / l ];\r\n\r\n\t\t}\r\n\r\n\t\tdepth = depth | 1;\r\n\r\n\t\tvar width = image.width;\r\n\t\tvar height = image.height;\r\n\r\n\t\tvar canvas = document.createElement( 'canvas' );\r\n\t\tcanvas.width = width;\r\n\t\tcanvas.height = height;\r\n\r\n\t\tvar context = canvas.getContext( '2d' );\r\n\t\tcontext.drawImage( image, 0, 0 );\r\n\r\n\t\tvar data = context.getImageData( 0, 0, width, height ).data;\r\n\t\tvar imageData = context.createImageData( width, height );\r\n\t\tvar output = imageData.data;\r\n\r\n\t\tfor ( var x = 0; x < width; x ++ ) {\r\n\r\n\t\t\tfor ( var y = 0; y < height; y ++ ) {\r\n\r\n\t\t\t\tvar ly = y - 1 < 0 ? 0 : y - 1;\r\n\t\t\t\tvar uy = y + 1 > height - 1 ? height - 1 : y + 1;\r\n\t\t\t\tvar lx = x - 1 < 0 ? 0 : x - 1;\r\n\t\t\t\tvar ux = x + 1 > width - 1 ? width - 1 : x + 1;\r\n\r\n\t\t\t\tvar points = [];\r\n\t\t\t\tvar origin = [ 0, 0, data[ ( y * width + x ) * 4 ] / 255 * depth ];\r\n\t\t\t\tpoints.push( [ - 1, 0, data[ ( y * width + lx ) * 4 ] / 255 * depth ] );\r\n\t\t\t\tpoints.push( [ - 1, - 1, data[ ( ly * width + lx ) * 4 ] / 255 * depth ] );\r\n\t\t\t\tpoints.push( [ 0, - 1, data[ ( ly * width + x ) * 4 ] / 255 * depth ] );\r\n\t\t\t\tpoints.push( [ 1, - 1, data[ ( ly * width + ux ) * 4 ] / 255 * depth ] );\r\n\t\t\t\tpoints.push( [ 1, 0, data[ ( y * width + ux ) * 4 ] / 255 * depth ] );\r\n\t\t\t\tpoints.push( [ 1, 1, data[ ( uy * width + ux ) * 4 ] / 255 * depth ] );\r\n\t\t\t\tpoints.push( [ 0, 1, data[ ( uy * width + x ) * 4 ] / 255 * depth ] );\r\n\t\t\t\tpoints.push( [ - 1, 1, data[ ( uy * width + lx ) * 4 ] / 255 * depth ] );\r\n\r\n\t\t\t\tvar normals = [];\r\n\t\t\t\tvar num_points = points.length;\r\n\r\n\t\t\t\tfor ( var i = 0; i < num_points; i ++ ) {\r\n\r\n\t\t\t\t\tvar v1 = points[ i ];\r\n\t\t\t\t\tvar v2 = points[ ( i + 1 ) % num_points ];\r\n\t\t\t\t\tv1 = subtract( v1, origin );\r\n\t\t\t\t\tv2 = subtract( v2, origin );\r\n\t\t\t\t\tnormals.push( normalize( cross( v1, v2 ) ) );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar normal = [ 0, 0, 0 ];\r\n\r\n\t\t\t\tfor ( var i = 0; i < normals.length; i ++ ) {\r\n\r\n\t\t\t\t\tnormal[ 0 ] += normals[ i ][ 0 ];\r\n\t\t\t\t\tnormal[ 1 ] += normals[ i ][ 1 ];\r\n\t\t\t\t\tnormal[ 2 ] += normals[ i ][ 2 ];\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tnormal[ 0 ] /= normals.length;\r\n\t\t\t\tnormal[ 1 ] /= normals.length;\r\n\t\t\t\tnormal[ 2 ] /= normals.length;\r\n\r\n\t\t\t\tvar idx = ( y * width + x ) * 4;\r\n\r\n\t\t\t\toutput[ idx ] = ( ( normal[ 0 ] + 1.0 ) / 2.0 * 255 ) | 0;\r\n\t\t\t\toutput[ idx + 1 ] = ( ( normal[ 1 ] + 1.0 ) / 2.0 * 255 ) | 0;\r\n\t\t\t\toutput[ idx + 2 ] = ( normal[ 2 ] * 255 ) | 0;\r\n\t\t\t\toutput[ idx + 3 ] = 255;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tcontext.putImageData( imageData, 0, 0 );\r\n\r\n\t\treturn canvas;\r\n\r\n\t},\r\n\r\n\tgenerateDataTexture: function ( width, height, color ) {\r\n\r\n\t\tvar size = width * height;\r\n\t\tvar data = new Uint8Array( 3 * size );\r\n\r\n\t\tvar r = Math.floor( color.r * 255 );\r\n\t\tvar g = Math.floor( color.g * 255 );\r\n\t\tvar b = Math.floor( color.b * 255 );\r\n\r\n\t\tfor ( var i = 0; i < size; i ++ ) {\r\n\r\n\t\t\tdata[ i * 3 ] \t   = r;\r\n\t\t\tdata[ i * 3 + 1 ] = g;\r\n\t\t\tdata[ i * 3 + 2 ] = b;\r\n\r\n\t\t}\r\n\r\n\t\tvar texture = new THREE.DataTexture( data, width, height, THREE.RGBFormat );\r\n\t\ttexture.needsUpdate = true;\r\n\r\n\t\treturn texture;\r\n\r\n\t}\r\n\r\n};\r\n\r\n// File:src/extras/SceneUtils.js\r\n\r\n/**\r\n * @author alteredq / http://alteredqualia.com/\r\n */\r\n\r\nTHREE.SceneUtils = {\r\n\r\n\tcreateMultiMaterialObject: function ( geometry, materials ) {\r\n\r\n\t\tvar group = new THREE.Object3D();\r\n\r\n\t\tfor ( var i = 0, l = materials.length; i < l; i ++ ) {\r\n\r\n\t\t\tgroup.add( new THREE.Mesh( geometry, materials[ i ] ) );\r\n\r\n\t\t}\r\n\r\n\t\treturn group;\r\n\r\n\t},\r\n\r\n\tdetach: function ( child, parent, scene ) {\r\n\r\n\t\tchild.applyMatrix( parent.matrixWorld );\r\n\t\tparent.remove( child );\r\n\t\tscene.add( child );\r\n\r\n\t},\r\n\r\n\tattach: function ( child, scene, parent ) {\r\n\r\n\t\tvar matrixWorldInverse = new THREE.Matrix4();\r\n\t\tmatrixWorldInverse.getInverse( parent.matrixWorld );\r\n\t\tchild.applyMatrix( matrixWorldInverse );\r\n\r\n\t\tscene.remove( child );\r\n\t\tparent.add( child );\r\n\r\n\t}\r\n\r\n};\r\n\r\n// File:src/extras/FontUtils.js\r\n\r\n/**\r\n * @author zz85 / http://www.lab4games.net/zz85/blog\r\n * @author alteredq / http://alteredqualia.com/\r\n *\r\n * For Text operations in three.js (See TextGeometry)\r\n *\r\n * It uses techniques used in:\r\n *\r\n * \ttypeface.js and canvastext\r\n * \t\tFor converting fonts and rendering with javascript\r\n *\t\thttp://typeface.neocracy.org\r\n *\r\n *\tTriangulation ported from AS3\r\n *\t\tSimple Polygon Triangulation\r\n *\t\thttp://actionsnippet.com/?p=1462\r\n *\r\n * \tA Method to triangulate shapes with holes\r\n *\t\thttp://www.sakri.net/blog/2009/06/12/an-approach-to-triangulating-polygons-with-holes/\r\n *\r\n */\r\n\r\nTHREE.FontUtils = {\r\n\r\n\tfaces: {},\r\n\r\n\t// Just for now. face[weight][style]\r\n\r\n\tface: 'helvetiker',\r\n\tweight: 'normal',\r\n\tstyle: 'normal',\r\n\tsize: 150,\r\n\tdivisions: 10,\r\n\r\n\tgetFace: function () {\r\n\r\n\t\ttry {\r\n\r\n\t\t\treturn this.faces[ this.face ][ this.weight ][ this.style ];\r\n\r\n\t\t} catch (e) {\r\n\r\n\t\t\tthrow \"The font \" + this.face + \" with \" + this.weight + \" weight and \" + this.style + \" style is missing.\"\r\n\r\n\t\t};\r\n\r\n\t},\r\n\r\n\tloadFace: function ( data ) {\r\n\r\n\t\tvar family = data.familyName.toLowerCase();\r\n\r\n\t\tvar ThreeFont = this;\r\n\r\n\t\tThreeFont.faces[ family ] = ThreeFont.faces[ family ] || {};\r\n\r\n\t\tThreeFont.faces[ family ][ data.cssFontWeight ] = ThreeFont.faces[ family ][ data.cssFontWeight ] || {};\r\n\t\tThreeFont.faces[ family ][ data.cssFontWeight ][ data.cssFontStyle ] = data;\r\n\r\n\t\tThreeFont.faces[ family ][ data.cssFontWeight ][ data.cssFontStyle ] = data;\r\n\r\n\t\treturn data;\r\n\r\n\t},\r\n\r\n\tdrawText: function ( text ) {\r\n\r\n\t\t// RenderText\r\n\r\n\t\tvar i,\r\n\t\t\tface = this.getFace(),\r\n\t\t\tscale = this.size / face.resolution,\r\n\t\t\toffset = 0,\r\n\t\t\tchars = String( text ).split( '' ),\r\n\t\t\tlength = chars.length;\r\n\r\n\t\tvar fontPaths = [];\r\n\r\n\t\tfor ( i = 0; i < length; i ++ ) {\r\n\r\n\t\t\tvar path = new THREE.Path();\r\n\r\n\t\t\tvar ret = this.extractGlyphPoints( chars[ i ], face, scale, offset, path );\r\n\t\t\toffset += ret.offset;\r\n\r\n\t\t\tfontPaths.push( ret.path );\r\n\r\n\t\t}\r\n\r\n\t\t// get the width\r\n\r\n\t\tvar width = offset / 2;\r\n\t\t//\r\n\t\t// for ( p = 0; p < allPts.length; p++ ) {\r\n\t\t//\r\n\t\t// \tallPts[ p ].x -= width;\r\n\t\t//\r\n\t\t// }\r\n\r\n\t\t//var extract = this.extractPoints( allPts, characterPts );\r\n\t\t//extract.contour = allPts;\r\n\r\n\t\t//extract.paths = fontPaths;\r\n\t\t//extract.offset = width;\r\n\r\n\t\treturn { paths: fontPaths, offset: width };\r\n\r\n\t},\r\n\r\n\r\n\r\n\r\n\textractGlyphPoints: function ( c, face, scale, offset, path ) {\r\n\r\n\t\tvar pts = [];\r\n\r\n\t\tvar i, i2, divisions,\r\n\t\t\toutline, action, length,\r\n\t\t\tscaleX, scaleY,\r\n\t\t\tx, y, cpx, cpy, cpx0, cpy0, cpx1, cpy1, cpx2, cpy2,\r\n\t\t\tlaste,\r\n\t\t\tglyph = face.glyphs[ c ] || face.glyphs[ '?' ];\r\n\r\n\t\tif ( ! glyph ) return;\r\n\r\n\t\tif ( glyph.o ) {\r\n\r\n\t\t\toutline = glyph._cachedOutline || ( glyph._cachedOutline = glyph.o.split( ' ' ) );\r\n\t\t\tlength = outline.length;\r\n\r\n\t\t\tscaleX = scale;\r\n\t\t\tscaleY = scale;\r\n\r\n\t\t\tfor ( i = 0; i < length; ) {\r\n\r\n\t\t\t\taction = outline[ i ++ ];\r\n\r\n\t\t\t\t//console.log( action );\r\n\r\n\t\t\t\tswitch ( action ) {\r\n\r\n\t\t\t\tcase 'm':\r\n\r\n\t\t\t\t\t// Move To\r\n\r\n\t\t\t\t\tx = outline[ i ++ ] * scaleX + offset;\r\n\t\t\t\t\ty = outline[ i ++ ] * scaleY;\r\n\r\n\t\t\t\t\tpath.moveTo( x, y );\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'l':\r\n\r\n\t\t\t\t\t// Line To\r\n\r\n\t\t\t\t\tx = outline[ i ++ ] * scaleX + offset;\r\n\t\t\t\t\ty = outline[ i ++ ] * scaleY;\r\n\t\t\t\t\tpath.lineTo( x, y );\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'q':\r\n\r\n\t\t\t\t\t// QuadraticCurveTo\r\n\r\n\t\t\t\t\tcpx  = outline[ i ++ ] * scaleX + offset;\r\n\t\t\t\t\tcpy  = outline[ i ++ ] * scaleY;\r\n\t\t\t\t\tcpx1 = outline[ i ++ ] * scaleX + offset;\r\n\t\t\t\t\tcpy1 = outline[ i ++ ] * scaleY;\r\n\r\n\t\t\t\t\tpath.quadraticCurveTo( cpx1, cpy1, cpx, cpy );\r\n\r\n\t\t\t\t\tlaste = pts[ pts.length - 1 ];\r\n\r\n\t\t\t\t\tif ( laste ) {\r\n\r\n\t\t\t\t\t\tcpx0 = laste.x;\r\n\t\t\t\t\t\tcpy0 = laste.y;\r\n\r\n\t\t\t\t\t\tfor ( i2 = 1, divisions = this.divisions; i2 <= divisions; i2 ++ ) {\r\n\r\n\t\t\t\t\t\t\tvar t = i2 / divisions;\r\n\t\t\t\t\t\t\tTHREE.Shape.Utils.b2( t, cpx0, cpx1, cpx );\r\n\t\t\t\t\t\t\tTHREE.Shape.Utils.b2( t, cpy0, cpy1, cpy );\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'b':\r\n\r\n\t\t\t\t\t// Cubic Bezier Curve\r\n\r\n\t\t\t\t\tcpx  = outline[ i ++ ] *  scaleX + offset;\r\n\t\t\t\t\tcpy  = outline[ i ++ ] *  scaleY;\r\n\t\t\t\t\tcpx1 = outline[ i ++ ] *  scaleX + offset;\r\n\t\t\t\t\tcpy1 = outline[ i ++ ] *  scaleY;\r\n\t\t\t\t\tcpx2 = outline[ i ++ ] *  scaleX + offset;\r\n\t\t\t\t\tcpy2 = outline[ i ++ ] *  scaleY;\r\n\r\n\t\t\t\t\tpath.bezierCurveTo( cpx1, cpy1, cpx2, cpy2, cpx, cpy );\r\n\r\n\t\t\t\t\tlaste = pts[ pts.length - 1 ];\r\n\r\n\t\t\t\t\tif ( laste ) {\r\n\r\n\t\t\t\t\t\tcpx0 = laste.x;\r\n\t\t\t\t\t\tcpy0 = laste.y;\r\n\r\n\t\t\t\t\t\tfor ( i2 = 1, divisions = this.divisions; i2 <= divisions; i2 ++ ) {\r\n\r\n\t\t\t\t\t\t\tvar t = i2 / divisions;\r\n\t\t\t\t\t\t\tTHREE.Shape.Utils.b3( t, cpx0, cpx1, cpx2, cpx );\r\n\t\t\t\t\t\t\tTHREE.Shape.Utils.b3( t, cpy0, cpy1, cpy2, cpy );\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\t\t}\r\n\r\n\r\n\r\n\t\treturn { offset: glyph.ha * scale, path:path };\r\n\t}\r\n\r\n};\r\n\r\n\r\nTHREE.FontUtils.generateShapes = function ( text, parameters ) {\r\n\r\n\t// Parameters \r\n\r\n\tparameters = parameters || {};\r\n\r\n\tvar size = parameters.size !== undefined ? parameters.size : 100;\r\n\tvar curveSegments = parameters.curveSegments !== undefined ? parameters.curveSegments : 4;\r\n\r\n\tvar font = parameters.font !== undefined ? parameters.font : 'helvetiker';\r\n\tvar weight = parameters.weight !== undefined ? parameters.weight : 'normal';\r\n\tvar style = parameters.style !== undefined ? parameters.style : 'normal';\r\n\r\n\tTHREE.FontUtils.size = size;\r\n\tTHREE.FontUtils.divisions = curveSegments;\r\n\r\n\tTHREE.FontUtils.face = font;\r\n\tTHREE.FontUtils.weight = weight;\r\n\tTHREE.FontUtils.style = style;\r\n\r\n\t// Get a Font data json object\r\n\r\n\tvar data = THREE.FontUtils.drawText( text );\r\n\r\n\tvar paths = data.paths;\r\n\tvar shapes = [];\r\n\r\n\tfor ( var p = 0, pl = paths.length; p < pl; p ++ ) {\r\n\r\n\t\tArray.prototype.push.apply( shapes, paths[ p ].toShapes() );\r\n\r\n\t}\r\n\r\n\treturn shapes;\r\n\r\n};\r\n\r\n\r\n/**\r\n * This code is a quick port of code written in C++ which was submitted to\r\n * flipcode.com by John W. Ratcliff  // July 22, 2000\r\n * See original code and more information here:\r\n * http://www.flipcode.com/archives/Efficient_Polygon_Triangulation.shtml\r\n *\r\n * ported to actionscript by Zevan Rosser\r\n * www.actionsnippet.com\r\n *\r\n * ported to javascript by Joshua Koo\r\n * http://www.lab4games.net/zz85/blog\r\n *\r\n */\r\n\r\n\r\n( function ( namespace ) {\r\n\r\n\tvar EPSILON = 0.0000000001;\r\n\r\n\t// takes in an contour array and returns\r\n\r\n\tvar process = function ( contour, indices ) {\r\n\r\n\t\tvar n = contour.length;\r\n\r\n\t\tif ( n < 3 ) return null;\r\n\r\n\t\tvar result = [],\r\n\t\t\tverts = [],\r\n\t\t\tvertIndices = [];\r\n\r\n\t\t/* we want a counter-clockwise polygon in verts */\r\n\r\n\t\tvar u, v, w;\r\n\r\n\t\tif ( area( contour ) > 0.0 ) {\r\n\r\n\t\t\tfor ( v = 0; v < n; v ++ ) verts[ v ] = v;\r\n\r\n\t\t} else {\r\n\r\n\t\t\tfor ( v = 0; v < n; v ++ ) verts[ v ] = ( n - 1 ) - v;\r\n\r\n\t\t}\r\n\r\n\t\tvar nv = n;\r\n\r\n\t\t/*  remove nv - 2 vertices, creating 1 triangle every time */\r\n\r\n\t\tvar count = 2 * nv;   /* error detection */\r\n\r\n\t\tfor ( v = nv - 1; nv > 2; ) {\r\n\r\n\t\t\t/* if we loop, it is probably a non-simple polygon */\r\n\r\n\t\t\tif ( ( count -- ) <= 0 ) {\r\n\r\n\t\t\t\t//** Triangulate: ERROR - probable bad polygon!\r\n\r\n\t\t\t\t//throw ( \"Warning, unable to triangulate polygon!\" );\r\n\t\t\t\t//return null;\r\n\t\t\t\t// Sometimes warning is fine, especially polygons are triangulated in reverse.\r\n\t\t\t\tTHREE.warn( 'THREE.FontUtils: Warning, unable to triangulate polygon! in Triangulate.process()' );\r\n\r\n\t\t\t\tif ( indices ) return vertIndices;\r\n\t\t\t\treturn result;\r\n\r\n\t\t\t}\r\n\r\n\t\t\t/* three consecutive vertices in current polygon, <u,v,w> */\r\n\r\n\t\t\tu = v; \t \tif ( nv <= u ) u = 0;     /* previous */\r\n\t\t\tv = u + 1;  if ( nv <= v ) v = 0;     /* new v    */\r\n\t\t\tw = v + 1;  if ( nv <= w ) w = 0;     /* next     */\r\n\r\n\t\t\tif ( snip( contour, u, v, w, nv, verts ) ) {\r\n\r\n\t\t\t\tvar a, b, c, s, t;\r\n\r\n\t\t\t\t/* true names of the vertices */\r\n\r\n\t\t\t\ta = verts[ u ];\r\n\t\t\t\tb = verts[ v ];\r\n\t\t\t\tc = verts[ w ];\r\n\r\n\t\t\t\t/* output Triangle */\r\n\r\n\t\t\t\tresult.push( [ contour[ a ],\r\n\t\t\t\t\tcontour[ b ],\r\n\t\t\t\t\tcontour[ c ] ] );\r\n\r\n\r\n\t\t\t\tvertIndices.push( [ verts[ u ], verts[ v ], verts[ w ] ] );\r\n\r\n\t\t\t\t/* remove v from the remaining polygon */\r\n\r\n\t\t\t\tfor ( s = v, t = v + 1; t < nv; s ++, t ++ ) {\r\n\r\n\t\t\t\t\tverts[ s ] = verts[ t ];\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tnv --;\r\n\r\n\t\t\t\t/* reset error detection counter */\r\n\r\n\t\t\t\tcount = 2 * nv;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tif ( indices ) return vertIndices;\r\n\t\treturn result;\r\n\r\n\t};\r\n\r\n\t// calculate area of the contour polygon\r\n\r\n\tvar area = function ( contour ) {\r\n\r\n\t\tvar n = contour.length;\r\n\t\tvar a = 0.0;\r\n\r\n\t\tfor ( var p = n - 1, q = 0; q < n; p = q ++ ) {\r\n\r\n\t\t\ta += contour[ p ].x * contour[ q ].y - contour[ q ].x * contour[ p ].y;\r\n\r\n\t\t}\r\n\r\n\t\treturn a * 0.5;\r\n\r\n\t};\r\n\r\n\tvar snip = function ( contour, u, v, w, n, verts ) {\r\n\r\n\t\tvar p;\r\n\t\tvar ax, ay, bx, by;\r\n\t\tvar cx, cy, px, py;\r\n\r\n\t\tax = contour[ verts[ u ] ].x;\r\n\t\tay = contour[ verts[ u ] ].y;\r\n\r\n\t\tbx = contour[ verts[ v ] ].x;\r\n\t\tby = contour[ verts[ v ] ].y;\r\n\r\n\t\tcx = contour[ verts[ w ] ].x;\r\n\t\tcy = contour[ verts[ w ] ].y;\r\n\r\n\t\tif ( EPSILON > ( ( ( bx - ax ) * ( cy - ay ) ) - ( ( by - ay ) * ( cx - ax ) ) ) ) return false;\r\n\r\n\t\tvar aX, aY, bX, bY, cX, cY;\r\n\t\tvar apx, apy, bpx, bpy, cpx, cpy;\r\n\t\tvar cCROSSap, bCROSScp, aCROSSbp;\r\n\r\n\t\taX = cx - bx;  aY = cy - by;\r\n\t\tbX = ax - cx;  bY = ay - cy;\r\n\t\tcX = bx - ax;  cY = by - ay;\r\n\r\n\t\tfor ( p = 0; p < n; p ++ ) {\r\n\r\n\t\t\tpx = contour[ verts[ p ] ].x\r\n\t\t\tpy = contour[ verts[ p ] ].y\r\n\r\n\t\t\tif ( ( ( px === ax ) && ( py === ay ) ) ||\r\n\t\t\t\t ( ( px === bx ) && ( py === by ) ) ||\r\n\t\t\t\t ( ( px === cx ) && ( py === cy ) ) )\tcontinue;\r\n\r\n\t\t\tapx = px - ax;  apy = py - ay;\r\n\t\t\tbpx = px - bx;  bpy = py - by;\r\n\t\t\tcpx = px - cx;  cpy = py - cy;\r\n\r\n\t\t\t// see if p is inside triangle abc\r\n\r\n\t\t\taCROSSbp = aX * bpy - aY * bpx;\r\n\t\t\tcCROSSap = cX * apy - cY * apx;\r\n\t\t\tbCROSScp = bX * cpy - bY * cpx;\r\n\r\n\t\t\tif ( ( aCROSSbp >= - EPSILON ) && ( bCROSScp >= - EPSILON ) && ( cCROSSap >= - EPSILON ) ) return false;\r\n\r\n\t\t}\r\n\r\n\t\treturn true;\r\n\r\n\t};\r\n\r\n\r\n\tnamespace.Triangulate = process;\r\n\tnamespace.Triangulate.area = area;\r\n\r\n\treturn namespace;\r\n\r\n} )( THREE.FontUtils );\r\n\r\n// To use the typeface.js face files, hook up the API\r\nself._typeface_js = { faces: THREE.FontUtils.faces, loadFace: THREE.FontUtils.loadFace };\r\nTHREE.typeface_js = self._typeface_js;\r\n\r\n// File:src/extras/audio/Audio.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.Audio = function ( listener ) {\r\n\r\n\tTHREE.Object3D.call( this );\r\n\r\n\tthis.type = 'Audio';\r\n\r\n\tthis.context = listener.context;\r\n\tthis.source = this.context.createBufferSource();\r\n\tthis.source.onended = this.onEnded.bind(this);\r\n\r\n\tthis.gain = this.context.createGain();\r\n\tthis.gain.connect( this.context.destination );\r\n\r\n\tthis.panner = this.context.createPanner();\r\n\tthis.panner.connect( this.gain );\r\n\r\n\tthis.autoplay = false;\r\n\r\n\tthis.startTime = 0;\r\n\tthis.isPlaying = false;\r\n\r\n};\r\n\r\nTHREE.Audio.prototype = Object.create( THREE.Object3D.prototype );\r\nTHREE.Audio.prototype.constructor = THREE.Audio;\r\n\r\nTHREE.Audio.prototype.load = function ( file ) {\r\n\r\n\tvar scope = this;\r\n\r\n\tvar request = new XMLHttpRequest();\r\n\trequest.open( 'GET', file, true );\r\n\trequest.responseType = 'arraybuffer';\r\n\trequest.onload = function ( e ) {\r\n\r\n\t\tscope.context.decodeAudioData( this.response, function ( buffer ) {\r\n\r\n\t\t\tscope.source.buffer = buffer;\r\n\r\n\t\t\tif( scope.autoplay ) scope.play();\r\n\r\n\t\t} );\r\n\r\n\t};\r\n\trequest.send();\r\n\r\n\treturn this;\r\n\r\n};\r\n\r\nTHREE.Audio.prototype.play = function () {\r\n\r\n\tif ( this.isPlaying === true ) {\r\n\r\n\t\tTHREE.warn( 'THREE.Audio: Audio is already playing.' );\r\n\t\treturn;\r\n\r\n\t}\r\n\r\n\tvar source = this.context.createBufferSource();\r\n\r\n\tsource.buffer = this.source.buffer;\r\n\tsource.loop = this.source.loop;\r\n\tsource.onended = this.source.onended;\r\n\tsource.connect( this.panner );\r\n\tsource.start( 0, this.startTime );\r\n\r\n\tthis.isPlaying = true;\r\n\r\n\tthis.source = source;\r\n\r\n};\r\n\r\nTHREE.Audio.prototype.pause = function () {\r\n\r\n\tthis.source.stop();\r\n\tthis.startTime = this.context.currentTime;\r\n\r\n};\r\n\r\nTHREE.Audio.prototype.stop = function () {\r\n\r\n\tthis.source.stop();\r\n\tthis.startTime = 0;\r\n\r\n};\r\n\r\nTHREE.Audio.prototype.onEnded = function() {\r\n\r\n\tthis.isPlaying = false;\r\n\r\n};\r\n\r\nTHREE.Audio.prototype.setLoop = function ( value ) {\r\n\r\n\tthis.source.loop = value;\r\n\r\n};\r\n\r\nTHREE.Audio.prototype.setRefDistance = function ( value ) {\r\n\r\n\tthis.panner.refDistance = value;\r\n\r\n};\r\n\r\nTHREE.Audio.prototype.setRolloffFactor = function ( value ) {\r\n\r\n\tthis.panner.rolloffFactor = value;\r\n\r\n};\r\n\r\nTHREE.Audio.prototype.setVolume = function ( value ) {\r\n\r\n\tthis.gain.gain.value = value;\r\n\r\n};\r\n\r\nTHREE.Audio.prototype.updateMatrixWorld = ( function () {\r\n\r\n\tvar position = new THREE.Vector3();\r\n\r\n\treturn function ( force ) {\r\n\r\n\t\tTHREE.Object3D.prototype.updateMatrixWorld.call( this, force );\r\n\r\n\t\tposition.setFromMatrixPosition( this.matrixWorld );\r\n\r\n\t\tthis.panner.setPosition( position.x, position.y, position.z );\r\n\r\n\t};\r\n\r\n} )();\r\n\r\n// File:src/extras/audio/AudioListener.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.AudioListener = function () {\r\n\r\n\tTHREE.Object3D.call( this );\r\n\r\n\tthis.type = 'AudioListener';\r\n\r\n\tthis.context = new ( window.AudioContext || window.webkitAudioContext )();\r\n\r\n};\r\n\r\nTHREE.AudioListener.prototype = Object.create( THREE.Object3D.prototype );\r\nTHREE.AudioListener.prototype.constructor = THREE.AudioListener;\r\n\r\nTHREE.AudioListener.prototype.updateMatrixWorld = ( function () {\r\n\r\n\tvar position = new THREE.Vector3();\r\n\tvar quaternion = new THREE.Quaternion();\r\n\tvar scale = new THREE.Vector3();\r\n\r\n\tvar orientation = new THREE.Vector3();\r\n\tvar velocity = new THREE.Vector3();\r\n\r\n\tvar positionPrev = new THREE.Vector3();\r\n\r\n\treturn function ( force ) {\r\n\r\n\t\tTHREE.Object3D.prototype.updateMatrixWorld.call( this, force );\r\n\r\n\t\tvar listener = this.context.listener;\r\n\t\tvar up = this.up;\r\n\r\n\t\tthis.matrixWorld.decompose( position, quaternion, scale );\r\n\r\n\t\torientation.set( 0, 0, -1 ).applyQuaternion( quaternion );\r\n\t\tvelocity.subVectors( position, positionPrev );\r\n\r\n\t\tlistener.setPosition( position.x, position.y, position.z );\r\n\t\tlistener.setOrientation( orientation.x, orientation.y, orientation.z, up.x, up.y, up.z );\r\n\t\tlistener.setVelocity( velocity.x, velocity.y, velocity.z );\r\n\r\n\t\tpositionPrev.copy( position );\r\n\r\n\t};\r\n\r\n} )();\r\n\r\n// File:src/extras/core/Curve.js\r\n\r\n/**\r\n * @author zz85 / http://www.lab4games.net/zz85/blog\r\n * Extensible curve object\r\n *\r\n * Some common of Curve methods\r\n * .getPoint(t), getTangent(t)\r\n * .getPointAt(u), getTagentAt(u)\r\n * .getPoints(), .getSpacedPoints()\r\n * .getLength()\r\n * .updateArcLengths()\r\n *\r\n * This following classes subclasses THREE.Curve:\r\n *\r\n * -- 2d classes --\r\n * THREE.LineCurve\r\n * THREE.QuadraticBezierCurve\r\n * THREE.CubicBezierCurve\r\n * THREE.SplineCurve\r\n * THREE.ArcCurve\r\n * THREE.EllipseCurve\r\n *\r\n * -- 3d classes --\r\n * THREE.LineCurve3\r\n * THREE.QuadraticBezierCurve3\r\n * THREE.CubicBezierCurve3\r\n * THREE.SplineCurve3\r\n * THREE.ClosedSplineCurve3\r\n *\r\n * A series of curves can be represented as a THREE.CurvePath\r\n *\r\n **/\r\n\r\n/**************************************************************\r\n *\tAbstract Curve base class\r\n **************************************************************/\r\n\r\nTHREE.Curve = function () {\r\n\r\n};\r\n\r\n// Virtual base class method to overwrite and implement in subclasses\r\n//\t- t [0 .. 1]\r\n\r\nTHREE.Curve.prototype.getPoint = function ( t ) {\r\n\r\n\tTHREE.warn( \"THREE.Curve: Warning, getPoint() not implemented!\" );\r\n\treturn null;\r\n\r\n};\r\n\r\n// Get point at relative position in curve according to arc length\r\n// - u [0 .. 1]\r\n\r\nTHREE.Curve.prototype.getPointAt = function ( u ) {\r\n\r\n\tvar t = this.getUtoTmapping( u );\r\n\treturn this.getPoint( t );\r\n\r\n};\r\n\r\n// Get sequence of points using getPoint( t )\r\n\r\nTHREE.Curve.prototype.getPoints = function ( divisions ) {\r\n\r\n\tif ( ! divisions ) divisions = 5;\r\n\r\n\tvar d, pts = [];\r\n\r\n\tfor ( d = 0; d <= divisions; d ++ ) {\r\n\r\n\t\tpts.push( this.getPoint( d / divisions ) );\r\n\r\n\t}\r\n\r\n\treturn pts;\r\n\r\n};\r\n\r\n// Get sequence of points using getPointAt( u )\r\n\r\nTHREE.Curve.prototype.getSpacedPoints = function ( divisions ) {\r\n\r\n\tif ( ! divisions ) divisions = 5;\r\n\r\n\tvar d, pts = [];\r\n\r\n\tfor ( d = 0; d <= divisions; d ++ ) {\r\n\r\n\t\tpts.push( this.getPointAt( d / divisions ) );\r\n\r\n\t}\r\n\r\n\treturn pts;\r\n\r\n};\r\n\r\n// Get total curve arc length\r\n\r\nTHREE.Curve.prototype.getLength = function () {\r\n\r\n\tvar lengths = this.getLengths();\r\n\treturn lengths[ lengths.length - 1 ];\r\n\r\n};\r\n\r\n// Get list of cumulative segment lengths\r\n\r\nTHREE.Curve.prototype.getLengths = function ( divisions ) {\r\n\r\n\tif ( ! divisions ) divisions = (this.__arcLengthDivisions) ? (this.__arcLengthDivisions) : 200;\r\n\r\n\tif ( this.cacheArcLengths\r\n\t\t&& ( this.cacheArcLengths.length == divisions + 1 )\r\n\t\t&& ! this.needsUpdate) {\r\n\r\n\t\t//console.log( \"cached\", this.cacheArcLengths );\r\n\t\treturn this.cacheArcLengths;\r\n\r\n\t}\r\n\r\n\tthis.needsUpdate = false;\r\n\r\n\tvar cache = [];\r\n\tvar current, last = this.getPoint( 0 );\r\n\tvar p, sum = 0;\r\n\r\n\tcache.push( 0 );\r\n\r\n\tfor ( p = 1; p <= divisions; p ++ ) {\r\n\r\n\t\tcurrent = this.getPoint ( p / divisions );\r\n\t\tsum += current.distanceTo( last );\r\n\t\tcache.push( sum );\r\n\t\tlast = current;\r\n\r\n\t}\r\n\r\n\tthis.cacheArcLengths = cache;\r\n\r\n\treturn cache; // { sums: cache, sum:sum }; Sum is in the last element.\r\n\r\n};\r\n\r\n\r\nTHREE.Curve.prototype.updateArcLengths = function() {\r\n\tthis.needsUpdate = true;\r\n\tthis.getLengths();\r\n};\r\n\r\n// Given u ( 0 .. 1 ), get a t to find p. This gives you points which are equi distance\r\n\r\nTHREE.Curve.prototype.getUtoTmapping = function ( u, distance ) {\r\n\r\n\tvar arcLengths = this.getLengths();\r\n\r\n\tvar i = 0, il = arcLengths.length;\r\n\r\n\tvar targetArcLength; // The targeted u distance value to get\r\n\r\n\tif ( distance ) {\r\n\r\n\t\ttargetArcLength = distance;\r\n\r\n\t} else {\r\n\r\n\t\ttargetArcLength = u * arcLengths[ il - 1 ];\r\n\r\n\t}\r\n\r\n\t//var time = Date.now();\r\n\r\n\t// binary search for the index with largest value smaller than target u distance\r\n\r\n\tvar low = 0, high = il - 1, comparison;\r\n\r\n\twhile ( low <= high ) {\r\n\r\n\t\ti = Math.floor( low + ( high - low ) / 2 ); // less likely to overflow, though probably not issue here, JS doesn't really have integers, all numbers are floats\r\n\r\n\t\tcomparison = arcLengths[ i ] - targetArcLength;\r\n\r\n\t\tif ( comparison < 0 ) {\r\n\r\n\t\t\tlow = i + 1;\r\n\r\n\t\t} else if ( comparison > 0 ) {\r\n\r\n\t\t\thigh = i - 1;\r\n\r\n\t\t} else {\r\n\r\n\t\t\thigh = i;\r\n\t\t\tbreak;\r\n\r\n\t\t\t// DONE\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\ti = high;\r\n\r\n\t//console.log('b' , i, low, high, Date.now()- time);\r\n\r\n\tif ( arcLengths[ i ] == targetArcLength ) {\r\n\r\n\t\tvar t = i / ( il - 1 );\r\n\t\treturn t;\r\n\r\n\t}\r\n\r\n\t// we could get finer grain at lengths, or use simple interpolatation between two points\r\n\r\n\tvar lengthBefore = arcLengths[ i ];\r\n\tvar lengthAfter = arcLengths[ i + 1 ];\r\n\r\n\tvar segmentLength = lengthAfter - lengthBefore;\r\n\r\n    // determine where we are between the 'before' and 'after' points\r\n\r\n\tvar segmentFraction = ( targetArcLength - lengthBefore ) / segmentLength;\r\n\r\n    // add that fractional amount to t\r\n\r\n\tvar t = ( i + segmentFraction ) / ( il - 1 );\r\n\r\n\treturn t;\r\n\r\n};\r\n\r\n// Returns a unit vector tangent at t\r\n// In case any sub curve does not implement its tangent derivation,\r\n// 2 points a small delta apart will be used to find its gradient\r\n// which seems to give a reasonable approximation\r\n\r\nTHREE.Curve.prototype.getTangent = function( t ) {\r\n\r\n\tvar delta = 0.0001;\r\n\tvar t1 = t - delta;\r\n\tvar t2 = t + delta;\r\n\r\n\t// Capping in case of danger\r\n\r\n\tif ( t1 < 0 ) t1 = 0;\r\n\tif ( t2 > 1 ) t2 = 1;\r\n\r\n\tvar pt1 = this.getPoint( t1 );\r\n\tvar pt2 = this.getPoint( t2 );\r\n\r\n\tvar vec = pt2.clone().sub(pt1);\r\n\treturn vec.normalize();\r\n\r\n};\r\n\r\n\r\nTHREE.Curve.prototype.getTangentAt = function ( u ) {\r\n\r\n\tvar t = this.getUtoTmapping( u );\r\n\treturn this.getTangent( t );\r\n\r\n};\r\n\r\n\r\n\r\n\r\n\r\n/**************************************************************\r\n *\tUtils\r\n **************************************************************/\r\n\r\nTHREE.Curve.Utils = {\r\n\r\n\ttangentQuadraticBezier: function ( t, p0, p1, p2 ) {\r\n\r\n\t\treturn 2 * ( 1 - t ) * ( p1 - p0 ) + 2 * t * ( p2 - p1 );\r\n\r\n\t},\r\n\r\n\t// Puay Bing, thanks for helping with this derivative!\r\n\r\n\ttangentCubicBezier: function (t, p0, p1, p2, p3 ) {\r\n\r\n\t\treturn - 3 * p0 * (1 - t) * (1 - t)  +\r\n\t\t\t3 * p1 * (1 - t) * (1 - t) - 6 * t * p1 * (1 - t) +\r\n\t\t\t6 * t *  p2 * (1 - t) - 3 * t * t * p2 +\r\n\t\t\t3 * t * t * p3;\r\n\r\n\t},\r\n\r\n\ttangentSpline: function ( t, p0, p1, p2, p3 ) {\r\n\r\n\t\t// To check if my formulas are correct\r\n\r\n\t\tvar h00 = 6 * t * t - 6 * t; \t// derived from 2t^3 − 3t^2 + 1\r\n\t\tvar h10 = 3 * t * t - 4 * t + 1; // t^3 − 2t^2 + t\r\n\t\tvar h01 = - 6 * t * t + 6 * t; \t// − 2t3 + 3t2\r\n\t\tvar h11 = 3 * t * t - 2 * t;\t// t3 − t2\r\n\r\n\t\treturn h00 + h10 + h01 + h11;\r\n\r\n\t},\r\n\r\n\t// Catmull-Rom\r\n\r\n\tinterpolate: function( p0, p1, p2, p3, t ) {\r\n\r\n\t\tvar v0 = ( p2 - p0 ) * 0.5;\r\n\t\tvar v1 = ( p3 - p1 ) * 0.5;\r\n\t\tvar t2 = t * t;\r\n\t\tvar t3 = t * t2;\r\n\t\treturn ( 2 * p1 - 2 * p2 + v0 + v1 ) * t3 + ( - 3 * p1 + 3 * p2 - 2 * v0 - v1 ) * t2 + v0 * t + p1;\r\n\r\n\t}\r\n\r\n};\r\n\r\n\r\n// TODO: Transformation for Curves?\r\n\r\n/**************************************************************\r\n *\t3D Curves\r\n **************************************************************/\r\n\r\n// A Factory method for creating new curve subclasses\r\n\r\nTHREE.Curve.create = function ( constructor, getPointFunc ) {\r\n\r\n\tconstructor.prototype = Object.create( THREE.Curve.prototype );\r\n\tconstructor.prototype.constructor = constructor;\r\n\tconstructor.prototype.getPoint = getPointFunc;\r\n\r\n\treturn constructor;\r\n\r\n};\r\n\r\n// File:src/extras/core/CurvePath.js\r\n\r\n/**\r\n * @author zz85 / http://www.lab4games.net/zz85/blog\r\n *\r\n **/\r\n\r\n/**************************************************************\r\n *\tCurved Path - a curve path is simply a array of connected\r\n *  curves, but retains the api of a curve\r\n **************************************************************/\r\n\r\nTHREE.CurvePath = function () {\r\n\r\n\tthis.curves = [];\r\n\tthis.bends = [];\r\n\t\r\n\tthis.autoClose = false; // Automatically closes the path\r\n};\r\n\r\nTHREE.CurvePath.prototype = Object.create( THREE.Curve.prototype );\r\nTHREE.CurvePath.prototype.constructor = THREE.CurvePath;\r\n\r\nTHREE.CurvePath.prototype.add = function ( curve ) {\r\n\r\n\tthis.curves.push( curve );\r\n\r\n};\r\n\r\nTHREE.CurvePath.prototype.checkConnection = function() {\r\n\t// TODO\r\n\t// If the ending of curve is not connected to the starting\r\n\t// or the next curve, then, this is not a real path\r\n};\r\n\r\nTHREE.CurvePath.prototype.closePath = function() {\r\n\t// TODO Test\r\n\t// and verify for vector3 (needs to implement equals)\r\n\t// Add a line curve if start and end of lines are not connected\r\n\tvar startPoint = this.curves[0].getPoint(0);\r\n\tvar endPoint = this.curves[this.curves.length - 1].getPoint(1);\r\n\t\r\n\tif (! startPoint.equals(endPoint)) {\r\n\t\tthis.curves.push( new THREE.LineCurve(endPoint, startPoint) );\r\n\t}\r\n\t\r\n};\r\n\r\n// To get accurate point with reference to\r\n// entire path distance at time t,\r\n// following has to be done:\r\n\r\n// 1. Length of each sub path have to be known\r\n// 2. Locate and identify type of curve\r\n// 3. Get t for the curve\r\n// 4. Return curve.getPointAt(t')\r\n\r\nTHREE.CurvePath.prototype.getPoint = function( t ) {\r\n\r\n\tvar d = t * this.getLength();\r\n\tvar curveLengths = this.getCurveLengths();\r\n\tvar i = 0, diff, curve;\r\n\r\n\t// To think about boundaries points.\r\n\r\n\twhile ( i < curveLengths.length ) {\r\n\r\n\t\tif ( curveLengths[ i ] >= d ) {\r\n\r\n\t\t\tdiff = curveLengths[ i ] - d;\r\n\t\t\tcurve = this.curves[ i ];\r\n\r\n\t\t\tvar u = 1 - diff / curve.getLength();\r\n\r\n\t\t\treturn curve.getPointAt( u );\r\n\r\n\t\t}\r\n\r\n\t\ti ++;\r\n\r\n\t}\r\n\r\n\treturn null;\r\n\r\n\t// loop where sum != 0, sum > d , sum+1 <d\r\n\r\n};\r\n\r\n/*\r\nTHREE.CurvePath.prototype.getTangent = function( t ) {\r\n};*/\r\n\r\n\r\n// We cannot use the default THREE.Curve getPoint() with getLength() because in\r\n// THREE.Curve, getLength() depends on getPoint() but in THREE.CurvePath\r\n// getPoint() depends on getLength\r\n\r\nTHREE.CurvePath.prototype.getLength = function() {\r\n\r\n\tvar lens = this.getCurveLengths();\r\n\treturn lens[ lens.length - 1 ];\r\n\r\n};\r\n\r\n// Compute lengths and cache them\r\n// We cannot overwrite getLengths() because UtoT mapping uses it.\r\n\r\nTHREE.CurvePath.prototype.getCurveLengths = function() {\r\n\r\n\t// We use cache values if curves and cache array are same length\r\n\r\n\tif ( this.cacheLengths && this.cacheLengths.length == this.curves.length ) {\r\n\r\n\t\treturn this.cacheLengths;\r\n\r\n\t};\r\n\r\n\t// Get length of subsurve\r\n\t// Push sums into cached array\r\n\r\n\tvar lengths = [], sums = 0;\r\n\tvar i, il = this.curves.length;\r\n\r\n\tfor ( i = 0; i < il; i ++ ) {\r\n\r\n\t\tsums += this.curves[ i ].getLength();\r\n\t\tlengths.push( sums );\r\n\r\n\t}\r\n\r\n\tthis.cacheLengths = lengths;\r\n\r\n\treturn lengths;\r\n\r\n};\r\n\r\n\r\n\r\n// Returns min and max coordinates\r\n\r\nTHREE.CurvePath.prototype.getBoundingBox = function () {\r\n\r\n\tvar points = this.getPoints();\r\n\r\n\tvar maxX, maxY, maxZ;\r\n\tvar minX, minY, minZ;\r\n\r\n\tmaxX = maxY = Number.NEGATIVE_INFINITY;\r\n\tminX = minY = Number.POSITIVE_INFINITY;\r\n\r\n\tvar p, i, il, sum;\r\n\r\n\tvar v3 = points[0] instanceof THREE.Vector3;\r\n\r\n\tsum = v3 ? new THREE.Vector3() : new THREE.Vector2();\r\n\r\n\tfor ( i = 0, il = points.length; i < il; i ++ ) {\r\n\r\n\t\tp = points[ i ];\r\n\r\n\t\tif ( p.x > maxX ) maxX = p.x;\r\n\t\telse if ( p.x < minX ) minX = p.x;\r\n\r\n\t\tif ( p.y > maxY ) maxY = p.y;\r\n\t\telse if ( p.y < minY ) minY = p.y;\r\n\r\n\t\tif ( v3 ) {\r\n\r\n\t\t\tif ( p.z > maxZ ) maxZ = p.z;\r\n\t\t\telse if ( p.z < minZ ) minZ = p.z;\r\n\r\n\t\t}\r\n\r\n\t\tsum.add( p );\r\n\r\n\t}\r\n\r\n\tvar ret = {\r\n\r\n\t\tminX: minX,\r\n\t\tminY: minY,\r\n\t\tmaxX: maxX,\r\n\t\tmaxY: maxY\r\n\r\n\t};\r\n\r\n\tif ( v3 ) {\r\n\r\n\t\tret.maxZ = maxZ;\r\n\t\tret.minZ = minZ;\r\n\r\n\t}\r\n\r\n\treturn ret;\r\n\r\n};\r\n\r\n/**************************************************************\r\n *\tCreate Geometries Helpers\r\n **************************************************************/\r\n\r\n/// Generate geometry from path points (for Line or Points objects)\r\n\r\nTHREE.CurvePath.prototype.createPointsGeometry = function( divisions ) {\r\n\r\n\tvar pts = this.getPoints( divisions, true );\r\n\treturn this.createGeometry( pts );\r\n\r\n};\r\n\r\n// Generate geometry from equidistance sampling along the path\r\n\r\nTHREE.CurvePath.prototype.createSpacedPointsGeometry = function( divisions ) {\r\n\r\n\tvar pts = this.getSpacedPoints( divisions, true );\r\n\treturn this.createGeometry( pts );\r\n\r\n};\r\n\r\nTHREE.CurvePath.prototype.createGeometry = function( points ) {\r\n\r\n\tvar geometry = new THREE.Geometry();\r\n\r\n\tfor ( var i = 0; i < points.length; i ++ ) {\r\n\r\n\t\tgeometry.vertices.push( new THREE.Vector3( points[ i ].x, points[ i ].y, points[ i ].z || 0) );\r\n\r\n\t}\r\n\r\n\treturn geometry;\r\n\r\n};\r\n\r\n\r\n/**************************************************************\r\n *\tBend / Wrap Helper Methods\r\n **************************************************************/\r\n\r\n// Wrap path / Bend modifiers?\r\n\r\nTHREE.CurvePath.prototype.addWrapPath = function ( bendpath ) {\r\n\r\n\tthis.bends.push( bendpath );\r\n\r\n};\r\n\r\nTHREE.CurvePath.prototype.getTransformedPoints = function( segments, bends ) {\r\n\r\n\tvar oldPts = this.getPoints( segments ); // getPoints getSpacedPoints\r\n\tvar i, il;\r\n\r\n\tif ( ! bends ) {\r\n\r\n\t\tbends = this.bends;\r\n\r\n\t}\r\n\r\n\tfor ( i = 0, il = bends.length; i < il; i ++ ) {\r\n\r\n\t\toldPts = this.getWrapPoints( oldPts, bends[ i ] );\r\n\r\n\t}\r\n\r\n\treturn oldPts;\r\n\r\n};\r\n\r\nTHREE.CurvePath.prototype.getTransformedSpacedPoints = function( segments, bends ) {\r\n\r\n\tvar oldPts = this.getSpacedPoints( segments );\r\n\r\n\tvar i, il;\r\n\r\n\tif ( ! bends ) {\r\n\r\n\t\tbends = this.bends;\r\n\r\n\t}\r\n\r\n\tfor ( i = 0, il = bends.length; i < il; i ++ ) {\r\n\r\n\t\toldPts = this.getWrapPoints( oldPts, bends[ i ] );\r\n\r\n\t}\r\n\r\n\treturn oldPts;\r\n\r\n};\r\n\r\n// This returns getPoints() bend/wrapped around the contour of a path.\r\n// Read http://www.planetclegg.com/projects/WarpingTextToSplines.html\r\n\r\nTHREE.CurvePath.prototype.getWrapPoints = function ( oldPts, path ) {\r\n\r\n\tvar bounds = this.getBoundingBox();\r\n\r\n\tvar i, il, p, oldX, oldY, xNorm;\r\n\r\n\tfor ( i = 0, il = oldPts.length; i < il; i ++ ) {\r\n\r\n\t\tp = oldPts[ i ];\r\n\r\n\t\toldX = p.x;\r\n\t\toldY = p.y;\r\n\r\n\t\txNorm = oldX / bounds.maxX;\r\n\r\n\t\t// If using actual distance, for length > path, requires line extrusions\r\n\t\t//xNorm = path.getUtoTmapping(xNorm, oldX); // 3 styles. 1) wrap stretched. 2) wrap stretch by arc length 3) warp by actual distance\r\n\r\n\t\txNorm = path.getUtoTmapping( xNorm, oldX );\r\n\r\n\t\t// check for out of bounds?\r\n\r\n\t\tvar pathPt = path.getPoint( xNorm );\r\n\t\tvar normal = path.getTangent( xNorm );\r\n\t\tnormal.set( - normal.y, normal.x ).multiplyScalar( oldY );\r\n\r\n\t\tp.x = pathPt.x + normal.x;\r\n\t\tp.y = pathPt.y + normal.y;\r\n\r\n\t}\r\n\r\n\treturn oldPts;\r\n\r\n};\r\n\r\n\r\n// File:src/extras/core/Gyroscope.js\r\n\r\n/**\r\n * @author alteredq / http://alteredqualia.com/\r\n */\r\n\r\nTHREE.Gyroscope = function () {\r\n\r\n\tTHREE.Object3D.call( this );\r\n\r\n};\r\n\r\nTHREE.Gyroscope.prototype = Object.create( THREE.Object3D.prototype );\r\nTHREE.Gyroscope.prototype.constructor = THREE.Gyroscope;\r\n\r\nTHREE.Gyroscope.prototype.updateMatrixWorld = ( function () {\r\n\r\n\tvar translationObject = new THREE.Vector3();\r\n\tvar quaternionObject = new THREE.Quaternion();\r\n\tvar scaleObject = new THREE.Vector3();\r\n\r\n\tvar translationWorld = new THREE.Vector3();\r\n\tvar quaternionWorld = new THREE.Quaternion();\r\n\tvar scaleWorld = new THREE.Vector3();\r\n\r\n\treturn function ( force ) {\r\n\r\n\t\tthis.matrixAutoUpdate && this.updateMatrix();\r\n\r\n\t\t// update matrixWorld\r\n\r\n\t\tif ( this.matrixWorldNeedsUpdate || force ) {\r\n\r\n\t\t\tif ( this.parent ) {\r\n\r\n\t\t\t\tthis.matrixWorld.multiplyMatrices( this.parent.matrixWorld, this.matrix );\r\n\r\n\t\t\t\tthis.matrixWorld.decompose( translationWorld, quaternionWorld, scaleWorld );\r\n\t\t\t\tthis.matrix.decompose( translationObject, quaternionObject, scaleObject );\r\n\r\n\t\t\t\tthis.matrixWorld.compose( translationWorld, quaternionObject, scaleWorld );\r\n\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tthis.matrixWorld.copy( this.matrix );\r\n\r\n\t\t\t}\r\n\r\n\r\n\t\t\tthis.matrixWorldNeedsUpdate = false;\r\n\r\n\t\t\tforce = true;\r\n\r\n\t\t}\r\n\r\n\t\t// update children\r\n\r\n\t\tfor ( var i = 0, l = this.children.length; i < l; i ++ ) {\r\n\r\n\t\t\tthis.children[ i ].updateMatrixWorld( force );\r\n\r\n\t\t}\r\n\r\n\t};\r\n\t\r\n}() );\r\n\r\n// File:src/extras/core/Path.js\r\n\r\n/**\r\n * @author zz85 / http://www.lab4games.net/zz85/blog\r\n * Creates free form 2d path using series of points, lines or curves.\r\n *\r\n **/\r\n\r\nTHREE.Path = function ( points ) {\r\n\r\n\tTHREE.CurvePath.call(this);\r\n\r\n\tthis.actions = [];\r\n\r\n\tif ( points ) {\r\n\r\n\t\tthis.fromPoints( points );\r\n\r\n\t}\r\n\r\n};\r\n\r\nTHREE.Path.prototype = Object.create( THREE.CurvePath.prototype );\r\nTHREE.Path.prototype.constructor = THREE.Path;\r\n\r\nTHREE.PathActions = {\r\n\r\n\tMOVE_TO: 'moveTo',\r\n\tLINE_TO: 'lineTo',\r\n\tQUADRATIC_CURVE_TO: 'quadraticCurveTo', // Bezier quadratic curve\r\n\tBEZIER_CURVE_TO: 'bezierCurveTo', \t\t// Bezier cubic curve\r\n\tCSPLINE_THRU: 'splineThru',\t\t\t\t// Catmull-rom spline\r\n\tARC: 'arc',\t\t\t\t\t\t\t\t// Circle\r\n\tELLIPSE: 'ellipse'\r\n};\r\n\r\n// TODO Clean up PATH API\r\n\r\n// Create path using straight lines to connect all points\r\n// - vectors: array of Vector2\r\n\r\nTHREE.Path.prototype.fromPoints = function ( vectors ) {\r\n\r\n\tthis.moveTo( vectors[ 0 ].x, vectors[ 0 ].y );\r\n\r\n\tfor ( var v = 1, vlen = vectors.length; v < vlen; v ++ ) {\r\n\r\n\t\tthis.lineTo( vectors[ v ].x, vectors[ v ].y );\r\n\r\n\t};\r\n\r\n};\r\n\r\n// startPath() endPath()?\r\n\r\nTHREE.Path.prototype.moveTo = function ( x, y ) {\r\n\r\n\tvar args = Array.prototype.slice.call( arguments );\r\n\tthis.actions.push( { action: THREE.PathActions.MOVE_TO, args: args } );\r\n\r\n};\r\n\r\nTHREE.Path.prototype.lineTo = function ( x, y ) {\r\n\r\n\tvar args = Array.prototype.slice.call( arguments );\r\n\r\n\tvar lastargs = this.actions[ this.actions.length - 1 ].args;\r\n\r\n\tvar x0 = lastargs[ lastargs.length - 2 ];\r\n\tvar y0 = lastargs[ lastargs.length - 1 ];\r\n\r\n\tvar curve = new THREE.LineCurve( new THREE.Vector2( x0, y0 ), new THREE.Vector2( x, y ) );\r\n\tthis.curves.push( curve );\r\n\r\n\tthis.actions.push( { action: THREE.PathActions.LINE_TO, args: args } );\r\n\r\n};\r\n\r\nTHREE.Path.prototype.quadraticCurveTo = function( aCPx, aCPy, aX, aY ) {\r\n\r\n\tvar args = Array.prototype.slice.call( arguments );\r\n\r\n\tvar lastargs = this.actions[ this.actions.length - 1 ].args;\r\n\r\n\tvar x0 = lastargs[ lastargs.length - 2 ];\r\n\tvar y0 = lastargs[ lastargs.length - 1 ];\r\n\r\n\tvar curve = new THREE.QuadraticBezierCurve( new THREE.Vector2( x0, y0 ),\r\n\t\t\t\t\t\t\t\t\t\t\t\tnew THREE.Vector2( aCPx, aCPy ),\r\n\t\t\t\t\t\t\t\t\t\t\t\tnew THREE.Vector2( aX, aY ) );\r\n\tthis.curves.push( curve );\r\n\r\n\tthis.actions.push( { action: THREE.PathActions.QUADRATIC_CURVE_TO, args: args } );\r\n\r\n};\r\n\r\nTHREE.Path.prototype.bezierCurveTo = function( aCP1x, aCP1y,\r\n\t\t\t\t\t\t\t\t\t\t\t   aCP2x, aCP2y,\r\n\t\t\t\t\t\t\t\t\t\t\t   aX, aY ) {\r\n\r\n\tvar args = Array.prototype.slice.call( arguments );\r\n\r\n\tvar lastargs = this.actions[ this.actions.length - 1 ].args;\r\n\r\n\tvar x0 = lastargs[ lastargs.length - 2 ];\r\n\tvar y0 = lastargs[ lastargs.length - 1 ];\r\n\r\n\tvar curve = new THREE.CubicBezierCurve( new THREE.Vector2( x0, y0 ),\r\n\t\t\t\t\t\t\t\t\t\t\tnew THREE.Vector2( aCP1x, aCP1y ),\r\n\t\t\t\t\t\t\t\t\t\t\tnew THREE.Vector2( aCP2x, aCP2y ),\r\n\t\t\t\t\t\t\t\t\t\t\tnew THREE.Vector2( aX, aY ) );\r\n\tthis.curves.push( curve );\r\n\r\n\tthis.actions.push( { action: THREE.PathActions.BEZIER_CURVE_TO, args: args } );\r\n\r\n};\r\n\r\nTHREE.Path.prototype.splineThru = function( pts /*Array of Vector*/ ) {\r\n\r\n\tvar args = Array.prototype.slice.call( arguments );\r\n\tvar lastargs = this.actions[ this.actions.length - 1 ].args;\r\n\r\n\tvar x0 = lastargs[ lastargs.length - 2 ];\r\n\tvar y0 = lastargs[ lastargs.length - 1 ];\r\n//---\r\n\tvar npts = [ new THREE.Vector2( x0, y0 ) ];\r\n\tArray.prototype.push.apply( npts, pts );\r\n\r\n\tvar curve = new THREE.SplineCurve( npts );\r\n\tthis.curves.push( curve );\r\n\r\n\tthis.actions.push( { action: THREE.PathActions.CSPLINE_THRU, args: args } );\r\n\r\n};\r\n\r\n// FUTURE: Change the API or follow canvas API?\r\n\r\nTHREE.Path.prototype.arc = function ( aX, aY, aRadius,\r\n\t\t\t\t\t\t\t\t\t  aStartAngle, aEndAngle, aClockwise ) {\r\n\r\n\tvar lastargs = this.actions[ this.actions.length - 1].args;\r\n\tvar x0 = lastargs[ lastargs.length - 2 ];\r\n\tvar y0 = lastargs[ lastargs.length - 1 ];\r\n\r\n\tthis.absarc(aX + x0, aY + y0, aRadius,\r\n\t\taStartAngle, aEndAngle, aClockwise );\r\n\r\n };\r\n\r\n THREE.Path.prototype.absarc = function ( aX, aY, aRadius,\r\n\t\t\t\t\t\t\t\t\t  aStartAngle, aEndAngle, aClockwise ) {\r\n\tthis.absellipse(aX, aY, aRadius, aRadius, aStartAngle, aEndAngle, aClockwise);\r\n };\r\n\r\nTHREE.Path.prototype.ellipse = function ( aX, aY, xRadius, yRadius,\r\n\t\t\t\t\t\t\t\t\t  aStartAngle, aEndAngle, aClockwise ) {\r\n\r\n\tvar lastargs = this.actions[ this.actions.length - 1].args;\r\n\tvar x0 = lastargs[ lastargs.length - 2 ];\r\n\tvar y0 = lastargs[ lastargs.length - 1 ];\r\n\r\n\tthis.absellipse(aX + x0, aY + y0, xRadius, yRadius,\r\n\t\taStartAngle, aEndAngle, aClockwise );\r\n\r\n };\r\n\r\n\r\nTHREE.Path.prototype.absellipse = function ( aX, aY, xRadius, yRadius,\r\n\t\t\t\t\t\t\t\t\t  aStartAngle, aEndAngle, aClockwise ) {\r\n\r\n\tvar args = Array.prototype.slice.call( arguments );\r\n\tvar curve = new THREE.EllipseCurve( aX, aY, xRadius, yRadius,\r\n\t\t\t\t\t\t\t\t\taStartAngle, aEndAngle, aClockwise );\r\n\tthis.curves.push( curve );\r\n\r\n\tvar lastPoint = curve.getPoint(1);\r\n\targs.push(lastPoint.x);\r\n\targs.push(lastPoint.y);\r\n\r\n\tthis.actions.push( { action: THREE.PathActions.ELLIPSE, args: args } );\r\n\r\n };\r\n\r\nTHREE.Path.prototype.getSpacedPoints = function ( divisions, closedPath ) {\r\n\r\n\tif ( ! divisions ) divisions = 40;\r\n\r\n\tvar points = [];\r\n\r\n\tfor ( var i = 0; i < divisions; i ++ ) {\r\n\r\n\t\tpoints.push( this.getPoint( i / divisions ) );\r\n\r\n\t\t//if( !this.getPoint( i / divisions ) ) throw \"DIE\";\r\n\r\n\t}\r\n\r\n\t// if ( closedPath ) {\r\n\t//\r\n\t// \tpoints.push( points[ 0 ] );\r\n\t//\r\n\t// }\r\n\r\n\treturn points;\r\n\r\n};\r\n\r\n/* Return an array of vectors based on contour of the path */\r\n\r\nTHREE.Path.prototype.getPoints = function( divisions, closedPath ) {\r\n\r\n\tif (this.useSpacedPoints) {\r\n\t\tconsole.log('tata');\r\n\t\treturn this.getSpacedPoints( divisions, closedPath );\r\n\t}\r\n\r\n\tdivisions = divisions || 12;\r\n\r\n\tvar points = [];\r\n\r\n\tvar i, il, item, action, args;\r\n\tvar cpx, cpy, cpx2, cpy2, cpx1, cpy1, cpx0, cpy0,\r\n\t\tlaste, j,\r\n\t\tt, tx, ty;\r\n\r\n\tfor ( i = 0, il = this.actions.length; i < il; i ++ ) {\r\n\r\n\t\titem = this.actions[ i ];\r\n\r\n\t\taction = item.action;\r\n\t\targs = item.args;\r\n\r\n\t\tswitch ( action ) {\r\n\r\n\t\tcase THREE.PathActions.MOVE_TO:\r\n\r\n\t\t\tpoints.push( new THREE.Vector2( args[ 0 ], args[ 1 ] ) );\r\n\r\n\t\t\tbreak;\r\n\r\n\t\tcase THREE.PathActions.LINE_TO:\r\n\r\n\t\t\tpoints.push( new THREE.Vector2( args[ 0 ], args[ 1 ] ) );\r\n\r\n\t\t\tbreak;\r\n\r\n\t\tcase THREE.PathActions.QUADRATIC_CURVE_TO:\r\n\r\n\t\t\tcpx  = args[ 2 ];\r\n\t\t\tcpy  = args[ 3 ];\r\n\r\n\t\t\tcpx1 = args[ 0 ];\r\n\t\t\tcpy1 = args[ 1 ];\r\n\r\n\t\t\tif ( points.length > 0 ) {\r\n\r\n\t\t\t\tlaste = points[ points.length - 1 ];\r\n\r\n\t\t\t\tcpx0 = laste.x;\r\n\t\t\t\tcpy0 = laste.y;\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tlaste = this.actions[ i - 1 ].args;\r\n\r\n\t\t\t\tcpx0 = laste[ laste.length - 2 ];\r\n\t\t\t\tcpy0 = laste[ laste.length - 1 ];\r\n\r\n\t\t\t}\r\n\r\n\t\t\tfor ( j = 1; j <= divisions; j ++ ) {\r\n\r\n\t\t\t\tt = j / divisions;\r\n\r\n\t\t\t\ttx = THREE.Shape.Utils.b2( t, cpx0, cpx1, cpx );\r\n\t\t\t\tty = THREE.Shape.Utils.b2( t, cpy0, cpy1, cpy );\r\n\r\n\t\t\t\tpoints.push( new THREE.Vector2( tx, ty ) );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tbreak;\r\n\r\n\t\tcase THREE.PathActions.BEZIER_CURVE_TO:\r\n\r\n\t\t\tcpx  = args[ 4 ];\r\n\t\t\tcpy  = args[ 5 ];\r\n\r\n\t\t\tcpx1 = args[ 0 ];\r\n\t\t\tcpy1 = args[ 1 ];\r\n\r\n\t\t\tcpx2 = args[ 2 ];\r\n\t\t\tcpy2 = args[ 3 ];\r\n\r\n\t\t\tif ( points.length > 0 ) {\r\n\r\n\t\t\t\tlaste = points[ points.length - 1 ];\r\n\r\n\t\t\t\tcpx0 = laste.x;\r\n\t\t\t\tcpy0 = laste.y;\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tlaste = this.actions[ i - 1 ].args;\r\n\r\n\t\t\t\tcpx0 = laste[ laste.length - 2 ];\r\n\t\t\t\tcpy0 = laste[ laste.length - 1 ];\r\n\r\n\t\t\t}\r\n\r\n\r\n\t\t\tfor ( j = 1; j <= divisions; j ++ ) {\r\n\r\n\t\t\t\tt = j / divisions;\r\n\r\n\t\t\t\ttx = THREE.Shape.Utils.b3( t, cpx0, cpx1, cpx2, cpx );\r\n\t\t\t\tty = THREE.Shape.Utils.b3( t, cpy0, cpy1, cpy2, cpy );\r\n\r\n\t\t\t\tpoints.push( new THREE.Vector2( tx, ty ) );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tbreak;\r\n\r\n\t\tcase THREE.PathActions.CSPLINE_THRU:\r\n\r\n\t\t\tlaste = this.actions[ i - 1 ].args;\r\n\r\n\t\t\tvar last = new THREE.Vector2( laste[ laste.length - 2 ], laste[ laste.length - 1 ] );\r\n\t\t\tvar spts = [ last ];\r\n\r\n\t\t\tvar n = divisions * args[ 0 ].length;\r\n\r\n\t\t\tspts = spts.concat( args[ 0 ] );\r\n\r\n\t\t\tvar spline = new THREE.SplineCurve( spts );\r\n\r\n\t\t\tfor ( j = 1; j <= n; j ++ ) {\r\n\r\n\t\t\t\tpoints.push( spline.getPointAt( j / n ) ) ;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tbreak;\r\n\r\n\t\tcase THREE.PathActions.ARC:\r\n\r\n\t\t\tvar aX = args[ 0 ], aY = args[ 1 ],\r\n\t\t\t\taRadius = args[ 2 ],\r\n\t\t\t\taStartAngle = args[ 3 ], aEndAngle = args[ 4 ],\r\n\t\t\t\taClockwise = !! args[ 5 ];\r\n\r\n\t\t\tvar deltaAngle = aEndAngle - aStartAngle;\r\n\t\t\tvar angle;\r\n\t\t\tvar tdivisions = divisions * 2;\r\n\r\n\t\t\tfor ( j = 1; j <= tdivisions; j ++ ) {\r\n\r\n\t\t\t\tt = j / tdivisions;\r\n\r\n\t\t\t\tif ( ! aClockwise ) {\r\n\r\n\t\t\t\t\tt = 1 - t;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tangle = aStartAngle + t * deltaAngle;\r\n\r\n\t\t\t\ttx = aX + aRadius * Math.cos( angle );\r\n\t\t\t\tty = aY + aRadius * Math.sin( angle );\r\n\r\n\t\t\t\t//console.log('t', t, 'angle', angle, 'tx', tx, 'ty', ty);\r\n\r\n\t\t\t\tpoints.push( new THREE.Vector2( tx, ty ) );\r\n\r\n\t\t\t}\r\n\r\n\t\t\t//console.log(points);\r\n\r\n\t\t\tbreak;\r\n\t\t  \r\n\t\tcase THREE.PathActions.ELLIPSE:\r\n\r\n\t\t\tvar aX = args[ 0 ], aY = args[ 1 ],\r\n\t\t\t\txRadius = args[ 2 ],\r\n\t\t\t\tyRadius = args[ 3 ],\r\n\t\t\t\taStartAngle = args[ 4 ], aEndAngle = args[ 5 ],\r\n\t\t\t\taClockwise = !! args[ 6 ];\r\n\r\n\r\n\t\t\tvar deltaAngle = aEndAngle - aStartAngle;\r\n\t\t\tvar angle;\r\n\t\t\tvar tdivisions = divisions * 2;\r\n\r\n\t\t\tfor ( j = 1; j <= tdivisions; j ++ ) {\r\n\r\n\t\t\t\tt = j / tdivisions;\r\n\r\n\t\t\t\tif ( ! aClockwise ) {\r\n\r\n\t\t\t\t\tt = 1 - t;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tangle = aStartAngle + t * deltaAngle;\r\n\r\n\t\t\t\ttx = aX + xRadius * Math.cos( angle );\r\n\t\t\t\tty = aY + yRadius * Math.sin( angle );\r\n\r\n\t\t\t\t//console.log('t', t, 'angle', angle, 'tx', tx, 'ty', ty);\r\n\r\n\t\t\t\tpoints.push( new THREE.Vector2( tx, ty ) );\r\n\r\n\t\t\t}\r\n\r\n\t\t\t//console.log(points);\r\n\r\n\t\t\tbreak;\r\n\r\n\t\t} // end switch\r\n\r\n\t}\r\n\r\n\r\n\r\n\t// Normalize to remove the closing point by default.\r\n\tvar lastPoint = points[ points.length - 1];\r\n\tvar EPSILON = 0.0000000001;\r\n\tif ( Math.abs(lastPoint.x - points[ 0 ].x) < EPSILON &&\r\n\t\t\t Math.abs(lastPoint.y - points[ 0 ].y) < EPSILON)\r\n\t\tpoints.splice( points.length - 1, 1);\r\n\tif ( closedPath ) {\r\n\r\n\t\tpoints.push( points[ 0 ] );\r\n\r\n\t}\r\n\r\n\treturn points;\r\n\r\n};\r\n\r\n//\r\n// Breaks path into shapes\r\n//\r\n//\tAssumptions (if parameter isCCW==true the opposite holds):\r\n//\t- solid shapes are defined clockwise (CW)\r\n//\t- holes are defined counterclockwise (CCW)\r\n//\r\n//\tIf parameter noHoles==true:\r\n//  - all subPaths are regarded as solid shapes\r\n//  - definition order CW/CCW has no relevance\r\n//\r\n\r\nTHREE.Path.prototype.toShapes = function( isCCW, noHoles ) {\r\n\r\n\tfunction extractSubpaths( inActions ) {\r\n\r\n\t\tvar i, il, item, action, args;\r\n\r\n\t\tvar subPaths = [], lastPath = new THREE.Path();\r\n\r\n\t\tfor ( i = 0, il = inActions.length; i < il; i ++ ) {\r\n\r\n\t\t\titem = inActions[ i ];\r\n\r\n\t\t\targs = item.args;\r\n\t\t\taction = item.action;\r\n\r\n\t\t\tif ( action == THREE.PathActions.MOVE_TO ) {\r\n\r\n\t\t\t\tif ( lastPath.actions.length != 0 ) {\r\n\r\n\t\t\t\t\tsubPaths.push( lastPath );\r\n\t\t\t\t\tlastPath = new THREE.Path();\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\tlastPath[ action ].apply( lastPath, args );\r\n\r\n\t\t}\r\n\r\n\t\tif ( lastPath.actions.length != 0 ) {\r\n\r\n\t\t\tsubPaths.push( lastPath );\r\n\r\n\t\t}\r\n\r\n\t\t// console.log(subPaths);\r\n\r\n\t\treturn\tsubPaths;\r\n\t}\r\n\r\n\tfunction toShapesNoHoles( inSubpaths ) {\r\n\r\n\t\tvar shapes = [];\r\n\r\n\t\tfor ( var i = 0, il = inSubpaths.length; i < il; i ++ ) {\r\n\r\n\t\t\tvar tmpPath = inSubpaths[ i ];\r\n\r\n\t\t\tvar tmpShape = new THREE.Shape();\r\n\t\t\ttmpShape.actions = tmpPath.actions;\r\n\t\t\ttmpShape.curves = tmpPath.curves;\r\n\r\n\t\t\tshapes.push( tmpShape );\r\n\t\t}\r\n\r\n\t\t//console.log(\"shape\", shapes);\r\n\r\n\t\treturn shapes;\r\n\t};\r\n\r\n\tfunction isPointInsidePolygon( inPt, inPolygon ) {\r\n\t\tvar EPSILON = 0.0000000001;\r\n\r\n\t\tvar polyLen = inPolygon.length;\r\n\r\n\t\t// inPt on polygon contour => immediate success    or\r\n\t\t// toggling of inside/outside at every single! intersection point of an edge\r\n\t\t//  with the horizontal line through inPt, left of inPt\r\n\t\t//  not counting lowerY endpoints of edges and whole edges on that line\r\n\t\tvar inside = false;\r\n\t\tfor ( var p = polyLen - 1, q = 0; q < polyLen; p = q ++ ) {\r\n\t\t\tvar edgeLowPt  = inPolygon[ p ];\r\n\t\t\tvar edgeHighPt = inPolygon[ q ];\r\n\r\n\t\t\tvar edgeDx = edgeHighPt.x - edgeLowPt.x;\r\n\t\t\tvar edgeDy = edgeHighPt.y - edgeLowPt.y;\r\n\r\n\t\t\tif ( Math.abs(edgeDy) > EPSILON ) {\t\t\t// not parallel\r\n\t\t\t\tif ( edgeDy < 0 ) {\r\n\t\t\t\t\tedgeLowPt  = inPolygon[ q ]; edgeDx = - edgeDx;\r\n\t\t\t\t\tedgeHighPt = inPolygon[ p ]; edgeDy = - edgeDy;\r\n\t\t\t\t}\r\n\t\t\t\tif ( ( inPt.y < edgeLowPt.y ) || ( inPt.y > edgeHighPt.y ) ) \t\tcontinue;\r\n\r\n\t\t\t\tif ( inPt.y == edgeLowPt.y ) {\r\n\t\t\t\t\tif ( inPt.x == edgeLowPt.x )\t\treturn\ttrue;\t\t// inPt is on contour ?\r\n\t\t\t\t\t// continue;\t\t\t\t// no intersection or edgeLowPt => doesn't count !!!\r\n\t\t\t\t} else {\r\n\t\t\t\t\tvar perpEdge = edgeDy * (inPt.x - edgeLowPt.x) - edgeDx * (inPt.y - edgeLowPt.y);\r\n\t\t\t\t\tif ( perpEdge == 0 )\t\t\t\treturn\ttrue;\t\t// inPt is on contour ?\r\n\t\t\t\t\tif ( perpEdge < 0 ) \t\t\t\tcontinue;\r\n\t\t\t\t\tinside = ! inside;\t\t// true intersection left of inPt\r\n\t\t\t\t}\r\n\t\t\t} else {\t\t// parallel or colinear\r\n\t\t\t\tif ( inPt.y != edgeLowPt.y ) \t\tcontinue;\t\t\t// parallel\r\n\t\t\t\t// egde lies on the same horizontal line as inPt\r\n\t\t\t\tif ( ( ( edgeHighPt.x <= inPt.x ) && ( inPt.x <= edgeLowPt.x ) ) ||\r\n\t\t\t\t\t ( ( edgeLowPt.x <= inPt.x ) && ( inPt.x <= edgeHighPt.x ) ) )\t\treturn\ttrue;\t// inPt: Point on contour !\r\n\t\t\t\t// continue;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn\tinside;\r\n\t}\r\n\r\n\r\n\tvar subPaths = extractSubpaths( this.actions );\r\n\tif ( subPaths.length == 0 ) return [];\r\n\r\n\tif ( noHoles === true )\treturn\ttoShapesNoHoles( subPaths );\r\n\r\n\r\n\tvar solid, tmpPath, tmpShape, shapes = [];\r\n\r\n\tif ( subPaths.length == 1) {\r\n\r\n\t\ttmpPath = subPaths[0];\r\n\t\ttmpShape = new THREE.Shape();\r\n\t\ttmpShape.actions = tmpPath.actions;\r\n\t\ttmpShape.curves = tmpPath.curves;\r\n\t\tshapes.push( tmpShape );\r\n\t\treturn shapes;\r\n\r\n\t}\r\n\r\n\tvar holesFirst = ! THREE.Shape.Utils.isClockWise( subPaths[ 0 ].getPoints() );\r\n\tholesFirst = isCCW ? ! holesFirst : holesFirst;\r\n\r\n\t// console.log(\"Holes first\", holesFirst);\r\n\t\r\n\tvar betterShapeHoles = [];\r\n\tvar newShapes = [];\r\n\tvar newShapeHoles = [];\r\n\tvar mainIdx = 0;\r\n\tvar tmpPoints;\r\n\r\n\tnewShapes[mainIdx] = undefined;\r\n\tnewShapeHoles[mainIdx] = [];\r\n\r\n\tvar i, il;\r\n\r\n\tfor ( i = 0, il = subPaths.length; i < il; i ++ ) {\r\n\r\n\t\ttmpPath = subPaths[ i ];\r\n\t\ttmpPoints = tmpPath.getPoints();\r\n\t\tsolid = THREE.Shape.Utils.isClockWise( tmpPoints );\r\n\t\tsolid = isCCW ? ! solid : solid;\r\n\r\n\t\tif ( solid ) {\r\n\r\n\t\t\tif ( (! holesFirst ) && ( newShapes[mainIdx] ) )\tmainIdx ++;\r\n\r\n\t\t\tnewShapes[mainIdx] = { s: new THREE.Shape(), p: tmpPoints };\r\n\t\t\tnewShapes[mainIdx].s.actions = tmpPath.actions;\r\n\t\t\tnewShapes[mainIdx].s.curves = tmpPath.curves;\r\n\t\t\t\r\n\t\t\tif ( holesFirst )\tmainIdx ++;\r\n\t\t\tnewShapeHoles[mainIdx] = [];\r\n\r\n\t\t\t//console.log('cw', i);\r\n\r\n\t\t} else {\r\n\r\n\t\t\tnewShapeHoles[mainIdx].push( { h: tmpPath, p: tmpPoints[0] } );\r\n\r\n\t\t\t//console.log('ccw', i);\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\t// only Holes? -> probably all Shapes with wrong orientation\r\n\tif ( ! newShapes[0] )\treturn\ttoShapesNoHoles( subPaths );\r\n\r\n\r\n\tif ( newShapes.length > 1 ) {\r\n\t\tvar ambigious = false;\r\n\t\tvar toChange = [];\r\n\r\n\t\tfor (var sIdx = 0, sLen = newShapes.length; sIdx < sLen; sIdx ++ ) {\r\n\t\t\tbetterShapeHoles[sIdx] = [];\r\n\t\t}\r\n\t\tfor (var sIdx = 0, sLen = newShapes.length; sIdx < sLen; sIdx ++ ) {\r\n\t\t\tvar sho = newShapeHoles[sIdx];\r\n\t\t\tfor (var hIdx = 0; hIdx < sho.length; hIdx ++ ) {\r\n\t\t\t\tvar ho = sho[hIdx];\r\n\t\t\t\tvar hole_unassigned = true;\r\n\t\t\t\tfor (var s2Idx = 0; s2Idx < newShapes.length; s2Idx ++ ) {\r\n\t\t\t\t\tif ( isPointInsidePolygon( ho.p, newShapes[s2Idx].p ) ) {\r\n\t\t\t\t\t\tif ( sIdx != s2Idx )\t\ttoChange.push( { froms: sIdx, tos: s2Idx, hole: hIdx } );\r\n\t\t\t\t\t\tif ( hole_unassigned ) {\r\n\t\t\t\t\t\t\thole_unassigned = false;\r\n\t\t\t\t\t\t\tbetterShapeHoles[s2Idx].push( ho );\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tambigious = true;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif ( hole_unassigned ) { betterShapeHoles[sIdx].push( ho ); }\r\n\t\t\t}\r\n\t\t}\r\n\t\t// console.log(\"ambigious: \", ambigious);\r\n\t\tif ( toChange.length > 0 ) {\r\n\t\t\t// console.log(\"to change: \", toChange);\r\n\t\t\tif (! ambigious)\tnewShapeHoles = betterShapeHoles;\r\n\t\t}\r\n\t}\r\n\r\n\tvar tmpHoles, j, jl;\r\n\tfor ( i = 0, il = newShapes.length; i < il; i ++ ) {\r\n\t\ttmpShape = newShapes[i].s;\r\n\t\tshapes.push( tmpShape );\r\n\t\ttmpHoles = newShapeHoles[i];\r\n\t\tfor ( j = 0, jl = tmpHoles.length; j < jl; j ++ ) {\r\n\t\t\ttmpShape.holes.push( tmpHoles[j].h );\r\n\t\t}\r\n\t}\r\n\r\n\t//console.log(\"shape\", shapes);\r\n\r\n\treturn shapes;\r\n\r\n};\r\n\r\n// File:src/extras/core/Shape.js\r\n\r\n/**\r\n * @author zz85 / http://www.lab4games.net/zz85/blog\r\n * Defines a 2d shape plane using paths.\r\n **/\r\n\r\n// STEP 1 Create a path.\r\n// STEP 2 Turn path into shape.\r\n// STEP 3 ExtrudeGeometry takes in Shape/Shapes\r\n// STEP 3a - Extract points from each shape, turn to vertices\r\n// STEP 3b - Triangulate each shape, add faces.\r\n\r\nTHREE.Shape = function () {\r\n\r\n\tTHREE.Path.apply( this, arguments );\r\n\tthis.holes = [];\r\n\r\n};\r\n\r\nTHREE.Shape.prototype = Object.create( THREE.Path.prototype );\r\nTHREE.Shape.prototype.constructor = THREE.Shape;\r\n\r\n// Convenience method to return ExtrudeGeometry\r\n\r\nTHREE.Shape.prototype.extrude = function ( options ) {\r\n\r\n\tvar extruded = new THREE.ExtrudeGeometry( this, options );\r\n\treturn extruded;\r\n\r\n};\r\n\r\n// Convenience method to return ShapeGeometry\r\n\r\nTHREE.Shape.prototype.makeGeometry = function ( options ) {\r\n\r\n\tvar geometry = new THREE.ShapeGeometry( this, options );\r\n\treturn geometry;\r\n\r\n};\r\n\r\n// Get points of holes\r\n\r\nTHREE.Shape.prototype.getPointsHoles = function ( divisions ) {\r\n\r\n\tvar i, il = this.holes.length, holesPts = [];\r\n\r\n\tfor ( i = 0; i < il; i ++ ) {\r\n\r\n\t\tholesPts[ i ] = this.holes[ i ].getTransformedPoints( divisions, this.bends );\r\n\r\n\t}\r\n\r\n\treturn holesPts;\r\n\r\n};\r\n\r\n// Get points of holes (spaced by regular distance)\r\n\r\nTHREE.Shape.prototype.getSpacedPointsHoles = function ( divisions ) {\r\n\r\n\tvar i, il = this.holes.length, holesPts = [];\r\n\r\n\tfor ( i = 0; i < il; i ++ ) {\r\n\r\n\t\tholesPts[ i ] = this.holes[ i ].getTransformedSpacedPoints( divisions, this.bends );\r\n\r\n\t}\r\n\r\n\treturn holesPts;\r\n\r\n};\r\n\r\n\r\n// Get points of shape and holes (keypoints based on segments parameter)\r\n\r\nTHREE.Shape.prototype.extractAllPoints = function ( divisions ) {\r\n\r\n\treturn {\r\n\r\n\t\tshape: this.getTransformedPoints( divisions ),\r\n\t\tholes: this.getPointsHoles( divisions )\r\n\r\n\t};\r\n\r\n};\r\n\r\nTHREE.Shape.prototype.extractPoints = function ( divisions ) {\r\n\r\n\tif (this.useSpacedPoints) {\r\n\t\treturn this.extractAllSpacedPoints(divisions);\r\n\t}\r\n\r\n\treturn this.extractAllPoints(divisions);\r\n\r\n};\r\n\r\n//\r\n// THREE.Shape.prototype.extractAllPointsWithBend = function ( divisions, bend ) {\r\n//\r\n// \treturn {\r\n//\r\n// \t\tshape: this.transform( bend, divisions ),\r\n// \t\tholes: this.getPointsHoles( divisions, bend )\r\n//\r\n// \t};\r\n//\r\n// };\r\n\r\n// Get points of shape and holes (spaced by regular distance)\r\n\r\nTHREE.Shape.prototype.extractAllSpacedPoints = function ( divisions ) {\r\n\r\n\treturn {\r\n\r\n\t\tshape: this.getTransformedSpacedPoints( divisions ),\r\n\t\tholes: this.getSpacedPointsHoles( divisions )\r\n\r\n\t};\r\n\r\n};\r\n\r\n/**************************************************************\r\n *\tUtils\r\n **************************************************************/\r\n\r\nTHREE.Shape.Utils = {\r\n\r\n\ttriangulateShape: function ( contour, holes ) {\r\n\r\n\t\tfunction point_in_segment_2D_colin( inSegPt1, inSegPt2, inOtherPt ) {\r\n\t\t\t// inOtherPt needs to be colinear to the inSegment\r\n\t\t\tif ( inSegPt1.x != inSegPt2.x ) {\r\n\t\t\t\tif ( inSegPt1.x < inSegPt2.x ) {\r\n\t\t\t\t\treturn\t( ( inSegPt1.x <= inOtherPt.x ) && ( inOtherPt.x <= inSegPt2.x ) );\r\n\t\t\t\t} else {\r\n\t\t\t\t\treturn\t( ( inSegPt2.x <= inOtherPt.x ) && ( inOtherPt.x <= inSegPt1.x ) );\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tif ( inSegPt1.y < inSegPt2.y ) {\r\n\t\t\t\t\treturn\t( ( inSegPt1.y <= inOtherPt.y ) && ( inOtherPt.y <= inSegPt2.y ) );\r\n\t\t\t\t} else {\r\n\t\t\t\t\treturn\t( ( inSegPt2.y <= inOtherPt.y ) && ( inOtherPt.y <= inSegPt1.y ) );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfunction intersect_segments_2D( inSeg1Pt1, inSeg1Pt2, inSeg2Pt1, inSeg2Pt2, inExcludeAdjacentSegs ) {\r\n\t\t\tvar EPSILON = 0.0000000001;\r\n\r\n\t\t\tvar seg1dx = inSeg1Pt2.x - inSeg1Pt1.x,   seg1dy = inSeg1Pt2.y - inSeg1Pt1.y;\r\n\t\t\tvar seg2dx = inSeg2Pt2.x - inSeg2Pt1.x,   seg2dy = inSeg2Pt2.y - inSeg2Pt1.y;\r\n\r\n\t\t\tvar seg1seg2dx = inSeg1Pt1.x - inSeg2Pt1.x;\r\n\t\t\tvar seg1seg2dy = inSeg1Pt1.y - inSeg2Pt1.y;\r\n\r\n\t\t\tvar limit\t\t= seg1dy * seg2dx - seg1dx * seg2dy;\r\n\t\t\tvar perpSeg1\t= seg1dy * seg1seg2dx - seg1dx * seg1seg2dy;\r\n\r\n\t\t\tif ( Math.abs(limit) > EPSILON ) {\t\t\t// not parallel\r\n\r\n\t\t\t\tvar perpSeg2;\r\n\t\t\t\tif ( limit > 0 ) {\r\n\t\t\t\t\tif ( ( perpSeg1 < 0 ) || ( perpSeg1 > limit ) ) \t\treturn [];\r\n\t\t\t\t\tperpSeg2 = seg2dy * seg1seg2dx - seg2dx * seg1seg2dy;\r\n\t\t\t\t\tif ( ( perpSeg2 < 0 ) || ( perpSeg2 > limit ) ) \t\treturn [];\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif ( ( perpSeg1 > 0 ) || ( perpSeg1 < limit ) ) \t\treturn [];\r\n\t\t\t\t\tperpSeg2 = seg2dy * seg1seg2dx - seg2dx * seg1seg2dy;\r\n\t\t\t\t\tif ( ( perpSeg2 > 0 ) || ( perpSeg2 < limit ) ) \t\treturn [];\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// i.e. to reduce rounding errors\r\n\t\t\t\t// intersection at endpoint of segment#1?\r\n\t\t\t\tif ( perpSeg2 == 0 ) {\r\n\t\t\t\t\tif ( ( inExcludeAdjacentSegs ) &&\r\n\t\t\t\t\t\t ( ( perpSeg1 == 0 ) || ( perpSeg1 == limit ) ) )\t\treturn [];\r\n\t\t\t\t\treturn [ inSeg1Pt1 ];\r\n\t\t\t\t}\r\n\t\t\t\tif ( perpSeg2 == limit ) {\r\n\t\t\t\t\tif ( ( inExcludeAdjacentSegs ) &&\r\n\t\t\t\t\t\t ( ( perpSeg1 == 0 ) || ( perpSeg1 == limit ) ) )\t\treturn [];\r\n\t\t\t\t\treturn [ inSeg1Pt2 ];\r\n\t\t\t\t}\r\n\t\t\t\t// intersection at endpoint of segment#2?\r\n\t\t\t\tif ( perpSeg1 == 0 )\t\treturn [ inSeg2Pt1 ];\r\n\t\t\t\tif ( perpSeg1 == limit )\treturn [ inSeg2Pt2 ];\r\n\r\n\t\t\t\t// return real intersection point\r\n\t\t\t\tvar factorSeg1 = perpSeg2 / limit;\r\n\t\t\t\treturn\t[ { x: inSeg1Pt1.x + factorSeg1 * seg1dx,\r\n\t\t\t\t\t\t\ty: inSeg1Pt1.y + factorSeg1 * seg1dy } ];\r\n\r\n\t\t\t} else {\t\t// parallel or colinear\r\n\t\t\t\tif ( ( perpSeg1 != 0 ) ||\r\n\t\t\t\t\t ( seg2dy * seg1seg2dx != seg2dx * seg1seg2dy ) ) \t\t\treturn [];\r\n\r\n\t\t\t\t// they are collinear or degenerate\r\n\t\t\t\tvar seg1Pt = ( (seg1dx == 0) && (seg1dy == 0) );\t// segment1 ist just a point?\r\n\t\t\t\tvar seg2Pt = ( (seg2dx == 0) && (seg2dy == 0) );\t// segment2 ist just a point?\r\n\t\t\t\t// both segments are points\r\n\t\t\t\tif ( seg1Pt && seg2Pt ) {\r\n\t\t\t\t\tif ( (inSeg1Pt1.x != inSeg2Pt1.x) ||\r\n\t\t\t\t\t\t (inSeg1Pt1.y != inSeg2Pt1.y) )\t\treturn [];   \t// they are distinct  points\r\n\t\t\t\t\treturn [ inSeg1Pt1 ];                 \t\t\t\t\t// they are the same point\r\n\t\t\t\t}\r\n\t\t\t\t// segment#1  is a single point\r\n\t\t\t\tif ( seg1Pt ) {\r\n\t\t\t\t\tif (! point_in_segment_2D_colin( inSeg2Pt1, inSeg2Pt2, inSeg1Pt1 ) )\t\treturn [];\t\t// but not in segment#2\r\n\t\t\t\t\treturn [ inSeg1Pt1 ];\r\n\t\t\t\t}\r\n\t\t\t\t// segment#2  is a single point\r\n\t\t\t\tif ( seg2Pt ) {\r\n\t\t\t\t\tif (! point_in_segment_2D_colin( inSeg1Pt1, inSeg1Pt2, inSeg2Pt1 ) )\t\treturn [];\t\t// but not in segment#1\r\n\t\t\t\t\treturn [ inSeg2Pt1 ];\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// they are collinear segments, which might overlap\r\n\t\t\t\tvar seg1min, seg1max, seg1minVal, seg1maxVal;\r\n\t\t\t\tvar seg2min, seg2max, seg2minVal, seg2maxVal;\r\n\t\t\t\tif (seg1dx != 0) {\t\t// the segments are NOT on a vertical line\r\n\t\t\t\t\tif ( inSeg1Pt1.x < inSeg1Pt2.x ) {\r\n\t\t\t\t\t\tseg1min = inSeg1Pt1; seg1minVal = inSeg1Pt1.x;\r\n\t\t\t\t\t\tseg1max = inSeg1Pt2; seg1maxVal = inSeg1Pt2.x;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tseg1min = inSeg1Pt2; seg1minVal = inSeg1Pt2.x;\r\n\t\t\t\t\t\tseg1max = inSeg1Pt1; seg1maxVal = inSeg1Pt1.x;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif ( inSeg2Pt1.x < inSeg2Pt2.x ) {\r\n\t\t\t\t\t\tseg2min = inSeg2Pt1; seg2minVal = inSeg2Pt1.x;\r\n\t\t\t\t\t\tseg2max = inSeg2Pt2; seg2maxVal = inSeg2Pt2.x;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tseg2min = inSeg2Pt2; seg2minVal = inSeg2Pt2.x;\r\n\t\t\t\t\t\tseg2max = inSeg2Pt1; seg2maxVal = inSeg2Pt1.x;\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\t\t\t\t// the segments are on a vertical line\r\n\t\t\t\t\tif ( inSeg1Pt1.y < inSeg1Pt2.y ) {\r\n\t\t\t\t\t\tseg1min = inSeg1Pt1; seg1minVal = inSeg1Pt1.y;\r\n\t\t\t\t\t\tseg1max = inSeg1Pt2; seg1maxVal = inSeg1Pt2.y;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tseg1min = inSeg1Pt2; seg1minVal = inSeg1Pt2.y;\r\n\t\t\t\t\t\tseg1max = inSeg1Pt1; seg1maxVal = inSeg1Pt1.y;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif ( inSeg2Pt1.y < inSeg2Pt2.y ) {\r\n\t\t\t\t\t\tseg2min = inSeg2Pt1; seg2minVal = inSeg2Pt1.y;\r\n\t\t\t\t\t\tseg2max = inSeg2Pt2; seg2maxVal = inSeg2Pt2.y;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tseg2min = inSeg2Pt2; seg2minVal = inSeg2Pt2.y;\r\n\t\t\t\t\t\tseg2max = inSeg2Pt1; seg2maxVal = inSeg2Pt1.y;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif ( seg1minVal <= seg2minVal ) {\r\n\t\t\t\t\tif ( seg1maxVal <  seg2minVal )\treturn [];\r\n\t\t\t\t\tif ( seg1maxVal == seg2minVal )\t{\r\n\t\t\t\t\t\tif ( inExcludeAdjacentSegs )\t\treturn [];\r\n\t\t\t\t\t\treturn [ seg2min ];\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif ( seg1maxVal <= seg2maxVal )\treturn [ seg2min, seg1max ];\r\n\t\t\t\t\treturn\t[ seg2min, seg2max ];\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif ( seg1minVal >  seg2maxVal )\treturn [];\r\n\t\t\t\t\tif ( seg1minVal == seg2maxVal )\t{\r\n\t\t\t\t\t\tif ( inExcludeAdjacentSegs )\t\treturn [];\r\n\t\t\t\t\t\treturn [ seg1min ];\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif ( seg1maxVal <= seg2maxVal )\treturn [ seg1min, seg1max ];\r\n\t\t\t\t\treturn\t[ seg1min, seg2max ];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfunction isPointInsideAngle( inVertex, inLegFromPt, inLegToPt, inOtherPt ) {\r\n\t\t\t// The order of legs is important\r\n\r\n\t\t\tvar EPSILON = 0.0000000001;\r\n\r\n\t\t\t// translation of all points, so that Vertex is at (0,0)\r\n\t\t\tvar legFromPtX\t= inLegFromPt.x - inVertex.x,  legFromPtY\t= inLegFromPt.y - inVertex.y;\r\n\t\t\tvar legToPtX\t= inLegToPt.x\t- inVertex.x,  legToPtY\t\t= inLegToPt.y\t- inVertex.y;\r\n\t\t\tvar otherPtX\t= inOtherPt.x\t- inVertex.x,  otherPtY\t\t= inOtherPt.y\t- inVertex.y;\r\n\r\n\t\t\t// main angle >0: < 180 deg.; 0: 180 deg.; <0: > 180 deg.\r\n\t\t\tvar from2toAngle\t= legFromPtX * legToPtY - legFromPtY * legToPtX;\r\n\t\t\tvar from2otherAngle\t= legFromPtX * otherPtY - legFromPtY * otherPtX;\r\n\r\n\t\t\tif ( Math.abs(from2toAngle) > EPSILON ) {\t\t\t// angle != 180 deg.\r\n\r\n\t\t\t\tvar other2toAngle\t\t= otherPtX * legToPtY - otherPtY * legToPtX;\r\n\t\t\t\t// console.log( \"from2to: \" + from2toAngle + \", from2other: \" + from2otherAngle + \", other2to: \" + other2toAngle );\r\n\r\n\t\t\t\tif ( from2toAngle > 0 ) {\t\t\t\t// main angle < 180 deg.\r\n\t\t\t\t\treturn\t( ( from2otherAngle >= 0 ) && ( other2toAngle >= 0 ) );\r\n\t\t\t\t} else {\t\t\t\t\t\t\t\t// main angle > 180 deg.\r\n\t\t\t\t\treturn\t( ( from2otherAngle >= 0 ) || ( other2toAngle >= 0 ) );\r\n\t\t\t\t}\r\n\t\t\t} else {\t\t\t\t\t\t\t\t\t\t// angle == 180 deg.\r\n\t\t\t\t// console.log( \"from2to: 180 deg., from2other: \" + from2otherAngle  );\r\n\t\t\t\treturn\t( from2otherAngle > 0 );\r\n\t\t\t}\r\n\t\t}\r\n\r\n\r\n\t\tfunction removeHoles( contour, holes ) {\r\n\r\n\t\t\tvar shape = contour.concat(); // work on this shape\r\n\t\t\tvar hole;\r\n\r\n\t\t\tfunction isCutLineInsideAngles( inShapeIdx, inHoleIdx ) {\r\n\t\t\t\t// Check if hole point lies within angle around shape point\r\n\t\t\t\tvar lastShapeIdx = shape.length - 1;\r\n\r\n\t\t\t\tvar prevShapeIdx = inShapeIdx - 1;\r\n\t\t\t\tif ( prevShapeIdx < 0 )\t\t\tprevShapeIdx = lastShapeIdx;\r\n\r\n\t\t\t\tvar nextShapeIdx = inShapeIdx + 1;\r\n\t\t\t\tif ( nextShapeIdx > lastShapeIdx )\tnextShapeIdx = 0;\r\n\r\n\t\t\t\tvar insideAngle = isPointInsideAngle( shape[inShapeIdx], shape[ prevShapeIdx ], shape[ nextShapeIdx ], hole[inHoleIdx] );\r\n\t\t\t\tif (! insideAngle ) {\r\n\t\t\t\t\t// console.log( \"Vertex (Shape): \" + inShapeIdx + \", Point: \" + hole[inHoleIdx].x + \"/\" + hole[inHoleIdx].y );\r\n\t\t\t\t\treturn\tfalse;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Check if shape point lies within angle around hole point\r\n\t\t\t\tvar lastHoleIdx = hole.length - 1;\r\n\r\n\t\t\t\tvar prevHoleIdx = inHoleIdx - 1;\r\n\t\t\t\tif ( prevHoleIdx < 0 )\t\t\tprevHoleIdx = lastHoleIdx;\r\n\r\n\t\t\t\tvar nextHoleIdx = inHoleIdx + 1;\r\n\t\t\t\tif ( nextHoleIdx > lastHoleIdx )\tnextHoleIdx = 0;\r\n\r\n\t\t\t\tinsideAngle = isPointInsideAngle( hole[inHoleIdx], hole[ prevHoleIdx ], hole[ nextHoleIdx ], shape[inShapeIdx] );\r\n\t\t\t\tif (! insideAngle ) {\r\n\t\t\t\t\t// console.log( \"Vertex (Hole): \" + inHoleIdx + \", Point: \" + shape[inShapeIdx].x + \"/\" + shape[inShapeIdx].y );\r\n\t\t\t\t\treturn\tfalse;\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn\ttrue;\r\n\t\t\t}\r\n\r\n\t\t\tfunction intersectsShapeEdge( inShapePt, inHolePt ) {\r\n\t\t\t\t// checks for intersections with shape edges\r\n\t\t\t\tvar sIdx, nextIdx, intersection;\r\n\t\t\t\tfor ( sIdx = 0; sIdx < shape.length; sIdx ++ ) {\r\n\t\t\t\t\tnextIdx = sIdx + 1; nextIdx %= shape.length;\r\n\t\t\t\t\tintersection = intersect_segments_2D( inShapePt, inHolePt, shape[sIdx], shape[nextIdx], true );\r\n\t\t\t\t\tif ( intersection.length > 0 )\t\treturn\ttrue;\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn\tfalse;\r\n\t\t\t}\r\n\r\n\t\t\tvar indepHoles = [];\r\n\r\n\t\t\tfunction intersectsHoleEdge( inShapePt, inHolePt ) {\r\n\t\t\t\t// checks for intersections with hole edges\r\n\t\t\t\tvar ihIdx, chkHole,\r\n\t\t\t\t\thIdx, nextIdx, intersection;\r\n\t\t\t\tfor ( ihIdx = 0; ihIdx < indepHoles.length; ihIdx ++ ) {\r\n\t\t\t\t\tchkHole = holes[indepHoles[ihIdx]];\r\n\t\t\t\t\tfor ( hIdx = 0; hIdx < chkHole.length; hIdx ++ ) {\r\n\t\t\t\t\t\tnextIdx = hIdx + 1; nextIdx %= chkHole.length;\r\n\t\t\t\t\t\tintersection = intersect_segments_2D( inShapePt, inHolePt, chkHole[hIdx], chkHole[nextIdx], true );\r\n\t\t\t\t\t\tif ( intersection.length > 0 )\t\treturn\ttrue;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\treturn\tfalse;\r\n\t\t\t}\r\n\r\n\t\t\tvar holeIndex, shapeIndex,\r\n\t\t\t\tshapePt, holePt,\r\n\t\t\t\tholeIdx, cutKey, failedCuts = [],\r\n\t\t\t\ttmpShape1, tmpShape2,\r\n\t\t\t\ttmpHole1, tmpHole2;\r\n\r\n\t\t\tfor ( var h = 0, hl = holes.length; h < hl; h ++ ) {\r\n\r\n\t\t\t\tindepHoles.push( h );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tvar minShapeIndex = 0;\r\n\t\t\tvar counter = indepHoles.length * 2;\r\n\t\t\twhile ( indepHoles.length > 0 ) {\r\n\t\t\t\tcounter --;\r\n\t\t\t\tif ( counter < 0 ) {\r\n\t\t\t\t\tconsole.log( \"Infinite Loop! Holes left:\" + indepHoles.length + \", Probably Hole outside Shape!\" );\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// search for shape-vertex and hole-vertex,\r\n\t\t\t\t// which can be connected without intersections\r\n\t\t\t\tfor ( shapeIndex = minShapeIndex; shapeIndex < shape.length; shapeIndex ++ ) {\r\n\r\n\t\t\t\t\tshapePt = shape[ shapeIndex ];\r\n\t\t\t\t\tholeIndex\t= - 1;\r\n\r\n\t\t\t\t\t// search for hole which can be reached without intersections\r\n\t\t\t\t\tfor ( var h = 0; h < indepHoles.length; h ++ ) {\r\n\t\t\t\t\t\tholeIdx = indepHoles[h];\r\n\r\n\t\t\t\t\t\t// prevent multiple checks\r\n\t\t\t\t\t\tcutKey = shapePt.x + \":\" + shapePt.y + \":\" + holeIdx;\r\n\t\t\t\t\t\tif ( failedCuts[cutKey] !== undefined )\t\t\tcontinue;\r\n\r\n\t\t\t\t\t\thole = holes[holeIdx];\r\n\t\t\t\t\t\tfor ( var h2 = 0; h2 < hole.length; h2 ++ ) {\r\n\t\t\t\t\t\t\tholePt = hole[ h2 ];\r\n\t\t\t\t\t\t\tif (! isCutLineInsideAngles( shapeIndex, h2 ) )\t\tcontinue;\r\n\t\t\t\t\t\t\tif ( intersectsShapeEdge( shapePt, holePt ) )\t\tcontinue;\r\n\t\t\t\t\t\t\tif ( intersectsHoleEdge( shapePt, holePt ) )\t\tcontinue;\r\n\r\n\t\t\t\t\t\t\tholeIndex = h2;\r\n\t\t\t\t\t\t\tindepHoles.splice(h, 1);\r\n\r\n\t\t\t\t\t\t\ttmpShape1 = shape.slice( 0, shapeIndex + 1 );\r\n\t\t\t\t\t\t\ttmpShape2 = shape.slice( shapeIndex );\r\n\t\t\t\t\t\t\ttmpHole1 = hole.slice( holeIndex );\r\n\t\t\t\t\t\t\ttmpHole2 = hole.slice( 0, holeIndex + 1 );\r\n\r\n\t\t\t\t\t\t\tshape = tmpShape1.concat( tmpHole1 ).concat( tmpHole2 ).concat( tmpShape2 );\r\n\r\n\t\t\t\t\t\t\tminShapeIndex = shapeIndex;\r\n\r\n\t\t\t\t\t\t\t// Debug only, to show the selected cuts\r\n\t\t\t\t\t\t\t// glob_CutLines.push( [ shapePt, holePt ] );\r\n\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif ( holeIndex >= 0 )\tbreak;\t\t// hole-vertex found\r\n\r\n\t\t\t\t\t\tfailedCuts[cutKey] = true;\t\t\t// remember failure\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif ( holeIndex >= 0 )\tbreak;\t\t// hole-vertex found\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn shape; \t\t\t/* shape with no holes */\r\n\t\t}\r\n\r\n\r\n\t\tvar i, il, f, face,\r\n\t\t\tkey, index,\r\n\t\t\tallPointsMap = {};\r\n\r\n\t\t// To maintain reference to old shape, one must match coordinates, or offset the indices from original arrays. It's probably easier to do the first.\r\n\r\n\t\tvar allpoints = contour.concat();\r\n\r\n\t\tfor ( var h = 0, hl = holes.length; h < hl; h ++ ) {\r\n\r\n\t\t\tArray.prototype.push.apply( allpoints, holes[h] );\r\n\r\n\t\t}\r\n\r\n\t\t//console.log( \"allpoints\",allpoints, allpoints.length );\r\n\r\n\t\t// prepare all points map\r\n\r\n\t\tfor ( i = 0, il = allpoints.length; i < il; i ++ ) {\r\n\r\n\t\t\tkey = allpoints[ i ].x + \":\" + allpoints[ i ].y;\r\n\r\n\t\t\tif ( allPointsMap[ key ] !== undefined ) {\r\n\r\n\t\t\t\tTHREE.warn( \"THREE.Shape: Duplicate point\", key );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tallPointsMap[ key ] = i;\r\n\r\n\t\t}\r\n\r\n\t\t// remove holes by cutting paths to holes and adding them to the shape\r\n\t\tvar shapeWithoutHoles = removeHoles( contour, holes );\r\n\r\n\t\tvar triangles = THREE.FontUtils.Triangulate( shapeWithoutHoles, false ); // True returns indices for points of spooled shape\r\n\t\t//console.log( \"triangles\",triangles, triangles.length );\r\n\r\n\t\t// check all face vertices against all points map\r\n\r\n\t\tfor ( i = 0, il = triangles.length; i < il; i ++ ) {\r\n\r\n\t\t\tface = triangles[ i ];\r\n\r\n\t\t\tfor ( f = 0; f < 3; f ++ ) {\r\n\r\n\t\t\t\tkey = face[ f ].x + \":\" + face[ f ].y;\r\n\r\n\t\t\t\tindex = allPointsMap[ key ];\r\n\r\n\t\t\t\tif ( index !== undefined ) {\r\n\r\n\t\t\t\t\tface[ f ] = index;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\treturn triangles.concat();\r\n\r\n\t},\r\n\r\n\tisClockWise: function ( pts ) {\r\n\r\n\t\treturn THREE.FontUtils.Triangulate.area( pts ) < 0;\r\n\r\n\t},\r\n\r\n\t// Bezier Curves formulas obtained from\r\n\t// http://en.wikipedia.org/wiki/B%C3%A9zier_curve\r\n\r\n\t// Quad Bezier Functions\r\n\r\n\tb2p0: function ( t, p ) {\r\n\r\n\t\tvar k = 1 - t;\r\n\t\treturn k * k * p;\r\n\r\n\t},\r\n\r\n\tb2p1: function ( t, p ) {\r\n\r\n\t\treturn 2 * ( 1 - t ) * t * p;\r\n\r\n\t},\r\n\r\n\tb2p2: function ( t, p ) {\r\n\r\n\t\treturn t * t * p;\r\n\r\n\t},\r\n\r\n\tb2: function ( t, p0, p1, p2 ) {\r\n\r\n\t\treturn this.b2p0( t, p0 ) + this.b2p1( t, p1 ) + this.b2p2( t, p2 );\r\n\r\n\t},\r\n\r\n\t// Cubic Bezier Functions\r\n\r\n\tb3p0: function ( t, p ) {\r\n\r\n\t\tvar k = 1 - t;\r\n\t\treturn k * k * k * p;\r\n\r\n\t},\r\n\r\n\tb3p1: function ( t, p ) {\r\n\r\n\t\tvar k = 1 - t;\r\n\t\treturn 3 * k * k * t * p;\r\n\r\n\t},\r\n\r\n\tb3p2: function ( t, p ) {\r\n\r\n\t\tvar k = 1 - t;\r\n\t\treturn 3 * k * t * t * p;\r\n\r\n\t},\r\n\r\n\tb3p3: function ( t, p ) {\r\n\r\n\t\treturn t * t * t * p;\r\n\r\n\t},\r\n\r\n\tb3: function ( t, p0, p1, p2, p3 ) {\r\n\r\n\t\treturn this.b3p0( t, p0 ) + this.b3p1( t, p1 ) + this.b3p2( t, p2 ) +  this.b3p3( t, p3 );\r\n\r\n\t}\r\n\r\n};\r\n\r\n\r\n// File:src/extras/curves/LineCurve.js\r\n\r\n/**************************************************************\r\n *\tLine\r\n **************************************************************/\r\n\r\nTHREE.LineCurve = function ( v1, v2 ) {\r\n\r\n\tthis.v1 = v1;\r\n\tthis.v2 = v2;\r\n\r\n};\r\n\r\nTHREE.LineCurve.prototype = Object.create( THREE.Curve.prototype );\r\nTHREE.LineCurve.prototype.constructor = THREE.LineCurve;\r\n\r\nTHREE.LineCurve.prototype.getPoint = function ( t ) {\r\n\r\n\tvar point = this.v2.clone().sub(this.v1);\r\n\tpoint.multiplyScalar( t ).add( this.v1 );\r\n\r\n\treturn point;\r\n\r\n};\r\n\r\n// Line curve is linear, so we can overwrite default getPointAt\r\n\r\nTHREE.LineCurve.prototype.getPointAt = function ( u ) {\r\n\r\n\treturn this.getPoint( u );\r\n\r\n};\r\n\r\nTHREE.LineCurve.prototype.getTangent = function( t ) {\r\n\r\n\tvar tangent = this.v2.clone().sub(this.v1);\r\n\r\n\treturn tangent.normalize();\r\n\r\n};\r\n\r\n// File:src/extras/curves/QuadraticBezierCurve.js\r\n\r\n/**************************************************************\r\n *\tQuadratic Bezier curve\r\n **************************************************************/\r\n\r\n\r\nTHREE.QuadraticBezierCurve = function ( v0, v1, v2 ) {\r\n\r\n\tthis.v0 = v0;\r\n\tthis.v1 = v1;\r\n\tthis.v2 = v2;\r\n\r\n};\r\n\r\nTHREE.QuadraticBezierCurve.prototype = Object.create( THREE.Curve.prototype );\r\nTHREE.QuadraticBezierCurve.prototype.constructor = THREE.QuadraticBezierCurve;\r\n\r\n\r\nTHREE.QuadraticBezierCurve.prototype.getPoint = function ( t ) {\r\n\r\n\tvar vector = new THREE.Vector2();\r\n\r\n\tvector.x = THREE.Shape.Utils.b2( t, this.v0.x, this.v1.x, this.v2.x );\r\n\tvector.y = THREE.Shape.Utils.b2( t, this.v0.y, this.v1.y, this.v2.y );\r\n\r\n\treturn vector;\r\n\r\n};\r\n\r\n\r\nTHREE.QuadraticBezierCurve.prototype.getTangent = function( t ) {\r\n\r\n\tvar vector = new THREE.Vector2();\r\n\r\n\tvector.x = THREE.Curve.Utils.tangentQuadraticBezier( t, this.v0.x, this.v1.x, this.v2.x );\r\n\tvector.y = THREE.Curve.Utils.tangentQuadraticBezier( t, this.v0.y, this.v1.y, this.v2.y );\r\n\r\n\t// returns unit vector\r\n\r\n\treturn vector.normalize();\r\n\r\n};\r\n\r\n// File:src/extras/curves/CubicBezierCurve.js\r\n\r\n/**************************************************************\r\n *\tCubic Bezier curve\r\n **************************************************************/\r\n\r\nTHREE.CubicBezierCurve = function ( v0, v1, v2, v3 ) {\r\n\r\n\tthis.v0 = v0;\r\n\tthis.v1 = v1;\r\n\tthis.v2 = v2;\r\n\tthis.v3 = v3;\r\n\r\n};\r\n\r\nTHREE.CubicBezierCurve.prototype = Object.create( THREE.Curve.prototype );\r\nTHREE.CubicBezierCurve.prototype.constructor = THREE.CubicBezierCurve;\r\n\r\nTHREE.CubicBezierCurve.prototype.getPoint = function ( t ) {\r\n\r\n\tvar tx, ty;\r\n\r\n\ttx = THREE.Shape.Utils.b3( t, this.v0.x, this.v1.x, this.v2.x, this.v3.x );\r\n\tty = THREE.Shape.Utils.b3( t, this.v0.y, this.v1.y, this.v2.y, this.v3.y );\r\n\r\n\treturn new THREE.Vector2( tx, ty );\r\n\r\n};\r\n\r\nTHREE.CubicBezierCurve.prototype.getTangent = function( t ) {\r\n\r\n\tvar tx, ty;\r\n\r\n\ttx = THREE.Curve.Utils.tangentCubicBezier( t, this.v0.x, this.v1.x, this.v2.x, this.v3.x );\r\n\tty = THREE.Curve.Utils.tangentCubicBezier( t, this.v0.y, this.v1.y, this.v2.y, this.v3.y );\r\n\r\n\tvar tangent = new THREE.Vector2( tx, ty );\r\n\ttangent.normalize();\r\n\r\n\treturn tangent;\r\n\r\n};\r\n\r\n// File:src/extras/curves/SplineCurve.js\r\n\r\n/**************************************************************\r\n *\tSpline curve\r\n **************************************************************/\r\n\r\nTHREE.SplineCurve = function ( points /* array of Vector2 */ ) {\r\n\r\n\tthis.points = ( points == undefined ) ? [] : points;\r\n\r\n};\r\n\r\nTHREE.SplineCurve.prototype = Object.create( THREE.Curve.prototype );\r\nTHREE.SplineCurve.prototype.constructor = THREE.SplineCurve;\r\n\r\nTHREE.SplineCurve.prototype.getPoint = function ( t ) {\r\n\r\n\tvar points = this.points;\r\n\tvar point = ( points.length - 1 ) * t;\r\n\r\n\tvar intPoint = Math.floor( point );\r\n\tvar weight = point - intPoint;\r\n\r\n\tvar point0 = points[ intPoint == 0 ? intPoint : intPoint - 1 ]\r\n\tvar point1 = points[ intPoint ]\r\n\tvar point2 = points[ intPoint > points.length - 2 ? points.length - 1 : intPoint + 1 ]\r\n\tvar point3 = points[ intPoint > points.length - 3 ? points.length - 1 : intPoint + 2 ]\r\n\r\n\tvar vector = new THREE.Vector2();\r\n\r\n\tvector.x = THREE.Curve.Utils.interpolate( point0.x, point1.x, point2.x, point3.x, weight );\r\n\tvector.y = THREE.Curve.Utils.interpolate( point0.y, point1.y, point2.y, point3.y, weight );\r\n\r\n\treturn vector;\r\n\r\n};\r\n\r\n// File:src/extras/curves/EllipseCurve.js\r\n\r\n/**************************************************************\r\n *\tEllipse curve\r\n **************************************************************/\r\n\r\nTHREE.EllipseCurve = function ( aX, aY, xRadius, yRadius, aStartAngle, aEndAngle, aClockwise ) {\r\n\r\n\tthis.aX = aX;\r\n\tthis.aY = aY;\r\n\r\n\tthis.xRadius = xRadius;\r\n\tthis.yRadius = yRadius;\r\n\r\n\tthis.aStartAngle = aStartAngle;\r\n\tthis.aEndAngle = aEndAngle;\r\n\r\n\tthis.aClockwise = aClockwise;\r\n\r\n};\r\n\r\nTHREE.EllipseCurve.prototype = Object.create( THREE.Curve.prototype );\r\nTHREE.EllipseCurve.prototype.constructor = THREE.EllipseCurve;\r\n\r\nTHREE.EllipseCurve.prototype.getPoint = function ( t ) {\r\n\r\n\tvar deltaAngle = this.aEndAngle - this.aStartAngle;\r\n\r\n\tif ( deltaAngle < 0 ) deltaAngle += Math.PI * 2;\r\n\tif ( deltaAngle > Math.PI * 2 ) deltaAngle -= Math.PI * 2;\r\n\r\n\tvar angle;\r\n\r\n\tif ( this.aClockwise === true ) {\r\n\r\n\t\tangle = this.aEndAngle + ( 1 - t ) * ( Math.PI * 2 - deltaAngle );\r\n\r\n\t} else {\r\n\r\n\t\tangle = this.aStartAngle + t * deltaAngle;\r\n\r\n\t}\r\n\t\r\n\tvar vector = new THREE.Vector2();\r\n\r\n\tvector.x = this.aX + this.xRadius * Math.cos( angle );\r\n\tvector.y = this.aY + this.yRadius * Math.sin( angle );\r\n\r\n\treturn vector;\r\n\r\n};\r\n\r\n// File:src/extras/curves/ArcCurve.js\r\n\r\n/**************************************************************\r\n *\tArc curve\r\n **************************************************************/\r\n\r\nTHREE.ArcCurve = function ( aX, aY, aRadius, aStartAngle, aEndAngle, aClockwise ) {\r\n\r\n\tTHREE.EllipseCurve.call( this, aX, aY, aRadius, aRadius, aStartAngle, aEndAngle, aClockwise );\r\n};\r\n\r\nTHREE.ArcCurve.prototype = Object.create( THREE.EllipseCurve.prototype );\r\nTHREE.ArcCurve.prototype.constructor = THREE.ArcCurve;\r\n\r\n// File:src/extras/curves/LineCurve3.js\r\n\r\n/**************************************************************\r\n *\tLine3D\r\n **************************************************************/\r\n\r\nTHREE.LineCurve3 = THREE.Curve.create(\r\n\r\n\tfunction ( v1, v2 ) {\r\n\r\n\t\tthis.v1 = v1;\r\n\t\tthis.v2 = v2;\r\n\r\n\t},\r\n\r\n\tfunction ( t ) {\r\n\r\n\t\tvar vector = new THREE.Vector3();\r\n\r\n\t\tvector.subVectors( this.v2, this.v1 ); // diff\r\n\t\tvector.multiplyScalar( t );\r\n\t\tvector.add( this.v1 );\r\n\r\n\t\treturn vector;\r\n\r\n\t}\r\n\r\n);\r\n\r\n// File:src/extras/curves/QuadraticBezierCurve3.js\r\n\r\n/**************************************************************\r\n *\tQuadratic Bezier 3D curve\r\n **************************************************************/\r\n\r\nTHREE.QuadraticBezierCurve3 = THREE.Curve.create(\r\n\r\n\tfunction ( v0, v1, v2 ) {\r\n\r\n\t\tthis.v0 = v0;\r\n\t\tthis.v1 = v1;\r\n\t\tthis.v2 = v2;\r\n\r\n\t},\r\n\r\n\tfunction ( t ) {\r\n\r\n\t\tvar vector = new THREE.Vector3();\r\n\r\n\t\tvector.x = THREE.Shape.Utils.b2( t, this.v0.x, this.v1.x, this.v2.x );\r\n\t\tvector.y = THREE.Shape.Utils.b2( t, this.v0.y, this.v1.y, this.v2.y );\r\n\t\tvector.z = THREE.Shape.Utils.b2( t, this.v0.z, this.v1.z, this.v2.z );\r\n\r\n\t\treturn vector;\r\n\r\n\t}\r\n\r\n);\r\n\r\n// File:src/extras/curves/CubicBezierCurve3.js\r\n\r\n/**************************************************************\r\n *\tCubic Bezier 3D curve\r\n **************************************************************/\r\n\r\nTHREE.CubicBezierCurve3 = THREE.Curve.create(\r\n\r\n\tfunction ( v0, v1, v2, v3 ) {\r\n\r\n\t\tthis.v0 = v0;\r\n\t\tthis.v1 = v1;\r\n\t\tthis.v2 = v2;\r\n\t\tthis.v3 = v3;\r\n\r\n\t},\r\n\r\n\tfunction ( t ) {\r\n\r\n\t\tvar vector = new THREE.Vector3();\r\n\r\n\t\tvector.x = THREE.Shape.Utils.b3( t, this.v0.x, this.v1.x, this.v2.x, this.v3.x );\r\n\t\tvector.y = THREE.Shape.Utils.b3( t, this.v0.y, this.v1.y, this.v2.y, this.v3.y );\r\n\t\tvector.z = THREE.Shape.Utils.b3( t, this.v0.z, this.v1.z, this.v2.z, this.v3.z );\r\n\r\n\t\treturn vector;\r\n\r\n\t}\r\n\r\n);\r\n\r\n// File:src/extras/curves/SplineCurve3.js\r\n\r\n/**************************************************************\r\n *\tSpline 3D curve\r\n **************************************************************/\r\n\r\n\r\nTHREE.SplineCurve3 = THREE.Curve.create(\r\n\r\n\tfunction ( points /* array of Vector3 */) {\r\n\r\n\t\tthis.points = ( points == undefined ) ? [] : points;\r\n\r\n\t},\r\n\r\n\tfunction ( t ) {\r\n\r\n\t\tvar points = this.points;\r\n\t\tvar point = ( points.length - 1 ) * t;\r\n\r\n\t\tvar intPoint = Math.floor( point );\r\n\t\tvar weight = point - intPoint;\r\n\r\n\t\tvar point0 = points[ intPoint == 0 ? intPoint : intPoint - 1 ];\r\n\t\tvar point1 = points[ intPoint ];\r\n\t\tvar point2 = points[ intPoint > points.length - 2 ? points.length - 1 : intPoint + 1 ];\r\n\t\tvar point3 = points[ intPoint > points.length - 3 ? points.length - 1 : intPoint + 2 ];\r\n\r\n\t\tvar vector = new THREE.Vector3();\r\n\r\n\t\tvector.x = THREE.Curve.Utils.interpolate( point0.x, point1.x, point2.x, point3.x, weight );\r\n\t\tvector.y = THREE.Curve.Utils.interpolate( point0.y, point1.y, point2.y, point3.y, weight );\r\n\t\tvector.z = THREE.Curve.Utils.interpolate( point0.z, point1.z, point2.z, point3.z, weight );\r\n\r\n\t\treturn vector;\r\n\r\n\t}\r\n\r\n);\r\n\r\n// File:src/extras/curves/ClosedSplineCurve3.js\r\n\r\n/**************************************************************\r\n *\tClosed Spline 3D curve\r\n **************************************************************/\r\n\r\n\r\nTHREE.ClosedSplineCurve3 = THREE.Curve.create(\r\n\r\n\tfunction ( points /* array of Vector3 */) {\r\n\r\n\t\tthis.points = ( points == undefined ) ? [] : points;\r\n\r\n\t},\r\n\r\n\tfunction ( t ) {\r\n\r\n\t\tvar points = this.points;\r\n\t\tvar point = ( points.length - 0 ) * t; // This needs to be from 0-length +1\r\n\r\n\t\tvar intPoint = Math.floor( point );\r\n\t\tvar weight = point - intPoint;\r\n\r\n\t\tintPoint += intPoint > 0 ? 0 : ( Math.floor( Math.abs( intPoint ) / points.length ) + 1 ) * points.length;\r\n\r\n\t\tvar point0 = points[ ( intPoint - 1 ) % points.length ];\r\n\t\tvar point1 = points[ ( intPoint     ) % points.length ];\r\n\t\tvar point2 = points[ ( intPoint + 1 ) % points.length ];\r\n\t\tvar point3 = points[ ( intPoint + 2 ) % points.length ];\r\n\r\n\t\tvar vector = new THREE.Vector3();\r\n\r\n\t\tvector.x = THREE.Curve.Utils.interpolate( point0.x, point1.x, point2.x, point3.x, weight );\r\n\t\tvector.y = THREE.Curve.Utils.interpolate( point0.y, point1.y, point2.y, point3.y, weight );\r\n\t\tvector.z = THREE.Curve.Utils.interpolate( point0.z, point1.z, point2.z, point3.z, weight );\r\n\r\n\t\treturn vector;\r\n\r\n\t}\r\n\r\n);\r\n\r\n// File:src/extras/animation/AnimationHandler.js\r\n\r\n/**\r\n * @author mikael emtinger / http://gomo.se/\r\n */\r\n\r\nTHREE.AnimationHandler = {\r\n\r\n\tLINEAR: 0,\r\n\tCATMULLROM: 1,\r\n\tCATMULLROM_FORWARD: 2,\r\n\r\n\t//\r\n\r\n\tadd: function () { THREE.warn( 'THREE.AnimationHandler.add() has been deprecated.' ); },\r\n\tget: function () { THREE.warn( 'THREE.AnimationHandler.get() has been deprecated.' ); },\r\n\tremove: function () { THREE.warn( 'THREE.AnimationHandler.remove() has been deprecated.' ); },\r\n\r\n\t//\r\n\r\n\tanimations: [],\r\n\r\n\tinit: function ( data ) {\r\n\r\n\t\tif ( data.initialized === true ) return data;\r\n\r\n\t\t// loop through all keys\r\n\r\n\t\tfor ( var h = 0; h < data.hierarchy.length; h ++ ) {\r\n\r\n\t\t\tfor ( var k = 0; k < data.hierarchy[ h ].keys.length; k ++ ) {\r\n\r\n\t\t\t\t// remove minus times\r\n\r\n\t\t\t\tif ( data.hierarchy[ h ].keys[ k ].time < 0 ) {\r\n\r\n\t\t\t\t\t data.hierarchy[ h ].keys[ k ].time = 0;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// create quaternions\r\n\r\n\t\t\t\tif ( data.hierarchy[ h ].keys[ k ].rot !== undefined &&\r\n\t\t\t\t  ! ( data.hierarchy[ h ].keys[ k ].rot instanceof THREE.Quaternion ) ) {\r\n\r\n\t\t\t\t\tvar quat = data.hierarchy[ h ].keys[ k ].rot;\r\n\t\t\t\t\tdata.hierarchy[ h ].keys[ k ].rot = new THREE.Quaternion().fromArray( quat );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\t// prepare morph target keys\r\n\r\n\t\t\tif ( data.hierarchy[ h ].keys.length && data.hierarchy[ h ].keys[ 0 ].morphTargets !== undefined ) {\r\n\r\n\t\t\t\t// get all used\r\n\r\n\t\t\t\tvar usedMorphTargets = {};\r\n\r\n\t\t\t\tfor ( var k = 0; k < data.hierarchy[ h ].keys.length; k ++ ) {\r\n\r\n\t\t\t\t\tfor ( var m = 0; m < data.hierarchy[ h ].keys[ k ].morphTargets.length; m ++ ) {\r\n\r\n\t\t\t\t\t\tvar morphTargetName = data.hierarchy[ h ].keys[ k ].morphTargets[ m ];\r\n\t\t\t\t\t\tusedMorphTargets[ morphTargetName ] = - 1;\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tdata.hierarchy[ h ].usedMorphTargets = usedMorphTargets;\r\n\r\n\r\n\t\t\t\t// set all used on all frames\r\n\r\n\t\t\t\tfor ( var k = 0; k < data.hierarchy[ h ].keys.length; k ++ ) {\r\n\r\n\t\t\t\t\tvar influences = {};\r\n\r\n\t\t\t\t\tfor ( var morphTargetName in usedMorphTargets ) {\r\n\r\n\t\t\t\t\t\tfor ( var m = 0; m < data.hierarchy[ h ].keys[ k ].morphTargets.length; m ++ ) {\r\n\r\n\t\t\t\t\t\t\tif ( data.hierarchy[ h ].keys[ k ].morphTargets[ m ] === morphTargetName ) {\r\n\r\n\t\t\t\t\t\t\t\tinfluences[ morphTargetName ] = data.hierarchy[ h ].keys[ k ].morphTargetsInfluences[ m ];\r\n\t\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tif ( m === data.hierarchy[ h ].keys[ k ].morphTargets.length ) {\r\n\r\n\t\t\t\t\t\t\tinfluences[ morphTargetName ] = 0;\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tdata.hierarchy[ h ].keys[ k ].morphTargetsInfluences = influences;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\r\n\t\t\t// remove all keys that are on the same time\r\n\r\n\t\t\tfor ( var k = 1; k < data.hierarchy[ h ].keys.length; k ++ ) {\r\n\r\n\t\t\t\tif ( data.hierarchy[ h ].keys[ k ].time === data.hierarchy[ h ].keys[ k - 1 ].time ) {\r\n\r\n\t\t\t\t\tdata.hierarchy[ h ].keys.splice( k, 1 );\r\n\t\t\t\t\tk --;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\r\n\t\t\t// set index\r\n\r\n\t\t\tfor ( var k = 0; k < data.hierarchy[ h ].keys.length; k ++ ) {\r\n\r\n\t\t\t\tdata.hierarchy[ h ].keys[ k ].index = k;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tdata.initialized = true;\r\n\r\n\t\treturn data;\r\n\r\n\t},\r\n\r\n\tparse: function ( root ) {\r\n\r\n\t\tvar parseRecurseHierarchy = function ( root, hierarchy ) {\r\n\r\n\t\t\thierarchy.push( root );\r\n\r\n\t\t\tfor ( var c = 0; c < root.children.length; c ++ )\r\n\t\t\t\tparseRecurseHierarchy( root.children[ c ], hierarchy );\r\n\r\n\t\t};\r\n\r\n\t\t// setup hierarchy\r\n\r\n\t\tvar hierarchy = [];\r\n\r\n\t\tif ( root instanceof THREE.SkinnedMesh ) {\r\n\r\n\t\t\tfor ( var b = 0; b < root.skeleton.bones.length; b ++ ) {\r\n\r\n\t\t\t\thierarchy.push( root.skeleton.bones[ b ] );\r\n\r\n\t\t\t}\r\n\r\n\t\t} else {\r\n\r\n\t\t\tparseRecurseHierarchy( root, hierarchy );\r\n\r\n\t\t}\r\n\r\n\t\treturn hierarchy;\r\n\r\n\t},\r\n\r\n\tplay: function ( animation ) {\r\n\r\n\t\tif ( this.animations.indexOf( animation ) === - 1 ) {\r\n\r\n\t\t\tthis.animations.push( animation );\r\n\r\n\t\t}\r\n\r\n\t},\r\n\r\n\tstop: function ( animation ) {\r\n\r\n\t\tvar index = this.animations.indexOf( animation );\r\n\r\n\t\tif ( index !== - 1 ) {\r\n\r\n\t\t\tthis.animations.splice( index, 1 );\r\n\r\n\t\t}\r\n\r\n\t},\r\n\r\n\tupdate: function ( deltaTimeMS ) {\r\n\r\n\t\tfor ( var i = 0; i < this.animations.length; i ++ ) {\r\n\r\n\t\t\tthis.animations[ i ].resetBlendWeights( );\r\n\r\n\t\t}\r\n\r\n\t\tfor ( var i = 0; i < this.animations.length; i ++ ) {\r\n\r\n\t\t\tthis.animations[ i ].update( deltaTimeMS );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n};\r\n\r\n// File:src/extras/animation/Animation.js\r\n\r\n/**\r\n * @author mikael emtinger / http://gomo.se/\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author alteredq / http://alteredqualia.com/\r\n */\r\n\r\nTHREE.Animation = function ( root, data ) {\r\n\r\n\tthis.root = root;\r\n\tthis.data = THREE.AnimationHandler.init( data );\r\n\tthis.hierarchy = THREE.AnimationHandler.parse( root );\r\n\r\n\tthis.currentTime = 0;\r\n\tthis.timeScale = 1;\r\n\r\n\tthis.isPlaying = false;\r\n\tthis.loop = true;\r\n\tthis.weight = 0;\r\n\r\n\tthis.interpolationType = THREE.AnimationHandler.LINEAR;\r\n\r\n};\r\n\r\nTHREE.Animation.prototype = {\r\n\r\n\tconstructor: THREE.Animation,\r\n\r\n\tkeyTypes:  [ \"pos\", \"rot\", \"scl\" ],\r\n\r\n\tplay: function ( startTime, weight ) {\r\n\r\n\t\tthis.currentTime = startTime !== undefined ? startTime : 0;\r\n\t\tthis.weight = weight !== undefined ? weight : 1;\r\n\r\n\t\tthis.isPlaying = true;\r\n\r\n\t\tthis.reset();\r\n\r\n\t\tTHREE.AnimationHandler.play( this );\r\n\r\n\t},\r\n\r\n\tstop: function() {\r\n\r\n\t\tthis.isPlaying = false;\r\n\r\n\t\tTHREE.AnimationHandler.stop( this );\r\n\r\n\t},\r\n\r\n\treset: function () {\r\n\r\n\t\tfor ( var h = 0, hl = this.hierarchy.length; h < hl; h ++ ) {\r\n\r\n\t\t\tvar object = this.hierarchy[ h ];\r\n\r\n\t\t\tif ( object.animationCache === undefined ) {\r\n\r\n\t\t\t\tobject.animationCache = {\r\n\t\t\t\t\tanimations: {},\r\n\t\t\t\t\tblending: {\r\n\t\t\t\t\t\tpositionWeight: 0.0,\r\n\t\t\t\t\t\tquaternionWeight: 0.0,\r\n\t\t\t\t\t\tscaleWeight: 0.0\r\n\t\t\t\t\t}\r\n\t\t\t\t};\r\n\t\t\t}\r\n\r\n\t\t\tvar name = this.data.name;\r\n\t\t\tvar animations = object.animationCache.animations;\r\n\t\t\tvar animationCache = animations[ name ];\r\n\r\n\t\t\tif ( animationCache === undefined ) {\r\n\r\n\t\t\t\tanimationCache = {\r\n\t\t\t\t\tprevKey: { pos: 0, rot: 0, scl: 0 },\r\n\t\t\t\t\tnextKey: { pos: 0, rot: 0, scl: 0 },\r\n\t\t\t\t\toriginalMatrix: object.matrix\r\n\t\t\t\t};\r\n\r\n\t\t\t\tanimations[ name ] = animationCache;\r\n\r\n\t\t\t}\r\n\r\n\t\t\t// Get keys to match our current time\r\n\r\n\t\t\tfor ( var t = 0; t < 3; t ++ ) {\r\n\r\n\t\t\t\tvar type = this.keyTypes[ t ];\r\n\r\n\t\t\t\tvar prevKey = this.data.hierarchy[ h ].keys[ 0 ];\r\n\t\t\t\tvar nextKey = this.getNextKeyWith( type, h, 1 );\r\n\r\n\t\t\t\twhile ( nextKey.time < this.currentTime && nextKey.index > prevKey.index ) {\r\n\r\n\t\t\t\t\tprevKey = nextKey;\r\n\t\t\t\t\tnextKey = this.getNextKeyWith( type, h, nextKey.index + 1 );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tanimationCache.prevKey[ type ] = prevKey;\r\n\t\t\t\tanimationCache.nextKey[ type ] = nextKey;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t},\r\n\r\n\tresetBlendWeights: function () {\r\n\r\n\t\tfor ( var h = 0, hl = this.hierarchy.length; h < hl; h ++ ) {\r\n\r\n\t\t\tvar object = this.hierarchy[ h ];\r\n\t\t\tvar animationCache = object.animationCache;\r\n\r\n\t\t\tif ( animationCache !== undefined ) {\r\n\r\n\t\t\t\tvar blending = animationCache.blending;\r\n\r\n\t\t\t\tblending.positionWeight = 0.0;\r\n\t\t\t\tblending.quaternionWeight = 0.0;\r\n\t\t\t\tblending.scaleWeight = 0.0;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t},\r\n\r\n\tupdate: ( function() {\r\n\r\n\t\tvar points = [];\r\n\t\tvar target = new THREE.Vector3();\r\n\t\tvar newVector = new THREE.Vector3();\r\n\t\tvar newQuat = new THREE.Quaternion();\r\n\r\n\t\t// Catmull-Rom spline\r\n\r\n\t\tvar interpolateCatmullRom = function ( points, scale ) {\r\n\r\n\t\t\tvar c = [], v3 = [],\r\n\t\t\tpoint, intPoint, weight, w2, w3,\r\n\t\t\tpa, pb, pc, pd;\r\n\r\n\t\t\tpoint = ( points.length - 1 ) * scale;\r\n\t\t\tintPoint = Math.floor( point );\r\n\t\t\tweight = point - intPoint;\r\n\r\n\t\t\tc[ 0 ] = intPoint === 0 ? intPoint : intPoint - 1;\r\n\t\t\tc[ 1 ] = intPoint;\r\n\t\t\tc[ 2 ] = intPoint > points.length - 2 ? intPoint : intPoint + 1;\r\n\t\t\tc[ 3 ] = intPoint > points.length - 3 ? intPoint : intPoint + 2;\r\n\r\n\t\t\tpa = points[ c[ 0 ] ];\r\n\t\t\tpb = points[ c[ 1 ] ];\r\n\t\t\tpc = points[ c[ 2 ] ];\r\n\t\t\tpd = points[ c[ 3 ] ];\r\n\r\n\t\t\tw2 = weight * weight;\r\n\t\t\tw3 = weight * w2;\r\n\r\n\t\t\tv3[ 0 ] = interpolate( pa[ 0 ], pb[ 0 ], pc[ 0 ], pd[ 0 ], weight, w2, w3 );\r\n\t\t\tv3[ 1 ] = interpolate( pa[ 1 ], pb[ 1 ], pc[ 1 ], pd[ 1 ], weight, w2, w3 );\r\n\t\t\tv3[ 2 ] = interpolate( pa[ 2 ], pb[ 2 ], pc[ 2 ], pd[ 2 ], weight, w2, w3 );\r\n\r\n\t\t\treturn v3;\r\n\r\n\t\t};\r\n\r\n\t\tvar interpolate = function ( p0, p1, p2, p3, t, t2, t3 ) {\r\n\r\n\t\t\tvar v0 = ( p2 - p0 ) * 0.5,\r\n\t\t\t\tv1 = ( p3 - p1 ) * 0.5;\r\n\r\n\t\t\treturn ( 2 * ( p1 - p2 ) + v0 + v1 ) * t3 + ( - 3 * ( p1 - p2 ) - 2 * v0 - v1 ) * t2 + v0 * t + p1;\r\n\r\n\t\t};\r\n\r\n\t\treturn function ( delta ) {\r\n\r\n\t\t\tif ( this.isPlaying === false ) return;\r\n\r\n\t\t\tthis.currentTime += delta * this.timeScale;\r\n\r\n\t\t\tif ( this.weight === 0 )\r\n\t\t\t\treturn;\r\n\r\n\t\t\t//\r\n\r\n\t\t\tvar duration = this.data.length;\r\n\r\n\t\t\tif ( this.currentTime > duration || this.currentTime < 0 ) {\r\n\r\n\t\t\t\tif ( this.loop ) {\r\n\r\n\t\t\t\t\tthis.currentTime %= duration;\r\n\r\n\t\t\t\t\tif ( this.currentTime < 0 )\r\n\t\t\t\t\t\tthis.currentTime += duration;\r\n\r\n\t\t\t\t\tthis.reset();\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\tthis.stop();\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\tfor ( var h = 0, hl = this.hierarchy.length; h < hl; h ++ ) {\r\n\r\n\t\t\t\tvar object = this.hierarchy[ h ];\r\n\t\t\t\tvar animationCache = object.animationCache.animations[this.data.name];\r\n\t\t\t\tvar blending = object.animationCache.blending;\r\n\r\n\t\t\t\t// loop through pos/rot/scl\r\n\r\n\t\t\t\tfor ( var t = 0; t < 3; t ++ ) {\r\n\r\n\t\t\t\t\t// get keys\r\n\r\n\t\t\t\t\tvar type    = this.keyTypes[ t ];\r\n\t\t\t\t\tvar prevKey = animationCache.prevKey[ type ];\r\n\t\t\t\t\tvar nextKey = animationCache.nextKey[ type ];\r\n\r\n\t\t\t\t\tif ( ( this.timeScale > 0 && nextKey.time <= this.currentTime ) ||\r\n\t\t\t\t\t\t( this.timeScale < 0 && prevKey.time >= this.currentTime ) ) {\r\n\r\n\t\t\t\t\t\tprevKey = this.data.hierarchy[ h ].keys[ 0 ];\r\n\t\t\t\t\t\tnextKey = this.getNextKeyWith( type, h, 1 );\r\n\r\n\t\t\t\t\t\twhile ( nextKey.time < this.currentTime && nextKey.index > prevKey.index ) {\r\n\r\n\t\t\t\t\t\t\tprevKey = nextKey;\r\n\t\t\t\t\t\t\tnextKey = this.getNextKeyWith( type, h, nextKey.index + 1 );\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tanimationCache.prevKey[ type ] = prevKey;\r\n\t\t\t\t\t\tanimationCache.nextKey[ type ] = nextKey;\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tvar scale = ( this.currentTime - prevKey.time ) / ( nextKey.time - prevKey.time );\r\n\r\n\t\t\t\t\tvar prevXYZ = prevKey[ type ];\r\n\t\t\t\t\tvar nextXYZ = nextKey[ type ];\r\n\r\n\t\t\t\t\tif ( scale < 0 ) scale = 0;\r\n\t\t\t\t\tif ( scale > 1 ) scale = 1;\r\n\r\n\t\t\t\t\t// interpolate\r\n\r\n\t\t\t\t\tif ( type === \"pos\" ) {\r\n\r\n\t\t\t\t\t\tif ( this.interpolationType === THREE.AnimationHandler.LINEAR ) {\r\n\r\n\t\t\t\t\t\t\tnewVector.x = prevXYZ[ 0 ] + ( nextXYZ[ 0 ] - prevXYZ[ 0 ] ) * scale;\r\n\t\t\t\t\t\t\tnewVector.y = prevXYZ[ 1 ] + ( nextXYZ[ 1 ] - prevXYZ[ 1 ] ) * scale;\r\n\t\t\t\t\t\t\tnewVector.z = prevXYZ[ 2 ] + ( nextXYZ[ 2 ] - prevXYZ[ 2 ] ) * scale;\r\n\r\n\t\t\t\t\t\t\t// blend\r\n\t\t\t\t\t\t\tvar proportionalWeight = this.weight / ( this.weight + blending.positionWeight );\r\n\t\t\t\t\t\t\tobject.position.lerp( newVector, proportionalWeight );\r\n\t\t\t\t\t\t\tblending.positionWeight += this.weight;\r\n\r\n\t\t\t\t\t\t} else if ( this.interpolationType === THREE.AnimationHandler.CATMULLROM ||\r\n\t\t\t\t\t\t\t\t\tthis.interpolationType === THREE.AnimationHandler.CATMULLROM_FORWARD ) {\r\n\r\n\t\t\t\t\t\t\tpoints[ 0 ] = this.getPrevKeyWith( \"pos\", h, prevKey.index - 1 )[ \"pos\" ];\r\n\t\t\t\t\t\t\tpoints[ 1 ] = prevXYZ;\r\n\t\t\t\t\t\t\tpoints[ 2 ] = nextXYZ;\r\n\t\t\t\t\t\t\tpoints[ 3 ] = this.getNextKeyWith( \"pos\", h, nextKey.index + 1 )[ \"pos\" ];\r\n\r\n\t\t\t\t\t\t\tscale = scale * 0.33 + 0.33;\r\n\r\n\t\t\t\t\t\t\tvar currentPoint = interpolateCatmullRom( points, scale );\r\n\t\t\t\t\t\t\tvar proportionalWeight = this.weight / ( this.weight + blending.positionWeight );\r\n\t\t\t\t\t\t\tblending.positionWeight += this.weight;\r\n\r\n\t\t\t\t\t\t\t// blend\r\n\r\n\t\t\t\t\t\t\tvar vector = object.position;\r\n\r\n\t\t\t\t\t\t\tvector.x = vector.x + ( currentPoint[ 0 ] - vector.x ) * proportionalWeight;\r\n\t\t\t\t\t\t\tvector.y = vector.y + ( currentPoint[ 1 ] - vector.y ) * proportionalWeight;\r\n\t\t\t\t\t\t\tvector.z = vector.z + ( currentPoint[ 2 ] - vector.z ) * proportionalWeight;\r\n\r\n\t\t\t\t\t\t\tif ( this.interpolationType === THREE.AnimationHandler.CATMULLROM_FORWARD ) {\r\n\r\n\t\t\t\t\t\t\t\tvar forwardPoint = interpolateCatmullRom( points, scale * 1.01 );\r\n\r\n\t\t\t\t\t\t\t\ttarget.set( forwardPoint[ 0 ], forwardPoint[ 1 ], forwardPoint[ 2 ] );\r\n\t\t\t\t\t\t\t\ttarget.sub( vector );\r\n\t\t\t\t\t\t\t\ttarget.y = 0;\r\n\t\t\t\t\t\t\t\ttarget.normalize();\r\n\r\n\t\t\t\t\t\t\t\tvar angle = Math.atan2( target.x, target.z );\r\n\t\t\t\t\t\t\t\tobject.rotation.set( 0, angle, 0 );\r\n\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t} else if ( type === \"rot\" ) {\r\n\r\n\t\t\t\t\t\tTHREE.Quaternion.slerp( prevXYZ, nextXYZ, newQuat, scale );\r\n\r\n\t\t\t\t\t\t// Avoid paying the cost of an additional slerp if we don't have to\r\n\t\t\t\t\t\tif ( blending.quaternionWeight === 0 ) {\r\n\r\n\t\t\t\t\t\t\tobject.quaternion.copy(newQuat);\r\n\t\t\t\t\t\t\tblending.quaternionWeight = this.weight;\r\n\r\n\t\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\t\tvar proportionalWeight = this.weight / ( this.weight + blending.quaternionWeight );\r\n\t\t\t\t\t\t\tTHREE.Quaternion.slerp( object.quaternion, newQuat, object.quaternion, proportionalWeight );\r\n\t\t\t\t\t\t\tblending.quaternionWeight += this.weight;\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t} else if ( type === \"scl\" ) {\r\n\r\n\t\t\t\t\t\tnewVector.x = prevXYZ[ 0 ] + ( nextXYZ[ 0 ] - prevXYZ[ 0 ] ) * scale;\r\n\t\t\t\t\t\tnewVector.y = prevXYZ[ 1 ] + ( nextXYZ[ 1 ] - prevXYZ[ 1 ] ) * scale;\r\n\t\t\t\t\t\tnewVector.z = prevXYZ[ 2 ] + ( nextXYZ[ 2 ] - prevXYZ[ 2 ] ) * scale;\r\n\r\n\t\t\t\t\t\tvar proportionalWeight = this.weight / ( this.weight + blending.scaleWeight );\r\n\t\t\t\t\t\tobject.scale.lerp( newVector, proportionalWeight );\r\n\t\t\t\t\t\tblending.scaleWeight += this.weight;\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn true;\r\n\r\n\t\t};\r\n\r\n\t} )(),\r\n\r\n\tgetNextKeyWith: function ( type, h, key ) {\r\n\r\n\t\tvar keys = this.data.hierarchy[ h ].keys;\r\n\r\n\t\tif ( this.interpolationType === THREE.AnimationHandler.CATMULLROM ||\r\n\t\t\t this.interpolationType === THREE.AnimationHandler.CATMULLROM_FORWARD ) {\r\n\r\n\t\t\tkey = key < keys.length - 1 ? key : keys.length - 1;\r\n\r\n\t\t} else {\r\n\r\n\t\t\tkey = key % keys.length;\r\n\r\n\t\t}\r\n\r\n\t\tfor ( ; key < keys.length; key ++ ) {\r\n\r\n\t\t\tif ( keys[ key ][ type ] !== undefined ) {\r\n\r\n\t\t\t\treturn keys[ key ];\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\treturn this.data.hierarchy[ h ].keys[ 0 ];\r\n\r\n\t},\r\n\r\n\tgetPrevKeyWith: function ( type, h, key ) {\r\n\r\n\t\tvar keys = this.data.hierarchy[ h ].keys;\r\n\r\n\t\tif ( this.interpolationType === THREE.AnimationHandler.CATMULLROM ||\r\n\t\t\tthis.interpolationType === THREE.AnimationHandler.CATMULLROM_FORWARD ) {\r\n\r\n\t\t\tkey = key > 0 ? key : 0;\r\n\r\n\t\t} else {\r\n\r\n\t\t\tkey = key >= 0 ? key : key + keys.length;\r\n\r\n\t\t}\r\n\r\n\r\n\t\tfor ( ; key >= 0; key -- ) {\r\n\r\n\t\t\tif ( keys[ key ][ type ] !== undefined ) {\r\n\r\n\t\t\t\treturn keys[ key ];\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\treturn this.data.hierarchy[ h ].keys[ keys.length - 1 ];\r\n\r\n\t}\r\n\r\n};\r\n\r\n// File:src/extras/animation/KeyFrameAnimation.js\r\n\r\n/**\r\n * @author mikael emtinger / http://gomo.se/\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author alteredq / http://alteredqualia.com/\r\n * @author khang duong\r\n * @author erik kitson\r\n */\r\n\r\nTHREE.KeyFrameAnimation = function ( data ) {\r\n\r\n\tthis.root = data.node;\r\n\tthis.data = THREE.AnimationHandler.init( data );\r\n\tthis.hierarchy = THREE.AnimationHandler.parse( this.root );\r\n\tthis.currentTime = 0;\r\n\tthis.timeScale = 0.001;\r\n\tthis.isPlaying = false;\r\n\tthis.isPaused = true;\r\n\tthis.loop = true;\r\n\r\n\t// initialize to first keyframes\r\n\r\n\tfor ( var h = 0, hl = this.hierarchy.length; h < hl; h ++ ) {\r\n\r\n\t\tvar keys = this.data.hierarchy[h].keys,\r\n\t\t\tsids = this.data.hierarchy[h].sids,\r\n\t\t\tobj = this.hierarchy[h];\r\n\r\n\t\tif ( keys.length && sids ) {\r\n\r\n\t\t\tfor ( var s = 0; s < sids.length; s ++ ) {\r\n\r\n\t\t\t\tvar sid = sids[ s ],\r\n\t\t\t\t\tnext = this.getNextKeyWith( sid, h, 0 );\r\n\r\n\t\t\t\tif ( next ) {\r\n\r\n\t\t\t\t\tnext.apply( sid );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\tobj.matrixAutoUpdate = false;\r\n\t\t\tthis.data.hierarchy[h].node.updateMatrix();\r\n\t\t\tobj.matrixWorldNeedsUpdate = true;\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n};\r\n\r\nTHREE.KeyFrameAnimation.prototype = {\r\n\r\n\tconstructor: THREE.KeyFrameAnimation,\r\n\r\n\tplay: function ( startTime ) {\r\n\r\n\t\tthis.currentTime = startTime !== undefined ? startTime : 0;\r\n\r\n\t\tif ( this.isPlaying === false ) {\r\n\r\n\t\t\tthis.isPlaying = true;\r\n\r\n\t\t\t// reset key cache\r\n\r\n\t\t\tvar h, hl = this.hierarchy.length,\r\n\t\t\t\tobject,\r\n\t\t\t\tnode;\r\n\r\n\t\t\tfor ( h = 0; h < hl; h ++ ) {\r\n\r\n\t\t\t\tobject = this.hierarchy[ h ];\r\n\t\t\t\tnode = this.data.hierarchy[ h ];\r\n\r\n\t\t\t\tif ( node.animationCache === undefined ) {\r\n\r\n\t\t\t\t\tnode.animationCache = {};\r\n\t\t\t\t\tnode.animationCache.prevKey = null;\r\n\t\t\t\t\tnode.animationCache.nextKey = null;\r\n\t\t\t\t\tnode.animationCache.originalMatrix = object.matrix;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar keys = this.data.hierarchy[h].keys;\r\n\r\n\t\t\t\tif (keys.length) {\r\n\r\n\t\t\t\t\tnode.animationCache.prevKey = keys[ 0 ];\r\n\t\t\t\t\tnode.animationCache.nextKey = keys[ 1 ];\r\n\r\n\t\t\t\t\tthis.startTime = Math.min( keys[0].time, this.startTime );\r\n\t\t\t\t\tthis.endTime = Math.max( keys[keys.length - 1].time, this.endTime );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\tthis.update( 0 );\r\n\r\n\t\t}\r\n\r\n\t\tthis.isPaused = false;\r\n\r\n\t\tTHREE.AnimationHandler.play( this );\r\n\r\n\t},\r\n\r\n\tstop: function () {\r\n\r\n\t\tthis.isPlaying = false;\r\n\t\tthis.isPaused  = false;\r\n\r\n\t\tTHREE.AnimationHandler.stop( this );\r\n\r\n\t\t// reset JIT matrix and remove cache\r\n\r\n\t\tfor ( var h = 0; h < this.data.hierarchy.length; h ++ ) {\r\n\r\n\t\t\tvar obj = this.hierarchy[ h ];\r\n\t\t\tvar node = this.data.hierarchy[ h ];\r\n\r\n\t\t\tif ( node.animationCache !== undefined ) {\r\n\r\n\t\t\t\tvar original = node.animationCache.originalMatrix;\r\n\r\n\t\t\t\toriginal.copy( obj.matrix );\r\n\t\t\t\tobj.matrix = original;\r\n\r\n\t\t\t\tdelete node.animationCache;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t},\r\n\r\n\tupdate: function ( delta ) {\r\n\r\n\t\tif ( this.isPlaying === false ) return;\r\n\r\n\t\tthis.currentTime += delta * this.timeScale;\r\n\r\n\t\t//\r\n\r\n\t\tvar duration = this.data.length;\r\n\r\n\t\tif ( this.loop === true && this.currentTime > duration ) {\r\n\r\n\t\t\tthis.currentTime %= duration;\r\n\r\n\t\t}\r\n\r\n\t\tthis.currentTime = Math.min( this.currentTime, duration );\r\n\r\n\t\tfor ( var h = 0, hl = this.hierarchy.length; h < hl; h ++ ) {\r\n\r\n\t\t\tvar object = this.hierarchy[ h ];\r\n\t\t\tvar node = this.data.hierarchy[ h ];\r\n\r\n\t\t\tvar keys = node.keys,\r\n\t\t\t\tanimationCache = node.animationCache;\r\n\r\n\r\n\t\t\tif ( keys.length ) {\r\n\r\n\t\t\t\tvar prevKey = animationCache.prevKey;\r\n\t\t\t\tvar nextKey = animationCache.nextKey;\r\n\r\n\t\t\t\tif ( nextKey.time <= this.currentTime ) {\r\n\r\n\t\t\t\t\twhile ( nextKey.time < this.currentTime && nextKey.index > prevKey.index ) {\r\n\r\n\t\t\t\t\t\tprevKey = nextKey;\r\n\t\t\t\t\t\tnextKey = keys[ prevKey.index + 1 ];\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tanimationCache.prevKey = prevKey;\r\n\t\t\t\t\tanimationCache.nextKey = nextKey;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( nextKey.time >= this.currentTime ) {\r\n\r\n\t\t\t\t\tprevKey.interpolate( nextKey, this.currentTime );\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\tprevKey.interpolate( nextKey, nextKey.time );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis.data.hierarchy[ h ].node.updateMatrix();\r\n\t\t\t\tobject.matrixWorldNeedsUpdate = true;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t},\r\n\r\n\tgetNextKeyWith: function ( sid, h, key ) {\r\n\r\n\t\tvar keys = this.data.hierarchy[ h ].keys;\r\n\t\tkey = key % keys.length;\r\n\r\n\t\tfor ( ; key < keys.length; key ++ ) {\r\n\r\n\t\t\tif ( keys[ key ].hasTarget( sid ) ) {\r\n\r\n\t\t\t\treturn keys[ key ];\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\treturn keys[ 0 ];\r\n\r\n\t},\r\n\r\n\tgetPrevKeyWith: function ( sid, h, key ) {\r\n\r\n\t\tvar keys = this.data.hierarchy[ h ].keys;\r\n\t\tkey = key >= 0 ? key : key + keys.length;\r\n\r\n\t\tfor ( ; key >= 0; key -- ) {\r\n\r\n\t\t\tif ( keys[ key ].hasTarget( sid ) ) {\r\n\r\n\t\t\t\treturn keys[ key ];\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\treturn keys[ keys.length - 1 ];\r\n\r\n\t}\r\n\r\n};\r\n\r\n// File:src/extras/animation/MorphAnimation.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com\r\n * @author willy-vvu / http://willy-vvu.github.io\r\n */\r\n\r\nTHREE.MorphAnimation = function ( mesh ) {\r\n\r\n\tthis.mesh = mesh;\r\n\tthis.frames = mesh.morphTargetInfluences.length;\r\n\tthis.currentTime = 0;\r\n\tthis.duration = 1000;\r\n\tthis.loop = true;\r\n\tthis.lastFrame = 0;\r\n\tthis.currentFrame = 0;\r\n\r\n\tthis.isPlaying = false;\r\n\r\n};\r\n\r\nTHREE.MorphAnimation.prototype = {\r\n\r\n\tconstructor: THREE.MorphAnimation,\r\n\r\n\tplay: function () {\r\n\r\n\t\tthis.isPlaying = true;\r\n\r\n\t},\r\n\r\n\tpause: function () {\r\n\r\n\t\tthis.isPlaying = false;\r\n\r\n\t},\r\n\r\n\tupdate: function ( delta ) {\r\n\r\n\t\tif ( this.isPlaying === false ) return;\r\n\r\n\t\tthis.currentTime += delta;\r\n\r\n\t\tif ( this.loop === true && this.currentTime > this.duration ) {\r\n\r\n\t\t\tthis.currentTime %= this.duration;\r\n\r\n\t\t}\r\n\r\n\t\tthis.currentTime = Math.min( this.currentTime, this.duration );\r\n\r\n\t\tvar interpolation = this.duration / this.frames;\r\n\t\tvar frame = Math.floor( this.currentTime / interpolation );\r\n\r\n\t\tvar influences = this.mesh.morphTargetInfluences;\r\n\r\n\t\tif ( frame != this.currentFrame ) {\r\n\r\n\t\t\tinfluences[ this.lastFrame ] = 0;\r\n\t\t\tinfluences[ this.currentFrame ] = 1;\r\n\t\t\tinfluences[ frame ] = 0;\r\n\r\n\t\t\tthis.lastFrame = this.currentFrame;\r\n\t\t\tthis.currentFrame = frame;\r\n\r\n\t\t}\r\n\r\n\t\tinfluences[ frame ] = ( this.currentTime % interpolation ) / interpolation;\r\n\t\tinfluences[ this.lastFrame ] = 1 - influences[ frame ];\r\n\r\n\t}\r\n\r\n};\r\n\r\n// File:src/extras/geometries/BoxGeometry.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * based on http://papervision3d.googlecode.com/svn/trunk/as3/trunk/src/org/papervision3d/objects/primitives/Cube.as\r\n */\r\n\r\nTHREE.BoxGeometry = function ( width, height, depth, widthSegments, heightSegments, depthSegments ) {\r\n\r\n\tTHREE.Geometry.call( this );\r\n\r\n\tthis.type = 'BoxGeometry';\r\n\r\n\tthis.parameters = {\r\n\t\twidth: width,\r\n\t\theight: height,\r\n\t\tdepth: depth,\r\n\t\twidthSegments: widthSegments,\r\n\t\theightSegments: heightSegments,\r\n\t\tdepthSegments: depthSegments\r\n\t};\r\n\r\n\tthis.widthSegments = widthSegments || 1;\r\n\tthis.heightSegments = heightSegments || 1;\r\n\tthis.depthSegments = depthSegments || 1;\r\n\r\n\tvar scope = this;\r\n\r\n\tvar width_half = width / 2;\r\n\tvar height_half = height / 2;\r\n\tvar depth_half = depth / 2;\r\n\r\n\tbuildPlane( 'z', 'y', - 1, - 1, depth, height, width_half, 0 ); // px\r\n\tbuildPlane( 'z', 'y',   1, - 1, depth, height, - width_half, 1 ); // nx\r\n\tbuildPlane( 'x', 'z',   1,   1, width, depth, height_half, 2 ); // py\r\n\tbuildPlane( 'x', 'z',   1, - 1, width, depth, - height_half, 3 ); // ny\r\n\tbuildPlane( 'x', 'y',   1, - 1, width, height, depth_half, 4 ); // pz\r\n\tbuildPlane( 'x', 'y', - 1, - 1, width, height, - depth_half, 5 ); // nz\r\n\r\n\tfunction buildPlane( u, v, udir, vdir, width, height, depth, materialIndex ) {\r\n\r\n\t\tvar w, ix, iy,\r\n\t\tgridX = scope.widthSegments,\r\n\t\tgridY = scope.heightSegments,\r\n\t\twidth_half = width / 2,\r\n\t\theight_half = height / 2,\r\n\t\toffset = scope.vertices.length;\r\n\r\n\t\tif ( ( u === 'x' && v === 'y' ) || ( u === 'y' && v === 'x' ) ) {\r\n\r\n\t\t\tw = 'z';\r\n\r\n\t\t} else if ( ( u === 'x' && v === 'z' ) || ( u === 'z' && v === 'x' ) ) {\r\n\r\n\t\t\tw = 'y';\r\n\t\t\tgridY = scope.depthSegments;\r\n\r\n\t\t} else if ( ( u === 'z' && v === 'y' ) || ( u === 'y' && v === 'z' ) ) {\r\n\r\n\t\t\tw = 'x';\r\n\t\t\tgridX = scope.depthSegments;\r\n\r\n\t\t}\r\n\r\n\t\tvar gridX1 = gridX + 1,\r\n\t\tgridY1 = gridY + 1,\r\n\t\tsegment_width = width / gridX,\r\n\t\tsegment_height = height / gridY,\r\n\t\tnormal = new THREE.Vector3();\r\n\r\n\t\tnormal[ w ] = depth > 0 ? 1 : - 1;\r\n\r\n\t\tfor ( iy = 0; iy < gridY1; iy ++ ) {\r\n\r\n\t\t\tfor ( ix = 0; ix < gridX1; ix ++ ) {\r\n\r\n\t\t\t\tvar vector = new THREE.Vector3();\r\n\t\t\t\tvector[ u ] = ( ix * segment_width - width_half ) * udir;\r\n\t\t\t\tvector[ v ] = ( iy * segment_height - height_half ) * vdir;\r\n\t\t\t\tvector[ w ] = depth;\r\n\r\n\t\t\t\tscope.vertices.push( vector );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tfor ( iy = 0; iy < gridY; iy ++ ) {\r\n\r\n\t\t\tfor ( ix = 0; ix < gridX; ix ++ ) {\r\n\r\n\t\t\t\tvar a = ix + gridX1 * iy;\r\n\t\t\t\tvar b = ix + gridX1 * ( iy + 1 );\r\n\t\t\t\tvar c = ( ix + 1 ) + gridX1 * ( iy + 1 );\r\n\t\t\t\tvar d = ( ix + 1 ) + gridX1 * iy;\r\n\r\n\t\t\t\tvar uva = new THREE.Vector2( ix / gridX, 1 - iy / gridY );\r\n\t\t\t\tvar uvb = new THREE.Vector2( ix / gridX, 1 - ( iy + 1 ) / gridY );\r\n\t\t\t\tvar uvc = new THREE.Vector2( ( ix + 1 ) / gridX, 1 - ( iy + 1 ) / gridY );\r\n\t\t\t\tvar uvd = new THREE.Vector2( ( ix + 1 ) / gridX, 1 - iy / gridY );\r\n\r\n\t\t\t\tvar face = new THREE.Face3( a + offset, b + offset, d + offset );\r\n\t\t\t\tface.normal.copy( normal );\r\n\t\t\t\tface.vertexNormals.push( normal.clone(), normal.clone(), normal.clone() );\r\n\t\t\t\tface.materialIndex = materialIndex;\r\n\r\n\t\t\t\tscope.faces.push( face );\r\n\t\t\t\tscope.faceVertexUvs[ 0 ].push( [ uva, uvb, uvd ] );\r\n\r\n\t\t\t\tface = new THREE.Face3( b + offset, c + offset, d + offset );\r\n\t\t\t\tface.normal.copy( normal );\r\n\t\t\t\tface.vertexNormals.push( normal.clone(), normal.clone(), normal.clone() );\r\n\t\t\t\tface.materialIndex = materialIndex;\r\n\r\n\t\t\t\tscope.faces.push( face );\r\n\t\t\t\tscope.faceVertexUvs[ 0 ].push( [ uvb.clone(), uvc, uvd.clone() ] );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tthis.mergeVertices();\r\n\r\n};\r\n\r\nTHREE.BoxGeometry.prototype = Object.create( THREE.Geometry.prototype );\r\nTHREE.BoxGeometry.prototype.constructor = THREE.BoxGeometry;\r\n\r\n// File:src/extras/geometries/CircleGeometry.js\r\n\r\n/**\r\n * @author hughes\r\n */\r\n\r\nTHREE.CircleGeometry = function ( radius, segments, thetaStart, thetaLength ) {\r\n\r\n\tTHREE.Geometry.call( this );\r\n\r\n\tthis.type = 'CircleGeometry';\r\n\r\n\tthis.parameters = {\r\n\t\tradius: radius,\r\n\t\tsegments: segments,\r\n\t\tthetaStart: thetaStart,\r\n\t\tthetaLength: thetaLength\r\n\t};\r\n\r\n\tradius = radius || 50;\r\n\tsegments = segments !== undefined ? Math.max( 3, segments ) : 8;\r\n\r\n\tthetaStart = thetaStart !== undefined ? thetaStart : 0;\r\n\tthetaLength = thetaLength !== undefined ? thetaLength : Math.PI * 2;\r\n\r\n\tvar i, uvs = [],\r\n\tcenter = new THREE.Vector3(), centerUV = new THREE.Vector2( 0.5, 0.5 );\r\n\r\n\tthis.vertices.push(center);\r\n\tuvs.push( centerUV );\r\n\r\n\tfor ( i = 0; i <= segments; i ++ ) {\r\n\r\n\t\tvar vertex = new THREE.Vector3();\r\n\t\tvar segment = thetaStart + i / segments * thetaLength;\r\n\r\n\t\tvertex.x = radius * Math.cos( segment );\r\n\t\tvertex.y = radius * Math.sin( segment );\r\n\r\n\t\tthis.vertices.push( vertex );\r\n\t\tuvs.push( new THREE.Vector2( ( vertex.x / radius + 1 ) / 2, ( vertex.y / radius + 1 ) / 2 ) );\r\n\r\n\t}\r\n\r\n\tvar n = new THREE.Vector3( 0, 0, 1 );\r\n\r\n\tfor ( i = 1; i <= segments; i ++ ) {\r\n\r\n\t\tthis.faces.push( new THREE.Face3( i, i + 1, 0, [ n.clone(), n.clone(), n.clone() ] ) );\r\n\t\tthis.faceVertexUvs[ 0 ].push( [ uvs[ i ].clone(), uvs[ i + 1 ].clone(), centerUV.clone() ] );\r\n\r\n\t}\r\n\r\n\tthis.computeFaceNormals();\r\n\r\n\tthis.boundingSphere = new THREE.Sphere( new THREE.Vector3(), radius );\r\n\r\n};\r\n\r\nTHREE.CircleGeometry.prototype = Object.create( THREE.Geometry.prototype );\r\nTHREE.CircleGeometry.prototype.constructor = THREE.CircleGeometry;\r\n\r\n// File:src/extras/geometries/CubeGeometry.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\n\r\nTHREE.CubeGeometry = function ( width, height, depth, widthSegments, heightSegments, depthSegments ) {\r\n\r\n\tTHREE.warn( 'THREE.CubeGeometry has been renamed to THREE.BoxGeometry.' );\r\n\treturn new THREE.BoxGeometry( width, height, depth, widthSegments, heightSegments, depthSegments );\r\n\r\n };\r\n\r\n// File:src/extras/geometries/CylinderGeometry.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.CylinderGeometry = function ( radiusTop, radiusBottom, height, radialSegments, heightSegments, openEnded, thetaStart, thetaLength ) {\r\n\r\n\tTHREE.Geometry.call( this );\r\n\r\n\tthis.type = 'CylinderGeometry';\r\n\r\n\tthis.parameters = {\r\n\t\tradiusTop: radiusTop,\r\n\t\tradiusBottom: radiusBottom,\r\n\t\theight: height,\r\n\t\tradialSegments: radialSegments,\r\n\t\theightSegments: heightSegments,\r\n\t\topenEnded: openEnded,\r\n\t\tthetaStart: thetaStart,\r\n\t\tthetaLength: thetaLength\r\n\t};\r\n\r\n\tradiusTop = radiusTop !== undefined ? radiusTop : 20;\r\n\tradiusBottom = radiusBottom !== undefined ? radiusBottom : 20;\r\n\theight = height !== undefined ? height : 100;\r\n\r\n\tradialSegments = radialSegments || 8;\r\n\theightSegments = heightSegments || 1;\r\n\r\n\topenEnded = openEnded !== undefined ? openEnded : false;\r\n\tthetaStart = thetaStart !== undefined ? thetaStart : 0;\r\n\tthetaLength = thetaLength !== undefined ? thetaLength : 2 * Math.PI;\r\n\r\n\tvar heightHalf = height / 2;\r\n\r\n\tvar x, y, vertices = [], uvs = [];\r\n\r\n\tfor ( y = 0; y <= heightSegments; y ++ ) {\r\n\r\n\t\tvar verticesRow = [];\r\n\t\tvar uvsRow = [];\r\n\r\n\t\tvar v = y / heightSegments;\r\n\t\tvar radius = v * ( radiusBottom - radiusTop ) + radiusTop;\r\n\r\n\t\tfor ( x = 0; x <= radialSegments; x ++ ) {\r\n\r\n\t\t\tvar u = x / radialSegments;\r\n\r\n\t\t\tvar vertex = new THREE.Vector3();\r\n\t\t\tvertex.x = radius * Math.sin( u * thetaLength + thetaStart );\r\n\t\t\tvertex.y = - v * height + heightHalf;\r\n\t\t\tvertex.z = radius * Math.cos( u * thetaLength + thetaStart );\r\n\r\n\t\t\tthis.vertices.push( vertex );\r\n\r\n\t\t\tverticesRow.push( this.vertices.length - 1 );\r\n\t\t\tuvsRow.push( new THREE.Vector2( u, 1 - v ) );\r\n\r\n\t\t}\r\n\r\n\t\tvertices.push( verticesRow );\r\n\t\tuvs.push( uvsRow );\r\n\r\n\t}\r\n\r\n\tvar tanTheta = ( radiusBottom - radiusTop ) / height;\r\n\tvar na, nb;\r\n\r\n\tfor ( x = 0; x < radialSegments; x ++ ) {\r\n\r\n\t\tif ( radiusTop !== 0 ) {\r\n\r\n\t\t\tna = this.vertices[ vertices[ 0 ][ x ] ].clone();\r\n\t\t\tnb = this.vertices[ vertices[ 0 ][ x + 1 ] ].clone();\r\n\r\n\t\t} else {\r\n\r\n\t\t\tna = this.vertices[ vertices[ 1 ][ x ] ].clone();\r\n\t\t\tnb = this.vertices[ vertices[ 1 ][ x + 1 ] ].clone();\r\n\r\n\t\t}\r\n\r\n\t\tna.setY( Math.sqrt( na.x * na.x + na.z * na.z ) * tanTheta ).normalize();\r\n\t\tnb.setY( Math.sqrt( nb.x * nb.x + nb.z * nb.z ) * tanTheta ).normalize();\r\n\r\n\t\tfor ( y = 0; y < heightSegments; y ++ ) {\r\n\r\n\t\t\tvar v1 = vertices[ y ][ x ];\r\n\t\t\tvar v2 = vertices[ y + 1 ][ x ];\r\n\t\t\tvar v3 = vertices[ y + 1 ][ x + 1 ];\r\n\t\t\tvar v4 = vertices[ y ][ x + 1 ];\r\n\r\n\t\t\tvar n1 = na.clone();\r\n\t\t\tvar n2 = na.clone();\r\n\t\t\tvar n3 = nb.clone();\r\n\t\t\tvar n4 = nb.clone();\r\n\r\n\t\t\tvar uv1 = uvs[ y ][ x ].clone();\r\n\t\t\tvar uv2 = uvs[ y + 1 ][ x ].clone();\r\n\t\t\tvar uv3 = uvs[ y + 1 ][ x + 1 ].clone();\r\n\t\t\tvar uv4 = uvs[ y ][ x + 1 ].clone();\r\n\r\n\t\t\tthis.faces.push( new THREE.Face3( v1, v2, v4, [ n1, n2, n4 ] ) );\r\n\t\t\tthis.faceVertexUvs[ 0 ].push( [ uv1, uv2, uv4 ] );\r\n\r\n\t\t\tthis.faces.push( new THREE.Face3( v2, v3, v4, [ n2.clone(), n3, n4.clone() ] ) );\r\n\t\t\tthis.faceVertexUvs[ 0 ].push( [ uv2.clone(), uv3, uv4.clone() ] );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\t// top cap\r\n\r\n\tif ( openEnded === false && radiusTop > 0 ) {\r\n\r\n\t\tthis.vertices.push( new THREE.Vector3( 0, heightHalf, 0 ) );\r\n\r\n\t\tfor ( x = 0; x < radialSegments; x ++ ) {\r\n\r\n\t\t\tvar v1 = vertices[ 0 ][ x ];\r\n\t\t\tvar v2 = vertices[ 0 ][ x + 1 ];\r\n\t\t\tvar v3 = this.vertices.length - 1;\r\n\r\n\t\t\tvar n1 = new THREE.Vector3( 0, 1, 0 );\r\n\t\t\tvar n2 = new THREE.Vector3( 0, 1, 0 );\r\n\t\t\tvar n3 = new THREE.Vector3( 0, 1, 0 );\r\n\r\n\t\t\tvar uv1 = uvs[ 0 ][ x ].clone();\r\n\t\t\tvar uv2 = uvs[ 0 ][ x + 1 ].clone();\r\n\t\t\tvar uv3 = new THREE.Vector2( uv2.x, 0 );\r\n\r\n\t\t\tthis.faces.push( new THREE.Face3( v1, v2, v3, [ n1, n2, n3 ] ) );\r\n\t\t\tthis.faceVertexUvs[ 0 ].push( [ uv1, uv2, uv3 ] );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\t// bottom cap\r\n\r\n\tif ( openEnded === false && radiusBottom > 0 ) {\r\n\r\n\t\tthis.vertices.push( new THREE.Vector3( 0, - heightHalf, 0 ) );\r\n\r\n\t\tfor ( x = 0; x < radialSegments; x ++ ) {\r\n\r\n\t\t\tvar v1 = vertices[ heightSegments ][ x + 1 ];\r\n\t\t\tvar v2 = vertices[ heightSegments ][ x ];\r\n\t\t\tvar v3 = this.vertices.length - 1;\r\n\r\n\t\t\tvar n1 = new THREE.Vector3( 0, - 1, 0 );\r\n\t\t\tvar n2 = new THREE.Vector3( 0, - 1, 0 );\r\n\t\t\tvar n3 = new THREE.Vector3( 0, - 1, 0 );\r\n\r\n\t\t\tvar uv1 = uvs[ heightSegments ][ x + 1 ].clone();\r\n\t\t\tvar uv2 = uvs[ heightSegments ][ x ].clone();\r\n\t\t\tvar uv3 = new THREE.Vector2( uv2.x, 1 );\r\n\r\n\t\t\tthis.faces.push( new THREE.Face3( v1, v2, v3, [ n1, n2, n3 ] ) );\r\n\t\t\tthis.faceVertexUvs[ 0 ].push( [ uv1, uv2, uv3 ] );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tthis.computeFaceNormals();\r\n\r\n};\r\n\r\nTHREE.CylinderGeometry.prototype = Object.create( THREE.Geometry.prototype );\r\nTHREE.CylinderGeometry.prototype.constructor = THREE.CylinderGeometry;\r\n\r\n// File:src/extras/geometries/ExtrudeGeometry.js\r\n\r\n/**\r\n * @author zz85 / http://www.lab4games.net/zz85/blog\r\n *\r\n * Creates extruded geometry from a path shape.\r\n *\r\n * parameters = {\r\n *\r\n *  curveSegments: <int>, // number of points on the curves\r\n *  steps: <int>, // number of points for z-side extrusions / used for subdividing segements of extrude spline too\r\n *  amount: <int>, // Depth to extrude the shape\r\n *\r\n *  bevelEnabled: <bool>, // turn on bevel\r\n *  bevelThickness: <float>, // how deep into the original shape bevel goes\r\n *  bevelSize: <float>, // how far from shape outline is bevel\r\n *  bevelSegments: <int>, // number of bevel layers\r\n *\r\n *  extrudePath: <THREE.CurvePath> // 3d spline path to extrude shape along. (creates Frames if .frames aren't defined)\r\n *  frames: <THREE.TubeGeometry.FrenetFrames> // containing arrays of tangents, normals, binormals\r\n *\r\n *  material: <int> // material index for front and back faces\r\n *  extrudeMaterial: <int> // material index for extrusion and beveled faces\r\n *  uvGenerator: <Object> // object that provides UV generator functions\r\n *\r\n * }\r\n **/\r\n\r\nTHREE.ExtrudeGeometry = function ( shapes, options ) {\r\n\r\n\tif ( typeof( shapes ) === \"undefined\" ) {\r\n\t\tshapes = [];\r\n\t\treturn;\r\n\t}\r\n\r\n\tTHREE.Geometry.call( this );\r\n\r\n\tthis.type = 'ExtrudeGeometry';\r\n\r\n\tshapes = shapes instanceof Array ? shapes : [ shapes ];\r\n\r\n\tthis.addShapeList( shapes, options );\r\n\r\n\tthis.computeFaceNormals();\r\n\r\n\t// can't really use automatic vertex normals\r\n\t// as then front and back sides get smoothed too\r\n\t// should do separate smoothing just for sides\r\n\r\n\t//this.computeVertexNormals();\r\n\r\n\t//console.log( \"took\", ( Date.now() - startTime ) );\r\n\r\n};\r\n\r\nTHREE.ExtrudeGeometry.prototype = Object.create( THREE.Geometry.prototype );\r\nTHREE.ExtrudeGeometry.prototype.constructor = THREE.ExtrudeGeometry;\r\n\r\nTHREE.ExtrudeGeometry.prototype.addShapeList = function ( shapes, options ) {\r\n\tvar sl = shapes.length;\r\n\r\n\tfor ( var s = 0; s < sl; s ++ ) {\r\n\t\tvar shape = shapes[ s ];\r\n\t\tthis.addShape( shape, options );\r\n\t}\r\n};\r\n\r\nTHREE.ExtrudeGeometry.prototype.addShape = function ( shape, options ) {\r\n\r\n\tvar amount = options.amount !== undefined ? options.amount : 100;\r\n\r\n\tvar bevelThickness = options.bevelThickness !== undefined ? options.bevelThickness : 6; // 10\r\n\tvar bevelSize = options.bevelSize !== undefined ? options.bevelSize : bevelThickness - 2; // 8\r\n\tvar bevelSegments = options.bevelSegments !== undefined ? options.bevelSegments : 3;\r\n\r\n\tvar bevelEnabled = options.bevelEnabled !== undefined ? options.bevelEnabled : true; // false\r\n\r\n\tvar curveSegments = options.curveSegments !== undefined ? options.curveSegments : 12;\r\n\r\n\tvar steps = options.steps !== undefined ? options.steps : 1;\r\n\r\n\tvar extrudePath = options.extrudePath;\r\n\tvar extrudePts, extrudeByPath = false;\r\n\r\n\tvar material = options.material;\r\n\tvar extrudeMaterial = options.extrudeMaterial;\r\n\r\n\t// Use default WorldUVGenerator if no UV generators are specified.\r\n\tvar uvgen = options.UVGenerator !== undefined ? options.UVGenerator : THREE.ExtrudeGeometry.WorldUVGenerator;\r\n\r\n\tvar splineTube, binormal, normal, position2;\r\n\tif ( extrudePath ) {\r\n\r\n\t\textrudePts = extrudePath.getSpacedPoints( steps );\r\n\r\n\t\textrudeByPath = true;\r\n\t\tbevelEnabled = false; // bevels not supported for path extrusion\r\n\r\n\t\t// SETUP TNB variables\r\n\r\n\t\t// Reuse TNB from TubeGeomtry for now.\r\n\t\t// TODO1 - have a .isClosed in spline?\r\n\r\n\t\tsplineTube = options.frames !== undefined ? options.frames : new THREE.TubeGeometry.FrenetFrames(extrudePath, steps, false);\r\n\r\n\t\t// console.log(splineTube, 'splineTube', splineTube.normals.length, 'steps', steps, 'extrudePts', extrudePts.length);\r\n\r\n\t\tbinormal = new THREE.Vector3();\r\n\t\tnormal = new THREE.Vector3();\r\n\t\tposition2 = new THREE.Vector3();\r\n\r\n\t}\r\n\r\n\t// Safeguards if bevels are not enabled\r\n\r\n\tif ( ! bevelEnabled ) {\r\n\r\n\t\tbevelSegments = 0;\r\n\t\tbevelThickness = 0;\r\n\t\tbevelSize = 0;\r\n\r\n\t}\r\n\r\n\t// Variables initalization\r\n\r\n\tvar ahole, h, hl; // looping of holes\r\n\tvar scope = this;\r\n\r\n\tvar shapesOffset = this.vertices.length;\r\n\r\n\tvar shapePoints = shape.extractPoints( curveSegments );\r\n\r\n\tvar vertices = shapePoints.shape;\r\n\tvar holes = shapePoints.holes;\r\n\r\n\tvar reverse = ! THREE.Shape.Utils.isClockWise( vertices ) ;\r\n\r\n\tif ( reverse ) {\r\n\r\n\t\tvertices = vertices.reverse();\r\n\r\n\t\t// Maybe we should also check if holes are in the opposite direction, just to be safe ...\r\n\r\n\t\tfor ( h = 0, hl = holes.length; h < hl; h ++ ) {\r\n\r\n\t\t\tahole = holes[ h ];\r\n\r\n\t\t\tif ( THREE.Shape.Utils.isClockWise( ahole ) ) {\r\n\r\n\t\t\t\tholes[ h ] = ahole.reverse();\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\treverse = false; // If vertices are in order now, we shouldn't need to worry about them again (hopefully)!\r\n\r\n\t}\r\n\r\n\r\n\tvar faces = THREE.Shape.Utils.triangulateShape ( vertices, holes );\r\n\r\n\t/* Vertices */\r\n\r\n\tvar contour = vertices; // vertices has all points but contour has only points of circumference\r\n\r\n\tfor ( h = 0, hl = holes.length; h < hl; h ++ ) {\r\n\r\n\t\tahole = holes[ h ];\r\n\r\n\t\tvertices = vertices.concat( ahole );\r\n\r\n\t}\r\n\r\n\r\n\tfunction scalePt2 ( pt, vec, size ) {\r\n\r\n\t\tif ( ! vec ) THREE.error( \"THREE.ExtrudeGeometry: vec does not exist\" );\r\n\r\n\t\treturn vec.clone().multiplyScalar( size ).add( pt );\r\n\r\n\t}\r\n\r\n\tvar b, bs, t, z,\r\n\t\tvert, vlen = vertices.length,\r\n\t\tface, flen = faces.length;\r\n\r\n\r\n\t// Find directions for point movement\r\n\r\n\r\n\tfunction getBevelVec( inPt, inPrev, inNext ) {\r\n\r\n\t\tvar EPSILON = 0.0000000001;\r\n\t\t\r\n\t\t// computes for inPt the corresponding point inPt' on a new contour\r\n\t\t//   shiftet by 1 unit (length of normalized vector) to the left\r\n\t\t// if we walk along contour clockwise, this new contour is outside the old one\r\n\t\t//\r\n\t\t// inPt' is the intersection of the two lines parallel to the two\r\n\t\t//  adjacent edges of inPt at a distance of 1 unit on the left side.\r\n\t\t\r\n\t\tvar v_trans_x, v_trans_y, shrink_by = 1;\t\t// resulting translation vector for inPt\r\n\r\n\t\t// good reading for geometry algorithms (here: line-line intersection)\r\n\t\t// http://geomalgorithms.com/a05-_intersect-1.html\r\n\r\n\t\tvar v_prev_x = inPt.x - inPrev.x, v_prev_y = inPt.y - inPrev.y;\r\n\t\tvar v_next_x = inNext.x - inPt.x, v_next_y = inNext.y - inPt.y;\r\n\t\t\r\n\t\tvar v_prev_lensq = ( v_prev_x * v_prev_x + v_prev_y * v_prev_y );\r\n\t\t\r\n\t\t// check for colinear edges\r\n\t\tvar colinear0 = ( v_prev_x * v_next_y - v_prev_y * v_next_x );\r\n\t\t\r\n\t\tif ( Math.abs( colinear0 ) > EPSILON ) {\t\t// not colinear\r\n\t\t\t\r\n\t\t\t// length of vectors for normalizing\r\n\t\r\n\t\t\tvar v_prev_len = Math.sqrt( v_prev_lensq );\r\n\t\t\tvar v_next_len = Math.sqrt( v_next_x * v_next_x + v_next_y * v_next_y );\r\n\t\t\t\r\n\t\t\t// shift adjacent points by unit vectors to the left\r\n\t\r\n\t\t\tvar ptPrevShift_x = ( inPrev.x - v_prev_y / v_prev_len );\r\n\t\t\tvar ptPrevShift_y = ( inPrev.y + v_prev_x / v_prev_len );\r\n\t\t\t\r\n\t\t\tvar ptNextShift_x = ( inNext.x - v_next_y / v_next_len );\r\n\t\t\tvar ptNextShift_y = ( inNext.y + v_next_x / v_next_len );\r\n\t\r\n\t\t\t// scaling factor for v_prev to intersection point\r\n\t\r\n\t\t\tvar sf = (  ( ptNextShift_x - ptPrevShift_x ) * v_next_y -\r\n\t\t\t\t\t\t( ptNextShift_y - ptPrevShift_y ) * v_next_x    ) /\r\n\t\t\t\t\t  ( v_prev_x * v_next_y - v_prev_y * v_next_x );\r\n\t\r\n\t\t\t// vector from inPt to intersection point\r\n\t\r\n\t\t\tv_trans_x = ( ptPrevShift_x + v_prev_x * sf - inPt.x );\r\n\t\t\tv_trans_y = ( ptPrevShift_y + v_prev_y * sf - inPt.y );\r\n\t\r\n\t\t\t// Don't normalize!, otherwise sharp corners become ugly\r\n\t\t\t//  but prevent crazy spikes\r\n\t\t\tvar v_trans_lensq = ( v_trans_x * v_trans_x + v_trans_y * v_trans_y )\r\n\t\t\tif ( v_trans_lensq <= 2 ) {\r\n\t\t\t\treturn\tnew THREE.Vector2( v_trans_x, v_trans_y );\r\n\t\t\t} else {\r\n\t\t\t\tshrink_by = Math.sqrt( v_trans_lensq / 2 );\r\n\t\t\t}\r\n\t\t\t\r\n\t\t} else {\t\t// handle special case of colinear edges\r\n\r\n\t\t\tvar direction_eq = false;\t\t// assumes: opposite\r\n\t\t\tif ( v_prev_x > EPSILON ) {\r\n\t\t\t\tif ( v_next_x > EPSILON ) { direction_eq = true; }\r\n\t\t\t} else {\r\n\t\t\t\tif ( v_prev_x < - EPSILON ) {\r\n\t\t\t\t\tif ( v_next_x < - EPSILON ) { direction_eq = true; }\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif ( Math.sign(v_prev_y) == Math.sign(v_next_y) ) { direction_eq = true; }\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif ( direction_eq ) {\r\n\t\t\t\t// console.log(\"Warning: lines are a straight sequence\");\r\n\t\t\t\tv_trans_x = - v_prev_y;\r\n\t\t\t\tv_trans_y =  v_prev_x;\r\n\t\t\t\tshrink_by = Math.sqrt( v_prev_lensq );\r\n\t\t\t} else {\r\n\t\t\t\t// console.log(\"Warning: lines are a straight spike\");\r\n\t\t\t\tv_trans_x = v_prev_x;\r\n\t\t\t\tv_trans_y = v_prev_y;\r\n\t\t\t\tshrink_by = Math.sqrt( v_prev_lensq / 2 );\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\treturn\tnew THREE.Vector2( v_trans_x / shrink_by, v_trans_y / shrink_by );\r\n\r\n\t}\r\n\r\n\r\n\tvar contourMovements = [];\r\n\r\n\tfor ( var i = 0, il = contour.length, j = il - 1, k = i + 1; i < il; i ++, j ++, k ++ ) {\r\n\r\n\t\tif ( j === il ) j = 0;\r\n\t\tif ( k === il ) k = 0;\r\n\r\n\t\t//  (j)---(i)---(k)\r\n\t\t// console.log('i,j,k', i, j , k)\r\n\r\n\t\tcontourMovements[ i ] = getBevelVec( contour[ i ], contour[ j ], contour[ k ] );\r\n\r\n\t}\r\n\r\n\tvar holesMovements = [], oneHoleMovements, verticesMovements = contourMovements.concat();\r\n\r\n\tfor ( h = 0, hl = holes.length; h < hl; h ++ ) {\r\n\r\n\t\tahole = holes[ h ];\r\n\r\n\t\toneHoleMovements = [];\r\n\r\n\t\tfor ( i = 0, il = ahole.length, j = il - 1, k = i + 1; i < il; i ++, j ++, k ++ ) {\r\n\r\n\t\t\tif ( j === il ) j = 0;\r\n\t\t\tif ( k === il ) k = 0;\r\n\r\n\t\t\t//  (j)---(i)---(k)\r\n\t\t\toneHoleMovements[ i ] = getBevelVec( ahole[ i ], ahole[ j ], ahole[ k ] );\r\n\r\n\t\t}\r\n\r\n\t\tholesMovements.push( oneHoleMovements );\r\n\t\tverticesMovements = verticesMovements.concat( oneHoleMovements );\r\n\r\n\t}\r\n\r\n\r\n\t// Loop bevelSegments, 1 for the front, 1 for the back\r\n\r\n\tfor ( b = 0; b < bevelSegments; b ++ ) {\r\n\t//for ( b = bevelSegments; b > 0; b -- ) {\r\n\r\n\t\tt = b / bevelSegments;\r\n\t\tz = bevelThickness * ( 1 - t );\r\n\r\n\t\t//z = bevelThickness * t;\r\n\t\tbs = bevelSize * ( Math.sin ( t * Math.PI / 2 ) ) ; // curved\r\n\t\t//bs = bevelSize * t ; // linear\r\n\r\n\t\t// contract shape\r\n\r\n\t\tfor ( i = 0, il = contour.length; i < il; i ++ ) {\r\n\r\n\t\t\tvert = scalePt2( contour[ i ], contourMovements[ i ], bs );\r\n\r\n\t\t\tv( vert.x, vert.y,  - z );\r\n\r\n\t\t}\r\n\r\n\t\t// expand holes\r\n\r\n\t\tfor ( h = 0, hl = holes.length; h < hl; h ++ ) {\r\n\r\n\t\t\tahole = holes[ h ];\r\n\t\t\toneHoleMovements = holesMovements[ h ];\r\n\r\n\t\t\tfor ( i = 0, il = ahole.length; i < il; i ++ ) {\r\n\r\n\t\t\t\tvert = scalePt2( ahole[ i ], oneHoleMovements[ i ], bs );\r\n\r\n\t\t\t\tv( vert.x, vert.y,  - z );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tbs = bevelSize;\r\n\r\n\t// Back facing vertices\r\n\r\n\tfor ( i = 0; i < vlen; i ++ ) {\r\n\r\n\t\tvert = bevelEnabled ? scalePt2( vertices[ i ], verticesMovements[ i ], bs ) : vertices[ i ];\r\n\r\n\t\tif ( ! extrudeByPath ) {\r\n\r\n\t\t\tv( vert.x, vert.y, 0 );\r\n\r\n\t\t} else {\r\n\r\n\t\t\t// v( vert.x, vert.y + extrudePts[ 0 ].y, extrudePts[ 0 ].x );\r\n\r\n\t\t\tnormal.copy( splineTube.normals[0] ).multiplyScalar(vert.x);\r\n\t\t\tbinormal.copy( splineTube.binormals[0] ).multiplyScalar(vert.y);\r\n\r\n\t\t\tposition2.copy( extrudePts[0] ).add(normal).add(binormal);\r\n\r\n\t\t\tv( position2.x, position2.y, position2.z );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\t// Add stepped vertices...\r\n\t// Including front facing vertices\r\n\r\n\tvar s;\r\n\r\n\tfor ( s = 1; s <= steps; s ++ ) {\r\n\r\n\t\tfor ( i = 0; i < vlen; i ++ ) {\r\n\r\n\t\t\tvert = bevelEnabled ? scalePt2( vertices[ i ], verticesMovements[ i ], bs ) : vertices[ i ];\r\n\r\n\t\t\tif ( ! extrudeByPath ) {\r\n\r\n\t\t\t\tv( vert.x, vert.y, amount / steps * s );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\t// v( vert.x, vert.y + extrudePts[ s - 1 ].y, extrudePts[ s - 1 ].x );\r\n\r\n\t\t\t\tnormal.copy( splineTube.normals[s] ).multiplyScalar( vert.x );\r\n\t\t\t\tbinormal.copy( splineTube.binormals[s] ).multiplyScalar( vert.y );\r\n\r\n\t\t\t\tposition2.copy( extrudePts[s] ).add( normal ).add( binormal );\r\n\r\n\t\t\t\tv( position2.x, position2.y, position2.z );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\r\n\t// Add bevel segments planes\r\n\r\n\t//for ( b = 1; b <= bevelSegments; b ++ ) {\r\n\tfor ( b = bevelSegments - 1; b >= 0; b -- ) {\r\n\r\n\t\tt = b / bevelSegments;\r\n\t\tz = bevelThickness * ( 1 - t );\r\n\t\t//bs = bevelSize * ( 1-Math.sin ( ( 1 - t ) * Math.PI/2 ) );\r\n\t\tbs = bevelSize * Math.sin ( t * Math.PI / 2 ) ;\r\n\r\n\t\t// contract shape\r\n\r\n\t\tfor ( i = 0, il = contour.length; i < il; i ++ ) {\r\n\r\n\t\t\tvert = scalePt2( contour[ i ], contourMovements[ i ], bs );\r\n\t\t\tv( vert.x, vert.y,  amount + z );\r\n\r\n\t\t}\r\n\r\n\t\t// expand holes\r\n\r\n\t\tfor ( h = 0, hl = holes.length; h < hl; h ++ ) {\r\n\r\n\t\t\tahole = holes[ h ];\r\n\t\t\toneHoleMovements = holesMovements[ h ];\r\n\r\n\t\t\tfor ( i = 0, il = ahole.length; i < il; i ++ ) {\r\n\r\n\t\t\t\tvert = scalePt2( ahole[ i ], oneHoleMovements[ i ], bs );\r\n\r\n\t\t\t\tif ( ! extrudeByPath ) {\r\n\r\n\t\t\t\t\tv( vert.x, vert.y,  amount + z );\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\tv( vert.x, vert.y + extrudePts[ steps - 1 ].y, extrudePts[ steps - 1 ].x + z );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\t/* Faces */\r\n\r\n\t// Top and bottom faces\r\n\r\n\tbuildLidFaces();\r\n\r\n\t// Sides faces\r\n\r\n\tbuildSideFaces();\r\n\r\n\r\n\t/////  Internal functions\r\n\r\n\tfunction buildLidFaces() {\r\n\r\n\t\tif ( bevelEnabled ) {\r\n\r\n\t\t\tvar layer = 0 ; // steps + 1\r\n\t\t\tvar offset = vlen * layer;\r\n\r\n\t\t\t// Bottom faces\r\n\r\n\t\t\tfor ( i = 0; i < flen; i ++ ) {\r\n\r\n\t\t\t\tface = faces[ i ];\r\n\t\t\t\tf3( face[ 2 ] + offset, face[ 1 ] + offset, face[ 0 ] + offset );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tlayer = steps + bevelSegments * 2;\r\n\t\t\toffset = vlen * layer;\r\n\r\n\t\t\t// Top faces\r\n\r\n\t\t\tfor ( i = 0; i < flen; i ++ ) {\r\n\r\n\t\t\t\tface = faces[ i ];\r\n\t\t\t\tf3( face[ 0 ] + offset, face[ 1 ] + offset, face[ 2 ] + offset );\r\n\r\n\t\t\t}\r\n\r\n\t\t} else {\r\n\r\n\t\t\t// Bottom faces\r\n\r\n\t\t\tfor ( i = 0; i < flen; i ++ ) {\r\n\r\n\t\t\t\tface = faces[ i ];\r\n\t\t\t\tf3( face[ 2 ], face[ 1 ], face[ 0 ] );\r\n\r\n\t\t\t}\r\n\r\n\t\t\t// Top faces\r\n\r\n\t\t\tfor ( i = 0; i < flen; i ++ ) {\r\n\r\n\t\t\t\tface = faces[ i ];\r\n\t\t\t\tf3( face[ 0 ] + vlen * steps, face[ 1 ] + vlen * steps, face[ 2 ] + vlen * steps );\r\n\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t}\r\n\r\n\t// Create faces for the z-sides of the shape\r\n\r\n\tfunction buildSideFaces() {\r\n\r\n\t\tvar layeroffset = 0;\r\n\t\tsidewalls( contour, layeroffset );\r\n\t\tlayeroffset += contour.length;\r\n\r\n\t\tfor ( h = 0, hl = holes.length; h < hl; h ++ ) {\r\n\r\n\t\t\tahole = holes[ h ];\r\n\t\t\tsidewalls( ahole, layeroffset );\r\n\r\n\t\t\t//, true\r\n\t\t\tlayeroffset += ahole.length;\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tfunction sidewalls( contour, layeroffset ) {\r\n\r\n\t\tvar j, k;\r\n\t\ti = contour.length;\r\n\r\n\t\twhile ( -- i >= 0 ) {\r\n\r\n\t\t\tj = i;\r\n\t\t\tk = i - 1;\r\n\t\t\tif ( k < 0 ) k = contour.length - 1;\r\n\r\n\t\t\t//console.log('b', i,j, i-1, k,vertices.length);\r\n\r\n\t\t\tvar s = 0, sl = steps  + bevelSegments * 2;\r\n\r\n\t\t\tfor ( s = 0; s < sl; s ++ ) {\r\n\r\n\t\t\t\tvar slen1 = vlen * s;\r\n\t\t\t\tvar slen2 = vlen * ( s + 1 );\r\n\r\n\t\t\t\tvar a = layeroffset + j + slen1,\r\n\t\t\t\t\tb = layeroffset + k + slen1,\r\n\t\t\t\t\tc = layeroffset + k + slen2,\r\n\t\t\t\t\td = layeroffset + j + slen2;\r\n\r\n\t\t\t\tf4( a, b, c, d, contour, s, sl, j, k );\r\n\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t}\r\n\r\n\r\n\tfunction v( x, y, z ) {\r\n\r\n\t\tscope.vertices.push( new THREE.Vector3( x, y, z ) );\r\n\r\n\t}\r\n\r\n\tfunction f3( a, b, c ) {\r\n\r\n\t\ta += shapesOffset;\r\n\t\tb += shapesOffset;\r\n\t\tc += shapesOffset;\r\n\r\n\t\t// normal, color, material\r\n\t\tscope.faces.push( new THREE.Face3( a, b, c, null, null, material ) );\r\n\r\n\t\tvar uvs = uvgen.generateTopUV( scope, a, b, c );\r\n\r\n\t\tscope.faceVertexUvs[ 0 ].push( uvs );\r\n\r\n\t}\r\n\r\n\tfunction f4( a, b, c, d, wallContour, stepIndex, stepsLength, contourIndex1, contourIndex2 ) {\r\n\r\n\t\ta += shapesOffset;\r\n\t\tb += shapesOffset;\r\n\t\tc += shapesOffset;\r\n\t\td += shapesOffset;\r\n\r\n\t\tscope.faces.push( new THREE.Face3( a, b, d, null, null, extrudeMaterial ) );\r\n\t\tscope.faces.push( new THREE.Face3( b, c, d, null, null, extrudeMaterial ) );\r\n\r\n\t\tvar uvs = uvgen.generateSideWallUV( scope, a, b, c, d );\r\n\r\n\t\tscope.faceVertexUvs[ 0 ].push( [ uvs[ 0 ], uvs[ 1 ], uvs[ 3 ] ] );\r\n\t\tscope.faceVertexUvs[ 0 ].push( [ uvs[ 1 ], uvs[ 2 ], uvs[ 3 ] ] );\r\n\r\n\t}\r\n\r\n};\r\n\r\nTHREE.ExtrudeGeometry.WorldUVGenerator = {\r\n\r\n\tgenerateTopUV: function ( geometry, indexA, indexB, indexC ) {\r\n\r\n\t\tvar vertices = geometry.vertices;\r\n\r\n\t\tvar a = vertices[ indexA ];\r\n\t\tvar b = vertices[ indexB ];\r\n\t\tvar c = vertices[ indexC ];\r\n\r\n\t\treturn [\r\n\t\t\tnew THREE.Vector2( a.x, a.y ),\r\n\t\t\tnew THREE.Vector2( b.x, b.y ),\r\n\t\t\tnew THREE.Vector2( c.x, c.y )\r\n\t\t];\r\n\r\n\t},\r\n\r\n\tgenerateSideWallUV: function ( geometry, indexA, indexB, indexC, indexD ) {\r\n\r\n\t\tvar vertices = geometry.vertices;\r\n\r\n\t\tvar a = vertices[ indexA ];\r\n\t\tvar b = vertices[ indexB ];\r\n\t\tvar c = vertices[ indexC ];\r\n\t\tvar d = vertices[ indexD ];\r\n\r\n\t\tif ( Math.abs( a.y - b.y ) < 0.01 ) {\r\n\t\t\treturn [\r\n\t\t\t\tnew THREE.Vector2( a.x, 1 - a.z ),\r\n\t\t\t\tnew THREE.Vector2( b.x, 1 - b.z ),\r\n\t\t\t\tnew THREE.Vector2( c.x, 1 - c.z ),\r\n\t\t\t\tnew THREE.Vector2( d.x, 1 - d.z )\r\n\t\t\t];\r\n\t\t} else {\r\n\t\t\treturn [\r\n\t\t\t\tnew THREE.Vector2( a.y, 1 - a.z ),\r\n\t\t\t\tnew THREE.Vector2( b.y, 1 - b.z ),\r\n\t\t\t\tnew THREE.Vector2( c.y, 1 - c.z ),\r\n\t\t\t\tnew THREE.Vector2( d.y, 1 - d.z )\r\n\t\t\t];\r\n\t\t}\r\n\t}\r\n};\r\n\r\n// File:src/extras/geometries/ShapeGeometry.js\r\n\r\n/**\r\n * @author jonobr1 / http://jonobr1.com\r\n *\r\n * Creates a one-sided polygonal geometry from a path shape. Similar to\r\n * ExtrudeGeometry.\r\n *\r\n * parameters = {\r\n *\r\n *\tcurveSegments: <int>, // number of points on the curves. NOT USED AT THE MOMENT.\r\n *\r\n *\tmaterial: <int> // material index for front and back faces\r\n *\tuvGenerator: <Object> // object that provides UV generator functions\r\n *\r\n * }\r\n **/\r\n\r\nTHREE.ShapeGeometry = function ( shapes, options ) {\r\n\r\n\tTHREE.Geometry.call( this );\r\n\r\n\tthis.type = 'ShapeGeometry';\r\n\r\n\tif ( shapes instanceof Array === false ) shapes = [ shapes ];\r\n\r\n\tthis.addShapeList( shapes, options );\r\n\r\n\tthis.computeFaceNormals();\r\n\r\n};\r\n\r\nTHREE.ShapeGeometry.prototype = Object.create( THREE.Geometry.prototype );\r\nTHREE.ShapeGeometry.prototype.constructor = THREE.ShapeGeometry;\r\n\r\n/**\r\n * Add an array of shapes to THREE.ShapeGeometry.\r\n */\r\nTHREE.ShapeGeometry.prototype.addShapeList = function ( shapes, options ) {\r\n\r\n\tfor ( var i = 0, l = shapes.length; i < l; i ++ ) {\r\n\r\n\t\tthis.addShape( shapes[ i ], options );\r\n\r\n\t}\r\n\r\n\treturn this;\r\n\r\n};\r\n\r\n/**\r\n * Adds a shape to THREE.ShapeGeometry, based on THREE.ExtrudeGeometry.\r\n */\r\nTHREE.ShapeGeometry.prototype.addShape = function ( shape, options ) {\r\n\r\n\tif ( options === undefined ) options = {};\r\n\tvar curveSegments = options.curveSegments !== undefined ? options.curveSegments : 12;\r\n\r\n\tvar material = options.material;\r\n\tvar uvgen = options.UVGenerator === undefined ? THREE.ExtrudeGeometry.WorldUVGenerator : options.UVGenerator;\r\n\r\n\t//\r\n\r\n\tvar i, l, hole;\r\n\r\n\tvar shapesOffset = this.vertices.length;\r\n\tvar shapePoints = shape.extractPoints( curveSegments );\r\n\r\n\tvar vertices = shapePoints.shape;\r\n\tvar holes = shapePoints.holes;\r\n\r\n\tvar reverse = ! THREE.Shape.Utils.isClockWise( vertices );\r\n\r\n\tif ( reverse ) {\r\n\r\n\t\tvertices = vertices.reverse();\r\n\r\n\t\t// Maybe we should also check if holes are in the opposite direction, just to be safe...\r\n\r\n\t\tfor ( i = 0, l = holes.length; i < l; i ++ ) {\r\n\r\n\t\t\thole = holes[ i ];\r\n\r\n\t\t\tif ( THREE.Shape.Utils.isClockWise( hole ) ) {\r\n\r\n\t\t\t\tholes[ i ] = hole.reverse();\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\treverse = false;\r\n\r\n\t}\r\n\r\n\tvar faces = THREE.Shape.Utils.triangulateShape( vertices, holes );\r\n\r\n\t// Vertices\r\n\r\n\tvar contour = vertices;\r\n\r\n\tfor ( i = 0, l = holes.length; i < l; i ++ ) {\r\n\r\n\t\thole = holes[ i ];\r\n\t\tvertices = vertices.concat( hole );\r\n\r\n\t}\r\n\r\n\t//\r\n\r\n\tvar vert, vlen = vertices.length;\r\n\tvar face, flen = faces.length;\r\n\r\n\tfor ( i = 0; i < vlen; i ++ ) {\r\n\r\n\t\tvert = vertices[ i ];\r\n\r\n\t\tthis.vertices.push( new THREE.Vector3( vert.x, vert.y, 0 ) );\r\n\r\n\t}\r\n\r\n\tfor ( i = 0; i < flen; i ++ ) {\r\n\r\n\t\tface = faces[ i ];\r\n\r\n\t\tvar a = face[ 0 ] + shapesOffset;\r\n\t\tvar b = face[ 1 ] + shapesOffset;\r\n\t\tvar c = face[ 2 ] + shapesOffset;\r\n\r\n\t\tthis.faces.push( new THREE.Face3( a, b, c, null, null, material ) );\r\n\t\tthis.faceVertexUvs[ 0 ].push( uvgen.generateTopUV( this, a, b, c ) );\r\n\r\n\t}\r\n\r\n};\r\n\r\n// File:src/extras/geometries/LatheGeometry.js\r\n\r\n/**\r\n * @author astrodud / http://astrodud.isgreat.org/\r\n * @author zz85 / https://github.com/zz85\r\n * @author bhouston / http://exocortex.com\r\n */\r\n\r\n// points - to create a closed torus, one must use a set of points \r\n//    like so: [ a, b, c, d, a ], see first is the same as last.\r\n// segments - the number of circumference segments to create\r\n// phiStart - the starting radian\r\n// phiLength - the radian (0 to 2*PI) range of the lathed section\r\n//    2*pi is a closed lathe, less than 2PI is a portion.\r\n\r\nTHREE.LatheGeometry = function ( points, segments, phiStart, phiLength ) {\r\n\r\n\tTHREE.Geometry.call( this );\r\n\r\n\tthis.type = 'LatheGeometry';\r\n\r\n\tthis.parameters = {\r\n\t\tpoints: points,\r\n\t\tsegments: segments,\r\n\t\tphiStart: phiStart,\r\n\t\tphiLength: phiLength\r\n\t};\r\n\r\n\tsegments = segments || 12;\r\n\tphiStart = phiStart || 0;\r\n\tphiLength = phiLength || 2 * Math.PI;\r\n\r\n\tvar inversePointLength = 1.0 / ( points.length - 1 );\r\n\tvar inverseSegments = 1.0 / segments;\r\n\r\n\tfor ( var i = 0, il = segments; i <= il; i ++ ) {\r\n\r\n\t\tvar phi = phiStart + i * inverseSegments * phiLength;\r\n\r\n\t\tvar c = Math.cos( phi ),\r\n\t\t\ts = Math.sin( phi );\r\n\r\n\t\tfor ( var j = 0, jl = points.length; j < jl; j ++ ) {\r\n\r\n\t\t\tvar pt = points[ j ];\r\n\r\n\t\t\tvar vertex = new THREE.Vector3();\r\n\r\n\t\t\tvertex.x = c * pt.x - s * pt.y;\r\n\t\t\tvertex.y = s * pt.x + c * pt.y;\r\n\t\t\tvertex.z = pt.z;\r\n\r\n\t\t\tthis.vertices.push( vertex );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tvar np = points.length;\r\n\r\n\tfor ( var i = 0, il = segments; i < il; i ++ ) {\r\n\r\n\t\tfor ( var j = 0, jl = points.length - 1; j < jl; j ++ ) {\r\n\r\n\t\t\tvar base = j + np * i;\r\n\t\t\tvar a = base;\r\n\t\t\tvar b = base + np;\r\n\t\t\tvar c = base + 1 + np;\r\n\t\t\tvar d = base + 1;\r\n\r\n\t\t\tvar u0 = i * inverseSegments;\r\n\t\t\tvar v0 = j * inversePointLength;\r\n\t\t\tvar u1 = u0 + inverseSegments;\r\n\t\t\tvar v1 = v0 + inversePointLength;\r\n\r\n\t\t\tthis.faces.push( new THREE.Face3( a, b, d ) );\r\n\r\n\t\t\tthis.faceVertexUvs[ 0 ].push( [\r\n\r\n\t\t\t\tnew THREE.Vector2( u0, v0 ),\r\n\t\t\t\tnew THREE.Vector2( u1, v0 ),\r\n\t\t\t\tnew THREE.Vector2( u0, v1 )\r\n\r\n\t\t\t] );\r\n\r\n\t\t\tthis.faces.push( new THREE.Face3( b, c, d ) );\r\n\r\n\t\t\tthis.faceVertexUvs[ 0 ].push( [\r\n\r\n\t\t\t\tnew THREE.Vector2( u1, v0 ),\r\n\t\t\t\tnew THREE.Vector2( u1, v1 ),\r\n\t\t\t\tnew THREE.Vector2( u0, v1 )\r\n\r\n\t\t\t] );\r\n\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tthis.mergeVertices();\r\n\tthis.computeFaceNormals();\r\n\tthis.computeVertexNormals();\r\n\r\n};\r\n\r\nTHREE.LatheGeometry.prototype = Object.create( THREE.Geometry.prototype );\r\nTHREE.LatheGeometry.prototype.constructor = THREE.LatheGeometry;\r\n\r\n// File:src/extras/geometries/PlaneGeometry.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * based on http://papervision3d.googlecode.com/svn/trunk/as3/trunk/src/org/papervision3d/objects/primitives/Plane.as\r\n */\r\n\r\nTHREE.PlaneGeometry = function ( width, height, widthSegments, heightSegments ) {\r\n\r\n\tconsole.info( 'THREE.PlaneGeometry: Consider using THREE.PlaneBufferGeometry for lower memory footprint.' );\r\n\r\n\tTHREE.Geometry.call( this );\r\n\r\n\tthis.type = 'PlaneGeometry';\r\n\r\n\tthis.parameters = {\r\n\t\twidth: width,\r\n\t\theight: height,\r\n\t\twidthSegments: widthSegments,\r\n\t\theightSegments: heightSegments\r\n\t};\r\n\r\n\tthis.fromBufferGeometry( new THREE.PlaneBufferGeometry( width, height, widthSegments, heightSegments ) );\r\n\r\n};\r\n\r\nTHREE.PlaneGeometry.prototype = Object.create( THREE.Geometry.prototype );\r\nTHREE.PlaneGeometry.prototype.constructor = THREE.PlaneGeometry;\r\n\r\n// File:src/extras/geometries/PlaneBufferGeometry.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * based on http://papervision3d.googlecode.com/svn/trunk/as3/trunk/src/org/papervision3d/objects/primitives/Plane.as\r\n */\r\n\r\nTHREE.PlaneBufferGeometry = function ( width, height, widthSegments, heightSegments ) {\r\n\r\n\tTHREE.BufferGeometry.call( this );\r\n\r\n\tthis.type = 'PlaneBufferGeometry';\r\n\r\n\tthis.parameters = {\r\n\t\twidth: width,\r\n\t\theight: height,\r\n\t\twidthSegments: widthSegments,\r\n\t\theightSegments: heightSegments\r\n\t};\r\n\r\n\tvar width_half = width / 2;\r\n\tvar height_half = height / 2;\r\n\r\n\tvar gridX = widthSegments || 1;\r\n\tvar gridY = heightSegments || 1;\r\n\r\n\tvar gridX1 = gridX + 1;\r\n\tvar gridY1 = gridY + 1;\r\n\r\n\tvar segment_width = width / gridX;\r\n\tvar segment_height = height / gridY;\r\n\r\n\tvar vertices = new Float32Array( gridX1 * gridY1 * 3 );\r\n\tvar normals = new Float32Array( gridX1 * gridY1 * 3 );\r\n\tvar uvs = new Float32Array( gridX1 * gridY1 * 2 );\r\n\r\n\tvar offset = 0;\r\n\tvar offset2 = 0;\r\n\r\n\tfor ( var iy = 0; iy < gridY1; iy ++ ) {\r\n\r\n\t\tvar y = iy * segment_height - height_half;\r\n\r\n\t\tfor ( var ix = 0; ix < gridX1; ix ++ ) {\r\n\r\n\t\t\tvar x = ix * segment_width - width_half;\r\n\r\n\t\t\tvertices[ offset     ] = x;\r\n\t\t\tvertices[ offset + 1 ] = - y;\r\n\r\n\t\t\tnormals[ offset + 2 ] = 1;\r\n\r\n\t\t\tuvs[ offset2     ] = ix / gridX;\r\n\t\t\tuvs[ offset2 + 1 ] = 1 - ( iy / gridY );\r\n\r\n\t\t\toffset += 3;\r\n\t\t\toffset2 += 2;\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\toffset = 0;\r\n\r\n\tvar indices = new ( ( vertices.length / 3 ) > 65535 ? Uint32Array : Uint16Array )( gridX * gridY * 6 );\r\n\r\n\tfor ( var iy = 0; iy < gridY; iy ++ ) {\r\n\r\n\t\tfor ( var ix = 0; ix < gridX; ix ++ ) {\r\n\r\n\t\t\tvar a = ix + gridX1 * iy;\r\n\t\t\tvar b = ix + gridX1 * ( iy + 1 );\r\n\t\t\tvar c = ( ix + 1 ) + gridX1 * ( iy + 1 );\r\n\t\t\tvar d = ( ix + 1 ) + gridX1 * iy;\r\n\r\n\t\t\tindices[ offset     ] = a;\r\n\t\t\tindices[ offset + 1 ] = b;\r\n\t\t\tindices[ offset + 2 ] = d;\r\n\r\n\t\t\tindices[ offset + 3 ] = b;\r\n\t\t\tindices[ offset + 4 ] = c;\r\n\t\t\tindices[ offset + 5 ] = d;\r\n\r\n\t\t\toffset += 6;\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tthis.addAttribute( 'index', new THREE.BufferAttribute( indices, 1 ) );\r\n\tthis.addAttribute( 'position', new THREE.BufferAttribute( vertices, 3 ) );\r\n\tthis.addAttribute( 'normal', new THREE.BufferAttribute( normals, 3 ) );\r\n\tthis.addAttribute( 'uv', new THREE.BufferAttribute( uvs, 2 ) );\r\n\r\n};\r\n\r\nTHREE.PlaneBufferGeometry.prototype = Object.create( THREE.BufferGeometry.prototype );\r\nTHREE.PlaneBufferGeometry.prototype.constructor = THREE.PlaneBufferGeometry;\r\n\r\n// File:src/extras/geometries/RingGeometry.js\r\n\r\n/**\r\n * @author Kaleb Murphy\r\n */\r\n\r\nTHREE.RingGeometry = function ( innerRadius, outerRadius, thetaSegments, phiSegments, thetaStart, thetaLength ) {\r\n\r\n\tTHREE.Geometry.call( this );\r\n\r\n\tthis.type = 'RingGeometry';\r\n\r\n\tthis.parameters = {\r\n\t\tinnerRadius: innerRadius,\r\n\t\touterRadius: outerRadius,\r\n\t\tthetaSegments: thetaSegments,\r\n\t\tphiSegments: phiSegments,\r\n\t\tthetaStart: thetaStart,\r\n\t\tthetaLength: thetaLength\r\n\t};\r\n\r\n\tinnerRadius = innerRadius || 0;\r\n\touterRadius = outerRadius || 50;\r\n\r\n\tthetaStart = thetaStart !== undefined ? thetaStart : 0;\r\n\tthetaLength = thetaLength !== undefined ? thetaLength : Math.PI * 2;\r\n\r\n\tthetaSegments = thetaSegments !== undefined ? Math.max( 3, thetaSegments ) : 8;\r\n\tphiSegments = phiSegments !== undefined ? Math.max( 1, phiSegments ) : 8;\r\n\r\n\tvar i, o, uvs = [], radius = innerRadius, radiusStep = ( ( outerRadius - innerRadius ) / phiSegments );\r\n\r\n\tfor ( i = 0; i < phiSegments + 1; i ++ ) { // concentric circles inside ring\r\n\r\n\t\tfor ( o = 0; o < thetaSegments + 1; o ++ ) { // number of segments per circle\r\n\r\n\t\t\tvar vertex = new THREE.Vector3();\r\n\t\t\tvar segment = thetaStart + o / thetaSegments * thetaLength;\r\n\t\t\tvertex.x = radius * Math.cos( segment );\r\n\t\t\tvertex.y = radius * Math.sin( segment );\r\n\r\n\t\t\tthis.vertices.push( vertex );\r\n\t\t\tuvs.push( new THREE.Vector2( ( vertex.x / outerRadius + 1 ) / 2, ( vertex.y / outerRadius + 1 ) / 2 ) );\r\n\t\t}\r\n\r\n\t\tradius += radiusStep;\r\n\r\n\t}\r\n\r\n\tvar n = new THREE.Vector3( 0, 0, 1 );\r\n\r\n\tfor ( i = 0; i < phiSegments; i ++ ) { // concentric circles inside ring\r\n\r\n\t\tvar thetaSegment = i * (thetaSegments + 1);\r\n\r\n\t\tfor ( o = 0; o < thetaSegments ; o ++ ) { // number of segments per circle\r\n\r\n\t\t\tvar segment = o + thetaSegment;\r\n\r\n\t\t\tvar v1 = segment;\r\n\t\t\tvar v2 = segment + thetaSegments + 1;\r\n\t\t\tvar v3 = segment + thetaSegments + 2;\r\n\r\n\t\t\tthis.faces.push( new THREE.Face3( v1, v2, v3, [ n.clone(), n.clone(), n.clone() ] ) );\r\n\t\t\tthis.faceVertexUvs[ 0 ].push( [ uvs[ v1 ].clone(), uvs[ v2 ].clone(), uvs[ v3 ].clone() ]);\r\n\r\n\t\t\tv1 = segment;\r\n\t\t\tv2 = segment + thetaSegments + 2;\r\n\t\t\tv3 = segment + 1;\r\n\r\n\t\t\tthis.faces.push( new THREE.Face3( v1, v2, v3, [ n.clone(), n.clone(), n.clone() ] ) );\r\n\t\t\tthis.faceVertexUvs[ 0 ].push( [ uvs[ v1 ].clone(), uvs[ v2 ].clone(), uvs[ v3 ].clone() ]);\r\n\r\n\t\t}\r\n\t}\r\n\r\n\tthis.computeFaceNormals();\r\n\r\n\tthis.boundingSphere = new THREE.Sphere( new THREE.Vector3(), radius );\r\n\r\n};\r\n\r\nTHREE.RingGeometry.prototype = Object.create( THREE.Geometry.prototype );\r\nTHREE.RingGeometry.prototype.constructor = THREE.RingGeometry;\r\n\r\n\r\n// File:src/extras/geometries/SphereGeometry.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.SphereGeometry = function ( radius, widthSegments, heightSegments, phiStart, phiLength, thetaStart, thetaLength ) {\r\n\r\n\tTHREE.Geometry.call( this );\r\n\r\n\tthis.type = 'SphereGeometry';\r\n\r\n\tthis.parameters = {\r\n\t\tradius: radius,\r\n\t\twidthSegments: widthSegments,\r\n\t\theightSegments: heightSegments,\r\n\t\tphiStart: phiStart,\r\n\t\tphiLength: phiLength,\r\n\t\tthetaStart: thetaStart,\r\n\t\tthetaLength: thetaLength \r\n\t};\r\n\r\n\tradius = radius || 50;\r\n\r\n\twidthSegments = Math.max( 3, Math.floor( widthSegments ) || 8 );\r\n\theightSegments = Math.max( 2, Math.floor( heightSegments ) || 6 );\r\n\r\n\tphiStart = phiStart !== undefined ? phiStart : 0;\r\n\tphiLength = phiLength !== undefined ? phiLength : Math.PI * 2;\r\n\r\n\tthetaStart = thetaStart !== undefined ? thetaStart : 0;\r\n\tthetaLength = thetaLength !== undefined ? thetaLength : Math.PI;\r\n\r\n\tvar x, y, vertices = [], uvs = [];\r\n\r\n\tfor ( y = 0; y <= heightSegments; y ++ ) {\r\n\r\n\t\tvar verticesRow = [];\r\n\t\tvar uvsRow = [];\r\n\r\n\t\tfor ( x = 0; x <= widthSegments; x ++ ) {\r\n\r\n\t\t\tvar u = x / widthSegments;\r\n\t\t\tvar v = y / heightSegments;\r\n\r\n\t\t\tvar vertex = new THREE.Vector3();\r\n\t\t\tvertex.x = - radius * Math.cos( phiStart + u * phiLength ) * Math.sin( thetaStart + v * thetaLength );\r\n\t\t\tvertex.y = radius * Math.cos( thetaStart + v * thetaLength );\r\n\t\t\tvertex.z = radius * Math.sin( phiStart + u * phiLength ) * Math.sin( thetaStart + v * thetaLength );\r\n\r\n\t\t\tthis.vertices.push( vertex );\r\n\r\n\t\t\tverticesRow.push( this.vertices.length - 1 );\r\n\t\t\tuvsRow.push( new THREE.Vector2( u, 1 - v ) );\r\n\r\n\t\t}\r\n\r\n\t\tvertices.push( verticesRow );\r\n\t\tuvs.push( uvsRow );\r\n\r\n\t}\r\n\r\n\tfor ( y = 0; y < heightSegments; y ++ ) {\r\n\r\n\t\tfor ( x = 0; x < widthSegments; x ++ ) {\r\n\r\n\t\t\tvar v1 = vertices[ y ][ x + 1 ];\r\n\t\t\tvar v2 = vertices[ y ][ x ];\r\n\t\t\tvar v3 = vertices[ y + 1 ][ x ];\r\n\t\t\tvar v4 = vertices[ y + 1 ][ x + 1 ];\r\n\r\n\t\t\tvar n1 = this.vertices[ v1 ].clone().normalize();\r\n\t\t\tvar n2 = this.vertices[ v2 ].clone().normalize();\r\n\t\t\tvar n3 = this.vertices[ v3 ].clone().normalize();\r\n\t\t\tvar n4 = this.vertices[ v4 ].clone().normalize();\r\n\r\n\t\t\tvar uv1 = uvs[ y ][ x + 1 ].clone();\r\n\t\t\tvar uv2 = uvs[ y ][ x ].clone();\r\n\t\t\tvar uv3 = uvs[ y + 1 ][ x ].clone();\r\n\t\t\tvar uv4 = uvs[ y + 1 ][ x + 1 ].clone();\r\n\r\n\t\t\tif ( Math.abs( this.vertices[ v1 ].y ) === radius ) {\r\n\r\n\t\t\t\tuv1.x = ( uv1.x + uv2.x ) / 2;\r\n\t\t\t\tthis.faces.push( new THREE.Face3( v1, v3, v4, [ n1, n3, n4 ] ) );\r\n\t\t\t\tthis.faceVertexUvs[ 0 ].push( [ uv1, uv3, uv4 ] );\r\n\r\n\t\t\t} else if ( Math.abs( this.vertices[ v3 ].y ) === radius ) {\r\n\r\n\t\t\t\tuv3.x = ( uv3.x + uv4.x ) / 2;\r\n\t\t\t\tthis.faces.push( new THREE.Face3( v1, v2, v3, [ n1, n2, n3 ] ) );\r\n\t\t\t\tthis.faceVertexUvs[ 0 ].push( [ uv1, uv2, uv3 ] );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tthis.faces.push( new THREE.Face3( v1, v2, v4, [ n1, n2, n4 ] ) );\r\n\t\t\t\tthis.faceVertexUvs[ 0 ].push( [ uv1, uv2, uv4 ] );\r\n\r\n\t\t\t\tthis.faces.push( new THREE.Face3( v2, v3, v4, [ n2.clone(), n3, n4.clone() ] ) );\r\n\t\t\t\tthis.faceVertexUvs[ 0 ].push( [ uv2.clone(), uv3, uv4.clone() ] );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tthis.computeFaceNormals();\r\n\r\n\tthis.boundingSphere = new THREE.Sphere( new THREE.Vector3(), radius );\r\n\r\n};\r\n\r\nTHREE.SphereGeometry.prototype = Object.create( THREE.Geometry.prototype );\r\nTHREE.SphereGeometry.prototype.constructor = THREE.SphereGeometry;\r\n\r\n// File:src/extras/geometries/TextGeometry.js\r\n\r\n/**\r\n * @author zz85 / http://www.lab4games.net/zz85/blog\r\n * @author alteredq / http://alteredqualia.com/\r\n *\r\n * For creating 3D text geometry in three.js\r\n *\r\n * Text = 3D Text\r\n *\r\n * parameters = {\r\n *  size: \t\t\t<float>, \t// size of the text\r\n *  height: \t\t<float>, \t// thickness to extrude text\r\n *  curveSegments: \t<int>,\t\t// number of points on the curves\r\n *\r\n *  font: \t\t\t<string>,\t\t// font name\r\n *  weight: \t\t<string>,\t\t// font weight (normal, bold)\r\n *  style: \t\t\t<string>,\t\t// font style  (normal, italics)\r\n *\r\n *  bevelEnabled:\t<bool>,\t\t\t// turn on bevel\r\n *  bevelThickness: <float>, \t\t// how deep into text bevel goes\r\n *  bevelSize:\t\t<float>, \t\t// how far from text outline is bevel\r\n *  }\r\n *\r\n */\r\n\r\n/*\tUsage Examples\r\n\r\n\t// TextGeometry wrapper\r\n\r\n\tvar text3d = new TextGeometry( text, options );\r\n\r\n\t// Complete manner\r\n\r\n\tvar textShapes = THREE.FontUtils.generateShapes( text, options );\r\n\tvar text3d = new ExtrudeGeometry( textShapes, options );\r\n\r\n*/\r\n\r\n\r\nTHREE.TextGeometry = function ( text, parameters ) {\r\n\r\n\tparameters = parameters || {};\r\n\r\n\tvar textShapes = THREE.FontUtils.generateShapes( text, parameters );\r\n\r\n\t// translate parameters to ExtrudeGeometry API\r\n\r\n\tparameters.amount = parameters.height !== undefined ? parameters.height : 50;\r\n\r\n\t// defaults\r\n\r\n\tif ( parameters.bevelThickness === undefined ) parameters.bevelThickness = 10;\r\n\tif ( parameters.bevelSize === undefined ) parameters.bevelSize = 8;\r\n\tif ( parameters.bevelEnabled === undefined ) parameters.bevelEnabled = false;\r\n\r\n\tTHREE.ExtrudeGeometry.call( this, textShapes, parameters );\r\n\r\n\tthis.type = 'TextGeometry';\r\n\r\n};\r\n\r\nTHREE.TextGeometry.prototype = Object.create( THREE.ExtrudeGeometry.prototype );\r\nTHREE.TextGeometry.prototype.constructor = THREE.TextGeometry;\r\n\r\n// File:src/extras/geometries/TorusGeometry.js\r\n\r\n/**\r\n * @author oosmoxiecode\r\n * @author mrdoob / http://mrdoob.com/\r\n * based on http://code.google.com/p/away3d/source/browse/trunk/fp10/Away3DLite/src/away3dlite/primitives/Torus.as?r=2888\r\n */\r\n\r\nTHREE.TorusGeometry = function ( radius, tube, radialSegments, tubularSegments, arc ) {\r\n\r\n\tTHREE.Geometry.call( this );\r\n\r\n\tthis.type = 'TorusGeometry';\r\n\r\n\tthis.parameters = {\r\n\t\tradius: radius,\r\n\t\ttube: tube,\r\n\t\tradialSegments: radialSegments,\r\n\t\ttubularSegments: tubularSegments,\r\n\t\tarc: arc\r\n\t};\r\n\r\n\tradius = radius || 100;\r\n\ttube = tube || 40;\r\n\tradialSegments = radialSegments || 8;\r\n\ttubularSegments = tubularSegments || 6;\r\n\tarc = arc || Math.PI * 2;\r\n\r\n\tvar center = new THREE.Vector3(), uvs = [], normals = [];\r\n\r\n\tfor ( var j = 0; j <= radialSegments; j ++ ) {\r\n\r\n\t\tfor ( var i = 0; i <= tubularSegments; i ++ ) {\r\n\r\n\t\t\tvar u = i / tubularSegments * arc;\r\n\t\t\tvar v = j / radialSegments * Math.PI * 2;\r\n\r\n\t\t\tcenter.x = radius * Math.cos( u );\r\n\t\t\tcenter.y = radius * Math.sin( u );\r\n\r\n\t\t\tvar vertex = new THREE.Vector3();\r\n\t\t\tvertex.x = ( radius + tube * Math.cos( v ) ) * Math.cos( u );\r\n\t\t\tvertex.y = ( radius + tube * Math.cos( v ) ) * Math.sin( u );\r\n\t\t\tvertex.z = tube * Math.sin( v );\r\n\r\n\t\t\tthis.vertices.push( vertex );\r\n\r\n\t\t\tuvs.push( new THREE.Vector2( i / tubularSegments, j / radialSegments ) );\r\n\t\t\tnormals.push( vertex.clone().sub( center ).normalize() );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tfor ( var j = 1; j <= radialSegments; j ++ ) {\r\n\r\n\t\tfor ( var i = 1; i <= tubularSegments; i ++ ) {\r\n\r\n\t\t\tvar a = ( tubularSegments + 1 ) * j + i - 1;\r\n\t\t\tvar b = ( tubularSegments + 1 ) * ( j - 1 ) + i - 1;\r\n\t\t\tvar c = ( tubularSegments + 1 ) * ( j - 1 ) + i;\r\n\t\t\tvar d = ( tubularSegments + 1 ) * j + i;\r\n\r\n\t\t\tvar face = new THREE.Face3( a, b, d, [ normals[ a ].clone(), normals[ b ].clone(), normals[ d ].clone() ] );\r\n\t\t\tthis.faces.push( face );\r\n\t\t\tthis.faceVertexUvs[ 0 ].push( [ uvs[ a ].clone(), uvs[ b ].clone(), uvs[ d ].clone() ] );\r\n\r\n\t\t\tface = new THREE.Face3( b, c, d, [ normals[ b ].clone(), normals[ c ].clone(), normals[ d ].clone() ] );\r\n\t\t\tthis.faces.push( face );\r\n\t\t\tthis.faceVertexUvs[ 0 ].push( [ uvs[ b ].clone(), uvs[ c ].clone(), uvs[ d ].clone() ] );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tthis.computeFaceNormals();\r\n\r\n};\r\n\r\nTHREE.TorusGeometry.prototype = Object.create( THREE.Geometry.prototype );\r\nTHREE.TorusGeometry.prototype.constructor = THREE.TorusGeometry;\r\n\r\n// File:src/extras/geometries/TorusKnotGeometry.js\r\n\r\n/**\r\n * @author oosmoxiecode\r\n * based on http://code.google.com/p/away3d/source/browse/trunk/fp10/Away3D/src/away3d/primitives/TorusKnot.as?spec=svn2473&r=2473\r\n */\r\n\r\nTHREE.TorusKnotGeometry = function ( radius, tube, radialSegments, tubularSegments, p, q, heightScale ) {\r\n\r\n\tTHREE.Geometry.call( this );\r\n\r\n\tthis.type = 'TorusKnotGeometry';\r\n\r\n\tthis.parameters = {\r\n\t\tradius: radius,\r\n\t\ttube: tube,\r\n\t\tradialSegments: radialSegments,\r\n\t\ttubularSegments: tubularSegments,\r\n\t\tp: p,\r\n\t\tq: q,\r\n\t\theightScale: heightScale\r\n\t};\r\n\r\n\tradius = radius || 100;\r\n\ttube = tube || 40;\r\n\tradialSegments = radialSegments || 64;\r\n\ttubularSegments = tubularSegments || 8;\r\n\tp = p || 2;\r\n\tq = q || 3;\r\n\theightScale = heightScale || 1;\r\n\t\r\n\tvar grid = new Array( radialSegments );\r\n\tvar tang = new THREE.Vector3();\r\n\tvar n = new THREE.Vector3();\r\n\tvar bitan = new THREE.Vector3();\r\n\r\n\tfor ( var i = 0; i < radialSegments; ++ i ) {\r\n\r\n\t\tgrid[ i ] = new Array( tubularSegments );\r\n\t\tvar u = i / radialSegments * 2 * p * Math.PI;\r\n\t\tvar p1 = getPos( u, q, p, radius, heightScale );\r\n\t\tvar p2 = getPos( u + 0.01, q, p, radius, heightScale );\r\n\t\ttang.subVectors( p2, p1 );\r\n\t\tn.addVectors( p2, p1 );\r\n\r\n\t\tbitan.crossVectors( tang, n );\r\n\t\tn.crossVectors( bitan, tang );\r\n\t\tbitan.normalize();\r\n\t\tn.normalize();\r\n\r\n\t\tfor ( var j = 0; j < tubularSegments; ++ j ) {\r\n\r\n\t\t\tvar v = j / tubularSegments * 2 * Math.PI;\r\n\t\t\tvar cx = - tube * Math.cos( v ); // TODO: Hack: Negating it so it faces outside.\r\n\t\t\tvar cy = tube * Math.sin( v );\r\n\r\n\t\t\tvar pos = new THREE.Vector3();\r\n\t\t\tpos.x = p1.x + cx * n.x + cy * bitan.x;\r\n\t\t\tpos.y = p1.y + cx * n.y + cy * bitan.y;\r\n\t\t\tpos.z = p1.z + cx * n.z + cy * bitan.z;\r\n\r\n\t\t\tgrid[ i ][ j ] = this.vertices.push( pos ) - 1;\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tfor ( var i = 0; i < radialSegments; ++ i ) {\r\n\r\n\t\tfor ( var j = 0; j < tubularSegments; ++ j ) {\r\n\r\n\t\t\tvar ip = ( i + 1 ) % radialSegments;\r\n\t\t\tvar jp = ( j + 1 ) % tubularSegments;\r\n\r\n\t\t\tvar a = grid[ i ][ j ];\r\n\t\t\tvar b = grid[ ip ][ j ];\r\n\t\t\tvar c = grid[ ip ][ jp ];\r\n\t\t\tvar d = grid[ i ][ jp ];\r\n\r\n\t\t\tvar uva = new THREE.Vector2( i / radialSegments, j / tubularSegments );\r\n\t\t\tvar uvb = new THREE.Vector2( ( i + 1 ) / radialSegments, j / tubularSegments );\r\n\t\t\tvar uvc = new THREE.Vector2( ( i + 1 ) / radialSegments, ( j + 1 ) / tubularSegments );\r\n\t\t\tvar uvd = new THREE.Vector2( i / radialSegments, ( j + 1 ) / tubularSegments );\r\n\r\n\t\t\tthis.faces.push( new THREE.Face3( a, b, d ) );\r\n\t\t\tthis.faceVertexUvs[ 0 ].push( [ uva, uvb, uvd ] );\r\n\r\n\t\t\tthis.faces.push( new THREE.Face3( b, c, d ) );\r\n\t\t\tthis.faceVertexUvs[ 0 ].push( [ uvb.clone(), uvc, uvd.clone() ] );\r\n\r\n\t\t}\r\n\t}\r\n\r\n\tthis.computeFaceNormals();\r\n\tthis.computeVertexNormals();\r\n\r\n\tfunction getPos( u, in_q, in_p, radius, heightScale ) {\r\n\r\n\t\tvar cu = Math.cos( u );\r\n\t\tvar su = Math.sin( u );\r\n\t\tvar quOverP = in_q / in_p * u;\r\n\t\tvar cs = Math.cos( quOverP );\r\n\r\n\t\tvar tx = radius * ( 2 + cs ) * 0.5 * cu;\r\n\t\tvar ty = radius * ( 2 + cs ) * su * 0.5;\r\n\t\tvar tz = heightScale * radius * Math.sin( quOverP ) * 0.5;\r\n\r\n\t\treturn new THREE.Vector3( tx, ty, tz );\r\n\r\n\t}\r\n\r\n};\r\n\r\nTHREE.TorusKnotGeometry.prototype = Object.create( THREE.Geometry.prototype );\r\nTHREE.TorusKnotGeometry.prototype.constructor = THREE.TorusKnotGeometry;\r\n\r\n// File:src/extras/geometries/TubeGeometry.js\r\n\r\n/**\r\n * @author WestLangley / https://github.com/WestLangley\r\n * @author zz85 / https://github.com/zz85\r\n * @author miningold / https://github.com/miningold\r\n * @author jonobr1 / https://github.com/jonobr1\r\n *\r\n * Modified from the TorusKnotGeometry by @oosmoxiecode\r\n *\r\n * Creates a tube which extrudes along a 3d spline\r\n *\r\n * Uses parallel transport frames as described in\r\n * http://www.cs.indiana.edu/pub/techreports/TR425.pdf\r\n */\r\n\r\nTHREE.TubeGeometry = function ( path, segments, radius, radialSegments, closed, taper ) {\r\n\r\n\tTHREE.Geometry.call( this );\r\n\r\n\tthis.type = 'TubeGeometry';\r\n\r\n\tthis.parameters = {\r\n\t\tpath: path,\r\n\t\tsegments: segments,\r\n\t\tradius: radius,\r\n\t\tradialSegments: radialSegments,\r\n\t\tclosed: closed\r\n\t};\r\n\r\n\tsegments = segments || 64;\r\n\tradius = radius || 1;\r\n\tradialSegments = radialSegments || 8;\r\n\tclosed = closed || false;\r\n\ttaper = taper || THREE.TubeGeometry.NoTaper;\r\n\r\n\tvar grid = [];\r\n\r\n\tvar scope = this,\r\n\r\n\t\ttangent,\r\n\t\tnormal,\r\n\t\tbinormal,\r\n\r\n\t\tnumpoints = segments + 1,\r\n\r\n\t\tu, v, r,\r\n\r\n\t\tcx, cy,\r\n\t\tpos, pos2 = new THREE.Vector3(),\r\n\t\ti, j,\r\n\t\tip, jp,\r\n\t\ta, b, c, d,\r\n\t\tuva, uvb, uvc, uvd;\r\n\r\n\tvar frames = new THREE.TubeGeometry.FrenetFrames( path, segments, closed ),\r\n\t\ttangents = frames.tangents,\r\n\t\tnormals = frames.normals,\r\n\t\tbinormals = frames.binormals;\r\n\r\n\t// proxy internals\r\n\tthis.tangents = tangents;\r\n\tthis.normals = normals;\r\n\tthis.binormals = binormals;\r\n\r\n\tfunction vert( x, y, z ) {\r\n\r\n\t\treturn scope.vertices.push( new THREE.Vector3( x, y, z ) ) - 1;\r\n\r\n\t}\r\n\r\n\t// consruct the grid\r\n\r\n\tfor ( i = 0; i < numpoints; i ++ ) {\r\n\r\n\t\tgrid[ i ] = [];\r\n\r\n\t\tu = i / ( numpoints - 1 );\r\n\r\n\t\tpos = path.getPointAt( u );\r\n\r\n\t\ttangent = tangents[ i ];\r\n\t\tnormal = normals[ i ];\r\n\t\tbinormal = binormals[ i ];\r\n\r\n\t\tr = radius * taper( u );\r\n\r\n\t\tfor ( j = 0; j < radialSegments; j ++ ) {\r\n\r\n\t\t\tv = j / radialSegments * 2 * Math.PI;\r\n\r\n\t\t\tcx = - r * Math.cos( v ); // TODO: Hack: Negating it so it faces outside.\r\n\t\t\tcy = r * Math.sin( v );\r\n\r\n\t\t\tpos2.copy( pos );\r\n\t\t\tpos2.x += cx * normal.x + cy * binormal.x;\r\n\t\t\tpos2.y += cx * normal.y + cy * binormal.y;\r\n\t\t\tpos2.z += cx * normal.z + cy * binormal.z;\r\n\r\n\t\t\tgrid[ i ][ j ] = vert( pos2.x, pos2.y, pos2.z );\r\n\r\n\t\t}\r\n\t}\r\n\r\n\r\n\t// construct the mesh\r\n\r\n\tfor ( i = 0; i < segments; i ++ ) {\r\n\r\n\t\tfor ( j = 0; j < radialSegments; j ++ ) {\r\n\r\n\t\t\tip = ( closed ) ? (i + 1) % segments : i + 1;\r\n\t\t\tjp = (j + 1) % radialSegments;\r\n\r\n\t\t\ta = grid[ i ][ j ];\t\t// *** NOT NECESSARILY PLANAR ! ***\r\n\t\t\tb = grid[ ip ][ j ];\r\n\t\t\tc = grid[ ip ][ jp ];\r\n\t\t\td = grid[ i ][ jp ];\r\n\r\n\t\t\tuva = new THREE.Vector2( i / segments, j / radialSegments );\r\n\t\t\tuvb = new THREE.Vector2( ( i + 1 ) / segments, j / radialSegments );\r\n\t\t\tuvc = new THREE.Vector2( ( i + 1 ) / segments, ( j + 1 ) / radialSegments );\r\n\t\t\tuvd = new THREE.Vector2( i / segments, ( j + 1 ) / radialSegments );\r\n\r\n\t\t\tthis.faces.push( new THREE.Face3( a, b, d ) );\r\n\t\t\tthis.faceVertexUvs[ 0 ].push( [ uva, uvb, uvd ] );\r\n\r\n\t\t\tthis.faces.push( new THREE.Face3( b, c, d ) );\r\n\t\t\tthis.faceVertexUvs[ 0 ].push( [ uvb.clone(), uvc, uvd.clone() ] );\r\n\r\n\t\t}\r\n\t}\r\n\r\n\tthis.computeFaceNormals();\r\n\tthis.computeVertexNormals();\r\n\r\n};\r\n\r\nTHREE.TubeGeometry.prototype = Object.create( THREE.Geometry.prototype );\r\nTHREE.TubeGeometry.prototype.constructor = THREE.TubeGeometry;\r\n\r\nTHREE.TubeGeometry.NoTaper = function ( u ) {\r\n\r\n\treturn 1;\r\n\r\n};\r\n\r\nTHREE.TubeGeometry.SinusoidalTaper = function ( u ) {\r\n\r\n\treturn Math.sin( Math.PI * u );\r\n\r\n};\r\n\r\n// For computing of Frenet frames, exposing the tangents, normals and binormals the spline\r\nTHREE.TubeGeometry.FrenetFrames = function ( path, segments, closed ) {\r\n\r\n\tvar\tnormal = new THREE.Vector3(),\r\n\r\n\t\ttangents = [],\r\n\t\tnormals = [],\r\n\t\tbinormals = [],\r\n\r\n\t\tvec = new THREE.Vector3(),\r\n\t\tmat = new THREE.Matrix4(),\r\n\r\n\t\tnumpoints = segments + 1,\r\n\t\ttheta,\r\n\t\tepsilon = 0.0001,\r\n\t\tsmallest,\r\n\r\n\t\ttx, ty, tz,\r\n\t\ti, u;\r\n\r\n\r\n\t// expose internals\r\n\tthis.tangents = tangents;\r\n\tthis.normals = normals;\r\n\tthis.binormals = binormals;\r\n\r\n\t// compute the tangent vectors for each segment on the path\r\n\r\n\tfor ( i = 0; i < numpoints; i ++ ) {\r\n\r\n\t\tu = i / ( numpoints - 1 );\r\n\r\n\t\ttangents[ i ] = path.getTangentAt( u );\r\n\t\ttangents[ i ].normalize();\r\n\r\n\t}\r\n\r\n\tinitialNormal3();\r\n\r\n\t/*\r\n\tfunction initialNormal1(lastBinormal) {\r\n\t\t// fixed start binormal. Has dangers of 0 vectors\r\n\t\tnormals[ 0 ] = new THREE.Vector3();\r\n\t\tbinormals[ 0 ] = new THREE.Vector3();\r\n\t\tif (lastBinormal===undefined) lastBinormal = new THREE.Vector3( 0, 0, 1 );\r\n\t\tnormals[ 0 ].crossVectors( lastBinormal, tangents[ 0 ] ).normalize();\r\n\t\tbinormals[ 0 ].crossVectors( tangents[ 0 ], normals[ 0 ] ).normalize();\r\n\t}\r\n\r\n\tfunction initialNormal2() {\r\n\r\n\t\t// This uses the Frenet-Serret formula for deriving binormal\r\n\t\tvar t2 = path.getTangentAt( epsilon );\r\n\r\n\t\tnormals[ 0 ] = new THREE.Vector3().subVectors( t2, tangents[ 0 ] ).normalize();\r\n\t\tbinormals[ 0 ] = new THREE.Vector3().crossVectors( tangents[ 0 ], normals[ 0 ] );\r\n\r\n\t\tnormals[ 0 ].crossVectors( binormals[ 0 ], tangents[ 0 ] ).normalize(); // last binormal x tangent\r\n\t\tbinormals[ 0 ].crossVectors( tangents[ 0 ], normals[ 0 ] ).normalize();\r\n\r\n\t}\r\n\t*/\r\n\r\n\tfunction initialNormal3() {\r\n\t\t// select an initial normal vector perpenicular to the first tangent vector,\r\n\t\t// and in the direction of the smallest tangent xyz component\r\n\r\n\t\tnormals[ 0 ] = new THREE.Vector3();\r\n\t\tbinormals[ 0 ] = new THREE.Vector3();\r\n\t\tsmallest = Number.MAX_VALUE;\r\n\t\ttx = Math.abs( tangents[ 0 ].x );\r\n\t\tty = Math.abs( tangents[ 0 ].y );\r\n\t\ttz = Math.abs( tangents[ 0 ].z );\r\n\r\n\t\tif ( tx <= smallest ) {\r\n\t\t\tsmallest = tx;\r\n\t\t\tnormal.set( 1, 0, 0 );\r\n\t\t}\r\n\r\n\t\tif ( ty <= smallest ) {\r\n\t\t\tsmallest = ty;\r\n\t\t\tnormal.set( 0, 1, 0 );\r\n\t\t}\r\n\r\n\t\tif ( tz <= smallest ) {\r\n\t\t\tnormal.set( 0, 0, 1 );\r\n\t\t}\r\n\r\n\t\tvec.crossVectors( tangents[ 0 ], normal ).normalize();\r\n\r\n\t\tnormals[ 0 ].crossVectors( tangents[ 0 ], vec );\r\n\t\tbinormals[ 0 ].crossVectors( tangents[ 0 ], normals[ 0 ] );\r\n\t}\r\n\r\n\r\n\t// compute the slowly-varying normal and binormal vectors for each segment on the path\r\n\r\n\tfor ( i = 1; i < numpoints; i ++ ) {\r\n\r\n\t\tnormals[ i ] = normals[ i - 1 ].clone();\r\n\r\n\t\tbinormals[ i ] = binormals[ i - 1 ].clone();\r\n\r\n\t\tvec.crossVectors( tangents[ i - 1 ], tangents[ i ] );\r\n\r\n\t\tif ( vec.length() > epsilon ) {\r\n\r\n\t\t\tvec.normalize();\r\n\r\n\t\t\ttheta = Math.acos( THREE.Math.clamp( tangents[ i - 1 ].dot( tangents[ i ] ), - 1, 1 ) ); // clamp for floating pt errors\r\n\r\n\t\t\tnormals[ i ].applyMatrix4( mat.makeRotationAxis( vec, theta ) );\r\n\r\n\t\t}\r\n\r\n\t\tbinormals[ i ].crossVectors( tangents[ i ], normals[ i ] );\r\n\r\n\t}\r\n\r\n\r\n\t// if the curve is closed, postprocess the vectors so the first and last normal vectors are the same\r\n\r\n\tif ( closed ) {\r\n\r\n\t\ttheta = Math.acos( THREE.Math.clamp( normals[ 0 ].dot( normals[ numpoints - 1 ] ), - 1, 1 ) );\r\n\t\ttheta /= ( numpoints - 1 );\r\n\r\n\t\tif ( tangents[ 0 ].dot( vec.crossVectors( normals[ 0 ], normals[ numpoints - 1 ] ) ) > 0 ) {\r\n\r\n\t\t\ttheta = - theta;\r\n\r\n\t\t}\r\n\r\n\t\tfor ( i = 1; i < numpoints; i ++ ) {\r\n\r\n\t\t\t// twist a little...\r\n\t\t\tnormals[ i ].applyMatrix4( mat.makeRotationAxis( tangents[ i ], theta * i ) );\r\n\t\t\tbinormals[ i ].crossVectors( tangents[ i ], normals[ i ] );\r\n\r\n\t\t}\r\n\r\n\t}\r\n};\r\n\r\n// File:src/extras/geometries/PolyhedronGeometry.js\r\n\r\n/**\r\n * @author clockworkgeek / https://github.com/clockworkgeek\r\n * @author timothypratley / https://github.com/timothypratley\r\n * @author WestLangley / http://github.com/WestLangley\r\n*/\r\n\r\nTHREE.PolyhedronGeometry = function ( vertices, indices, radius, detail ) {\r\n\r\n\tTHREE.Geometry.call( this );\r\n\r\n\tthis.type = 'PolyhedronGeometry';\r\n\r\n\tthis.parameters = {\r\n\t\tvertices: vertices,\r\n\t\tindices: indices,\r\n\t\tradius: radius,\r\n\t\tdetail: detail\r\n\t};\r\n\r\n\tradius = radius || 1;\r\n\tdetail = detail || 0;\r\n\r\n\tvar that = this;\r\n\r\n\tfor ( var i = 0, l = vertices.length; i < l; i += 3 ) {\r\n\r\n\t\tprepare( new THREE.Vector3( vertices[ i ], vertices[ i + 1 ], vertices[ i + 2 ] ) );\r\n\r\n\t}\r\n\r\n\tvar p = this.vertices;\r\n\r\n\tvar faces = [];\r\n\r\n\tfor ( var i = 0, j = 0, l = indices.length; i < l; i += 3, j ++ ) {\r\n\r\n\t\tvar v1 = p[ indices[ i     ] ];\r\n\t\tvar v2 = p[ indices[ i + 1 ] ];\r\n\t\tvar v3 = p[ indices[ i + 2 ] ];\r\n\r\n\t\tfaces[ j ] = new THREE.Face3( v1.index, v2.index, v3.index, [ v1.clone(), v2.clone(), v3.clone() ] );\r\n\r\n\t}\r\n\r\n\tvar centroid = new THREE.Vector3();\r\n\r\n\tfor ( var i = 0, l = faces.length; i < l; i ++ ) {\r\n\r\n\t\tsubdivide( faces[ i ], detail );\r\n\r\n\t}\r\n\r\n\r\n\t// Handle case when face straddles the seam\r\n\r\n\tfor ( var i = 0, l = this.faceVertexUvs[ 0 ].length; i < l; i ++ ) {\r\n\r\n\t\tvar uvs = this.faceVertexUvs[ 0 ][ i ];\r\n\r\n\t\tvar x0 = uvs[ 0 ].x;\r\n\t\tvar x1 = uvs[ 1 ].x;\r\n\t\tvar x2 = uvs[ 2 ].x;\r\n\r\n\t\tvar max = Math.max( x0, Math.max( x1, x2 ) );\r\n\t\tvar min = Math.min( x0, Math.min( x1, x2 ) );\r\n\r\n\t\tif ( max > 0.9 && min < 0.1 ) { // 0.9 is somewhat arbitrary\r\n\r\n\t\t\tif ( x0 < 0.2 ) uvs[ 0 ].x += 1;\r\n\t\t\tif ( x1 < 0.2 ) uvs[ 1 ].x += 1;\r\n\t\t\tif ( x2 < 0.2 ) uvs[ 2 ].x += 1;\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\r\n\t// Apply radius\r\n\r\n\tfor ( var i = 0, l = this.vertices.length; i < l; i ++ ) {\r\n\r\n\t\tthis.vertices[ i ].multiplyScalar( radius );\r\n\r\n\t}\r\n\r\n\r\n\t// Merge vertices\r\n\r\n\tthis.mergeVertices();\r\n\r\n\tthis.computeFaceNormals();\r\n\r\n\tthis.boundingSphere = new THREE.Sphere( new THREE.Vector3(), radius );\r\n\r\n\r\n\t// Project vector onto sphere's surface\r\n\r\n\tfunction prepare( vector ) {\r\n\r\n\t\tvar vertex = vector.normalize().clone();\r\n\t\tvertex.index = that.vertices.push( vertex ) - 1;\r\n\r\n\t\t// Texture coords are equivalent to map coords, calculate angle and convert to fraction of a circle.\r\n\r\n\t\tvar u = azimuth( vector ) / 2 / Math.PI + 0.5;\r\n\t\tvar v = inclination( vector ) / Math.PI + 0.5;\r\n\t\tvertex.uv = new THREE.Vector2( u, 1 - v );\r\n\r\n\t\treturn vertex;\r\n\r\n\t}\r\n\r\n\r\n\t// Approximate a curved face with recursively sub-divided triangles.\r\n\r\n\tfunction make( v1, v2, v3 ) {\r\n\r\n\t\tvar face = new THREE.Face3( v1.index, v2.index, v3.index, [ v1.clone(), v2.clone(), v3.clone() ] );\r\n\t\tthat.faces.push( face );\r\n\r\n\t\tcentroid.copy( v1 ).add( v2 ).add( v3 ).divideScalar( 3 );\r\n\r\n\t\tvar azi = azimuth( centroid );\r\n\r\n\t\tthat.faceVertexUvs[ 0 ].push( [\r\n\t\t\tcorrectUV( v1.uv, v1, azi ),\r\n\t\t\tcorrectUV( v2.uv, v2, azi ),\r\n\t\t\tcorrectUV( v3.uv, v3, azi )\r\n\t\t] );\r\n\r\n\t}\r\n\r\n\r\n\t// Analytically subdivide a face to the required detail level.\r\n\r\n\tfunction subdivide( face, detail ) {\r\n\r\n\t\tvar cols = Math.pow(2, detail);\r\n\t\tvar a = prepare( that.vertices[ face.a ] );\r\n\t\tvar b = prepare( that.vertices[ face.b ] );\r\n\t\tvar c = prepare( that.vertices[ face.c ] );\r\n\t\tvar v = [];\r\n\r\n\t\t// Construct all of the vertices for this subdivision.\r\n\r\n\t\tfor ( var i = 0 ; i <= cols; i ++ ) {\r\n\r\n\t\t\tv[ i ] = [];\r\n\r\n\t\t\tvar aj = prepare( a.clone().lerp( c, i / cols ) );\r\n\t\t\tvar bj = prepare( b.clone().lerp( c, i / cols ) );\r\n\t\t\tvar rows = cols - i;\r\n\r\n\t\t\tfor ( var j = 0; j <= rows; j ++) {\r\n\r\n\t\t\t\tif ( j == 0 && i == cols ) {\r\n\r\n\t\t\t\t\tv[ i ][ j ] = aj;\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\tv[ i ][ j ] = prepare( aj.clone().lerp( bj, j / rows ) );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\t// Construct all of the faces.\r\n\r\n\t\tfor ( var i = 0; i < cols ; i ++ ) {\r\n\r\n\t\t\tfor ( var j = 0; j < 2 * (cols - i) - 1; j ++ ) {\r\n\r\n\t\t\t\tvar k = Math.floor( j / 2 );\r\n\r\n\t\t\t\tif ( j % 2 == 0 ) {\r\n\r\n\t\t\t\t\tmake(\r\n\t\t\t\t\t\tv[ i ][ k + 1],\r\n\t\t\t\t\t\tv[ i + 1 ][ k ],\r\n\t\t\t\t\t\tv[ i ][ k ]\r\n\t\t\t\t\t);\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\tmake(\r\n\t\t\t\t\t\tv[ i ][ k + 1 ],\r\n\t\t\t\t\t\tv[ i + 1][ k + 1],\r\n\t\t\t\t\t\tv[ i + 1 ][ k ]\r\n\t\t\t\t\t);\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\r\n\t// Angle around the Y axis, counter-clockwise when looking from above.\r\n\r\n\tfunction azimuth( vector ) {\r\n\r\n\t\treturn Math.atan2( vector.z, - vector.x );\r\n\r\n\t}\r\n\r\n\r\n\t// Angle above the XZ plane.\r\n\r\n\tfunction inclination( vector ) {\r\n\r\n\t\treturn Math.atan2( - vector.y, Math.sqrt( ( vector.x * vector.x ) + ( vector.z * vector.z ) ) );\r\n\r\n\t}\r\n\r\n\r\n\t// Texture fixing helper. Spheres have some odd behaviours.\r\n\r\n\tfunction correctUV( uv, vector, azimuth ) {\r\n\r\n\t\tif ( ( azimuth < 0 ) && ( uv.x === 1 ) ) uv = new THREE.Vector2( uv.x - 1, uv.y );\r\n\t\tif ( ( vector.x === 0 ) && ( vector.z === 0 ) ) uv = new THREE.Vector2( azimuth / 2 / Math.PI + 0.5, uv.y );\r\n\t\treturn uv.clone();\r\n\r\n\t}\r\n\r\n\r\n};\r\n\r\nTHREE.PolyhedronGeometry.prototype = Object.create( THREE.Geometry.prototype );\r\nTHREE.PolyhedronGeometry.prototype.constructor = THREE.PolyhedronGeometry;\r\n\r\n// File:src/extras/geometries/DodecahedronGeometry.js\r\n\r\n/**\r\n * @author Abe Pazos / https://hamoid.com\r\n */\r\n\r\nTHREE.DodecahedronGeometry = function ( radius, detail ) {\r\n\r\n\tthis.parameters = {\r\n\t\tradius: radius,\r\n\t\tdetail: detail\r\n\t};\r\n\r\n\tvar t = ( 1 + Math.sqrt( 5 ) ) / 2;\r\n\tvar r = 1 / t;\r\n\r\n\tvar vertices = [\r\n\r\n\t\t// (±1, ±1, ±1)\r\n\t\t-1, -1, -1,    -1, -1,  1,\r\n\t\t-1,  1, -1,    -1,  1,  1,\r\n\t\t 1, -1, -1,     1, -1,  1,\r\n\t\t 1,  1, -1,     1,  1,  1,\r\n\r\n\t\t// (0, ±1/φ, ±φ)\r\n\t\t 0, -r, -t,     0, -r,  t,\r\n\t\t 0,  r, -t,     0,  r,  t,\r\n\r\n\t\t// (±1/φ, ±φ, 0)\r\n\t\t-r, -t,  0,    -r,  t,  0,\r\n\t\t r, -t,  0,     r,  t,  0,\r\n\r\n\t\t// (±φ, 0, ±1/φ)\r\n\t\t-t,  0, -r,     t,  0, -r,\r\n\t\t-t,  0,  r,     t,  0,  r\r\n\t];\r\n\r\n\tvar indices = [\r\n\t\t 3, 11,  7,      3,  7, 15,      3, 15, 13,\r\n\t\t 7, 19, 17,      7, 17,  6,      7,  6, 15,\r\n\t\t17,  4,  8,     17,  8, 10,     17, 10,  6,\r\n\t\t 8,  0, 16,      8, 16,  2,      8,  2, 10,\r\n\t\t 0, 12,  1,      0,  1, 18,      0, 18, 16,\r\n\t\t 6, 10,  2,      6,  2, 13,      6, 13, 15,\r\n\t\t 2, 16, 18,      2, 18,  3,      2,  3, 13,\r\n\t\t18,  1,  9,     18,  9, 11,     18, 11,  3,\r\n\t\t 4, 14, 12,      4, 12,  0,      4,  0,  8,\r\n\t\t11,  9,  5,     11,  5, 19,     11, 19,  7,\r\n\t\t19,  5, 14,     19, 14,  4,     19,  4, 17,\r\n\t\t 1, 12, 14,      1, 14,  5,      1,  5,  9\r\n\t];\r\n\r\n\tTHREE.PolyhedronGeometry.call( this, vertices, indices, radius, detail );\r\n\r\n};\r\n\r\nTHREE.DodecahedronGeometry.prototype = Object.create( THREE.Geometry.prototype );\r\nTHREE.DodecahedronGeometry.prototype.constructor = THREE.DodecahedronGeometry;\r\n\r\n// File:src/extras/geometries/IcosahedronGeometry.js\r\n\r\n/**\r\n * @author timothypratley / https://github.com/timothypratley\r\n */\r\n\r\nTHREE.IcosahedronGeometry = function ( radius, detail ) {\r\n\r\n\tvar t = ( 1 + Math.sqrt( 5 ) ) / 2;\r\n\r\n\tvar vertices = [\r\n\t\t- 1,  t,  0,    1,  t,  0,   - 1, - t,  0,    1, - t,  0,\r\n\t\t 0, - 1,  t,    0,  1,  t,    0, - 1, - t,    0,  1, - t,\r\n\t\t t,  0, - 1,    t,  0,  1,   - t,  0, - 1,   - t,  0,  1\r\n\t];\r\n\r\n\tvar indices = [\r\n\t\t 0, 11,  5,    0,  5,  1,    0,  1,  7,    0,  7, 10,    0, 10, 11,\r\n\t\t 1,  5,  9,    5, 11,  4,   11, 10,  2,   10,  7,  6,    7,  1,  8,\r\n\t\t 3,  9,  4,    3,  4,  2,    3,  2,  6,    3,  6,  8,    3,  8,  9,\r\n\t\t 4,  9,  5,    2,  4, 11,    6,  2, 10,    8,  6,  7,    9,  8,  1\r\n\t];\r\n\r\n\tTHREE.PolyhedronGeometry.call( this, vertices, indices, radius, detail );\r\n\r\n\tthis.type = 'IcosahedronGeometry';\r\n\r\n\tthis.parameters = {\r\n\t\tradius: radius,\r\n\t\tdetail: detail\r\n\t};\r\n};\r\n\r\nTHREE.IcosahedronGeometry.prototype = Object.create( THREE.Geometry.prototype );\r\nTHREE.IcosahedronGeometry.prototype.constructor = THREE.IcosahedronGeometry;\r\n\r\n// File:src/extras/geometries/OctahedronGeometry.js\r\n\r\n/**\r\n * @author timothypratley / https://github.com/timothypratley\r\n */\r\n\r\nTHREE.OctahedronGeometry = function ( radius, detail ) {\r\n\r\n\tthis.parameters = {\r\n\t\tradius: radius,\r\n\t\tdetail: detail\r\n\t};\r\n\r\n\tvar vertices = [\r\n\t\t1, 0, 0,   - 1, 0, 0,    0, 1, 0,    0,- 1, 0,    0, 0, 1,    0, 0,- 1\r\n\t];\r\n\r\n\tvar indices = [\r\n\t\t0, 2, 4,    0, 4, 3,    0, 3, 5,    0, 5, 2,    1, 2, 5,    1, 5, 3,    1, 3, 4,    1, 4, 2\r\n\t];\r\n\r\n\tTHREE.PolyhedronGeometry.call( this, vertices, indices, radius, detail );\r\n\r\n\tthis.type = 'OctahedronGeometry';\r\n\r\n\tthis.parameters = {\r\n\t\tradius: radius,\r\n\t\tdetail: detail\r\n\t};\r\n};\r\n\r\nTHREE.OctahedronGeometry.prototype = Object.create( THREE.Geometry.prototype );\r\nTHREE.OctahedronGeometry.prototype.constructor = THREE.OctahedronGeometry;\r\n\r\n// File:src/extras/geometries/TetrahedronGeometry.js\r\n\r\n/**\r\n * @author timothypratley / https://github.com/timothypratley\r\n */\r\n\r\nTHREE.TetrahedronGeometry = function ( radius, detail ) {\r\n\r\n\tvar vertices = [\r\n\t\t 1,  1,  1,   - 1, - 1,  1,   - 1,  1, - 1,    1, - 1, - 1\r\n\t];\r\n\r\n\tvar indices = [\r\n\t\t 2,  1,  0,    0,  3,  2,    1,  3,  0,    2,  3,  1\r\n\t];\r\n\r\n\tTHREE.PolyhedronGeometry.call( this, vertices, indices, radius, detail );\r\n\r\n\tthis.type = 'TetrahedronGeometry';\r\n\r\n\tthis.parameters = {\r\n\t\tradius: radius,\r\n\t\tdetail: detail\r\n\t};\r\n\r\n};\r\n\r\nTHREE.TetrahedronGeometry.prototype = Object.create( THREE.Geometry.prototype );\r\nTHREE.TetrahedronGeometry.prototype.constructor = THREE.TetrahedronGeometry;\r\n\r\n// File:src/extras/geometries/ParametricGeometry.js\r\n\r\n/**\r\n * @author zz85 / https://github.com/zz85\r\n * Parametric Surfaces Geometry\r\n * based on the brilliant article by @prideout http://prideout.net/blog/?p=44\r\n *\r\n * new THREE.ParametricGeometry( parametricFunction, uSegments, ySegements );\r\n *\r\n */\r\n\r\nTHREE.ParametricGeometry = function ( func, slices, stacks ) {\r\n\r\n\tTHREE.Geometry.call( this );\r\n\r\n\tthis.type = 'ParametricGeometry';\r\n\r\n\tthis.parameters = {\r\n\t\tfunc: func,\r\n\t\tslices: slices,\r\n\t\tstacks: stacks\r\n\t};\r\n\r\n\tvar verts = this.vertices;\r\n\tvar faces = this.faces;\r\n\tvar uvs = this.faceVertexUvs[ 0 ];\r\n\r\n\tvar i, j, p;\r\n\tvar u, v;\r\n\r\n\tvar sliceCount = slices + 1;\r\n\r\n\tfor ( i = 0; i <= stacks; i ++ ) {\r\n\r\n\t\tv = i / stacks;\r\n\r\n\t\tfor ( j = 0; j <= slices; j ++ ) {\r\n\r\n\t\t\tu = j / slices;\r\n\r\n\t\t\tp = func( u, v );\r\n\t\t\tverts.push( p );\r\n\r\n\t\t}\r\n\t}\r\n\r\n\tvar a, b, c, d;\r\n\tvar uva, uvb, uvc, uvd;\r\n\r\n\tfor ( i = 0; i < stacks; i ++ ) {\r\n\r\n\t\tfor ( j = 0; j < slices; j ++ ) {\r\n\r\n\t\t\ta = i * sliceCount + j;\r\n\t\t\tb = i * sliceCount + j + 1;\r\n\t\t\tc = (i + 1) * sliceCount + j + 1;\r\n\t\t\td = (i + 1) * sliceCount + j;\r\n\r\n\t\t\tuva = new THREE.Vector2( j / slices, i / stacks );\r\n\t\t\tuvb = new THREE.Vector2( ( j + 1 ) / slices, i / stacks );\r\n\t\t\tuvc = new THREE.Vector2( ( j + 1 ) / slices, ( i + 1 ) / stacks );\r\n\t\t\tuvd = new THREE.Vector2( j / slices, ( i + 1 ) / stacks );\r\n\r\n\t\t\tfaces.push( new THREE.Face3( a, b, d ) );\r\n\t\t\tuvs.push( [ uva, uvb, uvd ] );\r\n\r\n\t\t\tfaces.push( new THREE.Face3( b, c, d ) );\r\n\t\t\tuvs.push( [ uvb.clone(), uvc, uvd.clone() ] );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\t// console.log(this);\r\n\r\n\t// magic bullet\r\n\t// var diff = this.mergeVertices();\r\n\t// console.log('removed ', diff, ' vertices by merging');\r\n\r\n\tthis.computeFaceNormals();\r\n\tthis.computeVertexNormals();\r\n\r\n};\r\n\r\nTHREE.ParametricGeometry.prototype = Object.create( THREE.Geometry.prototype );\r\nTHREE.ParametricGeometry.prototype.constructor = THREE.ParametricGeometry;\r\n\r\n// File:src/extras/helpers/AxisHelper.js\r\n\r\n/**\r\n * @author sroucheray / http://sroucheray.org/\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.AxisHelper = function ( size ) {\r\n\r\n\tsize = size || 1;\r\n\r\n\tvar vertices = new Float32Array( [\r\n\t\t0, 0, 0,  size, 0, 0,\r\n\t\t0, 0, 0,  0, size, 0,\r\n\t\t0, 0, 0,  0, 0, size\r\n\t] );\r\n\r\n\tvar colors = new Float32Array( [\r\n\t\t1, 0, 0,  1, 0.6, 0,\r\n\t\t0, 1, 0,  0.6, 1, 0,\r\n\t\t0, 0, 1,  0, 0.6, 1\r\n\t] );\r\n\r\n\tvar geometry = new THREE.BufferGeometry();\r\n\tgeometry.addAttribute( 'position', new THREE.BufferAttribute( vertices, 3 ) );\r\n\tgeometry.addAttribute( 'color', new THREE.BufferAttribute( colors, 3 ) );\r\n\r\n\tvar material = new THREE.LineBasicMaterial( { vertexColors: THREE.VertexColors } );\r\n\r\n\tTHREE.Line.call( this, geometry, material, THREE.LinePieces );\r\n\r\n};\r\n\r\nTHREE.AxisHelper.prototype = Object.create( THREE.Line.prototype );\r\nTHREE.AxisHelper.prototype.constructor = THREE.AxisHelper;\r\n\r\n// File:src/extras/helpers/ArrowHelper.js\r\n\r\n/**\r\n * @author WestLangley / http://github.com/WestLangley\r\n * @author zz85 / http://github.com/zz85\r\n * @author bhouston / http://exocortex.com\r\n *\r\n * Creates an arrow for visualizing directions\r\n *\r\n * Parameters:\r\n *  dir - Vector3\r\n *  origin - Vector3\r\n *  length - Number\r\n *  color - color in hex value\r\n *  headLength - Number\r\n *  headWidth - Number\r\n */\r\n\r\nTHREE.ArrowHelper = ( function () {\r\n\r\n\tvar lineGeometry = new THREE.Geometry();\r\n\tlineGeometry.vertices.push( new THREE.Vector3( 0, 0, 0 ), new THREE.Vector3( 0, 1, 0 ) );\r\n\r\n\tvar coneGeometry = new THREE.CylinderGeometry( 0, 0.5, 1, 5, 1 );\r\n\tconeGeometry.applyMatrix( new THREE.Matrix4().makeTranslation( 0, - 0.5, 0 ) );\r\n\r\n\treturn function ( dir, origin, length, color, headLength, headWidth ) {\r\n\r\n\t\t// dir is assumed to be normalized\r\n\r\n\t\tTHREE.Object3D.call( this );\r\n\r\n\t\tif ( color === undefined ) color = 0xffff00;\r\n\t\tif ( length === undefined ) length = 1;\r\n\t\tif ( headLength === undefined ) headLength = 0.2 * length;\r\n\t\tif ( headWidth === undefined ) headWidth = 0.2 * headLength;\r\n\r\n\t\tthis.position.copy( origin );\r\n\r\n\t\tthis.line = new THREE.Line( lineGeometry, new THREE.LineBasicMaterial( { color: color } ) );\r\n\t\tthis.line.matrixAutoUpdate = false;\r\n\t\tthis.add( this.line );\r\n\r\n\t\tthis.cone = new THREE.Mesh( coneGeometry, new THREE.MeshBasicMaterial( { color: color } ) );\r\n\t\tthis.cone.matrixAutoUpdate = false;\r\n\t\tthis.add( this.cone );\r\n\r\n\t\tthis.setDirection( dir );\r\n\t\tthis.setLength( length, headLength, headWidth );\r\n\r\n\t}\r\n\r\n}() );\r\n\r\nTHREE.ArrowHelper.prototype = Object.create( THREE.Object3D.prototype );\r\nTHREE.ArrowHelper.prototype.constructor = THREE.ArrowHelper;\r\n\r\nTHREE.ArrowHelper.prototype.setDirection = ( function () {\r\n\r\n\tvar axis = new THREE.Vector3();\r\n\tvar radians;\r\n\r\n\treturn function ( dir ) {\r\n\r\n\t\t// dir is assumed to be normalized\r\n\r\n\t\tif ( dir.y > 0.99999 ) {\r\n\r\n\t\t\tthis.quaternion.set( 0, 0, 0, 1 );\r\n\r\n\t\t} else if ( dir.y < - 0.99999 ) {\r\n\r\n\t\t\tthis.quaternion.set( 1, 0, 0, 0 );\r\n\r\n\t\t} else {\r\n\r\n\t\t\taxis.set( dir.z, 0, - dir.x ).normalize();\r\n\r\n\t\t\tradians = Math.acos( dir.y );\r\n\r\n\t\t\tthis.quaternion.setFromAxisAngle( axis, radians );\r\n\r\n\t\t}\r\n\r\n\t};\r\n\r\n}() );\r\n\r\nTHREE.ArrowHelper.prototype.setLength = function ( length, headLength, headWidth ) {\r\n\r\n\tif ( headLength === undefined ) headLength = 0.2 * length;\r\n\tif ( headWidth === undefined ) headWidth = 0.2 * headLength;\r\n\r\n\tthis.line.scale.set( 1, length - headLength, 1 );\r\n\tthis.line.updateMatrix();\r\n\r\n\tthis.cone.scale.set( headWidth, headLength, headWidth );\r\n\tthis.cone.position.y = length;\r\n\tthis.cone.updateMatrix();\r\n\r\n};\r\n\r\nTHREE.ArrowHelper.prototype.setColor = function ( color ) {\r\n\r\n\tthis.line.material.color.set( color );\r\n\tthis.cone.material.color.set( color );\r\n\r\n};\r\n\r\n// File:src/extras/helpers/BoxHelper.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.BoxHelper = function ( object ) {\r\n\r\n\tvar geometry = new THREE.BufferGeometry();\r\n\tgeometry.addAttribute( 'position', new THREE.BufferAttribute( new Float32Array( 72 ), 3 ) );\r\n\r\n\tTHREE.Line.call( this, geometry, new THREE.LineBasicMaterial( { color: 0xffff00 } ), THREE.LinePieces );\r\n\r\n\tif ( object !== undefined ) {\r\n\r\n\t\tthis.update( object );\r\n\r\n\t}\r\n\r\n};\r\n\r\nTHREE.BoxHelper.prototype = Object.create( THREE.Line.prototype );\r\nTHREE.BoxHelper.prototype.constructor = THREE.BoxHelper;\r\n\r\nTHREE.BoxHelper.prototype.update = function ( object ) {\r\n\r\n\tvar geometry = object.geometry;\r\n\r\n\tif ( geometry.boundingBox === null ) {\r\n\r\n\t\tgeometry.computeBoundingBox();\r\n\r\n\t}\r\n\r\n\tvar min = geometry.boundingBox.min;\r\n\tvar max = geometry.boundingBox.max;\r\n\r\n\t/*\r\n\t  5____4\r\n\t1/___0/|\r\n\t| 6__|_7\r\n\t2/___3/\r\n\r\n\t0: max.x, max.y, max.z\r\n\t1: min.x, max.y, max.z\r\n\t2: min.x, min.y, max.z\r\n\t3: max.x, min.y, max.z\r\n\t4: max.x, max.y, min.z\r\n\t5: min.x, max.y, min.z\r\n\t6: min.x, min.y, min.z\r\n\t7: max.x, min.y, min.z\r\n\t*/\r\n\r\n\tvar vertices = this.geometry.attributes.position.array;\r\n\r\n\tvertices[  0 ] = max.x; vertices[  1 ] = max.y; vertices[  2 ] = max.z;\r\n\tvertices[  3 ] = min.x; vertices[  4 ] = max.y; vertices[  5 ] = max.z;\r\n\r\n\tvertices[  6 ] = min.x; vertices[  7 ] = max.y; vertices[  8 ] = max.z;\r\n\tvertices[  9 ] = min.x; vertices[ 10 ] = min.y; vertices[ 11 ] = max.z;\r\n\r\n\tvertices[ 12 ] = min.x; vertices[ 13 ] = min.y; vertices[ 14 ] = max.z;\r\n\tvertices[ 15 ] = max.x; vertices[ 16 ] = min.y; vertices[ 17 ] = max.z;\r\n\r\n\tvertices[ 18 ] = max.x; vertices[ 19 ] = min.y; vertices[ 20 ] = max.z;\r\n\tvertices[ 21 ] = max.x; vertices[ 22 ] = max.y; vertices[ 23 ] = max.z;\r\n\r\n\t//\r\n\r\n\tvertices[ 24 ] = max.x; vertices[ 25 ] = max.y; vertices[ 26 ] = min.z;\r\n\tvertices[ 27 ] = min.x; vertices[ 28 ] = max.y; vertices[ 29 ] = min.z;\r\n\r\n\tvertices[ 30 ] = min.x; vertices[ 31 ] = max.y; vertices[ 32 ] = min.z;\r\n\tvertices[ 33 ] = min.x; vertices[ 34 ] = min.y; vertices[ 35 ] = min.z;\r\n\r\n\tvertices[ 36 ] = min.x; vertices[ 37 ] = min.y; vertices[ 38 ] = min.z;\r\n\tvertices[ 39 ] = max.x; vertices[ 40 ] = min.y; vertices[ 41 ] = min.z;\r\n\r\n\tvertices[ 42 ] = max.x; vertices[ 43 ] = min.y; vertices[ 44 ] = min.z;\r\n\tvertices[ 45 ] = max.x; vertices[ 46 ] = max.y; vertices[ 47 ] = min.z;\r\n\r\n\t//\r\n\r\n\tvertices[ 48 ] = max.x; vertices[ 49 ] = max.y; vertices[ 50 ] = max.z;\r\n\tvertices[ 51 ] = max.x; vertices[ 52 ] = max.y; vertices[ 53 ] = min.z;\r\n\r\n\tvertices[ 54 ] = min.x; vertices[ 55 ] = max.y; vertices[ 56 ] = max.z;\r\n\tvertices[ 57 ] = min.x; vertices[ 58 ] = max.y; vertices[ 59 ] = min.z;\r\n\r\n\tvertices[ 60 ] = min.x; vertices[ 61 ] = min.y; vertices[ 62 ] = max.z;\r\n\tvertices[ 63 ] = min.x; vertices[ 64 ] = min.y; vertices[ 65 ] = min.z;\r\n\r\n\tvertices[ 66 ] = max.x; vertices[ 67 ] = min.y; vertices[ 68 ] = max.z;\r\n\tvertices[ 69 ] = max.x; vertices[ 70 ] = min.y; vertices[ 71 ] = min.z;\r\n\r\n\tthis.geometry.attributes.position.needsUpdate = true;\r\n\r\n\tthis.geometry.computeBoundingSphere();\r\n\r\n\tthis.matrix = object.matrixWorld;\r\n\tthis.matrixAutoUpdate = false;\r\n\r\n};\r\n\r\n// File:src/extras/helpers/BoundingBoxHelper.js\r\n\r\n/**\r\n * @author WestLangley / http://github.com/WestLangley\r\n */\r\n\r\n// a helper to show the world-axis-aligned bounding box for an object\r\n\r\nTHREE.BoundingBoxHelper = function ( object, hex ) {\r\n\r\n\tvar color = ( hex !== undefined ) ? hex : 0x888888;\r\n\r\n\tthis.object = object;\r\n\r\n\tthis.box = new THREE.Box3();\r\n\r\n\tTHREE.Mesh.call( this, new THREE.BoxGeometry( 1, 1, 1 ), new THREE.MeshBasicMaterial( { color: color, wireframe: true } ) );\r\n\r\n};\r\n\r\nTHREE.BoundingBoxHelper.prototype = Object.create( THREE.Mesh.prototype );\r\nTHREE.BoundingBoxHelper.prototype.constructor = THREE.BoundingBoxHelper;\r\n\r\nTHREE.BoundingBoxHelper.prototype.update = function () {\r\n\r\n\tthis.box.setFromObject( this.object );\r\n\r\n\tthis.box.size( this.scale );\r\n\r\n\tthis.box.center( this.position );\r\n\r\n};\r\n\r\n// File:src/extras/helpers/CameraHelper.js\r\n\r\n/**\r\n * @author alteredq / http://alteredqualia.com/\r\n *\r\n *\t- shows frustum, line of sight and up of the camera\r\n *\t- suitable for fast updates\r\n * \t- based on frustum visualization in lightgl.js shadowmap example\r\n *\t\thttp://evanw.github.com/lightgl.js/tests/shadowmap.html\r\n */\r\n\r\nTHREE.CameraHelper = function ( camera ) {\r\n\r\n\tvar geometry = new THREE.Geometry();\r\n\tvar material = new THREE.LineBasicMaterial( { color: 0xffffff, vertexColors: THREE.FaceColors } );\r\n\r\n\tvar pointMap = {};\r\n\r\n\t// colors\r\n\r\n\tvar hexFrustum = 0xffaa00;\r\n\tvar hexCone = 0xff0000;\r\n\tvar hexUp = 0x00aaff;\r\n\tvar hexTarget = 0xffffff;\r\n\tvar hexCross = 0x333333;\r\n\r\n\t// near\r\n\r\n\taddLine( \"n1\", \"n2\", hexFrustum );\r\n\taddLine( \"n2\", \"n4\", hexFrustum );\r\n\taddLine( \"n4\", \"n3\", hexFrustum );\r\n\taddLine( \"n3\", \"n1\", hexFrustum );\r\n\r\n\t// far\r\n\r\n\taddLine( \"f1\", \"f2\", hexFrustum );\r\n\taddLine( \"f2\", \"f4\", hexFrustum );\r\n\taddLine( \"f4\", \"f3\", hexFrustum );\r\n\taddLine( \"f3\", \"f1\", hexFrustum );\r\n\r\n\t// sides\r\n\r\n\taddLine( \"n1\", \"f1\", hexFrustum );\r\n\taddLine( \"n2\", \"f2\", hexFrustum );\r\n\taddLine( \"n3\", \"f3\", hexFrustum );\r\n\taddLine( \"n4\", \"f4\", hexFrustum );\r\n\r\n\t// cone\r\n\r\n\taddLine( \"p\", \"n1\", hexCone );\r\n\taddLine( \"p\", \"n2\", hexCone );\r\n\taddLine( \"p\", \"n3\", hexCone );\r\n\taddLine( \"p\", \"n4\", hexCone );\r\n\r\n\t// up\r\n\r\n\taddLine( \"u1\", \"u2\", hexUp );\r\n\taddLine( \"u2\", \"u3\", hexUp );\r\n\taddLine( \"u3\", \"u1\", hexUp );\r\n\r\n\t// target\r\n\r\n\taddLine( \"c\", \"t\", hexTarget );\r\n\taddLine( \"p\", \"c\", hexCross );\r\n\r\n\t// cross\r\n\r\n\taddLine( \"cn1\", \"cn2\", hexCross );\r\n\taddLine( \"cn3\", \"cn4\", hexCross );\r\n\r\n\taddLine( \"cf1\", \"cf2\", hexCross );\r\n\taddLine( \"cf3\", \"cf4\", hexCross );\r\n\r\n\tfunction addLine( a, b, hex ) {\r\n\r\n\t\taddPoint( a, hex );\r\n\t\taddPoint( b, hex );\r\n\r\n\t}\r\n\r\n\tfunction addPoint( id, hex ) {\r\n\r\n\t\tgeometry.vertices.push( new THREE.Vector3() );\r\n\t\tgeometry.colors.push( new THREE.Color( hex ) );\r\n\r\n\t\tif ( pointMap[ id ] === undefined ) {\r\n\r\n\t\t\tpointMap[ id ] = [];\r\n\r\n\t\t}\r\n\r\n\t\tpointMap[ id ].push( geometry.vertices.length - 1 );\r\n\r\n\t}\r\n\r\n\tTHREE.Line.call( this, geometry, material, THREE.LinePieces );\r\n\r\n\tthis.camera = camera;\r\n\tthis.matrix = camera.matrixWorld;\r\n\tthis.matrixAutoUpdate = false;\r\n\r\n\tthis.pointMap = pointMap;\r\n\r\n\tthis.update();\r\n\r\n};\r\n\r\nTHREE.CameraHelper.prototype = Object.create( THREE.Line.prototype );\r\nTHREE.CameraHelper.prototype.constructor = THREE.CameraHelper;\r\n\r\nTHREE.CameraHelper.prototype.update = function () {\r\n\r\n\tvar geometry, pointMap;\r\n\t\r\n\tvar vector = new THREE.Vector3();\r\n\tvar camera = new THREE.Camera();\r\n\r\n\tvar setPoint = function ( point, x, y, z ) {\r\n\r\n\t\tvector.set( x, y, z ).unproject( camera );\r\n\r\n\t\tvar points = pointMap[ point ];\r\n\r\n\t\tif ( points !== undefined ) {\r\n\r\n\t\t\tfor ( var i = 0, il = points.length; i < il; i ++ ) {\r\n\r\n\t\t\t\tgeometry.vertices[ points[ i ] ].copy( vector );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t};\r\n\r\n\treturn function () {\r\n\r\n\t\tgeometry = this.geometry;\r\n\t\tpointMap = this.pointMap;\r\n\r\n\t\tvar w = 1, h = 1;\r\n\r\n\t\t// we need just camera projection matrix\r\n\t\t// world matrix must be identity\r\n\r\n\t\tcamera.projectionMatrix.copy( this.camera.projectionMatrix );\r\n\r\n\t\t// center / target\r\n\r\n\t\tsetPoint( \"c\", 0, 0, - 1 );\r\n\t\tsetPoint( \"t\", 0, 0,  1 );\r\n\r\n\t\t// near\r\n\r\n\t\tsetPoint( \"n1\", - w, - h, - 1 );\r\n\t\tsetPoint( \"n2\",   w, - h, - 1 );\r\n\t\tsetPoint( \"n3\", - w,   h, - 1 );\r\n\t\tsetPoint( \"n4\",   w,   h, - 1 );\r\n\r\n\t\t// far\r\n\r\n\t\tsetPoint( \"f1\", - w, - h, 1 );\r\n\t\tsetPoint( \"f2\",   w, - h, 1 );\r\n\t\tsetPoint( \"f3\", - w,   h, 1 );\r\n\t\tsetPoint( \"f4\",   w,   h, 1 );\r\n\r\n\t\t// up\r\n\r\n\t\tsetPoint( \"u1\",   w * 0.7, h * 1.1, - 1 );\r\n\t\tsetPoint( \"u2\", - w * 0.7, h * 1.1, - 1 );\r\n\t\tsetPoint( \"u3\",         0, h * 2,   - 1 );\r\n\r\n\t\t// cross\r\n\r\n\t\tsetPoint( \"cf1\", - w,   0, 1 );\r\n\t\tsetPoint( \"cf2\",   w,   0, 1 );\r\n\t\tsetPoint( \"cf3\",   0, - h, 1 );\r\n\t\tsetPoint( \"cf4\",   0,   h, 1 );\r\n\r\n\t\tsetPoint( \"cn1\", - w,   0, - 1 );\r\n\t\tsetPoint( \"cn2\",   w,   0, - 1 );\r\n\t\tsetPoint( \"cn3\",   0, - h, - 1 );\r\n\t\tsetPoint( \"cn4\",   0,   h, - 1 );\r\n\r\n\t\tgeometry.verticesNeedUpdate = true;\r\n\r\n\t};\r\n\r\n}();\r\n\r\n// File:src/extras/helpers/DirectionalLightHelper.js\r\n\r\n/**\r\n * @author alteredq / http://alteredqualia.com/\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author WestLangley / http://github.com/WestLangley\r\n */\r\n\r\nTHREE.DirectionalLightHelper = function ( light, size ) {\r\n\r\n\tTHREE.Object3D.call( this );\r\n\r\n\tthis.light = light;\r\n\tthis.light.updateMatrixWorld();\r\n\r\n\tthis.matrix = light.matrixWorld;\r\n\tthis.matrixAutoUpdate = false;\r\n\r\n\tsize = size || 1;\r\n\r\n\tvar geometry = new THREE.Geometry();\r\n\tgeometry.vertices.push(\r\n\t\tnew THREE.Vector3( - size,   size, 0 ),\r\n\t\tnew THREE.Vector3(   size,   size, 0 ),\r\n\t\tnew THREE.Vector3(   size, - size, 0 ),\r\n\t\tnew THREE.Vector3( - size, - size, 0 ),\r\n\t\tnew THREE.Vector3( - size,   size, 0 )\r\n\t);\r\n\r\n\tvar material = new THREE.LineBasicMaterial( { fog: false } );\r\n\tmaterial.color.copy( this.light.color ).multiplyScalar( this.light.intensity );\r\n\r\n\tthis.lightPlane = new THREE.Line( geometry, material );\r\n\tthis.add( this.lightPlane );\r\n\r\n\tgeometry = new THREE.Geometry();\r\n\tgeometry.vertices.push(\r\n\t\tnew THREE.Vector3(),\r\n\t\tnew THREE.Vector3()\r\n\t);\r\n\r\n\tmaterial = new THREE.LineBasicMaterial( { fog: false } );\r\n\tmaterial.color.copy( this.light.color ).multiplyScalar( this.light.intensity );\r\n\r\n\tthis.targetLine = new THREE.Line( geometry, material );\r\n\tthis.add( this.targetLine );\r\n\r\n\tthis.update();\r\n\r\n};\r\n\r\nTHREE.DirectionalLightHelper.prototype = Object.create( THREE.Object3D.prototype );\r\nTHREE.DirectionalLightHelper.prototype.constructor = THREE.DirectionalLightHelper;\r\n\r\nTHREE.DirectionalLightHelper.prototype.dispose = function () {\r\n\r\n\tthis.lightPlane.geometry.dispose();\r\n\tthis.lightPlane.material.dispose();\r\n\tthis.targetLine.geometry.dispose();\r\n\tthis.targetLine.material.dispose();\r\n};\r\n\r\nTHREE.DirectionalLightHelper.prototype.update = function () {\r\n\r\n\tvar v1 = new THREE.Vector3();\r\n\tvar v2 = new THREE.Vector3();\r\n\tvar v3 = new THREE.Vector3();\r\n\r\n\treturn function () {\r\n\r\n\t\tv1.setFromMatrixPosition( this.light.matrixWorld );\r\n\t\tv2.setFromMatrixPosition( this.light.target.matrixWorld );\r\n\t\tv3.subVectors( v2, v1 );\r\n\r\n\t\tthis.lightPlane.lookAt( v3 );\r\n\t\tthis.lightPlane.material.color.copy( this.light.color ).multiplyScalar( this.light.intensity );\r\n\r\n\t\tthis.targetLine.geometry.vertices[ 1 ].copy( v3 );\r\n\t\tthis.targetLine.geometry.verticesNeedUpdate = true;\r\n\t\tthis.targetLine.material.color.copy( this.lightPlane.material.color );\r\n\r\n\t};\r\n\r\n}();\r\n\r\n// File:src/extras/helpers/EdgesHelper.js\r\n\r\n/**\r\n * @author WestLangley / http://github.com/WestLangley\r\n * @param object THREE.Mesh whose geometry will be used\r\n * @param hex line color\r\n * @param thresholdAngle the minimim angle (in degrees),\r\n * between the face normals of adjacent faces,\r\n * that is required to render an edge. A value of 10 means\r\n * an edge is only rendered if the angle is at least 10 degrees.\r\n */\r\n\r\nTHREE.EdgesHelper = function ( object, hex, thresholdAngle ) {\r\n\r\n\tvar color = ( hex !== undefined ) ? hex : 0xffffff;\r\n\tthresholdAngle = ( thresholdAngle !== undefined ) ? thresholdAngle : 1;\r\n\r\n\tvar thresholdDot = Math.cos( THREE.Math.degToRad( thresholdAngle ) );\r\n\r\n\tvar edge = [ 0, 0 ], hash = {};\r\n\tvar sortFunction = function ( a, b ) { return a - b };\r\n\r\n\tvar keys = [ 'a', 'b', 'c' ];\r\n\tvar geometry = new THREE.BufferGeometry();\r\n\r\n\tvar geometry2;\r\n\r\n\tif ( object.geometry instanceof THREE.BufferGeometry ) {\r\n\r\n\t\tgeometry2 = new THREE.Geometry();\r\n\t\tgeometry2.fromBufferGeometry( object.geometry );\r\n\r\n\t} else {\r\n\r\n\t\tgeometry2 = object.geometry.clone();\r\n\r\n\t}\r\n\r\n\tgeometry2.mergeVertices();\r\n\tgeometry2.computeFaceNormals();\r\n\r\n\tvar vertices = geometry2.vertices;\r\n\tvar faces = geometry2.faces;\r\n\tvar numEdges = 0;\r\n\r\n\tfor ( var i = 0, l = faces.length; i < l; i ++ ) {\r\n\r\n\t\tvar face = faces[ i ];\r\n\r\n\t\tfor ( var j = 0; j < 3; j ++ ) {\r\n\r\n\t\t\tedge[ 0 ] = face[ keys[ j ] ];\r\n\t\t\tedge[ 1 ] = face[ keys[ ( j + 1 ) % 3 ] ];\r\n\t\t\tedge.sort( sortFunction );\r\n\r\n\t\t\tvar key = edge.toString();\r\n\r\n\t\t\tif ( hash[ key ] === undefined ) {\r\n\r\n\t\t\t\thash[ key ] = { vert1: edge[ 0 ], vert2: edge[ 1 ], face1: i, face2: undefined };\r\n\t\t\t\tnumEdges ++;\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\thash[ key ].face2 = i;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tvar coords = new Float32Array( numEdges * 2 * 3 );\r\n\r\n\tvar index = 0;\r\n\r\n\tfor ( var key in hash ) {\r\n\r\n\t\tvar h = hash[ key ];\r\n\r\n\t\tif ( h.face2 === undefined || faces[ h.face1 ].normal.dot( faces[ h.face2 ].normal ) <= thresholdDot ) {\r\n\r\n\t\t\tvar vertex = vertices[ h.vert1 ];\r\n\t\t\tcoords[ index ++ ] = vertex.x;\r\n\t\t\tcoords[ index ++ ] = vertex.y;\r\n\t\t\tcoords[ index ++ ] = vertex.z;\r\n\r\n\t\t\tvertex = vertices[ h.vert2 ];\r\n\t\t\tcoords[ index ++ ] = vertex.x;\r\n\t\t\tcoords[ index ++ ] = vertex.y;\r\n\t\t\tcoords[ index ++ ] = vertex.z;\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tgeometry.addAttribute( 'position', new THREE.BufferAttribute( coords, 3 ) );\r\n\r\n\tTHREE.Line.call( this, geometry, new THREE.LineBasicMaterial( { color: color } ), THREE.LinePieces );\r\n\r\n\tthis.matrix = object.matrixWorld;\r\n\tthis.matrixAutoUpdate = false;\r\n\r\n};\r\n\r\nTHREE.EdgesHelper.prototype = Object.create( THREE.Line.prototype );\r\nTHREE.EdgesHelper.prototype.constructor = THREE.EdgesHelper;\r\n\r\n// File:src/extras/helpers/FaceNormalsHelper.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author WestLangley / http://github.com/WestLangley\r\n*/\r\n\r\nTHREE.FaceNormalsHelper = function ( object, size, hex, linewidth ) {\r\n\r\n\tthis.object = object;\r\n\r\n\tthis.size = ( size !== undefined ) ? size : 1;\r\n\r\n\tvar color = ( hex !== undefined ) ? hex : 0xffff00;\r\n\r\n\tvar width = ( linewidth !== undefined ) ? linewidth : 1;\r\n\r\n\tvar geometry = new THREE.Geometry();\r\n\r\n\tvar faces = this.object.geometry.faces;\r\n\r\n\tfor ( var i = 0, l = faces.length; i < l; i ++ ) {\r\n\r\n\t\tgeometry.vertices.push( new THREE.Vector3(), new THREE.Vector3() );\r\n\r\n\t}\r\n\r\n\tTHREE.Line.call( this, geometry, new THREE.LineBasicMaterial( { color: color, linewidth: width } ), THREE.LinePieces );\r\n\r\n\tthis.matrixAutoUpdate = false;\r\n\r\n\tthis.normalMatrix = new THREE.Matrix3();\r\n\r\n\tthis.update();\r\n\r\n};\r\n\r\nTHREE.FaceNormalsHelper.prototype = Object.create( THREE.Line.prototype );\r\nTHREE.FaceNormalsHelper.prototype.constructor = THREE.FaceNormalsHelper;\r\n\r\nTHREE.FaceNormalsHelper.prototype.update = function () {\r\n\r\n\tvar vertices = this.geometry.vertices;\r\n\r\n\tvar object = this.object;\r\n\tvar objectVertices = object.geometry.vertices;\r\n\tvar objectFaces = object.geometry.faces;\r\n\tvar objectWorldMatrix = object.matrixWorld;\r\n\r\n\tobject.updateMatrixWorld( true );\r\n\r\n\tthis.normalMatrix.getNormalMatrix( objectWorldMatrix );\r\n\r\n\tfor ( var i = 0, i2 = 0, l = objectFaces.length; i < l; i ++, i2 += 2 ) {\r\n\r\n\t\tvar face = objectFaces[ i ];\r\n\r\n\t\tvertices[ i2 ].copy( objectVertices[ face.a ] )\r\n\t\t\t.add( objectVertices[ face.b ] )\r\n\t\t\t.add( objectVertices[ face.c ] )\r\n\t\t\t.divideScalar( 3 )\r\n\t\t\t.applyMatrix4( objectWorldMatrix );\r\n\r\n\t\tvertices[ i2 + 1 ].copy( face.normal )\r\n\t\t\t.applyMatrix3( this.normalMatrix )\r\n\t\t\t.normalize()\r\n\t\t\t.multiplyScalar( this.size )\r\n\t\t\t.add( vertices[ i2 ] );\r\n\r\n\t}\r\n\r\n\tthis.geometry.verticesNeedUpdate = true;\r\n\r\n\treturn this;\r\n\r\n};\r\n\r\n\r\n// File:src/extras/helpers/GridHelper.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.GridHelper = function ( size, step ) {\r\n\r\n\tvar geometry = new THREE.Geometry();\r\n\tvar material = new THREE.LineBasicMaterial( { vertexColors: THREE.VertexColors } );\r\n\r\n\tthis.color1 = new THREE.Color( 0x444444 );\r\n\tthis.color2 = new THREE.Color( 0x888888 );\r\n\r\n\tfor ( var i = - size; i <= size; i += step ) {\r\n\r\n\t\tgeometry.vertices.push(\r\n\t\t\tnew THREE.Vector3( - size, 0, i ), new THREE.Vector3( size, 0, i ),\r\n\t\t\tnew THREE.Vector3( i, 0, - size ), new THREE.Vector3( i, 0, size )\r\n\t\t);\r\n\r\n\t\tvar color = i === 0 ? this.color1 : this.color2;\r\n\r\n\t\tgeometry.colors.push( color, color, color, color );\r\n\r\n\t}\r\n\r\n\tTHREE.Line.call( this, geometry, material, THREE.LinePieces );\r\n\r\n};\r\n\r\nTHREE.GridHelper.prototype = Object.create( THREE.Line.prototype );\r\nTHREE.GridHelper.prototype.constructor = THREE.GridHelper;\r\n\r\nTHREE.GridHelper.prototype.setColors = function( colorCenterLine, colorGrid ) {\r\n\r\n\tthis.color1.set( colorCenterLine );\r\n\tthis.color2.set( colorGrid );\r\n\r\n\tthis.geometry.colorsNeedUpdate = true;\r\n\r\n}\r\n\r\n// File:src/extras/helpers/HemisphereLightHelper.js\r\n\r\n/**\r\n * @author alteredq / http://alteredqualia.com/\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.HemisphereLightHelper = function ( light, sphereSize ) {\r\n\r\n\tTHREE.Object3D.call( this );\r\n\r\n\tthis.light = light;\r\n\tthis.light.updateMatrixWorld();\r\n\r\n\tthis.matrix = light.matrixWorld;\r\n\tthis.matrixAutoUpdate = false;\r\n\r\n\tthis.colors = [ new THREE.Color(), new THREE.Color() ];\r\n\r\n\tvar geometry = new THREE.SphereGeometry( sphereSize, 4, 2 );\r\n\tgeometry.applyMatrix( new THREE.Matrix4().makeRotationX( - Math.PI / 2 ) );\r\n\r\n\tfor ( var i = 0, il = 8; i < il; i ++ ) {\r\n\r\n\t\tgeometry.faces[ i ].color = this.colors[ i < 4 ? 0 : 1 ];\r\n\r\n\t}\r\n\r\n\tvar material = new THREE.MeshBasicMaterial( { vertexColors: THREE.FaceColors, wireframe: true } );\r\n\r\n\tthis.lightSphere = new THREE.Mesh( geometry, material );\r\n\tthis.add( this.lightSphere );\r\n\r\n\tthis.update();\r\n\r\n};\r\n\r\nTHREE.HemisphereLightHelper.prototype = Object.create( THREE.Object3D.prototype );\r\nTHREE.HemisphereLightHelper.prototype.constructor = THREE.HemisphereLightHelper;\r\n\r\nTHREE.HemisphereLightHelper.prototype.dispose = function () {\r\n\tthis.lightSphere.geometry.dispose();\r\n\tthis.lightSphere.material.dispose();\r\n};\r\n\r\nTHREE.HemisphereLightHelper.prototype.update = function () {\r\n\r\n\tvar vector = new THREE.Vector3();\r\n\r\n\treturn function () {\r\n\r\n\t\tthis.colors[ 0 ].copy( this.light.color ).multiplyScalar( this.light.intensity );\r\n\t\tthis.colors[ 1 ].copy( this.light.groundColor ).multiplyScalar( this.light.intensity );\r\n\r\n\t\tthis.lightSphere.lookAt( vector.setFromMatrixPosition( this.light.matrixWorld ).negate() );\r\n\t\tthis.lightSphere.geometry.colorsNeedUpdate = true;\r\n\r\n\t}\r\n\r\n}();\r\n\r\n// File:src/extras/helpers/PointLightHelper.js\r\n\r\n/**\r\n * @author alteredq / http://alteredqualia.com/\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.PointLightHelper = function ( light, sphereSize ) {\r\n\r\n\tthis.light = light;\r\n\tthis.light.updateMatrixWorld();\r\n\r\n\tvar geometry = new THREE.SphereGeometry( sphereSize, 4, 2 );\r\n\tvar material = new THREE.MeshBasicMaterial( { wireframe: true, fog: false } );\r\n\tmaterial.color.copy( this.light.color ).multiplyScalar( this.light.intensity );\r\n\r\n\tTHREE.Mesh.call( this, geometry, material );\r\n\r\n\tthis.matrix = this.light.matrixWorld;\r\n\tthis.matrixAutoUpdate = false;\r\n\r\n\t/*\r\n\tvar distanceGeometry = new THREE.IcosahedronGeometry( 1, 2 );\r\n\tvar distanceMaterial = new THREE.MeshBasicMaterial( { color: hexColor, fog: false, wireframe: true, opacity: 0.1, transparent: true } );\r\n\r\n\tthis.lightSphere = new THREE.Mesh( bulbGeometry, bulbMaterial );\r\n\tthis.lightDistance = new THREE.Mesh( distanceGeometry, distanceMaterial );\r\n\r\n\tvar d = light.distance;\r\n\r\n\tif ( d === 0.0 ) {\r\n\r\n\t\tthis.lightDistance.visible = false;\r\n\r\n\t} else {\r\n\r\n\t\tthis.lightDistance.scale.set( d, d, d );\r\n\r\n\t}\r\n\r\n\tthis.add( this.lightDistance );\r\n\t*/\r\n\r\n};\r\n\r\nTHREE.PointLightHelper.prototype = Object.create( THREE.Mesh.prototype );\r\nTHREE.PointLightHelper.prototype.constructor = THREE.PointLightHelper;\r\n\r\nTHREE.PointLightHelper.prototype.dispose = function () {\r\n\r\n\tthis.geometry.dispose();\r\n\tthis.material.dispose();\r\n};\r\n\r\nTHREE.PointLightHelper.prototype.update = function () {\r\n\r\n\tthis.material.color.copy( this.light.color ).multiplyScalar( this.light.intensity );\r\n\r\n\t/*\r\n\tvar d = this.light.distance;\r\n\r\n\tif ( d === 0.0 ) {\r\n\r\n\t\tthis.lightDistance.visible = false;\r\n\r\n\t} else {\r\n\r\n\t\tthis.lightDistance.visible = true;\r\n\t\tthis.lightDistance.scale.set( d, d, d );\r\n\r\n\t}\r\n\t*/\r\n\r\n};\r\n\r\n// File:src/extras/helpers/SkeletonHelper.js\r\n\r\n/**\r\n * @author Sean Griffin / http://twitter.com/sgrif\r\n * @author Michael Guerrero / http://realitymeltdown.com\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author ikerr / http://verold.com\r\n */\r\n\r\nTHREE.SkeletonHelper = function ( object ) {\r\n\r\n\tthis.bones = this.getBoneList( object );\r\n\r\n\tvar geometry = new THREE.Geometry();\r\n\r\n\tfor ( var i = 0; i < this.bones.length; i ++ ) {\r\n\r\n\t\tvar bone = this.bones[ i ];\r\n\r\n\t\tif ( bone.parent instanceof THREE.Bone ) {\r\n\r\n\t\t\tgeometry.vertices.push( new THREE.Vector3() );\r\n\t\t\tgeometry.vertices.push( new THREE.Vector3() );\r\n\t\t\tgeometry.colors.push( new THREE.Color( 0, 0, 1 ) );\r\n\t\t\tgeometry.colors.push( new THREE.Color( 0, 1, 0 ) );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tvar material = new THREE.LineBasicMaterial( { vertexColors: THREE.VertexColors, depthTest: false, depthWrite: false, transparent: true } );\r\n\r\n\tTHREE.Line.call( this, geometry, material, THREE.LinePieces );\r\n\r\n\tthis.root = object;\r\n\r\n\tthis.matrix = object.matrixWorld;\r\n\tthis.matrixAutoUpdate = false;\r\n\r\n\tthis.update();\r\n\r\n};\r\n\r\n\r\nTHREE.SkeletonHelper.prototype = Object.create( THREE.Line.prototype );\r\nTHREE.SkeletonHelper.prototype.constructor = THREE.SkeletonHelper;\r\n\r\nTHREE.SkeletonHelper.prototype.getBoneList = function( object ) {\r\n\r\n\tvar boneList = [];\r\n\r\n\tif ( object instanceof THREE.Bone ) {\r\n\r\n\t\tboneList.push( object );\r\n\r\n\t}\r\n\r\n\tfor ( var i = 0; i < object.children.length; i ++ ) {\r\n\r\n\t\tboneList.push.apply( boneList, this.getBoneList( object.children[ i ] ) );\r\n\r\n\t}\r\n\r\n\treturn boneList;\r\n\r\n};\r\n\r\nTHREE.SkeletonHelper.prototype.update = function () {\r\n\r\n\tvar geometry = this.geometry;\r\n\r\n\tvar matrixWorldInv = new THREE.Matrix4().getInverse( this.root.matrixWorld );\r\n\r\n\tvar boneMatrix = new THREE.Matrix4();\r\n\r\n\tvar j = 0;\r\n\r\n\tfor ( var i = 0; i < this.bones.length; i ++ ) {\r\n\r\n\t\tvar bone = this.bones[ i ];\r\n\r\n\t\tif ( bone.parent instanceof THREE.Bone ) {\r\n\r\n\t\t\tboneMatrix.multiplyMatrices( matrixWorldInv, bone.matrixWorld );\r\n\t\t\tgeometry.vertices[ j ].setFromMatrixPosition( boneMatrix );\r\n\r\n\t\t\tboneMatrix.multiplyMatrices( matrixWorldInv, bone.parent.matrixWorld );\r\n\t\t\tgeometry.vertices[ j + 1 ].setFromMatrixPosition( boneMatrix );\r\n\r\n\t\t\tj += 2;\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tgeometry.verticesNeedUpdate = true;\r\n\r\n\tgeometry.computeBoundingSphere();\r\n\r\n};\r\n\r\n// File:src/extras/helpers/SpotLightHelper.js\r\n\r\n/**\r\n * @author alteredq / http://alteredqualia.com/\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author WestLangley / http://github.com/WestLangley\r\n*/\r\n\r\nTHREE.SpotLightHelper = function ( light ) {\r\n\r\n\tTHREE.Object3D.call( this );\r\n\r\n\tthis.light = light;\r\n\tthis.light.updateMatrixWorld();\r\n\r\n\tthis.matrix = light.matrixWorld;\r\n\tthis.matrixAutoUpdate = false;\r\n\r\n\tvar geometry = new THREE.CylinderGeometry( 0, 1, 1, 8, 1, true );\r\n\r\n\tgeometry.applyMatrix( new THREE.Matrix4().makeTranslation( 0, - 0.5, 0 ) );\r\n\tgeometry.applyMatrix( new THREE.Matrix4().makeRotationX( - Math.PI / 2 ) );\r\n\r\n\tvar material = new THREE.MeshBasicMaterial( { wireframe: true, fog: false } );\r\n\r\n\tthis.cone = new THREE.Mesh( geometry, material );\r\n\tthis.add( this.cone );\r\n\r\n\tthis.update();\r\n\r\n};\r\n\r\nTHREE.SpotLightHelper.prototype = Object.create( THREE.Object3D.prototype );\r\nTHREE.SpotLightHelper.prototype.constructor = THREE.SpotLightHelper;\r\n\r\nTHREE.SpotLightHelper.prototype.dispose = function () {\r\n\tthis.cone.geometry.dispose();\r\n\tthis.cone.material.dispose();\r\n};\r\n\r\nTHREE.SpotLightHelper.prototype.update = function () {\r\n\r\n\tvar vector = new THREE.Vector3();\r\n\tvar vector2 = new THREE.Vector3();\r\n\r\n\treturn function () {\r\n\r\n\t\tvar coneLength = this.light.distance ? this.light.distance : 10000;\r\n\t\tvar coneWidth = coneLength * Math.tan( this.light.angle );\r\n\r\n\t\tthis.cone.scale.set( coneWidth, coneWidth, coneLength );\r\n\r\n\t\tvector.setFromMatrixPosition( this.light.matrixWorld );\r\n\t\tvector2.setFromMatrixPosition( this.light.target.matrixWorld );\r\n\r\n\t\tthis.cone.lookAt( vector2.sub( vector ) );\r\n\r\n\t\tthis.cone.material.color.copy( this.light.color ).multiplyScalar( this.light.intensity );\r\n\r\n\t};\r\n\r\n}();\r\n\r\n// File:src/extras/helpers/VertexNormalsHelper.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author WestLangley / http://github.com/WestLangley\r\n*/\r\n\r\nTHREE.VertexNormalsHelper = function ( object, size, hex, linewidth ) {\r\n\r\n\tthis.object = object;\r\n\r\n\tthis.size = ( size !== undefined ) ? size : 1;\r\n\r\n\tvar color = ( hex !== undefined ) ? hex : 0xff0000;\r\n\r\n\tvar width = ( linewidth !== undefined ) ? linewidth : 1;\r\n\r\n\tvar geometry = new THREE.Geometry();\r\n\r\n\tvar faces = object.geometry.faces;\r\n\r\n\tfor ( var i = 0, l = faces.length; i < l; i ++ ) {\r\n\r\n\t\tvar face = faces[ i ];\r\n\r\n\t\tfor ( var j = 0, jl = face.vertexNormals.length; j < jl; j ++ ) {\r\n\r\n\t\t\tgeometry.vertices.push( new THREE.Vector3(), new THREE.Vector3() );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tTHREE.Line.call( this, geometry, new THREE.LineBasicMaterial( { color: color, linewidth: width } ), THREE.LinePieces );\r\n\r\n\tthis.matrixAutoUpdate = false;\r\n\r\n\tthis.normalMatrix = new THREE.Matrix3();\r\n\r\n\tthis.update();\r\n\r\n};\r\n\r\nTHREE.VertexNormalsHelper.prototype = Object.create( THREE.Line.prototype );\r\nTHREE.VertexNormalsHelper.prototype.constructor = THREE.VertexNormalsHelper;\r\n\r\nTHREE.VertexNormalsHelper.prototype.update = ( function ( object ) {\r\n\r\n\tvar v1 = new THREE.Vector3();\r\n\r\n\treturn function( object ) {\r\n\r\n\t\tvar keys = [ 'a', 'b', 'c', 'd' ];\r\n\r\n\t\tthis.object.updateMatrixWorld( true );\r\n\r\n\t\tthis.normalMatrix.getNormalMatrix( this.object.matrixWorld );\r\n\r\n\t\tvar vertices = this.geometry.vertices;\r\n\r\n\t\tvar verts = this.object.geometry.vertices;\r\n\r\n\t\tvar faces = this.object.geometry.faces;\r\n\r\n\t\tvar worldMatrix = this.object.matrixWorld;\r\n\r\n\t\tvar idx = 0;\r\n\r\n\t\tfor ( var i = 0, l = faces.length; i < l; i ++ ) {\r\n\r\n\t\t\tvar face = faces[ i ];\r\n\r\n\t\t\tfor ( var j = 0, jl = face.vertexNormals.length; j < jl; j ++ ) {\r\n\r\n\t\t\t\tvar vertexId = face[ keys[ j ] ];\r\n\t\t\t\tvar vertex = verts[ vertexId ];\r\n\r\n\t\t\t\tvar normal = face.vertexNormals[ j ];\r\n\r\n\t\t\t\tvertices[ idx ].copy( vertex ).applyMatrix4( worldMatrix );\r\n\r\n\t\t\t\tv1.copy( normal ).applyMatrix3( this.normalMatrix ).normalize().multiplyScalar( this.size );\r\n\r\n\t\t\t\tv1.add( vertices[ idx ] );\r\n\t\t\t\tidx = idx + 1;\r\n\r\n\t\t\t\tvertices[ idx ].copy( v1 );\r\n\t\t\t\tidx = idx + 1;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tthis.geometry.verticesNeedUpdate = true;\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n}());\r\n\r\n// File:src/extras/helpers/VertexTangentsHelper.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author WestLangley / http://github.com/WestLangley\r\n*/\r\n\r\nTHREE.VertexTangentsHelper = function ( object, size, hex, linewidth ) {\r\n\r\n\tthis.object = object;\r\n\r\n\tthis.size = ( size !== undefined ) ? size : 1;\r\n\r\n\tvar color = ( hex !== undefined ) ? hex : 0x0000ff;\r\n\r\n\tvar width = ( linewidth !== undefined ) ? linewidth : 1;\r\n\r\n\tvar geometry = new THREE.Geometry();\r\n\r\n\tvar faces = object.geometry.faces;\r\n\r\n\tfor ( var i = 0, l = faces.length; i < l; i ++ ) {\r\n\r\n\t\tvar face = faces[ i ];\r\n\r\n\t\tfor ( var j = 0, jl = face.vertexTangents.length; j < jl; j ++ ) {\r\n\r\n\t\t\tgeometry.vertices.push( new THREE.Vector3() );\r\n\t\t\tgeometry.vertices.push( new THREE.Vector3() );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tTHREE.Line.call( this, geometry, new THREE.LineBasicMaterial( { color: color, linewidth: width } ), THREE.LinePieces );\r\n\r\n\tthis.matrixAutoUpdate = false;\r\n\r\n\tthis.update();\r\n\r\n};\r\n\r\nTHREE.VertexTangentsHelper.prototype = Object.create( THREE.Line.prototype );\r\nTHREE.VertexTangentsHelper.prototype.constructor = THREE.VertexTangentsHelper;\r\n\r\nTHREE.VertexTangentsHelper.prototype.update = ( function ( object ) {\r\n\r\n\tvar v1 = new THREE.Vector3();\r\n\r\n\treturn function( object ) {\r\n\r\n\t\tvar keys = [ 'a', 'b', 'c', 'd' ];\r\n\r\n\t\tthis.object.updateMatrixWorld( true );\r\n\r\n\t\tvar vertices = this.geometry.vertices;\r\n\r\n\t\tvar verts = this.object.geometry.vertices;\r\n\r\n\t\tvar faces = this.object.geometry.faces;\r\n\r\n\t\tvar worldMatrix = this.object.matrixWorld;\r\n\r\n\t\tvar idx = 0;\r\n\r\n\t\tfor ( var i = 0, l = faces.length; i < l; i ++ ) {\r\n\r\n\t\t\tvar face = faces[ i ];\r\n\r\n\t\t\tfor ( var j = 0, jl = face.vertexTangents.length; j < jl; j ++ ) {\r\n\r\n\t\t\t\tvar vertexId = face[ keys[ j ] ];\r\n\t\t\t\tvar vertex = verts[ vertexId ];\r\n\r\n\t\t\t\tvar tangent = face.vertexTangents[ j ];\r\n\r\n\t\t\t\tvertices[ idx ].copy( vertex ).applyMatrix4( worldMatrix );\r\n\r\n\t\t\t\tv1.copy( tangent ).transformDirection( worldMatrix ).multiplyScalar( this.size );\r\n\r\n\t\t\t\tv1.add( vertices[ idx ] );\r\n\t\t\t\tidx = idx + 1;\r\n\r\n\t\t\t\tvertices[ idx ].copy( v1 );\r\n\t\t\t\tidx = idx + 1;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tthis.geometry.verticesNeedUpdate = true;\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n}());\r\n\r\n// File:src/extras/helpers/WireframeHelper.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.WireframeHelper = function ( object, hex ) {\r\n\r\n\tvar color = ( hex !== undefined ) ? hex : 0xffffff;\r\n\r\n\tvar edge = [ 0, 0 ], hash = {};\r\n\tvar sortFunction = function ( a, b ) { return a - b };\r\n\r\n\tvar keys = [ 'a', 'b', 'c' ];\r\n\tvar geometry = new THREE.BufferGeometry();\r\n\r\n\tif ( object.geometry instanceof THREE.Geometry ) {\r\n\r\n\t\tvar vertices = object.geometry.vertices;\r\n\t\tvar faces = object.geometry.faces;\r\n\t\tvar numEdges = 0;\r\n\r\n\t\t// allocate maximal size\r\n\t\tvar edges = new Uint32Array( 6 * faces.length );\r\n\r\n\t\tfor ( var i = 0, l = faces.length; i < l; i ++ ) {\r\n\r\n\t\t\tvar face = faces[ i ];\r\n\r\n\t\t\tfor ( var j = 0; j < 3; j ++ ) {\r\n\r\n\t\t\t\tedge[ 0 ] = face[ keys[ j ] ];\r\n\t\t\t\tedge[ 1 ] = face[ keys[ ( j + 1 ) % 3 ] ];\r\n\t\t\t\tedge.sort( sortFunction );\r\n\r\n\t\t\t\tvar key = edge.toString();\r\n\r\n\t\t\t\tif ( hash[ key ] === undefined ) {\r\n\r\n\t\t\t\t\tedges[ 2 * numEdges ] = edge[ 0 ];\r\n\t\t\t\t\tedges[ 2 * numEdges + 1 ] = edge[ 1 ];\r\n\t\t\t\t\thash[ key ] = true;\r\n\t\t\t\t\tnumEdges ++;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tvar coords = new Float32Array( numEdges * 2 * 3 );\r\n\r\n\t\tfor ( var i = 0, l = numEdges; i < l; i ++ ) {\r\n\r\n\t\t\tfor ( var j = 0; j < 2; j ++ ) {\r\n\r\n\t\t\t\tvar vertex = vertices[ edges [ 2 * i + j] ];\r\n\r\n\t\t\t\tvar index = 6 * i + 3 * j;\r\n\t\t\t\tcoords[ index + 0 ] = vertex.x;\r\n\t\t\t\tcoords[ index + 1 ] = vertex.y;\r\n\t\t\t\tcoords[ index + 2 ] = vertex.z;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tgeometry.addAttribute( 'position', new THREE.BufferAttribute( coords, 3 ) );\r\n\r\n\t} else if ( object.geometry instanceof THREE.BufferGeometry ) {\r\n\r\n\t\tif ( object.geometry.attributes.index !== undefined ) { // Indexed BufferGeometry\r\n\r\n\t\t\tvar vertices = object.geometry.attributes.position.array;\r\n\t\t\tvar indices = object.geometry.attributes.index.array;\r\n\t\t\tvar drawcalls = object.geometry.drawcalls;\r\n\t\t\tvar numEdges = 0;\r\n\r\n\t\t\tif ( drawcalls.length === 0 ) {\r\n\r\n\t\t\t\tdrawcalls = [ { count : indices.length, index : 0, start : 0 } ];\r\n\r\n\t\t\t}\r\n\r\n\t\t\t// allocate maximal size\r\n\t\t\tvar edges = new Uint32Array( 2 * indices.length );\r\n\r\n\t\t\tfor ( var o = 0, ol = drawcalls.length; o < ol; ++ o ) {\r\n\r\n\t\t\t\tvar start = drawcalls[ o ].start;\r\n\t\t\t\tvar count = drawcalls[ o ].count;\r\n\t\t\t\tvar index = drawcalls[ o ].index;\r\n\r\n\t\t\t\tfor ( var i = start, il = start + count; i < il; i += 3 ) {\r\n\r\n\t\t\t\t\tfor ( var j = 0; j < 3; j ++ ) {\r\n\r\n\t\t\t\t\t\tedge[ 0 ] = index + indices[ i + j ];\r\n\t\t\t\t\t\tedge[ 1 ] = index + indices[ i + ( j + 1 ) % 3 ];\r\n\t\t\t\t\t\tedge.sort( sortFunction );\r\n\r\n\t\t\t\t\t\tvar key = edge.toString();\r\n\r\n\t\t\t\t\t\tif ( hash[ key ] === undefined ) {\r\n\r\n\t\t\t\t\t\t\tedges[ 2 * numEdges ] = edge[ 0 ];\r\n\t\t\t\t\t\t\tedges[ 2 * numEdges + 1 ] = edge[ 1 ];\r\n\t\t\t\t\t\t\thash[ key ] = true;\r\n\t\t\t\t\t\t\tnumEdges ++;\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\tvar coords = new Float32Array( numEdges * 2 * 3 );\r\n\r\n\t\t\tfor ( var i = 0, l = numEdges; i < l; i ++ ) {\r\n\r\n\t\t\t\tfor ( var j = 0; j < 2; j ++ ) {\r\n\r\n\t\t\t\t\tvar index = 6 * i + 3 * j;\r\n\t\t\t\t\tvar index2 = 3 * edges[ 2 * i + j];\r\n\t\t\t\t\tcoords[ index + 0 ] = vertices[ index2 ];\r\n\t\t\t\t\tcoords[ index + 1 ] = vertices[ index2 + 1 ];\r\n\t\t\t\t\tcoords[ index + 2 ] = vertices[ index2 + 2 ];\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\tgeometry.addAttribute( 'position', new THREE.BufferAttribute( coords, 3 ) );\r\n\r\n\t\t} else { // non-indexed BufferGeometry\r\n\r\n\t\t\tvar vertices = object.geometry.attributes.position.array;\r\n\t\t\tvar numEdges = vertices.length / 3;\r\n\t\t\tvar numTris = numEdges / 3;\r\n\r\n\t\t\tvar coords = new Float32Array( numEdges * 2 * 3 );\r\n\r\n\t\t\tfor ( var i = 0, l = numTris; i < l; i ++ ) {\r\n\r\n\t\t\t\tfor ( var j = 0; j < 3; j ++ ) {\r\n\r\n\t\t\t\t\tvar index = 18 * i + 6 * j;\r\n\r\n\t\t\t\t\tvar index1 = 9 * i + 3 * j;\r\n\t\t\t\t\tcoords[ index + 0 ] = vertices[ index1 ];\r\n\t\t\t\t\tcoords[ index + 1 ] = vertices[ index1 + 1 ];\r\n\t\t\t\t\tcoords[ index + 2 ] = vertices[ index1 + 2 ];\r\n\r\n\t\t\t\t\tvar index2 = 9 * i + 3 * ( ( j + 1 ) % 3 );\r\n\t\t\t\t\tcoords[ index + 3 ] = vertices[ index2 ];\r\n\t\t\t\t\tcoords[ index + 4 ] = vertices[ index2 + 1 ];\r\n\t\t\t\t\tcoords[ index + 5 ] = vertices[ index2 + 2 ];\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\tgeometry.addAttribute( 'position', new THREE.BufferAttribute( coords, 3 ) );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tTHREE.Line.call( this, geometry, new THREE.LineBasicMaterial( { color: color } ), THREE.LinePieces );\r\n\r\n\tthis.matrix = object.matrixWorld;\r\n\tthis.matrixAutoUpdate = false;\r\n\r\n};\r\n\r\nTHREE.WireframeHelper.prototype = Object.create( THREE.Line.prototype );\r\nTHREE.WireframeHelper.prototype.constructor = THREE.WireframeHelper;\r\n\r\n// File:src/extras/objects/ImmediateRenderObject.js\r\n\r\n/**\r\n * @author alteredq / http://alteredqualia.com/\r\n */\r\n\r\nTHREE.ImmediateRenderObject = function () {\r\n\r\n\tTHREE.Object3D.call( this );\r\n\r\n\tthis.render = function ( renderCallback ) {};\r\n\r\n};\r\n\r\nTHREE.ImmediateRenderObject.prototype = Object.create( THREE.Object3D.prototype );\r\nTHREE.ImmediateRenderObject.prototype.constructor = THREE.ImmediateRenderObject;\r\n\r\n// File:src/extras/objects/MorphBlendMesh.js\r\n\r\n/**\r\n * @author alteredq / http://alteredqualia.com/\r\n */\r\n\r\nTHREE.MorphBlendMesh = function( geometry, material ) {\r\n\r\n\tTHREE.Mesh.call( this, geometry, material );\r\n\r\n\tthis.animationsMap = {};\r\n\tthis.animationsList = [];\r\n\r\n\t// prepare default animation\r\n\t// (all frames played together in 1 second)\r\n\r\n\tvar numFrames = this.geometry.morphTargets.length;\r\n\r\n\tvar name = \"__default\";\r\n\r\n\tvar startFrame = 0;\r\n\tvar endFrame = numFrames - 1;\r\n\r\n\tvar fps = numFrames / 1;\r\n\r\n\tthis.createAnimation( name, startFrame, endFrame, fps );\r\n\tthis.setAnimationWeight( name, 1 );\r\n\r\n};\r\n\r\nTHREE.MorphBlendMesh.prototype = Object.create( THREE.Mesh.prototype );\r\nTHREE.MorphBlendMesh.prototype.constructor = THREE.MorphBlendMesh;\r\n\r\nTHREE.MorphBlendMesh.prototype.createAnimation = function ( name, start, end, fps ) {\r\n\r\n\tvar animation = {\r\n\r\n\t\tstartFrame: start,\r\n\t\tendFrame: end,\r\n\r\n\t\tlength: end - start + 1,\r\n\r\n\t\tfps: fps,\r\n\t\tduration: ( end - start ) / fps,\r\n\r\n\t\tlastFrame: 0,\r\n\t\tcurrentFrame: 0,\r\n\r\n\t\tactive: false,\r\n\r\n\t\ttime: 0,\r\n\t\tdirection: 1,\r\n\t\tweight: 1,\r\n\r\n\t\tdirectionBackwards: false,\r\n\t\tmirroredLoop: false\r\n\r\n\t};\r\n\r\n\tthis.animationsMap[ name ] = animation;\r\n\tthis.animationsList.push( animation );\r\n\r\n};\r\n\r\nTHREE.MorphBlendMesh.prototype.autoCreateAnimations = function ( fps ) {\r\n\r\n\tvar pattern = /([a-z]+)_?(\\d+)/;\r\n\r\n\tvar firstAnimation, frameRanges = {};\r\n\r\n\tvar geometry = this.geometry;\r\n\r\n\tfor ( var i = 0, il = geometry.morphTargets.length; i < il; i ++ ) {\r\n\r\n\t\tvar morph = geometry.morphTargets[ i ];\r\n\t\tvar chunks = morph.name.match( pattern );\r\n\r\n\t\tif ( chunks && chunks.length > 1 ) {\r\n\r\n\t\t\tvar name = chunks[ 1 ];\r\n\r\n\t\t\tif ( ! frameRanges[ name ] ) frameRanges[ name ] = { start: Infinity, end: - Infinity };\r\n\r\n\t\t\tvar range = frameRanges[ name ];\r\n\r\n\t\t\tif ( i < range.start ) range.start = i;\r\n\t\t\tif ( i > range.end ) range.end = i;\r\n\r\n\t\t\tif ( ! firstAnimation ) firstAnimation = name;\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tfor ( var name in frameRanges ) {\r\n\r\n\t\tvar range = frameRanges[ name ];\r\n\t\tthis.createAnimation( name, range.start, range.end, fps );\r\n\r\n\t}\r\n\r\n\tthis.firstAnimation = firstAnimation;\r\n\r\n};\r\n\r\nTHREE.MorphBlendMesh.prototype.setAnimationDirectionForward = function ( name ) {\r\n\r\n\tvar animation = this.animationsMap[ name ];\r\n\r\n\tif ( animation ) {\r\n\r\n\t\tanimation.direction = 1;\r\n\t\tanimation.directionBackwards = false;\r\n\r\n\t}\r\n\r\n};\r\n\r\nTHREE.MorphBlendMesh.prototype.setAnimationDirectionBackward = function ( name ) {\r\n\r\n\tvar animation = this.animationsMap[ name ];\r\n\r\n\tif ( animation ) {\r\n\r\n\t\tanimation.direction = - 1;\r\n\t\tanimation.directionBackwards = true;\r\n\r\n\t}\r\n\r\n};\r\n\r\nTHREE.MorphBlendMesh.prototype.setAnimationFPS = function ( name, fps ) {\r\n\r\n\tvar animation = this.animationsMap[ name ];\r\n\r\n\tif ( animation ) {\r\n\r\n\t\tanimation.fps = fps;\r\n\t\tanimation.duration = ( animation.end - animation.start ) / animation.fps;\r\n\r\n\t}\r\n\r\n};\r\n\r\nTHREE.MorphBlendMesh.prototype.setAnimationDuration = function ( name, duration ) {\r\n\r\n\tvar animation = this.animationsMap[ name ];\r\n\r\n\tif ( animation ) {\r\n\r\n\t\tanimation.duration = duration;\r\n\t\tanimation.fps = ( animation.end - animation.start ) / animation.duration;\r\n\r\n\t}\r\n\r\n};\r\n\r\nTHREE.MorphBlendMesh.prototype.setAnimationWeight = function ( name, weight ) {\r\n\r\n\tvar animation = this.animationsMap[ name ];\r\n\r\n\tif ( animation ) {\r\n\r\n\t\tanimation.weight = weight;\r\n\r\n\t}\r\n\r\n};\r\n\r\nTHREE.MorphBlendMesh.prototype.setAnimationTime = function ( name, time ) {\r\n\r\n\tvar animation = this.animationsMap[ name ];\r\n\r\n\tif ( animation ) {\r\n\r\n\t\tanimation.time = time;\r\n\r\n\t}\r\n\r\n};\r\n\r\nTHREE.MorphBlendMesh.prototype.getAnimationTime = function ( name ) {\r\n\r\n\tvar time = 0;\r\n\r\n\tvar animation = this.animationsMap[ name ];\r\n\r\n\tif ( animation ) {\r\n\r\n\t\ttime = animation.time;\r\n\r\n\t}\r\n\r\n\treturn time;\r\n\r\n};\r\n\r\nTHREE.MorphBlendMesh.prototype.getAnimationDuration = function ( name ) {\r\n\r\n\tvar duration = - 1;\r\n\r\n\tvar animation = this.animationsMap[ name ];\r\n\r\n\tif ( animation ) {\r\n\r\n\t\tduration = animation.duration;\r\n\r\n\t}\r\n\r\n\treturn duration;\r\n\r\n};\r\n\r\nTHREE.MorphBlendMesh.prototype.playAnimation = function ( name ) {\r\n\r\n\tvar animation = this.animationsMap[ name ];\r\n\r\n\tif ( animation ) {\r\n\r\n\t\tanimation.time = 0;\r\n\t\tanimation.active = true;\r\n\r\n\t} else {\r\n\r\n\t\tTHREE.warn( \"THREE.MorphBlendMesh: animation[\" + name + \"] undefined in .playAnimation()\" );\r\n\r\n\t}\r\n\r\n};\r\n\r\nTHREE.MorphBlendMesh.prototype.stopAnimation = function ( name ) {\r\n\r\n\tvar animation = this.animationsMap[ name ];\r\n\r\n\tif ( animation ) {\r\n\r\n\t\tanimation.active = false;\r\n\r\n\t}\r\n\r\n};\r\n\r\nTHREE.MorphBlendMesh.prototype.update = function ( delta ) {\r\n\r\n\tfor ( var i = 0, il = this.animationsList.length; i < il; i ++ ) {\r\n\r\n\t\tvar animation = this.animationsList[ i ];\r\n\r\n\t\tif ( ! animation.active ) continue;\r\n\r\n\t\tvar frameTime = animation.duration / animation.length;\r\n\r\n\t\tanimation.time += animation.direction * delta;\r\n\r\n\t\tif ( animation.mirroredLoop ) {\r\n\r\n\t\t\tif ( animation.time > animation.duration || animation.time < 0 ) {\r\n\r\n\t\t\t\tanimation.direction *= - 1;\r\n\r\n\t\t\t\tif ( animation.time > animation.duration ) {\r\n\r\n\t\t\t\t\tanimation.time = animation.duration;\r\n\t\t\t\t\tanimation.directionBackwards = true;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( animation.time < 0 ) {\r\n\r\n\t\t\t\t\tanimation.time = 0;\r\n\t\t\t\t\tanimation.directionBackwards = false;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t} else {\r\n\r\n\t\t\tanimation.time = animation.time % animation.duration;\r\n\r\n\t\t\tif ( animation.time < 0 ) animation.time += animation.duration;\r\n\r\n\t\t}\r\n\r\n\t\tvar keyframe = animation.startFrame + THREE.Math.clamp( Math.floor( animation.time / frameTime ), 0, animation.length - 1 );\r\n\t\tvar weight = animation.weight;\r\n\r\n\t\tif ( keyframe !== animation.currentFrame ) {\r\n\r\n\t\t\tthis.morphTargetInfluences[ animation.lastFrame ] = 0;\r\n\t\t\tthis.morphTargetInfluences[ animation.currentFrame ] = 1 * weight;\r\n\r\n\t\t\tthis.morphTargetInfluences[ keyframe ] = 0;\r\n\r\n\t\t\tanimation.lastFrame = animation.currentFrame;\r\n\t\t\tanimation.currentFrame = keyframe;\r\n\r\n\t\t}\r\n\r\n\t\tvar mix = ( animation.time % frameTime ) / frameTime;\r\n\r\n\t\tif ( animation.directionBackwards ) mix = 1 - mix;\r\n\r\n\t\tthis.morphTargetInfluences[ animation.currentFrame ] = mix * weight;\r\n\t\tthis.morphTargetInfluences[ animation.lastFrame ] = ( 1 - mix ) * weight;\r\n\r\n\t}\r\n\r\n};\r\n\r\n\r\n// Export the THREE object for **Node.js**, with\r\n// backwards-compatibility for the old `require()` API. If we're in\r\n// the browser, add `_` as a global object via a string identifier,\r\n// for Closure Compiler \"advanced\" mode.\r\nif (typeof exports !== 'undefined') {\r\n  if (typeof module !== 'undefined' && module.exports) {\r\n    exports = module.exports = THREE;\r\n  }\r\n  exports.THREE = THREE;\r\n} else {\r\n  this['THREE'] = THREE;\r\n}\r\n","module.exports = Entity;\n\n/**\n * Basic component-driven object with facade functions for interacting with the\n * injected EntityManager object.\n * @constructor\n */\nfunction Entity()\n{\n  // Injected by EntityManager\n  this._manager    = null;\n\n  /**\n   * @type {Array.<Function>}\n   * @private\n   */\n  this._Components = [];\n\n  /**\n   * @type {Array.<String>}\n   * @private\n   */\n  this._tags       = [];\n}\n\n/**\n * @param {Function} TComponent\n * @return {Entity} This entity.\n */\nEntity.prototype.addComponent = function(TComponent)\n{\n  this._manager.entityAddComponent(this, TComponent);\n  return this;\n};\n\n/**\n * @param {Function} TComponent\n * @return {Entity} This entity.\n */\nEntity.prototype.removeComponent = function(TComponent)\n{\n  this._manager.entityRemoveComponent(this, TComponent);\n  return this;\n};\n\n/**\n * @param {Function} TComponent\n * @return {boolean} True if this entity has TComponent.\n */\nEntity.prototype.hasComponent = function(TComponent)\n{\n  return !!~this._Components.indexOf(TComponent);\n};\n\n/**\n * @param {Array.<Function>} Components\n * @return {boolean} True if entity has all Components.\n */\nEntity.prototype.hasAllComponents = function(Components)\n{\n  var b = true;\n\n  for (var i = 0; i < Components.length; i++) {\n    var C = Components[i];\n    b &= !!~this._Components.indexOf(C);\n  }\n\n  return b;\n};\n\n/**\n * @param {String} tag\n * @return {boolean} True if entity has tag.\n */\nEntity.prototype.hasTag = function(tag)\n{\n  return !!~this._tags.indexOf(tag);\n};\n\n/**\n * @param {String} tag\n * @return {Entity} This entity.\n */\nEntity.prototype.addTag = function(tag)\n{\n  this._manager.entityAddTag(this, tag);\n  return this;\n};\n\n/**\n * @param {String} tag\n * @return {Entity} This entity.\n */\nEntity.prototype.removeTag = function(tag)\n{\n  this._manager.entityRemoveTag(this, tag);\n  return this;\n};\n\n/**\n * @return {void}\n */\nEntity.prototype.remove = function()\n{\n  return this._manager.removeEntity(this);\n};\n\n","module.exports = Messanger;\n\nvar Event = require('./Event.js');\n\n/**\n * General event aggregation with filtering on components or tags.\n * @constructor\n */\nfunction Messanger()\n{\n  this._events = {};\n  this.fired   = 0;\n  this.handled = 0;\n}\n\n/**\n * @param {String} eventName\n * @param {Function} callback\n * @return {Event}\n */\nMessanger.prototype.listenTo = function(eventName, callback)\n{\n  if (!this._events[eventName])\n    this._events[eventName] = [];\n\n  var event = new Event(eventName, callback);\n\n  // Dump and chump\n  this._events[eventName].push(event);\n  return event;\n};\n\n/**\n * @param {String} eventName\n * @param {Object=} entity\n * @param {Option=} option\n */\nMessanger.prototype.trigger = function(eventName, entity, option)\n{\n  this.fired++;\n\n  var events = this._events[eventName];\n  if (!events) return;\n\n  // Try all events\n  for (var n = 0; n < events.length; n++) {\n    var event = events[n];\n    if (event.fire(eventName, entity, option))\n      this.handled++;\n  }\n};\n\n","module.exports = EntityManager;\n\nvar Entity     = require('./Entity.js');\nvar ObjectPool = require('./ObjectPool.js');\nvar Messanger  = require('./Messanger.js');\nvar getName    = require('typedef').getName;\n\n/**\n * Manage, create, and destroy entities. Can use methods to mutate entities\n * (tags, components) directly or via the facade on the Entity.\n * @param {Messanger} messanger\n * @constructor\n */\nfunction EntityManager(messanger)\n{\n  this.messanger = messanger;\n  this._tags = {};\n\n  /**\n   * @type {Array.<Entity>}\n   */\n  this._entities = [];\n\n  /**\n   * @type {Array.<Group>}\n   */\n  this._groups = {};\n\n  this._entityPool = new ObjectPool(Entity);\n\n  this._componentPools = {};\n}\n\n/**\n * Fired AFTER an entity has be created.\n * @event\n */\nEntityManager.ENTITY_CREATED = 'EntityManager#ENTITY_CREATED';\n\n/**\n * Fired BEFORE an entity has been removed.\n * @event\n */\nEntityManager.ENTITY_REMOVE = 'EntityManager#ENTITY_REMOVE';\n\n/**\n * Fired AFTER a component has been removed.\n * @event\n */\nEntityManager.COMPONENT_ADDED = 'EntityManager#COMPONENT_ADDED';\n\n/**\n * Fired BEFORE a component has been removedt\n * @event\n */\nEntityManager.COMPONENT_REMOVE = 'EntityManager#COMPONENT_REMOVE';\n\n/**\n * @constructor\n * @param {Array.<Function>} Components\n * @param {Array<Entity>} entities\n */\nfunction Group(Components, entities)\n{\n  this.Components = Components || [];\n  this.entities = entities || [];\n}\n\n/**\n * Get a new entity.\n * @return {Entity}\n */\nEntityManager.prototype.createEntity = function()\n{\n  var entity = this._entityPool.aquire();\n\n  this._entities.push(entity);\n  entity._manager = this;\n  this._trigger(EntityManager.ENTITY_CREATED, entity);\n  return entity;\n};\n\n/**\n * Cleanly remove entities based on tag. Avoids loop issues.\n * @param {String} tag\n */\nEntityManager.prototype.removeEntitiesByTag = function(tag)\n{\n  var entities = this._tags[tag];\n\n  if (!entities) return;\n\n  for (var x = entities.length - 1; x >= 0; x--) {\n    var entity = entities[x];\n    entity.remove();\n  }\n};\n\n/**\n * Dump all entities out of the manager. Avoids loop issues.\n */\nEntityManager.prototype.removeAllEntities = function()\n{\n  for (var x = this._entities.length - 1; x >= 0; x--) {\n    this._entities[x].remove();\n  }\n};\n\n/**\n * Drop an entity. Returns it to the pool and fires all events for removing\n * components as well.\n * @param {Entity} entity\n */\nEntityManager.prototype.removeEntity = function(entity)\n{\n  var index = this._entities.indexOf(entity);\n\n  if (!~index)\n    throw new Error('Tried to remove entity not in list');\n\n  this.entityRemoveAllComponents(entity);\n\n  // Remove from entity list\n  this._trigger(EntityManager.ENTITY_REMOVE, entity);\n  this._entities.splice(index, 1);\n\n  // Remove entity from any tag groups\n  entity._tags = null;\n  for (var tag in this._tags) {\n    var entities = this._tags[tag];\n    var n = entities.indexOf(entity);\n    if (~n) entities.splice(n, 1);\n  }\n\n  // Prevent any acecss and free\n  entity._manager = null;\n  this._entityPool.release(entity);\n};\n\n/**\n * @param {Entity} entity\n * @param {String} tag\n */\nEntityManager.prototype.entityAddTag = function(entity, tag)\n{\n  var entities = this._tags[tag];\n\n  if (!entities)\n    entities = this._tags[tag] = [];\n\n  // Don't add if already there\n  if (~entities.indexOf(entity)) return;\n\n  entities.push(entity);\n  entity._tags.push(tag);\n};\n\n/**\n * @param {Entity} entity\n * @param {String} tag\n */\nEntityManager.prototype.entityRemoveTag = function(entity, tag)\n{\n  var entities = this._tags[tag];\n  if (!entities) return;\n\n  var index = entities.indexOf(entity);\n  if (!~index) return;\n\n  entities.splice(index, 1);\n  entity._tags.splice(entity._tags.indexOf(tag), 1);\n};\n\n/**\n * @param {Entity} entity\n * @param {Function} Component\n */\nEntityManager.prototype.entityAddComponent = function(entity, Component)\n{\n  if (~entity._Components.indexOf(Component)) return;\n\n  entity._Components.push(Component);\n\n  // Create the reference on the entity to this (aquired) component\n  var cName = componentPropertyName(Component);\n  var cPool = this._componentPools[cName];\n  if (!cPool)\n    cPool = this._componentPools[cName] = new ObjectPool(Component);\n  var component = cPool.aquire();\n  entity[cName] = component;\n\n  // Check each indexed group to see if we need to add this entity to the list\n  for (var groupName in this._groups) {\n    var group = this._groups[groupName];\n\n    if (!~group.Components.indexOf(Component))\n      continue;\n    if (!entity.hasAllComponents(group.Components))\n      continue;\n    if (~group.entities.indexOf(entity))\n      continue;\n\n    group.entities.push(entity);\n  }\n\n  this._trigger(EntityManager.COMPONENT_ADDED, entity, Component);\n};\n\n/**\n * Drop all components on an entity.\n * @param {Entity} entity\n */\nEntityManager.prototype.entityRemoveAllComponents = function(entity)\n{\n  var Cs = entity._Components;\n\n  for (var j = Cs.length - 1; j >= 0; j--) {\n    var C = Cs[j];\n    entity.removeComponent(C);\n  }\n};\n\n/**\n * @param {Entity} entity\n * @param {Function} Component\n */\nEntityManager.prototype.entityRemoveComponent = function(entity, Component)\n{\n  var index = entity._Components.indexOf(Component);\n  if (!~index) return;\n\n  this._trigger(EntityManager.COMPONENT_REMOVE, entity, Component);\n\n  // Check each indexed group to see if we need to remove it\n  for (var groupName in this._groups) {\n    var group = this._groups[groupName];\n\n    if (!~group.Components.indexOf(Component))\n      continue;\n    if (!entity.hasAllComponents(group.Components))\n      continue;\n\n    var loc = group.entities.indexOf(entity);\n    if (~loc) {\n      group.entities.splice(loc, 1);\n    }\n  }\n\n  // Remove T listing on entity and property ref, then free the component.\n  var propName = componentPropertyName(Component);\n  entity._Components.splice(index, 1);\n  var component = entity[propName];\n  delete entity[propName];\n  this._componentPools[propName].release(component);\n};\n\n/**\n * @param {Array.<Function>} Components\n * @return {Array.<Entity>}\n */\nEntityManager.prototype.queryComponents = function(Components)\n{\n  var group = this._groups[groupKey(Components)];\n\n  if (!group) {\n    group = this._indexGroup(Components);\n  }\n\n  return group.entities;\n};\n\n/**\n * @param {String} tag\n * @return {Array.<Entity>}\n */\nEntityManager.prototype.queryTag = function(tag)\n{\n  var entities = this._tags[tag];\n\n  if (entities === undefined)\n    entities = this._tags[tag] = [];\n\n  return entities;\n};\n\n/**\n * @return {Number} Total number of entities.\n */\nEntityManager.prototype.count = function()\n{\n  return this._entities.length;\n};\n\n/**\n * Get information about the object pools of the entities and the various\n * components.\n * @return {Object}\n */\nEntityManager.prototype.poolStats = function()\n{\n  var stats = {};\n  var e = this._entityPool;\n  stats.entity = {\n    used: this._entityPool.totalUsed(),\n    size: this._entityPool.count\n  };\n\n  for (var cName in this._componentPools) {\n    var pool = this._componentPools[cName];\n    stats[cName] = {\n      used: pool.totalUsed(),\n      size: pool.count\n    };\n  }\n\n  return stats;\n};\n\n/**\n * Create an index of entities with a set of components.\n * @param {Array.<Function>} Components\n * @private\n */\nEntityManager.prototype._indexGroup = function(Components)\n{\n  var key = groupKey(Components);\n\n  if (this._groups[key]) return;\n\n  var group = this._groups[key] = new Group(Components);\n\n  for (var n = 0; n < this._entities.length; n++) {\n    var entity = this._entities[n];\n    if (entity.hasAllComponents(Components)) {\n      group.entities.push(entity);\n    }\n  }\n\n  return group;\n};\n\n/**\n * Trigger the messanger if we have one.\n * @param {String} event\n * @param {Object=} a\n * @param {Object=} b\n */\nEntityManager.prototype._trigger = function(event, a, b)\n{\n  if (this.messanger)\n    this.messanger.trigger(event, a, b);\n};\n\n/**\n * @param {Function} Component\n * @return {String}\n * @private\n */\nfunction componentPropertyName(Component)\n{\n  var name = getName(Component);\n  return name.charAt(0).toLowerCase() + name.slice(1);\n}\n\n/**\n * @param {Array.<Function>} Components\n * @return {String}\n * @private\n */\nfunction groupKey(Components)\n{\n  var names = [];\n  for (var n = 0; n < Components.length; n++) {\n    var T = Components[n];\n    names.push(getName(T));\n  }\n\n  return names\n    .map(function(x) { return x.toLowerCase(); })\n    .sort()\n    .join('-');\n}\n\n","module.exports = QuadTree;\n\nvar ObjectPool = require('./ObjectPool.js');\nvar Spatial    = require('./Spatial.js');\nvar Vec2       = require('./Vec2.js');\n\n/**\n * Effectively store positional and sized objects. Each tree has a position and\n * size, as well as up to 4 child nodes (other trees) and an array of entries.\n * @constructor\n */\nfunction QuadTree()\n{\n  this.level       = 0;\n  this.position    = new Vec2();\n  this.size        = new Vec2();\n  this.maxEntities = 15;\n  this.maxLevels   = 10;\n\n  /**\n   * Pool that is used for all internal quad trees. Only root node has one, all\n   * others have a refence.\n   */\n  this.pool = new ObjectPool(QuadTree);\n\n  /**\n   * @type {Array.<QuadTree>}\n   */\n  this.nodes = [];\n\n  /**\n   * @type {Array.<{spatial: Spatial}>}\n   */\n  this.entities = [];\n}\n\n/**\n * Reset for pool.\n * @private\n */\nQuadTree.prototype.__init = function()\n{\n  this.level = 0;\n  this.position.clear();\n  this.size.clear();\n  this.nodes.length = 0;\n  this.entities.length = 0;\n\n  // Only root node has actual ref to pool\n  this.pool = null;\n};\n\n/**\n * Add an entity to the tree\n * @param {{spatial: Spatial}} entity\n */\nQuadTree.prototype.insert = function(entity)\n{\n  // Recurse if we can\n  if (this.nodes.length) {\n    var index = this._getIndex(entity.spatial.absPosition(),\n      entity.spatial.absHwidth());\n    if (~index) return this.nodes[index].insert(entity);\n  }\n\n  // Actually add the entity\n  this.entities.push(entity);\n  this._splitAndRedistributeIfNeeded();\n  entity.spatial._node = this;\n  return entity;\n};\n\n/**\n * Remove an entity from this tree.\n * @param {{spatial: Spatial}} param\n */\nQuadTree.prototype.remove = function(entity)\n{\n  // Remove if we can\n  var n = this.entities.indexOf(entity);\n  if (~n) {\n    this.entities.splice(n, 1);\n    entity.spatial._node = null;\n    if (!this.totalSize())\n      this.clear();\n    return;\n  }\n\n  // Recuse if we can\n  if (this.nodes.length) {\n    var index = this._getIndex(entity.spatial.absPosition(),\n      entity.spatial.absHwidth());\n    if (~index) return this.nodes[index].remove(entity);\n  }\n};\n\n/**\n * Total recursive size of this tree.\n * @return {Number}\n */\nQuadTree.prototype.totalSize = function()\n{\n  var size = this.entities.length;\n\n  for (var n = 0; n < this.nodes.length; n++) {\n    var node = this.nodes[n];\n    size += node.totalSize();\n  }\n\n  return size;\n};\n\n/**\n * Empty the tree recursively.\n */\nQuadTree.prototype.clear = function()\n{\n  // Clear entity area\n  for (var m = 0; m < this.entities.length; m++) {\n    var entity = this.entities[m];\n    entity.spatial._node = null;\n  }\n  this.entities.length = 0;\n\n  // Recurse, free the node, and wipe out our node length\n  for (var n = 0; n < this.nodes.length; n++) {\n    var node = this.nodes[n];\n    node.clear();\n    this.pool.release(node);\n  }\n  this.nodes.length = 0;\n};\n\n/**\n * Get all tree entries that are interesected by a rectangle defined with\n * position and hwidth.\n * @param {Vec2} position\n * @param {Vec2} hwidth\n * @param {Array.<{spatial: Spatial}>=} out__objects Return objects.\n * @return {Array.<{spatial: Spatial}>} The out__objects parameter (filled up now)\n */\nQuadTree.prototype.queryArea = function(position, hwidth, out__entities)\n{\n  var entities = out__entities || [];\n\n  // If query belongs in ONLY a single node, then recurse\n  var index = this._getIndex(position, hwidth);\n  if (~index && this.nodes.length) {\n    this.nodes[index].queryArea(position, hwidth, entities);\n\n  // Otherwise, we have to add ALL of the nodes as it may be overlapping one\n  } else {\n    for (var j = 0; j < this.nodes.length; j++) {\n      var node = this.nodes[j];\n      node.queryArea(position, hwidth, entities);\n    }\n  }\n\n  // Also add everything from this node itself\n  for (var m = 0; m < this.entities.length; m++) {\n    var entity = this.entities[m];\n\n    var overlapping = Vec2.rectIntersect(\n      entity.spatial.absPosition(),\n      entity.spatial.absHwidth(),\n      position,\n      hwidth);\n\n    if (overlapping) {\n      entities.push(entity);\n    }\n  }\n\n  return entities;\n};\n\n/**\n * Do a complete reset of the tree.\n */\nQuadTree.prototype.reIndex = function()\n{\n  this._combine();\n  this._splitAndRedistributeIfNeeded();\n};\n\nvar tSize = new Vec2();\nvar tPos  = new Vec2();\n\n/**\n * Check to see if an entity is still valid.\n * @param {{spatial: Spatial}} entity\n * @return {Boolean} True if the entity is in this tree (non-recursive) in its\n * correct place. False implies we need to re-add it.\n */\nQuadTree.prototype.validateEntity = function(entity)\n{\n  var pos = entity.spatial.position;\n  var hw  = entity.spatial.hwidth;\n\n  // Check to see if we're still inside this node\n  tSize.assign(this.size).smult(0.5);\n  tPos.assign(tSize).add(this.position);\n  var inside = Vec2.rectContains(pos, hw, tPos, tSize);\n\n  if (!inside) return false;\n\n  // No children nodes, then we're good\n  if (!this.nodes.length)\n    return true;\n\n  // Or if children nodes and we overlap, still good\n  var index = this._getIndex(entity.spatial.absPosition(),\n    entity.spatial.absHwidth());\n  if (this.nodes.length && !~index)\n    return true;\n\n  // Didnt make it\n  return false;\n};\n\n/**\n * Return which of the 4 quandrants of this tree an object would go into.\n * @param {Vec2} position\n * @param {Vec2} hwidth\n * @return {Number} Which quandrant, or -1 if won't fit.\n * @private\n */\nQuadTree.prototype._getIndex = function(position, hwidth)\n{\n  var midX = this.position.x + this.size.x / 2;\n  var midY = this.position.y + this.size.y / 2;\n\n  var left   = position.x - hwidth.x < midX && position.x + hwidth.x < midX;\n  var right  = position.x - hwidth.x > midX && position.x + hwidth.x > midX;\n  var top    = position.y - hwidth.y < midY && position.y + hwidth.y < midY;\n  var bottom = position.y - hwidth.y > midY && position.y + hwidth.y > midY;\n\n  if (top && right) return 0;\n  if (top && left) return 1;\n  if (bottom && left) return 2;\n  if (bottom && right) return 3;\n\n  return -1;\n};\n\n/**\n * If we've overpacked this tree, then split into 4 smaller trees (if we\n * haven't already) and redistribute.\n * @private\n */\nQuadTree.prototype._splitAndRedistributeIfNeeded = function()\n{\n  if (this.entities.length > this.maxEntities &&\n    this.level < this.maxLevels)\n  {\n    this._split();\n    this._redistribute();\n  }\n};\n\n/**\n * Create a sub quad tree\n * @return {QuadTree}\n * @private\n */\nQuadTree.prototype._factory = function()\n{\n  var node = this.pool.aquire();\n\n  node.pool        = this.pool;\n  node.level       = this.level + 1;\n  node.maxEntities = this.maxEntities;\n  node.maxLevels   = this.maxLevels;\n\n  return node;\n};\n\n/**\n * Create 4 sub nodes for the tree (does not populate tho)\n * @private\n */\nQuadTree.prototype._split = function()\n{\n  if (this.nodes.length) return;\n\n  var x = this.position.x;\n  var y = this.position.y;\n\n  var w = this.size.x / 2;\n  var h = this.size.y / 2;\n\n  // Create the seperate nodes\n  for (var n = 0; n < 4; n++) {\n    var node = this._factory();\n    node.size.set(w, h);\n\n    switch(n) {\n      case 0:\n        node.position.set(x + w, y);\n        break;\n      case 1:\n        node.position.set(x, y);\n        break;\n      case 2:\n        node.position.set(x, y + h);\n        break;\n      case 3:\n        node.position.set(x + w, y + h);\n        break;\n    }\n\n    this.nodes.push(node);\n  }\n};\n\n/**\n * Distrubute all entities into child nodes if we can.\n * @private\n */\nQuadTree.prototype._redistribute = function()\n{\n  // Loop through all of our entries and if they can fit into a child node,\n  // move them there\n  var i = 0;\n  while (i < this.entities.length) {\n    var entity = this.entities[i];\n    var index = this._getIndex(entity.spatial.absPosition(),\n      entity.spatial.absHwidth());\n\n    // Insert into child, remove from our array if they belong in another node\n    if (~index) {\n      this.nodes[index].insert(entity);\n      this.entities.splice(i, 1);\n    } else {\n      i++;\n    }\n  }\n};\n\n/**\n * Unwinds this node. Move all child nodes into this node and remove child\n * nodes.\n * @private\n */\nQuadTree.prototype._combine = function()\n{\n  for (var n = 0; n < this.nodes.length; n++) {\n    var node = this.nodes[n];\n\n    // Combine all children first\n    node._combine();\n\n    // All entries combined on node, now add it to US\n    for (var m = 0; m < node.entities.length; m++) {\n      var entity = node.entities[m];\n      this.entities.push(entity);\n    }\n\n    // Clear out and ensure we release it\n    node.entities.length = 0;\n    node.clear();\n    this.pool.release(node);\n  }\n\n  // Clear nodes array\n  this.nodes.length = 0;\n};\n\n","module.exports = ObjectPool;\n\n/**\n * Minimize garbage collector thrashing by re-using existing objects instead of\n * creating new ones. Requires manually lifecycle management.\n * @constructor\n * @param {Function} T\n */\nfunction ObjectPool(T)\n{\n  this.freeList = [];\n  this.count    = 0;\n  this.T        = T;\n}\n\n/**\n * Get a pooled object\n */\nObjectPool.prototype.aquire = function()\n{\n  // Grow the list by 20%ish if we're out\n  if (this.freeList.length <= 0) {\n    this.expand(Math.round(this.count*0.2) + 1);\n  }\n\n  var item = this.freeList.pop();\n\n  // We can provide explicit initing, otherwise re-call constructor (hackish)\n  if (item.__init)\n    item.__init();\n  else\n    this.T.call(item);\n\n  return item;\n};\n\n/**\n * Return an object back to the pool.\n */\nObjectPool.prototype.release = function(item)\n{\n  this.freeList.push(item);\n};\n\n/**\n * @param {Number} Amount of new objects to allocate for this pool.\n */\nObjectPool.prototype.expand = function(count)\n{\n  for (var n = 0; n < count; n++)\n    this.freeList.push(new this.T());\n  this.count += count;\n};\n\n/**\n * @return {Number} Total amount of allocated objects (available and in-use).\n */\nObjectPool.prototype.totalSize = function()\n{\n  return this.count;\n};\n\n/**\n * @return {Number} Total number of objects currently available.\n */\nObjectPool.prototype.totalFree = function()\n{\n  return this.freeList.length;\n};\n\n/**\n * @return {Number} Total number of objects currently in-use.\n */\nObjectPool.prototype.totalUsed = function()\n{\n  return this.count - this.freeList.length;\n};\n\n","module.exports = Vec2;\n\nvar ObjectPool = require('./ObjectPool.js');\n\n/**\n * 2-dimension Cartesian vector with built-in (optional) object pool.\n * @constructor\n * @param {Number} x\n * @param {Number} y\n */\nfunction Vec2(x, y)\n{\n  this.x = +x || 0.0;\n  this.y = +y || 0.0;\n}\n\n/**\n * Reset for pool.\n * @private\n */\nVec2.prototype.__init = function()\n{\n  this.clear();\n};\n\n// Interal static object pool\nvar pool = new ObjectPool(Vec2);\n\n/**\n * Get a vector from the pool.\n * @return {Vec2}\n */\nVec2.aquire = function()\n{\n  return pool.aquire();\n};\n\n/**\n * Return a vector to the pool.\n * @param {Vec2} v\n * @return {Number}\n */\nVec2.release = function(v)\n{\n  if (v) pool.release(v);\n  return pool.count - pool.freeList.length;\n};\n\n/**\n * Reset this vector to (0,0).\n * @return {Vec2} This vector.\n */\nVec2.prototype.clear = function()\n{\n  this.x = this.y = 0.0;\n  return this;\n};\n\n/**\n * Assign this vector the value of another.\n * @param {Vec2} v\n * @return {Vec2} This vector.\n */\nVec2.prototype.assign = function(v)\n{\n  this.x = v.x;\n  this.y = v.y;\n  return this;\n};\n\n/**\n * Determine if this vector is equal to another.\n * @param {Vec2} v\n * @return {Boolean} True if vectors are equal.\n */\nVec2.prototype.equals = function(v)\n{\n  return this.x === v.x && this.y === v.y;\n};\n\n/**\n * Set this vector to a set of coordinates.\n * @param {Number} x\n * @param {Number} y\n * @return {Vec2} This vector.\n */\nVec2.prototype.set = function(x, y)\n{\n  this.x = +x;\n  this.y = +y;\n  return this;\n};\n\n/**\n * Limit this vector to a specific magnitude.\n * @param {Number} size\n * @return {Vec2} This vector.\n */\nVec2.prototype.limit = function(size)\n{\n  size = +size;\n  if (!size)\n    return this;\n  else if (this.magnitude() > size)\n    return this.normalize(size);\n  else\n    return this;\n};\n\n/**\n * Normalize this vector.\n * @param {Number=} m Length.\n * @return {Vec2} This vector.\n */\nVec2.prototype.normalize = function(m)\n{\n  m = m || +1.0;\n  var length = Math.sqrt(this.x * this.x + this.y * this.y);\n  this.x = m * this.x / length;\n  this.y = m * this.y / length;\n  return this;\n};\n\n/**\n * Subtract some vector from this one.\n * @param {Vec2} v\n * @return {Vec2} This vector.\n */\nVec2.prototype.sub = function(v)\n{\n  this.x -= v.x;\n  this.y -= v.y;\n  return this;\n};\n\n/**\n * Add some vector to this one.\n * @param {Vec2} v\n * @return {Vec2} This vector.\n */\nVec2.prototype.add = function(v)\n{\n  this.x += v.x;\n  this.y += v.y;\n  return this;\n};\n\n/**\n * Scalar multiply this vector by a value.\n * @param {Number} n\n * @return {Vec2} This vector.\n */\nVec2.prototype.smult = function(n)\n{\n  n = +n;\n  this.x *= n;\n  this.y *= n;\n  return this;\n};\n\n/**\n * Rotate this vector clockwise about the origin by a certain angle.\n * @param {Number} theta\n * @return {Vec2} This vector.\n */\nVec2.prototype.rotate = function(theta)\n{\n  return this.set(\n    this.x * Math.cos(theta) - this.y * Math.sin(theta),\n    this.x * Math.sin(theta) + this.y * Math.cos(theta)\n  );\n};\n\n/**\n * Get the dot product of this vector and another.\n * @param {Vec2} v\n * @return {Number}\n */\nVec2.prototype.dot = function(v)\n{\n  return +(this.x * v.x + this.y * v.y);\n};\n\n/**\n * Get the determinate of this vector and another.\n * @param {Vec2} v\n * @return {Number}\n */\nVec2.prototype.det = function(v)\n{\n  return +(this.x * v.y - this.y * v.x);\n};\n\n/**\n * Get the magnitude of this vector.\n * @return {Number}\n */\nVec2.prototype.magnitude = function()\n{\n  return Math.sqrt(this.x * this.x + this.y * this.y);\n};\n\n/**\n * Get the squared magnitude of this vector.\n * @return {Number}\n */\nVec2.prototype.magnitude2 = function()\n{\n  return this.x * this.x + this.y * this.y;\n};\n\n/**\n * Get the angle of this vector.\n * @return {Number}\n */\nVec2.prototype.angle = function()\n{\n  return Math.atan2(this.y, this.x);\n};\n\n/**\n * Get the angle between this vector and another.\n * @param {Vec2} v\n * @return {Number}\n */\nVec2.prototype.angleBetween = function(v)\n{\n  return Math.atan2(this.det(v), this.dot(v));\n};\n\n/**\n * Make a pooled copy of this vector\n * @return {Vec2} A new vector.\n */\nVec2.prototype.pcopy = function()\n{\n  return Vec2.aquire().assign(this);\n};\n\n/**\n * Make a copy of this vector.\n * @return {Vec2} A new vector.\n */\nVec2.prototype.copy = function()\n{\n  return new Vec2().assign(this);\n};\n\n/**\n * Create a vector with a specific angle and magnitude.\n * @param {Number} theta\n * @param {Number=} m\n * @return {Vec2} A new vector.\n */\nVec2.fromAngle = function(theta, m)\n{\n  m = +m || 1.0;\n  return new Vec2(Math.cos(theta) * m, Math.sin(theta) * m);\n};\n\n/**\n * Create a pooled vector with a specific angle and magnitude.\n * @param {Number} theta\n * @param {Number} m\n * @return {Vec2} A new vector.\n */\nVec2.pfromAngle = function(theta, m)\n{\n  m = +m || 1.0;\n  return Vec2.aquire().set(\n    Math.cos(theta) * m,\n    Math.sin(theta) * m\n  );\n};\n\n/**\n * Determine if two rectangles, defined by a position and a halfwidth vector,\n * overlap.\n * @param {Vec2} p1 Position of rectangle 1\n * @param {Vec2} r1 Halfwidths of rectangle 1\n * @param {Vec2} p2 Position of rectangle 2\n * @param {Vec2} r2 Halfwidths of rectangle 2\n * @return {Boolean} True if they intersect\n */\nVec2.rectIntersect = function(p1, r1, p2, r2)\n{\n  // Basically, rectangles dont intersect if one's bottom is higher than ones\n  // top, ones left is more left than ones right, etc\n  var a = p1.x + r1.x < p2.x - r2.x;\n  var b = p1.x - r1.x > p2.x + r2.x;\n  var c = p1.y + r1.y < p2.y - r2.y;\n  var d = p1.y - r1.y > p2.y + r2.y;\n\n  // We want if they do\n  return !(a || b || c || d);\n};\n\n/**\n * Determines if rectangle 1 is entirely inside of rectangle 2.\n * @param {Vec2} p1 Position of rectangle 1\n * @param {Vec2} r1 Halfwidths of rectangle 1\n * @param {Vec2} p2 Position of rectangle 2\n * @param {Vec2} r2 Halfwidths of rectangle 2\n * @return {Boolean} True if they rectangle 1 is inside of rectangle 2\n */\nVec2.rectContains = function(p1, r1, p2, r2)\n{\n  if (p1.x - r1.x < p2.x - r2.x) return false;\n  if (p1.x + r1.x > p2.x + r2.x) return false;\n  if (p1.y - r1.y < p2.y - r2.y) return false;\n  if (p1.y + r1.y > p2.y + r2.y) return false;\n\n  return true;\n};\n\n/**\n * Convert a rectangle specified by top-left point + size into center location\n * + halfwidths.\n * @param {Vec2} position\n * @param {Vec2} size\n * @param {Vec2} out__position Output position\n * @param {Vec2} out__hwidth Output hwidths\n */\nVec2.sizeToHwidth = function(position, size, out__position, out__hwidth)\n{\n  out__hwidth.assign(size).smult(0.5);\n  out__position.assign(position).add(out__hwidth);\n};\n\n/**\n * Output this vector.\n */\nVec2.prototype.toString = function()\n{\n  return '' + (this.x.toFixed(2)) + ',' + (this.y.toFixed(2));\n};\n\n","module.exports = Spatial;\n\nvar Vec2 = require('./Vec2.js');\n\n/**\n * Basic component giving an entity the concept of being located somewhere.\n * Creates basic spatial heirachy, positions, rotation, etc.\n * @constructor\n */\nfunction Spatial()\n{\n  // Alloc our types\n  this.position     = new Vec2();\n  this.scale        = new Vec2();\n  this.hwidth       = new Vec2();\n\n  this._absScale    = new Vec2();\n  this._absPosition = new Vec2();\n  this._absHwidth   = new Vec2();\n\n  // Setup\n  this.__init();\n}\n\n/**\n * Setup called by pool.\n * @private\n */\nSpatial.prototype.__init = function()\n{\n  this.rotation = 0;\n\n  // Ref to quad tree node this component is in\n  this._node = null;\n\n  // Parent component\n  this.parent = null;\n\n  this.position.clear();\n  this.scale.set(1, 1);\n  this.hwidth.clear();\n  this._absPosition.clear();\n  this._absScale.set(1, 1);\n  this._absHwidth.clear();\n};\n\n/**\n * Fired when spatials overlap.\n * @event\n */\nSpatial.COINCIDENT = 'Spatial#COINCIDENT';\n\n/**\n * Attach this component to another entity's Spatial.\n * @param {{spatial: Spatial}} entity An entity with a Spatial component\n */\nSpatial.prototype.attachTo = function(entity)\n{\n  if (this.parent)\n    throw new Error ('Entity already attached');\n\n  if (!entity || !entity.spatial)\n    throw new Error('Invalid / missing entity');\n\n  this.parent = entity.spatial;\n};\n\n/**\n * The absolute world position of this component.\n * @return {Vec2}\n */\nSpatial.prototype.absPosition = function()\n{\n  var v = this._absPosition.assign(this.position);\n\n  // Trivial case, no parent\n  if (!this.parent) {\n    return v;\n  }\n\n  var parent = this.parent;\n\n  // Rotate our angle by parent's angle\n  var r = this.absRotation();\n  v.rotate(parent.absRotation());\n\n  // Scale by parents scale\n  var pScale = parent.absScale();\n  v.set(v.x * pScale.x, v.y * pScale.y);\n\n  // Add parent's position\n  return v.add(parent.absPosition());\n};\n\n/**\n * The absolute world rotation of this component.\n * @return {Number}\n */\nSpatial.prototype.absRotation = function()\n{\n  // Trivial case\n  if (!this.parent)\n    return this.rotation;\n\n  // This + parent\n  var r = this.rotation + this.parent.absRotation();\n\n  return r % (Math.PI*2);\n};\n\n/**\n * The absolute world hwidth for this component.\n * @return {Vec2}\n */\nSpatial.prototype.absHwidth = function()\n{\n  var h = this._absHwidth.assign(this.hwidth);\n\n  if (!this.parent)\n    return h;\n\n  var scale = this.absScale();\n\n  return h.set(h.x * scale.x, h.y * scale.y);\n};\n\n/**\n * The absolute world scale of this component.\n * @return {Vec2}\n */\nSpatial.prototype.absScale = function()\n{\n  var v = this._absScale.assign(this.scale);\n\n  // Trivial case\n  if (!this.parent) {\n    return v;\n  }\n\n  var pScale = this.parent.absScale();\n\n  return v.set(v.x * pScale.x, v.y * pScale.y);\n};\n\n","module.exports = Event;\n\n/**\n * @constructor\n */\nfunction Event(name, callback)\n{\n  this._name     = name || 'name';\n  this._callback = callback || null;\n\n  // Additional filters\n  this._Components = [];\n}\n\n/**\n * @param {String} eventName\n * @param {{hasAllComponents:Function}} entity\n * @param {Object=} option\n * @return {Boolean} True if fired.\n */\nEvent.prototype.fire = function(eventName, entity, option)\n{\n  // Name check\n  if (eventName !== this._name)\n    return false;\n\n  // Component filters\n  var Comps = this._Components;\n  if (entity && entity.hasAllComponents && Comps.length) {\n    if (!entity || !entity.hasAllComponents(Comps))\n      return false;\n  }\n\n  // Made it\n  this._callback(entity, option);\n  return true;\n};\n\n/**\n * @param {Function} T\n * @return {Event} This object.\n */\nEvent.prototype.whereComponent = function(T)\n{\n  this._Components.push(T);\n};\n\n/**\n * @param {Array.<Function>} Components\n * @return {Event} This object.\n */\nEvent.prototype.whereComponents = function(Components)\n{\n  this._Components = this._Components.concat(Components);\n  return this;\n};\n\n","module.exports = {\n\n  'extends'      : require('./lib/extends.js'),\n  'mixin'        : require('./lib/mixin.js'),\n  'getArguments' : require('./lib/getArguments.js'),\n  'getName'      : require('./lib/getName.js')\n\n};\n\n\n","module.exports = extends_;\n\n/**\n * The well documented, oft-used (Coffeescript, Typescript, ES6... etc) extends\n * pattern to get some sort of single-inheritance in Javascript.  Modify a\n * Child class to have inherited the static members via copying and link the\n * prototypes.\n * @param {Function} Child Child constructor function.\n * @param {Function} Parent Parent contrusctor function.\n * @return {Function} The Child constructor.\n */\nfunction extends_(Child, Parent)\n{\n  // Drop in statics\n  for (var key in Parent) {\n    if (!Child.hasOwnProperty(key) && Parent.hasOwnProperty(key)) {\n      Child[key] = Parent[key];\n    }\n  }\n\n  // Give static to access parent\n  Child.Super = Parent;\n\n  // Child's prototype property is an object with the parent's prototype\n  // property its [[prototype]] + constructor\n  if (Object.create instanceof Function) {\n    Child.prototype = Object.create(Parent.prototype, {\n      constructor: { value: Child }\n    });\n  } else {\n    // IE8 and below shim\n    var T = makeT(Child);\n    T.prototype = Parent.prototype;\n    Child.prototype = new T();\n  }\n\n  return Child;\n}\n\n/**\n * @param {Function} Child\n * @return {Function}\n */\nfunction makeT(Child)\n{\n  return function T() { this.constructor = Child; };\n}\n\n","module.exports = getName;\n\nvar FUNCTION_NAME = /function\\s+([^\\s(]+)/;\n\n/**\n * Get the name of a function (e.g. constructor)\n * @param {Function} f\n * @return {String} The function name.\n */\nfunction getName(f)\n{\n  var name = '';\n\n  if (f instanceof Function) {\n    if (f.name) {\n      return f.name;\n    }\n\n    var match = f.toString().match(FUNCTION_NAME);\n\n    if (match) {\n      name = match[1];\n    }\n  } else if (f && f.constructor instanceof Function) {\n    name = getName(f.constructor);\n  }\n\n  return name;\n}\n","module.exports = getArguments;\n\nvar FUNCTION_ARGS = /^\\w*function[^\\(]*\\(([^\\)]+)/;\n\n/**\n * Get the parameter names of a function.\n * @param {Function} f A function.\n * @return {Array.<String>} An array of the argument names of a function.\n */\nfunction getArguments(f)\n{\n  var ret = [];\n  var args = f.toString().match(FUNCTION_ARGS);\n\n  if (args) {\n    args = args[1]\n      .replace(/[ ]*,[ ]*/, ',')\n      .split(',');\n    for (var n = 0; n < args.length; n++) {\n      var a = args[n].replace(/^\\s+|\\s+$/g, '');\n      if (a) ret.push(a);\n    }\n  }\n\n  return ret;\n}\n\n","module.exports = mixin_;\n\n/**\n * Add all own properties of mixin to the prototype property of class T\n * @param {Function} T Class we want to mix into.\n * @param {Function|Object} mixin Mixin we want to mixt\n */\nfunction mixin_(T, mixin)\n{\n  // If we're mixing in a class (constructor function), then first mix in all\n  // things hanging directly off the mixin as \"statics\", then switch the mixin\n  // ref to point to the prototype\n  if (mixin instanceof Function) {\n    for (var k in mixin) {\n      T[k] = mixin[k];\n    }\n    mixin = mixin.prototype;\n  }\n\n  // Dump everything on the mixin into the prototype of our class\n  for (var key in mixin) {\n    if (mixin.hasOwnProperty(key)) {\n      T.prototype[key] = mixin[key];\n    }\n  }\n}\n\n"]}