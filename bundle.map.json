{"version":3,"sources":["../../../../AppData/Roaming/npm/node_modules/browserify/node_modules/browser-pack/_prelude.js","main.js","RequestAnimationFrame.js","js/THREEx.KeyboardState.js","js/Game.js","js/Globals.js","js/EntityFactory.js","js/MouseController.js","js/PointerLockControls.js","js/ResourceManager.js","js/Systems.js","node_modules/physijs-browserify/physi.js","node_modules/js-class/class.js","node_modules/stats.js/src/Stats.js","node_modules/three/three.js","js/Components.js","node_modules/tiny-ecs/index.js","js/components/Velocity.js","js/components/Position.js","js/components/Jump.js","js/components/Drawable.js","js/components/Expirable.js","js/components/CameraFollow.js","js/components/ShootDelay.js","js/components/OneTimeHit.js","js/components/Hurt.js","node_modules/tiny-ecs/lib/EntityManager.js","node_modules/tiny-ecs/lib/ObjectPool.js","node_modules/tiny-ecs/lib/QuadTree.js","node_modules/tiny-ecs/lib/Entity.js","node_modules/tiny-ecs/lib/Messanger.js","node_modules/tiny-ecs/lib/Spatial.js","node_modules/tiny-ecs/lib/Vec2.js","node_modules/tiny-ecs/lib/Event.js","node_modules/tiny-ecs/node_modules/typedef/index.js","node_modules/tiny-ecs/node_modules/typedef/lib/mixin.js","node_modules/tiny-ecs/node_modules/typedef/lib/extends.js","node_modules/tiny-ecs/node_modules/typedef/lib/getArguments.js","node_modules/tiny-ecs/node_modules/typedef/lib/getName.js"],"names":["init","Globals","hud","document","getElementById","score","gameOptions","container","loadingContainer","blocker","instructions","crosshair","modelsToPreload","game","Game","start","global","Class","require","THREE","THREEx","Physijs","Stats","scripts","worker","ammo","window","requestAnimationFrame","webkitRequestAnimationFrame","mozRequestAnimationFrame","oRequestAnimationFrame","msRequestAnimationFrame","callback","element","setTimeout","module","exports","KeyboardState","domElement","this","keyCodes","modifiers","_this","_onKeyDown","event","_onKeyChange","_onKeyUp","addEventListener","_onBlur","prop","prototype","destroy","removeEventListener","MODIFIERS","ALIAS","left","up","right","down","space","pageup","pagedown","tab","escape","keyCode","pressed","type","shiftKey","ctrlKey","altKey","metaKey","keyDesc","keys","split","i","length","key","indexOf","Object","toUpperCase","charCodeAt","eventMatches","aliases","aliasKeys","constructor","options","stats","prevTime","performance","now","renderer","scene","camera","paused","controlsEnabled","controls","systems","postPhysicsSystems","percentModelsLoaded","runImmediately","undefined","onResize","bind","onkeydown","onKeyDown","onMouseDown","onMouseUp","WebGLRenderer","antialias","setSize","innerWidth","innerHeight","setClearColor","appendChild","setMode","style","position","bottom","body","Scene","setGravity","Vector3","aspectRatio","PerspectiveCamera","add","PointerLockControls","getObject","clock","Clock","top","ambientLight","AmbientLight","dirLight","DirectionalLight","ground","BoxMesh","BoxGeometry","MeshBasicMaterial","color","_physijs","collision_type","EntityFactory","COLLISION_TYPES","obstacle","collision_masks","player","playerBullet","enemyBullet","instance","makePlayer","controlsObject","cameraOffset","makeEnemy","push","CameraRotationSystem","entities","PlayerInputSystem","MovementSystem","ExpirableSystem","CameraFollowSystem","ShootDelaySystem","HurtSystem","PhysicsUpdateSystem","loadModels","forEach","model","ResourceManager","loadModel","modelLoaded","percentPerModel","visibility","display","scrollTop","documentElement","initPointerLock","run","update","time","dt","system","simulate","MouseController","render","e","aspect","updateProjectionMatrix","which","KEY_CODES","button","isDown","wasPressed","havePointerLock","pointerlockchange","pointerLockElement","mozPointerLockElement","webkitPointerLockElement","enabled","pointerlockerror","requestPointerLock","mozRequestPointerLock","webkitRequestPointerLock","test","navigator","userAgent","fullscreenchange","fullscreenElement","mozFullscreenElement","mozFullScreenElement","requestFullscreen","mozRequestFullscreen","mozRequestFullScreen","webkitRequestFullscreen","innerHTML","statics",{"end":{"file":"?","comments_before":[],"nlb":false,"endpos":135,"endcol":16,"endline":8,"pos":127,"col":8,"line":8,"value":"instance","type":"name"},"start":{"file":"?","comments_before":[],"nlb":false,"endpos":135,"endcol":16,"endline":8,"pos":127,"col":8,"line":8,"value":"instance","type":"name"},"name":"instance"},"_instance","EntityManager","C","createEntity","addTag","addComponent","Position","Velocity","Jump","Drawable","CameraFollow","ShootDelay","drawable","mesh","createMaterial","entity","copy","enemy","setDamping","setAngularFactor","other_object","relative_velocity","relative_rotation","contact_normal","y","jump","canJump","x","z","cameraFollow","object","offset","shootDelay","delayTheshold","MeshPhongMaterial","makeBullet","bullet","Expirable","OneTimeHit","ConvexMesh","geometry","material","rotation","scale","oneTimeHit","alreadyHit","uuid","Hurt","hurt","originalColor","curScore","parseInt","vel","velocity","multiply","direction","applyCentralImpulse","expirable","maxAge","nothing","set","pitchObject","Object3D","yawObject","moveForward","moveBackward","moveLeft","moveRight","isOnObject","mass","moveSpeed","minimumY","onMouseMove","onKeyUp","movementX","mozMovementX","webkitMovementX","movementY","mozMovementY","webkitMovementY","Math","max","PI_2","min","bool","getDirection","Euler","v","applyEuler","translateX","translateY","translateZ","PI","Model","loadingManager","LoadingManager","jsonLoader","JSONLoader","textures","models","getTexture","path","ImageUtils","loadTexture","load","materials","MeshFaceMaterial","keyboard","jumped","players","queryTag","dv","MOVE_SPEED","canShoot","clone","rotationMatrix","applyMatrix4","moveables","queryComponents","hasComponent","expirables","age","remove","follows","Matrix4","extractRotation","matrix","shooters","timer","hurtables","invulnerabilityFrames","hurtColor","removeComponent","getLinearVelocity","SUPPORT_TRANSFERABLE","Eventable","getObjectId","getEulerXYZFromQuaternion","getQuatertionFromEuler","convertWorldPositionToObject","addObjectChildren","_temp1","_temp2","_is_simulating","_Physijs","_temp_vector3_1","_temp_vector3_2","_temp_matrix4_1","_quaternion_1","Quaternion","MESSAGE_TYPES","WORLDREPORT","COLLISIONREPORT","VEHICLEREPORT","CONSTRAINTREPORT","REPORT_ITEMSIZE","COLLISIONREPORT_ITEMSIZE","VEHICLEREPORT_ITEMSIZE","CONSTRAINTREPORT_ITEMSIZE","_eventListeners","event_name","hasOwnProperty","index","splice","dispatchEvent","parameters","Array","call","arguments","apply","make","obj","_id","w","atan2","asin","c1","s1","c2","s2","c3","s3","c1c2","s1s2","cos","sin","identity","makeRotationFromQuaternion","quaternion","getInverse","sub","noConflict","friction","restitution","physijs_material","id","PointConstraint","objecta","objectb","appliedImpulse","positiona","positionb","getDefinition","HingeConstraint","axis","parent","setLimits","low","high","bias_factor","relaxation_factor","execute","constraint","enableAngularMotor","acceleration","disableMotor","SliderConstraint","lin_lower","lin_upper","ang_lower","ang_upper","setRestitution","linear","angular","enableLinearMotor","disableLinearMotor","disableAngularMotor","ConeTwistConstraint","axisa","axisb","setLimit","enableMotor","setMaxMotorImpulse","max_impulse","setMotorTarget","target","setFromEuler","setFromRotationMatrix","DOFConstraint","setLinearLowerLimit","limit","setLinearUpperLimit","setAngularLowerLimit","setAngularUpperLimit","configureAngularMotor","low_angle","high_angle","max_force","params","self","_worker","Worker","transferableMessage","webkitPostMessage","postMessage","_materials_ref_counts","_objects","_vehicles","_constraints","ab","ArrayBuffer","byteLength","onerror","console","log","message","filename","lineno","onmessage","_temp","data","Float32Array","_updateScene","_updateCollisions","_updateVehicles","_updateConstraints","cmd","debug","dir","fixedTimeStep","rateLimit","num_objects","__dirtyPosition","__dirtyRotation","linearVelocity","angularVelocity","buffer","vehicle","wheel","wheels","addVectors","j","object2","id1","id2","collisions","normal_offsets","touches","subVectors","getAngularVelocity","normal_offset","addConstraint","show_marker","marker","Mesh","SphereGeometry","MeshNormalMaterial","onSimulationResume","removeConstraint","children","updateMatrix","updateMatrixWorld","setFromMatrixPosition","matrixWorld","position_offset","world","Vehicle","materialId","width","height","depth","pop","setFixedTimeStep","gravity","timeStep","maxSubSteps","object_id","pos","quat","boundingBox","computeBoundingBox","__defineGetter__","__defineSetter__","force","applyImpulse","impulse_x","impulse_y","impulse_z","applyTorque","torque_x","torque_y","torque_z","applyCentralForce","applyForce","force_x","force_y","force_z","setAngularVelocity","setLinearVelocity","factor","setLinearFactor","setCcdMotionThreshold","threshold","setCcdSweptSphereRadius","radius","PlaneMesh","normal","faces","HeightfieldMesh","xdiv","ydiv","xsize","ysize","xpts","sqrt","vertices","ypts","absMaxHeight","abs","a","b","points","round","SphereMesh","boundingSphere","computeBoundingSphere","pow","CylinderMesh","CapsuleMesh","ConeMesh","ConcaveMesh","face","triangles","Face3","c","Face4","d","tuning","VehicleTuning","rigidBody","suspension_stiffness","suspension_compression","suspension_damping","max_suspension_travel","friction_slip","max_suspension_force","addWheel","wheel_geometry","wheel_material","connection_point","wheel_direction","wheel_axle","suspension_rest_length","wheel_radius","is_front_wheel","castShadow","receiveShadow","multiplyScalar","setSteering","amount","steering","setBrake","brake","applyEngineForce","inherit","dest","src","noParent","getOwnPropertyNames","name","desc","getOwnPropertyDescriptor","defineProperty","__proto__","findType","meta","implType","implMeta","proto","base","implements","classProto","isArray","implementedType","extend","theClass","value","enumerable","configurable","writable","Checker","typeOf","typeInfo","an","is","VERSION","startTime","Date","ms","msMin","Infinity","msMax","fps","fpsMin","fpsMax","frames","mode","createElement","preventDefault","cssText","fpsDiv","fpsText","fpsGraph","bar","msDiv","msText","msGraph","updateGraph","dom","child","firstChild","REVISION","begin","end","textContent","sign","warn","error","MOUSE","LEFT","MIDDLE","RIGHT","CullFaceNone","CullFaceBack","CullFaceFront","CullFaceFrontBack","FrontFaceDirectionCW","FrontFaceDirectionCCW","BasicShadowMap","PCFShadowMap","PCFSoftShadowMap","FrontSide","BackSide","DoubleSide","NoShading","FlatShading","SmoothShading","NoColors","FaceColors","VertexColors","NoBlending","NormalBlending","AdditiveBlending","SubtractiveBlending","MultiplyBlending","CustomBlending","AddEquation","SubtractEquation","ReverseSubtractEquation","MinEquation","MaxEquation","ZeroFactor","OneFactor","SrcColorFactor","OneMinusSrcColorFactor","SrcAlphaFactor","OneMinusSrcAlphaFactor","DstAlphaFactor","OneMinusDstAlphaFactor","DstColorFactor","OneMinusDstColorFactor","SrcAlphaSaturateFactor","MultiplyOperation","MixOperation","AddOperation","UVMapping","CubeReflectionMapping","CubeRefractionMapping","EquirectangularReflectionMapping","EquirectangularRefractionMapping","SphericalReflectionMapping","RepeatWrapping","ClampToEdgeWrapping","MirroredRepeatWrapping","NearestFilter","NearestMipMapNearestFilter","NearestMipMapLinearFilter","LinearFilter","LinearMipMapNearestFilter","LinearMipMapLinearFilter","UnsignedByteType","ByteType","ShortType","UnsignedShortType","IntType","UnsignedIntType","FloatType","HalfFloatType","UnsignedShort4444Type","UnsignedShort5551Type","UnsignedShort565Type","AlphaFormat","RGBFormat","RGBAFormat","LuminanceFormat","LuminanceAlphaFormat","RGBEFormat","RGB_S3TC_DXT1_Format","RGBA_S3TC_DXT1_Format","RGBA_S3TC_DXT3_Format","RGBA_S3TC_DXT5_Format","RGB_PVRTC_4BPPV1_Format","RGB_PVRTC_2BPPV1_Format","RGBA_PVRTC_4BPPV1_Format","RGBA_PVRTC_2BPPV1_Format","Projector","projectVector","vector","project","unprojectVector","unproject","pickingRay","CanvasRenderer","clear","Color","setRGB","r","g","setHex","setStyle","hex","floor","setHSL","h","s","l","hue2rgb","p","q","t","exec","ColorKeywords","copyGammaToLinear","gammaFactor","copyLinearToGamma","safeInverse","convertGammaToLinear","convertLinearToGamma","getHex","getHexString","toString","slice","getHSL","optionalTarget","hue","saturation","hsl","lightness","delta","getStyle","offsetHSL","addColors","color1","color2","addScalar","lerp","alpha","equals","fromArray","array","toArray","aliceblue","antiquewhite","aqua","aquamarine","azure","beige","bisque","black","blanchedalmond","blue","blueviolet","brown","burlywood","cadetblue","chartreuse","chocolate","coral","cornflowerblue","cornsilk","crimson","cyan","darkblue","darkcyan","darkgoldenrod","darkgray","darkgreen","darkgrey","darkkhaki","darkmagenta","darkolivegreen","darkorange","darkorchid","darkred","darksalmon","darkseagreen","darkslateblue","darkslategray","darkslategrey","darkturquoise","darkviolet","deeppink","deepskyblue","dimgray","dimgrey","dodgerblue","firebrick","floralwhite","forestgreen","fuchsia","gainsboro","ghostwhite","gold","goldenrod","gray","green","greenyellow","grey","honeydew","hotpink","indianred","indigo","ivory","khaki","lavender","lavenderblush","lawngreen","lemonchiffon","lightblue","lightcoral","lightcyan","lightgoldenrodyellow","lightgray","lightgreen","lightgrey","lightpink","lightsalmon","lightseagreen","lightskyblue","lightslategray","lightslategrey","lightsteelblue","lightyellow","lime","limegreen","linen","magenta","maroon","mediumaquamarine","mediumblue","mediumorchid","mediumpurple","mediumseagreen","mediumslateblue","mediumspringgreen","mediumturquoise","mediumvioletred","midnightblue","mintcream","mistyrose","moccasin","navajowhite","navy","oldlace","olive","olivedrab","orange","orangered","orchid","palegoldenrod","palegreen","paleturquoise","palevioletred","papayawhip","peachpuff","peru","pink","plum","powderblue","purple","red","rosybrown","royalblue","saddlebrown","salmon","sandybrown","seagreen","seashell","sienna","silver","skyblue","slateblue","slategray","slategrey","snow","springgreen","steelblue","tan","teal","thistle","tomato","turquoise","violet","wheat","white","whitesmoke","yellow","yellowgreen","_x","_y","_z","_w","onChangeCallback","euler","Error","order","setFromAxisAngle","angle","halfAngle","m","te","elements","m11","m12","m13","m21","m22","m23","m31","m32","m33","trace","setFromUnitVectors","v1","EPS","vFrom","vTo","dot","crossVectors","normalize","inverse","conjugate","lengthSq","multiplyQuaternions","qax","qay","qaz","qaw","qbx","qby","qbz","qbw","multiplyVector3","applyQuaternion","slerp","qb","cosHalfTheta","halfTheta","acos","sinHalfTheta","ratioA","ratioB","onChange","qa","qm","Vector2","setX","setY","setComponent","getComponent","subScalar","divide","divideScalar","scalar","invScalar","clamp","clampScalar","minVal","maxVal","ceil","roundToZero","negate","distanceTo","distanceToSquared","dx","dy","setLength","oldLength","lerpVectors","v2","fromAttribute","attribute","itemSize","setZ","multiplyVectors","applyAxisAngle","applyMatrix3","applyProjection","qx","qy","qz","qw","ix","iy","iz","iw","multiplyMatrices","projectionMatrix","transformDirection","lengthManhattan","cross","ax","ay","az","bx","by","bz","projectOnVector","projectOnPlane","planeNormal","reflect","angleTo","theta","dz","setEulerFromRotationMatrix","setEulerFromQuaternion","getPositionFromMatrix","getScaleFromMatrix","setFromMatrixScale","getColumnFromMatrix","setFromMatrixColumn","sx","sy","sz","me","Vector4","setW","setAxisAngleFromQuaternion","setAxisAngleFromRotationMatrix","epsilon","epsilon2","xx","yy","zz","xy","xz","yz","_order","DefaultOrder","RotationOrders","setFromQuaternion","setFromVector3","reorder","newOrder","toVector3","optionalResult","Line3","line","center","result","distanceSq","distance","at","closestPointToPointParameter","startP","startEnd","point","clampToLine","startEnd2","startEnd_startP","closestPointToPoint","Box2","setFromPoints","makeEmpty","il","expandByPoint","setFromCenterAndSize","size","halfSize","box","empty","expandByVector","expandByScalar","containsPoint","containsBox","getParameter","isIntersectionBox","clampPoint","distanceToPoint","clampedPoint","intersect","union","translate","Box3","setFromObject","scope","traverse","node","Geometry","BufferGeometry","attributes","positions","getBoundingSphere","Sphere","Matrix3","n11","n12","n13","n21","n22","n23","n31","n32","n33","multiplyVector3Array","applyToVector3Array","determinant","f","throwOnInvertible","det","msg","transpose","tmp","flattenToArrayOffset","getNormalMatrix","transposeIntoArray","n14","n24","n34","n41","n42","n43","n44","extractPosition","copyPosition","extractBasis","xAxis","yAxis","zAxis","makeBasis","scaleX","scaleY","scaleZ","makeRotationFromEuler","ae","af","be","bf","ce","cf","de","df","ac","ad","bc","bd","setRotationFromQuaternion","x2","y2","z2","wx","wy","wz","lookAt","eye","n","a11","a12","a13","a14","a21","a22","a23","a24","a31","a32","a33","a34","a41","a42","a43","a44","b11","b12","b13","b14","b21","b22","b23","b24","b31","b32","b33","b34","b41","b42","b43","b44","multiplyToArray","multiplyVector4","rotateAxis","crossVector","getPosition","setPosition","rotateX","rotateY","rotateZ","rotateByAxis","getMaxScaleOnAxis","scaleXSq","scaleYSq","scaleZSq","makeTranslation","makeRotationX","makeRotationY","makeRotationZ","makeRotationAxis","tx","ty","makeScale","compose","decompose","invSX","invSY","invSZ","makeFrustum","near","far","makePerspective","fov","ymax","degToRad","ymin","xmin","xmax","makeOrthographic","Ray","origin","ray","recast","directionDistance","distanceSqToSegment","segCenter","segDir","diff","v0","optionalPointOnRay","optionalPointOnSegment","s0","sqrDist","extDet","segExtent","a01","b0","b1","invDet","isIntersectionSphere","sphere","intersectSphere","tca","d2","radius2","thc","t0","t1","isIntersectionPlane","plane","distToPoint","denominator","distanceToPlane","constant","intersectPlane","intersectBox","tmin","tmax","tymin","tymax","tzmin","tzmax","invdirx","invdiry","invdirz","intersectTriangle","edge1","edge2","backfaceCulling","DdN","DdQxE2","DdE1xQ","QdN","matrix4","optionalCenter","maxRadiusSq","intersectsSphere","radiusSum","deltaLengthSq","getBoundingBox","Frustum","p0","p1","p2","p3","p4","p5","planes","Plane","frustum","setFromMatrix","me0","me1","me2","me3","me4","me5","me6","me7","me8","me9","me10","me11","me12","me13","me14","me15","setComponents","intersectsObject","negRadius","intersectsBox","d1","setFromNormalAndCoplanarPoint","setFromCoplanarPoints","inverseNormalLength","distanceToSphere","projectPoint","orthoPoint","perpendicularMagnitude","isIntersectionLine","startSign","endSign","intersectLine","coplanarPoint","m1","optionalNormalMatrix","normalMatrix","newNormal","newCoplanarPoint","generateUUID","chars","rnd","random","join","clampBottom","mapLinear","a1","a2","b2","smoothstep","smootherstep","random16","randInt","randFloat","randFloatSpread","range","degreeToRadiansFactor","degrees","radToDeg","radianToDegreesFactor","radians","isPowerOfTwo","nextPowerOfTwo","Spline","interpolate","t2","t3","intPoint","weight","w2","w3","pa","pb","pc","pd","v3","initFromArray","getPoint","k","getControlPointsArray","coords","getLength","nSubDivisions","nSamples","oldIntPoint","oldPosition","tmpVec","chunkLengths","totalLength","chunks","total","reparametrizeByArcLength","samplingCoef","indexCurrent","indexNext","realDistance","sampling","newpoints","sl","Triangle","resultLengthSq","barycoordFromPoint","dot00","dot01","dot02","dot11","dot12","denom","invDenom","u","setFromPointsAndIndices","i0","i1","i2","triangle","area","midpoint","autoStart","oldTime","elapsedTime","running","stop","getElapsedTime","getDelta","newTime","EventDispatcher","hasEventListener","listener","_listeners","listeners","listenerArray","Raycaster","Sprite","PointCloud","LOD","Line","descSort","intersectObject","raycaster","intersects","recursive","raycast","precision","linePrecision","setFromCamera","OrthographicCamera","sort","intersectObjects","objects","Object3DIdCount","DefaultUp","onRotationChange","onQuaternionChange","defineProperties","rotationAutoUpdate","matrixAutoUpdate","matrixWorldNeedsUpdate","visible","frustumCulled","renderOrder","userData","eulerOrder","useQuaternion","applyMatrix","setRotationFromAxisAngle","setRotationFromEuler","setRotationFromMatrix","rotateOnAxis","q1","translateOnAxis","localToWorld","worldToLocal","getChildByName","getObjectByName","getObjectById","getObjectByProperty","getWorldPosition","getWorldQuaternion","getWorldRotation","getWorldScale","getWorldDirection","traverseVisible","traverseAncestors","toJSON","output","metadata","version","generator","geometries","parseGeometry","json","parseMaterial","parseObject","JSON","stringify","intensity","PointLight","decay","SpotLight","exponent","HemisphereLight","groundColor","parse","materialIndex","vertexNormals","vertexColors","vertexTangents","BufferAttribute","needsUpdate","copyAt","index1","index2","setXY","setXYZ","setXYZW","Int8Attribute","Uint8Attribute","Uint8ClampedAttribute","Int16Attribute","Uint16Attribute","Int32Attribute","Uint32Attribute","Float32Attribute","Float64Attribute","DynamicBufferAttribute","updateRange","count","create","GeometryIdCount","attributesKeys","drawcalls","offsets","addAttribute","getAttribute","addDrawCall","indexOffset","fromGeometry","settings","faceVertexUvs","hasFaceVertexUv","hasFaceVertexNormals","normals","colors","uvs","i3","na","nb","nc","fc","vca","vcb","vcc","uva","uvb","uvc","bb","isNaN","computeFaceNormals","computeVertexNormals","vA","vB","vC","pA","pB","pC","cb","indices","jl","normalizeNormals","computeTangents","handleTriangle","uvA","uvB","uvC","x1","y1","z1","sdir","tdir","tan1","tan2","handleVertex","n2","tmp2","tangents","uv","nVertices","tangent","iA","iB","iC","computeOffsets","facesCount","sortedIndices","Uint16Array","indexPtr","vertexPtr","duplicatedVertices","newVerticeMaps","faceVertices","Int32Array","vertexMap","revVertexMap","findex","vo","vid","faceMax","new_offset","new_vid","reorderBuffers","merge","attribute1","attributeArray1","attribute2","attributeArray2","attributeSize","indexBuffer","indexMap","vertexCount","sortedAttributes","attr","sourceArray","attrArray","attrSize","sortedAttr","numItems","sourceAttr","dispose","morphTargets","morphColors","morphNormals","skinWeights","skinIndices","lineDistances","hasTangents","dynamic","verticesNeedUpdate","elementsNeedUpdate","uvsNeedUpdate","normalsNeedUpdate","tangentsNeedUpdate","colorsNeedUpdate","lineDistancesNeedUpdate","groupsNeedUpdate","vertex","fromBufferGeometry","tempNormals","tempUVs","addFace","drawcall","fl","areaWeighted","vl","computeMorphNormals","__originalFaceNormal","__originalVertexNormals","tmpGeo","faceNormals","faceNormal","dstNormalsFace","dstNormalsVertex","context","ua","ub","uc","vertexIndex","faceIndex","computeLineDistances","materialIndexOffset","vertexOffset","vertices1","vertices2","faces1","faces2","uvs1","uvs2","vertexCopy","faceCopy","faceVertexNormals","faceVertexColors","uvCopy","mergeMesh","mergeVertices","verticesMap","unique","changes","precisionPoints","faceIndicesToRemove","dupIndex","idx","setBit","getNormalIndex","hash","normalsHash","getColorIndex","colorsHash","getUvIndex","uvsHash","hasMaterial","hasFaceUv","hasFaceNormal","hasFaceVertexNormal","hasFaceColor","hasFaceVertexColor","faceType","uvsCopy","kl","Camera","matrixWorldInverse","CubeCamera","cubeResolution","cameraPX","cameraNX","cameraPY","cameraNY","cameraPZ","cameraNZ","renderTarget","WebGLRenderTargetCube","format","magFilter","minFilter","updateCubeMap","generateMipmaps","activeCubeFace","zoom","cx","cy","setLens","focalLength","frameHeight","atan","setViewOffset","fullWidth","fullHeight","Light","light","AreaLight","constantAttenuation","linearAttenuation","quadraticAttenuation","onlyShadow","shadowCameraNear","shadowCameraFar","shadowCameraLeft","shadowCameraRight","shadowCameraTop","shadowCameraBottom","shadowCameraVisible","shadowBias","shadowDarkness","shadowMapWidth","shadowMapHeight","shadowCascade","shadowCascadeOffset","shadowCascadeCount","shadowCascadeBias","shadowCascadeWidth","shadowCascadeHeight","shadowCascadeNearZ","shadowCascadeFarZ","shadowCascadeArray","shadowMap","shadowMapSize","shadowCamera","shadowMatrix","skyColor","shadowCameraFov","Cache","files","file","get","Loader","showStatus","statusDomElement","addStatusElement","imageLoader","ImageLoader","onLoadStart","onLoadProgress","onLoadComplete","crossOrigin","fontSize","textAlign","background","padding","zIndex","updateProgress","progress","loaded","toFixed","extractUrlBase","url","parts","initMaterials","texturePath","needsTangents","ShaderMaterial","nearest_pow2","LN2","create_texture","where","sourceFile","repeat","wrap","anisotropy","texture","fullPath","loader","Handlers","Texture","image","canvas","getContext","drawImage","wrapS","wrapT","wrapMap","mirror","rgb2hex","rgb","mtype","mpars","opacity","map","lightMap","normalMap","bumpMap","wireframe","shading","toLowerCase","blending","transparent","depthTest","depthWrite","flipSided","side","doubleSided","colorDiffuse","DbgColor","colorSpecular","specular","colorEmissive","emissive","transparency","specularCoef","shininess","mapDiffuse","mapDiffuseRepeat","mapDiffuseOffset","mapDiffuseWrap","mapDiffuseAnisotropy","mapLight","mapLightRepeat","mapLightOffset","mapLightWrap","mapLightAnisotropy","mapBump","mapBumpRepeat","mapBumpOffset","mapBumpWrap","mapBumpAnisotropy","mapNormal","mapNormalRepeat","mapNormalOffset","mapNormalWrap","mapNormalAnisotropy","mapSpecular","mapSpecularRepeat","mapSpecularOffset","mapSpecularWrap","mapSpecularAnisotropy","mapAlpha","mapAlphaRepeat","mapAlphaOffset","mapAlphaWrap","mapAlphaAnisotropy","mapBumpScale","bumpScale","mapNormalFactor","normalScale","DbgName","handlers","regex","XHRLoader","manager","DefaultLoadingManager","onLoad","onProgress","onError","cached","request","XMLHttpRequest","open","response","itemEnd","responseType","send","itemStart","setResponseType","setCrossOrigin","withCredentials","loadAjaxJSON","callbackProgress","xhr","onreadystatechange","readyState","DONE","status","responseText","LOADING","getResponseHeader","HEADERS_RECEIVED","parseModel","isBitSet","fi","zLength","colorIndex","normalIndex","uvIndex","isQuad","faceA","faceB","uvLayer","nUvLayers","parseSkin","influencesPerVertex","bones","animation","animations","parseMorphing","dstVertices","srcVertices","cl","dstColors","srcColors","BufferGeometryLoader","text","typedArray","MaterialLoader","uniforms","vertexShader","fragmentShader","sizeAttenuation","ObjectLoader","substring","lastIndexOf","setTexturePath","parseGeometries","images","parseImages","parseTextures","parseMaterials","geometryLoader","bufferGeometryLoader","widthSegments","heightSegments","depthSegments","CircleGeometry","segments","CylinderGeometry","radiusTop","radiusBottom","radialSegments","openEnded","phiStart","phiLength","thetaStart","thetaLength","IcosahedronGeometry","detail","TorusGeometry","tube","tubularSegments","arc","TorusKnotGeometry","heightScale","alphaMap","envMap","specularMap","loadImage","getGeometry","getMaterial","Group","TextureLoader","DataTextureLoader","BinaryTextureLoader","_parser","DataTexture","texData","mipmaps","mipmapCount","CompressedTextureLoader","CompressedTexture","texDatas","isCubemap","Material","MaterialIdCount","blendSrc","blendDst","blendEquation","blendSrcAlpha","blendDstAlpha","blendEquationAlpha","colorWrite","polygonOffset","polygonOffsetFactor","polygonOffsetUnits","alphaTest","overdraw","_needsUpdate","setValues","values","newValue","currentValue","Number","MeshLambertMaterial","MeshDepthMaterial","PointCloudMaterial","SpriteMaterial","LineBasicMaterial","linewidth","linecap","linejoin","fog","LineDashedMaterial","dashSize","gapSize","combine","reflectivity","refractionRatio","wireframeLinewidth","wireframeLinecap","wireframeLinejoin","skinning","wrapAround","wrapRGB","metal","ParticleBasicMaterial","ParticleSystemMaterial","defines","lights","defaultAttributeValues","uv2","index0AttributeName","UniformsUtils","RawShaderMaterial","mapping","TextureIdCount","DEFAULT_IMAGE","DEFAULT_MAPPING","premultiplyAlpha","flipY","unpackAlignment","onUpdate","CubeTexture","VideoTexture","video","HAVE_ENOUGH_DATA","inverseMatrix","localThreshold","testPoint","rayPointDistance","intersectPoint","distanceToRay","oi","ol","pointCount","ParticleSystem","LineStrip","LinePieces","precisionSq","vStart","vEnd","interSegment","interRay","step","distSq","offsetIndex","nbVertices","updateMorphTargets","morphTargetBase","morphTargetForcedOrder","morphTargetInfluences","morphTargetDictionary","ml","getMorphTargetIndexByName","intersectionPoint","isFaceMaterial","objectMaterials","morphInfluences","tl","influence","targets","Bone","skin","Skeleton","boneInverses","useVertexTexture","identityMatrix","boneTextureWidth","boneTextureHeight","boneMatrices","boneTexture","calculateInverses","bl","pose","bone","offsetMatrix","SkinnedMesh","bindMode","bindMatrix","bindMatrixInverse","gbone","rotq","scl","normalizeSkinWeights","skeleton","sw","MorphAnimMesh","duration","mirroredLoop","lastKeyframe","currentKeyframe","directionBackwards","setFrameRange","startKeyframe","endKeyframe","setDirectionForward","setDirectionBackward","parseAnimations","firstAnimation","pattern","morph","match","label","setAnimationLabel","playAnimation","updateAnimation","frameTime","keyframe","mix","interpolateTargets","influences","addLevel","getObjectForDistance","matrixPosition","Particle","LensFlare","lensFlares","positionScreen","customUpdateCallback","updateLensFlares","flare","vecX","vecY","wantedRotation","overrideMaterial","autoUpdate","Fog","FogExp2","density","ShaderChunk","merged","uniforms_src","uniforms_dst","parameter_src","UniformsLib","common","diffuse","offsetRepeat","flipEnvMap","bump","normalmap","fogDensity","fogNear","fogFar","fogColor","ambientLightColor","directionalLightDirection","directionalLightColor","hemisphereLightDirection","hemisphereLightSkyColor","hemisphereLightGroundColor","pointLightColor","pointLightPosition","pointLightDistance","pointLightDecay","spotLightColor","spotLightPosition","spotLightDirection","spotLightDistance","spotLightAngleCos","spotLightExponent","spotLightDecay","particle","psColor","shadowmap","ShaderLib","basic","lambert","phong","particle_basic","dashed","totalSize","mNear","mFar","cube","tCube","tFlip","equirect","tEquirect","depthRGBA","createParticleBuffers","__webglVertexBuffer","_gl","createBuffer","__webglColorBuffer","info","memory","createLineBuffers","__webglLineDistanceBuffer","createMeshBuffers","geometryGroup","__webglNormalBuffer","__webglTangentBuffer","__webglUVBuffer","__webglUV2Buffer","__webglSkinIndicesBuffer","__webglSkinWeightsBuffer","__webglFaceBuffer","__webglLineBuffer","numMorphTargets","__webglMorphTargetsBuffers","numMorphNormals","__webglMorphNormalsBuffers","initCustomAttributes","nvertices","__webglCustomAttributesList","__webglInitialized","createUniqueBuffers","belongsToAttribute","initParticleBuffers","__vertexArray","__colorArray","__webglParticleCount","initLineBuffers","__lineDistanceArray","__webglLineCount","initMeshBuffers","faces3","ntris","nlines","getBufferMaterial","__normalArray","__uvArray","__uv2Array","__tangentArray","__skinIndexArray","__skinWeightArray","UintArray","extensions","Uint32Array","__typeArray","__faceArray","__lineArray","__morphTargetsArrays","__morphNormalsArrays","__webglFaceCount","originalAttribute","property","__original","__inittedArrays","materialNeedsFaceNormals","setParticleBuffers","hint","ca","cal","customAttribute","vertexArray","colorArray","dirtyVertices","dirtyColors","customAttributes","bindBuffer","ARRAY_BUFFER","bufferData","boundTo","setLineBuffers","dl","lineDistanceArray","dirtyLineDistances","setMeshBuffers","faceColor","n1","n3","sw1","sw2","sw3","si1","si2","si3","vn","uvi","uv2i","vk","vkl","vka","nka","chf","needsFaceNormals","offset_uv","offset_uv2","offset_face","offset_normal","offset_tangent","offset_line","offset_color","offset_skin","offset_morphTarget","offset_custom","uvArray","uv2Array","normalArray","tangentArray","skinIndexArray","skinWeightArray","morphTargetsArrays","morphNormalsArrays","faceArray","lineArray","dirtyElements","dirtyUvs","dirtyNormals","dirtyTangents","dirtyMorphTargets","morphTargetsNeedUpdate","chunk_faces3","obj_faces","obj_uvs","obj_uvs2","obj_skinIndices","obj_skinWeights","ELEMENT_ARRAY_BUFFER","pp","setupVertexAttributes","program","startIndex","geometryAttributes","programAttributes","programAttributesKeys","programAttribute","geometryAttribute","state","enableAttribute","vertexAttribPointer","FLOAT","vertexAttrib2fv","vertexAttrib3fv","disableUnusedAttributes","setupMorphTargets","numSupportedMorphTargets","__webglMorphTargetInfluences","activeInfluenceIndices","numericalSort","numSupportedMorphNormals","influenceIndex","uniform1fv","painterSortStable","reversePainterSortStable","projectObject","initObject","sprites","webglObjects","_webglObjects","_frustum","webglObject","unrollBufferMaterial","sortObjects","_vector3","_projScreenMatrix","renderObjects","renderList","setupMatrices","setMaterial","setMaterialFaces","renderBufferDirect","renderBuffer","renderObjectsImmediate","materialType","renderImmediateObject","unrollImmediateBufferMaterial","globject","opaque","transparentObjects","opaqueObjects","__webglInit","_modelViewMatrix","_normalMatrix","onObjectRemoved","onGeometryDispose","initGeometryGroups","__webglActive","addBuffer","geometryGroupsList","geometryGroups","ImmediateRenderObject","immediateRenderCallback","addBufferImmediate","_webglObjectsImmediate","makeGroups","usesFaceMaterial","groupHash","group","maxVerticesInGroup","hash_map","groups","groupsList","counter","geometryGroupCounter","addBuffers","objlist","updateObject","bufferType","DYNAMIC_DRAW","STATIC_DRAW","bufferSubData","BYTES_PER_ELEMENT","subarray","customAttributesDirty","areCustomAttributesDirty","clearCustomAttributes","removeObject","removeInstances","o","initMaterial","onMaterialDispose","shaderID","shaderIDs","shader","__webglShader","maxLightCount","allocateLights","maxShadows","allocateShadows","maxBones","allocateBones","_precision","supportsVertexTextures","_supportsVertexTextures","envMapMode","useFog","fogExp","flatShading","logarithmicDepthBuffer","_logarithmicDepthBuffer","_supportsBoneTextures","maxMorphTargets","maxMorphNormals","maxDirLights","directional","maxPointLights","maxSpotLights","spot","maxHemiLights","hemi","shadowMapEnabled","shadowMapType","shadowMapDebug","shadowMapCascade","code","pl","_programs","programInfo","usedTimes","WebGLProgram","programs","uniformsList","location","setBlending","setDepthTest","setDepthWrite","setColorWrite","setPolygonOffset","setProgram","_usedTextureUnits","deallocateMaterial","refreshProgram","refreshMaterial","refreshLights","p_uniforms","m_uniforms","_currentProgram","useProgram","_currentMaterialId","_currentCamera","uniformMatrix4fv","uniform1f","logDepthBufFC","cameraPosition","uniform3f","viewMatrix","textureUnit","getTextureUnit","uniform1i","setTexture","boneGlobalMatrices","refreshUniformsFog","_lightsNeedUpdate","setupLights","refreshUniformsLights","_lights","markUniformsLightsNeedsUpdate","refreshUniformsCommon","refreshUniformsLine","refreshUniformsDash","refreshUniformsParticle","refreshUniformsPhong","refreshUniformsLambert","_shadowPass","refreshUniformsShadow","loadUniformsGeneric","loadUniformsMatrices","modelMatrix","uvScaleMap","_canvas","ambient","distances","decays","directions","anglesCos","exponents","skyColors","groundColors","modelViewMatrix","uniformMatrix3fv","_maxTextures","uniform","uniform2f","uniform4f","uniform1iv","uniform3iv","uniform2fv","uniform3fv","uniform4fv","_array","setCubeTexture","setCubeTextureDynamic","setColorLinear","ll","zlights","dirColors","dirPositions","pointColors","pointPositions","pointDistances","pointDecays","spotColors","spotPositions","spotDistances","spotDirections","spotAnglesCos","spotExponents","spotDecays","hemiSkyColors","hemiGroundColors","hemiPositions","dirLength","pointLength","spotLength","hemiLength","dirCount","spotCount","hemiCount","dirOffset","pointOffset","spotOffset","hemiOffset","_direction","setTextureParameters","textureType","isImagePowerOfTwo","extension","texParameteri","TEXTURE_WRAP_S","paramThreeToGL","TEXTURE_WRAP_T","TEXTURE_MAG_FILTER","TEXTURE_MIN_FILTER","CLAMP_TO_EDGE","filterFallback","__currentAnisotropy","texParameterf","TEXTURE_MAX_ANISOTROPY_EXT","getMaxAnisotropy","clampToMaxSize","maxSize","slot","__webglTextureCube","onTextureDispose","createTexture","activeTexture","TEXTURE0","bindTexture","TEXTURE_CUBE_MAP","pixelStorei","UNPACK_FLIP_Y_WEBGL","isCompressed","isDataTexture","cubeImage","autoScaleCubemaps","_maxCubemapSize","glFormat","glType","mipmap","getCompressedTextureFormats","compressedTexImage2D","TEXTURE_CUBE_MAP_POSITIVE_X","texImage2D","generateMipmap","__webglTexture","setupFrameBuffer","framebuffer","textureTarget","bindFramebuffer","FRAMEBUFFER","framebufferTexture2D","COLOR_ATTACHMENT0","setupRenderBuffer","renderbuffer","bindRenderbuffer","RENDERBUFFER","depthBuffer","stencilBuffer","renderbufferStorage","DEPTH_COMPONENT16","framebufferRenderbuffer","DEPTH_ATTACHMENT","DEPTH_STENCIL","DEPTH_STENCIL_ATTACHMENT","RGBA4","updateRenderTargetMipmap","TEXTURE_2D","NEAREST","LINEAR","REPEAT","MIRRORED_REPEAT","NEAREST_MIPMAP_NEAREST","NEAREST_MIPMAP_LINEAR","LINEAR_MIPMAP_NEAREST","LINEAR_MIPMAP_LINEAR","UNSIGNED_BYTE","UNSIGNED_SHORT_4_4_4_4","UNSIGNED_SHORT_5_5_5_1","UNSIGNED_SHORT_5_6_5","BYTE","SHORT","UNSIGNED_SHORT","INT","UNSIGNED_INT","HALF_FLOAT_OES","ALPHA","RGB","RGBA","LUMINANCE","LUMINANCE_ALPHA","FUNC_ADD","FUNC_SUBTRACT","FUNC_REVERSE_SUBTRACT","ZERO","ONE","SRC_COLOR","ONE_MINUS_SRC_COLOR","SRC_ALPHA","ONE_MINUS_SRC_ALPHA","DST_ALPHA","ONE_MINUS_DST_ALPHA","DST_COLOR","ONE_MINUS_DST_COLOR","SRC_ALPHA_SATURATE","COMPRESSED_RGB_S3TC_DXT1_EXT","COMPRESSED_RGBA_S3TC_DXT1_EXT","COMPRESSED_RGBA_S3TC_DXT3_EXT","COMPRESSED_RGBA_S3TC_DXT5_EXT","COMPRESSED_RGB_PVRTC_4BPPV1_IMG","COMPRESSED_RGB_PVRTC_2BPPV1_IMG","COMPRESSED_RGBA_PVRTC_4BPPV1_IMG","COMPRESSED_RGBA_PVRTC_2BPPV1_IMG","MIN_EXT","MAX_EXT","nVertexUniforms","MAX_VERTEX_UNIFORM_VECTORS","nVertexMatrices","dirLights","pointLights","spotLights","hemiLights","_context","pixelRatio","_alpha","_depth","_stencil","stencil","_antialias","_premultipliedAlpha","premultipliedAlpha","_preserveDrawingBuffer","preserveDrawingBuffer","_clearColor","_clearAlpha","autoClear","autoClearColor","autoClearDepth","autoClearStencil","gammaInput","gammaOutput","shadowMapCullFace","calls","_currentFramebuffer","_currentGeometryProgram","_viewportX","_viewportY","_viewportWidth","_viewportHeight","_currentWidth","_currentHeight","resetGLState","setDefaultGLState","WebGLState","getShaderPrecisionFormat","rangeMin","rangeMax","WebGLExtensions","glClearColor","clearColor","clearDepth","clearStencil","enable","DEPTH_TEST","depthFunc","LEQUAL","frontFace","CCW","cullFace","BACK","CULL_FACE","BLEND","blendFunc","viewport","reset","MAX_TEXTURE_IMAGE_UNITS","_maxVertexTextures","MAX_VERTEX_TEXTURE_IMAGE_UNITS","_maxTextureSize","MAX_TEXTURE_SIZE","MAX_CUBE_MAP_TEXTURE_SIZE","_vertexShaderPrecisionHighpFloat","VERTEX_SHADER","HIGH_FLOAT","_vertexShaderPrecisionMediumpFloat","MEDIUM_FLOAT","_fragmentShaderPrecisionHighpFloat","FRAGMENT_SHADER","_fragmentShaderPrecisionMediumpFloat","formats","COMPRESSED_TEXTURE_FORMATS","highpAvailable","mediumpAvailable","shadowMapPlugin","ShadowMapPlugin","spritePlugin","SpritePlugin","lensFlarePlugin","LensFlarePlugin","forceContextLoss","loseContext","supportsFloatTextures","supportsHalfFloatTextures","supportsStandardDerivatives","supportsCompressedTextureS3TC","supportsCompressedTexturePVRTC","supportsBlendMinMax","MAX_TEXTURE_MAX_ANISOTROPY_EXT","getPrecision","getPixelRatio","setPixelRatio","updateStyle","setViewport","setScissor","scissor","enableScissorTest","SCISSOR_TEST","disable","getClearColor","getClearAlpha","setClearAlpha","bits","COLOR_BUFFER_BIT","DEPTH_BUFFER_BIT","STENCIL_BUFFER_BIT","clearTarget","setRenderTarget","deallocateGeometry","deallocateTexture","onRenderTargetDispose","deallocateRenderTarget","deleteBuffers","buffers","deleteBuffer","deleteTexture","deleteFramebuffer","__webglFramebuffer","deleteRenderbuffer","__webglRenderbuffer","deleteProgram","newPrograms","renderBufferImmediate","initAttributes","hasPositions","hasNormals","hasUvs","__webglUvBuffer","hasColors","positionArray","nx","ny","nz","nax","nbx","ncx","nay","nby","ncy","naz","nbz","ncz","drawArrays","TRIANGLES","updateBuffers","wireframeBit","geometryProgram","LINES","drawElements","POINTS","LINE_STRIP","setLineWidth","skinIndex","skinWeight","lineDistance","forceClear","setFaceCulling","frontFaceDirection","CW","FRONT","FRONT_AND_BACK","setDoubleSided","setFlipSided","uploadTexture","UNPACK_PREMULTIPLY_ALPHA_WEBGL","UNPACK_ALIGNMENT","isCube","isTargetPowerOfTwo","createFramebuffer","createRenderbuffer","shareDepthFrom","vx","vy","readRenderTargetPixels","WebGLRenderTarget","restore","checkFramebufferStatus","FRAMEBUFFER_COMPLETE","readPixels","addPrePlugin","addPostPlugin","updateShadowMap","gl","getExtension","programIdCount","generateDefines","chunk","cacheUniformLocations","identifiers","getUniformLocation","cacheAttributeLocations","getAttribLocation","shadowMapTypeDefine","envMapTypeDefine","envMapModeDefine","envMapBlendingDefine","prefix_vertex","prefix_fragment","gammaFactorDefine","customDefines","createProgram","glVertexShader","WebGLShader","glFragmentShader","attachShader","bindAttribLocation","linkProgram","programLogInfo","getProgramInfoLog","getProgramParameter","LINK_STATUS","getError","VALIDATE_STATUS","deleteShader","addLineNumbers","string","lines","createShader","shaderSource","compileShader","getShaderParameter","COMPILE_STATUS","getShaderInfoLog","newAttributes","Uint8Array","enabledAttributes","currentBlending","currentBlendEquation","currentBlendSrc","currentBlendDst","currentBlendEquationAlpha","currentBlendSrcAlpha","currentBlendDstAlpha","currentDepthTest","currentDepthWrite","currentColorWrite","currentDoubleSided","currentFlipSided","currentLineWidth","currentPolygonOffset","currentPolygonOffsetFactor","currentPolygonOffsetUnits","enableVertexAttribArray","disableVertexAttribArray","blendEquationSeparate","blendFuncSeparate","depthMask","colorMask","lineWidth","polygonoffset","units","POLYGON_OFFSET_FILL","flares","prefix","vertexBuffer","elementBuffer","hasVertexTexture","tempTexture","occlusionTexture","renderType","occlusionMap","screenPosition","viewportWidth","viewportHeight","tempPosition","invAspect","halfViewportWidth","halfViewportHeight","screenPositionPixels","TEXTURE1","copyTexImage2D","sprite","_renderer","_renderList","createVirtualLight","cascade","virtualLight","isVirtual","pointsWorld","pointsFrustum","nearZ","farZ","updateVirtualLight","updateShadowCamera","_min","_max","getObjectMaterial","_depthMaterial","_depthMaterialMorph","_depthMaterialSkin","_depthMaterialMorphSkin","_matrixPosition","depthShader","depthUniforms","originalCamera","gyro","Gyroscope","shadowFilter","pars","cameraHelper","CameraHelper","objectMaterial","useMorphing","useSkinning","customDepthMaterial","clearAlpha","spritePosition","spriteRotation","spriteScale","uvOffset","uvScale","fogType","fillStyle","fillRect","oldFogType","sceneFogType","GeometryUtils","geometry1","geometry2","loadTextureCube","loadCompressedTexture","loadCompressedTextureCube","getNormalMap","subtract","getImageData","imageData","createImageData","ly","uy","lx","ux","num_points","putImageData","generateDataTexture","SceneUtils","createMultiMaterialObject","detach","attach","FontUtils","divisions","getFace","loadFace","family","familyName","ThreeFont","cssFontWeight","cssFontStyle","drawText","resolution","String","fontPaths","Path","ret","extractGlyphPoints","paths","outline","action","cpx","cpy","cpx0","cpy0","cpx1","cpy1","cpx2","cpy2","laste","pts","glyph","glyphs","_cachedOutline","moveTo","lineTo","quadraticCurveTo","Shape","Utils","bezierCurveTo","b3","ha","generateShapes","curveSegments","font","shapes","toShapes","namespace","EPSILON","process","contour","verts","vertIndices","nv","snip","px","py","aX","aY","bX","bY","cX","cY","apx","apy","bpx","bpy","cCROSSap","bCROSScp","aCROSSbp","Triangulate","_typeface_js","typeface_js","Audio","source","createBufferSource","onended","onEnded","gain","createGain","connect","destination","panner","createPanner","autoplay","isPlaying","onload","decodeAudioData","play","loop","pause","currentTime","setLoop","setRefDistance","refDistance","setRolloffFactor","rolloffFactor","setVolume","AudioListener","AudioContext","webkitAudioContext","orientation","positionPrev","setOrientation","setVelocity","Curve","getPointAt","getUtoTmapping","getPoints","getSpacedPoints","lengths","getLengths","cacheArcLengths","current","cache","last","sum","updateArcLengths","targetArcLength","arcLengths","comparison","lengthBefore","lengthAfter","segmentLength","segmentFraction","getTangent","pt1","pt2","vec","getTangentAt","tangentQuadraticBezier","tangentCubicBezier","tangentSpline","h00","h10","h01","h11","getPointFunc","CurvePath","curves","bends","autoClose","curve","checkConnection","closePath","startPoint","endPoint","LineCurve","curveLengths","getCurveLengths","lens","cacheLengths","sums","maxX","maxY","maxZ","minX","minY","minZ","NEGATIVE_INFINITY","POSITIVE_INFINITY","createPointsGeometry","createGeometry","createSpacedPointsGeometry","addWrapPath","bendpath","getTransformedPoints","oldPts","getWrapPoints","getTransformedSpacedPoints","oldX","oldY","xNorm","bounds","pathPt","translationObject","quaternionObject","scaleObject","translationWorld","quaternionWorld","scaleWorld","actions","fromPoints","PathActions","MOVE_TO","LINE_TO","QUADRATIC_CURVE_TO","BEZIER_CURVE_TO","CSPLINE_THRU","ARC","ELLIPSE","vectors","vlen","args","lastargs","x0","y0","aCPx","aCPy","QuadraticBezierCurve","aCP1x","aCP1y","aCP2x","aCP2y","CubicBezierCurve","splineThru","npts","SplineCurve","aRadius","aStartAngle","aEndAngle","aClockwise","absarc","absellipse","ellipse","xRadius","yRadius","EllipseCurve","lastPoint","closedPath","useSpacedPoints","item","spts","concat","spline","deltaAngle","tdivisions","isCCW","noHoles","extractSubpaths","inActions","subPaths","lastPath","toShapesNoHoles","inSubpaths","tmpPath","tmpShape","isPointInsidePolygon","inPt","inPolygon","polyLen","inside","edgeLowPt","edgeHighPt","edgeDx","edgeDy","perpEdge","solid","holesFirst","isClockWise","tmpPoints","betterShapeHoles","newShapes","newShapeHoles","mainIdx","ambigious","toChange","sIdx","sLen","sho","hIdx","ho","hole_unassigned","s2Idx","froms","tos","hole","tmpHoles","holes","extrude","extruded","ExtrudeGeometry","makeGeometry","ShapeGeometry","getPointsHoles","holesPts","getSpacedPointsHoles","extractAllPoints","shape","extractPoints","extractAllSpacedPoints","triangulateShape","point_in_segment_2D_colin","inSegPt1","inSegPt2","inOtherPt","intersect_segments_2D","inSeg1Pt1","inSeg1Pt2","inSeg2Pt1","inSeg2Pt2","inExcludeAdjacentSegs","seg1dx","seg1dy","seg2dx","seg2dy","seg1seg2dx","seg1seg2dy","perpSeg1","perpSeg2","factorSeg1","seg1Pt","seg2Pt","seg1min","seg1max","seg1minVal","seg1maxVal","seg2min","seg2max","seg2minVal","seg2maxVal","isPointInsideAngle","inVertex","inLegFromPt","inLegToPt","legFromPtX","legFromPtY","legToPtX","legToPtY","otherPtX","otherPtY","from2toAngle","from2otherAngle","other2toAngle","removeHoles","isCutLineInsideAngles","inShapeIdx","inHoleIdx","lastShapeIdx","prevShapeIdx","nextShapeIdx","insideAngle","lastHoleIdx","prevHoleIdx","nextHoleIdx","intersectsShapeEdge","inShapePt","inHolePt","nextIdx","intersection","intersectsHoleEdge","ihIdx","chkHole","indepHoles","holeIndex","shapeIndex","shapePt","holePt","holeIdx","cutKey","tmpShape1","tmpShape2","tmpHole1","tmpHole2","failedCuts","hl","minShapeIndex","h2","allPointsMap","allpoints","shapeWithoutHoles","b2p0","b2p1","b2p2","b3p0","b3p1","b3p2","b3p3","point0","point1","point2","point3","ArcCurve","LineCurve3","QuadraticBezierCurve3","CubicBezierCurve3","SplineCurve3","ClosedSplineCurve3","AnimationHandler","CATMULLROM","CATMULLROM_FORWARD","initialized","hierarchy","rot","usedMorphTargets","morphTargetName","morphTargetsInfluences","root","parseRecurseHierarchy","deltaTimeMS","resetBlendWeights","Animation","timeScale","interpolationType","keyTypes","animationCache","positionWeight","quaternionWeight","scaleWeight","prevKey","nextKey","originalMatrix","getNextKeyWith","newVector","newQuat","interpolateCatmullRom","prevXYZ","nextXYZ","proportionalWeight","getPrevKeyWith","currentPoint","forwardPoint","KeyFrameAnimation","isPaused","sids","sid","next","endTime","original","hasTarget","MorphAnimation","lastFrame","currentFrame","interpolation","frame","buildPlane","udir","vdir","gridX","gridY","width_half","height_half","gridX1","gridY1","segment_width","segment_height","uvd","depth_half","centerUV","segment","CubeGeometry","heightHalf","verticesRow","uvsRow","tanTheta","v4","n4","uv1","uv3","uv4","addShapeList","addShape","scalePt2","pt","getBevelVec","inPrev","inNext","v_trans_x","v_trans_y","shrink_by","v_prev_x","v_prev_y","v_next_x","v_next_y","v_prev_lensq","colinear0","v_prev_len","v_next_len","ptPrevShift_x","ptPrevShift_y","ptNextShift_x","ptNextShift_y","sf","v_trans_lensq","direction_eq","buildLidFaces","bevelEnabled","layer","flen","f3","steps","bevelSegments","buildSideFaces","layeroffset","sidewalls","ahole","slen1","slen2","f4","shapesOffset","uvgen","generateTopUV","wallContour","stepIndex","stepsLength","contourIndex1","contourIndex2","extrudeMaterial","generateSideWallUV","extrudePts","splineTube","binormal","position2","bevelThickness","bevelSize","extrudePath","extrudeByPath","UVGenerator","WorldUVGenerator","TubeGeometry","FrenetFrames","shapePoints","reverse","bs","vert","contourMovements","oneHoleMovements","holesMovements","verticesMovements","binormals","indexA","indexB","indexC","indexD","LatheGeometry","inversePointLength","inverseSegments","phi","np","u0","u1","PlaneGeometry","PlaneBufferGeometry","offset2","RingGeometry","innerRadius","outerRadius","thetaSegments","phiSegments","radiusStep","thetaSegment","TextGeometry","textShapes","getPos","in_q","in_p","cu","su","quOverP","cs","tz","grid","tang","bitan","ip","jp","closed","taper","NoTaper","numpoints","pos2","SinusoidalTaper","initialNormal3","smallest","MAX_VALUE","mat","PolyhedronGeometry","prepare","that","azimuth","inclination","centroid","azi","correctUV","subdivide","cols","aj","bj","rows","DodecahedronGeometry","OctahedronGeometry","TetrahedronGeometry","ParametricGeometry","func","slices","stacks","sliceCount","AxisHelper","ArrowHelper","lineGeometry","coneGeometry","headLength","headWidth","cone","setDirection","setColor","BoxHelper","BoundingBoxHelper","addLine","addPoint","pointMap","hexFrustum","hexCone","hexUp","hexTarget","hexCross","setPoint","DirectionalLightHelper","lightPlane","targetLine","EdgesHelper","thresholdAngle","thresholdDot","edge","sortFunction","numEdges","vert1","vert2","face1","face2","FaceNormalsHelper","objectVertices","objectFaces","objectWorldMatrix","GridHelper","setColors","colorCenterLine","colorGrid","HemisphereLightHelper","sphereSize","lightSphere","PointLightHelper","SkeletonHelper","getBoneList","boneList","matrixWorldInv","boneMatrix","SpotLightHelper","vector2","coneLength","coneWidth","VertexNormalsHelper","worldMatrix","vertexId","VertexTangentsHelper","WireframeHelper","edges","numTris","renderCallback","MorphBlendMesh","animationsMap","animationsList","numFrames","startFrame","endFrame","createAnimation","setAnimationWeight","active","autoCreateAnimations","frameRanges","setAnimationDirectionForward","setAnimationDirectionBackward","setAnimationFPS","setAnimationDuration","setAnimationTime","getAnimationTime","getAnimationDuration","stopAnimation","Entity","Messanger","ObjectPool","QuadTree","Spatial","Vec2","messanger","_tags","_entities","_groups","_entityPool","_componentPools","Components","componentPropertyName","Component","getName","charAt","groupKey","names","T","ENTITY_CREATED","ENTITY_REMOVE","COMPONENT_ADDED","COMPONENT_REMOVE","aquire","_manager","_trigger","removeEntitiesByTag","tag","removeAllEntities","removeEntity","entityRemoveAllComponents","release","entityAddTag","entityRemoveTag","entityAddComponent","_Components","cName","cPool","component","groupName","hasAllComponents","Cs","entityRemoveComponent","loc","propName","_indexGroup","poolStats","used","totalUsed","pool","trigger","freeList","expand","__init","totalFree","level","maxEntities","maxLevels","nodes","insert","_getIndex","spatial","absPosition","absHwidth","_splitAndRedistributeIfNeeded","_node","queryArea","hwidth","out__entities","overlapping","rectIntersect","reIndex","_combine","tSize","tPos","validateEntity","hw","assign","smult","rectContains","midX","midY","_split","_redistribute","_factory","TComponent","hasTag","removeTag","_events","fired","handled","Event","listenTo","eventName","option","events","fire","_absScale","_absPosition","_absHwidth","COINCIDENT","attachTo","absRotation","rotate","pScale","absScale","magnitude","magnitude2","angleBetween","pcopy","fromAngle","pfromAngle","r1","r2","sizeToHwidth","out__position","out__hwidth","_name","_callback","Comps","whereComponent","whereComponents","extends","mixin","getArguments","mixin_","Function","extends_","Child","Parent","Super","makeT","FUNCTION_ARGS","replace","FUNCTION_NAME"],"mappings":"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AAMkwB,MAAM,YAK3BszC,QAEEyI,mBACElpE,KAAM,KACNykB,UAGF0kD,2BACEnpE,KAAM,KACNykB,UAEF2kD,uBACEppE,KAAM,KACNykB,UAGF4kD,0BACErpE,KAAM,KACNykB,UAEF6kD,yBACEtpE,KAAM,KACNykB,UAEF8kD,4BACEvpE,KAAM,KACNykB,UAGF+kD,iBACExpE,KAAM,KACNykB,UAEFglD,oBACEzpE,KAAM,KACNykB,UAEFilD,oBACE1pE,KAAM,MACNykB,UAEFklD,iBACE3pE,KAAM,MACNykB,UAGFmlD,gBACE5pE,KAAM,KACNykB,UAEFolD,mBACE7pE,KAAM,KACNykB,UAEFqlD,oBACE9pE,KAAM,KACNykB,UAEFslD,mBACE/pE,KAAM,MACNykB,UAEFulD,mBACEhqE,KAAM,MACNykB,UAEFwlD,mBACEjqE,KAAM,MACNykB,UAEFylD,gBACElqE,KAAM,MACNykB,WAKJ0lD,UAEEC,SACEpqE,KAAM,IACNykB,MAAO,GAAIxnB,OAAMkwB,MAAM,WAEzB4lC,SACE/yD,KAAM,IACNykB,MAAO,GAETqf,MACE9jC,KAAM,IACNykB,MAAO,GAETzY,OACEhM,KAAM,IACNykB,MAAO,GAETuuC,KACEhzD,KAAM,IACNykB,MAAO,MAETikD,cACE1oE,KAAM,KACNykB,MAAO,GAAIxnB,OAAMmkC,QAAQ,EAAG,EAAG,EAAG,IAGpC0nC,YACE9oE,KAAM,IACNykB,MAAO,OAETskD,SACE/oE,KAAM,IACNykB,MAAO,GAETukD,QACEhpE,KAAM,IACNykB,MAAO,KAETwkD,UACEjpE,KAAM,IACNykB,MAAO,GAAIxnB,OAAMkwB,MAAM,YAK3Bk9C,WAEEnb,WACElvD,KAAM,KACNykB,UAEF0qC,eACEnvD,KAAM,MACNykB,UAGF4pC,YACEruD,KAAM,MACNykB,UAEF6pC,gBACEtuD,KAAM,MACNykB,UAGF4qC,cACErvD,KAAM,MACNykB,YAkBNxnB,MAAMqtE,WAEJC,OAEEnQ,SAAUn9D,MAAM4jE,cAAcnb,OAE5BzoD,MAAMsrE,YAAoB,OAC1BtrE,MAAMsrE,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","file":"bundle.js","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})","global.Class = require('js-class');\r\nglobal.THREE = require('three');\r\nglobal.THREEx = require('./js/THREEx.KeyboardState.js');\r\nglobal.Physijs = require('physijs-browserify')(THREE);\r\nglobal.Stats = require('stats.js');\r\n\r\nrequire('./RequestAnimationFrame.js');\r\n\r\nrequire('./js/Game.js');\r\nrequire('./js/Globals.js');\r\nrequire('./js/ResourceManager.js');\r\nrequire('./js/PointerLockControls.js');\r\nrequire('./js/EntityFactory.js');\r\nrequire('./js/Systems.js');\r\nrequire('./js/MouseController.js');\r\n\r\nPhysijs.scripts.worker = './libs/physijsWorker.js';\r\nPhysijs.scripts.ammo = './ammo.js';\r\n\r\n// purpose: function as a basic FPS game using an ECS (entity-component system) pattern\r\n//\r\n// requires: RequestAnimationFrame.js, three.js, three-pointerlockcontrols.js, stats.js, js-class.js, physijs, tiny-ecs\r\n//           Game.js, ResourceManager.js\r\n//\r\n// author: Cornell Daly\r\n//\r\n// date: November 3, 2015\r\n//\r\n// additional notes: code is separated into multiple files\r\n\r\nvar game = null;\r\n\r\nfunction init() {\r\n  Globals.hud = document.getElementById(\"hud\");\r\n  Globals.score = document.getElementById(\"score\");\r\n\r\n  var gameOptions = {\r\n    container: document.getElementById(\"container\"),\r\n    loadingContainer: document.getElementById(\"loadingContainer\"),\r\n    blocker: document.getElementById(\"blocker\"),\r\n    instructions: document.getElementById(\"instructions\"),\r\n    crosshair: document.getElementById(\"crosshair\"),\r\n    modelsToPreload: [\r\n      \"models/potato.json\"\r\n    ]\r\n  };\r\n  game = new Game(gameOptions);\r\n\r\n  game.start();\r\n}\r\n\r\ninit();\r\n\r\n","/**\n * Provides requestAnimationFrame in a cross browser way.\n * http://paulirish.com/2011/requestanimationframe-for-smart-animating/\n */\n\nif ( !window.requestAnimationFrame ) {\n\n\twindow.requestAnimationFrame = ( function() {\n\n\t\treturn window.webkitRequestAnimationFrame ||\n\t\twindow.mozRequestAnimationFrame ||\n\t\twindow.oRequestAnimationFrame ||\n\t\twindow.msRequestAnimationFrame ||\n\t\tfunction( /* function FrameRequestCallback */ callback, /* DOMElement Element */ element ) {\n\n\t\t\twindow.setTimeout( callback, 1000 / 60 );\n\n\t\t};\n\n\t} )();\n\n}\n","// THREEx.KeyboardState.js keep the current state of the keyboard.\r\n// It is possible to query it at any time. No need of an event.\r\n// This is particularly convenient in loop driven case, like in\r\n// 3D demos or games.\r\n//\r\n// # Usage\r\n//\r\n// **Step 1**: Create the object\r\n//\r\n// ```var keyboard  = new THREEx.KeyboardState();```\r\n//\r\n// **Step 2**: Query the keyboard state\r\n//\r\n// This will return true if shift and A are pressed, false otherwise\r\n//\r\n// ```keyboard.pressed(\"shift+A\")```\r\n//\r\n// **Step 3**: Stop listening to the keyboard\r\n//\r\n// ```keyboard.destroy()```\r\n//\r\n// NOTE: this library may be nice as standaline. independant from three.js\r\n// - rename it keyboardForGame\r\n//\r\n// # Code\r\n//\r\n\r\n/** @namespace */\r\nvar THREEx = THREEx || {};\r\n\r\nif (typeof module === 'object') {\r\n\r\n  module.exports = THREEx;\r\n\r\n}\r\n\r\n/**\r\n * - NOTE: it would be quite easy to push event-driven too\r\n *   - microevent.js for events handling\r\n *   - in this._onkeyChange, generate a string from the DOM event\r\n *   - use this as event name\r\n */\r\nTHREEx.KeyboardState = function(domElement) {\r\n  this.domElement = domElement || document;\r\n  // to store the current state\r\n  this.keyCodes = {};\r\n  this.modifiers = {};\r\n\r\n  // create callback to bind/unbind keyboard events\r\n  var _this = this;\r\n  this._onKeyDown = function(event) {\r\n    _this._onKeyChange(event)\r\n  };\r\n  this._onKeyUp = function(event) {\r\n    _this._onKeyChange(event)\r\n  };\r\n\r\n  // bind keyEvents\r\n  this.domElement.addEventListener(\"keydown\", this._onKeyDown, false);\r\n  this.domElement.addEventListener(\"keyup\", this._onKeyUp, false);\r\n\r\n  // create callback to bind/unbind window blur event\r\n  this._onBlur = function() {\r\n    for (var prop in _this.keyCodes) _this.keyCodes[prop] = false;\r\n    for (var prop in _this.modifiers) _this.modifiers[prop] = false;\r\n  };\r\n\r\n  // bind window blur\r\n  window.addEventListener(\"blur\", this._onBlur, false);\r\n};\r\n\r\n/**\r\n * To stop listening of the keyboard events\r\n */\r\nTHREEx.KeyboardState.prototype.destroy = function() {\r\n  // unbind keyEvents\r\n  this.domElement.removeEventListener(\"keydown\", this._onKeyDown, false);\r\n  this.domElement.removeEventListener(\"keyup\", this._onKeyUp, false);\r\n\r\n  // unbind window blur event\r\n  window.removeEventListener(\"blur\", this._onBlur, false);\r\n};\r\n\r\nTHREEx.KeyboardState.MODIFIERS = ['shift', 'ctrl', 'alt', 'meta'];\r\nTHREEx.KeyboardState.ALIAS = {\r\n  'left': 37,\r\n  'up': 38,\r\n  'right': 39,\r\n  'down': 40,\r\n  'space': 32,\r\n  'pageup': 33,\r\n  'pagedown': 34,\r\n  'tab': 9,\r\n  'escape': 27\r\n};\r\n\r\n/**\r\n * to process the keyboard dom event\r\n */\r\nTHREEx.KeyboardState.prototype._onKeyChange = function(event) {\r\n  // log to debug\r\n  //console.log(\"onKeyChange\", event, event.keyCode, event.shiftKey, event.ctrlKey, event.altKey, event.metaKey)\r\n\r\n  // update this.keyCodes\r\n  var keyCode = event.keyCode\r\n  var pressed = event.type === 'keydown' ? true : false\r\n  this.keyCodes[keyCode] = pressed\r\n    // update this.modifiers\r\n  this.modifiers['shift'] = event.shiftKey\r\n  this.modifiers['ctrl'] = event.ctrlKey\r\n  this.modifiers['alt'] = event.altKey\r\n  this.modifiers['meta'] = event.metaKey\r\n};\r\n\r\n/**\r\n * query keyboard state to know if a key is pressed of not\r\n *\r\n * @param {String} keyDesc the description of the key. format : modifiers+key e.g shift+A\r\n * @returns {Boolean} true if the key is pressed, false otherwise\r\n */\r\nTHREEx.KeyboardState.prototype.pressed = function(keyDesc) {\r\n  var keys = keyDesc.split(\"+\");\r\n  for (var i = 0; i < keys.length; i++) {\r\n    var key = keys[i]\r\n    var pressed = false\r\n    if (THREEx.KeyboardState.MODIFIERS.indexOf(key) !== -1) {\r\n      pressed = this.modifiers[key];\r\n    }\r\n    else if (Object.keys(THREEx.KeyboardState.ALIAS).indexOf(key) != -1) {\r\n      pressed = this.keyCodes[THREEx.KeyboardState.ALIAS[key]];\r\n    }\r\n    else {\r\n      pressed = this.keyCodes[key.toUpperCase().charCodeAt(0)]\r\n    }\r\n    if (!pressed) return false;\r\n  };\r\n  return true;\r\n};\r\n\r\n/**\r\n * return true if an event match a keyDesc\r\n * @param  {KeyboardEvent} event   keyboard event\r\n * @param  {String} keyDesc string description of the key\r\n * @return {Boolean}         true if the event match keyDesc, false otherwise\r\n */\r\nTHREEx.KeyboardState.prototype.eventMatches = function(event, keyDesc) {\r\n  var aliases = THREEx.KeyboardState.ALIAS\r\n  var aliasKeys = Object.keys(aliases)\r\n  var keys = keyDesc.split(\"+\")\r\n    // log to debug\r\n    // console.log(\"eventMatches\", event, event.keyCode, event.shiftKey, event.ctrlKey, event.altKey, event.metaKey)\r\n  for (var i = 0; i < keys.length; i++) {\r\n    var key = keys[i];\r\n    var pressed = false;\r\n    if (key === 'shift') {\r\n      pressed = (event.shiftKey ? true : false)\r\n    }\r\n    else if (key === 'ctrl') {\r\n      pressed = (event.ctrlKey ? true : false)\r\n    }\r\n    else if (key === 'alt') {\r\n      pressed = (event.altKey ? true : false)\r\n    }\r\n    else if (key === 'meta') {\r\n      pressed = (event.metaKey ? true : false)\r\n    }\r\n    else if (aliasKeys.indexOf(key) !== -1) {\r\n      pressed = (event.keyCode === aliases[key] ? true : false);\r\n    }\r\n    else if (event.keyCode === key.toUpperCase().charCodeAt(0)) {\r\n      pressed = true;\r\n    }\r\n    if (!pressed) return false;\r\n  }\r\n  return true;\r\n};\r\n\r\nif (typeof exports !== 'undefined') {\r\n  if (typeof module !== 'undefined' && module.exports) {\r\n    exports = module.exports = THREEx;\r\n  }\r\n  else {\r\n    exports.THREEx = THREEx;\r\n  }\r\n}\r\nelse {\r\n  this['THREEx'] = THREEx;\r\n}\r\n\r\n","Game = Class({\r\n  constructor: function(options) {\r\n    this.container = options.container;\r\n    this.loadingContainer = options.loadingContainer;\r\n    this.blocker = options.blocker;\r\n    this.instructions = options.instructions;\r\n    this.crosshair = options.crosshair;\r\n\r\n    this.stats = null;\r\n\r\n    this.prevTime = performance.now();\r\n\r\n    this.renderer = null;\r\n    this.scene = null;\r\n    this.camera = null;\r\n\r\n    this.paused = true;\r\n\r\n    this.controlsEnabled = false;\r\n    this.controls = null;\r\n\r\n    this.systems = [];\r\n    this.postPhysicsSystems = [];\r\n\r\n    this.modelsToPreload = options.modelsToPreload;\r\n    this.percentModelsLoaded = 0;\r\n  },\r\n\r\n  start: function(runImmediately) {\r\n    if (runImmediately === undefined || runImmediately === null) {\r\n      runImmediately = true;\r\n    }\r\n\r\n    window.addEventListener('resize', this.onResize.bind(this));\r\n    window.onkeydown = this.onKeyDown.bind(this); // prevent spacebar from scrolling the page\r\n    window.addEventListener('mousedown', this.onMouseDown.bind(this));\r\n    window.addEventListener('mouseup', this.onMouseUp.bind(this));\r\n\r\n    this.renderer = new THREE.WebGLRenderer({\r\n      antialias: true\r\n    });\r\n    this.renderer.setSize(window.innerWidth, window.innerHeight);\r\n    this.renderer.setClearColor(0xffffff, 1);\r\n    this.container.appendChild(this.renderer.domElement);\r\n\r\n    /* Stats.js Setup */\r\n    this.stats = new Stats();\r\n    this.stats.setMode(0);\r\n\r\n    this.stats.domElement.style.position = 'absolute';\r\n    this.stats.domElement.style.left = '10px';\r\n    this.stats.domElement.style.bottom = '10px';\r\n\r\n    document.body.appendChild(this.stats.domElement);\r\n\r\n    // Create a new Three.js scene\r\n    this.scene = new Physijs.Scene();\r\n    this.scene.setGravity(new THREE.Vector3(0, -9.8 * 3, 0));\r\n\r\n    // Put in a camera\r\n    var aspectRatio = window.innerWidth / window.innerHeight;\r\n    this.camera = new THREE.PerspectiveCamera(45, aspectRatio, 0.1, 1000);\r\n    this.scene.add(this.camera);\r\n\r\n    /* Camera Controller */\r\n    this.controls = new PointerLockControls({\r\n      camera: this.camera\r\n    });\r\n    this.scene.add(this.controls.getObject());\r\n\r\n    this.clock = new THREE.Clock();\r\n\r\n    /* Setup Crosshair */\r\n\r\n    this.crosshair.style.left = ((window.innerWidth / 2) - 32) + 'px';\r\n    this.crosshair.style.top = ((window.innerHeight / 2) - 32) + 'px';\r\n\r\n    var ambientLight = new THREE.AmbientLight(0xcbcbcb);\r\n    this.scene.add(ambientLight);\r\n\r\n    var dirLight = new THREE.DirectionalLight(0xdcdcdc, 0.5);\r\n    this.scene.add(dirLight);\r\n\r\n    var ground = new Physijs.BoxMesh(\r\n      new THREE.BoxGeometry(500, 1, 500),\r\n      new THREE.MeshBasicMaterial({\r\n        color: 0x00dd00\r\n      }), 0);\r\n    ground._physijs.collision_type = EntityFactory.COLLISION_TYPES.obstacle;\r\n    ground._physijs.collision_masks = EntityFactory.COLLISION_TYPES.player | EntityFactory.COLLISION_TYPES.playerBullet | EntityFactory.COLLISION_TYPES.enemyBullet;\r\n    this.scene.add(ground);\r\n\r\n    /* Create Entities */\r\n\r\n    this.player = EntityFactory.instance.makePlayer({\r\n      scene: this.scene,\r\n      position: new THREE.Vector3(0, 20, 0),\r\n      controls: this.controls,\r\n      controlsObject: this.controls.getObject(),\r\n      cameraOffset: new THREE.Vector3(0, 3, 0)\r\n    });\r\n\r\n    /*var m = new Physijs.BoxMesh(\r\n      new THREE.BoxGeometry(10, 10, 10),\r\n      Physijs.createMaterial(new THREE.MeshPhongMaterial({\r\n        color: 0x0000ff\r\n      }), 0.5, 0.6), 0);\r\n    m._physijs.collision_type = EntityFactory.COLLISION_TYPES.enemy;\r\n    m._physijs.collision_masks = EntityFactory.COLLISION_TYPES.obstacle | EntityFactory.COLLISION_TYPES.player | EntityFactory.COLLISION_TYPES.playerBullet;\r\n    m.position.set(0, 5, -200);\r\n    this.scene.add(m);*/\r\n    EntityFactory.instance.makeEnemy({\r\n      scene: this.scene,\r\n      position: new THREE.Vector3(0, 5, -200)\r\n    });\r\n\r\n    /* Setup Systems */\r\n\r\n    this.systems.push(new CameraRotationSystem(EntityFactory.instance.entities));\r\n    this.systems.push(new PlayerInputSystem(EntityFactory.instance.entities));\r\n    this.systems.push(new MovementSystem(EntityFactory.instance.entities));\r\n    this.systems.push(new ExpirableSystem(EntityFactory.instance.entities));\r\n    this.systems.push(new CameraFollowSystem(EntityFactory.instance.entities));\r\n    this.systems.push(new ShootDelaySystem(EntityFactory.instance.entities));\r\n    this.systems.push(new HurtSystem(EntityFactory.instance.entities));\r\n\r\n    this.postPhysicsSystems.push(new PhysicsUpdateSystem(EntityFactory.instance.entities));\r\n\r\n    this.loadModels();\r\n  },\r\n\r\n  loadModels: function() {\r\n    this.modelsToPreload.forEach(function(model) {\r\n      ResourceManager.instance.loadModel(model, this.modelLoaded.bind(this));\r\n    }.bind(this));\r\n  },\r\n\r\n  modelLoaded: function(model) {\r\n    var percentPerModel = 100.0 / this.modelsToPreload.length;\r\n    this.percentModelsLoaded += percentPerModel;\r\n\r\n    if (this.percentModelsLoaded > 99.0) {\r\n      // hide loading indicator and show instructions\r\n      this.loadingContainer.style.visibility = \"hidden\";\r\n      this.blocker.style.visibility = \"visible\";\r\n      this.instructions.style.visibility = \"visible\";\r\n      Globals.hud.style.display = 'block';\r\n      this.crosshair.style.display = 'block';\r\n\r\n      // ensure the user is at the top of the page\r\n      document.body.scrollTop = document.documentElement.scrollTop = 0;\r\n\r\n      this.initPointerLock();\r\n\r\n      this.run();\r\n    }\r\n  },\r\n\r\n  run: function() {\r\n    requestAnimationFrame(this.update.bind(this));\r\n  },\r\n\r\n  update: function() {\r\n    requestAnimationFrame(this.update.bind(this));\r\n\r\n    var time = performance.now();\r\n    var dt = (time - this.prevTime) / 1000;\r\n\r\n    if (!this.paused) {\r\n      if (dt > 0.5) {\r\n        dt = 0.5;\r\n      }\r\n\r\n      this.systems.forEach(function(system) {\r\n        system.update(dt);\r\n      });\r\n\r\n      this.scene.simulate();\r\n\r\n      this.postPhysicsSystems.forEach(function(system) {\r\n        system.update(dt);\r\n      });\r\n\r\n      MouseController.instance.update(dt);\r\n    }\r\n\r\n    this.renderer.render(this.scene, this.camera);\r\n    this.stats.update();\r\n\r\n    this.prevTime = time;\r\n  },\r\n\r\n  onResize: function(e) {\r\n    this.renderer.setSize(window.innerWidth, window.innerHeight);\r\n\r\n    this.camera.aspect = (window.innerWidth / window.innerHeight);\r\n    this.camera.updateProjectionMatrix();\r\n\r\n    this.crosshair.style.left = ((window.innerWidth / 2) - 32) + 'px';\r\n    this.crosshair.style.top = ((window.innerHeight / 2) - 32) + 'px';\r\n  },\r\n\r\n  onKeyDown: function(e) {\r\n    var keyCode = ('which' in event) ? event.which : event.keyCode;\r\n\r\n    return (keyCode !== Game.KEY_CODES.space);\r\n  },\r\n\r\n  onMouseDown: function(e) {\r\n    if (this.paused) {\r\n      return;\r\n    }\r\n\r\n    if (e.button === 0) {\r\n      MouseController.instance.isDown.left = true;\r\n    }\r\n    else if (e.button === 2) {\r\n      MouseController.instance.isDown.right = true;\r\n    }\r\n  },\r\n\r\n  onMouseUp: function(e) {\r\n    if (this.paused) {\r\n      return;\r\n    }\r\n\r\n    if (e.button === 0) {\r\n      MouseController.instance.isDown.left = false;\r\n      MouseController.instance.wasPressed.left = true;\r\n    }\r\n    else if (e.button === 2) {\r\n      MouseController.instance.isDown.right = false;\r\n      MouseController.instance.wasPressed.right = true;\r\n    }\r\n  },\r\n\r\n  initPointerLock: function() {\r\n    var havePointerLock = 'pointerLockElement' in document || 'mozPointerLockElement' in document || 'webkitPointerLockElement' in document;\r\n\r\n    if (havePointerLock) {\r\n\r\n      var element = document.body;\r\n\r\n      var pointerlockchange = function(event) {\r\n\r\n        if (document.pointerLockElement === element || document.mozPointerLockElement === element || document.webkitPointerLockElement === element) {\r\n\r\n          this.controlsEnabled = true;\r\n          this.controls.enabled = true;\r\n\r\n          this.blocker.style.display = 'none';\r\n\r\n          this.paused = false;\r\n\r\n        }\r\n        else {\r\n\r\n          this.controls.enabled = false;\r\n\r\n          this.blocker.style.display = '-webkit-box';\r\n          this.blocker.style.display = '-moz-box';\r\n          this.blocker.style.display = 'box';\r\n\r\n          this.instructions.style.display = '';\r\n\r\n          this.paused = true;\r\n\r\n        }\r\n\r\n      }.bind(this);\r\n\r\n      var pointerlockerror = function(event) {\r\n\r\n        this.instructions.style.display = '';\r\n\r\n      }.bind(this);\r\n\r\n      // Hook pointer lock state change events\r\n      document.addEventListener('pointerlockchange', pointerlockchange, false);\r\n      document.addEventListener('mozpointerlockchange', pointerlockchange, false);\r\n      document.addEventListener('webkitpointerlockchange', pointerlockchange, false);\r\n\r\n      document.addEventListener('pointerlockerror', pointerlockerror, false);\r\n      document.addEventListener('mozpointerlockerror', pointerlockerror, false);\r\n      document.addEventListener('webkitpointerlockerror', pointerlockerror, false);\r\n\r\n      this.instructions.addEventListener('click', function(event) {\r\n\r\n        this.instructions.style.display = 'none';\r\n\r\n        // Ask the browser to lock the pointer\r\n        element.requestPointerLock = element.requestPointerLock || element.mozRequestPointerLock || element.webkitRequestPointerLock;\r\n\r\n        if (/Firefox/i.test(navigator.userAgent)) {\r\n\r\n          var fullscreenchange = function(event) {\r\n\r\n            if (document.fullscreenElement === element || document.mozFullscreenElement === element || document.mozFullScreenElement === element) {\r\n\r\n              document.removeEventListener('fullscreenchange', fullscreenchange);\r\n              document.removeEventListener('mozfullscreenchange', fullscreenchange);\r\n\r\n              element.requestPointerLock();\r\n            }\r\n\r\n          };\r\n\r\n          document.addEventListener('fullscreenchange', fullscreenchange, false);\r\n          document.addEventListener('mozfullscreenchange', fullscreenchange, false);\r\n\r\n          element.requestFullscreen = element.requestFullscreen || element.mozRequestFullscreen || element.mozRequestFullScreen || element.webkitRequestFullscreen;\r\n\r\n          element.requestFullscreen();\r\n\r\n        }\r\n        else {\r\n\r\n          element.requestPointerLock();\r\n\r\n        }\r\n\r\n      }.bind(this), false);\r\n\r\n    }\r\n    else {\r\n\r\n      this.instructions.innerHTML = 'Your browser doesn\\'t seem to support Pointer Lock API';\r\n\r\n    }\r\n  }\r\n}, {\r\n  statics: {\r\n    KEY_CODES: {\r\n      space: 32\r\n    }\r\n  }\r\n});\r\n\r\n","Globals = Class({\r\n  constructor: function() {\r\n    this.hud = null;\r\n    this.score = null;\r\n  }\r\n}, {\r\n  statics: {\r\n    get instance() {\r\n      if (!Globals._instance) {\r\n        Globals._instance = new Globals();\r\n      }\r\n      return Globals._instance;\r\n    }\r\n  }\r\n});\r\n\r\n","var EntityManager = require('tiny-ecs').EntityManager;\r\nvar C = require('./Components.js');\r\n\r\nEntityFactory = Class({\r\n  constructor: function() {\r\n    this.entities = new EntityManager();\r\n  },\r\n\r\n  makePlayer: function(options) {\r\n    var player = this.entities.createEntity();\r\n\r\n    player.addTag(\"player\");\r\n\r\n    player.addComponent(C.Position);\r\n    player.addComponent(C.Velocity);\r\n    player.addComponent(C.Jump);\r\n    player.addComponent(C.Drawable);\r\n    player.addComponent(C.CameraFollow);\r\n    player.addComponent(C.ShootDelay);\r\n\r\n    player.drawable.scene = options.scene;\r\n\r\n    player.drawable.mesh = new Physijs.BoxMesh(\r\n      new THREE.BoxGeometry(2, 8, 2),\r\n      Physijs.createMaterial(new THREE.MeshBasicMaterial({\r\n        color: 0xffff00\r\n      }), 0.9, 0.1));\r\n    player.drawable.mesh.entity = player;\r\n\r\n    player.drawable.mesh.position.copy(options.position);\r\n    //player.drawable.mesh.rotation.copy(options.rotation);\r\n\r\n    player.drawable.mesh._physijs.collision_type = EntityFactory.COLLISION_TYPES.player;\r\n    player.drawable.mesh._physijs.collision_masks = EntityFactory.COLLISION_TYPES.obstacle | EntityFactory.COLLISION_TYPES.enemy | EntityFactory.COLLISION_TYPES.enemyBullet;\r\n\r\n    player.drawable.scene.add(player.drawable.mesh);\r\n\r\n    player.drawable.mesh.setDamping(0.99, 0);\r\n    player.drawable.mesh.setAngularFactor(new THREE.Vector3(0, 0, 0));\r\n\r\n    player.drawable.mesh.addEventListener('collision', function(other_object, relative_velocity, relative_rotation, contact_normal) {\r\n      if (contact_normal.y < 0 && other_object._physijs.collision_type === EntityFactory.COLLISION_TYPES.obstacle) {\r\n        player.jump.canJump = true;\r\n      }\r\n    });\r\n\r\n    player.position.x = options.position.x;\r\n    player.position.y = options.position.y;\r\n    player.position.z = options.position.z;\r\n\r\n    player.cameraFollow.controls = options.controls;\r\n    player.cameraFollow.object = options.controlsObject;\r\n    player.cameraFollow.offset = options.cameraOffset;\r\n\r\n    player.shootDelay.delayTheshold = 0.5;\r\n\r\n    return player;\r\n  },\r\n\r\n  makeEnemy: function(options) {\r\n    var enemy = this.entities.createEntity();\r\n\r\n    enemy.addTag(\"enemy\");\r\n\r\n    enemy.addComponent(C.Position);\r\n    enemy.addComponent(C.Velocity);\r\n    enemy.addComponent(C.Drawable);\r\n\r\n    enemy.drawable.scene = options.scene;\r\n\r\n    enemy.drawable.mesh = new Physijs.BoxMesh(\r\n      new THREE.BoxGeometry(10, 10, 10),\r\n      Physijs.createMaterial(new THREE.MeshPhongMaterial({\r\n        color: 0x0000ff\r\n      }), 0.5, 0.6), 0);\r\n    enemy.drawable.mesh.entity = enemy;\r\n\r\n    enemy.drawable.mesh._physijs.collision_type = EntityFactory.COLLISION_TYPES.enemy;\r\n    enemy.drawable.mesh._physijs.collision_masks = EntityFactory.COLLISION_TYPES.obstacle | EntityFactory.COLLISION_TYPES.player | EntityFactory.COLLISION_TYPES.playerBullet;\r\n\r\n    enemy.drawable.mesh.position.copy(options.position);\r\n    //enemy.drawable.mesh.rotation.copy(options.rotation);\r\n\r\n    enemy.drawable.scene.add(enemy.drawable.mesh);\r\n\r\n    enemy.position.x = options.position.x;\r\n    enemy.position.y = options.position.y;\r\n    enemy.position.z = options.position.z;\r\n  },\r\n\r\n  makeBullet: function(options) {\r\n    ResourceManager.instance.loadModel('models/potato.json', function(model) {\r\n      var bullet = this.entities.createEntity();\r\n\r\n      bullet.addTag(\"bullet\");\r\n\r\n      bullet.addComponent(C.Position);\r\n      bullet.addComponent(C.Drawable);\r\n      bullet.addComponent(C.Expirable);\r\n      bullet.addComponent(C.OneTimeHit);\r\n\r\n      bullet.drawable.scene = options.scene;\r\n\r\n      bullet.drawable.mesh = new Physijs.ConvexMesh(\r\n        model.geometry,\r\n        Physijs.createMaterial(model.material, 0.7, 0.01)\r\n      );\r\n      bullet.drawable.mesh.entity = bullet;\r\n\r\n      bullet.drawable.mesh._physijs.collision_type = EntityFactory.COLLISION_TYPES.playerBullet;\r\n      bullet.drawable.mesh._physijs.collision_masks = EntityFactory.COLLISION_TYPES.obstacle | EntityFactory.COLLISION_TYPES.enemy | EntityFactory.COLLISION_TYPES.playerBullet | EntityFactory.COLLISION_TYPES.enemyBullet;\r\n\r\n      bullet.drawable.mesh.position.copy(options.position);\r\n      bullet.drawable.mesh.rotation.copy(options.rotation);\r\n      bullet.drawable.mesh.scale.copy(options.scale);\r\n\r\n      bullet.drawable.scene.add(bullet.drawable.mesh);\r\n\r\n      bullet.drawable.mesh.setDamping(0.1, 0);\r\n\r\n      bullet.drawable.mesh.addEventListener('collision', function(other_object, relative_velocity, relative_rotation, contact_normal) {\r\n        if (other_object._physijs.collision_type === EntityFactory.COLLISION_TYPES.enemy && bullet.oneTimeHit.alreadyHit.indexOf(other_object.uuid) < 0) {\r\n          other_object.entity.addComponent(C.Hurt);\r\n          other_object.entity.hurt.originalColor = other_object.material.color;\r\n\r\n          var curScore = parseInt(Globals.score.innerHTML, 10);\r\n          curScore++;\r\n\r\n          Globals.score.innerHTML = curScore;\r\n\r\n          bullet.oneTimeHit.alreadyHit.push(other_object.uuid);\r\n        }\r\n      }.bind(this));\r\n\r\n      if (options.position) {\r\n        bullet.position.x = options.position.x;\r\n        bullet.position.y = options.position.y;\r\n        bullet.position.z = options.position.z;\r\n      }\r\n\r\n      var vel = new THREE.Vector3(options.velocity, options.velocity, options.velocity);\r\n      vel.multiply(options.direction);\r\n      //var vel = new THREE.Vector3(0, 0, -options.velocity).applyMatrix4(options.rotationMatrix);\r\n      bullet.drawable.mesh.applyCentralImpulse(vel);\r\n      //console.log(vel, options.direction, options.position);\r\n\r\n      bullet.expirable.maxAge = 5;\r\n    }.bind(this));\r\n  }\r\n}, {\r\n  statics: {\r\n    get instance() {\r\n      if (!EntityFactory._instance) {\r\n        EntityFactory._instance = new EntityFactory();\r\n      }\r\n      return EntityFactory._instance;\r\n    },\r\n\r\n    COLLISION_TYPES: {\r\n      nothing: 0, // collide with nothing\r\n\r\n      obstacle: 1 << 0,\r\n      player: 1 << 2,\r\n      enemy: 1 << 3,\r\n\r\n      playerBullet: 1 << 4,\r\n      enemyBullet: 1 << 5\r\n    }\r\n  }\r\n});\r\n\r\n","MouseController = Class({\r\n  constructor: function() {\r\n    this.isDown = {\r\n      left: false,\r\n      right: false\r\n    };\r\n\r\n    this.wasPressed = {\r\n      left: false,\r\n      right: false\r\n    };\r\n  },\r\n\r\n  update: function(dt) {\r\n    this.wasPressed.left = false;\r\n    this.wasPressed.right = false;\r\n  }\r\n}, {\r\n  statics: {\r\n    get instance() {\r\n      if (!MouseController._instance) {\r\n        MouseController._instance = new MouseController();\r\n      }\r\n      return MouseController._instance;\r\n    }\r\n  }\r\n});\r\n\r\n","PointerLockControls = Class({\r\n  constructor: function(options) {\r\n    this.camera = options.camera;\r\n    this.camera.rotation.set(0, 0, 0);\r\n\r\n    this.pitchObject = new THREE.Object3D();\r\n    this.pitchObject.add(this.camera);\r\n\r\n    this.yawObject = new THREE.Object3D();\r\n    this.yawObject.position.y = 10;\r\n    this.yawObject.add(this.pitchObject);\r\n\r\n    this.moveForward = false;\r\n    this.moveBackward = false;\r\n    this.moveLeft = false;\r\n    this.moveRight = false;\r\n\r\n    this.isOnObject = false;\r\n    this.canJump = false;\r\n\r\n    this.prevTime = performance.now();\r\n\r\n    this.velocity = new THREE.Vector3();\r\n\r\n    this.enabled = false;\r\n\r\n    this.mass = options.mass || 100.0;\r\n    this.moveSpeed = options.moveSpeed || new THREE.Vector3(400.0, 350.0, 400.0);\r\n    this.minimumY = options.minimumY || 10;\r\n\r\n    document.addEventListener('mousemove', this.onMouseMove.bind(this), false);\r\n    document.addEventListener('keydown', this.onKeyDown.bind(this), false);\r\n    document.addEventListener('keyup', this.onKeyUp.bind(this), false);\r\n  },\r\n\r\n  onMouseMove: function(event) {\r\n    if (this.enabled === false) {\r\n      return;\r\n    }\r\n\r\n    var movementX = event.movementX || event.mozMovementX || event.webkitMovementX || 0;\r\n    var movementY = event.movementY || event.mozMovementY || event.webkitMovementY || 0;\r\n\r\n    this.yawObject.rotation.y -= movementX * 0.002;\r\n    this.pitchObject.rotation.x -= movementY * 0.002;\r\n\r\n    this.pitchObject.rotation.x = Math.max(-PointerLockControls.PI_2, Math.min(PointerLockControls.PI_2, this.pitchObject.rotation.x));\r\n  },\r\n\r\n  onKeyDown: function(event) {\r\n    switch (event.keyCode) {\r\n      case 38: // up\r\n      case 87: // w\r\n        this.moveForward = true;\r\n        break;\r\n\r\n      case 37: // left\r\n      case 65: // a\r\n        this.moveLeft = true;\r\n        break;\r\n\r\n      case 40: // down\r\n      case 83: // s\r\n        this.moveBackward = true;\r\n        break;\r\n\r\n      case 39: // right\r\n      case 68: // d\r\n        this.moveRight = true;\r\n        break;\r\n\r\n      case 32: // space\r\n        if (this.canJump === true) {\r\n          this.velocity.y += this.moveSpeed.y;\r\n        }\r\n\r\n        this.canJump = false;\r\n\r\n        break;\r\n\r\n      default:\r\n        break;\r\n    }\r\n  },\r\n\r\n  onKeyUp: function(event) {\r\n    switch (event.keyCode) {\r\n      case 38: // up\r\n      case 87: // w\r\n        this.moveForward = false;\r\n        break;\r\n\r\n      case 37: // left\r\n      case 65: // a\r\n        this.moveLeft = false;\r\n        break;\r\n\r\n      case 40: // down\r\n      case 83: // s\r\n        this.moveBackward = false;\r\n        break;\r\n\r\n      case 39: // right\r\n      case 68: // d\r\n        this.moveRight = false;\r\n        break;\r\n\r\n      default:\r\n        break;\r\n    }\r\n  },\r\n\r\n  getObject: function() {\r\n    return this.yawObject;\r\n  },\r\n\r\n  isOnObject: function(bool) {\r\n    this.isOnObject = bool;\r\n    this.canJump = bool;\r\n  },\r\n\r\n  getDirection: function() {\r\n    // assumes the camera itself is not rotated\r\n    var direction = new THREE.Vector3(0, 0, -1);\r\n    var rotation = new THREE.Euler(0, 0, 0, \"YXZ\");\r\n\r\n    return function(v) {\r\n      rotation.set(this.pitchObject.rotation.x, this.yawObject.rotation.y, 0);\r\n\r\n      v.copy(direction).applyEuler(rotation);\r\n\r\n      return v;\r\n    };\r\n  }(),\r\n\r\n  update: function(dt) {\r\n    if (this.enabled === false) {\r\n      return;\r\n    }\r\n\r\n    this.velocity.x -= this.velocity.x * 10.0 * dt;\r\n    this.velocity.z -= this.velocity.z * 10.0 * dt;\r\n\r\n    this.velocity.y -= 9.8 * this.mass * dt;\r\n\r\n    if (this.moveForward) {\r\n      this.velocity.z -= this.moveSpeed.z * dt;\r\n    }\r\n    if (this.moveBackward) {\r\n      this.velocity.z += this.moveSpeed.z * dt;\r\n    }\r\n\r\n    if (this.moveLeft) {\r\n      this.velocity.x -= this.moveSpeed.x * dt;\r\n    }\r\n    if (this.moveRight) {\r\n      this.velocity.x += this.moveSpeed.x * dt;\r\n    }\r\n\r\n    if (this.isOnObject === true) {\r\n      this.velocity.y = Math.max(0, this.velocity.y);\r\n    }\r\n\r\n    this.yawObject.translateX(this.velocity.x * dt);\r\n    this.yawObject.translateY(this.velocity.y * dt);\r\n    this.yawObject.translateZ(this.velocity.z * dt);\r\n\r\n    if (this.yawObject.position.y < this.minimumY) {\r\n      this.velocity.y = 0;\r\n      this.yawObject.position.y = this.minimumY;\r\n\r\n      this.canJump = true;\r\n    }\r\n  }\r\n}, {\r\n  statics: {\r\n    PI_2: Math.PI / 2\r\n  }\r\n});\r\n\r\n","Model = Class({\r\n  constructor: function(options) {\r\n    this.geometry = options.geometry;\r\n    this.material = options.material;\r\n  }\r\n});\r\n\r\nResourceManager = Class({\r\n  constructor: function() {\r\n    this.loadingManager = new THREE.LoadingManager();\r\n\r\n    this.jsonLoader = new THREE.JSONLoader(this.loadingManager);\r\n\r\n    this.textures = {};\r\n    this.models = {};\r\n  },\r\n\r\n  getTexture: function(path, callback) {\r\n    if (path === null || path === undefined) {\r\n      return null;\r\n    }\r\n    else if (path in this.textures) {\r\n      return this.textures[path];\r\n    }\r\n\r\n    this.textures[path] = THREE.ImageUtils.loadTexture(path, undefined, callback);\r\n\r\n    return this.textures[path];\r\n  },\r\n\r\n  loadModel: function(path, callback) {\r\n    if (path === null || path === undefined) {\r\n      return;\r\n    }\r\n    else if (path in this.models) {\r\n      callback(this.models[path]);\r\n\r\n      return;\r\n    }\r\n\r\n    this.jsonLoader.load(path, function(geometry, materials) {\r\n      var material = new THREE.MeshFaceMaterial(materials);\r\n\r\n      var model = new Model({\r\n        geometry: geometry,\r\n        material: material\r\n      });\r\n      this.models[path] = model;\r\n\r\n      callback(model);\r\n    }.bind(this));\r\n  }\r\n}, {\r\n  statics: {\r\n    get instance() {\r\n      if (!ResourceManager._instance) {\r\n        ResourceManager._instance = new ResourceManager();\r\n      }\r\n      return ResourceManager._instance;\r\n    }\r\n  }\r\n});\r\n\r\n","var C = require('./Components.js');\r\n\r\nPlayerInputSystem = Class({\r\n  constructor: function(entities) {\r\n    this.entities = entities;\r\n\r\n    this.keyboard = new THREEx.KeyboardState();\r\n    this.jumped = false;\r\n  },\r\n\r\n  update: function(dt) {\r\n    var players = this.entities.queryTag(\"player\");\r\n\r\n    players.forEach(function(entity) {\r\n      var velocity = new THREE.Vector3(entity.velocity.x, entity.velocity.y, entity.velocity.z);\r\n      var dv = new THREE.Vector3(); // delta velocity\r\n\r\n      if (this.keyboard.pressed(\"w\")) {\r\n        dv.z = -PlayerInputSystem.MOVE_SPEED;\r\n      }\r\n      else if (this.keyboard.pressed(\"s\")) {\r\n        dv.z = PlayerInputSystem.MOVE_SPEED;\r\n      }\r\n\r\n      if (this.keyboard.pressed(\"a\")) {\r\n        dv.x = -PlayerInputSystem.MOVE_SPEED;\r\n      }\r\n      else if (this.keyboard.pressed(\"d\")) {\r\n        dv.x = PlayerInputSystem.MOVE_SPEED;\r\n      }\r\n\r\n      if (this.keyboard.pressed(\"space\") && entity.jump.canJump) {\r\n        dv.y = 1500;\r\n        entity.jump.canJump = false;\r\n      }\r\n\r\n      if (entity.shootDelay.canShoot) {\r\n        if (MouseController.instance.wasPressed.left) {\r\n          var direction = new THREE.Vector3();\r\n          entity.cameraFollow.controls.getDirection(direction);\r\n\r\n          EntityFactory.instance.makeBullet({\r\n            scene: entity.drawable.scene,\r\n            position: entity.cameraFollow.object.position.clone(),\r\n            rotation: entity.cameraFollow.object.rotation.clone(),\r\n            scale: new THREE.Vector3(0.5, 0.5, 0.5),\r\n            direction: direction,\r\n            rotationMatrix: entity.velocity.rotationMatrix,\r\n            velocity: 2000\r\n          });\r\n\r\n          entity.shootDelay.canShoot = false;\r\n        }\r\n        else if (MouseController.instance.wasPressed.right) {\r\n          var direction = new THREE.Vector3();\r\n          entity.cameraFollow.controls.getDirection(direction);\r\n\r\n          EntityFactory.instance.makeBullet({\r\n            scene: entity.drawable.scene,\r\n            position: entity.cameraFollow.object.position.clone(),\r\n            rotation: entity.cameraFollow.object.rotation.clone(),\r\n            scale: new THREE.Vector3(0.5, 0.5, 0.5),\r\n            direction: direction,\r\n            rotationMatrix: entity.velocity.rotationMatrix,\r\n            velocity: 200\r\n          });\r\n\r\n          entity.shootDelay.canShoot = false;\r\n        }\r\n      }\r\n\r\n      dv = dv.applyMatrix4(entity.velocity.rotationMatrix);\r\n\r\n      velocity.add(dv);\r\n\r\n      entity.velocity.x = velocity.x;\r\n      entity.velocity.y = velocity.y;\r\n      entity.velocity.z = velocity.z;\r\n    }.bind(this));\r\n  }\r\n}, {\r\n  statics: {\r\n    MOVE_SPEED: 25\r\n  }\r\n});\r\n\r\nMovementSystem = Class({\r\n  constructor: function(entities) {\r\n    this.entities = entities;\r\n  },\r\n\r\n  update: function(dt) {\r\n    var moveables = this.entities.queryComponents([C.Position, C.Velocity]);\r\n\r\n    moveables.forEach(function(entity) {\r\n      var velocity = new THREE.Vector3(entity.velocity.x, entity.velocity.y, entity.velocity.z);\r\n\r\n      if (entity.hasComponent(C.Drawable)) {\r\n        entity.drawable.mesh.applyCentralImpulse(velocity, new THREE.Vector3());\r\n        //entity.drawable.mesh.setLinearVelocity(entity.velocity);\r\n      }\r\n      else {\r\n        entity.position.x += velocity.x * dt;\r\n        entity.position.y += velocity.y * dt;\r\n        entity.position.z += velocity.z * dt;\r\n      }\r\n    });\r\n  }\r\n});\r\n\r\nExpirableSystem = Class({\r\n  constructor: function(entities) {\r\n    this.entities = entities;\r\n  },\r\n\r\n  update: function(dt) {\r\n    var expirables = this.entities.queryComponents([C.Expirable]);\r\n\r\n    expirables.forEach(function(entity) {\r\n      entity.expirable.age += dt;\r\n\r\n      if (entity.expirable.age >= entity.expirable.maxAge) {\r\n        if (entity.hasComponent(C.Drawable)) {\r\n          entity.drawable.scene.remove(entity.drawable.mesh);\r\n        }\r\n\r\n        entity.remove();\r\n      }\r\n    });\r\n  }\r\n});\r\n\r\nCameraRotationSystem = Class({\r\n  constructor: function(entities) {\r\n    this.entities = entities;\r\n  },\r\n\r\n  update: function(dt) {\r\n    var follows = this.entities.queryComponents([C.CameraFollow, C.Velocity]);\r\n\r\n    follows.forEach(function(entity) {\r\n      entity.velocity.rotationMatrix = new THREE.Matrix4().extractRotation(entity.cameraFollow.object.matrix);\r\n    });\r\n  }\r\n});\r\n\r\nCameraFollowSystem = Class({\r\n  constructor: function(entities) {\r\n    this.entities = entities;\r\n  },\r\n\r\n  update: function(dt) {\r\n    var follows = this.entities.queryComponents([C.CameraFollow, C.Position, C.Velocity]);\r\n\r\n    /*if (follows.length > 1) {\r\n      throw new Error(\"The camera can only follow one object at a time!\");\r\n    }*/\r\n\r\n    follows.forEach(function(entity) {\r\n      if (entity.velocity.rotationMatrix === null) {\r\n        return;\r\n      }\r\n\r\n      var offset = entity.cameraFollow.offset.clone();\r\n      offset = offset.applyMatrix4(entity.velocity.rotationMatrix);\r\n\r\n      entity.cameraFollow.object.position.x = entity.position.x + offset.x;\r\n      entity.cameraFollow.object.position.y = entity.position.y + offset.y;\r\n      entity.cameraFollow.object.position.z = entity.position.z + offset.z;\r\n\r\n      entity.drawable.mesh.rotation.x = entity.cameraFollow.object.rotation.x;\r\n      entity.drawable.mesh.rotation.y = entity.cameraFollow.object.rotation.y;\r\n      entity.drawable.mesh.rotation.z = entity.cameraFollow.object.rotation.z;\r\n    });\r\n  }\r\n});\r\n\r\nShootDelaySystem = Class({\r\n  constructor: function(entities) {\r\n    this.entities = entities;\r\n  },\r\n\r\n  update: function(dt) {\r\n    var shooters = this.entities.queryComponents([C.ShootDelay]);\r\n\r\n    shooters.forEach(function(entity) {\r\n      if (entity.shootDelay.canShoot === false) {\r\n        entity.shootDelay.timer += dt;\r\n\r\n        if (entity.shootDelay.timer > entity.shootDelay.delayTheshold) {\r\n          entity.shootDelay.canShoot = true;\r\n          entity.shootDelay.timer = 0;\r\n        }\r\n      }\r\n    });\r\n  }\r\n});\r\n\r\nHurtSystem = Class({\r\n  constructor: function(entities) {\r\n    this.entities = entities;\r\n  },\r\n\r\n  update: function(dt) {\r\n    var hurtables = this.entities.queryComponents([C.Hurt, C.Drawable]);\r\n\r\n    hurtables.forEach(function(entity) {\r\n      entity.hurt.timer += dt;\r\n\r\n      if (entity.hurt.timer < entity.hurt.invulnerabilityFrames) {\r\n        entity.drawable.mesh.material.color = entity.hurt.hurtColor;\r\n      }\r\n      else {\r\n        entity.drawable.mesh.material.color = entity.hurt.originalColor;\r\n\r\n        entity.removeComponent(C.Hurt);\r\n      }\r\n    });\r\n  }\r\n});\r\n\r\nPhysicsUpdateSystem = Class({\r\n  constructor: function(entities) {\r\n    this.entities = entities;\r\n  },\r\n\r\n  update: function(dt) {\r\n    var moveables = this.entities.queryComponents([C.Position, C.Velocity, C.Drawable]);\r\n\r\n    moveables.forEach(function(entity) {\r\n      entity.position.x = entity.drawable.mesh.position.x;\r\n      entity.position.y = entity.drawable.mesh.position.y;\r\n      entity.position.z = entity.drawable.mesh.position.z;\r\n\r\n      entity.velocity.x = entity.drawable.mesh.getLinearVelocity().x;\r\n      entity.velocity.y = entity.drawable.mesh.getLinearVelocity().y;\r\n      entity.velocity.z = entity.drawable.mesh.getLinearVelocity().z;\r\n    });\r\n  }\r\n});\r\n\r\n","module.exports = function(THREE) {\n  'use strict';\n\n  var SUPPORT_TRANSFERABLE,\n    _is_simulating = false,\n    _Physijs = Physijs, // used for noConflict method\n    Physijs = {}, // object assigned to window.Physijs\n    Eventable, // class to provide simple event methods\n    getObjectId, // returns a unique ID for a Physijs mesh object\n    getEulerXYZFromQuaternion, getQuatertionFromEuler,\n    convertWorldPositionToObject, // Converts a world-space position to object-space\n    addObjectChildren,\n\n    _temp1, _temp2,\n    _temp_vector3_1 = new THREE.Vector3,\n    _temp_vector3_2 = new THREE.Vector3,\n    _temp_matrix4_1 = new THREE.Matrix4,\n    _quaternion_1 = new THREE.Quaternion,\n\n    // constants\n    MESSAGE_TYPES = {\n      WORLDREPORT: 0,\n      COLLISIONREPORT: 1,\n      VEHICLEREPORT: 2,\n      CONSTRAINTREPORT: 3\n    },\n    REPORT_ITEMSIZE = 14,\n    COLLISIONREPORT_ITEMSIZE = 5,\n    VEHICLEREPORT_ITEMSIZE = 9,\n    CONSTRAINTREPORT_ITEMSIZE = 6;\n\n  Physijs.scripts = {};\n\n  Eventable = function() {\n    this._eventListeners = {};\n  };\n  Eventable.prototype.addEventListener = function(event_name, callback) {\n    if (!this._eventListeners.hasOwnProperty(event_name)) {\n      this._eventListeners[event_name] = [];\n    }\n    this._eventListeners[event_name].push(callback);\n  };\n  Eventable.prototype.removeEventListener = function(event_name, callback) {\n    var index;\n\n    if (!this._eventListeners.hasOwnProperty(event_name)) return false;\n\n    if ((index = this._eventListeners[event_name].indexOf(callback)) >= 0) {\n      this._eventListeners[event_name].splice(index, 1);\n      return true;\n    }\n\n    return false;\n  };\n  Eventable.prototype.dispatchEvent = function(event_name) {\n    var i,\n      parameters = Array.prototype.splice.call(arguments, 1);\n\n    if (this._eventListeners.hasOwnProperty(event_name)) {\n      for (i = 0; i < this._eventListeners[event_name].length; i++) {\n        this._eventListeners[event_name][i].apply(this, parameters);\n      }\n    }\n  };\n  Eventable.make = function(obj) {\n    obj.prototype.addEventListener = Eventable.prototype.addEventListener;\n    obj.prototype.removeEventListener = Eventable.prototype.removeEventListener;\n    obj.prototype.dispatchEvent = Eventable.prototype.dispatchEvent;\n  };\n\n  getObjectId = (function() {\n    var _id = 1;\n    return function() {\n      return _id++;\n    };\n  })();\n\n  getEulerXYZFromQuaternion = function(x, y, z, w) {\n    return new THREE.Vector3(\n      Math.atan2(2 * (x * w - y * z), (w * w - x * x - y * y + z * z)),\n      Math.asin(2 * (x * z + y * w)),\n      Math.atan2(2 * (z * w - x * y), (w * w + x * x - y * y - z * z))\n    );\n  };\n\n  getQuatertionFromEuler = function(x, y, z) {\n    var c1, s1, c2, s2, c3, s3, c1c2, s1s2;\n    c1 = Math.cos(y);\n    s1 = Math.sin(y);\n    c2 = Math.cos(-z);\n    s2 = Math.sin(-z);\n    c3 = Math.cos(x);\n    s3 = Math.sin(x);\n\n    c1c2 = c1 * c2;\n    s1s2 = s1 * s2;\n\n    return {\n      w: c1c2 * c3 - s1s2 * s3,\n      x: c1c2 * s3 + s1s2 * c3,\n      y: s1 * c2 * c3 + c1 * s2 * s3,\n      z: c1 * s2 * c3 - s1 * c2 * s3\n    };\n  };\n\n  convertWorldPositionToObject = function(position, object) {\n    _temp_matrix4_1.identity(); // reset temp matrix\n\n    // Set the temp matrix's rotation to the object's rotation\n    _temp_matrix4_1.identity().makeRotationFromQuaternion(object.quaternion);\n\n    // Invert rotation matrix in order to \"unrotate\" a point back to object space\n    _temp_matrix4_1.getInverse(_temp_matrix4_1);\n\n    // Yay! Temp vars!\n    _temp_vector3_1.copy(position);\n    _temp_vector3_2.copy(object.position);\n\n    // Apply the rotation\n\n    return _temp_vector3_1.sub(_temp_vector3_2).applyMatrix4(_temp_matrix4_1);\n  };\n\n\n\n  // Physijs.noConflict\n  Physijs.noConflict = function() {\n    window.Physijs = _Physijs;\n    return Physijs;\n  };\n\n\n  // Physijs.createMaterial\n  Physijs.createMaterial = function(material, friction, restitution) {\n    var physijs_material = function() {};\n    physijs_material.prototype = material;\n    physijs_material = new physijs_material;\n\n    physijs_material._physijs = {\n      id: material.id,\n      friction: friction === undefined ? .8 : friction,\n      restitution: restitution === undefined ? .2 : restitution\n    };\n\n    return physijs_material;\n  };\n\n\n  // Constraints\n  Physijs.PointConstraint = function(objecta, objectb, position) {\n    if (position === undefined) {\n      position = objectb;\n      objectb = undefined;\n    }\n\n    this.type = 'point';\n    this.appliedImpulse = 0;\n    this.id = getObjectId();\n    this.objecta = objecta._physijs.id;\n    this.positiona = convertWorldPositionToObject(position, objecta).clone();\n\n    if (objectb) {\n      this.objectb = objectb._physijs.id;\n      this.positionb = convertWorldPositionToObject(position, objectb).clone();\n    }\n  };\n  Physijs.PointConstraint.prototype.getDefinition = function() {\n    return {\n      type: this.type,\n      id: this.id,\n      objecta: this.objecta,\n      objectb: this.objectb,\n      positiona: this.positiona,\n      positionb: this.positionb\n    };\n  };\n\n  Physijs.HingeConstraint = function(objecta, objectb, position, axis) {\n    if (axis === undefined) {\n      axis = position;\n      position = objectb;\n      objectb = undefined;\n    }\n\n    this.type = 'hinge';\n    this.appliedImpulse = 0;\n    this.id = getObjectId();\n    this.scene = objecta.parent;\n    this.objecta = objecta._physijs.id;\n    this.positiona = convertWorldPositionToObject(position, objecta).clone();\n    this.position = position.clone();\n    this.axis = axis;\n\n    if (objectb) {\n      this.objectb = objectb._physijs.id;\n      this.positionb = convertWorldPositionToObject(position, objectb).clone();\n    }\n  };\n  Physijs.HingeConstraint.prototype.getDefinition = function() {\n    return {\n      type: this.type,\n      id: this.id,\n      objecta: this.objecta,\n      objectb: this.objectb,\n      positiona: this.positiona,\n      positionb: this.positionb,\n      axis: this.axis\n    };\n  };\n  /*\n   * low = minimum angle in radians\n   * high = maximum angle in radians\n   * bias_factor = applied as a factor to constraint error\n   * relaxation_factor = controls bounce (0.0 == no bounce)\n   */\n  Physijs.HingeConstraint.prototype.setLimits = function(low, high, bias_factor, relaxation_factor) {\n    this.scene.execute('hinge_setLimits', {\n      constraint: this.id,\n      low: low,\n      high: high,\n      bias_factor: bias_factor,\n      relaxation_factor: relaxation_factor\n    });\n  };\n  Physijs.HingeConstraint.prototype.enableAngularMotor = function(velocity, acceleration) {\n    this.scene.execute('hinge_enableAngularMotor', {\n      constraint: this.id,\n      velocity: velocity,\n      acceleration: acceleration\n    });\n  };\n  Physijs.HingeConstraint.prototype.disableMotor = function(velocity, acceleration) {\n    this.scene.execute('hinge_disableMotor', {\n      constraint: this.id\n    });\n  };\n\n  Physijs.SliderConstraint = function(objecta, objectb, position, axis) {\n    if (axis === undefined) {\n      axis = position;\n      position = objectb;\n      objectb = undefined;\n    }\n\n    this.type = 'slider';\n    this.appliedImpulse = 0;\n    this.id = getObjectId();\n    this.scene = objecta.parent;\n    this.objecta = objecta._physijs.id;\n    this.positiona = convertWorldPositionToObject(position, objecta).clone();\n    this.axis = axis;\n\n    if (objectb) {\n      this.objectb = objectb._physijs.id;\n      this.positionb = convertWorldPositionToObject(position, objectb).clone();\n    }\n  };\n  Physijs.SliderConstraint.prototype.getDefinition = function() {\n    return {\n      type: this.type,\n      id: this.id,\n      objecta: this.objecta,\n      objectb: this.objectb,\n      positiona: this.positiona,\n      positionb: this.positionb,\n      axis: this.axis\n    };\n  };\n  Physijs.SliderConstraint.prototype.setLimits = function(lin_lower, lin_upper, ang_lower, ang_upper) {\n    this.scene.execute('slider_setLimits', {\n      constraint: this.id,\n      lin_lower: lin_lower,\n      lin_upper: lin_upper,\n      ang_lower: ang_lower,\n      ang_upper: ang_upper\n    });\n  };\n  Physijs.SliderConstraint.prototype.setRestitution = function(linear, angular) {\n    this.scene.execute(\n      'slider_setRestitution', {\n        constraint: this.id,\n        linear: linear,\n        angular: angular\n      }\n    );\n  };\n  Physijs.SliderConstraint.prototype.enableLinearMotor = function(velocity, acceleration) {\n    this.scene.execute('slider_enableLinearMotor', {\n      constraint: this.id,\n      velocity: velocity,\n      acceleration: acceleration\n    });\n  };\n  Physijs.SliderConstraint.prototype.disableLinearMotor = function() {\n    this.scene.execute('slider_disableLinearMotor', {\n      constraint: this.id\n    });\n  };\n  Physijs.SliderConstraint.prototype.enableAngularMotor = function(velocity, acceleration) {\n    this.scene.execute('slider_enableAngularMotor', {\n      constraint: this.id,\n      velocity: velocity,\n      acceleration: acceleration\n    });\n  };\n  Physijs.SliderConstraint.prototype.disableAngularMotor = function() {\n    this.scene.execute('slider_disableAngularMotor', {\n      constraint: this.id\n    });\n  };\n\n  Physijs.ConeTwistConstraint = function(objecta, objectb, position) {\n    if (position === undefined) {\n      throw 'Both objects must be defined in a ConeTwistConstraint.';\n    }\n    this.type = 'conetwist';\n    this.appliedImpulse = 0;\n    this.id = getObjectId();\n    this.scene = objecta.parent;\n    this.objecta = objecta._physijs.id;\n    this.positiona = convertWorldPositionToObject(position, objecta).clone();\n    this.objectb = objectb._physijs.id;\n    this.positionb = convertWorldPositionToObject(position, objectb).clone();\n    this.axisa = {\n      x: objecta.rotation.x,\n      y: objecta.rotation.y,\n      z: objecta.rotation.z\n    };\n    this.axisb = {\n      x: objectb.rotation.x,\n      y: objectb.rotation.y,\n      z: objectb.rotation.z\n    };\n  };\n  Physijs.ConeTwistConstraint.prototype.getDefinition = function() {\n    return {\n      type: this.type,\n      id: this.id,\n      objecta: this.objecta,\n      objectb: this.objectb,\n      positiona: this.positiona,\n      positionb: this.positionb,\n      axisa: this.axisa,\n      axisb: this.axisb\n    };\n  };\n  Physijs.ConeTwistConstraint.prototype.setLimit = function(x, y, z) {\n    this.scene.execute('conetwist_setLimit', {\n      constraint: this.id,\n      x: x,\n      y: y,\n      z: z\n    });\n  };\n  Physijs.ConeTwistConstraint.prototype.enableMotor = function() {\n    this.scene.execute('conetwist_enableMotor', {\n      constraint: this.id\n    });\n  };\n  Physijs.ConeTwistConstraint.prototype.setMaxMotorImpulse = function(max_impulse) {\n    this.scene.execute('conetwist_setMaxMotorImpulse', {\n      constraint: this.id,\n      max_impulse: max_impulse\n    });\n  };\n  Physijs.ConeTwistConstraint.prototype.setMotorTarget = function(target) {\n    if (target instanceof THREE.Vector3) {\n      target = new THREE.Quaternion().setFromEuler(new THREE.Euler(target.x, target.y, target.z));\n    }\n    else if (target instanceof THREE.Euler) {\n      target = new THREE.Quaternion().setFromEuler(target);\n    }\n    else if (target instanceof THREE.Matrix4) {\n      target = new THREE.Quaternion().setFromRotationMatrix(target);\n    }\n    this.scene.execute('conetwist_setMotorTarget', {\n      constraint: this.id,\n      x: target.x,\n      y: target.y,\n      z: target.z,\n      w: target.w\n    });\n  };\n  Physijs.ConeTwistConstraint.prototype.disableMotor = function() {\n    this.scene.execute('conetwist_disableMotor', {\n      constraint: this.id\n    });\n  };\n\n  Physijs.DOFConstraint = function(objecta, objectb, position) {\n    if (position === undefined) {\n      position = objectb;\n      objectb = undefined;\n    }\n    this.type = 'dof';\n    this.appliedImpulse = 0;\n    this.id = getObjectId();\n    this.scene = objecta.parent;\n    this.objecta = objecta._physijs.id;\n    this.positiona = convertWorldPositionToObject(position, objecta).clone();\n    this.axisa = {\n      x: objecta.rotation.x,\n      y: objecta.rotation.y,\n      z: objecta.rotation.z\n    };\n\n    if (objectb) {\n      this.objectb = objectb._physijs.id;\n      this.positionb = convertWorldPositionToObject(position, objectb).clone();\n      this.axisb = {\n        x: objectb.rotation.x,\n        y: objectb.rotation.y,\n        z: objectb.rotation.z\n      };\n    }\n  };\n  Physijs.DOFConstraint.prototype.getDefinition = function() {\n    return {\n      type: this.type,\n      id: this.id,\n      objecta: this.objecta,\n      objectb: this.objectb,\n      positiona: this.positiona,\n      positionb: this.positionb,\n      axisa: this.axisa,\n      axisb: this.axisb\n    };\n  };\n  Physijs.DOFConstraint.prototype.setLinearLowerLimit = function(limit) {\n    this.scene.execute('dof_setLinearLowerLimit', {\n      constraint: this.id,\n      x: limit.x,\n      y: limit.y,\n      z: limit.z\n    });\n  };\n  Physijs.DOFConstraint.prototype.setLinearUpperLimit = function(limit) {\n    this.scene.execute('dof_setLinearUpperLimit', {\n      constraint: this.id,\n      x: limit.x,\n      y: limit.y,\n      z: limit.z\n    });\n  };\n  Physijs.DOFConstraint.prototype.setAngularLowerLimit = function(limit) {\n    this.scene.execute('dof_setAngularLowerLimit', {\n      constraint: this.id,\n      x: limit.x,\n      y: limit.y,\n      z: limit.z\n    });\n  };\n  Physijs.DOFConstraint.prototype.setAngularUpperLimit = function(limit) {\n    this.scene.execute('dof_setAngularUpperLimit', {\n      constraint: this.id,\n      x: limit.x,\n      y: limit.y,\n      z: limit.z\n    });\n  };\n  Physijs.DOFConstraint.prototype.enableAngularMotor = function(which) {\n    this.scene.execute('dof_enableAngularMotor', {\n      constraint: this.id,\n      which: which\n    });\n  };\n  Physijs.DOFConstraint.prototype.configureAngularMotor = function(which, low_angle, high_angle, velocity, max_force) {\n    this.scene.execute('dof_configureAngularMotor', {\n      constraint: this.id,\n      which: which,\n      low_angle: low_angle,\n      high_angle: high_angle,\n      velocity: velocity,\n      max_force: max_force\n    });\n  };\n  Physijs.DOFConstraint.prototype.disableAngularMotor = function(which) {\n    this.scene.execute('dof_disableAngularMotor', {\n      constraint: this.id,\n      which: which\n    });\n  };\n\n  // Physijs.Scene\n  Physijs.Scene = function(params) {\n    var self = this;\n\n    Eventable.call(this);\n    THREE.Scene.call(this);\n\n    this._worker = new Worker(Physijs.scripts.worker || 'physijsWorker.js');\n    this._worker.transferableMessage = this._worker.webkitPostMessage || this._worker.postMessage;\n    this._materials_ref_counts = {};\n    this._objects = {};\n    this._vehicles = {};\n    this._constraints = {};\n\n    var ab = new ArrayBuffer(1);\n    this._worker.transferableMessage(ab, [ab]);\n    SUPPORT_TRANSFERABLE = (ab.byteLength === 0);\n\n    this._worker.onerror = function(event) {\n      console.log(event.message);\n      console.log(event.filename);\n      console.log(event.lineno);\n    };\n\n    this._worker.onmessage = function(event) {\n      var _temp,\n        data = event.data;\n\n      if (data instanceof ArrayBuffer && data.byteLength !== 1) { // byteLength === 1 is the worker making a SUPPORT_TRANSFERABLE test\n        data = new Float32Array(data);\n      }\n\n      if (data instanceof Float32Array) {\n\n        // transferable object\n        switch (data[0]) {\n          case MESSAGE_TYPES.WORLDREPORT:\n            self._updateScene(data);\n            break;\n\n          case MESSAGE_TYPES.COLLISIONREPORT:\n            self._updateCollisions(data);\n            break;\n\n          case MESSAGE_TYPES.VEHICLEREPORT:\n            self._updateVehicles(data);\n            break;\n\n          case MESSAGE_TYPES.CONSTRAINTREPORT:\n            self._updateConstraints(data);\n            break;\n        }\n\n      }\n      else {\n\n        if (data.cmd) {\n\n          // non-transferable object\n          switch (data.cmd) {\n            case 'objectReady':\n              _temp = data.params;\n              if (self._objects[_temp]) {\n                self._objects[_temp].dispatchEvent('ready');\n              }\n              break;\n\n            case 'worldReady':\n              self.dispatchEvent('ready');\n              break;\n\n            case 'vehicle':\n              window.test = data;\n              break;\n\n            default:\n              // Do nothing, just show the message\n              console.debug('Received: ' + data.cmd);\n              console.dir(data.params);\n              break;\n          }\n\n        }\n        else {\n\n          switch (data[0]) {\n            case MESSAGE_TYPES.WORLDREPORT:\n              self._updateScene(data);\n              break;\n\n            case MESSAGE_TYPES.COLLISIONREPORT:\n              self._updateCollisions(data);\n              break;\n\n            case MESSAGE_TYPES.VEHICLEREPORT:\n              self._updateVehicles(data);\n              break;\n\n            case MESSAGE_TYPES.CONSTRAINTREPORT:\n              self._updateConstraints(data);\n              break;\n          }\n\n        }\n\n      }\n    };\n\n\n    params = params || {};\n    params.ammo = Physijs.scripts.ammo || 'ammo.js';\n    params.fixedTimeStep = params.fixedTimeStep || 1 / 60;\n    params.rateLimit = params.rateLimit || true;\n    this.execute('init', params);\n  };\n  Physijs.Scene.prototype = new THREE.Scene;\n  Physijs.Scene.prototype.constructor = Physijs.Scene;\n  Eventable.make(Physijs.Scene);\n\n  Physijs.Scene.prototype._updateScene = function(data) {\n    var num_objects = data[1],\n      object,\n      i, offset;\n\n    for (i = 0; i < num_objects; i++) {\n      offset = 2 + i * REPORT_ITEMSIZE;\n      object = this._objects[data[offset]];\n\n      if (object === undefined) {\n        continue;\n      }\n\n      if (object.__dirtyPosition === false) {\n        object.position.set(\n          data[offset + 1],\n          data[offset + 2],\n          data[offset + 3]\n        );\n      }\n\n      if (object.__dirtyRotation === false) {\n        object.quaternion.set(\n          data[offset + 4],\n          data[offset + 5],\n          data[offset + 6],\n          data[offset + 7]\n        );\n      }\n\n      object._physijs.linearVelocity.set(\n        data[offset + 8],\n        data[offset + 9],\n        data[offset + 10]\n      );\n\n      object._physijs.angularVelocity.set(\n        data[offset + 11],\n        data[offset + 12],\n        data[offset + 13]\n      );\n\n    }\n\n    if (SUPPORT_TRANSFERABLE) {\n      // Give the typed array back to the worker\n      this._worker.transferableMessage(data.buffer, [data.buffer]);\n    }\n\n    _is_simulating = false;\n    this.dispatchEvent('update');\n  };\n\n  Physijs.Scene.prototype._updateVehicles = function(data) {\n    var vehicle, wheel,\n      i, offset;\n\n    for (i = 0; i < (data.length - 1) / VEHICLEREPORT_ITEMSIZE; i++) {\n      offset = 1 + i * VEHICLEREPORT_ITEMSIZE;\n      vehicle = this._vehicles[data[offset]];\n\n      if (vehicle === undefined) {\n        continue;\n      }\n\n      wheel = vehicle.wheels[data[offset + 1]];\n\n      wheel.position.set(\n        data[offset + 2],\n        data[offset + 3],\n        data[offset + 4]\n      );\n\n      wheel.quaternion.set(\n        data[offset + 5],\n        data[offset + 6],\n        data[offset + 7],\n        data[offset + 8]\n      );\n    }\n\n    if (SUPPORT_TRANSFERABLE) {\n      // Give the typed array back to the worker\n      this._worker.transferableMessage(data.buffer, [data.buffer]);\n    }\n  };\n\n  Physijs.Scene.prototype._updateConstraints = function(data) {\n    var constraint, object,\n      i, offset;\n\n    for (i = 0; i < (data.length - 1) / CONSTRAINTREPORT_ITEMSIZE; i++) {\n      offset = 1 + i * CONSTRAINTREPORT_ITEMSIZE;\n      constraint = this._constraints[data[offset]];\n      object = this._objects[data[offset + 1]];\n\n      if (constraint === undefined || object === undefined) {\n        continue;\n      }\n\n      _temp_vector3_1.set(\n        data[offset + 2],\n        data[offset + 3],\n        data[offset + 4]\n      );\n      _temp_matrix4_1.extractRotation(object.matrix);\n      _temp_vector3_1.applyMatrix4(_temp_matrix4_1);\n\n      constraint.positiona.addVectors(object.position, _temp_vector3_1);\n      constraint.appliedImpulse = data[offset + 5];\n    }\n\n    if (SUPPORT_TRANSFERABLE) {\n      // Give the typed array back to the worker\n      this._worker.transferableMessage(data.buffer, [data.buffer]);\n    }\n  };\n\n  Physijs.Scene.prototype._updateCollisions = function(data) {\n    /**\n     * #TODO\n     * This is probably the worst way ever to handle collisions. The inherent evilness is a residual\n     * effect from the previous version's evilness which mutated when switching to transferable objects.\n     *\n     * If you feel inclined to make this better, please do so.\n     */\n\n    var i, j, offset, object, object2, id1, id2,\n      collisions = {},\n      normal_offsets = {};\n\n    // Build collision manifest\n    for (i = 0; i < data[1]; i++) {\n      offset = 2 + i * COLLISIONREPORT_ITEMSIZE;\n      object = data[offset];\n      object2 = data[offset + 1];\n\n      normal_offsets[object + '-' + object2] = offset + 2;\n      normal_offsets[object2 + '-' + object] = -1 * (offset + 2);\n\n      // Register collisions for both the object colliding and the object being collided with\n      if (!collisions[object]) collisions[object] = [];\n      collisions[object].push(object2);\n\n      if (!collisions[object2]) collisions[object2] = [];\n      collisions[object2].push(object);\n    }\n\n    // Deal with collisions\n    for (id1 in this._objects) {\n      if (!this._objects.hasOwnProperty(id1)) continue;\n      object = this._objects[id1];\n\n      // If object touches anything, ...\n      if (collisions[id1]) {\n\n        // Clean up touches array\n        for (j = 0; j < object._physijs.touches.length; j++) {\n          if (collisions[id1].indexOf(object._physijs.touches[j]) === -1) {\n            object._physijs.touches.splice(j--, 1);\n          }\n        }\n\n        // Handle each colliding object\n        for (j = 0; j < collisions[id1].length; j++) {\n          id2 = collisions[id1][j];\n          object2 = this._objects[id2];\n\n          if (object2) {\n            // If object was not already touching object2, notify object\n            if (object._physijs.touches.indexOf(id2) === -1) {\n              object._physijs.touches.push(id2);\n\n              _temp_vector3_1.subVectors(object.getLinearVelocity(), object2.getLinearVelocity());\n              _temp1 = _temp_vector3_1.clone();\n\n              _temp_vector3_1.subVectors(object.getAngularVelocity(), object2.getAngularVelocity());\n              _temp2 = _temp_vector3_1.clone();\n\n              var normal_offset = normal_offsets[object._physijs.id + '-' + object2._physijs.id];\n              if (normal_offset > 0) {\n                _temp_vector3_1.set(-data[normal_offset], -data[normal_offset + 1], -data[normal_offset + 2]);\n              }\n              else {\n                normal_offset *= -1;\n                _temp_vector3_1.set(\n                  data[normal_offset],\n                  data[normal_offset + 1],\n                  data[normal_offset + 2]\n                );\n              }\n\n              object.dispatchEvent('collision', object2, _temp1, _temp2, _temp_vector3_1);\n            }\n          }\n        }\n\n      }\n      else {\n\n        // not touching other objects\n        object._physijs.touches.length = 0;\n\n      }\n\n    }\n\n    this.collisions = collisions;\n\n    if (SUPPORT_TRANSFERABLE) {\n      // Give the typed array back to the worker\n      this._worker.transferableMessage(data.buffer, [data.buffer]);\n    }\n  };\n\n  Physijs.Scene.prototype.addConstraint = function(constraint, show_marker) {\n    this._constraints[constraint.id] = constraint;\n    this.execute('addConstraint', constraint.getDefinition());\n\n    if (show_marker) {\n      var marker;\n\n      switch (constraint.type) {\n        case 'point':\n          marker = new THREE.Mesh(\n            new THREE.SphereGeometry(1.5),\n            new THREE.MeshNormalMaterial\n          );\n          marker.position.copy(constraint.positiona);\n          this._objects[constraint.objecta].add(marker);\n          break;\n\n        case 'hinge':\n          marker = new THREE.Mesh(\n            new THREE.SphereGeometry(1.5),\n            new THREE.MeshNormalMaterial\n          );\n          marker.position.copy(constraint.positiona);\n          this._objects[constraint.objecta].add(marker);\n          break;\n\n        case 'slider':\n          marker = new THREE.Mesh(\n            new THREE.BoxGeometry(10, 1, 1),\n            new THREE.MeshNormalMaterial\n          );\n          marker.position.copy(constraint.positiona);\n          // This rotation isn't right if all three axis are non-0 values\n          // TODO: change marker's rotation order to ZYX\n          marker.rotation.set(\n            constraint.axis.y, // yes, y and\n            constraint.axis.x, // x axis are swapped\n            constraint.axis.z\n          );\n          this._objects[constraint.objecta].add(marker);\n          break;\n\n        case 'conetwist':\n          marker = new THREE.Mesh(\n            new THREE.SphereGeometry(1.5),\n            new THREE.MeshNormalMaterial\n          );\n          marker.position.copy(constraint.positiona);\n          this._objects[constraint.objecta].add(marker);\n          break;\n\n        case 'dof':\n          marker = new THREE.Mesh(\n            new THREE.SphereGeometry(1.5),\n            new THREE.MeshNormalMaterial\n          );\n          marker.position.copy(constraint.positiona);\n          this._objects[constraint.objecta].add(marker);\n          break;\n      }\n    }\n\n    return constraint;\n  };\n\n  Physijs.Scene.prototype.onSimulationResume = function() {\n    this.execute('onSimulationResume', {});\n  };\n\n  Physijs.Scene.prototype.removeConstraint = function(constraint) {\n    if (this._constraints[constraint.id] !== undefined) {\n      this.execute('removeConstraint', {\n        id: constraint.id\n      });\n      delete this._constraints[constraint.id];\n    }\n  };\n\n  Physijs.Scene.prototype.execute = function(cmd, params) {\n    this._worker.postMessage({\n      cmd: cmd,\n      params: params\n    });\n  };\n\n  addObjectChildren = function(parent, object) {\n    var i;\n\n    for (i = 0; i < object.children.length; i++) {\n      if (object.children[i]._physijs) {\n        object.children[i].updateMatrix();\n        object.children[i].updateMatrixWorld();\n\n        _temp_vector3_1.setFromMatrixPosition(object.children[i].matrixWorld);\n        _quaternion_1.setFromRotationMatrix(object.children[i].matrixWorld);\n\n        object.children[i]._physijs.position_offset = {\n          x: _temp_vector3_1.x,\n          y: _temp_vector3_1.y,\n          z: _temp_vector3_1.z\n        };\n\n        object.children[i]._physijs.rotation = {\n          x: _quaternion_1.x,\n          y: _quaternion_1.y,\n          z: _quaternion_1.z,\n          w: _quaternion_1.w\n        };\n\n        parent._physijs.children.push(object.children[i]._physijs);\n      }\n\n      addObjectChildren(parent, object.children[i]);\n    }\n  };\n\n  Physijs.Scene.prototype.add = function(object) {\n    THREE.Mesh.prototype.add.call(this, object);\n\n    if (object._physijs) {\n\n      object.world = this;\n\n      if (object instanceof Physijs.Vehicle) {\n\n        this.add(object.mesh);\n        this._vehicles[object._physijs.id] = object;\n        this.execute('addVehicle', object._physijs);\n\n      }\n      else {\n\n        object.__dirtyPosition = false;\n        object.__dirtyRotation = false;\n        this._objects[object._physijs.id] = object;\n\n        if (object.children.length) {\n          object._physijs.children = [];\n          addObjectChildren(object, object);\n        }\n\n        if (object.material._physijs) {\n          if (!this._materials_ref_counts.hasOwnProperty(object.material._physijs.id)) {\n            this.execute('registerMaterial', object.material._physijs);\n            object._physijs.materialId = object.material._physijs.id;\n            this._materials_ref_counts[object.material._physijs.id] = 1;\n          }\n          else {\n            this._materials_ref_counts[object.material._physijs.id]++;\n          }\n        }\n\n        // Object starting position + rotation\n        object._physijs.position = {\n          x: object.position.x,\n          y: object.position.y,\n          z: object.position.z\n        };\n        object._physijs.rotation = {\n          x: object.quaternion.x,\n          y: object.quaternion.y,\n          z: object.quaternion.z,\n          w: object.quaternion.w\n        };\n\n        // Check for scaling\n        var mass_scaling = new THREE.Vector3(1, 1, 1);\n        if (object._physijs.width) {\n          object._physijs.width *= object.scale.x;\n        }\n        if (object._physijs.height) {\n          object._physijs.height *= object.scale.y;\n        }\n        if (object._physijs.depth) {\n          object._physijs.depth *= object.scale.z;\n        }\n\n        this.execute('addObject', object._physijs);\n\n      }\n    }\n  };\n\n  Physijs.Scene.prototype.remove = function(object) {\n    if (object instanceof Physijs.Vehicle) {\n      this.execute('removeVehicle', {\n        id: object._physijs.id\n      });\n      while (object.wheels.length) {\n        this.remove(object.wheels.pop());\n      }\n      this.remove(object.mesh);\n      delete this._vehicles[object._physijs.id];\n    }\n    else {\n      THREE.Mesh.prototype.remove.call(this, object);\n      if (object._physijs) {\n        delete this._objects[object._physijs.id];\n        this.execute('removeObject', {\n          id: object._physijs.id\n        });\n      }\n    }\n    if (object.material && object.material._physijs && this._materials_ref_counts.hasOwnProperty(object.material._physijs.id)) {\n      this._materials_ref_counts[object.material._physijs.id]--;\n      if (this._materials_ref_counts[object.material._physijs.id] == 0) {\n        this.execute('unRegisterMaterial', object.material._physijs);\n        delete this._materials_ref_counts[object.material._physijs.id];\n      }\n    }\n  };\n\n  Physijs.Scene.prototype.setFixedTimeStep = function(fixedTimeStep) {\n    if (fixedTimeStep) {\n      this.execute('setFixedTimeStep', fixedTimeStep);\n    }\n  };\n\n  Physijs.Scene.prototype.setGravity = function(gravity) {\n    if (gravity) {\n      this.execute('setGravity', gravity);\n    }\n  };\n\n  Physijs.Scene.prototype.simulate = function(timeStep, maxSubSteps) {\n    var object_id, object, update;\n\n    if (_is_simulating) {\n      return false;\n    }\n\n    _is_simulating = true;\n\n    for (object_id in this._objects) {\n      if (!this._objects.hasOwnProperty(object_id)) continue;\n\n      object = this._objects[object_id];\n\n      if (object.__dirtyPosition || object.__dirtyRotation) {\n        update = {\n          id: object._physijs.id\n        };\n\n        if (object.__dirtyPosition) {\n          update.pos = {\n            x: object.position.x,\n            y: object.position.y,\n            z: object.position.z\n          };\n          object.__dirtyPosition = false;\n        }\n\n        if (object.__dirtyRotation) {\n          update.quat = {\n            x: object.quaternion.x,\n            y: object.quaternion.y,\n            z: object.quaternion.z,\n            w: object.quaternion.w\n          };\n          object.__dirtyRotation = false;\n        }\n\n        this.execute('updateTransform', update);\n      }\n    }\n\n    this.execute('simulate', {\n      timeStep: timeStep,\n      maxSubSteps: maxSubSteps\n    });\n\n    return true;\n  };\n\n\n  // Phsijs.Mesh\n  Physijs.Mesh = function(geometry, material, mass) {\n    var index;\n\n    if (!geometry) {\n      return;\n    }\n\n    Eventable.call(this);\n    THREE.Mesh.call(this, geometry, material);\n\n    if (!geometry.boundingBox) {\n      geometry.computeBoundingBox();\n    }\n\n    this._physijs = {\n      type: null,\n      id: getObjectId(),\n      mass: mass || 0,\n      touches: [],\n      linearVelocity: new THREE.Vector3,\n      angularVelocity: new THREE.Vector3\n    };\n  };\n  Physijs.Mesh.prototype = new THREE.Mesh;\n  Physijs.Mesh.prototype.constructor = Physijs.Mesh;\n  Eventable.make(Physijs.Mesh);\n\n  // Physijs.Mesh.mass\n  Physijs.Mesh.prototype.__defineGetter__('mass', function() {\n    return this._physijs.mass;\n  });\n  Physijs.Mesh.prototype.__defineSetter__('mass', function(mass) {\n    this._physijs.mass = mass;\n    if (this.world) {\n      this.world.execute('updateMass', {\n        id: this._physijs.id,\n        mass: mass\n      });\n    }\n  });\n\n  // Physijs.Mesh.applyCentralImpulse\n  Physijs.Mesh.prototype.applyCentralImpulse = function(force) {\n    if (this.world) {\n      this.world.execute('applyCentralImpulse', {\n        id: this._physijs.id,\n        x: force.x,\n        y: force.y,\n        z: force.z\n      });\n    }\n  };\n\n  // Physijs.Mesh.applyImpulse\n  Physijs.Mesh.prototype.applyImpulse = function(force, offset) {\n    if (this.world) {\n      this.world.execute('applyImpulse', {\n        id: this._physijs.id,\n        impulse_x: force.x,\n        impulse_y: force.y,\n        impulse_z: force.z,\n        x: offset.x,\n        y: offset.y,\n        z: offset.z\n      });\n    }\n  };\n\n  // Physijs.Mesh.applyTorque\n  Physijs.Mesh.prototype.applyTorque = function(force) {\n    if (this.world) {\n      this.world.execute('applyTorque', {\n        id: this._physijs.id,\n        torque_x: force.x,\n        torque_y: force.y,\n        torque_z: force.z\n      });\n    }\n  };\n\n  // Physijs.Mesh.applyCentralForce\n  Physijs.Mesh.prototype.applyCentralForce = function(force) {\n    if (this.world) {\n      this.world.execute('applyCentralForce', {\n        id: this._physijs.id,\n        x: force.x,\n        y: force.y,\n        z: force.z\n      });\n    }\n  };\n\n  // Physijs.Mesh.applyForce\n  Physijs.Mesh.prototype.applyForce = function(force, offset) {\n    if (this.world) {\n      this.world.execute('applyForce', {\n        id: this._physijs.id,\n        force_x: force.x,\n        force_y: force.y,\n        force_z: force.z,\n        x: offset.x,\n        y: offset.y,\n        z: offset.z\n      });\n    }\n  };\n\n  // Physijs.Mesh.getAngularVelocity\n  Physijs.Mesh.prototype.getAngularVelocity = function() {\n    return this._physijs.angularVelocity;\n  };\n\n  // Physijs.Mesh.setAngularVelocity\n  Physijs.Mesh.prototype.setAngularVelocity = function(velocity) {\n    if (this.world) {\n      this.world.execute('setAngularVelocity', {\n        id: this._physijs.id,\n        x: velocity.x,\n        y: velocity.y,\n        z: velocity.z\n      });\n    }\n  };\n\n  // Physijs.Mesh.getLinearVelocity\n  Physijs.Mesh.prototype.getLinearVelocity = function() {\n    return this._physijs.linearVelocity;\n  };\n\n  // Physijs.Mesh.setLinearVelocity\n  Physijs.Mesh.prototype.setLinearVelocity = function(velocity) {\n    if (this.world) {\n      this.world.execute('setLinearVelocity', {\n        id: this._physijs.id,\n        x: velocity.x,\n        y: velocity.y,\n        z: velocity.z\n      });\n    }\n  };\n\n  // Physijs.Mesh.setAngularFactor\n  Physijs.Mesh.prototype.setAngularFactor = function(factor) {\n    if (this.world) {\n      this.world.execute('setAngularFactor', {\n        id: this._physijs.id,\n        x: factor.x,\n        y: factor.y,\n        z: factor.z\n      });\n    }\n  };\n\n  // Physijs.Mesh.setLinearFactor\n  Physijs.Mesh.prototype.setLinearFactor = function(factor) {\n    if (this.world) {\n      this.world.execute('setLinearFactor', {\n        id: this._physijs.id,\n        x: factor.x,\n        y: factor.y,\n        z: factor.z\n      });\n    }\n  };\n\n  // Physijs.Mesh.setDamping\n  Physijs.Mesh.prototype.setDamping = function(linear, angular) {\n    if (this.world) {\n      this.world.execute('setDamping', {\n        id: this._physijs.id,\n        linear: linear,\n        angular: angular\n      });\n    }\n  };\n\n  // Physijs.Mesh.setCcdMotionThreshold\n  Physijs.Mesh.prototype.setCcdMotionThreshold = function(threshold) {\n    if (this.world) {\n      this.world.execute('setCcdMotionThreshold', {\n        id: this._physijs.id,\n        threshold: threshold\n      });\n    }\n  };\n\n  // Physijs.Mesh.setCcdSweptSphereRadius\n  Physijs.Mesh.prototype.setCcdSweptSphereRadius = function(radius) {\n    if (this.world) {\n      this.world.execute('setCcdSweptSphereRadius', {\n        id: this._physijs.id,\n        radius: radius\n      });\n    }\n  };\n\n\n  // Physijs.PlaneMesh\n  Physijs.PlaneMesh = function(geometry, material, mass) {\n    var width, height;\n\n    Physijs.Mesh.call(this, geometry, material, mass);\n\n    if (!geometry.boundingBox) {\n      geometry.computeBoundingBox();\n    }\n\n    width = geometry.boundingBox.max.x - geometry.boundingBox.min.x;\n    height = geometry.boundingBox.max.y - geometry.boundingBox.min.y;\n\n    this._physijs.type = 'plane';\n    this._physijs.normal = geometry.faces[0].normal.clone();\n    this._physijs.mass = (typeof mass === 'undefined') ? width * height : mass;\n  };\n  Physijs.PlaneMesh.prototype = new Physijs.Mesh;\n  Physijs.PlaneMesh.prototype.constructor = Physijs.PlaneMesh;\n\n  // Physijs.HeightfieldMesh\n  Physijs.HeightfieldMesh = function(geometry, material, mass, xdiv, ydiv) {\n    Physijs.Mesh.call(this, geometry, material, mass);\n\n    this._physijs.type = 'heightfield';\n    this._physijs.xsize = geometry.boundingBox.max.x - geometry.boundingBox.min.x;\n    this._physijs.ysize = geometry.boundingBox.max.y - geometry.boundingBox.min.y;\n    this._physijs.xpts = (typeof xdiv === 'undefined') ? Math.sqrt(geometry.vertices.length) : xdiv + 1;\n    this._physijs.ypts = (typeof ydiv === 'undefined') ? Math.sqrt(geometry.vertices.length) : ydiv + 1;\n    // note - this assumes our plane geometry is square, unless we pass in specific xdiv and ydiv\n    this._physijs.absMaxHeight = Math.max(geometry.boundingBox.max.z, Math.abs(geometry.boundingBox.min.z));\n\n    var points = [];\n\n    var a, b;\n    for (var i = 0; i < geometry.vertices.length; i++) {\n\n      a = i % this._physijs.xpts;\n      b = Math.round((i / this._physijs.xpts) - ((i % this._physijs.xpts) / this._physijs.xpts));\n      points[i] = geometry.vertices[a + ((this._physijs.ypts - b - 1) * this._physijs.ypts)].z;\n\n      //points[i] = geometry.vertices[i];\n    }\n\n    this._physijs.points = points;\n  };\n  Physijs.HeightfieldMesh.prototype = new Physijs.Mesh;\n  Physijs.HeightfieldMesh.prototype.constructor = Physijs.HeightfieldMesh;\n\n  // Physijs.BoxMesh\n  Physijs.BoxMesh = function(geometry, material, mass) {\n    var width, height, depth;\n\n    Physijs.Mesh.call(this, geometry, material, mass);\n\n    if (!geometry.boundingBox) {\n      geometry.computeBoundingBox();\n    }\n\n    width = geometry.boundingBox.max.x - geometry.boundingBox.min.x;\n    height = geometry.boundingBox.max.y - geometry.boundingBox.min.y;\n    depth = geometry.boundingBox.max.z - geometry.boundingBox.min.z;\n\n    this._physijs.type = 'box';\n    this._physijs.width = width;\n    this._physijs.height = height;\n    this._physijs.depth = depth;\n    this._physijs.mass = (typeof mass === 'undefined') ? width * height * depth : mass;\n  };\n  Physijs.BoxMesh.prototype = new Physijs.Mesh;\n  Physijs.BoxMesh.prototype.constructor = Physijs.BoxMesh;\n\n\n  // Physijs.SphereMesh\n  Physijs.SphereMesh = function(geometry, material, mass) {\n    Physijs.Mesh.call(this, geometry, material, mass);\n\n    if (!geometry.boundingSphere) {\n      geometry.computeBoundingSphere();\n    }\n\n    this._physijs.type = 'sphere';\n    this._physijs.radius = geometry.boundingSphere.radius;\n    this._physijs.mass = (typeof mass === 'undefined') ? (4 / 3) * Math.PI * Math.pow(this._physijs.radius, 3) : mass;\n  };\n  Physijs.SphereMesh.prototype = new Physijs.Mesh;\n  Physijs.SphereMesh.prototype.constructor = Physijs.SphereMesh;\n\n\n  // Physijs.CylinderMesh\n  Physijs.CylinderMesh = function(geometry, material, mass) {\n    var width, height, depth;\n\n    Physijs.Mesh.call(this, geometry, material, mass);\n\n    if (!geometry.boundingBox) {\n      geometry.computeBoundingBox();\n    }\n\n    width = geometry.boundingBox.max.x - geometry.boundingBox.min.x;\n    height = geometry.boundingBox.max.y - geometry.boundingBox.min.y;\n    depth = geometry.boundingBox.max.z - geometry.boundingBox.min.z;\n\n    this._physijs.type = 'cylinder';\n    this._physijs.width = width;\n    this._physijs.height = height;\n    this._physijs.depth = depth;\n    this._physijs.mass = (typeof mass === 'undefined') ? width * height * depth : mass;\n  };\n  Physijs.CylinderMesh.prototype = new Physijs.Mesh;\n  Physijs.CylinderMesh.prototype.constructor = Physijs.CylinderMesh;\n\n\n  // Physijs.CapsuleMesh\n  Physijs.CapsuleMesh = function(geometry, material, mass) {\n    var width, height, depth;\n\n    Physijs.Mesh.call(this, geometry, material, mass);\n\n    if (!geometry.boundingBox) {\n      geometry.computeBoundingBox();\n    }\n\n    width = geometry.boundingBox.max.x - geometry.boundingBox.min.x;\n    height = geometry.boundingBox.max.y - geometry.boundingBox.min.y;\n    depth = geometry.boundingBox.max.z - geometry.boundingBox.min.z;\n\n    this._physijs.type = 'capsule';\n    this._physijs.radius = Math.max(width / 2, depth / 2);\n    this._physijs.height = height;\n    this._physijs.mass = (typeof mass === 'undefined') ? width * height * depth : mass;\n  };\n  Physijs.CapsuleMesh.prototype = new Physijs.Mesh;\n  Physijs.CapsuleMesh.prototype.constructor = Physijs.CapsuleMesh;\n\n\n  // Physijs.ConeMesh\n  Physijs.ConeMesh = function(geometry, material, mass) {\n    var width, height, depth;\n\n    Physijs.Mesh.call(this, geometry, material, mass);\n\n    if (!geometry.boundingBox) {\n      geometry.computeBoundingBox();\n    }\n\n    width = geometry.boundingBox.max.x - geometry.boundingBox.min.x;\n    height = geometry.boundingBox.max.y - geometry.boundingBox.min.y;\n\n    this._physijs.type = 'cone';\n    this._physijs.radius = width / 2;\n    this._physijs.height = height;\n    this._physijs.mass = (typeof mass === 'undefined') ? width * height : mass;\n  };\n  Physijs.ConeMesh.prototype = new Physijs.Mesh;\n  Physijs.ConeMesh.prototype.constructor = Physijs.ConeMesh;\n\n\n  // Physijs.ConcaveMesh\n  Physijs.ConcaveMesh = function(geometry, material, mass) {\n    var i,\n      width, height, depth,\n      vertices, face, triangles = [];\n\n    Physijs.Mesh.call(this, geometry, material, mass);\n\n    if (!geometry.boundingBox) {\n      geometry.computeBoundingBox();\n    }\n\n    vertices = geometry.vertices;\n\n    for (i = 0; i < geometry.faces.length; i++) {\n      face = geometry.faces[i];\n      if (face instanceof THREE.Face3) {\n\n        triangles.push([{\n          x: vertices[face.a].x,\n          y: vertices[face.a].y,\n          z: vertices[face.a].z\n        }, {\n          x: vertices[face.b].x,\n          y: vertices[face.b].y,\n          z: vertices[face.b].z\n        }, {\n          x: vertices[face.c].x,\n          y: vertices[face.c].y,\n          z: vertices[face.c].z\n        }]);\n\n      }\n      else if (face instanceof THREE.Face4) {\n\n        triangles.push([{\n          x: vertices[face.a].x,\n          y: vertices[face.a].y,\n          z: vertices[face.a].z\n        }, {\n          x: vertices[face.b].x,\n          y: vertices[face.b].y,\n          z: vertices[face.b].z\n        }, {\n          x: vertices[face.d].x,\n          y: vertices[face.d].y,\n          z: vertices[face.d].z\n        }]);\n        triangles.push([{\n          x: vertices[face.b].x,\n          y: vertices[face.b].y,\n          z: vertices[face.b].z\n        }, {\n          x: vertices[face.c].x,\n          y: vertices[face.c].y,\n          z: vertices[face.c].z\n        }, {\n          x: vertices[face.d].x,\n          y: vertices[face.d].y,\n          z: vertices[face.d].z\n        }]);\n\n      }\n    }\n\n    width = geometry.boundingBox.max.x - geometry.boundingBox.min.x;\n    height = geometry.boundingBox.max.y - geometry.boundingBox.min.y;\n    depth = geometry.boundingBox.max.z - geometry.boundingBox.min.z;\n\n    this._physijs.type = 'concave';\n    this._physijs.triangles = triangles;\n    this._physijs.mass = (typeof mass === 'undefined') ? width * height * depth : mass;\n  };\n  Physijs.ConcaveMesh.prototype = new Physijs.Mesh;\n  Physijs.ConcaveMesh.prototype.constructor = Physijs.ConcaveMesh;\n\n\n  // Physijs.ConvexMesh\n  Physijs.ConvexMesh = function(geometry, material, mass) {\n    var i,\n      width, height, depth,\n      points = [];\n\n    Physijs.Mesh.call(this, geometry, material, mass);\n\n    if (!geometry.boundingBox) {\n      geometry.computeBoundingBox();\n    }\n\n    for (i = 0; i < geometry.vertices.length; i++) {\n      points.push({\n        x: geometry.vertices[i].x,\n        y: geometry.vertices[i].y,\n        z: geometry.vertices[i].z\n      });\n    }\n\n\n    width = geometry.boundingBox.max.x - geometry.boundingBox.min.x;\n    height = geometry.boundingBox.max.y - geometry.boundingBox.min.y;\n    depth = geometry.boundingBox.max.z - geometry.boundingBox.min.z;\n\n    this._physijs.type = 'convex';\n    this._physijs.points = points;\n    this._physijs.mass = (typeof mass === 'undefined') ? width * height * depth : mass;\n  };\n  Physijs.ConvexMesh.prototype = new Physijs.Mesh;\n  Physijs.ConvexMesh.prototype.constructor = Physijs.ConvexMesh;\n\n\n  // Physijs.Vehicle\n  Physijs.Vehicle = function(mesh, tuning) {\n    tuning = tuning || new Physijs.VehicleTuning;\n    this.mesh = mesh;\n    this.wheels = [];\n    this._physijs = {\n      id: getObjectId(),\n      rigidBody: mesh._physijs.id,\n      suspension_stiffness: tuning.suspension_stiffness,\n      suspension_compression: tuning.suspension_compression,\n      suspension_damping: tuning.suspension_damping,\n      max_suspension_travel: tuning.max_suspension_travel,\n      friction_slip: tuning.friction_slip,\n      max_suspension_force: tuning.max_suspension_force\n    };\n  };\n  Physijs.Vehicle.prototype.addWheel = function(wheel_geometry, wheel_material, connection_point, wheel_direction, wheel_axle, suspension_rest_length, wheel_radius, is_front_wheel, tuning) {\n    var wheel = new THREE.Mesh(wheel_geometry, wheel_material);\n    wheel.castShadow = wheel.receiveShadow = true;\n    wheel.position.copy(wheel_direction).multiplyScalar(suspension_rest_length / 100).add(connection_point);\n    this.world.add(wheel);\n    this.wheels.push(wheel);\n\n    this.world.execute('addWheel', {\n      id: this._physijs.id,\n      connection_point: {\n        x: connection_point.x,\n        y: connection_point.y,\n        z: connection_point.z\n      },\n      wheel_direction: {\n        x: wheel_direction.x,\n        y: wheel_direction.y,\n        z: wheel_direction.z\n      },\n      wheel_axle: {\n        x: wheel_axle.x,\n        y: wheel_axle.y,\n        z: wheel_axle.z\n      },\n      suspension_rest_length: suspension_rest_length,\n      wheel_radius: wheel_radius,\n      is_front_wheel: is_front_wheel,\n      tuning: tuning\n    });\n  };\n  Physijs.Vehicle.prototype.setSteering = function(amount, wheel) {\n    if (wheel !== undefined && this.wheels[wheel] !== undefined) {\n      this.world.execute('setSteering', {\n        id: this._physijs.id,\n        wheel: wheel,\n        steering: amount\n      });\n    }\n    else if (this.wheels.length > 0) {\n      for (var i = 0; i < this.wheels.length; i++) {\n        this.world.execute('setSteering', {\n          id: this._physijs.id,\n          wheel: i,\n          steering: amount\n        });\n      }\n    }\n  };\n  Physijs.Vehicle.prototype.setBrake = function(amount, wheel) {\n    if (wheel !== undefined && this.wheels[wheel] !== undefined) {\n      this.world.execute('setBrake', {\n        id: this._physijs.id,\n        wheel: wheel,\n        brake: amount\n      });\n    }\n    else if (this.wheels.length > 0) {\n      for (var i = 0; i < this.wheels.length; i++) {\n        this.world.execute('setBrake', {\n          id: this._physijs.id,\n          wheel: i,\n          brake: amount\n        });\n      }\n    }\n  };\n  Physijs.Vehicle.prototype.applyEngineForce = function(amount, wheel) {\n    if (wheel !== undefined && this.wheels[wheel] !== undefined) {\n      this.world.execute('applyEngineForce', {\n        id: this._physijs.id,\n        wheel: wheel,\n        force: amount\n      });\n    }\n    else if (this.wheels.length > 0) {\n      for (var i = 0; i < this.wheels.length; i++) {\n        this.world.execute('applyEngineForce', {\n          id: this._physijs.id,\n          wheel: i,\n          force: amount\n        });\n      }\n    }\n  };\n\n  // Physijs.VehicleTuning\n  Physijs.VehicleTuning = function(suspension_stiffness, suspension_compression, suspension_damping, max_suspension_travel, friction_slip, max_suspension_force) {\n    this.suspension_stiffness = suspension_stiffness !== undefined ? suspension_stiffness : 5.88;\n    this.suspension_compression = suspension_compression !== undefined ? suspension_compression : 0.83;\n    this.suspension_damping = suspension_damping !== undefined ? suspension_damping : 0.88;\n    this.max_suspension_travel = max_suspension_travel !== undefined ? max_suspension_travel : 500;\n    this.friction_slip = friction_slip !== undefined ? friction_slip : 10.5;\n    this.max_suspension_force = max_suspension_force !== undefined ? max_suspension_force : 6000;\n  };\n\n  return Physijs;\n}\n\n","/** @preserve http://github.com/easeway/js-class */\n\n// Class Definition using ECMA5 prototype chain\n\nfunction inherit(dest, src, noParent) {\n    while (src && src !== Object.prototype) {\n        Object.getOwnPropertyNames(src).forEach(function (name) {\n            if (name != '.class' && !dest.hasOwnProperty(name)) {\n                var desc = Object.getOwnPropertyDescriptor(src, name);\n                Object.defineProperty(dest, name, desc);\n            }\n        });\n        if (noParent) {\n            break;\n        }\n        src = src.__proto__;\n    }\n    return dest;\n}\n\nvar Class = function (base, proto, options) {\n    if (typeof(base) != 'function') {\n        options = proto;\n        proto = base;\n        base = Object;\n    }\n    if (!proto) {\n        proto = {};\n    }\n    if (!options) {\n        options = {};\n    }\n    \n    var meta = {\n        name: options.name,\n        base: base,\n        implements: []\n    }\n    var classProto = Class.clone(proto);\n    if (options.implements) {\n        (Array.isArray(options.implements) ? options.implements : [options.implements])\n            .forEach(function (implementedType) {\n                if (typeof(implementedType) == 'function' && implementedType.prototype) {\n                    meta.implements.push(implementedType);\n                    Class.extend(classProto, implementedType.prototype);\n                }\n            });\n    }\n    classProto.__proto__ = base.prototype;\n    var theClass = function () {\n        if (typeof(this.constructor) == 'function') {\n            this.constructor.apply(this, arguments);\n        }\n    };\n    meta.type = theClass;\n    theClass.prototype = classProto;\n    Object.defineProperty(theClass, '.class.meta', { value: meta, enumerable: false, configurable: false, writable: false });\n    Object.defineProperty(classProto, '.class', { value: theClass, enumerable: false, configurable: false, writable: false });\n    if (options.statics) {\n        Class.extend(theClass, options.statics);\n    }\n    return theClass;\n};\n\nClass.extend = inherit;\n\nClass.clone = function (object) {\n    return inherit({}, object);\n};\n\nfunction findType(meta, type) {\n    while (meta) {\n        if (meta.type.prototype === type.prototype) {\n            return true;\n        }\n        for (var i in meta.implements) {\n            var implType = meta.implements[i];\n            var implMeta = implType['.class.meta'];\n            if (implMeta) {\n                if (findType(implMeta, type)) {\n                    return true;\n                }\n            } else {\n                for (var proto = implType.prototype; proto; proto = proto.__proto__) {\n                    if (proto === type.prototype) {\n                        return true;\n                    }\n                }\n            }\n        }\n        meta = meta.base ? meta.base['.class.meta'] : undefined;\n    }\n    return false;\n}\n\nvar Checker = Class({\n    constructor: function (object) {\n        this.object = object;\n    },\n    \n    typeOf: function (type) {\n        if (this.object instanceof type) {\n            return true;\n        }\n        var meta = Class.typeInfo(this.object);\n        return meta && findType(meta, type);\n    }\n});\n\n// aliases\nChecker.prototype.a = Checker.prototype.typeOf;\nChecker.prototype.an = Checker.prototype.typeOf;\n\nClass.is = function (object) {\n    return new Checker(object);\n};\n\nClass.typeInfo = function (object) {\n    var theClass = object.__proto__['.class'];\n    return theClass ? theClass['.class.meta'] : undefined;\n};\n\nClass.VERSION = [0, 0, 2];\n\nif (module) {\n    module.exports = Class;\n} else {\n    global.Class = Class;   // for browser\n}","/**\n * @author mrdoob / http://mrdoob.com/\n */\n\nvar Stats = function () {\n\n\tvar startTime = Date.now(), prevTime = startTime;\n\tvar ms = 0, msMin = Infinity, msMax = 0;\n\tvar fps = 0, fpsMin = Infinity, fpsMax = 0;\n\tvar frames = 0, mode = 0;\n\n\tvar container = document.createElement( 'div' );\n\tcontainer.id = 'stats';\n\tcontainer.addEventListener( 'mousedown', function ( event ) { event.preventDefault(); setMode( ++ mode % 2 ) }, false );\n\tcontainer.style.cssText = 'width:80px;opacity:0.9;cursor:pointer';\n\n\tvar fpsDiv = document.createElement( 'div' );\n\tfpsDiv.id = 'fps';\n\tfpsDiv.style.cssText = 'padding:0 0 3px 3px;text-align:left;background-color:#002';\n\tcontainer.appendChild( fpsDiv );\n\n\tvar fpsText = document.createElement( 'div' );\n\tfpsText.id = 'fpsText';\n\tfpsText.style.cssText = 'color:#0ff;font-family:Helvetica,Arial,sans-serif;font-size:9px;font-weight:bold;line-height:15px';\n\tfpsText.innerHTML = 'FPS';\n\tfpsDiv.appendChild( fpsText );\n\n\tvar fpsGraph = document.createElement( 'div' );\n\tfpsGraph.id = 'fpsGraph';\n\tfpsGraph.style.cssText = 'position:relative;width:74px;height:30px;background-color:#0ff';\n\tfpsDiv.appendChild( fpsGraph );\n\n\twhile ( fpsGraph.children.length < 74 ) {\n\n\t\tvar bar = document.createElement( 'span' );\n\t\tbar.style.cssText = 'width:1px;height:30px;float:left;background-color:#113';\n\t\tfpsGraph.appendChild( bar );\n\n\t}\n\n\tvar msDiv = document.createElement( 'div' );\n\tmsDiv.id = 'ms';\n\tmsDiv.style.cssText = 'padding:0 0 3px 3px;text-align:left;background-color:#020;display:none';\n\tcontainer.appendChild( msDiv );\n\n\tvar msText = document.createElement( 'div' );\n\tmsText.id = 'msText';\n\tmsText.style.cssText = 'color:#0f0;font-family:Helvetica,Arial,sans-serif;font-size:9px;font-weight:bold;line-height:15px';\n\tmsText.innerHTML = 'MS';\n\tmsDiv.appendChild( msText );\n\n\tvar msGraph = document.createElement( 'div' );\n\tmsGraph.id = 'msGraph';\n\tmsGraph.style.cssText = 'position:relative;width:74px;height:30px;background-color:#0f0';\n\tmsDiv.appendChild( msGraph );\n\n\twhile ( msGraph.children.length < 74 ) {\n\n\t\tvar bar = document.createElement( 'span' );\n\t\tbar.style.cssText = 'width:1px;height:30px;float:left;background-color:#131';\n\t\tmsGraph.appendChild( bar );\n\n\t}\n\n\tvar setMode = function ( value ) {\n\n\t\tmode = value;\n\n\t\tswitch ( mode ) {\n\n\t\t\tcase 0:\n\t\t\t\tfpsDiv.style.display = 'block';\n\t\t\t\tmsDiv.style.display = 'none';\n\t\t\t\tbreak;\n\t\t\tcase 1:\n\t\t\t\tfpsDiv.style.display = 'none';\n\t\t\t\tmsDiv.style.display = 'block';\n\t\t\t\tbreak;\n\t\t}\n\n\t};\n\n\tvar updateGraph = function ( dom, value ) {\n\n\t\tvar child = dom.appendChild( dom.firstChild );\n\t\tchild.style.height = value + 'px';\n\n\t};\n\n\treturn {\n\n\t\tREVISION: 12,\n\n\t\tdomElement: container,\n\n\t\tsetMode: setMode,\n\n\t\tbegin: function () {\n\n\t\t\tstartTime = Date.now();\n\n\t\t},\n\n\t\tend: function () {\n\n\t\t\tvar time = Date.now();\n\n\t\t\tms = time - startTime;\n\t\t\tmsMin = Math.min( msMin, ms );\n\t\t\tmsMax = Math.max( msMax, ms );\n\n\t\t\tmsText.textContent = ms + ' MS (' + msMin + '-' + msMax + ')';\n\t\t\tupdateGraph( msGraph, Math.min( 30, 30 - ( ms / 200 ) * 30 ) );\n\n\t\t\tframes ++;\n\n\t\t\tif ( time > prevTime + 1000 ) {\n\n\t\t\t\tfps = Math.round( ( frames * 1000 ) / ( time - prevTime ) );\n\t\t\t\tfpsMin = Math.min( fpsMin, fps );\n\t\t\t\tfpsMax = Math.max( fpsMax, fps );\n\n\t\t\t\tfpsText.textContent = fps + ' FPS (' + fpsMin + '-' + fpsMax + ')';\n\t\t\t\tupdateGraph( fpsGraph, Math.min( 30, 30 - ( fps / 100 ) * 30 ) );\n\n\t\t\t\tprevTime = time;\n\t\t\t\tframes = 0;\n\n\t\t\t}\n\n\t\t\treturn time;\n\n\t\t},\n\n\t\tupdate: function () {\n\n\t\t\tstartTime = this.end();\n\n\t\t}\n\n\t}\n\n};\n\nif ( typeof module === 'object' ) {\n\n\tmodule.exports = Stats;\n\n}","var self = self || {}; // File:src/Three.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nvar THREE = {\r\n  REVISION: '71'\r\n};\r\n\r\n// browserify support\r\n\r\nif (typeof module === 'object') {\r\n\r\n  module.exports = THREE;\r\n\r\n}\r\n\r\n// polyfills\r\n\r\nif (Math.sign === undefined) {\r\n\r\n  // https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Math/sign\r\n\r\n  Math.sign = function(x) {\r\n\r\n    return (x < 0) ? -1 : (x > 0) ? 1 : +x;\r\n\r\n  };\r\n\r\n}\r\n\r\n\r\n// set the default log handlers\r\nTHREE.log = function() {\r\n  console.log.apply(console, arguments);\r\n}\r\nTHREE.warn = function() {\r\n  console.warn.apply(console, arguments);\r\n}\r\nTHREE.error = function() {\r\n  console.error.apply(console, arguments);\r\n}\r\n\r\n\r\n// https://developer.mozilla.org/en-US/docs/Web/API/MouseEvent.button\r\n\r\nTHREE.MOUSE = {\r\n  LEFT: 0,\r\n  MIDDLE: 1,\r\n  RIGHT: 2\r\n};\r\n\r\n// GL STATE CONSTANTS\r\n\r\nTHREE.CullFaceNone = 0;\r\nTHREE.CullFaceBack = 1;\r\nTHREE.CullFaceFront = 2;\r\nTHREE.CullFaceFrontBack = 3;\r\n\r\nTHREE.FrontFaceDirectionCW = 0;\r\nTHREE.FrontFaceDirectionCCW = 1;\r\n\r\n// SHADOWING TYPES\r\n\r\nTHREE.BasicShadowMap = 0;\r\nTHREE.PCFShadowMap = 1;\r\nTHREE.PCFSoftShadowMap = 2;\r\n\r\n// MATERIAL CONSTANTS\r\n\r\n// side\r\n\r\nTHREE.FrontSide = 0;\r\nTHREE.BackSide = 1;\r\nTHREE.DoubleSide = 2;\r\n\r\n// shading\r\n\r\nTHREE.NoShading = 0;\r\nTHREE.FlatShading = 1;\r\nTHREE.SmoothShading = 2;\r\n\r\n// colors\r\n\r\nTHREE.NoColors = 0;\r\nTHREE.FaceColors = 1;\r\nTHREE.VertexColors = 2;\r\n\r\n// blending modes\r\n\r\nTHREE.NoBlending = 0;\r\nTHREE.NormalBlending = 1;\r\nTHREE.AdditiveBlending = 2;\r\nTHREE.SubtractiveBlending = 3;\r\nTHREE.MultiplyBlending = 4;\r\nTHREE.CustomBlending = 5;\r\n\r\n// custom blending equations\r\n// (numbers start from 100 not to clash with other\r\n//  mappings to OpenGL constants defined in Texture.js)\r\n\r\nTHREE.AddEquation = 100;\r\nTHREE.SubtractEquation = 101;\r\nTHREE.ReverseSubtractEquation = 102;\r\nTHREE.MinEquation = 103;\r\nTHREE.MaxEquation = 104;\r\n\r\n// custom blending destination factors\r\n\r\nTHREE.ZeroFactor = 200;\r\nTHREE.OneFactor = 201;\r\nTHREE.SrcColorFactor = 202;\r\nTHREE.OneMinusSrcColorFactor = 203;\r\nTHREE.SrcAlphaFactor = 204;\r\nTHREE.OneMinusSrcAlphaFactor = 205;\r\nTHREE.DstAlphaFactor = 206;\r\nTHREE.OneMinusDstAlphaFactor = 207;\r\n\r\n// custom blending source factors\r\n\r\n//THREE.ZeroFactor = 200;\r\n//THREE.OneFactor = 201;\r\n//THREE.SrcAlphaFactor = 204;\r\n//THREE.OneMinusSrcAlphaFactor = 205;\r\n//THREE.DstAlphaFactor = 206;\r\n//THREE.OneMinusDstAlphaFactor = 207;\r\nTHREE.DstColorFactor = 208;\r\nTHREE.OneMinusDstColorFactor = 209;\r\nTHREE.SrcAlphaSaturateFactor = 210;\r\n\r\n\r\n// TEXTURE CONSTANTS\r\n\r\nTHREE.MultiplyOperation = 0;\r\nTHREE.MixOperation = 1;\r\nTHREE.AddOperation = 2;\r\n\r\n// Mapping modes\r\n\r\nTHREE.UVMapping = 300;\r\n\r\nTHREE.CubeReflectionMapping = 301;\r\nTHREE.CubeRefractionMapping = 302;\r\n\r\nTHREE.EquirectangularReflectionMapping = 303;\r\nTHREE.EquirectangularRefractionMapping = 304;\r\n\r\nTHREE.SphericalReflectionMapping = 305;\r\n\r\n// Wrapping modes\r\n\r\nTHREE.RepeatWrapping = 1000;\r\nTHREE.ClampToEdgeWrapping = 1001;\r\nTHREE.MirroredRepeatWrapping = 1002;\r\n\r\n// Filters\r\n\r\nTHREE.NearestFilter = 1003;\r\nTHREE.NearestMipMapNearestFilter = 1004;\r\nTHREE.NearestMipMapLinearFilter = 1005;\r\nTHREE.LinearFilter = 1006;\r\nTHREE.LinearMipMapNearestFilter = 1007;\r\nTHREE.LinearMipMapLinearFilter = 1008;\r\n\r\n// Data types\r\n\r\nTHREE.UnsignedByteType = 1009;\r\nTHREE.ByteType = 1010;\r\nTHREE.ShortType = 1011;\r\nTHREE.UnsignedShortType = 1012;\r\nTHREE.IntType = 1013;\r\nTHREE.UnsignedIntType = 1014;\r\nTHREE.FloatType = 1015;\r\nTHREE.HalfFloatType = 1025;\r\n\r\n// Pixel types\r\n\r\n//THREE.UnsignedByteType = 1009;\r\nTHREE.UnsignedShort4444Type = 1016;\r\nTHREE.UnsignedShort5551Type = 1017;\r\nTHREE.UnsignedShort565Type = 1018;\r\n\r\n// Pixel formats\r\n\r\nTHREE.AlphaFormat = 1019;\r\nTHREE.RGBFormat = 1020;\r\nTHREE.RGBAFormat = 1021;\r\nTHREE.LuminanceFormat = 1022;\r\nTHREE.LuminanceAlphaFormat = 1023;\r\n// THREE.RGBEFormat handled as THREE.RGBAFormat in shaders\r\nTHREE.RGBEFormat = THREE.RGBAFormat; //1024;\r\n\r\n// DDS / ST3C Compressed texture formats\r\n\r\nTHREE.RGB_S3TC_DXT1_Format = 2001;\r\nTHREE.RGBA_S3TC_DXT1_Format = 2002;\r\nTHREE.RGBA_S3TC_DXT3_Format = 2003;\r\nTHREE.RGBA_S3TC_DXT5_Format = 2004;\r\n\r\n\r\n// PVRTC compressed texture formats\r\n\r\nTHREE.RGB_PVRTC_4BPPV1_Format = 2100;\r\nTHREE.RGB_PVRTC_2BPPV1_Format = 2101;\r\nTHREE.RGBA_PVRTC_4BPPV1_Format = 2102;\r\nTHREE.RGBA_PVRTC_2BPPV1_Format = 2103;\r\n\r\n\r\n// DEPRECATED\r\n\r\nTHREE.Projector = function() {\r\n\r\n  THREE.error('THREE.Projector has been moved to /examples/js/renderers/Projector.js.');\r\n\r\n  this.projectVector = function(vector, camera) {\r\n\r\n    THREE.warn('THREE.Projector: .projectVector() is now vector.project().');\r\n    vector.project(camera);\r\n\r\n  };\r\n\r\n  this.unprojectVector = function(vector, camera) {\r\n\r\n    THREE.warn('THREE.Projector: .unprojectVector() is now vector.unproject().');\r\n    vector.unproject(camera);\r\n\r\n  };\r\n\r\n  this.pickingRay = function(vector, camera) {\r\n\r\n    THREE.error('THREE.Projector: .pickingRay() is now raycaster.setFromCamera().');\r\n\r\n  };\r\n\r\n};\r\n\r\nTHREE.CanvasRenderer = function() {\r\n\r\n  THREE.error('THREE.CanvasRenderer has been moved to /examples/js/renderers/CanvasRenderer.js');\r\n\r\n  this.domElement = document.createElement('canvas');\r\n  this.clear = function() {};\r\n  this.render = function() {};\r\n  this.setClearColor = function() {};\r\n  this.setSize = function() {};\r\n\r\n};\r\n\r\n// File:src/math/Color.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.Color = function(color) {\r\n\r\n  if (arguments.length === 3) {\r\n\r\n    return this.setRGB(arguments[0], arguments[1], arguments[2]);\r\n\r\n  }\r\n\r\n  return this.set(color)\r\n\r\n};\r\n\r\nTHREE.Color.prototype = {\r\n\r\n  constructor: THREE.Color,\r\n\r\n  r: 1,\r\n  g: 1,\r\n  b: 1,\r\n\r\n  set: function(value) {\r\n\r\n    if (value instanceof THREE.Color) {\r\n\r\n      this.copy(value);\r\n\r\n    }\r\n    else if (typeof value === 'number') {\r\n\r\n      this.setHex(value);\r\n\r\n    }\r\n    else if (typeof value === 'string') {\r\n\r\n      this.setStyle(value);\r\n\r\n    }\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  setHex: function(hex) {\r\n\r\n    hex = Math.floor(hex);\r\n\r\n    this.r = (hex >> 16 & 255) / 255;\r\n    this.g = (hex >> 8 & 255) / 255;\r\n    this.b = (hex & 255) / 255;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  setRGB: function(r, g, b) {\r\n\r\n    this.r = r;\r\n    this.g = g;\r\n    this.b = b;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  setHSL: function(h, s, l) {\r\n\r\n    // h,s,l ranges are in 0.0 - 1.0\r\n\r\n    if (s === 0) {\r\n\r\n      this.r = this.g = this.b = l;\r\n\r\n    }\r\n    else {\r\n\r\n      var hue2rgb = function(p, q, t) {\r\n\r\n        if (t < 0) t += 1;\r\n        if (t > 1) t -= 1;\r\n        if (t < 1 / 6) return p + (q - p) * 6 * t;\r\n        if (t < 1 / 2) return q;\r\n        if (t < 2 / 3) return p + (q - p) * 6 * (2 / 3 - t);\r\n        return p;\r\n\r\n      };\r\n\r\n      var p = l <= 0.5 ? l * (1 + s) : l + s - (l * s);\r\n      var q = (2 * l) - p;\r\n\r\n      this.r = hue2rgb(q, p, h + 1 / 3);\r\n      this.g = hue2rgb(q, p, h);\r\n      this.b = hue2rgb(q, p, h - 1 / 3);\r\n\r\n    }\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  setStyle: function(style) {\r\n\r\n    // rgb(255,0,0)\r\n\r\n    if (/^rgb\\((\\d+), ?(\\d+), ?(\\d+)\\)$/i.test(style)) {\r\n\r\n      var color = /^rgb\\((\\d+), ?(\\d+), ?(\\d+)\\)$/i.exec(style);\r\n\r\n      this.r = Math.min(255, parseInt(color[1], 10)) / 255;\r\n      this.g = Math.min(255, parseInt(color[2], 10)) / 255;\r\n      this.b = Math.min(255, parseInt(color[3], 10)) / 255;\r\n\r\n      return this;\r\n\r\n    }\r\n\r\n    // rgb(100%,0%,0%)\r\n\r\n    if (/^rgb\\((\\d+)\\%, ?(\\d+)\\%, ?(\\d+)\\%\\)$/i.test(style)) {\r\n\r\n      var color = /^rgb\\((\\d+)\\%, ?(\\d+)\\%, ?(\\d+)\\%\\)$/i.exec(style);\r\n\r\n      this.r = Math.min(100, parseInt(color[1], 10)) / 100;\r\n      this.g = Math.min(100, parseInt(color[2], 10)) / 100;\r\n      this.b = Math.min(100, parseInt(color[3], 10)) / 100;\r\n\r\n      return this;\r\n\r\n    }\r\n\r\n    // #ff0000\r\n\r\n    if (/^\\#([0-9a-f]{6})$/i.test(style)) {\r\n\r\n      var color = /^\\#([0-9a-f]{6})$/i.exec(style);\r\n\r\n      this.setHex(parseInt(color[1], 16));\r\n\r\n      return this;\r\n\r\n    }\r\n\r\n    // #f00\r\n\r\n    if (/^\\#([0-9a-f])([0-9a-f])([0-9a-f])$/i.test(style)) {\r\n\r\n      var color = /^\\#([0-9a-f])([0-9a-f])([0-9a-f])$/i.exec(style);\r\n\r\n      this.setHex(parseInt(color[1] + color[1] + color[2] + color[2] + color[3] + color[3], 16));\r\n\r\n      return this;\r\n\r\n    }\r\n\r\n    // red\r\n\r\n    if (/^(\\w+)$/i.test(style)) {\r\n\r\n      this.setHex(THREE.ColorKeywords[style]);\r\n\r\n      return this;\r\n\r\n    }\r\n\r\n\r\n  },\r\n\r\n  copy: function(color) {\r\n\r\n    this.r = color.r;\r\n    this.g = color.g;\r\n    this.b = color.b;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  copyGammaToLinear: function(color, gammaFactor) {\r\n\r\n    if (gammaFactor === undefined) gammaFactor = 2.0;\r\n\r\n    this.r = Math.pow(color.r, gammaFactor);\r\n    this.g = Math.pow(color.g, gammaFactor);\r\n    this.b = Math.pow(color.b, gammaFactor);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  copyLinearToGamma: function(color, gammaFactor) {\r\n\r\n    if (gammaFactor === undefined) gammaFactor = 2.0;\r\n\r\n    var safeInverse = (gammaFactor > 0) ? (1.0 / gammaFactor) : 1.0;\r\n\r\n    this.r = Math.pow(color.r, safeInverse);\r\n    this.g = Math.pow(color.g, safeInverse);\r\n    this.b = Math.pow(color.b, safeInverse);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  convertGammaToLinear: function() {\r\n\r\n    var r = this.r,\r\n      g = this.g,\r\n      b = this.b;\r\n\r\n    this.r = r * r;\r\n    this.g = g * g;\r\n    this.b = b * b;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  convertLinearToGamma: function() {\r\n\r\n    this.r = Math.sqrt(this.r);\r\n    this.g = Math.sqrt(this.g);\r\n    this.b = Math.sqrt(this.b);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  getHex: function() {\r\n\r\n    return (this.r * 255) << 16 ^ (this.g * 255) << 8 ^ (this.b * 255) << 0;\r\n\r\n  },\r\n\r\n  getHexString: function() {\r\n\r\n    return ('000000' + this.getHex().toString(16)).slice(-6);\r\n\r\n  },\r\n\r\n  getHSL: function(optionalTarget) {\r\n\r\n    // h,s,l ranges are in 0.0 - 1.0\r\n\r\n    var hsl = optionalTarget || {\r\n      h: 0,\r\n      s: 0,\r\n      l: 0\r\n    };\r\n\r\n    var r = this.r,\r\n      g = this.g,\r\n      b = this.b;\r\n\r\n    var max = Math.max(r, g, b);\r\n    var min = Math.min(r, g, b);\r\n\r\n    var hue, saturation;\r\n    var lightness = (min + max) / 2.0;\r\n\r\n    if (min === max) {\r\n\r\n      hue = 0;\r\n      saturation = 0;\r\n\r\n    }\r\n    else {\r\n\r\n      var delta = max - min;\r\n\r\n      saturation = lightness <= 0.5 ? delta / (max + min) : delta / (2 - max - min);\r\n\r\n      switch (max) {\r\n\r\n        case r:\r\n          hue = (g - b) / delta + (g < b ? 6 : 0);\r\n          break;\r\n        case g:\r\n          hue = (b - r) / delta + 2;\r\n          break;\r\n        case b:\r\n          hue = (r - g) / delta + 4;\r\n          break;\r\n\r\n      }\r\n\r\n      hue /= 6;\r\n\r\n    }\r\n\r\n    hsl.h = hue;\r\n    hsl.s = saturation;\r\n    hsl.l = lightness;\r\n\r\n    return hsl;\r\n\r\n  },\r\n\r\n  getStyle: function() {\r\n\r\n    return 'rgb(' + ((this.r * 255) | 0) + ',' + ((this.g * 255) | 0) + ',' + ((this.b * 255) | 0) + ')';\r\n\r\n  },\r\n\r\n  offsetHSL: function(h, s, l) {\r\n\r\n    var hsl = this.getHSL();\r\n\r\n    hsl.h += h;\r\n    hsl.s += s;\r\n    hsl.l += l;\r\n\r\n    this.setHSL(hsl.h, hsl.s, hsl.l);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  add: function(color) {\r\n\r\n    this.r += color.r;\r\n    this.g += color.g;\r\n    this.b += color.b;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  addColors: function(color1, color2) {\r\n\r\n    this.r = color1.r + color2.r;\r\n    this.g = color1.g + color2.g;\r\n    this.b = color1.b + color2.b;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  addScalar: function(s) {\r\n\r\n    this.r += s;\r\n    this.g += s;\r\n    this.b += s;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  multiply: function(color) {\r\n\r\n    this.r *= color.r;\r\n    this.g *= color.g;\r\n    this.b *= color.b;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  multiplyScalar: function(s) {\r\n\r\n    this.r *= s;\r\n    this.g *= s;\r\n    this.b *= s;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  lerp: function(color, alpha) {\r\n\r\n    this.r += (color.r - this.r) * alpha;\r\n    this.g += (color.g - this.g) * alpha;\r\n    this.b += (color.b - this.b) * alpha;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  equals: function(c) {\r\n\r\n    return (c.r === this.r) && (c.g === this.g) && (c.b === this.b);\r\n\r\n  },\r\n\r\n  fromArray: function(array) {\r\n\r\n    this.r = array[0];\r\n    this.g = array[1];\r\n    this.b = array[2];\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  toArray: function(array, offset) {\r\n\r\n    if (array === undefined) array = [];\r\n    if (offset === undefined) offset = 0;\r\n\r\n    array[offset] = this.r;\r\n    array[offset + 1] = this.g;\r\n    array[offset + 2] = this.b;\r\n\r\n    return array;\r\n  },\r\n\r\n  clone: function() {\r\n\r\n    return new THREE.Color().setRGB(this.r, this.g, this.b);\r\n\r\n  }\r\n\r\n};\r\n\r\nTHREE.ColorKeywords = {\r\n  'aliceblue': 0xF0F8FF,\r\n  'antiquewhite': 0xFAEBD7,\r\n  'aqua': 0x00FFFF,\r\n  'aquamarine': 0x7FFFD4,\r\n  'azure': 0xF0FFFF,\r\n  'beige': 0xF5F5DC,\r\n  'bisque': 0xFFE4C4,\r\n  'black': 0x000000,\r\n  'blanchedalmond': 0xFFEBCD,\r\n  'blue': 0x0000FF,\r\n  'blueviolet': 0x8A2BE2,\r\n  'brown': 0xA52A2A,\r\n  'burlywood': 0xDEB887,\r\n  'cadetblue': 0x5F9EA0,\r\n  'chartreuse': 0x7FFF00,\r\n  'chocolate': 0xD2691E,\r\n  'coral': 0xFF7F50,\r\n  'cornflowerblue': 0x6495ED,\r\n  'cornsilk': 0xFFF8DC,\r\n  'crimson': 0xDC143C,\r\n  'cyan': 0x00FFFF,\r\n  'darkblue': 0x00008B,\r\n  'darkcyan': 0x008B8B,\r\n  'darkgoldenrod': 0xB8860B,\r\n  'darkgray': 0xA9A9A9,\r\n  'darkgreen': 0x006400,\r\n  'darkgrey': 0xA9A9A9,\r\n  'darkkhaki': 0xBDB76B,\r\n  'darkmagenta': 0x8B008B,\r\n  'darkolivegreen': 0x556B2F,\r\n  'darkorange': 0xFF8C00,\r\n  'darkorchid': 0x9932CC,\r\n  'darkred': 0x8B0000,\r\n  'darksalmon': 0xE9967A,\r\n  'darkseagreen': 0x8FBC8F,\r\n  'darkslateblue': 0x483D8B,\r\n  'darkslategray': 0x2F4F4F,\r\n  'darkslategrey': 0x2F4F4F,\r\n  'darkturquoise': 0x00CED1,\r\n  'darkviolet': 0x9400D3,\r\n  'deeppink': 0xFF1493,\r\n  'deepskyblue': 0x00BFFF,\r\n  'dimgray': 0x696969,\r\n  'dimgrey': 0x696969,\r\n  'dodgerblue': 0x1E90FF,\r\n  'firebrick': 0xB22222,\r\n  'floralwhite': 0xFFFAF0,\r\n  'forestgreen': 0x228B22,\r\n  'fuchsia': 0xFF00FF,\r\n  'gainsboro': 0xDCDCDC,\r\n  'ghostwhite': 0xF8F8FF,\r\n  'gold': 0xFFD700,\r\n  'goldenrod': 0xDAA520,\r\n  'gray': 0x808080,\r\n  'green': 0x008000,\r\n  'greenyellow': 0xADFF2F,\r\n  'grey': 0x808080,\r\n  'honeydew': 0xF0FFF0,\r\n  'hotpink': 0xFF69B4,\r\n  'indianred': 0xCD5C5C,\r\n  'indigo': 0x4B0082,\r\n  'ivory': 0xFFFFF0,\r\n  'khaki': 0xF0E68C,\r\n  'lavender': 0xE6E6FA,\r\n  'lavenderblush': 0xFFF0F5,\r\n  'lawngreen': 0x7CFC00,\r\n  'lemonchiffon': 0xFFFACD,\r\n  'lightblue': 0xADD8E6,\r\n  'lightcoral': 0xF08080,\r\n  'lightcyan': 0xE0FFFF,\r\n  'lightgoldenrodyellow': 0xFAFAD2,\r\n  'lightgray': 0xD3D3D3,\r\n  'lightgreen': 0x90EE90,\r\n  'lightgrey': 0xD3D3D3,\r\n  'lightpink': 0xFFB6C1,\r\n  'lightsalmon': 0xFFA07A,\r\n  'lightseagreen': 0x20B2AA,\r\n  'lightskyblue': 0x87CEFA,\r\n  'lightslategray': 0x778899,\r\n  'lightslategrey': 0x778899,\r\n  'lightsteelblue': 0xB0C4DE,\r\n  'lightyellow': 0xFFFFE0,\r\n  'lime': 0x00FF00,\r\n  'limegreen': 0x32CD32,\r\n  'linen': 0xFAF0E6,\r\n  'magenta': 0xFF00FF,\r\n  'maroon': 0x800000,\r\n  'mediumaquamarine': 0x66CDAA,\r\n  'mediumblue': 0x0000CD,\r\n  'mediumorchid': 0xBA55D3,\r\n  'mediumpurple': 0x9370DB,\r\n  'mediumseagreen': 0x3CB371,\r\n  'mediumslateblue': 0x7B68EE,\r\n  'mediumspringgreen': 0x00FA9A,\r\n  'mediumturquoise': 0x48D1CC,\r\n  'mediumvioletred': 0xC71585,\r\n  'midnightblue': 0x191970,\r\n  'mintcream': 0xF5FFFA,\r\n  'mistyrose': 0xFFE4E1,\r\n  'moccasin': 0xFFE4B5,\r\n  'navajowhite': 0xFFDEAD,\r\n  'navy': 0x000080,\r\n  'oldlace': 0xFDF5E6,\r\n  'olive': 0x808000,\r\n  'olivedrab': 0x6B8E23,\r\n  'orange': 0xFFA500,\r\n  'orangered': 0xFF4500,\r\n  'orchid': 0xDA70D6,\r\n  'palegoldenrod': 0xEEE8AA,\r\n  'palegreen': 0x98FB98,\r\n  'paleturquoise': 0xAFEEEE,\r\n  'palevioletred': 0xDB7093,\r\n  'papayawhip': 0xFFEFD5,\r\n  'peachpuff': 0xFFDAB9,\r\n  'peru': 0xCD853F,\r\n  'pink': 0xFFC0CB,\r\n  'plum': 0xDDA0DD,\r\n  'powderblue': 0xB0E0E6,\r\n  'purple': 0x800080,\r\n  'red': 0xFF0000,\r\n  'rosybrown': 0xBC8F8F,\r\n  'royalblue': 0x4169E1,\r\n  'saddlebrown': 0x8B4513,\r\n  'salmon': 0xFA8072,\r\n  'sandybrown': 0xF4A460,\r\n  'seagreen': 0x2E8B57,\r\n  'seashell': 0xFFF5EE,\r\n  'sienna': 0xA0522D,\r\n  'silver': 0xC0C0C0,\r\n  'skyblue': 0x87CEEB,\r\n  'slateblue': 0x6A5ACD,\r\n  'slategray': 0x708090,\r\n  'slategrey': 0x708090,\r\n  'snow': 0xFFFAFA,\r\n  'springgreen': 0x00FF7F,\r\n  'steelblue': 0x4682B4,\r\n  'tan': 0xD2B48C,\r\n  'teal': 0x008080,\r\n  'thistle': 0xD8BFD8,\r\n  'tomato': 0xFF6347,\r\n  'turquoise': 0x40E0D0,\r\n  'violet': 0xEE82EE,\r\n  'wheat': 0xF5DEB3,\r\n  'white': 0xFFFFFF,\r\n  'whitesmoke': 0xF5F5F5,\r\n  'yellow': 0xFFFF00,\r\n  'yellowgreen': 0x9ACD32\r\n};\r\n\r\n// File:src/math/Quaternion.js\r\n\r\n/**\r\n * @author mikael emtinger / http://gomo.se/\r\n * @author alteredq / http://alteredqualia.com/\r\n * @author WestLangley / http://github.com/WestLangley\r\n * @author bhouston / http://exocortex.com\r\n */\r\n\r\nTHREE.Quaternion = function(x, y, z, w) {\r\n\r\n  this._x = x || 0;\r\n  this._y = y || 0;\r\n  this._z = z || 0;\r\n  this._w = (w !== undefined) ? w : 1;\r\n\r\n};\r\n\r\nTHREE.Quaternion.prototype = {\r\n\r\n  constructor: THREE.Quaternion,\r\n\r\n  _x: 0,\r\n  _y: 0,\r\n  _z: 0,\r\n  _w: 0,\r\n\r\n  get x() {\r\n\r\n    return this._x;\r\n\r\n  },\r\n\r\n  set x(value) {\r\n\r\n    this._x = value;\r\n    this.onChangeCallback();\r\n\r\n  },\r\n\r\n  get y() {\r\n\r\n    return this._y;\r\n\r\n  },\r\n\r\n  set y(value) {\r\n\r\n    this._y = value;\r\n    this.onChangeCallback();\r\n\r\n  },\r\n\r\n  get z() {\r\n\r\n    return this._z;\r\n\r\n  },\r\n\r\n  set z(value) {\r\n\r\n    this._z = value;\r\n    this.onChangeCallback();\r\n\r\n  },\r\n\r\n  get w() {\r\n\r\n    return this._w;\r\n\r\n  },\r\n\r\n  set w(value) {\r\n\r\n    this._w = value;\r\n    this.onChangeCallback();\r\n\r\n  },\r\n\r\n  set: function(x, y, z, w) {\r\n\r\n    this._x = x;\r\n    this._y = y;\r\n    this._z = z;\r\n    this._w = w;\r\n\r\n    this.onChangeCallback();\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  copy: function(quaternion) {\r\n\r\n    this._x = quaternion.x;\r\n    this._y = quaternion.y;\r\n    this._z = quaternion.z;\r\n    this._w = quaternion.w;\r\n\r\n    this.onChangeCallback();\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  setFromEuler: function(euler, update) {\r\n\r\n    if (euler instanceof THREE.Euler === false) {\r\n\r\n      throw new Error('THREE.Quaternion: .setFromEuler() now expects a Euler rotation rather than a Vector3 and order.');\r\n    }\r\n\r\n    // http://www.mathworks.com/matlabcentral/fileexchange/\r\n    // \t20696-function-to-convert-between-dcm-euler-angles-quaternions-and-euler-vectors/\r\n    //\tcontent/SpinCalc.m\r\n\r\n    var c1 = Math.cos(euler._x / 2);\r\n    var c2 = Math.cos(euler._y / 2);\r\n    var c3 = Math.cos(euler._z / 2);\r\n    var s1 = Math.sin(euler._x / 2);\r\n    var s2 = Math.sin(euler._y / 2);\r\n    var s3 = Math.sin(euler._z / 2);\r\n\r\n    if (euler.order === 'XYZ') {\r\n\r\n      this._x = s1 * c2 * c3 + c1 * s2 * s3;\r\n      this._y = c1 * s2 * c3 - s1 * c2 * s3;\r\n      this._z = c1 * c2 * s3 + s1 * s2 * c3;\r\n      this._w = c1 * c2 * c3 - s1 * s2 * s3;\r\n\r\n    }\r\n    else if (euler.order === 'YXZ') {\r\n\r\n      this._x = s1 * c2 * c3 + c1 * s2 * s3;\r\n      this._y = c1 * s2 * c3 - s1 * c2 * s3;\r\n      this._z = c1 * c2 * s3 - s1 * s2 * c3;\r\n      this._w = c1 * c2 * c3 + s1 * s2 * s3;\r\n\r\n    }\r\n    else if (euler.order === 'ZXY') {\r\n\r\n      this._x = s1 * c2 * c3 - c1 * s2 * s3;\r\n      this._y = c1 * s2 * c3 + s1 * c2 * s3;\r\n      this._z = c1 * c2 * s3 + s1 * s2 * c3;\r\n      this._w = c1 * c2 * c3 - s1 * s2 * s3;\r\n\r\n    }\r\n    else if (euler.order === 'ZYX') {\r\n\r\n      this._x = s1 * c2 * c3 - c1 * s2 * s3;\r\n      this._y = c1 * s2 * c3 + s1 * c2 * s3;\r\n      this._z = c1 * c2 * s3 - s1 * s2 * c3;\r\n      this._w = c1 * c2 * c3 + s1 * s2 * s3;\r\n\r\n    }\r\n    else if (euler.order === 'YZX') {\r\n\r\n      this._x = s1 * c2 * c3 + c1 * s2 * s3;\r\n      this._y = c1 * s2 * c3 + s1 * c2 * s3;\r\n      this._z = c1 * c2 * s3 - s1 * s2 * c3;\r\n      this._w = c1 * c2 * c3 - s1 * s2 * s3;\r\n\r\n    }\r\n    else if (euler.order === 'XZY') {\r\n\r\n      this._x = s1 * c2 * c3 - c1 * s2 * s3;\r\n      this._y = c1 * s2 * c3 - s1 * c2 * s3;\r\n      this._z = c1 * c2 * s3 + s1 * s2 * c3;\r\n      this._w = c1 * c2 * c3 + s1 * s2 * s3;\r\n\r\n    }\r\n\r\n    if (update !== false) this.onChangeCallback();\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  setFromAxisAngle: function(axis, angle) {\r\n\r\n    // http://www.euclideanspace.com/maths/geometry/rotations/conversions/angleToQuaternion/index.htm\r\n\r\n    // assumes axis is normalized\r\n\r\n    var halfAngle = angle / 2,\r\n      s = Math.sin(halfAngle);\r\n\r\n    this._x = axis.x * s;\r\n    this._y = axis.y * s;\r\n    this._z = axis.z * s;\r\n    this._w = Math.cos(halfAngle);\r\n\r\n    this.onChangeCallback();\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  setFromRotationMatrix: function(m) {\r\n\r\n    // http://www.euclideanspace.com/maths/geometry/rotations/conversions/matrixToQuaternion/index.htm\r\n\r\n    // assumes the upper 3x3 of m is a pure rotation matrix (i.e, unscaled)\r\n\r\n    var te = m.elements,\r\n\r\n      m11 = te[0],\r\n      m12 = te[4],\r\n      m13 = te[8],\r\n      m21 = te[1],\r\n      m22 = te[5],\r\n      m23 = te[9],\r\n      m31 = te[2],\r\n      m32 = te[6],\r\n      m33 = te[10],\r\n\r\n      trace = m11 + m22 + m33,\r\n      s;\r\n\r\n    if (trace > 0) {\r\n\r\n      s = 0.5 / Math.sqrt(trace + 1.0);\r\n\r\n      this._w = 0.25 / s;\r\n      this._x = (m32 - m23) * s;\r\n      this._y = (m13 - m31) * s;\r\n      this._z = (m21 - m12) * s;\r\n\r\n    }\r\n    else if (m11 > m22 && m11 > m33) {\r\n\r\n      s = 2.0 * Math.sqrt(1.0 + m11 - m22 - m33);\r\n\r\n      this._w = (m32 - m23) / s;\r\n      this._x = 0.25 * s;\r\n      this._y = (m12 + m21) / s;\r\n      this._z = (m13 + m31) / s;\r\n\r\n    }\r\n    else if (m22 > m33) {\r\n\r\n      s = 2.0 * Math.sqrt(1.0 + m22 - m11 - m33);\r\n\r\n      this._w = (m13 - m31) / s;\r\n      this._x = (m12 + m21) / s;\r\n      this._y = 0.25 * s;\r\n      this._z = (m23 + m32) / s;\r\n\r\n    }\r\n    else {\r\n\r\n      s = 2.0 * Math.sqrt(1.0 + m33 - m11 - m22);\r\n\r\n      this._w = (m21 - m12) / s;\r\n      this._x = (m13 + m31) / s;\r\n      this._y = (m23 + m32) / s;\r\n      this._z = 0.25 * s;\r\n\r\n    }\r\n\r\n    this.onChangeCallback();\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  setFromUnitVectors: function() {\r\n\r\n    // http://lolengine.net/blog/2014/02/24/quaternion-from-two-vectors-final\r\n\r\n    // assumes direction vectors vFrom and vTo are normalized\r\n\r\n    var v1, r;\r\n\r\n    var EPS = 0.000001;\r\n\r\n    return function(vFrom, vTo) {\r\n\r\n      if (v1 === undefined) v1 = new THREE.Vector3();\r\n\r\n      r = vFrom.dot(vTo) + 1;\r\n\r\n      if (r < EPS) {\r\n\r\n        r = 0;\r\n\r\n        if (Math.abs(vFrom.x) > Math.abs(vFrom.z)) {\r\n\r\n          v1.set(-vFrom.y, vFrom.x, 0);\r\n\r\n        }\r\n        else {\r\n\r\n          v1.set(0, -vFrom.z, vFrom.y);\r\n\r\n        }\r\n\r\n      }\r\n      else {\r\n\r\n        v1.crossVectors(vFrom, vTo);\r\n\r\n      }\r\n\r\n      this._x = v1.x;\r\n      this._y = v1.y;\r\n      this._z = v1.z;\r\n      this._w = r;\r\n\r\n      this.normalize();\r\n\r\n      return this;\r\n\r\n    }\r\n\r\n  }(),\r\n\r\n  inverse: function() {\r\n\r\n    this.conjugate().normalize();\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  conjugate: function() {\r\n\r\n    this._x *= -1;\r\n    this._y *= -1;\r\n    this._z *= -1;\r\n\r\n    this.onChangeCallback();\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  dot: function(v) {\r\n\r\n    return this._x * v._x + this._y * v._y + this._z * v._z + this._w * v._w;\r\n\r\n  },\r\n\r\n  lengthSq: function() {\r\n\r\n    return this._x * this._x + this._y * this._y + this._z * this._z + this._w * this._w;\r\n\r\n  },\r\n\r\n  length: function() {\r\n\r\n    return Math.sqrt(this._x * this._x + this._y * this._y + this._z * this._z + this._w * this._w);\r\n\r\n  },\r\n\r\n  normalize: function() {\r\n\r\n    var l = this.length();\r\n\r\n    if (l === 0) {\r\n\r\n      this._x = 0;\r\n      this._y = 0;\r\n      this._z = 0;\r\n      this._w = 1;\r\n\r\n    }\r\n    else {\r\n\r\n      l = 1 / l;\r\n\r\n      this._x = this._x * l;\r\n      this._y = this._y * l;\r\n      this._z = this._z * l;\r\n      this._w = this._w * l;\r\n\r\n    }\r\n\r\n    this.onChangeCallback();\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  multiply: function(q, p) {\r\n\r\n    if (p !== undefined) {\r\n\r\n      THREE.warn('THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead.');\r\n      return this.multiplyQuaternions(q, p);\r\n\r\n    }\r\n\r\n    return this.multiplyQuaternions(this, q);\r\n\r\n  },\r\n\r\n  multiplyQuaternions: function(a, b) {\r\n\r\n    // from http://www.euclideanspace.com/maths/algebra/realNormedAlgebra/quaternions/code/index.htm\r\n\r\n    var qax = a._x,\r\n      qay = a._y,\r\n      qaz = a._z,\r\n      qaw = a._w;\r\n    var qbx = b._x,\r\n      qby = b._y,\r\n      qbz = b._z,\r\n      qbw = b._w;\r\n\r\n    this._x = qax * qbw + qaw * qbx + qay * qbz - qaz * qby;\r\n    this._y = qay * qbw + qaw * qby + qaz * qbx - qax * qbz;\r\n    this._z = qaz * qbw + qaw * qbz + qax * qby - qay * qbx;\r\n    this._w = qaw * qbw - qax * qbx - qay * qby - qaz * qbz;\r\n\r\n    this.onChangeCallback();\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  multiplyVector3: function(vector) {\r\n\r\n    THREE.warn('THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead.');\r\n    return vector.applyQuaternion(this);\r\n\r\n  },\r\n\r\n  slerp: function(qb, t) {\r\n\r\n    if (t === 0) return this;\r\n    if (t === 1) return this.copy(qb);\r\n\r\n    var x = this._x,\r\n      y = this._y,\r\n      z = this._z,\r\n      w = this._w;\r\n\r\n    // http://www.euclideanspace.com/maths/algebra/realNormedAlgebra/quaternions/slerp/\r\n\r\n    var cosHalfTheta = w * qb._w + x * qb._x + y * qb._y + z * qb._z;\r\n\r\n    if (cosHalfTheta < 0) {\r\n\r\n      this._w = -qb._w;\r\n      this._x = -qb._x;\r\n      this._y = -qb._y;\r\n      this._z = -qb._z;\r\n\r\n      cosHalfTheta = -cosHalfTheta;\r\n\r\n    }\r\n    else {\r\n\r\n      this.copy(qb);\r\n\r\n    }\r\n\r\n    if (cosHalfTheta >= 1.0) {\r\n\r\n      this._w = w;\r\n      this._x = x;\r\n      this._y = y;\r\n      this._z = z;\r\n\r\n      return this;\r\n\r\n    }\r\n\r\n    var halfTheta = Math.acos(cosHalfTheta);\r\n    var sinHalfTheta = Math.sqrt(1.0 - cosHalfTheta * cosHalfTheta);\r\n\r\n    if (Math.abs(sinHalfTheta) < 0.001) {\r\n\r\n      this._w = 0.5 * (w + this._w);\r\n      this._x = 0.5 * (x + this._x);\r\n      this._y = 0.5 * (y + this._y);\r\n      this._z = 0.5 * (z + this._z);\r\n\r\n      return this;\r\n\r\n    }\r\n\r\n    var ratioA = Math.sin((1 - t) * halfTheta) / sinHalfTheta,\r\n      ratioB = Math.sin(t * halfTheta) / sinHalfTheta;\r\n\r\n    this._w = (w * ratioA + this._w * ratioB);\r\n    this._x = (x * ratioA + this._x * ratioB);\r\n    this._y = (y * ratioA + this._y * ratioB);\r\n    this._z = (z * ratioA + this._z * ratioB);\r\n\r\n    this.onChangeCallback();\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  equals: function(quaternion) {\r\n\r\n    return (quaternion._x === this._x) && (quaternion._y === this._y) && (quaternion._z === this._z) && (quaternion._w === this._w);\r\n\r\n  },\r\n\r\n  fromArray: function(array, offset) {\r\n\r\n    if (offset === undefined) offset = 0;\r\n\r\n    this._x = array[offset];\r\n    this._y = array[offset + 1];\r\n    this._z = array[offset + 2];\r\n    this._w = array[offset + 3];\r\n\r\n    this.onChangeCallback();\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  toArray: function(array, offset) {\r\n\r\n    if (array === undefined) array = [];\r\n    if (offset === undefined) offset = 0;\r\n\r\n    array[offset] = this._x;\r\n    array[offset + 1] = this._y;\r\n    array[offset + 2] = this._z;\r\n    array[offset + 3] = this._w;\r\n\r\n    return array;\r\n\r\n  },\r\n\r\n  onChange: function(callback) {\r\n\r\n    this.onChangeCallback = callback;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  onChangeCallback: function() {},\r\n\r\n  clone: function() {\r\n\r\n    return new THREE.Quaternion(this._x, this._y, this._z, this._w);\r\n\r\n  }\r\n\r\n};\r\n\r\nTHREE.Quaternion.slerp = function(qa, qb, qm, t) {\r\n\r\n  return qm.copy(qa).slerp(qb, t);\r\n\r\n}\r\n\r\n// File:src/math/Vector2.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author philogb / http://blog.thejit.org/\r\n * @author egraether / http://egraether.com/\r\n * @author zz85 / http://www.lab4games.net/zz85/blog\r\n */\r\n\r\nTHREE.Vector2 = function(x, y) {\r\n\r\n  this.x = x || 0;\r\n  this.y = y || 0;\r\n\r\n};\r\n\r\nTHREE.Vector2.prototype = {\r\n\r\n  constructor: THREE.Vector2,\r\n\r\n  set: function(x, y) {\r\n\r\n    this.x = x;\r\n    this.y = y;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  setX: function(x) {\r\n\r\n    this.x = x;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  setY: function(y) {\r\n\r\n    this.y = y;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  setComponent: function(index, value) {\r\n\r\n    switch (index) {\r\n\r\n      case 0:\r\n        this.x = value;\r\n        break;\r\n      case 1:\r\n        this.y = value;\r\n        break;\r\n      default:\r\n        throw new Error('index is out of range: ' + index);\r\n\r\n    }\r\n\r\n  },\r\n\r\n  getComponent: function(index) {\r\n\r\n    switch (index) {\r\n\r\n      case 0:\r\n        return this.x;\r\n      case 1:\r\n        return this.y;\r\n      default:\r\n        throw new Error('index is out of range: ' + index);\r\n\r\n    }\r\n\r\n  },\r\n\r\n  copy: function(v) {\r\n\r\n    this.x = v.x;\r\n    this.y = v.y;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  add: function(v, w) {\r\n\r\n    if (w !== undefined) {\r\n\r\n      THREE.warn('THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead.');\r\n      return this.addVectors(v, w);\r\n\r\n    }\r\n\r\n    this.x += v.x;\r\n    this.y += v.y;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  addScalar: function(s) {\r\n\r\n    this.x += s;\r\n    this.y += s;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  addVectors: function(a, b) {\r\n\r\n    this.x = a.x + b.x;\r\n    this.y = a.y + b.y;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  sub: function(v, w) {\r\n\r\n    if (w !== undefined) {\r\n\r\n      THREE.warn('THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead.');\r\n      return this.subVectors(v, w);\r\n\r\n    }\r\n\r\n    this.x -= v.x;\r\n    this.y -= v.y;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  subScalar: function(s) {\r\n\r\n    this.x -= s;\r\n    this.y -= s;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  subVectors: function(a, b) {\r\n\r\n    this.x = a.x - b.x;\r\n    this.y = a.y - b.y;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  multiply: function(v) {\r\n\r\n    this.x *= v.x;\r\n    this.y *= v.y;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  multiplyScalar: function(s) {\r\n\r\n    this.x *= s;\r\n    this.y *= s;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  divide: function(v) {\r\n\r\n    this.x /= v.x;\r\n    this.y /= v.y;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  divideScalar: function(scalar) {\r\n\r\n    if (scalar !== 0) {\r\n\r\n      var invScalar = 1 / scalar;\r\n\r\n      this.x *= invScalar;\r\n      this.y *= invScalar;\r\n\r\n    }\r\n    else {\r\n\r\n      this.x = 0;\r\n      this.y = 0;\r\n\r\n    }\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  min: function(v) {\r\n\r\n    if (this.x > v.x) {\r\n\r\n      this.x = v.x;\r\n\r\n    }\r\n\r\n    if (this.y > v.y) {\r\n\r\n      this.y = v.y;\r\n\r\n    }\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  max: function(v) {\r\n\r\n    if (this.x < v.x) {\r\n\r\n      this.x = v.x;\r\n\r\n    }\r\n\r\n    if (this.y < v.y) {\r\n\r\n      this.y = v.y;\r\n\r\n    }\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  clamp: function(min, max) {\r\n\r\n    // This function assumes min < max, if this assumption isn't true it will not operate correctly\r\n\r\n    if (this.x < min.x) {\r\n\r\n      this.x = min.x;\r\n\r\n    }\r\n    else if (this.x > max.x) {\r\n\r\n      this.x = max.x;\r\n\r\n    }\r\n\r\n    if (this.y < min.y) {\r\n\r\n      this.y = min.y;\r\n\r\n    }\r\n    else if (this.y > max.y) {\r\n\r\n      this.y = max.y;\r\n\r\n    }\r\n\r\n    return this;\r\n  },\r\n\r\n  clampScalar: (function() {\r\n\r\n    var min, max;\r\n\r\n    return function(minVal, maxVal) {\r\n\r\n      if (min === undefined) {\r\n\r\n        min = new THREE.Vector2();\r\n        max = new THREE.Vector2();\r\n\r\n      }\r\n\r\n      min.set(minVal, minVal);\r\n      max.set(maxVal, maxVal);\r\n\r\n      return this.clamp(min, max);\r\n\r\n    };\r\n\r\n  })(),\r\n\r\n  floor: function() {\r\n\r\n    this.x = Math.floor(this.x);\r\n    this.y = Math.floor(this.y);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  ceil: function() {\r\n\r\n    this.x = Math.ceil(this.x);\r\n    this.y = Math.ceil(this.y);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  round: function() {\r\n\r\n    this.x = Math.round(this.x);\r\n    this.y = Math.round(this.y);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  roundToZero: function() {\r\n\r\n    this.x = (this.x < 0) ? Math.ceil(this.x) : Math.floor(this.x);\r\n    this.y = (this.y < 0) ? Math.ceil(this.y) : Math.floor(this.y);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  negate: function() {\r\n\r\n    this.x = -this.x;\r\n    this.y = -this.y;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  dot: function(v) {\r\n\r\n    return this.x * v.x + this.y * v.y;\r\n\r\n  },\r\n\r\n  lengthSq: function() {\r\n\r\n    return this.x * this.x + this.y * this.y;\r\n\r\n  },\r\n\r\n  length: function() {\r\n\r\n    return Math.sqrt(this.x * this.x + this.y * this.y);\r\n\r\n  },\r\n\r\n  normalize: function() {\r\n\r\n    return this.divideScalar(this.length());\r\n\r\n  },\r\n\r\n  distanceTo: function(v) {\r\n\r\n    return Math.sqrt(this.distanceToSquared(v));\r\n\r\n  },\r\n\r\n  distanceToSquared: function(v) {\r\n\r\n    var dx = this.x - v.x,\r\n      dy = this.y - v.y;\r\n    return dx * dx + dy * dy;\r\n\r\n  },\r\n\r\n  setLength: function(l) {\r\n\r\n    var oldLength = this.length();\r\n\r\n    if (oldLength !== 0 && l !== oldLength) {\r\n\r\n      this.multiplyScalar(l / oldLength);\r\n    }\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  lerp: function(v, alpha) {\r\n\r\n    this.x += (v.x - this.x) * alpha;\r\n    this.y += (v.y - this.y) * alpha;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  lerpVectors: function(v1, v2, alpha) {\r\n\r\n    this.subVectors(v2, v1).multiplyScalar(alpha).add(v1);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  equals: function(v) {\r\n\r\n    return ((v.x === this.x) && (v.y === this.y));\r\n\r\n  },\r\n\r\n  fromArray: function(array, offset) {\r\n\r\n    if (offset === undefined) offset = 0;\r\n\r\n    this.x = array[offset];\r\n    this.y = array[offset + 1];\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  toArray: function(array, offset) {\r\n\r\n    if (array === undefined) array = [];\r\n    if (offset === undefined) offset = 0;\r\n\r\n    array[offset] = this.x;\r\n    array[offset + 1] = this.y;\r\n\r\n    return array;\r\n\r\n  },\r\n\r\n  fromAttribute: function(attribute, index, offset) {\r\n\r\n    if (offset === undefined) offset = 0;\r\n\r\n    index = index * attribute.itemSize + offset;\r\n\r\n    this.x = attribute.array[index];\r\n    this.y = attribute.array[index + 1];\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  clone: function() {\r\n\r\n    return new THREE.Vector2(this.x, this.y);\r\n\r\n  }\r\n\r\n};\r\n\r\n// File:src/math/Vector3.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author *kile / http://kile.stravaganza.org/\r\n * @author philogb / http://blog.thejit.org/\r\n * @author mikael emtinger / http://gomo.se/\r\n * @author egraether / http://egraether.com/\r\n * @author WestLangley / http://github.com/WestLangley\r\n */\r\n\r\nTHREE.Vector3 = function(x, y, z) {\r\n\r\n  this.x = x || 0;\r\n  this.y = y || 0;\r\n  this.z = z || 0;\r\n\r\n};\r\n\r\nTHREE.Vector3.prototype = {\r\n\r\n  constructor: THREE.Vector3,\r\n\r\n  set: function(x, y, z) {\r\n\r\n    this.x = x;\r\n    this.y = y;\r\n    this.z = z;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  setX: function(x) {\r\n\r\n    this.x = x;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  setY: function(y) {\r\n\r\n    this.y = y;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  setZ: function(z) {\r\n\r\n    this.z = z;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  setComponent: function(index, value) {\r\n\r\n    switch (index) {\r\n\r\n      case 0:\r\n        this.x = value;\r\n        break;\r\n      case 1:\r\n        this.y = value;\r\n        break;\r\n      case 2:\r\n        this.z = value;\r\n        break;\r\n      default:\r\n        throw new Error('index is out of range: ' + index);\r\n\r\n    }\r\n\r\n  },\r\n\r\n  getComponent: function(index) {\r\n\r\n    switch (index) {\r\n\r\n      case 0:\r\n        return this.x;\r\n      case 1:\r\n        return this.y;\r\n      case 2:\r\n        return this.z;\r\n      default:\r\n        throw new Error('index is out of range: ' + index);\r\n\r\n    }\r\n\r\n  },\r\n\r\n  copy: function(v) {\r\n\r\n    this.x = v.x;\r\n    this.y = v.y;\r\n    this.z = v.z;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  add: function(v, w) {\r\n\r\n    if (w !== undefined) {\r\n\r\n      THREE.warn('THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead.');\r\n      return this.addVectors(v, w);\r\n\r\n    }\r\n\r\n    this.x += v.x;\r\n    this.y += v.y;\r\n    this.z += v.z;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  addScalar: function(s) {\r\n\r\n    this.x += s;\r\n    this.y += s;\r\n    this.z += s;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  addVectors: function(a, b) {\r\n\r\n    this.x = a.x + b.x;\r\n    this.y = a.y + b.y;\r\n    this.z = a.z + b.z;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  sub: function(v, w) {\r\n\r\n    if (w !== undefined) {\r\n\r\n      THREE.warn('THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead.');\r\n      return this.subVectors(v, w);\r\n\r\n    }\r\n\r\n    this.x -= v.x;\r\n    this.y -= v.y;\r\n    this.z -= v.z;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  subScalar: function(s) {\r\n\r\n    this.x -= s;\r\n    this.y -= s;\r\n    this.z -= s;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  subVectors: function(a, b) {\r\n\r\n    this.x = a.x - b.x;\r\n    this.y = a.y - b.y;\r\n    this.z = a.z - b.z;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  multiply: function(v, w) {\r\n\r\n    if (w !== undefined) {\r\n\r\n      THREE.warn('THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead.');\r\n      return this.multiplyVectors(v, w);\r\n\r\n    }\r\n\r\n    this.x *= v.x;\r\n    this.y *= v.y;\r\n    this.z *= v.z;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  multiplyScalar: function(scalar) {\r\n\r\n    this.x *= scalar;\r\n    this.y *= scalar;\r\n    this.z *= scalar;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  multiplyVectors: function(a, b) {\r\n\r\n    this.x = a.x * b.x;\r\n    this.y = a.y * b.y;\r\n    this.z = a.z * b.z;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  applyEuler: function() {\r\n\r\n    var quaternion;\r\n\r\n    return function(euler) {\r\n\r\n      if (euler instanceof THREE.Euler === false) {\r\n\r\n        THREE.error('THREE.Vector3: .applyEuler() now expects a Euler rotation rather than a Vector3 and order.');\r\n\r\n      }\r\n\r\n      if (quaternion === undefined) quaternion = new THREE.Quaternion();\r\n\r\n      this.applyQuaternion(quaternion.setFromEuler(euler));\r\n\r\n      return this;\r\n\r\n    };\r\n\r\n  }(),\r\n\r\n  applyAxisAngle: function() {\r\n\r\n    var quaternion;\r\n\r\n    return function(axis, angle) {\r\n\r\n      if (quaternion === undefined) quaternion = new THREE.Quaternion();\r\n\r\n      this.applyQuaternion(quaternion.setFromAxisAngle(axis, angle));\r\n\r\n      return this;\r\n\r\n    };\r\n\r\n  }(),\r\n\r\n  applyMatrix3: function(m) {\r\n\r\n    var x = this.x;\r\n    var y = this.y;\r\n    var z = this.z;\r\n\r\n    var e = m.elements;\r\n\r\n    this.x = e[0] * x + e[3] * y + e[6] * z;\r\n    this.y = e[1] * x + e[4] * y + e[7] * z;\r\n    this.z = e[2] * x + e[5] * y + e[8] * z;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  applyMatrix4: function(m) {\r\n\r\n    // input: THREE.Matrix4 affine matrix\r\n\r\n    var x = this.x,\r\n      y = this.y,\r\n      z = this.z;\r\n\r\n    var e = m.elements;\r\n\r\n    this.x = e[0] * x + e[4] * y + e[8] * z + e[12];\r\n    this.y = e[1] * x + e[5] * y + e[9] * z + e[13];\r\n    this.z = e[2] * x + e[6] * y + e[10] * z + e[14];\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  applyProjection: function(m) {\r\n\r\n    // input: THREE.Matrix4 projection matrix\r\n\r\n    var x = this.x,\r\n      y = this.y,\r\n      z = this.z;\r\n\r\n    var e = m.elements;\r\n    var d = 1 / (e[3] * x + e[7] * y + e[11] * z + e[15]); // perspective divide\r\n\r\n    this.x = (e[0] * x + e[4] * y + e[8] * z + e[12]) * d;\r\n    this.y = (e[1] * x + e[5] * y + e[9] * z + e[13]) * d;\r\n    this.z = (e[2] * x + e[6] * y + e[10] * z + e[14]) * d;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  applyQuaternion: function(q) {\r\n\r\n    var x = this.x;\r\n    var y = this.y;\r\n    var z = this.z;\r\n\r\n    var qx = q.x;\r\n    var qy = q.y;\r\n    var qz = q.z;\r\n    var qw = q.w;\r\n\r\n    // calculate quat * vector\r\n\r\n    var ix = qw * x + qy * z - qz * y;\r\n    var iy = qw * y + qz * x - qx * z;\r\n    var iz = qw * z + qx * y - qy * x;\r\n    var iw = -qx * x - qy * y - qz * z;\r\n\r\n    // calculate result * inverse quat\r\n\r\n    this.x = ix * qw + iw * -qx + iy * -qz - iz * -qy;\r\n    this.y = iy * qw + iw * -qy + iz * -qx - ix * -qz;\r\n    this.z = iz * qw + iw * -qz + ix * -qy - iy * -qx;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  project: function() {\r\n\r\n    var matrix;\r\n\r\n    return function(camera) {\r\n\r\n      if (matrix === undefined) matrix = new THREE.Matrix4();\r\n\r\n      matrix.multiplyMatrices(camera.projectionMatrix, matrix.getInverse(camera.matrixWorld));\r\n      return this.applyProjection(matrix);\r\n\r\n    };\r\n\r\n  }(),\r\n\r\n  unproject: function() {\r\n\r\n    var matrix;\r\n\r\n    return function(camera) {\r\n\r\n      if (matrix === undefined) matrix = new THREE.Matrix4();\r\n\r\n      matrix.multiplyMatrices(camera.matrixWorld, matrix.getInverse(camera.projectionMatrix));\r\n      return this.applyProjection(matrix);\r\n\r\n    };\r\n\r\n  }(),\r\n\r\n  transformDirection: function(m) {\r\n\r\n    // input: THREE.Matrix4 affine matrix\r\n    // vector interpreted as a direction\r\n\r\n    var x = this.x,\r\n      y = this.y,\r\n      z = this.z;\r\n\r\n    var e = m.elements;\r\n\r\n    this.x = e[0] * x + e[4] * y + e[8] * z;\r\n    this.y = e[1] * x + e[5] * y + e[9] * z;\r\n    this.z = e[2] * x + e[6] * y + e[10] * z;\r\n\r\n    this.normalize();\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  divide: function(v) {\r\n\r\n    this.x /= v.x;\r\n    this.y /= v.y;\r\n    this.z /= v.z;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  divideScalar: function(scalar) {\r\n\r\n    if (scalar !== 0) {\r\n\r\n      var invScalar = 1 / scalar;\r\n\r\n      this.x *= invScalar;\r\n      this.y *= invScalar;\r\n      this.z *= invScalar;\r\n\r\n    }\r\n    else {\r\n\r\n      this.x = 0;\r\n      this.y = 0;\r\n      this.z = 0;\r\n\r\n    }\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  min: function(v) {\r\n\r\n    if (this.x > v.x) {\r\n\r\n      this.x = v.x;\r\n\r\n    }\r\n\r\n    if (this.y > v.y) {\r\n\r\n      this.y = v.y;\r\n\r\n    }\r\n\r\n    if (this.z > v.z) {\r\n\r\n      this.z = v.z;\r\n\r\n    }\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  max: function(v) {\r\n\r\n    if (this.x < v.x) {\r\n\r\n      this.x = v.x;\r\n\r\n    }\r\n\r\n    if (this.y < v.y) {\r\n\r\n      this.y = v.y;\r\n\r\n    }\r\n\r\n    if (this.z < v.z) {\r\n\r\n      this.z = v.z;\r\n\r\n    }\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  clamp: function(min, max) {\r\n\r\n    // This function assumes min < max, if this assumption isn't true it will not operate correctly\r\n\r\n    if (this.x < min.x) {\r\n\r\n      this.x = min.x;\r\n\r\n    }\r\n    else if (this.x > max.x) {\r\n\r\n      this.x = max.x;\r\n\r\n    }\r\n\r\n    if (this.y < min.y) {\r\n\r\n      this.y = min.y;\r\n\r\n    }\r\n    else if (this.y > max.y) {\r\n\r\n      this.y = max.y;\r\n\r\n    }\r\n\r\n    if (this.z < min.z) {\r\n\r\n      this.z = min.z;\r\n\r\n    }\r\n    else if (this.z > max.z) {\r\n\r\n      this.z = max.z;\r\n\r\n    }\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  clampScalar: (function() {\r\n\r\n    var min, max;\r\n\r\n    return function(minVal, maxVal) {\r\n\r\n      if (min === undefined) {\r\n\r\n        min = new THREE.Vector3();\r\n        max = new THREE.Vector3();\r\n\r\n      }\r\n\r\n      min.set(minVal, minVal, minVal);\r\n      max.set(maxVal, maxVal, maxVal);\r\n\r\n      return this.clamp(min, max);\r\n\r\n    };\r\n\r\n  })(),\r\n\r\n  floor: function() {\r\n\r\n    this.x = Math.floor(this.x);\r\n    this.y = Math.floor(this.y);\r\n    this.z = Math.floor(this.z);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  ceil: function() {\r\n\r\n    this.x = Math.ceil(this.x);\r\n    this.y = Math.ceil(this.y);\r\n    this.z = Math.ceil(this.z);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  round: function() {\r\n\r\n    this.x = Math.round(this.x);\r\n    this.y = Math.round(this.y);\r\n    this.z = Math.round(this.z);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  roundToZero: function() {\r\n\r\n    this.x = (this.x < 0) ? Math.ceil(this.x) : Math.floor(this.x);\r\n    this.y = (this.y < 0) ? Math.ceil(this.y) : Math.floor(this.y);\r\n    this.z = (this.z < 0) ? Math.ceil(this.z) : Math.floor(this.z);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  negate: function() {\r\n\r\n    this.x = -this.x;\r\n    this.y = -this.y;\r\n    this.z = -this.z;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  dot: function(v) {\r\n\r\n    return this.x * v.x + this.y * v.y + this.z * v.z;\r\n\r\n  },\r\n\r\n  lengthSq: function() {\r\n\r\n    return this.x * this.x + this.y * this.y + this.z * this.z;\r\n\r\n  },\r\n\r\n  length: function() {\r\n\r\n    return Math.sqrt(this.x * this.x + this.y * this.y + this.z * this.z);\r\n\r\n  },\r\n\r\n  lengthManhattan: function() {\r\n\r\n    return Math.abs(this.x) + Math.abs(this.y) + Math.abs(this.z);\r\n\r\n  },\r\n\r\n  normalize: function() {\r\n\r\n    return this.divideScalar(this.length());\r\n\r\n  },\r\n\r\n  setLength: function(l) {\r\n\r\n    var oldLength = this.length();\r\n\r\n    if (oldLength !== 0 && l !== oldLength) {\r\n\r\n      this.multiplyScalar(l / oldLength);\r\n    }\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  lerp: function(v, alpha) {\r\n\r\n    this.x += (v.x - this.x) * alpha;\r\n    this.y += (v.y - this.y) * alpha;\r\n    this.z += (v.z - this.z) * alpha;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  lerpVectors: function(v1, v2, alpha) {\r\n\r\n    this.subVectors(v2, v1).multiplyScalar(alpha).add(v1);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  cross: function(v, w) {\r\n\r\n    if (w !== undefined) {\r\n\r\n      THREE.warn('THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead.');\r\n      return this.crossVectors(v, w);\r\n\r\n    }\r\n\r\n    var x = this.x,\r\n      y = this.y,\r\n      z = this.z;\r\n\r\n    this.x = y * v.z - z * v.y;\r\n    this.y = z * v.x - x * v.z;\r\n    this.z = x * v.y - y * v.x;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  crossVectors: function(a, b) {\r\n\r\n    var ax = a.x,\r\n      ay = a.y,\r\n      az = a.z;\r\n    var bx = b.x,\r\n      by = b.y,\r\n      bz = b.z;\r\n\r\n    this.x = ay * bz - az * by;\r\n    this.y = az * bx - ax * bz;\r\n    this.z = ax * by - ay * bx;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  projectOnVector: function() {\r\n\r\n    var v1, dot;\r\n\r\n    return function(vector) {\r\n\r\n      if (v1 === undefined) v1 = new THREE.Vector3();\r\n\r\n      v1.copy(vector).normalize();\r\n\r\n      dot = this.dot(v1);\r\n\r\n      return this.copy(v1).multiplyScalar(dot);\r\n\r\n    };\r\n\r\n  }(),\r\n\r\n  projectOnPlane: function() {\r\n\r\n    var v1;\r\n\r\n    return function(planeNormal) {\r\n\r\n      if (v1 === undefined) v1 = new THREE.Vector3();\r\n\r\n      v1.copy(this).projectOnVector(planeNormal);\r\n\r\n      return this.sub(v1);\r\n\r\n    }\r\n\r\n  }(),\r\n\r\n  reflect: function() {\r\n\r\n    // reflect incident vector off plane orthogonal to normal\r\n    // normal is assumed to have unit length\r\n\r\n    var v1;\r\n\r\n    return function(normal) {\r\n\r\n      if (v1 === undefined) v1 = new THREE.Vector3();\r\n\r\n      return this.sub(v1.copy(normal).multiplyScalar(2 * this.dot(normal)));\r\n\r\n    }\r\n\r\n  }(),\r\n\r\n  angleTo: function(v) {\r\n\r\n    var theta = this.dot(v) / (this.length() * v.length());\r\n\r\n    // clamp, to handle numerical problems\r\n\r\n    return Math.acos(THREE.Math.clamp(theta, -1, 1));\r\n\r\n  },\r\n\r\n  distanceTo: function(v) {\r\n\r\n    return Math.sqrt(this.distanceToSquared(v));\r\n\r\n  },\r\n\r\n  distanceToSquared: function(v) {\r\n\r\n    var dx = this.x - v.x;\r\n    var dy = this.y - v.y;\r\n    var dz = this.z - v.z;\r\n\r\n    return dx * dx + dy * dy + dz * dz;\r\n\r\n  },\r\n\r\n  setEulerFromRotationMatrix: function(m, order) {\r\n\r\n    THREE.error('THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.');\r\n\r\n  },\r\n\r\n  setEulerFromQuaternion: function(q, order) {\r\n\r\n    THREE.error('THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.');\r\n\r\n  },\r\n\r\n  getPositionFromMatrix: function(m) {\r\n\r\n    THREE.warn('THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition().');\r\n\r\n    return this.setFromMatrixPosition(m);\r\n\r\n  },\r\n\r\n  getScaleFromMatrix: function(m) {\r\n\r\n    THREE.warn('THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale().');\r\n\r\n    return this.setFromMatrixScale(m);\r\n  },\r\n\r\n  getColumnFromMatrix: function(index, matrix) {\r\n\r\n    THREE.warn('THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn().');\r\n\r\n    return this.setFromMatrixColumn(index, matrix);\r\n\r\n  },\r\n\r\n  setFromMatrixPosition: function(m) {\r\n\r\n    this.x = m.elements[12];\r\n    this.y = m.elements[13];\r\n    this.z = m.elements[14];\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  setFromMatrixScale: function(m) {\r\n\r\n    var sx = this.set(m.elements[0], m.elements[1], m.elements[2]).length();\r\n    var sy = this.set(m.elements[4], m.elements[5], m.elements[6]).length();\r\n    var sz = this.set(m.elements[8], m.elements[9], m.elements[10]).length();\r\n\r\n    this.x = sx;\r\n    this.y = sy;\r\n    this.z = sz;\r\n\r\n    return this;\r\n  },\r\n\r\n  setFromMatrixColumn: function(index, matrix) {\r\n\r\n    var offset = index * 4;\r\n\r\n    var me = matrix.elements;\r\n\r\n    this.x = me[offset];\r\n    this.y = me[offset + 1];\r\n    this.z = me[offset + 2];\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  equals: function(v) {\r\n\r\n    return ((v.x === this.x) && (v.y === this.y) && (v.z === this.z));\r\n\r\n  },\r\n\r\n  fromArray: function(array, offset) {\r\n\r\n    if (offset === undefined) offset = 0;\r\n\r\n    this.x = array[offset];\r\n    this.y = array[offset + 1];\r\n    this.z = array[offset + 2];\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  toArray: function(array, offset) {\r\n\r\n    if (array === undefined) array = [];\r\n    if (offset === undefined) offset = 0;\r\n\r\n    array[offset] = this.x;\r\n    array[offset + 1] = this.y;\r\n    array[offset + 2] = this.z;\r\n\r\n    return array;\r\n\r\n  },\r\n\r\n  fromAttribute: function(attribute, index, offset) {\r\n\r\n    if (offset === undefined) offset = 0;\r\n\r\n    index = index * attribute.itemSize + offset;\r\n\r\n    this.x = attribute.array[index];\r\n    this.y = attribute.array[index + 1];\r\n    this.z = attribute.array[index + 2];\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  clone: function() {\r\n\r\n    return new THREE.Vector3(this.x, this.y, this.z);\r\n\r\n  }\r\n\r\n};\r\n\r\n// File:src/math/Vector4.js\r\n\r\n/**\r\n * @author supereggbert / http://www.paulbrunt.co.uk/\r\n * @author philogb / http://blog.thejit.org/\r\n * @author mikael emtinger / http://gomo.se/\r\n * @author egraether / http://egraether.com/\r\n * @author WestLangley / http://github.com/WestLangley\r\n */\r\n\r\nTHREE.Vector4 = function(x, y, z, w) {\r\n\r\n  this.x = x || 0;\r\n  this.y = y || 0;\r\n  this.z = z || 0;\r\n  this.w = (w !== undefined) ? w : 1;\r\n\r\n};\r\n\r\nTHREE.Vector4.prototype = {\r\n\r\n  constructor: THREE.Vector4,\r\n\r\n  set: function(x, y, z, w) {\r\n\r\n    this.x = x;\r\n    this.y = y;\r\n    this.z = z;\r\n    this.w = w;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  setX: function(x) {\r\n\r\n    this.x = x;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  setY: function(y) {\r\n\r\n    this.y = y;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  setZ: function(z) {\r\n\r\n    this.z = z;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  setW: function(w) {\r\n\r\n    this.w = w;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  setComponent: function(index, value) {\r\n\r\n    switch (index) {\r\n\r\n      case 0:\r\n        this.x = value;\r\n        break;\r\n      case 1:\r\n        this.y = value;\r\n        break;\r\n      case 2:\r\n        this.z = value;\r\n        break;\r\n      case 3:\r\n        this.w = value;\r\n        break;\r\n      default:\r\n        throw new Error('index is out of range: ' + index);\r\n\r\n    }\r\n\r\n  },\r\n\r\n  getComponent: function(index) {\r\n\r\n    switch (index) {\r\n\r\n      case 0:\r\n        return this.x;\r\n      case 1:\r\n        return this.y;\r\n      case 2:\r\n        return this.z;\r\n      case 3:\r\n        return this.w;\r\n      default:\r\n        throw new Error('index is out of range: ' + index);\r\n\r\n    }\r\n\r\n  },\r\n\r\n  copy: function(v) {\r\n\r\n    this.x = v.x;\r\n    this.y = v.y;\r\n    this.z = v.z;\r\n    this.w = (v.w !== undefined) ? v.w : 1;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  add: function(v, w) {\r\n\r\n    if (w !== undefined) {\r\n\r\n      THREE.warn('THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead.');\r\n      return this.addVectors(v, w);\r\n\r\n    }\r\n\r\n    this.x += v.x;\r\n    this.y += v.y;\r\n    this.z += v.z;\r\n    this.w += v.w;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  addScalar: function(s) {\r\n\r\n    this.x += s;\r\n    this.y += s;\r\n    this.z += s;\r\n    this.w += s;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  addVectors: function(a, b) {\r\n\r\n    this.x = a.x + b.x;\r\n    this.y = a.y + b.y;\r\n    this.z = a.z + b.z;\r\n    this.w = a.w + b.w;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  sub: function(v, w) {\r\n\r\n    if (w !== undefined) {\r\n\r\n      THREE.warn('THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead.');\r\n      return this.subVectors(v, w);\r\n\r\n    }\r\n\r\n    this.x -= v.x;\r\n    this.y -= v.y;\r\n    this.z -= v.z;\r\n    this.w -= v.w;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  subScalar: function(s) {\r\n\r\n    this.x -= s;\r\n    this.y -= s;\r\n    this.z -= s;\r\n    this.w -= s;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  subVectors: function(a, b) {\r\n\r\n    this.x = a.x - b.x;\r\n    this.y = a.y - b.y;\r\n    this.z = a.z - b.z;\r\n    this.w = a.w - b.w;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  multiplyScalar: function(scalar) {\r\n\r\n    this.x *= scalar;\r\n    this.y *= scalar;\r\n    this.z *= scalar;\r\n    this.w *= scalar;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  applyMatrix4: function(m) {\r\n\r\n    var x = this.x;\r\n    var y = this.y;\r\n    var z = this.z;\r\n    var w = this.w;\r\n\r\n    var e = m.elements;\r\n\r\n    this.x = e[0] * x + e[4] * y + e[8] * z + e[12] * w;\r\n    this.y = e[1] * x + e[5] * y + e[9] * z + e[13] * w;\r\n    this.z = e[2] * x + e[6] * y + e[10] * z + e[14] * w;\r\n    this.w = e[3] * x + e[7] * y + e[11] * z + e[15] * w;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  divideScalar: function(scalar) {\r\n\r\n    if (scalar !== 0) {\r\n\r\n      var invScalar = 1 / scalar;\r\n\r\n      this.x *= invScalar;\r\n      this.y *= invScalar;\r\n      this.z *= invScalar;\r\n      this.w *= invScalar;\r\n\r\n    }\r\n    else {\r\n\r\n      this.x = 0;\r\n      this.y = 0;\r\n      this.z = 0;\r\n      this.w = 1;\r\n\r\n    }\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  setAxisAngleFromQuaternion: function(q) {\r\n\r\n    // http://www.euclideanspace.com/maths/geometry/rotations/conversions/quaternionToAngle/index.htm\r\n\r\n    // q is assumed to be normalized\r\n\r\n    this.w = 2 * Math.acos(q.w);\r\n\r\n    var s = Math.sqrt(1 - q.w * q.w);\r\n\r\n    if (s < 0.0001) {\r\n\r\n      this.x = 1;\r\n      this.y = 0;\r\n      this.z = 0;\r\n\r\n    }\r\n    else {\r\n\r\n      this.x = q.x / s;\r\n      this.y = q.y / s;\r\n      this.z = q.z / s;\r\n\r\n    }\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  setAxisAngleFromRotationMatrix: function(m) {\r\n\r\n    // http://www.euclideanspace.com/maths/geometry/rotations/conversions/matrixToAngle/index.htm\r\n\r\n    // assumes the upper 3x3 of m is a pure rotation matrix (i.e, unscaled)\r\n\r\n    var angle, x, y, z, // variables for result\r\n      epsilon = 0.01, // margin to allow for rounding errors\r\n      epsilon2 = 0.1, // margin to distinguish between 0 and 180 degrees\r\n\r\n      te = m.elements,\r\n\r\n      m11 = te[0],\r\n      m12 = te[4],\r\n      m13 = te[8],\r\n      m21 = te[1],\r\n      m22 = te[5],\r\n      m23 = te[9],\r\n      m31 = te[2],\r\n      m32 = te[6],\r\n      m33 = te[10];\r\n\r\n    if ((Math.abs(m12 - m21) < epsilon) && (Math.abs(m13 - m31) < epsilon) && (Math.abs(m23 - m32) < epsilon)) {\r\n\r\n      // singularity found\r\n      // first check for identity matrix which must have +1 for all terms\r\n      // in leading diagonal and zero in other terms\r\n\r\n      if ((Math.abs(m12 + m21) < epsilon2) && (Math.abs(m13 + m31) < epsilon2) && (Math.abs(m23 + m32) < epsilon2) && (Math.abs(m11 + m22 + m33 - 3) < epsilon2)) {\r\n\r\n        // this singularity is identity matrix so angle = 0\r\n\r\n        this.set(1, 0, 0, 0);\r\n\r\n        return this; // zero angle, arbitrary axis\r\n\r\n      }\r\n\r\n      // otherwise this singularity is angle = 180\r\n\r\n      angle = Math.PI;\r\n\r\n      var xx = (m11 + 1) / 2;\r\n      var yy = (m22 + 1) / 2;\r\n      var zz = (m33 + 1) / 2;\r\n      var xy = (m12 + m21) / 4;\r\n      var xz = (m13 + m31) / 4;\r\n      var yz = (m23 + m32) / 4;\r\n\r\n      if ((xx > yy) && (xx > zz)) { // m11 is the largest diagonal term\r\n\r\n        if (xx < epsilon) {\r\n\r\n          x = 0;\r\n          y = 0.707106781;\r\n          z = 0.707106781;\r\n\r\n        }\r\n        else {\r\n\r\n          x = Math.sqrt(xx);\r\n          y = xy / x;\r\n          z = xz / x;\r\n\r\n        }\r\n\r\n      }\r\n      else if (yy > zz) { // m22 is the largest diagonal term\r\n\r\n        if (yy < epsilon) {\r\n\r\n          x = 0.707106781;\r\n          y = 0;\r\n          z = 0.707106781;\r\n\r\n        }\r\n        else {\r\n\r\n          y = Math.sqrt(yy);\r\n          x = xy / y;\r\n          z = yz / y;\r\n\r\n        }\r\n\r\n      }\r\n      else { // m33 is the largest diagonal term so base result on this\r\n\r\n        if (zz < epsilon) {\r\n\r\n          x = 0.707106781;\r\n          y = 0.707106781;\r\n          z = 0;\r\n\r\n        }\r\n        else {\r\n\r\n          z = Math.sqrt(zz);\r\n          x = xz / z;\r\n          y = yz / z;\r\n\r\n        }\r\n\r\n      }\r\n\r\n      this.set(x, y, z, angle);\r\n\r\n      return this; // return 180 deg rotation\r\n\r\n    }\r\n\r\n    // as we have reached here there are no singularities so we can handle normally\r\n\r\n    var s = Math.sqrt((m32 - m23) * (m32 - m23) + (m13 - m31) * (m13 - m31) + (m21 - m12) * (m21 - m12)); // used to normalize\r\n\r\n    if (Math.abs(s) < 0.001) s = 1;\r\n\r\n    // prevent divide by zero, should not happen if matrix is orthogonal and should be\r\n    // caught by singularity test above, but I've left it in just in case\r\n\r\n    this.x = (m32 - m23) / s;\r\n    this.y = (m13 - m31) / s;\r\n    this.z = (m21 - m12) / s;\r\n    this.w = Math.acos((m11 + m22 + m33 - 1) / 2);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  min: function(v) {\r\n\r\n    if (this.x > v.x) {\r\n\r\n      this.x = v.x;\r\n\r\n    }\r\n\r\n    if (this.y > v.y) {\r\n\r\n      this.y = v.y;\r\n\r\n    }\r\n\r\n    if (this.z > v.z) {\r\n\r\n      this.z = v.z;\r\n\r\n    }\r\n\r\n    if (this.w > v.w) {\r\n\r\n      this.w = v.w;\r\n\r\n    }\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  max: function(v) {\r\n\r\n    if (this.x < v.x) {\r\n\r\n      this.x = v.x;\r\n\r\n    }\r\n\r\n    if (this.y < v.y) {\r\n\r\n      this.y = v.y;\r\n\r\n    }\r\n\r\n    if (this.z < v.z) {\r\n\r\n      this.z = v.z;\r\n\r\n    }\r\n\r\n    if (this.w < v.w) {\r\n\r\n      this.w = v.w;\r\n\r\n    }\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  clamp: function(min, max) {\r\n\r\n    // This function assumes min < max, if this assumption isn't true it will not operate correctly\r\n\r\n    if (this.x < min.x) {\r\n\r\n      this.x = min.x;\r\n\r\n    }\r\n    else if (this.x > max.x) {\r\n\r\n      this.x = max.x;\r\n\r\n    }\r\n\r\n    if (this.y < min.y) {\r\n\r\n      this.y = min.y;\r\n\r\n    }\r\n    else if (this.y > max.y) {\r\n\r\n      this.y = max.y;\r\n\r\n    }\r\n\r\n    if (this.z < min.z) {\r\n\r\n      this.z = min.z;\r\n\r\n    }\r\n    else if (this.z > max.z) {\r\n\r\n      this.z = max.z;\r\n\r\n    }\r\n\r\n    if (this.w < min.w) {\r\n\r\n      this.w = min.w;\r\n\r\n    }\r\n    else if (this.w > max.w) {\r\n\r\n      this.w = max.w;\r\n\r\n    }\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  clampScalar: (function() {\r\n\r\n    var min, max;\r\n\r\n    return function(minVal, maxVal) {\r\n\r\n      if (min === undefined) {\r\n\r\n        min = new THREE.Vector4();\r\n        max = new THREE.Vector4();\r\n\r\n      }\r\n\r\n      min.set(minVal, minVal, minVal, minVal);\r\n      max.set(maxVal, maxVal, maxVal, maxVal);\r\n\r\n      return this.clamp(min, max);\r\n\r\n    };\r\n\r\n  })(),\r\n\r\n  floor: function() {\r\n\r\n    this.x = Math.floor(this.x);\r\n    this.y = Math.floor(this.y);\r\n    this.z = Math.floor(this.z);\r\n    this.w = Math.floor(this.w);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  ceil: function() {\r\n\r\n    this.x = Math.ceil(this.x);\r\n    this.y = Math.ceil(this.y);\r\n    this.z = Math.ceil(this.z);\r\n    this.w = Math.ceil(this.w);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  round: function() {\r\n\r\n    this.x = Math.round(this.x);\r\n    this.y = Math.round(this.y);\r\n    this.z = Math.round(this.z);\r\n    this.w = Math.round(this.w);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  roundToZero: function() {\r\n\r\n    this.x = (this.x < 0) ? Math.ceil(this.x) : Math.floor(this.x);\r\n    this.y = (this.y < 0) ? Math.ceil(this.y) : Math.floor(this.y);\r\n    this.z = (this.z < 0) ? Math.ceil(this.z) : Math.floor(this.z);\r\n    this.w = (this.w < 0) ? Math.ceil(this.w) : Math.floor(this.w);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  negate: function() {\r\n\r\n    this.x = -this.x;\r\n    this.y = -this.y;\r\n    this.z = -this.z;\r\n    this.w = -this.w;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  dot: function(v) {\r\n\r\n    return this.x * v.x + this.y * v.y + this.z * v.z + this.w * v.w;\r\n\r\n  },\r\n\r\n  lengthSq: function() {\r\n\r\n    return this.x * this.x + this.y * this.y + this.z * this.z + this.w * this.w;\r\n\r\n  },\r\n\r\n  length: function() {\r\n\r\n    return Math.sqrt(this.x * this.x + this.y * this.y + this.z * this.z + this.w * this.w);\r\n\r\n  },\r\n\r\n  lengthManhattan: function() {\r\n\r\n    return Math.abs(this.x) + Math.abs(this.y) + Math.abs(this.z) + Math.abs(this.w);\r\n\r\n  },\r\n\r\n  normalize: function() {\r\n\r\n    return this.divideScalar(this.length());\r\n\r\n  },\r\n\r\n  setLength: function(l) {\r\n\r\n    var oldLength = this.length();\r\n\r\n    if (oldLength !== 0 && l !== oldLength) {\r\n\r\n      this.multiplyScalar(l / oldLength);\r\n\r\n    }\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  lerp: function(v, alpha) {\r\n\r\n    this.x += (v.x - this.x) * alpha;\r\n    this.y += (v.y - this.y) * alpha;\r\n    this.z += (v.z - this.z) * alpha;\r\n    this.w += (v.w - this.w) * alpha;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  lerpVectors: function(v1, v2, alpha) {\r\n\r\n    this.subVectors(v2, v1).multiplyScalar(alpha).add(v1);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  equals: function(v) {\r\n\r\n    return ((v.x === this.x) && (v.y === this.y) && (v.z === this.z) && (v.w === this.w));\r\n\r\n  },\r\n\r\n  fromArray: function(array, offset) {\r\n\r\n    if (offset === undefined) offset = 0;\r\n\r\n    this.x = array[offset];\r\n    this.y = array[offset + 1];\r\n    this.z = array[offset + 2];\r\n    this.w = array[offset + 3];\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  toArray: function(array, offset) {\r\n\r\n    if (array === undefined) array = [];\r\n    if (offset === undefined) offset = 0;\r\n\r\n    array[offset] = this.x;\r\n    array[offset + 1] = this.y;\r\n    array[offset + 2] = this.z;\r\n    array[offset + 3] = this.w;\r\n\r\n    return array;\r\n\r\n  },\r\n\r\n  fromAttribute: function(attribute, index, offset) {\r\n\r\n    if (offset === undefined) offset = 0;\r\n\r\n    index = index * attribute.itemSize + offset;\r\n\r\n    this.x = attribute.array[index];\r\n    this.y = attribute.array[index + 1];\r\n    this.z = attribute.array[index + 2];\r\n    this.w = attribute.array[index + 3];\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  clone: function() {\r\n\r\n    return new THREE.Vector4(this.x, this.y, this.z, this.w);\r\n\r\n  }\r\n\r\n};\r\n\r\n// File:src/math/Euler.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author WestLangley / http://github.com/WestLangley\r\n * @author bhouston / http://exocortex.com\r\n */\r\n\r\nTHREE.Euler = function(x, y, z, order) {\r\n\r\n  this._x = x || 0;\r\n  this._y = y || 0;\r\n  this._z = z || 0;\r\n  this._order = order || THREE.Euler.DefaultOrder;\r\n\r\n};\r\n\r\nTHREE.Euler.RotationOrders = ['XYZ', 'YZX', 'ZXY', 'XZY', 'YXZ', 'ZYX'];\r\n\r\nTHREE.Euler.DefaultOrder = 'XYZ';\r\n\r\nTHREE.Euler.prototype = {\r\n\r\n  constructor: THREE.Euler,\r\n\r\n  _x: 0,\r\n  _y: 0,\r\n  _z: 0,\r\n  _order: THREE.Euler.DefaultOrder,\r\n\r\n  get x() {\r\n\r\n    return this._x;\r\n\r\n  },\r\n\r\n  set x(value) {\r\n\r\n    this._x = value;\r\n    this.onChangeCallback();\r\n\r\n  },\r\n\r\n  get y() {\r\n\r\n    return this._y;\r\n\r\n  },\r\n\r\n  set y(value) {\r\n\r\n    this._y = value;\r\n    this.onChangeCallback();\r\n\r\n  },\r\n\r\n  get z() {\r\n\r\n    return this._z;\r\n\r\n  },\r\n\r\n  set z(value) {\r\n\r\n    this._z = value;\r\n    this.onChangeCallback();\r\n\r\n  },\r\n\r\n  get order() {\r\n\r\n    return this._order;\r\n\r\n  },\r\n\r\n  set order(value) {\r\n\r\n    this._order = value;\r\n    this.onChangeCallback();\r\n\r\n  },\r\n\r\n  set: function(x, y, z, order) {\r\n\r\n    this._x = x;\r\n    this._y = y;\r\n    this._z = z;\r\n    this._order = order || this._order;\r\n\r\n    this.onChangeCallback();\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  copy: function(euler) {\r\n\r\n    this._x = euler._x;\r\n    this._y = euler._y;\r\n    this._z = euler._z;\r\n    this._order = euler._order;\r\n\r\n    this.onChangeCallback();\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  setFromRotationMatrix: function(m, order, update) {\r\n\r\n    var clamp = THREE.Math.clamp;\r\n\r\n    // assumes the upper 3x3 of m is a pure rotation matrix (i.e, unscaled)\r\n\r\n    var te = m.elements;\r\n    var m11 = te[0],\r\n      m12 = te[4],\r\n      m13 = te[8];\r\n    var m21 = te[1],\r\n      m22 = te[5],\r\n      m23 = te[9];\r\n    var m31 = te[2],\r\n      m32 = te[6],\r\n      m33 = te[10];\r\n\r\n    order = order || this._order;\r\n\r\n    if (order === 'XYZ') {\r\n\r\n      this._y = Math.asin(clamp(m13, -1, 1));\r\n\r\n      if (Math.abs(m13) < 0.99999) {\r\n\r\n        this._x = Math.atan2(-m23, m33);\r\n        this._z = Math.atan2(-m12, m11);\r\n\r\n      }\r\n      else {\r\n\r\n        this._x = Math.atan2(m32, m22);\r\n        this._z = 0;\r\n\r\n      }\r\n\r\n    }\r\n    else if (order === 'YXZ') {\r\n\r\n      this._x = Math.asin(-clamp(m23, -1, 1));\r\n\r\n      if (Math.abs(m23) < 0.99999) {\r\n\r\n        this._y = Math.atan2(m13, m33);\r\n        this._z = Math.atan2(m21, m22);\r\n\r\n      }\r\n      else {\r\n\r\n        this._y = Math.atan2(-m31, m11);\r\n        this._z = 0;\r\n\r\n      }\r\n\r\n    }\r\n    else if (order === 'ZXY') {\r\n\r\n      this._x = Math.asin(clamp(m32, -1, 1));\r\n\r\n      if (Math.abs(m32) < 0.99999) {\r\n\r\n        this._y = Math.atan2(-m31, m33);\r\n        this._z = Math.atan2(-m12, m22);\r\n\r\n      }\r\n      else {\r\n\r\n        this._y = 0;\r\n        this._z = Math.atan2(m21, m11);\r\n\r\n      }\r\n\r\n    }\r\n    else if (order === 'ZYX') {\r\n\r\n      this._y = Math.asin(-clamp(m31, -1, 1));\r\n\r\n      if (Math.abs(m31) < 0.99999) {\r\n\r\n        this._x = Math.atan2(m32, m33);\r\n        this._z = Math.atan2(m21, m11);\r\n\r\n      }\r\n      else {\r\n\r\n        this._x = 0;\r\n        this._z = Math.atan2(-m12, m22);\r\n\r\n      }\r\n\r\n    }\r\n    else if (order === 'YZX') {\r\n\r\n      this._z = Math.asin(clamp(m21, -1, 1));\r\n\r\n      if (Math.abs(m21) < 0.99999) {\r\n\r\n        this._x = Math.atan2(-m23, m22);\r\n        this._y = Math.atan2(-m31, m11);\r\n\r\n      }\r\n      else {\r\n\r\n        this._x = 0;\r\n        this._y = Math.atan2(m13, m33);\r\n\r\n      }\r\n\r\n    }\r\n    else if (order === 'XZY') {\r\n\r\n      this._z = Math.asin(-clamp(m12, -1, 1));\r\n\r\n      if (Math.abs(m12) < 0.99999) {\r\n\r\n        this._x = Math.atan2(m32, m22);\r\n        this._y = Math.atan2(m13, m11);\r\n\r\n      }\r\n      else {\r\n\r\n        this._x = Math.atan2(-m23, m33);\r\n        this._y = 0;\r\n\r\n      }\r\n\r\n    }\r\n    else {\r\n\r\n      THREE.warn('THREE.Euler: .setFromRotationMatrix() given unsupported order: ' + order)\r\n\r\n    }\r\n\r\n    this._order = order;\r\n\r\n    if (update !== false) this.onChangeCallback();\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  setFromQuaternion: function() {\r\n\r\n    var matrix;\r\n\r\n    return function(q, order, update) {\r\n\r\n      if (matrix === undefined) matrix = new THREE.Matrix4();\r\n      matrix.makeRotationFromQuaternion(q);\r\n      this.setFromRotationMatrix(matrix, order, update);\r\n\r\n      return this;\r\n\r\n    };\r\n\r\n  }(),\r\n\r\n  setFromVector3: function(v, order) {\r\n\r\n    return this.set(v.x, v.y, v.z, order || this._order);\r\n\r\n  },\r\n\r\n  reorder: function() {\r\n\r\n    // WARNING: this discards revolution information -bhouston\r\n\r\n    var q = new THREE.Quaternion();\r\n\r\n    return function(newOrder) {\r\n\r\n      q.setFromEuler(this);\r\n      this.setFromQuaternion(q, newOrder);\r\n\r\n    };\r\n\r\n  }(),\r\n\r\n  equals: function(euler) {\r\n\r\n    return (euler._x === this._x) && (euler._y === this._y) && (euler._z === this._z) && (euler._order === this._order);\r\n\r\n  },\r\n\r\n  fromArray: function(array) {\r\n\r\n    this._x = array[0];\r\n    this._y = array[1];\r\n    this._z = array[2];\r\n    if (array[3] !== undefined) this._order = array[3];\r\n\r\n    this.onChangeCallback();\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  toArray: function(array, offset) {\r\n\r\n    if (array === undefined) array = [];\r\n    if (offset === undefined) offset = 0;\r\n\r\n    array[offset] = this._x;\r\n    array[offset + 1] = this._y;\r\n    array[offset + 2] = this._z;\r\n    array[offset + 3] = this._order;\r\n\r\n    return array;\r\n  },\r\n\r\n  toVector3: function(optionalResult) {\r\n\r\n    if (optionalResult) {\r\n\r\n      return optionalResult.set(this._x, this._y, this._z);\r\n\r\n    }\r\n    else {\r\n\r\n      return new THREE.Vector3(this._x, this._y, this._z);\r\n\r\n    }\r\n\r\n  },\r\n\r\n  onChange: function(callback) {\r\n\r\n    this.onChangeCallback = callback;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  onChangeCallback: function() {},\r\n\r\n  clone: function() {\r\n\r\n    return new THREE.Euler(this._x, this._y, this._z, this._order);\r\n\r\n  }\r\n\r\n};\r\n\r\n// File:src/math/Line3.js\r\n\r\n/**\r\n * @author bhouston / http://exocortex.com\r\n */\r\n\r\nTHREE.Line3 = function(start, end) {\r\n\r\n  this.start = (start !== undefined) ? start : new THREE.Vector3();\r\n  this.end = (end !== undefined) ? end : new THREE.Vector3();\r\n\r\n};\r\n\r\nTHREE.Line3.prototype = {\r\n\r\n  constructor: THREE.Line3,\r\n\r\n  set: function(start, end) {\r\n\r\n    this.start.copy(start);\r\n    this.end.copy(end);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  copy: function(line) {\r\n\r\n    this.start.copy(line.start);\r\n    this.end.copy(line.end);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  center: function(optionalTarget) {\r\n\r\n    var result = optionalTarget || new THREE.Vector3();\r\n    return result.addVectors(this.start, this.end).multiplyScalar(0.5);\r\n\r\n  },\r\n\r\n  delta: function(optionalTarget) {\r\n\r\n    var result = optionalTarget || new THREE.Vector3();\r\n    return result.subVectors(this.end, this.start);\r\n\r\n  },\r\n\r\n  distanceSq: function() {\r\n\r\n    return this.start.distanceToSquared(this.end);\r\n\r\n  },\r\n\r\n  distance: function() {\r\n\r\n    return this.start.distanceTo(this.end);\r\n\r\n  },\r\n\r\n  at: function(t, optionalTarget) {\r\n\r\n    var result = optionalTarget || new THREE.Vector3();\r\n\r\n    return this.delta(result).multiplyScalar(t).add(this.start);\r\n\r\n  },\r\n\r\n  closestPointToPointParameter: function() {\r\n\r\n    var startP = new THREE.Vector3();\r\n    var startEnd = new THREE.Vector3();\r\n\r\n    return function(point, clampToLine) {\r\n\r\n      startP.subVectors(point, this.start);\r\n      startEnd.subVectors(this.end, this.start);\r\n\r\n      var startEnd2 = startEnd.dot(startEnd);\r\n      var startEnd_startP = startEnd.dot(startP);\r\n\r\n      var t = startEnd_startP / startEnd2;\r\n\r\n      if (clampToLine) {\r\n\r\n        t = THREE.Math.clamp(t, 0, 1);\r\n\r\n      }\r\n\r\n      return t;\r\n\r\n    };\r\n\r\n  }(),\r\n\r\n  closestPointToPoint: function(point, clampToLine, optionalTarget) {\r\n\r\n    var t = this.closestPointToPointParameter(point, clampToLine);\r\n\r\n    var result = optionalTarget || new THREE.Vector3();\r\n\r\n    return this.delta(result).multiplyScalar(t).add(this.start);\r\n\r\n  },\r\n\r\n  applyMatrix4: function(matrix) {\r\n\r\n    this.start.applyMatrix4(matrix);\r\n    this.end.applyMatrix4(matrix);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  equals: function(line) {\r\n\r\n    return line.start.equals(this.start) && line.end.equals(this.end);\r\n\r\n  },\r\n\r\n  clone: function() {\r\n\r\n    return new THREE.Line3().copy(this);\r\n\r\n  }\r\n\r\n};\r\n\r\n// File:src/math/Box2.js\r\n\r\n/**\r\n * @author bhouston / http://exocortex.com\r\n */\r\n\r\nTHREE.Box2 = function(min, max) {\r\n\r\n  this.min = (min !== undefined) ? min : new THREE.Vector2(Infinity, Infinity);\r\n  this.max = (max !== undefined) ? max : new THREE.Vector2(-Infinity, -Infinity);\r\n\r\n};\r\n\r\nTHREE.Box2.prototype = {\r\n\r\n  constructor: THREE.Box2,\r\n\r\n  set: function(min, max) {\r\n\r\n    this.min.copy(min);\r\n    this.max.copy(max);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  setFromPoints: function(points) {\r\n\r\n    this.makeEmpty();\r\n\r\n    for (var i = 0, il = points.length; i < il; i++) {\r\n\r\n      this.expandByPoint(points[i])\r\n\r\n    }\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  setFromCenterAndSize: function() {\r\n\r\n    var v1 = new THREE.Vector2();\r\n\r\n    return function(center, size) {\r\n\r\n      var halfSize = v1.copy(size).multiplyScalar(0.5);\r\n      this.min.copy(center).sub(halfSize);\r\n      this.max.copy(center).add(halfSize);\r\n\r\n      return this;\r\n\r\n    };\r\n\r\n  }(),\r\n\r\n  copy: function(box) {\r\n\r\n    this.min.copy(box.min);\r\n    this.max.copy(box.max);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  makeEmpty: function() {\r\n\r\n    this.min.x = this.min.y = Infinity;\r\n    this.max.x = this.max.y = -Infinity;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  empty: function() {\r\n\r\n    // this is a more robust check for empty than ( volume <= 0 ) because volume can get positive with two negative axes\r\n\r\n    return (this.max.x < this.min.x) || (this.max.y < this.min.y);\r\n\r\n  },\r\n\r\n  center: function(optionalTarget) {\r\n\r\n    var result = optionalTarget || new THREE.Vector2();\r\n    return result.addVectors(this.min, this.max).multiplyScalar(0.5);\r\n\r\n  },\r\n\r\n  size: function(optionalTarget) {\r\n\r\n    var result = optionalTarget || new THREE.Vector2();\r\n    return result.subVectors(this.max, this.min);\r\n\r\n  },\r\n\r\n  expandByPoint: function(point) {\r\n\r\n    this.min.min(point);\r\n    this.max.max(point);\r\n\r\n    return this;\r\n  },\r\n\r\n  expandByVector: function(vector) {\r\n\r\n    this.min.sub(vector);\r\n    this.max.add(vector);\r\n\r\n    return this;\r\n  },\r\n\r\n  expandByScalar: function(scalar) {\r\n\r\n    this.min.addScalar(-scalar);\r\n    this.max.addScalar(scalar);\r\n\r\n    return this;\r\n  },\r\n\r\n  containsPoint: function(point) {\r\n\r\n    if (point.x < this.min.x || point.x > this.max.x ||\r\n      point.y < this.min.y || point.y > this.max.y) {\r\n\r\n      return false;\r\n\r\n    }\r\n\r\n    return true;\r\n\r\n  },\r\n\r\n  containsBox: function(box) {\r\n\r\n    if ((this.min.x <= box.min.x) && (box.max.x <= this.max.x) &&\r\n      (this.min.y <= box.min.y) && (box.max.y <= this.max.y)) {\r\n\r\n      return true;\r\n\r\n    }\r\n\r\n    return false;\r\n\r\n  },\r\n\r\n  getParameter: function(point, optionalTarget) {\r\n\r\n    // This can potentially have a divide by zero if the box\r\n    // has a size dimension of 0.\r\n\r\n    var result = optionalTarget || new THREE.Vector2();\r\n\r\n    return result.set(\r\n      (point.x - this.min.x) / (this.max.x - this.min.x), (point.y - this.min.y) / (this.max.y - this.min.y)\r\n    );\r\n\r\n  },\r\n\r\n  isIntersectionBox: function(box) {\r\n\r\n    // using 6 splitting planes to rule out intersections.\r\n\r\n    if (box.max.x < this.min.x || box.min.x > this.max.x ||\r\n      box.max.y < this.min.y || box.min.y > this.max.y) {\r\n\r\n      return false;\r\n\r\n    }\r\n\r\n    return true;\r\n\r\n  },\r\n\r\n  clampPoint: function(point, optionalTarget) {\r\n\r\n    var result = optionalTarget || new THREE.Vector2();\r\n    return result.copy(point).clamp(this.min, this.max);\r\n\r\n  },\r\n\r\n  distanceToPoint: function() {\r\n\r\n    var v1 = new THREE.Vector2();\r\n\r\n    return function(point) {\r\n\r\n      var clampedPoint = v1.copy(point).clamp(this.min, this.max);\r\n      return clampedPoint.sub(point).length();\r\n\r\n    };\r\n\r\n  }(),\r\n\r\n  intersect: function(box) {\r\n\r\n    this.min.max(box.min);\r\n    this.max.min(box.max);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  union: function(box) {\r\n\r\n    this.min.min(box.min);\r\n    this.max.max(box.max);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  translate: function(offset) {\r\n\r\n    this.min.add(offset);\r\n    this.max.add(offset);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  equals: function(box) {\r\n\r\n    return box.min.equals(this.min) && box.max.equals(this.max);\r\n\r\n  },\r\n\r\n  clone: function() {\r\n\r\n    return new THREE.Box2().copy(this);\r\n\r\n  }\r\n\r\n};\r\n\r\n// File:src/math/Box3.js\r\n\r\n/**\r\n * @author bhouston / http://exocortex.com\r\n * @author WestLangley / http://github.com/WestLangley\r\n */\r\n\r\nTHREE.Box3 = function(min, max) {\r\n\r\n  this.min = (min !== undefined) ? min : new THREE.Vector3(Infinity, Infinity, Infinity);\r\n  this.max = (max !== undefined) ? max : new THREE.Vector3(-Infinity, -Infinity, -Infinity);\r\n\r\n};\r\n\r\nTHREE.Box3.prototype = {\r\n\r\n  constructor: THREE.Box3,\r\n\r\n  set: function(min, max) {\r\n\r\n    this.min.copy(min);\r\n    this.max.copy(max);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  setFromPoints: function(points) {\r\n\r\n    this.makeEmpty();\r\n\r\n    for (var i = 0, il = points.length; i < il; i++) {\r\n\r\n      this.expandByPoint(points[i])\r\n\r\n    }\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  setFromCenterAndSize: function() {\r\n\r\n    var v1 = new THREE.Vector3();\r\n\r\n    return function(center, size) {\r\n\r\n      var halfSize = v1.copy(size).multiplyScalar(0.5);\r\n\r\n      this.min.copy(center).sub(halfSize);\r\n      this.max.copy(center).add(halfSize);\r\n\r\n      return this;\r\n\r\n    };\r\n\r\n  }(),\r\n\r\n  setFromObject: function() {\r\n\r\n    // Computes the world-axis-aligned bounding box of an object (including its children),\r\n    // accounting for both the object's, and childrens', world transforms\r\n\r\n    var v1 = new THREE.Vector3();\r\n\r\n    return function(object) {\r\n\r\n      var scope = this;\r\n\r\n      object.updateMatrixWorld(true);\r\n\r\n      this.makeEmpty();\r\n\r\n      object.traverse(function(node) {\r\n\r\n        var geometry = node.geometry;\r\n\r\n        if (geometry !== undefined) {\r\n\r\n          if (geometry instanceof THREE.Geometry) {\r\n\r\n            var vertices = geometry.vertices;\r\n\r\n            for (var i = 0, il = vertices.length; i < il; i++) {\r\n\r\n              v1.copy(vertices[i]);\r\n\r\n              v1.applyMatrix4(node.matrixWorld);\r\n\r\n              scope.expandByPoint(v1);\r\n\r\n            }\r\n\r\n          }\r\n          else if (geometry instanceof THREE.BufferGeometry && geometry.attributes['position'] !== undefined) {\r\n\r\n            var positions = geometry.attributes['position'].array;\r\n\r\n            for (var i = 0, il = positions.length; i < il; i += 3) {\r\n\r\n              v1.set(positions[i], positions[i + 1], positions[i + 2]);\r\n\r\n              v1.applyMatrix4(node.matrixWorld);\r\n\r\n              scope.expandByPoint(v1);\r\n\r\n            }\r\n\r\n          }\r\n\r\n        }\r\n\r\n      });\r\n\r\n      return this;\r\n\r\n    };\r\n\r\n  }(),\r\n\r\n  copy: function(box) {\r\n\r\n    this.min.copy(box.min);\r\n    this.max.copy(box.max);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  makeEmpty: function() {\r\n\r\n    this.min.x = this.min.y = this.min.z = Infinity;\r\n    this.max.x = this.max.y = this.max.z = -Infinity;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  empty: function() {\r\n\r\n    // this is a more robust check for empty than ( volume <= 0 ) because volume can get positive with two negative axes\r\n\r\n    return (this.max.x < this.min.x) || (this.max.y < this.min.y) || (this.max.z < this.min.z);\r\n\r\n  },\r\n\r\n  center: function(optionalTarget) {\r\n\r\n    var result = optionalTarget || new THREE.Vector3();\r\n    return result.addVectors(this.min, this.max).multiplyScalar(0.5);\r\n\r\n  },\r\n\r\n  size: function(optionalTarget) {\r\n\r\n    var result = optionalTarget || new THREE.Vector3();\r\n    return result.subVectors(this.max, this.min);\r\n\r\n  },\r\n\r\n  expandByPoint: function(point) {\r\n\r\n    this.min.min(point);\r\n    this.max.max(point);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  expandByVector: function(vector) {\r\n\r\n    this.min.sub(vector);\r\n    this.max.add(vector);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  expandByScalar: function(scalar) {\r\n\r\n    this.min.addScalar(-scalar);\r\n    this.max.addScalar(scalar);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  containsPoint: function(point) {\r\n\r\n    if (point.x < this.min.x || point.x > this.max.x ||\r\n      point.y < this.min.y || point.y > this.max.y ||\r\n      point.z < this.min.z || point.z > this.max.z) {\r\n\r\n      return false;\r\n\r\n    }\r\n\r\n    return true;\r\n\r\n  },\r\n\r\n  containsBox: function(box) {\r\n\r\n    if ((this.min.x <= box.min.x) && (box.max.x <= this.max.x) &&\r\n      (this.min.y <= box.min.y) && (box.max.y <= this.max.y) &&\r\n      (this.min.z <= box.min.z) && (box.max.z <= this.max.z)) {\r\n\r\n      return true;\r\n\r\n    }\r\n\r\n    return false;\r\n\r\n  },\r\n\r\n  getParameter: function(point, optionalTarget) {\r\n\r\n    // This can potentially have a divide by zero if the box\r\n    // has a size dimension of 0.\r\n\r\n    var result = optionalTarget || new THREE.Vector3();\r\n\r\n    return result.set(\r\n      (point.x - this.min.x) / (this.max.x - this.min.x), (point.y - this.min.y) / (this.max.y - this.min.y), (point.z - this.min.z) / (this.max.z - this.min.z)\r\n    );\r\n\r\n  },\r\n\r\n  isIntersectionBox: function(box) {\r\n\r\n    // using 6 splitting planes to rule out intersections.\r\n\r\n    if (box.max.x < this.min.x || box.min.x > this.max.x ||\r\n      box.max.y < this.min.y || box.min.y > this.max.y ||\r\n      box.max.z < this.min.z || box.min.z > this.max.z) {\r\n\r\n      return false;\r\n\r\n    }\r\n\r\n    return true;\r\n\r\n  },\r\n\r\n  clampPoint: function(point, optionalTarget) {\r\n\r\n    var result = optionalTarget || new THREE.Vector3();\r\n    return result.copy(point).clamp(this.min, this.max);\r\n\r\n  },\r\n\r\n  distanceToPoint: function() {\r\n\r\n    var v1 = new THREE.Vector3();\r\n\r\n    return function(point) {\r\n\r\n      var clampedPoint = v1.copy(point).clamp(this.min, this.max);\r\n      return clampedPoint.sub(point).length();\r\n\r\n    };\r\n\r\n  }(),\r\n\r\n  getBoundingSphere: function() {\r\n\r\n    var v1 = new THREE.Vector3();\r\n\r\n    return function(optionalTarget) {\r\n\r\n      var result = optionalTarget || new THREE.Sphere();\r\n\r\n      result.center = this.center();\r\n      result.radius = this.size(v1).length() * 0.5;\r\n\r\n      return result;\r\n\r\n    };\r\n\r\n  }(),\r\n\r\n  intersect: function(box) {\r\n\r\n    this.min.max(box.min);\r\n    this.max.min(box.max);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  union: function(box) {\r\n\r\n    this.min.min(box.min);\r\n    this.max.max(box.max);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  applyMatrix4: function() {\r\n\r\n    var points = [\r\n      new THREE.Vector3(),\r\n      new THREE.Vector3(),\r\n      new THREE.Vector3(),\r\n      new THREE.Vector3(),\r\n      new THREE.Vector3(),\r\n      new THREE.Vector3(),\r\n      new THREE.Vector3(),\r\n      new THREE.Vector3()\r\n    ];\r\n\r\n    return function(matrix) {\r\n\r\n      // NOTE: I am using a binary pattern to specify all 2^3 combinations below\r\n      points[0].set(this.min.x, this.min.y, this.min.z).applyMatrix4(matrix); // 000\r\n      points[1].set(this.min.x, this.min.y, this.max.z).applyMatrix4(matrix); // 001\r\n      points[2].set(this.min.x, this.max.y, this.min.z).applyMatrix4(matrix); // 010\r\n      points[3].set(this.min.x, this.max.y, this.max.z).applyMatrix4(matrix); // 011\r\n      points[4].set(this.max.x, this.min.y, this.min.z).applyMatrix4(matrix); // 100\r\n      points[5].set(this.max.x, this.min.y, this.max.z).applyMatrix4(matrix); // 101\r\n      points[6].set(this.max.x, this.max.y, this.min.z).applyMatrix4(matrix); // 110\r\n      points[7].set(this.max.x, this.max.y, this.max.z).applyMatrix4(matrix); // 111\r\n\r\n      this.makeEmpty();\r\n      this.setFromPoints(points);\r\n\r\n      return this;\r\n\r\n    };\r\n\r\n  }(),\r\n\r\n  translate: function(offset) {\r\n\r\n    this.min.add(offset);\r\n    this.max.add(offset);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  equals: function(box) {\r\n\r\n    return box.min.equals(this.min) && box.max.equals(this.max);\r\n\r\n  },\r\n\r\n  clone: function() {\r\n\r\n    return new THREE.Box3().copy(this);\r\n\r\n  }\r\n\r\n};\r\n\r\n// File:src/math/Matrix3.js\r\n\r\n/**\r\n * @author alteredq / http://alteredqualia.com/\r\n * @author WestLangley / http://github.com/WestLangley\r\n * @author bhouston / http://exocortex.com\r\n */\r\n\r\nTHREE.Matrix3 = function() {\r\n\r\n  this.elements = new Float32Array([\r\n\r\n    1, 0, 0,\r\n    0, 1, 0,\r\n    0, 0, 1\r\n\r\n  ]);\r\n\r\n  if (arguments.length > 0) {\r\n\r\n    THREE.error('THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.');\r\n\r\n  }\r\n\r\n};\r\n\r\nTHREE.Matrix3.prototype = {\r\n\r\n  constructor: THREE.Matrix3,\r\n\r\n  set: function(n11, n12, n13, n21, n22, n23, n31, n32, n33) {\r\n\r\n    var te = this.elements;\r\n\r\n    te[0] = n11;\r\n    te[3] = n12;\r\n    te[6] = n13;\r\n    te[1] = n21;\r\n    te[4] = n22;\r\n    te[7] = n23;\r\n    te[2] = n31;\r\n    te[5] = n32;\r\n    te[8] = n33;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  identity: function() {\r\n\r\n    this.set(\r\n\r\n      1, 0, 0,\r\n      0, 1, 0,\r\n      0, 0, 1\r\n\r\n    );\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  copy: function(m) {\r\n\r\n    var me = m.elements;\r\n\r\n    this.set(\r\n\r\n      me[0], me[3], me[6],\r\n      me[1], me[4], me[7],\r\n      me[2], me[5], me[8]\r\n\r\n    );\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  multiplyVector3: function(vector) {\r\n\r\n    THREE.warn('THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead.');\r\n    return vector.applyMatrix3(this);\r\n\r\n  },\r\n\r\n  multiplyVector3Array: function(a) {\r\n\r\n    THREE.warn('THREE.Matrix3: .multiplyVector3Array() has been renamed. Use matrix.applyToVector3Array( array ) instead.');\r\n    return this.applyToVector3Array(a);\r\n\r\n  },\r\n\r\n  applyToVector3Array: function() {\r\n\r\n    var v1 = new THREE.Vector3();\r\n\r\n    return function(array, offset, length) {\r\n\r\n      if (offset === undefined) offset = 0;\r\n      if (length === undefined) length = array.length;\r\n\r\n      for (var i = 0, j = offset; i < length; i += 3, j += 3) {\r\n\r\n        v1.x = array[j];\r\n        v1.y = array[j + 1];\r\n        v1.z = array[j + 2];\r\n\r\n        v1.applyMatrix3(this);\r\n\r\n        array[j] = v1.x;\r\n        array[j + 1] = v1.y;\r\n        array[j + 2] = v1.z;\r\n\r\n      }\r\n\r\n      return array;\r\n\r\n    };\r\n\r\n  }(),\r\n\r\n  multiplyScalar: function(s) {\r\n\r\n    var te = this.elements;\r\n\r\n    te[0] *= s;\r\n    te[3] *= s;\r\n    te[6] *= s;\r\n    te[1] *= s;\r\n    te[4] *= s;\r\n    te[7] *= s;\r\n    te[2] *= s;\r\n    te[5] *= s;\r\n    te[8] *= s;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  determinant: function() {\r\n\r\n    var te = this.elements;\r\n\r\n    var a = te[0],\r\n      b = te[1],\r\n      c = te[2],\r\n      d = te[3],\r\n      e = te[4],\r\n      f = te[5],\r\n      g = te[6],\r\n      h = te[7],\r\n      i = te[8];\r\n\r\n    return a * e * i - a * f * h - b * d * i + b * f * g + c * d * h - c * e * g;\r\n\r\n  },\r\n\r\n  getInverse: function(matrix, throwOnInvertible) {\r\n\r\n    // input: THREE.Matrix4\r\n    // ( based on http://code.google.com/p/webgl-mjs/ )\r\n\r\n    var me = matrix.elements;\r\n    var te = this.elements;\r\n\r\n    te[0] = me[10] * me[5] - me[6] * me[9];\r\n    te[1] = -me[10] * me[1] + me[2] * me[9];\r\n    te[2] = me[6] * me[1] - me[2] * me[5];\r\n    te[3] = -me[10] * me[4] + me[6] * me[8];\r\n    te[4] = me[10] * me[0] - me[2] * me[8];\r\n    te[5] = -me[6] * me[0] + me[2] * me[4];\r\n    te[6] = me[9] * me[4] - me[5] * me[8];\r\n    te[7] = -me[9] * me[0] + me[1] * me[8];\r\n    te[8] = me[5] * me[0] - me[1] * me[4];\r\n\r\n    var det = me[0] * te[0] + me[1] * te[3] + me[2] * te[6];\r\n\r\n    // no inverse\r\n\r\n    if (det === 0) {\r\n\r\n      var msg = \"Matrix3.getInverse(): can't invert matrix, determinant is 0\";\r\n\r\n      if (throwOnInvertible || false) {\r\n\r\n        throw new Error(msg);\r\n\r\n      }\r\n      else {\r\n\r\n        THREE.warn(msg);\r\n\r\n      }\r\n\r\n      this.identity();\r\n\r\n      return this;\r\n\r\n    }\r\n\r\n    this.multiplyScalar(1.0 / det);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  transpose: function() {\r\n\r\n    var tmp, m = this.elements;\r\n\r\n    tmp = m[1];\r\n    m[1] = m[3];\r\n    m[3] = tmp;\r\n    tmp = m[2];\r\n    m[2] = m[6];\r\n    m[6] = tmp;\r\n    tmp = m[5];\r\n    m[5] = m[7];\r\n    m[7] = tmp;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  flattenToArrayOffset: function(array, offset) {\r\n\r\n    var te = this.elements;\r\n\r\n    array[offset] = te[0];\r\n    array[offset + 1] = te[1];\r\n    array[offset + 2] = te[2];\r\n\r\n    array[offset + 3] = te[3];\r\n    array[offset + 4] = te[4];\r\n    array[offset + 5] = te[5];\r\n\r\n    array[offset + 6] = te[6];\r\n    array[offset + 7] = te[7];\r\n    array[offset + 8] = te[8];\r\n\r\n    return array;\r\n\r\n  },\r\n\r\n  getNormalMatrix: function(m) {\r\n\r\n    // input: THREE.Matrix4\r\n\r\n    this.getInverse(m).transpose();\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  transposeIntoArray: function(r) {\r\n\r\n    var m = this.elements;\r\n\r\n    r[0] = m[0];\r\n    r[1] = m[3];\r\n    r[2] = m[6];\r\n    r[3] = m[1];\r\n    r[4] = m[4];\r\n    r[5] = m[7];\r\n    r[6] = m[2];\r\n    r[7] = m[5];\r\n    r[8] = m[8];\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  fromArray: function(array) {\r\n\r\n    this.elements.set(array);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  toArray: function() {\r\n\r\n    var te = this.elements;\r\n\r\n    return [\r\n      te[0], te[1], te[2],\r\n      te[3], te[4], te[5],\r\n      te[6], te[7], te[8]\r\n    ];\r\n\r\n  },\r\n\r\n  clone: function() {\r\n\r\n    return new THREE.Matrix3().fromArray(this.elements);\r\n\r\n  }\r\n\r\n};\r\n\r\n// File:src/math/Matrix4.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author supereggbert / http://www.paulbrunt.co.uk/\r\n * @author philogb / http://blog.thejit.org/\r\n * @author jordi_ros / http://plattsoft.com\r\n * @author D1plo1d / http://github.com/D1plo1d\r\n * @author alteredq / http://alteredqualia.com/\r\n * @author mikael emtinger / http://gomo.se/\r\n * @author timknip / http://www.floorplanner.com/\r\n * @author bhouston / http://exocortex.com\r\n * @author WestLangley / http://github.com/WestLangley\r\n */\r\n\r\nTHREE.Matrix4 = function() {\r\n\r\n  this.elements = new Float32Array([\r\n\r\n    1, 0, 0, 0,\r\n    0, 1, 0, 0,\r\n    0, 0, 1, 0,\r\n    0, 0, 0, 1\r\n\r\n  ]);\r\n\r\n  if (arguments.length > 0) {\r\n\r\n    THREE.error('THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.');\r\n\r\n  }\r\n\r\n};\r\n\r\nTHREE.Matrix4.prototype = {\r\n\r\n  constructor: THREE.Matrix4,\r\n\r\n  set: function(n11, n12, n13, n14, n21, n22, n23, n24, n31, n32, n33, n34, n41, n42, n43, n44) {\r\n\r\n    var te = this.elements;\r\n\r\n    te[0] = n11;\r\n    te[4] = n12;\r\n    te[8] = n13;\r\n    te[12] = n14;\r\n    te[1] = n21;\r\n    te[5] = n22;\r\n    te[9] = n23;\r\n    te[13] = n24;\r\n    te[2] = n31;\r\n    te[6] = n32;\r\n    te[10] = n33;\r\n    te[14] = n34;\r\n    te[3] = n41;\r\n    te[7] = n42;\r\n    te[11] = n43;\r\n    te[15] = n44;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  identity: function() {\r\n\r\n    this.set(\r\n\r\n      1, 0, 0, 0,\r\n      0, 1, 0, 0,\r\n      0, 0, 1, 0,\r\n      0, 0, 0, 1\r\n\r\n    );\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  copy: function(m) {\r\n\r\n    this.elements.set(m.elements);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  extractPosition: function(m) {\r\n\r\n    THREE.warn('THREE.Matrix4: .extractPosition() has been renamed to .copyPosition().');\r\n    return this.copyPosition(m);\r\n\r\n  },\r\n\r\n  copyPosition: function(m) {\r\n\r\n    var te = this.elements;\r\n    var me = m.elements;\r\n\r\n    te[12] = me[12];\r\n    te[13] = me[13];\r\n    te[14] = me[14];\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  extractBasis: function(xAxis, yAxis, zAxis) {\r\n\r\n    var te = this.elements;\r\n\r\n    xAxis.set(te[0], te[1], te[2]);\r\n    yAxis.set(te[4], te[5], te[6]);\r\n    zAxis.set(te[8], te[9], te[10]);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  makeBasis: function(xAxis, yAxis, zAxis) {\r\n\r\n    this.set(\r\n      xAxis.x, yAxis.x, zAxis.x, 0,\r\n      xAxis.y, yAxis.y, zAxis.y, 0,\r\n      xAxis.z, yAxis.z, zAxis.z, 0,\r\n      0, 0, 0, 1\r\n    );\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  extractRotation: function() {\r\n\r\n    var v1 = new THREE.Vector3();\r\n\r\n    return function(m) {\r\n\r\n      var te = this.elements;\r\n      var me = m.elements;\r\n\r\n      var scaleX = 1 / v1.set(me[0], me[1], me[2]).length();\r\n      var scaleY = 1 / v1.set(me[4], me[5], me[6]).length();\r\n      var scaleZ = 1 / v1.set(me[8], me[9], me[10]).length();\r\n\r\n      te[0] = me[0] * scaleX;\r\n      te[1] = me[1] * scaleX;\r\n      te[2] = me[2] * scaleX;\r\n\r\n      te[4] = me[4] * scaleY;\r\n      te[5] = me[5] * scaleY;\r\n      te[6] = me[6] * scaleY;\r\n\r\n      te[8] = me[8] * scaleZ;\r\n      te[9] = me[9] * scaleZ;\r\n      te[10] = me[10] * scaleZ;\r\n\r\n      return this;\r\n\r\n    };\r\n\r\n  }(),\r\n\r\n  makeRotationFromEuler: function(euler) {\r\n\r\n    if (euler instanceof THREE.Euler === false) {\r\n\r\n      THREE.error('THREE.Matrix: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.');\r\n\r\n    }\r\n\r\n    var te = this.elements;\r\n\r\n    var x = euler.x,\r\n      y = euler.y,\r\n      z = euler.z;\r\n    var a = Math.cos(x),\r\n      b = Math.sin(x);\r\n    var c = Math.cos(y),\r\n      d = Math.sin(y);\r\n    var e = Math.cos(z),\r\n      f = Math.sin(z);\r\n\r\n    if (euler.order === 'XYZ') {\r\n\r\n      var ae = a * e,\r\n        af = a * f,\r\n        be = b * e,\r\n        bf = b * f;\r\n\r\n      te[0] = c * e;\r\n      te[4] = -c * f;\r\n      te[8] = d;\r\n\r\n      te[1] = af + be * d;\r\n      te[5] = ae - bf * d;\r\n      te[9] = -b * c;\r\n\r\n      te[2] = bf - ae * d;\r\n      te[6] = be + af * d;\r\n      te[10] = a * c;\r\n\r\n    }\r\n    else if (euler.order === 'YXZ') {\r\n\r\n      var ce = c * e,\r\n        cf = c * f,\r\n        de = d * e,\r\n        df = d * f;\r\n\r\n      te[0] = ce + df * b;\r\n      te[4] = de * b - cf;\r\n      te[8] = a * d;\r\n\r\n      te[1] = a * f;\r\n      te[5] = a * e;\r\n      te[9] = -b;\r\n\r\n      te[2] = cf * b - de;\r\n      te[6] = df + ce * b;\r\n      te[10] = a * c;\r\n\r\n    }\r\n    else if (euler.order === 'ZXY') {\r\n\r\n      var ce = c * e,\r\n        cf = c * f,\r\n        de = d * e,\r\n        df = d * f;\r\n\r\n      te[0] = ce - df * b;\r\n      te[4] = -a * f;\r\n      te[8] = de + cf * b;\r\n\r\n      te[1] = cf + de * b;\r\n      te[5] = a * e;\r\n      te[9] = df - ce * b;\r\n\r\n      te[2] = -a * d;\r\n      te[6] = b;\r\n      te[10] = a * c;\r\n\r\n    }\r\n    else if (euler.order === 'ZYX') {\r\n\r\n      var ae = a * e,\r\n        af = a * f,\r\n        be = b * e,\r\n        bf = b * f;\r\n\r\n      te[0] = c * e;\r\n      te[4] = be * d - af;\r\n      te[8] = ae * d + bf;\r\n\r\n      te[1] = c * f;\r\n      te[5] = bf * d + ae;\r\n      te[9] = af * d - be;\r\n\r\n      te[2] = -d;\r\n      te[6] = b * c;\r\n      te[10] = a * c;\r\n\r\n    }\r\n    else if (euler.order === 'YZX') {\r\n\r\n      var ac = a * c,\r\n        ad = a * d,\r\n        bc = b * c,\r\n        bd = b * d;\r\n\r\n      te[0] = c * e;\r\n      te[4] = bd - ac * f;\r\n      te[8] = bc * f + ad;\r\n\r\n      te[1] = f;\r\n      te[5] = a * e;\r\n      te[9] = -b * e;\r\n\r\n      te[2] = -d * e;\r\n      te[6] = ad * f + bc;\r\n      te[10] = ac - bd * f;\r\n\r\n    }\r\n    else if (euler.order === 'XZY') {\r\n\r\n      var ac = a * c,\r\n        ad = a * d,\r\n        bc = b * c,\r\n        bd = b * d;\r\n\r\n      te[0] = c * e;\r\n      te[4] = -f;\r\n      te[8] = d * e;\r\n\r\n      te[1] = ac * f + bd;\r\n      te[5] = a * e;\r\n      te[9] = ad * f - bc;\r\n\r\n      te[2] = bc * f - ad;\r\n      te[6] = b * e;\r\n      te[10] = bd * f + ac;\r\n\r\n    }\r\n\r\n    // last column\r\n    te[3] = 0;\r\n    te[7] = 0;\r\n    te[11] = 0;\r\n\r\n    // bottom row\r\n    te[12] = 0;\r\n    te[13] = 0;\r\n    te[14] = 0;\r\n    te[15] = 1;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  setRotationFromQuaternion: function(q) {\r\n\r\n    THREE.warn('THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion().');\r\n\r\n    return this.makeRotationFromQuaternion(q);\r\n\r\n  },\r\n\r\n  makeRotationFromQuaternion: function(q) {\r\n\r\n    var te = this.elements;\r\n\r\n    var x = q.x,\r\n      y = q.y,\r\n      z = q.z,\r\n      w = q.w;\r\n    var x2 = x + x,\r\n      y2 = y + y,\r\n      z2 = z + z;\r\n    var xx = x * x2,\r\n      xy = x * y2,\r\n      xz = x * z2;\r\n    var yy = y * y2,\r\n      yz = y * z2,\r\n      zz = z * z2;\r\n    var wx = w * x2,\r\n      wy = w * y2,\r\n      wz = w * z2;\r\n\r\n    te[0] = 1 - (yy + zz);\r\n    te[4] = xy - wz;\r\n    te[8] = xz + wy;\r\n\r\n    te[1] = xy + wz;\r\n    te[5] = 1 - (xx + zz);\r\n    te[9] = yz - wx;\r\n\r\n    te[2] = xz - wy;\r\n    te[6] = yz + wx;\r\n    te[10] = 1 - (xx + yy);\r\n\r\n    // last column\r\n    te[3] = 0;\r\n    te[7] = 0;\r\n    te[11] = 0;\r\n\r\n    // bottom row\r\n    te[12] = 0;\r\n    te[13] = 0;\r\n    te[14] = 0;\r\n    te[15] = 1;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  lookAt: function() {\r\n\r\n    var x = new THREE.Vector3();\r\n    var y = new THREE.Vector3();\r\n    var z = new THREE.Vector3();\r\n\r\n    return function(eye, target, up) {\r\n\r\n      var te = this.elements;\r\n\r\n      z.subVectors(eye, target).normalize();\r\n\r\n      if (z.length() === 0) {\r\n\r\n        z.z = 1;\r\n\r\n      }\r\n\r\n      x.crossVectors(up, z).normalize();\r\n\r\n      if (x.length() === 0) {\r\n\r\n        z.x += 0.0001;\r\n        x.crossVectors(up, z).normalize();\r\n\r\n      }\r\n\r\n      y.crossVectors(z, x);\r\n\r\n\r\n      te[0] = x.x;\r\n      te[4] = y.x;\r\n      te[8] = z.x;\r\n      te[1] = x.y;\r\n      te[5] = y.y;\r\n      te[9] = z.y;\r\n      te[2] = x.z;\r\n      te[6] = y.z;\r\n      te[10] = z.z;\r\n\r\n      return this;\r\n\r\n    };\r\n\r\n  }(),\r\n\r\n  multiply: function(m, n) {\r\n\r\n    if (n !== undefined) {\r\n\r\n      THREE.warn('THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead.');\r\n      return this.multiplyMatrices(m, n);\r\n\r\n    }\r\n\r\n    return this.multiplyMatrices(this, m);\r\n\r\n  },\r\n\r\n  multiplyMatrices: function(a, b) {\r\n\r\n    var ae = a.elements;\r\n    var be = b.elements;\r\n    var te = this.elements;\r\n\r\n    var a11 = ae[0],\r\n      a12 = ae[4],\r\n      a13 = ae[8],\r\n      a14 = ae[12];\r\n    var a21 = ae[1],\r\n      a22 = ae[5],\r\n      a23 = ae[9],\r\n      a24 = ae[13];\r\n    var a31 = ae[2],\r\n      a32 = ae[6],\r\n      a33 = ae[10],\r\n      a34 = ae[14];\r\n    var a41 = ae[3],\r\n      a42 = ae[7],\r\n      a43 = ae[11],\r\n      a44 = ae[15];\r\n\r\n    var b11 = be[0],\r\n      b12 = be[4],\r\n      b13 = be[8],\r\n      b14 = be[12];\r\n    var b21 = be[1],\r\n      b22 = be[5],\r\n      b23 = be[9],\r\n      b24 = be[13];\r\n    var b31 = be[2],\r\n      b32 = be[6],\r\n      b33 = be[10],\r\n      b34 = be[14];\r\n    var b41 = be[3],\r\n      b42 = be[7],\r\n      b43 = be[11],\r\n      b44 = be[15];\r\n\r\n    te[0] = a11 * b11 + a12 * b21 + a13 * b31 + a14 * b41;\r\n    te[4] = a11 * b12 + a12 * b22 + a13 * b32 + a14 * b42;\r\n    te[8] = a11 * b13 + a12 * b23 + a13 * b33 + a14 * b43;\r\n    te[12] = a11 * b14 + a12 * b24 + a13 * b34 + a14 * b44;\r\n\r\n    te[1] = a21 * b11 + a22 * b21 + a23 * b31 + a24 * b41;\r\n    te[5] = a21 * b12 + a22 * b22 + a23 * b32 + a24 * b42;\r\n    te[9] = a21 * b13 + a22 * b23 + a23 * b33 + a24 * b43;\r\n    te[13] = a21 * b14 + a22 * b24 + a23 * b34 + a24 * b44;\r\n\r\n    te[2] = a31 * b11 + a32 * b21 + a33 * b31 + a34 * b41;\r\n    te[6] = a31 * b12 + a32 * b22 + a33 * b32 + a34 * b42;\r\n    te[10] = a31 * b13 + a32 * b23 + a33 * b33 + a34 * b43;\r\n    te[14] = a31 * b14 + a32 * b24 + a33 * b34 + a34 * b44;\r\n\r\n    te[3] = a41 * b11 + a42 * b21 + a43 * b31 + a44 * b41;\r\n    te[7] = a41 * b12 + a42 * b22 + a43 * b32 + a44 * b42;\r\n    te[11] = a41 * b13 + a42 * b23 + a43 * b33 + a44 * b43;\r\n    te[15] = a41 * b14 + a42 * b24 + a43 * b34 + a44 * b44;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  multiplyToArray: function(a, b, r) {\r\n\r\n    var te = this.elements;\r\n\r\n    this.multiplyMatrices(a, b);\r\n\r\n    r[0] = te[0];\r\n    r[1] = te[1];\r\n    r[2] = te[2];\r\n    r[3] = te[3];\r\n    r[4] = te[4];\r\n    r[5] = te[5];\r\n    r[6] = te[6];\r\n    r[7] = te[7];\r\n    r[8] = te[8];\r\n    r[9] = te[9];\r\n    r[10] = te[10];\r\n    r[11] = te[11];\r\n    r[12] = te[12];\r\n    r[13] = te[13];\r\n    r[14] = te[14];\r\n    r[15] = te[15];\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  multiplyScalar: function(s) {\r\n\r\n    var te = this.elements;\r\n\r\n    te[0] *= s;\r\n    te[4] *= s;\r\n    te[8] *= s;\r\n    te[12] *= s;\r\n    te[1] *= s;\r\n    te[5] *= s;\r\n    te[9] *= s;\r\n    te[13] *= s;\r\n    te[2] *= s;\r\n    te[6] *= s;\r\n    te[10] *= s;\r\n    te[14] *= s;\r\n    te[3] *= s;\r\n    te[7] *= s;\r\n    te[11] *= s;\r\n    te[15] *= s;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  multiplyVector3: function(vector) {\r\n\r\n    THREE.warn('THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) or vector.applyProjection( matrix ) instead.');\r\n    return vector.applyProjection(this);\r\n\r\n  },\r\n\r\n  multiplyVector4: function(vector) {\r\n\r\n    THREE.warn('THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead.');\r\n    return vector.applyMatrix4(this);\r\n\r\n  },\r\n\r\n  multiplyVector3Array: function(a) {\r\n\r\n    THREE.warn('THREE.Matrix4: .multiplyVector3Array() has been renamed. Use matrix.applyToVector3Array( array ) instead.');\r\n    return this.applyToVector3Array(a);\r\n\r\n  },\r\n\r\n  applyToVector3Array: function() {\r\n\r\n    var v1 = new THREE.Vector3();\r\n\r\n    return function(array, offset, length) {\r\n\r\n      if (offset === undefined) offset = 0;\r\n      if (length === undefined) length = array.length;\r\n\r\n      for (var i = 0, j = offset; i < length; i += 3, j += 3) {\r\n\r\n        v1.x = array[j];\r\n        v1.y = array[j + 1];\r\n        v1.z = array[j + 2];\r\n\r\n        v1.applyMatrix4(this);\r\n\r\n        array[j] = v1.x;\r\n        array[j + 1] = v1.y;\r\n        array[j + 2] = v1.z;\r\n\r\n      }\r\n\r\n      return array;\r\n\r\n    };\r\n\r\n  }(),\r\n\r\n  rotateAxis: function(v) {\r\n\r\n    THREE.warn('THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead.');\r\n\r\n    v.transformDirection(this);\r\n\r\n  },\r\n\r\n  crossVector: function(vector) {\r\n\r\n    THREE.warn('THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead.');\r\n    return vector.applyMatrix4(this);\r\n\r\n  },\r\n\r\n  determinant: function() {\r\n\r\n    var te = this.elements;\r\n\r\n    var n11 = te[0],\r\n      n12 = te[4],\r\n      n13 = te[8],\r\n      n14 = te[12];\r\n    var n21 = te[1],\r\n      n22 = te[5],\r\n      n23 = te[9],\r\n      n24 = te[13];\r\n    var n31 = te[2],\r\n      n32 = te[6],\r\n      n33 = te[10],\r\n      n34 = te[14];\r\n    var n41 = te[3],\r\n      n42 = te[7],\r\n      n43 = te[11],\r\n      n44 = te[15];\r\n\r\n    //TODO: make this more efficient\r\n    //( based on http://www.euclideanspace.com/maths/algebra/matrix/functions/inverse/fourD/index.htm )\r\n\r\n    return (\r\n      n41 * (+n14 * n23 * n32 - n13 * n24 * n32 - n14 * n22 * n33 + n12 * n24 * n33 + n13 * n22 * n34 - n12 * n23 * n34) +\r\n      n42 * (+n11 * n23 * n34 - n11 * n24 * n33 + n14 * n21 * n33 - n13 * n21 * n34 + n13 * n24 * n31 - n14 * n23 * n31) +\r\n      n43 * (+n11 * n24 * n32 - n11 * n22 * n34 - n14 * n21 * n32 + n12 * n21 * n34 + n14 * n22 * n31 - n12 * n24 * n31) +\r\n      n44 * (-n13 * n22 * n31 - n11 * n23 * n32 + n11 * n22 * n33 + n13 * n21 * n32 - n12 * n21 * n33 + n12 * n23 * n31)\r\n\r\n    );\r\n\r\n  },\r\n\r\n  transpose: function() {\r\n\r\n    var te = this.elements;\r\n    var tmp;\r\n\r\n    tmp = te[1];\r\n    te[1] = te[4];\r\n    te[4] = tmp;\r\n    tmp = te[2];\r\n    te[2] = te[8];\r\n    te[8] = tmp;\r\n    tmp = te[6];\r\n    te[6] = te[9];\r\n    te[9] = tmp;\r\n\r\n    tmp = te[3];\r\n    te[3] = te[12];\r\n    te[12] = tmp;\r\n    tmp = te[7];\r\n    te[7] = te[13];\r\n    te[13] = tmp;\r\n    tmp = te[11];\r\n    te[11] = te[14];\r\n    te[14] = tmp;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  flattenToArrayOffset: function(array, offset) {\r\n\r\n    var te = this.elements;\r\n\r\n    array[offset] = te[0];\r\n    array[offset + 1] = te[1];\r\n    array[offset + 2] = te[2];\r\n    array[offset + 3] = te[3];\r\n\r\n    array[offset + 4] = te[4];\r\n    array[offset + 5] = te[5];\r\n    array[offset + 6] = te[6];\r\n    array[offset + 7] = te[7];\r\n\r\n    array[offset + 8] = te[8];\r\n    array[offset + 9] = te[9];\r\n    array[offset + 10] = te[10];\r\n    array[offset + 11] = te[11];\r\n\r\n    array[offset + 12] = te[12];\r\n    array[offset + 13] = te[13];\r\n    array[offset + 14] = te[14];\r\n    array[offset + 15] = te[15];\r\n\r\n    return array;\r\n\r\n  },\r\n\r\n  getPosition: function() {\r\n\r\n    var v1 = new THREE.Vector3();\r\n\r\n    return function() {\r\n\r\n      THREE.warn('THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead.');\r\n\r\n      var te = this.elements;\r\n      return v1.set(te[12], te[13], te[14]);\r\n\r\n    };\r\n\r\n  }(),\r\n\r\n  setPosition: function(v) {\r\n\r\n    var te = this.elements;\r\n\r\n    te[12] = v.x;\r\n    te[13] = v.y;\r\n    te[14] = v.z;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  getInverse: function(m, throwOnInvertible) {\r\n\r\n    // based on http://www.euclideanspace.com/maths/algebra/matrix/functions/inverse/fourD/index.htm\r\n    var te = this.elements;\r\n    var me = m.elements;\r\n\r\n    var n11 = me[0],\r\n      n12 = me[4],\r\n      n13 = me[8],\r\n      n14 = me[12];\r\n    var n21 = me[1],\r\n      n22 = me[5],\r\n      n23 = me[9],\r\n      n24 = me[13];\r\n    var n31 = me[2],\r\n      n32 = me[6],\r\n      n33 = me[10],\r\n      n34 = me[14];\r\n    var n41 = me[3],\r\n      n42 = me[7],\r\n      n43 = me[11],\r\n      n44 = me[15];\r\n\r\n    te[0] = n23 * n34 * n42 - n24 * n33 * n42 + n24 * n32 * n43 - n22 * n34 * n43 - n23 * n32 * n44 + n22 * n33 * n44;\r\n    te[4] = n14 * n33 * n42 - n13 * n34 * n42 - n14 * n32 * n43 + n12 * n34 * n43 + n13 * n32 * n44 - n12 * n33 * n44;\r\n    te[8] = n13 * n24 * n42 - n14 * n23 * n42 + n14 * n22 * n43 - n12 * n24 * n43 - n13 * n22 * n44 + n12 * n23 * n44;\r\n    te[12] = n14 * n23 * n32 - n13 * n24 * n32 - n14 * n22 * n33 + n12 * n24 * n33 + n13 * n22 * n34 - n12 * n23 * n34;\r\n    te[1] = n24 * n33 * n41 - n23 * n34 * n41 - n24 * n31 * n43 + n21 * n34 * n43 + n23 * n31 * n44 - n21 * n33 * n44;\r\n    te[5] = n13 * n34 * n41 - n14 * n33 * n41 + n14 * n31 * n43 - n11 * n34 * n43 - n13 * n31 * n44 + n11 * n33 * n44;\r\n    te[9] = n14 * n23 * n41 - n13 * n24 * n41 - n14 * n21 * n43 + n11 * n24 * n43 + n13 * n21 * n44 - n11 * n23 * n44;\r\n    te[13] = n13 * n24 * n31 - n14 * n23 * n31 + n14 * n21 * n33 - n11 * n24 * n33 - n13 * n21 * n34 + n11 * n23 * n34;\r\n    te[2] = n22 * n34 * n41 - n24 * n32 * n41 + n24 * n31 * n42 - n21 * n34 * n42 - n22 * n31 * n44 + n21 * n32 * n44;\r\n    te[6] = n14 * n32 * n41 - n12 * n34 * n41 - n14 * n31 * n42 + n11 * n34 * n42 + n12 * n31 * n44 - n11 * n32 * n44;\r\n    te[10] = n12 * n24 * n41 - n14 * n22 * n41 + n14 * n21 * n42 - n11 * n24 * n42 - n12 * n21 * n44 + n11 * n22 * n44;\r\n    te[14] = n14 * n22 * n31 - n12 * n24 * n31 - n14 * n21 * n32 + n11 * n24 * n32 + n12 * n21 * n34 - n11 * n22 * n34;\r\n    te[3] = n23 * n32 * n41 - n22 * n33 * n41 - n23 * n31 * n42 + n21 * n33 * n42 + n22 * n31 * n43 - n21 * n32 * n43;\r\n    te[7] = n12 * n33 * n41 - n13 * n32 * n41 + n13 * n31 * n42 - n11 * n33 * n42 - n12 * n31 * n43 + n11 * n32 * n43;\r\n    te[11] = n13 * n22 * n41 - n12 * n23 * n41 - n13 * n21 * n42 + n11 * n23 * n42 + n12 * n21 * n43 - n11 * n22 * n43;\r\n    te[15] = n12 * n23 * n31 - n13 * n22 * n31 + n13 * n21 * n32 - n11 * n23 * n32 - n12 * n21 * n33 + n11 * n22 * n33;\r\n\r\n    var det = n11 * te[0] + n21 * te[4] + n31 * te[8] + n41 * te[12];\r\n\r\n    if (det == 0) {\r\n\r\n      var msg = \"THREE.Matrix4.getInverse(): can't invert matrix, determinant is 0\";\r\n\r\n      if (throwOnInvertible || false) {\r\n\r\n        throw new Error(msg);\r\n\r\n      }\r\n      else {\r\n\r\n        THREE.warn(msg);\r\n\r\n      }\r\n\r\n      this.identity();\r\n\r\n      return this;\r\n    }\r\n\r\n    this.multiplyScalar(1 / det);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  translate: function(v) {\r\n\r\n    THREE.error('THREE.Matrix4: .translate() has been removed.');\r\n\r\n  },\r\n\r\n  rotateX: function(angle) {\r\n\r\n    THREE.error('THREE.Matrix4: .rotateX() has been removed.');\r\n\r\n  },\r\n\r\n  rotateY: function(angle) {\r\n\r\n    THREE.error('THREE.Matrix4: .rotateY() has been removed.');\r\n\r\n  },\r\n\r\n  rotateZ: function(angle) {\r\n\r\n    THREE.error('THREE.Matrix4: .rotateZ() has been removed.');\r\n\r\n  },\r\n\r\n  rotateByAxis: function(axis, angle) {\r\n\r\n    THREE.error('THREE.Matrix4: .rotateByAxis() has been removed.');\r\n\r\n  },\r\n\r\n  scale: function(v) {\r\n\r\n    var te = this.elements;\r\n    var x = v.x,\r\n      y = v.y,\r\n      z = v.z;\r\n\r\n    te[0] *= x;\r\n    te[4] *= y;\r\n    te[8] *= z;\r\n    te[1] *= x;\r\n    te[5] *= y;\r\n    te[9] *= z;\r\n    te[2] *= x;\r\n    te[6] *= y;\r\n    te[10] *= z;\r\n    te[3] *= x;\r\n    te[7] *= y;\r\n    te[11] *= z;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  getMaxScaleOnAxis: function() {\r\n\r\n    var te = this.elements;\r\n\r\n    var scaleXSq = te[0] * te[0] + te[1] * te[1] + te[2] * te[2];\r\n    var scaleYSq = te[4] * te[4] + te[5] * te[5] + te[6] * te[6];\r\n    var scaleZSq = te[8] * te[8] + te[9] * te[9] + te[10] * te[10];\r\n\r\n    return Math.sqrt(Math.max(scaleXSq, Math.max(scaleYSq, scaleZSq)));\r\n\r\n  },\r\n\r\n  makeTranslation: function(x, y, z) {\r\n\r\n    this.set(\r\n\r\n      1, 0, 0, x,\r\n      0, 1, 0, y,\r\n      0, 0, 1, z,\r\n      0, 0, 0, 1\r\n\r\n    );\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  makeRotationX: function(theta) {\r\n\r\n    var c = Math.cos(theta),\r\n      s = Math.sin(theta);\r\n\r\n    this.set(\r\n\r\n      1, 0, 0, 0,\r\n      0, c, -s, 0,\r\n      0, s, c, 0,\r\n      0, 0, 0, 1\r\n\r\n    );\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  makeRotationY: function(theta) {\r\n\r\n    var c = Math.cos(theta),\r\n      s = Math.sin(theta);\r\n\r\n    this.set(\r\n\r\n      c, 0, s, 0,\r\n      0, 1, 0, 0, -s, 0, c, 0,\r\n      0, 0, 0, 1\r\n\r\n    );\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  makeRotationZ: function(theta) {\r\n\r\n    var c = Math.cos(theta),\r\n      s = Math.sin(theta);\r\n\r\n    this.set(\r\n\r\n      c, -s, 0, 0,\r\n      s, c, 0, 0,\r\n      0, 0, 1, 0,\r\n      0, 0, 0, 1\r\n\r\n    );\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  makeRotationAxis: function(axis, angle) {\r\n\r\n    // Based on http://www.gamedev.net/reference/articles/article1199.asp\r\n\r\n    var c = Math.cos(angle);\r\n    var s = Math.sin(angle);\r\n    var t = 1 - c;\r\n    var x = axis.x,\r\n      y = axis.y,\r\n      z = axis.z;\r\n    var tx = t * x,\r\n      ty = t * y;\r\n\r\n    this.set(\r\n\r\n      tx * x + c, tx * y - s * z, tx * z + s * y, 0,\r\n      tx * y + s * z, ty * y + c, ty * z - s * x, 0,\r\n      tx * z - s * y, ty * z + s * x, t * z * z + c, 0,\r\n      0, 0, 0, 1\r\n\r\n    );\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  makeScale: function(x, y, z) {\r\n\r\n    this.set(\r\n\r\n      x, 0, 0, 0,\r\n      0, y, 0, 0,\r\n      0, 0, z, 0,\r\n      0, 0, 0, 1\r\n\r\n    );\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  compose: function(position, quaternion, scale) {\r\n\r\n    this.makeRotationFromQuaternion(quaternion);\r\n    this.scale(scale);\r\n    this.setPosition(position);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  decompose: function() {\r\n\r\n    var vector = new THREE.Vector3();\r\n    var matrix = new THREE.Matrix4();\r\n\r\n    return function(position, quaternion, scale) {\r\n\r\n      var te = this.elements;\r\n\r\n      var sx = vector.set(te[0], te[1], te[2]).length();\r\n      var sy = vector.set(te[4], te[5], te[6]).length();\r\n      var sz = vector.set(te[8], te[9], te[10]).length();\r\n\r\n      // if determine is negative, we need to invert one scale\r\n      var det = this.determinant();\r\n      if (det < 0) {\r\n        sx = -sx;\r\n      }\r\n\r\n      position.x = te[12];\r\n      position.y = te[13];\r\n      position.z = te[14];\r\n\r\n      // scale the rotation part\r\n\r\n      matrix.elements.set(this.elements); // at this point matrix is incomplete so we can't use .copy()\r\n\r\n      var invSX = 1 / sx;\r\n      var invSY = 1 / sy;\r\n      var invSZ = 1 / sz;\r\n\r\n      matrix.elements[0] *= invSX;\r\n      matrix.elements[1] *= invSX;\r\n      matrix.elements[2] *= invSX;\r\n\r\n      matrix.elements[4] *= invSY;\r\n      matrix.elements[5] *= invSY;\r\n      matrix.elements[6] *= invSY;\r\n\r\n      matrix.elements[8] *= invSZ;\r\n      matrix.elements[9] *= invSZ;\r\n      matrix.elements[10] *= invSZ;\r\n\r\n      quaternion.setFromRotationMatrix(matrix);\r\n\r\n      scale.x = sx;\r\n      scale.y = sy;\r\n      scale.z = sz;\r\n\r\n      return this;\r\n\r\n    };\r\n\r\n  }(),\r\n\r\n  makeFrustum: function(left, right, bottom, top, near, far) {\r\n\r\n    var te = this.elements;\r\n    var x = 2 * near / (right - left);\r\n    var y = 2 * near / (top - bottom);\r\n\r\n    var a = (right + left) / (right - left);\r\n    var b = (top + bottom) / (top - bottom);\r\n    var c = -(far + near) / (far - near);\r\n    var d = -2 * far * near / (far - near);\r\n\r\n    te[0] = x;\r\n    te[4] = 0;\r\n    te[8] = a;\r\n    te[12] = 0;\r\n    te[1] = 0;\r\n    te[5] = y;\r\n    te[9] = b;\r\n    te[13] = 0;\r\n    te[2] = 0;\r\n    te[6] = 0;\r\n    te[10] = c;\r\n    te[14] = d;\r\n    te[3] = 0;\r\n    te[7] = 0;\r\n    te[11] = -1;\r\n    te[15] = 0;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  makePerspective: function(fov, aspect, near, far) {\r\n\r\n    var ymax = near * Math.tan(THREE.Math.degToRad(fov * 0.5));\r\n    var ymin = -ymax;\r\n    var xmin = ymin * aspect;\r\n    var xmax = ymax * aspect;\r\n\r\n    return this.makeFrustum(xmin, xmax, ymin, ymax, near, far);\r\n\r\n  },\r\n\r\n  makeOrthographic: function(left, right, top, bottom, near, far) {\r\n\r\n    var te = this.elements;\r\n    var w = right - left;\r\n    var h = top - bottom;\r\n    var p = far - near;\r\n\r\n    var x = (right + left) / w;\r\n    var y = (top + bottom) / h;\r\n    var z = (far + near) / p;\r\n\r\n    te[0] = 2 / w;\r\n    te[4] = 0;\r\n    te[8] = 0;\r\n    te[12] = -x;\r\n    te[1] = 0;\r\n    te[5] = 2 / h;\r\n    te[9] = 0;\r\n    te[13] = -y;\r\n    te[2] = 0;\r\n    te[6] = 0;\r\n    te[10] = -2 / p;\r\n    te[14] = -z;\r\n    te[3] = 0;\r\n    te[7] = 0;\r\n    te[11] = 0;\r\n    te[15] = 1;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  fromArray: function(array) {\r\n\r\n    this.elements.set(array);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  toArray: function() {\r\n\r\n    var te = this.elements;\r\n\r\n    return [\r\n      te[0], te[1], te[2], te[3],\r\n      te[4], te[5], te[6], te[7],\r\n      te[8], te[9], te[10], te[11],\r\n      te[12], te[13], te[14], te[15]\r\n    ];\r\n\r\n  },\r\n\r\n  clone: function() {\r\n\r\n    return new THREE.Matrix4().fromArray(this.elements);\r\n\r\n  }\r\n\r\n};\r\n\r\n// File:src/math/Ray.js\r\n\r\n/**\r\n * @author bhouston / http://exocortex.com\r\n */\r\n\r\nTHREE.Ray = function(origin, direction) {\r\n\r\n  this.origin = (origin !== undefined) ? origin : new THREE.Vector3();\r\n  this.direction = (direction !== undefined) ? direction : new THREE.Vector3();\r\n\r\n};\r\n\r\nTHREE.Ray.prototype = {\r\n\r\n  constructor: THREE.Ray,\r\n\r\n  set: function(origin, direction) {\r\n\r\n    this.origin.copy(origin);\r\n    this.direction.copy(direction);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  copy: function(ray) {\r\n\r\n    this.origin.copy(ray.origin);\r\n    this.direction.copy(ray.direction);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  at: function(t, optionalTarget) {\r\n\r\n    var result = optionalTarget || new THREE.Vector3();\r\n\r\n    return result.copy(this.direction).multiplyScalar(t).add(this.origin);\r\n\r\n  },\r\n\r\n  recast: function() {\r\n\r\n    var v1 = new THREE.Vector3();\r\n\r\n    return function(t) {\r\n\r\n      this.origin.copy(this.at(t, v1));\r\n\r\n      return this;\r\n\r\n    };\r\n\r\n  }(),\r\n\r\n  closestPointToPoint: function(point, optionalTarget) {\r\n\r\n    var result = optionalTarget || new THREE.Vector3();\r\n    result.subVectors(point, this.origin);\r\n    var directionDistance = result.dot(this.direction);\r\n\r\n    if (directionDistance < 0) {\r\n\r\n      return result.copy(this.origin);\r\n\r\n    }\r\n\r\n    return result.copy(this.direction).multiplyScalar(directionDistance).add(this.origin);\r\n\r\n  },\r\n\r\n  distanceToPoint: function() {\r\n\r\n    var v1 = new THREE.Vector3();\r\n\r\n    return function(point) {\r\n\r\n      var directionDistance = v1.subVectors(point, this.origin).dot(this.direction);\r\n\r\n      // point behind the ray\r\n\r\n      if (directionDistance < 0) {\r\n\r\n        return this.origin.distanceTo(point);\r\n\r\n      }\r\n\r\n      v1.copy(this.direction).multiplyScalar(directionDistance).add(this.origin);\r\n\r\n      return v1.distanceTo(point);\r\n\r\n    };\r\n\r\n  }(),\r\n\r\n  distanceSqToSegment: function() {\r\n\r\n    var segCenter = new THREE.Vector3();\r\n    var segDir = new THREE.Vector3();\r\n    var diff = new THREE.Vector3();\r\n\r\n    return function(v0, v1, optionalPointOnRay, optionalPointOnSegment) {\r\n\r\n      // from http://www.geometrictools.com/LibMathematics/Distance/Wm5DistRay3Segment3.cpp\r\n      // It returns the min distance between the ray and the segment\r\n      // defined by v0 and v1\r\n      // It can also set two optional targets :\r\n      // - The closest point on the ray\r\n      // - The closest point on the segment\r\n\r\n      segCenter.copy(v0).add(v1).multiplyScalar(0.5);\r\n      segDir.copy(v1).sub(v0).normalize();\r\n      diff.copy(this.origin).sub(segCenter);\r\n\r\n      var segExtent = v0.distanceTo(v1) * 0.5;\r\n      var a01 = -this.direction.dot(segDir);\r\n      var b0 = diff.dot(this.direction);\r\n      var b1 = -diff.dot(segDir);\r\n      var c = diff.lengthSq();\r\n      var det = Math.abs(1 - a01 * a01);\r\n      var s0, s1, sqrDist, extDet;\r\n\r\n      if (det > 0) {\r\n\r\n        // The ray and segment are not parallel.\r\n\r\n        s0 = a01 * b1 - b0;\r\n        s1 = a01 * b0 - b1;\r\n        extDet = segExtent * det;\r\n\r\n        if (s0 >= 0) {\r\n\r\n          if (s1 >= -extDet) {\r\n\r\n            if (s1 <= extDet) {\r\n\r\n              // region 0\r\n              // Minimum at interior points of ray and segment.\r\n\r\n              var invDet = 1 / det;\r\n              s0 *= invDet;\r\n              s1 *= invDet;\r\n              sqrDist = s0 * (s0 + a01 * s1 + 2 * b0) + s1 * (a01 * s0 + s1 + 2 * b1) + c;\r\n\r\n            }\r\n            else {\r\n\r\n              // region 1\r\n\r\n              s1 = segExtent;\r\n              s0 = Math.max(0, -(a01 * s1 + b0));\r\n              sqrDist = -s0 * s0 + s1 * (s1 + 2 * b1) + c;\r\n\r\n            }\r\n\r\n          }\r\n          else {\r\n\r\n            // region 5\r\n\r\n            s1 = -segExtent;\r\n            s0 = Math.max(0, -(a01 * s1 + b0));\r\n            sqrDist = -s0 * s0 + s1 * (s1 + 2 * b1) + c;\r\n\r\n          }\r\n\r\n        }\r\n        else {\r\n\r\n          if (s1 <= -extDet) {\r\n\r\n            // region 4\r\n\r\n            s0 = Math.max(0, -(-a01 * segExtent + b0));\r\n            s1 = (s0 > 0) ? -segExtent : Math.min(Math.max(-segExtent, -b1), segExtent);\r\n            sqrDist = -s0 * s0 + s1 * (s1 + 2 * b1) + c;\r\n\r\n          }\r\n          else if (s1 <= extDet) {\r\n\r\n            // region 3\r\n\r\n            s0 = 0;\r\n            s1 = Math.min(Math.max(-segExtent, -b1), segExtent);\r\n            sqrDist = s1 * (s1 + 2 * b1) + c;\r\n\r\n          }\r\n          else {\r\n\r\n            // region 2\r\n\r\n            s0 = Math.max(0, -(a01 * segExtent + b0));\r\n            s1 = (s0 > 0) ? segExtent : Math.min(Math.max(-segExtent, -b1), segExtent);\r\n            sqrDist = -s0 * s0 + s1 * (s1 + 2 * b1) + c;\r\n\r\n          }\r\n\r\n        }\r\n\r\n      }\r\n      else {\r\n\r\n        // Ray and segment are parallel.\r\n\r\n        s1 = (a01 > 0) ? -segExtent : segExtent;\r\n        s0 = Math.max(0, -(a01 * s1 + b0));\r\n        sqrDist = -s0 * s0 + s1 * (s1 + 2 * b1) + c;\r\n\r\n      }\r\n\r\n      if (optionalPointOnRay) {\r\n\r\n        optionalPointOnRay.copy(this.direction).multiplyScalar(s0).add(this.origin);\r\n\r\n      }\r\n\r\n      if (optionalPointOnSegment) {\r\n\r\n        optionalPointOnSegment.copy(segDir).multiplyScalar(s1).add(segCenter);\r\n\r\n      }\r\n\r\n      return sqrDist;\r\n\r\n    };\r\n\r\n  }(),\r\n\r\n\r\n  isIntersectionSphere: function(sphere) {\r\n\r\n    return this.distanceToPoint(sphere.center) <= sphere.radius;\r\n\r\n  },\r\n\r\n  intersectSphere: function() {\r\n\r\n    // from http://www.scratchapixel.com/lessons/3d-basic-lessons/lesson-7-intersecting-simple-shapes/ray-sphere-intersection/\r\n\r\n    var v1 = new THREE.Vector3();\r\n\r\n    return function(sphere, optionalTarget) {\r\n\r\n      v1.subVectors(sphere.center, this.origin);\r\n\r\n      var tca = v1.dot(this.direction);\r\n\r\n      var d2 = v1.dot(v1) - tca * tca;\r\n\r\n      var radius2 = sphere.radius * sphere.radius;\r\n\r\n      if (d2 > radius2) return null;\r\n\r\n      var thc = Math.sqrt(radius2 - d2);\r\n\r\n      // t0 = first intersect point - entrance on front of sphere\r\n      var t0 = tca - thc;\r\n\r\n      // t1 = second intersect point - exit point on back of sphere\r\n      var t1 = tca + thc;\r\n\r\n      // test to see if both t0 and t1 are behind the ray - if so, return null\r\n      if (t0 < 0 && t1 < 0) return null;\r\n\r\n      // test to see if t0 is behind the ray:\r\n      // if it is, the ray is inside the sphere, so return the second exit point scaled by t1,\r\n      // in order to always return an intersect point that is in front of the ray.\r\n      if (t0 < 0) return this.at(t1, optionalTarget);\r\n\r\n      // else t0 is in front of the ray, so return the first collision point scaled by t0 \r\n      return this.at(t0, optionalTarget);\r\n\r\n    }\r\n\r\n  }(),\r\n\r\n  isIntersectionPlane: function(plane) {\r\n\r\n    // check if the ray lies on the plane first\r\n\r\n    var distToPoint = plane.distanceToPoint(this.origin);\r\n\r\n    if (distToPoint === 0) {\r\n\r\n      return true;\r\n\r\n    }\r\n\r\n    var denominator = plane.normal.dot(this.direction);\r\n\r\n    if (denominator * distToPoint < 0) {\r\n\r\n      return true;\r\n\r\n    }\r\n\r\n    // ray origin is behind the plane (and is pointing behind it)\r\n\r\n    return false;\r\n\r\n  },\r\n\r\n  distanceToPlane: function(plane) {\r\n\r\n    var denominator = plane.normal.dot(this.direction);\r\n    if (denominator == 0) {\r\n\r\n      // line is coplanar, return origin\r\n      if (plane.distanceToPoint(this.origin) == 0) {\r\n\r\n        return 0;\r\n\r\n      }\r\n\r\n      // Null is preferable to undefined since undefined means.... it is undefined\r\n\r\n      return null;\r\n\r\n    }\r\n\r\n    var t = -(this.origin.dot(plane.normal) + plane.constant) / denominator;\r\n\r\n    // Return if the ray never intersects the plane\r\n\r\n    return t >= 0 ? t : null;\r\n\r\n  },\r\n\r\n  intersectPlane: function(plane, optionalTarget) {\r\n\r\n    var t = this.distanceToPlane(plane);\r\n\r\n    if (t === null) {\r\n\r\n      return null;\r\n    }\r\n\r\n    return this.at(t, optionalTarget);\r\n\r\n  },\r\n\r\n  isIntersectionBox: function() {\r\n\r\n    var v = new THREE.Vector3();\r\n\r\n    return function(box) {\r\n\r\n      return this.intersectBox(box, v) !== null;\r\n\r\n    };\r\n\r\n  }(),\r\n\r\n  intersectBox: function(box, optionalTarget) {\r\n\r\n    // http://www.scratchapixel.com/lessons/3d-basic-lessons/lesson-7-intersecting-simple-shapes/ray-box-intersection/\r\n\r\n    var tmin, tmax, tymin, tymax, tzmin, tzmax;\r\n\r\n    var invdirx = 1 / this.direction.x,\r\n      invdiry = 1 / this.direction.y,\r\n      invdirz = 1 / this.direction.z;\r\n\r\n    var origin = this.origin;\r\n\r\n    if (invdirx >= 0) {\r\n\r\n      tmin = (box.min.x - origin.x) * invdirx;\r\n      tmax = (box.max.x - origin.x) * invdirx;\r\n\r\n    }\r\n    else {\r\n\r\n      tmin = (box.max.x - origin.x) * invdirx;\r\n      tmax = (box.min.x - origin.x) * invdirx;\r\n    }\r\n\r\n    if (invdiry >= 0) {\r\n\r\n      tymin = (box.min.y - origin.y) * invdiry;\r\n      tymax = (box.max.y - origin.y) * invdiry;\r\n\r\n    }\r\n    else {\r\n\r\n      tymin = (box.max.y - origin.y) * invdiry;\r\n      tymax = (box.min.y - origin.y) * invdiry;\r\n    }\r\n\r\n    if ((tmin > tymax) || (tymin > tmax)) return null;\r\n\r\n    // These lines also handle the case where tmin or tmax is NaN\r\n    // (result of 0 * Infinity). x !== x returns true if x is NaN\r\n\r\n    if (tymin > tmin || tmin !== tmin) tmin = tymin;\r\n\r\n    if (tymax < tmax || tmax !== tmax) tmax = tymax;\r\n\r\n    if (invdirz >= 0) {\r\n\r\n      tzmin = (box.min.z - origin.z) * invdirz;\r\n      tzmax = (box.max.z - origin.z) * invdirz;\r\n\r\n    }\r\n    else {\r\n\r\n      tzmin = (box.max.z - origin.z) * invdirz;\r\n      tzmax = (box.min.z - origin.z) * invdirz;\r\n    }\r\n\r\n    if ((tmin > tzmax) || (tzmin > tmax)) return null;\r\n\r\n    if (tzmin > tmin || tmin !== tmin) tmin = tzmin;\r\n\r\n    if (tzmax < tmax || tmax !== tmax) tmax = tzmax;\r\n\r\n    //return point closest to the ray (positive side)\r\n\r\n    if (tmax < 0) return null;\r\n\r\n    return this.at(tmin >= 0 ? tmin : tmax, optionalTarget);\r\n\r\n  },\r\n\r\n  intersectTriangle: function() {\r\n\r\n    // Compute the offset origin, edges, and normal.\r\n    var diff = new THREE.Vector3();\r\n    var edge1 = new THREE.Vector3();\r\n    var edge2 = new THREE.Vector3();\r\n    var normal = new THREE.Vector3();\r\n\r\n    return function(a, b, c, backfaceCulling, optionalTarget) {\r\n\r\n      // from http://www.geometrictools.com/LibMathematics/Intersection/Wm5IntrRay3Triangle3.cpp\r\n\r\n      edge1.subVectors(b, a);\r\n      edge2.subVectors(c, a);\r\n      normal.crossVectors(edge1, edge2);\r\n\r\n      // Solve Q + t*D = b1*E1 + b2*E2 (Q = kDiff, D = ray direction,\r\n      // E1 = kEdge1, E2 = kEdge2, N = Cross(E1,E2)) by\r\n      //   |Dot(D,N)|*b1 = sign(Dot(D,N))*Dot(D,Cross(Q,E2))\r\n      //   |Dot(D,N)|*b2 = sign(Dot(D,N))*Dot(D,Cross(E1,Q))\r\n      //   |Dot(D,N)|*t = -sign(Dot(D,N))*Dot(Q,N)\r\n      var DdN = this.direction.dot(normal);\r\n      var sign;\r\n\r\n      if (DdN > 0) {\r\n\r\n        if (backfaceCulling) return null;\r\n        sign = 1;\r\n\r\n      }\r\n      else if (DdN < 0) {\r\n\r\n        sign = -1;\r\n        DdN = -DdN;\r\n\r\n      }\r\n      else {\r\n\r\n        return null;\r\n\r\n      }\r\n\r\n      diff.subVectors(this.origin, a);\r\n      var DdQxE2 = sign * this.direction.dot(edge2.crossVectors(diff, edge2));\r\n\r\n      // b1 < 0, no intersection\r\n      if (DdQxE2 < 0) {\r\n\r\n        return null;\r\n\r\n      }\r\n\r\n      var DdE1xQ = sign * this.direction.dot(edge1.cross(diff));\r\n\r\n      // b2 < 0, no intersection\r\n      if (DdE1xQ < 0) {\r\n\r\n        return null;\r\n\r\n      }\r\n\r\n      // b1+b2 > 1, no intersection\r\n      if (DdQxE2 + DdE1xQ > DdN) {\r\n\r\n        return null;\r\n\r\n      }\r\n\r\n      // Line intersects triangle, check if ray does.\r\n      var QdN = -sign * diff.dot(normal);\r\n\r\n      // t < 0, no intersection\r\n      if (QdN < 0) {\r\n\r\n        return null;\r\n\r\n      }\r\n\r\n      // Ray intersects triangle.\r\n      return this.at(QdN / DdN, optionalTarget);\r\n\r\n    };\r\n\r\n  }(),\r\n\r\n  applyMatrix4: function(matrix4) {\r\n\r\n    this.direction.add(this.origin).applyMatrix4(matrix4);\r\n    this.origin.applyMatrix4(matrix4);\r\n    this.direction.sub(this.origin);\r\n    this.direction.normalize();\r\n\r\n    return this;\r\n  },\r\n\r\n  equals: function(ray) {\r\n\r\n    return ray.origin.equals(this.origin) && ray.direction.equals(this.direction);\r\n\r\n  },\r\n\r\n  clone: function() {\r\n\r\n    return new THREE.Ray().copy(this);\r\n\r\n  }\r\n\r\n};\r\n\r\n// File:src/math/Sphere.js\r\n\r\n/**\r\n * @author bhouston / http://exocortex.com\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.Sphere = function(center, radius) {\r\n\r\n  this.center = (center !== undefined) ? center : new THREE.Vector3();\r\n  this.radius = (radius !== undefined) ? radius : 0;\r\n\r\n};\r\n\r\nTHREE.Sphere.prototype = {\r\n\r\n  constructor: THREE.Sphere,\r\n\r\n  set: function(center, radius) {\r\n\r\n    this.center.copy(center);\r\n    this.radius = radius;\r\n\r\n    return this;\r\n  },\r\n\r\n  setFromPoints: function() {\r\n\r\n    var box = new THREE.Box3();\r\n\r\n    return function(points, optionalCenter) {\r\n\r\n      var center = this.center;\r\n\r\n      if (optionalCenter !== undefined) {\r\n\r\n        center.copy(optionalCenter);\r\n\r\n      }\r\n      else {\r\n\r\n        box.setFromPoints(points).center(center);\r\n\r\n      }\r\n\r\n      var maxRadiusSq = 0;\r\n\r\n      for (var i = 0, il = points.length; i < il; i++) {\r\n\r\n        maxRadiusSq = Math.max(maxRadiusSq, center.distanceToSquared(points[i]));\r\n\r\n      }\r\n\r\n      this.radius = Math.sqrt(maxRadiusSq);\r\n\r\n      return this;\r\n\r\n    };\r\n\r\n  }(),\r\n\r\n  copy: function(sphere) {\r\n\r\n    this.center.copy(sphere.center);\r\n    this.radius = sphere.radius;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  empty: function() {\r\n\r\n    return (this.radius <= 0);\r\n\r\n  },\r\n\r\n  containsPoint: function(point) {\r\n\r\n    return (point.distanceToSquared(this.center) <= (this.radius * this.radius));\r\n\r\n  },\r\n\r\n  distanceToPoint: function(point) {\r\n\r\n    return (point.distanceTo(this.center) - this.radius);\r\n\r\n  },\r\n\r\n  intersectsSphere: function(sphere) {\r\n\r\n    var radiusSum = this.radius + sphere.radius;\r\n\r\n    return sphere.center.distanceToSquared(this.center) <= (radiusSum * radiusSum);\r\n\r\n  },\r\n\r\n  clampPoint: function(point, optionalTarget) {\r\n\r\n    var deltaLengthSq = this.center.distanceToSquared(point);\r\n\r\n    var result = optionalTarget || new THREE.Vector3();\r\n    result.copy(point);\r\n\r\n    if (deltaLengthSq > (this.radius * this.radius)) {\r\n\r\n      result.sub(this.center).normalize();\r\n      result.multiplyScalar(this.radius).add(this.center);\r\n\r\n    }\r\n\r\n    return result;\r\n\r\n  },\r\n\r\n  getBoundingBox: function(optionalTarget) {\r\n\r\n    var box = optionalTarget || new THREE.Box3();\r\n\r\n    box.set(this.center, this.center);\r\n    box.expandByScalar(this.radius);\r\n\r\n    return box;\r\n\r\n  },\r\n\r\n  applyMatrix4: function(matrix) {\r\n\r\n    this.center.applyMatrix4(matrix);\r\n    this.radius = this.radius * matrix.getMaxScaleOnAxis();\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  translate: function(offset) {\r\n\r\n    this.center.add(offset);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  equals: function(sphere) {\r\n\r\n    return sphere.center.equals(this.center) && (sphere.radius === this.radius);\r\n\r\n  },\r\n\r\n  clone: function() {\r\n\r\n    return new THREE.Sphere().copy(this);\r\n\r\n  }\r\n\r\n};\r\n\r\n// File:src/math/Frustum.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author alteredq / http://alteredqualia.com/\r\n * @author bhouston / http://exocortex.com\r\n */\r\n\r\nTHREE.Frustum = function(p0, p1, p2, p3, p4, p5) {\r\n\r\n  this.planes = [\r\n\r\n    (p0 !== undefined) ? p0 : new THREE.Plane(), (p1 !== undefined) ? p1 : new THREE.Plane(), (p2 !== undefined) ? p2 : new THREE.Plane(), (p3 !== undefined) ? p3 : new THREE.Plane(), (p4 !== undefined) ? p4 : new THREE.Plane(), (p5 !== undefined) ? p5 : new THREE.Plane()\r\n\r\n  ];\r\n\r\n};\r\n\r\nTHREE.Frustum.prototype = {\r\n\r\n  constructor: THREE.Frustum,\r\n\r\n  set: function(p0, p1, p2, p3, p4, p5) {\r\n\r\n    var planes = this.planes;\r\n\r\n    planes[0].copy(p0);\r\n    planes[1].copy(p1);\r\n    planes[2].copy(p2);\r\n    planes[3].copy(p3);\r\n    planes[4].copy(p4);\r\n    planes[5].copy(p5);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  copy: function(frustum) {\r\n\r\n    var planes = this.planes;\r\n\r\n    for (var i = 0; i < 6; i++) {\r\n\r\n      planes[i].copy(frustum.planes[i]);\r\n\r\n    }\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  setFromMatrix: function(m) {\r\n\r\n    var planes = this.planes;\r\n    var me = m.elements;\r\n    var me0 = me[0],\r\n      me1 = me[1],\r\n      me2 = me[2],\r\n      me3 = me[3];\r\n    var me4 = me[4],\r\n      me5 = me[5],\r\n      me6 = me[6],\r\n      me7 = me[7];\r\n    var me8 = me[8],\r\n      me9 = me[9],\r\n      me10 = me[10],\r\n      me11 = me[11];\r\n    var me12 = me[12],\r\n      me13 = me[13],\r\n      me14 = me[14],\r\n      me15 = me[15];\r\n\r\n    planes[0].setComponents(me3 - me0, me7 - me4, me11 - me8, me15 - me12).normalize();\r\n    planes[1].setComponents(me3 + me0, me7 + me4, me11 + me8, me15 + me12).normalize();\r\n    planes[2].setComponents(me3 + me1, me7 + me5, me11 + me9, me15 + me13).normalize();\r\n    planes[3].setComponents(me3 - me1, me7 - me5, me11 - me9, me15 - me13).normalize();\r\n    planes[4].setComponents(me3 - me2, me7 - me6, me11 - me10, me15 - me14).normalize();\r\n    planes[5].setComponents(me3 + me2, me7 + me6, me11 + me10, me15 + me14).normalize();\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  intersectsObject: function() {\r\n\r\n    var sphere = new THREE.Sphere();\r\n\r\n    return function(object) {\r\n\r\n      var geometry = object.geometry;\r\n\r\n      if (geometry.boundingSphere === null) geometry.computeBoundingSphere();\r\n\r\n      sphere.copy(geometry.boundingSphere);\r\n      sphere.applyMatrix4(object.matrixWorld);\r\n\r\n      return this.intersectsSphere(sphere);\r\n\r\n    };\r\n\r\n  }(),\r\n\r\n  intersectsSphere: function(sphere) {\r\n\r\n    var planes = this.planes;\r\n    var center = sphere.center;\r\n    var negRadius = -sphere.radius;\r\n\r\n    for (var i = 0; i < 6; i++) {\r\n\r\n      var distance = planes[i].distanceToPoint(center);\r\n\r\n      if (distance < negRadius) {\r\n\r\n        return false;\r\n\r\n      }\r\n\r\n    }\r\n\r\n    return true;\r\n\r\n  },\r\n\r\n  intersectsBox: function() {\r\n\r\n    var p1 = new THREE.Vector3(),\r\n      p2 = new THREE.Vector3();\r\n\r\n    return function(box) {\r\n\r\n      var planes = this.planes;\r\n\r\n      for (var i = 0; i < 6; i++) {\r\n\r\n        var plane = planes[i];\r\n\r\n        p1.x = plane.normal.x > 0 ? box.min.x : box.max.x;\r\n        p2.x = plane.normal.x > 0 ? box.max.x : box.min.x;\r\n        p1.y = plane.normal.y > 0 ? box.min.y : box.max.y;\r\n        p2.y = plane.normal.y > 0 ? box.max.y : box.min.y;\r\n        p1.z = plane.normal.z > 0 ? box.min.z : box.max.z;\r\n        p2.z = plane.normal.z > 0 ? box.max.z : box.min.z;\r\n\r\n        var d1 = plane.distanceToPoint(p1);\r\n        var d2 = plane.distanceToPoint(p2);\r\n\r\n        // if both outside plane, no intersection\r\n\r\n        if (d1 < 0 && d2 < 0) {\r\n\r\n          return false;\r\n\r\n        }\r\n      }\r\n\r\n      return true;\r\n    };\r\n\r\n  }(),\r\n\r\n\r\n  containsPoint: function(point) {\r\n\r\n    var planes = this.planes;\r\n\r\n    for (var i = 0; i < 6; i++) {\r\n\r\n      if (planes[i].distanceToPoint(point) < 0) {\r\n\r\n        return false;\r\n\r\n      }\r\n\r\n    }\r\n\r\n    return true;\r\n\r\n  },\r\n\r\n  clone: function() {\r\n\r\n    return new THREE.Frustum().copy(this);\r\n\r\n  }\r\n\r\n};\r\n\r\n// File:src/math/Plane.js\r\n\r\n/**\r\n * @author bhouston / http://exocortex.com\r\n */\r\n\r\nTHREE.Plane = function(normal, constant) {\r\n\r\n  this.normal = (normal !== undefined) ? normal : new THREE.Vector3(1, 0, 0);\r\n  this.constant = (constant !== undefined) ? constant : 0;\r\n\r\n};\r\n\r\nTHREE.Plane.prototype = {\r\n\r\n  constructor: THREE.Plane,\r\n\r\n  set: function(normal, constant) {\r\n\r\n    this.normal.copy(normal);\r\n    this.constant = constant;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  setComponents: function(x, y, z, w) {\r\n\r\n    this.normal.set(x, y, z);\r\n    this.constant = w;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  setFromNormalAndCoplanarPoint: function(normal, point) {\r\n\r\n    this.normal.copy(normal);\r\n    this.constant = -point.dot(this.normal); // must be this.normal, not normal, as this.normal is normalized\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  setFromCoplanarPoints: function() {\r\n\r\n    var v1 = new THREE.Vector3();\r\n    var v2 = new THREE.Vector3();\r\n\r\n    return function(a, b, c) {\r\n\r\n      var normal = v1.subVectors(c, b).cross(v2.subVectors(a, b)).normalize();\r\n\r\n      // Q: should an error be thrown if normal is zero (e.g. degenerate plane)?\r\n\r\n      this.setFromNormalAndCoplanarPoint(normal, a);\r\n\r\n      return this;\r\n\r\n    };\r\n\r\n  }(),\r\n\r\n\r\n  copy: function(plane) {\r\n\r\n    this.normal.copy(plane.normal);\r\n    this.constant = plane.constant;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  normalize: function() {\r\n\r\n    // Note: will lead to a divide by zero if the plane is invalid.\r\n\r\n    var inverseNormalLength = 1.0 / this.normal.length();\r\n    this.normal.multiplyScalar(inverseNormalLength);\r\n    this.constant *= inverseNormalLength;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  negate: function() {\r\n\r\n    this.constant *= -1;\r\n    this.normal.negate();\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  distanceToPoint: function(point) {\r\n\r\n    return this.normal.dot(point) + this.constant;\r\n\r\n  },\r\n\r\n  distanceToSphere: function(sphere) {\r\n\r\n    return this.distanceToPoint(sphere.center) - sphere.radius;\r\n\r\n  },\r\n\r\n  projectPoint: function(point, optionalTarget) {\r\n\r\n    return this.orthoPoint(point, optionalTarget).sub(point).negate();\r\n\r\n  },\r\n\r\n  orthoPoint: function(point, optionalTarget) {\r\n\r\n    var perpendicularMagnitude = this.distanceToPoint(point);\r\n\r\n    var result = optionalTarget || new THREE.Vector3();\r\n    return result.copy(this.normal).multiplyScalar(perpendicularMagnitude);\r\n\r\n  },\r\n\r\n  isIntersectionLine: function(line) {\r\n\r\n    // Note: this tests if a line intersects the plane, not whether it (or its end-points) are coplanar with it.\r\n\r\n    var startSign = this.distanceToPoint(line.start);\r\n    var endSign = this.distanceToPoint(line.end);\r\n\r\n    return (startSign < 0 && endSign > 0) || (endSign < 0 && startSign > 0);\r\n\r\n  },\r\n\r\n  intersectLine: function() {\r\n\r\n    var v1 = new THREE.Vector3();\r\n\r\n    return function(line, optionalTarget) {\r\n\r\n      var result = optionalTarget || new THREE.Vector3();\r\n\r\n      var direction = line.delta(v1);\r\n\r\n      var denominator = this.normal.dot(direction);\r\n\r\n      if (denominator == 0) {\r\n\r\n        // line is coplanar, return origin\r\n        if (this.distanceToPoint(line.start) == 0) {\r\n\r\n          return result.copy(line.start);\r\n\r\n        }\r\n\r\n        // Unsure if this is the correct method to handle this case.\r\n        return undefined;\r\n\r\n      }\r\n\r\n      var t = -(line.start.dot(this.normal) + this.constant) / denominator;\r\n\r\n      if (t < 0 || t > 1) {\r\n\r\n        return undefined;\r\n\r\n      }\r\n\r\n      return result.copy(direction).multiplyScalar(t).add(line.start);\r\n\r\n    };\r\n\r\n  }(),\r\n\r\n\r\n  coplanarPoint: function(optionalTarget) {\r\n\r\n    var result = optionalTarget || new THREE.Vector3();\r\n    return result.copy(this.normal).multiplyScalar(-this.constant);\r\n\r\n  },\r\n\r\n  applyMatrix4: function() {\r\n\r\n    var v1 = new THREE.Vector3();\r\n    var v2 = new THREE.Vector3();\r\n    var m1 = new THREE.Matrix3();\r\n\r\n    return function(matrix, optionalNormalMatrix) {\r\n\r\n      // compute new normal based on theory here:\r\n      // http://www.songho.ca/opengl/gl_normaltransform.html\r\n      var normalMatrix = optionalNormalMatrix || m1.getNormalMatrix(matrix);\r\n      var newNormal = v1.copy(this.normal).applyMatrix3(normalMatrix);\r\n\r\n      var newCoplanarPoint = this.coplanarPoint(v2);\r\n      newCoplanarPoint.applyMatrix4(matrix);\r\n\r\n      this.setFromNormalAndCoplanarPoint(newNormal, newCoplanarPoint);\r\n\r\n      return this;\r\n\r\n    };\r\n\r\n  }(),\r\n\r\n  translate: function(offset) {\r\n\r\n    this.constant = this.constant - offset.dot(this.normal);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  equals: function(plane) {\r\n\r\n    return plane.normal.equals(this.normal) && (plane.constant == this.constant);\r\n\r\n  },\r\n\r\n  clone: function() {\r\n\r\n    return new THREE.Plane().copy(this);\r\n\r\n  }\r\n\r\n};\r\n\r\n// File:src/math/Math.js\r\n\r\n/**\r\n * @author alteredq / http://alteredqualia.com/\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.Math = {\r\n\r\n  generateUUID: function() {\r\n\r\n    // http://www.broofa.com/Tools/Math.uuid.htm\r\n\r\n    var chars = '0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz'.split('');\r\n    var uuid = new Array(36);\r\n    var rnd = 0,\r\n      r;\r\n\r\n    return function() {\r\n\r\n      for (var i = 0; i < 36; i++) {\r\n\r\n        if (i == 8 || i == 13 || i == 18 || i == 23) {\r\n\r\n          uuid[i] = '-';\r\n\r\n        }\r\n        else if (i == 14) {\r\n\r\n          uuid[i] = '4';\r\n\r\n        }\r\n        else {\r\n\r\n          if (rnd <= 0x02) rnd = 0x2000000 + (Math.random() * 0x1000000) | 0;\r\n          r = rnd & 0xf;\r\n          rnd = rnd >> 4;\r\n          uuid[i] = chars[(i == 19) ? (r & 0x3) | 0x8 : r];\r\n\r\n        }\r\n      }\r\n\r\n      return uuid.join('');\r\n\r\n    };\r\n\r\n  }(),\r\n\r\n  // Clamp value to range <a, b>\r\n\r\n  clamp: function(x, a, b) {\r\n\r\n    return (x < a) ? a : ((x > b) ? b : x);\r\n\r\n  },\r\n\r\n  // Clamp value to range <a, inf)\r\n\r\n  clampBottom: function(x, a) {\r\n\r\n    return x < a ? a : x;\r\n\r\n  },\r\n\r\n  // Linear mapping from range <a1, a2> to range <b1, b2>\r\n\r\n  mapLinear: function(x, a1, a2, b1, b2) {\r\n\r\n    return b1 + (x - a1) * (b2 - b1) / (a2 - a1);\r\n\r\n  },\r\n\r\n  // http://en.wikipedia.org/wiki/Smoothstep\r\n\r\n  smoothstep: function(x, min, max) {\r\n\r\n    if (x <= min) return 0;\r\n    if (x >= max) return 1;\r\n\r\n    x = (x - min) / (max - min);\r\n\r\n    return x * x * (3 - 2 * x);\r\n\r\n  },\r\n\r\n  smootherstep: function(x, min, max) {\r\n\r\n    if (x <= min) return 0;\r\n    if (x >= max) return 1;\r\n\r\n    x = (x - min) / (max - min);\r\n\r\n    return x * x * x * (x * (x * 6 - 15) + 10);\r\n\r\n  },\r\n\r\n  // Random float from <0, 1> with 16 bits of randomness\r\n  // (standard Math.random() creates repetitive patterns when applied over larger space)\r\n\r\n  random16: function() {\r\n\r\n    return (65280 * Math.random() + 255 * Math.random()) / 65535;\r\n\r\n  },\r\n\r\n  // Random integer from <low, high> interval\r\n\r\n  randInt: function(low, high) {\r\n\r\n    return Math.floor(this.randFloat(low, high));\r\n\r\n  },\r\n\r\n  // Random float from <low, high> interval\r\n\r\n  randFloat: function(low, high) {\r\n\r\n    return low + Math.random() * (high - low);\r\n\r\n  },\r\n\r\n  // Random float from <-range/2, range/2> interval\r\n\r\n  randFloatSpread: function(range) {\r\n\r\n    return range * (0.5 - Math.random());\r\n\r\n  },\r\n\r\n  degToRad: function() {\r\n\r\n    var degreeToRadiansFactor = Math.PI / 180;\r\n\r\n    return function(degrees) {\r\n\r\n      return degrees * degreeToRadiansFactor;\r\n\r\n    };\r\n\r\n  }(),\r\n\r\n  radToDeg: function() {\r\n\r\n    var radianToDegreesFactor = 180 / Math.PI;\r\n\r\n    return function(radians) {\r\n\r\n      return radians * radianToDegreesFactor;\r\n\r\n    };\r\n\r\n  }(),\r\n\r\n  isPowerOfTwo: function(value) {\r\n\r\n    return (value & (value - 1)) === 0 && value !== 0;\r\n\r\n  },\r\n\r\n  nextPowerOfTwo: function(value) {\r\n\r\n    value--;\r\n    value |= value >> 1;\r\n    value |= value >> 2;\r\n    value |= value >> 4;\r\n    value |= value >> 8;\r\n    value |= value >> 16;\r\n    value++;\r\n\r\n    return value;\r\n\r\n  }\r\n\r\n};\r\n\r\n// File:src/math/Spline.js\r\n\r\n/**\r\n * Spline from Tween.js, slightly optimized (and trashed)\r\n * http://sole.github.com/tween.js/examples/05_spline.html\r\n *\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author alteredq / http://alteredqualia.com/\r\n */\r\n\r\nTHREE.Spline = function(points) {\r\n\r\n  this.points = points;\r\n\r\n  var c = [],\r\n    v3 = {\r\n      x: 0,\r\n      y: 0,\r\n      z: 0\r\n    },\r\n    point, intPoint, weight, w2, w3,\r\n    pa, pb, pc, pd;\r\n\r\n  this.initFromArray = function(a) {\r\n\r\n    this.points = [];\r\n\r\n    for (var i = 0; i < a.length; i++) {\r\n\r\n      this.points[i] = {\r\n        x: a[i][0],\r\n        y: a[i][1],\r\n        z: a[i][2]\r\n      };\r\n\r\n    }\r\n\r\n  };\r\n\r\n  this.getPoint = function(k) {\r\n\r\n    point = (this.points.length - 1) * k;\r\n    intPoint = Math.floor(point);\r\n    weight = point - intPoint;\r\n\r\n    c[0] = intPoint === 0 ? intPoint : intPoint - 1;\r\n    c[1] = intPoint;\r\n    c[2] = intPoint > this.points.length - 2 ? this.points.length - 1 : intPoint + 1;\r\n    c[3] = intPoint > this.points.length - 3 ? this.points.length - 1 : intPoint + 2;\r\n\r\n    pa = this.points[c[0]];\r\n    pb = this.points[c[1]];\r\n    pc = this.points[c[2]];\r\n    pd = this.points[c[3]];\r\n\r\n    w2 = weight * weight;\r\n    w3 = weight * w2;\r\n\r\n    v3.x = interpolate(pa.x, pb.x, pc.x, pd.x, weight, w2, w3);\r\n    v3.y = interpolate(pa.y, pb.y, pc.y, pd.y, weight, w2, w3);\r\n    v3.z = interpolate(pa.z, pb.z, pc.z, pd.z, weight, w2, w3);\r\n\r\n    return v3;\r\n\r\n  };\r\n\r\n  this.getControlPointsArray = function() {\r\n\r\n    var i, p, l = this.points.length,\r\n      coords = [];\r\n\r\n    for (i = 0; i < l; i++) {\r\n\r\n      p = this.points[i];\r\n      coords[i] = [p.x, p.y, p.z];\r\n\r\n    }\r\n\r\n    return coords;\r\n\r\n  };\r\n\r\n  // approximate length by summing linear segments\r\n\r\n  this.getLength = function(nSubDivisions) {\r\n\r\n    var i, index, nSamples, position,\r\n      point = 0,\r\n      intPoint = 0,\r\n      oldIntPoint = 0,\r\n      oldPosition = new THREE.Vector3(),\r\n      tmpVec = new THREE.Vector3(),\r\n      chunkLengths = [],\r\n      totalLength = 0;\r\n\r\n    // first point has 0 length\r\n\r\n    chunkLengths[0] = 0;\r\n\r\n    if (!nSubDivisions) nSubDivisions = 100;\r\n\r\n    nSamples = this.points.length * nSubDivisions;\r\n\r\n    oldPosition.copy(this.points[0]);\r\n\r\n    for (i = 1; i < nSamples; i++) {\r\n\r\n      index = i / nSamples;\r\n\r\n      position = this.getPoint(index);\r\n      tmpVec.copy(position);\r\n\r\n      totalLength += tmpVec.distanceTo(oldPosition);\r\n\r\n      oldPosition.copy(position);\r\n\r\n      point = (this.points.length - 1) * index;\r\n      intPoint = Math.floor(point);\r\n\r\n      if (intPoint != oldIntPoint) {\r\n\r\n        chunkLengths[intPoint] = totalLength;\r\n        oldIntPoint = intPoint;\r\n\r\n      }\r\n\r\n    }\r\n\r\n    // last point ends with total length\r\n\r\n    chunkLengths[chunkLengths.length] = totalLength;\r\n\r\n    return {\r\n      chunks: chunkLengths,\r\n      total: totalLength\r\n    };\r\n\r\n  };\r\n\r\n  this.reparametrizeByArcLength = function(samplingCoef) {\r\n\r\n    var i, j,\r\n      index, indexCurrent, indexNext,\r\n      realDistance,\r\n      sampling, position,\r\n      newpoints = [],\r\n      tmpVec = new THREE.Vector3(),\r\n      sl = this.getLength();\r\n\r\n    newpoints.push(tmpVec.copy(this.points[0]).clone());\r\n\r\n    for (i = 1; i < this.points.length; i++) {\r\n\r\n      //tmpVec.copy( this.points[ i - 1 ] );\r\n      //linearDistance = tmpVec.distanceTo( this.points[ i ] );\r\n\r\n      realDistance = sl.chunks[i] - sl.chunks[i - 1];\r\n\r\n      sampling = Math.ceil(samplingCoef * realDistance / sl.total);\r\n\r\n      indexCurrent = (i - 1) / (this.points.length - 1);\r\n      indexNext = i / (this.points.length - 1);\r\n\r\n      for (j = 1; j < sampling - 1; j++) {\r\n\r\n        index = indexCurrent + j * (1 / sampling) * (indexNext - indexCurrent);\r\n\r\n        position = this.getPoint(index);\r\n        newpoints.push(tmpVec.copy(position).clone());\r\n\r\n      }\r\n\r\n      newpoints.push(tmpVec.copy(this.points[i]).clone());\r\n\r\n    }\r\n\r\n    this.points = newpoints;\r\n\r\n  };\r\n\r\n  // Catmull-Rom\r\n\r\n  function interpolate(p0, p1, p2, p3, t, t2, t3) {\r\n\r\n    var v0 = (p2 - p0) * 0.5,\r\n      v1 = (p3 - p1) * 0.5;\r\n\r\n    return (2 * (p1 - p2) + v0 + v1) * t3 + (-3 * (p1 - p2) - 2 * v0 - v1) * t2 + v0 * t + p1;\r\n\r\n  };\r\n\r\n};\r\n\r\n// File:src/math/Triangle.js\r\n\r\n/**\r\n * @author bhouston / http://exocortex.com\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.Triangle = function(a, b, c) {\r\n\r\n  this.a = (a !== undefined) ? a : new THREE.Vector3();\r\n  this.b = (b !== undefined) ? b : new THREE.Vector3();\r\n  this.c = (c !== undefined) ? c : new THREE.Vector3();\r\n\r\n};\r\n\r\nTHREE.Triangle.normal = function() {\r\n\r\n  var v0 = new THREE.Vector3();\r\n\r\n  return function(a, b, c, optionalTarget) {\r\n\r\n    var result = optionalTarget || new THREE.Vector3();\r\n\r\n    result.subVectors(c, b);\r\n    v0.subVectors(a, b);\r\n    result.cross(v0);\r\n\r\n    var resultLengthSq = result.lengthSq();\r\n    if (resultLengthSq > 0) {\r\n\r\n      return result.multiplyScalar(1 / Math.sqrt(resultLengthSq));\r\n\r\n    }\r\n\r\n    return result.set(0, 0, 0);\r\n\r\n  };\r\n\r\n}();\r\n\r\n// static/instance method to calculate barycoordinates\r\n// based on: http://www.blackpawn.com/texts/pointinpoly/default.html\r\nTHREE.Triangle.barycoordFromPoint = function() {\r\n\r\n  var v0 = new THREE.Vector3();\r\n  var v1 = new THREE.Vector3();\r\n  var v2 = new THREE.Vector3();\r\n\r\n  return function(point, a, b, c, optionalTarget) {\r\n\r\n    v0.subVectors(c, a);\r\n    v1.subVectors(b, a);\r\n    v2.subVectors(point, a);\r\n\r\n    var dot00 = v0.dot(v0);\r\n    var dot01 = v0.dot(v1);\r\n    var dot02 = v0.dot(v2);\r\n    var dot11 = v1.dot(v1);\r\n    var dot12 = v1.dot(v2);\r\n\r\n    var denom = (dot00 * dot11 - dot01 * dot01);\r\n\r\n    var result = optionalTarget || new THREE.Vector3();\r\n\r\n    // colinear or singular triangle\r\n    if (denom == 0) {\r\n      // arbitrary location outside of triangle?\r\n      // not sure if this is the best idea, maybe should be returning undefined\r\n      return result.set(-2, -1, -1);\r\n    }\r\n\r\n    var invDenom = 1 / denom;\r\n    var u = (dot11 * dot02 - dot01 * dot12) * invDenom;\r\n    var v = (dot00 * dot12 - dot01 * dot02) * invDenom;\r\n\r\n    // barycoordinates must always sum to 1\r\n    return result.set(1 - u - v, v, u);\r\n\r\n  };\r\n\r\n}();\r\n\r\nTHREE.Triangle.containsPoint = function() {\r\n\r\n  var v1 = new THREE.Vector3();\r\n\r\n  return function(point, a, b, c) {\r\n\r\n    var result = THREE.Triangle.barycoordFromPoint(point, a, b, c, v1);\r\n\r\n    return (result.x >= 0) && (result.y >= 0) && ((result.x + result.y) <= 1);\r\n\r\n  };\r\n\r\n}();\r\n\r\nTHREE.Triangle.prototype = {\r\n\r\n  constructor: THREE.Triangle,\r\n\r\n  set: function(a, b, c) {\r\n\r\n    this.a.copy(a);\r\n    this.b.copy(b);\r\n    this.c.copy(c);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  setFromPointsAndIndices: function(points, i0, i1, i2) {\r\n\r\n    this.a.copy(points[i0]);\r\n    this.b.copy(points[i1]);\r\n    this.c.copy(points[i2]);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  copy: function(triangle) {\r\n\r\n    this.a.copy(triangle.a);\r\n    this.b.copy(triangle.b);\r\n    this.c.copy(triangle.c);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  area: function() {\r\n\r\n    var v0 = new THREE.Vector3();\r\n    var v1 = new THREE.Vector3();\r\n\r\n    return function() {\r\n\r\n      v0.subVectors(this.c, this.b);\r\n      v1.subVectors(this.a, this.b);\r\n\r\n      return v0.cross(v1).length() * 0.5;\r\n\r\n    };\r\n\r\n  }(),\r\n\r\n  midpoint: function(optionalTarget) {\r\n\r\n    var result = optionalTarget || new THREE.Vector3();\r\n    return result.addVectors(this.a, this.b).add(this.c).multiplyScalar(1 / 3);\r\n\r\n  },\r\n\r\n  normal: function(optionalTarget) {\r\n\r\n    return THREE.Triangle.normal(this.a, this.b, this.c, optionalTarget);\r\n\r\n  },\r\n\r\n  plane: function(optionalTarget) {\r\n\r\n    var result = optionalTarget || new THREE.Plane();\r\n\r\n    return result.setFromCoplanarPoints(this.a, this.b, this.c);\r\n\r\n  },\r\n\r\n  barycoordFromPoint: function(point, optionalTarget) {\r\n\r\n    return THREE.Triangle.barycoordFromPoint(point, this.a, this.b, this.c, optionalTarget);\r\n\r\n  },\r\n\r\n  containsPoint: function(point) {\r\n\r\n    return THREE.Triangle.containsPoint(point, this.a, this.b, this.c);\r\n\r\n  },\r\n\r\n  equals: function(triangle) {\r\n\r\n    return triangle.a.equals(this.a) && triangle.b.equals(this.b) && triangle.c.equals(this.c);\r\n\r\n  },\r\n\r\n  clone: function() {\r\n\r\n    return new THREE.Triangle().copy(this);\r\n\r\n  }\r\n\r\n};\r\n\r\n// File:src/core/Clock.js\r\n\r\n/**\r\n * @author alteredq / http://alteredqualia.com/\r\n */\r\n\r\nTHREE.Clock = function(autoStart) {\r\n\r\n  this.autoStart = (autoStart !== undefined) ? autoStart : true;\r\n\r\n  this.startTime = 0;\r\n  this.oldTime = 0;\r\n  this.elapsedTime = 0;\r\n\r\n  this.running = false;\r\n\r\n};\r\n\r\nTHREE.Clock.prototype = {\r\n\r\n  constructor: THREE.Clock,\r\n\r\n  start: function() {\r\n\r\n    this.startTime = self.performance !== undefined && self.performance.now !== undefined ? self.performance.now() : Date.now();\r\n\r\n    this.oldTime = this.startTime;\r\n    this.running = true;\r\n  },\r\n\r\n  stop: function() {\r\n\r\n    this.getElapsedTime();\r\n    this.running = false;\r\n\r\n  },\r\n\r\n  getElapsedTime: function() {\r\n\r\n    this.getDelta();\r\n    return this.elapsedTime;\r\n\r\n  },\r\n\r\n  getDelta: function() {\r\n\r\n    var diff = 0;\r\n\r\n    if (this.autoStart && !this.running) {\r\n\r\n      this.start();\r\n\r\n    }\r\n\r\n    if (this.running) {\r\n\r\n      var newTime = self.performance !== undefined && self.performance.now !== undefined ? self.performance.now() : Date.now();\r\n\r\n      diff = 0.001 * (newTime - this.oldTime);\r\n      this.oldTime = newTime;\r\n\r\n      this.elapsedTime += diff;\r\n\r\n    }\r\n\r\n    return diff;\r\n\r\n  }\r\n\r\n};\r\n\r\n// File:src/core/EventDispatcher.js\r\n\r\n/**\r\n * https://github.com/mrdoob/eventdispatcher.js/\r\n */\r\n\r\nTHREE.EventDispatcher = function() {}\r\n\r\nTHREE.EventDispatcher.prototype = {\r\n\r\n  constructor: THREE.EventDispatcher,\r\n\r\n  apply: function(object) {\r\n\r\n    object.addEventListener = THREE.EventDispatcher.prototype.addEventListener;\r\n    object.hasEventListener = THREE.EventDispatcher.prototype.hasEventListener;\r\n    object.removeEventListener = THREE.EventDispatcher.prototype.removeEventListener;\r\n    object.dispatchEvent = THREE.EventDispatcher.prototype.dispatchEvent;\r\n\r\n  },\r\n\r\n  addEventListener: function(type, listener) {\r\n\r\n    if (this._listeners === undefined) this._listeners = {};\r\n\r\n    var listeners = this._listeners;\r\n\r\n    if (listeners[type] === undefined) {\r\n\r\n      listeners[type] = [];\r\n\r\n    }\r\n\r\n    if (listeners[type].indexOf(listener) === -1) {\r\n\r\n      listeners[type].push(listener);\r\n\r\n    }\r\n\r\n  },\r\n\r\n  hasEventListener: function(type, listener) {\r\n\r\n    if (this._listeners === undefined) return false;\r\n\r\n    var listeners = this._listeners;\r\n\r\n    if (listeners[type] !== undefined && listeners[type].indexOf(listener) !== -1) {\r\n\r\n      return true;\r\n\r\n    }\r\n\r\n    return false;\r\n\r\n  },\r\n\r\n  removeEventListener: function(type, listener) {\r\n\r\n    if (this._listeners === undefined) return;\r\n\r\n    var listeners = this._listeners;\r\n    var listenerArray = listeners[type];\r\n\r\n    if (listenerArray !== undefined) {\r\n\r\n      var index = listenerArray.indexOf(listener);\r\n\r\n      if (index !== -1) {\r\n\r\n        listenerArray.splice(index, 1);\r\n\r\n      }\r\n\r\n    }\r\n\r\n  },\r\n\r\n  dispatchEvent: function(event) {\r\n\r\n    if (this._listeners === undefined) return;\r\n\r\n    var listeners = this._listeners;\r\n    var listenerArray = listeners[event.type];\r\n\r\n    if (listenerArray !== undefined) {\r\n\r\n      event.target = this;\r\n\r\n      var array = [];\r\n      var length = listenerArray.length;\r\n\r\n      for (var i = 0; i < length; i++) {\r\n\r\n        array[i] = listenerArray[i];\r\n\r\n      }\r\n\r\n      for (var i = 0; i < length; i++) {\r\n\r\n        array[i].call(this, event);\r\n\r\n      }\r\n\r\n    }\r\n\r\n  }\r\n\r\n};\r\n\r\n// File:src/core/Raycaster.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author bhouston / http://exocortex.com/\r\n * @author stephomi / http://stephaneginier.com/\r\n */\r\n\r\n(function(THREE) {\r\n\r\n  THREE.Raycaster = function(origin, direction, near, far) {\r\n\r\n    this.ray = new THREE.Ray(origin, direction);\r\n    // direction is assumed to be normalized (for accurate distance calculations)\r\n\r\n    this.near = near || 0;\r\n    this.far = far || Infinity;\r\n\r\n    this.params = {\r\n      Sprite: {},\r\n      Mesh: {},\r\n      PointCloud: {\r\n        threshold: 1\r\n      },\r\n      LOD: {},\r\n      Line: {}\r\n    };\r\n\r\n  };\r\n\r\n  var descSort = function(a, b) {\r\n\r\n    return a.distance - b.distance;\r\n\r\n  };\r\n\r\n  var intersectObject = function(object, raycaster, intersects, recursive) {\r\n\r\n    object.raycast(raycaster, intersects);\r\n\r\n    if (recursive === true) {\r\n\r\n      var children = object.children;\r\n\r\n      for (var i = 0, l = children.length; i < l; i++) {\r\n\r\n        intersectObject(children[i], raycaster, intersects, true);\r\n\r\n      }\r\n\r\n    }\r\n\r\n  };\r\n\r\n  //\r\n\r\n  THREE.Raycaster.prototype = {\r\n\r\n    constructor: THREE.Raycaster,\r\n\r\n    precision: 0.0001,\r\n    linePrecision: 1,\r\n\r\n    set: function(origin, direction) {\r\n\r\n      // direction is assumed to be normalized (for accurate distance calculations)\r\n\r\n      this.ray.set(origin, direction);\r\n\r\n    },\r\n\r\n    setFromCamera: function(coords, camera) {\r\n\r\n      // camera is assumed _not_ to be a child of a transformed object\r\n\r\n      if (camera instanceof THREE.PerspectiveCamera) {\r\n\r\n        this.ray.origin.copy(camera.position);\r\n        this.ray.direction.set(coords.x, coords.y, 0.5).unproject(camera).sub(camera.position).normalize();\r\n\r\n      }\r\n      else if (camera instanceof THREE.OrthographicCamera) {\r\n\r\n        this.ray.origin.set(coords.x, coords.y, -1).unproject(camera);\r\n        this.ray.direction.set(0, 0, -1).transformDirection(camera.matrixWorld);\r\n\r\n      }\r\n      else {\r\n\r\n        THREE.error('THREE.Raycaster: Unsupported camera type.');\r\n\r\n      }\r\n\r\n    },\r\n\r\n    intersectObject: function(object, recursive) {\r\n\r\n      var intersects = [];\r\n\r\n      intersectObject(object, this, intersects, recursive);\r\n\r\n      intersects.sort(descSort);\r\n\r\n      return intersects;\r\n\r\n    },\r\n\r\n    intersectObjects: function(objects, recursive) {\r\n\r\n      var intersects = [];\r\n\r\n      if (objects instanceof Array === false) {\r\n\r\n        THREE.warn('THREE.Raycaster.intersectObjects: objects is not an Array.');\r\n        return intersects;\r\n\r\n      }\r\n\r\n      for (var i = 0, l = objects.length; i < l; i++) {\r\n\r\n        intersectObject(objects[i], this, intersects, recursive);\r\n\r\n      }\r\n\r\n      intersects.sort(descSort);\r\n\r\n      return intersects;\r\n\r\n    }\r\n\r\n  };\r\n\r\n}(THREE));\r\n\r\n// File:src/core/Object3D.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author mikael emtinger / http://gomo.se/\r\n * @author alteredq / http://alteredqualia.com/\r\n * @author WestLangley / http://github.com/WestLangley\r\n */\r\n\r\nTHREE.Object3D = function() {\r\n\r\n  Object.defineProperty(this, 'id', {\r\n    value: THREE.Object3DIdCount++\r\n  });\r\n\r\n  this.uuid = THREE.Math.generateUUID();\r\n\r\n  this.name = '';\r\n  this.type = 'Object3D';\r\n\r\n  this.parent = undefined;\r\n  this.children = [];\r\n\r\n  this.up = THREE.Object3D.DefaultUp.clone();\r\n\r\n  var position = new THREE.Vector3();\r\n  var rotation = new THREE.Euler();\r\n  var quaternion = new THREE.Quaternion();\r\n  var scale = new THREE.Vector3(1, 1, 1);\r\n\r\n  var onRotationChange = function() {\r\n    quaternion.setFromEuler(rotation, false);\r\n  };\r\n\r\n  var onQuaternionChange = function() {\r\n    rotation.setFromQuaternion(quaternion, undefined, false);\r\n  };\r\n\r\n  rotation.onChange(onRotationChange);\r\n  quaternion.onChange(onQuaternionChange);\r\n\r\n  Object.defineProperties(this, {\r\n    position: {\r\n      enumerable: true,\r\n      value: position\r\n    },\r\n    rotation: {\r\n      enumerable: true,\r\n      value: rotation\r\n    },\r\n    quaternion: {\r\n      enumerable: true,\r\n      value: quaternion\r\n    },\r\n    scale: {\r\n      enumerable: true,\r\n      value: scale\r\n    }\r\n  });\r\n\r\n  this.rotationAutoUpdate = true;\r\n\r\n  this.matrix = new THREE.Matrix4();\r\n  this.matrixWorld = new THREE.Matrix4();\r\n\r\n  this.matrixAutoUpdate = true;\r\n  this.matrixWorldNeedsUpdate = false;\r\n\r\n  this.visible = true;\r\n\r\n  this.castShadow = false;\r\n  this.receiveShadow = false;\r\n\r\n  this.frustumCulled = true;\r\n  this.renderOrder = 0;\r\n\r\n  this.userData = {};\r\n\r\n};\r\n\r\nTHREE.Object3D.DefaultUp = new THREE.Vector3(0, 1, 0);\r\n\r\nTHREE.Object3D.prototype = {\r\n\r\n  constructor: THREE.Object3D,\r\n\r\n  get eulerOrder() {\r\n\r\n    THREE.warn('THREE.Object3D: .eulerOrder has been moved to .rotation.order.');\r\n\r\n    return this.rotation.order;\r\n\r\n  },\r\n\r\n  set eulerOrder(value) {\r\n\r\n    THREE.warn('THREE.Object3D: .eulerOrder has been moved to .rotation.order.');\r\n\r\n    this.rotation.order = value;\r\n\r\n  },\r\n\r\n  get useQuaternion() {\r\n\r\n    THREE.warn('THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.');\r\n\r\n  },\r\n\r\n  set useQuaternion(value) {\r\n\r\n    THREE.warn('THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.');\r\n\r\n  },\r\n\r\n  applyMatrix: function(matrix) {\r\n\r\n    this.matrix.multiplyMatrices(matrix, this.matrix);\r\n\r\n    this.matrix.decompose(this.position, this.quaternion, this.scale);\r\n\r\n  },\r\n\r\n  setRotationFromAxisAngle: function(axis, angle) {\r\n\r\n    // assumes axis is normalized\r\n\r\n    this.quaternion.setFromAxisAngle(axis, angle);\r\n\r\n  },\r\n\r\n  setRotationFromEuler: function(euler) {\r\n\r\n    this.quaternion.setFromEuler(euler, true);\r\n\r\n  },\r\n\r\n  setRotationFromMatrix: function(m) {\r\n\r\n    // assumes the upper 3x3 of m is a pure rotation matrix (i.e, unscaled)\r\n\r\n    this.quaternion.setFromRotationMatrix(m);\r\n\r\n  },\r\n\r\n  setRotationFromQuaternion: function(q) {\r\n\r\n    // assumes q is normalized\r\n\r\n    this.quaternion.copy(q);\r\n\r\n  },\r\n\r\n  rotateOnAxis: function() {\r\n\r\n    // rotate object on axis in object space\r\n    // axis is assumed to be normalized\r\n\r\n    var q1 = new THREE.Quaternion();\r\n\r\n    return function(axis, angle) {\r\n\r\n      q1.setFromAxisAngle(axis, angle);\r\n\r\n      this.quaternion.multiply(q1);\r\n\r\n      return this;\r\n\r\n    }\r\n\r\n  }(),\r\n\r\n  rotateX: function() {\r\n\r\n    var v1 = new THREE.Vector3(1, 0, 0);\r\n\r\n    return function(angle) {\r\n\r\n      return this.rotateOnAxis(v1, angle);\r\n\r\n    };\r\n\r\n  }(),\r\n\r\n  rotateY: function() {\r\n\r\n    var v1 = new THREE.Vector3(0, 1, 0);\r\n\r\n    return function(angle) {\r\n\r\n      return this.rotateOnAxis(v1, angle);\r\n\r\n    };\r\n\r\n  }(),\r\n\r\n  rotateZ: function() {\r\n\r\n    var v1 = new THREE.Vector3(0, 0, 1);\r\n\r\n    return function(angle) {\r\n\r\n      return this.rotateOnAxis(v1, angle);\r\n\r\n    };\r\n\r\n  }(),\r\n\r\n  translateOnAxis: function() {\r\n\r\n    // translate object by distance along axis in object space\r\n    // axis is assumed to be normalized\r\n\r\n    var v1 = new THREE.Vector3();\r\n\r\n    return function(axis, distance) {\r\n\r\n      v1.copy(axis).applyQuaternion(this.quaternion);\r\n\r\n      this.position.add(v1.multiplyScalar(distance));\r\n\r\n      return this;\r\n\r\n    }\r\n\r\n  }(),\r\n\r\n  translate: function(distance, axis) {\r\n\r\n    THREE.warn('THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead.');\r\n    return this.translateOnAxis(axis, distance);\r\n\r\n  },\r\n\r\n  translateX: function() {\r\n\r\n    var v1 = new THREE.Vector3(1, 0, 0);\r\n\r\n    return function(distance) {\r\n\r\n      return this.translateOnAxis(v1, distance);\r\n\r\n    };\r\n\r\n  }(),\r\n\r\n  translateY: function() {\r\n\r\n    var v1 = new THREE.Vector3(0, 1, 0);\r\n\r\n    return function(distance) {\r\n\r\n      return this.translateOnAxis(v1, distance);\r\n\r\n    };\r\n\r\n  }(),\r\n\r\n  translateZ: function() {\r\n\r\n    var v1 = new THREE.Vector3(0, 0, 1);\r\n\r\n    return function(distance) {\r\n\r\n      return this.translateOnAxis(v1, distance);\r\n\r\n    };\r\n\r\n  }(),\r\n\r\n  localToWorld: function(vector) {\r\n\r\n    return vector.applyMatrix4(this.matrixWorld);\r\n\r\n  },\r\n\r\n  worldToLocal: function() {\r\n\r\n    var m1 = new THREE.Matrix4();\r\n\r\n    return function(vector) {\r\n\r\n      return vector.applyMatrix4(m1.getInverse(this.matrixWorld));\r\n\r\n    };\r\n\r\n  }(),\r\n\r\n  lookAt: function() {\r\n\r\n    // This routine does not support objects with rotated and/or translated parent(s)\r\n\r\n    var m1 = new THREE.Matrix4();\r\n\r\n    return function(vector) {\r\n\r\n      m1.lookAt(vector, this.position, this.up);\r\n\r\n      this.quaternion.setFromRotationMatrix(m1);\r\n\r\n    };\r\n\r\n  }(),\r\n\r\n  add: function(object) {\r\n\r\n    if (arguments.length > 1) {\r\n\r\n      for (var i = 0; i < arguments.length; i++) {\r\n\r\n        this.add(arguments[i]);\r\n\r\n      }\r\n\r\n      return this;\r\n\r\n    };\r\n\r\n    if (object === this) {\r\n\r\n      THREE.error(\"THREE.Object3D.add: object can't be added as a child of itself.\", object);\r\n      return this;\r\n\r\n    }\r\n\r\n    if (object instanceof THREE.Object3D) {\r\n\r\n      if (object.parent !== undefined) {\r\n\r\n        object.parent.remove(object);\r\n\r\n      }\r\n\r\n      object.parent = this;\r\n      object.dispatchEvent({\r\n        type: 'added'\r\n      });\r\n\r\n      this.children.push(object);\r\n\r\n    }\r\n    else {\r\n\r\n      THREE.error(\"THREE.Object3D.add: object not an instance of THREE.Object3D.\", object);\r\n\r\n    }\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  remove: function(object) {\r\n\r\n    if (arguments.length > 1) {\r\n\r\n      for (var i = 0; i < arguments.length; i++) {\r\n\r\n        this.remove(arguments[i]);\r\n\r\n      }\r\n\r\n    };\r\n\r\n    var index = this.children.indexOf(object);\r\n\r\n    if (index !== -1) {\r\n\r\n      object.parent = undefined;\r\n\r\n      object.dispatchEvent({\r\n        type: 'removed'\r\n      });\r\n\r\n      this.children.splice(index, 1);\r\n\r\n    }\r\n\r\n  },\r\n\r\n  getChildByName: function(name) {\r\n\r\n    THREE.warn('THREE.Object3D: .getChildByName() has been renamed to .getObjectByName().');\r\n    return this.getObjectByName(name);\r\n\r\n  },\r\n\r\n  getObjectById: function(id) {\r\n\r\n    return this.getObjectByProperty('id', id);\r\n\r\n  },\r\n\r\n  getObjectByName: function(name) {\r\n\r\n    return this.getObjectByProperty('name', name);\r\n\r\n  },\r\n\r\n  getObjectByProperty: function(name, value) {\r\n\r\n    if (this[name] === value) return this;\r\n\r\n    for (var i = 0, l = this.children.length; i < l; i++) {\r\n\r\n      var child = this.children[i];\r\n      var object = child.getObjectByProperty(name, value);\r\n\r\n      if (object !== undefined) {\r\n\r\n        return object;\r\n\r\n      }\r\n\r\n    }\r\n\r\n    return undefined;\r\n\r\n  },\r\n\r\n  getWorldPosition: function(optionalTarget) {\r\n\r\n    var result = optionalTarget || new THREE.Vector3();\r\n\r\n    this.updateMatrixWorld(true);\r\n\r\n    return result.setFromMatrixPosition(this.matrixWorld);\r\n\r\n  },\r\n\r\n  getWorldQuaternion: function() {\r\n\r\n    var position = new THREE.Vector3();\r\n    var scale = new THREE.Vector3();\r\n\r\n    return function(optionalTarget) {\r\n\r\n      var result = optionalTarget || new THREE.Quaternion();\r\n\r\n      this.updateMatrixWorld(true);\r\n\r\n      this.matrixWorld.decompose(position, result, scale);\r\n\r\n      return result;\r\n\r\n    }\r\n\r\n  }(),\r\n\r\n  getWorldRotation: function() {\r\n\r\n    var quaternion = new THREE.Quaternion();\r\n\r\n    return function(optionalTarget) {\r\n\r\n      var result = optionalTarget || new THREE.Euler();\r\n\r\n      this.getWorldQuaternion(quaternion);\r\n\r\n      return result.setFromQuaternion(quaternion, this.rotation.order, false);\r\n\r\n    }\r\n\r\n  }(),\r\n\r\n  getWorldScale: function() {\r\n\r\n    var position = new THREE.Vector3();\r\n    var quaternion = new THREE.Quaternion();\r\n\r\n    return function(optionalTarget) {\r\n\r\n      var result = optionalTarget || new THREE.Vector3();\r\n\r\n      this.updateMatrixWorld(true);\r\n\r\n      this.matrixWorld.decompose(position, quaternion, result);\r\n\r\n      return result;\r\n\r\n    }\r\n\r\n  }(),\r\n\r\n  getWorldDirection: function() {\r\n\r\n    var quaternion = new THREE.Quaternion();\r\n\r\n    return function(optionalTarget) {\r\n\r\n      var result = optionalTarget || new THREE.Vector3();\r\n\r\n      this.getWorldQuaternion(quaternion);\r\n\r\n      return result.set(0, 0, 1).applyQuaternion(quaternion);\r\n\r\n    }\r\n\r\n  }(),\r\n\r\n  raycast: function() {},\r\n\r\n  traverse: function(callback) {\r\n\r\n    callback(this);\r\n\r\n    for (var i = 0, l = this.children.length; i < l; i++) {\r\n\r\n      this.children[i].traverse(callback);\r\n\r\n    }\r\n\r\n  },\r\n\r\n  traverseVisible: function(callback) {\r\n\r\n    if (this.visible === false) return;\r\n\r\n    callback(this);\r\n\r\n    for (var i = 0, l = this.children.length; i < l; i++) {\r\n\r\n      this.children[i].traverseVisible(callback);\r\n\r\n    }\r\n\r\n  },\r\n\r\n  traverseAncestors: function(callback) {\r\n\r\n    if (this.parent) {\r\n\r\n      callback(this.parent);\r\n\r\n      this.parent.traverseAncestors(callback);\r\n\r\n    }\r\n\r\n  },\r\n\r\n  updateMatrix: function() {\r\n\r\n    this.matrix.compose(this.position, this.quaternion, this.scale);\r\n\r\n    this.matrixWorldNeedsUpdate = true;\r\n\r\n  },\r\n\r\n  updateMatrixWorld: function(force) {\r\n\r\n    if (this.matrixAutoUpdate === true) this.updateMatrix();\r\n\r\n    if (this.matrixWorldNeedsUpdate === true || force === true) {\r\n\r\n      if (this.parent === undefined) {\r\n\r\n        this.matrixWorld.copy(this.matrix);\r\n\r\n      }\r\n      else {\r\n\r\n        this.matrixWorld.multiplyMatrices(this.parent.matrixWorld, this.matrix);\r\n\r\n      }\r\n\r\n      this.matrixWorldNeedsUpdate = false;\r\n\r\n      force = true;\r\n\r\n    }\r\n\r\n    // update children\r\n\r\n    for (var i = 0, l = this.children.length; i < l; i++) {\r\n\r\n      this.children[i].updateMatrixWorld(force);\r\n\r\n    }\r\n\r\n  },\r\n\r\n  toJSON: function() {\r\n\r\n    var output = {\r\n      metadata: {\r\n        version: 4.3,\r\n        type: 'Object',\r\n        generator: 'ObjectExporter'\r\n      }\r\n    };\r\n\r\n    //\r\n\r\n    var geometries = {};\r\n\r\n    var parseGeometry = function(geometry) {\r\n\r\n      if (output.geometries === undefined) {\r\n\r\n        output.geometries = [];\r\n\r\n      }\r\n\r\n      if (geometries[geometry.uuid] === undefined) {\r\n\r\n        var json = geometry.toJSON();\r\n\r\n        delete json.metadata;\r\n\r\n        geometries[geometry.uuid] = json;\r\n\r\n        output.geometries.push(json);\r\n\r\n      }\r\n\r\n      return geometry.uuid;\r\n\r\n    };\r\n\r\n    //\r\n\r\n    var materials = {};\r\n\r\n    var parseMaterial = function(material) {\r\n\r\n      if (output.materials === undefined) {\r\n\r\n        output.materials = [];\r\n\r\n      }\r\n\r\n      if (materials[material.uuid] === undefined) {\r\n\r\n        var json = material.toJSON();\r\n\r\n        delete json.metadata;\r\n\r\n        materials[material.uuid] = json;\r\n\r\n        output.materials.push(json);\r\n\r\n      }\r\n\r\n      return material.uuid;\r\n\r\n    };\r\n\r\n    //\r\n\r\n    var parseObject = function(object) {\r\n\r\n      var data = {};\r\n\r\n      data.uuid = object.uuid;\r\n      data.type = object.type;\r\n\r\n      if (object.name !== '') data.name = object.name;\r\n      if (JSON.stringify(object.userData) !== '{}') data.userData = object.userData;\r\n      if (object.visible !== true) data.visible = object.visible;\r\n\r\n      if (object instanceof THREE.PerspectiveCamera) {\r\n\r\n        data.fov = object.fov;\r\n        data.aspect = object.aspect;\r\n        data.near = object.near;\r\n        data.far = object.far;\r\n\r\n      }\r\n      else if (object instanceof THREE.OrthographicCamera) {\r\n\r\n        data.left = object.left;\r\n        data.right = object.right;\r\n        data.top = object.top;\r\n        data.bottom = object.bottom;\r\n        data.near = object.near;\r\n        data.far = object.far;\r\n\r\n      }\r\n      else if (object instanceof THREE.AmbientLight) {\r\n\r\n        data.color = object.color.getHex();\r\n\r\n      }\r\n      else if (object instanceof THREE.DirectionalLight) {\r\n\r\n        data.color = object.color.getHex();\r\n        data.intensity = object.intensity;\r\n\r\n      }\r\n      else if (object instanceof THREE.PointLight) {\r\n\r\n        data.color = object.color.getHex();\r\n        data.intensity = object.intensity;\r\n        data.distance = object.distance;\r\n        data.decay = object.decay;\r\n\r\n      }\r\n      else if (object instanceof THREE.SpotLight) {\r\n\r\n        data.color = object.color.getHex();\r\n        data.intensity = object.intensity;\r\n        data.distance = object.distance;\r\n        data.angle = object.angle;\r\n        data.exponent = object.exponent;\r\n        data.decay = object.decay;\r\n\r\n      }\r\n      else if (object instanceof THREE.HemisphereLight) {\r\n\r\n        data.color = object.color.getHex();\r\n        data.groundColor = object.groundColor.getHex();\r\n\r\n      }\r\n      else if (object instanceof THREE.Mesh || object instanceof THREE.Line || object instanceof THREE.PointCloud) {\r\n\r\n        data.geometry = parseGeometry(object.geometry);\r\n        data.material = parseMaterial(object.material);\r\n\r\n        if (object instanceof THREE.Line) data.mode = object.mode;\r\n\r\n      }\r\n      else if (object instanceof THREE.Sprite) {\r\n\r\n        data.material = parseMaterial(object.material);\r\n\r\n      }\r\n\r\n      data.matrix = object.matrix.toArray();\r\n\r\n      if (object.children.length > 0) {\r\n\r\n        data.children = [];\r\n\r\n        for (var i = 0; i < object.children.length; i++) {\r\n\r\n          data.children.push(parseObject(object.children[i]));\r\n\r\n        }\r\n\r\n      }\r\n\r\n      return data;\r\n\r\n    }\r\n\r\n    output.object = parseObject(this);\r\n\r\n    return output;\r\n\r\n  },\r\n\r\n  clone: function(object, recursive) {\r\n\r\n    if (object === undefined) object = new THREE.Object3D();\r\n    if (recursive === undefined) recursive = true;\r\n\r\n    object.name = this.name;\r\n\r\n    object.up.copy(this.up);\r\n\r\n    object.position.copy(this.position);\r\n    object.quaternion.copy(this.quaternion);\r\n    object.scale.copy(this.scale);\r\n\r\n    object.rotationAutoUpdate = this.rotationAutoUpdate;\r\n\r\n    object.matrix.copy(this.matrix);\r\n    object.matrixWorld.copy(this.matrixWorld);\r\n\r\n    object.matrixAutoUpdate = this.matrixAutoUpdate;\r\n    object.matrixWorldNeedsUpdate = this.matrixWorldNeedsUpdate;\r\n\r\n    object.visible = this.visible;\r\n\r\n    object.castShadow = this.castShadow;\r\n    object.receiveShadow = this.receiveShadow;\r\n\r\n    object.frustumCulled = this.frustumCulled;\r\n\r\n    object.userData = JSON.parse(JSON.stringify(this.userData));\r\n\r\n    if (recursive === true) {\r\n\r\n      for (var i = 0; i < this.children.length; i++) {\r\n\r\n        var child = this.children[i];\r\n        object.add(child.clone());\r\n\r\n      }\r\n\r\n    }\r\n\r\n    return object;\r\n\r\n  }\r\n\r\n};\r\n\r\nTHREE.EventDispatcher.prototype.apply(THREE.Object3D.prototype);\r\n\r\nTHREE.Object3DIdCount = 0;\r\n\r\n// File:src/core/Face3.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author alteredq / http://alteredqualia.com/\r\n */\r\n\r\nTHREE.Face3 = function(a, b, c, normal, color, materialIndex) {\r\n\r\n  this.a = a;\r\n  this.b = b;\r\n  this.c = c;\r\n\r\n  this.normal = normal instanceof THREE.Vector3 ? normal : new THREE.Vector3();\r\n  this.vertexNormals = normal instanceof Array ? normal : [];\r\n\r\n  this.color = color instanceof THREE.Color ? color : new THREE.Color();\r\n  this.vertexColors = color instanceof Array ? color : [];\r\n\r\n  this.vertexTangents = [];\r\n\r\n  this.materialIndex = materialIndex !== undefined ? materialIndex : 0;\r\n\r\n};\r\n\r\nTHREE.Face3.prototype = {\r\n\r\n  constructor: THREE.Face3,\r\n\r\n  clone: function() {\r\n\r\n    var face = new THREE.Face3(this.a, this.b, this.c);\r\n\r\n    face.normal.copy(this.normal);\r\n    face.color.copy(this.color);\r\n\r\n    face.materialIndex = this.materialIndex;\r\n\r\n    for (var i = 0, il = this.vertexNormals.length; i < il; i++) {\r\n\r\n      face.vertexNormals[i] = this.vertexNormals[i].clone();\r\n\r\n    }\r\n\r\n    for (var i = 0, il = this.vertexColors.length; i < il; i++) {\r\n\r\n      face.vertexColors[i] = this.vertexColors[i].clone();\r\n\r\n    }\r\n\r\n    for (var i = 0, il = this.vertexTangents.length; i < il; i++) {\r\n\r\n      face.vertexTangents[i] = this.vertexTangents[i].clone();\r\n\r\n    }\r\n\r\n    return face;\r\n\r\n  }\r\n\r\n};\r\n\r\n// File:src/core/Face4.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.Face4 = function(a, b, c, d, normal, color, materialIndex) {\r\n\r\n  THREE.warn('THREE.Face4 has been removed. A THREE.Face3 will be created instead.')\r\n  return new THREE.Face3(a, b, c, normal, color, materialIndex);\r\n\r\n};\r\n\r\n// File:src/core/BufferAttribute.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.BufferAttribute = function(array, itemSize) {\r\n\r\n  this.array = array;\r\n  this.itemSize = itemSize;\r\n\r\n  this.needsUpdate = false;\r\n\r\n};\r\n\r\nTHREE.BufferAttribute.prototype = {\r\n\r\n  constructor: THREE.BufferAttribute,\r\n\r\n  get length() {\r\n\r\n    return this.array.length;\r\n\r\n  },\r\n\r\n  copyAt: function(index1, attribute, index2) {\r\n\r\n    index1 *= this.itemSize;\r\n    index2 *= attribute.itemSize;\r\n\r\n    for (var i = 0, l = this.itemSize; i < l; i++) {\r\n\r\n      this.array[index1 + i] = attribute.array[index2 + i];\r\n\r\n    }\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  set: function(value, offset) {\r\n\r\n    if (offset === undefined) offset = 0;\r\n\r\n    this.array.set(value, offset);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  setX: function(index, x) {\r\n\r\n    this.array[index * this.itemSize] = x;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  setY: function(index, y) {\r\n\r\n    this.array[index * this.itemSize + 1] = y;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  setZ: function(index, z) {\r\n\r\n    this.array[index * this.itemSize + 2] = z;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  setXY: function(index, x, y) {\r\n\r\n    index *= this.itemSize;\r\n\r\n    this.array[index] = x;\r\n    this.array[index + 1] = y;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  setXYZ: function(index, x, y, z) {\r\n\r\n    index *= this.itemSize;\r\n\r\n    this.array[index] = x;\r\n    this.array[index + 1] = y;\r\n    this.array[index + 2] = z;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  setXYZW: function(index, x, y, z, w) {\r\n\r\n    index *= this.itemSize;\r\n\r\n    this.array[index] = x;\r\n    this.array[index + 1] = y;\r\n    this.array[index + 2] = z;\r\n    this.array[index + 3] = w;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  clone: function() {\r\n\r\n    return new THREE.BufferAttribute(new this.array.constructor(this.array), this.itemSize);\r\n\r\n  }\r\n\r\n};\r\n\r\n//\r\n\r\nTHREE.Int8Attribute = function(data, itemSize) {\r\n\r\n  THREE.warn('THREE.Int8Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead.');\r\n  return new THREE.BufferAttribute(data, itemSize);\r\n\r\n};\r\n\r\nTHREE.Uint8Attribute = function(data, itemSize) {\r\n\r\n  THREE.warn('THREE.Uint8Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead.');\r\n  return new THREE.BufferAttribute(data, itemSize);\r\n\r\n};\r\n\r\nTHREE.Uint8ClampedAttribute = function(data, itemSize) {\r\n\r\n  THREE.warn('THREE.Uint8ClampedAttribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead.');\r\n  return new THREE.BufferAttribute(data, itemSize);\r\n\r\n\r\n};\r\n\r\nTHREE.Int16Attribute = function(data, itemSize) {\r\n\r\n  THREE.warn('THREE.Int16Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead.');\r\n  return new THREE.BufferAttribute(data, itemSize);\r\n\r\n};\r\n\r\nTHREE.Uint16Attribute = function(data, itemSize) {\r\n\r\n  THREE.warn('THREE.Uint16Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead.');\r\n  return new THREE.BufferAttribute(data, itemSize);\r\n\r\n};\r\n\r\nTHREE.Int32Attribute = function(data, itemSize) {\r\n\r\n  THREE.warn('THREE.Int32Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead.');\r\n  return new THREE.BufferAttribute(data, itemSize);\r\n\r\n};\r\n\r\nTHREE.Uint32Attribute = function(data, itemSize) {\r\n\r\n  THREE.warn('THREE.Uint32Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead.');\r\n  return new THREE.BufferAttribute(data, itemSize);\r\n\r\n};\r\n\r\nTHREE.Float32Attribute = function(data, itemSize) {\r\n\r\n  THREE.warn('THREE.Float32Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead.');\r\n  return new THREE.BufferAttribute(data, itemSize);\r\n\r\n};\r\n\r\nTHREE.Float64Attribute = function(data, itemSize) {\r\n\r\n  THREE.warn('THREE.Float64Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead.');\r\n  return new THREE.BufferAttribute(data, itemSize);\r\n\r\n};\r\n\r\n// File:src/core/DynamicBufferAttribute.js\r\n\r\n/**\r\n * @author benaadams / https://twitter.com/ben_a_adams\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.DynamicBufferAttribute = function(array, itemSize) {\r\n\r\n  THREE.BufferAttribute.call(this, array, itemSize);\r\n\r\n  this.updateRange = {\r\n    offset: 0,\r\n    count: -1\r\n  };\r\n\r\n};\r\n\r\nTHREE.DynamicBufferAttribute.prototype = Object.create(THREE.BufferAttribute.prototype);\r\nTHREE.DynamicBufferAttribute.prototype.constructor = THREE.DynamicBufferAttribute;\r\n\r\nTHREE.DynamicBufferAttribute.prototype.clone = function() {\r\n\r\n  return new THREE.DynamicBufferAttribute(new this.array.constructor(this.array), this.itemSize);\r\n\r\n};\r\n\r\n// File:src/core/BufferGeometry.js\r\n\r\n/**\r\n * @author alteredq / http://alteredqualia.com/\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.BufferGeometry = function() {\r\n\r\n  Object.defineProperty(this, 'id', {\r\n    value: THREE.GeometryIdCount++\r\n  });\r\n\r\n  this.uuid = THREE.Math.generateUUID();\r\n\r\n  this.name = '';\r\n  this.type = 'BufferGeometry';\r\n\r\n  this.attributes = {};\r\n  this.attributesKeys = [];\r\n\r\n  this.drawcalls = [];\r\n  this.offsets = this.drawcalls; // backwards compatibility\r\n\r\n  this.boundingBox = null;\r\n  this.boundingSphere = null;\r\n\r\n};\r\n\r\nTHREE.BufferGeometry.prototype = {\r\n\r\n  constructor: THREE.BufferGeometry,\r\n\r\n  addAttribute: function(name, attribute) {\r\n\r\n    if (attribute instanceof THREE.BufferAttribute === false) {\r\n\r\n      THREE.warn('THREE.BufferGeometry: .addAttribute() now expects ( name, attribute ).');\r\n\r\n      this.attributes[name] = {\r\n        array: arguments[1],\r\n        itemSize: arguments[2]\r\n      };\r\n\r\n      return;\r\n\r\n    }\r\n\r\n    this.attributes[name] = attribute;\r\n    this.attributesKeys = Object.keys(this.attributes);\r\n\r\n  },\r\n\r\n  getAttribute: function(name) {\r\n\r\n    return this.attributes[name];\r\n\r\n  },\r\n\r\n  addDrawCall: function(start, count, indexOffset) {\r\n\r\n    this.drawcalls.push({\r\n\r\n      start: start,\r\n      count: count,\r\n      index: indexOffset !== undefined ? indexOffset : 0\r\n\r\n    });\r\n\r\n  },\r\n\r\n  applyMatrix: function(matrix) {\r\n\r\n    var position = this.attributes.position;\r\n\r\n    if (position !== undefined) {\r\n\r\n      matrix.applyToVector3Array(position.array);\r\n      position.needsUpdate = true;\r\n\r\n    }\r\n\r\n    var normal = this.attributes.normal;\r\n\r\n    if (normal !== undefined) {\r\n\r\n      var normalMatrix = new THREE.Matrix3().getNormalMatrix(matrix);\r\n\r\n      normalMatrix.applyToVector3Array(normal.array);\r\n      normal.needsUpdate = true;\r\n\r\n    }\r\n\r\n    if (this.boundingBox !== null) {\r\n\r\n      this.computeBoundingBox();\r\n\r\n    }\r\n\r\n    if (this.boundingSphere !== null) {\r\n\r\n      this.computeBoundingSphere();\r\n\r\n    }\r\n\r\n  },\r\n\r\n  center: function() {\r\n\r\n    this.computeBoundingBox();\r\n\r\n    var offset = this.boundingBox.center().negate();\r\n\r\n    this.applyMatrix(new THREE.Matrix4().setPosition(offset));\r\n\r\n    return offset;\r\n\r\n  },\r\n\r\n  fromGeometry: function(geometry, settings) {\r\n\r\n    settings = settings || {\r\n      'vertexColors': THREE.NoColors\r\n    };\r\n\r\n    var vertices = geometry.vertices;\r\n    var faces = geometry.faces;\r\n    var faceVertexUvs = geometry.faceVertexUvs;\r\n    var vertexColors = settings.vertexColors;\r\n    var hasFaceVertexUv = faceVertexUvs[0].length > 0;\r\n    var hasFaceVertexNormals = faces[0].vertexNormals.length == 3;\r\n\r\n    var positions = new Float32Array(faces.length * 3 * 3);\r\n    this.addAttribute('position', new THREE.BufferAttribute(positions, 3));\r\n\r\n    var normals = new Float32Array(faces.length * 3 * 3);\r\n    this.addAttribute('normal', new THREE.BufferAttribute(normals, 3));\r\n\r\n    if (vertexColors !== THREE.NoColors) {\r\n\r\n      var colors = new Float32Array(faces.length * 3 * 3);\r\n      this.addAttribute('color', new THREE.BufferAttribute(colors, 3));\r\n\r\n    }\r\n\r\n    if (hasFaceVertexUv === true) {\r\n\r\n      var uvs = new Float32Array(faces.length * 3 * 2);\r\n      this.addAttribute('uv', new THREE.BufferAttribute(uvs, 2));\r\n\r\n    }\r\n\r\n    for (var i = 0, i2 = 0, i3 = 0; i < faces.length; i++, i2 += 6, i3 += 9) {\r\n\r\n      var face = faces[i];\r\n\r\n      var a = vertices[face.a];\r\n      var b = vertices[face.b];\r\n      var c = vertices[face.c];\r\n\r\n      positions[i3] = a.x;\r\n      positions[i3 + 1] = a.y;\r\n      positions[i3 + 2] = a.z;\r\n\r\n      positions[i3 + 3] = b.x;\r\n      positions[i3 + 4] = b.y;\r\n      positions[i3 + 5] = b.z;\r\n\r\n      positions[i3 + 6] = c.x;\r\n      positions[i3 + 7] = c.y;\r\n      positions[i3 + 8] = c.z;\r\n\r\n      if (hasFaceVertexNormals === true) {\r\n\r\n        var na = face.vertexNormals[0];\r\n        var nb = face.vertexNormals[1];\r\n        var nc = face.vertexNormals[2];\r\n\r\n        normals[i3] = na.x;\r\n        normals[i3 + 1] = na.y;\r\n        normals[i3 + 2] = na.z;\r\n\r\n        normals[i3 + 3] = nb.x;\r\n        normals[i3 + 4] = nb.y;\r\n        normals[i3 + 5] = nb.z;\r\n\r\n        normals[i3 + 6] = nc.x;\r\n        normals[i3 + 7] = nc.y;\r\n        normals[i3 + 8] = nc.z;\r\n\r\n      }\r\n      else {\r\n\r\n        var n = face.normal;\r\n\r\n        normals[i3] = n.x;\r\n        normals[i3 + 1] = n.y;\r\n        normals[i3 + 2] = n.z;\r\n\r\n        normals[i3 + 3] = n.x;\r\n        normals[i3 + 4] = n.y;\r\n        normals[i3 + 5] = n.z;\r\n\r\n        normals[i3 + 6] = n.x;\r\n        normals[i3 + 7] = n.y;\r\n        normals[i3 + 8] = n.z;\r\n\r\n      }\r\n\r\n      if (vertexColors === THREE.FaceColors) {\r\n\r\n        var fc = face.color;\r\n\r\n        colors[i3] = fc.r;\r\n        colors[i3 + 1] = fc.g;\r\n        colors[i3 + 2] = fc.b;\r\n\r\n        colors[i3 + 3] = fc.r;\r\n        colors[i3 + 4] = fc.g;\r\n        colors[i3 + 5] = fc.b;\r\n\r\n        colors[i3 + 6] = fc.r;\r\n        colors[i3 + 7] = fc.g;\r\n        colors[i3 + 8] = fc.b;\r\n\r\n      }\r\n      else if (vertexColors === THREE.VertexColors) {\r\n\r\n        var vca = face.vertexColors[0];\r\n        var vcb = face.vertexColors[1];\r\n        var vcc = face.vertexColors[2];\r\n\r\n        colors[i3] = vca.r;\r\n        colors[i3 + 1] = vca.g;\r\n        colors[i3 + 2] = vca.b;\r\n\r\n        colors[i3 + 3] = vcb.r;\r\n        colors[i3 + 4] = vcb.g;\r\n        colors[i3 + 5] = vcb.b;\r\n\r\n        colors[i3 + 6] = vcc.r;\r\n        colors[i3 + 7] = vcc.g;\r\n        colors[i3 + 8] = vcc.b;\r\n\r\n      }\r\n\r\n      if (hasFaceVertexUv === true) {\r\n\r\n        var uva = faceVertexUvs[0][i][0];\r\n        var uvb = faceVertexUvs[0][i][1];\r\n        var uvc = faceVertexUvs[0][i][2];\r\n\r\n        uvs[i2] = uva.x;\r\n        uvs[i2 + 1] = uva.y;\r\n\r\n        uvs[i2 + 2] = uvb.x;\r\n        uvs[i2 + 3] = uvb.y;\r\n\r\n        uvs[i2 + 4] = uvc.x;\r\n        uvs[i2 + 5] = uvc.y;\r\n\r\n      }\r\n\r\n    }\r\n\r\n    this.computeBoundingSphere()\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  computeBoundingBox: function() {\r\n\r\n    var vector = new THREE.Vector3();\r\n\r\n    return function() {\r\n\r\n      if (this.boundingBox === null) {\r\n\r\n        this.boundingBox = new THREE.Box3();\r\n\r\n      }\r\n\r\n      var positions = this.attributes.position.array;\r\n\r\n      if (positions) {\r\n\r\n        var bb = this.boundingBox;\r\n        bb.makeEmpty();\r\n\r\n        for (var i = 0, il = positions.length; i < il; i += 3) {\r\n\r\n          vector.set(positions[i], positions[i + 1], positions[i + 2]);\r\n          bb.expandByPoint(vector);\r\n\r\n        }\r\n\r\n      }\r\n\r\n      if (positions === undefined || positions.length === 0) {\r\n\r\n        this.boundingBox.min.set(0, 0, 0);\r\n        this.boundingBox.max.set(0, 0, 0);\r\n\r\n      }\r\n\r\n      if (isNaN(this.boundingBox.min.x) || isNaN(this.boundingBox.min.y) || isNaN(this.boundingBox.min.z)) {\r\n\r\n        THREE.error('THREE.BufferGeometry.computeBoundingBox: Computed min/max have NaN values. The \"position\" attribute is likely to have NaN values.');\r\n\r\n      }\r\n\r\n    }\r\n\r\n  }(),\r\n\r\n  computeBoundingSphere: function() {\r\n\r\n    var box = new THREE.Box3();\r\n    var vector = new THREE.Vector3();\r\n\r\n    return function() {\r\n\r\n      if (this.boundingSphere === null) {\r\n\r\n        this.boundingSphere = new THREE.Sphere();\r\n\r\n      }\r\n\r\n      var positions = this.attributes.position.array;\r\n\r\n      if (positions) {\r\n\r\n        box.makeEmpty();\r\n\r\n        var center = this.boundingSphere.center;\r\n\r\n        for (var i = 0, il = positions.length; i < il; i += 3) {\r\n\r\n          vector.set(positions[i], positions[i + 1], positions[i + 2]);\r\n          box.expandByPoint(vector);\r\n\r\n        }\r\n\r\n        box.center(center);\r\n\r\n        // hoping to find a boundingSphere with a radius smaller than the\r\n        // boundingSphere of the boundingBox:  sqrt(3) smaller in the best case\r\n\r\n        var maxRadiusSq = 0;\r\n\r\n        for (var i = 0, il = positions.length; i < il; i += 3) {\r\n\r\n          vector.set(positions[i], positions[i + 1], positions[i + 2]);\r\n          maxRadiusSq = Math.max(maxRadiusSq, center.distanceToSquared(vector));\r\n\r\n        }\r\n\r\n        this.boundingSphere.radius = Math.sqrt(maxRadiusSq);\r\n\r\n        if (isNaN(this.boundingSphere.radius)) {\r\n\r\n          THREE.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The \"position\" attribute is likely to have NaN values.');\r\n\r\n        }\r\n\r\n      }\r\n\r\n    }\r\n\r\n  }(),\r\n\r\n  computeFaceNormals: function() {\r\n\r\n    // backwards compatibility\r\n\r\n  },\r\n\r\n  computeVertexNormals: function() {\r\n\r\n    var attributes = this.attributes;\r\n\r\n    if (attributes.position) {\r\n\r\n      var positions = attributes.position.array;\r\n\r\n      if (attributes.normal === undefined) {\r\n\r\n        this.addAttribute('normal', new THREE.BufferAttribute(new Float32Array(positions.length), 3));\r\n\r\n      }\r\n      else {\r\n\r\n        // reset existing normals to zero\r\n\r\n        var normals = attributes.normal.array;\r\n\r\n        for (var i = 0, il = normals.length; i < il; i++) {\r\n\r\n          normals[i] = 0;\r\n\r\n        }\r\n\r\n      }\r\n\r\n      var normals = attributes.normal.array;\r\n\r\n      var vA, vB, vC,\r\n\r\n        pA = new THREE.Vector3(),\r\n        pB = new THREE.Vector3(),\r\n        pC = new THREE.Vector3(),\r\n\r\n        cb = new THREE.Vector3(),\r\n        ab = new THREE.Vector3();\r\n\r\n      // indexed elements\r\n\r\n      if (attributes.index) {\r\n\r\n        var indices = attributes.index.array;\r\n\r\n        var offsets = (this.offsets.length > 0 ? this.offsets : [{\r\n          start: 0,\r\n          count: indices.length,\r\n          index: 0\r\n        }]);\r\n\r\n        for (var j = 0, jl = offsets.length; j < jl; ++j) {\r\n\r\n          var start = offsets[j].start;\r\n          var count = offsets[j].count;\r\n          var index = offsets[j].index;\r\n\r\n          for (var i = start, il = start + count; i < il; i += 3) {\r\n\r\n            vA = (index + indices[i]) * 3;\r\n            vB = (index + indices[i + 1]) * 3;\r\n            vC = (index + indices[i + 2]) * 3;\r\n\r\n            pA.fromArray(positions, vA);\r\n            pB.fromArray(positions, vB);\r\n            pC.fromArray(positions, vC);\r\n\r\n            cb.subVectors(pC, pB);\r\n            ab.subVectors(pA, pB);\r\n            cb.cross(ab);\r\n\r\n            normals[vA] += cb.x;\r\n            normals[vA + 1] += cb.y;\r\n            normals[vA + 2] += cb.z;\r\n\r\n            normals[vB] += cb.x;\r\n            normals[vB + 1] += cb.y;\r\n            normals[vB + 2] += cb.z;\r\n\r\n            normals[vC] += cb.x;\r\n            normals[vC + 1] += cb.y;\r\n            normals[vC + 2] += cb.z;\r\n\r\n          }\r\n\r\n        }\r\n\r\n      }\r\n      else {\r\n\r\n        // non-indexed elements (unconnected triangle soup)\r\n\r\n        for (var i = 0, il = positions.length; i < il; i += 9) {\r\n\r\n          pA.fromArray(positions, i);\r\n          pB.fromArray(positions, i + 3);\r\n          pC.fromArray(positions, i + 6);\r\n\r\n          cb.subVectors(pC, pB);\r\n          ab.subVectors(pA, pB);\r\n          cb.cross(ab);\r\n\r\n          normals[i] = cb.x;\r\n          normals[i + 1] = cb.y;\r\n          normals[i + 2] = cb.z;\r\n\r\n          normals[i + 3] = cb.x;\r\n          normals[i + 4] = cb.y;\r\n          normals[i + 5] = cb.z;\r\n\r\n          normals[i + 6] = cb.x;\r\n          normals[i + 7] = cb.y;\r\n          normals[i + 8] = cb.z;\r\n\r\n        }\r\n\r\n      }\r\n\r\n      this.normalizeNormals();\r\n\r\n      attributes.normal.needsUpdate = true;\r\n\r\n    }\r\n\r\n  },\r\n\r\n  computeTangents: function() {\r\n\r\n    // based on http://www.terathon.com/code/tangent.html\r\n    // (per vertex tangents)\r\n\r\n    if (this.attributes.index === undefined ||\r\n      this.attributes.position === undefined ||\r\n      this.attributes.normal === undefined ||\r\n      this.attributes.uv === undefined) {\r\n\r\n      THREE.warn('THREE.BufferGeometry: Missing required attributes (index, position, normal or uv) in BufferGeometry.computeTangents()');\r\n      return;\r\n\r\n    }\r\n\r\n    var indices = this.attributes.index.array;\r\n    var positions = this.attributes.position.array;\r\n    var normals = this.attributes.normal.array;\r\n    var uvs = this.attributes.uv.array;\r\n\r\n    var nVertices = positions.length / 3;\r\n\r\n    if (this.attributes.tangent === undefined) {\r\n\r\n      this.addAttribute('tangent', new THREE.BufferAttribute(new Float32Array(4 * nVertices), 4));\r\n\r\n    }\r\n\r\n    var tangents = this.attributes.tangent.array;\r\n\r\n    var tan1 = [],\r\n      tan2 = [];\r\n\r\n    for (var k = 0; k < nVertices; k++) {\r\n\r\n      tan1[k] = new THREE.Vector3();\r\n      tan2[k] = new THREE.Vector3();\r\n\r\n    }\r\n\r\n    var vA = new THREE.Vector3(),\r\n      vB = new THREE.Vector3(),\r\n      vC = new THREE.Vector3(),\r\n\r\n      uvA = new THREE.Vector2(),\r\n      uvB = new THREE.Vector2(),\r\n      uvC = new THREE.Vector2(),\r\n\r\n      x1, x2, y1, y2, z1, z2,\r\n      s1, s2, t1, t2, r;\r\n\r\n    var sdir = new THREE.Vector3(),\r\n      tdir = new THREE.Vector3();\r\n\r\n    function handleTriangle(a, b, c) {\r\n\r\n      vA.fromArray(positions, a * 3);\r\n      vB.fromArray(positions, b * 3);\r\n      vC.fromArray(positions, c * 3);\r\n\r\n      uvA.fromArray(uvs, a * 2);\r\n      uvB.fromArray(uvs, b * 2);\r\n      uvC.fromArray(uvs, c * 2);\r\n\r\n      x1 = vB.x - vA.x;\r\n      x2 = vC.x - vA.x;\r\n\r\n      y1 = vB.y - vA.y;\r\n      y2 = vC.y - vA.y;\r\n\r\n      z1 = vB.z - vA.z;\r\n      z2 = vC.z - vA.z;\r\n\r\n      s1 = uvB.x - uvA.x;\r\n      s2 = uvC.x - uvA.x;\r\n\r\n      t1 = uvB.y - uvA.y;\r\n      t2 = uvC.y - uvA.y;\r\n\r\n      r = 1.0 / (s1 * t2 - s2 * t1);\r\n\r\n      sdir.set(\r\n        (t2 * x1 - t1 * x2) * r, (t2 * y1 - t1 * y2) * r, (t2 * z1 - t1 * z2) * r\r\n      );\r\n\r\n      tdir.set(\r\n        (s1 * x2 - s2 * x1) * r, (s1 * y2 - s2 * y1) * r, (s1 * z2 - s2 * z1) * r\r\n      );\r\n\r\n      tan1[a].add(sdir);\r\n      tan1[b].add(sdir);\r\n      tan1[c].add(sdir);\r\n\r\n      tan2[a].add(tdir);\r\n      tan2[b].add(tdir);\r\n      tan2[c].add(tdir);\r\n\r\n    }\r\n\r\n    var i, il;\r\n    var j, jl;\r\n    var iA, iB, iC;\r\n\r\n    if (this.drawcalls.length === 0) {\r\n\r\n      this.addDrawCall(0, indices.length, 0);\r\n\r\n    }\r\n\r\n    var drawcalls = this.drawcalls;\r\n\r\n    for (j = 0, jl = drawcalls.length; j < jl; ++j) {\r\n\r\n      var start = drawcalls[j].start;\r\n      var count = drawcalls[j].count;\r\n      var index = drawcalls[j].index;\r\n\r\n      for (i = start, il = start + count; i < il; i += 3) {\r\n\r\n        iA = index + indices[i];\r\n        iB = index + indices[i + 1];\r\n        iC = index + indices[i + 2];\r\n\r\n        handleTriangle(iA, iB, iC);\r\n\r\n      }\r\n\r\n    }\r\n\r\n    var tmp = new THREE.Vector3(),\r\n      tmp2 = new THREE.Vector3();\r\n    var n = new THREE.Vector3(),\r\n      n2 = new THREE.Vector3();\r\n    var w, t, test;\r\n\r\n    function handleVertex(v) {\r\n\r\n      n.fromArray(normals, v * 3);\r\n      n2.copy(n);\r\n\r\n      t = tan1[v];\r\n\r\n      // Gram-Schmidt orthogonalize\r\n\r\n      tmp.copy(t);\r\n      tmp.sub(n.multiplyScalar(n.dot(t))).normalize();\r\n\r\n      // Calculate handedness\r\n\r\n      tmp2.crossVectors(n2, t);\r\n      test = tmp2.dot(tan2[v]);\r\n      w = (test < 0.0) ? -1.0 : 1.0;\r\n\r\n      tangents[v * 4] = tmp.x;\r\n      tangents[v * 4 + 1] = tmp.y;\r\n      tangents[v * 4 + 2] = tmp.z;\r\n      tangents[v * 4 + 3] = w;\r\n\r\n    }\r\n\r\n    for (j = 0, jl = drawcalls.length; j < jl; ++j) {\r\n\r\n      var start = drawcalls[j].start;\r\n      var count = drawcalls[j].count;\r\n      var index = drawcalls[j].index;\r\n\r\n      for (i = start, il = start + count; i < il; i += 3) {\r\n\r\n        iA = index + indices[i];\r\n        iB = index + indices[i + 1];\r\n        iC = index + indices[i + 2];\r\n\r\n        handleVertex(iA);\r\n        handleVertex(iB);\r\n        handleVertex(iC);\r\n\r\n      }\r\n\r\n    }\r\n\r\n  },\r\n\r\n  /*\r\n  Compute the draw offset for large models by chunking the index buffer into chunks of 65k addressable vertices.\r\n  This method will effectively rewrite the index buffer and remap all attributes to match the new indices.\r\n  WARNING: This method will also expand the vertex count to prevent sprawled triangles across draw offsets.\r\n  size - Defaults to 65535, but allows for larger or smaller chunks.\r\n  */\r\n  computeOffsets: function(size) {\r\n\r\n    if (size === undefined) size = 65535; // WebGL limits type of index buffer values to 16-bit.\r\n\r\n    var indices = this.attributes.index.array;\r\n    var vertices = this.attributes.position.array;\r\n\r\n    var facesCount = (indices.length / 3);\r\n\r\n    /*\r\n    console.log(\"Computing buffers in offsets of \"+size+\" -> indices:\"+indices.length+\" vertices:\"+vertices.length);\r\n    console.log(\"Faces to process: \"+(indices.length/3));\r\n    console.log(\"Reordering \"+verticesCount+\" vertices.\");\r\n    */\r\n\r\n    var sortedIndices = new Uint16Array(indices.length); //16-bit buffers\r\n    var indexPtr = 0;\r\n    var vertexPtr = 0;\r\n\r\n    var offsets = [{\r\n      start: 0,\r\n      count: 0,\r\n      index: 0\r\n    }];\r\n    var offset = offsets[0];\r\n\r\n    var duplicatedVertices = 0;\r\n    var newVerticeMaps = 0;\r\n    var faceVertices = new Int32Array(6);\r\n    var vertexMap = new Int32Array(vertices.length);\r\n    var revVertexMap = new Int32Array(vertices.length);\r\n    for (var j = 0; j < vertices.length; j++) {\r\n      vertexMap[j] = -1;\r\n      revVertexMap[j] = -1;\r\n    }\r\n\r\n    /*\r\n    \tTraverse every face and reorder vertices in the proper offsets of 65k.\r\n    \tWe can have more than 65k entries in the index buffer per offset, but only reference 65k values.\r\n    */\r\n    for (var findex = 0; findex < facesCount; findex++) {\r\n      newVerticeMaps = 0;\r\n\r\n      for (var vo = 0; vo < 3; vo++) {\r\n        var vid = indices[findex * 3 + vo];\r\n        if (vertexMap[vid] == -1) {\r\n          //Unmapped vertice\r\n          faceVertices[vo * 2] = vid;\r\n          faceVertices[vo * 2 + 1] = -1;\r\n          newVerticeMaps++;\r\n        }\r\n        else if (vertexMap[vid] < offset.index) {\r\n          //Reused vertices from previous block (duplicate)\r\n          faceVertices[vo * 2] = vid;\r\n          faceVertices[vo * 2 + 1] = -1;\r\n          duplicatedVertices++;\r\n        }\r\n        else {\r\n          //Reused vertice in the current block\r\n          faceVertices[vo * 2] = vid;\r\n          faceVertices[vo * 2 + 1] = vertexMap[vid];\r\n        }\r\n      }\r\n\r\n      var faceMax = vertexPtr + newVerticeMaps;\r\n      if (faceMax > (offset.index + size)) {\r\n        var new_offset = {\r\n          start: indexPtr,\r\n          count: 0,\r\n          index: vertexPtr\r\n        };\r\n        offsets.push(new_offset);\r\n        offset = new_offset;\r\n\r\n        //Re-evaluate reused vertices in light of new offset.\r\n        for (var v = 0; v < 6; v += 2) {\r\n          var new_vid = faceVertices[v + 1];\r\n          if (new_vid > -1 && new_vid < offset.index)\r\n            faceVertices[v + 1] = -1;\r\n        }\r\n      }\r\n\r\n      //Reindex the face.\r\n      for (var v = 0; v < 6; v += 2) {\r\n        var vid = faceVertices[v];\r\n        var new_vid = faceVertices[v + 1];\r\n\r\n        if (new_vid === -1)\r\n          new_vid = vertexPtr++;\r\n\r\n        vertexMap[vid] = new_vid;\r\n        revVertexMap[new_vid] = vid;\r\n        sortedIndices[indexPtr++] = new_vid - offset.index; //XXX overflows at 16bit\r\n        offset.count++;\r\n      }\r\n    }\r\n\r\n    /* Move all attribute values to map to the new computed indices , also expand the vertice stack to match our new vertexPtr. */\r\n    this.reorderBuffers(sortedIndices, revVertexMap, vertexPtr);\r\n    this.offsets = offsets; // TODO: Deprecate\r\n    this.drawcalls = offsets;\r\n\r\n    /*\r\n    var orderTime = Date.now();\r\n    console.log(\"Reorder time: \"+(orderTime-s)+\"ms\");\r\n    console.log(\"Duplicated \"+duplicatedVertices+\" vertices.\");\r\n    console.log(\"Compute Buffers time: \"+(Date.now()-s)+\"ms\");\r\n    console.log(\"Draw offsets: \"+offsets.length);\r\n    */\r\n\r\n    return offsets;\r\n\r\n  },\r\n\r\n  merge: function(geometry, offset) {\r\n\r\n    if (geometry instanceof THREE.BufferGeometry === false) {\r\n\r\n      THREE.error('THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.', geometry);\r\n      return;\r\n\r\n    }\r\n\r\n    if (offset === undefined) offset = 0;\r\n\r\n    var attributes = this.attributes;\r\n\r\n    for (var key in attributes) {\r\n\r\n      if (geometry.attributes[key] === undefined) continue;\r\n\r\n      var attribute1 = attributes[key];\r\n      var attributeArray1 = attribute1.array;\r\n\r\n      var attribute2 = geometry.attributes[key];\r\n      var attributeArray2 = attribute2.array;\r\n\r\n      var attributeSize = attribute2.itemSize;\r\n\r\n      for (var i = 0, j = attributeSize * offset; i < attributeArray2.length; i++, j++) {\r\n\r\n        attributeArray1[j] = attributeArray2[i];\r\n\r\n      }\r\n\r\n    }\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  normalizeNormals: function() {\r\n\r\n    var normals = this.attributes.normal.array;\r\n\r\n    var x, y, z, n;\r\n\r\n    for (var i = 0, il = normals.length; i < il; i += 3) {\r\n\r\n      x = normals[i];\r\n      y = normals[i + 1];\r\n      z = normals[i + 2];\r\n\r\n      n = 1.0 / Math.sqrt(x * x + y * y + z * z);\r\n\r\n      normals[i] *= n;\r\n      normals[i + 1] *= n;\r\n      normals[i + 2] *= n;\r\n\r\n    }\r\n\r\n  },\r\n\r\n  /*\r\n  \treoderBuffers:\r\n  \tReorder attributes based on a new indexBuffer and indexMap.\r\n  \tindexBuffer - Uint16Array of the new ordered indices.\r\n  \tindexMap - Int32Array where the position is the new vertex ID and the value the old vertex ID for each vertex.\r\n  \tvertexCount - Amount of total vertices considered in this reordering (in case you want to grow the vertice stack).\r\n  */\r\n  reorderBuffers: function(indexBuffer, indexMap, vertexCount) {\r\n\r\n    /* Create a copy of all attributes for reordering. */\r\n    var sortedAttributes = {};\r\n    for (var attr in this.attributes) {\r\n      if (attr == 'index')\r\n        continue;\r\n      var sourceArray = this.attributes[attr].array;\r\n      sortedAttributes[attr] = new sourceArray.constructor(this.attributes[attr].itemSize * vertexCount);\r\n    }\r\n\r\n    /* Move attribute positions based on the new index map */\r\n    for (var new_vid = 0; new_vid < vertexCount; new_vid++) {\r\n      var vid = indexMap[new_vid];\r\n      for (var attr in this.attributes) {\r\n        if (attr == 'index')\r\n          continue;\r\n        var attrArray = this.attributes[attr].array;\r\n        var attrSize = this.attributes[attr].itemSize;\r\n        var sortedAttr = sortedAttributes[attr];\r\n        for (var k = 0; k < attrSize; k++)\r\n          sortedAttr[new_vid * attrSize + k] = attrArray[vid * attrSize + k];\r\n      }\r\n    }\r\n\r\n    /* Carry the new sorted buffers locally */\r\n    this.attributes['index'].array = indexBuffer;\r\n    for (var attr in this.attributes) {\r\n      if (attr == 'index')\r\n        continue;\r\n      this.attributes[attr].array = sortedAttributes[attr];\r\n      this.attributes[attr].numItems = this.attributes[attr].itemSize * vertexCount;\r\n    }\r\n  },\r\n\r\n  toJSON: function() {\r\n\r\n    var output = {\r\n      metadata: {\r\n        version: 4.0,\r\n        type: 'BufferGeometry',\r\n        generator: 'BufferGeometryExporter'\r\n      },\r\n      uuid: this.uuid,\r\n      type: this.type,\r\n      data: {\r\n        attributes: {}\r\n      }\r\n    };\r\n\r\n    var attributes = this.attributes;\r\n    var offsets = this.offsets;\r\n    var boundingSphere = this.boundingSphere;\r\n\r\n    for (var key in attributes) {\r\n\r\n      var attribute = attributes[key];\r\n\r\n      var array = Array.prototype.slice.call(attribute.array);\r\n\r\n      output.data.attributes[key] = {\r\n        itemSize: attribute.itemSize,\r\n        type: attribute.array.constructor.name,\r\n        array: array\r\n      }\r\n\r\n    }\r\n\r\n    if (offsets.length > 0) {\r\n\r\n      output.data.offsets = JSON.parse(JSON.stringify(offsets));\r\n\r\n    }\r\n\r\n    if (boundingSphere !== null) {\r\n\r\n      output.data.boundingSphere = {\r\n        center: boundingSphere.center.toArray(),\r\n        radius: boundingSphere.radius\r\n      }\r\n\r\n    }\r\n\r\n    return output;\r\n\r\n  },\r\n\r\n  clone: function() {\r\n\r\n    var geometry = new THREE.BufferGeometry();\r\n\r\n    for (var attr in this.attributes) {\r\n\r\n      var sourceAttr = this.attributes[attr];\r\n      geometry.addAttribute(attr, sourceAttr.clone());\r\n\r\n    }\r\n\r\n    for (var i = 0, il = this.offsets.length; i < il; i++) {\r\n\r\n      var offset = this.offsets[i];\r\n\r\n      geometry.offsets.push({\r\n\r\n        start: offset.start,\r\n        index: offset.index,\r\n        count: offset.count\r\n\r\n      });\r\n\r\n    }\r\n\r\n    return geometry;\r\n\r\n  },\r\n\r\n  dispose: function() {\r\n\r\n    this.dispatchEvent({\r\n      type: 'dispose'\r\n    });\r\n\r\n  }\r\n\r\n};\r\n\r\nTHREE.EventDispatcher.prototype.apply(THREE.BufferGeometry.prototype);\r\n\r\n// File:src/core/Geometry.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author kile / http://kile.stravaganza.org/\r\n * @author alteredq / http://alteredqualia.com/\r\n * @author mikael emtinger / http://gomo.se/\r\n * @author zz85 / http://www.lab4games.net/zz85/blog\r\n * @author bhouston / http://exocortex.com\r\n */\r\n\r\nTHREE.Geometry = function() {\r\n\r\n  Object.defineProperty(this, 'id', {\r\n    value: THREE.GeometryIdCount++\r\n  });\r\n\r\n  this.uuid = THREE.Math.generateUUID();\r\n\r\n  this.name = '';\r\n  this.type = 'Geometry';\r\n\r\n  this.vertices = [];\r\n  this.colors = []; // one-to-one vertex colors, used in Points and Line\r\n\r\n  this.faces = [];\r\n\r\n  this.faceVertexUvs = [\r\n    []\r\n  ];\r\n\r\n  this.morphTargets = [];\r\n  this.morphColors = [];\r\n  this.morphNormals = [];\r\n\r\n  this.skinWeights = [];\r\n  this.skinIndices = [];\r\n\r\n  this.lineDistances = [];\r\n\r\n  this.boundingBox = null;\r\n  this.boundingSphere = null;\r\n\r\n  this.hasTangents = false;\r\n\r\n  this.dynamic = true; // the intermediate typed arrays will be deleted when set to false\r\n\r\n  // update flags\r\n\r\n  this.verticesNeedUpdate = false;\r\n  this.elementsNeedUpdate = false;\r\n  this.uvsNeedUpdate = false;\r\n  this.normalsNeedUpdate = false;\r\n  this.tangentsNeedUpdate = false;\r\n  this.colorsNeedUpdate = false;\r\n  this.lineDistancesNeedUpdate = false;\r\n\r\n  this.groupsNeedUpdate = false;\r\n\r\n};\r\n\r\nTHREE.Geometry.prototype = {\r\n\r\n  constructor: THREE.Geometry,\r\n\r\n  applyMatrix: function(matrix) {\r\n\r\n    var normalMatrix = new THREE.Matrix3().getNormalMatrix(matrix);\r\n\r\n    for (var i = 0, il = this.vertices.length; i < il; i++) {\r\n\r\n      var vertex = this.vertices[i];\r\n      vertex.applyMatrix4(matrix);\r\n\r\n    }\r\n\r\n    for (var i = 0, il = this.faces.length; i < il; i++) {\r\n\r\n      var face = this.faces[i];\r\n      face.normal.applyMatrix3(normalMatrix).normalize();\r\n\r\n      for (var j = 0, jl = face.vertexNormals.length; j < jl; j++) {\r\n\r\n        face.vertexNormals[j].applyMatrix3(normalMatrix).normalize();\r\n\r\n      }\r\n\r\n    }\r\n\r\n    if (this.boundingBox !== null) {\r\n\r\n      this.computeBoundingBox();\r\n\r\n    }\r\n\r\n    if (this.boundingSphere !== null) {\r\n\r\n      this.computeBoundingSphere();\r\n\r\n    }\r\n\r\n    this.verticesNeedUpdate = true;\r\n    this.normalsNeedUpdate = true;\r\n\r\n  },\r\n\r\n  fromBufferGeometry: function(geometry) {\r\n\r\n    var scope = this;\r\n\r\n    var attributes = geometry.attributes;\r\n\r\n    var vertices = attributes.position.array;\r\n    var indices = attributes.index !== undefined ? attributes.index.array : undefined;\r\n    var normals = attributes.normal !== undefined ? attributes.normal.array : undefined;\r\n    var colors = attributes.color !== undefined ? attributes.color.array : undefined;\r\n    var uvs = attributes.uv !== undefined ? attributes.uv.array : undefined;\r\n\r\n    var tempNormals = [];\r\n    var tempUVs = [];\r\n\r\n    for (var i = 0, j = 0; i < vertices.length; i += 3, j += 2) {\r\n\r\n      scope.vertices.push(new THREE.Vector3(vertices[i], vertices[i + 1], vertices[i + 2]));\r\n\r\n      if (normals !== undefined) {\r\n\r\n        tempNormals.push(new THREE.Vector3(normals[i], normals[i + 1], normals[i + 2]));\r\n\r\n      }\r\n\r\n      if (colors !== undefined) {\r\n\r\n        scope.colors.push(new THREE.Color(colors[i], colors[i + 1], colors[i + 2]));\r\n\r\n      }\r\n\r\n      if (uvs !== undefined) {\r\n\r\n        tempUVs.push(new THREE.Vector2(uvs[j], uvs[j + 1]));\r\n\r\n      }\r\n\r\n    }\r\n\r\n    var addFace = function(a, b, c) {\r\n\r\n      var vertexNormals = normals !== undefined ? [tempNormals[a].clone(), tempNormals[b].clone(), tempNormals[c].clone()] : [];\r\n      var vertexColors = colors !== undefined ? [scope.colors[a].clone(), scope.colors[b].clone(), scope.colors[c].clone()] : [];\r\n\r\n      scope.faces.push(new THREE.Face3(a, b, c, vertexNormals, vertexColors));\r\n\r\n      if (uvs !== undefined) {\r\n\r\n        scope.faceVertexUvs[0].push([tempUVs[a].clone(), tempUVs[b].clone(), tempUVs[c].clone()]);\r\n\r\n      }\r\n\r\n    };\r\n\r\n    if (indices !== undefined) {\r\n\r\n      var drawcalls = geometry.drawcalls;\r\n\r\n      if (drawcalls.length > 0) {\r\n\r\n        for (var i = 0; i < drawcalls.length; i++) {\r\n\r\n          var drawcall = drawcalls[i];\r\n\r\n          var start = drawcall.start;\r\n          var count = drawcall.count;\r\n          var index = drawcall.index;\r\n\r\n          for (var j = start, jl = start + count; j < jl; j += 3) {\r\n\r\n            addFace(index + indices[j], index + indices[j + 1], index + indices[j + 2]);\r\n\r\n          }\r\n\r\n        }\r\n\r\n      }\r\n      else {\r\n\r\n        for (var i = 0; i < indices.length; i += 3) {\r\n\r\n          addFace(indices[i], indices[i + 1], indices[i + 2]);\r\n\r\n        }\r\n\r\n      }\r\n\r\n    }\r\n    else {\r\n\r\n      for (var i = 0; i < vertices.length / 3; i += 3) {\r\n\r\n        addFace(i, i + 1, i + 2);\r\n\r\n      }\r\n\r\n    }\r\n\r\n    this.computeFaceNormals();\r\n\r\n    if (geometry.boundingBox !== null) {\r\n\r\n      this.boundingBox = geometry.boundingBox.clone();\r\n\r\n    }\r\n\r\n    if (geometry.boundingSphere !== null) {\r\n\r\n      this.boundingSphere = geometry.boundingSphere.clone();\r\n\r\n    }\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  center: function() {\r\n\r\n    this.computeBoundingBox();\r\n\r\n    var offset = this.boundingBox.center().negate();\r\n\r\n    this.applyMatrix(new THREE.Matrix4().setPosition(offset));\r\n\r\n    return offset;\r\n\r\n  },\r\n\r\n  computeFaceNormals: function() {\r\n\r\n    var cb = new THREE.Vector3(),\r\n      ab = new THREE.Vector3();\r\n\r\n    for (var f = 0, fl = this.faces.length; f < fl; f++) {\r\n\r\n      var face = this.faces[f];\r\n\r\n      var vA = this.vertices[face.a];\r\n      var vB = this.vertices[face.b];\r\n      var vC = this.vertices[face.c];\r\n\r\n      cb.subVectors(vC, vB);\r\n      ab.subVectors(vA, vB);\r\n      cb.cross(ab);\r\n\r\n      cb.normalize();\r\n\r\n      face.normal.copy(cb);\r\n\r\n    }\r\n\r\n  },\r\n\r\n  computeVertexNormals: function(areaWeighted) {\r\n\r\n    var v, vl, f, fl, face, vertices;\r\n\r\n    vertices = new Array(this.vertices.length);\r\n\r\n    for (v = 0, vl = this.vertices.length; v < vl; v++) {\r\n\r\n      vertices[v] = new THREE.Vector3();\r\n\r\n    }\r\n\r\n    if (areaWeighted) {\r\n\r\n      // vertex normals weighted by triangle areas\r\n      // http://www.iquilezles.org/www/articles/normals/normals.htm\r\n\r\n      var vA, vB, vC;\r\n      var cb = new THREE.Vector3(),\r\n        ab = new THREE.Vector3();\r\n\r\n      for (f = 0, fl = this.faces.length; f < fl; f++) {\r\n\r\n        face = this.faces[f];\r\n\r\n        vA = this.vertices[face.a];\r\n        vB = this.vertices[face.b];\r\n        vC = this.vertices[face.c];\r\n\r\n        cb.subVectors(vC, vB);\r\n        ab.subVectors(vA, vB);\r\n        cb.cross(ab);\r\n\r\n        vertices[face.a].add(cb);\r\n        vertices[face.b].add(cb);\r\n        vertices[face.c].add(cb);\r\n\r\n      }\r\n\r\n    }\r\n    else {\r\n\r\n      for (f = 0, fl = this.faces.length; f < fl; f++) {\r\n\r\n        face = this.faces[f];\r\n\r\n        vertices[face.a].add(face.normal);\r\n        vertices[face.b].add(face.normal);\r\n        vertices[face.c].add(face.normal);\r\n\r\n      }\r\n\r\n    }\r\n\r\n    for (v = 0, vl = this.vertices.length; v < vl; v++) {\r\n\r\n      vertices[v].normalize();\r\n\r\n    }\r\n\r\n    for (f = 0, fl = this.faces.length; f < fl; f++) {\r\n\r\n      face = this.faces[f];\r\n\r\n      face.vertexNormals[0] = vertices[face.a].clone();\r\n      face.vertexNormals[1] = vertices[face.b].clone();\r\n      face.vertexNormals[2] = vertices[face.c].clone();\r\n\r\n    }\r\n\r\n  },\r\n\r\n  computeMorphNormals: function() {\r\n\r\n    var i, il, f, fl, face;\r\n\r\n    // save original normals\r\n    // - create temp variables on first access\r\n    //   otherwise just copy (for faster repeated calls)\r\n\r\n    for (f = 0, fl = this.faces.length; f < fl; f++) {\r\n\r\n      face = this.faces[f];\r\n\r\n      if (!face.__originalFaceNormal) {\r\n\r\n        face.__originalFaceNormal = face.normal.clone();\r\n\r\n      }\r\n      else {\r\n\r\n        face.__originalFaceNormal.copy(face.normal);\r\n\r\n      }\r\n\r\n      if (!face.__originalVertexNormals) face.__originalVertexNormals = [];\r\n\r\n      for (i = 0, il = face.vertexNormals.length; i < il; i++) {\r\n\r\n        if (!face.__originalVertexNormals[i]) {\r\n\r\n          face.__originalVertexNormals[i] = face.vertexNormals[i].clone();\r\n\r\n        }\r\n        else {\r\n\r\n          face.__originalVertexNormals[i].copy(face.vertexNormals[i]);\r\n\r\n        }\r\n\r\n      }\r\n\r\n    }\r\n\r\n    // use temp geometry to compute face and vertex normals for each morph\r\n\r\n    var tmpGeo = new THREE.Geometry();\r\n    tmpGeo.faces = this.faces;\r\n\r\n    for (i = 0, il = this.morphTargets.length; i < il; i++) {\r\n\r\n      // create on first access\r\n\r\n      if (!this.morphNormals[i]) {\r\n\r\n        this.morphNormals[i] = {};\r\n        this.morphNormals[i].faceNormals = [];\r\n        this.morphNormals[i].vertexNormals = [];\r\n\r\n        var dstNormalsFace = this.morphNormals[i].faceNormals;\r\n        var dstNormalsVertex = this.morphNormals[i].vertexNormals;\r\n\r\n        var faceNormal, vertexNormals;\r\n\r\n        for (f = 0, fl = this.faces.length; f < fl; f++) {\r\n\r\n          faceNormal = new THREE.Vector3();\r\n          vertexNormals = {\r\n            a: new THREE.Vector3(),\r\n            b: new THREE.Vector3(),\r\n            c: new THREE.Vector3()\r\n          };\r\n\r\n          dstNormalsFace.push(faceNormal);\r\n          dstNormalsVertex.push(vertexNormals);\r\n\r\n        }\r\n\r\n      }\r\n\r\n      var morphNormals = this.morphNormals[i];\r\n\r\n      // set vertices to morph target\r\n\r\n      tmpGeo.vertices = this.morphTargets[i].vertices;\r\n\r\n      // compute morph normals\r\n\r\n      tmpGeo.computeFaceNormals();\r\n      tmpGeo.computeVertexNormals();\r\n\r\n      // store morph normals\r\n\r\n      var faceNormal, vertexNormals;\r\n\r\n      for (f = 0, fl = this.faces.length; f < fl; f++) {\r\n\r\n        face = this.faces[f];\r\n\r\n        faceNormal = morphNormals.faceNormals[f];\r\n        vertexNormals = morphNormals.vertexNormals[f];\r\n\r\n        faceNormal.copy(face.normal);\r\n\r\n        vertexNormals.a.copy(face.vertexNormals[0]);\r\n        vertexNormals.b.copy(face.vertexNormals[1]);\r\n        vertexNormals.c.copy(face.vertexNormals[2]);\r\n\r\n      }\r\n\r\n    }\r\n\r\n    // restore original normals\r\n\r\n    for (f = 0, fl = this.faces.length; f < fl; f++) {\r\n\r\n      face = this.faces[f];\r\n\r\n      face.normal = face.__originalFaceNormal;\r\n      face.vertexNormals = face.__originalVertexNormals;\r\n\r\n    }\r\n\r\n  },\r\n\r\n  computeTangents: function() {\r\n\r\n    // based on http://www.terathon.com/code/tangent.html\r\n    // tangents go to vertices\r\n\r\n    var f, fl, v, vl, i, vertexIndex,\r\n      face, uv, vA, vB, vC, uvA, uvB, uvC,\r\n      x1, x2, y1, y2, z1, z2,\r\n      s1, s2, t1, t2, r, t, test,\r\n      tan1 = [],\r\n      tan2 = [],\r\n      sdir = new THREE.Vector3(),\r\n      tdir = new THREE.Vector3(),\r\n      tmp = new THREE.Vector3(),\r\n      tmp2 = new THREE.Vector3(),\r\n      n = new THREE.Vector3(),\r\n      w;\r\n\r\n    for (v = 0, vl = this.vertices.length; v < vl; v++) {\r\n\r\n      tan1[v] = new THREE.Vector3();\r\n      tan2[v] = new THREE.Vector3();\r\n\r\n    }\r\n\r\n    function handleTriangle(context, a, b, c, ua, ub, uc) {\r\n\r\n      vA = context.vertices[a];\r\n      vB = context.vertices[b];\r\n      vC = context.vertices[c];\r\n\r\n      uvA = uv[ua];\r\n      uvB = uv[ub];\r\n      uvC = uv[uc];\r\n\r\n      x1 = vB.x - vA.x;\r\n      x2 = vC.x - vA.x;\r\n      y1 = vB.y - vA.y;\r\n      y2 = vC.y - vA.y;\r\n      z1 = vB.z - vA.z;\r\n      z2 = vC.z - vA.z;\r\n\r\n      s1 = uvB.x - uvA.x;\r\n      s2 = uvC.x - uvA.x;\r\n      t1 = uvB.y - uvA.y;\r\n      t2 = uvC.y - uvA.y;\r\n\r\n      r = 1.0 / (s1 * t2 - s2 * t1);\r\n      sdir.set((t2 * x1 - t1 * x2) * r, (t2 * y1 - t1 * y2) * r, (t2 * z1 - t1 * z2) * r);\r\n      tdir.set((s1 * x2 - s2 * x1) * r, (s1 * y2 - s2 * y1) * r, (s1 * z2 - s2 * z1) * r);\r\n\r\n      tan1[a].add(sdir);\r\n      tan1[b].add(sdir);\r\n      tan1[c].add(sdir);\r\n\r\n      tan2[a].add(tdir);\r\n      tan2[b].add(tdir);\r\n      tan2[c].add(tdir);\r\n\r\n    }\r\n\r\n    for (f = 0, fl = this.faces.length; f < fl; f++) {\r\n\r\n      face = this.faces[f];\r\n      uv = this.faceVertexUvs[0][f]; // use UV layer 0 for tangents\r\n\r\n      handleTriangle(this, face.a, face.b, face.c, 0, 1, 2);\r\n\r\n    }\r\n\r\n    var faceIndex = ['a', 'b', 'c', 'd'];\r\n\r\n    for (f = 0, fl = this.faces.length; f < fl; f++) {\r\n\r\n      face = this.faces[f];\r\n\r\n      for (i = 0; i < Math.min(face.vertexNormals.length, 3); i++) {\r\n\r\n        n.copy(face.vertexNormals[i]);\r\n\r\n        vertexIndex = face[faceIndex[i]];\r\n\r\n        t = tan1[vertexIndex];\r\n\r\n        // Gram-Schmidt orthogonalize\r\n\r\n        tmp.copy(t);\r\n        tmp.sub(n.multiplyScalar(n.dot(t))).normalize();\r\n\r\n        // Calculate handedness\r\n\r\n        tmp2.crossVectors(face.vertexNormals[i], t);\r\n        test = tmp2.dot(tan2[vertexIndex]);\r\n        w = (test < 0.0) ? -1.0 : 1.0;\r\n\r\n        face.vertexTangents[i] = new THREE.Vector4(tmp.x, tmp.y, tmp.z, w);\r\n\r\n      }\r\n\r\n    }\r\n\r\n    this.hasTangents = true;\r\n\r\n  },\r\n\r\n  computeLineDistances: function() {\r\n\r\n    var d = 0;\r\n    var vertices = this.vertices;\r\n\r\n    for (var i = 0, il = vertices.length; i < il; i++) {\r\n\r\n      if (i > 0) {\r\n\r\n        d += vertices[i].distanceTo(vertices[i - 1]);\r\n\r\n      }\r\n\r\n      this.lineDistances[i] = d;\r\n\r\n    }\r\n\r\n  },\r\n\r\n  computeBoundingBox: function() {\r\n\r\n    if (this.boundingBox === null) {\r\n\r\n      this.boundingBox = new THREE.Box3();\r\n\r\n    }\r\n\r\n    this.boundingBox.setFromPoints(this.vertices);\r\n\r\n  },\r\n\r\n  computeBoundingSphere: function() {\r\n\r\n    if (this.boundingSphere === null) {\r\n\r\n      this.boundingSphere = new THREE.Sphere();\r\n\r\n    }\r\n\r\n    this.boundingSphere.setFromPoints(this.vertices);\r\n\r\n  },\r\n\r\n  merge: function(geometry, matrix, materialIndexOffset) {\r\n\r\n    if (geometry instanceof THREE.Geometry === false) {\r\n\r\n      THREE.error('THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.', geometry);\r\n      return;\r\n\r\n    }\r\n\r\n    var normalMatrix,\r\n      vertexOffset = this.vertices.length,\r\n      vertices1 = this.vertices,\r\n      vertices2 = geometry.vertices,\r\n      faces1 = this.faces,\r\n      faces2 = geometry.faces,\r\n      uvs1 = this.faceVertexUvs[0],\r\n      uvs2 = geometry.faceVertexUvs[0];\r\n\r\n    if (materialIndexOffset === undefined) materialIndexOffset = 0;\r\n\r\n    if (matrix !== undefined) {\r\n\r\n      normalMatrix = new THREE.Matrix3().getNormalMatrix(matrix);\r\n\r\n    }\r\n\r\n    // vertices\r\n\r\n    for (var i = 0, il = vertices2.length; i < il; i++) {\r\n\r\n      var vertex = vertices2[i];\r\n\r\n      var vertexCopy = vertex.clone();\r\n\r\n      if (matrix !== undefined) vertexCopy.applyMatrix4(matrix);\r\n\r\n      vertices1.push(vertexCopy);\r\n\r\n    }\r\n\r\n    // faces\r\n\r\n    for (i = 0, il = faces2.length; i < il; i++) {\r\n\r\n      var face = faces2[i],\r\n        faceCopy, normal, color,\r\n        faceVertexNormals = face.vertexNormals,\r\n        faceVertexColors = face.vertexColors;\r\n\r\n      faceCopy = new THREE.Face3(face.a + vertexOffset, face.b + vertexOffset, face.c + vertexOffset);\r\n      faceCopy.normal.copy(face.normal);\r\n\r\n      if (normalMatrix !== undefined) {\r\n\r\n        faceCopy.normal.applyMatrix3(normalMatrix).normalize();\r\n\r\n      }\r\n\r\n      for (var j = 0, jl = faceVertexNormals.length; j < jl; j++) {\r\n\r\n        normal = faceVertexNormals[j].clone();\r\n\r\n        if (normalMatrix !== undefined) {\r\n\r\n          normal.applyMatrix3(normalMatrix).normalize();\r\n\r\n        }\r\n\r\n        faceCopy.vertexNormals.push(normal);\r\n\r\n      }\r\n\r\n      faceCopy.color.copy(face.color);\r\n\r\n      for (var j = 0, jl = faceVertexColors.length; j < jl; j++) {\r\n\r\n        color = faceVertexColors[j];\r\n        faceCopy.vertexColors.push(color.clone());\r\n\r\n      }\r\n\r\n      faceCopy.materialIndex = face.materialIndex + materialIndexOffset;\r\n\r\n      faces1.push(faceCopy);\r\n\r\n    }\r\n\r\n    // uvs\r\n\r\n    for (i = 0, il = uvs2.length; i < il; i++) {\r\n\r\n      var uv = uvs2[i],\r\n        uvCopy = [];\r\n\r\n      if (uv === undefined) {\r\n\r\n        continue;\r\n\r\n      }\r\n\r\n      for (var j = 0, jl = uv.length; j < jl; j++) {\r\n\r\n        uvCopy.push(uv[j].clone());\r\n\r\n      }\r\n\r\n      uvs1.push(uvCopy);\r\n\r\n    }\r\n\r\n  },\r\n\r\n  mergeMesh: function(mesh) {\r\n\r\n    if (mesh instanceof THREE.Mesh === false) {\r\n\r\n      THREE.error('THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.', mesh);\r\n      return;\r\n\r\n    }\r\n\r\n    mesh.matrixAutoUpdate && mesh.updateMatrix();\r\n\r\n    this.merge(mesh.geometry, mesh.matrix);\r\n\r\n  },\r\n\r\n  /*\r\n   * Checks for duplicate vertices with hashmap.\r\n   * Duplicated vertices are removed\r\n   * and faces' vertices are updated.\r\n   */\r\n\r\n  mergeVertices: function() {\r\n\r\n    var verticesMap = {}; // Hashmap for looking up vertice by position coordinates (and making sure they are unique)\r\n    var unique = [],\r\n      changes = [];\r\n\r\n    var v, key;\r\n    var precisionPoints = 4; // number of decimal points, eg. 4 for epsilon of 0.0001\r\n    var precision = Math.pow(10, precisionPoints);\r\n    var i, il, face;\r\n    var indices, j, jl;\r\n\r\n    for (i = 0, il = this.vertices.length; i < il; i++) {\r\n\r\n      v = this.vertices[i];\r\n      key = Math.round(v.x * precision) + '_' + Math.round(v.y * precision) + '_' + Math.round(v.z * precision);\r\n\r\n      if (verticesMap[key] === undefined) {\r\n\r\n        verticesMap[key] = i;\r\n        unique.push(this.vertices[i]);\r\n        changes[i] = unique.length - 1;\r\n\r\n      }\r\n      else {\r\n\r\n        //console.log('Duplicate vertex found. ', i, ' could be using ', verticesMap[key]);\r\n        changes[i] = changes[verticesMap[key]];\r\n\r\n      }\r\n\r\n    };\r\n\r\n\r\n    // if faces are completely degenerate after merging vertices, we\r\n    // have to remove them from the geometry.\r\n    var faceIndicesToRemove = [];\r\n\r\n    for (i = 0, il = this.faces.length; i < il; i++) {\r\n\r\n      face = this.faces[i];\r\n\r\n      face.a = changes[face.a];\r\n      face.b = changes[face.b];\r\n      face.c = changes[face.c];\r\n\r\n      indices = [face.a, face.b, face.c];\r\n\r\n      var dupIndex = -1;\r\n\r\n      // if any duplicate vertices are found in a Face3\r\n      // we have to remove the face as nothing can be saved\r\n      for (var n = 0; n < 3; n++) {\r\n        if (indices[n] == indices[(n + 1) % 3]) {\r\n\r\n          dupIndex = n;\r\n          faceIndicesToRemove.push(i);\r\n          break;\r\n\r\n        }\r\n      }\r\n\r\n    }\r\n\r\n    for (i = faceIndicesToRemove.length - 1; i >= 0; i--) {\r\n      var idx = faceIndicesToRemove[i];\r\n\r\n      this.faces.splice(idx, 1);\r\n\r\n      for (j = 0, jl = this.faceVertexUvs.length; j < jl; j++) {\r\n\r\n        this.faceVertexUvs[j].splice(idx, 1);\r\n\r\n      }\r\n\r\n    }\r\n\r\n    // Use unique set of vertices\r\n\r\n    var diff = this.vertices.length - unique.length;\r\n    this.vertices = unique;\r\n    return diff;\r\n\r\n  },\r\n\r\n  toJSON: function() {\r\n\r\n    var output = {\r\n      metadata: {\r\n        version: 4.0,\r\n        type: 'BufferGeometry',\r\n        generator: 'BufferGeometryExporter'\r\n      },\r\n      uuid: this.uuid,\r\n      type: this.type\r\n    };\r\n\r\n    if (this.name !== \"\") output.name = this.name;\r\n\r\n    if (this.parameters !== undefined) {\r\n\r\n      var parameters = this.parameters;\r\n\r\n      for (var key in parameters) {\r\n\r\n        if (parameters[key] !== undefined) output[key] = parameters[key];\r\n\r\n      }\r\n\r\n      return output;\r\n\r\n    }\r\n\r\n    var vertices = [];\r\n\r\n    for (var i = 0; i < this.vertices.length; i++) {\r\n\r\n      var vertex = this.vertices[i];\r\n      vertices.push(vertex.x, vertex.y, vertex.z);\r\n\r\n    }\r\n\r\n    var faces = [];\r\n    var normals = [];\r\n    var normalsHash = {};\r\n    var colors = [];\r\n    var colorsHash = {};\r\n    var uvs = [];\r\n    var uvsHash = {};\r\n\r\n    for (var i = 0; i < this.faces.length; i++) {\r\n\r\n      var face = this.faces[i];\r\n\r\n      var hasMaterial = false; // face.materialIndex !== undefined;\r\n      var hasFaceUv = false; // deprecated\r\n      var hasFaceVertexUv = this.faceVertexUvs[0][i] !== undefined;\r\n      var hasFaceNormal = face.normal.length() > 0;\r\n      var hasFaceVertexNormal = face.vertexNormals.length > 0;\r\n      var hasFaceColor = face.color.r !== 1 || face.color.g !== 1 || face.color.b !== 1;\r\n      var hasFaceVertexColor = face.vertexColors.length > 0;\r\n\r\n      var faceType = 0;\r\n\r\n      faceType = setBit(faceType, 0, 0);\r\n      faceType = setBit(faceType, 1, hasMaterial);\r\n      faceType = setBit(faceType, 2, hasFaceUv);\r\n      faceType = setBit(faceType, 3, hasFaceVertexUv);\r\n      faceType = setBit(faceType, 4, hasFaceNormal);\r\n      faceType = setBit(faceType, 5, hasFaceVertexNormal);\r\n      faceType = setBit(faceType, 6, hasFaceColor);\r\n      faceType = setBit(faceType, 7, hasFaceVertexColor);\r\n\r\n      faces.push(faceType);\r\n      faces.push(face.a, face.b, face.c);\r\n\r\n\r\n      /*\r\n      if ( hasMaterial ) {\r\n\r\n      \tfaces.push( face.materialIndex );\r\n\r\n      }\r\n      */\r\n\r\n      if (hasFaceVertexUv) {\r\n\r\n        var faceVertexUvs = this.faceVertexUvs[0][i];\r\n\r\n        faces.push(\r\n          getUvIndex(faceVertexUvs[0]),\r\n          getUvIndex(faceVertexUvs[1]),\r\n          getUvIndex(faceVertexUvs[2])\r\n        );\r\n\r\n      }\r\n\r\n      if (hasFaceNormal) {\r\n\r\n        faces.push(getNormalIndex(face.normal));\r\n\r\n      }\r\n\r\n      if (hasFaceVertexNormal) {\r\n\r\n        var vertexNormals = face.vertexNormals;\r\n\r\n        faces.push(\r\n          getNormalIndex(vertexNormals[0]),\r\n          getNormalIndex(vertexNormals[1]),\r\n          getNormalIndex(vertexNormals[2])\r\n        );\r\n\r\n      }\r\n\r\n      if (hasFaceColor) {\r\n\r\n        faces.push(getColorIndex(face.color));\r\n\r\n      }\r\n\r\n      if (hasFaceVertexColor) {\r\n\r\n        var vertexColors = face.vertexColors;\r\n\r\n        faces.push(\r\n          getColorIndex(vertexColors[0]),\r\n          getColorIndex(vertexColors[1]),\r\n          getColorIndex(vertexColors[2])\r\n        );\r\n\r\n      }\r\n\r\n    }\r\n\r\n    function setBit(value, position, enabled) {\r\n\r\n      return enabled ? value | (1 << position) : value & (~(1 << position));\r\n\r\n    }\r\n\r\n    function getNormalIndex(normal) {\r\n\r\n      var hash = normal.x.toString() + normal.y.toString() + normal.z.toString();\r\n\r\n      if (normalsHash[hash] !== undefined) {\r\n\r\n        return normalsHash[hash];\r\n\r\n      }\r\n\r\n      normalsHash[hash] = normals.length / 3;\r\n      normals.push(normal.x, normal.y, normal.z);\r\n\r\n      return normalsHash[hash];\r\n\r\n    }\r\n\r\n    function getColorIndex(color) {\r\n\r\n      var hash = color.r.toString() + color.g.toString() + color.b.toString();\r\n\r\n      if (colorsHash[hash] !== undefined) {\r\n\r\n        return colorsHash[hash];\r\n\r\n      }\r\n\r\n      colorsHash[hash] = colors.length;\r\n      colors.push(color.getHex());\r\n\r\n      return colorsHash[hash];\r\n\r\n    }\r\n\r\n    function getUvIndex(uv) {\r\n\r\n      var hash = uv.x.toString() + uv.y.toString();\r\n\r\n      if (uvsHash[hash] !== undefined) {\r\n\r\n        return uvsHash[hash];\r\n\r\n      }\r\n\r\n      uvsHash[hash] = uvs.length / 2;\r\n      uvs.push(uv.x, uv.y);\r\n\r\n      return uvsHash[hash];\r\n\r\n    }\r\n\r\n    output.data = {};\r\n\r\n    output.data.vertices = vertices;\r\n    output.data.normals = normals;\r\n    if (colors.length > 0) output.data.colors = colors;\r\n    if (uvs.length > 0) output.data.uvs = [uvs]; // temporal backward compatibility\r\n    output.data.faces = faces;\r\n\r\n    //\r\n\r\n    return output;\r\n\r\n  },\r\n\r\n  clone: function() {\r\n\r\n    var geometry = new THREE.Geometry();\r\n\r\n    var vertices = this.vertices;\r\n\r\n    for (var i = 0, il = vertices.length; i < il; i++) {\r\n\r\n      geometry.vertices.push(vertices[i].clone());\r\n\r\n    }\r\n\r\n    var faces = this.faces;\r\n\r\n    for (var i = 0, il = faces.length; i < il; i++) {\r\n\r\n      geometry.faces.push(faces[i].clone());\r\n\r\n    }\r\n\r\n    for (var i = 0, il = this.faceVertexUvs.length; i < il; i++) {\r\n\r\n      var faceVertexUvs = this.faceVertexUvs[i];\r\n\r\n      if (geometry.faceVertexUvs[i] === undefined) {\r\n\r\n        geometry.faceVertexUvs[i] = [];\r\n\r\n      }\r\n\r\n      for (var j = 0, jl = faceVertexUvs.length; j < jl; j++) {\r\n\r\n        var uvs = faceVertexUvs[j],\r\n          uvsCopy = [];\r\n\r\n        for (var k = 0, kl = uvs.length; k < kl; k++) {\r\n\r\n          var uv = uvs[k];\r\n\r\n          uvsCopy.push(uv.clone());\r\n\r\n        }\r\n\r\n        geometry.faceVertexUvs[i].push(uvsCopy);\r\n\r\n      }\r\n\r\n    }\r\n\r\n    return geometry;\r\n\r\n  },\r\n\r\n  dispose: function() {\r\n\r\n    this.dispatchEvent({\r\n      type: 'dispose'\r\n    });\r\n\r\n  }\r\n\r\n};\r\n\r\nTHREE.EventDispatcher.prototype.apply(THREE.Geometry.prototype);\r\n\r\nTHREE.GeometryIdCount = 0;\r\n\r\n// File:src/cameras/Camera.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author mikael emtinger / http://gomo.se/\r\n * @author WestLangley / http://github.com/WestLangley\r\n */\r\n\r\nTHREE.Camera = function() {\r\n\r\n  THREE.Object3D.call(this);\r\n\r\n  this.type = 'Camera';\r\n\r\n  this.matrixWorldInverse = new THREE.Matrix4();\r\n  this.projectionMatrix = new THREE.Matrix4();\r\n\r\n};\r\n\r\nTHREE.Camera.prototype = Object.create(THREE.Object3D.prototype);\r\nTHREE.Camera.prototype.constructor = THREE.Camera;\r\n\r\nTHREE.Camera.prototype.getWorldDirection = function() {\r\n\r\n  var quaternion = new THREE.Quaternion();\r\n\r\n  return function(optionalTarget) {\r\n\r\n    var result = optionalTarget || new THREE.Vector3();\r\n\r\n    this.getWorldQuaternion(quaternion);\r\n\r\n    return result.set(0, 0, -1).applyQuaternion(quaternion);\r\n\r\n  }\r\n\r\n}();\r\n\r\nTHREE.Camera.prototype.lookAt = function() {\r\n\r\n  // This routine does not support cameras with rotated and/or translated parent(s)\r\n\r\n  var m1 = new THREE.Matrix4();\r\n\r\n  return function(vector) {\r\n\r\n    m1.lookAt(this.position, vector, this.up);\r\n\r\n    this.quaternion.setFromRotationMatrix(m1);\r\n\r\n  };\r\n\r\n}();\r\n\r\nTHREE.Camera.prototype.clone = function(camera) {\r\n\r\n  if (camera === undefined) camera = new THREE.Camera();\r\n\r\n  THREE.Object3D.prototype.clone.call(this, camera);\r\n\r\n  camera.matrixWorldInverse.copy(this.matrixWorldInverse);\r\n  camera.projectionMatrix.copy(this.projectionMatrix);\r\n\r\n  return camera;\r\n};\r\n\r\n// File:src/cameras/CubeCamera.js\r\n\r\n/**\r\n * Camera for rendering cube maps\r\n *\t- renders scene into axis-aligned cube\r\n *\r\n * @author alteredq / http://alteredqualia.com/\r\n */\r\n\r\nTHREE.CubeCamera = function(near, far, cubeResolution) {\r\n\r\n  THREE.Object3D.call(this);\r\n\r\n  this.type = 'CubeCamera';\r\n\r\n  var fov = 90,\r\n    aspect = 1;\r\n\r\n  var cameraPX = new THREE.PerspectiveCamera(fov, aspect, near, far);\r\n  cameraPX.up.set(0, -1, 0);\r\n  cameraPX.lookAt(new THREE.Vector3(1, 0, 0));\r\n  this.add(cameraPX);\r\n\r\n  var cameraNX = new THREE.PerspectiveCamera(fov, aspect, near, far);\r\n  cameraNX.up.set(0, -1, 0);\r\n  cameraNX.lookAt(new THREE.Vector3(-1, 0, 0));\r\n  this.add(cameraNX);\r\n\r\n  var cameraPY = new THREE.PerspectiveCamera(fov, aspect, near, far);\r\n  cameraPY.up.set(0, 0, 1);\r\n  cameraPY.lookAt(new THREE.Vector3(0, 1, 0));\r\n  this.add(cameraPY);\r\n\r\n  var cameraNY = new THREE.PerspectiveCamera(fov, aspect, near, far);\r\n  cameraNY.up.set(0, 0, -1);\r\n  cameraNY.lookAt(new THREE.Vector3(0, -1, 0));\r\n  this.add(cameraNY);\r\n\r\n  var cameraPZ = new THREE.PerspectiveCamera(fov, aspect, near, far);\r\n  cameraPZ.up.set(0, -1, 0);\r\n  cameraPZ.lookAt(new THREE.Vector3(0, 0, 1));\r\n  this.add(cameraPZ);\r\n\r\n  var cameraNZ = new THREE.PerspectiveCamera(fov, aspect, near, far);\r\n  cameraNZ.up.set(0, -1, 0);\r\n  cameraNZ.lookAt(new THREE.Vector3(0, 0, -1));\r\n  this.add(cameraNZ);\r\n\r\n  this.renderTarget = new THREE.WebGLRenderTargetCube(cubeResolution, cubeResolution, {\r\n    format: THREE.RGBFormat,\r\n    magFilter: THREE.LinearFilter,\r\n    minFilter: THREE.LinearFilter\r\n  });\r\n\r\n  this.updateCubeMap = function(renderer, scene) {\r\n\r\n    var renderTarget = this.renderTarget;\r\n    var generateMipmaps = renderTarget.generateMipmaps;\r\n\r\n    renderTarget.generateMipmaps = false;\r\n\r\n    renderTarget.activeCubeFace = 0;\r\n    renderer.render(scene, cameraPX, renderTarget);\r\n\r\n    renderTarget.activeCubeFace = 1;\r\n    renderer.render(scene, cameraNX, renderTarget);\r\n\r\n    renderTarget.activeCubeFace = 2;\r\n    renderer.render(scene, cameraPY, renderTarget);\r\n\r\n    renderTarget.activeCubeFace = 3;\r\n    renderer.render(scene, cameraNY, renderTarget);\r\n\r\n    renderTarget.activeCubeFace = 4;\r\n    renderer.render(scene, cameraPZ, renderTarget);\r\n\r\n    renderTarget.generateMipmaps = generateMipmaps;\r\n\r\n    renderTarget.activeCubeFace = 5;\r\n    renderer.render(scene, cameraNZ, renderTarget);\r\n\r\n  };\r\n\r\n};\r\n\r\nTHREE.CubeCamera.prototype = Object.create(THREE.Object3D.prototype);\r\nTHREE.CubeCamera.prototype.constructor = THREE.CubeCamera;\r\n\r\n// File:src/cameras/OrthographicCamera.js\r\n\r\n/**\r\n * @author alteredq / http://alteredqualia.com/\r\n */\r\n\r\nTHREE.OrthographicCamera = function(left, right, top, bottom, near, far) {\r\n\r\n  THREE.Camera.call(this);\r\n\r\n  this.type = 'OrthographicCamera';\r\n\r\n  this.zoom = 1;\r\n\r\n  this.left = left;\r\n  this.right = right;\r\n  this.top = top;\r\n  this.bottom = bottom;\r\n\r\n  this.near = (near !== undefined) ? near : 0.1;\r\n  this.far = (far !== undefined) ? far : 2000;\r\n\r\n  this.updateProjectionMatrix();\r\n\r\n};\r\n\r\nTHREE.OrthographicCamera.prototype = Object.create(THREE.Camera.prototype);\r\nTHREE.OrthographicCamera.prototype.constructor = THREE.OrthographicCamera;\r\n\r\nTHREE.OrthographicCamera.prototype.updateProjectionMatrix = function() {\r\n\r\n  var dx = (this.right - this.left) / (2 * this.zoom);\r\n  var dy = (this.top - this.bottom) / (2 * this.zoom);\r\n  var cx = (this.right + this.left) / 2;\r\n  var cy = (this.top + this.bottom) / 2;\r\n\r\n  this.projectionMatrix.makeOrthographic(cx - dx, cx + dx, cy + dy, cy - dy, this.near, this.far);\r\n\r\n};\r\n\r\nTHREE.OrthographicCamera.prototype.clone = function() {\r\n\r\n  var camera = new THREE.OrthographicCamera();\r\n\r\n  THREE.Camera.prototype.clone.call(this, camera);\r\n\r\n  camera.zoom = this.zoom;\r\n\r\n  camera.left = this.left;\r\n  camera.right = this.right;\r\n  camera.top = this.top;\r\n  camera.bottom = this.bottom;\r\n\r\n  camera.near = this.near;\r\n  camera.far = this.far;\r\n\r\n  camera.projectionMatrix.copy(this.projectionMatrix);\r\n\r\n  return camera;\r\n};\r\n\r\n// File:src/cameras/PerspectiveCamera.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author greggman / http://games.greggman.com/\r\n * @author zz85 / http://www.lab4games.net/zz85/blog\r\n */\r\n\r\nTHREE.PerspectiveCamera = function(fov, aspect, near, far) {\r\n\r\n  THREE.Camera.call(this);\r\n\r\n  this.type = 'PerspectiveCamera';\r\n\r\n  this.zoom = 1;\r\n\r\n  this.fov = fov !== undefined ? fov : 50;\r\n  this.aspect = aspect !== undefined ? aspect : 1;\r\n  this.near = near !== undefined ? near : 0.1;\r\n  this.far = far !== undefined ? far : 2000;\r\n\r\n  this.updateProjectionMatrix();\r\n\r\n};\r\n\r\nTHREE.PerspectiveCamera.prototype = Object.create(THREE.Camera.prototype);\r\nTHREE.PerspectiveCamera.prototype.constructor = THREE.PerspectiveCamera;\r\n\r\n\r\n/**\r\n * Uses Focal Length (in mm) to estimate and set FOV\r\n * 35mm (fullframe) camera is used if frame size is not specified;\r\n * Formula based on http://www.bobatkins.com/photography/technical/field_of_view.html\r\n */\r\n\r\nTHREE.PerspectiveCamera.prototype.setLens = function(focalLength, frameHeight) {\r\n\r\n  if (frameHeight === undefined) frameHeight = 24;\r\n\r\n  this.fov = 2 * THREE.Math.radToDeg(Math.atan(frameHeight / (focalLength * 2)));\r\n  this.updateProjectionMatrix();\r\n\r\n}\r\n\r\n\r\n/**\r\n * Sets an offset in a larger frustum. This is useful for multi-window or\r\n * multi-monitor/multi-machine setups.\r\n *\r\n * For example, if you have 3x2 monitors and each monitor is 1920x1080 and\r\n * the monitors are in grid like this\r\n *\r\n *   +---+---+---+\r\n *   | A | B | C |\r\n *   +---+---+---+\r\n *   | D | E | F |\r\n *   +---+---+---+\r\n *\r\n * then for each monitor you would call it like this\r\n *\r\n *   var w = 1920;\r\n *   var h = 1080;\r\n *   var fullWidth = w * 3;\r\n *   var fullHeight = h * 2;\r\n *\r\n *   --A--\r\n *   camera.setOffset( fullWidth, fullHeight, w * 0, h * 0, w, h );\r\n *   --B--\r\n *   camera.setOffset( fullWidth, fullHeight, w * 1, h * 0, w, h );\r\n *   --C--\r\n *   camera.setOffset( fullWidth, fullHeight, w * 2, h * 0, w, h );\r\n *   --D--\r\n *   camera.setOffset( fullWidth, fullHeight, w * 0, h * 1, w, h );\r\n *   --E--\r\n *   camera.setOffset( fullWidth, fullHeight, w * 1, h * 1, w, h );\r\n *   --F--\r\n *   camera.setOffset( fullWidth, fullHeight, w * 2, h * 1, w, h );\r\n *\r\n *   Note there is no reason monitors have to be the same size or in a grid.\r\n */\r\n\r\nTHREE.PerspectiveCamera.prototype.setViewOffset = function(fullWidth, fullHeight, x, y, width, height) {\r\n\r\n  this.fullWidth = fullWidth;\r\n  this.fullHeight = fullHeight;\r\n  this.x = x;\r\n  this.y = y;\r\n  this.width = width;\r\n  this.height = height;\r\n\r\n  this.updateProjectionMatrix();\r\n\r\n};\r\n\r\n\r\nTHREE.PerspectiveCamera.prototype.updateProjectionMatrix = function() {\r\n\r\n  var fov = THREE.Math.radToDeg(2 * Math.atan(Math.tan(THREE.Math.degToRad(this.fov) * 0.5) / this.zoom));\r\n\r\n  if (this.fullWidth) {\r\n\r\n    var aspect = this.fullWidth / this.fullHeight;\r\n    var top = Math.tan(THREE.Math.degToRad(fov * 0.5)) * this.near;\r\n    var bottom = -top;\r\n    var left = aspect * bottom;\r\n    var right = aspect * top;\r\n    var width = Math.abs(right - left);\r\n    var height = Math.abs(top - bottom);\r\n\r\n    this.projectionMatrix.makeFrustum(\r\n      left + this.x * width / this.fullWidth,\r\n      left + (this.x + this.width) * width / this.fullWidth,\r\n      top - (this.y + this.height) * height / this.fullHeight,\r\n      top - this.y * height / this.fullHeight,\r\n      this.near,\r\n      this.far\r\n    );\r\n\r\n  }\r\n  else {\r\n\r\n    this.projectionMatrix.makePerspective(fov, this.aspect, this.near, this.far);\r\n\r\n  }\r\n\r\n};\r\n\r\nTHREE.PerspectiveCamera.prototype.clone = function() {\r\n\r\n  var camera = new THREE.PerspectiveCamera();\r\n\r\n  THREE.Camera.prototype.clone.call(this, camera);\r\n\r\n  camera.zoom = this.zoom;\r\n\r\n  camera.fov = this.fov;\r\n  camera.aspect = this.aspect;\r\n  camera.near = this.near;\r\n  camera.far = this.far;\r\n\r\n  camera.projectionMatrix.copy(this.projectionMatrix);\r\n\r\n  return camera;\r\n\r\n};\r\n\r\n// File:src/lights/Light.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author alteredq / http://alteredqualia.com/\r\n */\r\n\r\nTHREE.Light = function(color) {\r\n\r\n  THREE.Object3D.call(this);\r\n\r\n  this.type = 'Light';\r\n\r\n  this.color = new THREE.Color(color);\r\n\r\n};\r\n\r\nTHREE.Light.prototype = Object.create(THREE.Object3D.prototype);\r\nTHREE.Light.prototype.constructor = THREE.Light;\r\n\r\nTHREE.Light.prototype.clone = function(light) {\r\n\r\n  if (light === undefined) light = new THREE.Light();\r\n\r\n  THREE.Object3D.prototype.clone.call(this, light);\r\n\r\n  light.color.copy(this.color);\r\n\r\n  return light;\r\n\r\n};\r\n\r\n// File:src/lights/AmbientLight.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.AmbientLight = function(color) {\r\n\r\n  THREE.Light.call(this, color);\r\n\r\n  this.type = 'AmbientLight';\r\n\r\n};\r\n\r\nTHREE.AmbientLight.prototype = Object.create(THREE.Light.prototype);\r\nTHREE.AmbientLight.prototype.constructor = THREE.AmbientLight;\r\n\r\nTHREE.AmbientLight.prototype.clone = function() {\r\n\r\n  var light = new THREE.AmbientLight();\r\n\r\n  THREE.Light.prototype.clone.call(this, light);\r\n\r\n  return light;\r\n\r\n};\r\n\r\n// File:src/lights/AreaLight.js\r\n\r\n/**\r\n * @author MPanknin / http://www.redplant.de/\r\n * @author alteredq / http://alteredqualia.com/\r\n */\r\n\r\nTHREE.AreaLight = function(color, intensity) {\r\n\r\n  THREE.Light.call(this, color);\r\n\r\n  this.type = 'AreaLight';\r\n\r\n  this.normal = new THREE.Vector3(0, -1, 0);\r\n  this.right = new THREE.Vector3(1, 0, 0);\r\n\r\n  this.intensity = (intensity !== undefined) ? intensity : 1;\r\n\r\n  this.width = 1.0;\r\n  this.height = 1.0;\r\n\r\n  this.constantAttenuation = 1.5;\r\n  this.linearAttenuation = 0.5;\r\n  this.quadraticAttenuation = 0.1;\r\n\r\n};\r\n\r\nTHREE.AreaLight.prototype = Object.create(THREE.Light.prototype);\r\nTHREE.AreaLight.prototype.constructor = THREE.AreaLight;\r\n\r\n\r\n// File:src/lights/DirectionalLight.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author alteredq / http://alteredqualia.com/\r\n */\r\n\r\nTHREE.DirectionalLight = function(color, intensity) {\r\n\r\n  THREE.Light.call(this, color);\r\n\r\n  this.type = 'DirectionalLight';\r\n\r\n  this.position.set(0, 1, 0);\r\n  this.target = new THREE.Object3D();\r\n\r\n  this.intensity = (intensity !== undefined) ? intensity : 1;\r\n\r\n  this.castShadow = false;\r\n  this.onlyShadow = false;\r\n\r\n  //\r\n\r\n  this.shadowCameraNear = 50;\r\n  this.shadowCameraFar = 5000;\r\n\r\n  this.shadowCameraLeft = -500;\r\n  this.shadowCameraRight = 500;\r\n  this.shadowCameraTop = 500;\r\n  this.shadowCameraBottom = -500;\r\n\r\n  this.shadowCameraVisible = false;\r\n\r\n  this.shadowBias = 0;\r\n  this.shadowDarkness = 0.5;\r\n\r\n  this.shadowMapWidth = 512;\r\n  this.shadowMapHeight = 512;\r\n\r\n  //\r\n\r\n  this.shadowCascade = false;\r\n\r\n  this.shadowCascadeOffset = new THREE.Vector3(0, 0, -1000);\r\n  this.shadowCascadeCount = 2;\r\n\r\n  this.shadowCascadeBias = [0, 0, 0];\r\n  this.shadowCascadeWidth = [512, 512, 512];\r\n  this.shadowCascadeHeight = [512, 512, 512];\r\n\r\n  this.shadowCascadeNearZ = [-1.000, 0.990, 0.998];\r\n  this.shadowCascadeFarZ = [0.990, 0.998, 1.000];\r\n\r\n  this.shadowCascadeArray = [];\r\n\r\n  //\r\n\r\n  this.shadowMap = null;\r\n  this.shadowMapSize = null;\r\n  this.shadowCamera = null;\r\n  this.shadowMatrix = null;\r\n\r\n};\r\n\r\nTHREE.DirectionalLight.prototype = Object.create(THREE.Light.prototype);\r\nTHREE.DirectionalLight.prototype.constructor = THREE.DirectionalLight;\r\n\r\nTHREE.DirectionalLight.prototype.clone = function() {\r\n\r\n  var light = new THREE.DirectionalLight();\r\n\r\n  THREE.Light.prototype.clone.call(this, light);\r\n\r\n  light.target = this.target.clone();\r\n\r\n  light.intensity = this.intensity;\r\n\r\n  light.castShadow = this.castShadow;\r\n  light.onlyShadow = this.onlyShadow;\r\n\r\n  //\r\n\r\n  light.shadowCameraNear = this.shadowCameraNear;\r\n  light.shadowCameraFar = this.shadowCameraFar;\r\n\r\n  light.shadowCameraLeft = this.shadowCameraLeft;\r\n  light.shadowCameraRight = this.shadowCameraRight;\r\n  light.shadowCameraTop = this.shadowCameraTop;\r\n  light.shadowCameraBottom = this.shadowCameraBottom;\r\n\r\n  light.shadowCameraVisible = this.shadowCameraVisible;\r\n\r\n  light.shadowBias = this.shadowBias;\r\n  light.shadowDarkness = this.shadowDarkness;\r\n\r\n  light.shadowMapWidth = this.shadowMapWidth;\r\n  light.shadowMapHeight = this.shadowMapHeight;\r\n\r\n  //\r\n\r\n  light.shadowCascade = this.shadowCascade;\r\n\r\n  light.shadowCascadeOffset.copy(this.shadowCascadeOffset);\r\n  light.shadowCascadeCount = this.shadowCascadeCount;\r\n\r\n  light.shadowCascadeBias = this.shadowCascadeBias.slice(0);\r\n  light.shadowCascadeWidth = this.shadowCascadeWidth.slice(0);\r\n  light.shadowCascadeHeight = this.shadowCascadeHeight.slice(0);\r\n\r\n  light.shadowCascadeNearZ = this.shadowCascadeNearZ.slice(0);\r\n  light.shadowCascadeFarZ = this.shadowCascadeFarZ.slice(0);\r\n\r\n  return light;\r\n\r\n};\r\n\r\n// File:src/lights/HemisphereLight.js\r\n\r\n/**\r\n * @author alteredq / http://alteredqualia.com/\r\n */\r\n\r\nTHREE.HemisphereLight = function(skyColor, groundColor, intensity) {\r\n\r\n  THREE.Light.call(this, skyColor);\r\n\r\n  this.type = 'HemisphereLight';\r\n\r\n  this.position.set(0, 100, 0);\r\n\r\n  this.groundColor = new THREE.Color(groundColor);\r\n  this.intensity = (intensity !== undefined) ? intensity : 1;\r\n\r\n};\r\n\r\nTHREE.HemisphereLight.prototype = Object.create(THREE.Light.prototype);\r\nTHREE.HemisphereLight.prototype.constructor = THREE.HemisphereLight;\r\n\r\nTHREE.HemisphereLight.prototype.clone = function() {\r\n\r\n  var light = new THREE.HemisphereLight();\r\n\r\n  THREE.Light.prototype.clone.call(this, light);\r\n\r\n  light.groundColor.copy(this.groundColor);\r\n  light.intensity = this.intensity;\r\n\r\n  return light;\r\n\r\n};\r\n\r\n// File:src/lights/PointLight.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.PointLight = function(color, intensity, distance, decay) {\r\n\r\n  THREE.Light.call(this, color);\r\n\r\n  this.type = 'PointLight';\r\n\r\n  this.intensity = (intensity !== undefined) ? intensity : 1;\r\n  this.distance = (distance !== undefined) ? distance : 0;\r\n  this.decay = (decay !== undefined) ? decay : 1; // for physically correct lights, should be 2.\r\n\r\n};\r\n\r\nTHREE.PointLight.prototype = Object.create(THREE.Light.prototype);\r\nTHREE.PointLight.prototype.constructor = THREE.PointLight;\r\n\r\nTHREE.PointLight.prototype.clone = function() {\r\n\r\n  var light = new THREE.PointLight();\r\n\r\n  THREE.Light.prototype.clone.call(this, light);\r\n\r\n  light.intensity = this.intensity;\r\n  light.distance = this.distance;\r\n  light.decay = this.decay;\r\n\r\n  return light;\r\n\r\n};\r\n\r\n// File:src/lights/SpotLight.js\r\n\r\n/**\r\n * @author alteredq / http://alteredqualia.com/\r\n */\r\n\r\nTHREE.SpotLight = function(color, intensity, distance, angle, exponent, decay) {\r\n\r\n  THREE.Light.call(this, color);\r\n\r\n  this.type = 'SpotLight';\r\n\r\n  this.position.set(0, 1, 0);\r\n  this.target = new THREE.Object3D();\r\n\r\n  this.intensity = (intensity !== undefined) ? intensity : 1;\r\n  this.distance = (distance !== undefined) ? distance : 0;\r\n  this.angle = (angle !== undefined) ? angle : Math.PI / 3;\r\n  this.exponent = (exponent !== undefined) ? exponent : 10;\r\n  this.decay = (decay !== undefined) ? decay : 1; // for physically correct lights, should be 2.\r\n\r\n  this.castShadow = false;\r\n  this.onlyShadow = false;\r\n\r\n  //\r\n\r\n  this.shadowCameraNear = 50;\r\n  this.shadowCameraFar = 5000;\r\n  this.shadowCameraFov = 50;\r\n\r\n  this.shadowCameraVisible = false;\r\n\r\n  this.shadowBias = 0;\r\n  this.shadowDarkness = 0.5;\r\n\r\n  this.shadowMapWidth = 512;\r\n  this.shadowMapHeight = 512;\r\n\r\n  //\r\n\r\n  this.shadowMap = null;\r\n  this.shadowMapSize = null;\r\n  this.shadowCamera = null;\r\n  this.shadowMatrix = null;\r\n\r\n};\r\n\r\nTHREE.SpotLight.prototype = Object.create(THREE.Light.prototype);\r\nTHREE.SpotLight.prototype.constructor = THREE.SpotLight;\r\n\r\nTHREE.SpotLight.prototype.clone = function() {\r\n\r\n  var light = new THREE.SpotLight();\r\n\r\n  THREE.Light.prototype.clone.call(this, light);\r\n\r\n  light.target = this.target.clone();\r\n\r\n  light.intensity = this.intensity;\r\n  light.distance = this.distance;\r\n  light.angle = this.angle;\r\n  light.exponent = this.exponent;\r\n  light.decay = this.decay;\r\n\r\n  light.castShadow = this.castShadow;\r\n  light.onlyShadow = this.onlyShadow;\r\n\r\n  //\r\n\r\n  light.shadowCameraNear = this.shadowCameraNear;\r\n  light.shadowCameraFar = this.shadowCameraFar;\r\n  light.shadowCameraFov = this.shadowCameraFov;\r\n\r\n  light.shadowCameraVisible = this.shadowCameraVisible;\r\n\r\n  light.shadowBias = this.shadowBias;\r\n  light.shadowDarkness = this.shadowDarkness;\r\n\r\n  light.shadowMapWidth = this.shadowMapWidth;\r\n  light.shadowMapHeight = this.shadowMapHeight;\r\n\r\n  return light;\r\n\r\n};\r\n\r\n// File:src/loaders/Cache.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.Cache = {\r\n\r\n  files: {},\r\n\r\n  add: function(key, file) {\r\n\r\n    // console.log( 'THREE.Cache', 'Adding key:', key );\r\n\r\n    this.files[key] = file;\r\n\r\n  },\r\n\r\n  get: function(key) {\r\n\r\n    // console.log( 'THREE.Cache', 'Checking key:', key );\r\n\r\n    return this.files[key];\r\n\r\n  },\r\n\r\n  remove: function(key) {\r\n\r\n    delete this.files[key];\r\n\r\n  },\r\n\r\n  clear: function() {\r\n\r\n    this.files = {}\r\n\r\n  }\r\n\r\n};\r\n\r\n// File:src/loaders/Loader.js\r\n\r\n/**\r\n * @author alteredq / http://alteredqualia.com/\r\n */\r\n\r\nTHREE.Loader = function(showStatus) {\r\n\r\n  this.showStatus = showStatus;\r\n  this.statusDomElement = showStatus ? THREE.Loader.prototype.addStatusElement() : null;\r\n\r\n  this.imageLoader = new THREE.ImageLoader();\r\n\r\n  this.onLoadStart = function() {};\r\n  this.onLoadProgress = function() {};\r\n  this.onLoadComplete = function() {};\r\n\r\n};\r\n\r\nTHREE.Loader.prototype = {\r\n\r\n  constructor: THREE.Loader,\r\n\r\n  crossOrigin: undefined,\r\n\r\n  addStatusElement: function() {\r\n\r\n    var e = document.createElement('div');\r\n\r\n    e.style.position = 'absolute';\r\n    e.style.right = '0px';\r\n    e.style.top = '0px';\r\n    e.style.fontSize = '0.8em';\r\n    e.style.textAlign = 'left';\r\n    e.style.background = 'rgba(0,0,0,0.25)';\r\n    e.style.color = '#fff';\r\n    e.style.width = '120px';\r\n    e.style.padding = '0.5em 0.5em 0.5em 0.5em';\r\n    e.style.zIndex = 1000;\r\n\r\n    e.innerHTML = 'Loading ...';\r\n\r\n    return e;\r\n\r\n  },\r\n\r\n  updateProgress: function(progress) {\r\n\r\n    var message = 'Loaded ';\r\n\r\n    if (progress.total) {\r\n\r\n      message += (100 * progress.loaded / progress.total).toFixed(0) + '%';\r\n\r\n\r\n    }\r\n    else {\r\n\r\n      message += (progress.loaded / 1024).toFixed(2) + ' KB';\r\n\r\n    }\r\n\r\n    this.statusDomElement.innerHTML = message;\r\n\r\n  },\r\n\r\n  extractUrlBase: function(url) {\r\n\r\n    var parts = url.split('/');\r\n\r\n    if (parts.length === 1) return './';\r\n\r\n    parts.pop();\r\n\r\n    return parts.join('/') + '/';\r\n\r\n  },\r\n\r\n  initMaterials: function(materials, texturePath) {\r\n\r\n    var array = [];\r\n\r\n    for (var i = 0; i < materials.length; ++i) {\r\n\r\n      array[i] = this.createMaterial(materials[i], texturePath);\r\n\r\n    }\r\n\r\n    return array;\r\n\r\n  },\r\n\r\n  needsTangents: function(materials) {\r\n\r\n    for (var i = 0, il = materials.length; i < il; i++) {\r\n\r\n      var m = materials[i];\r\n\r\n      if (m instanceof THREE.ShaderMaterial) return true;\r\n\r\n    }\r\n\r\n    return false;\r\n\r\n  },\r\n\r\n  createMaterial: function(m, texturePath) {\r\n\r\n    var scope = this;\r\n\r\n    function nearest_pow2(n) {\r\n\r\n      var l = Math.log(n) / Math.LN2;\r\n      return Math.pow(2, Math.round(l));\r\n\r\n    }\r\n\r\n    function create_texture(where, name, sourceFile, repeat, offset, wrap, anisotropy) {\r\n\r\n      var fullPath = texturePath + sourceFile;\r\n\r\n      var texture;\r\n\r\n      var loader = THREE.Loader.Handlers.get(fullPath);\r\n\r\n      if (loader !== null) {\r\n\r\n        texture = loader.load(fullPath);\r\n\r\n      }\r\n      else {\r\n\r\n        texture = new THREE.Texture();\r\n\r\n        loader = scope.imageLoader;\r\n        loader.crossOrigin = scope.crossOrigin;\r\n        loader.load(fullPath, function(image) {\r\n\r\n          if (THREE.Math.isPowerOfTwo(image.width) === false ||\r\n            THREE.Math.isPowerOfTwo(image.height) === false) {\r\n\r\n            var width = nearest_pow2(image.width);\r\n            var height = nearest_pow2(image.height);\r\n\r\n            var canvas = document.createElement('canvas');\r\n            canvas.width = width;\r\n            canvas.height = height;\r\n\r\n            var context = canvas.getContext('2d');\r\n            context.drawImage(image, 0, 0, width, height);\r\n\r\n            texture.image = canvas;\r\n\r\n          }\r\n          else {\r\n\r\n            texture.image = image;\r\n\r\n          }\r\n\r\n          texture.needsUpdate = true;\r\n\r\n        });\r\n\r\n      }\r\n\r\n      texture.sourceFile = sourceFile;\r\n\r\n      if (repeat) {\r\n\r\n        texture.repeat.set(repeat[0], repeat[1]);\r\n\r\n        if (repeat[0] !== 1) texture.wrapS = THREE.RepeatWrapping;\r\n        if (repeat[1] !== 1) texture.wrapT = THREE.RepeatWrapping;\r\n\r\n      }\r\n\r\n      if (offset) {\r\n\r\n        texture.offset.set(offset[0], offset[1]);\r\n\r\n      }\r\n\r\n      if (wrap) {\r\n\r\n        var wrapMap = {\r\n          'repeat': THREE.RepeatWrapping,\r\n          'mirror': THREE.MirroredRepeatWrapping\r\n        }\r\n\r\n        if (wrapMap[wrap[0]] !== undefined) texture.wrapS = wrapMap[wrap[0]];\r\n        if (wrapMap[wrap[1]] !== undefined) texture.wrapT = wrapMap[wrap[1]];\r\n\r\n      }\r\n\r\n      if (anisotropy) {\r\n\r\n        texture.anisotropy = anisotropy;\r\n\r\n      }\r\n\r\n      where[name] = texture;\r\n\r\n    }\r\n\r\n    function rgb2hex(rgb) {\r\n\r\n      return (rgb[0] * 255 << 16) + (rgb[1] * 255 << 8) + rgb[2] * 255;\r\n\r\n    }\r\n\r\n    // defaults\r\n\r\n    var mtype = 'MeshLambertMaterial';\r\n    var mpars = {\r\n      color: 0xeeeeee,\r\n      opacity: 1.0,\r\n      map: null,\r\n      lightMap: null,\r\n      normalMap: null,\r\n      bumpMap: null,\r\n      wireframe: false\r\n    };\r\n\r\n    // parameters from model file\r\n\r\n    if (m.shading) {\r\n\r\n      var shading = m.shading.toLowerCase();\r\n\r\n      if (shading === 'phong') mtype = 'MeshPhongMaterial';\r\n      else if (shading === 'basic') mtype = 'MeshBasicMaterial';\r\n\r\n    }\r\n\r\n    if (m.blending !== undefined && THREE[m.blending] !== undefined) {\r\n\r\n      mpars.blending = THREE[m.blending];\r\n\r\n    }\r\n\r\n    if (m.transparent !== undefined) {\r\n\r\n      mpars.transparent = m.transparent;\r\n\r\n    }\r\n\r\n    if (m.opacity !== undefined && m.opacity < 1.0) {\r\n\r\n      mpars.transparent = true;\r\n\r\n    }\r\n\r\n    if (m.depthTest !== undefined) {\r\n\r\n      mpars.depthTest = m.depthTest;\r\n\r\n    }\r\n\r\n    if (m.depthWrite !== undefined) {\r\n\r\n      mpars.depthWrite = m.depthWrite;\r\n\r\n    }\r\n\r\n    if (m.visible !== undefined) {\r\n\r\n      mpars.visible = m.visible;\r\n\r\n    }\r\n\r\n    if (m.flipSided !== undefined) {\r\n\r\n      mpars.side = THREE.BackSide;\r\n\r\n    }\r\n\r\n    if (m.doubleSided !== undefined) {\r\n\r\n      mpars.side = THREE.DoubleSide;\r\n\r\n    }\r\n\r\n    if (m.wireframe !== undefined) {\r\n\r\n      mpars.wireframe = m.wireframe;\r\n\r\n    }\r\n\r\n    if (m.vertexColors !== undefined) {\r\n\r\n      if (m.vertexColors === 'face') {\r\n\r\n        mpars.vertexColors = THREE.FaceColors;\r\n\r\n      }\r\n      else if (m.vertexColors) {\r\n\r\n        mpars.vertexColors = THREE.VertexColors;\r\n\r\n      }\r\n\r\n    }\r\n\r\n    // colors\r\n\r\n    if (m.colorDiffuse) {\r\n\r\n      mpars.color = rgb2hex(m.colorDiffuse);\r\n\r\n    }\r\n    else if (m.DbgColor) {\r\n\r\n      mpars.color = m.DbgColor;\r\n\r\n    }\r\n\r\n    if (m.colorSpecular) {\r\n\r\n      mpars.specular = rgb2hex(m.colorSpecular);\r\n\r\n    }\r\n\r\n    if (m.colorEmissive) {\r\n\r\n      mpars.emissive = rgb2hex(m.colorEmissive);\r\n\r\n    }\r\n\r\n    // modifiers\r\n\r\n    if (m.transparency !== undefined) {\r\n\r\n      console.warn('THREE.Loader: transparency has been renamed to opacity');\r\n      m.opacity = m.transparency;\r\n\r\n    }\r\n\r\n    if (m.opacity !== undefined) {\r\n\r\n      mpars.opacity = m.opacity;\r\n\r\n    }\r\n\r\n    if (m.specularCoef) {\r\n\r\n      mpars.shininess = m.specularCoef;\r\n\r\n    }\r\n\r\n    // textures\r\n\r\n    if (m.mapDiffuse && texturePath) {\r\n\r\n      create_texture(mpars, 'map', m.mapDiffuse, m.mapDiffuseRepeat, m.mapDiffuseOffset, m.mapDiffuseWrap, m.mapDiffuseAnisotropy);\r\n\r\n    }\r\n\r\n    if (m.mapLight && texturePath) {\r\n\r\n      create_texture(mpars, 'lightMap', m.mapLight, m.mapLightRepeat, m.mapLightOffset, m.mapLightWrap, m.mapLightAnisotropy);\r\n\r\n    }\r\n\r\n    if (m.mapBump && texturePath) {\r\n\r\n      create_texture(mpars, 'bumpMap', m.mapBump, m.mapBumpRepeat, m.mapBumpOffset, m.mapBumpWrap, m.mapBumpAnisotropy);\r\n\r\n    }\r\n\r\n    if (m.mapNormal && texturePath) {\r\n\r\n      create_texture(mpars, 'normalMap', m.mapNormal, m.mapNormalRepeat, m.mapNormalOffset, m.mapNormalWrap, m.mapNormalAnisotropy);\r\n\r\n    }\r\n\r\n    if (m.mapSpecular && texturePath) {\r\n\r\n      create_texture(mpars, 'specularMap', m.mapSpecular, m.mapSpecularRepeat, m.mapSpecularOffset, m.mapSpecularWrap, m.mapSpecularAnisotropy);\r\n\r\n    }\r\n\r\n    if (m.mapAlpha && texturePath) {\r\n\r\n      create_texture(mpars, 'alphaMap', m.mapAlpha, m.mapAlphaRepeat, m.mapAlphaOffset, m.mapAlphaWrap, m.mapAlphaAnisotropy);\r\n\r\n    }\r\n\r\n    //\r\n\r\n    if (m.mapBumpScale) {\r\n\r\n      mpars.bumpScale = m.mapBumpScale;\r\n\r\n    }\r\n\r\n    if (m.mapNormalFactor) {\r\n\r\n      mpars.normalScale = new THREE.Vector2(m.mapNormalFactor, m.mapNormalFactor);\r\n\r\n    }\r\n\r\n    var material = new THREE[mtype](mpars);\r\n\r\n    if (m.DbgName !== undefined) material.name = m.DbgName;\r\n\r\n    return material;\r\n\r\n  }\r\n\r\n};\r\n\r\nTHREE.Loader.Handlers = {\r\n\r\n  handlers: [],\r\n\r\n  add: function(regex, loader) {\r\n\r\n    this.handlers.push(regex, loader);\r\n\r\n  },\r\n\r\n  get: function(file) {\r\n\r\n    for (var i = 0, l = this.handlers.length; i < l; i += 2) {\r\n\r\n      var regex = this.handlers[i];\r\n      var loader = this.handlers[i + 1];\r\n\r\n      if (regex.test(file)) {\r\n\r\n        return loader;\r\n\r\n      }\r\n\r\n    }\r\n\r\n    return null;\r\n\r\n  }\r\n\r\n};\r\n\r\n// File:src/loaders/XHRLoader.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.XHRLoader = function(manager) {\r\n\r\n  this.manager = (manager !== undefined) ? manager : THREE.DefaultLoadingManager;\r\n\r\n};\r\n\r\nTHREE.XHRLoader.prototype = {\r\n\r\n  constructor: THREE.XHRLoader,\r\n\r\n  load: function(url, onLoad, onProgress, onError) {\r\n\r\n    var scope = this;\r\n\r\n    var cached = THREE.Cache.get(url);\r\n\r\n    if (cached !== undefined) {\r\n\r\n      if (onLoad) onLoad(cached);\r\n      return;\r\n\r\n    }\r\n\r\n    var request = new XMLHttpRequest();\r\n    request.open('GET', url, true);\r\n\r\n    request.addEventListener('load', function(event) {\r\n\r\n      THREE.Cache.add(url, this.response);\r\n\r\n      if (onLoad) onLoad(this.response);\r\n\r\n      scope.manager.itemEnd(url);\r\n\r\n    }, false);\r\n\r\n    if (onProgress !== undefined) {\r\n\r\n      request.addEventListener('progress', function(event) {\r\n\r\n        onProgress(event);\r\n\r\n      }, false);\r\n\r\n    }\r\n\r\n    if (onError !== undefined) {\r\n\r\n      request.addEventListener('error', function(event) {\r\n\r\n        onError(event);\r\n\r\n      }, false);\r\n\r\n    }\r\n\r\n    if (this.crossOrigin !== undefined) request.crossOrigin = this.crossOrigin;\r\n    if (this.responseType !== undefined) request.responseType = this.responseType;\r\n\r\n    request.send(null);\r\n\r\n    scope.manager.itemStart(url);\r\n\r\n  },\r\n\r\n  setResponseType: function(value) {\r\n\r\n    this.responseType = value;\r\n\r\n  },\r\n\r\n  setCrossOrigin: function(value) {\r\n\r\n    this.crossOrigin = value;\r\n\r\n  }\r\n\r\n};\r\n\r\n// File:src/loaders/ImageLoader.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.ImageLoader = function(manager) {\r\n\r\n  this.manager = (manager !== undefined) ? manager : THREE.DefaultLoadingManager;\r\n\r\n};\r\n\r\nTHREE.ImageLoader.prototype = {\r\n\r\n  constructor: THREE.ImageLoader,\r\n\r\n  load: function(url, onLoad, onProgress, onError) {\r\n\r\n    var scope = this;\r\n\r\n    var cached = THREE.Cache.get(url);\r\n\r\n    if (cached !== undefined) {\r\n\r\n      onLoad(cached);\r\n      return;\r\n\r\n    }\r\n\r\n    var image = document.createElement('img');\r\n\r\n    image.addEventListener('load', function(event) {\r\n\r\n      THREE.Cache.add(url, this);\r\n\r\n      if (onLoad) onLoad(this);\r\n\r\n      scope.manager.itemEnd(url);\r\n\r\n    }, false);\r\n\r\n    if (onProgress !== undefined) {\r\n\r\n      image.addEventListener('progress', function(event) {\r\n\r\n        onProgress(event);\r\n\r\n      }, false);\r\n\r\n    }\r\n\r\n    if (onError !== undefined) {\r\n\r\n      image.addEventListener('error', function(event) {\r\n\r\n        onError(event);\r\n\r\n      }, false);\r\n\r\n    }\r\n\r\n    if (this.crossOrigin !== undefined) image.crossOrigin = this.crossOrigin;\r\n\r\n    image.src = url;\r\n\r\n    scope.manager.itemStart(url);\r\n\r\n    return image;\r\n\r\n  },\r\n\r\n  setCrossOrigin: function(value) {\r\n\r\n    this.crossOrigin = value;\r\n\r\n  }\r\n\r\n}\r\n\r\n// File:src/loaders/JSONLoader.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author alteredq / http://alteredqualia.com/\r\n */\r\n\r\nTHREE.JSONLoader = function(showStatus) {\r\n\r\n  THREE.Loader.call(this, showStatus);\r\n\r\n  this.withCredentials = false;\r\n\r\n};\r\n\r\nTHREE.JSONLoader.prototype = Object.create(THREE.Loader.prototype);\r\nTHREE.JSONLoader.prototype.constructor = THREE.JSONLoader;\r\n\r\nTHREE.JSONLoader.prototype.load = function(url, callback, texturePath) {\r\n\r\n  // todo: unify load API to for easier SceneLoader use\r\n\r\n  texturePath = texturePath && (typeof texturePath === 'string') ? texturePath : this.extractUrlBase(url);\r\n\r\n  this.onLoadStart();\r\n  this.loadAjaxJSON(this, url, callback, texturePath);\r\n\r\n};\r\n\r\nTHREE.JSONLoader.prototype.loadAjaxJSON = function(context, url, callback, texturePath, callbackProgress) {\r\n\r\n  var xhr = new XMLHttpRequest();\r\n\r\n  var length = 0;\r\n\r\n  xhr.onreadystatechange = function() {\r\n\r\n    if (xhr.readyState === xhr.DONE) {\r\n\r\n      if (xhr.status === 200 || xhr.status === 0) {\r\n\r\n        if (xhr.responseText) {\r\n\r\n          var json = JSON.parse(xhr.responseText);\r\n          var metadata = json.metadata;\r\n\r\n          if (metadata !== undefined) {\r\n\r\n            if (metadata.type === 'object') {\r\n\r\n              THREE.error('THREE.JSONLoader: ' + url + ' should be loaded with THREE.ObjectLoader instead.');\r\n              return;\r\n\r\n            }\r\n\r\n            if (metadata.type === 'scene') {\r\n\r\n              THREE.error('THREE.JSONLoader: ' + url + ' seems to be a Scene. Use THREE.SceneLoader instead.');\r\n              return;\r\n\r\n            }\r\n\r\n          }\r\n\r\n          var result = context.parse(json, texturePath);\r\n          callback(result.geometry, result.materials);\r\n\r\n        }\r\n        else {\r\n\r\n          THREE.error('THREE.JSONLoader: ' + url + ' seems to be unreachable or the file is empty.');\r\n\r\n        }\r\n\r\n        // in context of more complex asset initialization\r\n        // do not block on single failed file\r\n        // maybe should go even one more level up\r\n\r\n        context.onLoadComplete();\r\n\r\n      }\r\n      else {\r\n\r\n        THREE.error('THREE.JSONLoader: Couldn\\'t load ' + url + ' (' + xhr.status + ')');\r\n\r\n      }\r\n\r\n    }\r\n    else if (xhr.readyState === xhr.LOADING) {\r\n\r\n      if (callbackProgress) {\r\n\r\n        if (length === 0) {\r\n\r\n          length = xhr.getResponseHeader('Content-Length');\r\n\r\n        }\r\n\r\n        callbackProgress({\r\n          total: length,\r\n          loaded: xhr.responseText.length\r\n        });\r\n\r\n      }\r\n\r\n    }\r\n    else if (xhr.readyState === xhr.HEADERS_RECEIVED) {\r\n\r\n      if (callbackProgress !== undefined) {\r\n\r\n        length = xhr.getResponseHeader('Content-Length');\r\n\r\n      }\r\n\r\n    }\r\n\r\n  };\r\n\r\n  xhr.open('GET', url, true);\r\n  xhr.withCredentials = this.withCredentials;\r\n  xhr.send(null);\r\n\r\n};\r\n\r\nTHREE.JSONLoader.prototype.parse = function(json, texturePath) {\r\n\r\n  var geometry = new THREE.Geometry(),\r\n    scale = (json.scale !== undefined) ? 1.0 / json.scale : 1.0;\r\n\r\n  parseModel(scale);\r\n\r\n  parseSkin();\r\n  parseMorphing(scale);\r\n\r\n  geometry.computeFaceNormals();\r\n  geometry.computeBoundingSphere();\r\n\r\n  function parseModel(scale) {\r\n\r\n    function isBitSet(value, position) {\r\n\r\n      return value & (1 << position);\r\n\r\n    }\r\n\r\n    var i, j, fi,\r\n\r\n      offset, zLength,\r\n\r\n      colorIndex, normalIndex, uvIndex, materialIndex,\r\n\r\n      type,\r\n      isQuad,\r\n      hasMaterial,\r\n      hasFaceVertexUv,\r\n      hasFaceNormal, hasFaceVertexNormal,\r\n      hasFaceColor, hasFaceVertexColor,\r\n\r\n      vertex, face, faceA, faceB, hex, normal,\r\n\r\n      uvLayer, uv, u, v,\r\n\r\n      faces = json.faces,\r\n      vertices = json.vertices,\r\n      normals = json.normals,\r\n      colors = json.colors,\r\n\r\n      nUvLayers = 0;\r\n\r\n    if (json.uvs !== undefined) {\r\n\r\n      // disregard empty arrays\r\n\r\n      for (i = 0; i < json.uvs.length; i++) {\r\n\r\n        if (json.uvs[i].length) nUvLayers++;\r\n\r\n      }\r\n\r\n      for (i = 0; i < nUvLayers; i++) {\r\n\r\n        geometry.faceVertexUvs[i] = [];\r\n\r\n      }\r\n\r\n    }\r\n\r\n    offset = 0;\r\n    zLength = vertices.length;\r\n\r\n    while (offset < zLength) {\r\n\r\n      vertex = new THREE.Vector3();\r\n\r\n      vertex.x = vertices[offset++] * scale;\r\n      vertex.y = vertices[offset++] * scale;\r\n      vertex.z = vertices[offset++] * scale;\r\n\r\n      geometry.vertices.push(vertex);\r\n\r\n    }\r\n\r\n    offset = 0;\r\n    zLength = faces.length;\r\n\r\n    while (offset < zLength) {\r\n\r\n      type = faces[offset++];\r\n\r\n\r\n      isQuad = isBitSet(type, 0);\r\n      hasMaterial = isBitSet(type, 1);\r\n      hasFaceVertexUv = isBitSet(type, 3);\r\n      hasFaceNormal = isBitSet(type, 4);\r\n      hasFaceVertexNormal = isBitSet(type, 5);\r\n      hasFaceColor = isBitSet(type, 6);\r\n      hasFaceVertexColor = isBitSet(type, 7);\r\n\r\n      // console.log(\"type\", type, \"bits\", isQuad, hasMaterial, hasFaceVertexUv, hasFaceNormal, hasFaceVertexNormal, hasFaceColor, hasFaceVertexColor);\r\n\r\n      if (isQuad) {\r\n\r\n        faceA = new THREE.Face3();\r\n        faceA.a = faces[offset];\r\n        faceA.b = faces[offset + 1];\r\n        faceA.c = faces[offset + 3];\r\n\r\n        faceB = new THREE.Face3();\r\n        faceB.a = faces[offset + 1];\r\n        faceB.b = faces[offset + 2];\r\n        faceB.c = faces[offset + 3];\r\n\r\n        offset += 4;\r\n\r\n        if (hasMaterial) {\r\n\r\n          materialIndex = faces[offset++];\r\n          faceA.materialIndex = materialIndex;\r\n          faceB.materialIndex = materialIndex;\r\n\r\n        }\r\n\r\n        // to get face <=> uv index correspondence\r\n\r\n        fi = geometry.faces.length;\r\n\r\n        if (hasFaceVertexUv) {\r\n\r\n          for (i = 0; i < nUvLayers; i++) {\r\n\r\n            uvLayer = json.uvs[i];\r\n\r\n            geometry.faceVertexUvs[i][fi] = [];\r\n            geometry.faceVertexUvs[i][fi + 1] = []\r\n\r\n            for (j = 0; j < 4; j++) {\r\n\r\n              uvIndex = faces[offset++];\r\n\r\n              u = uvLayer[uvIndex * 2];\r\n              v = uvLayer[uvIndex * 2 + 1];\r\n\r\n              uv = new THREE.Vector2(u, v);\r\n\r\n              if (j !== 2) geometry.faceVertexUvs[i][fi].push(uv);\r\n              if (j !== 0) geometry.faceVertexUvs[i][fi + 1].push(uv);\r\n\r\n            }\r\n\r\n          }\r\n\r\n        }\r\n\r\n        if (hasFaceNormal) {\r\n\r\n          normalIndex = faces[offset++] * 3;\r\n\r\n          faceA.normal.set(\r\n            normals[normalIndex++],\r\n            normals[normalIndex++],\r\n            normals[normalIndex]\r\n          );\r\n\r\n          faceB.normal.copy(faceA.normal);\r\n\r\n        }\r\n\r\n        if (hasFaceVertexNormal) {\r\n\r\n          for (i = 0; i < 4; i++) {\r\n\r\n            normalIndex = faces[offset++] * 3;\r\n\r\n            normal = new THREE.Vector3(\r\n              normals[normalIndex++],\r\n              normals[normalIndex++],\r\n              normals[normalIndex]\r\n            );\r\n\r\n\r\n            if (i !== 2) faceA.vertexNormals.push(normal);\r\n            if (i !== 0) faceB.vertexNormals.push(normal);\r\n\r\n          }\r\n\r\n        }\r\n\r\n\r\n        if (hasFaceColor) {\r\n\r\n          colorIndex = faces[offset++];\r\n          hex = colors[colorIndex];\r\n\r\n          faceA.color.setHex(hex);\r\n          faceB.color.setHex(hex);\r\n\r\n        }\r\n\r\n\r\n        if (hasFaceVertexColor) {\r\n\r\n          for (i = 0; i < 4; i++) {\r\n\r\n            colorIndex = faces[offset++];\r\n            hex = colors[colorIndex];\r\n\r\n            if (i !== 2) faceA.vertexColors.push(new THREE.Color(hex));\r\n            if (i !== 0) faceB.vertexColors.push(new THREE.Color(hex));\r\n\r\n          }\r\n\r\n        }\r\n\r\n        geometry.faces.push(faceA);\r\n        geometry.faces.push(faceB);\r\n\r\n      }\r\n      else {\r\n\r\n        face = new THREE.Face3();\r\n        face.a = faces[offset++];\r\n        face.b = faces[offset++];\r\n        face.c = faces[offset++];\r\n\r\n        if (hasMaterial) {\r\n\r\n          materialIndex = faces[offset++];\r\n          face.materialIndex = materialIndex;\r\n\r\n        }\r\n\r\n        // to get face <=> uv index correspondence\r\n\r\n        fi = geometry.faces.length;\r\n\r\n        if (hasFaceVertexUv) {\r\n\r\n          for (i = 0; i < nUvLayers; i++) {\r\n\r\n            uvLayer = json.uvs[i];\r\n\r\n            geometry.faceVertexUvs[i][fi] = [];\r\n\r\n            for (j = 0; j < 3; j++) {\r\n\r\n              uvIndex = faces[offset++];\r\n\r\n              u = uvLayer[uvIndex * 2];\r\n              v = uvLayer[uvIndex * 2 + 1];\r\n\r\n              uv = new THREE.Vector2(u, v);\r\n\r\n              geometry.faceVertexUvs[i][fi].push(uv);\r\n\r\n            }\r\n\r\n          }\r\n\r\n        }\r\n\r\n        if (hasFaceNormal) {\r\n\r\n          normalIndex = faces[offset++] * 3;\r\n\r\n          face.normal.set(\r\n            normals[normalIndex++],\r\n            normals[normalIndex++],\r\n            normals[normalIndex]\r\n          );\r\n\r\n        }\r\n\r\n        if (hasFaceVertexNormal) {\r\n\r\n          for (i = 0; i < 3; i++) {\r\n\r\n            normalIndex = faces[offset++] * 3;\r\n\r\n            normal = new THREE.Vector3(\r\n              normals[normalIndex++],\r\n              normals[normalIndex++],\r\n              normals[normalIndex]\r\n            );\r\n\r\n            face.vertexNormals.push(normal);\r\n\r\n          }\r\n\r\n        }\r\n\r\n\r\n        if (hasFaceColor) {\r\n\r\n          colorIndex = faces[offset++];\r\n          face.color.setHex(colors[colorIndex]);\r\n\r\n        }\r\n\r\n\r\n        if (hasFaceVertexColor) {\r\n\r\n          for (i = 0; i < 3; i++) {\r\n\r\n            colorIndex = faces[offset++];\r\n            face.vertexColors.push(new THREE.Color(colors[colorIndex]));\r\n\r\n          }\r\n\r\n        }\r\n\r\n        geometry.faces.push(face);\r\n\r\n      }\r\n\r\n    }\r\n\r\n  };\r\n\r\n  function parseSkin() {\r\n    var influencesPerVertex = (json.influencesPerVertex !== undefined) ? json.influencesPerVertex : 2;\r\n\r\n    if (json.skinWeights) {\r\n\r\n      for (var i = 0, l = json.skinWeights.length; i < l; i += influencesPerVertex) {\r\n\r\n        var x = json.skinWeights[i];\r\n        var y = (influencesPerVertex > 1) ? json.skinWeights[i + 1] : 0;\r\n        var z = (influencesPerVertex > 2) ? json.skinWeights[i + 2] : 0;\r\n        var w = (influencesPerVertex > 3) ? json.skinWeights[i + 3] : 0;\r\n\r\n        geometry.skinWeights.push(new THREE.Vector4(x, y, z, w));\r\n\r\n      }\r\n\r\n    }\r\n\r\n    if (json.skinIndices) {\r\n\r\n      for (var i = 0, l = json.skinIndices.length; i < l; i += influencesPerVertex) {\r\n\r\n        var a = json.skinIndices[i];\r\n        var b = (influencesPerVertex > 1) ? json.skinIndices[i + 1] : 0;\r\n        var c = (influencesPerVertex > 2) ? json.skinIndices[i + 2] : 0;\r\n        var d = (influencesPerVertex > 3) ? json.skinIndices[i + 3] : 0;\r\n\r\n        geometry.skinIndices.push(new THREE.Vector4(a, b, c, d));\r\n\r\n      }\r\n\r\n    }\r\n\r\n    geometry.bones = json.bones;\r\n\r\n    if (geometry.bones && geometry.bones.length > 0 && (geometry.skinWeights.length !== geometry.skinIndices.length || geometry.skinIndices.length !== geometry.vertices.length)) {\r\n\r\n      THREE.warn('THREE.JSONLoader: When skinning, number of vertices (' + geometry.vertices.length + '), skinIndices (' +\r\n        geometry.skinIndices.length + '), and skinWeights (' + geometry.skinWeights.length + ') should match.');\r\n\r\n    }\r\n\r\n\r\n    // could change this to json.animations[0] or remove completely\r\n\r\n    geometry.animation = json.animation;\r\n    geometry.animations = json.animations;\r\n\r\n  };\r\n\r\n  function parseMorphing(scale) {\r\n\r\n    if (json.morphTargets !== undefined) {\r\n\r\n      var i, l, v, vl, dstVertices, srcVertices;\r\n\r\n      for (i = 0, l = json.morphTargets.length; i < l; i++) {\r\n\r\n        geometry.morphTargets[i] = {};\r\n        geometry.morphTargets[i].name = json.morphTargets[i].name;\r\n        geometry.morphTargets[i].vertices = [];\r\n\r\n        dstVertices = geometry.morphTargets[i].vertices;\r\n        srcVertices = json.morphTargets[i].vertices;\r\n\r\n        for (v = 0, vl = srcVertices.length; v < vl; v += 3) {\r\n\r\n          var vertex = new THREE.Vector3();\r\n          vertex.x = srcVertices[v] * scale;\r\n          vertex.y = srcVertices[v + 1] * scale;\r\n          vertex.z = srcVertices[v + 2] * scale;\r\n\r\n          dstVertices.push(vertex);\r\n\r\n        }\r\n\r\n      }\r\n\r\n    }\r\n\r\n    if (json.morphColors !== undefined) {\r\n\r\n      var i, l, c, cl, dstColors, srcColors, color;\r\n\r\n      for (i = 0, l = json.morphColors.length; i < l; i++) {\r\n\r\n        geometry.morphColors[i] = {};\r\n        geometry.morphColors[i].name = json.morphColors[i].name;\r\n        geometry.morphColors[i].colors = [];\r\n\r\n        dstColors = geometry.morphColors[i].colors;\r\n        srcColors = json.morphColors[i].colors;\r\n\r\n        for (c = 0, cl = srcColors.length; c < cl; c += 3) {\r\n\r\n          color = new THREE.Color(0xffaa00);\r\n          color.setRGB(srcColors[c], srcColors[c + 1], srcColors[c + 2]);\r\n          dstColors.push(color);\r\n\r\n        }\r\n\r\n      }\r\n\r\n    }\r\n\r\n  };\r\n\r\n  if (json.materials === undefined || json.materials.length === 0) {\r\n\r\n    return {\r\n      geometry: geometry\r\n    };\r\n\r\n  }\r\n  else {\r\n\r\n    var materials = this.initMaterials(json.materials, texturePath);\r\n\r\n    if (this.needsTangents(materials)) {\r\n\r\n      geometry.computeTangents();\r\n\r\n    }\r\n\r\n    return {\r\n      geometry: geometry,\r\n      materials: materials\r\n    };\r\n\r\n  }\r\n\r\n};\r\n\r\n// File:src/loaders/LoadingManager.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.LoadingManager = function(onLoad, onProgress, onError) {\r\n\r\n  var scope = this;\r\n\r\n  var loaded = 0,\r\n    total = 0;\r\n\r\n  this.onLoad = onLoad;\r\n  this.onProgress = onProgress;\r\n  this.onError = onError;\r\n\r\n  this.itemStart = function(url) {\r\n\r\n    total++;\r\n\r\n  };\r\n\r\n  this.itemEnd = function(url) {\r\n\r\n    loaded++;\r\n\r\n    if (scope.onProgress !== undefined) {\r\n\r\n      scope.onProgress(url, loaded, total);\r\n\r\n    }\r\n\r\n    if (loaded === total && scope.onLoad !== undefined) {\r\n\r\n      scope.onLoad();\r\n\r\n    }\r\n\r\n  };\r\n\r\n};\r\n\r\nTHREE.DefaultLoadingManager = new THREE.LoadingManager();\r\n\r\n// File:src/loaders/BufferGeometryLoader.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.BufferGeometryLoader = function(manager) {\r\n\r\n  this.manager = (manager !== undefined) ? manager : THREE.DefaultLoadingManager;\r\n\r\n};\r\n\r\nTHREE.BufferGeometryLoader.prototype = {\r\n\r\n  constructor: THREE.BufferGeometryLoader,\r\n\r\n  load: function(url, onLoad, onProgress, onError) {\r\n\r\n    var scope = this;\r\n\r\n    var loader = new THREE.XHRLoader(scope.manager);\r\n    loader.setCrossOrigin(this.crossOrigin);\r\n    loader.load(url, function(text) {\r\n\r\n      onLoad(scope.parse(JSON.parse(text)));\r\n\r\n    }, onProgress, onError);\r\n\r\n  },\r\n\r\n  setCrossOrigin: function(value) {\r\n\r\n    this.crossOrigin = value;\r\n\r\n  },\r\n\r\n  parse: function(json) {\r\n\r\n    var geometry = new THREE.BufferGeometry();\r\n\r\n    var attributes = json.data.attributes;\r\n\r\n    for (var key in attributes) {\r\n\r\n      var attribute = attributes[key];\r\n      var typedArray = new self[attribute.type](attribute.array);\r\n\r\n      geometry.addAttribute(key, new THREE.BufferAttribute(typedArray, attribute.itemSize));\r\n\r\n    }\r\n\r\n    var offsets = json.data.offsets;\r\n\r\n    if (offsets !== undefined) {\r\n\r\n      geometry.offsets = JSON.parse(JSON.stringify(offsets));\r\n\r\n    }\r\n\r\n    var boundingSphere = json.data.boundingSphere;\r\n\r\n    if (boundingSphere !== undefined) {\r\n\r\n      var center = new THREE.Vector3();\r\n\r\n      if (boundingSphere.center !== undefined) {\r\n\r\n        center.fromArray(boundingSphere.center);\r\n\r\n      }\r\n\r\n      geometry.boundingSphere = new THREE.Sphere(center, boundingSphere.radius);\r\n\r\n    }\r\n\r\n    return geometry;\r\n\r\n  }\r\n\r\n};\r\n\r\n// File:src/loaders/MaterialLoader.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.MaterialLoader = function(manager) {\r\n\r\n  this.manager = (manager !== undefined) ? manager : THREE.DefaultLoadingManager;\r\n\r\n};\r\n\r\nTHREE.MaterialLoader.prototype = {\r\n\r\n  constructor: THREE.MaterialLoader,\r\n\r\n  load: function(url, onLoad, onProgress, onError) {\r\n\r\n    var scope = this;\r\n\r\n    var loader = new THREE.XHRLoader(scope.manager);\r\n    loader.setCrossOrigin(this.crossOrigin);\r\n    loader.load(url, function(text) {\r\n\r\n      onLoad(scope.parse(JSON.parse(text)));\r\n\r\n    }, onProgress, onError);\r\n\r\n  },\r\n\r\n  setCrossOrigin: function(value) {\r\n\r\n    this.crossOrigin = value;\r\n\r\n  },\r\n\r\n  parse: function(json) {\r\n\r\n    var material = new THREE[json.type];\r\n\r\n    if (json.color !== undefined) material.color.setHex(json.color);\r\n    if (json.emissive !== undefined) material.emissive.setHex(json.emissive);\r\n    if (json.specular !== undefined) material.specular.setHex(json.specular);\r\n    if (json.shininess !== undefined) material.shininess = json.shininess;\r\n    if (json.uniforms !== undefined) material.uniforms = json.uniforms;\r\n    if (json.vertexShader !== undefined) material.vertexShader = json.vertexShader;\r\n    if (json.fragmentShader !== undefined) material.fragmentShader = json.fragmentShader;\r\n    if (json.vertexColors !== undefined) material.vertexColors = json.vertexColors;\r\n    if (json.shading !== undefined) material.shading = json.shading;\r\n    if (json.blending !== undefined) material.blending = json.blending;\r\n    if (json.side !== undefined) material.side = json.side;\r\n    if (json.opacity !== undefined) material.opacity = json.opacity;\r\n    if (json.transparent !== undefined) material.transparent = json.transparent;\r\n    if (json.wireframe !== undefined) material.wireframe = json.wireframe;\r\n\r\n    // for PointCloudMaterial\r\n    if (json.size !== undefined) material.size = json.size;\r\n    if (json.sizeAttenuation !== undefined) material.sizeAttenuation = json.sizeAttenuation;\r\n\r\n    if (json.materials !== undefined) {\r\n\r\n      for (var i = 0, l = json.materials.length; i < l; i++) {\r\n\r\n        material.materials.push(this.parse(json.materials[i]));\r\n\r\n      }\r\n\r\n    }\r\n\r\n    return material;\r\n\r\n  }\r\n\r\n};\r\n\r\n// File:src/loaders/ObjectLoader.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.ObjectLoader = function(manager) {\r\n\r\n  this.manager = (manager !== undefined) ? manager : THREE.DefaultLoadingManager;\r\n  this.texturePath = '';\r\n\r\n};\r\n\r\nTHREE.ObjectLoader.prototype = {\r\n\r\n  constructor: THREE.ObjectLoader,\r\n\r\n  load: function(url, onLoad, onProgress, onError) {\r\n\r\n    if (this.texturePath === '') {\r\n\r\n      this.texturePath = url.substring(0, url.lastIndexOf('/') + 1);\r\n\r\n    }\r\n\r\n    var scope = this;\r\n\r\n    var loader = new THREE.XHRLoader(scope.manager);\r\n    loader.setCrossOrigin(this.crossOrigin);\r\n    loader.load(url, function(text) {\r\n\r\n      scope.parse(JSON.parse(text), onLoad);\r\n\r\n    }, onProgress, onError);\r\n\r\n  },\r\n\r\n  setTexturePath: function(value) {\r\n\r\n    this.texturePath = value;\r\n\r\n  },\r\n\r\n  setCrossOrigin: function(value) {\r\n\r\n    this.crossOrigin = value;\r\n\r\n  },\r\n\r\n  parse: function(json, onLoad) {\r\n\r\n    var geometries = this.parseGeometries(json.geometries);\r\n\r\n    var images = this.parseImages(json.images, function() {\r\n\r\n      if (onLoad !== undefined) onLoad(object);\r\n\r\n    });\r\n    var textures = this.parseTextures(json.textures, images);\r\n    var materials = this.parseMaterials(json.materials, textures);\r\n    var object = this.parseObject(json.object, geometries, materials);\r\n\r\n    if (json.images === undefined || json.images.length === 0) {\r\n\r\n      if (onLoad !== undefined) onLoad(object);\r\n\r\n    }\r\n\r\n    return object;\r\n\r\n  },\r\n\r\n  parseGeometries: function(json) {\r\n\r\n    var geometries = {};\r\n\r\n    if (json !== undefined) {\r\n\r\n      var geometryLoader = new THREE.JSONLoader();\r\n      var bufferGeometryLoader = new THREE.BufferGeometryLoader();\r\n\r\n      for (var i = 0, l = json.length; i < l; i++) {\r\n\r\n        var geometry;\r\n        var data = json[i];\r\n\r\n        switch (data.type) {\r\n\r\n          case 'PlaneGeometry':\r\n          case 'PlaneBufferGeometry':\r\n\r\n            geometry = new THREE[data.type](\r\n              data.width,\r\n              data.height,\r\n              data.widthSegments,\r\n              data.heightSegments\r\n            );\r\n\r\n            break;\r\n\r\n          case 'BoxGeometry':\r\n          case 'CubeGeometry': // backwards compatible\r\n\r\n            geometry = new THREE.BoxGeometry(\r\n              data.width,\r\n              data.height,\r\n              data.depth,\r\n              data.widthSegments,\r\n              data.heightSegments,\r\n              data.depthSegments\r\n            );\r\n\r\n            break;\r\n\r\n          case 'CircleGeometry':\r\n\r\n            geometry = new THREE.CircleGeometry(\r\n              data.radius,\r\n              data.segments\r\n            );\r\n\r\n            break;\r\n\r\n          case 'CylinderGeometry':\r\n\r\n            geometry = new THREE.CylinderGeometry(\r\n              data.radiusTop,\r\n              data.radiusBottom,\r\n              data.height,\r\n              data.radialSegments,\r\n              data.heightSegments,\r\n              data.openEnded\r\n            );\r\n\r\n            break;\r\n\r\n          case 'SphereGeometry':\r\n\r\n            geometry = new THREE.SphereGeometry(\r\n              data.radius,\r\n              data.widthSegments,\r\n              data.heightSegments,\r\n              data.phiStart,\r\n              data.phiLength,\r\n              data.thetaStart,\r\n              data.thetaLength\r\n            );\r\n\r\n            break;\r\n\r\n          case 'IcosahedronGeometry':\r\n\r\n            geometry = new THREE.IcosahedronGeometry(\r\n              data.radius,\r\n              data.detail\r\n            );\r\n\r\n            break;\r\n\r\n          case 'TorusGeometry':\r\n\r\n            geometry = new THREE.TorusGeometry(\r\n              data.radius,\r\n              data.tube,\r\n              data.radialSegments,\r\n              data.tubularSegments,\r\n              data.arc\r\n            );\r\n\r\n            break;\r\n\r\n          case 'TorusKnotGeometry':\r\n\r\n            geometry = new THREE.TorusKnotGeometry(\r\n              data.radius,\r\n              data.tube,\r\n              data.radialSegments,\r\n              data.tubularSegments,\r\n              data.p,\r\n              data.q,\r\n              data.heightScale\r\n            );\r\n\r\n            break;\r\n\r\n          case 'BufferGeometry':\r\n\r\n            geometry = bufferGeometryLoader.parse(data);\r\n\r\n            break;\r\n\r\n          case 'Geometry':\r\n\r\n            geometry = geometryLoader.parse(data.data).geometry;\r\n\r\n            break;\r\n\r\n        }\r\n\r\n        geometry.uuid = data.uuid;\r\n\r\n        if (data.name !== undefined) geometry.name = data.name;\r\n\r\n        geometries[data.uuid] = geometry;\r\n\r\n      }\r\n\r\n    }\r\n\r\n    return geometries;\r\n\r\n  },\r\n\r\n  parseMaterials: function(json, textures) {\r\n\r\n    var materials = {};\r\n\r\n    if (json !== undefined) {\r\n\r\n      var getTexture = function(name) {\r\n\r\n        if (textures[name] === undefined) {\r\n\r\n          THREE.warn('THREE.ObjectLoader: Undefined texture', name);\r\n\r\n        }\r\n\r\n        return textures[name];\r\n\r\n      };\r\n\r\n      var loader = new THREE.MaterialLoader();\r\n\r\n      for (var i = 0, l = json.length; i < l; i++) {\r\n\r\n        var data = json[i];\r\n        var material = loader.parse(data);\r\n\r\n        material.uuid = data.uuid;\r\n\r\n        if (data.name !== undefined) material.name = data.name;\r\n\r\n        if (data.map !== undefined) {\r\n\r\n          material.map = getTexture(data.map);\r\n\r\n        }\r\n\r\n        if (data.bumpMap !== undefined) {\r\n\r\n          material.bumpMap = getTexture(data.bumpMap);\r\n          if (data.bumpScale) {\r\n            material.bumpScale = new THREE.Vector2(data.bumpScale, data.bumpScale);\r\n          }\r\n\r\n        }\r\n\r\n        if (data.alphaMap !== undefined) {\r\n\r\n          material.alphaMap = getTexture(data.alphaMap);\r\n\r\n        }\r\n\r\n        if (data.envMap !== undefined) {\r\n\r\n          material.envMap = getTexture(data.envMap);\r\n\r\n        }\r\n\r\n        if (data.normalMap !== undefined) {\r\n\r\n          material.normalMap = getTexture(data.normalMap);\r\n          if (data.normalScale) {\r\n            material.normalScale = new THREE.Vector2(data.normalScale, data.normalScale);\r\n          }\r\n\r\n        }\r\n\r\n        if (data.lightMap !== undefined) {\r\n\r\n          material.lightMap = getTexture(data.lightMap);\r\n\r\n        }\r\n\r\n        if (data.specularMap !== undefined) {\r\n\r\n          material.specularMap = getTexture(data.specularMap);\r\n\r\n        }\r\n\r\n        materials[data.uuid] = material;\r\n\r\n      }\r\n\r\n    }\r\n\r\n    return materials;\r\n\r\n  },\r\n\r\n  parseImages: function(json, onLoad) {\r\n\r\n    var scope = this;\r\n    var images = {};\r\n\r\n    if (json !== undefined && json.length > 0) {\r\n\r\n      var manager = new THREE.LoadingManager(onLoad);\r\n\r\n      var loader = new THREE.ImageLoader(manager);\r\n      loader.setCrossOrigin(this.crossOrigin);\r\n\r\n      var loadImage = function(url) {\r\n\r\n        scope.manager.itemStart(url);\r\n\r\n        return loader.load(url, function() {\r\n\r\n          scope.manager.itemEnd(url);\r\n\r\n        });\r\n\r\n      };\r\n\r\n      for (var i = 0, l = json.length; i < l; i++) {\r\n\r\n        var image = json[i];\r\n        var path = /^(\\/\\/)|([a-z]+:(\\/\\/)?)/i.test(image.url) ? image.url : scope.texturePath + image.url;\r\n\r\n        images[image.uuid] = loadImage(path);\r\n\r\n      }\r\n\r\n    }\r\n\r\n    return images;\r\n\r\n  },\r\n\r\n  parseTextures: function(json, images) {\r\n\r\n    var textures = {};\r\n\r\n    if (json !== undefined) {\r\n\r\n      for (var i = 0, l = json.length; i < l; i++) {\r\n\r\n        var data = json[i];\r\n\r\n        if (data.image === undefined) {\r\n\r\n          THREE.warn('THREE.ObjectLoader: No \"image\" speficied for', data.uuid);\r\n\r\n        }\r\n\r\n        if (images[data.image] === undefined) {\r\n\r\n          THREE.warn('THREE.ObjectLoader: Undefined image', data.image);\r\n\r\n        }\r\n\r\n        var texture = new THREE.Texture(images[data.image]);\r\n        texture.needsUpdate = true;\r\n\r\n        texture.uuid = data.uuid;\r\n\r\n        if (data.name !== undefined) texture.name = data.name;\r\n        if (data.repeat !== undefined) texture.repeat = new THREE.Vector2(data.repeat[0], data.repeat[1]);\r\n        if (data.minFilter !== undefined) texture.minFilter = THREE[data.minFilter];\r\n        if (data.magFilter !== undefined) texture.magFilter = THREE[data.magFilter];\r\n        if (data.anisotropy !== undefined) texture.anisotropy = data.anisotropy;\r\n        if (data.wrap instanceof Array) {\r\n\r\n          texture.wrapS = THREE[data.wrap[0]];\r\n          texture.wrapT = THREE[data.wrap[1]];\r\n\r\n        }\r\n\r\n        textures[data.uuid] = texture;\r\n\r\n      }\r\n\r\n    }\r\n\r\n    return textures;\r\n\r\n  },\r\n\r\n  parseObject: function() {\r\n\r\n    var matrix = new THREE.Matrix4();\r\n\r\n    return function(data, geometries, materials) {\r\n\r\n      var object;\r\n\r\n      var getGeometry = function(name) {\r\n\r\n        if (geometries[name] === undefined) {\r\n\r\n          THREE.warn('THREE.ObjectLoader: Undefined geometry', name);\r\n\r\n        }\r\n\r\n        return geometries[name];\r\n\r\n      };\r\n\r\n      var getMaterial = function(name) {\r\n\r\n        if (materials[name] === undefined) {\r\n\r\n          THREE.warn('THREE.ObjectLoader: Undefined material', name);\r\n\r\n        }\r\n\r\n        return materials[name];\r\n\r\n      };\r\n\r\n      switch (data.type) {\r\n\r\n        case 'Scene':\r\n\r\n          object = new THREE.Scene();\r\n\r\n          break;\r\n\r\n        case 'PerspectiveCamera':\r\n\r\n          object = new THREE.PerspectiveCamera(data.fov, data.aspect, data.near, data.far);\r\n\r\n          break;\r\n\r\n        case 'OrthographicCamera':\r\n\r\n          object = new THREE.OrthographicCamera(data.left, data.right, data.top, data.bottom, data.near, data.far);\r\n\r\n          break;\r\n\r\n        case 'AmbientLight':\r\n\r\n          object = new THREE.AmbientLight(data.color);\r\n\r\n          break;\r\n\r\n        case 'DirectionalLight':\r\n\r\n          object = new THREE.DirectionalLight(data.color, data.intensity);\r\n\r\n          break;\r\n\r\n        case 'PointLight':\r\n\r\n          object = new THREE.PointLight(data.color, data.intensity, data.distance, data.decay);\r\n\r\n          break;\r\n\r\n        case 'SpotLight':\r\n\r\n          object = new THREE.SpotLight(data.color, data.intensity, data.distance, data.angle, data.exponent, data.decay);\r\n\r\n          break;\r\n\r\n        case 'HemisphereLight':\r\n\r\n          object = new THREE.HemisphereLight(data.color, data.groundColor, data.intensity);\r\n\r\n          break;\r\n\r\n        case 'Mesh':\r\n\r\n          object = new THREE.Mesh(getGeometry(data.geometry), getMaterial(data.material));\r\n\r\n          break;\r\n\r\n        case 'Line':\r\n\r\n          object = new THREE.Line(getGeometry(data.geometry), getMaterial(data.material), data.mode);\r\n\r\n          break;\r\n\r\n        case 'PointCloud':\r\n\r\n          object = new THREE.PointCloud(getGeometry(data.geometry), getMaterial(data.material));\r\n\r\n          break;\r\n\r\n        case 'Sprite':\r\n\r\n          object = new THREE.Sprite(getMaterial(data.material));\r\n\r\n          break;\r\n\r\n        case 'Group':\r\n\r\n          object = new THREE.Group();\r\n\r\n          break;\r\n\r\n        default:\r\n\r\n          object = new THREE.Object3D();\r\n\r\n      }\r\n\r\n      object.uuid = data.uuid;\r\n\r\n      if (data.name !== undefined) object.name = data.name;\r\n      if (data.matrix !== undefined) {\r\n\r\n        matrix.fromArray(data.matrix);\r\n        matrix.decompose(object.position, object.quaternion, object.scale);\r\n\r\n      }\r\n      else {\r\n\r\n        if (data.position !== undefined) object.position.fromArray(data.position);\r\n        if (data.rotation !== undefined) object.rotation.fromArray(data.rotation);\r\n        if (data.scale !== undefined) object.scale.fromArray(data.scale);\r\n\r\n      }\r\n\r\n      if (data.visible !== undefined) object.visible = data.visible;\r\n      if (data.userData !== undefined) object.userData = data.userData;\r\n\r\n      if (data.children !== undefined) {\r\n\r\n        for (var child in data.children) {\r\n\r\n          object.add(this.parseObject(data.children[child], geometries, materials));\r\n\r\n        }\r\n\r\n      }\r\n\r\n      return object;\r\n\r\n    }\r\n\r\n  }()\r\n\r\n};\r\n\r\n// File:src/loaders/TextureLoader.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.TextureLoader = function(manager) {\r\n\r\n  this.manager = (manager !== undefined) ? manager : THREE.DefaultLoadingManager;\r\n\r\n};\r\n\r\nTHREE.TextureLoader.prototype = {\r\n\r\n  constructor: THREE.TextureLoader,\r\n\r\n  load: function(url, onLoad, onProgress, onError) {\r\n\r\n    var scope = this;\r\n\r\n    var loader = new THREE.ImageLoader(scope.manager);\r\n    loader.setCrossOrigin(this.crossOrigin);\r\n    loader.load(url, function(image) {\r\n\r\n      var texture = new THREE.Texture(image);\r\n      texture.needsUpdate = true;\r\n\r\n      if (onLoad !== undefined) {\r\n\r\n        onLoad(texture);\r\n\r\n      }\r\n\r\n    }, onProgress, onError);\r\n\r\n  },\r\n\r\n  setCrossOrigin: function(value) {\r\n\r\n    this.crossOrigin = value;\r\n\r\n  }\r\n\r\n};\r\n\r\n// File:src/loaders/BinaryTextureLoader.js\r\n\r\n/**\r\n * @author Nikos M. / https://github.com/foo123/\r\n *\r\n * Abstract Base class to load generic binary textures formats (rgbe, hdr, ...)\r\n */\r\n\r\nTHREE.DataTextureLoader = THREE.BinaryTextureLoader = function() {\r\n\r\n  // override in sub classes\r\n  this._parser = null;\r\n\r\n};\r\n\r\nTHREE.BinaryTextureLoader.prototype = {\r\n\r\n  constructor: THREE.BinaryTextureLoader,\r\n\r\n  load: function(url, onLoad, onProgress, onError) {\r\n\r\n    var scope = this;\r\n\r\n    var texture = new THREE.DataTexture();\r\n\r\n    var loader = new THREE.XHRLoader();\r\n    loader.setResponseType('arraybuffer');\r\n\r\n    loader.load(url, function(buffer) {\r\n\r\n      var texData = scope._parser(buffer);\r\n\r\n      if (!texData) return;\r\n\r\n      if (undefined !== texData.image) {\r\n\r\n        texture.image = texData.image;\r\n\r\n      }\r\n      else if (undefined !== texData.data) {\r\n\r\n        texture.image.width = texData.width;\r\n        texture.image.height = texData.height;\r\n        texture.image.data = texData.data;\r\n\r\n      }\r\n\r\n      texture.wrapS = undefined !== texData.wrapS ? texData.wrapS : THREE.ClampToEdgeWrapping;\r\n      texture.wrapT = undefined !== texData.wrapT ? texData.wrapT : THREE.ClampToEdgeWrapping;\r\n\r\n      texture.magFilter = undefined !== texData.magFilter ? texData.magFilter : THREE.LinearFilter;\r\n      texture.minFilter = undefined !== texData.minFilter ? texData.minFilter : THREE.LinearMipMapLinearFilter;\r\n\r\n      texture.anisotropy = undefined !== texData.anisotropy ? texData.anisotropy : 1;\r\n\r\n      if (undefined !== texData.format) {\r\n\r\n        texture.format = texData.format;\r\n\r\n      }\r\n      if (undefined !== texData.type) {\r\n\r\n        texture.type = texData.type;\r\n\r\n      }\r\n\r\n      if (undefined !== texData.mipmaps) {\r\n\r\n        texture.mipmaps = texData.mipmaps;\r\n\r\n      }\r\n\r\n      if (1 === texData.mipmapCount) {\r\n\r\n        texture.minFilter = THREE.LinearFilter;\r\n\r\n      }\r\n\r\n      texture.needsUpdate = true;\r\n\r\n      if (onLoad) onLoad(texture, texData);\r\n\r\n    }, onProgress, onError);\r\n\r\n\r\n    return texture;\r\n\r\n  }\r\n\r\n};\r\n\r\n// File:src/loaders/CompressedTextureLoader.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n *\r\n * Abstract Base class to block based textures loader (dds, pvr, ...)\r\n */\r\n\r\nTHREE.CompressedTextureLoader = function() {\r\n\r\n  // override in sub classes\r\n  this._parser = null;\r\n\r\n};\r\n\r\n\r\nTHREE.CompressedTextureLoader.prototype = {\r\n\r\n  constructor: THREE.CompressedTextureLoader,\r\n\r\n  load: function(url, onLoad, onError) {\r\n\r\n    var scope = this;\r\n\r\n    var images = [];\r\n\r\n    var texture = new THREE.CompressedTexture();\r\n    texture.image = images;\r\n\r\n    var loader = new THREE.XHRLoader();\r\n    loader.setResponseType('arraybuffer');\r\n\r\n    if (url instanceof Array) {\r\n\r\n      var loaded = 0;\r\n\r\n      var loadTexture = function(i) {\r\n\r\n        loader.load(url[i], function(buffer) {\r\n\r\n          var texDatas = scope._parser(buffer, true);\r\n\r\n          images[i] = {\r\n            width: texDatas.width,\r\n            height: texDatas.height,\r\n            format: texDatas.format,\r\n            mipmaps: texDatas.mipmaps\r\n          };\r\n\r\n          loaded += 1;\r\n\r\n          if (loaded === 6) {\r\n\r\n            if (texDatas.mipmapCount == 1)\r\n              texture.minFilter = THREE.LinearFilter;\r\n\r\n            texture.format = texDatas.format;\r\n            texture.needsUpdate = true;\r\n\r\n            if (onLoad) onLoad(texture);\r\n\r\n          }\r\n\r\n        });\r\n\r\n      };\r\n\r\n      for (var i = 0, il = url.length; i < il; ++i) {\r\n\r\n        loadTexture(i);\r\n\r\n      }\r\n\r\n    }\r\n    else {\r\n\r\n      // compressed cubemap texture stored in a single DDS file\r\n\r\n      loader.load(url, function(buffer) {\r\n\r\n        var texDatas = scope._parser(buffer, true);\r\n\r\n        if (texDatas.isCubemap) {\r\n\r\n          var faces = texDatas.mipmaps.length / texDatas.mipmapCount;\r\n\r\n          for (var f = 0; f < faces; f++) {\r\n\r\n            images[f] = {\r\n              mipmaps: []\r\n            };\r\n\r\n            for (var i = 0; i < texDatas.mipmapCount; i++) {\r\n\r\n              images[f].mipmaps.push(texDatas.mipmaps[f * texDatas.mipmapCount + i]);\r\n              images[f].format = texDatas.format;\r\n              images[f].width = texDatas.width;\r\n              images[f].height = texDatas.height;\r\n\r\n            }\r\n\r\n          }\r\n\r\n        }\r\n        else {\r\n\r\n          texture.image.width = texDatas.width;\r\n          texture.image.height = texDatas.height;\r\n          texture.mipmaps = texDatas.mipmaps;\r\n\r\n        }\r\n\r\n        if (texDatas.mipmapCount === 1) {\r\n\r\n          texture.minFilter = THREE.LinearFilter;\r\n\r\n        }\r\n\r\n        texture.format = texDatas.format;\r\n        texture.needsUpdate = true;\r\n\r\n        if (onLoad) onLoad(texture);\r\n\r\n      });\r\n\r\n    }\r\n\r\n    return texture;\r\n\r\n  }\r\n\r\n};\r\n\r\n// File:src/materials/Material.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author alteredq / http://alteredqualia.com/\r\n */\r\n\r\nTHREE.Material = function() {\r\n\r\n  Object.defineProperty(this, 'id', {\r\n    value: THREE.MaterialIdCount++\r\n  });\r\n\r\n  this.uuid = THREE.Math.generateUUID();\r\n\r\n  this.name = '';\r\n  this.type = 'Material';\r\n\r\n  this.side = THREE.FrontSide;\r\n\r\n  this.opacity = 1;\r\n  this.transparent = false;\r\n\r\n  this.blending = THREE.NormalBlending;\r\n\r\n  this.blendSrc = THREE.SrcAlphaFactor;\r\n  this.blendDst = THREE.OneMinusSrcAlphaFactor;\r\n  this.blendEquation = THREE.AddEquation;\r\n  this.blendSrcAlpha = null;\r\n  this.blendDstAlpha = null;\r\n  this.blendEquationAlpha = null;\r\n\r\n  this.depthTest = true;\r\n  this.depthWrite = true;\r\n\r\n  this.colorWrite = true;\r\n\r\n  this.polygonOffset = false;\r\n  this.polygonOffsetFactor = 0;\r\n  this.polygonOffsetUnits = 0;\r\n\r\n  this.alphaTest = 0;\r\n\r\n  this.overdraw = 0; // Overdrawn pixels (typically between 0 and 1) for fixing antialiasing gaps in CanvasRenderer\r\n\r\n  this.visible = true;\r\n\r\n  this._needsUpdate = true;\r\n\r\n};\r\n\r\nTHREE.Material.prototype = {\r\n\r\n  constructor: THREE.Material,\r\n\r\n  get needsUpdate() {\r\n\r\n    return this._needsUpdate;\r\n\r\n  },\r\n\r\n  set needsUpdate(value) {\r\n\r\n    if (value === true) this.update();\r\n\r\n    this._needsUpdate = value;\r\n\r\n  },\r\n\r\n  setValues: function(values) {\r\n\r\n    if (values === undefined) return;\r\n\r\n    for (var key in values) {\r\n\r\n      var newValue = values[key];\r\n\r\n      if (newValue === undefined) {\r\n\r\n        THREE.warn(\"THREE.Material: '\" + key + \"' parameter is undefined.\");\r\n        continue;\r\n\r\n      }\r\n\r\n      if (key in this) {\r\n\r\n        var currentValue = this[key];\r\n\r\n        if (currentValue instanceof THREE.Color) {\r\n\r\n          currentValue.set(newValue);\r\n\r\n        }\r\n        else if (currentValue instanceof THREE.Vector3 && newValue instanceof THREE.Vector3) {\r\n\r\n          currentValue.copy(newValue);\r\n\r\n        }\r\n        else if (key == 'overdraw') {\r\n\r\n          // ensure overdraw is backwards-compatable with legacy boolean type\r\n          this[key] = Number(newValue);\r\n\r\n        }\r\n        else {\r\n\r\n          this[key] = newValue;\r\n\r\n        }\r\n\r\n      }\r\n\r\n    }\r\n\r\n  },\r\n\r\n  toJSON: function() {\r\n\r\n    var output = {\r\n      metadata: {\r\n        version: 4.2,\r\n        type: 'material',\r\n        generator: 'MaterialExporter'\r\n      },\r\n      uuid: this.uuid,\r\n      type: this.type\r\n    };\r\n\r\n    if (this.name !== \"\") output.name = this.name;\r\n\r\n    if (this instanceof THREE.MeshBasicMaterial) {\r\n\r\n      output.color = this.color.getHex();\r\n      if (this.vertexColors !== THREE.NoColors) output.vertexColors = this.vertexColors;\r\n      if (this.blending !== THREE.NormalBlending) output.blending = this.blending;\r\n      if (this.side !== THREE.FrontSide) output.side = this.side;\r\n\r\n    }\r\n    else if (this instanceof THREE.MeshLambertMaterial) {\r\n\r\n      output.color = this.color.getHex();\r\n      output.emissive = this.emissive.getHex();\r\n      if (this.vertexColors !== THREE.NoColors) output.vertexColors = this.vertexColors;\r\n      if (this.shading !== THREE.SmoothShading) output.shading = this.shading;\r\n      if (this.blending !== THREE.NormalBlending) output.blending = this.blending;\r\n      if (this.side !== THREE.FrontSide) output.side = this.side;\r\n\r\n    }\r\n    else if (this instanceof THREE.MeshPhongMaterial) {\r\n\r\n      output.color = this.color.getHex();\r\n      output.emissive = this.emissive.getHex();\r\n      output.specular = this.specular.getHex();\r\n      output.shininess = this.shininess;\r\n      if (this.vertexColors !== THREE.NoColors) output.vertexColors = this.vertexColors;\r\n      if (this.shading !== THREE.SmoothShading) output.shading = this.shading;\r\n      if (this.blending !== THREE.NormalBlending) output.blending = this.blending;\r\n      if (this.side !== THREE.FrontSide) output.side = this.side;\r\n\r\n    }\r\n    else if (this instanceof THREE.MeshNormalMaterial) {\r\n\r\n      if (this.blending !== THREE.NormalBlending) output.blending = this.blending;\r\n      if (this.side !== THREE.FrontSide) output.side = this.side;\r\n\r\n    }\r\n    else if (this instanceof THREE.MeshDepthMaterial) {\r\n\r\n      if (this.blending !== THREE.NormalBlending) output.blending = this.blending;\r\n      if (this.side !== THREE.FrontSide) output.side = this.side;\r\n\r\n    }\r\n    else if (this instanceof THREE.PointCloudMaterial) {\r\n\r\n      output.size = this.size;\r\n      output.sizeAttenuation = this.sizeAttenuation;\r\n      output.color = this.color.getHex();\r\n\r\n      if (this.vertexColors !== THREE.NoColors) output.vertexColors = this.vertexColors;\r\n      if (this.blending !== THREE.NormalBlending) output.blending = this.blending;\r\n\r\n    }\r\n    else if (this instanceof THREE.ShaderMaterial) {\r\n\r\n      output.uniforms = this.uniforms;\r\n      output.vertexShader = this.vertexShader;\r\n      output.fragmentShader = this.fragmentShader;\r\n\r\n    }\r\n    else if (this instanceof THREE.SpriteMaterial) {\r\n\r\n      output.color = this.color.getHex();\r\n\r\n    }\r\n\r\n    if (this.opacity < 1) output.opacity = this.opacity;\r\n    if (this.transparent !== false) output.transparent = this.transparent;\r\n    if (this.wireframe !== false) output.wireframe = this.wireframe;\r\n\r\n    return output;\r\n\r\n  },\r\n\r\n  clone: function(material) {\r\n\r\n    if (material === undefined) material = new THREE.Material();\r\n\r\n    material.name = this.name;\r\n\r\n    material.side = this.side;\r\n\r\n    material.opacity = this.opacity;\r\n    material.transparent = this.transparent;\r\n\r\n    material.blending = this.blending;\r\n\r\n    material.blendSrc = this.blendSrc;\r\n    material.blendDst = this.blendDst;\r\n    material.blendEquation = this.blendEquation;\r\n    material.blendSrcAlpha = this.blendSrcAlpha;\r\n    material.blendDstAlpha = this.blendDstAlpha;\r\n    material.blendEquationAlpha = this.blendEquationAlpha;\r\n\r\n    material.depthTest = this.depthTest;\r\n    material.depthWrite = this.depthWrite;\r\n\r\n    material.polygonOffset = this.polygonOffset;\r\n    material.polygonOffsetFactor = this.polygonOffsetFactor;\r\n    material.polygonOffsetUnits = this.polygonOffsetUnits;\r\n\r\n    material.alphaTest = this.alphaTest;\r\n\r\n    material.overdraw = this.overdraw;\r\n\r\n    material.visible = this.visible;\r\n\r\n    return material;\r\n\r\n  },\r\n\r\n  update: function() {\r\n\r\n    this.dispatchEvent({\r\n      type: 'update'\r\n    });\r\n\r\n  },\r\n\r\n  dispose: function() {\r\n\r\n    this.dispatchEvent({\r\n      type: 'dispose'\r\n    });\r\n\r\n  }\r\n\r\n};\r\n\r\nTHREE.EventDispatcher.prototype.apply(THREE.Material.prototype);\r\n\r\nTHREE.MaterialIdCount = 0;\r\n\r\n// File:src/materials/LineBasicMaterial.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author alteredq / http://alteredqualia.com/\r\n *\r\n * parameters = {\r\n *  color: <hex>,\r\n *  opacity: <float>,\r\n *\r\n *  blending: THREE.NormalBlending,\r\n *  depthTest: <bool>,\r\n *  depthWrite: <bool>,\r\n *\r\n *  linewidth: <float>,\r\n *  linecap: \"round\",\r\n *  linejoin: \"round\",\r\n *\r\n *  vertexColors: <bool>\r\n *\r\n *  fog: <bool>\r\n * }\r\n */\r\n\r\nTHREE.LineBasicMaterial = function(parameters) {\r\n\r\n  THREE.Material.call(this);\r\n\r\n  this.type = 'LineBasicMaterial';\r\n\r\n  this.color = new THREE.Color(0xffffff);\r\n\r\n  this.linewidth = 1;\r\n  this.linecap = 'round';\r\n  this.linejoin = 'round';\r\n\r\n  this.vertexColors = THREE.NoColors;\r\n\r\n  this.fog = true;\r\n\r\n  this.setValues(parameters);\r\n\r\n};\r\n\r\nTHREE.LineBasicMaterial.prototype = Object.create(THREE.Material.prototype);\r\nTHREE.LineBasicMaterial.prototype.constructor = THREE.LineBasicMaterial;\r\n\r\nTHREE.LineBasicMaterial.prototype.clone = function() {\r\n\r\n  var material = new THREE.LineBasicMaterial();\r\n\r\n  THREE.Material.prototype.clone.call(this, material);\r\n\r\n  material.color.copy(this.color);\r\n\r\n  material.linewidth = this.linewidth;\r\n  material.linecap = this.linecap;\r\n  material.linejoin = this.linejoin;\r\n\r\n  material.vertexColors = this.vertexColors;\r\n\r\n  material.fog = this.fog;\r\n\r\n  return material;\r\n\r\n};\r\n\r\n// File:src/materials/LineDashedMaterial.js\r\n\r\n/**\r\n * @author alteredq / http://alteredqualia.com/\r\n *\r\n * parameters = {\r\n *  color: <hex>,\r\n *  opacity: <float>,\r\n *\r\n *  blending: THREE.NormalBlending,\r\n *  depthTest: <bool>,\r\n *  depthWrite: <bool>,\r\n *\r\n *  linewidth: <float>,\r\n *\r\n *  scale: <float>,\r\n *  dashSize: <float>,\r\n *  gapSize: <float>,\r\n *\r\n *  vertexColors: <bool>\r\n *\r\n *  fog: <bool>\r\n * }\r\n */\r\n\r\nTHREE.LineDashedMaterial = function(parameters) {\r\n\r\n  THREE.Material.call(this);\r\n\r\n  this.type = 'LineDashedMaterial';\r\n\r\n  this.color = new THREE.Color(0xffffff);\r\n\r\n  this.linewidth = 1;\r\n\r\n  this.scale = 1;\r\n  this.dashSize = 3;\r\n  this.gapSize = 1;\r\n\r\n  this.vertexColors = false;\r\n\r\n  this.fog = true;\r\n\r\n  this.setValues(parameters);\r\n\r\n};\r\n\r\nTHREE.LineDashedMaterial.prototype = Object.create(THREE.Material.prototype);\r\nTHREE.LineDashedMaterial.prototype.constructor = THREE.LineDashedMaterial;\r\n\r\nTHREE.LineDashedMaterial.prototype.clone = function() {\r\n\r\n  var material = new THREE.LineDashedMaterial();\r\n\r\n  THREE.Material.prototype.clone.call(this, material);\r\n\r\n  material.color.copy(this.color);\r\n\r\n  material.linewidth = this.linewidth;\r\n\r\n  material.scale = this.scale;\r\n  material.dashSize = this.dashSize;\r\n  material.gapSize = this.gapSize;\r\n\r\n  material.vertexColors = this.vertexColors;\r\n\r\n  material.fog = this.fog;\r\n\r\n  return material;\r\n\r\n};\r\n\r\n// File:src/materials/MeshBasicMaterial.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author alteredq / http://alteredqualia.com/\r\n *\r\n * parameters = {\r\n *  color: <hex>,\r\n *  opacity: <float>,\r\n *  map: new THREE.Texture( <Image> ),\r\n *\r\n *  lightMap: new THREE.Texture( <Image> ),\r\n *\r\n *  specularMap: new THREE.Texture( <Image> ),\r\n *\r\n *  alphaMap: new THREE.Texture( <Image> ),\r\n *\r\n *  envMap: new THREE.TextureCube( [posx, negx, posy, negy, posz, negz] ),\r\n *  combine: THREE.Multiply,\r\n *  reflectivity: <float>,\r\n *  refractionRatio: <float>,\r\n *\r\n *  shading: THREE.SmoothShading,\r\n *  blending: THREE.NormalBlending,\r\n *  depthTest: <bool>,\r\n *  depthWrite: <bool>,\r\n *\r\n *  wireframe: <boolean>,\r\n *  wireframeLinewidth: <float>,\r\n *\r\n *  vertexColors: THREE.NoColors / THREE.VertexColors / THREE.FaceColors,\r\n *\r\n *  skinning: <bool>,\r\n *  morphTargets: <bool>,\r\n *\r\n *  fog: <bool>\r\n * }\r\n */\r\n\r\nTHREE.MeshBasicMaterial = function(parameters) {\r\n\r\n  THREE.Material.call(this);\r\n\r\n  this.type = 'MeshBasicMaterial';\r\n\r\n  this.color = new THREE.Color(0xffffff); // emissive\r\n\r\n  this.map = null;\r\n\r\n  this.lightMap = null;\r\n\r\n  this.specularMap = null;\r\n\r\n  this.alphaMap = null;\r\n\r\n  this.envMap = null;\r\n  this.combine = THREE.MultiplyOperation;\r\n  this.reflectivity = 1;\r\n  this.refractionRatio = 0.98;\r\n\r\n  this.fog = true;\r\n\r\n  this.shading = THREE.SmoothShading;\r\n\r\n  this.wireframe = false;\r\n  this.wireframeLinewidth = 1;\r\n  this.wireframeLinecap = 'round';\r\n  this.wireframeLinejoin = 'round';\r\n\r\n  this.vertexColors = THREE.NoColors;\r\n\r\n  this.skinning = false;\r\n  this.morphTargets = false;\r\n\r\n  this.setValues(parameters);\r\n\r\n};\r\n\r\nTHREE.MeshBasicMaterial.prototype = Object.create(THREE.Material.prototype);\r\nTHREE.MeshBasicMaterial.prototype.constructor = THREE.MeshBasicMaterial;\r\n\r\nTHREE.MeshBasicMaterial.prototype.clone = function() {\r\n\r\n  var material = new THREE.MeshBasicMaterial();\r\n\r\n  THREE.Material.prototype.clone.call(this, material);\r\n\r\n  material.color.copy(this.color);\r\n\r\n  material.map = this.map;\r\n\r\n  material.lightMap = this.lightMap;\r\n\r\n  material.specularMap = this.specularMap;\r\n\r\n  material.alphaMap = this.alphaMap;\r\n\r\n  material.envMap = this.envMap;\r\n  material.combine = this.combine;\r\n  material.reflectivity = this.reflectivity;\r\n  material.refractionRatio = this.refractionRatio;\r\n\r\n  material.fog = this.fog;\r\n\r\n  material.shading = this.shading;\r\n\r\n  material.wireframe = this.wireframe;\r\n  material.wireframeLinewidth = this.wireframeLinewidth;\r\n  material.wireframeLinecap = this.wireframeLinecap;\r\n  material.wireframeLinejoin = this.wireframeLinejoin;\r\n\r\n  material.vertexColors = this.vertexColors;\r\n\r\n  material.skinning = this.skinning;\r\n  material.morphTargets = this.morphTargets;\r\n\r\n  return material;\r\n\r\n};\r\n\r\n// File:src/materials/MeshLambertMaterial.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author alteredq / http://alteredqualia.com/\r\n *\r\n * parameters = {\r\n *  color: <hex>,\r\n *  emissive: <hex>,\r\n *  opacity: <float>,\r\n *\r\n *  map: new THREE.Texture( <Image> ),\r\n *\r\n *  lightMap: new THREE.Texture( <Image> ),\r\n *\r\n *  specularMap: new THREE.Texture( <Image> ),\r\n *\r\n *  alphaMap: new THREE.Texture( <Image> ),\r\n *\r\n *  envMap: new THREE.TextureCube( [posx, negx, posy, negy, posz, negz] ),\r\n *  combine: THREE.Multiply,\r\n *  reflectivity: <float>,\r\n *  refractionRatio: <float>,\r\n *\r\n *  shading: THREE.SmoothShading,\r\n *  blending: THREE.NormalBlending,\r\n *  depthTest: <bool>,\r\n *  depthWrite: <bool>,\r\n *\r\n *  wireframe: <boolean>,\r\n *  wireframeLinewidth: <float>,\r\n *\r\n *  vertexColors: THREE.NoColors / THREE.VertexColors / THREE.FaceColors,\r\n *\r\n *  skinning: <bool>,\r\n *  morphTargets: <bool>,\r\n *  morphNormals: <bool>,\r\n *\r\n *\tfog: <bool>\r\n * }\r\n */\r\n\r\nTHREE.MeshLambertMaterial = function(parameters) {\r\n\r\n  THREE.Material.call(this);\r\n\r\n  this.type = 'MeshLambertMaterial';\r\n\r\n  this.color = new THREE.Color(0xffffff); // diffuse\r\n  this.emissive = new THREE.Color(0x000000);\r\n\r\n  this.wrapAround = false;\r\n  this.wrapRGB = new THREE.Vector3(1, 1, 1);\r\n\r\n  this.map = null;\r\n\r\n  this.lightMap = null;\r\n\r\n  this.specularMap = null;\r\n\r\n  this.alphaMap = null;\r\n\r\n  this.envMap = null;\r\n  this.combine = THREE.MultiplyOperation;\r\n  this.reflectivity = 1;\r\n  this.refractionRatio = 0.98;\r\n\r\n  this.fog = true;\r\n\r\n  this.shading = THREE.SmoothShading;\r\n\r\n  this.wireframe = false;\r\n  this.wireframeLinewidth = 1;\r\n  this.wireframeLinecap = 'round';\r\n  this.wireframeLinejoin = 'round';\r\n\r\n  this.vertexColors = THREE.NoColors;\r\n\r\n  this.skinning = false;\r\n  this.morphTargets = false;\r\n  this.morphNormals = false;\r\n\r\n  this.setValues(parameters);\r\n\r\n};\r\n\r\nTHREE.MeshLambertMaterial.prototype = Object.create(THREE.Material.prototype);\r\nTHREE.MeshLambertMaterial.prototype.constructor = THREE.MeshLambertMaterial;\r\n\r\nTHREE.MeshLambertMaterial.prototype.clone = function() {\r\n\r\n  var material = new THREE.MeshLambertMaterial();\r\n\r\n  THREE.Material.prototype.clone.call(this, material);\r\n\r\n  material.color.copy(this.color);\r\n  material.emissive.copy(this.emissive);\r\n\r\n  material.wrapAround = this.wrapAround;\r\n  material.wrapRGB.copy(this.wrapRGB);\r\n\r\n  material.map = this.map;\r\n\r\n  material.lightMap = this.lightMap;\r\n\r\n  material.specularMap = this.specularMap;\r\n\r\n  material.alphaMap = this.alphaMap;\r\n\r\n  material.envMap = this.envMap;\r\n  material.combine = this.combine;\r\n  material.reflectivity = this.reflectivity;\r\n  material.refractionRatio = this.refractionRatio;\r\n\r\n  material.fog = this.fog;\r\n\r\n  material.shading = this.shading;\r\n\r\n  material.wireframe = this.wireframe;\r\n  material.wireframeLinewidth = this.wireframeLinewidth;\r\n  material.wireframeLinecap = this.wireframeLinecap;\r\n  material.wireframeLinejoin = this.wireframeLinejoin;\r\n\r\n  material.vertexColors = this.vertexColors;\r\n\r\n  material.skinning = this.skinning;\r\n  material.morphTargets = this.morphTargets;\r\n  material.morphNormals = this.morphNormals;\r\n\r\n  return material;\r\n\r\n};\r\n\r\n// File:src/materials/MeshPhongMaterial.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author alteredq / http://alteredqualia.com/\r\n *\r\n * parameters = {\r\n *  color: <hex>,\r\n *  emissive: <hex>,\r\n *  specular: <hex>,\r\n *  shininess: <float>,\r\n *  opacity: <float>,\r\n *\r\n *  map: new THREE.Texture( <Image> ),\r\n *\r\n *  lightMap: new THREE.Texture( <Image> ),\r\n *\r\n *  bumpMap: new THREE.Texture( <Image> ),\r\n *  bumpScale: <float>,\r\n *\r\n *  normalMap: new THREE.Texture( <Image> ),\r\n *  normalScale: <Vector2>,\r\n *\r\n *  specularMap: new THREE.Texture( <Image> ),\r\n *\r\n *  alphaMap: new THREE.Texture( <Image> ),\r\n *\r\n *  envMap: new THREE.TextureCube( [posx, negx, posy, negy, posz, negz] ),\r\n *  combine: THREE.Multiply,\r\n *  reflectivity: <float>,\r\n *  refractionRatio: <float>,\r\n *\r\n *  shading: THREE.SmoothShading,\r\n *  blending: THREE.NormalBlending,\r\n *  depthTest: <bool>,\r\n *  depthWrite: <bool>,\r\n *\r\n *  wireframe: <boolean>,\r\n *  wireframeLinewidth: <float>,\r\n *\r\n *  vertexColors: THREE.NoColors / THREE.VertexColors / THREE.FaceColors,\r\n *\r\n *  skinning: <bool>,\r\n *  morphTargets: <bool>,\r\n *  morphNormals: <bool>,\r\n *\r\n *\tfog: <bool>\r\n * }\r\n */\r\n\r\nTHREE.MeshPhongMaterial = function(parameters) {\r\n\r\n  THREE.Material.call(this);\r\n\r\n  this.type = 'MeshPhongMaterial';\r\n\r\n  this.color = new THREE.Color(0xffffff); // diffuse\r\n  this.emissive = new THREE.Color(0x000000);\r\n  this.specular = new THREE.Color(0x111111);\r\n  this.shininess = 30;\r\n\r\n  this.metal = false;\r\n\r\n  this.wrapAround = false;\r\n  this.wrapRGB = new THREE.Vector3(1, 1, 1);\r\n\r\n  this.map = null;\r\n\r\n  this.lightMap = null;\r\n\r\n  this.bumpMap = null;\r\n  this.bumpScale = 1;\r\n\r\n  this.normalMap = null;\r\n  this.normalScale = new THREE.Vector2(1, 1);\r\n\r\n  this.specularMap = null;\r\n\r\n  this.alphaMap = null;\r\n\r\n  this.envMap = null;\r\n  this.combine = THREE.MultiplyOperation;\r\n  this.reflectivity = 1;\r\n  this.refractionRatio = 0.98;\r\n\r\n  this.fog = true;\r\n\r\n  this.shading = THREE.SmoothShading;\r\n\r\n  this.wireframe = false;\r\n  this.wireframeLinewidth = 1;\r\n  this.wireframeLinecap = 'round';\r\n  this.wireframeLinejoin = 'round';\r\n\r\n  this.vertexColors = THREE.NoColors;\r\n\r\n  this.skinning = false;\r\n  this.morphTargets = false;\r\n  this.morphNormals = false;\r\n\r\n  this.setValues(parameters);\r\n\r\n};\r\n\r\nTHREE.MeshPhongMaterial.prototype = Object.create(THREE.Material.prototype);\r\nTHREE.MeshPhongMaterial.prototype.constructor = THREE.MeshPhongMaterial;\r\n\r\nTHREE.MeshPhongMaterial.prototype.clone = function() {\r\n\r\n  var material = new THREE.MeshPhongMaterial();\r\n\r\n  THREE.Material.prototype.clone.call(this, material);\r\n\r\n  material.color.copy(this.color);\r\n  material.emissive.copy(this.emissive);\r\n  material.specular.copy(this.specular);\r\n  material.shininess = this.shininess;\r\n\r\n  material.metal = this.metal;\r\n\r\n  material.wrapAround = this.wrapAround;\r\n  material.wrapRGB.copy(this.wrapRGB);\r\n\r\n  material.map = this.map;\r\n\r\n  material.lightMap = this.lightMap;\r\n\r\n  material.bumpMap = this.bumpMap;\r\n  material.bumpScale = this.bumpScale;\r\n\r\n  material.normalMap = this.normalMap;\r\n  material.normalScale.copy(this.normalScale);\r\n\r\n  material.specularMap = this.specularMap;\r\n\r\n  material.alphaMap = this.alphaMap;\r\n\r\n  material.envMap = this.envMap;\r\n  material.combine = this.combine;\r\n  material.reflectivity = this.reflectivity;\r\n  material.refractionRatio = this.refractionRatio;\r\n\r\n  material.fog = this.fog;\r\n\r\n  material.shading = this.shading;\r\n\r\n  material.wireframe = this.wireframe;\r\n  material.wireframeLinewidth = this.wireframeLinewidth;\r\n  material.wireframeLinecap = this.wireframeLinecap;\r\n  material.wireframeLinejoin = this.wireframeLinejoin;\r\n\r\n  material.vertexColors = this.vertexColors;\r\n\r\n  material.skinning = this.skinning;\r\n  material.morphTargets = this.morphTargets;\r\n  material.morphNormals = this.morphNormals;\r\n\r\n  return material;\r\n\r\n};\r\n\r\n// File:src/materials/MeshDepthMaterial.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author alteredq / http://alteredqualia.com/\r\n *\r\n * parameters = {\r\n *  opacity: <float>,\r\n *\r\n *  blending: THREE.NormalBlending,\r\n *  depthTest: <bool>,\r\n *  depthWrite: <bool>,\r\n *\r\n *  wireframe: <boolean>,\r\n *  wireframeLinewidth: <float>\r\n * }\r\n */\r\n\r\nTHREE.MeshDepthMaterial = function(parameters) {\r\n\r\n  THREE.Material.call(this);\r\n\r\n  this.type = 'MeshDepthMaterial';\r\n\r\n  this.morphTargets = false;\r\n  this.wireframe = false;\r\n  this.wireframeLinewidth = 1;\r\n\r\n  this.setValues(parameters);\r\n\r\n};\r\n\r\nTHREE.MeshDepthMaterial.prototype = Object.create(THREE.Material.prototype);\r\nTHREE.MeshDepthMaterial.prototype.constructor = THREE.MeshDepthMaterial;\r\n\r\nTHREE.MeshDepthMaterial.prototype.clone = function() {\r\n\r\n  var material = new THREE.MeshDepthMaterial();\r\n\r\n  THREE.Material.prototype.clone.call(this, material);\r\n\r\n  material.wireframe = this.wireframe;\r\n  material.wireframeLinewidth = this.wireframeLinewidth;\r\n\r\n  return material;\r\n\r\n};\r\n\r\n// File:src/materials/MeshNormalMaterial.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n *\r\n * parameters = {\r\n *  opacity: <float>,\r\n *\r\n *  shading: THREE.FlatShading,\r\n *  blending: THREE.NormalBlending,\r\n *  depthTest: <bool>,\r\n *  depthWrite: <bool>,\r\n *\r\n *  wireframe: <boolean>,\r\n *  wireframeLinewidth: <float>\r\n * }\r\n */\r\n\r\nTHREE.MeshNormalMaterial = function(parameters) {\r\n\r\n  THREE.Material.call(this, parameters);\r\n\r\n  this.type = 'MeshNormalMaterial';\r\n\r\n  this.wireframe = false;\r\n  this.wireframeLinewidth = 1;\r\n\r\n  this.morphTargets = false;\r\n\r\n  this.setValues(parameters);\r\n\r\n};\r\n\r\nTHREE.MeshNormalMaterial.prototype = Object.create(THREE.Material.prototype);\r\nTHREE.MeshNormalMaterial.prototype.constructor = THREE.MeshNormalMaterial;\r\n\r\nTHREE.MeshNormalMaterial.prototype.clone = function() {\r\n\r\n  var material = new THREE.MeshNormalMaterial();\r\n\r\n  THREE.Material.prototype.clone.call(this, material);\r\n\r\n  material.wireframe = this.wireframe;\r\n  material.wireframeLinewidth = this.wireframeLinewidth;\r\n\r\n  return material;\r\n\r\n};\r\n\r\n// File:src/materials/MeshFaceMaterial.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.MeshFaceMaterial = function(materials) {\r\n\r\n  this.uuid = THREE.Math.generateUUID();\r\n\r\n  this.type = 'MeshFaceMaterial';\r\n\r\n  this.materials = materials instanceof Array ? materials : [];\r\n\r\n};\r\n\r\nTHREE.MeshFaceMaterial.prototype = {\r\n\r\n  constructor: THREE.MeshFaceMaterial,\r\n\r\n  toJSON: function() {\r\n\r\n    var output = {\r\n      metadata: {\r\n        version: 4.2,\r\n        type: 'material',\r\n        generator: 'MaterialExporter'\r\n      },\r\n      uuid: this.uuid,\r\n      type: this.type,\r\n      materials: []\r\n    };\r\n\r\n    for (var i = 0, l = this.materials.length; i < l; i++) {\r\n\r\n      output.materials.push(this.materials[i].toJSON());\r\n\r\n    }\r\n\r\n    return output;\r\n\r\n  },\r\n\r\n  clone: function() {\r\n\r\n    var material = new THREE.MeshFaceMaterial();\r\n\r\n    for (var i = 0; i < this.materials.length; i++) {\r\n\r\n      material.materials.push(this.materials[i].clone());\r\n\r\n    }\r\n\r\n    return material;\r\n\r\n  }\r\n\r\n};\r\n\r\n// File:src/materials/PointCloudMaterial.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author alteredq / http://alteredqualia.com/\r\n *\r\n * parameters = {\r\n *  color: <hex>,\r\n *  opacity: <float>,\r\n *  map: new THREE.Texture( <Image> ),\r\n *\r\n *  size: <float>,\r\n *  sizeAttenuation: <bool>,\r\n *\r\n *  blending: THREE.NormalBlending,\r\n *  depthTest: <bool>,\r\n *  depthWrite: <bool>,\r\n *\r\n *  vertexColors: <bool>,\r\n *\r\n *  fog: <bool>\r\n * }\r\n */\r\n\r\nTHREE.PointCloudMaterial = function(parameters) {\r\n\r\n  THREE.Material.call(this);\r\n\r\n  this.type = 'PointCloudMaterial';\r\n\r\n  this.color = new THREE.Color(0xffffff);\r\n\r\n  this.map = null;\r\n\r\n  this.size = 1;\r\n  this.sizeAttenuation = true;\r\n\r\n  this.vertexColors = THREE.NoColors;\r\n\r\n  this.fog = true;\r\n\r\n  this.setValues(parameters);\r\n\r\n};\r\n\r\nTHREE.PointCloudMaterial.prototype = Object.create(THREE.Material.prototype);\r\nTHREE.PointCloudMaterial.prototype.constructor = THREE.PointCloudMaterial;\r\n\r\nTHREE.PointCloudMaterial.prototype.clone = function() {\r\n\r\n  var material = new THREE.PointCloudMaterial();\r\n\r\n  THREE.Material.prototype.clone.call(this, material);\r\n\r\n  material.color.copy(this.color);\r\n\r\n  material.map = this.map;\r\n\r\n  material.size = this.size;\r\n  material.sizeAttenuation = this.sizeAttenuation;\r\n\r\n  material.vertexColors = this.vertexColors;\r\n\r\n  material.fog = this.fog;\r\n\r\n  return material;\r\n\r\n};\r\n\r\n// backwards compatibility\r\n\r\nTHREE.ParticleBasicMaterial = function(parameters) {\r\n\r\n  THREE.warn('THREE.ParticleBasicMaterial has been renamed to THREE.PointCloudMaterial.');\r\n  return new THREE.PointCloudMaterial(parameters);\r\n\r\n};\r\n\r\nTHREE.ParticleSystemMaterial = function(parameters) {\r\n\r\n  THREE.warn('THREE.ParticleSystemMaterial has been renamed to THREE.PointCloudMaterial.');\r\n  return new THREE.PointCloudMaterial(parameters);\r\n\r\n};\r\n\r\n// File:src/materials/ShaderMaterial.js\r\n\r\n/**\r\n * @author alteredq / http://alteredqualia.com/\r\n *\r\n * parameters = {\r\n *  defines: { \"label\" : \"value\" },\r\n *  uniforms: { \"parameter1\": { type: \"f\", value: 1.0 }, \"parameter2\": { type: \"i\" value2: 2 } },\r\n *\r\n *  fragmentShader: <string>,\r\n *  vertexShader: <string>,\r\n *\r\n *  shading: THREE.SmoothShading,\r\n *  blending: THREE.NormalBlending,\r\n *  depthTest: <bool>,\r\n *  depthWrite: <bool>,\r\n *\r\n *  wireframe: <boolean>,\r\n *  wireframeLinewidth: <float>,\r\n *\r\n *  lights: <bool>,\r\n *\r\n *  vertexColors: THREE.NoColors / THREE.VertexColors / THREE.FaceColors,\r\n *\r\n *  skinning: <bool>,\r\n *  morphTargets: <bool>,\r\n *  morphNormals: <bool>,\r\n *\r\n *\tfog: <bool>\r\n * }\r\n */\r\n\r\nTHREE.ShaderMaterial = function(parameters) {\r\n\r\n  THREE.Material.call(this);\r\n\r\n  this.type = 'ShaderMaterial';\r\n\r\n  this.defines = {};\r\n  this.uniforms = {};\r\n  this.attributes = null;\r\n\r\n  this.vertexShader = 'void main() {\\n\\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\\n}';\r\n  this.fragmentShader = 'void main() {\\n\\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\\n}';\r\n\r\n  this.shading = THREE.SmoothShading;\r\n\r\n  this.linewidth = 1;\r\n\r\n  this.wireframe = false;\r\n  this.wireframeLinewidth = 1;\r\n\r\n  this.fog = false; // set to use scene fog\r\n\r\n  this.lights = false; // set to use scene lights\r\n\r\n  this.vertexColors = THREE.NoColors; // set to use \"color\" attribute stream\r\n\r\n  this.skinning = false; // set to use skinning attribute streams\r\n\r\n  this.morphTargets = false; // set to use morph targets\r\n  this.morphNormals = false; // set to use morph normals\r\n\r\n  // When rendered geometry doesn't include these attributes but the material does,\r\n  // use these default values in WebGL. This avoids errors when buffer data is missing.\r\n  this.defaultAttributeValues = {\r\n    'color': [1, 1, 1],\r\n    'uv': [0, 0],\r\n    'uv2': [0, 0]\r\n  };\r\n\r\n  this.index0AttributeName = undefined;\r\n\r\n  this.setValues(parameters);\r\n\r\n};\r\n\r\nTHREE.ShaderMaterial.prototype = Object.create(THREE.Material.prototype);\r\nTHREE.ShaderMaterial.prototype.constructor = THREE.ShaderMaterial;\r\n\r\nTHREE.ShaderMaterial.prototype.clone = function() {\r\n\r\n  var material = new THREE.ShaderMaterial();\r\n\r\n  THREE.Material.prototype.clone.call(this, material);\r\n\r\n  material.fragmentShader = this.fragmentShader;\r\n  material.vertexShader = this.vertexShader;\r\n\r\n  material.uniforms = THREE.UniformsUtils.clone(this.uniforms);\r\n\r\n  material.attributes = this.attributes;\r\n  material.defines = this.defines;\r\n\r\n  material.shading = this.shading;\r\n\r\n  material.wireframe = this.wireframe;\r\n  material.wireframeLinewidth = this.wireframeLinewidth;\r\n\r\n  material.fog = this.fog;\r\n\r\n  material.lights = this.lights;\r\n\r\n  material.vertexColors = this.vertexColors;\r\n\r\n  material.skinning = this.skinning;\r\n\r\n  material.morphTargets = this.morphTargets;\r\n  material.morphNormals = this.morphNormals;\r\n\r\n  return material;\r\n\r\n};\r\n\r\n// File:src/materials/RawShaderMaterial.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.RawShaderMaterial = function(parameters) {\r\n\r\n  THREE.ShaderMaterial.call(this, parameters);\r\n\r\n  this.type = 'RawShaderMaterial';\r\n\r\n};\r\n\r\nTHREE.RawShaderMaterial.prototype = Object.create(THREE.ShaderMaterial.prototype);\r\nTHREE.RawShaderMaterial.prototype.constructor = THREE.RawShaderMaterial;\r\n\r\nTHREE.RawShaderMaterial.prototype.clone = function() {\r\n\r\n  var material = new THREE.RawShaderMaterial();\r\n\r\n  THREE.ShaderMaterial.prototype.clone.call(this, material);\r\n\r\n  return material;\r\n\r\n};\r\n\r\n// File:src/materials/SpriteMaterial.js\r\n\r\n/**\r\n * @author alteredq / http://alteredqualia.com/\r\n *\r\n * parameters = {\r\n *  color: <hex>,\r\n *  opacity: <float>,\r\n *  map: new THREE.Texture( <Image> ),\r\n *\r\n *  blending: THREE.NormalBlending,\r\n *  depthTest: <bool>,\r\n *  depthWrite: <bool>,\r\n *\r\n *\tuvOffset: new THREE.Vector2(),\r\n *\tuvScale: new THREE.Vector2(),\r\n *\r\n *  fog: <bool>\r\n * }\r\n */\r\n\r\nTHREE.SpriteMaterial = function(parameters) {\r\n\r\n  THREE.Material.call(this);\r\n\r\n  this.type = 'SpriteMaterial';\r\n\r\n  this.color = new THREE.Color(0xffffff);\r\n  this.map = null;\r\n\r\n  this.rotation = 0;\r\n\r\n  this.fog = false;\r\n\r\n  // set parameters\r\n\r\n  this.setValues(parameters);\r\n\r\n};\r\n\r\nTHREE.SpriteMaterial.prototype = Object.create(THREE.Material.prototype);\r\nTHREE.SpriteMaterial.prototype.constructor = THREE.SpriteMaterial;\r\n\r\nTHREE.SpriteMaterial.prototype.clone = function() {\r\n\r\n  var material = new THREE.SpriteMaterial();\r\n\r\n  THREE.Material.prototype.clone.call(this, material);\r\n\r\n  material.color.copy(this.color);\r\n  material.map = this.map;\r\n\r\n  material.rotation = this.rotation;\r\n\r\n  material.fog = this.fog;\r\n\r\n  return material;\r\n\r\n};\r\n\r\n// File:src/textures/Texture.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author alteredq / http://alteredqualia.com/\r\n * @author szimek / https://github.com/szimek/\r\n */\r\n\r\nTHREE.Texture = function(image, mapping, wrapS, wrapT, magFilter, minFilter, format, type, anisotropy) {\r\n\r\n  Object.defineProperty(this, 'id', {\r\n    value: THREE.TextureIdCount++\r\n  });\r\n\r\n  this.uuid = THREE.Math.generateUUID();\r\n\r\n  this.name = '';\r\n  this.sourceFile = '';\r\n\r\n  this.image = image !== undefined ? image : THREE.Texture.DEFAULT_IMAGE;\r\n  this.mipmaps = [];\r\n\r\n  this.mapping = mapping !== undefined ? mapping : THREE.Texture.DEFAULT_MAPPING;\r\n\r\n  this.wrapS = wrapS !== undefined ? wrapS : THREE.ClampToEdgeWrapping;\r\n  this.wrapT = wrapT !== undefined ? wrapT : THREE.ClampToEdgeWrapping;\r\n\r\n  this.magFilter = magFilter !== undefined ? magFilter : THREE.LinearFilter;\r\n  this.minFilter = minFilter !== undefined ? minFilter : THREE.LinearMipMapLinearFilter;\r\n\r\n  this.anisotropy = anisotropy !== undefined ? anisotropy : 1;\r\n\r\n  this.format = format !== undefined ? format : THREE.RGBAFormat;\r\n  this.type = type !== undefined ? type : THREE.UnsignedByteType;\r\n\r\n  this.offset = new THREE.Vector2(0, 0);\r\n  this.repeat = new THREE.Vector2(1, 1);\r\n\r\n  this.generateMipmaps = true;\r\n  this.premultiplyAlpha = false;\r\n  this.flipY = true;\r\n  this.unpackAlignment = 4; // valid values: 1, 2, 4, 8 (see http://www.khronos.org/opengles/sdk/docs/man/xhtml/glPixelStorei.xml)\r\n\r\n  this._needsUpdate = false;\r\n  this.onUpdate = null;\r\n\r\n};\r\n\r\nTHREE.Texture.DEFAULT_IMAGE = undefined;\r\nTHREE.Texture.DEFAULT_MAPPING = THREE.UVMapping;\r\n\r\nTHREE.Texture.prototype = {\r\n\r\n  constructor: THREE.Texture,\r\n\r\n  get needsUpdate() {\r\n\r\n    return this._needsUpdate;\r\n\r\n  },\r\n\r\n  set needsUpdate(value) {\r\n\r\n    if (value === true) this.update();\r\n\r\n    this._needsUpdate = value;\r\n\r\n  },\r\n\r\n  clone: function(texture) {\r\n\r\n    if (texture === undefined) texture = new THREE.Texture();\r\n\r\n    texture.image = this.image;\r\n    texture.mipmaps = this.mipmaps.slice(0);\r\n\r\n    texture.mapping = this.mapping;\r\n\r\n    texture.wrapS = this.wrapS;\r\n    texture.wrapT = this.wrapT;\r\n\r\n    texture.magFilter = this.magFilter;\r\n    texture.minFilter = this.minFilter;\r\n\r\n    texture.anisotropy = this.anisotropy;\r\n\r\n    texture.format = this.format;\r\n    texture.type = this.type;\r\n\r\n    texture.offset.copy(this.offset);\r\n    texture.repeat.copy(this.repeat);\r\n\r\n    texture.generateMipmaps = this.generateMipmaps;\r\n    texture.premultiplyAlpha = this.premultiplyAlpha;\r\n    texture.flipY = this.flipY;\r\n    texture.unpackAlignment = this.unpackAlignment;\r\n\r\n    return texture;\r\n\r\n  },\r\n\r\n  update: function() {\r\n\r\n    this.dispatchEvent({\r\n      type: 'update'\r\n    });\r\n\r\n  },\r\n\r\n  dispose: function() {\r\n\r\n    this.dispatchEvent({\r\n      type: 'dispose'\r\n    });\r\n\r\n  }\r\n\r\n};\r\n\r\nTHREE.EventDispatcher.prototype.apply(THREE.Texture.prototype);\r\n\r\nTHREE.TextureIdCount = 0;\r\n\r\n// File:src/textures/CubeTexture.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.CubeTexture = function(images, mapping, wrapS, wrapT, magFilter, minFilter, format, type, anisotropy) {\r\n\r\n  mapping = mapping !== undefined ? mapping : THREE.CubeReflectionMapping;\r\n\r\n  THREE.Texture.call(this, images, mapping, wrapS, wrapT, magFilter, minFilter, format, type, anisotropy);\r\n\r\n  this.images = images;\r\n\r\n};\r\n\r\nTHREE.CubeTexture.prototype = Object.create(THREE.Texture.prototype);\r\nTHREE.CubeTexture.prototype.constructor = THREE.CubeTexture;\r\n\r\nTHREE.CubeTexture.clone = function(texture) {\r\n\r\n  if (texture === undefined) texture = new THREE.CubeTexture();\r\n\r\n  THREE.Texture.prototype.clone.call(this, texture);\r\n\r\n  texture.images = this.images;\r\n\r\n  return texture;\r\n\r\n};\r\n\r\n// File:src/textures/CompressedTexture.js\r\n\r\n/**\r\n * @author alteredq / http://alteredqualia.com/\r\n */\r\n\r\nTHREE.CompressedTexture = function(mipmaps, width, height, format, type, mapping, wrapS, wrapT, magFilter, minFilter, anisotropy) {\r\n\r\n  THREE.Texture.call(this, null, mapping, wrapS, wrapT, magFilter, minFilter, format, type, anisotropy);\r\n\r\n  this.image = {\r\n    width: width,\r\n    height: height\r\n  };\r\n  this.mipmaps = mipmaps;\r\n\r\n  // no flipping for cube textures\r\n  // (also flipping doesn't work for compressed textures )\r\n\r\n  this.flipY = false;\r\n\r\n  // can't generate mipmaps for compressed textures\r\n  // mips must be embedded in DDS files\r\n\r\n  this.generateMipmaps = false;\r\n\r\n};\r\n\r\nTHREE.CompressedTexture.prototype = Object.create(THREE.Texture.prototype);\r\nTHREE.CompressedTexture.prototype.constructor = THREE.CompressedTexture;\r\n\r\nTHREE.CompressedTexture.prototype.clone = function() {\r\n\r\n  var texture = new THREE.CompressedTexture();\r\n\r\n  THREE.Texture.prototype.clone.call(this, texture);\r\n\r\n  return texture;\r\n\r\n};\r\n\r\n// File:src/textures/DataTexture.js\r\n\r\n/**\r\n * @author alteredq / http://alteredqualia.com/\r\n */\r\n\r\nTHREE.DataTexture = function(data, width, height, format, type, mapping, wrapS, wrapT, magFilter, minFilter, anisotropy) {\r\n\r\n  THREE.Texture.call(this, null, mapping, wrapS, wrapT, magFilter, minFilter, format, type, anisotropy);\r\n\r\n  this.image = {\r\n    data: data,\r\n    width: width,\r\n    height: height\r\n  };\r\n\r\n};\r\n\r\nTHREE.DataTexture.prototype = Object.create(THREE.Texture.prototype);\r\nTHREE.DataTexture.prototype.constructor = THREE.DataTexture;\r\n\r\nTHREE.DataTexture.prototype.clone = function() {\r\n\r\n  var texture = new THREE.DataTexture();\r\n\r\n  THREE.Texture.prototype.clone.call(this, texture);\r\n\r\n  return texture;\r\n\r\n};\r\n\r\n// File:src/textures/VideoTexture.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.VideoTexture = function(video, mapping, wrapS, wrapT, magFilter, minFilter, format, type, anisotropy) {\r\n\r\n  THREE.Texture.call(this, video, mapping, wrapS, wrapT, magFilter, minFilter, format, type, anisotropy);\r\n\r\n  this.generateMipmaps = false;\r\n\r\n  var scope = this;\r\n\r\n  var update = function() {\r\n\r\n    requestAnimationFrame(update);\r\n\r\n    if (video.readyState === video.HAVE_ENOUGH_DATA) {\r\n\r\n      scope.needsUpdate = true;\r\n\r\n    }\r\n\r\n  };\r\n\r\n  update();\r\n\r\n};\r\n\r\nTHREE.VideoTexture.prototype = Object.create(THREE.Texture.prototype);\r\nTHREE.VideoTexture.prototype.constructor = THREE.VideoTexture;\r\n\r\n// File:src/objects/Group.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.Group = function() {\r\n\r\n  THREE.Object3D.call(this);\r\n\r\n  this.type = 'Group';\r\n\r\n};\r\n\r\nTHREE.Group.prototype = Object.create(THREE.Object3D.prototype);\r\nTHREE.Group.prototype.constructor = THREE.Group;\r\n\r\n// File:src/objects/PointCloud.js\r\n\r\n/**\r\n * @author alteredq / http://alteredqualia.com/\r\n */\r\n\r\nTHREE.PointCloud = function(geometry, material) {\r\n\r\n  THREE.Object3D.call(this);\r\n\r\n  this.type = 'PointCloud';\r\n\r\n  this.geometry = geometry !== undefined ? geometry : new THREE.Geometry();\r\n  this.material = material !== undefined ? material : new THREE.PointCloudMaterial({\r\n    color: Math.random() * 0xffffff\r\n  });\r\n\r\n};\r\n\r\nTHREE.PointCloud.prototype = Object.create(THREE.Object3D.prototype);\r\nTHREE.PointCloud.prototype.constructor = THREE.PointCloud;\r\n\r\nTHREE.PointCloud.prototype.raycast = (function() {\r\n\r\n  var inverseMatrix = new THREE.Matrix4();\r\n  var ray = new THREE.Ray();\r\n\r\n  return function(raycaster, intersects) {\r\n\r\n    var object = this;\r\n    var geometry = object.geometry;\r\n    var threshold = raycaster.params.PointCloud.threshold;\r\n\r\n    inverseMatrix.getInverse(this.matrixWorld);\r\n    ray.copy(raycaster.ray).applyMatrix4(inverseMatrix);\r\n\r\n    if (geometry.boundingBox !== null) {\r\n\r\n      if (ray.isIntersectionBox(geometry.boundingBox) === false) {\r\n\r\n        return;\r\n\r\n      }\r\n\r\n    }\r\n\r\n    var localThreshold = threshold / ((this.scale.x + this.scale.y + this.scale.z) / 3);\r\n    var position = new THREE.Vector3();\r\n\r\n    var testPoint = function(point, index) {\r\n\r\n      var rayPointDistance = ray.distanceToPoint(point);\r\n\r\n      if (rayPointDistance < localThreshold) {\r\n\r\n        var intersectPoint = ray.closestPointToPoint(point);\r\n        intersectPoint.applyMatrix4(object.matrixWorld);\r\n\r\n        var distance = raycaster.ray.origin.distanceTo(intersectPoint);\r\n\r\n        intersects.push({\r\n\r\n          distance: distance,\r\n          distanceToRay: rayPointDistance,\r\n          point: intersectPoint.clone(),\r\n          index: index,\r\n          face: null,\r\n          object: object\r\n\r\n        });\r\n\r\n      }\r\n\r\n    };\r\n\r\n    if (geometry instanceof THREE.BufferGeometry) {\r\n\r\n      var attributes = geometry.attributes;\r\n      var positions = attributes.position.array;\r\n\r\n      if (attributes.index !== undefined) {\r\n\r\n        var indices = attributes.index.array;\r\n        var offsets = geometry.offsets;\r\n\r\n        if (offsets.length === 0) {\r\n\r\n          var offset = {\r\n            start: 0,\r\n            count: indices.length,\r\n            index: 0\r\n          };\r\n\r\n          offsets = [offset];\r\n\r\n        }\r\n\r\n        for (var oi = 0, ol = offsets.length; oi < ol; ++oi) {\r\n\r\n          var start = offsets[oi].start;\r\n          var count = offsets[oi].count;\r\n          var index = offsets[oi].index;\r\n\r\n          for (var i = start, il = start + count; i < il; i++) {\r\n\r\n            var a = index + indices[i];\r\n\r\n            position.fromArray(positions, a * 3);\r\n\r\n            testPoint(position, a);\r\n\r\n          }\r\n\r\n        }\r\n\r\n      }\r\n      else {\r\n\r\n        var pointCount = positions.length / 3;\r\n\r\n        for (var i = 0; i < pointCount; i++) {\r\n\r\n          position.set(\r\n            positions[3 * i],\r\n            positions[3 * i + 1],\r\n            positions[3 * i + 2]\r\n          );\r\n\r\n          testPoint(position, i);\r\n\r\n        }\r\n\r\n      }\r\n\r\n    }\r\n    else {\r\n\r\n      var vertices = this.geometry.vertices;\r\n\r\n      for (var i = 0; i < vertices.length; i++) {\r\n\r\n        testPoint(vertices[i], i);\r\n\r\n      }\r\n\r\n    }\r\n\r\n  };\r\n\r\n}());\r\n\r\nTHREE.PointCloud.prototype.clone = function(object) {\r\n\r\n  if (object === undefined) object = new THREE.PointCloud(this.geometry, this.material);\r\n\r\n  THREE.Object3D.prototype.clone.call(this, object);\r\n\r\n  return object;\r\n\r\n};\r\n\r\n// Backwards compatibility\r\n\r\nTHREE.ParticleSystem = function(geometry, material) {\r\n\r\n  THREE.warn('THREE.ParticleSystem has been renamed to THREE.PointCloud.');\r\n  return new THREE.PointCloud(geometry, material);\r\n\r\n};\r\n\r\n// File:src/objects/Line.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.Line = function(geometry, material, mode) {\r\n\r\n  THREE.Object3D.call(this);\r\n\r\n  this.type = 'Line';\r\n\r\n  this.geometry = geometry !== undefined ? geometry : new THREE.Geometry();\r\n  this.material = material !== undefined ? material : new THREE.LineBasicMaterial({\r\n    color: Math.random() * 0xffffff\r\n  });\r\n\r\n  this.mode = mode !== undefined ? mode : THREE.LineStrip;\r\n\r\n};\r\n\r\nTHREE.LineStrip = 0;\r\nTHREE.LinePieces = 1;\r\n\r\nTHREE.Line.prototype = Object.create(THREE.Object3D.prototype);\r\nTHREE.Line.prototype.constructor = THREE.Line;\r\n\r\nTHREE.Line.prototype.raycast = (function() {\r\n\r\n  var inverseMatrix = new THREE.Matrix4();\r\n  var ray = new THREE.Ray();\r\n  var sphere = new THREE.Sphere();\r\n\r\n  return function(raycaster, intersects) {\r\n\r\n    var precision = raycaster.linePrecision;\r\n    var precisionSq = precision * precision;\r\n\r\n    var geometry = this.geometry;\r\n\r\n    if (geometry.boundingSphere === null) geometry.computeBoundingSphere();\r\n\r\n    // Checking boundingSphere distance to ray\r\n\r\n    sphere.copy(geometry.boundingSphere);\r\n    sphere.applyMatrix4(this.matrixWorld);\r\n\r\n    if (raycaster.ray.isIntersectionSphere(sphere) === false) {\r\n\r\n      return;\r\n\r\n    }\r\n\r\n    inverseMatrix.getInverse(this.matrixWorld);\r\n    ray.copy(raycaster.ray).applyMatrix4(inverseMatrix);\r\n\r\n    var vStart = new THREE.Vector3();\r\n    var vEnd = new THREE.Vector3();\r\n    var interSegment = new THREE.Vector3();\r\n    var interRay = new THREE.Vector3();\r\n    var step = this.mode === THREE.LineStrip ? 1 : 2;\r\n\r\n    if (geometry instanceof THREE.BufferGeometry) {\r\n\r\n      var attributes = geometry.attributes;\r\n\r\n      if (attributes.index !== undefined) {\r\n\r\n        var indices = attributes.index.array;\r\n        var positions = attributes.position.array;\r\n        var offsets = geometry.offsets;\r\n\r\n        if (offsets.length === 0) {\r\n\r\n          offsets = [{\r\n            start: 0,\r\n            count: indices.length,\r\n            index: 0\r\n          }];\r\n\r\n        }\r\n\r\n        for (var oi = 0; oi < offsets.length; oi++) {\r\n\r\n          var start = offsets[oi].start;\r\n          var count = offsets[oi].count;\r\n          var index = offsets[oi].index;\r\n\r\n          for (var i = start; i < start + count - 1; i += step) {\r\n\r\n            var a = index + indices[i];\r\n            var b = index + indices[i + 1];\r\n\r\n            vStart.fromArray(positions, a * 3);\r\n            vEnd.fromArray(positions, b * 3);\r\n\r\n            var distSq = ray.distanceSqToSegment(vStart, vEnd, interRay, interSegment);\r\n\r\n            if (distSq > precisionSq) continue;\r\n\r\n            var distance = ray.origin.distanceTo(interRay);\r\n\r\n            if (distance < raycaster.near || distance > raycaster.far) continue;\r\n\r\n            intersects.push({\r\n\r\n              distance: distance,\r\n              // What do we want? intersection point on the ray or on the segment??\r\n              // point: raycaster.ray.at( distance ),\r\n              point: interSegment.clone().applyMatrix4(this.matrixWorld),\r\n              index: i,\r\n              offsetIndex: oi,\r\n              face: null,\r\n              faceIndex: null,\r\n              object: this\r\n\r\n            });\r\n\r\n          }\r\n\r\n        }\r\n\r\n      }\r\n      else {\r\n\r\n        var positions = attributes.position.array;\r\n\r\n        for (var i = 0; i < positions.length / 3 - 1; i += step) {\r\n\r\n          vStart.fromArray(positions, 3 * i);\r\n          vEnd.fromArray(positions, 3 * i + 3);\r\n\r\n          var distSq = ray.distanceSqToSegment(vStart, vEnd, interRay, interSegment);\r\n\r\n          if (distSq > precisionSq) continue;\r\n\r\n          var distance = ray.origin.distanceTo(interRay);\r\n\r\n          if (distance < raycaster.near || distance > raycaster.far) continue;\r\n\r\n          intersects.push({\r\n\r\n            distance: distance,\r\n            // What do we want? intersection point on the ray or on the segment??\r\n            // point: raycaster.ray.at( distance ),\r\n            point: interSegment.clone().applyMatrix4(this.matrixWorld),\r\n            index: i,\r\n            face: null,\r\n            faceIndex: null,\r\n            object: this\r\n\r\n          });\r\n\r\n        }\r\n\r\n      }\r\n\r\n    }\r\n    else if (geometry instanceof THREE.Geometry) {\r\n\r\n      var vertices = geometry.vertices;\r\n      var nbVertices = vertices.length;\r\n\r\n      for (var i = 0; i < nbVertices - 1; i += step) {\r\n\r\n        var distSq = ray.distanceSqToSegment(vertices[i], vertices[i + 1], interRay, interSegment);\r\n\r\n        if (distSq > precisionSq) continue;\r\n\r\n        var distance = ray.origin.distanceTo(interRay);\r\n\r\n        if (distance < raycaster.near || distance > raycaster.far) continue;\r\n\r\n        intersects.push({\r\n\r\n          distance: distance,\r\n          // What do we want? intersection point on the ray or on the segment??\r\n          // point: raycaster.ray.at( distance ),\r\n          point: interSegment.clone().applyMatrix4(this.matrixWorld),\r\n          index: i,\r\n          face: null,\r\n          faceIndex: null,\r\n          object: this\r\n\r\n        });\r\n\r\n      }\r\n\r\n    }\r\n\r\n  };\r\n\r\n}());\r\n\r\nTHREE.Line.prototype.clone = function(object) {\r\n\r\n  if (object === undefined) object = new THREE.Line(this.geometry, this.material, this.mode);\r\n\r\n  THREE.Object3D.prototype.clone.call(this, object);\r\n\r\n  return object;\r\n\r\n};\r\n\r\n// File:src/objects/Mesh.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author alteredq / http://alteredqualia.com/\r\n * @author mikael emtinger / http://gomo.se/\r\n * @author jonobr1 / http://jonobr1.com/\r\n */\r\n\r\nTHREE.Mesh = function(geometry, material) {\r\n\r\n  THREE.Object3D.call(this);\r\n\r\n  this.type = 'Mesh';\r\n\r\n  this.geometry = geometry !== undefined ? geometry : new THREE.Geometry();\r\n  this.material = material !== undefined ? material : new THREE.MeshBasicMaterial({\r\n    color: Math.random() * 0xffffff\r\n  });\r\n\r\n  this.updateMorphTargets();\r\n\r\n};\r\n\r\nTHREE.Mesh.prototype = Object.create(THREE.Object3D.prototype);\r\nTHREE.Mesh.prototype.constructor = THREE.Mesh;\r\n\r\nTHREE.Mesh.prototype.updateMorphTargets = function() {\r\n\r\n  if (this.geometry.morphTargets !== undefined && this.geometry.morphTargets.length > 0) {\r\n\r\n    this.morphTargetBase = -1;\r\n    this.morphTargetForcedOrder = [];\r\n    this.morphTargetInfluences = [];\r\n    this.morphTargetDictionary = {};\r\n\r\n    for (var m = 0, ml = this.geometry.morphTargets.length; m < ml; m++) {\r\n\r\n      this.morphTargetInfluences.push(0);\r\n      this.morphTargetDictionary[this.geometry.morphTargets[m].name] = m;\r\n\r\n    }\r\n\r\n  }\r\n\r\n};\r\n\r\nTHREE.Mesh.prototype.getMorphTargetIndexByName = function(name) {\r\n\r\n  if (this.morphTargetDictionary[name] !== undefined) {\r\n\r\n    return this.morphTargetDictionary[name];\r\n\r\n  }\r\n\r\n  THREE.warn('THREE.Mesh.getMorphTargetIndexByName: morph target ' + name + ' does not exist. Returning 0.');\r\n\r\n  return 0;\r\n\r\n};\r\n\r\n\r\nTHREE.Mesh.prototype.raycast = (function() {\r\n\r\n  var inverseMatrix = new THREE.Matrix4();\r\n  var ray = new THREE.Ray();\r\n  var sphere = new THREE.Sphere();\r\n\r\n  var vA = new THREE.Vector3();\r\n  var vB = new THREE.Vector3();\r\n  var vC = new THREE.Vector3();\r\n\r\n  return function(raycaster, intersects) {\r\n\r\n    var geometry = this.geometry;\r\n\r\n    // Checking boundingSphere distance to ray\r\n\r\n    if (geometry.boundingSphere === null) geometry.computeBoundingSphere();\r\n\r\n    sphere.copy(geometry.boundingSphere);\r\n    sphere.applyMatrix4(this.matrixWorld);\r\n\r\n    if (raycaster.ray.isIntersectionSphere(sphere) === false) {\r\n\r\n      return;\r\n\r\n    }\r\n\r\n    // Check boundingBox before continuing\r\n\r\n    inverseMatrix.getInverse(this.matrixWorld);\r\n    ray.copy(raycaster.ray).applyMatrix4(inverseMatrix);\r\n\r\n    if (geometry.boundingBox !== null) {\r\n\r\n      if (ray.isIntersectionBox(geometry.boundingBox) === false) {\r\n\r\n        return;\r\n\r\n      }\r\n\r\n    }\r\n\r\n    if (geometry instanceof THREE.BufferGeometry) {\r\n\r\n      var material = this.material;\r\n\r\n      if (material === undefined) return;\r\n\r\n      var attributes = geometry.attributes;\r\n\r\n      var a, b, c;\r\n      var precision = raycaster.precision;\r\n\r\n      if (attributes.index !== undefined) {\r\n\r\n        var indices = attributes.index.array;\r\n        var positions = attributes.position.array;\r\n        var offsets = geometry.offsets;\r\n\r\n        if (offsets.length === 0) {\r\n\r\n          offsets = [{\r\n            start: 0,\r\n            count: indices.length,\r\n            index: 0\r\n          }];\r\n\r\n        }\r\n\r\n        for (var oi = 0, ol = offsets.length; oi < ol; ++oi) {\r\n\r\n          var start = offsets[oi].start;\r\n          var count = offsets[oi].count;\r\n          var index = offsets[oi].index;\r\n\r\n          for (var i = start, il = start + count; i < il; i += 3) {\r\n\r\n            a = index + indices[i];\r\n            b = index + indices[i + 1];\r\n            c = index + indices[i + 2];\r\n\r\n            vA.fromArray(positions, a * 3);\r\n            vB.fromArray(positions, b * 3);\r\n            vC.fromArray(positions, c * 3);\r\n\r\n            if (material.side === THREE.BackSide) {\r\n\r\n              var intersectionPoint = ray.intersectTriangle(vC, vB, vA, true);\r\n\r\n            }\r\n            else {\r\n\r\n              var intersectionPoint = ray.intersectTriangle(vA, vB, vC, material.side !== THREE.DoubleSide);\r\n\r\n            }\r\n\r\n            if (intersectionPoint === null) continue;\r\n\r\n            intersectionPoint.applyMatrix4(this.matrixWorld);\r\n\r\n            var distance = raycaster.ray.origin.distanceTo(intersectionPoint);\r\n\r\n            if (distance < precision || distance < raycaster.near || distance > raycaster.far) continue;\r\n\r\n            intersects.push({\r\n\r\n              distance: distance,\r\n              point: intersectionPoint,\r\n              face: new THREE.Face3(a, b, c, THREE.Triangle.normal(vA, vB, vC)),\r\n              faceIndex: null,\r\n              object: this\r\n\r\n            });\r\n\r\n          }\r\n\r\n        }\r\n\r\n      }\r\n      else {\r\n\r\n        var positions = attributes.position.array;\r\n\r\n        for (var i = 0, j = 0, il = positions.length; i < il; i += 3, j += 9) {\r\n\r\n          a = i;\r\n          b = i + 1;\r\n          c = i + 2;\r\n\r\n          vA.fromArray(positions, j);\r\n          vB.fromArray(positions, j + 3);\r\n          vC.fromArray(positions, j + 6);\r\n\r\n          if (material.side === THREE.BackSide) {\r\n\r\n            var intersectionPoint = ray.intersectTriangle(vC, vB, vA, true);\r\n\r\n          }\r\n          else {\r\n\r\n            var intersectionPoint = ray.intersectTriangle(vA, vB, vC, material.side !== THREE.DoubleSide);\r\n\r\n          }\r\n\r\n          if (intersectionPoint === null) continue;\r\n\r\n          intersectionPoint.applyMatrix4(this.matrixWorld);\r\n\r\n          var distance = raycaster.ray.origin.distanceTo(intersectionPoint);\r\n\r\n          if (distance < precision || distance < raycaster.near || distance > raycaster.far) continue;\r\n\r\n          intersects.push({\r\n\r\n            distance: distance,\r\n            point: intersectionPoint,\r\n            face: new THREE.Face3(a, b, c, THREE.Triangle.normal(vA, vB, vC)),\r\n            faceIndex: null,\r\n            object: this\r\n\r\n          });\r\n\r\n        }\r\n\r\n      }\r\n\r\n    }\r\n    else if (geometry instanceof THREE.Geometry) {\r\n\r\n      var isFaceMaterial = this.material instanceof THREE.MeshFaceMaterial;\r\n      var objectMaterials = isFaceMaterial === true ? this.material.materials : null;\r\n\r\n      var a, b, c;\r\n      var precision = raycaster.precision;\r\n\r\n      var vertices = geometry.vertices;\r\n\r\n      for (var f = 0, fl = geometry.faces.length; f < fl; f++) {\r\n\r\n        var face = geometry.faces[f];\r\n\r\n        var material = isFaceMaterial === true ? objectMaterials[face.materialIndex] : this.material;\r\n\r\n        if (material === undefined) continue;\r\n\r\n        a = vertices[face.a];\r\n        b = vertices[face.b];\r\n        c = vertices[face.c];\r\n\r\n        if (material.morphTargets === true) {\r\n\r\n          var morphTargets = geometry.morphTargets;\r\n          var morphInfluences = this.morphTargetInfluences;\r\n\r\n          vA.set(0, 0, 0);\r\n          vB.set(0, 0, 0);\r\n          vC.set(0, 0, 0);\r\n\r\n          for (var t = 0, tl = morphTargets.length; t < tl; t++) {\r\n\r\n            var influence = morphInfluences[t];\r\n\r\n            if (influence === 0) continue;\r\n\r\n            var targets = morphTargets[t].vertices;\r\n\r\n            vA.x += (targets[face.a].x - a.x) * influence;\r\n            vA.y += (targets[face.a].y - a.y) * influence;\r\n            vA.z += (targets[face.a].z - a.z) * influence;\r\n\r\n            vB.x += (targets[face.b].x - b.x) * influence;\r\n            vB.y += (targets[face.b].y - b.y) * influence;\r\n            vB.z += (targets[face.b].z - b.z) * influence;\r\n\r\n            vC.x += (targets[face.c].x - c.x) * influence;\r\n            vC.y += (targets[face.c].y - c.y) * influence;\r\n            vC.z += (targets[face.c].z - c.z) * influence;\r\n\r\n          }\r\n\r\n          vA.add(a);\r\n          vB.add(b);\r\n          vC.add(c);\r\n\r\n          a = vA;\r\n          b = vB;\r\n          c = vC;\r\n\r\n        }\r\n\r\n        if (material.side === THREE.BackSide) {\r\n\r\n          var intersectionPoint = ray.intersectTriangle(c, b, a, true);\r\n\r\n        }\r\n        else {\r\n\r\n          var intersectionPoint = ray.intersectTriangle(a, b, c, material.side !== THREE.DoubleSide);\r\n\r\n        }\r\n\r\n        if (intersectionPoint === null) continue;\r\n\r\n        intersectionPoint.applyMatrix4(this.matrixWorld);\r\n\r\n        var distance = raycaster.ray.origin.distanceTo(intersectionPoint);\r\n\r\n        if (distance < precision || distance < raycaster.near || distance > raycaster.far) continue;\r\n\r\n        intersects.push({\r\n\r\n          distance: distance,\r\n          point: intersectionPoint,\r\n          face: face,\r\n          faceIndex: f,\r\n          object: this\r\n\r\n        });\r\n\r\n      }\r\n\r\n    }\r\n\r\n  };\r\n\r\n}());\r\n\r\nTHREE.Mesh.prototype.clone = function(object, recursive) {\r\n\r\n  if (object === undefined) object = new THREE.Mesh(this.geometry, this.material);\r\n\r\n  THREE.Object3D.prototype.clone.call(this, object, recursive);\r\n\r\n  return object;\r\n\r\n};\r\n\r\n// File:src/objects/Bone.js\r\n\r\n/**\r\n * @author mikael emtinger / http://gomo.se/\r\n * @author alteredq / http://alteredqualia.com/\r\n * @author ikerr / http://verold.com\r\n */\r\n\r\nTHREE.Bone = function(skin) {\r\n\r\n  THREE.Object3D.call(this);\r\n\r\n  this.type = 'Bone';\r\n\r\n  this.skin = skin;\r\n\r\n};\r\n\r\nTHREE.Bone.prototype = Object.create(THREE.Object3D.prototype);\r\nTHREE.Bone.prototype.constructor = THREE.Bone;\r\n\r\n// File:src/objects/Skeleton.js\r\n\r\n/**\r\n * @author mikael emtinger / http://gomo.se/\r\n * @author alteredq / http://alteredqualia.com/\r\n * @author michael guerrero / http://realitymeltdown.com\r\n * @author ikerr / http://verold.com\r\n */\r\n\r\nTHREE.Skeleton = function(bones, boneInverses, useVertexTexture) {\r\n\r\n  this.useVertexTexture = useVertexTexture !== undefined ? useVertexTexture : true;\r\n\r\n  this.identityMatrix = new THREE.Matrix4();\r\n\r\n  // copy the bone array\r\n\r\n  bones = bones || [];\r\n\r\n  this.bones = bones.slice(0);\r\n\r\n  // create a bone texture or an array of floats\r\n\r\n  if (this.useVertexTexture) {\r\n\r\n    // layout (1 matrix = 4 pixels)\r\n    //      RGBA RGBA RGBA RGBA (=> column1, column2, column3, column4)\r\n    //  with  8x8  pixel texture max   16 bones  (8 * 8  / 4)\r\n    //       16x16 pixel texture max   64 bones (16 * 16 / 4)\r\n    //       32x32 pixel texture max  256 bones (32 * 32 / 4)\r\n    //       64x64 pixel texture max 1024 bones (64 * 64 / 4)\r\n\r\n    var size;\r\n\r\n    if (this.bones.length > 256)\r\n      size = 64;\r\n    else if (this.bones.length > 64)\r\n      size = 32;\r\n    else if (this.bones.length > 16)\r\n      size = 16;\r\n    else\r\n      size = 8;\r\n\r\n    this.boneTextureWidth = size;\r\n    this.boneTextureHeight = size;\r\n\r\n    this.boneMatrices = new Float32Array(this.boneTextureWidth * this.boneTextureHeight * 4); // 4 floats per RGBA pixel\r\n    this.boneTexture = new THREE.DataTexture(this.boneMatrices, this.boneTextureWidth, this.boneTextureHeight, THREE.RGBAFormat, THREE.FloatType);\r\n    this.boneTexture.minFilter = THREE.NearestFilter;\r\n    this.boneTexture.magFilter = THREE.NearestFilter;\r\n    this.boneTexture.generateMipmaps = false;\r\n    this.boneTexture.flipY = false;\r\n\r\n  }\r\n  else {\r\n\r\n    this.boneMatrices = new Float32Array(16 * this.bones.length);\r\n\r\n  }\r\n\r\n  // use the supplied bone inverses or calculate the inverses\r\n\r\n  if (boneInverses === undefined) {\r\n\r\n    this.calculateInverses();\r\n\r\n  }\r\n  else {\r\n\r\n    if (this.bones.length === boneInverses.length) {\r\n\r\n      this.boneInverses = boneInverses.slice(0);\r\n\r\n    }\r\n    else {\r\n\r\n      THREE.warn('THREE.Skeleton bonInverses is the wrong length.');\r\n\r\n      this.boneInverses = [];\r\n\r\n      for (var b = 0, bl = this.bones.length; b < bl; b++) {\r\n\r\n        this.boneInverses.push(new THREE.Matrix4());\r\n\r\n      }\r\n\r\n    }\r\n\r\n  }\r\n\r\n};\r\n\r\nTHREE.Skeleton.prototype.calculateInverses = function() {\r\n\r\n  this.boneInverses = [];\r\n\r\n  for (var b = 0, bl = this.bones.length; b < bl; b++) {\r\n\r\n    var inverse = new THREE.Matrix4();\r\n\r\n    if (this.bones[b]) {\r\n\r\n      inverse.getInverse(this.bones[b].matrixWorld);\r\n\r\n    }\r\n\r\n    this.boneInverses.push(inverse);\r\n\r\n  }\r\n\r\n};\r\n\r\nTHREE.Skeleton.prototype.pose = function() {\r\n\r\n  var bone;\r\n\r\n  // recover the bind-time world matrices\r\n\r\n  for (var b = 0, bl = this.bones.length; b < bl; b++) {\r\n\r\n    bone = this.bones[b];\r\n\r\n    if (bone) {\r\n\r\n      bone.matrixWorld.getInverse(this.boneInverses[b]);\r\n\r\n    }\r\n\r\n  }\r\n\r\n  // compute the local matrices, positions, rotations and scales\r\n\r\n  for (var b = 0, bl = this.bones.length; b < bl; b++) {\r\n\r\n    bone = this.bones[b];\r\n\r\n    if (bone) {\r\n\r\n      if (bone.parent) {\r\n\r\n        bone.matrix.getInverse(bone.parent.matrixWorld);\r\n        bone.matrix.multiply(bone.matrixWorld);\r\n\r\n      }\r\n      else {\r\n\r\n        bone.matrix.copy(bone.matrixWorld);\r\n\r\n      }\r\n\r\n      bone.matrix.decompose(bone.position, bone.quaternion, bone.scale);\r\n\r\n    }\r\n\r\n  }\r\n\r\n};\r\n\r\nTHREE.Skeleton.prototype.update = (function() {\r\n\r\n  var offsetMatrix = new THREE.Matrix4();\r\n\r\n  return function() {\r\n\r\n    // flatten bone matrices to array\r\n\r\n    for (var b = 0, bl = this.bones.length; b < bl; b++) {\r\n\r\n      // compute the offset between the current and the original transform\r\n\r\n      var matrix = this.bones[b] ? this.bones[b].matrixWorld : this.identityMatrix;\r\n\r\n      offsetMatrix.multiplyMatrices(matrix, this.boneInverses[b]);\r\n      offsetMatrix.flattenToArrayOffset(this.boneMatrices, b * 16);\r\n\r\n    }\r\n\r\n    if (this.useVertexTexture) {\r\n\r\n      this.boneTexture.needsUpdate = true;\r\n\r\n    }\r\n\r\n  };\r\n\r\n})();\r\n\r\n\r\n// File:src/objects/SkinnedMesh.js\r\n\r\n/**\r\n * @author mikael emtinger / http://gomo.se/\r\n * @author alteredq / http://alteredqualia.com/\r\n * @author ikerr / http://verold.com\r\n */\r\n\r\nTHREE.SkinnedMesh = function(geometry, material, useVertexTexture) {\r\n\r\n  THREE.Mesh.call(this, geometry, material);\r\n\r\n  this.type = 'SkinnedMesh';\r\n\r\n  this.bindMode = \"attached\";\r\n  this.bindMatrix = new THREE.Matrix4();\r\n  this.bindMatrixInverse = new THREE.Matrix4();\r\n\r\n  // init bones\r\n\r\n  // TODO: remove bone creation as there is no reason (other than\r\n  // convenience) for THREE.SkinnedMesh to do this.\r\n\r\n  var bones = [];\r\n\r\n  if (this.geometry && this.geometry.bones !== undefined) {\r\n\r\n    var bone, gbone, p, q, s;\r\n\r\n    for (var b = 0, bl = this.geometry.bones.length; b < bl; ++b) {\r\n\r\n      gbone = this.geometry.bones[b];\r\n\r\n      p = gbone.pos;\r\n      q = gbone.rotq;\r\n      s = gbone.scl;\r\n\r\n      bone = new THREE.Bone(this);\r\n      bones.push(bone);\r\n\r\n      bone.name = gbone.name;\r\n      bone.position.set(p[0], p[1], p[2]);\r\n      bone.quaternion.set(q[0], q[1], q[2], q[3]);\r\n\r\n      if (s !== undefined) {\r\n\r\n        bone.scale.set(s[0], s[1], s[2]);\r\n\r\n      }\r\n      else {\r\n\r\n        bone.scale.set(1, 1, 1);\r\n\r\n      }\r\n\r\n    }\r\n\r\n    for (var b = 0, bl = this.geometry.bones.length; b < bl; ++b) {\r\n\r\n      gbone = this.geometry.bones[b];\r\n\r\n      if (gbone.parent !== -1) {\r\n\r\n        bones[gbone.parent].add(bones[b]);\r\n\r\n      }\r\n      else {\r\n\r\n        this.add(bones[b]);\r\n\r\n      }\r\n\r\n    }\r\n\r\n  }\r\n\r\n  this.normalizeSkinWeights();\r\n\r\n  this.updateMatrixWorld(true);\r\n  this.bind(new THREE.Skeleton(bones, undefined, useVertexTexture));\r\n\r\n};\r\n\r\n\r\nTHREE.SkinnedMesh.prototype = Object.create(THREE.Mesh.prototype);\r\nTHREE.SkinnedMesh.prototype.constructor = THREE.SkinnedMesh;\r\n\r\nTHREE.SkinnedMesh.prototype.bind = function(skeleton, bindMatrix) {\r\n\r\n  this.skeleton = skeleton;\r\n\r\n  if (bindMatrix === undefined) {\r\n\r\n    this.updateMatrixWorld(true);\r\n\r\n    bindMatrix = this.matrixWorld;\r\n\r\n  }\r\n\r\n  this.bindMatrix.copy(bindMatrix);\r\n  this.bindMatrixInverse.getInverse(bindMatrix);\r\n\r\n};\r\n\r\nTHREE.SkinnedMesh.prototype.pose = function() {\r\n\r\n  this.skeleton.pose();\r\n\r\n};\r\n\r\nTHREE.SkinnedMesh.prototype.normalizeSkinWeights = function() {\r\n\r\n  if (this.geometry instanceof THREE.Geometry) {\r\n\r\n    for (var i = 0; i < this.geometry.skinIndices.length; i++) {\r\n\r\n      var sw = this.geometry.skinWeights[i];\r\n\r\n      var scale = 1.0 / sw.lengthManhattan();\r\n\r\n      if (scale !== Infinity) {\r\n\r\n        sw.multiplyScalar(scale);\r\n\r\n      }\r\n      else {\r\n\r\n        sw.set(1); // this will be normalized by the shader anyway\r\n\r\n      }\r\n\r\n    }\r\n\r\n  }\r\n  else {\r\n\r\n    // skinning weights assumed to be normalized for THREE.BufferGeometry\r\n\r\n  }\r\n\r\n};\r\n\r\nTHREE.SkinnedMesh.prototype.updateMatrixWorld = function(force) {\r\n\r\n  THREE.Mesh.prototype.updateMatrixWorld.call(this, true);\r\n\r\n  if (this.bindMode === \"attached\") {\r\n\r\n    this.bindMatrixInverse.getInverse(this.matrixWorld);\r\n\r\n  }\r\n  else if (this.bindMode === \"detached\") {\r\n\r\n    this.bindMatrixInverse.getInverse(this.bindMatrix);\r\n\r\n  }\r\n  else {\r\n\r\n    THREE.warn('THREE.SkinnedMesh unreckognized bindMode: ' + this.bindMode);\r\n\r\n  }\r\n\r\n};\r\n\r\nTHREE.SkinnedMesh.prototype.clone = function(object) {\r\n\r\n  if (object === undefined) {\r\n\r\n    object = new THREE.SkinnedMesh(this.geometry, this.material, this.useVertexTexture);\r\n\r\n  }\r\n\r\n  THREE.Mesh.prototype.clone.call(this, object);\r\n\r\n  return object;\r\n\r\n};\r\n\r\n\r\n// File:src/objects/MorphAnimMesh.js\r\n\r\n/**\r\n * @author alteredq / http://alteredqualia.com/\r\n */\r\n\r\nTHREE.MorphAnimMesh = function(geometry, material) {\r\n\r\n  THREE.Mesh.call(this, geometry, material);\r\n\r\n  this.type = 'MorphAnimMesh';\r\n\r\n  // API\r\n\r\n  this.duration = 1000; // milliseconds\r\n  this.mirroredLoop = false;\r\n  this.time = 0;\r\n\r\n  // internals\r\n\r\n  this.lastKeyframe = 0;\r\n  this.currentKeyframe = 0;\r\n\r\n  this.direction = 1;\r\n  this.directionBackwards = false;\r\n\r\n  this.setFrameRange(0, this.geometry.morphTargets.length - 1);\r\n\r\n};\r\n\r\nTHREE.MorphAnimMesh.prototype = Object.create(THREE.Mesh.prototype);\r\nTHREE.MorphAnimMesh.prototype.constructor = THREE.MorphAnimMesh;\r\n\r\nTHREE.MorphAnimMesh.prototype.setFrameRange = function(start, end) {\r\n\r\n  this.startKeyframe = start;\r\n  this.endKeyframe = end;\r\n\r\n  this.length = this.endKeyframe - this.startKeyframe + 1;\r\n\r\n};\r\n\r\nTHREE.MorphAnimMesh.prototype.setDirectionForward = function() {\r\n\r\n  this.direction = 1;\r\n  this.directionBackwards = false;\r\n\r\n};\r\n\r\nTHREE.MorphAnimMesh.prototype.setDirectionBackward = function() {\r\n\r\n  this.direction = -1;\r\n  this.directionBackwards = true;\r\n\r\n};\r\n\r\nTHREE.MorphAnimMesh.prototype.parseAnimations = function() {\r\n\r\n  var geometry = this.geometry;\r\n\r\n  if (!geometry.animations) geometry.animations = {};\r\n\r\n  var firstAnimation, animations = geometry.animations;\r\n\r\n  var pattern = /([a-z]+)_?(\\d+)/;\r\n\r\n  for (var i = 0, il = geometry.morphTargets.length; i < il; i++) {\r\n\r\n    var morph = geometry.morphTargets[i];\r\n    var parts = morph.name.match(pattern);\r\n\r\n    if (parts && parts.length > 1) {\r\n\r\n      var label = parts[1];\r\n\r\n      if (!animations[label]) animations[label] = {\r\n        start: Infinity,\r\n        end: -Infinity\r\n      };\r\n\r\n      var animation = animations[label];\r\n\r\n      if (i < animation.start) animation.start = i;\r\n      if (i > animation.end) animation.end = i;\r\n\r\n      if (!firstAnimation) firstAnimation = label;\r\n\r\n    }\r\n\r\n  }\r\n\r\n  geometry.firstAnimation = firstAnimation;\r\n\r\n};\r\n\r\nTHREE.MorphAnimMesh.prototype.setAnimationLabel = function(label, start, end) {\r\n\r\n  if (!this.geometry.animations) this.geometry.animations = {};\r\n\r\n  this.geometry.animations[label] = {\r\n    start: start,\r\n    end: end\r\n  };\r\n\r\n};\r\n\r\nTHREE.MorphAnimMesh.prototype.playAnimation = function(label, fps) {\r\n\r\n  var animation = this.geometry.animations[label];\r\n\r\n  if (animation) {\r\n\r\n    this.setFrameRange(animation.start, animation.end);\r\n    this.duration = 1000 * ((animation.end - animation.start) / fps);\r\n    this.time = 0;\r\n\r\n  }\r\n  else {\r\n\r\n    THREE.warn('THREE.MorphAnimMesh: animation[' + label + '] undefined in .playAnimation()');\r\n\r\n  }\r\n\r\n};\r\n\r\nTHREE.MorphAnimMesh.prototype.updateAnimation = function(delta) {\r\n\r\n  var frameTime = this.duration / this.length;\r\n\r\n  this.time += this.direction * delta;\r\n\r\n  if (this.mirroredLoop) {\r\n\r\n    if (this.time > this.duration || this.time < 0) {\r\n\r\n      this.direction *= -1;\r\n\r\n      if (this.time > this.duration) {\r\n\r\n        this.time = this.duration;\r\n        this.directionBackwards = true;\r\n\r\n      }\r\n\r\n      if (this.time < 0) {\r\n\r\n        this.time = 0;\r\n        this.directionBackwards = false;\r\n\r\n      }\r\n\r\n    }\r\n\r\n  }\r\n  else {\r\n\r\n    this.time = this.time % this.duration;\r\n\r\n    if (this.time < 0) this.time += this.duration;\r\n\r\n  }\r\n\r\n  var keyframe = this.startKeyframe + THREE.Math.clamp(Math.floor(this.time / frameTime), 0, this.length - 1);\r\n\r\n  if (keyframe !== this.currentKeyframe) {\r\n\r\n    this.morphTargetInfluences[this.lastKeyframe] = 0;\r\n    this.morphTargetInfluences[this.currentKeyframe] = 1;\r\n\r\n    this.morphTargetInfluences[keyframe] = 0;\r\n\r\n    this.lastKeyframe = this.currentKeyframe;\r\n    this.currentKeyframe = keyframe;\r\n\r\n  }\r\n\r\n  var mix = (this.time % frameTime) / frameTime;\r\n\r\n  if (this.directionBackwards) {\r\n\r\n    mix = 1 - mix;\r\n\r\n  }\r\n\r\n  this.morphTargetInfluences[this.currentKeyframe] = mix;\r\n  this.morphTargetInfluences[this.lastKeyframe] = 1 - mix;\r\n\r\n};\r\n\r\nTHREE.MorphAnimMesh.prototype.interpolateTargets = function(a, b, t) {\r\n\r\n  var influences = this.morphTargetInfluences;\r\n\r\n  for (var i = 0, l = influences.length; i < l; i++) {\r\n\r\n    influences[i] = 0;\r\n\r\n  }\r\n\r\n  if (a > -1) influences[a] = 1 - t;\r\n  if (b > -1) influences[b] = t;\r\n\r\n};\r\n\r\nTHREE.MorphAnimMesh.prototype.clone = function(object) {\r\n\r\n  if (object === undefined) object = new THREE.MorphAnimMesh(this.geometry, this.material);\r\n\r\n  object.duration = this.duration;\r\n  object.mirroredLoop = this.mirroredLoop;\r\n  object.time = this.time;\r\n\r\n  object.lastKeyframe = this.lastKeyframe;\r\n  object.currentKeyframe = this.currentKeyframe;\r\n\r\n  object.direction = this.direction;\r\n  object.directionBackwards = this.directionBackwards;\r\n\r\n  THREE.Mesh.prototype.clone.call(this, object);\r\n\r\n  return object;\r\n\r\n};\r\n\r\n// File:src/objects/LOD.js\r\n\r\n/**\r\n * @author mikael emtinger / http://gomo.se/\r\n * @author alteredq / http://alteredqualia.com/\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.LOD = function() {\r\n\r\n  THREE.Object3D.call(this);\r\n\r\n  this.objects = [];\r\n\r\n};\r\n\r\n\r\nTHREE.LOD.prototype = Object.create(THREE.Object3D.prototype);\r\nTHREE.LOD.prototype.constructor = THREE.LOD;\r\n\r\nTHREE.LOD.prototype.addLevel = function(object, distance) {\r\n\r\n  if (distance === undefined) distance = 0;\r\n\r\n  distance = Math.abs(distance);\r\n\r\n  for (var l = 0; l < this.objects.length; l++) {\r\n\r\n    if (distance < this.objects[l].distance) {\r\n\r\n      break;\r\n\r\n    }\r\n\r\n  }\r\n\r\n  this.objects.splice(l, 0, {\r\n    distance: distance,\r\n    object: object\r\n  });\r\n  this.add(object);\r\n\r\n};\r\n\r\nTHREE.LOD.prototype.getObjectForDistance = function(distance) {\r\n\r\n  for (var i = 1, l = this.objects.length; i < l; i++) {\r\n\r\n    if (distance < this.objects[i].distance) {\r\n\r\n      break;\r\n\r\n    }\r\n\r\n  }\r\n\r\n  return this.objects[i - 1].object;\r\n\r\n};\r\n\r\nTHREE.LOD.prototype.raycast = (function() {\r\n\r\n  var matrixPosition = new THREE.Vector3();\r\n\r\n  return function(raycaster, intersects) {\r\n\r\n    matrixPosition.setFromMatrixPosition(this.matrixWorld);\r\n\r\n    var distance = raycaster.ray.origin.distanceTo(matrixPosition);\r\n\r\n    this.getObjectForDistance(distance).raycast(raycaster, intersects);\r\n\r\n  };\r\n\r\n}());\r\n\r\nTHREE.LOD.prototype.update = function() {\r\n\r\n  var v1 = new THREE.Vector3();\r\n  var v2 = new THREE.Vector3();\r\n\r\n  return function(camera) {\r\n\r\n    if (this.objects.length > 1) {\r\n\r\n      v1.setFromMatrixPosition(camera.matrixWorld);\r\n      v2.setFromMatrixPosition(this.matrixWorld);\r\n\r\n      var distance = v1.distanceTo(v2);\r\n\r\n      this.objects[0].object.visible = true;\r\n\r\n      for (var i = 1, l = this.objects.length; i < l; i++) {\r\n\r\n        if (distance >= this.objects[i].distance) {\r\n\r\n          this.objects[i - 1].object.visible = false;\r\n          this.objects[i].object.visible = true;\r\n\r\n        }\r\n        else {\r\n\r\n          break;\r\n\r\n        }\r\n\r\n      }\r\n\r\n      for (; i < l; i++) {\r\n\r\n        this.objects[i].object.visible = false;\r\n\r\n      }\r\n\r\n    }\r\n\r\n  };\r\n\r\n}();\r\n\r\nTHREE.LOD.prototype.clone = function(object) {\r\n\r\n  if (object === undefined) object = new THREE.LOD();\r\n\r\n  THREE.Object3D.prototype.clone.call(this, object);\r\n\r\n  for (var i = 0, l = this.objects.length; i < l; i++) {\r\n    var x = this.objects[i].object.clone();\r\n    x.visible = i === 0;\r\n    object.addLevel(x, this.objects[i].distance);\r\n  }\r\n\r\n  return object;\r\n\r\n};\r\n\r\n// File:src/objects/Sprite.js\r\n\r\n/**\r\n * @author mikael emtinger / http://gomo.se/\r\n * @author alteredq / http://alteredqualia.com/\r\n */\r\n\r\nTHREE.Sprite = (function() {\r\n\r\n  var indices = new Uint16Array([0, 1, 2, 0, 2, 3]);\r\n  var vertices = new Float32Array([-0.5, -0.5, 0, 0.5, -0.5, 0, 0.5, 0.5, 0, -0.5, 0.5, 0]);\r\n  var uvs = new Float32Array([0, 0, 1, 0, 1, 1, 0, 1]);\r\n\r\n  var geometry = new THREE.BufferGeometry();\r\n  geometry.addAttribute('index', new THREE.BufferAttribute(indices, 1));\r\n  geometry.addAttribute('position', new THREE.BufferAttribute(vertices, 3));\r\n  geometry.addAttribute('uv', new THREE.BufferAttribute(uvs, 2));\r\n\r\n  return function(material) {\r\n\r\n    THREE.Object3D.call(this);\r\n\r\n    this.type = 'Sprite';\r\n\r\n    this.geometry = geometry;\r\n    this.material = (material !== undefined) ? material : new THREE.SpriteMaterial();\r\n\r\n  };\r\n\r\n})();\r\n\r\nTHREE.Sprite.prototype = Object.create(THREE.Object3D.prototype);\r\nTHREE.Sprite.prototype.constructor = THREE.Sprite;\r\n\r\nTHREE.Sprite.prototype.raycast = (function() {\r\n\r\n  var matrixPosition = new THREE.Vector3();\r\n\r\n  return function(raycaster, intersects) {\r\n\r\n    matrixPosition.setFromMatrixPosition(this.matrixWorld);\r\n\r\n    var distance = raycaster.ray.distanceToPoint(matrixPosition);\r\n\r\n    if (distance > this.scale.x) {\r\n\r\n      return;\r\n\r\n    }\r\n\r\n    intersects.push({\r\n\r\n      distance: distance,\r\n      point: this.position,\r\n      face: null,\r\n      object: this\r\n\r\n    });\r\n\r\n  };\r\n\r\n}());\r\n\r\nTHREE.Sprite.prototype.clone = function(object) {\r\n\r\n  if (object === undefined) object = new THREE.Sprite(this.material);\r\n\r\n  THREE.Object3D.prototype.clone.call(this, object);\r\n\r\n  return object;\r\n\r\n};\r\n\r\n// Backwards compatibility\r\n\r\nTHREE.Particle = THREE.Sprite;\r\n\r\n// File:src/objects/LensFlare.js\r\n\r\n/**\r\n * @author mikael emtinger / http://gomo.se/\r\n * @author alteredq / http://alteredqualia.com/\r\n */\r\n\r\nTHREE.LensFlare = function(texture, size, distance, blending, color) {\r\n\r\n  THREE.Object3D.call(this);\r\n\r\n  this.lensFlares = [];\r\n\r\n  this.positionScreen = new THREE.Vector3();\r\n  this.customUpdateCallback = undefined;\r\n\r\n  if (texture !== undefined) {\r\n\r\n    this.add(texture, size, distance, blending, color);\r\n\r\n  }\r\n\r\n};\r\n\r\nTHREE.LensFlare.prototype = Object.create(THREE.Object3D.prototype);\r\nTHREE.LensFlare.prototype.constructor = THREE.LensFlare;\r\n\r\n\r\n/*\r\n * Add: adds another flare\r\n */\r\n\r\nTHREE.LensFlare.prototype.add = function(texture, size, distance, blending, color, opacity) {\r\n\r\n  if (size === undefined) size = -1;\r\n  if (distance === undefined) distance = 0;\r\n  if (opacity === undefined) opacity = 1;\r\n  if (color === undefined) color = new THREE.Color(0xffffff);\r\n  if (blending === undefined) blending = THREE.NormalBlending;\r\n\r\n  distance = Math.min(distance, Math.max(0, distance));\r\n\r\n  this.lensFlares.push({\r\n    texture: texture, // THREE.Texture\r\n    size: size, // size in pixels (-1 = use texture.width)\r\n    distance: distance, // distance (0-1) from light source (0=at light source)\r\n    x: 0,\r\n    y: 0,\r\n    z: 0, // screen position (-1 => 1) z = 0 is ontop z = 1 is back\r\n    scale: 1, // scale\r\n    rotation: 1, // rotation\r\n    opacity: opacity, // opacity\r\n    color: color, // color\r\n    blending: blending // blending\r\n  });\r\n\r\n};\r\n\r\n/*\r\n * Update lens flares update positions on all flares based on the screen position\r\n * Set myLensFlare.customUpdateCallback to alter the flares in your project specific way.\r\n */\r\n\r\nTHREE.LensFlare.prototype.updateLensFlares = function() {\r\n\r\n  var f, fl = this.lensFlares.length;\r\n  var flare;\r\n  var vecX = -this.positionScreen.x * 2;\r\n  var vecY = -this.positionScreen.y * 2;\r\n\r\n  for (f = 0; f < fl; f++) {\r\n\r\n    flare = this.lensFlares[f];\r\n\r\n    flare.x = this.positionScreen.x + vecX * flare.distance;\r\n    flare.y = this.positionScreen.y + vecY * flare.distance;\r\n\r\n    flare.wantedRotation = flare.x * Math.PI * 0.25;\r\n    flare.rotation += (flare.wantedRotation - flare.rotation) * 0.25;\r\n\r\n  }\r\n\r\n};\r\n\r\n\r\n// File:src/scenes/Scene.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.Scene = function() {\r\n\r\n  THREE.Object3D.call(this);\r\n\r\n  this.type = 'Scene';\r\n\r\n  this.fog = null;\r\n  this.overrideMaterial = null;\r\n\r\n  this.autoUpdate = true; // checked by the renderer\r\n\r\n};\r\n\r\nTHREE.Scene.prototype = Object.create(THREE.Object3D.prototype);\r\nTHREE.Scene.prototype.constructor = THREE.Scene;\r\n\r\nTHREE.Scene.prototype.clone = function(object) {\r\n\r\n  if (object === undefined) object = new THREE.Scene();\r\n\r\n  THREE.Object3D.prototype.clone.call(this, object);\r\n\r\n  if (this.fog !== null) object.fog = this.fog.clone();\r\n  if (this.overrideMaterial !== null) object.overrideMaterial = this.overrideMaterial.clone();\r\n\r\n  object.autoUpdate = this.autoUpdate;\r\n  object.matrixAutoUpdate = this.matrixAutoUpdate;\r\n\r\n  return object;\r\n\r\n};\r\n\r\n// File:src/scenes/Fog.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author alteredq / http://alteredqualia.com/\r\n */\r\n\r\nTHREE.Fog = function(color, near, far) {\r\n\r\n  this.name = '';\r\n\r\n  this.color = new THREE.Color(color);\r\n\r\n  this.near = (near !== undefined) ? near : 1;\r\n  this.far = (far !== undefined) ? far : 1000;\r\n\r\n};\r\n\r\nTHREE.Fog.prototype.clone = function() {\r\n\r\n  return new THREE.Fog(this.color.getHex(), this.near, this.far);\r\n\r\n};\r\n\r\n// File:src/scenes/FogExp2.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author alteredq / http://alteredqualia.com/\r\n */\r\n\r\nTHREE.FogExp2 = function(color, density) {\r\n\r\n  this.name = '';\r\n\r\n  this.color = new THREE.Color(color);\r\n  this.density = (density !== undefined) ? density : 0.00025;\r\n\r\n};\r\n\r\nTHREE.FogExp2.prototype.clone = function() {\r\n\r\n  return new THREE.FogExp2(this.color.getHex(), this.density);\r\n\r\n};\r\n\r\n// File:src/renderers/shaders/ShaderChunk.js\r\n\r\nTHREE.ShaderChunk = {};\r\n\r\n// File:src/renderers/shaders/ShaderChunk/common.glsl\r\n\r\nTHREE.ShaderChunk['common'] = \"#define PI 3.14159\\n#define PI2 6.28318\\n#define RECIPROCAL_PI2 0.15915494\\n#define LOG2 1.442695\\n#define EPSILON 1e-6\\n\\nfloat square( in float a ) { return a*a; }\\nvec2  square( in vec2 a )  { return vec2( a.x*a.x, a.y*a.y ); }\\nvec3  square( in vec3 a )  { return vec3( a.x*a.x, a.y*a.y, a.z*a.z ); }\\nvec4  square( in vec4 a )  { return vec4( a.x*a.x, a.y*a.y, a.z*a.z, a.w*a.w ); }\\nfloat saturate( in float a ) { return clamp( a, 0.0, 1.0 ); }\\nvec2  saturate( in vec2 a )  { return clamp( a, 0.0, 1.0 ); }\\nvec3  saturate( in vec3 a )  { return clamp( a, 0.0, 1.0 ); }\\nvec4  saturate( in vec4 a )  { return clamp( a, 0.0, 1.0 ); }\\nfloat average( in float a ) { return a; }\\nfloat average( in vec2 a )  { return ( a.x + a.y) * 0.5; }\\nfloat average( in vec3 a )  { return ( a.x + a.y + a.z) / 3.0; }\\nfloat average( in vec4 a )  { return ( a.x + a.y + a.z + a.w) * 0.25; }\\nfloat whiteCompliment( in float a ) { return saturate( 1.0 - a ); }\\nvec2  whiteCompliment( in vec2 a )  { return saturate( vec2(1.0) - a ); }\\nvec3  whiteCompliment( in vec3 a )  { return saturate( vec3(1.0) - a ); }\\nvec4  whiteCompliment( in vec4 a )  { return saturate( vec4(1.0) - a ); }\\nvec3 transformDirection( in vec3 normal, in mat4 matrix ) {\\n\treturn normalize( ( matrix * vec4( normal, 0.0 ) ).xyz );\\n}\\n// http://en.wikibooks.org/wiki/GLSL_Programming/Applying_Matrix_Transformations\\nvec3 inverseTransformDirection( in vec3 normal, in mat4 matrix ) {\\n\treturn normalize( ( vec4( normal, 0.0 ) * matrix ).xyz );\\n}\\nvec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal) {\\n\tfloat distance = dot( planeNormal, point-pointOnPlane );\\n\treturn point - distance * planeNormal;\\n}\\nfloat sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\\n\treturn sign( dot( point - pointOnPlane, planeNormal ) );\\n}\\nvec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {\\n\treturn pointOnLine + lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) );\\n}\\nfloat calcLightAttenuation( float lightDistance, float cutoffDistance, float decayExponent ) {\\n\tif ( decayExponent > 0.0 ) {\\n\t  return pow( saturate( 1.0 - lightDistance / cutoffDistance ), decayExponent );\\n\t}\\n\treturn 1.0;\\n}\\n\\nvec3 inputToLinear( in vec3 a ) {\\n#ifdef GAMMA_INPUT\\n\treturn pow( a, vec3( float( GAMMA_FACTOR ) ) );\\n#else\\n\treturn a;\\n#endif\\n}\\nvec3 linearToOutput( in vec3 a ) {\\n#ifdef GAMMA_OUTPUT\\n\treturn pow( a, vec3( 1.0 / float( GAMMA_FACTOR ) ) );\\n#else\\n\treturn a;\\n#endif\\n}\\n\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/alphatest_fragment.glsl\r\n\r\nTHREE.ShaderChunk['alphatest_fragment'] = \"#ifdef ALPHATEST\\n\\n\tif ( diffuseColor.a < ALPHATEST ) discard;\\n\\n#endif\\n\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/lights_lambert_vertex.glsl\r\n\r\nTHREE.ShaderChunk['lights_lambert_vertex'] = \"vLightFront = vec3( 0.0 );\\n\\n#ifdef DOUBLE_SIDED\\n\\n\tvLightBack = vec3( 0.0 );\\n\\n#endif\\n\\ntransformedNormal = normalize( transformedNormal );\\n\\n#if MAX_DIR_LIGHTS > 0\\n\\nfor( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {\\n\\n\tvec3 dirVector = transformDirection( directionalLightDirection[ i ], viewMatrix );\\n\\n\tfloat dotProduct = dot( transformedNormal, dirVector );\\n\tvec3 directionalLightWeighting = vec3( max( dotProduct, 0.0 ) );\\n\\n\t#ifdef DOUBLE_SIDED\\n\\n\t\tvec3 directionalLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );\\n\\n\t\t#ifdef WRAP_AROUND\\n\\n\t\t\tvec3 directionalLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );\\n\\n\t\t#endif\\n\\n\t#endif\\n\\n\t#ifdef WRAP_AROUND\\n\\n\t\tvec3 directionalLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );\\n\t\tdirectionalLightWeighting = mix( directionalLightWeighting, directionalLightWeightingHalf, wrapRGB );\\n\\n\t\t#ifdef DOUBLE_SIDED\\n\\n\t\t\tdirectionalLightWeightingBack = mix( directionalLightWeightingBack, directionalLightWeightingHalfBack, wrapRGB );\\n\\n\t\t#endif\\n\\n\t#endif\\n\\n\tvLightFront += directionalLightColor[ i ] * directionalLightWeighting;\\n\\n\t#ifdef DOUBLE_SIDED\\n\\n\t\tvLightBack += directionalLightColor[ i ] * directionalLightWeightingBack;\\n\\n\t#endif\\n\\n}\\n\\n#endif\\n\\n#if MAX_POINT_LIGHTS > 0\\n\\n\tfor( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\\n\\n\t\tvec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\\n\t\tvec3 lVector = lPosition.xyz - mvPosition.xyz;\\n\\n\t\tfloat attenuation = calcLightAttenuation( length( lVector ), pointLightDistance[ i ], pointLightDecay[ i ] );\\n\\n\t\tlVector = normalize( lVector );\\n\t\tfloat dotProduct = dot( transformedNormal, lVector );\\n\\n\t\tvec3 pointLightWeighting = vec3( max( dotProduct, 0.0 ) );\\n\\n\t\t#ifdef DOUBLE_SIDED\\n\\n\t\t\tvec3 pointLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );\\n\\n\t\t\t#ifdef WRAP_AROUND\\n\\n\t\t\t\tvec3 pointLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );\\n\\n\t\t\t#endif\\n\\n\t\t#endif\\n\\n\t\t#ifdef WRAP_AROUND\\n\\n\t\t\tvec3 pointLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );\\n\t\t\tpointLightWeighting = mix( pointLightWeighting, pointLightWeightingHalf, wrapRGB );\\n\\n\t\t\t#ifdef DOUBLE_SIDED\\n\\n\t\t\t\tpointLightWeightingBack = mix( pointLightWeightingBack, pointLightWeightingHalfBack, wrapRGB );\\n\\n\t\t\t#endif\\n\\n\t\t#endif\\n\\n\t\tvLightFront += pointLightColor[ i ] * pointLightWeighting * attenuation;\\n\\n\t\t#ifdef DOUBLE_SIDED\\n\\n\t\t\tvLightBack += pointLightColor[ i ] * pointLightWeightingBack * attenuation;\\n\\n\t\t#endif\\n\\n\t}\\n\\n#endif\\n\\n#if MAX_SPOT_LIGHTS > 0\\n\\n\tfor( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {\\n\\n\t\tvec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );\\n\t\tvec3 lVector = lPosition.xyz - mvPosition.xyz;\\n\\n\t\tfloat spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - worldPosition.xyz ) );\\n\\n\t\tif ( spotEffect > spotLightAngleCos[ i ] ) {\\n\\n\t\t\tspotEffect = max( pow( max( spotEffect, 0.0 ), spotLightExponent[ i ] ), 0.0 );\\n\\n\t\t\tfloat attenuation = calcLightAttenuation( length( lVector ), spotLightDistance[ i ], spotLightDecay[ i ] );\\n\\n\t\t\tlVector = normalize( lVector );\\n\\n\t\t\tfloat dotProduct = dot( transformedNormal, lVector );\\n\t\t\tvec3 spotLightWeighting = vec3( max( dotProduct, 0.0 ) );\\n\\n\t\t\t#ifdef DOUBLE_SIDED\\n\\n\t\t\t\tvec3 spotLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );\\n\\n\t\t\t\t#ifdef WRAP_AROUND\\n\\n\t\t\t\t\tvec3 spotLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );\\n\\n\t\t\t\t#endif\\n\\n\t\t\t#endif\\n\\n\t\t\t#ifdef WRAP_AROUND\\n\\n\t\t\t\tvec3 spotLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );\\n\t\t\t\tspotLightWeighting = mix( spotLightWeighting, spotLightWeightingHalf, wrapRGB );\\n\\n\t\t\t\t#ifdef DOUBLE_SIDED\\n\\n\t\t\t\t\tspotLightWeightingBack = mix( spotLightWeightingBack, spotLightWeightingHalfBack, wrapRGB );\\n\\n\t\t\t\t#endif\\n\\n\t\t\t#endif\\n\\n\t\t\tvLightFront += spotLightColor[ i ] * spotLightWeighting * attenuation * spotEffect;\\n\\n\t\t\t#ifdef DOUBLE_SIDED\\n\\n\t\t\t\tvLightBack += spotLightColor[ i ] * spotLightWeightingBack * attenuation * spotEffect;\\n\\n\t\t\t#endif\\n\\n\t\t}\\n\\n\t}\\n\\n#endif\\n\\n#if MAX_HEMI_LIGHTS > 0\\n\\n\tfor( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {\\n\\n\t\tvec3 lVector = transformDirection( hemisphereLightDirection[ i ], viewMatrix );\\n\\n\t\tfloat dotProduct = dot( transformedNormal, lVector );\\n\\n\t\tfloat hemiDiffuseWeight = 0.5 * dotProduct + 0.5;\\n\t\tfloat hemiDiffuseWeightBack = -0.5 * dotProduct + 0.5;\\n\\n\t\tvLightFront += mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );\\n\\n\t\t#ifdef DOUBLE_SIDED\\n\\n\t\t\tvLightBack += mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeightBack );\\n\\n\t\t#endif\\n\\n\t}\\n\\n#endif\\n\\nvLightFront += ambientLightColor;\\n\\n#ifdef DOUBLE_SIDED\\n\\n\tvLightBack += ambientLightColor;\\n\\n#endif\\n\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/map_particle_pars_fragment.glsl\r\n\r\nTHREE.ShaderChunk['map_particle_pars_fragment'] = \"#ifdef USE_MAP\\n\\n\tuniform vec4 offsetRepeat;\\n\tuniform sampler2D map;\\n\\n#endif\\n\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/default_vertex.glsl\r\n\r\nTHREE.ShaderChunk['default_vertex'] = \"#ifdef USE_SKINNING\\n\\n\tvec4 mvPosition = modelViewMatrix * skinned;\\n\\n#elif defined( USE_MORPHTARGETS )\\n\\n\tvec4 mvPosition = modelViewMatrix * vec4( morphed, 1.0 );\\n\\n#else\\n\\n\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\\n\\n#endif\\n\\ngl_Position = projectionMatrix * mvPosition;\\n\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/map_pars_fragment.glsl\r\n\r\nTHREE.ShaderChunk['map_pars_fragment'] = \"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP )\\n\\n\tvarying vec2 vUv;\\n\\n#endif\\n\\n#ifdef USE_MAP\\n\\n\tuniform sampler2D map;\\n\\n#endif\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/skinnormal_vertex.glsl\r\n\r\nTHREE.ShaderChunk['skinnormal_vertex'] = \"#ifdef USE_SKINNING\\n\\n\tmat4 skinMatrix = mat4( 0.0 );\\n\tskinMatrix += skinWeight.x * boneMatX;\\n\tskinMatrix += skinWeight.y * boneMatY;\\n\tskinMatrix += skinWeight.z * boneMatZ;\\n\tskinMatrix += skinWeight.w * boneMatW;\\n\tskinMatrix  = bindMatrixInverse * skinMatrix * bindMatrix;\\n\\n\t#ifdef USE_MORPHNORMALS\\n\\n\tvec4 skinnedNormal = skinMatrix * vec4( morphedNormal, 0.0 );\\n\\n\t#else\\n\\n\tvec4 skinnedNormal = skinMatrix * vec4( normal, 0.0 );\\n\\n\t#endif\\n\\n#endif\\n\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/logdepthbuf_pars_vertex.glsl\r\n\r\nTHREE.ShaderChunk['logdepthbuf_pars_vertex'] = \"#ifdef USE_LOGDEPTHBUF\\n\\n\t#ifdef USE_LOGDEPTHBUF_EXT\\n\\n\t\tvarying float vFragDepth;\\n\\n\t#endif\\n\\n\tuniform float logDepthBufFC;\\n\\n#endif\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/lightmap_pars_vertex.glsl\r\n\r\nTHREE.ShaderChunk['lightmap_pars_vertex'] = \"#ifdef USE_LIGHTMAP\\n\\n\tvarying vec2 vUv2;\\n\\n#endif\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/lights_phong_fragment.glsl\r\n\r\nTHREE.ShaderChunk['lights_phong_fragment'] = \"#ifndef FLAT_SHADED\\n\\n\tvec3 normal = normalize( vNormal );\\n\\n\t#ifdef DOUBLE_SIDED\\n\\n\t\tnormal = normal * ( -1.0 + 2.0 * float( gl_FrontFacing ) );\\n\\n\t#endif\\n\\n#else\\n\\n\tvec3 fdx = dFdx( vViewPosition );\\n\tvec3 fdy = dFdy( vViewPosition );\\n\tvec3 normal = normalize( cross( fdx, fdy ) );\\n\\n#endif\\n\\nvec3 viewPosition = normalize( vViewPosition );\\n\\n#ifdef USE_NORMALMAP\\n\\n\tnormal = perturbNormal2Arb( -vViewPosition, normal );\\n\\n#elif defined( USE_BUMPMAP )\\n\\n\tnormal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );\\n\\n#endif\\n\\nvec3 totalDiffuseLight = vec3( 0.0 );\\nvec3 totalSpecularLight = vec3( 0.0 );\\n\\n#if MAX_POINT_LIGHTS > 0\\n\\n\tfor ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\\n\\n\t\tvec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\\n\t\tvec3 lVector = lPosition.xyz + vViewPosition.xyz;\\n\\n\t\tfloat attenuation = calcLightAttenuation( length( lVector ), pointLightDistance[ i ], pointLightDecay[ i ] );\\n\\n\t\tlVector = normalize( lVector );\\n\\n\t\t// diffuse\\n\\n\t\tfloat dotProduct = dot( normal, lVector );\\n\\n\t\t#ifdef WRAP_AROUND\\n\\n\t\t\tfloat pointDiffuseWeightFull = max( dotProduct, 0.0 );\\n\t\t\tfloat pointDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );\\n\\n\t\t\tvec3 pointDiffuseWeight = mix( vec3( pointDiffuseWeightFull ), vec3( pointDiffuseWeightHalf ), wrapRGB );\\n\\n\t\t#else\\n\\n\t\t\tfloat pointDiffuseWeight = max( dotProduct, 0.0 );\\n\\n\t\t#endif\\n\\n\t\ttotalDiffuseLight += pointLightColor[ i ] * pointDiffuseWeight * attenuation;\\n\\n\t\t\t\t// specular\\n\\n\t\tvec3 pointHalfVector = normalize( lVector + viewPosition );\\n\t\tfloat pointDotNormalHalf = max( dot( normal, pointHalfVector ), 0.0 );\\n\t\tfloat pointSpecularWeight = specularStrength * max( pow( pointDotNormalHalf, shininess ), 0.0 );\\n\\n\t\tfloat specularNormalization = ( shininess + 2.0 ) / 8.0;\\n\\n\t\tvec3 schlick = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVector, pointHalfVector ), 0.0 ), 5.0 );\\n\t\ttotalSpecularLight += schlick * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * attenuation * specularNormalization;\\n\\n\t}\\n\\n#endif\\n\\n#if MAX_SPOT_LIGHTS > 0\\n\\n\tfor ( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {\\n\\n\t\tvec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );\\n\t\tvec3 lVector = lPosition.xyz + vViewPosition.xyz;\\n\\n\t\tfloat attenuation = calcLightAttenuation( length( lVector ), spotLightDistance[ i ], spotLightDecay[ i ] );\\n\\n\t\tlVector = normalize( lVector );\\n\\n\t\tfloat spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - vWorldPosition ) );\\n\\n\t\tif ( spotEffect > spotLightAngleCos[ i ] ) {\\n\\n\t\t\tspotEffect = max( pow( max( spotEffect, 0.0 ), spotLightExponent[ i ] ), 0.0 );\\n\\n\t\t\t// diffuse\\n\\n\t\t\tfloat dotProduct = dot( normal, lVector );\\n\\n\t\t\t#ifdef WRAP_AROUND\\n\\n\t\t\t\tfloat spotDiffuseWeightFull = max( dotProduct, 0.0 );\\n\t\t\t\tfloat spotDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );\\n\\n\t\t\t\tvec3 spotDiffuseWeight = mix( vec3( spotDiffuseWeightFull ), vec3( spotDiffuseWeightHalf ), wrapRGB );\\n\\n\t\t\t#else\\n\\n\t\t\t\tfloat spotDiffuseWeight = max( dotProduct, 0.0 );\\n\\n\t\t\t#endif\\n\\n\t\t\ttotalDiffuseLight += spotLightColor[ i ] * spotDiffuseWeight * attenuation * spotEffect;\\n\\n\t\t\t// specular\\n\\n\t\t\tvec3 spotHalfVector = normalize( lVector + viewPosition );\\n\t\t\tfloat spotDotNormalHalf = max( dot( normal, spotHalfVector ), 0.0 );\\n\t\t\tfloat spotSpecularWeight = specularStrength * max( pow( spotDotNormalHalf, shininess ), 0.0 );\\n\\n\t\t\tfloat specularNormalization = ( shininess + 2.0 ) / 8.0;\\n\\n\t\t\tvec3 schlick = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVector, spotHalfVector ), 0.0 ), 5.0 );\\n\t\t\ttotalSpecularLight += schlick * spotLightColor[ i ] * spotSpecularWeight * spotDiffuseWeight * attenuation * specularNormalization * spotEffect;\\n\\n\t\t}\\n\\n\t}\\n\\n#endif\\n\\n#if MAX_DIR_LIGHTS > 0\\n\\n\tfor( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {\\n\\n\t\tvec3 dirVector = transformDirection( directionalLightDirection[ i ], viewMatrix );\\n\\n\t\t// diffuse\\n\\n\t\tfloat dotProduct = dot( normal, dirVector );\\n\\n\t\t#ifdef WRAP_AROUND\\n\\n\t\t\tfloat dirDiffuseWeightFull = max( dotProduct, 0.0 );\\n\t\t\tfloat dirDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );\\n\\n\t\t\tvec3 dirDiffuseWeight = mix( vec3( dirDiffuseWeightFull ), vec3( dirDiffuseWeightHalf ), wrapRGB );\\n\\n\t\t#else\\n\\n\t\t\tfloat dirDiffuseWeight = max( dotProduct, 0.0 );\\n\\n\t\t#endif\\n\\n\t\ttotalDiffuseLight += directionalLightColor[ i ] * dirDiffuseWeight;\\n\\n\t\t// specular\\n\\n\t\tvec3 dirHalfVector = normalize( dirVector + viewPosition );\\n\t\tfloat dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );\\n\t\tfloat dirSpecularWeight = specularStrength * max( pow( dirDotNormalHalf, shininess ), 0.0 );\\n\\n\t\t/*\\n\t\t// fresnel term from skin shader\\n\t\tconst float F0 = 0.128;\\n\\n\t\tfloat base = 1.0 - dot( viewPosition, dirHalfVector );\\n\t\tfloat exponential = pow( base, 5.0 );\\n\\n\t\tfloat fresnel = exponential + F0 * ( 1.0 - exponential );\\n\t\t*/\\n\\n\t\t/*\\n\t\t// fresnel term from fresnel shader\\n\t\tconst float mFresnelBias = 0.08;\\n\t\tconst float mFresnelScale = 0.3;\\n\t\tconst float mFresnelPower = 5.0;\\n\\n\t\tfloat fresnel = mFresnelBias + mFresnelScale * pow( 1.0 + dot( normalize( -viewPosition ), normal ), mFresnelPower );\\n\t\t*/\\n\\n\t\tfloat specularNormalization = ( shininess + 2.0 ) / 8.0;\\n\\n\t\t// \t\tdirSpecular += specular * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight * specularNormalization * fresnel;\\n\\n\t\tvec3 schlick = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( dirVector, dirHalfVector ), 0.0 ), 5.0 );\\n\t\ttotalSpecularLight += schlick * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight * specularNormalization;\\n\\n\\n\t}\\n\\n#endif\\n\\n#if MAX_HEMI_LIGHTS > 0\\n\\n\tfor( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {\\n\\n\t\tvec3 lVector = transformDirection( hemisphereLightDirection[ i ], viewMatrix );\\n\\n\t\t// diffuse\\n\\n\t\tfloat dotProduct = dot( normal, lVector );\\n\t\tfloat hemiDiffuseWeight = 0.5 * dotProduct + 0.5;\\n\\n\t\tvec3 hemiColor = mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );\\n\\n\t\ttotalDiffuseLight += hemiColor;\\n\\n\t\t// specular (sky light)\\n\\n\t\tvec3 hemiHalfVectorSky = normalize( lVector + viewPosition );\\n\t\tfloat hemiDotNormalHalfSky = 0.5 * dot( normal, hemiHalfVectorSky ) + 0.5;\\n\t\tfloat hemiSpecularWeightSky = specularStrength * max( pow( max( hemiDotNormalHalfSky, 0.0 ), shininess ), 0.0 );\\n\\n\t\t// specular (ground light)\\n\\n\t\tvec3 lVectorGround = -lVector;\\n\\n\t\tvec3 hemiHalfVectorGround = normalize( lVectorGround + viewPosition );\\n\t\tfloat hemiDotNormalHalfGround = 0.5 * dot( normal, hemiHalfVectorGround ) + 0.5;\\n\t\tfloat hemiSpecularWeightGround = specularStrength * max( pow( max( hemiDotNormalHalfGround, 0.0 ), shininess ), 0.0 );\\n\\n\t\tfloat dotProductGround = dot( normal, lVectorGround );\\n\\n\t\tfloat specularNormalization = ( shininess + 2.0 ) / 8.0;\\n\\n\t\tvec3 schlickSky = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVector, hemiHalfVectorSky ), 0.0 ), 5.0 );\\n\t\tvec3 schlickGround = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVectorGround, hemiHalfVectorGround ), 0.0 ), 5.0 );\\n\t\ttotalSpecularLight += hemiColor * specularNormalization * ( schlickSky * hemiSpecularWeightSky * max( dotProduct, 0.0 ) + schlickGround * hemiSpecularWeightGround * max( dotProductGround, 0.0 ) );\\n\\n\t}\\n\\n#endif\\n\\n#ifdef METAL\\n\\n\toutgoingLight += diffuseColor.rgb * ( totalDiffuseLight + ambientLightColor ) * specular + totalSpecularLight + emissive;\\n\\n#else\\n\\n\toutgoingLight += diffuseColor.rgb * ( totalDiffuseLight + ambientLightColor ) + totalSpecularLight + emissive;\\n\\n#endif\\n\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/fog_pars_fragment.glsl\r\n\r\nTHREE.ShaderChunk['fog_pars_fragment'] = \"#ifdef USE_FOG\\n\\n\tuniform vec3 fogColor;\\n\\n\t#ifdef FOG_EXP2\\n\\n\t\tuniform float fogDensity;\\n\\n\t#else\\n\\n\t\tuniform float fogNear;\\n\t\tuniform float fogFar;\\n\t#endif\\n\\n#endif\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/morphnormal_vertex.glsl\r\n\r\nTHREE.ShaderChunk['morphnormal_vertex'] = \"#ifdef USE_MORPHNORMALS\\n\\n\tvec3 morphedNormal = vec3( 0.0 );\\n\\n\tmorphedNormal += ( morphNormal0 - normal ) * morphTargetInfluences[ 0 ];\\n\tmorphedNormal += ( morphNormal1 - normal ) * morphTargetInfluences[ 1 ];\\n\tmorphedNormal += ( morphNormal2 - normal ) * morphTargetInfluences[ 2 ];\\n\tmorphedNormal += ( morphNormal3 - normal ) * morphTargetInfluences[ 3 ];\\n\\n\tmorphedNormal += normal;\\n\\n#endif\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/envmap_pars_fragment.glsl\r\n\r\nTHREE.ShaderChunk['envmap_pars_fragment'] = \"#ifdef USE_ENVMAP\\n\\n\tuniform float reflectivity;\\n\t#ifdef ENVMAP_TYPE_CUBE\\n\t\tuniform samplerCube envMap;\\n\t#else\\n\t\tuniform sampler2D envMap;\\n\t#endif\\n\tuniform float flipEnvMap;\\n\\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\\n\\n\t\tuniform float refractionRatio;\\n\\n\t#else\\n\\n\t\tvarying vec3 vReflect;\\n\\n\t#endif\\n\\n#endif\\n\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/logdepthbuf_fragment.glsl\r\n\r\nTHREE.ShaderChunk['logdepthbuf_fragment'] = \"#if defined(USE_LOGDEPTHBUF) && defined(USE_LOGDEPTHBUF_EXT)\\n\\n\tgl_FragDepthEXT = log2(vFragDepth) * logDepthBufFC * 0.5;\\n\\n#endif\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/normalmap_pars_fragment.glsl\r\n\r\nTHREE.ShaderChunk['normalmap_pars_fragment'] = \"#ifdef USE_NORMALMAP\\n\\n\tuniform sampler2D normalMap;\\n\tuniform vec2 normalScale;\\n\\n\t// Per-Pixel Tangent Space Normal Mapping\\n\t// http://hacksoflife.blogspot.ch/2009/11/per-pixel-tangent-space-normal-mapping.html\\n\\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm ) {\\n\\n\t\tvec3 q0 = dFdx( eye_pos.xyz );\\n\t\tvec3 q1 = dFdy( eye_pos.xyz );\\n\t\tvec2 st0 = dFdx( vUv.st );\\n\t\tvec2 st1 = dFdy( vUv.st );\\n\\n\t\tvec3 S = normalize( q0 * st1.t - q1 * st0.t );\\n\t\tvec3 T = normalize( -q0 * st1.s + q1 * st0.s );\\n\t\tvec3 N = normalize( surf_norm );\\n\\n\t\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\\n\t\tmapN.xy = normalScale * mapN.xy;\\n\t\tmat3 tsn = mat3( S, T, N );\\n\t\treturn normalize( tsn * mapN );\\n\\n\t}\\n\\n#endif\\n\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/lights_phong_pars_vertex.glsl\r\n\r\nTHREE.ShaderChunk['lights_phong_pars_vertex'] = \"#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP ) || defined( USE_ENVMAP )\\n\\n\tvarying vec3 vWorldPosition;\\n\\n#endif\\n\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/lightmap_pars_fragment.glsl\r\n\r\nTHREE.ShaderChunk['lightmap_pars_fragment'] = \"#ifdef USE_LIGHTMAP\\n\\n\tvarying vec2 vUv2;\\n\tuniform sampler2D lightMap;\\n\\n#endif\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/shadowmap_vertex.glsl\r\n\r\nTHREE.ShaderChunk['shadowmap_vertex'] = \"#ifdef USE_SHADOWMAP\\n\\n\tfor( int i = 0; i < MAX_SHADOWS; i ++ ) {\\n\\n\t\tvShadowCoord[ i ] = shadowMatrix[ i ] * worldPosition;\\n\\n\t}\\n\\n#endif\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/lights_phong_vertex.glsl\r\n\r\nTHREE.ShaderChunk['lights_phong_vertex'] = \"#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP ) || defined( USE_ENVMAP )\\n\\n\tvWorldPosition = worldPosition.xyz;\\n\\n#endif\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/map_fragment.glsl\r\n\r\nTHREE.ShaderChunk['map_fragment'] = \"#ifdef USE_MAP\\n\\n\tvec4 texelColor = texture2D( map, vUv );\\n\\n\ttexelColor.xyz = inputToLinear( texelColor.xyz );\\n\\n\tdiffuseColor *= texelColor;\\n\\n#endif\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/lightmap_vertex.glsl\r\n\r\nTHREE.ShaderChunk['lightmap_vertex'] = \"#ifdef USE_LIGHTMAP\\n\\n\tvUv2 = uv2;\\n\\n#endif\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/map_particle_fragment.glsl\r\n\r\nTHREE.ShaderChunk['map_particle_fragment'] = \"#ifdef USE_MAP\\n\\n\tdiffuseColor *= texture2D( map, vec2( gl_PointCoord.x, 1.0 - gl_PointCoord.y ) * offsetRepeat.zw + offsetRepeat.xy );\\n\\n#endif\\n\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/color_pars_fragment.glsl\r\n\r\nTHREE.ShaderChunk['color_pars_fragment'] = \"#ifdef USE_COLOR\\n\\n\tvarying vec3 vColor;\\n\\n#endif\\n\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/color_vertex.glsl\r\n\r\nTHREE.ShaderChunk['color_vertex'] = \"#ifdef USE_COLOR\\n\\n\tvColor.xyz = inputToLinear( color.xyz );\\n\\n#endif\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/skinning_vertex.glsl\r\n\r\nTHREE.ShaderChunk['skinning_vertex'] = \"#ifdef USE_SKINNING\\n\\n\t#ifdef USE_MORPHTARGETS\\n\\n\tvec4 skinVertex = bindMatrix * vec4( morphed, 1.0 );\\n\\n\t#else\\n\\n\tvec4 skinVertex = bindMatrix * vec4( position, 1.0 );\\n\\n\t#endif\\n\\n\tvec4 skinned = vec4( 0.0 );\\n\tskinned += boneMatX * skinVertex * skinWeight.x;\\n\tskinned += boneMatY * skinVertex * skinWeight.y;\\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\\n\tskinned += boneMatW * skinVertex * skinWeight.w;\\n\tskinned  = bindMatrixInverse * skinned;\\n\\n#endif\\n\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/envmap_pars_vertex.glsl\r\n\r\nTHREE.ShaderChunk['envmap_pars_vertex'] = \"#if defined( USE_ENVMAP ) && ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP ) && ! defined( PHONG )\\n\\n\tvarying vec3 vReflect;\\n\\n\tuniform float refractionRatio;\\n\\n#endif\\n\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/linear_to_gamma_fragment.glsl\r\n\r\nTHREE.ShaderChunk['linear_to_gamma_fragment'] = \"\\n\toutgoingLight = linearToOutput( outgoingLight );\\n\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/color_pars_vertex.glsl\r\n\r\nTHREE.ShaderChunk['color_pars_vertex'] = \"#ifdef USE_COLOR\\n\\n\tvarying vec3 vColor;\\n\\n#endif\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/lights_lambert_pars_vertex.glsl\r\n\r\nTHREE.ShaderChunk['lights_lambert_pars_vertex'] = \"uniform vec3 ambientLightColor;\\n\\n#if MAX_DIR_LIGHTS > 0\\n\\n\tuniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\\n\tuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\\n\\n#endif\\n\\n#if MAX_HEMI_LIGHTS > 0\\n\\n\tuniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];\\n\tuniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];\\n\tuniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];\\n\\n#endif\\n\\n#if MAX_POINT_LIGHTS > 0\\n\\n\tuniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\\n\tuniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\\n\tuniform float pointLightDistance[ MAX_POINT_LIGHTS ];\\n\tuniform float pointLightDecay[ MAX_POINT_LIGHTS ];\\n\\n#endif\\n\\n#if MAX_SPOT_LIGHTS > 0\\n\\n\tuniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];\\n\tuniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];\\n\tuniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];\\n\tuniform float spotLightDistance[ MAX_SPOT_LIGHTS ];\\n\tuniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];\\n\tuniform float spotLightExponent[ MAX_SPOT_LIGHTS ];\\n\tuniform float spotLightDecay[ MAX_SPOT_LIGHTS ];\\n\\n#endif\\n\\n#ifdef WRAP_AROUND\\n\\n\tuniform vec3 wrapRGB;\\n\\n#endif\\n\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/map_pars_vertex.glsl\r\n\r\nTHREE.ShaderChunk['map_pars_vertex'] = \"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP )\\n\\n\tvarying vec2 vUv;\\n\tuniform vec4 offsetRepeat;\\n\\n#endif\\n\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/envmap_fragment.glsl\r\n\r\nTHREE.ShaderChunk['envmap_fragment'] = \"#ifdef USE_ENVMAP\\n\\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\\n\\n\t\tvec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );\\n\\n\t\t// Transforming Normal Vectors with the Inverse Transformation\\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\\n\\n\t\t#ifdef ENVMAP_MODE_REFLECTION\\n\\n\t\t\tvec3 reflectVec = reflect( cameraToVertex, worldNormal );\\n\\n\t\t#else\\n\\n\t\t\tvec3 reflectVec = refract( cameraToVertex, worldNormal, refractionRatio );\\n\\n\t\t#endif\\n\\n\t#else\\n\\n\t\tvec3 reflectVec = vReflect;\\n\\n\t#endif\\n\\n\t#ifdef DOUBLE_SIDED\\n\t\tfloat flipNormal = ( -1.0 + 2.0 * float( gl_FrontFacing ) );\\n\t#else\\n\t\tfloat flipNormal = 1.0;\\n\t#endif\\n\\n\t#ifdef ENVMAP_TYPE_CUBE\\n\t\tvec4 envColor = textureCube( envMap, flipNormal * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\\n\\n\t#elif defined( ENVMAP_TYPE_EQUIREC )\\n\t\tvec2 sampleUV;\\n\t\tsampleUV.y = saturate( flipNormal * reflectVec.y * 0.5 + 0.5 );\\n\t\tsampleUV.x = atan( flipNormal * reflectVec.z, flipNormal * reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\\n\t\tvec4 envColor = texture2D( envMap, sampleUV );\\n\\n\t#elif defined( ENVMAP_TYPE_SPHERE )\\n\t\tvec3 reflectView = flipNormal * normalize((viewMatrix * vec4( reflectVec, 0.0 )).xyz + vec3(0.0,0.0,1.0));\\n\t\tvec4 envColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5 );\\n\t#endif\\n\\n\tenvColor.xyz = inputToLinear( envColor.xyz );\\n\\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\\n\\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\\n\\n\t#elif defined( ENVMAP_BLENDING_MIX )\\n\\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\\n\\n\t#elif defined( ENVMAP_BLENDING_ADD )\\n\\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\\n\\n\t#endif\\n\\n#endif\\n\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/specularmap_pars_fragment.glsl\r\n\r\nTHREE.ShaderChunk['specularmap_pars_fragment'] = \"#ifdef USE_SPECULARMAP\\n\\n\tuniform sampler2D specularMap;\\n\\n#endif\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/logdepthbuf_vertex.glsl\r\n\r\nTHREE.ShaderChunk['logdepthbuf_vertex'] = \"#ifdef USE_LOGDEPTHBUF\\n\\n\tgl_Position.z = log2(max( EPSILON, gl_Position.w + 1.0 )) * logDepthBufFC;\\n\\n\t#ifdef USE_LOGDEPTHBUF_EXT\\n\\n\t\tvFragDepth = 1.0 + gl_Position.w;\\n\\n#else\\n\\n\t\tgl_Position.z = (gl_Position.z - 1.0) * gl_Position.w;\\n\\n\t#endif\\n\\n#endif\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/morphtarget_pars_vertex.glsl\r\n\r\nTHREE.ShaderChunk['morphtarget_pars_vertex'] = \"#ifdef USE_MORPHTARGETS\\n\\n\t#ifndef USE_MORPHNORMALS\\n\\n\tuniform float morphTargetInfluences[ 8 ];\\n\\n\t#else\\n\\n\tuniform float morphTargetInfluences[ 4 ];\\n\\n\t#endif\\n\\n#endif\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/specularmap_fragment.glsl\r\n\r\nTHREE.ShaderChunk['specularmap_fragment'] = \"float specularStrength;\\n\\n#ifdef USE_SPECULARMAP\\n\\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\\n\tspecularStrength = texelSpecular.r;\\n\\n#else\\n\\n\tspecularStrength = 1.0;\\n\\n#endif\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/fog_fragment.glsl\r\n\r\nTHREE.ShaderChunk['fog_fragment'] = \"#ifdef USE_FOG\\n\\n\t#ifdef USE_LOGDEPTHBUF_EXT\\n\\n\t\tfloat depth = gl_FragDepthEXT / gl_FragCoord.w;\\n\\n\t#else\\n\\n\t\tfloat depth = gl_FragCoord.z / gl_FragCoord.w;\\n\\n\t#endif\\n\\n\t#ifdef FOG_EXP2\\n\\n\t\tfloat fogFactor = exp2( - square( fogDensity ) * square( depth ) * LOG2 );\\n\t\tfogFactor = whiteCompliment( fogFactor );\\n\\n\t#else\\n\\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, depth );\\n\\n\t#endif\\n\t\\n\toutgoingLight = mix( outgoingLight, fogColor, fogFactor );\\n\\n#endif\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/bumpmap_pars_fragment.glsl\r\n\r\nTHREE.ShaderChunk['bumpmap_pars_fragment'] = \"#ifdef USE_BUMPMAP\\n\\n\tuniform sampler2D bumpMap;\\n\tuniform float bumpScale;\\n\\n\t// Derivative maps - bump mapping unparametrized surfaces by Morten Mikkelsen\\n\t// http://mmikkelsen3d.blogspot.sk/2011/07/derivative-maps.html\\n\\n\t// Evaluate the derivative of the height w.r.t. screen-space using forward differencing (listing 2)\\n\\n\tvec2 dHdxy_fwd() {\\n\\n\t\tvec2 dSTdx = dFdx( vUv );\\n\t\tvec2 dSTdy = dFdy( vUv );\\n\\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\\n\\n\t\treturn vec2( dBx, dBy );\\n\\n\t}\\n\\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\\n\\n\t\tvec3 vSigmaX = dFdx( surf_pos );\\n\t\tvec3 vSigmaY = dFdy( surf_pos );\\n\t\tvec3 vN = surf_norm;\t\t// normalized\\n\\n\t\tvec3 R1 = cross( vSigmaY, vN );\\n\t\tvec3 R2 = cross( vN, vSigmaX );\\n\\n\t\tfloat fDet = dot( vSigmaX, R1 );\\n\\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\\n\\n\t}\\n\\n#endif\\n\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/defaultnormal_vertex.glsl\r\n\r\nTHREE.ShaderChunk['defaultnormal_vertex'] = \"#ifdef USE_SKINNING\\n\\n\tvec3 objectNormal = skinnedNormal.xyz;\\n\\n#elif defined( USE_MORPHNORMALS )\\n\\n\tvec3 objectNormal = morphedNormal;\\n\\n#else\\n\\n\tvec3 objectNormal = normal;\\n\\n#endif\\n\\n#ifdef FLIP_SIDED\\n\\n\tobjectNormal = -objectNormal;\\n\\n#endif\\n\\nvec3 transformedNormal = normalMatrix * objectNormal;\\n\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/lights_phong_pars_fragment.glsl\r\n\r\nTHREE.ShaderChunk['lights_phong_pars_fragment'] = \"uniform vec3 ambientLightColor;\\n\\n#if MAX_DIR_LIGHTS > 0\\n\\n\tuniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\\n\tuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\\n\\n#endif\\n\\n#if MAX_HEMI_LIGHTS > 0\\n\\n\tuniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];\\n\tuniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];\\n\tuniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];\\n\\n#endif\\n\\n#if MAX_POINT_LIGHTS > 0\\n\\n\tuniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\\n\\n\tuniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\\n\tuniform float pointLightDistance[ MAX_POINT_LIGHTS ];\\n\tuniform float pointLightDecay[ MAX_POINT_LIGHTS ];\\n\\n#endif\\n\\n#if MAX_SPOT_LIGHTS > 0\\n\\n\tuniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];\\n\tuniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];\\n\tuniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];\\n\tuniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];\\n\tuniform float spotLightExponent[ MAX_SPOT_LIGHTS ];\\n\tuniform float spotLightDistance[ MAX_SPOT_LIGHTS ];\\n\tuniform float spotLightDecay[ MAX_SPOT_LIGHTS ];\\n\\n#endif\\n\\n#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP ) || defined( USE_ENVMAP )\\n\\n\tvarying vec3 vWorldPosition;\\n\\n#endif\\n\\n#ifdef WRAP_AROUND\\n\\n\tuniform vec3 wrapRGB;\\n\\n#endif\\n\\nvarying vec3 vViewPosition;\\n\\n#ifndef FLAT_SHADED\\n\\n\tvarying vec3 vNormal;\\n\\n#endif\\n\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/skinbase_vertex.glsl\r\n\r\nTHREE.ShaderChunk['skinbase_vertex'] = \"#ifdef USE_SKINNING\\n\\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\\n\\n#endif\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/map_vertex.glsl\r\n\r\nTHREE.ShaderChunk['map_vertex'] = \"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP )\\n\\n\tvUv = uv * offsetRepeat.zw + offsetRepeat.xy;\\n\\n#endif\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/lightmap_fragment.glsl\r\n\r\nTHREE.ShaderChunk['lightmap_fragment'] = \"#ifdef USE_LIGHTMAP\\n\\n\toutgoingLight *= diffuseColor.xyz * texture2D( lightMap, vUv2 ).xyz;\\n\\n#endif\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/shadowmap_pars_vertex.glsl\r\n\r\nTHREE.ShaderChunk['shadowmap_pars_vertex'] = \"#ifdef USE_SHADOWMAP\\n\\n\tvarying vec4 vShadowCoord[ MAX_SHADOWS ];\\n\tuniform mat4 shadowMatrix[ MAX_SHADOWS ];\\n\\n#endif\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/color_fragment.glsl\r\n\r\nTHREE.ShaderChunk['color_fragment'] = \"#ifdef USE_COLOR\\n\\n\tdiffuseColor.rgb *= vColor;\\n\\n#endif\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/morphtarget_vertex.glsl\r\n\r\nTHREE.ShaderChunk['morphtarget_vertex'] = \"#ifdef USE_MORPHTARGETS\\n\\n\tvec3 morphed = vec3( 0.0 );\\n\tmorphed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];\\n\tmorphed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];\\n\tmorphed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];\\n\tmorphed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];\\n\\n\t#ifndef USE_MORPHNORMALS\\n\\n\tmorphed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];\\n\tmorphed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];\\n\tmorphed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];\\n\tmorphed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];\\n\\n\t#endif\\n\\n\tmorphed += position;\\n\\n#endif\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/envmap_vertex.glsl\r\n\r\nTHREE.ShaderChunk['envmap_vertex'] = \"#if defined( USE_ENVMAP ) && ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP ) && ! defined( PHONG )\\n\\n\tvec3 worldNormal = transformDirection( objectNormal, modelMatrix );\\n\\n\tvec3 cameraToVertex = normalize( worldPosition.xyz - cameraPosition );\\n\\n\t#ifdef ENVMAP_MODE_REFLECTION\\n\\n\t\tvReflect = reflect( cameraToVertex, worldNormal );\\n\\n\t#else\\n\\n\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\\n\\n\t#endif\\n\\n#endif\\n\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/shadowmap_fragment.glsl\r\n\r\nTHREE.ShaderChunk['shadowmap_fragment'] = \"#ifdef USE_SHADOWMAP\\n\\n\t#ifdef SHADOWMAP_DEBUG\\n\\n\t\tvec3 frustumColors[3];\\n\t\tfrustumColors[0] = vec3( 1.0, 0.5, 0.0 );\\n\t\tfrustumColors[1] = vec3( 0.0, 1.0, 0.8 );\\n\t\tfrustumColors[2] = vec3( 0.0, 0.5, 1.0 );\\n\\n\t#endif\\n\\n\t#ifdef SHADOWMAP_CASCADE\\n\\n\t\tint inFrustumCount = 0;\\n\\n\t#endif\\n\\n\tfloat fDepth;\\n\tvec3 shadowColor = vec3( 1.0 );\\n\\n\tfor( int i = 0; i < MAX_SHADOWS; i ++ ) {\\n\\n\t\tvec3 shadowCoord = vShadowCoord[ i ].xyz / vShadowCoord[ i ].w;\\n\\n\t\t\t\t// if ( something && something ) breaks ATI OpenGL shader compiler\\n\t\t\t\t// if ( all( something, something ) ) using this instead\\n\\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\\n\t\tbool inFrustum = all( inFrustumVec );\\n\\n\t\t\t\t// don't shadow pixels outside of light frustum\\n\t\t\t\t// use just first frustum (for cascades)\\n\t\t\t\t// don't shadow pixels behind far plane of light frustum\\n\\n\t\t#ifdef SHADOWMAP_CASCADE\\n\\n\t\t\tinFrustumCount += int( inFrustum );\\n\t\t\tbvec3 frustumTestVec = bvec3( inFrustum, inFrustumCount == 1, shadowCoord.z <= 1.0 );\\n\\n\t\t#else\\n\\n\t\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\\n\\n\t\t#endif\\n\\n\t\tbool frustumTest = all( frustumTestVec );\\n\\n\t\tif ( frustumTest ) {\\n\\n\t\t\tshadowCoord.z += shadowBias[ i ];\\n\\n\t\t\t#if defined( SHADOWMAP_TYPE_PCF )\\n\\n\t\t\t\t\t\t// Percentage-close filtering\\n\t\t\t\t\t\t// (9 pixel kernel)\\n\t\t\t\t\t\t// http://fabiensanglard.net/shadowmappingPCF/\\n\\n\t\t\t\tfloat shadow = 0.0;\\n\\n\t\t/*\\n\t\t\t\t\t\t// nested loops breaks shader compiler / validator on some ATI cards when using OpenGL\\n\t\t\t\t\t\t// must enroll loop manually\\n\\n\t\t\t\tfor ( float y = -1.25; y <= 1.25; y += 1.25 )\\n\t\t\t\t\tfor ( float x = -1.25; x <= 1.25; x += 1.25 ) {\\n\\n\t\t\t\t\t\tvec4 rgbaDepth = texture2D( shadowMap[ i ], vec2( x * xPixelOffset, y * yPixelOffset ) + shadowCoord.xy );\\n\\n\t\t\t\t\t\t\t\t// doesn't seem to produce any noticeable visual difference compared to simple texture2D lookup\\n\t\t\t\t\t\t\t\t//vec4 rgbaDepth = texture2DProj( shadowMap[ i ], vec4( vShadowCoord[ i ].w * ( vec2( x * xPixelOffset, y * yPixelOffset ) + shadowCoord.xy ), 0.05, vShadowCoord[ i ].w ) );\\n\\n\t\t\t\t\t\tfloat fDepth = unpackDepth( rgbaDepth );\\n\\n\t\t\t\t\t\tif ( fDepth < shadowCoord.z )\\n\t\t\t\t\t\t\tshadow += 1.0;\\n\\n\t\t\t\t}\\n\\n\t\t\t\tshadow /= 9.0;\\n\\n\t\t*/\\n\\n\t\t\t\tconst float shadowDelta = 1.0 / 9.0;\\n\\n\t\t\t\tfloat xPixelOffset = 1.0 / shadowMapSize[ i ].x;\\n\t\t\t\tfloat yPixelOffset = 1.0 / shadowMapSize[ i ].y;\\n\\n\t\t\t\tfloat dx0 = -1.25 * xPixelOffset;\\n\t\t\t\tfloat dy0 = -1.25 * yPixelOffset;\\n\t\t\t\tfloat dx1 = 1.25 * xPixelOffset;\\n\t\t\t\tfloat dy1 = 1.25 * yPixelOffset;\\n\\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy0 ) ) );\\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\\n\\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy0 ) ) );\\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\\n\\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy0 ) ) );\\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\\n\\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, 0.0 ) ) );\\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\\n\\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy ) );\\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\\n\\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, 0.0 ) ) );\\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\\n\\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy1 ) ) );\\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\\n\\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy1 ) ) );\\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\\n\\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy1 ) ) );\\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\\n\\n\t\t\t\tshadowColor = shadowColor * vec3( ( 1.0 - shadowDarkness[ i ] * shadow ) );\\n\\n\t\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\\n\\n\t\t\t\t\t\t// Percentage-close filtering\\n\t\t\t\t\t\t// (9 pixel kernel)\\n\t\t\t\t\t\t// http://fabiensanglard.net/shadowmappingPCF/\\n\\n\t\t\t\tfloat shadow = 0.0;\\n\\n\t\t\t\tfloat xPixelOffset = 1.0 / shadowMapSize[ i ].x;\\n\t\t\t\tfloat yPixelOffset = 1.0 / shadowMapSize[ i ].y;\\n\\n\t\t\t\tfloat dx0 = -1.0 * xPixelOffset;\\n\t\t\t\tfloat dy0 = -1.0 * yPixelOffset;\\n\t\t\t\tfloat dx1 = 1.0 * xPixelOffset;\\n\t\t\t\tfloat dy1 = 1.0 * yPixelOffset;\\n\\n\t\t\t\tmat3 shadowKernel;\\n\t\t\t\tmat3 depthKernel;\\n\\n\t\t\t\tdepthKernel[0][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy0 ) ) );\\n\t\t\t\tdepthKernel[0][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, 0.0 ) ) );\\n\t\t\t\tdepthKernel[0][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy1 ) ) );\\n\t\t\t\tdepthKernel[1][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy0 ) ) );\\n\t\t\t\tdepthKernel[1][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy ) );\\n\t\t\t\tdepthKernel[1][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy1 ) ) );\\n\t\t\t\tdepthKernel[2][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy0 ) ) );\\n\t\t\t\tdepthKernel[2][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, 0.0 ) ) );\\n\t\t\t\tdepthKernel[2][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy1 ) ) );\\n\\n\t\t\t\tvec3 shadowZ = vec3( shadowCoord.z );\\n\t\t\t\tshadowKernel[0] = vec3(lessThan(depthKernel[0], shadowZ ));\\n\t\t\t\tshadowKernel[0] *= vec3(0.25);\\n\\n\t\t\t\tshadowKernel[1] = vec3(lessThan(depthKernel[1], shadowZ ));\\n\t\t\t\tshadowKernel[1] *= vec3(0.25);\\n\\n\t\t\t\tshadowKernel[2] = vec3(lessThan(depthKernel[2], shadowZ ));\\n\t\t\t\tshadowKernel[2] *= vec3(0.25);\\n\\n\t\t\t\tvec2 fractionalCoord = 1.0 - fract( shadowCoord.xy * shadowMapSize[i].xy );\\n\\n\t\t\t\tshadowKernel[0] = mix( shadowKernel[1], shadowKernel[0], fractionalCoord.x );\\n\t\t\t\tshadowKernel[1] = mix( shadowKernel[2], shadowKernel[1], fractionalCoord.x );\\n\\n\t\t\t\tvec4 shadowValues;\\n\t\t\t\tshadowValues.x = mix( shadowKernel[0][1], shadowKernel[0][0], fractionalCoord.y );\\n\t\t\t\tshadowValues.y = mix( shadowKernel[0][2], shadowKernel[0][1], fractionalCoord.y );\\n\t\t\t\tshadowValues.z = mix( shadowKernel[1][1], shadowKernel[1][0], fractionalCoord.y );\\n\t\t\t\tshadowValues.w = mix( shadowKernel[1][2], shadowKernel[1][1], fractionalCoord.y );\\n\\n\t\t\t\tshadow = dot( shadowValues, vec4( 1.0 ) );\\n\\n\t\t\t\tshadowColor = shadowColor * vec3( ( 1.0 - shadowDarkness[ i ] * shadow ) );\\n\\n\t\t\t#else\\n\\n\t\t\t\tvec4 rgbaDepth = texture2D( shadowMap[ i ], shadowCoord.xy );\\n\t\t\t\tfloat fDepth = unpackDepth( rgbaDepth );\\n\\n\t\t\t\tif ( fDepth < shadowCoord.z )\\n\\n\t\t// spot with multiple shadows is darker\\n\\n\t\t\t\t\tshadowColor = shadowColor * vec3( 1.0 - shadowDarkness[ i ] );\\n\\n\t\t// spot with multiple shadows has the same color as single shadow spot\\n\\n\t\t// \t\t\t\t\tshadowColor = min( shadowColor, vec3( shadowDarkness[ i ] ) );\\n\\n\t\t\t#endif\\n\\n\t\t}\\n\\n\\n\t\t#ifdef SHADOWMAP_DEBUG\\n\\n\t\t\t#ifdef SHADOWMAP_CASCADE\\n\\n\t\t\t\tif ( inFrustum && inFrustumCount == 1 ) outgoingLight *= frustumColors[ i ];\\n\\n\t\t\t#else\\n\\n\t\t\t\tif ( inFrustum ) outgoingLight *= frustumColors[ i ];\\n\\n\t\t\t#endif\\n\\n\t\t#endif\\n\\n\t}\\n\\n\t// NOTE: I am unsure if this is correct in linear space.  -bhouston, Dec 29, 2014\\n\tshadowColor = inputToLinear( shadowColor );\\n\\n\toutgoingLight = outgoingLight * shadowColor;\\n\\n#endif\\n\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/worldpos_vertex.glsl\r\n\r\nTHREE.ShaderChunk['worldpos_vertex'] = \"#if defined( USE_ENVMAP ) || defined( PHONG ) || defined( LAMBERT ) || defined ( USE_SHADOWMAP )\\n\\n\t#ifdef USE_SKINNING\\n\\n\t\tvec4 worldPosition = modelMatrix * skinned;\\n\\n\t#elif defined( USE_MORPHTARGETS )\\n\\n\t\tvec4 worldPosition = modelMatrix * vec4( morphed, 1.0 );\\n\\n\t#else\\n\\n\t\tvec4 worldPosition = modelMatrix * vec4( position, 1.0 );\\n\\n\t#endif\\n\\n#endif\\n\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/shadowmap_pars_fragment.glsl\r\n\r\nTHREE.ShaderChunk['shadowmap_pars_fragment'] = \"#ifdef USE_SHADOWMAP\\n\\n\tuniform sampler2D shadowMap[ MAX_SHADOWS ];\\n\tuniform vec2 shadowMapSize[ MAX_SHADOWS ];\\n\\n\tuniform float shadowDarkness[ MAX_SHADOWS ];\\n\tuniform float shadowBias[ MAX_SHADOWS ];\\n\\n\tvarying vec4 vShadowCoord[ MAX_SHADOWS ];\\n\\n\tfloat unpackDepth( const in vec4 rgba_depth ) {\\n\\n\t\tconst vec4 bit_shift = vec4( 1.0 / ( 256.0 * 256.0 * 256.0 ), 1.0 / ( 256.0 * 256.0 ), 1.0 / 256.0, 1.0 );\\n\t\tfloat depth = dot( rgba_depth, bit_shift );\\n\t\treturn depth;\\n\\n\t}\\n\\n#endif\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/skinning_pars_vertex.glsl\r\n\r\nTHREE.ShaderChunk['skinning_pars_vertex'] = \"#ifdef USE_SKINNING\\n\\n\tuniform mat4 bindMatrix;\\n\tuniform mat4 bindMatrixInverse;\\n\\n\t#ifdef BONE_TEXTURE\\n\\n\t\tuniform sampler2D boneTexture;\\n\t\tuniform int boneTextureWidth;\\n\t\tuniform int boneTextureHeight;\\n\\n\t\tmat4 getBoneMatrix( const in float i ) {\\n\\n\t\t\tfloat j = i * 4.0;\\n\t\t\tfloat x = mod( j, float( boneTextureWidth ) );\\n\t\t\tfloat y = floor( j / float( boneTextureWidth ) );\\n\\n\t\t\tfloat dx = 1.0 / float( boneTextureWidth );\\n\t\t\tfloat dy = 1.0 / float( boneTextureHeight );\\n\\n\t\t\ty = dy * ( y + 0.5 );\\n\\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\\n\\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\\n\\n\t\t\treturn bone;\\n\\n\t\t}\\n\\n\t#else\\n\\n\t\tuniform mat4 boneGlobalMatrices[ MAX_BONES ];\\n\\n\t\tmat4 getBoneMatrix( const in float i ) {\\n\\n\t\t\tmat4 bone = boneGlobalMatrices[ int(i) ];\\n\t\t\treturn bone;\\n\\n\t\t}\\n\\n\t#endif\\n\\n#endif\\n\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/logdepthbuf_pars_fragment.glsl\r\n\r\nTHREE.ShaderChunk['logdepthbuf_pars_fragment'] = \"#ifdef USE_LOGDEPTHBUF\\n\\n\tuniform float logDepthBufFC;\\n\\n\t#ifdef USE_LOGDEPTHBUF_EXT\\n\\n\t\t#extension GL_EXT_frag_depth : enable\\n\t\tvarying float vFragDepth;\\n\\n\t#endif\\n\\n#endif\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/alphamap_fragment.glsl\r\n\r\nTHREE.ShaderChunk['alphamap_fragment'] = \"#ifdef USE_ALPHAMAP\\n\\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\\n\\n#endif\\n\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/alphamap_pars_fragment.glsl\r\n\r\nTHREE.ShaderChunk['alphamap_pars_fragment'] = \"#ifdef USE_ALPHAMAP\\n\\n\tuniform sampler2D alphaMap;\\n\\n#endif\\n\";\r\n\r\n// File:src/renderers/shaders/UniformsUtils.js\r\n\r\n/**\r\n * Uniform Utilities\r\n */\r\n\r\nTHREE.UniformsUtils = {\r\n\r\n  merge: function(uniforms) {\r\n\r\n    var merged = {};\r\n\r\n    for (var u = 0; u < uniforms.length; u++) {\r\n\r\n      var tmp = this.clone(uniforms[u]);\r\n\r\n      for (var p in tmp) {\r\n\r\n        merged[p] = tmp[p];\r\n\r\n      }\r\n\r\n    }\r\n\r\n    return merged;\r\n\r\n  },\r\n\r\n  clone: function(uniforms_src) {\r\n\r\n    var uniforms_dst = {};\r\n\r\n    for (var u in uniforms_src) {\r\n\r\n      uniforms_dst[u] = {};\r\n\r\n      for (var p in uniforms_src[u]) {\r\n\r\n        var parameter_src = uniforms_src[u][p];\r\n\r\n        if (parameter_src instanceof THREE.Color ||\r\n          parameter_src instanceof THREE.Vector2 ||\r\n          parameter_src instanceof THREE.Vector3 ||\r\n          parameter_src instanceof THREE.Vector4 ||\r\n          parameter_src instanceof THREE.Matrix4 ||\r\n          parameter_src instanceof THREE.Texture) {\r\n\r\n          uniforms_dst[u][p] = parameter_src.clone();\r\n\r\n        }\r\n        else if (parameter_src instanceof Array) {\r\n\r\n          uniforms_dst[u][p] = parameter_src.slice();\r\n\r\n        }\r\n        else {\r\n\r\n          uniforms_dst[u][p] = parameter_src;\r\n\r\n        }\r\n\r\n      }\r\n\r\n    }\r\n\r\n    return uniforms_dst;\r\n\r\n  }\r\n\r\n};\r\n\r\n// File:src/renderers/shaders/UniformsLib.js\r\n\r\n/**\r\n * Uniforms library for shared webgl shaders\r\n */\r\n\r\nTHREE.UniformsLib = {\r\n\r\n  common: {\r\n\r\n    \"diffuse\": {\r\n      type: \"c\",\r\n      value: new THREE.Color(0xeeeeee)\r\n    },\r\n    \"opacity\": {\r\n      type: \"f\",\r\n      value: 1.0\r\n    },\r\n\r\n    \"map\": {\r\n      type: \"t\",\r\n      value: null\r\n    },\r\n    \"offsetRepeat\": {\r\n      type: \"v4\",\r\n      value: new THREE.Vector4(0, 0, 1, 1)\r\n    },\r\n\r\n    \"lightMap\": {\r\n      type: \"t\",\r\n      value: null\r\n    },\r\n    \"specularMap\": {\r\n      type: \"t\",\r\n      value: null\r\n    },\r\n    \"alphaMap\": {\r\n      type: \"t\",\r\n      value: null\r\n    },\r\n\r\n    \"envMap\": {\r\n      type: \"t\",\r\n      value: null\r\n    },\r\n    \"flipEnvMap\": {\r\n      type: \"f\",\r\n      value: -1\r\n    },\r\n    \"reflectivity\": {\r\n      type: \"f\",\r\n      value: 1.0\r\n    },\r\n    \"refractionRatio\": {\r\n      type: \"f\",\r\n      value: 0.98\r\n    },\r\n\r\n    \"morphTargetInfluences\": {\r\n      type: \"f\",\r\n      value: 0\r\n    }\r\n\r\n  },\r\n\r\n  bump: {\r\n\r\n    \"bumpMap\": {\r\n      type: \"t\",\r\n      value: null\r\n    },\r\n    \"bumpScale\": {\r\n      type: \"f\",\r\n      value: 1\r\n    }\r\n\r\n  },\r\n\r\n  normalmap: {\r\n\r\n    \"normalMap\": {\r\n      type: \"t\",\r\n      value: null\r\n    },\r\n    \"normalScale\": {\r\n      type: \"v2\",\r\n      value: new THREE.Vector2(1, 1)\r\n    }\r\n  },\r\n\r\n  fog: {\r\n\r\n    \"fogDensity\": {\r\n      type: \"f\",\r\n      value: 0.00025\r\n    },\r\n    \"fogNear\": {\r\n      type: \"f\",\r\n      value: 1\r\n    },\r\n    \"fogFar\": {\r\n      type: \"f\",\r\n      value: 2000\r\n    },\r\n    \"fogColor\": {\r\n      type: \"c\",\r\n      value: new THREE.Color(0xffffff)\r\n    }\r\n\r\n  },\r\n\r\n  lights: {\r\n\r\n    \"ambientLightColor\": {\r\n      type: \"fv\",\r\n      value: []\r\n    },\r\n\r\n    \"directionalLightDirection\": {\r\n      type: \"fv\",\r\n      value: []\r\n    },\r\n    \"directionalLightColor\": {\r\n      type: \"fv\",\r\n      value: []\r\n    },\r\n\r\n    \"hemisphereLightDirection\": {\r\n      type: \"fv\",\r\n      value: []\r\n    },\r\n    \"hemisphereLightSkyColor\": {\r\n      type: \"fv\",\r\n      value: []\r\n    },\r\n    \"hemisphereLightGroundColor\": {\r\n      type: \"fv\",\r\n      value: []\r\n    },\r\n\r\n    \"pointLightColor\": {\r\n      type: \"fv\",\r\n      value: []\r\n    },\r\n    \"pointLightPosition\": {\r\n      type: \"fv\",\r\n      value: []\r\n    },\r\n    \"pointLightDistance\": {\r\n      type: \"fv1\",\r\n      value: []\r\n    },\r\n    \"pointLightDecay\": {\r\n      type: \"fv1\",\r\n      value: []\r\n    },\r\n\r\n    \"spotLightColor\": {\r\n      type: \"fv\",\r\n      value: []\r\n    },\r\n    \"spotLightPosition\": {\r\n      type: \"fv\",\r\n      value: []\r\n    },\r\n    \"spotLightDirection\": {\r\n      type: \"fv\",\r\n      value: []\r\n    },\r\n    \"spotLightDistance\": {\r\n      type: \"fv1\",\r\n      value: []\r\n    },\r\n    \"spotLightAngleCos\": {\r\n      type: \"fv1\",\r\n      value: []\r\n    },\r\n    \"spotLightExponent\": {\r\n      type: \"fv1\",\r\n      value: []\r\n    },\r\n    \"spotLightDecay\": {\r\n      type: \"fv1\",\r\n      value: []\r\n    }\r\n\r\n  },\r\n\r\n  particle: {\r\n\r\n    \"psColor\": {\r\n      type: \"c\",\r\n      value: new THREE.Color(0xeeeeee)\r\n    },\r\n    \"opacity\": {\r\n      type: \"f\",\r\n      value: 1.0\r\n    },\r\n    \"size\": {\r\n      type: \"f\",\r\n      value: 1.0\r\n    },\r\n    \"scale\": {\r\n      type: \"f\",\r\n      value: 1.0\r\n    },\r\n    \"map\": {\r\n      type: \"t\",\r\n      value: null\r\n    },\r\n    \"offsetRepeat\": {\r\n      type: \"v4\",\r\n      value: new THREE.Vector4(0, 0, 1, 1)\r\n    },\r\n\r\n    \"fogDensity\": {\r\n      type: \"f\",\r\n      value: 0.00025\r\n    },\r\n    \"fogNear\": {\r\n      type: \"f\",\r\n      value: 1\r\n    },\r\n    \"fogFar\": {\r\n      type: \"f\",\r\n      value: 2000\r\n    },\r\n    \"fogColor\": {\r\n      type: \"c\",\r\n      value: new THREE.Color(0xffffff)\r\n    }\r\n\r\n  },\r\n\r\n  shadowmap: {\r\n\r\n    \"shadowMap\": {\r\n      type: \"tv\",\r\n      value: []\r\n    },\r\n    \"shadowMapSize\": {\r\n      type: \"v2v\",\r\n      value: []\r\n    },\r\n\r\n    \"shadowBias\": {\r\n      type: \"fv1\",\r\n      value: []\r\n    },\r\n    \"shadowDarkness\": {\r\n      type: \"fv1\",\r\n      value: []\r\n    },\r\n\r\n    \"shadowMatrix\": {\r\n      type: \"m4v\",\r\n      value: []\r\n    }\r\n\r\n  }\r\n\r\n};\r\n\r\n// File:src/renderers/shaders/ShaderLib.js\r\n\r\n/**\r\n * Webgl Shader Library for three.js\r\n *\r\n * @author alteredq / http://alteredqualia.com/\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author mikael emtinger / http://gomo.se/\r\n */\r\n\r\n\r\nTHREE.ShaderLib = {\r\n\r\n  'basic': {\r\n\r\n    uniforms: THREE.UniformsUtils.merge([\r\n\r\n      THREE.UniformsLib[\"common\"],\r\n      THREE.UniformsLib[\"fog\"],\r\n      THREE.UniformsLib[\"shadowmap\"]\r\n\r\n    ]),\r\n\r\n    vertexShader: [\r\n\r\n      THREE.ShaderChunk[\"common\"],\r\n      THREE.ShaderChunk[\"map_pars_vertex\"],\r\n      THREE.ShaderChunk[\"lightmap_pars_vertex\"],\r\n      THREE.ShaderChunk[\"envmap_pars_vertex\"],\r\n      THREE.ShaderChunk[\"color_pars_vertex\"],\r\n      THREE.ShaderChunk[\"morphtarget_pars_vertex\"],\r\n      THREE.ShaderChunk[\"skinning_pars_vertex\"],\r\n      THREE.ShaderChunk[\"shadowmap_pars_vertex\"],\r\n      THREE.ShaderChunk[\"logdepthbuf_pars_vertex\"],\r\n\r\n      \"void main() {\",\r\n\r\n      THREE.ShaderChunk[\"map_vertex\"],\r\n      THREE.ShaderChunk[\"lightmap_vertex\"],\r\n      THREE.ShaderChunk[\"color_vertex\"],\r\n      THREE.ShaderChunk[\"skinbase_vertex\"],\r\n\r\n      \"\t#ifdef USE_ENVMAP\",\r\n\r\n      THREE.ShaderChunk[\"morphnormal_vertex\"],\r\n      THREE.ShaderChunk[\"skinnormal_vertex\"],\r\n      THREE.ShaderChunk[\"defaultnormal_vertex\"],\r\n\r\n      \"\t#endif\",\r\n\r\n      THREE.ShaderChunk[\"morphtarget_vertex\"],\r\n      THREE.ShaderChunk[\"skinning_vertex\"],\r\n      THREE.ShaderChunk[\"default_vertex\"],\r\n      THREE.ShaderChunk[\"logdepthbuf_vertex\"],\r\n\r\n      THREE.ShaderChunk[\"worldpos_vertex\"],\r\n      THREE.ShaderChunk[\"envmap_vertex\"],\r\n      THREE.ShaderChunk[\"shadowmap_vertex\"],\r\n\r\n      \"}\"\r\n\r\n    ].join(\"\\n\"),\r\n\r\n    fragmentShader: [\r\n\r\n      \"uniform vec3 diffuse;\",\r\n      \"uniform float opacity;\",\r\n\r\n      THREE.ShaderChunk[\"common\"],\r\n      THREE.ShaderChunk[\"color_pars_fragment\"],\r\n      THREE.ShaderChunk[\"map_pars_fragment\"],\r\n      THREE.ShaderChunk[\"alphamap_pars_fragment\"],\r\n      THREE.ShaderChunk[\"lightmap_pars_fragment\"],\r\n      THREE.ShaderChunk[\"envmap_pars_fragment\"],\r\n      THREE.ShaderChunk[\"fog_pars_fragment\"],\r\n      THREE.ShaderChunk[\"shadowmap_pars_fragment\"],\r\n      THREE.ShaderChunk[\"specularmap_pars_fragment\"],\r\n      THREE.ShaderChunk[\"logdepthbuf_pars_fragment\"],\r\n\r\n      \"void main() {\",\r\n\r\n      \"\tvec3 outgoingLight = vec3( 0.0 );\", // outgoing light does not have an alpha, the surface does\r\n      \"\tvec4 diffuseColor = vec4( diffuse, opacity );\",\r\n\r\n      THREE.ShaderChunk[\"logdepthbuf_fragment\"],\r\n      THREE.ShaderChunk[\"map_fragment\"],\r\n      THREE.ShaderChunk[\"color_fragment\"],\r\n      THREE.ShaderChunk[\"alphamap_fragment\"],\r\n      THREE.ShaderChunk[\"alphatest_fragment\"],\r\n      THREE.ShaderChunk[\"specularmap_fragment\"],\r\n\r\n      \"\toutgoingLight = diffuseColor.rgb;\", // simple shader\r\n\r\n      THREE.ShaderChunk[\"lightmap_fragment\"], // TODO: Light map on an otherwise unlit surface doesn't make sense.\r\n      THREE.ShaderChunk[\"envmap_fragment\"],\r\n      THREE.ShaderChunk[\"shadowmap_fragment\"], // TODO: Shadows on an otherwise unlit surface doesn't make sense.\r\n\r\n      THREE.ShaderChunk[\"linear_to_gamma_fragment\"],\r\n\r\n      THREE.ShaderChunk[\"fog_fragment\"],\r\n\r\n      \"\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\", // TODO, this should be pre-multiplied to allow for bright highlights on very transparent objects\r\n\r\n      \"}\"\r\n\r\n    ].join(\"\\n\")\r\n\r\n  },\r\n\r\n  'lambert': {\r\n\r\n    uniforms: THREE.UniformsUtils.merge([\r\n\r\n      THREE.UniformsLib[\"common\"],\r\n      THREE.UniformsLib[\"fog\"],\r\n      THREE.UniformsLib[\"lights\"],\r\n      THREE.UniformsLib[\"shadowmap\"],\r\n\r\n      {\r\n        \"emissive\": {\r\n          type: \"c\",\r\n          value: new THREE.Color(0x000000)\r\n        },\r\n        \"wrapRGB\": {\r\n          type: \"v3\",\r\n          value: new THREE.Vector3(1, 1, 1)\r\n        }\r\n      }\r\n\r\n    ]),\r\n\r\n    vertexShader: [\r\n\r\n      \"#define LAMBERT\",\r\n\r\n      \"varying vec3 vLightFront;\",\r\n\r\n      \"#ifdef DOUBLE_SIDED\",\r\n\r\n      \"\tvarying vec3 vLightBack;\",\r\n\r\n      \"#endif\",\r\n\r\n      THREE.ShaderChunk[\"common\"],\r\n      THREE.ShaderChunk[\"map_pars_vertex\"],\r\n      THREE.ShaderChunk[\"lightmap_pars_vertex\"],\r\n      THREE.ShaderChunk[\"envmap_pars_vertex\"],\r\n      THREE.ShaderChunk[\"lights_lambert_pars_vertex\"],\r\n      THREE.ShaderChunk[\"color_pars_vertex\"],\r\n      THREE.ShaderChunk[\"morphtarget_pars_vertex\"],\r\n      THREE.ShaderChunk[\"skinning_pars_vertex\"],\r\n      THREE.ShaderChunk[\"shadowmap_pars_vertex\"],\r\n      THREE.ShaderChunk[\"logdepthbuf_pars_vertex\"],\r\n\r\n      \"void main() {\",\r\n\r\n      THREE.ShaderChunk[\"map_vertex\"],\r\n      THREE.ShaderChunk[\"lightmap_vertex\"],\r\n      THREE.ShaderChunk[\"color_vertex\"],\r\n\r\n      THREE.ShaderChunk[\"morphnormal_vertex\"],\r\n      THREE.ShaderChunk[\"skinbase_vertex\"],\r\n      THREE.ShaderChunk[\"skinnormal_vertex\"],\r\n      THREE.ShaderChunk[\"defaultnormal_vertex\"],\r\n\r\n      THREE.ShaderChunk[\"morphtarget_vertex\"],\r\n      THREE.ShaderChunk[\"skinning_vertex\"],\r\n      THREE.ShaderChunk[\"default_vertex\"],\r\n      THREE.ShaderChunk[\"logdepthbuf_vertex\"],\r\n\r\n      THREE.ShaderChunk[\"worldpos_vertex\"],\r\n      THREE.ShaderChunk[\"envmap_vertex\"],\r\n      THREE.ShaderChunk[\"lights_lambert_vertex\"],\r\n      THREE.ShaderChunk[\"shadowmap_vertex\"],\r\n\r\n      \"}\"\r\n\r\n    ].join(\"\\n\"),\r\n\r\n    fragmentShader: [\r\n\r\n      \"uniform vec3 diffuse;\",\r\n      \"uniform vec3 emissive;\",\r\n      \"uniform float opacity;\",\r\n\r\n      \"varying vec3 vLightFront;\",\r\n\r\n      \"#ifdef DOUBLE_SIDED\",\r\n\r\n      \"\tvarying vec3 vLightBack;\",\r\n\r\n      \"#endif\",\r\n\r\n      THREE.ShaderChunk[\"common\"],\r\n      THREE.ShaderChunk[\"color_pars_fragment\"],\r\n      THREE.ShaderChunk[\"map_pars_fragment\"],\r\n      THREE.ShaderChunk[\"alphamap_pars_fragment\"],\r\n      THREE.ShaderChunk[\"lightmap_pars_fragment\"],\r\n      THREE.ShaderChunk[\"envmap_pars_fragment\"],\r\n      THREE.ShaderChunk[\"fog_pars_fragment\"],\r\n      THREE.ShaderChunk[\"shadowmap_pars_fragment\"],\r\n      THREE.ShaderChunk[\"specularmap_pars_fragment\"],\r\n      THREE.ShaderChunk[\"logdepthbuf_pars_fragment\"],\r\n\r\n      \"void main() {\",\r\n\r\n      \"\tvec3 outgoingLight = vec3( 0.0 );\", // outgoing light does not have an alpha, the surface does\r\n      \"\tvec4 diffuseColor = vec4( diffuse, opacity );\",\r\n\r\n      THREE.ShaderChunk[\"logdepthbuf_fragment\"],\r\n      THREE.ShaderChunk[\"map_fragment\"],\r\n      THREE.ShaderChunk[\"color_fragment\"],\r\n      THREE.ShaderChunk[\"alphamap_fragment\"],\r\n      THREE.ShaderChunk[\"alphatest_fragment\"],\r\n      THREE.ShaderChunk[\"specularmap_fragment\"],\r\n\r\n      \"\t#ifdef DOUBLE_SIDED\",\r\n\r\n      //\"float isFront = float( gl_FrontFacing );\",\r\n      //\"gl_FragColor.xyz *= isFront * vLightFront + ( 1.0 - isFront ) * vLightBack;\",\r\n\r\n      \"\t\tif ( gl_FrontFacing )\",\r\n      \"\t\t\toutgoingLight += diffuseColor.rgb * vLightFront + emissive;\",\r\n      \"\t\telse\",\r\n      \"\t\t\toutgoingLight += diffuseColor.rgb * vLightBack + emissive;\",\r\n\r\n      \"\t#else\",\r\n\r\n      \"\t\toutgoingLight += diffuseColor.rgb * vLightFront + emissive;\",\r\n\r\n      \"\t#endif\",\r\n\r\n      THREE.ShaderChunk[\"lightmap_fragment\"],\r\n      THREE.ShaderChunk[\"envmap_fragment\"],\r\n      THREE.ShaderChunk[\"shadowmap_fragment\"],\r\n\r\n      THREE.ShaderChunk[\"linear_to_gamma_fragment\"],\r\n\r\n      THREE.ShaderChunk[\"fog_fragment\"],\r\n\r\n      \"\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\", // TODO, this should be pre-multiplied to allow for bright highlights on very transparent objects\r\n\r\n      \"}\"\r\n\r\n    ].join(\"\\n\")\r\n\r\n  },\r\n\r\n  'phong': {\r\n\r\n    uniforms: THREE.UniformsUtils.merge([\r\n\r\n      THREE.UniformsLib[\"common\"],\r\n      THREE.UniformsLib[\"bump\"],\r\n      THREE.UniformsLib[\"normalmap\"],\r\n      THREE.UniformsLib[\"fog\"],\r\n      THREE.UniformsLib[\"lights\"],\r\n      THREE.UniformsLib[\"shadowmap\"],\r\n\r\n      {\r\n        \"emissive\": {\r\n          type: \"c\",\r\n          value: new THREE.Color(0x000000)\r\n        },\r\n        \"specular\": {\r\n          type: \"c\",\r\n          value: new THREE.Color(0x111111)\r\n        },\r\n        \"shininess\": {\r\n          type: \"f\",\r\n          value: 30\r\n        },\r\n        \"wrapRGB\": {\r\n          type: \"v3\",\r\n          value: new THREE.Vector3(1, 1, 1)\r\n        }\r\n      }\r\n\r\n    ]),\r\n\r\n    vertexShader: [\r\n\r\n      \"#define PHONG\",\r\n\r\n      \"varying vec3 vViewPosition;\",\r\n\r\n      \"#ifndef FLAT_SHADED\",\r\n\r\n      \"\tvarying vec3 vNormal;\",\r\n\r\n      \"#endif\",\r\n\r\n      THREE.ShaderChunk[\"common\"],\r\n      THREE.ShaderChunk[\"map_pars_vertex\"],\r\n      THREE.ShaderChunk[\"lightmap_pars_vertex\"],\r\n      THREE.ShaderChunk[\"envmap_pars_vertex\"],\r\n      THREE.ShaderChunk[\"lights_phong_pars_vertex\"],\r\n      THREE.ShaderChunk[\"color_pars_vertex\"],\r\n      THREE.ShaderChunk[\"morphtarget_pars_vertex\"],\r\n      THREE.ShaderChunk[\"skinning_pars_vertex\"],\r\n      THREE.ShaderChunk[\"shadowmap_pars_vertex\"],\r\n      THREE.ShaderChunk[\"logdepthbuf_pars_vertex\"],\r\n\r\n      \"void main() {\",\r\n\r\n      THREE.ShaderChunk[\"map_vertex\"],\r\n      THREE.ShaderChunk[\"lightmap_vertex\"],\r\n      THREE.ShaderChunk[\"color_vertex\"],\r\n\r\n      THREE.ShaderChunk[\"morphnormal_vertex\"],\r\n      THREE.ShaderChunk[\"skinbase_vertex\"],\r\n      THREE.ShaderChunk[\"skinnormal_vertex\"],\r\n      THREE.ShaderChunk[\"defaultnormal_vertex\"],\r\n\r\n      \"#ifndef FLAT_SHADED\", // Normal computed with derivatives when FLAT_SHADED\r\n\r\n      \"\tvNormal = normalize( transformedNormal );\",\r\n\r\n      \"#endif\",\r\n\r\n      THREE.ShaderChunk[\"morphtarget_vertex\"],\r\n      THREE.ShaderChunk[\"skinning_vertex\"],\r\n      THREE.ShaderChunk[\"default_vertex\"],\r\n      THREE.ShaderChunk[\"logdepthbuf_vertex\"],\r\n\r\n      \"\tvViewPosition = -mvPosition.xyz;\",\r\n\r\n      THREE.ShaderChunk[\"worldpos_vertex\"],\r\n      THREE.ShaderChunk[\"envmap_vertex\"],\r\n      THREE.ShaderChunk[\"lights_phong_vertex\"],\r\n      THREE.ShaderChunk[\"shadowmap_vertex\"],\r\n\r\n      \"}\"\r\n\r\n    ].join(\"\\n\"),\r\n\r\n    fragmentShader: [\r\n\r\n      \"#define PHONG\",\r\n\r\n      \"uniform vec3 diffuse;\",\r\n      \"uniform vec3 emissive;\",\r\n      \"uniform vec3 specular;\",\r\n      \"uniform float shininess;\",\r\n      \"uniform float opacity;\",\r\n\r\n      THREE.ShaderChunk[\"common\"],\r\n      THREE.ShaderChunk[\"color_pars_fragment\"],\r\n      THREE.ShaderChunk[\"map_pars_fragment\"],\r\n      THREE.ShaderChunk[\"alphamap_pars_fragment\"],\r\n      THREE.ShaderChunk[\"lightmap_pars_fragment\"],\r\n      THREE.ShaderChunk[\"envmap_pars_fragment\"],\r\n      THREE.ShaderChunk[\"fog_pars_fragment\"],\r\n      THREE.ShaderChunk[\"lights_phong_pars_fragment\"],\r\n      THREE.ShaderChunk[\"shadowmap_pars_fragment\"],\r\n      THREE.ShaderChunk[\"bumpmap_pars_fragment\"],\r\n      THREE.ShaderChunk[\"normalmap_pars_fragment\"],\r\n      THREE.ShaderChunk[\"specularmap_pars_fragment\"],\r\n      THREE.ShaderChunk[\"logdepthbuf_pars_fragment\"],\r\n\r\n      \"void main() {\",\r\n\r\n      \"\tvec3 outgoingLight = vec3( 0.0 );\", // outgoing light does not have an alpha, the surface does\r\n      \"\tvec4 diffuseColor = vec4( diffuse, opacity );\",\r\n\r\n      THREE.ShaderChunk[\"logdepthbuf_fragment\"],\r\n      THREE.ShaderChunk[\"map_fragment\"],\r\n      THREE.ShaderChunk[\"color_fragment\"],\r\n      THREE.ShaderChunk[\"alphamap_fragment\"],\r\n      THREE.ShaderChunk[\"alphatest_fragment\"],\r\n      THREE.ShaderChunk[\"specularmap_fragment\"],\r\n\r\n      THREE.ShaderChunk[\"lights_phong_fragment\"],\r\n\r\n      THREE.ShaderChunk[\"lightmap_fragment\"],\r\n      THREE.ShaderChunk[\"envmap_fragment\"],\r\n      THREE.ShaderChunk[\"shadowmap_fragment\"],\r\n\r\n      THREE.ShaderChunk[\"linear_to_gamma_fragment\"],\r\n\r\n      THREE.ShaderChunk[\"fog_fragment\"],\r\n\r\n      \"\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\", // TODO, this should be pre-multiplied to allow for bright highlights on very transparent objects\r\n\r\n      \"}\"\r\n\r\n    ].join(\"\\n\")\r\n\r\n  },\r\n\r\n  'particle_basic': {\r\n\r\n    uniforms: THREE.UniformsUtils.merge([\r\n\r\n      THREE.UniformsLib[\"particle\"],\r\n      THREE.UniformsLib[\"shadowmap\"]\r\n\r\n    ]),\r\n\r\n    vertexShader: [\r\n\r\n      \"uniform float size;\",\r\n      \"uniform float scale;\",\r\n\r\n      THREE.ShaderChunk[\"common\"],\r\n      THREE.ShaderChunk[\"color_pars_vertex\"],\r\n      THREE.ShaderChunk[\"shadowmap_pars_vertex\"],\r\n      THREE.ShaderChunk[\"logdepthbuf_pars_vertex\"],\r\n\r\n      \"void main() {\",\r\n\r\n      THREE.ShaderChunk[\"color_vertex\"],\r\n\r\n      \"\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\",\r\n\r\n      \"\t#ifdef USE_SIZEATTENUATION\",\r\n      \"\t\tgl_PointSize = size * ( scale / length( mvPosition.xyz ) );\",\r\n      \"\t#else\",\r\n      \"\t\tgl_PointSize = size;\",\r\n      \"\t#endif\",\r\n\r\n      \"\tgl_Position = projectionMatrix * mvPosition;\",\r\n\r\n      THREE.ShaderChunk[\"logdepthbuf_vertex\"],\r\n      THREE.ShaderChunk[\"worldpos_vertex\"],\r\n      THREE.ShaderChunk[\"shadowmap_vertex\"],\r\n\r\n      \"}\"\r\n\r\n    ].join(\"\\n\"),\r\n\r\n    fragmentShader: [\r\n\r\n      \"uniform vec3 psColor;\",\r\n      \"uniform float opacity;\",\r\n\r\n      THREE.ShaderChunk[\"common\"],\r\n      THREE.ShaderChunk[\"color_pars_fragment\"],\r\n      THREE.ShaderChunk[\"map_particle_pars_fragment\"],\r\n      THREE.ShaderChunk[\"fog_pars_fragment\"],\r\n      THREE.ShaderChunk[\"shadowmap_pars_fragment\"],\r\n      THREE.ShaderChunk[\"logdepthbuf_pars_fragment\"],\r\n\r\n      \"void main() {\",\r\n\r\n      \"\tvec3 outgoingLight = vec3( 0.0 );\", // outgoing light does not have an alpha, the surface does\r\n      \"\tvec4 diffuseColor = vec4( psColor, opacity );\",\r\n\r\n      THREE.ShaderChunk[\"logdepthbuf_fragment\"],\r\n      THREE.ShaderChunk[\"map_particle_fragment\"],\r\n      THREE.ShaderChunk[\"color_fragment\"],\r\n      THREE.ShaderChunk[\"alphatest_fragment\"],\r\n\r\n      \"\toutgoingLight = diffuseColor.rgb;\", // simple shader\r\n\r\n      THREE.ShaderChunk[\"shadowmap_fragment\"],\r\n      THREE.ShaderChunk[\"fog_fragment\"],\r\n\r\n      \"\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\", // TODO, this should be pre-multiplied to allow for bright highlights on very transparent objects\r\n\r\n      \"}\"\r\n\r\n    ].join(\"\\n\")\r\n\r\n  },\r\n\r\n  'dashed': {\r\n\r\n    uniforms: THREE.UniformsUtils.merge([\r\n\r\n      THREE.UniformsLib[\"common\"],\r\n      THREE.UniformsLib[\"fog\"],\r\n\r\n      {\r\n        \"scale\": {\r\n          type: \"f\",\r\n          value: 1\r\n        },\r\n        \"dashSize\": {\r\n          type: \"f\",\r\n          value: 1\r\n        },\r\n        \"totalSize\": {\r\n          type: \"f\",\r\n          value: 2\r\n        }\r\n      }\r\n\r\n    ]),\r\n\r\n    vertexShader: [\r\n\r\n      \"uniform float scale;\",\r\n      \"attribute float lineDistance;\",\r\n\r\n      \"varying float vLineDistance;\",\r\n\r\n      THREE.ShaderChunk[\"common\"],\r\n      THREE.ShaderChunk[\"color_pars_vertex\"],\r\n      THREE.ShaderChunk[\"logdepthbuf_pars_vertex\"],\r\n\r\n      \"void main() {\",\r\n\r\n      THREE.ShaderChunk[\"color_vertex\"],\r\n\r\n      \"\tvLineDistance = scale * lineDistance;\",\r\n\r\n      \"\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\",\r\n      \"\tgl_Position = projectionMatrix * mvPosition;\",\r\n\r\n      THREE.ShaderChunk[\"logdepthbuf_vertex\"],\r\n\r\n      \"}\"\r\n\r\n    ].join(\"\\n\"),\r\n\r\n    fragmentShader: [\r\n\r\n      \"uniform vec3 diffuse;\",\r\n      \"uniform float opacity;\",\r\n\r\n      \"uniform float dashSize;\",\r\n      \"uniform float totalSize;\",\r\n\r\n      \"varying float vLineDistance;\",\r\n\r\n      THREE.ShaderChunk[\"common\"],\r\n      THREE.ShaderChunk[\"color_pars_fragment\"],\r\n      THREE.ShaderChunk[\"fog_pars_fragment\"],\r\n      THREE.ShaderChunk[\"logdepthbuf_pars_fragment\"],\r\n\r\n      \"void main() {\",\r\n\r\n      \"\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\",\r\n\r\n      \"\t\tdiscard;\",\r\n\r\n      \"\t}\",\r\n\r\n      \"\tvec3 outgoingLight = vec3( 0.0 );\", // outgoing light does not have an alpha, the surface does\r\n      \"\tvec4 diffuseColor = vec4( diffuse, opacity );\",\r\n\r\n      THREE.ShaderChunk[\"logdepthbuf_fragment\"],\r\n      THREE.ShaderChunk[\"color_fragment\"],\r\n\r\n      \"\toutgoingLight = diffuseColor.rgb;\", // simple shader\r\n\r\n      THREE.ShaderChunk[\"fog_fragment\"],\r\n\r\n      \"\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\", // TODO, this should be pre-multiplied to allow for bright highlights on very transparent objects\r\n\r\n      \"}\"\r\n\r\n    ].join(\"\\n\")\r\n\r\n  },\r\n\r\n  'depth': {\r\n\r\n    uniforms: {\r\n\r\n      \"mNear\": {\r\n        type: \"f\",\r\n        value: 1.0\r\n      },\r\n      \"mFar\": {\r\n        type: \"f\",\r\n        value: 2000.0\r\n      },\r\n      \"opacity\": {\r\n        type: \"f\",\r\n        value: 1.0\r\n      }\r\n\r\n    },\r\n\r\n    vertexShader: [\r\n\r\n      THREE.ShaderChunk[\"common\"],\r\n      THREE.ShaderChunk[\"morphtarget_pars_vertex\"],\r\n      THREE.ShaderChunk[\"logdepthbuf_pars_vertex\"],\r\n\r\n      \"void main() {\",\r\n\r\n      THREE.ShaderChunk[\"morphtarget_vertex\"],\r\n      THREE.ShaderChunk[\"default_vertex\"],\r\n      THREE.ShaderChunk[\"logdepthbuf_vertex\"],\r\n\r\n      \"}\"\r\n\r\n    ].join(\"\\n\"),\r\n\r\n    fragmentShader: [\r\n\r\n      \"uniform float mNear;\",\r\n      \"uniform float mFar;\",\r\n      \"uniform float opacity;\",\r\n\r\n      THREE.ShaderChunk[\"common\"],\r\n      THREE.ShaderChunk[\"logdepthbuf_pars_fragment\"],\r\n\r\n      \"void main() {\",\r\n\r\n      THREE.ShaderChunk[\"logdepthbuf_fragment\"],\r\n\r\n      \"\t#ifdef USE_LOGDEPTHBUF_EXT\",\r\n\r\n      \"\t\tfloat depth = gl_FragDepthEXT / gl_FragCoord.w;\",\r\n\r\n      \"\t#else\",\r\n\r\n      \"\t\tfloat depth = gl_FragCoord.z / gl_FragCoord.w;\",\r\n\r\n      \"\t#endif\",\r\n\r\n      \"\tfloat color = 1.0 - smoothstep( mNear, mFar, depth );\",\r\n      \"\tgl_FragColor = vec4( vec3( color ), opacity );\", // TODO, this should be pre-multiplied to allow for bright highlights on very transparent objects\r\n\r\n      \"}\"\r\n\r\n    ].join(\"\\n\")\r\n\r\n  },\r\n\r\n  'normal': {\r\n\r\n    uniforms: {\r\n\r\n      \"opacity\": {\r\n        type: \"f\",\r\n        value: 1.0\r\n      }\r\n\r\n    },\r\n\r\n    vertexShader: [\r\n\r\n      \"varying vec3 vNormal;\",\r\n\r\n      THREE.ShaderChunk[\"common\"],\r\n      THREE.ShaderChunk[\"morphtarget_pars_vertex\"],\r\n      THREE.ShaderChunk[\"logdepthbuf_pars_vertex\"],\r\n\r\n      \"void main() {\",\r\n\r\n      \"\tvNormal = normalize( normalMatrix * normal );\",\r\n\r\n      THREE.ShaderChunk[\"morphtarget_vertex\"],\r\n      THREE.ShaderChunk[\"default_vertex\"],\r\n      THREE.ShaderChunk[\"logdepthbuf_vertex\"],\r\n\r\n      \"}\"\r\n\r\n    ].join(\"\\n\"),\r\n\r\n    fragmentShader: [\r\n\r\n      \"uniform float opacity;\",\r\n      \"varying vec3 vNormal;\",\r\n\r\n      THREE.ShaderChunk[\"common\"],\r\n      THREE.ShaderChunk[\"logdepthbuf_pars_fragment\"],\r\n\r\n      \"void main() {\",\r\n\r\n      \"\tgl_FragColor = vec4( 0.5 * normalize( vNormal ) + 0.5, opacity );\",\r\n\r\n      THREE.ShaderChunk[\"logdepthbuf_fragment\"],\r\n\r\n      \"}\"\r\n\r\n    ].join(\"\\n\")\r\n\r\n  },\r\n\r\n  /* -------------------------------------------------------------------------\r\n  //\tCube map shader\r\n   ------------------------------------------------------------------------- */\r\n\r\n  'cube': {\r\n\r\n    uniforms: {\r\n      \"tCube\": {\r\n        type: \"t\",\r\n        value: null\r\n      },\r\n      \"tFlip\": {\r\n        type: \"f\",\r\n        value: -1\r\n      }\r\n    },\r\n\r\n    vertexShader: [\r\n\r\n      \"varying vec3 vWorldPosition;\",\r\n\r\n      THREE.ShaderChunk[\"common\"],\r\n      THREE.ShaderChunk[\"logdepthbuf_pars_vertex\"],\r\n\r\n      \"void main() {\",\r\n\r\n      \"\tvWorldPosition = transformDirection( position, modelMatrix );\",\r\n\r\n      \"\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\",\r\n\r\n      THREE.ShaderChunk[\"logdepthbuf_vertex\"],\r\n\r\n      \"}\"\r\n\r\n    ].join(\"\\n\"),\r\n\r\n    fragmentShader: [\r\n\r\n      \"uniform samplerCube tCube;\",\r\n      \"uniform float tFlip;\",\r\n\r\n      \"varying vec3 vWorldPosition;\",\r\n\r\n      THREE.ShaderChunk[\"common\"],\r\n      THREE.ShaderChunk[\"logdepthbuf_pars_fragment\"],\r\n\r\n      \"void main() {\",\r\n\r\n      \"\tgl_FragColor = textureCube( tCube, vec3( tFlip * vWorldPosition.x, vWorldPosition.yz ) );\",\r\n\r\n      THREE.ShaderChunk[\"logdepthbuf_fragment\"],\r\n\r\n      \"}\"\r\n\r\n    ].join(\"\\n\")\r\n\r\n  },\r\n\r\n  /* -------------------------------------------------------------------------\r\n  //\tCube map shader\r\n   ------------------------------------------------------------------------- */\r\n\r\n  'equirect': {\r\n\r\n    uniforms: {\r\n      \"tEquirect\": {\r\n        type: \"t\",\r\n        value: null\r\n      },\r\n      \"tFlip\": {\r\n        type: \"f\",\r\n        value: -1\r\n      }\r\n    },\r\n\r\n    vertexShader: [\r\n\r\n      \"varying vec3 vWorldPosition;\",\r\n\r\n      THREE.ShaderChunk[\"common\"],\r\n      THREE.ShaderChunk[\"logdepthbuf_pars_vertex\"],\r\n\r\n      \"void main() {\",\r\n\r\n      \"\tvWorldPosition = transformDirection( position, modelMatrix );\",\r\n\r\n      \"\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\",\r\n\r\n      THREE.ShaderChunk[\"logdepthbuf_vertex\"],\r\n\r\n      \"}\"\r\n\r\n    ].join(\"\\n\"),\r\n\r\n    fragmentShader: [\r\n\r\n      \"uniform sampler2D tEquirect;\",\r\n      \"uniform float tFlip;\",\r\n\r\n      \"varying vec3 vWorldPosition;\",\r\n\r\n      THREE.ShaderChunk[\"common\"],\r\n      THREE.ShaderChunk[\"logdepthbuf_pars_fragment\"],\r\n\r\n      \"void main() {\",\r\n\r\n      // \"\tgl_FragColor = textureCube( tCube, vec3( tFlip * vWorldPosition.x, vWorldPosition.yz ) );\",\r\n      \"vec3 direction = normalize( vWorldPosition );\",\r\n      \"vec2 sampleUV;\",\r\n      \"sampleUV.y = saturate( tFlip * direction.y * -0.5 + 0.5 );\",\r\n      \"sampleUV.x = atan( direction.z, direction.x ) * RECIPROCAL_PI2 + 0.5;\",\r\n      \"gl_FragColor = texture2D( tEquirect, sampleUV );\",\r\n\r\n      THREE.ShaderChunk[\"logdepthbuf_fragment\"],\r\n\r\n      \"}\"\r\n\r\n    ].join(\"\\n\")\r\n\r\n  },\r\n\r\n  /* Depth encoding into RGBA texture\r\n   *\r\n   * based on SpiderGL shadow map example\r\n   * http://spidergl.org/example.php?id=6\r\n   *\r\n   * originally from\r\n   * http://www.gamedev.net/topic/442138-packing-a-float-into-a-a8r8g8b8-texture-shader/page__whichpage__1%25EF%25BF%25BD\r\n   *\r\n   * see also\r\n   * http://aras-p.info/blog/2009/07/30/encoding-floats-to-rgba-the-final/\r\n   */\r\n\r\n  'depthRGBA': {\r\n\r\n    uniforms: {},\r\n\r\n    vertexShader: [\r\n\r\n      THREE.ShaderChunk[\"common\"],\r\n      THREE.ShaderChunk[\"morphtarget_pars_vertex\"],\r\n      THREE.ShaderChunk[\"skinning_pars_vertex\"],\r\n      THREE.ShaderChunk[\"logdepthbuf_pars_vertex\"],\r\n\r\n      \"void main() {\",\r\n\r\n      THREE.ShaderChunk[\"skinbase_vertex\"],\r\n      THREE.ShaderChunk[\"morphtarget_vertex\"],\r\n      THREE.ShaderChunk[\"skinning_vertex\"],\r\n      THREE.ShaderChunk[\"default_vertex\"],\r\n      THREE.ShaderChunk[\"logdepthbuf_vertex\"],\r\n\r\n      \"}\"\r\n\r\n    ].join(\"\\n\"),\r\n\r\n    fragmentShader: [\r\n\r\n      THREE.ShaderChunk[\"common\"],\r\n      THREE.ShaderChunk[\"logdepthbuf_pars_fragment\"],\r\n\r\n      \"vec4 pack_depth( const in float depth ) {\",\r\n\r\n      \"\tconst vec4 bit_shift = vec4( 256.0 * 256.0 * 256.0, 256.0 * 256.0, 256.0, 1.0 );\",\r\n      \"\tconst vec4 bit_mask = vec4( 0.0, 1.0 / 256.0, 1.0 / 256.0, 1.0 / 256.0 );\",\r\n      \"\tvec4 res = mod( depth * bit_shift * vec4( 255 ), vec4( 256 ) ) / vec4( 255 );\", // \"\tvec4 res = fract( depth * bit_shift );\",\r\n      \"\tres -= res.xxyz * bit_mask;\",\r\n      \"\treturn res;\",\r\n\r\n      \"}\",\r\n\r\n      \"void main() {\",\r\n\r\n      THREE.ShaderChunk[\"logdepthbuf_fragment\"],\r\n\r\n      \"\t#ifdef USE_LOGDEPTHBUF_EXT\",\r\n\r\n      \"\t\tgl_FragData[ 0 ] = pack_depth( gl_FragDepthEXT );\",\r\n\r\n      \"\t#else\",\r\n\r\n      \"\t\tgl_FragData[ 0 ] = pack_depth( gl_FragCoord.z );\",\r\n\r\n      \"\t#endif\",\r\n\r\n      //\"gl_FragData[ 0 ] = pack_depth( gl_FragCoord.z / gl_FragCoord.w );\",\r\n      //\"float z = ( ( gl_FragCoord.z / gl_FragCoord.w ) - 3.0 ) / ( 4000.0 - 3.0 );\",\r\n      //\"gl_FragData[ 0 ] = pack_depth( z );\",\r\n      //\"gl_FragData[ 0 ] = vec4( z, z, z, 1.0 );\",\r\n\r\n      \"}\"\r\n\r\n    ].join(\"\\n\")\r\n\r\n  }\r\n\r\n};\r\n\r\n// File:src/renderers/WebGLRenderer.js\r\n\r\n/**\r\n * @author supereggbert / http://www.paulbrunt.co.uk/\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author alteredq / http://alteredqualia.com/\r\n * @author szimek / https://github.com/szimek/\r\n */\r\n\r\nTHREE.WebGLRenderer = function(parameters) {\r\n\r\n  console.log('THREE.WebGLRenderer', THREE.REVISION);\r\n\r\n  parameters = parameters || {};\r\n\r\n  var _canvas = parameters.canvas !== undefined ? parameters.canvas : document.createElement('canvas'),\r\n    _context = parameters.context !== undefined ? parameters.context : null,\r\n\r\n    pixelRatio = 1,\r\n\r\n    _precision = parameters.precision !== undefined ? parameters.precision : 'highp',\r\n\r\n    _alpha = parameters.alpha !== undefined ? parameters.alpha : false,\r\n    _depth = parameters.depth !== undefined ? parameters.depth : true,\r\n    _stencil = parameters.stencil !== undefined ? parameters.stencil : true,\r\n    _antialias = parameters.antialias !== undefined ? parameters.antialias : false,\r\n    _premultipliedAlpha = parameters.premultipliedAlpha !== undefined ? parameters.premultipliedAlpha : true,\r\n    _preserveDrawingBuffer = parameters.preserveDrawingBuffer !== undefined ? parameters.preserveDrawingBuffer : false,\r\n    _logarithmicDepthBuffer = parameters.logarithmicDepthBuffer !== undefined ? parameters.logarithmicDepthBuffer : false,\r\n\r\n    _clearColor = new THREE.Color(0x000000),\r\n    _clearAlpha = 0;\r\n\r\n  var lights = [];\r\n\r\n  var _webglObjects = {};\r\n  var _webglObjectsImmediate = [];\r\n\r\n  var opaqueObjects = [];\r\n  var transparentObjects = [];\r\n\r\n  var sprites = [];\r\n  var lensFlares = [];\r\n\r\n  // public properties\r\n\r\n  this.domElement = _canvas;\r\n  this.context = null;\r\n\r\n  // clearing\r\n\r\n  this.autoClear = true;\r\n  this.autoClearColor = true;\r\n  this.autoClearDepth = true;\r\n  this.autoClearStencil = true;\r\n\r\n  // scene graph\r\n\r\n  this.sortObjects = true;\r\n\r\n  // physically based shading\r\n\r\n  this.gammaFactor = 2.0; // for backwards compatibility\r\n  this.gammaInput = false;\r\n  this.gammaOutput = false;\r\n\r\n  // shadow map\r\n\r\n  this.shadowMapEnabled = false;\r\n  this.shadowMapType = THREE.PCFShadowMap;\r\n  this.shadowMapCullFace = THREE.CullFaceFront;\r\n  this.shadowMapDebug = false;\r\n  this.shadowMapCascade = false;\r\n\r\n  // morphs\r\n\r\n  this.maxMorphTargets = 8;\r\n  this.maxMorphNormals = 4;\r\n\r\n  // flags\r\n\r\n  this.autoScaleCubemaps = true;\r\n\r\n  // info\r\n\r\n  this.info = {\r\n\r\n    memory: {\r\n\r\n      programs: 0,\r\n      geometries: 0,\r\n      textures: 0\r\n\r\n    },\r\n\r\n    render: {\r\n\r\n      calls: 0,\r\n      vertices: 0,\r\n      faces: 0,\r\n      points: 0\r\n\r\n    }\r\n\r\n  };\r\n\r\n  // internal properties\r\n\r\n  var _this = this,\r\n\r\n    _programs = [],\r\n\r\n    // internal state cache\r\n\r\n    _currentProgram = null,\r\n    _currentFramebuffer = null,\r\n    _currentMaterialId = -1,\r\n    _currentGeometryProgram = '',\r\n    _currentCamera = null,\r\n\r\n    _usedTextureUnits = 0,\r\n\r\n    _viewportX = 0,\r\n    _viewportY = 0,\r\n    _viewportWidth = _canvas.width,\r\n    _viewportHeight = _canvas.height,\r\n    _currentWidth = 0,\r\n    _currentHeight = 0,\r\n\r\n    // frustum\r\n\r\n    _frustum = new THREE.Frustum(),\r\n\r\n    // camera matrices cache\r\n\r\n    _projScreenMatrix = new THREE.Matrix4(),\r\n\r\n    _vector3 = new THREE.Vector3(),\r\n\r\n    // light arrays cache\r\n\r\n    _direction = new THREE.Vector3(),\r\n\r\n    _lightsNeedUpdate = true,\r\n\r\n    _lights = {\r\n\r\n      ambient: [0, 0, 0],\r\n      directional: {\r\n        length: 0,\r\n        colors: [],\r\n        positions: []\r\n      },\r\n      point: {\r\n        length: 0,\r\n        colors: [],\r\n        positions: [],\r\n        distances: [],\r\n        decays: []\r\n      },\r\n      spot: {\r\n        length: 0,\r\n        colors: [],\r\n        positions: [],\r\n        distances: [],\r\n        directions: [],\r\n        anglesCos: [],\r\n        exponents: [],\r\n        decays: []\r\n      },\r\n      hemi: {\r\n        length: 0,\r\n        skyColors: [],\r\n        groundColors: [],\r\n        positions: []\r\n      }\r\n\r\n    };\r\n\r\n  // initialize\r\n\r\n  var _gl;\r\n\r\n  try {\r\n\r\n    var attributes = {\r\n      alpha: _alpha,\r\n      depth: _depth,\r\n      stencil: _stencil,\r\n      antialias: _antialias,\r\n      premultipliedAlpha: _premultipliedAlpha,\r\n      preserveDrawingBuffer: _preserveDrawingBuffer\r\n    };\r\n\r\n    _gl = _context || _canvas.getContext('webgl', attributes) || _canvas.getContext('experimental-webgl', attributes);\r\n\r\n    if (_gl === null) {\r\n\r\n      if (_canvas.getContext('webgl') !== null) {\r\n\r\n        throw 'Error creating WebGL context with your selected attributes.';\r\n\r\n      }\r\n      else {\r\n\r\n        throw 'Error creating WebGL context.';\r\n\r\n      }\r\n\r\n    }\r\n\r\n    _canvas.addEventListener('webglcontextlost', function(event) {\r\n\r\n      event.preventDefault();\r\n\r\n      resetGLState();\r\n      setDefaultGLState();\r\n\r\n      _webglObjects = {};\r\n\r\n    }, false);\r\n\r\n  }\r\n  catch (error) {\r\n\r\n    THREE.error('THREE.WebGLRenderer: ' + error);\r\n\r\n  }\r\n\r\n  var state = new THREE.WebGLState(_gl, paramThreeToGL);\r\n\r\n  if (_gl.getShaderPrecisionFormat === undefined) {\r\n\r\n    _gl.getShaderPrecisionFormat = function() {\r\n\r\n      return {\r\n        'rangeMin': 1,\r\n        'rangeMax': 1,\r\n        'precision': 1\r\n      };\r\n\r\n    }\r\n\r\n  }\r\n\r\n  var extensions = new THREE.WebGLExtensions(_gl);\r\n\r\n  extensions.get('OES_texture_float');\r\n  extensions.get('OES_texture_float_linear');\r\n  extensions.get('OES_texture_half_float');\r\n  extensions.get('OES_texture_half_float_linear');\r\n  extensions.get('OES_standard_derivatives');\r\n\r\n  if (_logarithmicDepthBuffer) {\r\n\r\n    extensions.get('EXT_frag_depth');\r\n\r\n  }\r\n\r\n  //\r\n\r\n  var glClearColor = function(r, g, b, a) {\r\n\r\n    if (_premultipliedAlpha === true) {\r\n\r\n      r *= a;\r\n      g *= a;\r\n      b *= a;\r\n\r\n    }\r\n\r\n    _gl.clearColor(r, g, b, a);\r\n\r\n  };\r\n\r\n  var setDefaultGLState = function() {\r\n\r\n    _gl.clearColor(0, 0, 0, 1);\r\n    _gl.clearDepth(1);\r\n    _gl.clearStencil(0);\r\n\r\n    _gl.enable(_gl.DEPTH_TEST);\r\n    _gl.depthFunc(_gl.LEQUAL);\r\n\r\n    _gl.frontFace(_gl.CCW);\r\n    _gl.cullFace(_gl.BACK);\r\n    _gl.enable(_gl.CULL_FACE);\r\n\r\n    _gl.enable(_gl.BLEND);\r\n    _gl.blendEquation(_gl.FUNC_ADD);\r\n    _gl.blendFunc(_gl.SRC_ALPHA, _gl.ONE_MINUS_SRC_ALPHA);\r\n\r\n    _gl.viewport(_viewportX, _viewportY, _viewportWidth, _viewportHeight);\r\n\r\n    glClearColor(_clearColor.r, _clearColor.g, _clearColor.b, _clearAlpha);\r\n\r\n  };\r\n\r\n  var resetGLState = function() {\r\n\r\n    _currentProgram = null;\r\n    _currentCamera = null;\r\n\r\n    _currentGeometryProgram = '';\r\n    _currentMaterialId = -1;\r\n\r\n    _lightsNeedUpdate = true;\r\n\r\n    state.reset();\r\n\r\n  };\r\n\r\n  setDefaultGLState();\r\n\r\n  this.context = _gl;\r\n  this.state = state;\r\n\r\n  // GPU capabilities\r\n\r\n  var _maxTextures = _gl.getParameter(_gl.MAX_TEXTURE_IMAGE_UNITS);\r\n  var _maxVertexTextures = _gl.getParameter(_gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS);\r\n  var _maxTextureSize = _gl.getParameter(_gl.MAX_TEXTURE_SIZE);\r\n  var _maxCubemapSize = _gl.getParameter(_gl.MAX_CUBE_MAP_TEXTURE_SIZE);\r\n\r\n  var _supportsVertexTextures = _maxVertexTextures > 0;\r\n  var _supportsBoneTextures = _supportsVertexTextures && extensions.get('OES_texture_float');\r\n\r\n  //\r\n\r\n  var _vertexShaderPrecisionHighpFloat = _gl.getShaderPrecisionFormat(_gl.VERTEX_SHADER, _gl.HIGH_FLOAT);\r\n  var _vertexShaderPrecisionMediumpFloat = _gl.getShaderPrecisionFormat(_gl.VERTEX_SHADER, _gl.MEDIUM_FLOAT);\r\n\r\n  var _fragmentShaderPrecisionHighpFloat = _gl.getShaderPrecisionFormat(_gl.FRAGMENT_SHADER, _gl.HIGH_FLOAT);\r\n  var _fragmentShaderPrecisionMediumpFloat = _gl.getShaderPrecisionFormat(_gl.FRAGMENT_SHADER, _gl.MEDIUM_FLOAT);\r\n\r\n  var getCompressedTextureFormats = (function() {\r\n\r\n    var array;\r\n\r\n    return function() {\r\n\r\n      if (array !== undefined) {\r\n\r\n        return array;\r\n\r\n      }\r\n\r\n      array = [];\r\n\r\n      if (extensions.get('WEBGL_compressed_texture_pvrtc') || extensions.get('WEBGL_compressed_texture_s3tc')) {\r\n\r\n        var formats = _gl.getParameter(_gl.COMPRESSED_TEXTURE_FORMATS);\r\n\r\n        for (var i = 0; i < formats.length; i++) {\r\n\r\n          array.push(formats[i]);\r\n\r\n        }\r\n\r\n      }\r\n\r\n      return array;\r\n\r\n    };\r\n\r\n  })();\r\n\r\n  // clamp precision to maximum available\r\n\r\n  var highpAvailable = _vertexShaderPrecisionHighpFloat.precision > 0 && _fragmentShaderPrecisionHighpFloat.precision > 0;\r\n  var mediumpAvailable = _vertexShaderPrecisionMediumpFloat.precision > 0 && _fragmentShaderPrecisionMediumpFloat.precision > 0;\r\n\r\n  if (_precision === 'highp' && !highpAvailable) {\r\n\r\n    if (mediumpAvailable) {\r\n\r\n      _precision = 'mediump';\r\n      THREE.warn('THREE.WebGLRenderer: highp not supported, using mediump.');\r\n\r\n    }\r\n    else {\r\n\r\n      _precision = 'lowp';\r\n      THREE.warn('THREE.WebGLRenderer: highp and mediump not supported, using lowp.');\r\n\r\n    }\r\n\r\n  }\r\n\r\n  if (_precision === 'mediump' && !mediumpAvailable) {\r\n\r\n    _precision = 'lowp';\r\n    THREE.warn('THREE.WebGLRenderer: mediump not supported, using lowp.');\r\n\r\n  }\r\n\r\n  // Plugins\r\n\r\n  var shadowMapPlugin = new THREE.ShadowMapPlugin(this, lights, _webglObjects, _webglObjectsImmediate);\r\n\r\n  var spritePlugin = new THREE.SpritePlugin(this, sprites);\r\n  var lensFlarePlugin = new THREE.LensFlarePlugin(this, lensFlares);\r\n\r\n  // API\r\n\r\n  this.getContext = function() {\r\n\r\n    return _gl;\r\n\r\n  };\r\n\r\n  this.forceContextLoss = function() {\r\n\r\n    extensions.get('WEBGL_lose_context').loseContext();\r\n\r\n  };\r\n\r\n  this.supportsVertexTextures = function() {\r\n\r\n    return _supportsVertexTextures;\r\n\r\n  };\r\n\r\n  this.supportsFloatTextures = function() {\r\n\r\n    return extensions.get('OES_texture_float');\r\n\r\n  };\r\n\r\n  this.supportsHalfFloatTextures = function() {\r\n\r\n    return extensions.get('OES_texture_half_float');\r\n\r\n  };\r\n\r\n  this.supportsStandardDerivatives = function() {\r\n\r\n    return extensions.get('OES_standard_derivatives');\r\n\r\n  };\r\n\r\n  this.supportsCompressedTextureS3TC = function() {\r\n\r\n    return extensions.get('WEBGL_compressed_texture_s3tc');\r\n\r\n  };\r\n\r\n  this.supportsCompressedTexturePVRTC = function() {\r\n\r\n    return extensions.get('WEBGL_compressed_texture_pvrtc');\r\n\r\n  };\r\n\r\n  this.supportsBlendMinMax = function() {\r\n\r\n    return extensions.get('EXT_blend_minmax');\r\n\r\n  };\r\n\r\n  this.getMaxAnisotropy = (function() {\r\n\r\n    var value;\r\n\r\n    return function() {\r\n\r\n      if (value !== undefined) {\r\n\r\n        return value;\r\n\r\n      }\r\n\r\n      var extension = extensions.get('EXT_texture_filter_anisotropic');\r\n\r\n      value = extension !== null ? _gl.getParameter(extension.MAX_TEXTURE_MAX_ANISOTROPY_EXT) : 0;\r\n\r\n      return value;\r\n\r\n    }\r\n\r\n  })();\r\n\r\n  this.getPrecision = function() {\r\n\r\n    return _precision;\r\n\r\n  };\r\n\r\n  this.getPixelRatio = function() {\r\n\r\n    return pixelRatio;\r\n\r\n  };\r\n\r\n  this.setPixelRatio = function(value) {\r\n\r\n    pixelRatio = value;\r\n\r\n  };\r\n\r\n  this.setSize = function(width, height, updateStyle) {\r\n\r\n    _canvas.width = width * pixelRatio;\r\n    _canvas.height = height * pixelRatio;\r\n\r\n    if (updateStyle !== false) {\r\n\r\n      _canvas.style.width = width + 'px';\r\n      _canvas.style.height = height + 'px';\r\n\r\n    }\r\n\r\n    this.setViewport(0, 0, width, height);\r\n\r\n  };\r\n\r\n  this.setViewport = function(x, y, width, height) {\r\n\r\n    _viewportX = x * pixelRatio;\r\n    _viewportY = y * pixelRatio;\r\n\r\n    _viewportWidth = width * pixelRatio;\r\n    _viewportHeight = height * pixelRatio;\r\n\r\n    _gl.viewport(_viewportX, _viewportY, _viewportWidth, _viewportHeight);\r\n\r\n  };\r\n\r\n  this.setScissor = function(x, y, width, height) {\r\n\r\n    _gl.scissor(\r\n      x * pixelRatio,\r\n      y * pixelRatio,\r\n      width * pixelRatio,\r\n      height * pixelRatio\r\n    );\r\n\r\n  };\r\n\r\n  this.enableScissorTest = function(enable) {\r\n\r\n    enable ? _gl.enable(_gl.SCISSOR_TEST) : _gl.disable(_gl.SCISSOR_TEST);\r\n\r\n  };\r\n\r\n  // Clearing\r\n\r\n  this.getClearColor = function() {\r\n\r\n    return _clearColor;\r\n\r\n  };\r\n\r\n  this.setClearColor = function(color, alpha) {\r\n\r\n    _clearColor.set(color);\r\n\r\n    _clearAlpha = alpha !== undefined ? alpha : 1;\r\n\r\n    glClearColor(_clearColor.r, _clearColor.g, _clearColor.b, _clearAlpha);\r\n\r\n  };\r\n\r\n  this.getClearAlpha = function() {\r\n\r\n    return _clearAlpha;\r\n\r\n  };\r\n\r\n  this.setClearAlpha = function(alpha) {\r\n\r\n    _clearAlpha = alpha;\r\n\r\n    glClearColor(_clearColor.r, _clearColor.g, _clearColor.b, _clearAlpha);\r\n\r\n  };\r\n\r\n  this.clear = function(color, depth, stencil) {\r\n\r\n    var bits = 0;\r\n\r\n    if (color === undefined || color) bits |= _gl.COLOR_BUFFER_BIT;\r\n    if (depth === undefined || depth) bits |= _gl.DEPTH_BUFFER_BIT;\r\n    if (stencil === undefined || stencil) bits |= _gl.STENCIL_BUFFER_BIT;\r\n\r\n    _gl.clear(bits);\r\n\r\n  };\r\n\r\n  this.clearColor = function() {\r\n\r\n    _gl.clear(_gl.COLOR_BUFFER_BIT);\r\n\r\n  };\r\n\r\n  this.clearDepth = function() {\r\n\r\n    _gl.clear(_gl.DEPTH_BUFFER_BIT);\r\n\r\n  };\r\n\r\n  this.clearStencil = function() {\r\n\r\n    _gl.clear(_gl.STENCIL_BUFFER_BIT);\r\n\r\n  };\r\n\r\n  this.clearTarget = function(renderTarget, color, depth, stencil) {\r\n\r\n    this.setRenderTarget(renderTarget);\r\n    this.clear(color, depth, stencil);\r\n\r\n  };\r\n\r\n  // Reset\r\n\r\n  this.resetGLState = resetGLState;\r\n\r\n  // Buffer allocation\r\n\r\n  function createParticleBuffers(geometry) {\r\n\r\n    geometry.__webglVertexBuffer = _gl.createBuffer();\r\n    geometry.__webglColorBuffer = _gl.createBuffer();\r\n\r\n    _this.info.memory.geometries++;\r\n\r\n  };\r\n\r\n  function createLineBuffers(geometry) {\r\n\r\n    geometry.__webglVertexBuffer = _gl.createBuffer();\r\n    geometry.__webglColorBuffer = _gl.createBuffer();\r\n    geometry.__webglLineDistanceBuffer = _gl.createBuffer();\r\n\r\n    _this.info.memory.geometries++;\r\n\r\n  };\r\n\r\n  function createMeshBuffers(geometryGroup) {\r\n\r\n    geometryGroup.__webglVertexBuffer = _gl.createBuffer();\r\n    geometryGroup.__webglNormalBuffer = _gl.createBuffer();\r\n    geometryGroup.__webglTangentBuffer = _gl.createBuffer();\r\n    geometryGroup.__webglColorBuffer = _gl.createBuffer();\r\n    geometryGroup.__webglUVBuffer = _gl.createBuffer();\r\n    geometryGroup.__webglUV2Buffer = _gl.createBuffer();\r\n\r\n    geometryGroup.__webglSkinIndicesBuffer = _gl.createBuffer();\r\n    geometryGroup.__webglSkinWeightsBuffer = _gl.createBuffer();\r\n\r\n    geometryGroup.__webglFaceBuffer = _gl.createBuffer();\r\n    geometryGroup.__webglLineBuffer = _gl.createBuffer();\r\n\r\n    var numMorphTargets = geometryGroup.numMorphTargets;\r\n\r\n    if (numMorphTargets) {\r\n\r\n      geometryGroup.__webglMorphTargetsBuffers = [];\r\n\r\n      for (var m = 0, ml = numMorphTargets; m < ml; m++) {\r\n\r\n        geometryGroup.__webglMorphTargetsBuffers.push(_gl.createBuffer());\r\n\r\n      }\r\n\r\n    }\r\n\r\n    var numMorphNormals = geometryGroup.numMorphNormals;\r\n\r\n    if (numMorphNormals) {\r\n\r\n      geometryGroup.__webglMorphNormalsBuffers = [];\r\n\r\n      for (var m = 0, ml = numMorphNormals; m < ml; m++) {\r\n\r\n        geometryGroup.__webglMorphNormalsBuffers.push(_gl.createBuffer());\r\n\r\n      }\r\n\r\n    }\r\n\r\n    _this.info.memory.geometries++;\r\n\r\n  };\r\n\r\n  // Events\r\n\r\n  var onObjectRemoved = function(event) {\r\n\r\n    var object = event.target;\r\n\r\n    object.traverse(function(child) {\r\n\r\n      child.removeEventListener('remove', onObjectRemoved);\r\n\r\n      removeObject(child);\r\n\r\n    });\r\n\r\n  };\r\n\r\n  var onGeometryDispose = function(event) {\r\n\r\n    var geometry = event.target;\r\n\r\n    geometry.removeEventListener('dispose', onGeometryDispose);\r\n\r\n    deallocateGeometry(geometry);\r\n\r\n  };\r\n\r\n  var onTextureDispose = function(event) {\r\n\r\n    var texture = event.target;\r\n\r\n    texture.removeEventListener('dispose', onTextureDispose);\r\n\r\n    deallocateTexture(texture);\r\n\r\n    _this.info.memory.textures--;\r\n\r\n\r\n  };\r\n\r\n  var onRenderTargetDispose = function(event) {\r\n\r\n    var renderTarget = event.target;\r\n\r\n    renderTarget.removeEventListener('dispose', onRenderTargetDispose);\r\n\r\n    deallocateRenderTarget(renderTarget);\r\n\r\n    _this.info.memory.textures--;\r\n\r\n  };\r\n\r\n  var onMaterialDispose = function(event) {\r\n\r\n    var material = event.target;\r\n\r\n    material.removeEventListener('dispose', onMaterialDispose);\r\n\r\n    deallocateMaterial(material);\r\n\r\n  };\r\n\r\n  // Buffer deallocation\r\n\r\n  var deleteBuffers = function(geometry) {\r\n\r\n    var buffers = [\r\n      '__webglVertexBuffer',\r\n      '__webglNormalBuffer',\r\n      '__webglTangentBuffer',\r\n      '__webglColorBuffer',\r\n      '__webglUVBuffer',\r\n      '__webglUV2Buffer',\r\n\r\n      '__webglSkinIndicesBuffer',\r\n      '__webglSkinWeightsBuffer',\r\n\r\n      '__webglFaceBuffer',\r\n      '__webglLineBuffer',\r\n\r\n      '__webglLineDistanceBuffer'\r\n    ];\r\n\r\n    for (var i = 0, l = buffers.length; i < l; i++) {\r\n\r\n      var name = buffers[i];\r\n\r\n      if (geometry[name] !== undefined) {\r\n\r\n        _gl.deleteBuffer(geometry[name]);\r\n\r\n        delete geometry[name];\r\n\r\n      }\r\n\r\n    }\r\n\r\n    // custom attributes\r\n\r\n    if (geometry.__webglCustomAttributesList !== undefined) {\r\n\r\n      for (var name in geometry.__webglCustomAttributesList) {\r\n\r\n        _gl.deleteBuffer(geometry.__webglCustomAttributesList[name].buffer);\r\n\r\n      }\r\n\r\n      delete geometry.__webglCustomAttributesList;\r\n\r\n    }\r\n\r\n    _this.info.memory.geometries--;\r\n\r\n  };\r\n\r\n  var deallocateGeometry = function(geometry) {\r\n\r\n    delete geometry.__webglInit;\r\n\r\n    if (geometry instanceof THREE.BufferGeometry) {\r\n\r\n      for (var name in geometry.attributes) {\r\n\r\n        var attribute = geometry.attributes[name];\r\n\r\n        if (attribute.buffer !== undefined) {\r\n\r\n          _gl.deleteBuffer(attribute.buffer);\r\n\r\n          delete attribute.buffer;\r\n\r\n        }\r\n\r\n      }\r\n\r\n      _this.info.memory.geometries--;\r\n\r\n    }\r\n    else {\r\n\r\n      var geometryGroupsList = geometryGroups[geometry.id];\r\n\r\n      if (geometryGroupsList !== undefined) {\r\n\r\n        for (var i = 0, l = geometryGroupsList.length; i < l; i++) {\r\n\r\n          var geometryGroup = geometryGroupsList[i];\r\n\r\n          if (geometryGroup.numMorphTargets !== undefined) {\r\n\r\n            for (var m = 0, ml = geometryGroup.numMorphTargets; m < ml; m++) {\r\n\r\n              _gl.deleteBuffer(geometryGroup.__webglMorphTargetsBuffers[m]);\r\n\r\n            }\r\n\r\n            delete geometryGroup.__webglMorphTargetsBuffers;\r\n\r\n          }\r\n\r\n          if (geometryGroup.numMorphNormals !== undefined) {\r\n\r\n            for (var m = 0, ml = geometryGroup.numMorphNormals; m < ml; m++) {\r\n\r\n              _gl.deleteBuffer(geometryGroup.__webglMorphNormalsBuffers[m]);\r\n\r\n            }\r\n\r\n            delete geometryGroup.__webglMorphNormalsBuffers;\r\n\r\n          }\r\n\r\n          deleteBuffers(geometryGroup);\r\n\r\n        }\r\n\r\n        delete geometryGroups[geometry.id];\r\n\r\n      }\r\n      else {\r\n\r\n        deleteBuffers(geometry);\r\n\r\n      }\r\n\r\n    }\r\n\r\n    // TOFIX: Workaround for deleted geometry being currently bound\r\n\r\n    _currentGeometryProgram = '';\r\n\r\n  };\r\n\r\n  var deallocateTexture = function(texture) {\r\n\r\n    if (texture.image && texture.image.__webglTextureCube) {\r\n\r\n      // cube texture\r\n\r\n      _gl.deleteTexture(texture.image.__webglTextureCube);\r\n\r\n      delete texture.image.__webglTextureCube;\r\n\r\n    }\r\n    else {\r\n\r\n      // 2D texture\r\n\r\n      if (texture.__webglInit === undefined) return;\r\n\r\n      _gl.deleteTexture(texture.__webglTexture);\r\n\r\n      delete texture.__webglTexture;\r\n      delete texture.__webglInit;\r\n\r\n    }\r\n\r\n  };\r\n\r\n  var deallocateRenderTarget = function(renderTarget) {\r\n\r\n    if (!renderTarget || renderTarget.__webglTexture === undefined) return;\r\n\r\n    _gl.deleteTexture(renderTarget.__webglTexture);\r\n\r\n    delete renderTarget.__webglTexture;\r\n\r\n    if (renderTarget instanceof THREE.WebGLRenderTargetCube) {\r\n\r\n      for (var i = 0; i < 6; i++) {\r\n\r\n        _gl.deleteFramebuffer(renderTarget.__webglFramebuffer[i]);\r\n        _gl.deleteRenderbuffer(renderTarget.__webglRenderbuffer[i]);\r\n\r\n      }\r\n\r\n    }\r\n    else {\r\n\r\n      _gl.deleteFramebuffer(renderTarget.__webglFramebuffer);\r\n      _gl.deleteRenderbuffer(renderTarget.__webglRenderbuffer);\r\n\r\n    }\r\n\r\n    delete renderTarget.__webglFramebuffer;\r\n    delete renderTarget.__webglRenderbuffer;\r\n\r\n  };\r\n\r\n  var deallocateMaterial = function(material) {\r\n\r\n    var program = material.program.program;\r\n\r\n    if (program === undefined) return;\r\n\r\n    material.program = undefined;\r\n\r\n    // only deallocate GL program if this was the last use of shared program\r\n    // assumed there is only single copy of any program in the _programs list\r\n    // (that's how it's constructed)\r\n\r\n    var i, il, programInfo;\r\n    var deleteProgram = false;\r\n\r\n    for (i = 0, il = _programs.length; i < il; i++) {\r\n\r\n      programInfo = _programs[i];\r\n\r\n      if (programInfo.program === program) {\r\n\r\n        programInfo.usedTimes--;\r\n\r\n        if (programInfo.usedTimes === 0) {\r\n\r\n          deleteProgram = true;\r\n\r\n        }\r\n\r\n        break;\r\n\r\n      }\r\n\r\n    }\r\n\r\n    if (deleteProgram === true) {\r\n\r\n      // avoid using array.splice, this is costlier than creating new array from scratch\r\n\r\n      var newPrograms = [];\r\n\r\n      for (i = 0, il = _programs.length; i < il; i++) {\r\n\r\n        programInfo = _programs[i];\r\n\r\n        if (programInfo.program !== program) {\r\n\r\n          newPrograms.push(programInfo);\r\n\r\n        }\r\n\r\n      }\r\n\r\n      _programs = newPrograms;\r\n\r\n      _gl.deleteProgram(program);\r\n\r\n      _this.info.memory.programs--;\r\n\r\n    }\r\n\r\n  };\r\n\r\n  // Buffer initialization\r\n\r\n  function initCustomAttributes(object) {\r\n\r\n    var geometry = object.geometry;\r\n    var material = object.material;\r\n\r\n    var nvertices = geometry.vertices.length;\r\n\r\n    if (material.attributes) {\r\n\r\n      if (geometry.__webglCustomAttributesList === undefined) {\r\n\r\n        geometry.__webglCustomAttributesList = [];\r\n\r\n      }\r\n\r\n      for (var name in material.attributes) {\r\n\r\n        var attribute = material.attributes[name];\r\n\r\n        if (!attribute.__webglInitialized || attribute.createUniqueBuffers) {\r\n\r\n          attribute.__webglInitialized = true;\r\n\r\n          var size = 1; // \"f\" and \"i\"\r\n\r\n          if (attribute.type === 'v2') size = 2;\r\n          else if (attribute.type === 'v3') size = 3;\r\n          else if (attribute.type === 'v4') size = 4;\r\n          else if (attribute.type === 'c') size = 3;\r\n\r\n          attribute.size = size;\r\n\r\n          attribute.array = new Float32Array(nvertices * size);\r\n\r\n          attribute.buffer = _gl.createBuffer();\r\n          attribute.buffer.belongsToAttribute = name;\r\n\r\n          attribute.needsUpdate = true;\r\n\r\n        }\r\n\r\n        geometry.__webglCustomAttributesList.push(attribute);\r\n\r\n      }\r\n\r\n    }\r\n\r\n  };\r\n\r\n  function initParticleBuffers(geometry, object) {\r\n\r\n    var nvertices = geometry.vertices.length;\r\n\r\n    geometry.__vertexArray = new Float32Array(nvertices * 3);\r\n    geometry.__colorArray = new Float32Array(nvertices * 3);\r\n\r\n    geometry.__webglParticleCount = nvertices;\r\n\r\n    initCustomAttributes(object);\r\n\r\n  };\r\n\r\n  function initLineBuffers(geometry, object) {\r\n\r\n    var nvertices = geometry.vertices.length;\r\n\r\n    geometry.__vertexArray = new Float32Array(nvertices * 3);\r\n    geometry.__colorArray = new Float32Array(nvertices * 3);\r\n    geometry.__lineDistanceArray = new Float32Array(nvertices * 1);\r\n\r\n    geometry.__webglLineCount = nvertices;\r\n\r\n    initCustomAttributes(object);\r\n\r\n  };\r\n\r\n  function initMeshBuffers(geometryGroup, object) {\r\n\r\n    var geometry = object.geometry,\r\n      faces3 = geometryGroup.faces3,\r\n\r\n      nvertices = faces3.length * 3,\r\n      ntris = faces3.length * 1,\r\n      nlines = faces3.length * 3,\r\n\r\n      material = getBufferMaterial(object, geometryGroup);\r\n\r\n    geometryGroup.__vertexArray = new Float32Array(nvertices * 3);\r\n    geometryGroup.__normalArray = new Float32Array(nvertices * 3);\r\n    geometryGroup.__colorArray = new Float32Array(nvertices * 3);\r\n    geometryGroup.__uvArray = new Float32Array(nvertices * 2);\r\n\r\n    if (geometry.faceVertexUvs.length > 1) {\r\n\r\n      geometryGroup.__uv2Array = new Float32Array(nvertices * 2);\r\n\r\n    }\r\n\r\n    if (geometry.hasTangents) {\r\n\r\n      geometryGroup.__tangentArray = new Float32Array(nvertices * 4);\r\n\r\n    }\r\n\r\n    if (object.geometry.skinWeights.length && object.geometry.skinIndices.length) {\r\n\r\n      geometryGroup.__skinIndexArray = new Float32Array(nvertices * 4);\r\n      geometryGroup.__skinWeightArray = new Float32Array(nvertices * 4);\r\n\r\n    }\r\n\r\n    var UintArray = extensions.get('OES_element_index_uint') !== null && ntris > 21845 ? Uint32Array : Uint16Array; // 65535 / 3\r\n\r\n    geometryGroup.__typeArray = UintArray;\r\n    geometryGroup.__faceArray = new UintArray(ntris * 3);\r\n    geometryGroup.__lineArray = new UintArray(nlines * 2);\r\n\r\n    var numMorphTargets = geometryGroup.numMorphTargets;\r\n\r\n    if (numMorphTargets) {\r\n\r\n      geometryGroup.__morphTargetsArrays = [];\r\n\r\n      for (var m = 0, ml = numMorphTargets; m < ml; m++) {\r\n\r\n        geometryGroup.__morphTargetsArrays.push(new Float32Array(nvertices * 3));\r\n\r\n      }\r\n\r\n    }\r\n\r\n    var numMorphNormals = geometryGroup.numMorphNormals;\r\n\r\n    if (numMorphNormals) {\r\n\r\n      geometryGroup.__morphNormalsArrays = [];\r\n\r\n      for (var m = 0, ml = numMorphNormals; m < ml; m++) {\r\n\r\n        geometryGroup.__morphNormalsArrays.push(new Float32Array(nvertices * 3));\r\n\r\n      }\r\n\r\n    }\r\n\r\n    geometryGroup.__webglFaceCount = ntris * 3;\r\n    geometryGroup.__webglLineCount = nlines * 2;\r\n\r\n\r\n    // custom attributes\r\n\r\n    if (material.attributes) {\r\n\r\n      if (geometryGroup.__webglCustomAttributesList === undefined) {\r\n\r\n        geometryGroup.__webglCustomAttributesList = [];\r\n\r\n      }\r\n\r\n      for (var name in material.attributes) {\r\n\r\n        // Do a shallow copy of the attribute object so different geometryGroup chunks use different\r\n        // attribute buffers which are correctly indexed in the setMeshBuffers function\r\n\r\n        var originalAttribute = material.attributes[name];\r\n\r\n        var attribute = {};\r\n\r\n        for (var property in originalAttribute) {\r\n\r\n          attribute[property] = originalAttribute[property];\r\n\r\n        }\r\n\r\n        if (!attribute.__webglInitialized || attribute.createUniqueBuffers) {\r\n\r\n          attribute.__webglInitialized = true;\r\n\r\n          var size = 1; // \"f\" and \"i\"\r\n\r\n          if (attribute.type === 'v2') size = 2;\r\n          else if (attribute.type === 'v3') size = 3;\r\n          else if (attribute.type === 'v4') size = 4;\r\n          else if (attribute.type === 'c') size = 3;\r\n\r\n          attribute.size = size;\r\n\r\n          attribute.array = new Float32Array(nvertices * size);\r\n\r\n          attribute.buffer = _gl.createBuffer();\r\n          attribute.buffer.belongsToAttribute = name;\r\n\r\n          originalAttribute.needsUpdate = true;\r\n          attribute.__original = originalAttribute;\r\n\r\n        }\r\n\r\n        geometryGroup.__webglCustomAttributesList.push(attribute);\r\n\r\n      }\r\n\r\n    }\r\n\r\n    geometryGroup.__inittedArrays = true;\r\n\r\n  };\r\n\r\n  function getBufferMaterial(object, geometryGroup) {\r\n\r\n    return object.material instanceof THREE.MeshFaceMaterial ? object.material.materials[geometryGroup.materialIndex] : object.material;\r\n\r\n  }\r\n\r\n  function materialNeedsFaceNormals(material) {\r\n\r\n    return material instanceof THREE.MeshPhongMaterial === false && material.shading === THREE.FlatShading;\r\n\r\n  }\r\n\r\n  // Buffer setting\r\n\r\n  function setParticleBuffers(geometry, hint, object) {\r\n\r\n    var v, c, vertex, offset, color,\r\n\r\n      vertices = geometry.vertices,\r\n      vl = vertices.length,\r\n\r\n      colors = geometry.colors,\r\n      cl = colors.length,\r\n\r\n      vertexArray = geometry.__vertexArray,\r\n      colorArray = geometry.__colorArray,\r\n\r\n      dirtyVertices = geometry.verticesNeedUpdate,\r\n      dirtyColors = geometry.colorsNeedUpdate,\r\n\r\n      customAttributes = geometry.__webglCustomAttributesList,\r\n      i, il,\r\n      ca, cal, value,\r\n      customAttribute;\r\n\r\n    if (dirtyVertices) {\r\n\r\n      for (v = 0; v < vl; v++) {\r\n\r\n        vertex = vertices[v];\r\n\r\n        offset = v * 3;\r\n\r\n        vertexArray[offset] = vertex.x;\r\n        vertexArray[offset + 1] = vertex.y;\r\n        vertexArray[offset + 2] = vertex.z;\r\n\r\n      }\r\n\r\n      _gl.bindBuffer(_gl.ARRAY_BUFFER, geometry.__webglVertexBuffer);\r\n      _gl.bufferData(_gl.ARRAY_BUFFER, vertexArray, hint);\r\n\r\n    }\r\n\r\n    if (dirtyColors) {\r\n\r\n      for (c = 0; c < cl; c++) {\r\n\r\n        color = colors[c];\r\n\r\n        offset = c * 3;\r\n\r\n        colorArray[offset] = color.r;\r\n        colorArray[offset + 1] = color.g;\r\n        colorArray[offset + 2] = color.b;\r\n\r\n      }\r\n\r\n      _gl.bindBuffer(_gl.ARRAY_BUFFER, geometry.__webglColorBuffer);\r\n      _gl.bufferData(_gl.ARRAY_BUFFER, colorArray, hint);\r\n\r\n    }\r\n\r\n    if (customAttributes) {\r\n\r\n      for (i = 0, il = customAttributes.length; i < il; i++) {\r\n\r\n        customAttribute = customAttributes[i];\r\n\r\n        if (customAttribute.needsUpdate && (customAttribute.boundTo === undefined || customAttribute.boundTo === 'vertices')) {\r\n\r\n          cal = customAttribute.value.length;\r\n\r\n          offset = 0;\r\n\r\n          if (customAttribute.size === 1) {\r\n\r\n            for (ca = 0; ca < cal; ca++) {\r\n\r\n              customAttribute.array[ca] = customAttribute.value[ca];\r\n\r\n            }\r\n\r\n          }\r\n          else if (customAttribute.size === 2) {\r\n\r\n            for (ca = 0; ca < cal; ca++) {\r\n\r\n              value = customAttribute.value[ca];\r\n\r\n              customAttribute.array[offset] = value.x;\r\n              customAttribute.array[offset + 1] = value.y;\r\n\r\n              offset += 2;\r\n\r\n            }\r\n\r\n          }\r\n          else if (customAttribute.size === 3) {\r\n\r\n            if (customAttribute.type === 'c') {\r\n\r\n              for (ca = 0; ca < cal; ca++) {\r\n\r\n                value = customAttribute.value[ca];\r\n\r\n                customAttribute.array[offset] = value.r;\r\n                customAttribute.array[offset + 1] = value.g;\r\n                customAttribute.array[offset + 2] = value.b;\r\n\r\n                offset += 3;\r\n\r\n              }\r\n\r\n            }\r\n            else {\r\n\r\n              for (ca = 0; ca < cal; ca++) {\r\n\r\n                value = customAttribute.value[ca];\r\n\r\n                customAttribute.array[offset] = value.x;\r\n                customAttribute.array[offset + 1] = value.y;\r\n                customAttribute.array[offset + 2] = value.z;\r\n\r\n                offset += 3;\r\n\r\n              }\r\n\r\n            }\r\n\r\n          }\r\n          else if (customAttribute.size === 4) {\r\n\r\n            for (ca = 0; ca < cal; ca++) {\r\n\r\n              value = customAttribute.value[ca];\r\n\r\n              customAttribute.array[offset] = value.x;\r\n              customAttribute.array[offset + 1] = value.y;\r\n              customAttribute.array[offset + 2] = value.z;\r\n              customAttribute.array[offset + 3] = value.w;\r\n\r\n              offset += 4;\r\n\r\n            }\r\n\r\n          }\r\n\r\n        }\r\n\r\n        _gl.bindBuffer(_gl.ARRAY_BUFFER, customAttribute.buffer);\r\n        _gl.bufferData(_gl.ARRAY_BUFFER, customAttribute.array, hint);\r\n\r\n        customAttribute.needsUpdate = false;\r\n\r\n      }\r\n\r\n    }\r\n\r\n  }\r\n\r\n  function setLineBuffers(geometry, hint) {\r\n\r\n    var v, c, d, vertex, offset, color,\r\n\r\n      vertices = geometry.vertices,\r\n      colors = geometry.colors,\r\n      lineDistances = geometry.lineDistances,\r\n\r\n      vl = vertices.length,\r\n      cl = colors.length,\r\n      dl = lineDistances.length,\r\n\r\n      vertexArray = geometry.__vertexArray,\r\n      colorArray = geometry.__colorArray,\r\n      lineDistanceArray = geometry.__lineDistanceArray,\r\n\r\n      dirtyVertices = geometry.verticesNeedUpdate,\r\n      dirtyColors = geometry.colorsNeedUpdate,\r\n      dirtyLineDistances = geometry.lineDistancesNeedUpdate,\r\n\r\n      customAttributes = geometry.__webglCustomAttributesList,\r\n\r\n      i, il,\r\n      ca, cal, value,\r\n      customAttribute;\r\n\r\n    if (dirtyVertices) {\r\n\r\n      for (v = 0; v < vl; v++) {\r\n\r\n        vertex = vertices[v];\r\n\r\n        offset = v * 3;\r\n\r\n        vertexArray[offset] = vertex.x;\r\n        vertexArray[offset + 1] = vertex.y;\r\n        vertexArray[offset + 2] = vertex.z;\r\n\r\n      }\r\n\r\n      _gl.bindBuffer(_gl.ARRAY_BUFFER, geometry.__webglVertexBuffer);\r\n      _gl.bufferData(_gl.ARRAY_BUFFER, vertexArray, hint);\r\n\r\n    }\r\n\r\n    if (dirtyColors) {\r\n\r\n      for (c = 0; c < cl; c++) {\r\n\r\n        color = colors[c];\r\n\r\n        offset = c * 3;\r\n\r\n        colorArray[offset] = color.r;\r\n        colorArray[offset + 1] = color.g;\r\n        colorArray[offset + 2] = color.b;\r\n\r\n      }\r\n\r\n      _gl.bindBuffer(_gl.ARRAY_BUFFER, geometry.__webglColorBuffer);\r\n      _gl.bufferData(_gl.ARRAY_BUFFER, colorArray, hint);\r\n\r\n    }\r\n\r\n    if (dirtyLineDistances) {\r\n\r\n      for (d = 0; d < dl; d++) {\r\n\r\n        lineDistanceArray[d] = lineDistances[d];\r\n\r\n      }\r\n\r\n      _gl.bindBuffer(_gl.ARRAY_BUFFER, geometry.__webglLineDistanceBuffer);\r\n      _gl.bufferData(_gl.ARRAY_BUFFER, lineDistanceArray, hint);\r\n\r\n    }\r\n\r\n    if (customAttributes) {\r\n\r\n      for (i = 0, il = customAttributes.length; i < il; i++) {\r\n\r\n        customAttribute = customAttributes[i];\r\n\r\n        if (customAttribute.needsUpdate && (customAttribute.boundTo === undefined || customAttribute.boundTo === 'vertices')) {\r\n\r\n          offset = 0;\r\n\r\n          cal = customAttribute.value.length;\r\n\r\n          if (customAttribute.size === 1) {\r\n\r\n            for (ca = 0; ca < cal; ca++) {\r\n\r\n              customAttribute.array[ca] = customAttribute.value[ca];\r\n\r\n            }\r\n\r\n          }\r\n          else if (customAttribute.size === 2) {\r\n\r\n            for (ca = 0; ca < cal; ca++) {\r\n\r\n              value = customAttribute.value[ca];\r\n\r\n              customAttribute.array[offset] = value.x;\r\n              customAttribute.array[offset + 1] = value.y;\r\n\r\n              offset += 2;\r\n\r\n            }\r\n\r\n          }\r\n          else if (customAttribute.size === 3) {\r\n\r\n            if (customAttribute.type === 'c') {\r\n\r\n              for (ca = 0; ca < cal; ca++) {\r\n\r\n                value = customAttribute.value[ca];\r\n\r\n                customAttribute.array[offset] = value.r;\r\n                customAttribute.array[offset + 1] = value.g;\r\n                customAttribute.array[offset + 2] = value.b;\r\n\r\n                offset += 3;\r\n\r\n              }\r\n\r\n            }\r\n            else {\r\n\r\n              for (ca = 0; ca < cal; ca++) {\r\n\r\n                value = customAttribute.value[ca];\r\n\r\n                customAttribute.array[offset] = value.x;\r\n                customAttribute.array[offset + 1] = value.y;\r\n                customAttribute.array[offset + 2] = value.z;\r\n\r\n                offset += 3;\r\n\r\n              }\r\n\r\n            }\r\n\r\n          }\r\n          else if (customAttribute.size === 4) {\r\n\r\n            for (ca = 0; ca < cal; ca++) {\r\n\r\n              value = customAttribute.value[ca];\r\n\r\n              customAttribute.array[offset] = value.x;\r\n              customAttribute.array[offset + 1] = value.y;\r\n              customAttribute.array[offset + 2] = value.z;\r\n              customAttribute.array[offset + 3] = value.w;\r\n\r\n              offset += 4;\r\n\r\n            }\r\n\r\n          }\r\n\r\n          _gl.bindBuffer(_gl.ARRAY_BUFFER, customAttribute.buffer);\r\n          _gl.bufferData(_gl.ARRAY_BUFFER, customAttribute.array, hint);\r\n\r\n          customAttribute.needsUpdate = false;\r\n\r\n        }\r\n\r\n      }\r\n\r\n    }\r\n\r\n  }\r\n\r\n  function setMeshBuffers(geometryGroup, object, hint, dispose, material) {\r\n\r\n    if (!geometryGroup.__inittedArrays) {\r\n\r\n      return;\r\n\r\n    }\r\n\r\n    var needsFaceNormals = materialNeedsFaceNormals(material);\r\n\r\n    var f, fl, fi, face,\r\n      vertexNormals, faceNormal,\r\n      vertexColors, faceColor,\r\n      vertexTangents,\r\n      uv, uv2, v1, v2, v3, t1, t2, t3, n1, n2, n3,\r\n      c1, c2, c3,\r\n      sw1, sw2, sw3,\r\n      si1, si2, si3,\r\n      i, il,\r\n      vn, uvi, uv2i,\r\n      vk, vkl, vka,\r\n      nka, chf, faceVertexNormals,\r\n\r\n      vertexIndex = 0,\r\n\r\n      offset = 0,\r\n      offset_uv = 0,\r\n      offset_uv2 = 0,\r\n      offset_face = 0,\r\n      offset_normal = 0,\r\n      offset_tangent = 0,\r\n      offset_line = 0,\r\n      offset_color = 0,\r\n      offset_skin = 0,\r\n      offset_morphTarget = 0,\r\n      offset_custom = 0,\r\n\r\n      value,\r\n\r\n      vertexArray = geometryGroup.__vertexArray,\r\n      uvArray = geometryGroup.__uvArray,\r\n      uv2Array = geometryGroup.__uv2Array,\r\n      normalArray = geometryGroup.__normalArray,\r\n      tangentArray = geometryGroup.__tangentArray,\r\n      colorArray = geometryGroup.__colorArray,\r\n\r\n      skinIndexArray = geometryGroup.__skinIndexArray,\r\n      skinWeightArray = geometryGroup.__skinWeightArray,\r\n\r\n      morphTargetsArrays = geometryGroup.__morphTargetsArrays,\r\n      morphNormalsArrays = geometryGroup.__morphNormalsArrays,\r\n\r\n      customAttributes = geometryGroup.__webglCustomAttributesList,\r\n      customAttribute,\r\n\r\n      faceArray = geometryGroup.__faceArray,\r\n      lineArray = geometryGroup.__lineArray,\r\n\r\n      geometry = object.geometry, // this is shared for all chunks\r\n\r\n      dirtyVertices = geometry.verticesNeedUpdate,\r\n      dirtyElements = geometry.elementsNeedUpdate,\r\n      dirtyUvs = geometry.uvsNeedUpdate,\r\n      dirtyNormals = geometry.normalsNeedUpdate,\r\n      dirtyTangents = geometry.tangentsNeedUpdate,\r\n      dirtyColors = geometry.colorsNeedUpdate,\r\n      dirtyMorphTargets = geometry.morphTargetsNeedUpdate,\r\n\r\n      vertices = geometry.vertices,\r\n      chunk_faces3 = geometryGroup.faces3,\r\n      obj_faces = geometry.faces,\r\n\r\n      obj_uvs = geometry.faceVertexUvs[0],\r\n      obj_uvs2 = geometry.faceVertexUvs[1],\r\n\r\n      obj_skinIndices = geometry.skinIndices,\r\n      obj_skinWeights = geometry.skinWeights,\r\n\r\n      morphTargets = geometry.morphTargets,\r\n      morphNormals = geometry.morphNormals;\r\n\r\n    if (dirtyVertices) {\r\n\r\n      for (f = 0, fl = chunk_faces3.length; f < fl; f++) {\r\n\r\n        face = obj_faces[chunk_faces3[f]];\r\n\r\n        v1 = vertices[face.a];\r\n        v2 = vertices[face.b];\r\n        v3 = vertices[face.c];\r\n\r\n        vertexArray[offset] = v1.x;\r\n        vertexArray[offset + 1] = v1.y;\r\n        vertexArray[offset + 2] = v1.z;\r\n\r\n        vertexArray[offset + 3] = v2.x;\r\n        vertexArray[offset + 4] = v2.y;\r\n        vertexArray[offset + 5] = v2.z;\r\n\r\n        vertexArray[offset + 6] = v3.x;\r\n        vertexArray[offset + 7] = v3.y;\r\n        vertexArray[offset + 8] = v3.z;\r\n\r\n        offset += 9;\r\n\r\n      }\r\n\r\n      _gl.bindBuffer(_gl.ARRAY_BUFFER, geometryGroup.__webglVertexBuffer);\r\n      _gl.bufferData(_gl.ARRAY_BUFFER, vertexArray, hint);\r\n\r\n    }\r\n\r\n    if (dirtyMorphTargets) {\r\n\r\n      for (vk = 0, vkl = morphTargets.length; vk < vkl; vk++) {\r\n\r\n        offset_morphTarget = 0;\r\n\r\n        for (f = 0, fl = chunk_faces3.length; f < fl; f++) {\r\n\r\n          chf = chunk_faces3[f];\r\n          face = obj_faces[chf];\r\n\r\n          // morph positions\r\n\r\n          v1 = morphTargets[vk].vertices[face.a];\r\n          v2 = morphTargets[vk].vertices[face.b];\r\n          v3 = morphTargets[vk].vertices[face.c];\r\n\r\n          vka = morphTargetsArrays[vk];\r\n\r\n          vka[offset_morphTarget] = v1.x;\r\n          vka[offset_morphTarget + 1] = v1.y;\r\n          vka[offset_morphTarget + 2] = v1.z;\r\n\r\n          vka[offset_morphTarget + 3] = v2.x;\r\n          vka[offset_morphTarget + 4] = v2.y;\r\n          vka[offset_morphTarget + 5] = v2.z;\r\n\r\n          vka[offset_morphTarget + 6] = v3.x;\r\n          vka[offset_morphTarget + 7] = v3.y;\r\n          vka[offset_morphTarget + 8] = v3.z;\r\n\r\n          // morph normals\r\n\r\n          if (material.morphNormals) {\r\n\r\n            if (needsFaceNormals) {\r\n\r\n              n1 = morphNormals[vk].faceNormals[chf];\r\n              n2 = n1;\r\n              n3 = n1;\r\n\r\n            }\r\n            else {\r\n\r\n              faceVertexNormals = morphNormals[vk].vertexNormals[chf];\r\n\r\n              n1 = faceVertexNormals.a;\r\n              n2 = faceVertexNormals.b;\r\n              n3 = faceVertexNormals.c;\r\n\r\n            }\r\n\r\n            nka = morphNormalsArrays[vk];\r\n\r\n            nka[offset_morphTarget] = n1.x;\r\n            nka[offset_morphTarget + 1] = n1.y;\r\n            nka[offset_morphTarget + 2] = n1.z;\r\n\r\n            nka[offset_morphTarget + 3] = n2.x;\r\n            nka[offset_morphTarget + 4] = n2.y;\r\n            nka[offset_morphTarget + 5] = n2.z;\r\n\r\n            nka[offset_morphTarget + 6] = n3.x;\r\n            nka[offset_morphTarget + 7] = n3.y;\r\n            nka[offset_morphTarget + 8] = n3.z;\r\n\r\n          }\r\n\r\n          //\r\n\r\n          offset_morphTarget += 9;\r\n\r\n        }\r\n\r\n        _gl.bindBuffer(_gl.ARRAY_BUFFER, geometryGroup.__webglMorphTargetsBuffers[vk]);\r\n        _gl.bufferData(_gl.ARRAY_BUFFER, morphTargetsArrays[vk], hint);\r\n\r\n        if (material.morphNormals) {\r\n\r\n          _gl.bindBuffer(_gl.ARRAY_BUFFER, geometryGroup.__webglMorphNormalsBuffers[vk]);\r\n          _gl.bufferData(_gl.ARRAY_BUFFER, morphNormalsArrays[vk], hint);\r\n\r\n        }\r\n\r\n      }\r\n\r\n    }\r\n\r\n    if (obj_skinWeights.length) {\r\n\r\n      for (f = 0, fl = chunk_faces3.length; f < fl; f++) {\r\n\r\n        face = obj_faces[chunk_faces3[f]];\r\n\r\n        // weights\r\n\r\n        sw1 = obj_skinWeights[face.a];\r\n        sw2 = obj_skinWeights[face.b];\r\n        sw3 = obj_skinWeights[face.c];\r\n\r\n        skinWeightArray[offset_skin] = sw1.x;\r\n        skinWeightArray[offset_skin + 1] = sw1.y;\r\n        skinWeightArray[offset_skin + 2] = sw1.z;\r\n        skinWeightArray[offset_skin + 3] = sw1.w;\r\n\r\n        skinWeightArray[offset_skin + 4] = sw2.x;\r\n        skinWeightArray[offset_skin + 5] = sw2.y;\r\n        skinWeightArray[offset_skin + 6] = sw2.z;\r\n        skinWeightArray[offset_skin + 7] = sw2.w;\r\n\r\n        skinWeightArray[offset_skin + 8] = sw3.x;\r\n        skinWeightArray[offset_skin + 9] = sw3.y;\r\n        skinWeightArray[offset_skin + 10] = sw3.z;\r\n        skinWeightArray[offset_skin + 11] = sw3.w;\r\n\r\n        // indices\r\n\r\n        si1 = obj_skinIndices[face.a];\r\n        si2 = obj_skinIndices[face.b];\r\n        si3 = obj_skinIndices[face.c];\r\n\r\n        skinIndexArray[offset_skin] = si1.x;\r\n        skinIndexArray[offset_skin + 1] = si1.y;\r\n        skinIndexArray[offset_skin + 2] = si1.z;\r\n        skinIndexArray[offset_skin + 3] = si1.w;\r\n\r\n        skinIndexArray[offset_skin + 4] = si2.x;\r\n        skinIndexArray[offset_skin + 5] = si2.y;\r\n        skinIndexArray[offset_skin + 6] = si2.z;\r\n        skinIndexArray[offset_skin + 7] = si2.w;\r\n\r\n        skinIndexArray[offset_skin + 8] = si3.x;\r\n        skinIndexArray[offset_skin + 9] = si3.y;\r\n        skinIndexArray[offset_skin + 10] = si3.z;\r\n        skinIndexArray[offset_skin + 11] = si3.w;\r\n\r\n        offset_skin += 12;\r\n\r\n      }\r\n\r\n      if (offset_skin > 0) {\r\n\r\n        _gl.bindBuffer(_gl.ARRAY_BUFFER, geometryGroup.__webglSkinIndicesBuffer);\r\n        _gl.bufferData(_gl.ARRAY_BUFFER, skinIndexArray, hint);\r\n\r\n        _gl.bindBuffer(_gl.ARRAY_BUFFER, geometryGroup.__webglSkinWeightsBuffer);\r\n        _gl.bufferData(_gl.ARRAY_BUFFER, skinWeightArray, hint);\r\n\r\n      }\r\n\r\n    }\r\n\r\n    if (dirtyColors) {\r\n\r\n      for (f = 0, fl = chunk_faces3.length; f < fl; f++) {\r\n\r\n        face = obj_faces[chunk_faces3[f]];\r\n\r\n        vertexColors = face.vertexColors;\r\n        faceColor = face.color;\r\n\r\n        if (vertexColors.length === 3 && material.vertexColors === THREE.VertexColors) {\r\n\r\n          c1 = vertexColors[0];\r\n          c2 = vertexColors[1];\r\n          c3 = vertexColors[2];\r\n\r\n        }\r\n        else {\r\n\r\n          c1 = faceColor;\r\n          c2 = faceColor;\r\n          c3 = faceColor;\r\n\r\n        }\r\n\r\n        colorArray[offset_color] = c1.r;\r\n        colorArray[offset_color + 1] = c1.g;\r\n        colorArray[offset_color + 2] = c1.b;\r\n\r\n        colorArray[offset_color + 3] = c2.r;\r\n        colorArray[offset_color + 4] = c2.g;\r\n        colorArray[offset_color + 5] = c2.b;\r\n\r\n        colorArray[offset_color + 6] = c3.r;\r\n        colorArray[offset_color + 7] = c3.g;\r\n        colorArray[offset_color + 8] = c3.b;\r\n\r\n        offset_color += 9;\r\n\r\n      }\r\n\r\n      if (offset_color > 0) {\r\n\r\n        _gl.bindBuffer(_gl.ARRAY_BUFFER, geometryGroup.__webglColorBuffer);\r\n        _gl.bufferData(_gl.ARRAY_BUFFER, colorArray, hint);\r\n\r\n      }\r\n\r\n    }\r\n\r\n    if (dirtyTangents && geometry.hasTangents) {\r\n\r\n      for (f = 0, fl = chunk_faces3.length; f < fl; f++) {\r\n\r\n        face = obj_faces[chunk_faces3[f]];\r\n\r\n        vertexTangents = face.vertexTangents;\r\n\r\n        t1 = vertexTangents[0];\r\n        t2 = vertexTangents[1];\r\n        t3 = vertexTangents[2];\r\n\r\n        tangentArray[offset_tangent] = t1.x;\r\n        tangentArray[offset_tangent + 1] = t1.y;\r\n        tangentArray[offset_tangent + 2] = t1.z;\r\n        tangentArray[offset_tangent + 3] = t1.w;\r\n\r\n        tangentArray[offset_tangent + 4] = t2.x;\r\n        tangentArray[offset_tangent + 5] = t2.y;\r\n        tangentArray[offset_tangent + 6] = t2.z;\r\n        tangentArray[offset_tangent + 7] = t2.w;\r\n\r\n        tangentArray[offset_tangent + 8] = t3.x;\r\n        tangentArray[offset_tangent + 9] = t3.y;\r\n        tangentArray[offset_tangent + 10] = t3.z;\r\n        tangentArray[offset_tangent + 11] = t3.w;\r\n\r\n        offset_tangent += 12;\r\n\r\n      }\r\n\r\n      _gl.bindBuffer(_gl.ARRAY_BUFFER, geometryGroup.__webglTangentBuffer);\r\n      _gl.bufferData(_gl.ARRAY_BUFFER, tangentArray, hint);\r\n\r\n    }\r\n\r\n    if (dirtyNormals) {\r\n\r\n      for (f = 0, fl = chunk_faces3.length; f < fl; f++) {\r\n\r\n        face = obj_faces[chunk_faces3[f]];\r\n\r\n        vertexNormals = face.vertexNormals;\r\n        faceNormal = face.normal;\r\n\r\n        if (vertexNormals.length === 3 && needsFaceNormals === false) {\r\n\r\n          for (i = 0; i < 3; i++) {\r\n\r\n            vn = vertexNormals[i];\r\n\r\n            normalArray[offset_normal] = vn.x;\r\n            normalArray[offset_normal + 1] = vn.y;\r\n            normalArray[offset_normal + 2] = vn.z;\r\n\r\n            offset_normal += 3;\r\n\r\n          }\r\n\r\n        }\r\n        else {\r\n\r\n          for (i = 0; i < 3; i++) {\r\n\r\n            normalArray[offset_normal] = faceNormal.x;\r\n            normalArray[offset_normal + 1] = faceNormal.y;\r\n            normalArray[offset_normal + 2] = faceNormal.z;\r\n\r\n            offset_normal += 3;\r\n\r\n          }\r\n\r\n        }\r\n\r\n      }\r\n\r\n      _gl.bindBuffer(_gl.ARRAY_BUFFER, geometryGroup.__webglNormalBuffer);\r\n      _gl.bufferData(_gl.ARRAY_BUFFER, normalArray, hint);\r\n\r\n    }\r\n\r\n    if (dirtyUvs && obj_uvs) {\r\n\r\n      for (f = 0, fl = chunk_faces3.length; f < fl; f++) {\r\n\r\n        fi = chunk_faces3[f];\r\n\r\n        uv = obj_uvs[fi];\r\n\r\n        if (uv === undefined) continue;\r\n\r\n        for (i = 0; i < 3; i++) {\r\n\r\n          uvi = uv[i];\r\n\r\n          uvArray[offset_uv] = uvi.x;\r\n          uvArray[offset_uv + 1] = uvi.y;\r\n\r\n          offset_uv += 2;\r\n\r\n        }\r\n\r\n      }\r\n\r\n      if (offset_uv > 0) {\r\n\r\n        _gl.bindBuffer(_gl.ARRAY_BUFFER, geometryGroup.__webglUVBuffer);\r\n        _gl.bufferData(_gl.ARRAY_BUFFER, uvArray, hint);\r\n\r\n      }\r\n\r\n    }\r\n\r\n    if (dirtyUvs && obj_uvs2) {\r\n\r\n      for (f = 0, fl = chunk_faces3.length; f < fl; f++) {\r\n\r\n        fi = chunk_faces3[f];\r\n\r\n        uv2 = obj_uvs2[fi];\r\n\r\n        if (uv2 === undefined) continue;\r\n\r\n        for (i = 0; i < 3; i++) {\r\n\r\n          uv2i = uv2[i];\r\n\r\n          uv2Array[offset_uv2] = uv2i.x;\r\n          uv2Array[offset_uv2 + 1] = uv2i.y;\r\n\r\n          offset_uv2 += 2;\r\n\r\n        }\r\n\r\n      }\r\n\r\n      if (offset_uv2 > 0) {\r\n\r\n        _gl.bindBuffer(_gl.ARRAY_BUFFER, geometryGroup.__webglUV2Buffer);\r\n        _gl.bufferData(_gl.ARRAY_BUFFER, uv2Array, hint);\r\n\r\n      }\r\n\r\n    }\r\n\r\n    if (dirtyElements) {\r\n\r\n      for (f = 0, fl = chunk_faces3.length; f < fl; f++) {\r\n\r\n        faceArray[offset_face] = vertexIndex;\r\n        faceArray[offset_face + 1] = vertexIndex + 1;\r\n        faceArray[offset_face + 2] = vertexIndex + 2;\r\n\r\n        offset_face += 3;\r\n\r\n        lineArray[offset_line] = vertexIndex;\r\n        lineArray[offset_line + 1] = vertexIndex + 1;\r\n\r\n        lineArray[offset_line + 2] = vertexIndex;\r\n        lineArray[offset_line + 3] = vertexIndex + 2;\r\n\r\n        lineArray[offset_line + 4] = vertexIndex + 1;\r\n        lineArray[offset_line + 5] = vertexIndex + 2;\r\n\r\n        offset_line += 6;\r\n\r\n        vertexIndex += 3;\r\n\r\n      }\r\n\r\n      _gl.bindBuffer(_gl.ELEMENT_ARRAY_BUFFER, geometryGroup.__webglFaceBuffer);\r\n      _gl.bufferData(_gl.ELEMENT_ARRAY_BUFFER, faceArray, hint);\r\n\r\n      _gl.bindBuffer(_gl.ELEMENT_ARRAY_BUFFER, geometryGroup.__webglLineBuffer);\r\n      _gl.bufferData(_gl.ELEMENT_ARRAY_BUFFER, lineArray, hint);\r\n\r\n    }\r\n\r\n    if (customAttributes) {\r\n\r\n      for (i = 0, il = customAttributes.length; i < il; i++) {\r\n\r\n        customAttribute = customAttributes[i];\r\n\r\n        if (!customAttribute.__original.needsUpdate) continue;\r\n\r\n        offset_custom = 0;\r\n\r\n        if (customAttribute.size === 1) {\r\n\r\n          if (customAttribute.boundTo === undefined || customAttribute.boundTo === 'vertices') {\r\n\r\n            for (f = 0, fl = chunk_faces3.length; f < fl; f++) {\r\n\r\n              face = obj_faces[chunk_faces3[f]];\r\n\r\n              customAttribute.array[offset_custom] = customAttribute.value[face.a];\r\n              customAttribute.array[offset_custom + 1] = customAttribute.value[face.b];\r\n              customAttribute.array[offset_custom + 2] = customAttribute.value[face.c];\r\n\r\n              offset_custom += 3;\r\n\r\n            }\r\n\r\n          }\r\n          else if (customAttribute.boundTo === 'faces') {\r\n\r\n            for (f = 0, fl = chunk_faces3.length; f < fl; f++) {\r\n\r\n              value = customAttribute.value[chunk_faces3[f]];\r\n\r\n              customAttribute.array[offset_custom] = value;\r\n              customAttribute.array[offset_custom + 1] = value;\r\n              customAttribute.array[offset_custom + 2] = value;\r\n\r\n              offset_custom += 3;\r\n\r\n            }\r\n\r\n          }\r\n\r\n        }\r\n        else if (customAttribute.size === 2) {\r\n\r\n          if (customAttribute.boundTo === undefined || customAttribute.boundTo === 'vertices') {\r\n\r\n            for (f = 0, fl = chunk_faces3.length; f < fl; f++) {\r\n\r\n              face = obj_faces[chunk_faces3[f]];\r\n\r\n              v1 = customAttribute.value[face.a];\r\n              v2 = customAttribute.value[face.b];\r\n              v3 = customAttribute.value[face.c];\r\n\r\n              customAttribute.array[offset_custom] = v1.x;\r\n              customAttribute.array[offset_custom + 1] = v1.y;\r\n\r\n              customAttribute.array[offset_custom + 2] = v2.x;\r\n              customAttribute.array[offset_custom + 3] = v2.y;\r\n\r\n              customAttribute.array[offset_custom + 4] = v3.x;\r\n              customAttribute.array[offset_custom + 5] = v3.y;\r\n\r\n              offset_custom += 6;\r\n\r\n            }\r\n\r\n          }\r\n          else if (customAttribute.boundTo === 'faces') {\r\n\r\n            for (f = 0, fl = chunk_faces3.length; f < fl; f++) {\r\n\r\n              value = customAttribute.value[chunk_faces3[f]];\r\n\r\n              v1 = value;\r\n              v2 = value;\r\n              v3 = value;\r\n\r\n              customAttribute.array[offset_custom] = v1.x;\r\n              customAttribute.array[offset_custom + 1] = v1.y;\r\n\r\n              customAttribute.array[offset_custom + 2] = v2.x;\r\n              customAttribute.array[offset_custom + 3] = v2.y;\r\n\r\n              customAttribute.array[offset_custom + 4] = v3.x;\r\n              customAttribute.array[offset_custom + 5] = v3.y;\r\n\r\n              offset_custom += 6;\r\n\r\n            }\r\n\r\n          }\r\n\r\n        }\r\n        else if (customAttribute.size === 3) {\r\n\r\n          var pp;\r\n\r\n          if (customAttribute.type === 'c') {\r\n\r\n            pp = ['r', 'g', 'b'];\r\n\r\n          }\r\n          else {\r\n\r\n            pp = ['x', 'y', 'z'];\r\n\r\n          }\r\n\r\n          if (customAttribute.boundTo === undefined || customAttribute.boundTo === 'vertices') {\r\n\r\n            for (f = 0, fl = chunk_faces3.length; f < fl; f++) {\r\n\r\n              face = obj_faces[chunk_faces3[f]];\r\n\r\n              v1 = customAttribute.value[face.a];\r\n              v2 = customAttribute.value[face.b];\r\n              v3 = customAttribute.value[face.c];\r\n\r\n              customAttribute.array[offset_custom] = v1[pp[0]];\r\n              customAttribute.array[offset_custom + 1] = v1[pp[1]];\r\n              customAttribute.array[offset_custom + 2] = v1[pp[2]];\r\n\r\n              customAttribute.array[offset_custom + 3] = v2[pp[0]];\r\n              customAttribute.array[offset_custom + 4] = v2[pp[1]];\r\n              customAttribute.array[offset_custom + 5] = v2[pp[2]];\r\n\r\n              customAttribute.array[offset_custom + 6] = v3[pp[0]];\r\n              customAttribute.array[offset_custom + 7] = v3[pp[1]];\r\n              customAttribute.array[offset_custom + 8] = v3[pp[2]];\r\n\r\n              offset_custom += 9;\r\n\r\n            }\r\n\r\n          }\r\n          else if (customAttribute.boundTo === 'faces') {\r\n\r\n            for (f = 0, fl = chunk_faces3.length; f < fl; f++) {\r\n\r\n              value = customAttribute.value[chunk_faces3[f]];\r\n\r\n              v1 = value;\r\n              v2 = value;\r\n              v3 = value;\r\n\r\n              customAttribute.array[offset_custom] = v1[pp[0]];\r\n              customAttribute.array[offset_custom + 1] = v1[pp[1]];\r\n              customAttribute.array[offset_custom + 2] = v1[pp[2]];\r\n\r\n              customAttribute.array[offset_custom + 3] = v2[pp[0]];\r\n              customAttribute.array[offset_custom + 4] = v2[pp[1]];\r\n              customAttribute.array[offset_custom + 5] = v2[pp[2]];\r\n\r\n              customAttribute.array[offset_custom + 6] = v3[pp[0]];\r\n              customAttribute.array[offset_custom + 7] = v3[pp[1]];\r\n              customAttribute.array[offset_custom + 8] = v3[pp[2]];\r\n\r\n              offset_custom += 9;\r\n\r\n            }\r\n\r\n          }\r\n          else if (customAttribute.boundTo === 'faceVertices') {\r\n\r\n            for (f = 0, fl = chunk_faces3.length; f < fl; f++) {\r\n\r\n              value = customAttribute.value[chunk_faces3[f]];\r\n\r\n              v1 = value[0];\r\n              v2 = value[1];\r\n              v3 = value[2];\r\n\r\n              customAttribute.array[offset_custom] = v1[pp[0]];\r\n              customAttribute.array[offset_custom + 1] = v1[pp[1]];\r\n              customAttribute.array[offset_custom + 2] = v1[pp[2]];\r\n\r\n              customAttribute.array[offset_custom + 3] = v2[pp[0]];\r\n              customAttribute.array[offset_custom + 4] = v2[pp[1]];\r\n              customAttribute.array[offset_custom + 5] = v2[pp[2]];\r\n\r\n              customAttribute.array[offset_custom + 6] = v3[pp[0]];\r\n              customAttribute.array[offset_custom + 7] = v3[pp[1]];\r\n              customAttribute.array[offset_custom + 8] = v3[pp[2]];\r\n\r\n              offset_custom += 9;\r\n\r\n            }\r\n\r\n          }\r\n\r\n        }\r\n        else if (customAttribute.size === 4) {\r\n\r\n          if (customAttribute.boundTo === undefined || customAttribute.boundTo === 'vertices') {\r\n\r\n            for (f = 0, fl = chunk_faces3.length; f < fl; f++) {\r\n\r\n              face = obj_faces[chunk_faces3[f]];\r\n\r\n              v1 = customAttribute.value[face.a];\r\n              v2 = customAttribute.value[face.b];\r\n              v3 = customAttribute.value[face.c];\r\n\r\n              customAttribute.array[offset_custom] = v1.x;\r\n              customAttribute.array[offset_custom + 1] = v1.y;\r\n              customAttribute.array[offset_custom + 2] = v1.z;\r\n              customAttribute.array[offset_custom + 3] = v1.w;\r\n\r\n              customAttribute.array[offset_custom + 4] = v2.x;\r\n              customAttribute.array[offset_custom + 5] = v2.y;\r\n              customAttribute.array[offset_custom + 6] = v2.z;\r\n              customAttribute.array[offset_custom + 7] = v2.w;\r\n\r\n              customAttribute.array[offset_custom + 8] = v3.x;\r\n              customAttribute.array[offset_custom + 9] = v3.y;\r\n              customAttribute.array[offset_custom + 10] = v3.z;\r\n              customAttribute.array[offset_custom + 11] = v3.w;\r\n\r\n              offset_custom += 12;\r\n\r\n            }\r\n\r\n          }\r\n          else if (customAttribute.boundTo === 'faces') {\r\n\r\n            for (f = 0, fl = chunk_faces3.length; f < fl; f++) {\r\n\r\n              value = customAttribute.value[chunk_faces3[f]];\r\n\r\n              v1 = value;\r\n              v2 = value;\r\n              v3 = value;\r\n\r\n              customAttribute.array[offset_custom] = v1.x;\r\n              customAttribute.array[offset_custom + 1] = v1.y;\r\n              customAttribute.array[offset_custom + 2] = v1.z;\r\n              customAttribute.array[offset_custom + 3] = v1.w;\r\n\r\n              customAttribute.array[offset_custom + 4] = v2.x;\r\n              customAttribute.array[offset_custom + 5] = v2.y;\r\n              customAttribute.array[offset_custom + 6] = v2.z;\r\n              customAttribute.array[offset_custom + 7] = v2.w;\r\n\r\n              customAttribute.array[offset_custom + 8] = v3.x;\r\n              customAttribute.array[offset_custom + 9] = v3.y;\r\n              customAttribute.array[offset_custom + 10] = v3.z;\r\n              customAttribute.array[offset_custom + 11] = v3.w;\r\n\r\n              offset_custom += 12;\r\n\r\n            }\r\n\r\n          }\r\n          else if (customAttribute.boundTo === 'faceVertices') {\r\n\r\n            for (f = 0, fl = chunk_faces3.length; f < fl; f++) {\r\n\r\n              value = customAttribute.value[chunk_faces3[f]];\r\n\r\n              v1 = value[0];\r\n              v2 = value[1];\r\n              v3 = value[2];\r\n\r\n              customAttribute.array[offset_custom] = v1.x;\r\n              customAttribute.array[offset_custom + 1] = v1.y;\r\n              customAttribute.array[offset_custom + 2] = v1.z;\r\n              customAttribute.array[offset_custom + 3] = v1.w;\r\n\r\n              customAttribute.array[offset_custom + 4] = v2.x;\r\n              customAttribute.array[offset_custom + 5] = v2.y;\r\n              customAttribute.array[offset_custom + 6] = v2.z;\r\n              customAttribute.array[offset_custom + 7] = v2.w;\r\n\r\n              customAttribute.array[offset_custom + 8] = v3.x;\r\n              customAttribute.array[offset_custom + 9] = v3.y;\r\n              customAttribute.array[offset_custom + 10] = v3.z;\r\n              customAttribute.array[offset_custom + 11] = v3.w;\r\n\r\n              offset_custom += 12;\r\n\r\n            }\r\n\r\n          }\r\n\r\n        }\r\n\r\n        _gl.bindBuffer(_gl.ARRAY_BUFFER, customAttribute.buffer);\r\n        _gl.bufferData(_gl.ARRAY_BUFFER, customAttribute.array, hint);\r\n\r\n      }\r\n\r\n    }\r\n\r\n    if (dispose) {\r\n\r\n      delete geometryGroup.__inittedArrays;\r\n      delete geometryGroup.__colorArray;\r\n      delete geometryGroup.__normalArray;\r\n      delete geometryGroup.__tangentArray;\r\n      delete geometryGroup.__uvArray;\r\n      delete geometryGroup.__uv2Array;\r\n      delete geometryGroup.__faceArray;\r\n      delete geometryGroup.__vertexArray;\r\n      delete geometryGroup.__lineArray;\r\n      delete geometryGroup.__skinIndexArray;\r\n      delete geometryGroup.__skinWeightArray;\r\n\r\n    }\r\n\r\n  };\r\n\r\n  // Buffer rendering\r\n\r\n  this.renderBufferImmediate = function(object, program, material) {\r\n\r\n    state.initAttributes();\r\n\r\n    if (object.hasPositions && !object.__webglVertexBuffer) object.__webglVertexBuffer = _gl.createBuffer();\r\n    if (object.hasNormals && !object.__webglNormalBuffer) object.__webglNormalBuffer = _gl.createBuffer();\r\n    if (object.hasUvs && !object.__webglUvBuffer) object.__webglUvBuffer = _gl.createBuffer();\r\n    if (object.hasColors && !object.__webglColorBuffer) object.__webglColorBuffer = _gl.createBuffer();\r\n\r\n    if (object.hasPositions) {\r\n\r\n      _gl.bindBuffer(_gl.ARRAY_BUFFER, object.__webglVertexBuffer);\r\n      _gl.bufferData(_gl.ARRAY_BUFFER, object.positionArray, _gl.DYNAMIC_DRAW);\r\n\r\n      state.enableAttribute(program.attributes.position);\r\n\r\n      _gl.vertexAttribPointer(program.attributes.position, 3, _gl.FLOAT, false, 0, 0);\r\n\r\n    }\r\n\r\n    if (object.hasNormals) {\r\n\r\n      _gl.bindBuffer(_gl.ARRAY_BUFFER, object.__webglNormalBuffer);\r\n\r\n      if (material instanceof THREE.MeshPhongMaterial === false &&\r\n        material.shading === THREE.FlatShading) {\r\n\r\n        var nx, ny, nz,\r\n          nax, nbx, ncx, nay, nby, ncy, naz, nbz, ncz,\r\n          normalArray,\r\n          i, il = object.count * 3;\r\n\r\n        for (i = 0; i < il; i += 9) {\r\n\r\n          normalArray = object.normalArray;\r\n\r\n          nax = normalArray[i];\r\n          nay = normalArray[i + 1];\r\n          naz = normalArray[i + 2];\r\n\r\n          nbx = normalArray[i + 3];\r\n          nby = normalArray[i + 4];\r\n          nbz = normalArray[i + 5];\r\n\r\n          ncx = normalArray[i + 6];\r\n          ncy = normalArray[i + 7];\r\n          ncz = normalArray[i + 8];\r\n\r\n          nx = (nax + nbx + ncx) / 3;\r\n          ny = (nay + nby + ncy) / 3;\r\n          nz = (naz + nbz + ncz) / 3;\r\n\r\n          normalArray[i] = nx;\r\n          normalArray[i + 1] = ny;\r\n          normalArray[i + 2] = nz;\r\n\r\n          normalArray[i + 3] = nx;\r\n          normalArray[i + 4] = ny;\r\n          normalArray[i + 5] = nz;\r\n\r\n          normalArray[i + 6] = nx;\r\n          normalArray[i + 7] = ny;\r\n          normalArray[i + 8] = nz;\r\n\r\n        }\r\n\r\n      }\r\n\r\n      _gl.bufferData(_gl.ARRAY_BUFFER, object.normalArray, _gl.DYNAMIC_DRAW);\r\n\r\n      state.enableAttribute(program.attributes.normal);\r\n\r\n      _gl.vertexAttribPointer(program.attributes.normal, 3, _gl.FLOAT, false, 0, 0);\r\n\r\n    }\r\n\r\n    if (object.hasUvs && material.map) {\r\n\r\n      _gl.bindBuffer(_gl.ARRAY_BUFFER, object.__webglUvBuffer);\r\n      _gl.bufferData(_gl.ARRAY_BUFFER, object.uvArray, _gl.DYNAMIC_DRAW);\r\n\r\n      state.enableAttribute(program.attributes.uv);\r\n\r\n      _gl.vertexAttribPointer(program.attributes.uv, 2, _gl.FLOAT, false, 0, 0);\r\n\r\n    }\r\n\r\n    if (object.hasColors && material.vertexColors !== THREE.NoColors) {\r\n\r\n      _gl.bindBuffer(_gl.ARRAY_BUFFER, object.__webglColorBuffer);\r\n      _gl.bufferData(_gl.ARRAY_BUFFER, object.colorArray, _gl.DYNAMIC_DRAW);\r\n\r\n      state.enableAttribute(program.attributes.color);\r\n\r\n      _gl.vertexAttribPointer(program.attributes.color, 3, _gl.FLOAT, false, 0, 0);\r\n\r\n    }\r\n\r\n    state.disableUnusedAttributes();\r\n\r\n    _gl.drawArrays(_gl.TRIANGLES, 0, object.count);\r\n\r\n    object.count = 0;\r\n\r\n  };\r\n\r\n  function setupVertexAttributes(material, program, geometry, startIndex) {\r\n\r\n    var geometryAttributes = geometry.attributes;\r\n\r\n    var programAttributes = program.attributes;\r\n    var programAttributesKeys = program.attributesKeys;\r\n\r\n    for (var i = 0, l = programAttributesKeys.length; i < l; i++) {\r\n\r\n      var key = programAttributesKeys[i];\r\n      var programAttribute = programAttributes[key];\r\n\r\n      if (programAttribute >= 0) {\r\n\r\n        var geometryAttribute = geometryAttributes[key];\r\n\r\n        if (geometryAttribute !== undefined) {\r\n\r\n          var size = geometryAttribute.itemSize;\r\n\r\n          _gl.bindBuffer(_gl.ARRAY_BUFFER, geometryAttribute.buffer);\r\n\r\n          state.enableAttribute(programAttribute);\r\n\r\n          _gl.vertexAttribPointer(programAttribute, size, _gl.FLOAT, false, 0, startIndex * size * 4); // 4 bytes per Float32\r\n\r\n        }\r\n        else if (material.defaultAttributeValues !== undefined) {\r\n\r\n          if (material.defaultAttributeValues[key].length === 2) {\r\n\r\n            _gl.vertexAttrib2fv(programAttribute, material.defaultAttributeValues[key]);\r\n\r\n          }\r\n          else if (material.defaultAttributeValues[key].length === 3) {\r\n\r\n            _gl.vertexAttrib3fv(programAttribute, material.defaultAttributeValues[key]);\r\n\r\n          }\r\n\r\n        }\r\n\r\n      }\r\n\r\n    }\r\n\r\n    state.disableUnusedAttributes();\r\n\r\n  }\r\n\r\n  this.renderBufferDirect = function(camera, lights, fog, material, geometry, object) {\r\n\r\n    if (material.visible === false) return;\r\n\r\n    updateObject(object);\r\n\r\n    var program = setProgram(camera, lights, fog, material, object);\r\n\r\n    var updateBuffers = false,\r\n      wireframeBit = material.wireframe ? 1 : 0,\r\n      geometryProgram = 'direct_' + geometry.id + '_' + program.id + '_' + wireframeBit;\r\n\r\n    if (geometryProgram !== _currentGeometryProgram) {\r\n\r\n      _currentGeometryProgram = geometryProgram;\r\n      updateBuffers = true;\r\n\r\n    }\r\n\r\n    if (updateBuffers) {\r\n\r\n      state.initAttributes();\r\n\r\n    }\r\n\r\n    // render mesh\r\n\r\n    if (object instanceof THREE.Mesh) {\r\n\r\n      var mode = material.wireframe === true ? _gl.LINES : _gl.TRIANGLES;\r\n\r\n      var index = geometry.attributes.index;\r\n\r\n      if (index) {\r\n\r\n        // indexed triangles\r\n\r\n        var type, size;\r\n\r\n        if (index.array instanceof Uint32Array && extensions.get('OES_element_index_uint')) {\r\n\r\n          type = _gl.UNSIGNED_INT;\r\n          size = 4;\r\n\r\n        }\r\n        else {\r\n\r\n          type = _gl.UNSIGNED_SHORT;\r\n          size = 2;\r\n\r\n        }\r\n\r\n        var offsets = geometry.offsets;\r\n\r\n        if (offsets.length === 0) {\r\n\r\n          if (updateBuffers) {\r\n\r\n            setupVertexAttributes(material, program, geometry, 0);\r\n            _gl.bindBuffer(_gl.ELEMENT_ARRAY_BUFFER, index.buffer);\r\n\r\n          }\r\n\r\n          _gl.drawElements(mode, index.array.length, type, 0);\r\n\r\n          _this.info.render.calls++;\r\n          _this.info.render.vertices += index.array.length; // not really true, here vertices can be shared\r\n          _this.info.render.faces += index.array.length / 3;\r\n\r\n        }\r\n        else {\r\n\r\n          // if there is more than 1 chunk\r\n          // must set attribute pointers to use new offsets for each chunk\r\n          // even if geometry and materials didn't change\r\n\r\n          updateBuffers = true;\r\n\r\n          for (var i = 0, il = offsets.length; i < il; i++) {\r\n\r\n            var startIndex = offsets[i].index;\r\n\r\n            if (updateBuffers) {\r\n\r\n              setupVertexAttributes(material, program, geometry, startIndex);\r\n              _gl.bindBuffer(_gl.ELEMENT_ARRAY_BUFFER, index.buffer);\r\n\r\n            }\r\n\r\n            // render indexed triangles\r\n\r\n            _gl.drawElements(mode, offsets[i].count, type, offsets[i].start * size);\r\n\r\n            _this.info.render.calls++;\r\n            _this.info.render.vertices += offsets[i].count; // not really true, here vertices can be shared\r\n            _this.info.render.faces += offsets[i].count / 3;\r\n\r\n          }\r\n\r\n        }\r\n\r\n      }\r\n      else {\r\n\r\n        // non-indexed triangles\r\n\r\n        if (updateBuffers) {\r\n\r\n          setupVertexAttributes(material, program, geometry, 0);\r\n\r\n        }\r\n\r\n        var position = geometry.attributes['position'];\r\n\r\n        // render non-indexed triangles\r\n\r\n        _gl.drawArrays(mode, 0, position.array.length / position.itemSize);\r\n\r\n        _this.info.render.calls++;\r\n        _this.info.render.vertices += position.array.length / position.itemSize;\r\n        _this.info.render.faces += position.array.length / (3 * position.itemSize);\r\n\r\n      }\r\n\r\n    }\r\n    else if (object instanceof THREE.PointCloud) {\r\n\r\n      // render particles\r\n\r\n      var mode = _gl.POINTS;\r\n\r\n      var index = geometry.attributes.index;\r\n\r\n      if (index) {\r\n\r\n        // indexed points\r\n\r\n        var type, size;\r\n\r\n        if (index.array instanceof Uint32Array && extensions.get('OES_element_index_uint')) {\r\n\r\n          type = _gl.UNSIGNED_INT;\r\n          size = 4;\r\n\r\n        }\r\n        else {\r\n\r\n          type = _gl.UNSIGNED_SHORT;\r\n          size = 2;\r\n\r\n        }\r\n\r\n        var offsets = geometry.offsets;\r\n\r\n        if (offsets.length === 0) {\r\n\r\n          if (updateBuffers) {\r\n\r\n            setupVertexAttributes(material, program, geometry, 0);\r\n            _gl.bindBuffer(_gl.ELEMENT_ARRAY_BUFFER, index.buffer);\r\n\r\n          }\r\n\r\n          _gl.drawElements(mode, index.array.length, type, 0);\r\n\r\n          _this.info.render.calls++;\r\n          _this.info.render.points += index.array.length;\r\n\r\n        }\r\n        else {\r\n\r\n          // if there is more than 1 chunk\r\n          // must set attribute pointers to use new offsets for each chunk\r\n          // even if geometry and materials didn't change\r\n\r\n          if (offsets.length > 1) updateBuffers = true;\r\n\r\n          for (var i = 0, il = offsets.length; i < il; i++) {\r\n\r\n            var startIndex = offsets[i].index;\r\n\r\n            if (updateBuffers) {\r\n\r\n              setupVertexAttributes(material, program, geometry, startIndex);\r\n              _gl.bindBuffer(_gl.ELEMENT_ARRAY_BUFFER, index.buffer);\r\n\r\n            }\r\n\r\n            // render indexed points\r\n\r\n            _gl.drawElements(mode, offsets[i].count, type, offsets[i].start * size);\r\n\r\n            _this.info.render.calls++;\r\n            _this.info.render.points += offsets[i].count;\r\n\r\n          }\r\n\r\n        }\r\n\r\n      }\r\n      else {\r\n\r\n        // non-indexed points\r\n\r\n        if (updateBuffers) {\r\n\r\n          setupVertexAttributes(material, program, geometry, 0);\r\n\r\n        }\r\n\r\n        var position = geometry.attributes.position;\r\n        var offsets = geometry.offsets;\r\n\r\n        if (offsets.length === 0) {\r\n\r\n          _gl.drawArrays(mode, 0, position.array.length / 3);\r\n\r\n          _this.info.render.calls++;\r\n          _this.info.render.points += position.array.length / 3;\r\n\r\n        }\r\n        else {\r\n\r\n          for (var i = 0, il = offsets.length; i < il; i++) {\r\n\r\n            _gl.drawArrays(mode, offsets[i].index, offsets[i].count);\r\n\r\n            _this.info.render.calls++;\r\n            _this.info.render.points += offsets[i].count;\r\n\r\n          }\r\n\r\n        }\r\n\r\n      }\r\n\r\n    }\r\n    else if (object instanceof THREE.Line) {\r\n\r\n      var mode = (object.mode === THREE.LineStrip) ? _gl.LINE_STRIP : _gl.LINES;\r\n\r\n      state.setLineWidth(material.linewidth * pixelRatio);\r\n\r\n      var index = geometry.attributes.index;\r\n\r\n      if (index) {\r\n\r\n        // indexed lines\r\n\r\n        var type, size;\r\n\r\n        if (index.array instanceof Uint32Array) {\r\n\r\n          type = _gl.UNSIGNED_INT;\r\n          size = 4;\r\n\r\n        }\r\n        else {\r\n\r\n          type = _gl.UNSIGNED_SHORT;\r\n          size = 2;\r\n\r\n        }\r\n\r\n        var offsets = geometry.offsets;\r\n\r\n        if (offsets.length === 0) {\r\n\r\n          if (updateBuffers) {\r\n\r\n            setupVertexAttributes(material, program, geometry, 0);\r\n            _gl.bindBuffer(_gl.ELEMENT_ARRAY_BUFFER, index.buffer);\r\n\r\n          }\r\n\r\n          _gl.drawElements(mode, index.array.length, type, 0); // 2 bytes per Uint16Array\r\n\r\n          _this.info.render.calls++;\r\n          _this.info.render.vertices += index.array.length; // not really true, here vertices can be shared\r\n\r\n        }\r\n        else {\r\n\r\n          // if there is more than 1 chunk\r\n          // must set attribute pointers to use new offsets for each chunk\r\n          // even if geometry and materials didn't change\r\n\r\n          if (offsets.length > 1) updateBuffers = true;\r\n\r\n          for (var i = 0, il = offsets.length; i < il; i++) {\r\n\r\n            var startIndex = offsets[i].index;\r\n\r\n            if (updateBuffers) {\r\n\r\n              setupVertexAttributes(material, program, geometry, startIndex);\r\n              _gl.bindBuffer(_gl.ELEMENT_ARRAY_BUFFER, index.buffer);\r\n\r\n            }\r\n\r\n            // render indexed lines\r\n\r\n            _gl.drawElements(mode, offsets[i].count, type, offsets[i].start * size); // 2 bytes per Uint16Array\r\n\r\n            _this.info.render.calls++;\r\n            _this.info.render.vertices += offsets[i].count; // not really true, here vertices can be shared\r\n\r\n          }\r\n\r\n        }\r\n\r\n      }\r\n      else {\r\n\r\n        // non-indexed lines\r\n\r\n        if (updateBuffers) {\r\n\r\n          setupVertexAttributes(material, program, geometry, 0);\r\n\r\n        }\r\n\r\n        var position = geometry.attributes.position;\r\n        var offsets = geometry.offsets;\r\n\r\n        if (offsets.length === 0) {\r\n\r\n          _gl.drawArrays(mode, 0, position.array.length / 3);\r\n\r\n          _this.info.render.calls++;\r\n          _this.info.render.vertices += position.array.length / 3;\r\n\r\n        }\r\n        else {\r\n\r\n          for (var i = 0, il = offsets.length; i < il; i++) {\r\n\r\n            _gl.drawArrays(mode, offsets[i].index, offsets[i].count);\r\n\r\n            _this.info.render.calls++;\r\n            _this.info.render.vertices += offsets[i].count;\r\n\r\n          }\r\n\r\n        }\r\n\r\n      }\r\n\r\n    }\r\n\r\n  };\r\n\r\n  this.renderBuffer = function(camera, lights, fog, material, geometryGroup, object) {\r\n\r\n    if (material.visible === false) return;\r\n\r\n    updateObject(object);\r\n\r\n    var program = setProgram(camera, lights, fog, material, object);\r\n\r\n    var attributes = program.attributes;\r\n\r\n    var updateBuffers = false,\r\n      wireframeBit = material.wireframe ? 1 : 0,\r\n      geometryProgram = geometryGroup.id + '_' + program.id + '_' + wireframeBit;\r\n\r\n    if (geometryProgram !== _currentGeometryProgram) {\r\n\r\n      _currentGeometryProgram = geometryProgram;\r\n      updateBuffers = true;\r\n\r\n    }\r\n\r\n    if (updateBuffers) {\r\n\r\n      state.initAttributes();\r\n\r\n    }\r\n\r\n    // vertices\r\n\r\n    if (!material.morphTargets && attributes.position >= 0) {\r\n\r\n      if (updateBuffers) {\r\n\r\n        _gl.bindBuffer(_gl.ARRAY_BUFFER, geometryGroup.__webglVertexBuffer);\r\n\r\n        state.enableAttribute(attributes.position);\r\n\r\n        _gl.vertexAttribPointer(attributes.position, 3, _gl.FLOAT, false, 0, 0);\r\n\r\n      }\r\n\r\n    }\r\n    else {\r\n\r\n      if (object.morphTargetBase) {\r\n\r\n        setupMorphTargets(material, geometryGroup, object);\r\n\r\n      }\r\n\r\n    }\r\n\r\n\r\n    if (updateBuffers) {\r\n\r\n      // custom attributes\r\n\r\n      // Use the per-geometryGroup custom attribute arrays which are setup in initMeshBuffers\r\n\r\n      if (geometryGroup.__webglCustomAttributesList) {\r\n\r\n        for (var i = 0, il = geometryGroup.__webglCustomAttributesList.length; i < il; i++) {\r\n\r\n          var attribute = geometryGroup.__webglCustomAttributesList[i];\r\n\r\n          if (attributes[attribute.buffer.belongsToAttribute] >= 0) {\r\n\r\n            _gl.bindBuffer(_gl.ARRAY_BUFFER, attribute.buffer);\r\n\r\n            state.enableAttribute(attributes[attribute.buffer.belongsToAttribute]);\r\n\r\n            _gl.vertexAttribPointer(attributes[attribute.buffer.belongsToAttribute], attribute.size, _gl.FLOAT, false, 0, 0);\r\n\r\n          }\r\n\r\n        }\r\n\r\n      }\r\n\r\n\r\n      // colors\r\n\r\n      if (attributes.color >= 0) {\r\n\r\n        if (object.geometry.colors.length > 0 || object.geometry.faces.length > 0) {\r\n\r\n          _gl.bindBuffer(_gl.ARRAY_BUFFER, geometryGroup.__webglColorBuffer);\r\n\r\n          state.enableAttribute(attributes.color);\r\n\r\n          _gl.vertexAttribPointer(attributes.color, 3, _gl.FLOAT, false, 0, 0);\r\n\r\n        }\r\n        else if (material.defaultAttributeValues !== undefined) {\r\n\r\n\r\n          _gl.vertexAttrib3fv(attributes.color, material.defaultAttributeValues.color);\r\n\r\n        }\r\n\r\n      }\r\n\r\n      // normals\r\n\r\n      if (attributes.normal >= 0) {\r\n\r\n        _gl.bindBuffer(_gl.ARRAY_BUFFER, geometryGroup.__webglNormalBuffer);\r\n\r\n        state.enableAttribute(attributes.normal);\r\n\r\n        _gl.vertexAttribPointer(attributes.normal, 3, _gl.FLOAT, false, 0, 0);\r\n\r\n      }\r\n\r\n      // tangents\r\n\r\n      if (attributes.tangent >= 0) {\r\n\r\n        _gl.bindBuffer(_gl.ARRAY_BUFFER, geometryGroup.__webglTangentBuffer);\r\n\r\n        state.enableAttribute(attributes.tangent);\r\n\r\n        _gl.vertexAttribPointer(attributes.tangent, 4, _gl.FLOAT, false, 0, 0);\r\n\r\n      }\r\n\r\n      // uvs\r\n\r\n      if (attributes.uv >= 0) {\r\n\r\n        if (object.geometry.faceVertexUvs[0]) {\r\n\r\n          _gl.bindBuffer(_gl.ARRAY_BUFFER, geometryGroup.__webglUVBuffer);\r\n\r\n          state.enableAttribute(attributes.uv);\r\n\r\n          _gl.vertexAttribPointer(attributes.uv, 2, _gl.FLOAT, false, 0, 0);\r\n\r\n        }\r\n        else if (material.defaultAttributeValues !== undefined) {\r\n\r\n\r\n          _gl.vertexAttrib2fv(attributes.uv, material.defaultAttributeValues.uv);\r\n\r\n        }\r\n\r\n      }\r\n\r\n      if (attributes.uv2 >= 0) {\r\n\r\n        if (object.geometry.faceVertexUvs[1]) {\r\n\r\n          _gl.bindBuffer(_gl.ARRAY_BUFFER, geometryGroup.__webglUV2Buffer);\r\n\r\n          state.enableAttribute(attributes.uv2);\r\n\r\n          _gl.vertexAttribPointer(attributes.uv2, 2, _gl.FLOAT, false, 0, 0);\r\n\r\n        }\r\n        else if (material.defaultAttributeValues !== undefined) {\r\n\r\n\r\n          _gl.vertexAttrib2fv(attributes.uv2, material.defaultAttributeValues.uv2);\r\n\r\n        }\r\n\r\n      }\r\n\r\n      if (material.skinning &&\r\n        attributes.skinIndex >= 0 && attributes.skinWeight >= 0) {\r\n\r\n        _gl.bindBuffer(_gl.ARRAY_BUFFER, geometryGroup.__webglSkinIndicesBuffer);\r\n\r\n        state.enableAttribute(attributes.skinIndex);\r\n\r\n        _gl.vertexAttribPointer(attributes.skinIndex, 4, _gl.FLOAT, false, 0, 0);\r\n\r\n        _gl.bindBuffer(_gl.ARRAY_BUFFER, geometryGroup.__webglSkinWeightsBuffer);\r\n\r\n        state.enableAttribute(attributes.skinWeight);\r\n\r\n        _gl.vertexAttribPointer(attributes.skinWeight, 4, _gl.FLOAT, false, 0, 0);\r\n\r\n      }\r\n\r\n      // line distances\r\n\r\n      if (attributes.lineDistance >= 0) {\r\n\r\n        _gl.bindBuffer(_gl.ARRAY_BUFFER, geometryGroup.__webglLineDistanceBuffer);\r\n\r\n        state.enableAttribute(attributes.lineDistance);\r\n\r\n        _gl.vertexAttribPointer(attributes.lineDistance, 1, _gl.FLOAT, false, 0, 0);\r\n\r\n      }\r\n\r\n    }\r\n\r\n    state.disableUnusedAttributes();\r\n\r\n    // render mesh\r\n\r\n    if (object instanceof THREE.Mesh) {\r\n\r\n      var type = geometryGroup.__typeArray === Uint32Array ? _gl.UNSIGNED_INT : _gl.UNSIGNED_SHORT;\r\n\r\n      // wireframe\r\n\r\n      if (material.wireframe) {\r\n\r\n        state.setLineWidth(material.wireframeLinewidth * pixelRatio);\r\n\r\n        if (updateBuffers) _gl.bindBuffer(_gl.ELEMENT_ARRAY_BUFFER, geometryGroup.__webglLineBuffer);\r\n        _gl.drawElements(_gl.LINES, geometryGroup.__webglLineCount, type, 0);\r\n\r\n        // triangles\r\n\r\n      }\r\n      else {\r\n\r\n        if (updateBuffers) _gl.bindBuffer(_gl.ELEMENT_ARRAY_BUFFER, geometryGroup.__webglFaceBuffer);\r\n        _gl.drawElements(_gl.TRIANGLES, geometryGroup.__webglFaceCount, type, 0);\r\n\r\n      }\r\n\r\n      _this.info.render.calls++;\r\n      _this.info.render.vertices += geometryGroup.__webglFaceCount;\r\n      _this.info.render.faces += geometryGroup.__webglFaceCount / 3;\r\n\r\n      // render lines\r\n\r\n    }\r\n    else if (object instanceof THREE.Line) {\r\n\r\n      var mode = (object.mode === THREE.LineStrip) ? _gl.LINE_STRIP : _gl.LINES;\r\n\r\n      state.setLineWidth(material.linewidth * pixelRatio);\r\n\r\n      _gl.drawArrays(mode, 0, geometryGroup.__webglLineCount);\r\n\r\n      _this.info.render.calls++;\r\n\r\n      // render particles\r\n\r\n    }\r\n    else if (object instanceof THREE.PointCloud) {\r\n\r\n      _gl.drawArrays(_gl.POINTS, 0, geometryGroup.__webglParticleCount);\r\n\r\n      _this.info.render.calls++;\r\n      _this.info.render.points += geometryGroup.__webglParticleCount;\r\n\r\n    }\r\n\r\n  };\r\n\r\n  function setupMorphTargets(material, geometryGroup, object) {\r\n\r\n    // set base\r\n\r\n    var attributes = material.program.attributes;\r\n\r\n    if (object.morphTargetBase !== -1 && attributes.position >= 0) {\r\n\r\n      _gl.bindBuffer(_gl.ARRAY_BUFFER, geometryGroup.__webglMorphTargetsBuffers[object.morphTargetBase]);\r\n\r\n      state.enableAttribute(attributes.position);\r\n\r\n      _gl.vertexAttribPointer(attributes.position, 3, _gl.FLOAT, false, 0, 0);\r\n\r\n    }\r\n    else if (attributes.position >= 0) {\r\n\r\n      _gl.bindBuffer(_gl.ARRAY_BUFFER, geometryGroup.__webglVertexBuffer);\r\n\r\n      state.enableAttribute(attributes.position);\r\n\r\n      _gl.vertexAttribPointer(attributes.position, 3, _gl.FLOAT, false, 0, 0);\r\n\r\n    }\r\n\r\n    if (object.morphTargetForcedOrder.length) {\r\n\r\n      // set forced order\r\n\r\n      var m = 0;\r\n      var order = object.morphTargetForcedOrder;\r\n      var influences = object.morphTargetInfluences;\r\n\r\n      var attribute;\r\n\r\n      while (m < material.numSupportedMorphTargets && m < order.length) {\r\n\r\n        attribute = attributes['morphTarget' + m];\r\n\r\n        if (attribute >= 0) {\r\n\r\n          _gl.bindBuffer(_gl.ARRAY_BUFFER, geometryGroup.__webglMorphTargetsBuffers[order[m]]);\r\n\r\n          state.enableAttribute(attribute);\r\n\r\n          _gl.vertexAttribPointer(attribute, 3, _gl.FLOAT, false, 0, 0);\r\n\r\n        }\r\n\r\n        attribute = attributes['morphNormal' + m];\r\n\r\n        if (attribute >= 0 && material.morphNormals) {\r\n\r\n          _gl.bindBuffer(_gl.ARRAY_BUFFER, geometryGroup.__webglMorphNormalsBuffers[order[m]]);\r\n\r\n          state.enableAttribute(attribute);\r\n\r\n          _gl.vertexAttribPointer(attribute, 3, _gl.FLOAT, false, 0, 0);\r\n\r\n        }\r\n\r\n        object.__webglMorphTargetInfluences[m] = influences[order[m]];\r\n\r\n        m++;\r\n\r\n      }\r\n\r\n    }\r\n    else {\r\n\r\n      // find the most influencing\r\n\r\n      var activeInfluenceIndices = [];\r\n      var influences = object.morphTargetInfluences;\r\n      var morphTargets = object.geometry.morphTargets;\r\n\r\n      if (influences.length > morphTargets.length) {\r\n\r\n        console.warn('THREE.WebGLRenderer: Influences array is bigger than morphTargets array.');\r\n        influences.length = morphTargets.length;\r\n\r\n      }\r\n\r\n      for (var i = 0, il = influences.length; i < il; i++) {\r\n\r\n        var influence = influences[i];\r\n\r\n        activeInfluenceIndices.push([influence, i]);\r\n\r\n      }\r\n\r\n      if (activeInfluenceIndices.length > material.numSupportedMorphTargets) {\r\n\r\n        activeInfluenceIndices.sort(numericalSort);\r\n        activeInfluenceIndices.length = material.numSupportedMorphTargets;\r\n\r\n      }\r\n      else if (activeInfluenceIndices.length > material.numSupportedMorphNormals) {\r\n\r\n        activeInfluenceIndices.sort(numericalSort);\r\n\r\n      }\r\n      else if (activeInfluenceIndices.length === 0) {\r\n\r\n        activeInfluenceIndices.push([0, 0]);\r\n\r\n      }\r\n\r\n      var attribute;\r\n\r\n      for (var m = 0, ml = material.numSupportedMorphTargets; m < ml; m++) {\r\n\r\n        if (activeInfluenceIndices[m]) {\r\n\r\n          var influenceIndex = activeInfluenceIndices[m][1];\r\n\r\n          attribute = attributes['morphTarget' + m];\r\n\r\n          if (attribute >= 0) {\r\n\r\n            _gl.bindBuffer(_gl.ARRAY_BUFFER, geometryGroup.__webglMorphTargetsBuffers[influenceIndex]);\r\n\r\n            state.enableAttribute(attribute);\r\n\r\n            _gl.vertexAttribPointer(attribute, 3, _gl.FLOAT, false, 0, 0);\r\n\r\n          }\r\n\r\n          attribute = attributes['morphNormal' + m];\r\n\r\n          if (attribute >= 0 && material.morphNormals) {\r\n\r\n            _gl.bindBuffer(_gl.ARRAY_BUFFER, geometryGroup.__webglMorphNormalsBuffers[influenceIndex]);\r\n\r\n            state.enableAttribute(attribute);\r\n\r\n            _gl.vertexAttribPointer(attribute, 3, _gl.FLOAT, false, 0, 0);\r\n\r\n          }\r\n\r\n          object.__webglMorphTargetInfluences[m] = influences[influenceIndex];\r\n\r\n        }\r\n        else {\r\n\r\n          /*\r\n          _gl.vertexAttribPointer( attributes[ \"morphTarget\" + m ], 3, _gl.FLOAT, false, 0, 0 );\r\n\r\n          if ( material.morphNormals ) {\r\n\r\n          \t_gl.vertexAttribPointer( attributes[ \"morphNormal\" + m ], 3, _gl.FLOAT, false, 0, 0 );\r\n\r\n          }\r\n          */\r\n\r\n          object.__webglMorphTargetInfluences[m] = 0;\r\n\r\n        }\r\n\r\n      }\r\n\r\n    }\r\n\r\n    // load updated influences uniform\r\n\r\n    if (material.program.uniforms.morphTargetInfluences !== null) {\r\n\r\n      _gl.uniform1fv(material.program.uniforms.morphTargetInfluences, object.__webglMorphTargetInfluences);\r\n\r\n    }\r\n\r\n  }\r\n\r\n  // Sorting\r\n\r\n  function painterSortStable(a, b) {\r\n\r\n    if (a.object.renderOrder !== b.object.renderOrder) {\r\n\r\n      return a.object.renderOrder - b.object.renderOrder;\r\n\r\n    }\r\n    else if (a.material.id !== b.material.id) {\r\n\r\n      return a.material.id - b.material.id;\r\n\r\n    }\r\n    else if (a.z !== b.z) {\r\n\r\n      return a.z - b.z;\r\n\r\n    }\r\n    else {\r\n\r\n      return a.id - b.id;\r\n\r\n    }\r\n\r\n  }\r\n\r\n  function reversePainterSortStable(a, b) {\r\n\r\n    if (a.object.renderOrder !== b.object.renderOrder) {\r\n\r\n      return a.object.renderOrder - b.object.renderOrder;\r\n\r\n    }\r\n    if (a.z !== b.z) {\r\n\r\n      return b.z - a.z;\r\n\r\n    }\r\n    else {\r\n\r\n      return a.id - b.id;\r\n\r\n    }\r\n\r\n  }\r\n\r\n  function numericalSort(a, b) {\r\n\r\n    return b[0] - a[0];\r\n\r\n  }\r\n\r\n  // Rendering\r\n\r\n  this.render = function(scene, camera, renderTarget, forceClear) {\r\n\r\n    if (camera instanceof THREE.Camera === false) {\r\n\r\n      THREE.error('THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.');\r\n      return;\r\n\r\n    }\r\n\r\n    var fog = scene.fog;\r\n\r\n    // reset caching for this frame\r\n\r\n    _currentGeometryProgram = '';\r\n    _currentMaterialId = -1;\r\n    _currentCamera = null;\r\n    _lightsNeedUpdate = true;\r\n\r\n    // update scene graph\r\n\r\n    if (scene.autoUpdate === true) scene.updateMatrixWorld();\r\n\r\n    // update camera matrices and frustum\r\n\r\n    if (camera.parent === undefined) camera.updateMatrixWorld();\r\n\r\n    // update Skeleton objects\r\n\r\n    scene.traverse(function(object) {\r\n\r\n      if (object instanceof THREE.SkinnedMesh) {\r\n\r\n        object.skeleton.update();\r\n\r\n      }\r\n\r\n    });\r\n\r\n    camera.matrixWorldInverse.getInverse(camera.matrixWorld);\r\n\r\n    _projScreenMatrix.multiplyMatrices(camera.projectionMatrix, camera.matrixWorldInverse);\r\n    _frustum.setFromMatrix(_projScreenMatrix);\r\n\r\n    lights.length = 0;\r\n    opaqueObjects.length = 0;\r\n    transparentObjects.length = 0;\r\n\r\n    sprites.length = 0;\r\n    lensFlares.length = 0;\r\n\r\n    projectObject(scene);\r\n\r\n    if (_this.sortObjects === true) {\r\n\r\n      opaqueObjects.sort(painterSortStable);\r\n      transparentObjects.sort(reversePainterSortStable);\r\n\r\n    }\r\n\r\n    // custom render plugins (pre pass)\r\n\r\n    shadowMapPlugin.render(scene, camera);\r\n\r\n    //\r\n\r\n    _this.info.render.calls = 0;\r\n    _this.info.render.vertices = 0;\r\n    _this.info.render.faces = 0;\r\n    _this.info.render.points = 0;\r\n\r\n    this.setRenderTarget(renderTarget);\r\n\r\n    if (this.autoClear || forceClear) {\r\n\r\n      this.clear(this.autoClearColor, this.autoClearDepth, this.autoClearStencil);\r\n\r\n    }\r\n\r\n    // set matrices for immediate objects\r\n\r\n    for (var i = 0, il = _webglObjectsImmediate.length; i < il; i++) {\r\n\r\n      var webglObject = _webglObjectsImmediate[i];\r\n      var object = webglObject.object;\r\n\r\n      if (object.visible) {\r\n\r\n        setupMatrices(object, camera);\r\n\r\n        unrollImmediateBufferMaterial(webglObject);\r\n\r\n      }\r\n\r\n    }\r\n\r\n    if (scene.overrideMaterial) {\r\n\r\n      var overrideMaterial = scene.overrideMaterial;\r\n\r\n      setMaterial(overrideMaterial);\r\n\r\n      renderObjects(opaqueObjects, camera, lights, fog, overrideMaterial);\r\n      renderObjects(transparentObjects, camera, lights, fog, overrideMaterial);\r\n      renderObjectsImmediate(_webglObjectsImmediate, '', camera, lights, fog, overrideMaterial);\r\n\r\n    }\r\n    else {\r\n\r\n      // opaque pass (front-to-back order)\r\n\r\n      state.setBlending(THREE.NoBlending);\r\n\r\n      renderObjects(opaqueObjects, camera, lights, fog, null);\r\n      renderObjectsImmediate(_webglObjectsImmediate, 'opaque', camera, lights, fog, null);\r\n\r\n      // transparent pass (back-to-front order)\r\n\r\n      renderObjects(transparentObjects, camera, lights, fog, null);\r\n      renderObjectsImmediate(_webglObjectsImmediate, 'transparent', camera, lights, fog, null);\r\n\r\n    }\r\n\r\n    // custom render plugins (post pass)\r\n\r\n    spritePlugin.render(scene, camera);\r\n    lensFlarePlugin.render(scene, camera, _currentWidth, _currentHeight);\r\n\r\n    // Generate mipmap if we're using any kind of mipmap filtering\r\n\r\n    if (renderTarget && renderTarget.generateMipmaps && renderTarget.minFilter !== THREE.NearestFilter && renderTarget.minFilter !== THREE.LinearFilter) {\r\n\r\n      updateRenderTargetMipmap(renderTarget);\r\n\r\n    }\r\n\r\n    // Ensure depth buffer writing is enabled so it can be cleared on next render\r\n\r\n    state.setDepthTest(true);\r\n    state.setDepthWrite(true);\r\n    state.setColorWrite(true);\r\n\r\n    // _gl.finish();\r\n\r\n  };\r\n\r\n  function projectObject(object) {\r\n\r\n    if (object.visible === false) return;\r\n\r\n    if (object instanceof THREE.Scene || object instanceof THREE.Group) {\r\n\r\n      // skip\r\n\r\n    }\r\n    else {\r\n\r\n      initObject(object);\r\n\r\n      if (object instanceof THREE.Light) {\r\n\r\n        lights.push(object);\r\n\r\n      }\r\n      else if (object instanceof THREE.Sprite) {\r\n\r\n        sprites.push(object);\r\n\r\n      }\r\n      else if (object instanceof THREE.LensFlare) {\r\n\r\n        lensFlares.push(object);\r\n\r\n      }\r\n      else {\r\n\r\n        var webglObjects = _webglObjects[object.id];\r\n\r\n        if (webglObjects && (object.frustumCulled === false || _frustum.intersectsObject(object) === true)) {\r\n\r\n          for (var i = 0, l = webglObjects.length; i < l; i++) {\r\n\r\n            var webglObject = webglObjects[i];\r\n\r\n            unrollBufferMaterial(webglObject);\r\n\r\n            webglObject.render = true;\r\n\r\n            if (_this.sortObjects === true) {\r\n\r\n              _vector3.setFromMatrixPosition(object.matrixWorld);\r\n              _vector3.applyProjection(_projScreenMatrix);\r\n\r\n              webglObject.z = _vector3.z;\r\n\r\n            }\r\n\r\n          }\r\n\r\n        }\r\n\r\n      }\r\n\r\n    }\r\n\r\n    for (var i = 0, l = object.children.length; i < l; i++) {\r\n\r\n      projectObject(object.children[i]);\r\n\r\n    }\r\n\r\n  }\r\n\r\n  function renderObjects(renderList, camera, lights, fog, overrideMaterial) {\r\n\r\n    var material;\r\n\r\n    for (var i = 0, l = renderList.length; i < l; i++) {\r\n\r\n      var webglObject = renderList[i];\r\n\r\n      var object = webglObject.object;\r\n      var buffer = webglObject.buffer;\r\n\r\n      setupMatrices(object, camera);\r\n\r\n      if (overrideMaterial) {\r\n\r\n        material = overrideMaterial;\r\n\r\n      }\r\n      else {\r\n\r\n        material = webglObject.material;\r\n\r\n        if (!material) continue;\r\n\r\n        setMaterial(material);\r\n\r\n      }\r\n\r\n      _this.setMaterialFaces(material);\r\n\r\n      if (buffer instanceof THREE.BufferGeometry) {\r\n\r\n        _this.renderBufferDirect(camera, lights, fog, material, buffer, object);\r\n\r\n      }\r\n      else {\r\n\r\n        _this.renderBuffer(camera, lights, fog, material, buffer, object);\r\n\r\n      }\r\n\r\n    }\r\n\r\n  }\r\n\r\n  function renderObjectsImmediate(renderList, materialType, camera, lights, fog, overrideMaterial) {\r\n\r\n    var material;\r\n\r\n    for (var i = 0, l = renderList.length; i < l; i++) {\r\n\r\n      var webglObject = renderList[i];\r\n      var object = webglObject.object;\r\n\r\n      if (object.visible) {\r\n\r\n        if (overrideMaterial) {\r\n\r\n          material = overrideMaterial;\r\n\r\n        }\r\n        else {\r\n\r\n          material = webglObject[materialType];\r\n\r\n          if (!material) continue;\r\n\r\n          setMaterial(material);\r\n\r\n        }\r\n\r\n        _this.renderImmediateObject(camera, lights, fog, material, object);\r\n\r\n      }\r\n\r\n    }\r\n\r\n  }\r\n\r\n  this.renderImmediateObject = function(camera, lights, fog, material, object) {\r\n\r\n    var program = setProgram(camera, lights, fog, material, object);\r\n\r\n    _currentGeometryProgram = '';\r\n\r\n    _this.setMaterialFaces(material);\r\n\r\n    if (object.immediateRenderCallback) {\r\n\r\n      object.immediateRenderCallback(program, _gl, _frustum);\r\n\r\n    }\r\n    else {\r\n\r\n      object.render(function(object) {\r\n        _this.renderBufferImmediate(object, program, material);\r\n      });\r\n\r\n    }\r\n\r\n  };\r\n\r\n  function unrollImmediateBufferMaterial(globject) {\r\n\r\n    var object = globject.object,\r\n      material = object.material;\r\n\r\n    if (material.transparent) {\r\n\r\n      globject.transparent = material;\r\n      globject.opaque = null;\r\n\r\n    }\r\n    else {\r\n\r\n      globject.opaque = material;\r\n      globject.transparent = null;\r\n\r\n    }\r\n\r\n  }\r\n\r\n  function unrollBufferMaterial(globject) {\r\n\r\n    var object = globject.object;\r\n    var buffer = globject.buffer;\r\n\r\n    var geometry = object.geometry;\r\n    var material = object.material;\r\n\r\n    if (material instanceof THREE.MeshFaceMaterial) {\r\n\r\n      var materialIndex = geometry instanceof THREE.BufferGeometry ? 0 : buffer.materialIndex;\r\n\r\n      material = material.materials[materialIndex];\r\n\r\n      globject.material = material;\r\n\r\n      if (material.transparent) {\r\n\r\n        transparentObjects.push(globject);\r\n\r\n      }\r\n      else {\r\n\r\n        opaqueObjects.push(globject);\r\n\r\n      }\r\n\r\n    }\r\n    else if (material) {\r\n\r\n      globject.material = material;\r\n\r\n      if (material.transparent) {\r\n\r\n        transparentObjects.push(globject);\r\n\r\n      }\r\n      else {\r\n\r\n        opaqueObjects.push(globject);\r\n\r\n      }\r\n\r\n    }\r\n\r\n  }\r\n\r\n  function initObject(object) {\r\n\r\n    if (object.__webglInit === undefined) {\r\n\r\n      object.__webglInit = true;\r\n      object._modelViewMatrix = new THREE.Matrix4();\r\n      object._normalMatrix = new THREE.Matrix3();\r\n\r\n      object.addEventListener('removed', onObjectRemoved);\r\n\r\n    }\r\n\r\n    var geometry = object.geometry;\r\n\r\n    if (geometry === undefined) {\r\n\r\n      // ImmediateRenderObject\r\n\r\n    }\r\n    else if (geometry.__webglInit === undefined) {\r\n\r\n      geometry.__webglInit = true;\r\n      geometry.addEventListener('dispose', onGeometryDispose);\r\n\r\n      if (geometry instanceof THREE.BufferGeometry) {\r\n\r\n        _this.info.memory.geometries++;\r\n\r\n      }\r\n      else if (object instanceof THREE.Mesh) {\r\n\r\n        initGeometryGroups(object, geometry);\r\n\r\n      }\r\n      else if (object instanceof THREE.Line) {\r\n\r\n        if (geometry.__webglVertexBuffer === undefined) {\r\n\r\n          createLineBuffers(geometry);\r\n          initLineBuffers(geometry, object);\r\n\r\n          geometry.verticesNeedUpdate = true;\r\n          geometry.colorsNeedUpdate = true;\r\n          geometry.lineDistancesNeedUpdate = true;\r\n\r\n        }\r\n\r\n      }\r\n      else if (object instanceof THREE.PointCloud) {\r\n\r\n        if (geometry.__webglVertexBuffer === undefined) {\r\n\r\n          createParticleBuffers(geometry);\r\n          initParticleBuffers(geometry, object);\r\n\r\n          geometry.verticesNeedUpdate = true;\r\n          geometry.colorsNeedUpdate = true;\r\n\r\n        }\r\n\r\n      }\r\n\r\n    }\r\n\r\n    if (object.__webglActive === undefined) {\r\n\r\n      object.__webglActive = true;\r\n\r\n      if (object instanceof THREE.Mesh) {\r\n\r\n        if (geometry instanceof THREE.BufferGeometry) {\r\n\r\n          addBuffer(_webglObjects, geometry, object);\r\n\r\n        }\r\n        else if (geometry instanceof THREE.Geometry) {\r\n\r\n          var geometryGroupsList = geometryGroups[geometry.id];\r\n\r\n          for (var i = 0, l = geometryGroupsList.length; i < l; i++) {\r\n\r\n            addBuffer(_webglObjects, geometryGroupsList[i], object);\r\n\r\n          }\r\n\r\n        }\r\n\r\n      }\r\n      else if (object instanceof THREE.Line || object instanceof THREE.PointCloud) {\r\n\r\n        addBuffer(_webglObjects, geometry, object);\r\n\r\n      }\r\n      else if (object instanceof THREE.ImmediateRenderObject || object.immediateRenderCallback) {\r\n\r\n        addBufferImmediate(_webglObjectsImmediate, object);\r\n\r\n      }\r\n\r\n    }\r\n\r\n  }\r\n\r\n  // Geometry splitting\r\n\r\n  var geometryGroups = {};\r\n  var geometryGroupCounter = 0;\r\n\r\n  function makeGroups(geometry, usesFaceMaterial) {\r\n\r\n    var maxVerticesInGroup = extensions.get('OES_element_index_uint') ? 4294967296 : 65535;\r\n\r\n    var groupHash, hash_map = {};\r\n\r\n    var numMorphTargets = geometry.morphTargets.length;\r\n    var numMorphNormals = geometry.morphNormals.length;\r\n\r\n    var group;\r\n    var groups = {};\r\n    var groupsList = [];\r\n\r\n    for (var f = 0, fl = geometry.faces.length; f < fl; f++) {\r\n\r\n      var face = geometry.faces[f];\r\n      var materialIndex = usesFaceMaterial ? face.materialIndex : 0;\r\n\r\n      if (!(materialIndex in hash_map)) {\r\n\r\n        hash_map[materialIndex] = {\r\n          hash: materialIndex,\r\n          counter: 0\r\n        };\r\n\r\n      }\r\n\r\n      groupHash = hash_map[materialIndex].hash + '_' + hash_map[materialIndex].counter;\r\n\r\n      if (!(groupHash in groups)) {\r\n\r\n        group = {\r\n          id: geometryGroupCounter++,\r\n          faces3: [],\r\n          materialIndex: materialIndex,\r\n          vertices: 0,\r\n          numMorphTargets: numMorphTargets,\r\n          numMorphNormals: numMorphNormals\r\n        };\r\n\r\n        groups[groupHash] = group;\r\n        groupsList.push(group);\r\n\r\n      }\r\n\r\n      if (groups[groupHash].vertices + 3 > maxVerticesInGroup) {\r\n\r\n        hash_map[materialIndex].counter += 1;\r\n        groupHash = hash_map[materialIndex].hash + '_' + hash_map[materialIndex].counter;\r\n\r\n        if (!(groupHash in groups)) {\r\n\r\n          group = {\r\n            id: geometryGroupCounter++,\r\n            faces3: [],\r\n            materialIndex: materialIndex,\r\n            vertices: 0,\r\n            numMorphTargets: numMorphTargets,\r\n            numMorphNormals: numMorphNormals\r\n          };\r\n\r\n          groups[groupHash] = group;\r\n          groupsList.push(group);\r\n\r\n        }\r\n\r\n      }\r\n\r\n      groups[groupHash].faces3.push(f);\r\n      groups[groupHash].vertices += 3;\r\n\r\n    }\r\n\r\n    return groupsList;\r\n\r\n  }\r\n\r\n  function initGeometryGroups(object, geometry) {\r\n\r\n    var material = object.material,\r\n      addBuffers = false;\r\n\r\n    if (geometryGroups[geometry.id] === undefined || geometry.groupsNeedUpdate === true) {\r\n\r\n      delete _webglObjects[object.id];\r\n\r\n      geometryGroups[geometry.id] = makeGroups(geometry, material instanceof THREE.MeshFaceMaterial);\r\n\r\n      geometry.groupsNeedUpdate = false;\r\n\r\n    }\r\n\r\n    var geometryGroupsList = geometryGroups[geometry.id];\r\n\r\n    // create separate VBOs per geometry chunk\r\n\r\n    for (var i = 0, il = geometryGroupsList.length; i < il; i++) {\r\n\r\n      var geometryGroup = geometryGroupsList[i];\r\n\r\n      // initialise VBO on the first access\r\n\r\n      if (geometryGroup.__webglVertexBuffer === undefined) {\r\n\r\n        createMeshBuffers(geometryGroup);\r\n        initMeshBuffers(geometryGroup, object);\r\n\r\n        geometry.verticesNeedUpdate = true;\r\n        geometry.morphTargetsNeedUpdate = true;\r\n        geometry.elementsNeedUpdate = true;\r\n        geometry.uvsNeedUpdate = true;\r\n        geometry.normalsNeedUpdate = true;\r\n        geometry.tangentsNeedUpdate = true;\r\n        geometry.colorsNeedUpdate = true;\r\n\r\n        addBuffers = true;\r\n\r\n      }\r\n      else {\r\n\r\n        addBuffers = false;\r\n\r\n      }\r\n\r\n      if (addBuffers || object.__webglActive === undefined) {\r\n\r\n        addBuffer(_webglObjects, geometryGroup, object);\r\n\r\n      }\r\n\r\n    }\r\n\r\n    object.__webglActive = true;\r\n\r\n  }\r\n\r\n  function addBuffer(objlist, buffer, object) {\r\n\r\n    var id = object.id;\r\n    objlist[id] = objlist[id] || [];\r\n    objlist[id].push({\r\n      id: id,\r\n      buffer: buffer,\r\n      object: object,\r\n      material: null,\r\n      z: 0\r\n    });\r\n\r\n  };\r\n\r\n  function addBufferImmediate(objlist, object) {\r\n\r\n    objlist.push({\r\n      id: null,\r\n      object: object,\r\n      opaque: null,\r\n      transparent: null,\r\n      z: 0\r\n    });\r\n\r\n  };\r\n\r\n  // Objects updates\r\n\r\n  function updateObject(object) {\r\n\r\n    var geometry = object.geometry;\r\n\r\n    if (geometry instanceof THREE.BufferGeometry) {\r\n\r\n      var attributes = geometry.attributes;\r\n      var attributesKeys = geometry.attributesKeys;\r\n\r\n      for (var i = 0, l = attributesKeys.length; i < l; i++) {\r\n\r\n        var key = attributesKeys[i];\r\n        var attribute = attributes[key];\r\n        var bufferType = (key === 'index') ? _gl.ELEMENT_ARRAY_BUFFER : _gl.ARRAY_BUFFER;\r\n\r\n        if (attribute.buffer === undefined) {\r\n\r\n          attribute.buffer = _gl.createBuffer();\r\n          _gl.bindBuffer(bufferType, attribute.buffer);\r\n          _gl.bufferData(bufferType, attribute.array, (attribute instanceof THREE.DynamicBufferAttribute) ? _gl.DYNAMIC_DRAW : _gl.STATIC_DRAW);\r\n\r\n          attribute.needsUpdate = false;\r\n\r\n        }\r\n        else if (attribute.needsUpdate === true) {\r\n\r\n          _gl.bindBuffer(bufferType, attribute.buffer);\r\n\r\n          if (attribute.updateRange === undefined || attribute.updateRange.count === -1) { // Not using update ranges\r\n\r\n            _gl.bufferSubData(bufferType, 0, attribute.array);\r\n\r\n          }\r\n          else if (attribute.updateRange.count === 0) {\r\n\r\n            console.error('THREE.WebGLRenderer.updateObject: using updateRange for THREE.DynamicBufferAttribute and marked as needsUpdate but count is 0, ensure you are using set methods or updating manually.');\r\n\r\n          }\r\n          else {\r\n\r\n            _gl.bufferSubData(bufferType, attribute.updateRange.offset * attribute.array.BYTES_PER_ELEMENT,\r\n              attribute.array.subarray(attribute.updateRange.offset, attribute.updateRange.offset + attribute.updateRange.count));\r\n\r\n            attribute.updateRange.count = 0; // reset range\r\n\r\n          }\r\n\r\n          attribute.needsUpdate = false;\r\n\r\n        }\r\n\r\n      }\r\n\r\n    }\r\n    else if (object instanceof THREE.Mesh) {\r\n\r\n      // check all geometry groups\r\n\r\n      if (geometry.groupsNeedUpdate === true) {\r\n\r\n        initGeometryGroups(object, geometry);\r\n\r\n      }\r\n\r\n      var geometryGroupsList = geometryGroups[geometry.id];\r\n\r\n      for (var i = 0, il = geometryGroupsList.length; i < il; i++) {\r\n\r\n        var geometryGroup = geometryGroupsList[i];\r\n        var material = getBufferMaterial(object, geometryGroup);\r\n\r\n        var customAttributesDirty = material.attributes && areCustomAttributesDirty(material);\r\n\r\n        if (geometry.verticesNeedUpdate || geometry.morphTargetsNeedUpdate || geometry.elementsNeedUpdate ||\r\n          geometry.uvsNeedUpdate || geometry.normalsNeedUpdate ||\r\n          geometry.colorsNeedUpdate || geometry.tangentsNeedUpdate || customAttributesDirty) {\r\n\r\n          setMeshBuffers(geometryGroup, object, _gl.DYNAMIC_DRAW, !geometry.dynamic, material);\r\n\r\n        }\r\n\r\n      }\r\n\r\n      geometry.verticesNeedUpdate = false;\r\n      geometry.morphTargetsNeedUpdate = false;\r\n      geometry.elementsNeedUpdate = false;\r\n      geometry.uvsNeedUpdate = false;\r\n      geometry.normalsNeedUpdate = false;\r\n      geometry.colorsNeedUpdate = false;\r\n      geometry.tangentsNeedUpdate = false;\r\n\r\n      material.attributes && clearCustomAttributes(material);\r\n\r\n    }\r\n    else if (object instanceof THREE.Line) {\r\n\r\n      var material = getBufferMaterial(object, geometry);\r\n      var customAttributesDirty = material.attributes && areCustomAttributesDirty(material);\r\n\r\n      if (geometry.verticesNeedUpdate || geometry.colorsNeedUpdate || geometry.lineDistancesNeedUpdate || customAttributesDirty) {\r\n\r\n        setLineBuffers(geometry, _gl.DYNAMIC_DRAW);\r\n\r\n      }\r\n\r\n      geometry.verticesNeedUpdate = false;\r\n      geometry.colorsNeedUpdate = false;\r\n      geometry.lineDistancesNeedUpdate = false;\r\n\r\n      material.attributes && clearCustomAttributes(material);\r\n\r\n    }\r\n    else if (object instanceof THREE.PointCloud) {\r\n\r\n      var material = getBufferMaterial(object, geometry);\r\n      var customAttributesDirty = material.attributes && areCustomAttributesDirty(material);\r\n\r\n      if (geometry.verticesNeedUpdate || geometry.colorsNeedUpdate || customAttributesDirty) {\r\n\r\n        setParticleBuffers(geometry, _gl.DYNAMIC_DRAW, object);\r\n\r\n      }\r\n\r\n      geometry.verticesNeedUpdate = false;\r\n      geometry.colorsNeedUpdate = false;\r\n\r\n      material.attributes && clearCustomAttributes(material);\r\n\r\n    }\r\n\r\n  }\r\n\r\n  // Objects updates - custom attributes check\r\n\r\n  function areCustomAttributesDirty(material) {\r\n\r\n    for (var name in material.attributes) {\r\n\r\n      if (material.attributes[name].needsUpdate) return true;\r\n\r\n    }\r\n\r\n    return false;\r\n\r\n  }\r\n\r\n  function clearCustomAttributes(material) {\r\n\r\n    for (var name in material.attributes) {\r\n\r\n      material.attributes[name].needsUpdate = false;\r\n\r\n    }\r\n\r\n  }\r\n\r\n  // Objects removal\r\n\r\n  function removeObject(object) {\r\n\r\n    if (object instanceof THREE.Mesh ||\r\n      object instanceof THREE.PointCloud ||\r\n      object instanceof THREE.Line) {\r\n\r\n      delete _webglObjects[object.id];\r\n\r\n    }\r\n    else if (object instanceof THREE.ImmediateRenderObject || object.immediateRenderCallback) {\r\n\r\n      removeInstances(_webglObjectsImmediate, object);\r\n\r\n    }\r\n\r\n    delete object.__webglInit;\r\n    delete object._modelViewMatrix;\r\n    delete object._normalMatrix;\r\n\r\n    delete object.__webglActive;\r\n\r\n  }\r\n\r\n  function removeInstances(objlist, object) {\r\n\r\n    for (var o = objlist.length - 1; o >= 0; o--) {\r\n\r\n      if (objlist[o].object === object) {\r\n\r\n        objlist.splice(o, 1);\r\n\r\n      }\r\n\r\n    }\r\n\r\n  }\r\n\r\n  // Materials\r\n\r\n  var shaderIDs = {\r\n    MeshDepthMaterial: 'depth',\r\n    MeshNormalMaterial: 'normal',\r\n    MeshBasicMaterial: 'basic',\r\n    MeshLambertMaterial: 'lambert',\r\n    MeshPhongMaterial: 'phong',\r\n    LineBasicMaterial: 'basic',\r\n    LineDashedMaterial: 'dashed',\r\n    PointCloudMaterial: 'particle_basic'\r\n  };\r\n\r\n  function initMaterial(material, lights, fog, object) {\r\n\r\n    material.addEventListener('dispose', onMaterialDispose);\r\n\r\n    var shaderID = shaderIDs[material.type];\r\n\r\n    if (shaderID) {\r\n\r\n      var shader = THREE.ShaderLib[shaderID];\r\n\r\n      material.__webglShader = {\r\n        uniforms: THREE.UniformsUtils.clone(shader.uniforms),\r\n        vertexShader: shader.vertexShader,\r\n        fragmentShader: shader.fragmentShader\r\n      }\r\n\r\n    }\r\n    else {\r\n\r\n      material.__webglShader = {\r\n        uniforms: material.uniforms,\r\n        vertexShader: material.vertexShader,\r\n        fragmentShader: material.fragmentShader\r\n      }\r\n\r\n    }\r\n\r\n    // heuristics to create shader parameters according to lights in the scene\r\n    // (not to blow over maxLights budget)\r\n\r\n    var maxLightCount = allocateLights(lights);\r\n    var maxShadows = allocateShadows(lights);\r\n    var maxBones = allocateBones(object);\r\n\r\n    var parameters = {\r\n\r\n      precision: _precision,\r\n      supportsVertexTextures: _supportsVertexTextures,\r\n\r\n      map: !!material.map,\r\n      envMap: !!material.envMap,\r\n      envMapMode: material.envMap && material.envMap.mapping,\r\n      lightMap: !!material.lightMap,\r\n      bumpMap: !!material.bumpMap,\r\n      normalMap: !!material.normalMap,\r\n      specularMap: !!material.specularMap,\r\n      alphaMap: !!material.alphaMap,\r\n\r\n      combine: material.combine,\r\n\r\n      vertexColors: material.vertexColors,\r\n\r\n      fog: fog,\r\n      useFog: material.fog,\r\n      fogExp: fog instanceof THREE.FogExp2,\r\n\r\n      flatShading: material.shading === THREE.FlatShading,\r\n\r\n      sizeAttenuation: material.sizeAttenuation,\r\n      logarithmicDepthBuffer: _logarithmicDepthBuffer,\r\n\r\n      skinning: material.skinning,\r\n      maxBones: maxBones,\r\n      useVertexTexture: _supportsBoneTextures && object && object.skeleton && object.skeleton.useVertexTexture,\r\n\r\n      morphTargets: material.morphTargets,\r\n      morphNormals: material.morphNormals,\r\n      maxMorphTargets: _this.maxMorphTargets,\r\n      maxMorphNormals: _this.maxMorphNormals,\r\n\r\n      maxDirLights: maxLightCount.directional,\r\n      maxPointLights: maxLightCount.point,\r\n      maxSpotLights: maxLightCount.spot,\r\n      maxHemiLights: maxLightCount.hemi,\r\n\r\n      maxShadows: maxShadows,\r\n      shadowMapEnabled: _this.shadowMapEnabled && object.receiveShadow && maxShadows > 0,\r\n      shadowMapType: _this.shadowMapType,\r\n      shadowMapDebug: _this.shadowMapDebug,\r\n      shadowMapCascade: _this.shadowMapCascade,\r\n\r\n      alphaTest: material.alphaTest,\r\n      metal: material.metal,\r\n      wrapAround: material.wrapAround,\r\n      doubleSided: material.side === THREE.DoubleSide,\r\n      flipSided: material.side === THREE.BackSide\r\n\r\n    };\r\n\r\n    // Generate code\r\n\r\n    var chunks = [];\r\n\r\n    if (shaderID) {\r\n\r\n      chunks.push(shaderID);\r\n\r\n    }\r\n    else {\r\n\r\n      chunks.push(material.fragmentShader);\r\n      chunks.push(material.vertexShader);\r\n\r\n    }\r\n\r\n    if (material.defines !== undefined) {\r\n\r\n      for (var name in material.defines) {\r\n\r\n        chunks.push(name);\r\n        chunks.push(material.defines[name]);\r\n\r\n      }\r\n\r\n    }\r\n\r\n    for (var name in parameters) {\r\n\r\n      chunks.push(name);\r\n      chunks.push(parameters[name]);\r\n\r\n    }\r\n\r\n    var code = chunks.join();\r\n\r\n    var program;\r\n\r\n    // Check if code has been already compiled\r\n\r\n    for (var p = 0, pl = _programs.length; p < pl; p++) {\r\n\r\n      var programInfo = _programs[p];\r\n\r\n      if (programInfo.code === code) {\r\n\r\n        program = programInfo;\r\n        program.usedTimes++;\r\n\r\n        break;\r\n\r\n      }\r\n\r\n    }\r\n\r\n    if (program === undefined) {\r\n\r\n      program = new THREE.WebGLProgram(_this, code, material, parameters);\r\n      _programs.push(program);\r\n\r\n      _this.info.memory.programs = _programs.length;\r\n\r\n    }\r\n\r\n    material.program = program;\r\n\r\n    var attributes = program.attributes;\r\n\r\n    if (material.morphTargets) {\r\n\r\n      material.numSupportedMorphTargets = 0;\r\n\r\n      var id, base = 'morphTarget';\r\n\r\n      for (var i = 0; i < _this.maxMorphTargets; i++) {\r\n\r\n        id = base + i;\r\n\r\n        if (attributes[id] >= 0) {\r\n\r\n          material.numSupportedMorphTargets++;\r\n\r\n        }\r\n\r\n      }\r\n\r\n    }\r\n\r\n    if (material.morphNormals) {\r\n\r\n      material.numSupportedMorphNormals = 0;\r\n\r\n      var id, base = 'morphNormal';\r\n\r\n      for (i = 0; i < _this.maxMorphNormals; i++) {\r\n\r\n        id = base + i;\r\n\r\n        if (attributes[id] >= 0) {\r\n\r\n          material.numSupportedMorphNormals++;\r\n\r\n        }\r\n\r\n      }\r\n\r\n    }\r\n\r\n    material.uniformsList = [];\r\n\r\n    for (var u in material.__webglShader.uniforms) {\r\n\r\n      var location = material.program.uniforms[u];\r\n\r\n      if (location) {\r\n        material.uniformsList.push([material.__webglShader.uniforms[u], location]);\r\n      }\r\n\r\n    }\r\n\r\n  }\r\n\r\n  function setMaterial(material) {\r\n\r\n    if (material.transparent === true) {\r\n\r\n      state.setBlending(material.blending, material.blendEquation, material.blendSrc, material.blendDst, material.blendEquationAlpha, material.blendSrcAlpha, material.blendDstAlpha);\r\n\r\n    }\r\n    else {\r\n\r\n      state.setBlending(THREE.NoBlending);\r\n\r\n    }\r\n\r\n    state.setDepthTest(material.depthTest);\r\n    state.setDepthWrite(material.depthWrite);\r\n    state.setColorWrite(material.colorWrite);\r\n    state.setPolygonOffset(material.polygonOffset, material.polygonOffsetFactor, material.polygonOffsetUnits);\r\n\r\n  }\r\n\r\n  function setProgram(camera, lights, fog, material, object) {\r\n\r\n    _usedTextureUnits = 0;\r\n\r\n    if (material.needsUpdate) {\r\n\r\n      if (material.program) deallocateMaterial(material);\r\n\r\n      initMaterial(material, lights, fog, object);\r\n      material.needsUpdate = false;\r\n\r\n    }\r\n\r\n    if (material.morphTargets) {\r\n\r\n      if (!object.__webglMorphTargetInfluences) {\r\n\r\n        object.__webglMorphTargetInfluences = new Float32Array(_this.maxMorphTargets);\r\n\r\n      }\r\n\r\n    }\r\n\r\n    var refreshProgram = false;\r\n    var refreshMaterial = false;\r\n    var refreshLights = false;\r\n\r\n    var program = material.program,\r\n      p_uniforms = program.uniforms,\r\n      m_uniforms = material.__webglShader.uniforms;\r\n\r\n    if (program.id !== _currentProgram) {\r\n\r\n      _gl.useProgram(program.program);\r\n      _currentProgram = program.id;\r\n\r\n      refreshProgram = true;\r\n      refreshMaterial = true;\r\n      refreshLights = true;\r\n\r\n    }\r\n\r\n    if (material.id !== _currentMaterialId) {\r\n\r\n      if (_currentMaterialId === -1) refreshLights = true;\r\n      _currentMaterialId = material.id;\r\n\r\n      refreshMaterial = true;\r\n\r\n    }\r\n\r\n    if (refreshProgram || camera !== _currentCamera) {\r\n\r\n      _gl.uniformMatrix4fv(p_uniforms.projectionMatrix, false, camera.projectionMatrix.elements);\r\n\r\n      if (_logarithmicDepthBuffer) {\r\n\r\n        _gl.uniform1f(p_uniforms.logDepthBufFC, 2.0 / (Math.log(camera.far + 1.0) / Math.LN2));\r\n\r\n      }\r\n\r\n\r\n      if (camera !== _currentCamera) _currentCamera = camera;\r\n\r\n      // load material specific uniforms\r\n      // (shader material also gets them for the sake of genericity)\r\n\r\n      if (material instanceof THREE.ShaderMaterial ||\r\n        material instanceof THREE.MeshPhongMaterial ||\r\n        material.envMap) {\r\n\r\n        if (p_uniforms.cameraPosition !== null) {\r\n\r\n          _vector3.setFromMatrixPosition(camera.matrixWorld);\r\n          _gl.uniform3f(p_uniforms.cameraPosition, _vector3.x, _vector3.y, _vector3.z);\r\n\r\n        }\r\n\r\n      }\r\n\r\n      if (material instanceof THREE.MeshPhongMaterial ||\r\n        material instanceof THREE.MeshLambertMaterial ||\r\n        material instanceof THREE.MeshBasicMaterial ||\r\n        material instanceof THREE.ShaderMaterial ||\r\n        material.skinning) {\r\n\r\n        if (p_uniforms.viewMatrix !== null) {\r\n\r\n          _gl.uniformMatrix4fv(p_uniforms.viewMatrix, false, camera.matrixWorldInverse.elements);\r\n\r\n        }\r\n\r\n      }\r\n\r\n    }\r\n\r\n    // skinning uniforms must be set even if material didn't change\r\n    // auto-setting of texture unit for bone texture must go before other textures\r\n    // not sure why, but otherwise weird things happen\r\n\r\n    if (material.skinning) {\r\n\r\n      if (object.bindMatrix && p_uniforms.bindMatrix !== null) {\r\n\r\n        _gl.uniformMatrix4fv(p_uniforms.bindMatrix, false, object.bindMatrix.elements);\r\n\r\n      }\r\n\r\n      if (object.bindMatrixInverse && p_uniforms.bindMatrixInverse !== null) {\r\n\r\n        _gl.uniformMatrix4fv(p_uniforms.bindMatrixInverse, false, object.bindMatrixInverse.elements);\r\n\r\n      }\r\n\r\n      if (_supportsBoneTextures && object.skeleton && object.skeleton.useVertexTexture) {\r\n\r\n        if (p_uniforms.boneTexture !== null) {\r\n\r\n          var textureUnit = getTextureUnit();\r\n\r\n          _gl.uniform1i(p_uniforms.boneTexture, textureUnit);\r\n          _this.setTexture(object.skeleton.boneTexture, textureUnit);\r\n\r\n        }\r\n\r\n        if (p_uniforms.boneTextureWidth !== null) {\r\n\r\n          _gl.uniform1i(p_uniforms.boneTextureWidth, object.skeleton.boneTextureWidth);\r\n\r\n        }\r\n\r\n        if (p_uniforms.boneTextureHeight !== null) {\r\n\r\n          _gl.uniform1i(p_uniforms.boneTextureHeight, object.skeleton.boneTextureHeight);\r\n\r\n        }\r\n\r\n      }\r\n      else if (object.skeleton && object.skeleton.boneMatrices) {\r\n\r\n        if (p_uniforms.boneGlobalMatrices !== null) {\r\n\r\n          _gl.uniformMatrix4fv(p_uniforms.boneGlobalMatrices, false, object.skeleton.boneMatrices);\r\n\r\n        }\r\n\r\n      }\r\n\r\n    }\r\n\r\n    if (refreshMaterial) {\r\n\r\n      // refresh uniforms common to several materials\r\n\r\n      if (fog && material.fog) {\r\n\r\n        refreshUniformsFog(m_uniforms, fog);\r\n\r\n      }\r\n\r\n      if (material instanceof THREE.MeshPhongMaterial ||\r\n        material instanceof THREE.MeshLambertMaterial ||\r\n        material.lights) {\r\n\r\n        if (_lightsNeedUpdate) {\r\n\r\n          refreshLights = true;\r\n          setupLights(lights);\r\n          _lightsNeedUpdate = false;\r\n        }\r\n\r\n        if (refreshLights) {\r\n          refreshUniformsLights(m_uniforms, _lights);\r\n          markUniformsLightsNeedsUpdate(m_uniforms, true);\r\n        }\r\n        else {\r\n          markUniformsLightsNeedsUpdate(m_uniforms, false);\r\n        }\r\n\r\n      }\r\n\r\n      if (material instanceof THREE.MeshBasicMaterial ||\r\n        material instanceof THREE.MeshLambertMaterial ||\r\n        material instanceof THREE.MeshPhongMaterial) {\r\n\r\n        refreshUniformsCommon(m_uniforms, material);\r\n\r\n      }\r\n\r\n      // refresh single material specific uniforms\r\n\r\n      if (material instanceof THREE.LineBasicMaterial) {\r\n\r\n        refreshUniformsLine(m_uniforms, material);\r\n\r\n      }\r\n      else if (material instanceof THREE.LineDashedMaterial) {\r\n\r\n        refreshUniformsLine(m_uniforms, material);\r\n        refreshUniformsDash(m_uniforms, material);\r\n\r\n      }\r\n      else if (material instanceof THREE.PointCloudMaterial) {\r\n\r\n        refreshUniformsParticle(m_uniforms, material);\r\n\r\n      }\r\n      else if (material instanceof THREE.MeshPhongMaterial) {\r\n\r\n        refreshUniformsPhong(m_uniforms, material);\r\n\r\n      }\r\n      else if (material instanceof THREE.MeshLambertMaterial) {\r\n\r\n        refreshUniformsLambert(m_uniforms, material);\r\n\r\n      }\r\n      else if (material instanceof THREE.MeshDepthMaterial) {\r\n\r\n        m_uniforms.mNear.value = camera.near;\r\n        m_uniforms.mFar.value = camera.far;\r\n        m_uniforms.opacity.value = material.opacity;\r\n\r\n      }\r\n      else if (material instanceof THREE.MeshNormalMaterial) {\r\n\r\n        m_uniforms.opacity.value = material.opacity;\r\n\r\n      }\r\n\r\n      if (object.receiveShadow && !material._shadowPass) {\r\n\r\n        refreshUniformsShadow(m_uniforms, lights);\r\n\r\n      }\r\n\r\n      // load common uniforms\r\n\r\n      loadUniformsGeneric(material.uniformsList);\r\n\r\n    }\r\n\r\n    loadUniformsMatrices(p_uniforms, object);\r\n\r\n    if (p_uniforms.modelMatrix !== null) {\r\n\r\n      _gl.uniformMatrix4fv(p_uniforms.modelMatrix, false, object.matrixWorld.elements);\r\n\r\n    }\r\n\r\n    return program;\r\n\r\n  }\r\n\r\n  // Uniforms (refresh uniforms objects)\r\n\r\n  function refreshUniformsCommon(uniforms, material) {\r\n\r\n    uniforms.opacity.value = material.opacity;\r\n\r\n    uniforms.diffuse.value = material.color;\r\n\r\n    uniforms.map.value = material.map;\r\n    uniforms.lightMap.value = material.lightMap;\r\n    uniforms.specularMap.value = material.specularMap;\r\n    uniforms.alphaMap.value = material.alphaMap;\r\n\r\n    if (material.bumpMap) {\r\n\r\n      uniforms.bumpMap.value = material.bumpMap;\r\n      uniforms.bumpScale.value = material.bumpScale;\r\n\r\n    }\r\n\r\n    if (material.normalMap) {\r\n\r\n      uniforms.normalMap.value = material.normalMap;\r\n      uniforms.normalScale.value.copy(material.normalScale);\r\n\r\n    }\r\n\r\n    // uv repeat and offset setting priorities\r\n    //  1. color map\r\n    //  2. specular map\r\n    //  3. normal map\r\n    //  4. bump map\r\n    //  5. alpha map\r\n\r\n    var uvScaleMap;\r\n\r\n    if (material.map) {\r\n\r\n      uvScaleMap = material.map;\r\n\r\n    }\r\n    else if (material.specularMap) {\r\n\r\n      uvScaleMap = material.specularMap;\r\n\r\n    }\r\n    else if (material.normalMap) {\r\n\r\n      uvScaleMap = material.normalMap;\r\n\r\n    }\r\n    else if (material.bumpMap) {\r\n\r\n      uvScaleMap = material.bumpMap;\r\n\r\n    }\r\n    else if (material.alphaMap) {\r\n\r\n      uvScaleMap = material.alphaMap;\r\n\r\n    }\r\n\r\n    if (uvScaleMap !== undefined) {\r\n\r\n      var offset = uvScaleMap.offset;\r\n      var repeat = uvScaleMap.repeat;\r\n\r\n      uniforms.offsetRepeat.value.set(offset.x, offset.y, repeat.x, repeat.y);\r\n\r\n    }\r\n\r\n    uniforms.envMap.value = material.envMap;\r\n    uniforms.flipEnvMap.value = (material.envMap instanceof THREE.WebGLRenderTargetCube) ? 1 : -1;\r\n\r\n    uniforms.reflectivity.value = material.reflectivity;\r\n    uniforms.refractionRatio.value = material.refractionRatio;\r\n\r\n  }\r\n\r\n  function refreshUniformsLine(uniforms, material) {\r\n\r\n    uniforms.diffuse.value = material.color;\r\n    uniforms.opacity.value = material.opacity;\r\n\r\n  }\r\n\r\n  function refreshUniformsDash(uniforms, material) {\r\n\r\n    uniforms.dashSize.value = material.dashSize;\r\n    uniforms.totalSize.value = material.dashSize + material.gapSize;\r\n    uniforms.scale.value = material.scale;\r\n\r\n  }\r\n\r\n  function refreshUniformsParticle(uniforms, material) {\r\n\r\n    uniforms.psColor.value = material.color;\r\n    uniforms.opacity.value = material.opacity;\r\n    uniforms.size.value = material.size;\r\n    uniforms.scale.value = _canvas.height / 2.0; // TODO: Cache this.\r\n\r\n    uniforms.map.value = material.map;\r\n\r\n    if (material.map !== null) {\r\n\r\n      var offset = material.map.offset;\r\n      var repeat = material.map.repeat;\r\n\r\n      uniforms.offsetRepeat.value.set(offset.x, offset.y, repeat.x, repeat.y);\r\n\r\n    }\r\n\r\n  }\r\n\r\n  function refreshUniformsFog(uniforms, fog) {\r\n\r\n    uniforms.fogColor.value = fog.color;\r\n\r\n    if (fog instanceof THREE.Fog) {\r\n\r\n      uniforms.fogNear.value = fog.near;\r\n      uniforms.fogFar.value = fog.far;\r\n\r\n    }\r\n    else if (fog instanceof THREE.FogExp2) {\r\n\r\n      uniforms.fogDensity.value = fog.density;\r\n\r\n    }\r\n\r\n  }\r\n\r\n  function refreshUniformsPhong(uniforms, material) {\r\n\r\n    uniforms.shininess.value = material.shininess;\r\n\r\n    uniforms.emissive.value = material.emissive;\r\n    uniforms.specular.value = material.specular;\r\n\r\n    if (material.wrapAround) {\r\n\r\n      uniforms.wrapRGB.value.copy(material.wrapRGB);\r\n\r\n    }\r\n\r\n  }\r\n\r\n  function refreshUniformsLambert(uniforms, material) {\r\n\r\n    uniforms.emissive.value = material.emissive;\r\n\r\n    if (material.wrapAround) {\r\n\r\n      uniforms.wrapRGB.value.copy(material.wrapRGB);\r\n\r\n    }\r\n\r\n  }\r\n\r\n  function refreshUniformsLights(uniforms, lights) {\r\n\r\n    uniforms.ambientLightColor.value = lights.ambient;\r\n\r\n    uniforms.directionalLightColor.value = lights.directional.colors;\r\n    uniforms.directionalLightDirection.value = lights.directional.positions;\r\n\r\n    uniforms.pointLightColor.value = lights.point.colors;\r\n    uniforms.pointLightPosition.value = lights.point.positions;\r\n    uniforms.pointLightDistance.value = lights.point.distances;\r\n    uniforms.pointLightDecay.value = lights.point.decays;\r\n\r\n    uniforms.spotLightColor.value = lights.spot.colors;\r\n    uniforms.spotLightPosition.value = lights.spot.positions;\r\n    uniforms.spotLightDistance.value = lights.spot.distances;\r\n    uniforms.spotLightDirection.value = lights.spot.directions;\r\n    uniforms.spotLightAngleCos.value = lights.spot.anglesCos;\r\n    uniforms.spotLightExponent.value = lights.spot.exponents;\r\n    uniforms.spotLightDecay.value = lights.spot.decays;\r\n\r\n    uniforms.hemisphereLightSkyColor.value = lights.hemi.skyColors;\r\n    uniforms.hemisphereLightGroundColor.value = lights.hemi.groundColors;\r\n    uniforms.hemisphereLightDirection.value = lights.hemi.positions;\r\n\r\n  }\r\n\r\n  // If uniforms are marked as clean, they don't need to be loaded to the GPU.\r\n\r\n  function markUniformsLightsNeedsUpdate(uniforms, value) {\r\n\r\n    uniforms.ambientLightColor.needsUpdate = value;\r\n\r\n    uniforms.directionalLightColor.needsUpdate = value;\r\n    uniforms.directionalLightDirection.needsUpdate = value;\r\n\r\n    uniforms.pointLightColor.needsUpdate = value;\r\n    uniforms.pointLightPosition.needsUpdate = value;\r\n    uniforms.pointLightDistance.needsUpdate = value;\r\n    uniforms.pointLightDecay.needsUpdate = value;\r\n\r\n    uniforms.spotLightColor.needsUpdate = value;\r\n    uniforms.spotLightPosition.needsUpdate = value;\r\n    uniforms.spotLightDistance.needsUpdate = value;\r\n    uniforms.spotLightDirection.needsUpdate = value;\r\n    uniforms.spotLightAngleCos.needsUpdate = value;\r\n    uniforms.spotLightExponent.needsUpdate = value;\r\n    uniforms.spotLightDecay.needsUpdate = value;\r\n\r\n    uniforms.hemisphereLightSkyColor.needsUpdate = value;\r\n    uniforms.hemisphereLightGroundColor.needsUpdate = value;\r\n    uniforms.hemisphereLightDirection.needsUpdate = value;\r\n\r\n  }\r\n\r\n  function refreshUniformsShadow(uniforms, lights) {\r\n\r\n    if (uniforms.shadowMatrix) {\r\n\r\n      var j = 0;\r\n\r\n      for (var i = 0, il = lights.length; i < il; i++) {\r\n\r\n        var light = lights[i];\r\n\r\n        if (!light.castShadow) continue;\r\n\r\n        if (light instanceof THREE.SpotLight || (light instanceof THREE.DirectionalLight && !light.shadowCascade)) {\r\n\r\n          uniforms.shadowMap.value[j] = light.shadowMap;\r\n          uniforms.shadowMapSize.value[j] = light.shadowMapSize;\r\n\r\n          uniforms.shadowMatrix.value[j] = light.shadowMatrix;\r\n\r\n          uniforms.shadowDarkness.value[j] = light.shadowDarkness;\r\n          uniforms.shadowBias.value[j] = light.shadowBias;\r\n\r\n          j++;\r\n\r\n        }\r\n\r\n      }\r\n\r\n    }\r\n\r\n  }\r\n\r\n  // Uniforms (load to GPU)\r\n\r\n  function loadUniformsMatrices(uniforms, object) {\r\n\r\n    _gl.uniformMatrix4fv(uniforms.modelViewMatrix, false, object._modelViewMatrix.elements);\r\n\r\n    if (uniforms.normalMatrix) {\r\n\r\n      _gl.uniformMatrix3fv(uniforms.normalMatrix, false, object._normalMatrix.elements);\r\n\r\n    }\r\n\r\n  }\r\n\r\n  function getTextureUnit() {\r\n\r\n    var textureUnit = _usedTextureUnits;\r\n\r\n    if (textureUnit >= _maxTextures) {\r\n\r\n      THREE.warn('WebGLRenderer: trying to use ' + textureUnit + ' texture units while this GPU supports only ' + _maxTextures);\r\n\r\n    }\r\n\r\n    _usedTextureUnits += 1;\r\n\r\n    return textureUnit;\r\n\r\n  }\r\n\r\n  function loadUniformsGeneric(uniforms) {\r\n\r\n    var texture, textureUnit, offset;\r\n\r\n    for (var j = 0, jl = uniforms.length; j < jl; j++) {\r\n\r\n      var uniform = uniforms[j][0];\r\n\r\n      // needsUpdate property is not added to all uniforms.\r\n      if (uniform.needsUpdate === false) continue;\r\n\r\n      var type = uniform.type;\r\n      var value = uniform.value;\r\n      var location = uniforms[j][1];\r\n\r\n      switch (type) {\r\n\r\n        case '1i':\r\n          _gl.uniform1i(location, value);\r\n          break;\r\n\r\n        case '1f':\r\n          _gl.uniform1f(location, value);\r\n          break;\r\n\r\n        case '2f':\r\n          _gl.uniform2f(location, value[0], value[1]);\r\n          break;\r\n\r\n        case '3f':\r\n          _gl.uniform3f(location, value[0], value[1], value[2]);\r\n          break;\r\n\r\n        case '4f':\r\n          _gl.uniform4f(location, value[0], value[1], value[2], value[3]);\r\n          break;\r\n\r\n        case '1iv':\r\n          _gl.uniform1iv(location, value);\r\n          break;\r\n\r\n        case '3iv':\r\n          _gl.uniform3iv(location, value);\r\n          break;\r\n\r\n        case '1fv':\r\n          _gl.uniform1fv(location, value);\r\n          break;\r\n\r\n        case '2fv':\r\n          _gl.uniform2fv(location, value);\r\n          break;\r\n\r\n        case '3fv':\r\n          _gl.uniform3fv(location, value);\r\n          break;\r\n\r\n        case '4fv':\r\n          _gl.uniform4fv(location, value);\r\n          break;\r\n\r\n        case 'Matrix3fv':\r\n          _gl.uniformMatrix3fv(location, false, value);\r\n          break;\r\n\r\n        case 'Matrix4fv':\r\n          _gl.uniformMatrix4fv(location, false, value);\r\n          break;\r\n\r\n          //\r\n\r\n        case 'i':\r\n\r\n          // single integer\r\n          _gl.uniform1i(location, value);\r\n\r\n          break;\r\n\r\n        case 'f':\r\n\r\n          // single float\r\n          _gl.uniform1f(location, value);\r\n\r\n          break;\r\n\r\n        case 'v2':\r\n\r\n          // single THREE.Vector2\r\n          _gl.uniform2f(location, value.x, value.y);\r\n\r\n          break;\r\n\r\n        case 'v3':\r\n\r\n          // single THREE.Vector3\r\n          _gl.uniform3f(location, value.x, value.y, value.z);\r\n\r\n          break;\r\n\r\n        case 'v4':\r\n\r\n          // single THREE.Vector4\r\n          _gl.uniform4f(location, value.x, value.y, value.z, value.w);\r\n\r\n          break;\r\n\r\n        case 'c':\r\n\r\n          // single THREE.Color\r\n          _gl.uniform3f(location, value.r, value.g, value.b);\r\n\r\n          break;\r\n\r\n        case 'iv1':\r\n\r\n          // flat array of integers (JS or typed array)\r\n          _gl.uniform1iv(location, value);\r\n\r\n          break;\r\n\r\n        case 'iv':\r\n\r\n          // flat array of integers with 3 x N size (JS or typed array)\r\n          _gl.uniform3iv(location, value);\r\n\r\n          break;\r\n\r\n        case 'fv1':\r\n\r\n          // flat array of floats (JS or typed array)\r\n          _gl.uniform1fv(location, value);\r\n\r\n          break;\r\n\r\n        case 'fv':\r\n\r\n          // flat array of floats with 3 x N size (JS or typed array)\r\n          _gl.uniform3fv(location, value);\r\n\r\n          break;\r\n\r\n        case 'v2v':\r\n\r\n          // array of THREE.Vector2\r\n\r\n          if (uniform._array === undefined) {\r\n\r\n            uniform._array = new Float32Array(2 * value.length);\r\n\r\n          }\r\n\r\n          for (var i = 0, il = value.length; i < il; i++) {\r\n\r\n            offset = i * 2;\r\n\r\n            uniform._array[offset] = value[i].x;\r\n            uniform._array[offset + 1] = value[i].y;\r\n\r\n          }\r\n\r\n          _gl.uniform2fv(location, uniform._array);\r\n\r\n          break;\r\n\r\n        case 'v3v':\r\n\r\n          // array of THREE.Vector3\r\n\r\n          if (uniform._array === undefined) {\r\n\r\n            uniform._array = new Float32Array(3 * value.length);\r\n\r\n          }\r\n\r\n          for (var i = 0, il = value.length; i < il; i++) {\r\n\r\n            offset = i * 3;\r\n\r\n            uniform._array[offset] = value[i].x;\r\n            uniform._array[offset + 1] = value[i].y;\r\n            uniform._array[offset + 2] = value[i].z;\r\n\r\n          }\r\n\r\n          _gl.uniform3fv(location, uniform._array);\r\n\r\n          break;\r\n\r\n        case 'v4v':\r\n\r\n          // array of THREE.Vector4\r\n\r\n          if (uniform._array === undefined) {\r\n\r\n            uniform._array = new Float32Array(4 * value.length);\r\n\r\n          }\r\n\r\n          for (var i = 0, il = value.length; i < il; i++) {\r\n\r\n            offset = i * 4;\r\n\r\n            uniform._array[offset] = value[i].x;\r\n            uniform._array[offset + 1] = value[i].y;\r\n            uniform._array[offset + 2] = value[i].z;\r\n            uniform._array[offset + 3] = value[i].w;\r\n\r\n          }\r\n\r\n          _gl.uniform4fv(location, uniform._array);\r\n\r\n          break;\r\n\r\n        case 'm3':\r\n\r\n          // single THREE.Matrix3\r\n          _gl.uniformMatrix3fv(location, false, value.elements);\r\n\r\n          break;\r\n\r\n        case 'm3v':\r\n\r\n          // array of THREE.Matrix3\r\n\r\n          if (uniform._array === undefined) {\r\n\r\n            uniform._array = new Float32Array(9 * value.length);\r\n\r\n          }\r\n\r\n          for (var i = 0, il = value.length; i < il; i++) {\r\n\r\n            value[i].flattenToArrayOffset(uniform._array, i * 9);\r\n\r\n          }\r\n\r\n          _gl.uniformMatrix3fv(location, false, uniform._array);\r\n\r\n          break;\r\n\r\n        case 'm4':\r\n\r\n          // single THREE.Matrix4\r\n          _gl.uniformMatrix4fv(location, false, value.elements);\r\n\r\n          break;\r\n\r\n        case 'm4v':\r\n\r\n          // array of THREE.Matrix4\r\n\r\n          if (uniform._array === undefined) {\r\n\r\n            uniform._array = new Float32Array(16 * value.length);\r\n\r\n          }\r\n\r\n          for (var i = 0, il = value.length; i < il; i++) {\r\n\r\n            value[i].flattenToArrayOffset(uniform._array, i * 16);\r\n\r\n          }\r\n\r\n          _gl.uniformMatrix4fv(location, false, uniform._array);\r\n\r\n          break;\r\n\r\n        case 't':\r\n\r\n          // single THREE.Texture (2d or cube)\r\n\r\n          texture = value;\r\n          textureUnit = getTextureUnit();\r\n\r\n          _gl.uniform1i(location, textureUnit);\r\n\r\n          if (!texture) continue;\r\n\r\n          if (texture instanceof THREE.CubeTexture ||\r\n            (texture.image instanceof Array && texture.image.length === 6)) { // CompressedTexture can have Array in image :/\r\n\r\n            setCubeTexture(texture, textureUnit);\r\n\r\n          }\r\n          else if (texture instanceof THREE.WebGLRenderTargetCube) {\r\n\r\n            setCubeTextureDynamic(texture, textureUnit);\r\n\r\n          }\r\n          else {\r\n\r\n            _this.setTexture(texture, textureUnit);\r\n\r\n          }\r\n\r\n          break;\r\n\r\n        case 'tv':\r\n\r\n          // array of THREE.Texture (2d)\r\n\r\n          if (uniform._array === undefined) {\r\n\r\n            uniform._array = [];\r\n\r\n          }\r\n\r\n          for (var i = 0, il = uniform.value.length; i < il; i++) {\r\n\r\n            uniform._array[i] = getTextureUnit();\r\n\r\n          }\r\n\r\n          _gl.uniform1iv(location, uniform._array);\r\n\r\n          for (var i = 0, il = uniform.value.length; i < il; i++) {\r\n\r\n            texture = uniform.value[i];\r\n            textureUnit = uniform._array[i];\r\n\r\n            if (!texture) continue;\r\n\r\n            _this.setTexture(texture, textureUnit);\r\n\r\n          }\r\n\r\n          break;\r\n\r\n        default:\r\n\r\n          THREE.warn('THREE.WebGLRenderer: Unknown uniform type: ' + type);\r\n\r\n      }\r\n\r\n    }\r\n\r\n  }\r\n\r\n  function setupMatrices(object, camera) {\r\n\r\n    object._modelViewMatrix.multiplyMatrices(camera.matrixWorldInverse, object.matrixWorld);\r\n    object._normalMatrix.getNormalMatrix(object._modelViewMatrix);\r\n\r\n  }\r\n\r\n  function setColorLinear(array, offset, color, intensity) {\r\n\r\n    array[offset] = color.r * intensity;\r\n    array[offset + 1] = color.g * intensity;\r\n    array[offset + 2] = color.b * intensity;\r\n\r\n  }\r\n\r\n  function setupLights(lights) {\r\n\r\n    var l, ll, light,\r\n      r = 0,\r\n      g = 0,\r\n      b = 0,\r\n      color, skyColor, groundColor,\r\n      intensity,\r\n      distance,\r\n\r\n      zlights = _lights,\r\n\r\n      dirColors = zlights.directional.colors,\r\n      dirPositions = zlights.directional.positions,\r\n\r\n      pointColors = zlights.point.colors,\r\n      pointPositions = zlights.point.positions,\r\n      pointDistances = zlights.point.distances,\r\n      pointDecays = zlights.point.decays,\r\n\r\n      spotColors = zlights.spot.colors,\r\n      spotPositions = zlights.spot.positions,\r\n      spotDistances = zlights.spot.distances,\r\n      spotDirections = zlights.spot.directions,\r\n      spotAnglesCos = zlights.spot.anglesCos,\r\n      spotExponents = zlights.spot.exponents,\r\n      spotDecays = zlights.spot.decays,\r\n\r\n      hemiSkyColors = zlights.hemi.skyColors,\r\n      hemiGroundColors = zlights.hemi.groundColors,\r\n      hemiPositions = zlights.hemi.positions,\r\n\r\n      dirLength = 0,\r\n      pointLength = 0,\r\n      spotLength = 0,\r\n      hemiLength = 0,\r\n\r\n      dirCount = 0,\r\n      pointCount = 0,\r\n      spotCount = 0,\r\n      hemiCount = 0,\r\n\r\n      dirOffset = 0,\r\n      pointOffset = 0,\r\n      spotOffset = 0,\r\n      hemiOffset = 0;\r\n\r\n    for (l = 0, ll = lights.length; l < ll; l++) {\r\n\r\n      light = lights[l];\r\n\r\n      if (light.onlyShadow) continue;\r\n\r\n      color = light.color;\r\n      intensity = light.intensity;\r\n      distance = light.distance;\r\n\r\n      if (light instanceof THREE.AmbientLight) {\r\n\r\n        if (!light.visible) continue;\r\n\r\n        r += color.r;\r\n        g += color.g;\r\n        b += color.b;\r\n\r\n      }\r\n      else if (light instanceof THREE.DirectionalLight) {\r\n\r\n        dirCount += 1;\r\n\r\n        if (!light.visible) continue;\r\n\r\n        _direction.setFromMatrixPosition(light.matrixWorld);\r\n        _vector3.setFromMatrixPosition(light.target.matrixWorld);\r\n        _direction.sub(_vector3);\r\n        _direction.normalize();\r\n\r\n        dirOffset = dirLength * 3;\r\n\r\n        dirPositions[dirOffset] = _direction.x;\r\n        dirPositions[dirOffset + 1] = _direction.y;\r\n        dirPositions[dirOffset + 2] = _direction.z;\r\n\r\n        setColorLinear(dirColors, dirOffset, color, intensity);\r\n\r\n        dirLength += 1;\r\n\r\n      }\r\n      else if (light instanceof THREE.PointLight) {\r\n\r\n        pointCount += 1;\r\n\r\n        if (!light.visible) continue;\r\n\r\n        pointOffset = pointLength * 3;\r\n\r\n        setColorLinear(pointColors, pointOffset, color, intensity);\r\n\r\n        _vector3.setFromMatrixPosition(light.matrixWorld);\r\n\r\n        pointPositions[pointOffset] = _vector3.x;\r\n        pointPositions[pointOffset + 1] = _vector3.y;\r\n        pointPositions[pointOffset + 2] = _vector3.z;\r\n\r\n        // distance is 0 if decay is 0, because there is no attenuation at all.\r\n        pointDistances[pointLength] = distance;\r\n        pointDecays[pointLength] = (light.distance === 0) ? 0.0 : light.decay;\r\n\r\n        pointLength += 1;\r\n\r\n      }\r\n      else if (light instanceof THREE.SpotLight) {\r\n\r\n        spotCount += 1;\r\n\r\n        if (!light.visible) continue;\r\n\r\n        spotOffset = spotLength * 3;\r\n\r\n        setColorLinear(spotColors, spotOffset, color, intensity);\r\n\r\n        _direction.setFromMatrixPosition(light.matrixWorld);\r\n\r\n        spotPositions[spotOffset] = _direction.x;\r\n        spotPositions[spotOffset + 1] = _direction.y;\r\n        spotPositions[spotOffset + 2] = _direction.z;\r\n\r\n        spotDistances[spotLength] = distance;\r\n\r\n        _vector3.setFromMatrixPosition(light.target.matrixWorld);\r\n        _direction.sub(_vector3);\r\n        _direction.normalize();\r\n\r\n        spotDirections[spotOffset] = _direction.x;\r\n        spotDirections[spotOffset + 1] = _direction.y;\r\n        spotDirections[spotOffset + 2] = _direction.z;\r\n\r\n        spotAnglesCos[spotLength] = Math.cos(light.angle);\r\n        spotExponents[spotLength] = light.exponent;\r\n        spotDecays[spotLength] = (light.distance === 0) ? 0.0 : light.decay;\r\n\r\n        spotLength += 1;\r\n\r\n      }\r\n      else if (light instanceof THREE.HemisphereLight) {\r\n\r\n        hemiCount += 1;\r\n\r\n        if (!light.visible) continue;\r\n\r\n        _direction.setFromMatrixPosition(light.matrixWorld);\r\n        _direction.normalize();\r\n\r\n        hemiOffset = hemiLength * 3;\r\n\r\n        hemiPositions[hemiOffset] = _direction.x;\r\n        hemiPositions[hemiOffset + 1] = _direction.y;\r\n        hemiPositions[hemiOffset + 2] = _direction.z;\r\n\r\n        skyColor = light.color;\r\n        groundColor = light.groundColor;\r\n\r\n        setColorLinear(hemiSkyColors, hemiOffset, skyColor, intensity);\r\n        setColorLinear(hemiGroundColors, hemiOffset, groundColor, intensity);\r\n\r\n        hemiLength += 1;\r\n\r\n      }\r\n\r\n    }\r\n\r\n    // null eventual remains from removed lights\r\n    // (this is to avoid if in shader)\r\n\r\n    for (l = dirLength * 3, ll = Math.max(dirColors.length, dirCount * 3); l < ll; l++) dirColors[l] = 0.0;\r\n    for (l = pointLength * 3, ll = Math.max(pointColors.length, pointCount * 3); l < ll; l++) pointColors[l] = 0.0;\r\n    for (l = spotLength * 3, ll = Math.max(spotColors.length, spotCount * 3); l < ll; l++) spotColors[l] = 0.0;\r\n    for (l = hemiLength * 3, ll = Math.max(hemiSkyColors.length, hemiCount * 3); l < ll; l++) hemiSkyColors[l] = 0.0;\r\n    for (l = hemiLength * 3, ll = Math.max(hemiGroundColors.length, hemiCount * 3); l < ll; l++) hemiGroundColors[l] = 0.0;\r\n\r\n    zlights.directional.length = dirLength;\r\n    zlights.point.length = pointLength;\r\n    zlights.spot.length = spotLength;\r\n    zlights.hemi.length = hemiLength;\r\n\r\n    zlights.ambient[0] = r;\r\n    zlights.ambient[1] = g;\r\n    zlights.ambient[2] = b;\r\n\r\n  }\r\n\r\n  // GL state setting\r\n\r\n  this.setFaceCulling = function(cullFace, frontFaceDirection) {\r\n\r\n    if (cullFace === THREE.CullFaceNone) {\r\n\r\n      _gl.disable(_gl.CULL_FACE);\r\n\r\n    }\r\n    else {\r\n\r\n      if (frontFaceDirection === THREE.FrontFaceDirectionCW) {\r\n\r\n        _gl.frontFace(_gl.CW);\r\n\r\n      }\r\n      else {\r\n\r\n        _gl.frontFace(_gl.CCW);\r\n\r\n      }\r\n\r\n      if (cullFace === THREE.CullFaceBack) {\r\n\r\n        _gl.cullFace(_gl.BACK);\r\n\r\n      }\r\n      else if (cullFace === THREE.CullFaceFront) {\r\n\r\n        _gl.cullFace(_gl.FRONT);\r\n\r\n      }\r\n      else {\r\n\r\n        _gl.cullFace(_gl.FRONT_AND_BACK);\r\n\r\n      }\r\n\r\n      _gl.enable(_gl.CULL_FACE);\r\n\r\n    }\r\n\r\n  };\r\n\r\n  this.setMaterialFaces = function(material) {\r\n\r\n    state.setDoubleSided(material.side === THREE.DoubleSide);\r\n    state.setFlipSided(material.side === THREE.BackSide);\r\n\r\n  };\r\n\r\n  // Textures\r\n\r\n  function setTextureParameters(textureType, texture, isImagePowerOfTwo) {\r\n\r\n    var extension;\r\n\r\n    if (isImagePowerOfTwo) {\r\n\r\n      _gl.texParameteri(textureType, _gl.TEXTURE_WRAP_S, paramThreeToGL(texture.wrapS));\r\n      _gl.texParameteri(textureType, _gl.TEXTURE_WRAP_T, paramThreeToGL(texture.wrapT));\r\n\r\n      _gl.texParameteri(textureType, _gl.TEXTURE_MAG_FILTER, paramThreeToGL(texture.magFilter));\r\n      _gl.texParameteri(textureType, _gl.TEXTURE_MIN_FILTER, paramThreeToGL(texture.minFilter));\r\n\r\n    }\r\n    else {\r\n\r\n      _gl.texParameteri(textureType, _gl.TEXTURE_WRAP_S, _gl.CLAMP_TO_EDGE);\r\n      _gl.texParameteri(textureType, _gl.TEXTURE_WRAP_T, _gl.CLAMP_TO_EDGE);\r\n\r\n      if (texture.wrapS !== THREE.ClampToEdgeWrapping || texture.wrapT !== THREE.ClampToEdgeWrapping) {\r\n\r\n        THREE.warn('THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping. ( ' + texture.sourceFile + ' )');\r\n\r\n      }\r\n\r\n      _gl.texParameteri(textureType, _gl.TEXTURE_MAG_FILTER, filterFallback(texture.magFilter));\r\n      _gl.texParameteri(textureType, _gl.TEXTURE_MIN_FILTER, filterFallback(texture.minFilter));\r\n\r\n      if (texture.minFilter !== THREE.NearestFilter && texture.minFilter !== THREE.LinearFilter) {\r\n\r\n        THREE.warn('THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter. ( ' + texture.sourceFile + ' )');\r\n\r\n      }\r\n\r\n    }\r\n\r\n    extension = extensions.get('EXT_texture_filter_anisotropic');\r\n\r\n    if (extension && texture.type !== THREE.FloatType && texture.type !== THREE.HalfFloatType) {\r\n\r\n      if (texture.anisotropy > 1 || texture.__currentAnisotropy) {\r\n\r\n        _gl.texParameterf(textureType, extension.TEXTURE_MAX_ANISOTROPY_EXT, Math.min(texture.anisotropy, _this.getMaxAnisotropy()));\r\n        texture.__currentAnisotropy = texture.anisotropy;\r\n\r\n      }\r\n\r\n    }\r\n\r\n  }\r\n\r\n  this.uploadTexture = function(texture) {\r\n\r\n    if (texture.__webglInit === undefined) {\r\n\r\n      texture.__webglInit = true;\r\n\r\n      texture.addEventListener('dispose', onTextureDispose);\r\n\r\n      texture.__webglTexture = _gl.createTexture();\r\n\r\n      _this.info.memory.textures++;\r\n\r\n    }\r\n\r\n    _gl.bindTexture(_gl.TEXTURE_2D, texture.__webglTexture);\r\n\r\n    _gl.pixelStorei(_gl.UNPACK_FLIP_Y_WEBGL, texture.flipY);\r\n    _gl.pixelStorei(_gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL, texture.premultiplyAlpha);\r\n    _gl.pixelStorei(_gl.UNPACK_ALIGNMENT, texture.unpackAlignment);\r\n\r\n    texture.image = clampToMaxSize(texture.image, _maxTextureSize);\r\n\r\n    var image = texture.image,\r\n      isImagePowerOfTwo = THREE.Math.isPowerOfTwo(image.width) && THREE.Math.isPowerOfTwo(image.height),\r\n      glFormat = paramThreeToGL(texture.format),\r\n      glType = paramThreeToGL(texture.type);\r\n\r\n    setTextureParameters(_gl.TEXTURE_2D, texture, isImagePowerOfTwo);\r\n\r\n    var mipmap, mipmaps = texture.mipmaps;\r\n\r\n    if (texture instanceof THREE.DataTexture) {\r\n\r\n      // use manually created mipmaps if available\r\n      // if there are no manual mipmaps\r\n      // set 0 level mipmap and then use GL to generate other mipmap levels\r\n\r\n      if (mipmaps.length > 0 && isImagePowerOfTwo) {\r\n\r\n        for (var i = 0, il = mipmaps.length; i < il; i++) {\r\n\r\n          mipmap = mipmaps[i];\r\n          _gl.texImage2D(_gl.TEXTURE_2D, i, glFormat, mipmap.width, mipmap.height, 0, glFormat, glType, mipmap.data);\r\n\r\n        }\r\n\r\n        texture.generateMipmaps = false;\r\n\r\n      }\r\n      else {\r\n\r\n        _gl.texImage2D(_gl.TEXTURE_2D, 0, glFormat, image.width, image.height, 0, glFormat, glType, image.data);\r\n\r\n      }\r\n\r\n    }\r\n    else if (texture instanceof THREE.CompressedTexture) {\r\n\r\n      for (var i = 0, il = mipmaps.length; i < il; i++) {\r\n\r\n        mipmap = mipmaps[i];\r\n\r\n        if (texture.format !== THREE.RGBAFormat && texture.format !== THREE.RGBFormat) {\r\n\r\n          if (getCompressedTextureFormats().indexOf(glFormat) > -1) {\r\n\r\n            _gl.compressedTexImage2D(_gl.TEXTURE_2D, i, glFormat, mipmap.width, mipmap.height, 0, mipmap.data);\r\n\r\n          }\r\n          else {\r\n\r\n            THREE.warn(\"THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()\");\r\n\r\n          }\r\n\r\n        }\r\n        else {\r\n\r\n          _gl.texImage2D(_gl.TEXTURE_2D, i, glFormat, mipmap.width, mipmap.height, 0, glFormat, glType, mipmap.data);\r\n\r\n        }\r\n\r\n      }\r\n\r\n    }\r\n    else { // regular Texture (image, video, canvas)\r\n\r\n      // use manually created mipmaps if available\r\n      // if there are no manual mipmaps\r\n      // set 0 level mipmap and then use GL to generate other mipmap levels\r\n\r\n      if (mipmaps.length > 0 && isImagePowerOfTwo) {\r\n\r\n        for (var i = 0, il = mipmaps.length; i < il; i++) {\r\n\r\n          mipmap = mipmaps[i];\r\n          _gl.texImage2D(_gl.TEXTURE_2D, i, glFormat, glFormat, glType, mipmap);\r\n\r\n        }\r\n\r\n        texture.generateMipmaps = false;\r\n\r\n      }\r\n      else {\r\n\r\n        _gl.texImage2D(_gl.TEXTURE_2D, 0, glFormat, glFormat, glType, texture.image);\r\n\r\n      }\r\n\r\n    }\r\n\r\n    if (texture.generateMipmaps && isImagePowerOfTwo) _gl.generateMipmap(_gl.TEXTURE_2D);\r\n\r\n    texture.needsUpdate = false;\r\n\r\n    if (texture.onUpdate) texture.onUpdate();\r\n\r\n  };\r\n\r\n  this.setTexture = function(texture, slot) {\r\n\r\n    _gl.activeTexture(_gl.TEXTURE0 + slot);\r\n\r\n    if (texture.needsUpdate) {\r\n\r\n      _this.uploadTexture(texture);\r\n\r\n    }\r\n    else {\r\n\r\n      _gl.bindTexture(_gl.TEXTURE_2D, texture.__webglTexture);\r\n\r\n    }\r\n\r\n  };\r\n\r\n  function clampToMaxSize(image, maxSize) {\r\n\r\n    if (image.width > maxSize || image.height > maxSize) {\r\n\r\n      // Warning: Scaling through the canvas will only work with images that use\r\n      // premultiplied alpha.\r\n\r\n      var scale = maxSize / Math.max(image.width, image.height);\r\n\r\n      var canvas = document.createElement('canvas');\r\n      canvas.width = Math.floor(image.width * scale);\r\n      canvas.height = Math.floor(image.height * scale);\r\n\r\n      var context = canvas.getContext('2d');\r\n      context.drawImage(image, 0, 0, image.width, image.height, 0, 0, canvas.width, canvas.height);\r\n\r\n      THREE.warn('THREE.WebGLRenderer: image is too big (' + image.width + 'x' + image.height + '). Resized to ' + canvas.width + 'x' + canvas.height, image);\r\n\r\n      return canvas;\r\n\r\n    }\r\n\r\n    return image;\r\n\r\n  }\r\n\r\n  function setCubeTexture(texture, slot) {\r\n\r\n    if (texture.image.length === 6) {\r\n\r\n      if (texture.needsUpdate) {\r\n\r\n        if (!texture.image.__webglTextureCube) {\r\n\r\n          texture.addEventListener('dispose', onTextureDispose);\r\n\r\n          texture.image.__webglTextureCube = _gl.createTexture();\r\n\r\n          _this.info.memory.textures++;\r\n\r\n        }\r\n\r\n        _gl.activeTexture(_gl.TEXTURE0 + slot);\r\n        _gl.bindTexture(_gl.TEXTURE_CUBE_MAP, texture.image.__webglTextureCube);\r\n\r\n        _gl.pixelStorei(_gl.UNPACK_FLIP_Y_WEBGL, texture.flipY);\r\n\r\n        var isCompressed = texture instanceof THREE.CompressedTexture;\r\n        var isDataTexture = texture.image[0] instanceof THREE.DataTexture;\r\n\r\n        var cubeImage = [];\r\n\r\n        for (var i = 0; i < 6; i++) {\r\n\r\n          if (_this.autoScaleCubemaps && !isCompressed && !isDataTexture) {\r\n\r\n            cubeImage[i] = clampToMaxSize(texture.image[i], _maxCubemapSize);\r\n\r\n          }\r\n          else {\r\n\r\n            cubeImage[i] = isDataTexture ? texture.image[i].image : texture.image[i];\r\n\r\n          }\r\n\r\n        }\r\n\r\n        var image = cubeImage[0],\r\n          isImagePowerOfTwo = THREE.Math.isPowerOfTwo(image.width) && THREE.Math.isPowerOfTwo(image.height),\r\n          glFormat = paramThreeToGL(texture.format),\r\n          glType = paramThreeToGL(texture.type);\r\n\r\n        setTextureParameters(_gl.TEXTURE_CUBE_MAP, texture, isImagePowerOfTwo);\r\n\r\n        for (var i = 0; i < 6; i++) {\r\n\r\n          if (!isCompressed) {\r\n\r\n            if (isDataTexture) {\r\n\r\n              _gl.texImage2D(_gl.TEXTURE_CUBE_MAP_POSITIVE_X + i, 0, glFormat, cubeImage[i].width, cubeImage[i].height, 0, glFormat, glType, cubeImage[i].data);\r\n\r\n            }\r\n            else {\r\n\r\n              _gl.texImage2D(_gl.TEXTURE_CUBE_MAP_POSITIVE_X + i, 0, glFormat, glFormat, glType, cubeImage[i]);\r\n\r\n            }\r\n\r\n          }\r\n          else {\r\n\r\n            var mipmap, mipmaps = cubeImage[i].mipmaps;\r\n\r\n            for (var j = 0, jl = mipmaps.length; j < jl; j++) {\r\n\r\n              mipmap = mipmaps[j];\r\n\r\n              if (texture.format !== THREE.RGBAFormat && texture.format !== THREE.RGBFormat) {\r\n\r\n                if (getCompressedTextureFormats().indexOf(glFormat) > -1) {\r\n\r\n                  _gl.compressedTexImage2D(_gl.TEXTURE_CUBE_MAP_POSITIVE_X + i, j, glFormat, mipmap.width, mipmap.height, 0, mipmap.data);\r\n\r\n                }\r\n                else {\r\n\r\n                  THREE.warn(\"THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setCubeTexture()\");\r\n\r\n                }\r\n\r\n              }\r\n              else {\r\n\r\n                _gl.texImage2D(_gl.TEXTURE_CUBE_MAP_POSITIVE_X + i, j, glFormat, mipmap.width, mipmap.height, 0, glFormat, glType, mipmap.data);\r\n\r\n              }\r\n\r\n            }\r\n\r\n          }\r\n\r\n        }\r\n\r\n        if (texture.generateMipmaps && isImagePowerOfTwo) {\r\n\r\n          _gl.generateMipmap(_gl.TEXTURE_CUBE_MAP);\r\n\r\n        }\r\n\r\n        texture.needsUpdate = false;\r\n\r\n        if (texture.onUpdate) texture.onUpdate();\r\n\r\n      }\r\n      else {\r\n\r\n        _gl.activeTexture(_gl.TEXTURE0 + slot);\r\n        _gl.bindTexture(_gl.TEXTURE_CUBE_MAP, texture.image.__webglTextureCube);\r\n\r\n      }\r\n\r\n    }\r\n\r\n  }\r\n\r\n  function setCubeTextureDynamic(texture, slot) {\r\n\r\n    _gl.activeTexture(_gl.TEXTURE0 + slot);\r\n    _gl.bindTexture(_gl.TEXTURE_CUBE_MAP, texture.__webglTexture);\r\n\r\n  }\r\n\r\n  // Render targets\r\n\r\n  function setupFrameBuffer(framebuffer, renderTarget, textureTarget) {\r\n\r\n    _gl.bindFramebuffer(_gl.FRAMEBUFFER, framebuffer);\r\n    _gl.framebufferTexture2D(_gl.FRAMEBUFFER, _gl.COLOR_ATTACHMENT0, textureTarget, renderTarget.__webglTexture, 0);\r\n\r\n  }\r\n\r\n  function setupRenderBuffer(renderbuffer, renderTarget) {\r\n\r\n    _gl.bindRenderbuffer(_gl.RENDERBUFFER, renderbuffer);\r\n\r\n    if (renderTarget.depthBuffer && !renderTarget.stencilBuffer) {\r\n\r\n      _gl.renderbufferStorage(_gl.RENDERBUFFER, _gl.DEPTH_COMPONENT16, renderTarget.width, renderTarget.height);\r\n      _gl.framebufferRenderbuffer(_gl.FRAMEBUFFER, _gl.DEPTH_ATTACHMENT, _gl.RENDERBUFFER, renderbuffer);\r\n\r\n      /* For some reason this is not working. Defaulting to RGBA4.\r\n      } else if ( ! renderTarget.depthBuffer && renderTarget.stencilBuffer ) {\r\n\r\n      \t_gl.renderbufferStorage( _gl.RENDERBUFFER, _gl.STENCIL_INDEX8, renderTarget.width, renderTarget.height );\r\n      \t_gl.framebufferRenderbuffer( _gl.FRAMEBUFFER, _gl.STENCIL_ATTACHMENT, _gl.RENDERBUFFER, renderbuffer );\r\n      */\r\n    }\r\n    else if (renderTarget.depthBuffer && renderTarget.stencilBuffer) {\r\n\r\n      _gl.renderbufferStorage(_gl.RENDERBUFFER, _gl.DEPTH_STENCIL, renderTarget.width, renderTarget.height);\r\n      _gl.framebufferRenderbuffer(_gl.FRAMEBUFFER, _gl.DEPTH_STENCIL_ATTACHMENT, _gl.RENDERBUFFER, renderbuffer);\r\n\r\n    }\r\n    else {\r\n\r\n      _gl.renderbufferStorage(_gl.RENDERBUFFER, _gl.RGBA4, renderTarget.width, renderTarget.height);\r\n\r\n    }\r\n\r\n  }\r\n\r\n  this.setRenderTarget = function(renderTarget) {\r\n\r\n    var isCube = (renderTarget instanceof THREE.WebGLRenderTargetCube);\r\n\r\n    if (renderTarget && renderTarget.__webglFramebuffer === undefined) {\r\n\r\n      if (renderTarget.depthBuffer === undefined) renderTarget.depthBuffer = true;\r\n      if (renderTarget.stencilBuffer === undefined) renderTarget.stencilBuffer = true;\r\n\r\n      renderTarget.addEventListener('dispose', onRenderTargetDispose);\r\n\r\n      renderTarget.__webglTexture = _gl.createTexture();\r\n\r\n      _this.info.memory.textures++;\r\n\r\n      // Setup texture, create render and frame buffers\r\n\r\n      var isTargetPowerOfTwo = THREE.Math.isPowerOfTwo(renderTarget.width) && THREE.Math.isPowerOfTwo(renderTarget.height),\r\n        glFormat = paramThreeToGL(renderTarget.format),\r\n        glType = paramThreeToGL(renderTarget.type);\r\n\r\n      if (isCube) {\r\n\r\n        renderTarget.__webglFramebuffer = [];\r\n        renderTarget.__webglRenderbuffer = [];\r\n\r\n        _gl.bindTexture(_gl.TEXTURE_CUBE_MAP, renderTarget.__webglTexture);\r\n        setTextureParameters(_gl.TEXTURE_CUBE_MAP, renderTarget, isTargetPowerOfTwo);\r\n\r\n        for (var i = 0; i < 6; i++) {\r\n\r\n          renderTarget.__webglFramebuffer[i] = _gl.createFramebuffer();\r\n          renderTarget.__webglRenderbuffer[i] = _gl.createRenderbuffer();\r\n\r\n          _gl.texImage2D(_gl.TEXTURE_CUBE_MAP_POSITIVE_X + i, 0, glFormat, renderTarget.width, renderTarget.height, 0, glFormat, glType, null);\r\n\r\n          setupFrameBuffer(renderTarget.__webglFramebuffer[i], renderTarget, _gl.TEXTURE_CUBE_MAP_POSITIVE_X + i);\r\n          setupRenderBuffer(renderTarget.__webglRenderbuffer[i], renderTarget);\r\n\r\n        }\r\n\r\n        if (isTargetPowerOfTwo) _gl.generateMipmap(_gl.TEXTURE_CUBE_MAP);\r\n\r\n      }\r\n      else {\r\n\r\n        renderTarget.__webglFramebuffer = _gl.createFramebuffer();\r\n\r\n        if (renderTarget.shareDepthFrom) {\r\n\r\n          renderTarget.__webglRenderbuffer = renderTarget.shareDepthFrom.__webglRenderbuffer;\r\n\r\n        }\r\n        else {\r\n\r\n          renderTarget.__webglRenderbuffer = _gl.createRenderbuffer();\r\n\r\n        }\r\n\r\n        _gl.bindTexture(_gl.TEXTURE_2D, renderTarget.__webglTexture);\r\n        setTextureParameters(_gl.TEXTURE_2D, renderTarget, isTargetPowerOfTwo);\r\n\r\n        _gl.texImage2D(_gl.TEXTURE_2D, 0, glFormat, renderTarget.width, renderTarget.height, 0, glFormat, glType, null);\r\n\r\n        setupFrameBuffer(renderTarget.__webglFramebuffer, renderTarget, _gl.TEXTURE_2D);\r\n\r\n        if (renderTarget.shareDepthFrom) {\r\n\r\n          if (renderTarget.depthBuffer && !renderTarget.stencilBuffer) {\r\n\r\n            _gl.framebufferRenderbuffer(_gl.FRAMEBUFFER, _gl.DEPTH_ATTACHMENT, _gl.RENDERBUFFER, renderTarget.__webglRenderbuffer);\r\n\r\n          }\r\n          else if (renderTarget.depthBuffer && renderTarget.stencilBuffer) {\r\n\r\n            _gl.framebufferRenderbuffer(_gl.FRAMEBUFFER, _gl.DEPTH_STENCIL_ATTACHMENT, _gl.RENDERBUFFER, renderTarget.__webglRenderbuffer);\r\n\r\n          }\r\n\r\n        }\r\n        else {\r\n\r\n          setupRenderBuffer(renderTarget.__webglRenderbuffer, renderTarget);\r\n\r\n        }\r\n\r\n        if (isTargetPowerOfTwo) _gl.generateMipmap(_gl.TEXTURE_2D);\r\n\r\n      }\r\n\r\n      // Release everything\r\n\r\n      if (isCube) {\r\n\r\n        _gl.bindTexture(_gl.TEXTURE_CUBE_MAP, null);\r\n\r\n      }\r\n      else {\r\n\r\n        _gl.bindTexture(_gl.TEXTURE_2D, null);\r\n\r\n      }\r\n\r\n      _gl.bindRenderbuffer(_gl.RENDERBUFFER, null);\r\n      _gl.bindFramebuffer(_gl.FRAMEBUFFER, null);\r\n\r\n    }\r\n\r\n    var framebuffer, width, height, vx, vy;\r\n\r\n    if (renderTarget) {\r\n\r\n      if (isCube) {\r\n\r\n        framebuffer = renderTarget.__webglFramebuffer[renderTarget.activeCubeFace];\r\n\r\n      }\r\n      else {\r\n\r\n        framebuffer = renderTarget.__webglFramebuffer;\r\n\r\n      }\r\n\r\n      width = renderTarget.width;\r\n      height = renderTarget.height;\r\n\r\n      vx = 0;\r\n      vy = 0;\r\n\r\n    }\r\n    else {\r\n\r\n      framebuffer = null;\r\n\r\n      width = _viewportWidth;\r\n      height = _viewportHeight;\r\n\r\n      vx = _viewportX;\r\n      vy = _viewportY;\r\n\r\n    }\r\n\r\n    if (framebuffer !== _currentFramebuffer) {\r\n\r\n      _gl.bindFramebuffer(_gl.FRAMEBUFFER, framebuffer);\r\n      _gl.viewport(vx, vy, width, height);\r\n\r\n      _currentFramebuffer = framebuffer;\r\n\r\n    }\r\n\r\n    _currentWidth = width;\r\n    _currentHeight = height;\r\n\r\n  };\r\n\r\n  this.readRenderTargetPixels = function(renderTarget, x, y, width, height, buffer) {\r\n\r\n    if (!(renderTarget instanceof THREE.WebGLRenderTarget)) {\r\n\r\n      console.error('THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.');\r\n      return;\r\n\r\n    }\r\n\r\n    if (renderTarget.__webglFramebuffer) {\r\n\r\n      if (renderTarget.format !== THREE.RGBAFormat) {\r\n\r\n        console.error('THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA format. readPixels can read only RGBA format.');\r\n        return;\r\n\r\n      }\r\n\r\n      var restore = false;\r\n\r\n      if (renderTarget.__webglFramebuffer !== _currentFramebuffer) {\r\n\r\n        _gl.bindFramebuffer(_gl.FRAMEBUFFER, renderTarget.__webglFramebuffer);\r\n\r\n        restore = true;\r\n\r\n      }\r\n\r\n      if (_gl.checkFramebufferStatus(_gl.FRAMEBUFFER) === _gl.FRAMEBUFFER_COMPLETE) {\r\n\r\n        _gl.readPixels(x, y, width, height, _gl.RGBA, _gl.UNSIGNED_BYTE, buffer);\r\n\r\n      }\r\n      else {\r\n\r\n        console.error('THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.');\r\n\r\n      }\r\n\r\n      if (restore) {\r\n\r\n        _gl.bindFramebuffer(_gl.FRAMEBUFFER, _currentFramebuffer);\r\n\r\n      }\r\n\r\n    }\r\n\r\n  };\r\n\r\n  function updateRenderTargetMipmap(renderTarget) {\r\n\r\n    if (renderTarget instanceof THREE.WebGLRenderTargetCube) {\r\n\r\n      _gl.bindTexture(_gl.TEXTURE_CUBE_MAP, renderTarget.__webglTexture);\r\n      _gl.generateMipmap(_gl.TEXTURE_CUBE_MAP);\r\n      _gl.bindTexture(_gl.TEXTURE_CUBE_MAP, null);\r\n\r\n    }\r\n    else {\r\n\r\n      _gl.bindTexture(_gl.TEXTURE_2D, renderTarget.__webglTexture);\r\n      _gl.generateMipmap(_gl.TEXTURE_2D);\r\n      _gl.bindTexture(_gl.TEXTURE_2D, null);\r\n\r\n    }\r\n\r\n  }\r\n\r\n  // Fallback filters for non-power-of-2 textures\r\n\r\n  function filterFallback(f) {\r\n\r\n    if (f === THREE.NearestFilter || f === THREE.NearestMipMapNearestFilter || f === THREE.NearestMipMapLinearFilter) {\r\n\r\n      return _gl.NEAREST;\r\n\r\n    }\r\n\r\n    return _gl.LINEAR;\r\n\r\n  }\r\n\r\n  // Map three.js constants to WebGL constants\r\n\r\n  function paramThreeToGL(p) {\r\n\r\n    var extension;\r\n\r\n    if (p === THREE.RepeatWrapping) return _gl.REPEAT;\r\n    if (p === THREE.ClampToEdgeWrapping) return _gl.CLAMP_TO_EDGE;\r\n    if (p === THREE.MirroredRepeatWrapping) return _gl.MIRRORED_REPEAT;\r\n\r\n    if (p === THREE.NearestFilter) return _gl.NEAREST;\r\n    if (p === THREE.NearestMipMapNearestFilter) return _gl.NEAREST_MIPMAP_NEAREST;\r\n    if (p === THREE.NearestMipMapLinearFilter) return _gl.NEAREST_MIPMAP_LINEAR;\r\n\r\n    if (p === THREE.LinearFilter) return _gl.LINEAR;\r\n    if (p === THREE.LinearMipMapNearestFilter) return _gl.LINEAR_MIPMAP_NEAREST;\r\n    if (p === THREE.LinearMipMapLinearFilter) return _gl.LINEAR_MIPMAP_LINEAR;\r\n\r\n    if (p === THREE.UnsignedByteType) return _gl.UNSIGNED_BYTE;\r\n    if (p === THREE.UnsignedShort4444Type) return _gl.UNSIGNED_SHORT_4_4_4_4;\r\n    if (p === THREE.UnsignedShort5551Type) return _gl.UNSIGNED_SHORT_5_5_5_1;\r\n    if (p === THREE.UnsignedShort565Type) return _gl.UNSIGNED_SHORT_5_6_5;\r\n\r\n    if (p === THREE.ByteType) return _gl.BYTE;\r\n    if (p === THREE.ShortType) return _gl.SHORT;\r\n    if (p === THREE.UnsignedShortType) return _gl.UNSIGNED_SHORT;\r\n    if (p === THREE.IntType) return _gl.INT;\r\n    if (p === THREE.UnsignedIntType) return _gl.UNSIGNED_INT;\r\n    if (p === THREE.FloatType) return _gl.FLOAT;\r\n\r\n    extension = extensions.get('OES_texture_half_float');\r\n\r\n    if (extension !== null) {\r\n\r\n      if (p === THREE.HalfFloatType) return extension.HALF_FLOAT_OES;\r\n\r\n    }\r\n\r\n    if (p === THREE.AlphaFormat) return _gl.ALPHA;\r\n    if (p === THREE.RGBFormat) return _gl.RGB;\r\n    if (p === THREE.RGBAFormat) return _gl.RGBA;\r\n    if (p === THREE.LuminanceFormat) return _gl.LUMINANCE;\r\n    if (p === THREE.LuminanceAlphaFormat) return _gl.LUMINANCE_ALPHA;\r\n\r\n    if (p === THREE.AddEquation) return _gl.FUNC_ADD;\r\n    if (p === THREE.SubtractEquation) return _gl.FUNC_SUBTRACT;\r\n    if (p === THREE.ReverseSubtractEquation) return _gl.FUNC_REVERSE_SUBTRACT;\r\n\r\n    if (p === THREE.ZeroFactor) return _gl.ZERO;\r\n    if (p === THREE.OneFactor) return _gl.ONE;\r\n    if (p === THREE.SrcColorFactor) return _gl.SRC_COLOR;\r\n    if (p === THREE.OneMinusSrcColorFactor) return _gl.ONE_MINUS_SRC_COLOR;\r\n    if (p === THREE.SrcAlphaFactor) return _gl.SRC_ALPHA;\r\n    if (p === THREE.OneMinusSrcAlphaFactor) return _gl.ONE_MINUS_SRC_ALPHA;\r\n    if (p === THREE.DstAlphaFactor) return _gl.DST_ALPHA;\r\n    if (p === THREE.OneMinusDstAlphaFactor) return _gl.ONE_MINUS_DST_ALPHA;\r\n\r\n    if (p === THREE.DstColorFactor) return _gl.DST_COLOR;\r\n    if (p === THREE.OneMinusDstColorFactor) return _gl.ONE_MINUS_DST_COLOR;\r\n    if (p === THREE.SrcAlphaSaturateFactor) return _gl.SRC_ALPHA_SATURATE;\r\n\r\n    extension = extensions.get('WEBGL_compressed_texture_s3tc');\r\n\r\n    if (extension !== null) {\r\n\r\n      if (p === THREE.RGB_S3TC_DXT1_Format) return extension.COMPRESSED_RGB_S3TC_DXT1_EXT;\r\n      if (p === THREE.RGBA_S3TC_DXT1_Format) return extension.COMPRESSED_RGBA_S3TC_DXT1_EXT;\r\n      if (p === THREE.RGBA_S3TC_DXT3_Format) return extension.COMPRESSED_RGBA_S3TC_DXT3_EXT;\r\n      if (p === THREE.RGBA_S3TC_DXT5_Format) return extension.COMPRESSED_RGBA_S3TC_DXT5_EXT;\r\n\r\n    }\r\n\r\n    extension = extensions.get('WEBGL_compressed_texture_pvrtc');\r\n\r\n    if (extension !== null) {\r\n\r\n      if (p === THREE.RGB_PVRTC_4BPPV1_Format) return extension.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;\r\n      if (p === THREE.RGB_PVRTC_2BPPV1_Format) return extension.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;\r\n      if (p === THREE.RGBA_PVRTC_4BPPV1_Format) return extension.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;\r\n      if (p === THREE.RGBA_PVRTC_2BPPV1_Format) return extension.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG;\r\n\r\n    }\r\n\r\n    extension = extensions.get('EXT_blend_minmax');\r\n\r\n    if (extension !== null) {\r\n\r\n      if (p === THREE.MinEquation) return extension.MIN_EXT;\r\n      if (p === THREE.MaxEquation) return extension.MAX_EXT;\r\n\r\n    }\r\n\r\n    return 0;\r\n\r\n  }\r\n\r\n  // Allocations\r\n\r\n  function allocateBones(object) {\r\n\r\n    if (_supportsBoneTextures && object && object.skeleton && object.skeleton.useVertexTexture) {\r\n\r\n      return 1024;\r\n\r\n    }\r\n    else {\r\n\r\n      // default for when object is not specified\r\n      // ( for example when prebuilding shader\r\n      //   to be used with multiple objects )\r\n      //\r\n      //  - leave some extra space for other uniforms\r\n      //  - limit here is ANGLE's 254 max uniform vectors\r\n      //    (up to 54 should be safe)\r\n\r\n      var nVertexUniforms = _gl.getParameter(_gl.MAX_VERTEX_UNIFORM_VECTORS);\r\n      var nVertexMatrices = Math.floor((nVertexUniforms - 20) / 4);\r\n\r\n      var maxBones = nVertexMatrices;\r\n\r\n      if (object !== undefined && object instanceof THREE.SkinnedMesh) {\r\n\r\n        maxBones = Math.min(object.skeleton.bones.length, maxBones);\r\n\r\n        if (maxBones < object.skeleton.bones.length) {\r\n\r\n          THREE.warn('WebGLRenderer: too many bones - ' + object.skeleton.bones.length + ', this GPU supports just ' + maxBones + ' (try OpenGL instead of ANGLE)');\r\n\r\n        }\r\n\r\n      }\r\n\r\n      return maxBones;\r\n\r\n    }\r\n\r\n  }\r\n\r\n  function allocateLights(lights) {\r\n\r\n    var dirLights = 0;\r\n    var pointLights = 0;\r\n    var spotLights = 0;\r\n    var hemiLights = 0;\r\n\r\n    for (var l = 0, ll = lights.length; l < ll; l++) {\r\n\r\n      var light = lights[l];\r\n\r\n      if (light.onlyShadow || light.visible === false) continue;\r\n\r\n      if (light instanceof THREE.DirectionalLight) dirLights++;\r\n      if (light instanceof THREE.PointLight) pointLights++;\r\n      if (light instanceof THREE.SpotLight) spotLights++;\r\n      if (light instanceof THREE.HemisphereLight) hemiLights++;\r\n\r\n    }\r\n\r\n    return {\r\n      'directional': dirLights,\r\n      'point': pointLights,\r\n      'spot': spotLights,\r\n      'hemi': hemiLights\r\n    };\r\n\r\n  }\r\n\r\n  function allocateShadows(lights) {\r\n\r\n    var maxShadows = 0;\r\n\r\n    for (var l = 0, ll = lights.length; l < ll; l++) {\r\n\r\n      var light = lights[l];\r\n\r\n      if (!light.castShadow) continue;\r\n\r\n      if (light instanceof THREE.SpotLight) maxShadows++;\r\n      if (light instanceof THREE.DirectionalLight && !light.shadowCascade) maxShadows++;\r\n\r\n    }\r\n\r\n    return maxShadows;\r\n\r\n  }\r\n\r\n  // DEPRECATED\r\n\r\n  this.initMaterial = function() {\r\n\r\n    THREE.warn('THREE.WebGLRenderer: .initMaterial() has been removed.');\r\n\r\n  };\r\n\r\n  this.addPrePlugin = function() {\r\n\r\n    THREE.warn('THREE.WebGLRenderer: .addPrePlugin() has been removed.');\r\n\r\n  };\r\n\r\n  this.addPostPlugin = function() {\r\n\r\n    THREE.warn('THREE.WebGLRenderer: .addPostPlugin() has been removed.');\r\n\r\n  };\r\n\r\n  this.updateShadowMap = function() {\r\n\r\n    THREE.warn('THREE.WebGLRenderer: .updateShadowMap() has been removed.');\r\n\r\n  };\r\n\r\n};\r\n\r\n// File:src/renderers/WebGLRenderTarget.js\r\n\r\n/**\r\n * @author szimek / https://github.com/szimek/\r\n * @author alteredq / http://alteredqualia.com/\r\n */\r\n\r\nTHREE.WebGLRenderTarget = function(width, height, options) {\r\n\r\n  this.width = width;\r\n  this.height = height;\r\n\r\n  options = options || {};\r\n\r\n  this.wrapS = options.wrapS !== undefined ? options.wrapS : THREE.ClampToEdgeWrapping;\r\n  this.wrapT = options.wrapT !== undefined ? options.wrapT : THREE.ClampToEdgeWrapping;\r\n\r\n  this.magFilter = options.magFilter !== undefined ? options.magFilter : THREE.LinearFilter;\r\n  this.minFilter = options.minFilter !== undefined ? options.minFilter : THREE.LinearMipMapLinearFilter;\r\n\r\n  this.anisotropy = options.anisotropy !== undefined ? options.anisotropy : 1;\r\n\r\n  this.offset = new THREE.Vector2(0, 0);\r\n  this.repeat = new THREE.Vector2(1, 1);\r\n\r\n  this.format = options.format !== undefined ? options.format : THREE.RGBAFormat;\r\n  this.type = options.type !== undefined ? options.type : THREE.UnsignedByteType;\r\n\r\n  this.depthBuffer = options.depthBuffer !== undefined ? options.depthBuffer : true;\r\n  this.stencilBuffer = options.stencilBuffer !== undefined ? options.stencilBuffer : true;\r\n\r\n  this.generateMipmaps = true;\r\n\r\n  this.shareDepthFrom = options.shareDepthFrom !== undefined ? options.shareDepthFrom : null;\r\n\r\n};\r\n\r\nTHREE.WebGLRenderTarget.prototype = {\r\n\r\n  constructor: THREE.WebGLRenderTarget,\r\n\r\n  setSize: function(width, height) {\r\n\r\n    this.width = width;\r\n    this.height = height;\r\n\r\n  },\r\n\r\n  clone: function() {\r\n\r\n    var tmp = new THREE.WebGLRenderTarget(this.width, this.height);\r\n\r\n    tmp.wrapS = this.wrapS;\r\n    tmp.wrapT = this.wrapT;\r\n\r\n    tmp.magFilter = this.magFilter;\r\n    tmp.minFilter = this.minFilter;\r\n\r\n    tmp.anisotropy = this.anisotropy;\r\n\r\n    tmp.offset.copy(this.offset);\r\n    tmp.repeat.copy(this.repeat);\r\n\r\n    tmp.format = this.format;\r\n    tmp.type = this.type;\r\n\r\n    tmp.depthBuffer = this.depthBuffer;\r\n    tmp.stencilBuffer = this.stencilBuffer;\r\n\r\n    tmp.generateMipmaps = this.generateMipmaps;\r\n\r\n    tmp.shareDepthFrom = this.shareDepthFrom;\r\n\r\n    return tmp;\r\n\r\n  },\r\n\r\n  dispose: function() {\r\n\r\n    this.dispatchEvent({\r\n      type: 'dispose'\r\n    });\r\n\r\n  }\r\n\r\n};\r\n\r\nTHREE.EventDispatcher.prototype.apply(THREE.WebGLRenderTarget.prototype);\r\n\r\n// File:src/renderers/WebGLRenderTargetCube.js\r\n\r\n/**\r\n * @author alteredq / http://alteredqualia.com\r\n */\r\n\r\nTHREE.WebGLRenderTargetCube = function(width, height, options) {\r\n\r\n  THREE.WebGLRenderTarget.call(this, width, height, options);\r\n\r\n  this.activeCubeFace = 0; // PX 0, NX 1, PY 2, NY 3, PZ 4, NZ 5\r\n\r\n};\r\n\r\nTHREE.WebGLRenderTargetCube.prototype = Object.create(THREE.WebGLRenderTarget.prototype);\r\nTHREE.WebGLRenderTargetCube.prototype.constructor = THREE.WebGLRenderTargetCube;\r\n\r\n// File:src/renderers/webgl/WebGLExtensions.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.WebGLExtensions = function(gl) {\r\n\r\n  var extensions = {};\r\n\r\n  this.get = function(name) {\r\n\r\n    if (extensions[name] !== undefined) {\r\n\r\n      return extensions[name];\r\n\r\n    }\r\n\r\n    var extension;\r\n\r\n    switch (name) {\r\n\r\n      case 'EXT_texture_filter_anisotropic':\r\n        extension = gl.getExtension('EXT_texture_filter_anisotropic') || gl.getExtension('MOZ_EXT_texture_filter_anisotropic') || gl.getExtension('WEBKIT_EXT_texture_filter_anisotropic');\r\n        break;\r\n\r\n      case 'WEBGL_compressed_texture_s3tc':\r\n        extension = gl.getExtension('WEBGL_compressed_texture_s3tc') || gl.getExtension('MOZ_WEBGL_compressed_texture_s3tc') || gl.getExtension('WEBKIT_WEBGL_compressed_texture_s3tc');\r\n        break;\r\n\r\n      case 'WEBGL_compressed_texture_pvrtc':\r\n        extension = gl.getExtension('WEBGL_compressed_texture_pvrtc') || gl.getExtension('WEBKIT_WEBGL_compressed_texture_pvrtc');\r\n        break;\r\n\r\n      default:\r\n        extension = gl.getExtension(name);\r\n\r\n    }\r\n\r\n    if (extension === null) {\r\n\r\n      THREE.warn('THREE.WebGLRenderer: ' + name + ' extension not supported.');\r\n\r\n    }\r\n\r\n    extensions[name] = extension;\r\n\r\n    return extension;\r\n\r\n  };\r\n\r\n};\r\n\r\n// File:src/renderers/webgl/WebGLProgram.js\r\n\r\nTHREE.WebGLProgram = (function() {\r\n\r\n  var programIdCount = 0;\r\n\r\n  var generateDefines = function(defines) {\r\n\r\n    var value, chunk, chunks = [];\r\n\r\n    for (var d in defines) {\r\n\r\n      value = defines[d];\r\n      if (value === false) continue;\r\n\r\n      chunk = '#define ' + d + ' ' + value;\r\n      chunks.push(chunk);\r\n\r\n    }\r\n\r\n    return chunks.join('\\n');\r\n\r\n  };\r\n\r\n  var cacheUniformLocations = function(gl, program, identifiers) {\r\n\r\n    var uniforms = {};\r\n\r\n    for (var i = 0, l = identifiers.length; i < l; i++) {\r\n\r\n      var id = identifiers[i];\r\n      uniforms[id] = gl.getUniformLocation(program, id);\r\n\r\n    }\r\n\r\n    return uniforms;\r\n\r\n  };\r\n\r\n  var cacheAttributeLocations = function(gl, program, identifiers) {\r\n\r\n    var attributes = {};\r\n\r\n    for (var i = 0, l = identifiers.length; i < l; i++) {\r\n\r\n      var id = identifiers[i];\r\n      attributes[id] = gl.getAttribLocation(program, id);\r\n\r\n    }\r\n\r\n    return attributes;\r\n\r\n  };\r\n\r\n  return function(renderer, code, material, parameters) {\r\n\r\n    var _this = renderer;\r\n    var _gl = _this.context;\r\n\r\n    var defines = material.defines;\r\n    var uniforms = material.__webglShader.uniforms;\r\n    var attributes = material.attributes;\r\n\r\n    var vertexShader = material.__webglShader.vertexShader;\r\n    var fragmentShader = material.__webglShader.fragmentShader;\r\n\r\n    var index0AttributeName = material.index0AttributeName;\r\n\r\n    if (index0AttributeName === undefined && parameters.morphTargets === true) {\r\n\r\n      // programs with morphTargets displace position out of attribute 0\r\n\r\n      index0AttributeName = 'position';\r\n\r\n    }\r\n\r\n    var shadowMapTypeDefine = 'SHADOWMAP_TYPE_BASIC';\r\n\r\n    if (parameters.shadowMapType === THREE.PCFShadowMap) {\r\n\r\n      shadowMapTypeDefine = 'SHADOWMAP_TYPE_PCF';\r\n\r\n    }\r\n    else if (parameters.shadowMapType === THREE.PCFSoftShadowMap) {\r\n\r\n      shadowMapTypeDefine = 'SHADOWMAP_TYPE_PCF_SOFT';\r\n\r\n    }\r\n\r\n    var envMapTypeDefine = 'ENVMAP_TYPE_CUBE';\r\n    var envMapModeDefine = 'ENVMAP_MODE_REFLECTION';\r\n    var envMapBlendingDefine = 'ENVMAP_BLENDING_MULTIPLY';\r\n\r\n    if (parameters.envMap) {\r\n\r\n      switch (material.envMap.mapping) {\r\n\r\n        case THREE.CubeReflectionMapping:\r\n        case THREE.CubeRefractionMapping:\r\n          envMapTypeDefine = 'ENVMAP_TYPE_CUBE';\r\n          break;\r\n\r\n        case THREE.EquirectangularReflectionMapping:\r\n        case THREE.EquirectangularRefractionMapping:\r\n          envMapTypeDefine = 'ENVMAP_TYPE_EQUIREC';\r\n          break;\r\n\r\n        case THREE.SphericalReflectionMapping:\r\n          envMapTypeDefine = 'ENVMAP_TYPE_SPHERE';\r\n          break;\r\n\r\n      }\r\n\r\n      switch (material.envMap.mapping) {\r\n\r\n        case THREE.CubeRefractionMapping:\r\n        case THREE.EquirectangularRefractionMapping:\r\n          envMapModeDefine = 'ENVMAP_MODE_REFRACTION';\r\n          break;\r\n\r\n      }\r\n\r\n      switch (material.combine) {\r\n\r\n        case THREE.MultiplyOperation:\r\n          envMapBlendingDefine = 'ENVMAP_BLENDING_MULTIPLY';\r\n          break;\r\n\r\n        case THREE.MixOperation:\r\n          envMapBlendingDefine = 'ENVMAP_BLENDING_MIX';\r\n          break;\r\n\r\n        case THREE.AddOperation:\r\n          envMapBlendingDefine = 'ENVMAP_BLENDING_ADD';\r\n          break;\r\n\r\n      }\r\n\r\n    }\r\n\r\n    var gammaFactorDefine = (renderer.gammaFactor > 0) ? renderer.gammaFactor : 1.0;\r\n\r\n    // console.log( 'building new program ' );\r\n\r\n    //\r\n\r\n    var customDefines = generateDefines(defines);\r\n\r\n    //\r\n\r\n    var program = _gl.createProgram();\r\n\r\n    var prefix_vertex, prefix_fragment;\r\n\r\n    if (material instanceof THREE.RawShaderMaterial) {\r\n\r\n      prefix_vertex = '';\r\n      prefix_fragment = '';\r\n\r\n    }\r\n    else {\r\n\r\n      prefix_vertex = [\r\n\r\n        'precision ' + parameters.precision + ' float;',\r\n        'precision ' + parameters.precision + ' int;',\r\n\r\n        customDefines,\r\n\r\n        parameters.supportsVertexTextures ? '#define VERTEX_TEXTURES' : '',\r\n\r\n        _this.gammaInput ? '#define GAMMA_INPUT' : '',\r\n        _this.gammaOutput ? '#define GAMMA_OUTPUT' : '',\r\n        '#define GAMMA_FACTOR ' + gammaFactorDefine,\r\n\r\n        '#define MAX_DIR_LIGHTS ' + parameters.maxDirLights,\r\n        '#define MAX_POINT_LIGHTS ' + parameters.maxPointLights,\r\n        '#define MAX_SPOT_LIGHTS ' + parameters.maxSpotLights,\r\n        '#define MAX_HEMI_LIGHTS ' + parameters.maxHemiLights,\r\n\r\n        '#define MAX_SHADOWS ' + parameters.maxShadows,\r\n\r\n        '#define MAX_BONES ' + parameters.maxBones,\r\n\r\n        parameters.map ? '#define USE_MAP' : '',\r\n        parameters.envMap ? '#define USE_ENVMAP' : '',\r\n        parameters.envMap ? '#define ' + envMapModeDefine : '',\r\n        parameters.lightMap ? '#define USE_LIGHTMAP' : '',\r\n        parameters.bumpMap ? '#define USE_BUMPMAP' : '',\r\n        parameters.normalMap ? '#define USE_NORMALMAP' : '',\r\n        parameters.specularMap ? '#define USE_SPECULARMAP' : '',\r\n        parameters.alphaMap ? '#define USE_ALPHAMAP' : '',\r\n        parameters.vertexColors ? '#define USE_COLOR' : '',\r\n\r\n        parameters.flatShading ? '#define FLAT_SHADED' : '',\r\n\r\n        parameters.skinning ? '#define USE_SKINNING' : '',\r\n        parameters.useVertexTexture ? '#define BONE_TEXTURE' : '',\r\n\r\n        parameters.morphTargets ? '#define USE_MORPHTARGETS' : '',\r\n        parameters.morphNormals ? '#define USE_MORPHNORMALS' : '',\r\n        parameters.wrapAround ? '#define WRAP_AROUND' : '',\r\n        parameters.doubleSided ? '#define DOUBLE_SIDED' : '',\r\n        parameters.flipSided ? '#define FLIP_SIDED' : '',\r\n\r\n        parameters.shadowMapEnabled ? '#define USE_SHADOWMAP' : '',\r\n        parameters.shadowMapEnabled ? '#define ' + shadowMapTypeDefine : '',\r\n        parameters.shadowMapDebug ? '#define SHADOWMAP_DEBUG' : '',\r\n        parameters.shadowMapCascade ? '#define SHADOWMAP_CASCADE' : '',\r\n\r\n        parameters.sizeAttenuation ? '#define USE_SIZEATTENUATION' : '',\r\n\r\n        parameters.logarithmicDepthBuffer ? '#define USE_LOGDEPTHBUF' : '',\r\n        //_this._glExtensionFragDepth ? '#define USE_LOGDEPTHBUF_EXT' : '',\r\n\r\n\r\n        'uniform mat4 modelMatrix;',\r\n        'uniform mat4 modelViewMatrix;',\r\n        'uniform mat4 projectionMatrix;',\r\n        'uniform mat4 viewMatrix;',\r\n        'uniform mat3 normalMatrix;',\r\n        'uniform vec3 cameraPosition;',\r\n\r\n        'attribute vec3 position;',\r\n        'attribute vec3 normal;',\r\n        'attribute vec2 uv;',\r\n        'attribute vec2 uv2;',\r\n\r\n        '#ifdef USE_COLOR',\r\n\r\n        '\tattribute vec3 color;',\r\n\r\n        '#endif',\r\n\r\n        '#ifdef USE_MORPHTARGETS',\r\n\r\n        '\tattribute vec3 morphTarget0;',\r\n        '\tattribute vec3 morphTarget1;',\r\n        '\tattribute vec3 morphTarget2;',\r\n        '\tattribute vec3 morphTarget3;',\r\n\r\n        '\t#ifdef USE_MORPHNORMALS',\r\n\r\n        '\t\tattribute vec3 morphNormal0;',\r\n        '\t\tattribute vec3 morphNormal1;',\r\n        '\t\tattribute vec3 morphNormal2;',\r\n        '\t\tattribute vec3 morphNormal3;',\r\n\r\n        '\t#else',\r\n\r\n        '\t\tattribute vec3 morphTarget4;',\r\n        '\t\tattribute vec3 morphTarget5;',\r\n        '\t\tattribute vec3 morphTarget6;',\r\n        '\t\tattribute vec3 morphTarget7;',\r\n\r\n        '\t#endif',\r\n\r\n        '#endif',\r\n\r\n        '#ifdef USE_SKINNING',\r\n\r\n        '\tattribute vec4 skinIndex;',\r\n        '\tattribute vec4 skinWeight;',\r\n\r\n        '#endif',\r\n\r\n        ''\r\n\r\n      ].join('\\n');\r\n\r\n      prefix_fragment = [\r\n\r\n        'precision ' + parameters.precision + ' float;',\r\n        'precision ' + parameters.precision + ' int;',\r\n\r\n        (parameters.bumpMap || parameters.normalMap || parameters.flatShading) ? '#extension GL_OES_standard_derivatives : enable' : '',\r\n\r\n        customDefines,\r\n\r\n        '#define MAX_DIR_LIGHTS ' + parameters.maxDirLights,\r\n        '#define MAX_POINT_LIGHTS ' + parameters.maxPointLights,\r\n        '#define MAX_SPOT_LIGHTS ' + parameters.maxSpotLights,\r\n        '#define MAX_HEMI_LIGHTS ' + parameters.maxHemiLights,\r\n\r\n        '#define MAX_SHADOWS ' + parameters.maxShadows,\r\n\r\n        parameters.alphaTest ? '#define ALPHATEST ' + parameters.alphaTest : '',\r\n\r\n        _this.gammaInput ? '#define GAMMA_INPUT' : '',\r\n        _this.gammaOutput ? '#define GAMMA_OUTPUT' : '',\r\n        '#define GAMMA_FACTOR ' + gammaFactorDefine,\r\n\r\n        (parameters.useFog && parameters.fog) ? '#define USE_FOG' : '', (parameters.useFog && parameters.fogExp) ? '#define FOG_EXP2' : '',\r\n\r\n        parameters.map ? '#define USE_MAP' : '',\r\n        parameters.envMap ? '#define USE_ENVMAP' : '',\r\n        parameters.envMap ? '#define ' + envMapTypeDefine : '',\r\n        parameters.envMap ? '#define ' + envMapModeDefine : '',\r\n        parameters.envMap ? '#define ' + envMapBlendingDefine : '',\r\n        parameters.lightMap ? '#define USE_LIGHTMAP' : '',\r\n        parameters.bumpMap ? '#define USE_BUMPMAP' : '',\r\n        parameters.normalMap ? '#define USE_NORMALMAP' : '',\r\n        parameters.specularMap ? '#define USE_SPECULARMAP' : '',\r\n        parameters.alphaMap ? '#define USE_ALPHAMAP' : '',\r\n        parameters.vertexColors ? '#define USE_COLOR' : '',\r\n\r\n        parameters.flatShading ? '#define FLAT_SHADED' : '',\r\n\r\n        parameters.metal ? '#define METAL' : '',\r\n        parameters.wrapAround ? '#define WRAP_AROUND' : '',\r\n        parameters.doubleSided ? '#define DOUBLE_SIDED' : '',\r\n        parameters.flipSided ? '#define FLIP_SIDED' : '',\r\n\r\n        parameters.shadowMapEnabled ? '#define USE_SHADOWMAP' : '',\r\n        parameters.shadowMapEnabled ? '#define ' + shadowMapTypeDefine : '',\r\n        parameters.shadowMapDebug ? '#define SHADOWMAP_DEBUG' : '',\r\n        parameters.shadowMapCascade ? '#define SHADOWMAP_CASCADE' : '',\r\n\r\n        parameters.logarithmicDepthBuffer ? '#define USE_LOGDEPTHBUF' : '',\r\n        //_this._glExtensionFragDepth ? '#define USE_LOGDEPTHBUF_EXT' : '',\r\n\r\n        'uniform mat4 viewMatrix;',\r\n        'uniform vec3 cameraPosition;',\r\n        ''\r\n\r\n      ].join('\\n');\r\n\r\n    }\r\n\r\n    var glVertexShader = new THREE.WebGLShader(_gl, _gl.VERTEX_SHADER, prefix_vertex + vertexShader);\r\n    var glFragmentShader = new THREE.WebGLShader(_gl, _gl.FRAGMENT_SHADER, prefix_fragment + fragmentShader);\r\n\r\n    _gl.attachShader(program, glVertexShader);\r\n    _gl.attachShader(program, glFragmentShader);\r\n\r\n    if (index0AttributeName !== undefined) {\r\n\r\n      // Force a particular attribute to index 0.\r\n      // because potentially expensive emulation is done by browser if attribute 0 is disabled.\r\n      // And, color, for example is often automatically bound to index 0 so disabling it\r\n\r\n      _gl.bindAttribLocation(program, 0, index0AttributeName);\r\n\r\n    }\r\n\r\n    _gl.linkProgram(program);\r\n\r\n    var programLogInfo = _gl.getProgramInfoLog(program);\r\n\r\n    if (_gl.getProgramParameter(program, _gl.LINK_STATUS) === false) {\r\n\r\n      THREE.error('THREE.WebGLProgram: shader error: ' + _gl.getError(), 'gl.VALIDATE_STATUS', _gl.getProgramParameter(program, _gl.VALIDATE_STATUS), 'gl.getPRogramInfoLog', programLogInfo);\r\n\r\n    }\r\n\r\n    if (programLogInfo !== '') {\r\n\r\n      THREE.warn('THREE.WebGLProgram: gl.getProgramInfoLog()' + programLogInfo);\r\n      // THREE.warn( _gl.getExtension( 'WEBGL_debug_shaders' ).getTranslatedShaderSource( glVertexShader ) );\r\n      // THREE.warn( _gl.getExtension( 'WEBGL_debug_shaders' ).getTranslatedShaderSource( glFragmentShader ) );\r\n\r\n    }\r\n\r\n    // clean up\r\n\r\n    _gl.deleteShader(glVertexShader);\r\n    _gl.deleteShader(glFragmentShader);\r\n\r\n    // cache uniform locations\r\n\r\n    var identifiers = [\r\n\r\n      'viewMatrix',\r\n      'modelViewMatrix',\r\n      'projectionMatrix',\r\n      'normalMatrix',\r\n      'modelMatrix',\r\n      'cameraPosition',\r\n      'morphTargetInfluences',\r\n      'bindMatrix',\r\n      'bindMatrixInverse'\r\n\r\n    ];\r\n\r\n    if (parameters.useVertexTexture) {\r\n\r\n      identifiers.push('boneTexture');\r\n      identifiers.push('boneTextureWidth');\r\n      identifiers.push('boneTextureHeight');\r\n\r\n    }\r\n    else {\r\n\r\n      identifiers.push('boneGlobalMatrices');\r\n\r\n    }\r\n\r\n    if (parameters.logarithmicDepthBuffer) {\r\n\r\n      identifiers.push('logDepthBufFC');\r\n\r\n    }\r\n\r\n\r\n    for (var u in uniforms) {\r\n\r\n      identifiers.push(u);\r\n\r\n    }\r\n\r\n    this.uniforms = cacheUniformLocations(_gl, program, identifiers);\r\n\r\n    // cache attributes locations\r\n\r\n    identifiers = [\r\n\r\n      'position',\r\n      'normal',\r\n      'uv',\r\n      'uv2',\r\n      'tangent',\r\n      'color',\r\n      'skinIndex',\r\n      'skinWeight',\r\n      'lineDistance'\r\n\r\n    ];\r\n\r\n    for (var i = 0; i < parameters.maxMorphTargets; i++) {\r\n\r\n      identifiers.push('morphTarget' + i);\r\n\r\n    }\r\n\r\n    for (var i = 0; i < parameters.maxMorphNormals; i++) {\r\n\r\n      identifiers.push('morphNormal' + i);\r\n\r\n    }\r\n\r\n    for (var a in attributes) {\r\n\r\n      identifiers.push(a);\r\n\r\n    }\r\n\r\n    this.attributes = cacheAttributeLocations(_gl, program, identifiers);\r\n    this.attributesKeys = Object.keys(this.attributes);\r\n\r\n    //\r\n\r\n    this.id = programIdCount++;\r\n    this.code = code;\r\n    this.usedTimes = 1;\r\n    this.program = program;\r\n    this.vertexShader = glVertexShader;\r\n    this.fragmentShader = glFragmentShader;\r\n\r\n    return this;\r\n\r\n  };\r\n\r\n})();\r\n\r\n// File:src/renderers/webgl/WebGLShader.js\r\n\r\nTHREE.WebGLShader = (function() {\r\n\r\n  var addLineNumbers = function(string) {\r\n\r\n    var lines = string.split('\\n');\r\n\r\n    for (var i = 0; i < lines.length; i++) {\r\n\r\n      lines[i] = (i + 1) + ': ' + lines[i];\r\n\r\n    }\r\n\r\n    return lines.join('\\n');\r\n\r\n  };\r\n\r\n  return function(gl, type, string) {\r\n\r\n    var shader = gl.createShader(type);\r\n\r\n    gl.shaderSource(shader, string);\r\n    gl.compileShader(shader);\r\n\r\n    if (gl.getShaderParameter(shader, gl.COMPILE_STATUS) === false) {\r\n\r\n      THREE.error('THREE.WebGLShader: Shader couldn\\'t compile.');\r\n\r\n    }\r\n\r\n    if (gl.getShaderInfoLog(shader) !== '') {\r\n\r\n      THREE.warn('THREE.WebGLShader: gl.getShaderInfoLog()', gl.getShaderInfoLog(shader), addLineNumbers(string));\r\n\r\n    }\r\n\r\n    // --enable-privileged-webgl-extension\r\n    // console.log( type, gl.getExtension( 'WEBGL_debug_shaders' ).getTranslatedShaderSource( shader ) );\r\n\r\n    return shader;\r\n\r\n  };\r\n\r\n})();\r\n\r\n// File:src/renderers/webgl/WebGLState.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.WebGLState = function(gl, paramThreeToGL) {\r\n\r\n  var newAttributes = new Uint8Array(16);\r\n  var enabledAttributes = new Uint8Array(16);\r\n\r\n  var currentBlending = null;\r\n  var currentBlendEquation = null;\r\n  var currentBlendSrc = null;\r\n  var currentBlendDst = null;\r\n  var currentBlendEquationAlpha = null;\r\n  var currentBlendSrcAlpha = null;\r\n  var currentBlendDstAlpha = null;\r\n\r\n  var currentDepthTest = null;\r\n  var currentDepthWrite = null;\r\n\r\n  var currentColorWrite = null;\r\n\r\n  var currentDoubleSided = null;\r\n  var currentFlipSided = null;\r\n\r\n  var currentLineWidth = null;\r\n\r\n  var currentPolygonOffset = null;\r\n  var currentPolygonOffsetFactor = null;\r\n  var currentPolygonOffsetUnits = null;\r\n\r\n  this.initAttributes = function() {\r\n\r\n    for (var i = 0, l = newAttributes.length; i < l; i++) {\r\n\r\n      newAttributes[i] = 0;\r\n\r\n    }\r\n\r\n  };\r\n\r\n  this.enableAttribute = function(attribute) {\r\n\r\n    newAttributes[attribute] = 1;\r\n\r\n    if (enabledAttributes[attribute] === 0) {\r\n\r\n      gl.enableVertexAttribArray(attribute);\r\n      enabledAttributes[attribute] = 1;\r\n\r\n    }\r\n\r\n  };\r\n\r\n  this.disableUnusedAttributes = function() {\r\n\r\n    for (var i = 0, l = enabledAttributes.length; i < l; i++) {\r\n\r\n      if (enabledAttributes[i] !== newAttributes[i]) {\r\n\r\n        gl.disableVertexAttribArray(i);\r\n        enabledAttributes[i] = 0;\r\n\r\n      }\r\n\r\n    }\r\n\r\n  };\r\n\r\n  this.setBlending = function(blending, blendEquation, blendSrc, blendDst, blendEquationAlpha, blendSrcAlpha, blendDstAlpha) {\r\n\r\n    if (blending !== currentBlending) {\r\n\r\n      if (blending === THREE.NoBlending) {\r\n\r\n        gl.disable(gl.BLEND);\r\n\r\n      }\r\n      else if (blending === THREE.AdditiveBlending) {\r\n\r\n        gl.enable(gl.BLEND);\r\n        gl.blendEquation(gl.FUNC_ADD);\r\n        gl.blendFunc(gl.SRC_ALPHA, gl.ONE);\r\n\r\n      }\r\n      else if (blending === THREE.SubtractiveBlending) {\r\n\r\n        // TODO: Find blendFuncSeparate() combination\r\n        gl.enable(gl.BLEND);\r\n        gl.blendEquation(gl.FUNC_ADD);\r\n        gl.blendFunc(gl.ZERO, gl.ONE_MINUS_SRC_COLOR);\r\n\r\n      }\r\n      else if (blending === THREE.MultiplyBlending) {\r\n\r\n        // TODO: Find blendFuncSeparate() combination\r\n        gl.enable(gl.BLEND);\r\n        gl.blendEquation(gl.FUNC_ADD);\r\n        gl.blendFunc(gl.ZERO, gl.SRC_COLOR);\r\n\r\n      }\r\n      else if (blending === THREE.CustomBlending) {\r\n\r\n        gl.enable(gl.BLEND);\r\n\r\n      }\r\n      else {\r\n\r\n        gl.enable(gl.BLEND);\r\n        gl.blendEquationSeparate(gl.FUNC_ADD, gl.FUNC_ADD);\r\n        gl.blendFuncSeparate(gl.SRC_ALPHA, gl.ONE_MINUS_SRC_ALPHA, gl.ONE, gl.ONE_MINUS_SRC_ALPHA);\r\n\r\n      }\r\n\r\n      currentBlending = blending;\r\n\r\n    }\r\n\r\n    if (blending === THREE.CustomBlending) {\r\n\r\n      blendEquationAlpha = blendEquationAlpha || blendEquation;\r\n      blendSrcAlpha = blendSrcAlpha || blendSrc;\r\n      blendDstAlpha = blendDstAlpha || blendDst;\r\n\r\n      if (blendEquation !== currentBlendEquation || blendEquationAlpha !== currentBlendEquationAlpha) {\r\n\r\n        gl.blendEquationSeparate(paramThreeToGL(blendEquation), paramThreeToGL(blendEquationAlpha));\r\n\r\n        currentBlendEquation = blendEquation;\r\n        currentBlendEquationAlpha = blendEquationAlpha;\r\n\r\n      }\r\n\r\n      if (blendSrc !== currentBlendSrc || blendDst !== currentBlendDst || blendSrcAlpha !== currentBlendSrcAlpha || blendDstAlpha !== currentBlendDstAlpha) {\r\n\r\n        gl.blendFuncSeparate(paramThreeToGL(blendSrc), paramThreeToGL(blendDst), paramThreeToGL(blendSrcAlpha), paramThreeToGL(blendDstAlpha));\r\n\r\n        currentBlendSrc = blendSrc;\r\n        currentBlendDst = blendDst;\r\n        currentBlendSrcAlpha = blendSrcAlpha;\r\n        currentBlendDstAlpha = blendDstAlpha;\r\n\r\n      }\r\n\r\n    }\r\n    else {\r\n\r\n      currentBlendEquation = null;\r\n      currentBlendSrc = null;\r\n      currentBlendDst = null;\r\n      currentBlendEquationAlpha = null;\r\n      currentBlendSrcAlpha = null;\r\n      currentBlendDstAlpha = null;\r\n\r\n    }\r\n\r\n  };\r\n\r\n  this.setDepthTest = function(depthTest) {\r\n\r\n    if (currentDepthTest !== depthTest) {\r\n\r\n      if (depthTest) {\r\n\r\n        gl.enable(gl.DEPTH_TEST);\r\n\r\n      }\r\n      else {\r\n\r\n        gl.disable(gl.DEPTH_TEST);\r\n\r\n      }\r\n\r\n      currentDepthTest = depthTest;\r\n\r\n    }\r\n\r\n  };\r\n\r\n  this.setDepthWrite = function(depthWrite) {\r\n\r\n    if (currentDepthWrite !== depthWrite) {\r\n\r\n      gl.depthMask(depthWrite);\r\n      currentDepthWrite = depthWrite;\r\n\r\n    }\r\n\r\n  };\r\n\r\n  this.setColorWrite = function(colorWrite) {\r\n\r\n    if (currentColorWrite !== colorWrite) {\r\n\r\n      gl.colorMask(colorWrite, colorWrite, colorWrite, colorWrite);\r\n      currentColorWrite = colorWrite;\r\n\r\n    }\r\n\r\n  };\r\n\r\n  this.setDoubleSided = function(doubleSided) {\r\n\r\n    if (currentDoubleSided !== doubleSided) {\r\n\r\n      if (doubleSided) {\r\n\r\n        gl.disable(gl.CULL_FACE);\r\n\r\n      }\r\n      else {\r\n\r\n        gl.enable(gl.CULL_FACE);\r\n\r\n      }\r\n\r\n      currentDoubleSided = doubleSided;\r\n\r\n    }\r\n\r\n  };\r\n\r\n  this.setFlipSided = function(flipSided) {\r\n\r\n    if (currentFlipSided !== flipSided) {\r\n\r\n      if (flipSided) {\r\n\r\n        gl.frontFace(gl.CW);\r\n\r\n      }\r\n      else {\r\n\r\n        gl.frontFace(gl.CCW);\r\n\r\n      }\r\n\r\n      currentFlipSided = flipSided;\r\n\r\n    }\r\n\r\n  };\r\n\r\n  this.setLineWidth = function(width) {\r\n\r\n    if (width !== currentLineWidth) {\r\n\r\n      gl.lineWidth(width);\r\n\r\n      currentLineWidth = width;\r\n\r\n    }\r\n\r\n  };\r\n\r\n  this.setPolygonOffset = function(polygonoffset, factor, units) {\r\n\r\n    if (currentPolygonOffset !== polygonoffset) {\r\n\r\n      if (polygonoffset) {\r\n\r\n        gl.enable(gl.POLYGON_OFFSET_FILL);\r\n\r\n      }\r\n      else {\r\n\r\n        gl.disable(gl.POLYGON_OFFSET_FILL);\r\n\r\n      }\r\n\r\n      currentPolygonOffset = polygonoffset;\r\n\r\n    }\r\n\r\n    if (polygonoffset && (currentPolygonOffsetFactor !== factor || currentPolygonOffsetUnits !== units)) {\r\n\r\n      gl.polygonOffset(factor, units);\r\n\r\n      currentPolygonOffsetFactor = factor;\r\n      currentPolygonOffsetUnits = units;\r\n\r\n    }\r\n\r\n  };\r\n\r\n  this.reset = function() {\r\n\r\n    for (var i = 0; i < enabledAttributes.length; i++) {\r\n\r\n      enabledAttributes[i] = 0;\r\n\r\n    }\r\n\r\n    currentBlending = null;\r\n    currentDepthTest = null;\r\n    currentDepthWrite = null;\r\n    currentColorWrite = null;\r\n    currentDoubleSided = null;\r\n    currentFlipSided = null;\r\n\r\n  };\r\n\r\n};\r\n\r\n// File:src/renderers/webgl/plugins/LensFlarePlugin.js\r\n\r\n/**\r\n * @author mikael emtinger / http://gomo.se/\r\n * @author alteredq / http://alteredqualia.com/\r\n */\r\n\r\nTHREE.LensFlarePlugin = function(renderer, flares) {\r\n\r\n  var gl = renderer.context;\r\n\r\n  var vertexBuffer, elementBuffer;\r\n  var program, attributes, uniforms;\r\n  var hasVertexTexture;\r\n\r\n  var tempTexture, occlusionTexture;\r\n\r\n  var init = function() {\r\n\r\n    var vertices = new Float32Array([-1, -1, 0, 0,\r\n      1, -1, 1, 0,\r\n      1, 1, 1, 1, -1, 1, 0, 1\r\n    ]);\r\n\r\n    var faces = new Uint16Array([\r\n      0, 1, 2,\r\n      0, 2, 3\r\n    ]);\r\n\r\n    // buffers\r\n\r\n    vertexBuffer = gl.createBuffer();\r\n    elementBuffer = gl.createBuffer();\r\n\r\n    gl.bindBuffer(gl.ARRAY_BUFFER, vertexBuffer);\r\n    gl.bufferData(gl.ARRAY_BUFFER, vertices, gl.STATIC_DRAW);\r\n\r\n    gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, elementBuffer);\r\n    gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, faces, gl.STATIC_DRAW);\r\n\r\n    // textures\r\n\r\n    tempTexture = gl.createTexture();\r\n    occlusionTexture = gl.createTexture();\r\n\r\n    gl.bindTexture(gl.TEXTURE_2D, tempTexture);\r\n    gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGB, 16, 16, 0, gl.RGB, gl.UNSIGNED_BYTE, null);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);\r\n\r\n    gl.bindTexture(gl.TEXTURE_2D, occlusionTexture);\r\n    gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, 16, 16, 0, gl.RGBA, gl.UNSIGNED_BYTE, null);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);\r\n\r\n    hasVertexTexture = gl.getParameter(gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS) > 0;\r\n\r\n    var shader;\r\n\r\n    if (hasVertexTexture) {\r\n\r\n      shader = {\r\n\r\n        vertexShader: [\r\n\r\n          \"uniform lowp int renderType;\",\r\n\r\n          \"uniform vec3 screenPosition;\",\r\n          \"uniform vec2 scale;\",\r\n          \"uniform float rotation;\",\r\n\r\n          \"uniform sampler2D occlusionMap;\",\r\n\r\n          \"attribute vec2 position;\",\r\n          \"attribute vec2 uv;\",\r\n\r\n          \"varying vec2 vUV;\",\r\n          \"varying float vVisibility;\",\r\n\r\n          \"void main() {\",\r\n\r\n          \"vUV = uv;\",\r\n\r\n          \"vec2 pos = position;\",\r\n\r\n          \"if( renderType == 2 ) {\",\r\n\r\n          \"vec4 visibility = texture2D( occlusionMap, vec2( 0.1, 0.1 ) );\",\r\n          \"visibility += texture2D( occlusionMap, vec2( 0.5, 0.1 ) );\",\r\n          \"visibility += texture2D( occlusionMap, vec2( 0.9, 0.1 ) );\",\r\n          \"visibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) );\",\r\n          \"visibility += texture2D( occlusionMap, vec2( 0.9, 0.9 ) );\",\r\n          \"visibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) );\",\r\n          \"visibility += texture2D( occlusionMap, vec2( 0.1, 0.9 ) );\",\r\n          \"visibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) );\",\r\n          \"visibility += texture2D( occlusionMap, vec2( 0.5, 0.5 ) );\",\r\n\r\n          \"vVisibility =        visibility.r / 9.0;\",\r\n          \"vVisibility *= 1.0 - visibility.g / 9.0;\",\r\n          \"vVisibility *=       visibility.b / 9.0;\",\r\n          \"vVisibility *= 1.0 - visibility.a / 9.0;\",\r\n\r\n          \"pos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;\",\r\n          \"pos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;\",\r\n\r\n          \"}\",\r\n\r\n          \"gl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );\",\r\n\r\n          \"}\"\r\n\r\n        ].join(\"\\n\"),\r\n\r\n        fragmentShader: [\r\n\r\n          \"uniform lowp int renderType;\",\r\n\r\n          \"uniform sampler2D map;\",\r\n          \"uniform float opacity;\",\r\n          \"uniform vec3 color;\",\r\n\r\n          \"varying vec2 vUV;\",\r\n          \"varying float vVisibility;\",\r\n\r\n          \"void main() {\",\r\n\r\n          // pink square\r\n\r\n          \"if( renderType == 0 ) {\",\r\n\r\n          \"gl_FragColor = vec4( 1.0, 0.0, 1.0, 0.0 );\",\r\n\r\n          // restore\r\n\r\n          \"} else if( renderType == 1 ) {\",\r\n\r\n          \"gl_FragColor = texture2D( map, vUV );\",\r\n\r\n          // flare\r\n\r\n          \"} else {\",\r\n\r\n          \"vec4 texture = texture2D( map, vUV );\",\r\n          \"texture.a *= opacity * vVisibility;\",\r\n          \"gl_FragColor = texture;\",\r\n          \"gl_FragColor.rgb *= color;\",\r\n\r\n          \"}\",\r\n\r\n          \"}\"\r\n\r\n        ].join(\"\\n\")\r\n\r\n      };\r\n\r\n    }\r\n    else {\r\n\r\n      shader = {\r\n\r\n        vertexShader: [\r\n\r\n          \"uniform lowp int renderType;\",\r\n\r\n          \"uniform vec3 screenPosition;\",\r\n          \"uniform vec2 scale;\",\r\n          \"uniform float rotation;\",\r\n\r\n          \"attribute vec2 position;\",\r\n          \"attribute vec2 uv;\",\r\n\r\n          \"varying vec2 vUV;\",\r\n\r\n          \"void main() {\",\r\n\r\n          \"vUV = uv;\",\r\n\r\n          \"vec2 pos = position;\",\r\n\r\n          \"if( renderType == 2 ) {\",\r\n\r\n          \"pos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;\",\r\n          \"pos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;\",\r\n\r\n          \"}\",\r\n\r\n          \"gl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );\",\r\n\r\n          \"}\"\r\n\r\n        ].join(\"\\n\"),\r\n\r\n        fragmentShader: [\r\n\r\n          \"precision mediump float;\",\r\n\r\n          \"uniform lowp int renderType;\",\r\n\r\n          \"uniform sampler2D map;\",\r\n          \"uniform sampler2D occlusionMap;\",\r\n          \"uniform float opacity;\",\r\n          \"uniform vec3 color;\",\r\n\r\n          \"varying vec2 vUV;\",\r\n\r\n          \"void main() {\",\r\n\r\n          // pink square\r\n\r\n          \"if( renderType == 0 ) {\",\r\n\r\n          \"gl_FragColor = vec4( texture2D( map, vUV ).rgb, 0.0 );\",\r\n\r\n          // restore\r\n\r\n          \"} else if( renderType == 1 ) {\",\r\n\r\n          \"gl_FragColor = texture2D( map, vUV );\",\r\n\r\n          // flare\r\n\r\n          \"} else {\",\r\n\r\n          \"float visibility = texture2D( occlusionMap, vec2( 0.5, 0.1 ) ).a;\",\r\n          \"visibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) ).a;\",\r\n          \"visibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) ).a;\",\r\n          \"visibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) ).a;\",\r\n          \"visibility = ( 1.0 - visibility / 4.0 );\",\r\n\r\n          \"vec4 texture = texture2D( map, vUV );\",\r\n          \"texture.a *= opacity * visibility;\",\r\n          \"gl_FragColor = texture;\",\r\n          \"gl_FragColor.rgb *= color;\",\r\n\r\n          \"}\",\r\n\r\n          \"}\"\r\n\r\n        ].join(\"\\n\")\r\n\r\n      };\r\n\r\n    }\r\n\r\n    program = createProgram(shader);\r\n\r\n    attributes = {\r\n      vertex: gl.getAttribLocation(program, \"position\"),\r\n      uv: gl.getAttribLocation(program, \"uv\")\r\n    }\r\n\r\n    uniforms = {\r\n      renderType: gl.getUniformLocation(program, \"renderType\"),\r\n      map: gl.getUniformLocation(program, \"map\"),\r\n      occlusionMap: gl.getUniformLocation(program, \"occlusionMap\"),\r\n      opacity: gl.getUniformLocation(program, \"opacity\"),\r\n      color: gl.getUniformLocation(program, \"color\"),\r\n      scale: gl.getUniformLocation(program, \"scale\"),\r\n      rotation: gl.getUniformLocation(program, \"rotation\"),\r\n      screenPosition: gl.getUniformLocation(program, \"screenPosition\")\r\n    };\r\n\r\n  };\r\n\r\n  /*\r\n   * Render lens flares\r\n   * Method: renders 16x16 0xff00ff-colored points scattered over the light source area,\r\n   *         reads these back and calculates occlusion.\r\n   */\r\n\r\n  this.render = function(scene, camera, viewportWidth, viewportHeight) {\r\n\r\n    if (flares.length === 0) return;\r\n\r\n    var tempPosition = new THREE.Vector3();\r\n\r\n    var invAspect = viewportHeight / viewportWidth,\r\n      halfViewportWidth = viewportWidth * 0.5,\r\n      halfViewportHeight = viewportHeight * 0.5;\r\n\r\n    var size = 16 / viewportHeight,\r\n      scale = new THREE.Vector2(size * invAspect, size);\r\n\r\n    var screenPosition = new THREE.Vector3(1, 1, 0),\r\n      screenPositionPixels = new THREE.Vector2(1, 1);\r\n\r\n    if (program === undefined) {\r\n\r\n      init();\r\n\r\n    }\r\n\r\n    gl.useProgram(program);\r\n\r\n    gl.enableVertexAttribArray(attributes.vertex);\r\n    gl.enableVertexAttribArray(attributes.uv);\r\n\r\n    // loop through all lens flares to update their occlusion and positions\r\n    // setup gl and common used attribs/unforms\r\n\r\n    gl.uniform1i(uniforms.occlusionMap, 0);\r\n    gl.uniform1i(uniforms.map, 1);\r\n\r\n    gl.bindBuffer(gl.ARRAY_BUFFER, vertexBuffer);\r\n    gl.vertexAttribPointer(attributes.vertex, 2, gl.FLOAT, false, 2 * 8, 0);\r\n    gl.vertexAttribPointer(attributes.uv, 2, gl.FLOAT, false, 2 * 8, 8);\r\n\r\n    gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, elementBuffer);\r\n\r\n    gl.disable(gl.CULL_FACE);\r\n    gl.depthMask(false);\r\n\r\n    for (var i = 0, l = flares.length; i < l; i++) {\r\n\r\n      size = 16 / viewportHeight;\r\n      scale.set(size * invAspect, size);\r\n\r\n      // calc object screen position\r\n\r\n      var flare = flares[i];\r\n\r\n      tempPosition.set(flare.matrixWorld.elements[12], flare.matrixWorld.elements[13], flare.matrixWorld.elements[14]);\r\n\r\n      tempPosition.applyMatrix4(camera.matrixWorldInverse);\r\n      tempPosition.applyProjection(camera.projectionMatrix);\r\n\r\n      // setup arrays for gl programs\r\n\r\n      screenPosition.copy(tempPosition)\r\n\r\n      screenPositionPixels.x = screenPosition.x * halfViewportWidth + halfViewportWidth;\r\n      screenPositionPixels.y = screenPosition.y * halfViewportHeight + halfViewportHeight;\r\n\r\n      // screen cull\r\n\r\n      if (hasVertexTexture || (\r\n          screenPositionPixels.x > 0 &&\r\n          screenPositionPixels.x < viewportWidth &&\r\n          screenPositionPixels.y > 0 &&\r\n          screenPositionPixels.y < viewportHeight)) {\r\n\r\n        // save current RGB to temp texture\r\n\r\n        gl.activeTexture(gl.TEXTURE1);\r\n        gl.bindTexture(gl.TEXTURE_2D, tempTexture);\r\n        gl.copyTexImage2D(gl.TEXTURE_2D, 0, gl.RGB, screenPositionPixels.x - 8, screenPositionPixels.y - 8, 16, 16, 0);\r\n\r\n\r\n        // render pink quad\r\n\r\n        gl.uniform1i(uniforms.renderType, 0);\r\n        gl.uniform2f(uniforms.scale, scale.x, scale.y);\r\n        gl.uniform3f(uniforms.screenPosition, screenPosition.x, screenPosition.y, screenPosition.z);\r\n\r\n        gl.disable(gl.BLEND);\r\n        gl.enable(gl.DEPTH_TEST);\r\n\r\n        gl.drawElements(gl.TRIANGLES, 6, gl.UNSIGNED_SHORT, 0);\r\n\r\n\r\n        // copy result to occlusionMap\r\n\r\n        gl.activeTexture(gl.TEXTURE0);\r\n        gl.bindTexture(gl.TEXTURE_2D, occlusionTexture);\r\n        gl.copyTexImage2D(gl.TEXTURE_2D, 0, gl.RGBA, screenPositionPixels.x - 8, screenPositionPixels.y - 8, 16, 16, 0);\r\n\r\n\r\n        // restore graphics\r\n\r\n        gl.uniform1i(uniforms.renderType, 1);\r\n        gl.disable(gl.DEPTH_TEST);\r\n\r\n        gl.activeTexture(gl.TEXTURE1);\r\n        gl.bindTexture(gl.TEXTURE_2D, tempTexture);\r\n        gl.drawElements(gl.TRIANGLES, 6, gl.UNSIGNED_SHORT, 0);\r\n\r\n\r\n        // update object positions\r\n\r\n        flare.positionScreen.copy(screenPosition)\r\n\r\n        if (flare.customUpdateCallback) {\r\n\r\n          flare.customUpdateCallback(flare);\r\n\r\n        }\r\n        else {\r\n\r\n          flare.updateLensFlares();\r\n\r\n        }\r\n\r\n        // render flares\r\n\r\n        gl.uniform1i(uniforms.renderType, 2);\r\n        gl.enable(gl.BLEND);\r\n\r\n        for (var j = 0, jl = flare.lensFlares.length; j < jl; j++) {\r\n\r\n          var sprite = flare.lensFlares[j];\r\n\r\n          if (sprite.opacity > 0.001 && sprite.scale > 0.001) {\r\n\r\n            screenPosition.x = sprite.x;\r\n            screenPosition.y = sprite.y;\r\n            screenPosition.z = sprite.z;\r\n\r\n            size = sprite.size * sprite.scale / viewportHeight;\r\n\r\n            scale.x = size * invAspect;\r\n            scale.y = size;\r\n\r\n            gl.uniform3f(uniforms.screenPosition, screenPosition.x, screenPosition.y, screenPosition.z);\r\n            gl.uniform2f(uniforms.scale, scale.x, scale.y);\r\n            gl.uniform1f(uniforms.rotation, sprite.rotation);\r\n\r\n            gl.uniform1f(uniforms.opacity, sprite.opacity);\r\n            gl.uniform3f(uniforms.color, sprite.color.r, sprite.color.g, sprite.color.b);\r\n\r\n            renderer.state.setBlending(sprite.blending, sprite.blendEquation, sprite.blendSrc, sprite.blendDst);\r\n            renderer.setTexture(sprite.texture, 1);\r\n\r\n            gl.drawElements(gl.TRIANGLES, 6, gl.UNSIGNED_SHORT, 0);\r\n\r\n          }\r\n\r\n        }\r\n\r\n      }\r\n\r\n    }\r\n\r\n    // restore gl\r\n\r\n    gl.enable(gl.CULL_FACE);\r\n    gl.enable(gl.DEPTH_TEST);\r\n    gl.depthMask(true);\r\n\r\n    renderer.resetGLState();\r\n\r\n  };\r\n\r\n  function createProgram(shader) {\r\n\r\n    var program = gl.createProgram();\r\n\r\n    var fragmentShader = gl.createShader(gl.FRAGMENT_SHADER);\r\n    var vertexShader = gl.createShader(gl.VERTEX_SHADER);\r\n\r\n    var prefix = \"precision \" + renderer.getPrecision() + \" float;\\n\";\r\n\r\n    gl.shaderSource(fragmentShader, prefix + shader.fragmentShader);\r\n    gl.shaderSource(vertexShader, prefix + shader.vertexShader);\r\n\r\n    gl.compileShader(fragmentShader);\r\n    gl.compileShader(vertexShader);\r\n\r\n    gl.attachShader(program, fragmentShader);\r\n    gl.attachShader(program, vertexShader);\r\n\r\n    gl.linkProgram(program);\r\n\r\n    return program;\r\n\r\n  }\r\n\r\n};\r\n\r\n// File:src/renderers/webgl/plugins/ShadowMapPlugin.js\r\n\r\n/**\r\n * @author alteredq / http://alteredqualia.com/\r\n */\r\n\r\nTHREE.ShadowMapPlugin = function(_renderer, _lights, _webglObjects, _webglObjectsImmediate) {\r\n\r\n  var _gl = _renderer.context;\r\n\r\n  var _depthMaterial, _depthMaterialMorph, _depthMaterialSkin, _depthMaterialMorphSkin,\r\n\r\n    _frustum = new THREE.Frustum(),\r\n    _projScreenMatrix = new THREE.Matrix4(),\r\n\r\n    _min = new THREE.Vector3(),\r\n    _max = new THREE.Vector3(),\r\n\r\n    _matrixPosition = new THREE.Vector3(),\r\n\r\n    _renderList = [];\r\n\r\n  // init\r\n\r\n  var depthShader = THREE.ShaderLib[\"depthRGBA\"];\r\n  var depthUniforms = THREE.UniformsUtils.clone(depthShader.uniforms);\r\n\r\n  _depthMaterial = new THREE.ShaderMaterial({\r\n    uniforms: depthUniforms,\r\n    vertexShader: depthShader.vertexShader,\r\n    fragmentShader: depthShader.fragmentShader\r\n  });\r\n\r\n  _depthMaterialMorph = new THREE.ShaderMaterial({\r\n    uniforms: depthUniforms,\r\n    vertexShader: depthShader.vertexShader,\r\n    fragmentShader: depthShader.fragmentShader,\r\n    morphTargets: true\r\n  });\r\n\r\n  _depthMaterialSkin = new THREE.ShaderMaterial({\r\n    uniforms: depthUniforms,\r\n    vertexShader: depthShader.vertexShader,\r\n    fragmentShader: depthShader.fragmentShader,\r\n    skinning: true\r\n  });\r\n\r\n  _depthMaterialMorphSkin = new THREE.ShaderMaterial({\r\n    uniforms: depthUniforms,\r\n    vertexShader: depthShader.vertexShader,\r\n    fragmentShader: depthShader.fragmentShader,\r\n    morphTargets: true,\r\n    skinning: true\r\n  });\r\n\r\n  _depthMaterial._shadowPass = true;\r\n  _depthMaterialMorph._shadowPass = true;\r\n  _depthMaterialSkin._shadowPass = true;\r\n  _depthMaterialMorphSkin._shadowPass = true;\r\n\r\n  this.render = function(scene, camera) {\r\n\r\n    if (_renderer.shadowMapEnabled === false) return;\r\n\r\n    var i, il, j, jl, n,\r\n\r\n      shadowMap, shadowMatrix, shadowCamera,\r\n      buffer, material,\r\n      webglObject, object, light,\r\n\r\n      lights = [],\r\n      k = 0,\r\n\r\n      fog = null;\r\n\r\n    // set GL state for depth map\r\n\r\n    _gl.clearColor(1, 1, 1, 1);\r\n    _gl.disable(_gl.BLEND);\r\n\r\n    _gl.enable(_gl.CULL_FACE);\r\n    _gl.frontFace(_gl.CCW);\r\n\r\n    if (_renderer.shadowMapCullFace === THREE.CullFaceFront) {\r\n\r\n      _gl.cullFace(_gl.FRONT);\r\n\r\n    }\r\n    else {\r\n\r\n      _gl.cullFace(_gl.BACK);\r\n\r\n    }\r\n\r\n    _renderer.state.setDepthTest(true);\r\n\r\n    // preprocess lights\r\n    // \t- skip lights that are not casting shadows\r\n    //\t- create virtual lights for cascaded shadow maps\r\n\r\n    for (i = 0, il = _lights.length; i < il; i++) {\r\n\r\n      light = _lights[i];\r\n\r\n      if (!light.castShadow) continue;\r\n\r\n      if ((light instanceof THREE.DirectionalLight) && light.shadowCascade) {\r\n\r\n        for (n = 0; n < light.shadowCascadeCount; n++) {\r\n\r\n          var virtualLight;\r\n\r\n          if (!light.shadowCascadeArray[n]) {\r\n\r\n            virtualLight = createVirtualLight(light, n);\r\n            virtualLight.originalCamera = camera;\r\n\r\n            var gyro = new THREE.Gyroscope();\r\n            gyro.position.copy(light.shadowCascadeOffset);\r\n\r\n            gyro.add(virtualLight);\r\n            gyro.add(virtualLight.target);\r\n\r\n            camera.add(gyro);\r\n\r\n            light.shadowCascadeArray[n] = virtualLight;\r\n\r\n            //console.log( \"Created virtualLight\", virtualLight );\r\n\r\n          }\r\n          else {\r\n\r\n            virtualLight = light.shadowCascadeArray[n];\r\n\r\n          }\r\n\r\n          updateVirtualLight(light, n);\r\n\r\n          lights[k] = virtualLight;\r\n          k++;\r\n\r\n        }\r\n\r\n      }\r\n      else {\r\n\r\n        lights[k] = light;\r\n        k++;\r\n\r\n      }\r\n\r\n    }\r\n\r\n    // render depth map\r\n\r\n    for (i = 0, il = lights.length; i < il; i++) {\r\n\r\n      light = lights[i];\r\n\r\n      if (!light.shadowMap) {\r\n\r\n        var shadowFilter = THREE.LinearFilter;\r\n\r\n        if (_renderer.shadowMapType === THREE.PCFSoftShadowMap) {\r\n\r\n          shadowFilter = THREE.NearestFilter;\r\n\r\n        }\r\n\r\n        var pars = {\r\n          minFilter: shadowFilter,\r\n          magFilter: shadowFilter,\r\n          format: THREE.RGBAFormat\r\n        };\r\n\r\n        light.shadowMap = new THREE.WebGLRenderTarget(light.shadowMapWidth, light.shadowMapHeight, pars);\r\n        light.shadowMapSize = new THREE.Vector2(light.shadowMapWidth, light.shadowMapHeight);\r\n\r\n        light.shadowMatrix = new THREE.Matrix4();\r\n\r\n      }\r\n\r\n      if (!light.shadowCamera) {\r\n\r\n        if (light instanceof THREE.SpotLight) {\r\n\r\n          light.shadowCamera = new THREE.PerspectiveCamera(light.shadowCameraFov, light.shadowMapWidth / light.shadowMapHeight, light.shadowCameraNear, light.shadowCameraFar);\r\n\r\n        }\r\n        else if (light instanceof THREE.DirectionalLight) {\r\n\r\n          light.shadowCamera = new THREE.OrthographicCamera(light.shadowCameraLeft, light.shadowCameraRight, light.shadowCameraTop, light.shadowCameraBottom, light.shadowCameraNear, light.shadowCameraFar);\r\n\r\n        }\r\n        else {\r\n\r\n          THREE.error(\"THREE.ShadowMapPlugin: Unsupported light type for shadow\", light);\r\n          continue;\r\n\r\n        }\r\n\r\n        scene.add(light.shadowCamera);\r\n\r\n        if (scene.autoUpdate === true) scene.updateMatrixWorld();\r\n\r\n      }\r\n\r\n      if (light.shadowCameraVisible && !light.cameraHelper) {\r\n\r\n        light.cameraHelper = new THREE.CameraHelper(light.shadowCamera);\r\n        scene.add(light.cameraHelper);\r\n\r\n      }\r\n\r\n      if (light.isVirtual && virtualLight.originalCamera == camera) {\r\n\r\n        updateShadowCamera(camera, light);\r\n\r\n      }\r\n\r\n      shadowMap = light.shadowMap;\r\n      shadowMatrix = light.shadowMatrix;\r\n      shadowCamera = light.shadowCamera;\r\n\r\n      //\r\n\r\n      shadowCamera.position.setFromMatrixPosition(light.matrixWorld);\r\n      _matrixPosition.setFromMatrixPosition(light.target.matrixWorld);\r\n      shadowCamera.lookAt(_matrixPosition);\r\n      shadowCamera.updateMatrixWorld();\r\n\r\n      shadowCamera.matrixWorldInverse.getInverse(shadowCamera.matrixWorld);\r\n\r\n      //\r\n\r\n      if (light.cameraHelper) light.cameraHelper.visible = light.shadowCameraVisible;\r\n      if (light.shadowCameraVisible) light.cameraHelper.update();\r\n\r\n      // compute shadow matrix\r\n\r\n      shadowMatrix.set(\r\n        0.5, 0.0, 0.0, 0.5,\r\n        0.0, 0.5, 0.0, 0.5,\r\n        0.0, 0.0, 0.5, 0.5,\r\n        0.0, 0.0, 0.0, 1.0\r\n      );\r\n\r\n      shadowMatrix.multiply(shadowCamera.projectionMatrix);\r\n      shadowMatrix.multiply(shadowCamera.matrixWorldInverse);\r\n\r\n      // update camera matrices and frustum\r\n\r\n      _projScreenMatrix.multiplyMatrices(shadowCamera.projectionMatrix, shadowCamera.matrixWorldInverse);\r\n      _frustum.setFromMatrix(_projScreenMatrix);\r\n\r\n      // render shadow map\r\n\r\n      _renderer.setRenderTarget(shadowMap);\r\n      _renderer.clear();\r\n\r\n      // set object matrices & frustum culling\r\n\r\n      _renderList.length = 0;\r\n\r\n      projectObject(scene, scene, shadowCamera);\r\n\r\n\r\n      // render regular objects\r\n\r\n      var objectMaterial, useMorphing, useSkinning;\r\n\r\n      for (j = 0, jl = _renderList.length; j < jl; j++) {\r\n\r\n        webglObject = _renderList[j];\r\n\r\n        object = webglObject.object;\r\n        buffer = webglObject.buffer;\r\n\r\n        // culling is overriden globally for all objects\r\n        // while rendering depth map\r\n\r\n        // need to deal with MeshFaceMaterial somehow\r\n        // in that case just use the first of material.materials for now\r\n        // (proper solution would require to break objects by materials\r\n        //  similarly to regular rendering and then set corresponding\r\n        //  depth materials per each chunk instead of just once per object)\r\n\r\n        objectMaterial = getObjectMaterial(object);\r\n\r\n        useMorphing = object.geometry.morphTargets !== undefined && object.geometry.morphTargets.length > 0 && objectMaterial.morphTargets;\r\n        useSkinning = object instanceof THREE.SkinnedMesh && objectMaterial.skinning;\r\n\r\n        if (object.customDepthMaterial) {\r\n\r\n          material = object.customDepthMaterial;\r\n\r\n        }\r\n        else if (useSkinning) {\r\n\r\n          material = useMorphing ? _depthMaterialMorphSkin : _depthMaterialSkin;\r\n\r\n        }\r\n        else if (useMorphing) {\r\n\r\n          material = _depthMaterialMorph;\r\n\r\n        }\r\n        else {\r\n\r\n          material = _depthMaterial;\r\n\r\n        }\r\n\r\n        _renderer.setMaterialFaces(objectMaterial);\r\n\r\n        if (buffer instanceof THREE.BufferGeometry) {\r\n\r\n          _renderer.renderBufferDirect(shadowCamera, _lights, fog, material, buffer, object);\r\n\r\n        }\r\n        else {\r\n\r\n          _renderer.renderBuffer(shadowCamera, _lights, fog, material, buffer, object);\r\n\r\n        }\r\n\r\n      }\r\n\r\n      // set matrices and render immediate objects\r\n\r\n      for (j = 0, jl = _webglObjectsImmediate.length; j < jl; j++) {\r\n\r\n        webglObject = _webglObjectsImmediate[j];\r\n        object = webglObject.object;\r\n\r\n        if (object.visible && object.castShadow) {\r\n\r\n          object._modelViewMatrix.multiplyMatrices(shadowCamera.matrixWorldInverse, object.matrixWorld);\r\n\r\n          _renderer.renderImmediateObject(shadowCamera, _lights, fog, _depthMaterial, object);\r\n\r\n        }\r\n\r\n      }\r\n\r\n    }\r\n\r\n    // restore GL state\r\n\r\n    var clearColor = _renderer.getClearColor(),\r\n      clearAlpha = _renderer.getClearAlpha();\r\n\r\n    _gl.clearColor(clearColor.r, clearColor.g, clearColor.b, clearAlpha);\r\n    _gl.enable(_gl.BLEND);\r\n\r\n    if (_renderer.shadowMapCullFace === THREE.CullFaceFront) {\r\n\r\n      _gl.cullFace(_gl.BACK);\r\n\r\n    }\r\n\r\n    _renderer.resetGLState();\r\n\r\n  };\r\n\r\n  function projectObject(scene, object, shadowCamera) {\r\n\r\n    if (object.visible) {\r\n\r\n      var webglObjects = _webglObjects[object.id];\r\n\r\n      if (webglObjects && object.castShadow && (object.frustumCulled === false || _frustum.intersectsObject(object) === true)) {\r\n\r\n        for (var i = 0, l = webglObjects.length; i < l; i++) {\r\n\r\n          var webglObject = webglObjects[i];\r\n\r\n          object._modelViewMatrix.multiplyMatrices(shadowCamera.matrixWorldInverse, object.matrixWorld);\r\n          _renderList.push(webglObject);\r\n\r\n        }\r\n\r\n      }\r\n\r\n      for (var i = 0, l = object.children.length; i < l; i++) {\r\n\r\n        projectObject(scene, object.children[i], shadowCamera);\r\n\r\n      }\r\n\r\n    }\r\n\r\n  }\r\n\r\n  function createVirtualLight(light, cascade) {\r\n\r\n    var virtualLight = new THREE.DirectionalLight();\r\n\r\n    virtualLight.isVirtual = true;\r\n\r\n    virtualLight.onlyShadow = true;\r\n    virtualLight.castShadow = true;\r\n\r\n    virtualLight.shadowCameraNear = light.shadowCameraNear;\r\n    virtualLight.shadowCameraFar = light.shadowCameraFar;\r\n\r\n    virtualLight.shadowCameraLeft = light.shadowCameraLeft;\r\n    virtualLight.shadowCameraRight = light.shadowCameraRight;\r\n    virtualLight.shadowCameraBottom = light.shadowCameraBottom;\r\n    virtualLight.shadowCameraTop = light.shadowCameraTop;\r\n\r\n    virtualLight.shadowCameraVisible = light.shadowCameraVisible;\r\n\r\n    virtualLight.shadowDarkness = light.shadowDarkness;\r\n\r\n    virtualLight.shadowBias = light.shadowCascadeBias[cascade];\r\n    virtualLight.shadowMapWidth = light.shadowCascadeWidth[cascade];\r\n    virtualLight.shadowMapHeight = light.shadowCascadeHeight[cascade];\r\n\r\n    virtualLight.pointsWorld = [];\r\n    virtualLight.pointsFrustum = [];\r\n\r\n    var pointsWorld = virtualLight.pointsWorld,\r\n      pointsFrustum = virtualLight.pointsFrustum;\r\n\r\n    for (var i = 0; i < 8; i++) {\r\n\r\n      pointsWorld[i] = new THREE.Vector3();\r\n      pointsFrustum[i] = new THREE.Vector3();\r\n\r\n    }\r\n\r\n    var nearZ = light.shadowCascadeNearZ[cascade];\r\n    var farZ = light.shadowCascadeFarZ[cascade];\r\n\r\n    pointsFrustum[0].set(-1, -1, nearZ);\r\n    pointsFrustum[1].set(1, -1, nearZ);\r\n    pointsFrustum[2].set(-1, 1, nearZ);\r\n    pointsFrustum[3].set(1, 1, nearZ);\r\n\r\n    pointsFrustum[4].set(-1, -1, farZ);\r\n    pointsFrustum[5].set(1, -1, farZ);\r\n    pointsFrustum[6].set(-1, 1, farZ);\r\n    pointsFrustum[7].set(1, 1, farZ);\r\n\r\n    return virtualLight;\r\n\r\n  }\r\n\r\n  // Synchronize virtual light with the original light\r\n\r\n  function updateVirtualLight(light, cascade) {\r\n\r\n    var virtualLight = light.shadowCascadeArray[cascade];\r\n\r\n    virtualLight.position.copy(light.position);\r\n    virtualLight.target.position.copy(light.target.position);\r\n    virtualLight.lookAt(virtualLight.target);\r\n\r\n    virtualLight.shadowCameraVisible = light.shadowCameraVisible;\r\n    virtualLight.shadowDarkness = light.shadowDarkness;\r\n\r\n    virtualLight.shadowBias = light.shadowCascadeBias[cascade];\r\n\r\n    var nearZ = light.shadowCascadeNearZ[cascade];\r\n    var farZ = light.shadowCascadeFarZ[cascade];\r\n\r\n    var pointsFrustum = virtualLight.pointsFrustum;\r\n\r\n    pointsFrustum[0].z = nearZ;\r\n    pointsFrustum[1].z = nearZ;\r\n    pointsFrustum[2].z = nearZ;\r\n    pointsFrustum[3].z = nearZ;\r\n\r\n    pointsFrustum[4].z = farZ;\r\n    pointsFrustum[5].z = farZ;\r\n    pointsFrustum[6].z = farZ;\r\n    pointsFrustum[7].z = farZ;\r\n\r\n  }\r\n\r\n  // Fit shadow camera's ortho frustum to camera frustum\r\n\r\n  function updateShadowCamera(camera, light) {\r\n\r\n    var shadowCamera = light.shadowCamera,\r\n      pointsFrustum = light.pointsFrustum,\r\n      pointsWorld = light.pointsWorld;\r\n\r\n    _min.set(Infinity, Infinity, Infinity);\r\n    _max.set(-Infinity, -Infinity, -Infinity);\r\n\r\n    for (var i = 0; i < 8; i++) {\r\n\r\n      var p = pointsWorld[i];\r\n\r\n      p.copy(pointsFrustum[i]);\r\n      p.unproject(camera);\r\n\r\n      p.applyMatrix4(shadowCamera.matrixWorldInverse);\r\n\r\n      if (p.x < _min.x) _min.x = p.x;\r\n      if (p.x > _max.x) _max.x = p.x;\r\n\r\n      if (p.y < _min.y) _min.y = p.y;\r\n      if (p.y > _max.y) _max.y = p.y;\r\n\r\n      if (p.z < _min.z) _min.z = p.z;\r\n      if (p.z > _max.z) _max.z = p.z;\r\n\r\n    }\r\n\r\n    shadowCamera.left = _min.x;\r\n    shadowCamera.right = _max.x;\r\n    shadowCamera.top = _max.y;\r\n    shadowCamera.bottom = _min.y;\r\n\r\n    // can't really fit near/far\r\n    //shadowCamera.near = _min.z;\r\n    //shadowCamera.far = _max.z;\r\n\r\n    shadowCamera.updateProjectionMatrix();\r\n\r\n  }\r\n\r\n  // For the moment just ignore objects that have multiple materials with different animation methods\r\n  // Only the first material will be taken into account for deciding which depth material to use for shadow maps\r\n\r\n  function getObjectMaterial(object) {\r\n\r\n    return object.material instanceof THREE.MeshFaceMaterial ? object.material.materials[0] : object.material;\r\n\r\n  };\r\n\r\n};\r\n\r\n// File:src/renderers/webgl/plugins/SpritePlugin.js\r\n\r\n/**\r\n * @author mikael emtinger / http://gomo.se/\r\n * @author alteredq / http://alteredqualia.com/\r\n */\r\n\r\nTHREE.SpritePlugin = function(renderer, sprites) {\r\n\r\n  var gl = renderer.context;\r\n\r\n  var vertexBuffer, elementBuffer;\r\n  var program, attributes, uniforms;\r\n\r\n  var texture;\r\n\r\n  // decompose matrixWorld\r\n\r\n  var spritePosition = new THREE.Vector3();\r\n  var spriteRotation = new THREE.Quaternion();\r\n  var spriteScale = new THREE.Vector3();\r\n\r\n  var init = function() {\r\n\r\n    var vertices = new Float32Array([-0.5, -0.5, 0, 0,\r\n      0.5, -0.5, 1, 0,\r\n      0.5, 0.5, 1, 1, -0.5, 0.5, 0, 1\r\n    ]);\r\n\r\n    var faces = new Uint16Array([\r\n      0, 1, 2,\r\n      0, 2, 3\r\n    ]);\r\n\r\n    vertexBuffer = gl.createBuffer();\r\n    elementBuffer = gl.createBuffer();\r\n\r\n    gl.bindBuffer(gl.ARRAY_BUFFER, vertexBuffer);\r\n    gl.bufferData(gl.ARRAY_BUFFER, vertices, gl.STATIC_DRAW);\r\n\r\n    gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, elementBuffer);\r\n    gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, faces, gl.STATIC_DRAW);\r\n\r\n    program = createProgram();\r\n\r\n    attributes = {\r\n      position: gl.getAttribLocation(program, 'position'),\r\n      uv: gl.getAttribLocation(program, 'uv')\r\n    };\r\n\r\n    uniforms = {\r\n      uvOffset: gl.getUniformLocation(program, 'uvOffset'),\r\n      uvScale: gl.getUniformLocation(program, 'uvScale'),\r\n\r\n      rotation: gl.getUniformLocation(program, 'rotation'),\r\n      scale: gl.getUniformLocation(program, 'scale'),\r\n\r\n      color: gl.getUniformLocation(program, 'color'),\r\n      map: gl.getUniformLocation(program, 'map'),\r\n      opacity: gl.getUniformLocation(program, 'opacity'),\r\n\r\n      modelViewMatrix: gl.getUniformLocation(program, 'modelViewMatrix'),\r\n      projectionMatrix: gl.getUniformLocation(program, 'projectionMatrix'),\r\n\r\n      fogType: gl.getUniformLocation(program, 'fogType'),\r\n      fogDensity: gl.getUniformLocation(program, 'fogDensity'),\r\n      fogNear: gl.getUniformLocation(program, 'fogNear'),\r\n      fogFar: gl.getUniformLocation(program, 'fogFar'),\r\n      fogColor: gl.getUniformLocation(program, 'fogColor'),\r\n\r\n      alphaTest: gl.getUniformLocation(program, 'alphaTest')\r\n    };\r\n\r\n    var canvas = document.createElement('canvas');\r\n    canvas.width = 8;\r\n    canvas.height = 8;\r\n\r\n    var context = canvas.getContext('2d');\r\n    context.fillStyle = 'white';\r\n    context.fillRect(0, 0, 8, 8);\r\n\r\n    texture = new THREE.Texture(canvas);\r\n    texture.needsUpdate = true;\r\n\r\n  };\r\n\r\n  this.render = function(scene, camera) {\r\n\r\n    if (sprites.length === 0) return;\r\n\r\n    // setup gl\r\n\r\n    if (program === undefined) {\r\n\r\n      init();\r\n\r\n    }\r\n\r\n    gl.useProgram(program);\r\n\r\n    gl.enableVertexAttribArray(attributes.position);\r\n    gl.enableVertexAttribArray(attributes.uv);\r\n\r\n    gl.disable(gl.CULL_FACE);\r\n    gl.enable(gl.BLEND);\r\n\r\n    gl.bindBuffer(gl.ARRAY_BUFFER, vertexBuffer);\r\n    gl.vertexAttribPointer(attributes.position, 2, gl.FLOAT, false, 2 * 8, 0);\r\n    gl.vertexAttribPointer(attributes.uv, 2, gl.FLOAT, false, 2 * 8, 8);\r\n\r\n    gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, elementBuffer);\r\n\r\n    gl.uniformMatrix4fv(uniforms.projectionMatrix, false, camera.projectionMatrix.elements);\r\n\r\n    gl.activeTexture(gl.TEXTURE0);\r\n    gl.uniform1i(uniforms.map, 0);\r\n\r\n    var oldFogType = 0;\r\n    var sceneFogType = 0;\r\n    var fog = scene.fog;\r\n\r\n    if (fog) {\r\n\r\n      gl.uniform3f(uniforms.fogColor, fog.color.r, fog.color.g, fog.color.b);\r\n\r\n      if (fog instanceof THREE.Fog) {\r\n\r\n        gl.uniform1f(uniforms.fogNear, fog.near);\r\n        gl.uniform1f(uniforms.fogFar, fog.far);\r\n\r\n        gl.uniform1i(uniforms.fogType, 1);\r\n        oldFogType = 1;\r\n        sceneFogType = 1;\r\n\r\n      }\r\n      else if (fog instanceof THREE.FogExp2) {\r\n\r\n        gl.uniform1f(uniforms.fogDensity, fog.density);\r\n\r\n        gl.uniform1i(uniforms.fogType, 2);\r\n        oldFogType = 2;\r\n        sceneFogType = 2;\r\n\r\n      }\r\n\r\n    }\r\n    else {\r\n\r\n      gl.uniform1i(uniforms.fogType, 0);\r\n      oldFogType = 0;\r\n      sceneFogType = 0;\r\n\r\n    }\r\n\r\n\r\n    // update positions and sort\r\n\r\n    for (var i = 0, l = sprites.length; i < l; i++) {\r\n\r\n      var sprite = sprites[i];\r\n\r\n      sprite._modelViewMatrix.multiplyMatrices(camera.matrixWorldInverse, sprite.matrixWorld);\r\n      sprite.z = -sprite._modelViewMatrix.elements[14];\r\n\r\n    }\r\n\r\n    sprites.sort(painterSortStable);\r\n\r\n    // render all sprites\r\n\r\n    var scale = [];\r\n\r\n    for (var i = 0, l = sprites.length; i < l; i++) {\r\n\r\n      var sprite = sprites[i];\r\n      var material = sprite.material;\r\n\r\n      gl.uniform1f(uniforms.alphaTest, material.alphaTest);\r\n      gl.uniformMatrix4fv(uniforms.modelViewMatrix, false, sprite._modelViewMatrix.elements);\r\n\r\n      sprite.matrixWorld.decompose(spritePosition, spriteRotation, spriteScale);\r\n\r\n      scale[0] = spriteScale.x;\r\n      scale[1] = spriteScale.y;\r\n\r\n      var fogType = 0;\r\n\r\n      if (scene.fog && material.fog) {\r\n\r\n        fogType = sceneFogType;\r\n\r\n      }\r\n\r\n      if (oldFogType !== fogType) {\r\n\r\n        gl.uniform1i(uniforms.fogType, fogType);\r\n        oldFogType = fogType;\r\n\r\n      }\r\n\r\n      if (material.map !== null) {\r\n\r\n        gl.uniform2f(uniforms.uvOffset, material.map.offset.x, material.map.offset.y);\r\n        gl.uniform2f(uniforms.uvScale, material.map.repeat.x, material.map.repeat.y);\r\n\r\n      }\r\n      else {\r\n\r\n        gl.uniform2f(uniforms.uvOffset, 0, 0);\r\n        gl.uniform2f(uniforms.uvScale, 1, 1);\r\n\r\n      }\r\n\r\n      gl.uniform1f(uniforms.opacity, material.opacity);\r\n      gl.uniform3f(uniforms.color, material.color.r, material.color.g, material.color.b);\r\n\r\n      gl.uniform1f(uniforms.rotation, material.rotation);\r\n      gl.uniform2fv(uniforms.scale, scale);\r\n\r\n      renderer.state.setBlending(material.blending, material.blendEquation, material.blendSrc, material.blendDst);\r\n      renderer.state.setDepthTest(material.depthTest);\r\n      renderer.state.setDepthWrite(material.depthWrite);\r\n\r\n      if (material.map && material.map.image && material.map.image.width) {\r\n\r\n        renderer.setTexture(material.map, 0);\r\n\r\n      }\r\n      else {\r\n\r\n        renderer.setTexture(texture, 0);\r\n\r\n      }\r\n\r\n      gl.drawElements(gl.TRIANGLES, 6, gl.UNSIGNED_SHORT, 0);\r\n\r\n    }\r\n\r\n    // restore gl\r\n\r\n    gl.enable(gl.CULL_FACE);\r\n\r\n    renderer.resetGLState();\r\n\r\n  };\r\n\r\n  function createProgram() {\r\n\r\n    var program = gl.createProgram();\r\n\r\n    var vertexShader = gl.createShader(gl.VERTEX_SHADER);\r\n    var fragmentShader = gl.createShader(gl.FRAGMENT_SHADER);\r\n\r\n    gl.shaderSource(vertexShader, [\r\n\r\n      'precision ' + renderer.getPrecision() + ' float;',\r\n\r\n      'uniform mat4 modelViewMatrix;',\r\n      'uniform mat4 projectionMatrix;',\r\n      'uniform float rotation;',\r\n      'uniform vec2 scale;',\r\n      'uniform vec2 uvOffset;',\r\n      'uniform vec2 uvScale;',\r\n\r\n      'attribute vec2 position;',\r\n      'attribute vec2 uv;',\r\n\r\n      'varying vec2 vUV;',\r\n\r\n      'void main() {',\r\n\r\n      'vUV = uvOffset + uv * uvScale;',\r\n\r\n      'vec2 alignedPosition = position * scale;',\r\n\r\n      'vec2 rotatedPosition;',\r\n      'rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;',\r\n      'rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;',\r\n\r\n      'vec4 finalPosition;',\r\n\r\n      'finalPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );',\r\n      'finalPosition.xy += rotatedPosition;',\r\n      'finalPosition = projectionMatrix * finalPosition;',\r\n\r\n      'gl_Position = finalPosition;',\r\n\r\n      '}'\r\n\r\n    ].join('\\n'));\r\n\r\n    gl.shaderSource(fragmentShader, [\r\n\r\n      'precision ' + renderer.getPrecision() + ' float;',\r\n\r\n      'uniform vec3 color;',\r\n      'uniform sampler2D map;',\r\n      'uniform float opacity;',\r\n\r\n      'uniform int fogType;',\r\n      'uniform vec3 fogColor;',\r\n      'uniform float fogDensity;',\r\n      'uniform float fogNear;',\r\n      'uniform float fogFar;',\r\n      'uniform float alphaTest;',\r\n\r\n      'varying vec2 vUV;',\r\n\r\n      'void main() {',\r\n\r\n      'vec4 texture = texture2D( map, vUV );',\r\n\r\n      'if ( texture.a < alphaTest ) discard;',\r\n\r\n      'gl_FragColor = vec4( color * texture.xyz, texture.a * opacity );',\r\n\r\n      'if ( fogType > 0 ) {',\r\n\r\n      'float depth = gl_FragCoord.z / gl_FragCoord.w;',\r\n      'float fogFactor = 0.0;',\r\n\r\n      'if ( fogType == 1 ) {',\r\n\r\n      'fogFactor = smoothstep( fogNear, fogFar, depth );',\r\n\r\n      '} else {',\r\n\r\n      'const float LOG2 = 1.442695;',\r\n      'float fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );',\r\n      'fogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );',\r\n\r\n      '}',\r\n\r\n      'gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );',\r\n\r\n      '}',\r\n\r\n      '}'\r\n\r\n    ].join('\\n'));\r\n\r\n    gl.compileShader(vertexShader);\r\n    gl.compileShader(fragmentShader);\r\n\r\n    gl.attachShader(program, vertexShader);\r\n    gl.attachShader(program, fragmentShader);\r\n\r\n    gl.linkProgram(program);\r\n\r\n    return program;\r\n\r\n  };\r\n\r\n  function painterSortStable(a, b) {\r\n\r\n    if (a.z !== b.z) {\r\n\r\n      return b.z - a.z;\r\n\r\n    }\r\n    else {\r\n\r\n      return b.id - a.id;\r\n\r\n    }\r\n\r\n  };\r\n\r\n};\r\n\r\n// File:src/extras/GeometryUtils.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.GeometryUtils = {\r\n\r\n  merge: function(geometry1, geometry2, materialIndexOffset) {\r\n\r\n    THREE.warn('THREE.GeometryUtils: .merge() has been moved to Geometry. Use geometry.merge( geometry2, matrix, materialIndexOffset ) instead.');\r\n\r\n    var matrix;\r\n\r\n    if (geometry2 instanceof THREE.Mesh) {\r\n\r\n      geometry2.matrixAutoUpdate && geometry2.updateMatrix();\r\n\r\n      matrix = geometry2.matrix;\r\n      geometry2 = geometry2.geometry;\r\n\r\n    }\r\n\r\n    geometry1.merge(geometry2, matrix, materialIndexOffset);\r\n\r\n  },\r\n\r\n  center: function(geometry) {\r\n\r\n    THREE.warn('THREE.GeometryUtils: .center() has been moved to Geometry. Use geometry.center() instead.');\r\n    return geometry.center();\r\n\r\n  }\r\n\r\n};\r\n\r\n// File:src/extras/ImageUtils.js\r\n\r\n/**\r\n * @author alteredq / http://alteredqualia.com/\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author Daosheng Mu / https://github.com/DaoshengMu/\r\n */\r\n\r\nTHREE.ImageUtils = {\r\n\r\n  crossOrigin: undefined,\r\n\r\n  loadTexture: function(url, mapping, onLoad, onError) {\r\n\r\n    var loader = new THREE.ImageLoader();\r\n    loader.crossOrigin = this.crossOrigin;\r\n\r\n    var texture = new THREE.Texture(undefined, mapping);\r\n\r\n    loader.load(url, function(image) {\r\n\r\n      texture.image = image;\r\n      texture.needsUpdate = true;\r\n\r\n      if (onLoad) onLoad(texture);\r\n\r\n    }, undefined, function(event) {\r\n\r\n      if (onError) onError(event);\r\n\r\n    });\r\n\r\n    texture.sourceFile = url;\r\n\r\n    return texture;\r\n\r\n  },\r\n\r\n  loadTextureCube: function(array, mapping, onLoad, onError) {\r\n\r\n    var images = [];\r\n\r\n    var loader = new THREE.ImageLoader();\r\n    loader.crossOrigin = this.crossOrigin;\r\n\r\n    var texture = new THREE.CubeTexture(images, mapping);\r\n\r\n    // no flipping needed for cube textures\r\n\r\n    texture.flipY = false;\r\n\r\n    var loaded = 0;\r\n\r\n    var loadTexture = function(i) {\r\n\r\n      loader.load(array[i], function(image) {\r\n\r\n        texture.images[i] = image;\r\n\r\n        loaded += 1;\r\n\r\n        if (loaded === 6) {\r\n\r\n          texture.needsUpdate = true;\r\n\r\n          if (onLoad) onLoad(texture);\r\n\r\n        }\r\n\r\n      }, undefined, onError);\r\n\r\n    }\r\n\r\n    for (var i = 0, il = array.length; i < il; ++i) {\r\n\r\n      loadTexture(i);\r\n\r\n    }\r\n\r\n    return texture;\r\n\r\n  },\r\n\r\n  loadCompressedTexture: function() {\r\n\r\n    THREE.error('THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.')\r\n\r\n  },\r\n\r\n  loadCompressedTextureCube: function() {\r\n\r\n    THREE.error('THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.')\r\n\r\n  },\r\n\r\n  getNormalMap: function(image, depth) {\r\n\r\n    // Adapted from http://www.paulbrunt.co.uk/lab/heightnormal/\r\n\r\n    var cross = function(a, b) {\r\n\r\n      return [a[1] * b[2] - a[2] * b[1], a[2] * b[0] - a[0] * b[2], a[0] * b[1] - a[1] * b[0]];\r\n\r\n    }\r\n\r\n    var subtract = function(a, b) {\r\n\r\n      return [a[0] - b[0], a[1] - b[1], a[2] - b[2]];\r\n\r\n    }\r\n\r\n    var normalize = function(a) {\r\n\r\n      var l = Math.sqrt(a[0] * a[0] + a[1] * a[1] + a[2] * a[2]);\r\n      return [a[0] / l, a[1] / l, a[2] / l];\r\n\r\n    }\r\n\r\n    depth = depth | 1;\r\n\r\n    var width = image.width;\r\n    var height = image.height;\r\n\r\n    var canvas = document.createElement('canvas');\r\n    canvas.width = width;\r\n    canvas.height = height;\r\n\r\n    var context = canvas.getContext('2d');\r\n    context.drawImage(image, 0, 0);\r\n\r\n    var data = context.getImageData(0, 0, width, height).data;\r\n    var imageData = context.createImageData(width, height);\r\n    var output = imageData.data;\r\n\r\n    for (var x = 0; x < width; x++) {\r\n\r\n      for (var y = 0; y < height; y++) {\r\n\r\n        var ly = y - 1 < 0 ? 0 : y - 1;\r\n        var uy = y + 1 > height - 1 ? height - 1 : y + 1;\r\n        var lx = x - 1 < 0 ? 0 : x - 1;\r\n        var ux = x + 1 > width - 1 ? width - 1 : x + 1;\r\n\r\n        var points = [];\r\n        var origin = [0, 0, data[(y * width + x) * 4] / 255 * depth];\r\n        points.push([-1, 0, data[(y * width + lx) * 4] / 255 * depth]);\r\n        points.push([-1, -1, data[(ly * width + lx) * 4] / 255 * depth]);\r\n        points.push([0, -1, data[(ly * width + x) * 4] / 255 * depth]);\r\n        points.push([1, -1, data[(ly * width + ux) * 4] / 255 * depth]);\r\n        points.push([1, 0, data[(y * width + ux) * 4] / 255 * depth]);\r\n        points.push([1, 1, data[(uy * width + ux) * 4] / 255 * depth]);\r\n        points.push([0, 1, data[(uy * width + x) * 4] / 255 * depth]);\r\n        points.push([-1, 1, data[(uy * width + lx) * 4] / 255 * depth]);\r\n\r\n        var normals = [];\r\n        var num_points = points.length;\r\n\r\n        for (var i = 0; i < num_points; i++) {\r\n\r\n          var v1 = points[i];\r\n          var v2 = points[(i + 1) % num_points];\r\n          v1 = subtract(v1, origin);\r\n          v2 = subtract(v2, origin);\r\n          normals.push(normalize(cross(v1, v2)));\r\n\r\n        }\r\n\r\n        var normal = [0, 0, 0];\r\n\r\n        for (var i = 0; i < normals.length; i++) {\r\n\r\n          normal[0] += normals[i][0];\r\n          normal[1] += normals[i][1];\r\n          normal[2] += normals[i][2];\r\n\r\n        }\r\n\r\n        normal[0] /= normals.length;\r\n        normal[1] /= normals.length;\r\n        normal[2] /= normals.length;\r\n\r\n        var idx = (y * width + x) * 4;\r\n\r\n        output[idx] = ((normal[0] + 1.0) / 2.0 * 255) | 0;\r\n        output[idx + 1] = ((normal[1] + 1.0) / 2.0 * 255) | 0;\r\n        output[idx + 2] = (normal[2] * 255) | 0;\r\n        output[idx + 3] = 255;\r\n\r\n      }\r\n\r\n    }\r\n\r\n    context.putImageData(imageData, 0, 0);\r\n\r\n    return canvas;\r\n\r\n  },\r\n\r\n  generateDataTexture: function(width, height, color) {\r\n\r\n    var size = width * height;\r\n    var data = new Uint8Array(3 * size);\r\n\r\n    var r = Math.floor(color.r * 255);\r\n    var g = Math.floor(color.g * 255);\r\n    var b = Math.floor(color.b * 255);\r\n\r\n    for (var i = 0; i < size; i++) {\r\n\r\n      data[i * 3] = r;\r\n      data[i * 3 + 1] = g;\r\n      data[i * 3 + 2] = b;\r\n\r\n    }\r\n\r\n    var texture = new THREE.DataTexture(data, width, height, THREE.RGBFormat);\r\n    texture.needsUpdate = true;\r\n\r\n    return texture;\r\n\r\n  }\r\n\r\n};\r\n\r\n// File:src/extras/SceneUtils.js\r\n\r\n/**\r\n * @author alteredq / http://alteredqualia.com/\r\n */\r\n\r\nTHREE.SceneUtils = {\r\n\r\n  createMultiMaterialObject: function(geometry, materials) {\r\n\r\n    var group = new THREE.Object3D();\r\n\r\n    for (var i = 0, l = materials.length; i < l; i++) {\r\n\r\n      group.add(new THREE.Mesh(geometry, materials[i]));\r\n\r\n    }\r\n\r\n    return group;\r\n\r\n  },\r\n\r\n  detach: function(child, parent, scene) {\r\n\r\n    child.applyMatrix(parent.matrixWorld);\r\n    parent.remove(child);\r\n    scene.add(child);\r\n\r\n  },\r\n\r\n  attach: function(child, scene, parent) {\r\n\r\n    var matrixWorldInverse = new THREE.Matrix4();\r\n    matrixWorldInverse.getInverse(parent.matrixWorld);\r\n    child.applyMatrix(matrixWorldInverse);\r\n\r\n    scene.remove(child);\r\n    parent.add(child);\r\n\r\n  }\r\n\r\n};\r\n\r\n// File:src/extras/FontUtils.js\r\n\r\n/**\r\n * @author zz85 / http://www.lab4games.net/zz85/blog\r\n * @author alteredq / http://alteredqualia.com/\r\n *\r\n * For Text operations in three.js (See TextGeometry)\r\n *\r\n * It uses techniques used in:\r\n *\r\n * \ttypeface.js and canvastext\r\n * \t\tFor converting fonts and rendering with javascript\r\n *\t\thttp://typeface.neocracy.org\r\n *\r\n *\tTriangulation ported from AS3\r\n *\t\tSimple Polygon Triangulation\r\n *\t\thttp://actionsnippet.com/?p=1462\r\n *\r\n * \tA Method to triangulate shapes with holes\r\n *\t\thttp://www.sakri.net/blog/2009/06/12/an-approach-to-triangulating-polygons-with-holes/\r\n *\r\n */\r\n\r\nTHREE.FontUtils = {\r\n\r\n  faces: {},\r\n\r\n  // Just for now. face[weight][style]\r\n\r\n  face: 'helvetiker',\r\n  weight: 'normal',\r\n  style: 'normal',\r\n  size: 150,\r\n  divisions: 10,\r\n\r\n  getFace: function() {\r\n\r\n    try {\r\n\r\n      return this.faces[this.face][this.weight][this.style];\r\n\r\n    }\r\n    catch (e) {\r\n\r\n      throw \"The font \" + this.face + \" with \" + this.weight + \" weight and \" + this.style + \" style is missing.\"\r\n\r\n    };\r\n\r\n  },\r\n\r\n  loadFace: function(data) {\r\n\r\n    var family = data.familyName.toLowerCase();\r\n\r\n    var ThreeFont = this;\r\n\r\n    ThreeFont.faces[family] = ThreeFont.faces[family] || {};\r\n\r\n    ThreeFont.faces[family][data.cssFontWeight] = ThreeFont.faces[family][data.cssFontWeight] || {};\r\n    ThreeFont.faces[family][data.cssFontWeight][data.cssFontStyle] = data;\r\n\r\n    ThreeFont.faces[family][data.cssFontWeight][data.cssFontStyle] = data;\r\n\r\n    return data;\r\n\r\n  },\r\n\r\n  drawText: function(text) {\r\n\r\n    // RenderText\r\n\r\n    var i,\r\n      face = this.getFace(),\r\n      scale = this.size / face.resolution,\r\n      offset = 0,\r\n      chars = String(text).split(''),\r\n      length = chars.length;\r\n\r\n    var fontPaths = [];\r\n\r\n    for (i = 0; i < length; i++) {\r\n\r\n      var path = new THREE.Path();\r\n\r\n      var ret = this.extractGlyphPoints(chars[i], face, scale, offset, path);\r\n      offset += ret.offset;\r\n\r\n      fontPaths.push(ret.path);\r\n\r\n    }\r\n\r\n    // get the width\r\n\r\n    var width = offset / 2;\r\n    //\r\n    // for ( p = 0; p < allPts.length; p++ ) {\r\n    //\r\n    // \tallPts[ p ].x -= width;\r\n    //\r\n    // }\r\n\r\n    //var extract = this.extractPoints( allPts, characterPts );\r\n    //extract.contour = allPts;\r\n\r\n    //extract.paths = fontPaths;\r\n    //extract.offset = width;\r\n\r\n    return {\r\n      paths: fontPaths,\r\n      offset: width\r\n    };\r\n\r\n  },\r\n\r\n\r\n\r\n\r\n  extractGlyphPoints: function(c, face, scale, offset, path) {\r\n\r\n    var pts = [];\r\n\r\n    var i, i2, divisions,\r\n      outline, action, length,\r\n      scaleX, scaleY,\r\n      x, y, cpx, cpy, cpx0, cpy0, cpx1, cpy1, cpx2, cpy2,\r\n      laste,\r\n      glyph = face.glyphs[c] || face.glyphs['?'];\r\n\r\n    if (!glyph) return;\r\n\r\n    if (glyph.o) {\r\n\r\n      outline = glyph._cachedOutline || (glyph._cachedOutline = glyph.o.split(' '));\r\n      length = outline.length;\r\n\r\n      scaleX = scale;\r\n      scaleY = scale;\r\n\r\n      for (i = 0; i < length;) {\r\n\r\n        action = outline[i++];\r\n\r\n        //console.log( action );\r\n\r\n        switch (action) {\r\n\r\n          case 'm':\r\n\r\n            // Move To\r\n\r\n            x = outline[i++] * scaleX + offset;\r\n            y = outline[i++] * scaleY;\r\n\r\n            path.moveTo(x, y);\r\n            break;\r\n\r\n          case 'l':\r\n\r\n            // Line To\r\n\r\n            x = outline[i++] * scaleX + offset;\r\n            y = outline[i++] * scaleY;\r\n            path.lineTo(x, y);\r\n            break;\r\n\r\n          case 'q':\r\n\r\n            // QuadraticCurveTo\r\n\r\n            cpx = outline[i++] * scaleX + offset;\r\n            cpy = outline[i++] * scaleY;\r\n            cpx1 = outline[i++] * scaleX + offset;\r\n            cpy1 = outline[i++] * scaleY;\r\n\r\n            path.quadraticCurveTo(cpx1, cpy1, cpx, cpy);\r\n\r\n            laste = pts[pts.length - 1];\r\n\r\n            if (laste) {\r\n\r\n              cpx0 = laste.x;\r\n              cpy0 = laste.y;\r\n\r\n              for (i2 = 1, divisions = this.divisions; i2 <= divisions; i2++) {\r\n\r\n                var t = i2 / divisions;\r\n                THREE.Shape.Utils.b2(t, cpx0, cpx1, cpx);\r\n                THREE.Shape.Utils.b2(t, cpy0, cpy1, cpy);\r\n              }\r\n\r\n            }\r\n\r\n            break;\r\n\r\n          case 'b':\r\n\r\n            // Cubic Bezier Curve\r\n\r\n            cpx = outline[i++] * scaleX + offset;\r\n            cpy = outline[i++] * scaleY;\r\n            cpx1 = outline[i++] * scaleX + offset;\r\n            cpy1 = outline[i++] * scaleY;\r\n            cpx2 = outline[i++] * scaleX + offset;\r\n            cpy2 = outline[i++] * scaleY;\r\n\r\n            path.bezierCurveTo(cpx1, cpy1, cpx2, cpy2, cpx, cpy);\r\n\r\n            laste = pts[pts.length - 1];\r\n\r\n            if (laste) {\r\n\r\n              cpx0 = laste.x;\r\n              cpy0 = laste.y;\r\n\r\n              for (i2 = 1, divisions = this.divisions; i2 <= divisions; i2++) {\r\n\r\n                var t = i2 / divisions;\r\n                THREE.Shape.Utils.b3(t, cpx0, cpx1, cpx2, cpx);\r\n                THREE.Shape.Utils.b3(t, cpy0, cpy1, cpy2, cpy);\r\n\r\n              }\r\n\r\n            }\r\n\r\n            break;\r\n\r\n        }\r\n\r\n      }\r\n    }\r\n\r\n\r\n\r\n    return {\r\n      offset: glyph.ha * scale,\r\n      path: path\r\n    };\r\n  }\r\n\r\n};\r\n\r\n\r\nTHREE.FontUtils.generateShapes = function(text, parameters) {\r\n\r\n  // Parameters \r\n\r\n  parameters = parameters || {};\r\n\r\n  var size = parameters.size !== undefined ? parameters.size : 100;\r\n  var curveSegments = parameters.curveSegments !== undefined ? parameters.curveSegments : 4;\r\n\r\n  var font = parameters.font !== undefined ? parameters.font : 'helvetiker';\r\n  var weight = parameters.weight !== undefined ? parameters.weight : 'normal';\r\n  var style = parameters.style !== undefined ? parameters.style : 'normal';\r\n\r\n  THREE.FontUtils.size = size;\r\n  THREE.FontUtils.divisions = curveSegments;\r\n\r\n  THREE.FontUtils.face = font;\r\n  THREE.FontUtils.weight = weight;\r\n  THREE.FontUtils.style = style;\r\n\r\n  // Get a Font data json object\r\n\r\n  var data = THREE.FontUtils.drawText(text);\r\n\r\n  var paths = data.paths;\r\n  var shapes = [];\r\n\r\n  for (var p = 0, pl = paths.length; p < pl; p++) {\r\n\r\n    Array.prototype.push.apply(shapes, paths[p].toShapes());\r\n\r\n  }\r\n\r\n  return shapes;\r\n\r\n};\r\n\r\n\r\n/**\r\n * This code is a quick port of code written in C++ which was submitted to\r\n * flipcode.com by John W. Ratcliff  // July 22, 2000\r\n * See original code and more information here:\r\n * http://www.flipcode.com/archives/Efficient_Polygon_Triangulation.shtml\r\n *\r\n * ported to actionscript by Zevan Rosser\r\n * www.actionsnippet.com\r\n *\r\n * ported to javascript by Joshua Koo\r\n * http://www.lab4games.net/zz85/blog\r\n *\r\n */\r\n\r\n\r\n(function(namespace) {\r\n\r\n  var EPSILON = 0.0000000001;\r\n\r\n  // takes in an contour array and returns\r\n\r\n  var process = function(contour, indices) {\r\n\r\n    var n = contour.length;\r\n\r\n    if (n < 3) return null;\r\n\r\n    var result = [],\r\n      verts = [],\r\n      vertIndices = [];\r\n\r\n    /* we want a counter-clockwise polygon in verts */\r\n\r\n    var u, v, w;\r\n\r\n    if (area(contour) > 0.0) {\r\n\r\n      for (v = 0; v < n; v++) verts[v] = v;\r\n\r\n    }\r\n    else {\r\n\r\n      for (v = 0; v < n; v++) verts[v] = (n - 1) - v;\r\n\r\n    }\r\n\r\n    var nv = n;\r\n\r\n    /*  remove nv - 2 vertices, creating 1 triangle every time */\r\n\r\n    var count = 2 * nv; /* error detection */\r\n\r\n    for (v = nv - 1; nv > 2;) {\r\n\r\n      /* if we loop, it is probably a non-simple polygon */\r\n\r\n      if ((count--) <= 0) {\r\n\r\n        //** Triangulate: ERROR - probable bad polygon!\r\n\r\n        //throw ( \"Warning, unable to triangulate polygon!\" );\r\n        //return null;\r\n        // Sometimes warning is fine, especially polygons are triangulated in reverse.\r\n        THREE.warn('THREE.FontUtils: Warning, unable to triangulate polygon! in Triangulate.process()');\r\n\r\n        if (indices) return vertIndices;\r\n        return result;\r\n\r\n      }\r\n\r\n      /* three consecutive vertices in current polygon, <u,v,w> */\r\n\r\n      u = v;\r\n      if (nv <= u) u = 0; /* previous */\r\n      v = u + 1;\r\n      if (nv <= v) v = 0; /* new v    */\r\n      w = v + 1;\r\n      if (nv <= w) w = 0; /* next     */\r\n\r\n      if (snip(contour, u, v, w, nv, verts)) {\r\n\r\n        var a, b, c, s, t;\r\n\r\n        /* true names of the vertices */\r\n\r\n        a = verts[u];\r\n        b = verts[v];\r\n        c = verts[w];\r\n\r\n        /* output Triangle */\r\n\r\n        result.push([contour[a],\r\n          contour[b],\r\n          contour[c]\r\n        ]);\r\n\r\n\r\n        vertIndices.push([verts[u], verts[v], verts[w]]);\r\n\r\n        /* remove v from the remaining polygon */\r\n\r\n        for (s = v, t = v + 1; t < nv; s++, t++) {\r\n\r\n          verts[s] = verts[t];\r\n\r\n        }\r\n\r\n        nv--;\r\n\r\n        /* reset error detection counter */\r\n\r\n        count = 2 * nv;\r\n\r\n      }\r\n\r\n    }\r\n\r\n    if (indices) return vertIndices;\r\n    return result;\r\n\r\n  };\r\n\r\n  // calculate area of the contour polygon\r\n\r\n  var area = function(contour) {\r\n\r\n    var n = contour.length;\r\n    var a = 0.0;\r\n\r\n    for (var p = n - 1, q = 0; q < n; p = q++) {\r\n\r\n      a += contour[p].x * contour[q].y - contour[q].x * contour[p].y;\r\n\r\n    }\r\n\r\n    return a * 0.5;\r\n\r\n  };\r\n\r\n  var snip = function(contour, u, v, w, n, verts) {\r\n\r\n    var p;\r\n    var ax, ay, bx, by;\r\n    var cx, cy, px, py;\r\n\r\n    ax = contour[verts[u]].x;\r\n    ay = contour[verts[u]].y;\r\n\r\n    bx = contour[verts[v]].x;\r\n    by = contour[verts[v]].y;\r\n\r\n    cx = contour[verts[w]].x;\r\n    cy = contour[verts[w]].y;\r\n\r\n    if (EPSILON > (((bx - ax) * (cy - ay)) - ((by - ay) * (cx - ax)))) return false;\r\n\r\n    var aX, aY, bX, bY, cX, cY;\r\n    var apx, apy, bpx, bpy, cpx, cpy;\r\n    var cCROSSap, bCROSScp, aCROSSbp;\r\n\r\n    aX = cx - bx;\r\n    aY = cy - by;\r\n    bX = ax - cx;\r\n    bY = ay - cy;\r\n    cX = bx - ax;\r\n    cY = by - ay;\r\n\r\n    for (p = 0; p < n; p++) {\r\n\r\n      px = contour[verts[p]].x\r\n      py = contour[verts[p]].y\r\n\r\n      if (((px === ax) && (py === ay)) ||\r\n        ((px === bx) && (py === by)) ||\r\n        ((px === cx) && (py === cy))) continue;\r\n\r\n      apx = px - ax;\r\n      apy = py - ay;\r\n      bpx = px - bx;\r\n      bpy = py - by;\r\n      cpx = px - cx;\r\n      cpy = py - cy;\r\n\r\n      // see if p is inside triangle abc\r\n\r\n      aCROSSbp = aX * bpy - aY * bpx;\r\n      cCROSSap = cX * apy - cY * apx;\r\n      bCROSScp = bX * cpy - bY * cpx;\r\n\r\n      if ((aCROSSbp >= -EPSILON) && (bCROSScp >= -EPSILON) && (cCROSSap >= -EPSILON)) return false;\r\n\r\n    }\r\n\r\n    return true;\r\n\r\n  };\r\n\r\n\r\n  namespace.Triangulate = process;\r\n  namespace.Triangulate.area = area;\r\n\r\n  return namespace;\r\n\r\n})(THREE.FontUtils);\r\n\r\n// To use the typeface.js face files, hook up the API\r\nself._typeface_js = {\r\n  faces: THREE.FontUtils.faces,\r\n  loadFace: THREE.FontUtils.loadFace\r\n};\r\nTHREE.typeface_js = self._typeface_js;\r\n\r\n// File:src/extras/audio/Audio.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.Audio = function(listener) {\r\n\r\n  THREE.Object3D.call(this);\r\n\r\n  this.type = 'Audio';\r\n\r\n  this.context = listener.context;\r\n  this.source = this.context.createBufferSource();\r\n  this.source.onended = this.onEnded.bind(this);\r\n\r\n  this.gain = this.context.createGain();\r\n  this.gain.connect(this.context.destination);\r\n\r\n  this.panner = this.context.createPanner();\r\n  this.panner.connect(this.gain);\r\n\r\n  this.autoplay = false;\r\n\r\n  this.startTime = 0;\r\n  this.isPlaying = false;\r\n\r\n};\r\n\r\nTHREE.Audio.prototype = Object.create(THREE.Object3D.prototype);\r\nTHREE.Audio.prototype.constructor = THREE.Audio;\r\n\r\nTHREE.Audio.prototype.load = function(file) {\r\n\r\n  var scope = this;\r\n\r\n  var request = new XMLHttpRequest();\r\n  request.open('GET', file, true);\r\n  request.responseType = 'arraybuffer';\r\n  request.onload = function(e) {\r\n\r\n    scope.context.decodeAudioData(this.response, function(buffer) {\r\n\r\n      scope.source.buffer = buffer;\r\n\r\n      if (scope.autoplay) scope.play();\r\n\r\n    });\r\n\r\n  };\r\n  request.send();\r\n\r\n  return this;\r\n\r\n};\r\n\r\nTHREE.Audio.prototype.play = function() {\r\n\r\n  if (this.isPlaying === true) {\r\n\r\n    THREE.warn('THREE.Audio: Audio is already playing.');\r\n    return;\r\n\r\n  }\r\n\r\n  var source = this.context.createBufferSource();\r\n\r\n  source.buffer = this.source.buffer;\r\n  source.loop = this.source.loop;\r\n  source.onended = this.source.onended;\r\n  source.connect(this.panner);\r\n  source.start(0, this.startTime);\r\n\r\n  this.isPlaying = true;\r\n\r\n  this.source = source;\r\n\r\n};\r\n\r\nTHREE.Audio.prototype.pause = function() {\r\n\r\n  this.source.stop();\r\n  this.startTime = this.context.currentTime;\r\n\r\n};\r\n\r\nTHREE.Audio.prototype.stop = function() {\r\n\r\n  this.source.stop();\r\n  this.startTime = 0;\r\n\r\n};\r\n\r\nTHREE.Audio.prototype.onEnded = function() {\r\n\r\n  this.isPlaying = false;\r\n\r\n};\r\n\r\nTHREE.Audio.prototype.setLoop = function(value) {\r\n\r\n  this.source.loop = value;\r\n\r\n};\r\n\r\nTHREE.Audio.prototype.setRefDistance = function(value) {\r\n\r\n  this.panner.refDistance = value;\r\n\r\n};\r\n\r\nTHREE.Audio.prototype.setRolloffFactor = function(value) {\r\n\r\n  this.panner.rolloffFactor = value;\r\n\r\n};\r\n\r\nTHREE.Audio.prototype.setVolume = function(value) {\r\n\r\n  this.gain.gain.value = value;\r\n\r\n};\r\n\r\nTHREE.Audio.prototype.updateMatrixWorld = (function() {\r\n\r\n  var position = new THREE.Vector3();\r\n\r\n  return function(force) {\r\n\r\n    THREE.Object3D.prototype.updateMatrixWorld.call(this, force);\r\n\r\n    position.setFromMatrixPosition(this.matrixWorld);\r\n\r\n    this.panner.setPosition(position.x, position.y, position.z);\r\n\r\n  };\r\n\r\n})();\r\n\r\n// File:src/extras/audio/AudioListener.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.AudioListener = function() {\r\n\r\n  THREE.Object3D.call(this);\r\n\r\n  this.type = 'AudioListener';\r\n\r\n  this.context = new(window.AudioContext || window.webkitAudioContext)();\r\n\r\n};\r\n\r\nTHREE.AudioListener.prototype = Object.create(THREE.Object3D.prototype);\r\nTHREE.AudioListener.prototype.constructor = THREE.AudioListener;\r\n\r\nTHREE.AudioListener.prototype.updateMatrixWorld = (function() {\r\n\r\n  var position = new THREE.Vector3();\r\n  var quaternion = new THREE.Quaternion();\r\n  var scale = new THREE.Vector3();\r\n\r\n  var orientation = new THREE.Vector3();\r\n  var velocity = new THREE.Vector3();\r\n\r\n  var positionPrev = new THREE.Vector3();\r\n\r\n  return function(force) {\r\n\r\n    THREE.Object3D.prototype.updateMatrixWorld.call(this, force);\r\n\r\n    var listener = this.context.listener;\r\n    var up = this.up;\r\n\r\n    this.matrixWorld.decompose(position, quaternion, scale);\r\n\r\n    orientation.set(0, 0, -1).applyQuaternion(quaternion);\r\n    velocity.subVectors(position, positionPrev);\r\n\r\n    listener.setPosition(position.x, position.y, position.z);\r\n    listener.setOrientation(orientation.x, orientation.y, orientation.z, up.x, up.y, up.z);\r\n    listener.setVelocity(velocity.x, velocity.y, velocity.z);\r\n\r\n    positionPrev.copy(position);\r\n\r\n  };\r\n\r\n})();\r\n\r\n// File:src/extras/core/Curve.js\r\n\r\n/**\r\n * @author zz85 / http://www.lab4games.net/zz85/blog\r\n * Extensible curve object\r\n *\r\n * Some common of Curve methods\r\n * .getPoint(t), getTangent(t)\r\n * .getPointAt(u), getTagentAt(u)\r\n * .getPoints(), .getSpacedPoints()\r\n * .getLength()\r\n * .updateArcLengths()\r\n *\r\n * This following classes subclasses THREE.Curve:\r\n *\r\n * -- 2d classes --\r\n * THREE.LineCurve\r\n * THREE.QuadraticBezierCurve\r\n * THREE.CubicBezierCurve\r\n * THREE.SplineCurve\r\n * THREE.ArcCurve\r\n * THREE.EllipseCurve\r\n *\r\n * -- 3d classes --\r\n * THREE.LineCurve3\r\n * THREE.QuadraticBezierCurve3\r\n * THREE.CubicBezierCurve3\r\n * THREE.SplineCurve3\r\n * THREE.ClosedSplineCurve3\r\n *\r\n * A series of curves can be represented as a THREE.CurvePath\r\n *\r\n **/\r\n\r\n/**************************************************************\r\n *\tAbstract Curve base class\r\n **************************************************************/\r\n\r\nTHREE.Curve = function() {\r\n\r\n};\r\n\r\n// Virtual base class method to overwrite and implement in subclasses\r\n//\t- t [0 .. 1]\r\n\r\nTHREE.Curve.prototype.getPoint = function(t) {\r\n\r\n  THREE.warn(\"THREE.Curve: Warning, getPoint() not implemented!\");\r\n  return null;\r\n\r\n};\r\n\r\n// Get point at relative position in curve according to arc length\r\n// - u [0 .. 1]\r\n\r\nTHREE.Curve.prototype.getPointAt = function(u) {\r\n\r\n  var t = this.getUtoTmapping(u);\r\n  return this.getPoint(t);\r\n\r\n};\r\n\r\n// Get sequence of points using getPoint( t )\r\n\r\nTHREE.Curve.prototype.getPoints = function(divisions) {\r\n\r\n  if (!divisions) divisions = 5;\r\n\r\n  var d, pts = [];\r\n\r\n  for (d = 0; d <= divisions; d++) {\r\n\r\n    pts.push(this.getPoint(d / divisions));\r\n\r\n  }\r\n\r\n  return pts;\r\n\r\n};\r\n\r\n// Get sequence of points using getPointAt( u )\r\n\r\nTHREE.Curve.prototype.getSpacedPoints = function(divisions) {\r\n\r\n  if (!divisions) divisions = 5;\r\n\r\n  var d, pts = [];\r\n\r\n  for (d = 0; d <= divisions; d++) {\r\n\r\n    pts.push(this.getPointAt(d / divisions));\r\n\r\n  }\r\n\r\n  return pts;\r\n\r\n};\r\n\r\n// Get total curve arc length\r\n\r\nTHREE.Curve.prototype.getLength = function() {\r\n\r\n  var lengths = this.getLengths();\r\n  return lengths[lengths.length - 1];\r\n\r\n};\r\n\r\n// Get list of cumulative segment lengths\r\n\r\nTHREE.Curve.prototype.getLengths = function(divisions) {\r\n\r\n  if (!divisions) divisions = (this.__arcLengthDivisions) ? (this.__arcLengthDivisions) : 200;\r\n\r\n  if (this.cacheArcLengths && (this.cacheArcLengths.length == divisions + 1) && !this.needsUpdate) {\r\n\r\n    //console.log( \"cached\", this.cacheArcLengths );\r\n    return this.cacheArcLengths;\r\n\r\n  }\r\n\r\n  this.needsUpdate = false;\r\n\r\n  var cache = [];\r\n  var current, last = this.getPoint(0);\r\n  var p, sum = 0;\r\n\r\n  cache.push(0);\r\n\r\n  for (p = 1; p <= divisions; p++) {\r\n\r\n    current = this.getPoint(p / divisions);\r\n    sum += current.distanceTo(last);\r\n    cache.push(sum);\r\n    last = current;\r\n\r\n  }\r\n\r\n  this.cacheArcLengths = cache;\r\n\r\n  return cache; // { sums: cache, sum:sum }; Sum is in the last element.\r\n\r\n};\r\n\r\n\r\nTHREE.Curve.prototype.updateArcLengths = function() {\r\n  this.needsUpdate = true;\r\n  this.getLengths();\r\n};\r\n\r\n// Given u ( 0 .. 1 ), get a t to find p. This gives you points which are equi distance\r\n\r\nTHREE.Curve.prototype.getUtoTmapping = function(u, distance) {\r\n\r\n  var arcLengths = this.getLengths();\r\n\r\n  var i = 0,\r\n    il = arcLengths.length;\r\n\r\n  var targetArcLength; // The targeted u distance value to get\r\n\r\n  if (distance) {\r\n\r\n    targetArcLength = distance;\r\n\r\n  }\r\n  else {\r\n\r\n    targetArcLength = u * arcLengths[il - 1];\r\n\r\n  }\r\n\r\n  //var time = Date.now();\r\n\r\n  // binary search for the index with largest value smaller than target u distance\r\n\r\n  var low = 0,\r\n    high = il - 1,\r\n    comparison;\r\n\r\n  while (low <= high) {\r\n\r\n    i = Math.floor(low + (high - low) / 2); // less likely to overflow, though probably not issue here, JS doesn't really have integers, all numbers are floats\r\n\r\n    comparison = arcLengths[i] - targetArcLength;\r\n\r\n    if (comparison < 0) {\r\n\r\n      low = i + 1;\r\n\r\n    }\r\n    else if (comparison > 0) {\r\n\r\n      high = i - 1;\r\n\r\n    }\r\n    else {\r\n\r\n      high = i;\r\n      break;\r\n\r\n      // DONE\r\n\r\n    }\r\n\r\n  }\r\n\r\n  i = high;\r\n\r\n  //console.log('b' , i, low, high, Date.now()- time);\r\n\r\n  if (arcLengths[i] == targetArcLength) {\r\n\r\n    var t = i / (il - 1);\r\n    return t;\r\n\r\n  }\r\n\r\n  // we could get finer grain at lengths, or use simple interpolatation between two points\r\n\r\n  var lengthBefore = arcLengths[i];\r\n  var lengthAfter = arcLengths[i + 1];\r\n\r\n  var segmentLength = lengthAfter - lengthBefore;\r\n\r\n  // determine where we are between the 'before' and 'after' points\r\n\r\n  var segmentFraction = (targetArcLength - lengthBefore) / segmentLength;\r\n\r\n  // add that fractional amount to t\r\n\r\n  var t = (i + segmentFraction) / (il - 1);\r\n\r\n  return t;\r\n\r\n};\r\n\r\n// Returns a unit vector tangent at t\r\n// In case any sub curve does not implement its tangent derivation,\r\n// 2 points a small delta apart will be used to find its gradient\r\n// which seems to give a reasonable approximation\r\n\r\nTHREE.Curve.prototype.getTangent = function(t) {\r\n\r\n  var delta = 0.0001;\r\n  var t1 = t - delta;\r\n  var t2 = t + delta;\r\n\r\n  // Capping in case of danger\r\n\r\n  if (t1 < 0) t1 = 0;\r\n  if (t2 > 1) t2 = 1;\r\n\r\n  var pt1 = this.getPoint(t1);\r\n  var pt2 = this.getPoint(t2);\r\n\r\n  var vec = pt2.clone().sub(pt1);\r\n  return vec.normalize();\r\n\r\n};\r\n\r\n\r\nTHREE.Curve.prototype.getTangentAt = function(u) {\r\n\r\n  var t = this.getUtoTmapping(u);\r\n  return this.getTangent(t);\r\n\r\n};\r\n\r\n\r\n\r\n\r\n\r\n/**************************************************************\r\n *\tUtils\r\n **************************************************************/\r\n\r\nTHREE.Curve.Utils = {\r\n\r\n  tangentQuadraticBezier: function(t, p0, p1, p2) {\r\n\r\n    return 2 * (1 - t) * (p1 - p0) + 2 * t * (p2 - p1);\r\n\r\n  },\r\n\r\n  // Puay Bing, thanks for helping with this derivative!\r\n\r\n  tangentCubicBezier: function(t, p0, p1, p2, p3) {\r\n\r\n    return -3 * p0 * (1 - t) * (1 - t) +\r\n      3 * p1 * (1 - t) * (1 - t) - 6 * t * p1 * (1 - t) +\r\n      6 * t * p2 * (1 - t) - 3 * t * t * p2 +\r\n      3 * t * t * p3;\r\n\r\n  },\r\n\r\n  tangentSpline: function(t, p0, p1, p2, p3) {\r\n\r\n    // To check if my formulas are correct\r\n\r\n    var h00 = 6 * t * t - 6 * t; // derived from 2t^3  3t^2 + 1\r\n    var h10 = 3 * t * t - 4 * t + 1; // t^3  2t^2 + t\r\n    var h01 = -6 * t * t + 6 * t; //  2t3 + 3t2\r\n    var h11 = 3 * t * t - 2 * t; // t3  t2\r\n\r\n    return h00 + h10 + h01 + h11;\r\n\r\n  },\r\n\r\n  // Catmull-Rom\r\n\r\n  interpolate: function(p0, p1, p2, p3, t) {\r\n\r\n    var v0 = (p2 - p0) * 0.5;\r\n    var v1 = (p3 - p1) * 0.5;\r\n    var t2 = t * t;\r\n    var t3 = t * t2;\r\n    return (2 * p1 - 2 * p2 + v0 + v1) * t3 + (-3 * p1 + 3 * p2 - 2 * v0 - v1) * t2 + v0 * t + p1;\r\n\r\n  }\r\n\r\n};\r\n\r\n\r\n// TODO: Transformation for Curves?\r\n\r\n/**************************************************************\r\n *\t3D Curves\r\n **************************************************************/\r\n\r\n// A Factory method for creating new curve subclasses\r\n\r\nTHREE.Curve.create = function(constructor, getPointFunc) {\r\n\r\n  constructor.prototype = Object.create(THREE.Curve.prototype);\r\n  constructor.prototype.constructor = constructor;\r\n  constructor.prototype.getPoint = getPointFunc;\r\n\r\n  return constructor;\r\n\r\n};\r\n\r\n// File:src/extras/core/CurvePath.js\r\n\r\n/**\r\n * @author zz85 / http://www.lab4games.net/zz85/blog\r\n *\r\n **/\r\n\r\n/**************************************************************\r\n *\tCurved Path - a curve path is simply a array of connected\r\n *  curves, but retains the api of a curve\r\n **************************************************************/\r\n\r\nTHREE.CurvePath = function() {\r\n\r\n  this.curves = [];\r\n  this.bends = [];\r\n\r\n  this.autoClose = false; // Automatically closes the path\r\n};\r\n\r\nTHREE.CurvePath.prototype = Object.create(THREE.Curve.prototype);\r\nTHREE.CurvePath.prototype.constructor = THREE.CurvePath;\r\n\r\nTHREE.CurvePath.prototype.add = function(curve) {\r\n\r\n  this.curves.push(curve);\r\n\r\n};\r\n\r\nTHREE.CurvePath.prototype.checkConnection = function() {\r\n  // TODO\r\n  // If the ending of curve is not connected to the starting\r\n  // or the next curve, then, this is not a real path\r\n};\r\n\r\nTHREE.CurvePath.prototype.closePath = function() {\r\n  // TODO Test\r\n  // and verify for vector3 (needs to implement equals)\r\n  // Add a line curve if start and end of lines are not connected\r\n  var startPoint = this.curves[0].getPoint(0);\r\n  var endPoint = this.curves[this.curves.length - 1].getPoint(1);\r\n\r\n  if (!startPoint.equals(endPoint)) {\r\n    this.curves.push(new THREE.LineCurve(endPoint, startPoint));\r\n  }\r\n\r\n};\r\n\r\n// To get accurate point with reference to\r\n// entire path distance at time t,\r\n// following has to be done:\r\n\r\n// 1. Length of each sub path have to be known\r\n// 2. Locate and identify type of curve\r\n// 3. Get t for the curve\r\n// 4. Return curve.getPointAt(t')\r\n\r\nTHREE.CurvePath.prototype.getPoint = function(t) {\r\n\r\n  var d = t * this.getLength();\r\n  var curveLengths = this.getCurveLengths();\r\n  var i = 0,\r\n    diff, curve;\r\n\r\n  // To think about boundaries points.\r\n\r\n  while (i < curveLengths.length) {\r\n\r\n    if (curveLengths[i] >= d) {\r\n\r\n      diff = curveLengths[i] - d;\r\n      curve = this.curves[i];\r\n\r\n      var u = 1 - diff / curve.getLength();\r\n\r\n      return curve.getPointAt(u);\r\n\r\n    }\r\n\r\n    i++;\r\n\r\n  }\r\n\r\n  return null;\r\n\r\n  // loop where sum != 0, sum > d , sum+1 <d\r\n\r\n};\r\n\r\n/*\r\nTHREE.CurvePath.prototype.getTangent = function( t ) {\r\n};*/\r\n\r\n\r\n// We cannot use the default THREE.Curve getPoint() with getLength() because in\r\n// THREE.Curve, getLength() depends on getPoint() but in THREE.CurvePath\r\n// getPoint() depends on getLength\r\n\r\nTHREE.CurvePath.prototype.getLength = function() {\r\n\r\n  var lens = this.getCurveLengths();\r\n  return lens[lens.length - 1];\r\n\r\n};\r\n\r\n// Compute lengths and cache them\r\n// We cannot overwrite getLengths() because UtoT mapping uses it.\r\n\r\nTHREE.CurvePath.prototype.getCurveLengths = function() {\r\n\r\n  // We use cache values if curves and cache array are same length\r\n\r\n  if (this.cacheLengths && this.cacheLengths.length == this.curves.length) {\r\n\r\n    return this.cacheLengths;\r\n\r\n  };\r\n\r\n  // Get length of subsurve\r\n  // Push sums into cached array\r\n\r\n  var lengths = [],\r\n    sums = 0;\r\n  var i, il = this.curves.length;\r\n\r\n  for (i = 0; i < il; i++) {\r\n\r\n    sums += this.curves[i].getLength();\r\n    lengths.push(sums);\r\n\r\n  }\r\n\r\n  this.cacheLengths = lengths;\r\n\r\n  return lengths;\r\n\r\n};\r\n\r\n\r\n\r\n// Returns min and max coordinates\r\n\r\nTHREE.CurvePath.prototype.getBoundingBox = function() {\r\n\r\n  var points = this.getPoints();\r\n\r\n  var maxX, maxY, maxZ;\r\n  var minX, minY, minZ;\r\n\r\n  maxX = maxY = Number.NEGATIVE_INFINITY;\r\n  minX = minY = Number.POSITIVE_INFINITY;\r\n\r\n  var p, i, il, sum;\r\n\r\n  var v3 = points[0] instanceof THREE.Vector3;\r\n\r\n  sum = v3 ? new THREE.Vector3() : new THREE.Vector2();\r\n\r\n  for (i = 0, il = points.length; i < il; i++) {\r\n\r\n    p = points[i];\r\n\r\n    if (p.x > maxX) maxX = p.x;\r\n    else if (p.x < minX) minX = p.x;\r\n\r\n    if (p.y > maxY) maxY = p.y;\r\n    else if (p.y < minY) minY = p.y;\r\n\r\n    if (v3) {\r\n\r\n      if (p.z > maxZ) maxZ = p.z;\r\n      else if (p.z < minZ) minZ = p.z;\r\n\r\n    }\r\n\r\n    sum.add(p);\r\n\r\n  }\r\n\r\n  var ret = {\r\n\r\n    minX: minX,\r\n    minY: minY,\r\n    maxX: maxX,\r\n    maxY: maxY\r\n\r\n  };\r\n\r\n  if (v3) {\r\n\r\n    ret.maxZ = maxZ;\r\n    ret.minZ = minZ;\r\n\r\n  }\r\n\r\n  return ret;\r\n\r\n};\r\n\r\n/**************************************************************\r\n *\tCreate Geometries Helpers\r\n **************************************************************/\r\n\r\n/// Generate geometry from path points (for Line or Points objects)\r\n\r\nTHREE.CurvePath.prototype.createPointsGeometry = function(divisions) {\r\n\r\n  var pts = this.getPoints(divisions, true);\r\n  return this.createGeometry(pts);\r\n\r\n};\r\n\r\n// Generate geometry from equidistance sampling along the path\r\n\r\nTHREE.CurvePath.prototype.createSpacedPointsGeometry = function(divisions) {\r\n\r\n  var pts = this.getSpacedPoints(divisions, true);\r\n  return this.createGeometry(pts);\r\n\r\n};\r\n\r\nTHREE.CurvePath.prototype.createGeometry = function(points) {\r\n\r\n  var geometry = new THREE.Geometry();\r\n\r\n  for (var i = 0; i < points.length; i++) {\r\n\r\n    geometry.vertices.push(new THREE.Vector3(points[i].x, points[i].y, points[i].z || 0));\r\n\r\n  }\r\n\r\n  return geometry;\r\n\r\n};\r\n\r\n\r\n/**************************************************************\r\n *\tBend / Wrap Helper Methods\r\n **************************************************************/\r\n\r\n// Wrap path / Bend modifiers?\r\n\r\nTHREE.CurvePath.prototype.addWrapPath = function(bendpath) {\r\n\r\n  this.bends.push(bendpath);\r\n\r\n};\r\n\r\nTHREE.CurvePath.prototype.getTransformedPoints = function(segments, bends) {\r\n\r\n  var oldPts = this.getPoints(segments); // getPoints getSpacedPoints\r\n  var i, il;\r\n\r\n  if (!bends) {\r\n\r\n    bends = this.bends;\r\n\r\n  }\r\n\r\n  for (i = 0, il = bends.length; i < il; i++) {\r\n\r\n    oldPts = this.getWrapPoints(oldPts, bends[i]);\r\n\r\n  }\r\n\r\n  return oldPts;\r\n\r\n};\r\n\r\nTHREE.CurvePath.prototype.getTransformedSpacedPoints = function(segments, bends) {\r\n\r\n  var oldPts = this.getSpacedPoints(segments);\r\n\r\n  var i, il;\r\n\r\n  if (!bends) {\r\n\r\n    bends = this.bends;\r\n\r\n  }\r\n\r\n  for (i = 0, il = bends.length; i < il; i++) {\r\n\r\n    oldPts = this.getWrapPoints(oldPts, bends[i]);\r\n\r\n  }\r\n\r\n  return oldPts;\r\n\r\n};\r\n\r\n// This returns getPoints() bend/wrapped around the contour of a path.\r\n// Read http://www.planetclegg.com/projects/WarpingTextToSplines.html\r\n\r\nTHREE.CurvePath.prototype.getWrapPoints = function(oldPts, path) {\r\n\r\n  var bounds = this.getBoundingBox();\r\n\r\n  var i, il, p, oldX, oldY, xNorm;\r\n\r\n  for (i = 0, il = oldPts.length; i < il; i++) {\r\n\r\n    p = oldPts[i];\r\n\r\n    oldX = p.x;\r\n    oldY = p.y;\r\n\r\n    xNorm = oldX / bounds.maxX;\r\n\r\n    // If using actual distance, for length > path, requires line extrusions\r\n    //xNorm = path.getUtoTmapping(xNorm, oldX); // 3 styles. 1) wrap stretched. 2) wrap stretch by arc length 3) warp by actual distance\r\n\r\n    xNorm = path.getUtoTmapping(xNorm, oldX);\r\n\r\n    // check for out of bounds?\r\n\r\n    var pathPt = path.getPoint(xNorm);\r\n    var normal = path.getTangent(xNorm);\r\n    normal.set(-normal.y, normal.x).multiplyScalar(oldY);\r\n\r\n    p.x = pathPt.x + normal.x;\r\n    p.y = pathPt.y + normal.y;\r\n\r\n  }\r\n\r\n  return oldPts;\r\n\r\n};\r\n\r\n\r\n// File:src/extras/core/Gyroscope.js\r\n\r\n/**\r\n * @author alteredq / http://alteredqualia.com/\r\n */\r\n\r\nTHREE.Gyroscope = function() {\r\n\r\n  THREE.Object3D.call(this);\r\n\r\n};\r\n\r\nTHREE.Gyroscope.prototype = Object.create(THREE.Object3D.prototype);\r\nTHREE.Gyroscope.prototype.constructor = THREE.Gyroscope;\r\n\r\nTHREE.Gyroscope.prototype.updateMatrixWorld = (function() {\r\n\r\n  var translationObject = new THREE.Vector3();\r\n  var quaternionObject = new THREE.Quaternion();\r\n  var scaleObject = new THREE.Vector3();\r\n\r\n  var translationWorld = new THREE.Vector3();\r\n  var quaternionWorld = new THREE.Quaternion();\r\n  var scaleWorld = new THREE.Vector3();\r\n\r\n  return function(force) {\r\n\r\n    this.matrixAutoUpdate && this.updateMatrix();\r\n\r\n    // update matrixWorld\r\n\r\n    if (this.matrixWorldNeedsUpdate || force) {\r\n\r\n      if (this.parent) {\r\n\r\n        this.matrixWorld.multiplyMatrices(this.parent.matrixWorld, this.matrix);\r\n\r\n        this.matrixWorld.decompose(translationWorld, quaternionWorld, scaleWorld);\r\n        this.matrix.decompose(translationObject, quaternionObject, scaleObject);\r\n\r\n        this.matrixWorld.compose(translationWorld, quaternionObject, scaleWorld);\r\n\r\n\r\n      }\r\n      else {\r\n\r\n        this.matrixWorld.copy(this.matrix);\r\n\r\n      }\r\n\r\n\r\n      this.matrixWorldNeedsUpdate = false;\r\n\r\n      force = true;\r\n\r\n    }\r\n\r\n    // update children\r\n\r\n    for (var i = 0, l = this.children.length; i < l; i++) {\r\n\r\n      this.children[i].updateMatrixWorld(force);\r\n\r\n    }\r\n\r\n  };\r\n\r\n}());\r\n\r\n// File:src/extras/core/Path.js\r\n\r\n/**\r\n * @author zz85 / http://www.lab4games.net/zz85/blog\r\n * Creates free form 2d path using series of points, lines or curves.\r\n *\r\n **/\r\n\r\nTHREE.Path = function(points) {\r\n\r\n  THREE.CurvePath.call(this);\r\n\r\n  this.actions = [];\r\n\r\n  if (points) {\r\n\r\n    this.fromPoints(points);\r\n\r\n  }\r\n\r\n};\r\n\r\nTHREE.Path.prototype = Object.create(THREE.CurvePath.prototype);\r\nTHREE.Path.prototype.constructor = THREE.Path;\r\n\r\nTHREE.PathActions = {\r\n\r\n  MOVE_TO: 'moveTo',\r\n  LINE_TO: 'lineTo',\r\n  QUADRATIC_CURVE_TO: 'quadraticCurveTo', // Bezier quadratic curve\r\n  BEZIER_CURVE_TO: 'bezierCurveTo', // Bezier cubic curve\r\n  CSPLINE_THRU: 'splineThru', // Catmull-rom spline\r\n  ARC: 'arc', // Circle\r\n  ELLIPSE: 'ellipse'\r\n};\r\n\r\n// TODO Clean up PATH API\r\n\r\n// Create path using straight lines to connect all points\r\n// - vectors: array of Vector2\r\n\r\nTHREE.Path.prototype.fromPoints = function(vectors) {\r\n\r\n  this.moveTo(vectors[0].x, vectors[0].y);\r\n\r\n  for (var v = 1, vlen = vectors.length; v < vlen; v++) {\r\n\r\n    this.lineTo(vectors[v].x, vectors[v].y);\r\n\r\n  };\r\n\r\n};\r\n\r\n// startPath() endPath()?\r\n\r\nTHREE.Path.prototype.moveTo = function(x, y) {\r\n\r\n  var args = Array.prototype.slice.call(arguments);\r\n  this.actions.push({\r\n    action: THREE.PathActions.MOVE_TO,\r\n    args: args\r\n  });\r\n\r\n};\r\n\r\nTHREE.Path.prototype.lineTo = function(x, y) {\r\n\r\n  var args = Array.prototype.slice.call(arguments);\r\n\r\n  var lastargs = this.actions[this.actions.length - 1].args;\r\n\r\n  var x0 = lastargs[lastargs.length - 2];\r\n  var y0 = lastargs[lastargs.length - 1];\r\n\r\n  var curve = new THREE.LineCurve(new THREE.Vector2(x0, y0), new THREE.Vector2(x, y));\r\n  this.curves.push(curve);\r\n\r\n  this.actions.push({\r\n    action: THREE.PathActions.LINE_TO,\r\n    args: args\r\n  });\r\n\r\n};\r\n\r\nTHREE.Path.prototype.quadraticCurveTo = function(aCPx, aCPy, aX, aY) {\r\n\r\n  var args = Array.prototype.slice.call(arguments);\r\n\r\n  var lastargs = this.actions[this.actions.length - 1].args;\r\n\r\n  var x0 = lastargs[lastargs.length - 2];\r\n  var y0 = lastargs[lastargs.length - 1];\r\n\r\n  var curve = new THREE.QuadraticBezierCurve(new THREE.Vector2(x0, y0),\r\n    new THREE.Vector2(aCPx, aCPy),\r\n    new THREE.Vector2(aX, aY));\r\n  this.curves.push(curve);\r\n\r\n  this.actions.push({\r\n    action: THREE.PathActions.QUADRATIC_CURVE_TO,\r\n    args: args\r\n  });\r\n\r\n};\r\n\r\nTHREE.Path.prototype.bezierCurveTo = function(aCP1x, aCP1y,\r\n  aCP2x, aCP2y,\r\n  aX, aY) {\r\n\r\n  var args = Array.prototype.slice.call(arguments);\r\n\r\n  var lastargs = this.actions[this.actions.length - 1].args;\r\n\r\n  var x0 = lastargs[lastargs.length - 2];\r\n  var y0 = lastargs[lastargs.length - 1];\r\n\r\n  var curve = new THREE.CubicBezierCurve(new THREE.Vector2(x0, y0),\r\n    new THREE.Vector2(aCP1x, aCP1y),\r\n    new THREE.Vector2(aCP2x, aCP2y),\r\n    new THREE.Vector2(aX, aY));\r\n  this.curves.push(curve);\r\n\r\n  this.actions.push({\r\n    action: THREE.PathActions.BEZIER_CURVE_TO,\r\n    args: args\r\n  });\r\n\r\n};\r\n\r\nTHREE.Path.prototype.splineThru = function(pts /*Array of Vector*/ ) {\r\n\r\n  var args = Array.prototype.slice.call(arguments);\r\n  var lastargs = this.actions[this.actions.length - 1].args;\r\n\r\n  var x0 = lastargs[lastargs.length - 2];\r\n  var y0 = lastargs[lastargs.length - 1];\r\n  //---\r\n  var npts = [new THREE.Vector2(x0, y0)];\r\n  Array.prototype.push.apply(npts, pts);\r\n\r\n  var curve = new THREE.SplineCurve(npts);\r\n  this.curves.push(curve);\r\n\r\n  this.actions.push({\r\n    action: THREE.PathActions.CSPLINE_THRU,\r\n    args: args\r\n  });\r\n\r\n};\r\n\r\n// FUTURE: Change the API or follow canvas API?\r\n\r\nTHREE.Path.prototype.arc = function(aX, aY, aRadius,\r\n  aStartAngle, aEndAngle, aClockwise) {\r\n\r\n  var lastargs = this.actions[this.actions.length - 1].args;\r\n  var x0 = lastargs[lastargs.length - 2];\r\n  var y0 = lastargs[lastargs.length - 1];\r\n\r\n  this.absarc(aX + x0, aY + y0, aRadius,\r\n    aStartAngle, aEndAngle, aClockwise);\r\n\r\n};\r\n\r\nTHREE.Path.prototype.absarc = function(aX, aY, aRadius,\r\n  aStartAngle, aEndAngle, aClockwise) {\r\n  this.absellipse(aX, aY, aRadius, aRadius, aStartAngle, aEndAngle, aClockwise);\r\n};\r\n\r\nTHREE.Path.prototype.ellipse = function(aX, aY, xRadius, yRadius,\r\n  aStartAngle, aEndAngle, aClockwise) {\r\n\r\n  var lastargs = this.actions[this.actions.length - 1].args;\r\n  var x0 = lastargs[lastargs.length - 2];\r\n  var y0 = lastargs[lastargs.length - 1];\r\n\r\n  this.absellipse(aX + x0, aY + y0, xRadius, yRadius,\r\n    aStartAngle, aEndAngle, aClockwise);\r\n\r\n};\r\n\r\n\r\nTHREE.Path.prototype.absellipse = function(aX, aY, xRadius, yRadius,\r\n  aStartAngle, aEndAngle, aClockwise) {\r\n\r\n  var args = Array.prototype.slice.call(arguments);\r\n  var curve = new THREE.EllipseCurve(aX, aY, xRadius, yRadius,\r\n    aStartAngle, aEndAngle, aClockwise);\r\n  this.curves.push(curve);\r\n\r\n  var lastPoint = curve.getPoint(1);\r\n  args.push(lastPoint.x);\r\n  args.push(lastPoint.y);\r\n\r\n  this.actions.push({\r\n    action: THREE.PathActions.ELLIPSE,\r\n    args: args\r\n  });\r\n\r\n};\r\n\r\nTHREE.Path.prototype.getSpacedPoints = function(divisions, closedPath) {\r\n\r\n  if (!divisions) divisions = 40;\r\n\r\n  var points = [];\r\n\r\n  for (var i = 0; i < divisions; i++) {\r\n\r\n    points.push(this.getPoint(i / divisions));\r\n\r\n    //if( !this.getPoint( i / divisions ) ) throw \"DIE\";\r\n\r\n  }\r\n\r\n  // if ( closedPath ) {\r\n  //\r\n  // \tpoints.push( points[ 0 ] );\r\n  //\r\n  // }\r\n\r\n  return points;\r\n\r\n};\r\n\r\n/* Return an array of vectors based on contour of the path */\r\n\r\nTHREE.Path.prototype.getPoints = function(divisions, closedPath) {\r\n\r\n  if (this.useSpacedPoints) {\r\n    console.log('tata');\r\n    return this.getSpacedPoints(divisions, closedPath);\r\n  }\r\n\r\n  divisions = divisions || 12;\r\n\r\n  var points = [];\r\n\r\n  var i, il, item, action, args;\r\n  var cpx, cpy, cpx2, cpy2, cpx1, cpy1, cpx0, cpy0,\r\n    laste, j,\r\n    t, tx, ty;\r\n\r\n  for (i = 0, il = this.actions.length; i < il; i++) {\r\n\r\n    item = this.actions[i];\r\n\r\n    action = item.action;\r\n    args = item.args;\r\n\r\n    switch (action) {\r\n\r\n      case THREE.PathActions.MOVE_TO:\r\n\r\n        points.push(new THREE.Vector2(args[0], args[1]));\r\n\r\n        break;\r\n\r\n      case THREE.PathActions.LINE_TO:\r\n\r\n        points.push(new THREE.Vector2(args[0], args[1]));\r\n\r\n        break;\r\n\r\n      case THREE.PathActions.QUADRATIC_CURVE_TO:\r\n\r\n        cpx = args[2];\r\n        cpy = args[3];\r\n\r\n        cpx1 = args[0];\r\n        cpy1 = args[1];\r\n\r\n        if (points.length > 0) {\r\n\r\n          laste = points[points.length - 1];\r\n\r\n          cpx0 = laste.x;\r\n          cpy0 = laste.y;\r\n\r\n        }\r\n        else {\r\n\r\n          laste = this.actions[i - 1].args;\r\n\r\n          cpx0 = laste[laste.length - 2];\r\n          cpy0 = laste[laste.length - 1];\r\n\r\n        }\r\n\r\n        for (j = 1; j <= divisions; j++) {\r\n\r\n          t = j / divisions;\r\n\r\n          tx = THREE.Shape.Utils.b2(t, cpx0, cpx1, cpx);\r\n          ty = THREE.Shape.Utils.b2(t, cpy0, cpy1, cpy);\r\n\r\n          points.push(new THREE.Vector2(tx, ty));\r\n\r\n        }\r\n\r\n        break;\r\n\r\n      case THREE.PathActions.BEZIER_CURVE_TO:\r\n\r\n        cpx = args[4];\r\n        cpy = args[5];\r\n\r\n        cpx1 = args[0];\r\n        cpy1 = args[1];\r\n\r\n        cpx2 = args[2];\r\n        cpy2 = args[3];\r\n\r\n        if (points.length > 0) {\r\n\r\n          laste = points[points.length - 1];\r\n\r\n          cpx0 = laste.x;\r\n          cpy0 = laste.y;\r\n\r\n        }\r\n        else {\r\n\r\n          laste = this.actions[i - 1].args;\r\n\r\n          cpx0 = laste[laste.length - 2];\r\n          cpy0 = laste[laste.length - 1];\r\n\r\n        }\r\n\r\n\r\n        for (j = 1; j <= divisions; j++) {\r\n\r\n          t = j / divisions;\r\n\r\n          tx = THREE.Shape.Utils.b3(t, cpx0, cpx1, cpx2, cpx);\r\n          ty = THREE.Shape.Utils.b3(t, cpy0, cpy1, cpy2, cpy);\r\n\r\n          points.push(new THREE.Vector2(tx, ty));\r\n\r\n        }\r\n\r\n        break;\r\n\r\n      case THREE.PathActions.CSPLINE_THRU:\r\n\r\n        laste = this.actions[i - 1].args;\r\n\r\n        var last = new THREE.Vector2(laste[laste.length - 2], laste[laste.length - 1]);\r\n        var spts = [last];\r\n\r\n        var n = divisions * args[0].length;\r\n\r\n        spts = spts.concat(args[0]);\r\n\r\n        var spline = new THREE.SplineCurve(spts);\r\n\r\n        for (j = 1; j <= n; j++) {\r\n\r\n          points.push(spline.getPointAt(j / n));\r\n\r\n        }\r\n\r\n        break;\r\n\r\n      case THREE.PathActions.ARC:\r\n\r\n        var aX = args[0],\r\n          aY = args[1],\r\n          aRadius = args[2],\r\n          aStartAngle = args[3],\r\n          aEndAngle = args[4],\r\n          aClockwise = !!args[5];\r\n\r\n        var deltaAngle = aEndAngle - aStartAngle;\r\n        var angle;\r\n        var tdivisions = divisions * 2;\r\n\r\n        for (j = 1; j <= tdivisions; j++) {\r\n\r\n          t = j / tdivisions;\r\n\r\n          if (!aClockwise) {\r\n\r\n            t = 1 - t;\r\n\r\n          }\r\n\r\n          angle = aStartAngle + t * deltaAngle;\r\n\r\n          tx = aX + aRadius * Math.cos(angle);\r\n          ty = aY + aRadius * Math.sin(angle);\r\n\r\n          //console.log('t', t, 'angle', angle, 'tx', tx, 'ty', ty);\r\n\r\n          points.push(new THREE.Vector2(tx, ty));\r\n\r\n        }\r\n\r\n        //console.log(points);\r\n\r\n        break;\r\n\r\n      case THREE.PathActions.ELLIPSE:\r\n\r\n        var aX = args[0],\r\n          aY = args[1],\r\n          xRadius = args[2],\r\n          yRadius = args[3],\r\n          aStartAngle = args[4],\r\n          aEndAngle = args[5],\r\n          aClockwise = !!args[6];\r\n\r\n\r\n        var deltaAngle = aEndAngle - aStartAngle;\r\n        var angle;\r\n        var tdivisions = divisions * 2;\r\n\r\n        for (j = 1; j <= tdivisions; j++) {\r\n\r\n          t = j / tdivisions;\r\n\r\n          if (!aClockwise) {\r\n\r\n            t = 1 - t;\r\n\r\n          }\r\n\r\n          angle = aStartAngle + t * deltaAngle;\r\n\r\n          tx = aX + xRadius * Math.cos(angle);\r\n          ty = aY + yRadius * Math.sin(angle);\r\n\r\n          //console.log('t', t, 'angle', angle, 'tx', tx, 'ty', ty);\r\n\r\n          points.push(new THREE.Vector2(tx, ty));\r\n\r\n        }\r\n\r\n        //console.log(points);\r\n\r\n        break;\r\n\r\n    } // end switch\r\n\r\n  }\r\n\r\n\r\n\r\n  // Normalize to remove the closing point by default.\r\n  var lastPoint = points[points.length - 1];\r\n  var EPSILON = 0.0000000001;\r\n  if (Math.abs(lastPoint.x - points[0].x) < EPSILON &&\r\n    Math.abs(lastPoint.y - points[0].y) < EPSILON)\r\n    points.splice(points.length - 1, 1);\r\n  if (closedPath) {\r\n\r\n    points.push(points[0]);\r\n\r\n  }\r\n\r\n  return points;\r\n\r\n};\r\n\r\n//\r\n// Breaks path into shapes\r\n//\r\n//\tAssumptions (if parameter isCCW==true the opposite holds):\r\n//\t- solid shapes are defined clockwise (CW)\r\n//\t- holes are defined counterclockwise (CCW)\r\n//\r\n//\tIf parameter noHoles==true:\r\n//  - all subPaths are regarded as solid shapes\r\n//  - definition order CW/CCW has no relevance\r\n//\r\n\r\nTHREE.Path.prototype.toShapes = function(isCCW, noHoles) {\r\n\r\n  function extractSubpaths(inActions) {\r\n\r\n    var i, il, item, action, args;\r\n\r\n    var subPaths = [],\r\n      lastPath = new THREE.Path();\r\n\r\n    for (i = 0, il = inActions.length; i < il; i++) {\r\n\r\n      item = inActions[i];\r\n\r\n      args = item.args;\r\n      action = item.action;\r\n\r\n      if (action == THREE.PathActions.MOVE_TO) {\r\n\r\n        if (lastPath.actions.length != 0) {\r\n\r\n          subPaths.push(lastPath);\r\n          lastPath = new THREE.Path();\r\n\r\n        }\r\n\r\n      }\r\n\r\n      lastPath[action].apply(lastPath, args);\r\n\r\n    }\r\n\r\n    if (lastPath.actions.length != 0) {\r\n\r\n      subPaths.push(lastPath);\r\n\r\n    }\r\n\r\n    // console.log(subPaths);\r\n\r\n    return subPaths;\r\n  }\r\n\r\n  function toShapesNoHoles(inSubpaths) {\r\n\r\n    var shapes = [];\r\n\r\n    for (var i = 0, il = inSubpaths.length; i < il; i++) {\r\n\r\n      var tmpPath = inSubpaths[i];\r\n\r\n      var tmpShape = new THREE.Shape();\r\n      tmpShape.actions = tmpPath.actions;\r\n      tmpShape.curves = tmpPath.curves;\r\n\r\n      shapes.push(tmpShape);\r\n    }\r\n\r\n    //console.log(\"shape\", shapes);\r\n\r\n    return shapes;\r\n  };\r\n\r\n  function isPointInsidePolygon(inPt, inPolygon) {\r\n    var EPSILON = 0.0000000001;\r\n\r\n    var polyLen = inPolygon.length;\r\n\r\n    // inPt on polygon contour => immediate success    or\r\n    // toggling of inside/outside at every single! intersection point of an edge\r\n    //  with the horizontal line through inPt, left of inPt\r\n    //  not counting lowerY endpoints of edges and whole edges on that line\r\n    var inside = false;\r\n    for (var p = polyLen - 1, q = 0; q < polyLen; p = q++) {\r\n      var edgeLowPt = inPolygon[p];\r\n      var edgeHighPt = inPolygon[q];\r\n\r\n      var edgeDx = edgeHighPt.x - edgeLowPt.x;\r\n      var edgeDy = edgeHighPt.y - edgeLowPt.y;\r\n\r\n      if (Math.abs(edgeDy) > EPSILON) { // not parallel\r\n        if (edgeDy < 0) {\r\n          edgeLowPt = inPolygon[q];\r\n          edgeDx = -edgeDx;\r\n          edgeHighPt = inPolygon[p];\r\n          edgeDy = -edgeDy;\r\n        }\r\n        if ((inPt.y < edgeLowPt.y) || (inPt.y > edgeHighPt.y)) continue;\r\n\r\n        if (inPt.y == edgeLowPt.y) {\r\n          if (inPt.x == edgeLowPt.x) return true; // inPt is on contour ?\r\n          // continue;\t\t\t\t// no intersection or edgeLowPt => doesn't count !!!\r\n        }\r\n        else {\r\n          var perpEdge = edgeDy * (inPt.x - edgeLowPt.x) - edgeDx * (inPt.y - edgeLowPt.y);\r\n          if (perpEdge == 0) return true; // inPt is on contour ?\r\n          if (perpEdge < 0) continue;\r\n          inside = !inside; // true intersection left of inPt\r\n        }\r\n      }\r\n      else { // parallel or colinear\r\n        if (inPt.y != edgeLowPt.y) continue; // parallel\r\n        // egde lies on the same horizontal line as inPt\r\n        if (((edgeHighPt.x <= inPt.x) && (inPt.x <= edgeLowPt.x)) ||\r\n          ((edgeLowPt.x <= inPt.x) && (inPt.x <= edgeHighPt.x))) return true; // inPt: Point on contour !\r\n        // continue;\r\n      }\r\n    }\r\n\r\n    return inside;\r\n  }\r\n\r\n\r\n  var subPaths = extractSubpaths(this.actions);\r\n  if (subPaths.length == 0) return [];\r\n\r\n  if (noHoles === true) return toShapesNoHoles(subPaths);\r\n\r\n\r\n  var solid, tmpPath, tmpShape, shapes = [];\r\n\r\n  if (subPaths.length == 1) {\r\n\r\n    tmpPath = subPaths[0];\r\n    tmpShape = new THREE.Shape();\r\n    tmpShape.actions = tmpPath.actions;\r\n    tmpShape.curves = tmpPath.curves;\r\n    shapes.push(tmpShape);\r\n    return shapes;\r\n\r\n  }\r\n\r\n  var holesFirst = !THREE.Shape.Utils.isClockWise(subPaths[0].getPoints());\r\n  holesFirst = isCCW ? !holesFirst : holesFirst;\r\n\r\n  // console.log(\"Holes first\", holesFirst);\r\n\r\n  var betterShapeHoles = [];\r\n  var newShapes = [];\r\n  var newShapeHoles = [];\r\n  var mainIdx = 0;\r\n  var tmpPoints;\r\n\r\n  newShapes[mainIdx] = undefined;\r\n  newShapeHoles[mainIdx] = [];\r\n\r\n  var i, il;\r\n\r\n  for (i = 0, il = subPaths.length; i < il; i++) {\r\n\r\n    tmpPath = subPaths[i];\r\n    tmpPoints = tmpPath.getPoints();\r\n    solid = THREE.Shape.Utils.isClockWise(tmpPoints);\r\n    solid = isCCW ? !solid : solid;\r\n\r\n    if (solid) {\r\n\r\n      if ((!holesFirst) && (newShapes[mainIdx])) mainIdx++;\r\n\r\n      newShapes[mainIdx] = {\r\n        s: new THREE.Shape(),\r\n        p: tmpPoints\r\n      };\r\n      newShapes[mainIdx].s.actions = tmpPath.actions;\r\n      newShapes[mainIdx].s.curves = tmpPath.curves;\r\n\r\n      if (holesFirst) mainIdx++;\r\n      newShapeHoles[mainIdx] = [];\r\n\r\n      //console.log('cw', i);\r\n\r\n    }\r\n    else {\r\n\r\n      newShapeHoles[mainIdx].push({\r\n        h: tmpPath,\r\n        p: tmpPoints[0]\r\n      });\r\n\r\n      //console.log('ccw', i);\r\n\r\n    }\r\n\r\n  }\r\n\r\n  // only Holes? -> probably all Shapes with wrong orientation\r\n  if (!newShapes[0]) return toShapesNoHoles(subPaths);\r\n\r\n\r\n  if (newShapes.length > 1) {\r\n    var ambigious = false;\r\n    var toChange = [];\r\n\r\n    for (var sIdx = 0, sLen = newShapes.length; sIdx < sLen; sIdx++) {\r\n      betterShapeHoles[sIdx] = [];\r\n    }\r\n    for (var sIdx = 0, sLen = newShapes.length; sIdx < sLen; sIdx++) {\r\n      var sho = newShapeHoles[sIdx];\r\n      for (var hIdx = 0; hIdx < sho.length; hIdx++) {\r\n        var ho = sho[hIdx];\r\n        var hole_unassigned = true;\r\n        for (var s2Idx = 0; s2Idx < newShapes.length; s2Idx++) {\r\n          if (isPointInsidePolygon(ho.p, newShapes[s2Idx].p)) {\r\n            if (sIdx != s2Idx) toChange.push({\r\n              froms: sIdx,\r\n              tos: s2Idx,\r\n              hole: hIdx\r\n            });\r\n            if (hole_unassigned) {\r\n              hole_unassigned = false;\r\n              betterShapeHoles[s2Idx].push(ho);\r\n            }\r\n            else {\r\n              ambigious = true;\r\n            }\r\n          }\r\n        }\r\n        if (hole_unassigned) {\r\n          betterShapeHoles[sIdx].push(ho);\r\n        }\r\n      }\r\n    }\r\n    // console.log(\"ambigious: \", ambigious);\r\n    if (toChange.length > 0) {\r\n      // console.log(\"to change: \", toChange);\r\n      if (!ambigious) newShapeHoles = betterShapeHoles;\r\n    }\r\n  }\r\n\r\n  var tmpHoles, j, jl;\r\n  for (i = 0, il = newShapes.length; i < il; i++) {\r\n    tmpShape = newShapes[i].s;\r\n    shapes.push(tmpShape);\r\n    tmpHoles = newShapeHoles[i];\r\n    for (j = 0, jl = tmpHoles.length; j < jl; j++) {\r\n      tmpShape.holes.push(tmpHoles[j].h);\r\n    }\r\n  }\r\n\r\n  //console.log(\"shape\", shapes);\r\n\r\n  return shapes;\r\n\r\n};\r\n\r\n// File:src/extras/core/Shape.js\r\n\r\n/**\r\n * @author zz85 / http://www.lab4games.net/zz85/blog\r\n * Defines a 2d shape plane using paths.\r\n **/\r\n\r\n// STEP 1 Create a path.\r\n// STEP 2 Turn path into shape.\r\n// STEP 3 ExtrudeGeometry takes in Shape/Shapes\r\n// STEP 3a - Extract points from each shape, turn to vertices\r\n// STEP 3b - Triangulate each shape, add faces.\r\n\r\nTHREE.Shape = function() {\r\n\r\n  THREE.Path.apply(this, arguments);\r\n  this.holes = [];\r\n\r\n};\r\n\r\nTHREE.Shape.prototype = Object.create(THREE.Path.prototype);\r\nTHREE.Shape.prototype.constructor = THREE.Shape;\r\n\r\n// Convenience method to return ExtrudeGeometry\r\n\r\nTHREE.Shape.prototype.extrude = function(options) {\r\n\r\n  var extruded = new THREE.ExtrudeGeometry(this, options);\r\n  return extruded;\r\n\r\n};\r\n\r\n// Convenience method to return ShapeGeometry\r\n\r\nTHREE.Shape.prototype.makeGeometry = function(options) {\r\n\r\n  var geometry = new THREE.ShapeGeometry(this, options);\r\n  return geometry;\r\n\r\n};\r\n\r\n// Get points of holes\r\n\r\nTHREE.Shape.prototype.getPointsHoles = function(divisions) {\r\n\r\n  var i, il = this.holes.length,\r\n    holesPts = [];\r\n\r\n  for (i = 0; i < il; i++) {\r\n\r\n    holesPts[i] = this.holes[i].getTransformedPoints(divisions, this.bends);\r\n\r\n  }\r\n\r\n  return holesPts;\r\n\r\n};\r\n\r\n// Get points of holes (spaced by regular distance)\r\n\r\nTHREE.Shape.prototype.getSpacedPointsHoles = function(divisions) {\r\n\r\n  var i, il = this.holes.length,\r\n    holesPts = [];\r\n\r\n  for (i = 0; i < il; i++) {\r\n\r\n    holesPts[i] = this.holes[i].getTransformedSpacedPoints(divisions, this.bends);\r\n\r\n  }\r\n\r\n  return holesPts;\r\n\r\n};\r\n\r\n\r\n// Get points of shape and holes (keypoints based on segments parameter)\r\n\r\nTHREE.Shape.prototype.extractAllPoints = function(divisions) {\r\n\r\n  return {\r\n\r\n    shape: this.getTransformedPoints(divisions),\r\n    holes: this.getPointsHoles(divisions)\r\n\r\n  };\r\n\r\n};\r\n\r\nTHREE.Shape.prototype.extractPoints = function(divisions) {\r\n\r\n  if (this.useSpacedPoints) {\r\n    return this.extractAllSpacedPoints(divisions);\r\n  }\r\n\r\n  return this.extractAllPoints(divisions);\r\n\r\n};\r\n\r\n//\r\n// THREE.Shape.prototype.extractAllPointsWithBend = function ( divisions, bend ) {\r\n//\r\n// \treturn {\r\n//\r\n// \t\tshape: this.transform( bend, divisions ),\r\n// \t\tholes: this.getPointsHoles( divisions, bend )\r\n//\r\n// \t};\r\n//\r\n// };\r\n\r\n// Get points of shape and holes (spaced by regular distance)\r\n\r\nTHREE.Shape.prototype.extractAllSpacedPoints = function(divisions) {\r\n\r\n  return {\r\n\r\n    shape: this.getTransformedSpacedPoints(divisions),\r\n    holes: this.getSpacedPointsHoles(divisions)\r\n\r\n  };\r\n\r\n};\r\n\r\n/**************************************************************\r\n *\tUtils\r\n **************************************************************/\r\n\r\nTHREE.Shape.Utils = {\r\n\r\n  triangulateShape: function(contour, holes) {\r\n\r\n    function point_in_segment_2D_colin(inSegPt1, inSegPt2, inOtherPt) {\r\n      // inOtherPt needs to be colinear to the inSegment\r\n      if (inSegPt1.x != inSegPt2.x) {\r\n        if (inSegPt1.x < inSegPt2.x) {\r\n          return ((inSegPt1.x <= inOtherPt.x) && (inOtherPt.x <= inSegPt2.x));\r\n        }\r\n        else {\r\n          return ((inSegPt2.x <= inOtherPt.x) && (inOtherPt.x <= inSegPt1.x));\r\n        }\r\n      }\r\n      else {\r\n        if (inSegPt1.y < inSegPt2.y) {\r\n          return ((inSegPt1.y <= inOtherPt.y) && (inOtherPt.y <= inSegPt2.y));\r\n        }\r\n        else {\r\n          return ((inSegPt2.y <= inOtherPt.y) && (inOtherPt.y <= inSegPt1.y));\r\n        }\r\n      }\r\n    }\r\n\r\n    function intersect_segments_2D(inSeg1Pt1, inSeg1Pt2, inSeg2Pt1, inSeg2Pt2, inExcludeAdjacentSegs) {\r\n      var EPSILON = 0.0000000001;\r\n\r\n      var seg1dx = inSeg1Pt2.x - inSeg1Pt1.x,\r\n        seg1dy = inSeg1Pt2.y - inSeg1Pt1.y;\r\n      var seg2dx = inSeg2Pt2.x - inSeg2Pt1.x,\r\n        seg2dy = inSeg2Pt2.y - inSeg2Pt1.y;\r\n\r\n      var seg1seg2dx = inSeg1Pt1.x - inSeg2Pt1.x;\r\n      var seg1seg2dy = inSeg1Pt1.y - inSeg2Pt1.y;\r\n\r\n      var limit = seg1dy * seg2dx - seg1dx * seg2dy;\r\n      var perpSeg1 = seg1dy * seg1seg2dx - seg1dx * seg1seg2dy;\r\n\r\n      if (Math.abs(limit) > EPSILON) { // not parallel\r\n\r\n        var perpSeg2;\r\n        if (limit > 0) {\r\n          if ((perpSeg1 < 0) || (perpSeg1 > limit)) return [];\r\n          perpSeg2 = seg2dy * seg1seg2dx - seg2dx * seg1seg2dy;\r\n          if ((perpSeg2 < 0) || (perpSeg2 > limit)) return [];\r\n        }\r\n        else {\r\n          if ((perpSeg1 > 0) || (perpSeg1 < limit)) return [];\r\n          perpSeg2 = seg2dy * seg1seg2dx - seg2dx * seg1seg2dy;\r\n          if ((perpSeg2 > 0) || (perpSeg2 < limit)) return [];\r\n        }\r\n\r\n        // i.e. to reduce rounding errors\r\n        // intersection at endpoint of segment#1?\r\n        if (perpSeg2 == 0) {\r\n          if ((inExcludeAdjacentSegs) &&\r\n            ((perpSeg1 == 0) || (perpSeg1 == limit))) return [];\r\n          return [inSeg1Pt1];\r\n        }\r\n        if (perpSeg2 == limit) {\r\n          if ((inExcludeAdjacentSegs) &&\r\n            ((perpSeg1 == 0) || (perpSeg1 == limit))) return [];\r\n          return [inSeg1Pt2];\r\n        }\r\n        // intersection at endpoint of segment#2?\r\n        if (perpSeg1 == 0) return [inSeg2Pt1];\r\n        if (perpSeg1 == limit) return [inSeg2Pt2];\r\n\r\n        // return real intersection point\r\n        var factorSeg1 = perpSeg2 / limit;\r\n        return [{\r\n          x: inSeg1Pt1.x + factorSeg1 * seg1dx,\r\n          y: inSeg1Pt1.y + factorSeg1 * seg1dy\r\n        }];\r\n\r\n      }\r\n      else { // parallel or colinear\r\n        if ((perpSeg1 != 0) ||\r\n          (seg2dy * seg1seg2dx != seg2dx * seg1seg2dy)) return [];\r\n\r\n        // they are collinear or degenerate\r\n        var seg1Pt = ((seg1dx == 0) && (seg1dy == 0)); // segment1 ist just a point?\r\n        var seg2Pt = ((seg2dx == 0) && (seg2dy == 0)); // segment2 ist just a point?\r\n        // both segments are points\r\n        if (seg1Pt && seg2Pt) {\r\n          if ((inSeg1Pt1.x != inSeg2Pt1.x) ||\r\n            (inSeg1Pt1.y != inSeg2Pt1.y)) return []; // they are distinct  points\r\n          return [inSeg1Pt1]; // they are the same point\r\n        }\r\n        // segment#1  is a single point\r\n        if (seg1Pt) {\r\n          if (!point_in_segment_2D_colin(inSeg2Pt1, inSeg2Pt2, inSeg1Pt1)) return []; // but not in segment#2\r\n          return [inSeg1Pt1];\r\n        }\r\n        // segment#2  is a single point\r\n        if (seg2Pt) {\r\n          if (!point_in_segment_2D_colin(inSeg1Pt1, inSeg1Pt2, inSeg2Pt1)) return []; // but not in segment#1\r\n          return [inSeg2Pt1];\r\n        }\r\n\r\n        // they are collinear segments, which might overlap\r\n        var seg1min, seg1max, seg1minVal, seg1maxVal;\r\n        var seg2min, seg2max, seg2minVal, seg2maxVal;\r\n        if (seg1dx != 0) { // the segments are NOT on a vertical line\r\n          if (inSeg1Pt1.x < inSeg1Pt2.x) {\r\n            seg1min = inSeg1Pt1;\r\n            seg1minVal = inSeg1Pt1.x;\r\n            seg1max = inSeg1Pt2;\r\n            seg1maxVal = inSeg1Pt2.x;\r\n          }\r\n          else {\r\n            seg1min = inSeg1Pt2;\r\n            seg1minVal = inSeg1Pt2.x;\r\n            seg1max = inSeg1Pt1;\r\n            seg1maxVal = inSeg1Pt1.x;\r\n          }\r\n          if (inSeg2Pt1.x < inSeg2Pt2.x) {\r\n            seg2min = inSeg2Pt1;\r\n            seg2minVal = inSeg2Pt1.x;\r\n            seg2max = inSeg2Pt2;\r\n            seg2maxVal = inSeg2Pt2.x;\r\n          }\r\n          else {\r\n            seg2min = inSeg2Pt2;\r\n            seg2minVal = inSeg2Pt2.x;\r\n            seg2max = inSeg2Pt1;\r\n            seg2maxVal = inSeg2Pt1.x;\r\n          }\r\n        }\r\n        else { // the segments are on a vertical line\r\n          if (inSeg1Pt1.y < inSeg1Pt2.y) {\r\n            seg1min = inSeg1Pt1;\r\n            seg1minVal = inSeg1Pt1.y;\r\n            seg1max = inSeg1Pt2;\r\n            seg1maxVal = inSeg1Pt2.y;\r\n          }\r\n          else {\r\n            seg1min = inSeg1Pt2;\r\n            seg1minVal = inSeg1Pt2.y;\r\n            seg1max = inSeg1Pt1;\r\n            seg1maxVal = inSeg1Pt1.y;\r\n          }\r\n          if (inSeg2Pt1.y < inSeg2Pt2.y) {\r\n            seg2min = inSeg2Pt1;\r\n            seg2minVal = inSeg2Pt1.y;\r\n            seg2max = inSeg2Pt2;\r\n            seg2maxVal = inSeg2Pt2.y;\r\n          }\r\n          else {\r\n            seg2min = inSeg2Pt2;\r\n            seg2minVal = inSeg2Pt2.y;\r\n            seg2max = inSeg2Pt1;\r\n            seg2maxVal = inSeg2Pt1.y;\r\n          }\r\n        }\r\n        if (seg1minVal <= seg2minVal) {\r\n          if (seg1maxVal < seg2minVal) return [];\r\n          if (seg1maxVal == seg2minVal) {\r\n            if (inExcludeAdjacentSegs) return [];\r\n            return [seg2min];\r\n          }\r\n          if (seg1maxVal <= seg2maxVal) return [seg2min, seg1max];\r\n          return [seg2min, seg2max];\r\n        }\r\n        else {\r\n          if (seg1minVal > seg2maxVal) return [];\r\n          if (seg1minVal == seg2maxVal) {\r\n            if (inExcludeAdjacentSegs) return [];\r\n            return [seg1min];\r\n          }\r\n          if (seg1maxVal <= seg2maxVal) return [seg1min, seg1max];\r\n          return [seg1min, seg2max];\r\n        }\r\n      }\r\n    }\r\n\r\n    function isPointInsideAngle(inVertex, inLegFromPt, inLegToPt, inOtherPt) {\r\n      // The order of legs is important\r\n\r\n      var EPSILON = 0.0000000001;\r\n\r\n      // translation of all points, so that Vertex is at (0,0)\r\n      var legFromPtX = inLegFromPt.x - inVertex.x,\r\n        legFromPtY = inLegFromPt.y - inVertex.y;\r\n      var legToPtX = inLegToPt.x - inVertex.x,\r\n        legToPtY = inLegToPt.y - inVertex.y;\r\n      var otherPtX = inOtherPt.x - inVertex.x,\r\n        otherPtY = inOtherPt.y - inVertex.y;\r\n\r\n      // main angle >0: < 180 deg.; 0: 180 deg.; <0: > 180 deg.\r\n      var from2toAngle = legFromPtX * legToPtY - legFromPtY * legToPtX;\r\n      var from2otherAngle = legFromPtX * otherPtY - legFromPtY * otherPtX;\r\n\r\n      if (Math.abs(from2toAngle) > EPSILON) { // angle != 180 deg.\r\n\r\n        var other2toAngle = otherPtX * legToPtY - otherPtY * legToPtX;\r\n        // console.log( \"from2to: \" + from2toAngle + \", from2other: \" + from2otherAngle + \", other2to: \" + other2toAngle );\r\n\r\n        if (from2toAngle > 0) { // main angle < 180 deg.\r\n          return ((from2otherAngle >= 0) && (other2toAngle >= 0));\r\n        }\r\n        else { // main angle > 180 deg.\r\n          return ((from2otherAngle >= 0) || (other2toAngle >= 0));\r\n        }\r\n      }\r\n      else { // angle == 180 deg.\r\n        // console.log( \"from2to: 180 deg., from2other: \" + from2otherAngle  );\r\n        return (from2otherAngle > 0);\r\n      }\r\n    }\r\n\r\n\r\n    function removeHoles(contour, holes) {\r\n\r\n      var shape = contour.concat(); // work on this shape\r\n      var hole;\r\n\r\n      function isCutLineInsideAngles(inShapeIdx, inHoleIdx) {\r\n        // Check if hole point lies within angle around shape point\r\n        var lastShapeIdx = shape.length - 1;\r\n\r\n        var prevShapeIdx = inShapeIdx - 1;\r\n        if (prevShapeIdx < 0) prevShapeIdx = lastShapeIdx;\r\n\r\n        var nextShapeIdx = inShapeIdx + 1;\r\n        if (nextShapeIdx > lastShapeIdx) nextShapeIdx = 0;\r\n\r\n        var insideAngle = isPointInsideAngle(shape[inShapeIdx], shape[prevShapeIdx], shape[nextShapeIdx], hole[inHoleIdx]);\r\n        if (!insideAngle) {\r\n          // console.log( \"Vertex (Shape): \" + inShapeIdx + \", Point: \" + hole[inHoleIdx].x + \"/\" + hole[inHoleIdx].y );\r\n          return false;\r\n        }\r\n\r\n        // Check if shape point lies within angle around hole point\r\n        var lastHoleIdx = hole.length - 1;\r\n\r\n        var prevHoleIdx = inHoleIdx - 1;\r\n        if (prevHoleIdx < 0) prevHoleIdx = lastHoleIdx;\r\n\r\n        var nextHoleIdx = inHoleIdx + 1;\r\n        if (nextHoleIdx > lastHoleIdx) nextHoleIdx = 0;\r\n\r\n        insideAngle = isPointInsideAngle(hole[inHoleIdx], hole[prevHoleIdx], hole[nextHoleIdx], shape[inShapeIdx]);\r\n        if (!insideAngle) {\r\n          // console.log( \"Vertex (Hole): \" + inHoleIdx + \", Point: \" + shape[inShapeIdx].x + \"/\" + shape[inShapeIdx].y );\r\n          return false;\r\n        }\r\n\r\n        return true;\r\n      }\r\n\r\n      function intersectsShapeEdge(inShapePt, inHolePt) {\r\n        // checks for intersections with shape edges\r\n        var sIdx, nextIdx, intersection;\r\n        for (sIdx = 0; sIdx < shape.length; sIdx++) {\r\n          nextIdx = sIdx + 1;\r\n          nextIdx %= shape.length;\r\n          intersection = intersect_segments_2D(inShapePt, inHolePt, shape[sIdx], shape[nextIdx], true);\r\n          if (intersection.length > 0) return true;\r\n        }\r\n\r\n        return false;\r\n      }\r\n\r\n      var indepHoles = [];\r\n\r\n      function intersectsHoleEdge(inShapePt, inHolePt) {\r\n        // checks for intersections with hole edges\r\n        var ihIdx, chkHole,\r\n          hIdx, nextIdx, intersection;\r\n        for (ihIdx = 0; ihIdx < indepHoles.length; ihIdx++) {\r\n          chkHole = holes[indepHoles[ihIdx]];\r\n          for (hIdx = 0; hIdx < chkHole.length; hIdx++) {\r\n            nextIdx = hIdx + 1;\r\n            nextIdx %= chkHole.length;\r\n            intersection = intersect_segments_2D(inShapePt, inHolePt, chkHole[hIdx], chkHole[nextIdx], true);\r\n            if (intersection.length > 0) return true;\r\n          }\r\n        }\r\n        return false;\r\n      }\r\n\r\n      var holeIndex, shapeIndex,\r\n        shapePt, holePt,\r\n        holeIdx, cutKey, failedCuts = [],\r\n        tmpShape1, tmpShape2,\r\n        tmpHole1, tmpHole2;\r\n\r\n      for (var h = 0, hl = holes.length; h < hl; h++) {\r\n\r\n        indepHoles.push(h);\r\n\r\n      }\r\n\r\n      var minShapeIndex = 0;\r\n      var counter = indepHoles.length * 2;\r\n      while (indepHoles.length > 0) {\r\n        counter--;\r\n        if (counter < 0) {\r\n          console.log(\"Infinite Loop! Holes left:\" + indepHoles.length + \", Probably Hole outside Shape!\");\r\n          break;\r\n        }\r\n\r\n        // search for shape-vertex and hole-vertex,\r\n        // which can be connected without intersections\r\n        for (shapeIndex = minShapeIndex; shapeIndex < shape.length; shapeIndex++) {\r\n\r\n          shapePt = shape[shapeIndex];\r\n          holeIndex = -1;\r\n\r\n          // search for hole which can be reached without intersections\r\n          for (var h = 0; h < indepHoles.length; h++) {\r\n            holeIdx = indepHoles[h];\r\n\r\n            // prevent multiple checks\r\n            cutKey = shapePt.x + \":\" + shapePt.y + \":\" + holeIdx;\r\n            if (failedCuts[cutKey] !== undefined) continue;\r\n\r\n            hole = holes[holeIdx];\r\n            for (var h2 = 0; h2 < hole.length; h2++) {\r\n              holePt = hole[h2];\r\n              if (!isCutLineInsideAngles(shapeIndex, h2)) continue;\r\n              if (intersectsShapeEdge(shapePt, holePt)) continue;\r\n              if (intersectsHoleEdge(shapePt, holePt)) continue;\r\n\r\n              holeIndex = h2;\r\n              indepHoles.splice(h, 1);\r\n\r\n              tmpShape1 = shape.slice(0, shapeIndex + 1);\r\n              tmpShape2 = shape.slice(shapeIndex);\r\n              tmpHole1 = hole.slice(holeIndex);\r\n              tmpHole2 = hole.slice(0, holeIndex + 1);\r\n\r\n              shape = tmpShape1.concat(tmpHole1).concat(tmpHole2).concat(tmpShape2);\r\n\r\n              minShapeIndex = shapeIndex;\r\n\r\n              // Debug only, to show the selected cuts\r\n              // glob_CutLines.push( [ shapePt, holePt ] );\r\n\r\n              break;\r\n            }\r\n            if (holeIndex >= 0) break; // hole-vertex found\r\n\r\n            failedCuts[cutKey] = true; // remember failure\r\n          }\r\n          if (holeIndex >= 0) break; // hole-vertex found\r\n        }\r\n      }\r\n\r\n      return shape; /* shape with no holes */\r\n    }\r\n\r\n\r\n    var i, il, f, face,\r\n      key, index,\r\n      allPointsMap = {};\r\n\r\n    // To maintain reference to old shape, one must match coordinates, or offset the indices from original arrays. It's probably easier to do the first.\r\n\r\n    var allpoints = contour.concat();\r\n\r\n    for (var h = 0, hl = holes.length; h < hl; h++) {\r\n\r\n      Array.prototype.push.apply(allpoints, holes[h]);\r\n\r\n    }\r\n\r\n    //console.log( \"allpoints\",allpoints, allpoints.length );\r\n\r\n    // prepare all points map\r\n\r\n    for (i = 0, il = allpoints.length; i < il; i++) {\r\n\r\n      key = allpoints[i].x + \":\" + allpoints[i].y;\r\n\r\n      if (allPointsMap[key] !== undefined) {\r\n\r\n        THREE.warn(\"THREE.Shape: Duplicate point\", key);\r\n\r\n      }\r\n\r\n      allPointsMap[key] = i;\r\n\r\n    }\r\n\r\n    // remove holes by cutting paths to holes and adding them to the shape\r\n    var shapeWithoutHoles = removeHoles(contour, holes);\r\n\r\n    var triangles = THREE.FontUtils.Triangulate(shapeWithoutHoles, false); // True returns indices for points of spooled shape\r\n    //console.log( \"triangles\",triangles, triangles.length );\r\n\r\n    // check all face vertices against all points map\r\n\r\n    for (i = 0, il = triangles.length; i < il; i++) {\r\n\r\n      face = triangles[i];\r\n\r\n      for (f = 0; f < 3; f++) {\r\n\r\n        key = face[f].x + \":\" + face[f].y;\r\n\r\n        index = allPointsMap[key];\r\n\r\n        if (index !== undefined) {\r\n\r\n          face[f] = index;\r\n\r\n        }\r\n\r\n      }\r\n\r\n    }\r\n\r\n    return triangles.concat();\r\n\r\n  },\r\n\r\n  isClockWise: function(pts) {\r\n\r\n    return THREE.FontUtils.Triangulate.area(pts) < 0;\r\n\r\n  },\r\n\r\n  // Bezier Curves formulas obtained from\r\n  // http://en.wikipedia.org/wiki/B%C3%A9zier_curve\r\n\r\n  // Quad Bezier Functions\r\n\r\n  b2p0: function(t, p) {\r\n\r\n    var k = 1 - t;\r\n    return k * k * p;\r\n\r\n  },\r\n\r\n  b2p1: function(t, p) {\r\n\r\n    return 2 * (1 - t) * t * p;\r\n\r\n  },\r\n\r\n  b2p2: function(t, p) {\r\n\r\n    return t * t * p;\r\n\r\n  },\r\n\r\n  b2: function(t, p0, p1, p2) {\r\n\r\n    return this.b2p0(t, p0) + this.b2p1(t, p1) + this.b2p2(t, p2);\r\n\r\n  },\r\n\r\n  // Cubic Bezier Functions\r\n\r\n  b3p0: function(t, p) {\r\n\r\n    var k = 1 - t;\r\n    return k * k * k * p;\r\n\r\n  },\r\n\r\n  b3p1: function(t, p) {\r\n\r\n    var k = 1 - t;\r\n    return 3 * k * k * t * p;\r\n\r\n  },\r\n\r\n  b3p2: function(t, p) {\r\n\r\n    var k = 1 - t;\r\n    return 3 * k * t * t * p;\r\n\r\n  },\r\n\r\n  b3p3: function(t, p) {\r\n\r\n    return t * t * t * p;\r\n\r\n  },\r\n\r\n  b3: function(t, p0, p1, p2, p3) {\r\n\r\n    return this.b3p0(t, p0) + this.b3p1(t, p1) + this.b3p2(t, p2) + this.b3p3(t, p3);\r\n\r\n  }\r\n\r\n};\r\n\r\n\r\n// File:src/extras/curves/LineCurve.js\r\n\r\n/**************************************************************\r\n *\tLine\r\n **************************************************************/\r\n\r\nTHREE.LineCurve = function(v1, v2) {\r\n\r\n  this.v1 = v1;\r\n  this.v2 = v2;\r\n\r\n};\r\n\r\nTHREE.LineCurve.prototype = Object.create(THREE.Curve.prototype);\r\nTHREE.LineCurve.prototype.constructor = THREE.LineCurve;\r\n\r\nTHREE.LineCurve.prototype.getPoint = function(t) {\r\n\r\n  var point = this.v2.clone().sub(this.v1);\r\n  point.multiplyScalar(t).add(this.v1);\r\n\r\n  return point;\r\n\r\n};\r\n\r\n// Line curve is linear, so we can overwrite default getPointAt\r\n\r\nTHREE.LineCurve.prototype.getPointAt = function(u) {\r\n\r\n  return this.getPoint(u);\r\n\r\n};\r\n\r\nTHREE.LineCurve.prototype.getTangent = function(t) {\r\n\r\n  var tangent = this.v2.clone().sub(this.v1);\r\n\r\n  return tangent.normalize();\r\n\r\n};\r\n\r\n// File:src/extras/curves/QuadraticBezierCurve.js\r\n\r\n/**************************************************************\r\n *\tQuadratic Bezier curve\r\n **************************************************************/\r\n\r\n\r\nTHREE.QuadraticBezierCurve = function(v0, v1, v2) {\r\n\r\n  this.v0 = v0;\r\n  this.v1 = v1;\r\n  this.v2 = v2;\r\n\r\n};\r\n\r\nTHREE.QuadraticBezierCurve.prototype = Object.create(THREE.Curve.prototype);\r\nTHREE.QuadraticBezierCurve.prototype.constructor = THREE.QuadraticBezierCurve;\r\n\r\n\r\nTHREE.QuadraticBezierCurve.prototype.getPoint = function(t) {\r\n\r\n  var vector = new THREE.Vector2();\r\n\r\n  vector.x = THREE.Shape.Utils.b2(t, this.v0.x, this.v1.x, this.v2.x);\r\n  vector.y = THREE.Shape.Utils.b2(t, this.v0.y, this.v1.y, this.v2.y);\r\n\r\n  return vector;\r\n\r\n};\r\n\r\n\r\nTHREE.QuadraticBezierCurve.prototype.getTangent = function(t) {\r\n\r\n  var vector = new THREE.Vector2();\r\n\r\n  vector.x = THREE.Curve.Utils.tangentQuadraticBezier(t, this.v0.x, this.v1.x, this.v2.x);\r\n  vector.y = THREE.Curve.Utils.tangentQuadraticBezier(t, this.v0.y, this.v1.y, this.v2.y);\r\n\r\n  // returns unit vector\r\n\r\n  return vector.normalize();\r\n\r\n};\r\n\r\n// File:src/extras/curves/CubicBezierCurve.js\r\n\r\n/**************************************************************\r\n *\tCubic Bezier curve\r\n **************************************************************/\r\n\r\nTHREE.CubicBezierCurve = function(v0, v1, v2, v3) {\r\n\r\n  this.v0 = v0;\r\n  this.v1 = v1;\r\n  this.v2 = v2;\r\n  this.v3 = v3;\r\n\r\n};\r\n\r\nTHREE.CubicBezierCurve.prototype = Object.create(THREE.Curve.prototype);\r\nTHREE.CubicBezierCurve.prototype.constructor = THREE.CubicBezierCurve;\r\n\r\nTHREE.CubicBezierCurve.prototype.getPoint = function(t) {\r\n\r\n  var tx, ty;\r\n\r\n  tx = THREE.Shape.Utils.b3(t, this.v0.x, this.v1.x, this.v2.x, this.v3.x);\r\n  ty = THREE.Shape.Utils.b3(t, this.v0.y, this.v1.y, this.v2.y, this.v3.y);\r\n\r\n  return new THREE.Vector2(tx, ty);\r\n\r\n};\r\n\r\nTHREE.CubicBezierCurve.prototype.getTangent = function(t) {\r\n\r\n  var tx, ty;\r\n\r\n  tx = THREE.Curve.Utils.tangentCubicBezier(t, this.v0.x, this.v1.x, this.v2.x, this.v3.x);\r\n  ty = THREE.Curve.Utils.tangentCubicBezier(t, this.v0.y, this.v1.y, this.v2.y, this.v3.y);\r\n\r\n  var tangent = new THREE.Vector2(tx, ty);\r\n  tangent.normalize();\r\n\r\n  return tangent;\r\n\r\n};\r\n\r\n// File:src/extras/curves/SplineCurve.js\r\n\r\n/**************************************************************\r\n *\tSpline curve\r\n **************************************************************/\r\n\r\nTHREE.SplineCurve = function(points /* array of Vector2 */ ) {\r\n\r\n  this.points = (points == undefined) ? [] : points;\r\n\r\n};\r\n\r\nTHREE.SplineCurve.prototype = Object.create(THREE.Curve.prototype);\r\nTHREE.SplineCurve.prototype.constructor = THREE.SplineCurve;\r\n\r\nTHREE.SplineCurve.prototype.getPoint = function(t) {\r\n\r\n  var points = this.points;\r\n  var point = (points.length - 1) * t;\r\n\r\n  var intPoint = Math.floor(point);\r\n  var weight = point - intPoint;\r\n\r\n  var point0 = points[intPoint == 0 ? intPoint : intPoint - 1]\r\n  var point1 = points[intPoint]\r\n  var point2 = points[intPoint > points.length - 2 ? points.length - 1 : intPoint + 1]\r\n  var point3 = points[intPoint > points.length - 3 ? points.length - 1 : intPoint + 2]\r\n\r\n  var vector = new THREE.Vector2();\r\n\r\n  vector.x = THREE.Curve.Utils.interpolate(point0.x, point1.x, point2.x, point3.x, weight);\r\n  vector.y = THREE.Curve.Utils.interpolate(point0.y, point1.y, point2.y, point3.y, weight);\r\n\r\n  return vector;\r\n\r\n};\r\n\r\n// File:src/extras/curves/EllipseCurve.js\r\n\r\n/**************************************************************\r\n *\tEllipse curve\r\n **************************************************************/\r\n\r\nTHREE.EllipseCurve = function(aX, aY, xRadius, yRadius, aStartAngle, aEndAngle, aClockwise) {\r\n\r\n  this.aX = aX;\r\n  this.aY = aY;\r\n\r\n  this.xRadius = xRadius;\r\n  this.yRadius = yRadius;\r\n\r\n  this.aStartAngle = aStartAngle;\r\n  this.aEndAngle = aEndAngle;\r\n\r\n  this.aClockwise = aClockwise;\r\n\r\n};\r\n\r\nTHREE.EllipseCurve.prototype = Object.create(THREE.Curve.prototype);\r\nTHREE.EllipseCurve.prototype.constructor = THREE.EllipseCurve;\r\n\r\nTHREE.EllipseCurve.prototype.getPoint = function(t) {\r\n\r\n  var deltaAngle = this.aEndAngle - this.aStartAngle;\r\n\r\n  if (deltaAngle < 0) deltaAngle += Math.PI * 2;\r\n  if (deltaAngle > Math.PI * 2) deltaAngle -= Math.PI * 2;\r\n\r\n  var angle;\r\n\r\n  if (this.aClockwise === true) {\r\n\r\n    angle = this.aEndAngle + (1 - t) * (Math.PI * 2 - deltaAngle);\r\n\r\n  }\r\n  else {\r\n\r\n    angle = this.aStartAngle + t * deltaAngle;\r\n\r\n  }\r\n\r\n  var vector = new THREE.Vector2();\r\n\r\n  vector.x = this.aX + this.xRadius * Math.cos(angle);\r\n  vector.y = this.aY + this.yRadius * Math.sin(angle);\r\n\r\n  return vector;\r\n\r\n};\r\n\r\n// File:src/extras/curves/ArcCurve.js\r\n\r\n/**************************************************************\r\n *\tArc curve\r\n **************************************************************/\r\n\r\nTHREE.ArcCurve = function(aX, aY, aRadius, aStartAngle, aEndAngle, aClockwise) {\r\n\r\n  THREE.EllipseCurve.call(this, aX, aY, aRadius, aRadius, aStartAngle, aEndAngle, aClockwise);\r\n};\r\n\r\nTHREE.ArcCurve.prototype = Object.create(THREE.EllipseCurve.prototype);\r\nTHREE.ArcCurve.prototype.constructor = THREE.ArcCurve;\r\n\r\n// File:src/extras/curves/LineCurve3.js\r\n\r\n/**************************************************************\r\n *\tLine3D\r\n **************************************************************/\r\n\r\nTHREE.LineCurve3 = THREE.Curve.create(\r\n\r\n  function(v1, v2) {\r\n\r\n    this.v1 = v1;\r\n    this.v2 = v2;\r\n\r\n  },\r\n\r\n  function(t) {\r\n\r\n    var vector = new THREE.Vector3();\r\n\r\n    vector.subVectors(this.v2, this.v1); // diff\r\n    vector.multiplyScalar(t);\r\n    vector.add(this.v1);\r\n\r\n    return vector;\r\n\r\n  }\r\n\r\n);\r\n\r\n// File:src/extras/curves/QuadraticBezierCurve3.js\r\n\r\n/**************************************************************\r\n *\tQuadratic Bezier 3D curve\r\n **************************************************************/\r\n\r\nTHREE.QuadraticBezierCurve3 = THREE.Curve.create(\r\n\r\n  function(v0, v1, v2) {\r\n\r\n    this.v0 = v0;\r\n    this.v1 = v1;\r\n    this.v2 = v2;\r\n\r\n  },\r\n\r\n  function(t) {\r\n\r\n    var vector = new THREE.Vector3();\r\n\r\n    vector.x = THREE.Shape.Utils.b2(t, this.v0.x, this.v1.x, this.v2.x);\r\n    vector.y = THREE.Shape.Utils.b2(t, this.v0.y, this.v1.y, this.v2.y);\r\n    vector.z = THREE.Shape.Utils.b2(t, this.v0.z, this.v1.z, this.v2.z);\r\n\r\n    return vector;\r\n\r\n  }\r\n\r\n);\r\n\r\n// File:src/extras/curves/CubicBezierCurve3.js\r\n\r\n/**************************************************************\r\n *\tCubic Bezier 3D curve\r\n **************************************************************/\r\n\r\nTHREE.CubicBezierCurve3 = THREE.Curve.create(\r\n\r\n  function(v0, v1, v2, v3) {\r\n\r\n    this.v0 = v0;\r\n    this.v1 = v1;\r\n    this.v2 = v2;\r\n    this.v3 = v3;\r\n\r\n  },\r\n\r\n  function(t) {\r\n\r\n    var vector = new THREE.Vector3();\r\n\r\n    vector.x = THREE.Shape.Utils.b3(t, this.v0.x, this.v1.x, this.v2.x, this.v3.x);\r\n    vector.y = THREE.Shape.Utils.b3(t, this.v0.y, this.v1.y, this.v2.y, this.v3.y);\r\n    vector.z = THREE.Shape.Utils.b3(t, this.v0.z, this.v1.z, this.v2.z, this.v3.z);\r\n\r\n    return vector;\r\n\r\n  }\r\n\r\n);\r\n\r\n// File:src/extras/curves/SplineCurve3.js\r\n\r\n/**************************************************************\r\n *\tSpline 3D curve\r\n **************************************************************/\r\n\r\n\r\nTHREE.SplineCurve3 = THREE.Curve.create(\r\n\r\n  function(points /* array of Vector3 */ ) {\r\n\r\n    this.points = (points == undefined) ? [] : points;\r\n\r\n  },\r\n\r\n  function(t) {\r\n\r\n    var points = this.points;\r\n    var point = (points.length - 1) * t;\r\n\r\n    var intPoint = Math.floor(point);\r\n    var weight = point - intPoint;\r\n\r\n    var point0 = points[intPoint == 0 ? intPoint : intPoint - 1];\r\n    var point1 = points[intPoint];\r\n    var point2 = points[intPoint > points.length - 2 ? points.length - 1 : intPoint + 1];\r\n    var point3 = points[intPoint > points.length - 3 ? points.length - 1 : intPoint + 2];\r\n\r\n    var vector = new THREE.Vector3();\r\n\r\n    vector.x = THREE.Curve.Utils.interpolate(point0.x, point1.x, point2.x, point3.x, weight);\r\n    vector.y = THREE.Curve.Utils.interpolate(point0.y, point1.y, point2.y, point3.y, weight);\r\n    vector.z = THREE.Curve.Utils.interpolate(point0.z, point1.z, point2.z, point3.z, weight);\r\n\r\n    return vector;\r\n\r\n  }\r\n\r\n);\r\n\r\n// File:src/extras/curves/ClosedSplineCurve3.js\r\n\r\n/**************************************************************\r\n *\tClosed Spline 3D curve\r\n **************************************************************/\r\n\r\n\r\nTHREE.ClosedSplineCurve3 = THREE.Curve.create(\r\n\r\n  function(points /* array of Vector3 */ ) {\r\n\r\n    this.points = (points == undefined) ? [] : points;\r\n\r\n  },\r\n\r\n  function(t) {\r\n\r\n    var points = this.points;\r\n    var point = (points.length - 0) * t; // This needs to be from 0-length +1\r\n\r\n    var intPoint = Math.floor(point);\r\n    var weight = point - intPoint;\r\n\r\n    intPoint += intPoint > 0 ? 0 : (Math.floor(Math.abs(intPoint) / points.length) + 1) * points.length;\r\n\r\n    var point0 = points[(intPoint - 1) % points.length];\r\n    var point1 = points[(intPoint) % points.length];\r\n    var point2 = points[(intPoint + 1) % points.length];\r\n    var point3 = points[(intPoint + 2) % points.length];\r\n\r\n    var vector = new THREE.Vector3();\r\n\r\n    vector.x = THREE.Curve.Utils.interpolate(point0.x, point1.x, point2.x, point3.x, weight);\r\n    vector.y = THREE.Curve.Utils.interpolate(point0.y, point1.y, point2.y, point3.y, weight);\r\n    vector.z = THREE.Curve.Utils.interpolate(point0.z, point1.z, point2.z, point3.z, weight);\r\n\r\n    return vector;\r\n\r\n  }\r\n\r\n);\r\n\r\n// File:src/extras/animation/AnimationHandler.js\r\n\r\n/**\r\n * @author mikael emtinger / http://gomo.se/\r\n */\r\n\r\nTHREE.AnimationHandler = {\r\n\r\n  LINEAR: 0,\r\n  CATMULLROM: 1,\r\n  CATMULLROM_FORWARD: 2,\r\n\r\n  //\r\n\r\n  add: function() {\r\n    THREE.warn('THREE.AnimationHandler.add() has been deprecated.');\r\n  },\r\n  get: function() {\r\n    THREE.warn('THREE.AnimationHandler.get() has been deprecated.');\r\n  },\r\n  remove: function() {\r\n    THREE.warn('THREE.AnimationHandler.remove() has been deprecated.');\r\n  },\r\n\r\n  //\r\n\r\n  animations: [],\r\n\r\n  init: function(data) {\r\n\r\n    if (data.initialized === true) return data;\r\n\r\n    // loop through all keys\r\n\r\n    for (var h = 0; h < data.hierarchy.length; h++) {\r\n\r\n      for (var k = 0; k < data.hierarchy[h].keys.length; k++) {\r\n\r\n        // remove minus times\r\n\r\n        if (data.hierarchy[h].keys[k].time < 0) {\r\n\r\n          data.hierarchy[h].keys[k].time = 0;\r\n\r\n        }\r\n\r\n        // create quaternions\r\n\r\n        if (data.hierarchy[h].keys[k].rot !== undefined &&\r\n          !(data.hierarchy[h].keys[k].rot instanceof THREE.Quaternion)) {\r\n\r\n          var quat = data.hierarchy[h].keys[k].rot;\r\n          data.hierarchy[h].keys[k].rot = new THREE.Quaternion().fromArray(quat);\r\n\r\n        }\r\n\r\n      }\r\n\r\n      // prepare morph target keys\r\n\r\n      if (data.hierarchy[h].keys.length && data.hierarchy[h].keys[0].morphTargets !== undefined) {\r\n\r\n        // get all used\r\n\r\n        var usedMorphTargets = {};\r\n\r\n        for (var k = 0; k < data.hierarchy[h].keys.length; k++) {\r\n\r\n          for (var m = 0; m < data.hierarchy[h].keys[k].morphTargets.length; m++) {\r\n\r\n            var morphTargetName = data.hierarchy[h].keys[k].morphTargets[m];\r\n            usedMorphTargets[morphTargetName] = -1;\r\n\r\n          }\r\n\r\n        }\r\n\r\n        data.hierarchy[h].usedMorphTargets = usedMorphTargets;\r\n\r\n\r\n        // set all used on all frames\r\n\r\n        for (var k = 0; k < data.hierarchy[h].keys.length; k++) {\r\n\r\n          var influences = {};\r\n\r\n          for (var morphTargetName in usedMorphTargets) {\r\n\r\n            for (var m = 0; m < data.hierarchy[h].keys[k].morphTargets.length; m++) {\r\n\r\n              if (data.hierarchy[h].keys[k].morphTargets[m] === morphTargetName) {\r\n\r\n                influences[morphTargetName] = data.hierarchy[h].keys[k].morphTargetsInfluences[m];\r\n                break;\r\n\r\n              }\r\n\r\n            }\r\n\r\n            if (m === data.hierarchy[h].keys[k].morphTargets.length) {\r\n\r\n              influences[morphTargetName] = 0;\r\n\r\n            }\r\n\r\n          }\r\n\r\n          data.hierarchy[h].keys[k].morphTargetsInfluences = influences;\r\n\r\n        }\r\n\r\n      }\r\n\r\n\r\n      // remove all keys that are on the same time\r\n\r\n      for (var k = 1; k < data.hierarchy[h].keys.length; k++) {\r\n\r\n        if (data.hierarchy[h].keys[k].time === data.hierarchy[h].keys[k - 1].time) {\r\n\r\n          data.hierarchy[h].keys.splice(k, 1);\r\n          k--;\r\n\r\n        }\r\n\r\n      }\r\n\r\n\r\n      // set index\r\n\r\n      for (var k = 0; k < data.hierarchy[h].keys.length; k++) {\r\n\r\n        data.hierarchy[h].keys[k].index = k;\r\n\r\n      }\r\n\r\n    }\r\n\r\n    data.initialized = true;\r\n\r\n    return data;\r\n\r\n  },\r\n\r\n  parse: function(root) {\r\n\r\n    var parseRecurseHierarchy = function(root, hierarchy) {\r\n\r\n      hierarchy.push(root);\r\n\r\n      for (var c = 0; c < root.children.length; c++)\r\n        parseRecurseHierarchy(root.children[c], hierarchy);\r\n\r\n    };\r\n\r\n    // setup hierarchy\r\n\r\n    var hierarchy = [];\r\n\r\n    if (root instanceof THREE.SkinnedMesh) {\r\n\r\n      for (var b = 0; b < root.skeleton.bones.length; b++) {\r\n\r\n        hierarchy.push(root.skeleton.bones[b]);\r\n\r\n      }\r\n\r\n    }\r\n    else {\r\n\r\n      parseRecurseHierarchy(root, hierarchy);\r\n\r\n    }\r\n\r\n    return hierarchy;\r\n\r\n  },\r\n\r\n  play: function(animation) {\r\n\r\n    if (this.animations.indexOf(animation) === -1) {\r\n\r\n      this.animations.push(animation);\r\n\r\n    }\r\n\r\n  },\r\n\r\n  stop: function(animation) {\r\n\r\n    var index = this.animations.indexOf(animation);\r\n\r\n    if (index !== -1) {\r\n\r\n      this.animations.splice(index, 1);\r\n\r\n    }\r\n\r\n  },\r\n\r\n  update: function(deltaTimeMS) {\r\n\r\n    for (var i = 0; i < this.animations.length; i++) {\r\n\r\n      this.animations[i].resetBlendWeights();\r\n\r\n    }\r\n\r\n    for (var i = 0; i < this.animations.length; i++) {\r\n\r\n      this.animations[i].update(deltaTimeMS);\r\n\r\n    }\r\n\r\n  }\r\n\r\n};\r\n\r\n// File:src/extras/animation/Animation.js\r\n\r\n/**\r\n * @author mikael emtinger / http://gomo.se/\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author alteredq / http://alteredqualia.com/\r\n */\r\n\r\nTHREE.Animation = function(root, data) {\r\n\r\n  this.root = root;\r\n  this.data = THREE.AnimationHandler.init(data);\r\n  this.hierarchy = THREE.AnimationHandler.parse(root);\r\n\r\n  this.currentTime = 0;\r\n  this.timeScale = 1;\r\n\r\n  this.isPlaying = false;\r\n  this.loop = true;\r\n  this.weight = 0;\r\n\r\n  this.interpolationType = THREE.AnimationHandler.LINEAR;\r\n\r\n};\r\n\r\nTHREE.Animation.prototype = {\r\n\r\n  constructor: THREE.Animation,\r\n\r\n  keyTypes: [\"pos\", \"rot\", \"scl\"],\r\n\r\n  play: function(startTime, weight) {\r\n\r\n    this.currentTime = startTime !== undefined ? startTime : 0;\r\n    this.weight = weight !== undefined ? weight : 1;\r\n\r\n    this.isPlaying = true;\r\n\r\n    this.reset();\r\n\r\n    THREE.AnimationHandler.play(this);\r\n\r\n  },\r\n\r\n  stop: function() {\r\n\r\n    this.isPlaying = false;\r\n\r\n    THREE.AnimationHandler.stop(this);\r\n\r\n  },\r\n\r\n  reset: function() {\r\n\r\n    for (var h = 0, hl = this.hierarchy.length; h < hl; h++) {\r\n\r\n      var object = this.hierarchy[h];\r\n\r\n      if (object.animationCache === undefined) {\r\n\r\n        object.animationCache = {\r\n          animations: {},\r\n          blending: {\r\n            positionWeight: 0.0,\r\n            quaternionWeight: 0.0,\r\n            scaleWeight: 0.0\r\n          }\r\n        };\r\n      }\r\n\r\n      var name = this.data.name;\r\n      var animations = object.animationCache.animations;\r\n      var animationCache = animations[name];\r\n\r\n      if (animationCache === undefined) {\r\n\r\n        animationCache = {\r\n          prevKey: {\r\n            pos: 0,\r\n            rot: 0,\r\n            scl: 0\r\n          },\r\n          nextKey: {\r\n            pos: 0,\r\n            rot: 0,\r\n            scl: 0\r\n          },\r\n          originalMatrix: object.matrix\r\n        };\r\n\r\n        animations[name] = animationCache;\r\n\r\n      }\r\n\r\n      // Get keys to match our current time\r\n\r\n      for (var t = 0; t < 3; t++) {\r\n\r\n        var type = this.keyTypes[t];\r\n\r\n        var prevKey = this.data.hierarchy[h].keys[0];\r\n        var nextKey = this.getNextKeyWith(type, h, 1);\r\n\r\n        while (nextKey.time < this.currentTime && nextKey.index > prevKey.index) {\r\n\r\n          prevKey = nextKey;\r\n          nextKey = this.getNextKeyWith(type, h, nextKey.index + 1);\r\n\r\n        }\r\n\r\n        animationCache.prevKey[type] = prevKey;\r\n        animationCache.nextKey[type] = nextKey;\r\n\r\n      }\r\n\r\n    }\r\n\r\n  },\r\n\r\n  resetBlendWeights: function() {\r\n\r\n    for (var h = 0, hl = this.hierarchy.length; h < hl; h++) {\r\n\r\n      var object = this.hierarchy[h];\r\n      var animationCache = object.animationCache;\r\n\r\n      if (animationCache !== undefined) {\r\n\r\n        var blending = animationCache.blending;\r\n\r\n        blending.positionWeight = 0.0;\r\n        blending.quaternionWeight = 0.0;\r\n        blending.scaleWeight = 0.0;\r\n\r\n      }\r\n\r\n    }\r\n\r\n  },\r\n\r\n  update: (function() {\r\n\r\n    var points = [];\r\n    var target = new THREE.Vector3();\r\n    var newVector = new THREE.Vector3();\r\n    var newQuat = new THREE.Quaternion();\r\n\r\n    // Catmull-Rom spline\r\n\r\n    var interpolateCatmullRom = function(points, scale) {\r\n\r\n      var c = [],\r\n        v3 = [],\r\n        point, intPoint, weight, w2, w3,\r\n        pa, pb, pc, pd;\r\n\r\n      point = (points.length - 1) * scale;\r\n      intPoint = Math.floor(point);\r\n      weight = point - intPoint;\r\n\r\n      c[0] = intPoint === 0 ? intPoint : intPoint - 1;\r\n      c[1] = intPoint;\r\n      c[2] = intPoint > points.length - 2 ? intPoint : intPoint + 1;\r\n      c[3] = intPoint > points.length - 3 ? intPoint : intPoint + 2;\r\n\r\n      pa = points[c[0]];\r\n      pb = points[c[1]];\r\n      pc = points[c[2]];\r\n      pd = points[c[3]];\r\n\r\n      w2 = weight * weight;\r\n      w3 = weight * w2;\r\n\r\n      v3[0] = interpolate(pa[0], pb[0], pc[0], pd[0], weight, w2, w3);\r\n      v3[1] = interpolate(pa[1], pb[1], pc[1], pd[1], weight, w2, w3);\r\n      v3[2] = interpolate(pa[2], pb[2], pc[2], pd[2], weight, w2, w3);\r\n\r\n      return v3;\r\n\r\n    };\r\n\r\n    var interpolate = function(p0, p1, p2, p3, t, t2, t3) {\r\n\r\n      var v0 = (p2 - p0) * 0.5,\r\n        v1 = (p3 - p1) * 0.5;\r\n\r\n      return (2 * (p1 - p2) + v0 + v1) * t3 + (-3 * (p1 - p2) - 2 * v0 - v1) * t2 + v0 * t + p1;\r\n\r\n    };\r\n\r\n    return function(delta) {\r\n\r\n      if (this.isPlaying === false) return;\r\n\r\n      this.currentTime += delta * this.timeScale;\r\n\r\n      if (this.weight === 0)\r\n        return;\r\n\r\n      //\r\n\r\n      var duration = this.data.length;\r\n\r\n      if (this.currentTime > duration || this.currentTime < 0) {\r\n\r\n        if (this.loop) {\r\n\r\n          this.currentTime %= duration;\r\n\r\n          if (this.currentTime < 0)\r\n            this.currentTime += duration;\r\n\r\n          this.reset();\r\n\r\n        }\r\n        else {\r\n\r\n          this.stop();\r\n\r\n        }\r\n\r\n      }\r\n\r\n      for (var h = 0, hl = this.hierarchy.length; h < hl; h++) {\r\n\r\n        var object = this.hierarchy[h];\r\n        var animationCache = object.animationCache.animations[this.data.name];\r\n        var blending = object.animationCache.blending;\r\n\r\n        // loop through pos/rot/scl\r\n\r\n        for (var t = 0; t < 3; t++) {\r\n\r\n          // get keys\r\n\r\n          var type = this.keyTypes[t];\r\n          var prevKey = animationCache.prevKey[type];\r\n          var nextKey = animationCache.nextKey[type];\r\n\r\n          if ((this.timeScale > 0 && nextKey.time <= this.currentTime) ||\r\n            (this.timeScale < 0 && prevKey.time >= this.currentTime)) {\r\n\r\n            prevKey = this.data.hierarchy[h].keys[0];\r\n            nextKey = this.getNextKeyWith(type, h, 1);\r\n\r\n            while (nextKey.time < this.currentTime && nextKey.index > prevKey.index) {\r\n\r\n              prevKey = nextKey;\r\n              nextKey = this.getNextKeyWith(type, h, nextKey.index + 1);\r\n\r\n            }\r\n\r\n            animationCache.prevKey[type] = prevKey;\r\n            animationCache.nextKey[type] = nextKey;\r\n\r\n          }\r\n\r\n          var scale = (this.currentTime - prevKey.time) / (nextKey.time - prevKey.time);\r\n\r\n          var prevXYZ = prevKey[type];\r\n          var nextXYZ = nextKey[type];\r\n\r\n          if (scale < 0) scale = 0;\r\n          if (scale > 1) scale = 1;\r\n\r\n          // interpolate\r\n\r\n          if (type === \"pos\") {\r\n\r\n            if (this.interpolationType === THREE.AnimationHandler.LINEAR) {\r\n\r\n              newVector.x = prevXYZ[0] + (nextXYZ[0] - prevXYZ[0]) * scale;\r\n              newVector.y = prevXYZ[1] + (nextXYZ[1] - prevXYZ[1]) * scale;\r\n              newVector.z = prevXYZ[2] + (nextXYZ[2] - prevXYZ[2]) * scale;\r\n\r\n              // blend\r\n              var proportionalWeight = this.weight / (this.weight + blending.positionWeight);\r\n              object.position.lerp(newVector, proportionalWeight);\r\n              blending.positionWeight += this.weight;\r\n\r\n            }\r\n            else if (this.interpolationType === THREE.AnimationHandler.CATMULLROM ||\r\n              this.interpolationType === THREE.AnimationHandler.CATMULLROM_FORWARD) {\r\n\r\n              points[0] = this.getPrevKeyWith(\"pos\", h, prevKey.index - 1)[\"pos\"];\r\n              points[1] = prevXYZ;\r\n              points[2] = nextXYZ;\r\n              points[3] = this.getNextKeyWith(\"pos\", h, nextKey.index + 1)[\"pos\"];\r\n\r\n              scale = scale * 0.33 + 0.33;\r\n\r\n              var currentPoint = interpolateCatmullRom(points, scale);\r\n              var proportionalWeight = this.weight / (this.weight + blending.positionWeight);\r\n              blending.positionWeight += this.weight;\r\n\r\n              // blend\r\n\r\n              var vector = object.position;\r\n\r\n              vector.x = vector.x + (currentPoint[0] - vector.x) * proportionalWeight;\r\n              vector.y = vector.y + (currentPoint[1] - vector.y) * proportionalWeight;\r\n              vector.z = vector.z + (currentPoint[2] - vector.z) * proportionalWeight;\r\n\r\n              if (this.interpolationType === THREE.AnimationHandler.CATMULLROM_FORWARD) {\r\n\r\n                var forwardPoint = interpolateCatmullRom(points, scale * 1.01);\r\n\r\n                target.set(forwardPoint[0], forwardPoint[1], forwardPoint[2]);\r\n                target.sub(vector);\r\n                target.y = 0;\r\n                target.normalize();\r\n\r\n                var angle = Math.atan2(target.x, target.z);\r\n                object.rotation.set(0, angle, 0);\r\n\r\n              }\r\n\r\n            }\r\n\r\n          }\r\n          else if (type === \"rot\") {\r\n\r\n            THREE.Quaternion.slerp(prevXYZ, nextXYZ, newQuat, scale);\r\n\r\n            // Avoid paying the cost of an additional slerp if we don't have to\r\n            if (blending.quaternionWeight === 0) {\r\n\r\n              object.quaternion.copy(newQuat);\r\n              blending.quaternionWeight = this.weight;\r\n\r\n            }\r\n            else {\r\n\r\n              var proportionalWeight = this.weight / (this.weight + blending.quaternionWeight);\r\n              THREE.Quaternion.slerp(object.quaternion, newQuat, object.quaternion, proportionalWeight);\r\n              blending.quaternionWeight += this.weight;\r\n\r\n            }\r\n\r\n          }\r\n          else if (type === \"scl\") {\r\n\r\n            newVector.x = prevXYZ[0] + (nextXYZ[0] - prevXYZ[0]) * scale;\r\n            newVector.y = prevXYZ[1] + (nextXYZ[1] - prevXYZ[1]) * scale;\r\n            newVector.z = prevXYZ[2] + (nextXYZ[2] - prevXYZ[2]) * scale;\r\n\r\n            var proportionalWeight = this.weight / (this.weight + blending.scaleWeight);\r\n            object.scale.lerp(newVector, proportionalWeight);\r\n            blending.scaleWeight += this.weight;\r\n\r\n          }\r\n\r\n        }\r\n\r\n      }\r\n\r\n      return true;\r\n\r\n    };\r\n\r\n  })(),\r\n\r\n  getNextKeyWith: function(type, h, key) {\r\n\r\n    var keys = this.data.hierarchy[h].keys;\r\n\r\n    if (this.interpolationType === THREE.AnimationHandler.CATMULLROM ||\r\n      this.interpolationType === THREE.AnimationHandler.CATMULLROM_FORWARD) {\r\n\r\n      key = key < keys.length - 1 ? key : keys.length - 1;\r\n\r\n    }\r\n    else {\r\n\r\n      key = key % keys.length;\r\n\r\n    }\r\n\r\n    for (; key < keys.length; key++) {\r\n\r\n      if (keys[key][type] !== undefined) {\r\n\r\n        return keys[key];\r\n\r\n      }\r\n\r\n    }\r\n\r\n    return this.data.hierarchy[h].keys[0];\r\n\r\n  },\r\n\r\n  getPrevKeyWith: function(type, h, key) {\r\n\r\n    var keys = this.data.hierarchy[h].keys;\r\n\r\n    if (this.interpolationType === THREE.AnimationHandler.CATMULLROM ||\r\n      this.interpolationType === THREE.AnimationHandler.CATMULLROM_FORWARD) {\r\n\r\n      key = key > 0 ? key : 0;\r\n\r\n    }\r\n    else {\r\n\r\n      key = key >= 0 ? key : key + keys.length;\r\n\r\n    }\r\n\r\n\r\n    for (; key >= 0; key--) {\r\n\r\n      if (keys[key][type] !== undefined) {\r\n\r\n        return keys[key];\r\n\r\n      }\r\n\r\n    }\r\n\r\n    return this.data.hierarchy[h].keys[keys.length - 1];\r\n\r\n  }\r\n\r\n};\r\n\r\n// File:src/extras/animation/KeyFrameAnimation.js\r\n\r\n/**\r\n * @author mikael emtinger / http://gomo.se/\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author alteredq / http://alteredqualia.com/\r\n * @author khang duong\r\n * @author erik kitson\r\n */\r\n\r\nTHREE.KeyFrameAnimation = function(data) {\r\n\r\n  this.root = data.node;\r\n  this.data = THREE.AnimationHandler.init(data);\r\n  this.hierarchy = THREE.AnimationHandler.parse(this.root);\r\n  this.currentTime = 0;\r\n  this.timeScale = 0.001;\r\n  this.isPlaying = false;\r\n  this.isPaused = true;\r\n  this.loop = true;\r\n\r\n  // initialize to first keyframes\r\n\r\n  for (var h = 0, hl = this.hierarchy.length; h < hl; h++) {\r\n\r\n    var keys = this.data.hierarchy[h].keys,\r\n      sids = this.data.hierarchy[h].sids,\r\n      obj = this.hierarchy[h];\r\n\r\n    if (keys.length && sids) {\r\n\r\n      for (var s = 0; s < sids.length; s++) {\r\n\r\n        var sid = sids[s],\r\n          next = this.getNextKeyWith(sid, h, 0);\r\n\r\n        if (next) {\r\n\r\n          next.apply(sid);\r\n\r\n        }\r\n\r\n      }\r\n\r\n      obj.matrixAutoUpdate = false;\r\n      this.data.hierarchy[h].node.updateMatrix();\r\n      obj.matrixWorldNeedsUpdate = true;\r\n\r\n    }\r\n\r\n  }\r\n\r\n};\r\n\r\nTHREE.KeyFrameAnimation.prototype = {\r\n\r\n  constructor: THREE.KeyFrameAnimation,\r\n\r\n  play: function(startTime) {\r\n\r\n    this.currentTime = startTime !== undefined ? startTime : 0;\r\n\r\n    if (this.isPlaying === false) {\r\n\r\n      this.isPlaying = true;\r\n\r\n      // reset key cache\r\n\r\n      var h, hl = this.hierarchy.length,\r\n        object,\r\n        node;\r\n\r\n      for (h = 0; h < hl; h++) {\r\n\r\n        object = this.hierarchy[h];\r\n        node = this.data.hierarchy[h];\r\n\r\n        if (node.animationCache === undefined) {\r\n\r\n          node.animationCache = {};\r\n          node.animationCache.prevKey = null;\r\n          node.animationCache.nextKey = null;\r\n          node.animationCache.originalMatrix = object.matrix;\r\n\r\n        }\r\n\r\n        var keys = this.data.hierarchy[h].keys;\r\n\r\n        if (keys.length) {\r\n\r\n          node.animationCache.prevKey = keys[0];\r\n          node.animationCache.nextKey = keys[1];\r\n\r\n          this.startTime = Math.min(keys[0].time, this.startTime);\r\n          this.endTime = Math.max(keys[keys.length - 1].time, this.endTime);\r\n\r\n        }\r\n\r\n      }\r\n\r\n      this.update(0);\r\n\r\n    }\r\n\r\n    this.isPaused = false;\r\n\r\n    THREE.AnimationHandler.play(this);\r\n\r\n  },\r\n\r\n  stop: function() {\r\n\r\n    this.isPlaying = false;\r\n    this.isPaused = false;\r\n\r\n    THREE.AnimationHandler.stop(this);\r\n\r\n    // reset JIT matrix and remove cache\r\n\r\n    for (var h = 0; h < this.data.hierarchy.length; h++) {\r\n\r\n      var obj = this.hierarchy[h];\r\n      var node = this.data.hierarchy[h];\r\n\r\n      if (node.animationCache !== undefined) {\r\n\r\n        var original = node.animationCache.originalMatrix;\r\n\r\n        original.copy(obj.matrix);\r\n        obj.matrix = original;\r\n\r\n        delete node.animationCache;\r\n\r\n      }\r\n\r\n    }\r\n\r\n  },\r\n\r\n  update: function(delta) {\r\n\r\n    if (this.isPlaying === false) return;\r\n\r\n    this.currentTime += delta * this.timeScale;\r\n\r\n    //\r\n\r\n    var duration = this.data.length;\r\n\r\n    if (this.loop === true && this.currentTime > duration) {\r\n\r\n      this.currentTime %= duration;\r\n\r\n    }\r\n\r\n    this.currentTime = Math.min(this.currentTime, duration);\r\n\r\n    for (var h = 0, hl = this.hierarchy.length; h < hl; h++) {\r\n\r\n      var object = this.hierarchy[h];\r\n      var node = this.data.hierarchy[h];\r\n\r\n      var keys = node.keys,\r\n        animationCache = node.animationCache;\r\n\r\n\r\n      if (keys.length) {\r\n\r\n        var prevKey = animationCache.prevKey;\r\n        var nextKey = animationCache.nextKey;\r\n\r\n        if (nextKey.time <= this.currentTime) {\r\n\r\n          while (nextKey.time < this.currentTime && nextKey.index > prevKey.index) {\r\n\r\n            prevKey = nextKey;\r\n            nextKey = keys[prevKey.index + 1];\r\n\r\n          }\r\n\r\n          animationCache.prevKey = prevKey;\r\n          animationCache.nextKey = nextKey;\r\n\r\n        }\r\n\r\n        if (nextKey.time >= this.currentTime) {\r\n\r\n          prevKey.interpolate(nextKey, this.currentTime);\r\n\r\n        }\r\n        else {\r\n\r\n          prevKey.interpolate(nextKey, nextKey.time);\r\n\r\n        }\r\n\r\n        this.data.hierarchy[h].node.updateMatrix();\r\n        object.matrixWorldNeedsUpdate = true;\r\n\r\n      }\r\n\r\n    }\r\n\r\n  },\r\n\r\n  getNextKeyWith: function(sid, h, key) {\r\n\r\n    var keys = this.data.hierarchy[h].keys;\r\n    key = key % keys.length;\r\n\r\n    for (; key < keys.length; key++) {\r\n\r\n      if (keys[key].hasTarget(sid)) {\r\n\r\n        return keys[key];\r\n\r\n      }\r\n\r\n    }\r\n\r\n    return keys[0];\r\n\r\n  },\r\n\r\n  getPrevKeyWith: function(sid, h, key) {\r\n\r\n    var keys = this.data.hierarchy[h].keys;\r\n    key = key >= 0 ? key : key + keys.length;\r\n\r\n    for (; key >= 0; key--) {\r\n\r\n      if (keys[key].hasTarget(sid)) {\r\n\r\n        return keys[key];\r\n\r\n      }\r\n\r\n    }\r\n\r\n    return keys[keys.length - 1];\r\n\r\n  }\r\n\r\n};\r\n\r\n// File:src/extras/animation/MorphAnimation.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com\r\n * @author willy-vvu / http://willy-vvu.github.io\r\n */\r\n\r\nTHREE.MorphAnimation = function(mesh) {\r\n\r\n  this.mesh = mesh;\r\n  this.frames = mesh.morphTargetInfluences.length;\r\n  this.currentTime = 0;\r\n  this.duration = 1000;\r\n  this.loop = true;\r\n  this.lastFrame = 0;\r\n  this.currentFrame = 0;\r\n\r\n  this.isPlaying = false;\r\n\r\n};\r\n\r\nTHREE.MorphAnimation.prototype = {\r\n\r\n  constructor: THREE.MorphAnimation,\r\n\r\n  play: function() {\r\n\r\n    this.isPlaying = true;\r\n\r\n  },\r\n\r\n  pause: function() {\r\n\r\n    this.isPlaying = false;\r\n\r\n  },\r\n\r\n  update: function(delta) {\r\n\r\n    if (this.isPlaying === false) return;\r\n\r\n    this.currentTime += delta;\r\n\r\n    if (this.loop === true && this.currentTime > this.duration) {\r\n\r\n      this.currentTime %= this.duration;\r\n\r\n    }\r\n\r\n    this.currentTime = Math.min(this.currentTime, this.duration);\r\n\r\n    var interpolation = this.duration / this.frames;\r\n    var frame = Math.floor(this.currentTime / interpolation);\r\n\r\n    var influences = this.mesh.morphTargetInfluences;\r\n\r\n    if (frame != this.currentFrame) {\r\n\r\n      influences[this.lastFrame] = 0;\r\n      influences[this.currentFrame] = 1;\r\n      influences[frame] = 0;\r\n\r\n      this.lastFrame = this.currentFrame;\r\n      this.currentFrame = frame;\r\n\r\n    }\r\n\r\n    influences[frame] = (this.currentTime % interpolation) / interpolation;\r\n    influences[this.lastFrame] = 1 - influences[frame];\r\n\r\n  }\r\n\r\n};\r\n\r\n// File:src/extras/geometries/BoxGeometry.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * based on http://papervision3d.googlecode.com/svn/trunk/as3/trunk/src/org/papervision3d/objects/primitives/Cube.as\r\n */\r\n\r\nTHREE.BoxGeometry = function(width, height, depth, widthSegments, heightSegments, depthSegments) {\r\n\r\n  THREE.Geometry.call(this);\r\n\r\n  this.type = 'BoxGeometry';\r\n\r\n  this.parameters = {\r\n    width: width,\r\n    height: height,\r\n    depth: depth,\r\n    widthSegments: widthSegments,\r\n    heightSegments: heightSegments,\r\n    depthSegments: depthSegments\r\n  };\r\n\r\n  this.widthSegments = widthSegments || 1;\r\n  this.heightSegments = heightSegments || 1;\r\n  this.depthSegments = depthSegments || 1;\r\n\r\n  var scope = this;\r\n\r\n  var width_half = width / 2;\r\n  var height_half = height / 2;\r\n  var depth_half = depth / 2;\r\n\r\n  buildPlane('z', 'y', -1, -1, depth, height, width_half, 0); // px\r\n  buildPlane('z', 'y', 1, -1, depth, height, -width_half, 1); // nx\r\n  buildPlane('x', 'z', 1, 1, width, depth, height_half, 2); // py\r\n  buildPlane('x', 'z', 1, -1, width, depth, -height_half, 3); // ny\r\n  buildPlane('x', 'y', 1, -1, width, height, depth_half, 4); // pz\r\n  buildPlane('x', 'y', -1, -1, width, height, -depth_half, 5); // nz\r\n\r\n  function buildPlane(u, v, udir, vdir, width, height, depth, materialIndex) {\r\n\r\n    var w, ix, iy,\r\n      gridX = scope.widthSegments,\r\n      gridY = scope.heightSegments,\r\n      width_half = width / 2,\r\n      height_half = height / 2,\r\n      offset = scope.vertices.length;\r\n\r\n    if ((u === 'x' && v === 'y') || (u === 'y' && v === 'x')) {\r\n\r\n      w = 'z';\r\n\r\n    }\r\n    else if ((u === 'x' && v === 'z') || (u === 'z' && v === 'x')) {\r\n\r\n      w = 'y';\r\n      gridY = scope.depthSegments;\r\n\r\n    }\r\n    else if ((u === 'z' && v === 'y') || (u === 'y' && v === 'z')) {\r\n\r\n      w = 'x';\r\n      gridX = scope.depthSegments;\r\n\r\n    }\r\n\r\n    var gridX1 = gridX + 1,\r\n      gridY1 = gridY + 1,\r\n      segment_width = width / gridX,\r\n      segment_height = height / gridY,\r\n      normal = new THREE.Vector3();\r\n\r\n    normal[w] = depth > 0 ? 1 : -1;\r\n\r\n    for (iy = 0; iy < gridY1; iy++) {\r\n\r\n      for (ix = 0; ix < gridX1; ix++) {\r\n\r\n        var vector = new THREE.Vector3();\r\n        vector[u] = (ix * segment_width - width_half) * udir;\r\n        vector[v] = (iy * segment_height - height_half) * vdir;\r\n        vector[w] = depth;\r\n\r\n        scope.vertices.push(vector);\r\n\r\n      }\r\n\r\n    }\r\n\r\n    for (iy = 0; iy < gridY; iy++) {\r\n\r\n      for (ix = 0; ix < gridX; ix++) {\r\n\r\n        var a = ix + gridX1 * iy;\r\n        var b = ix + gridX1 * (iy + 1);\r\n        var c = (ix + 1) + gridX1 * (iy + 1);\r\n        var d = (ix + 1) + gridX1 * iy;\r\n\r\n        var uva = new THREE.Vector2(ix / gridX, 1 - iy / gridY);\r\n        var uvb = new THREE.Vector2(ix / gridX, 1 - (iy + 1) / gridY);\r\n        var uvc = new THREE.Vector2((ix + 1) / gridX, 1 - (iy + 1) / gridY);\r\n        var uvd = new THREE.Vector2((ix + 1) / gridX, 1 - iy / gridY);\r\n\r\n        var face = new THREE.Face3(a + offset, b + offset, d + offset);\r\n        face.normal.copy(normal);\r\n        face.vertexNormals.push(normal.clone(), normal.clone(), normal.clone());\r\n        face.materialIndex = materialIndex;\r\n\r\n        scope.faces.push(face);\r\n        scope.faceVertexUvs[0].push([uva, uvb, uvd]);\r\n\r\n        face = new THREE.Face3(b + offset, c + offset, d + offset);\r\n        face.normal.copy(normal);\r\n        face.vertexNormals.push(normal.clone(), normal.clone(), normal.clone());\r\n        face.materialIndex = materialIndex;\r\n\r\n        scope.faces.push(face);\r\n        scope.faceVertexUvs[0].push([uvb.clone(), uvc, uvd.clone()]);\r\n\r\n      }\r\n\r\n    }\r\n\r\n  }\r\n\r\n  this.mergeVertices();\r\n\r\n};\r\n\r\nTHREE.BoxGeometry.prototype = Object.create(THREE.Geometry.prototype);\r\nTHREE.BoxGeometry.prototype.constructor = THREE.BoxGeometry;\r\n\r\n// File:src/extras/geometries/CircleGeometry.js\r\n\r\n/**\r\n * @author hughes\r\n */\r\n\r\nTHREE.CircleGeometry = function(radius, segments, thetaStart, thetaLength) {\r\n\r\n  THREE.Geometry.call(this);\r\n\r\n  this.type = 'CircleGeometry';\r\n\r\n  this.parameters = {\r\n    radius: radius,\r\n    segments: segments,\r\n    thetaStart: thetaStart,\r\n    thetaLength: thetaLength\r\n  };\r\n\r\n  radius = radius || 50;\r\n  segments = segments !== undefined ? Math.max(3, segments) : 8;\r\n\r\n  thetaStart = thetaStart !== undefined ? thetaStart : 0;\r\n  thetaLength = thetaLength !== undefined ? thetaLength : Math.PI * 2;\r\n\r\n  var i, uvs = [],\r\n    center = new THREE.Vector3(),\r\n    centerUV = new THREE.Vector2(0.5, 0.5);\r\n\r\n  this.vertices.push(center);\r\n  uvs.push(centerUV);\r\n\r\n  for (i = 0; i <= segments; i++) {\r\n\r\n    var vertex = new THREE.Vector3();\r\n    var segment = thetaStart + i / segments * thetaLength;\r\n\r\n    vertex.x = radius * Math.cos(segment);\r\n    vertex.y = radius * Math.sin(segment);\r\n\r\n    this.vertices.push(vertex);\r\n    uvs.push(new THREE.Vector2((vertex.x / radius + 1) / 2, (vertex.y / radius + 1) / 2));\r\n\r\n  }\r\n\r\n  var n = new THREE.Vector3(0, 0, 1);\r\n\r\n  for (i = 1; i <= segments; i++) {\r\n\r\n    this.faces.push(new THREE.Face3(i, i + 1, 0, [n.clone(), n.clone(), n.clone()]));\r\n    this.faceVertexUvs[0].push([uvs[i].clone(), uvs[i + 1].clone(), centerUV.clone()]);\r\n\r\n  }\r\n\r\n  this.computeFaceNormals();\r\n\r\n  this.boundingSphere = new THREE.Sphere(new THREE.Vector3(), radius);\r\n\r\n};\r\n\r\nTHREE.CircleGeometry.prototype = Object.create(THREE.Geometry.prototype);\r\nTHREE.CircleGeometry.prototype.constructor = THREE.CircleGeometry;\r\n\r\n// File:src/extras/geometries/CubeGeometry.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\n\r\nTHREE.CubeGeometry = function(width, height, depth, widthSegments, heightSegments, depthSegments) {\r\n\r\n  THREE.warn('THREE.CubeGeometry has been renamed to THREE.BoxGeometry.');\r\n  return new THREE.BoxGeometry(width, height, depth, widthSegments, heightSegments, depthSegments);\r\n\r\n};\r\n\r\n// File:src/extras/geometries/CylinderGeometry.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.CylinderGeometry = function(radiusTop, radiusBottom, height, radialSegments, heightSegments, openEnded, thetaStart, thetaLength) {\r\n\r\n  THREE.Geometry.call(this);\r\n\r\n  this.type = 'CylinderGeometry';\r\n\r\n  this.parameters = {\r\n    radiusTop: radiusTop,\r\n    radiusBottom: radiusBottom,\r\n    height: height,\r\n    radialSegments: radialSegments,\r\n    heightSegments: heightSegments,\r\n    openEnded: openEnded,\r\n    thetaStart: thetaStart,\r\n    thetaLength: thetaLength\r\n  };\r\n\r\n  radiusTop = radiusTop !== undefined ? radiusTop : 20;\r\n  radiusBottom = radiusBottom !== undefined ? radiusBottom : 20;\r\n  height = height !== undefined ? height : 100;\r\n\r\n  radialSegments = radialSegments || 8;\r\n  heightSegments = heightSegments || 1;\r\n\r\n  openEnded = openEnded !== undefined ? openEnded : false;\r\n  thetaStart = thetaStart !== undefined ? thetaStart : 0;\r\n  thetaLength = thetaLength !== undefined ? thetaLength : 2 * Math.PI;\r\n\r\n  var heightHalf = height / 2;\r\n\r\n  var x, y, vertices = [],\r\n    uvs = [];\r\n\r\n  for (y = 0; y <= heightSegments; y++) {\r\n\r\n    var verticesRow = [];\r\n    var uvsRow = [];\r\n\r\n    var v = y / heightSegments;\r\n    var radius = v * (radiusBottom - radiusTop) + radiusTop;\r\n\r\n    for (x = 0; x <= radialSegments; x++) {\r\n\r\n      var u = x / radialSegments;\r\n\r\n      var vertex = new THREE.Vector3();\r\n      vertex.x = radius * Math.sin(u * thetaLength + thetaStart);\r\n      vertex.y = -v * height + heightHalf;\r\n      vertex.z = radius * Math.cos(u * thetaLength + thetaStart);\r\n\r\n      this.vertices.push(vertex);\r\n\r\n      verticesRow.push(this.vertices.length - 1);\r\n      uvsRow.push(new THREE.Vector2(u, 1 - v));\r\n\r\n    }\r\n\r\n    vertices.push(verticesRow);\r\n    uvs.push(uvsRow);\r\n\r\n  }\r\n\r\n  var tanTheta = (radiusBottom - radiusTop) / height;\r\n  var na, nb;\r\n\r\n  for (x = 0; x < radialSegments; x++) {\r\n\r\n    if (radiusTop !== 0) {\r\n\r\n      na = this.vertices[vertices[0][x]].clone();\r\n      nb = this.vertices[vertices[0][x + 1]].clone();\r\n\r\n    }\r\n    else {\r\n\r\n      na = this.vertices[vertices[1][x]].clone();\r\n      nb = this.vertices[vertices[1][x + 1]].clone();\r\n\r\n    }\r\n\r\n    na.setY(Math.sqrt(na.x * na.x + na.z * na.z) * tanTheta).normalize();\r\n    nb.setY(Math.sqrt(nb.x * nb.x + nb.z * nb.z) * tanTheta).normalize();\r\n\r\n    for (y = 0; y < heightSegments; y++) {\r\n\r\n      var v1 = vertices[y][x];\r\n      var v2 = vertices[y + 1][x];\r\n      var v3 = vertices[y + 1][x + 1];\r\n      var v4 = vertices[y][x + 1];\r\n\r\n      var n1 = na.clone();\r\n      var n2 = na.clone();\r\n      var n3 = nb.clone();\r\n      var n4 = nb.clone();\r\n\r\n      var uv1 = uvs[y][x].clone();\r\n      var uv2 = uvs[y + 1][x].clone();\r\n      var uv3 = uvs[y + 1][x + 1].clone();\r\n      var uv4 = uvs[y][x + 1].clone();\r\n\r\n      this.faces.push(new THREE.Face3(v1, v2, v4, [n1, n2, n4]));\r\n      this.faceVertexUvs[0].push([uv1, uv2, uv4]);\r\n\r\n      this.faces.push(new THREE.Face3(v2, v3, v4, [n2.clone(), n3, n4.clone()]));\r\n      this.faceVertexUvs[0].push([uv2.clone(), uv3, uv4.clone()]);\r\n\r\n    }\r\n\r\n  }\r\n\r\n  // top cap\r\n\r\n  if (openEnded === false && radiusTop > 0) {\r\n\r\n    this.vertices.push(new THREE.Vector3(0, heightHalf, 0));\r\n\r\n    for (x = 0; x < radialSegments; x++) {\r\n\r\n      var v1 = vertices[0][x];\r\n      var v2 = vertices[0][x + 1];\r\n      var v3 = this.vertices.length - 1;\r\n\r\n      var n1 = new THREE.Vector3(0, 1, 0);\r\n      var n2 = new THREE.Vector3(0, 1, 0);\r\n      var n3 = new THREE.Vector3(0, 1, 0);\r\n\r\n      var uv1 = uvs[0][x].clone();\r\n      var uv2 = uvs[0][x + 1].clone();\r\n      var uv3 = new THREE.Vector2(uv2.x, 0);\r\n\r\n      this.faces.push(new THREE.Face3(v1, v2, v3, [n1, n2, n3]));\r\n      this.faceVertexUvs[0].push([uv1, uv2, uv3]);\r\n\r\n    }\r\n\r\n  }\r\n\r\n  // bottom cap\r\n\r\n  if (openEnded === false && radiusBottom > 0) {\r\n\r\n    this.vertices.push(new THREE.Vector3(0, -heightHalf, 0));\r\n\r\n    for (x = 0; x < radialSegments; x++) {\r\n\r\n      var v1 = vertices[heightSegments][x + 1];\r\n      var v2 = vertices[heightSegments][x];\r\n      var v3 = this.vertices.length - 1;\r\n\r\n      var n1 = new THREE.Vector3(0, -1, 0);\r\n      var n2 = new THREE.Vector3(0, -1, 0);\r\n      var n3 = new THREE.Vector3(0, -1, 0);\r\n\r\n      var uv1 = uvs[heightSegments][x + 1].clone();\r\n      var uv2 = uvs[heightSegments][x].clone();\r\n      var uv3 = new THREE.Vector2(uv2.x, 1);\r\n\r\n      this.faces.push(new THREE.Face3(v1, v2, v3, [n1, n2, n3]));\r\n      this.faceVertexUvs[0].push([uv1, uv2, uv3]);\r\n\r\n    }\r\n\r\n  }\r\n\r\n  this.computeFaceNormals();\r\n\r\n};\r\n\r\nTHREE.CylinderGeometry.prototype = Object.create(THREE.Geometry.prototype);\r\nTHREE.CylinderGeometry.prototype.constructor = THREE.CylinderGeometry;\r\n\r\n// File:src/extras/geometries/ExtrudeGeometry.js\r\n\r\n/**\r\n * @author zz85 / http://www.lab4games.net/zz85/blog\r\n *\r\n * Creates extruded geometry from a path shape.\r\n *\r\n * parameters = {\r\n *\r\n *  curveSegments: <int>, // number of points on the curves\r\n *  steps: <int>, // number of points for z-side extrusions / used for subdividing segements of extrude spline too\r\n *  amount: <int>, // Depth to extrude the shape\r\n *\r\n *  bevelEnabled: <bool>, // turn on bevel\r\n *  bevelThickness: <float>, // how deep into the original shape bevel goes\r\n *  bevelSize: <float>, // how far from shape outline is bevel\r\n *  bevelSegments: <int>, // number of bevel layers\r\n *\r\n *  extrudePath: <THREE.CurvePath> // 3d spline path to extrude shape along. (creates Frames if .frames aren't defined)\r\n *  frames: <THREE.TubeGeometry.FrenetFrames> // containing arrays of tangents, normals, binormals\r\n *\r\n *  material: <int> // material index for front and back faces\r\n *  extrudeMaterial: <int> // material index for extrusion and beveled faces\r\n *  uvGenerator: <Object> // object that provides UV generator functions\r\n *\r\n * }\r\n **/\r\n\r\nTHREE.ExtrudeGeometry = function(shapes, options) {\r\n\r\n  if (typeof(shapes) === \"undefined\") {\r\n    shapes = [];\r\n    return;\r\n  }\r\n\r\n  THREE.Geometry.call(this);\r\n\r\n  this.type = 'ExtrudeGeometry';\r\n\r\n  shapes = shapes instanceof Array ? shapes : [shapes];\r\n\r\n  this.addShapeList(shapes, options);\r\n\r\n  this.computeFaceNormals();\r\n\r\n  // can't really use automatic vertex normals\r\n  // as then front and back sides get smoothed too\r\n  // should do separate smoothing just for sides\r\n\r\n  //this.computeVertexNormals();\r\n\r\n  //console.log( \"took\", ( Date.now() - startTime ) );\r\n\r\n};\r\n\r\nTHREE.ExtrudeGeometry.prototype = Object.create(THREE.Geometry.prototype);\r\nTHREE.ExtrudeGeometry.prototype.constructor = THREE.ExtrudeGeometry;\r\n\r\nTHREE.ExtrudeGeometry.prototype.addShapeList = function(shapes, options) {\r\n  var sl = shapes.length;\r\n\r\n  for (var s = 0; s < sl; s++) {\r\n    var shape = shapes[s];\r\n    this.addShape(shape, options);\r\n  }\r\n};\r\n\r\nTHREE.ExtrudeGeometry.prototype.addShape = function(shape, options) {\r\n\r\n  var amount = options.amount !== undefined ? options.amount : 100;\r\n\r\n  var bevelThickness = options.bevelThickness !== undefined ? options.bevelThickness : 6; // 10\r\n  var bevelSize = options.bevelSize !== undefined ? options.bevelSize : bevelThickness - 2; // 8\r\n  var bevelSegments = options.bevelSegments !== undefined ? options.bevelSegments : 3;\r\n\r\n  var bevelEnabled = options.bevelEnabled !== undefined ? options.bevelEnabled : true; // false\r\n\r\n  var curveSegments = options.curveSegments !== undefined ? options.curveSegments : 12;\r\n\r\n  var steps = options.steps !== undefined ? options.steps : 1;\r\n\r\n  var extrudePath = options.extrudePath;\r\n  var extrudePts, extrudeByPath = false;\r\n\r\n  var material = options.material;\r\n  var extrudeMaterial = options.extrudeMaterial;\r\n\r\n  // Use default WorldUVGenerator if no UV generators are specified.\r\n  var uvgen = options.UVGenerator !== undefined ? options.UVGenerator : THREE.ExtrudeGeometry.WorldUVGenerator;\r\n\r\n  var splineTube, binormal, normal, position2;\r\n  if (extrudePath) {\r\n\r\n    extrudePts = extrudePath.getSpacedPoints(steps);\r\n\r\n    extrudeByPath = true;\r\n    bevelEnabled = false; // bevels not supported for path extrusion\r\n\r\n    // SETUP TNB variables\r\n\r\n    // Reuse TNB from TubeGeomtry for now.\r\n    // TODO1 - have a .isClosed in spline?\r\n\r\n    splineTube = options.frames !== undefined ? options.frames : new THREE.TubeGeometry.FrenetFrames(extrudePath, steps, false);\r\n\r\n    // console.log(splineTube, 'splineTube', splineTube.normals.length, 'steps', steps, 'extrudePts', extrudePts.length);\r\n\r\n    binormal = new THREE.Vector3();\r\n    normal = new THREE.Vector3();\r\n    position2 = new THREE.Vector3();\r\n\r\n  }\r\n\r\n  // Safeguards if bevels are not enabled\r\n\r\n  if (!bevelEnabled) {\r\n\r\n    bevelSegments = 0;\r\n    bevelThickness = 0;\r\n    bevelSize = 0;\r\n\r\n  }\r\n\r\n  // Variables initalization\r\n\r\n  var ahole, h, hl; // looping of holes\r\n  var scope = this;\r\n\r\n  var shapesOffset = this.vertices.length;\r\n\r\n  var shapePoints = shape.extractPoints(curveSegments);\r\n\r\n  var vertices = shapePoints.shape;\r\n  var holes = shapePoints.holes;\r\n\r\n  var reverse = !THREE.Shape.Utils.isClockWise(vertices);\r\n\r\n  if (reverse) {\r\n\r\n    vertices = vertices.reverse();\r\n\r\n    // Maybe we should also check if holes are in the opposite direction, just to be safe ...\r\n\r\n    for (h = 0, hl = holes.length; h < hl; h++) {\r\n\r\n      ahole = holes[h];\r\n\r\n      if (THREE.Shape.Utils.isClockWise(ahole)) {\r\n\r\n        holes[h] = ahole.reverse();\r\n\r\n      }\r\n\r\n    }\r\n\r\n    reverse = false; // If vertices are in order now, we shouldn't need to worry about them again (hopefully)!\r\n\r\n  }\r\n\r\n\r\n  var faces = THREE.Shape.Utils.triangulateShape(vertices, holes);\r\n\r\n  /* Vertices */\r\n\r\n  var contour = vertices; // vertices has all points but contour has only points of circumference\r\n\r\n  for (h = 0, hl = holes.length; h < hl; h++) {\r\n\r\n    ahole = holes[h];\r\n\r\n    vertices = vertices.concat(ahole);\r\n\r\n  }\r\n\r\n\r\n  function scalePt2(pt, vec, size) {\r\n\r\n    if (!vec) THREE.error(\"THREE.ExtrudeGeometry: vec does not exist\");\r\n\r\n    return vec.clone().multiplyScalar(size).add(pt);\r\n\r\n  }\r\n\r\n  var b, bs, t, z,\r\n    vert, vlen = vertices.length,\r\n    face, flen = faces.length;\r\n\r\n\r\n  // Find directions for point movement\r\n\r\n\r\n  function getBevelVec(inPt, inPrev, inNext) {\r\n\r\n    var EPSILON = 0.0000000001;\r\n\r\n    // computes for inPt the corresponding point inPt' on a new contour\r\n    //   shiftet by 1 unit (length of normalized vector) to the left\r\n    // if we walk along contour clockwise, this new contour is outside the old one\r\n    //\r\n    // inPt' is the intersection of the two lines parallel to the two\r\n    //  adjacent edges of inPt at a distance of 1 unit on the left side.\r\n\r\n    var v_trans_x, v_trans_y, shrink_by = 1; // resulting translation vector for inPt\r\n\r\n    // good reading for geometry algorithms (here: line-line intersection)\r\n    // http://geomalgorithms.com/a05-_intersect-1.html\r\n\r\n    var v_prev_x = inPt.x - inPrev.x,\r\n      v_prev_y = inPt.y - inPrev.y;\r\n    var v_next_x = inNext.x - inPt.x,\r\n      v_next_y = inNext.y - inPt.y;\r\n\r\n    var v_prev_lensq = (v_prev_x * v_prev_x + v_prev_y * v_prev_y);\r\n\r\n    // check for colinear edges\r\n    var colinear0 = (v_prev_x * v_next_y - v_prev_y * v_next_x);\r\n\r\n    if (Math.abs(colinear0) > EPSILON) { // not colinear\r\n\r\n      // length of vectors for normalizing\r\n\r\n      var v_prev_len = Math.sqrt(v_prev_lensq);\r\n      var v_next_len = Math.sqrt(v_next_x * v_next_x + v_next_y * v_next_y);\r\n\r\n      // shift adjacent points by unit vectors to the left\r\n\r\n      var ptPrevShift_x = (inPrev.x - v_prev_y / v_prev_len);\r\n      var ptPrevShift_y = (inPrev.y + v_prev_x / v_prev_len);\r\n\r\n      var ptNextShift_x = (inNext.x - v_next_y / v_next_len);\r\n      var ptNextShift_y = (inNext.y + v_next_x / v_next_len);\r\n\r\n      // scaling factor for v_prev to intersection point\r\n\r\n      var sf = ((ptNextShift_x - ptPrevShift_x) * v_next_y -\r\n          (ptNextShift_y - ptPrevShift_y) * v_next_x) /\r\n        (v_prev_x * v_next_y - v_prev_y * v_next_x);\r\n\r\n      // vector from inPt to intersection point\r\n\r\n      v_trans_x = (ptPrevShift_x + v_prev_x * sf - inPt.x);\r\n      v_trans_y = (ptPrevShift_y + v_prev_y * sf - inPt.y);\r\n\r\n      // Don't normalize!, otherwise sharp corners become ugly\r\n      //  but prevent crazy spikes\r\n      var v_trans_lensq = (v_trans_x * v_trans_x + v_trans_y * v_trans_y)\r\n      if (v_trans_lensq <= 2) {\r\n        return new THREE.Vector2(v_trans_x, v_trans_y);\r\n      }\r\n      else {\r\n        shrink_by = Math.sqrt(v_trans_lensq / 2);\r\n      }\r\n\r\n    }\r\n    else { // handle special case of colinear edges\r\n\r\n      var direction_eq = false; // assumes: opposite\r\n      if (v_prev_x > EPSILON) {\r\n        if (v_next_x > EPSILON) {\r\n          direction_eq = true;\r\n        }\r\n      }\r\n      else {\r\n        if (v_prev_x < -EPSILON) {\r\n          if (v_next_x < -EPSILON) {\r\n            direction_eq = true;\r\n          }\r\n        }\r\n        else {\r\n          if (Math.sign(v_prev_y) == Math.sign(v_next_y)) {\r\n            direction_eq = true;\r\n          }\r\n        }\r\n      }\r\n\r\n      if (direction_eq) {\r\n        // console.log(\"Warning: lines are a straight sequence\");\r\n        v_trans_x = -v_prev_y;\r\n        v_trans_y = v_prev_x;\r\n        shrink_by = Math.sqrt(v_prev_lensq);\r\n      }\r\n      else {\r\n        // console.log(\"Warning: lines are a straight spike\");\r\n        v_trans_x = v_prev_x;\r\n        v_trans_y = v_prev_y;\r\n        shrink_by = Math.sqrt(v_prev_lensq / 2);\r\n      }\r\n\r\n    }\r\n\r\n    return new THREE.Vector2(v_trans_x / shrink_by, v_trans_y / shrink_by);\r\n\r\n  }\r\n\r\n\r\n  var contourMovements = [];\r\n\r\n  for (var i = 0, il = contour.length, j = il - 1, k = i + 1; i < il; i++, j++, k++) {\r\n\r\n    if (j === il) j = 0;\r\n    if (k === il) k = 0;\r\n\r\n    //  (j)---(i)---(k)\r\n    // console.log('i,j,k', i, j , k)\r\n\r\n    contourMovements[i] = getBevelVec(contour[i], contour[j], contour[k]);\r\n\r\n  }\r\n\r\n  var holesMovements = [],\r\n    oneHoleMovements, verticesMovements = contourMovements.concat();\r\n\r\n  for (h = 0, hl = holes.length; h < hl; h++) {\r\n\r\n    ahole = holes[h];\r\n\r\n    oneHoleMovements = [];\r\n\r\n    for (i = 0, il = ahole.length, j = il - 1, k = i + 1; i < il; i++, j++, k++) {\r\n\r\n      if (j === il) j = 0;\r\n      if (k === il) k = 0;\r\n\r\n      //  (j)---(i)---(k)\r\n      oneHoleMovements[i] = getBevelVec(ahole[i], ahole[j], ahole[k]);\r\n\r\n    }\r\n\r\n    holesMovements.push(oneHoleMovements);\r\n    verticesMovements = verticesMovements.concat(oneHoleMovements);\r\n\r\n  }\r\n\r\n\r\n  // Loop bevelSegments, 1 for the front, 1 for the back\r\n\r\n  for (b = 0; b < bevelSegments; b++) {\r\n    //for ( b = bevelSegments; b > 0; b -- ) {\r\n\r\n    t = b / bevelSegments;\r\n    z = bevelThickness * (1 - t);\r\n\r\n    //z = bevelThickness * t;\r\n    bs = bevelSize * (Math.sin(t * Math.PI / 2)); // curved\r\n    //bs = bevelSize * t ; // linear\r\n\r\n    // contract shape\r\n\r\n    for (i = 0, il = contour.length; i < il; i++) {\r\n\r\n      vert = scalePt2(contour[i], contourMovements[i], bs);\r\n\r\n      v(vert.x, vert.y, -z);\r\n\r\n    }\r\n\r\n    // expand holes\r\n\r\n    for (h = 0, hl = holes.length; h < hl; h++) {\r\n\r\n      ahole = holes[h];\r\n      oneHoleMovements = holesMovements[h];\r\n\r\n      for (i = 0, il = ahole.length; i < il; i++) {\r\n\r\n        vert = scalePt2(ahole[i], oneHoleMovements[i], bs);\r\n\r\n        v(vert.x, vert.y, -z);\r\n\r\n      }\r\n\r\n    }\r\n\r\n  }\r\n\r\n  bs = bevelSize;\r\n\r\n  // Back facing vertices\r\n\r\n  for (i = 0; i < vlen; i++) {\r\n\r\n    vert = bevelEnabled ? scalePt2(vertices[i], verticesMovements[i], bs) : vertices[i];\r\n\r\n    if (!extrudeByPath) {\r\n\r\n      v(vert.x, vert.y, 0);\r\n\r\n    }\r\n    else {\r\n\r\n      // v( vert.x, vert.y + extrudePts[ 0 ].y, extrudePts[ 0 ].x );\r\n\r\n      normal.copy(splineTube.normals[0]).multiplyScalar(vert.x);\r\n      binormal.copy(splineTube.binormals[0]).multiplyScalar(vert.y);\r\n\r\n      position2.copy(extrudePts[0]).add(normal).add(binormal);\r\n\r\n      v(position2.x, position2.y, position2.z);\r\n\r\n    }\r\n\r\n  }\r\n\r\n  // Add stepped vertices...\r\n  // Including front facing vertices\r\n\r\n  var s;\r\n\r\n  for (s = 1; s <= steps; s++) {\r\n\r\n    for (i = 0; i < vlen; i++) {\r\n\r\n      vert = bevelEnabled ? scalePt2(vertices[i], verticesMovements[i], bs) : vertices[i];\r\n\r\n      if (!extrudeByPath) {\r\n\r\n        v(vert.x, vert.y, amount / steps * s);\r\n\r\n      }\r\n      else {\r\n\r\n        // v( vert.x, vert.y + extrudePts[ s - 1 ].y, extrudePts[ s - 1 ].x );\r\n\r\n        normal.copy(splineTube.normals[s]).multiplyScalar(vert.x);\r\n        binormal.copy(splineTube.binormals[s]).multiplyScalar(vert.y);\r\n\r\n        position2.copy(extrudePts[s]).add(normal).add(binormal);\r\n\r\n        v(position2.x, position2.y, position2.z);\r\n\r\n      }\r\n\r\n    }\r\n\r\n  }\r\n\r\n\r\n  // Add bevel segments planes\r\n\r\n  //for ( b = 1; b <= bevelSegments; b ++ ) {\r\n  for (b = bevelSegments - 1; b >= 0; b--) {\r\n\r\n    t = b / bevelSegments;\r\n    z = bevelThickness * (1 - t);\r\n    //bs = bevelSize * ( 1-Math.sin ( ( 1 - t ) * Math.PI/2 ) );\r\n    bs = bevelSize * Math.sin(t * Math.PI / 2);\r\n\r\n    // contract shape\r\n\r\n    for (i = 0, il = contour.length; i < il; i++) {\r\n\r\n      vert = scalePt2(contour[i], contourMovements[i], bs);\r\n      v(vert.x, vert.y, amount + z);\r\n\r\n    }\r\n\r\n    // expand holes\r\n\r\n    for (h = 0, hl = holes.length; h < hl; h++) {\r\n\r\n      ahole = holes[h];\r\n      oneHoleMovements = holesMovements[h];\r\n\r\n      for (i = 0, il = ahole.length; i < il; i++) {\r\n\r\n        vert = scalePt2(ahole[i], oneHoleMovements[i], bs);\r\n\r\n        if (!extrudeByPath) {\r\n\r\n          v(vert.x, vert.y, amount + z);\r\n\r\n        }\r\n        else {\r\n\r\n          v(vert.x, vert.y + extrudePts[steps - 1].y, extrudePts[steps - 1].x + z);\r\n\r\n        }\r\n\r\n      }\r\n\r\n    }\r\n\r\n  }\r\n\r\n  /* Faces */\r\n\r\n  // Top and bottom faces\r\n\r\n  buildLidFaces();\r\n\r\n  // Sides faces\r\n\r\n  buildSideFaces();\r\n\r\n\r\n  /////  Internal functions\r\n\r\n  function buildLidFaces() {\r\n\r\n    if (bevelEnabled) {\r\n\r\n      var layer = 0; // steps + 1\r\n      var offset = vlen * layer;\r\n\r\n      // Bottom faces\r\n\r\n      for (i = 0; i < flen; i++) {\r\n\r\n        face = faces[i];\r\n        f3(face[2] + offset, face[1] + offset, face[0] + offset);\r\n\r\n      }\r\n\r\n      layer = steps + bevelSegments * 2;\r\n      offset = vlen * layer;\r\n\r\n      // Top faces\r\n\r\n      for (i = 0; i < flen; i++) {\r\n\r\n        face = faces[i];\r\n        f3(face[0] + offset, face[1] + offset, face[2] + offset);\r\n\r\n      }\r\n\r\n    }\r\n    else {\r\n\r\n      // Bottom faces\r\n\r\n      for (i = 0; i < flen; i++) {\r\n\r\n        face = faces[i];\r\n        f3(face[2], face[1], face[0]);\r\n\r\n      }\r\n\r\n      // Top faces\r\n\r\n      for (i = 0; i < flen; i++) {\r\n\r\n        face = faces[i];\r\n        f3(face[0] + vlen * steps, face[1] + vlen * steps, face[2] + vlen * steps);\r\n\r\n      }\r\n    }\r\n\r\n  }\r\n\r\n  // Create faces for the z-sides of the shape\r\n\r\n  function buildSideFaces() {\r\n\r\n    var layeroffset = 0;\r\n    sidewalls(contour, layeroffset);\r\n    layeroffset += contour.length;\r\n\r\n    for (h = 0, hl = holes.length; h < hl; h++) {\r\n\r\n      ahole = holes[h];\r\n      sidewalls(ahole, layeroffset);\r\n\r\n      //, true\r\n      layeroffset += ahole.length;\r\n\r\n    }\r\n\r\n  }\r\n\r\n  function sidewalls(contour, layeroffset) {\r\n\r\n    var j, k;\r\n    i = contour.length;\r\n\r\n    while (--i >= 0) {\r\n\r\n      j = i;\r\n      k = i - 1;\r\n      if (k < 0) k = contour.length - 1;\r\n\r\n      //console.log('b', i,j, i-1, k,vertices.length);\r\n\r\n      var s = 0,\r\n        sl = steps + bevelSegments * 2;\r\n\r\n      for (s = 0; s < sl; s++) {\r\n\r\n        var slen1 = vlen * s;\r\n        var slen2 = vlen * (s + 1);\r\n\r\n        var a = layeroffset + j + slen1,\r\n          b = layeroffset + k + slen1,\r\n          c = layeroffset + k + slen2,\r\n          d = layeroffset + j + slen2;\r\n\r\n        f4(a, b, c, d, contour, s, sl, j, k);\r\n\r\n      }\r\n    }\r\n\r\n  }\r\n\r\n\r\n  function v(x, y, z) {\r\n\r\n    scope.vertices.push(new THREE.Vector3(x, y, z));\r\n\r\n  }\r\n\r\n  function f3(a, b, c) {\r\n\r\n    a += shapesOffset;\r\n    b += shapesOffset;\r\n    c += shapesOffset;\r\n\r\n    // normal, color, material\r\n    scope.faces.push(new THREE.Face3(a, b, c, null, null, material));\r\n\r\n    var uvs = uvgen.generateTopUV(scope, a, b, c);\r\n\r\n    scope.faceVertexUvs[0].push(uvs);\r\n\r\n  }\r\n\r\n  function f4(a, b, c, d, wallContour, stepIndex, stepsLength, contourIndex1, contourIndex2) {\r\n\r\n    a += shapesOffset;\r\n    b += shapesOffset;\r\n    c += shapesOffset;\r\n    d += shapesOffset;\r\n\r\n    scope.faces.push(new THREE.Face3(a, b, d, null, null, extrudeMaterial));\r\n    scope.faces.push(new THREE.Face3(b, c, d, null, null, extrudeMaterial));\r\n\r\n    var uvs = uvgen.generateSideWallUV(scope, a, b, c, d);\r\n\r\n    scope.faceVertexUvs[0].push([uvs[0], uvs[1], uvs[3]]);\r\n    scope.faceVertexUvs[0].push([uvs[1], uvs[2], uvs[3]]);\r\n\r\n  }\r\n\r\n};\r\n\r\nTHREE.ExtrudeGeometry.WorldUVGenerator = {\r\n\r\n  generateTopUV: function(geometry, indexA, indexB, indexC) {\r\n\r\n    var vertices = geometry.vertices;\r\n\r\n    var a = vertices[indexA];\r\n    var b = vertices[indexB];\r\n    var c = vertices[indexC];\r\n\r\n    return [\r\n      new THREE.Vector2(a.x, a.y),\r\n      new THREE.Vector2(b.x, b.y),\r\n      new THREE.Vector2(c.x, c.y)\r\n    ];\r\n\r\n  },\r\n\r\n  generateSideWallUV: function(geometry, indexA, indexB, indexC, indexD) {\r\n\r\n    var vertices = geometry.vertices;\r\n\r\n    var a = vertices[indexA];\r\n    var b = vertices[indexB];\r\n    var c = vertices[indexC];\r\n    var d = vertices[indexD];\r\n\r\n    if (Math.abs(a.y - b.y) < 0.01) {\r\n      return [\r\n        new THREE.Vector2(a.x, 1 - a.z),\r\n        new THREE.Vector2(b.x, 1 - b.z),\r\n        new THREE.Vector2(c.x, 1 - c.z),\r\n        new THREE.Vector2(d.x, 1 - d.z)\r\n      ];\r\n    }\r\n    else {\r\n      return [\r\n        new THREE.Vector2(a.y, 1 - a.z),\r\n        new THREE.Vector2(b.y, 1 - b.z),\r\n        new THREE.Vector2(c.y, 1 - c.z),\r\n        new THREE.Vector2(d.y, 1 - d.z)\r\n      ];\r\n    }\r\n  }\r\n};\r\n\r\n// File:src/extras/geometries/ShapeGeometry.js\r\n\r\n/**\r\n * @author jonobr1 / http://jonobr1.com\r\n *\r\n * Creates a one-sided polygonal geometry from a path shape. Similar to\r\n * ExtrudeGeometry.\r\n *\r\n * parameters = {\r\n *\r\n *\tcurveSegments: <int>, // number of points on the curves. NOT USED AT THE MOMENT.\r\n *\r\n *\tmaterial: <int> // material index for front and back faces\r\n *\tuvGenerator: <Object> // object that provides UV generator functions\r\n *\r\n * }\r\n **/\r\n\r\nTHREE.ShapeGeometry = function(shapes, options) {\r\n\r\n  THREE.Geometry.call(this);\r\n\r\n  this.type = 'ShapeGeometry';\r\n\r\n  if (shapes instanceof Array === false) shapes = [shapes];\r\n\r\n  this.addShapeList(shapes, options);\r\n\r\n  this.computeFaceNormals();\r\n\r\n};\r\n\r\nTHREE.ShapeGeometry.prototype = Object.create(THREE.Geometry.prototype);\r\nTHREE.ShapeGeometry.prototype.constructor = THREE.ShapeGeometry;\r\n\r\n/**\r\n * Add an array of shapes to THREE.ShapeGeometry.\r\n */\r\nTHREE.ShapeGeometry.prototype.addShapeList = function(shapes, options) {\r\n\r\n  for (var i = 0, l = shapes.length; i < l; i++) {\r\n\r\n    this.addShape(shapes[i], options);\r\n\r\n  }\r\n\r\n  return this;\r\n\r\n};\r\n\r\n/**\r\n * Adds a shape to THREE.ShapeGeometry, based on THREE.ExtrudeGeometry.\r\n */\r\nTHREE.ShapeGeometry.prototype.addShape = function(shape, options) {\r\n\r\n  if (options === undefined) options = {};\r\n  var curveSegments = options.curveSegments !== undefined ? options.curveSegments : 12;\r\n\r\n  var material = options.material;\r\n  var uvgen = options.UVGenerator === undefined ? THREE.ExtrudeGeometry.WorldUVGenerator : options.UVGenerator;\r\n\r\n  //\r\n\r\n  var i, l, hole;\r\n\r\n  var shapesOffset = this.vertices.length;\r\n  var shapePoints = shape.extractPoints(curveSegments);\r\n\r\n  var vertices = shapePoints.shape;\r\n  var holes = shapePoints.holes;\r\n\r\n  var reverse = !THREE.Shape.Utils.isClockWise(vertices);\r\n\r\n  if (reverse) {\r\n\r\n    vertices = vertices.reverse();\r\n\r\n    // Maybe we should also check if holes are in the opposite direction, just to be safe...\r\n\r\n    for (i = 0, l = holes.length; i < l; i++) {\r\n\r\n      hole = holes[i];\r\n\r\n      if (THREE.Shape.Utils.isClockWise(hole)) {\r\n\r\n        holes[i] = hole.reverse();\r\n\r\n      }\r\n\r\n    }\r\n\r\n    reverse = false;\r\n\r\n  }\r\n\r\n  var faces = THREE.Shape.Utils.triangulateShape(vertices, holes);\r\n\r\n  // Vertices\r\n\r\n  var contour = vertices;\r\n\r\n  for (i = 0, l = holes.length; i < l; i++) {\r\n\r\n    hole = holes[i];\r\n    vertices = vertices.concat(hole);\r\n\r\n  }\r\n\r\n  //\r\n\r\n  var vert, vlen = vertices.length;\r\n  var face, flen = faces.length;\r\n\r\n  for (i = 0; i < vlen; i++) {\r\n\r\n    vert = vertices[i];\r\n\r\n    this.vertices.push(new THREE.Vector3(vert.x, vert.y, 0));\r\n\r\n  }\r\n\r\n  for (i = 0; i < flen; i++) {\r\n\r\n    face = faces[i];\r\n\r\n    var a = face[0] + shapesOffset;\r\n    var b = face[1] + shapesOffset;\r\n    var c = face[2] + shapesOffset;\r\n\r\n    this.faces.push(new THREE.Face3(a, b, c, null, null, material));\r\n    this.faceVertexUvs[0].push(uvgen.generateTopUV(this, a, b, c));\r\n\r\n  }\r\n\r\n};\r\n\r\n// File:src/extras/geometries/LatheGeometry.js\r\n\r\n/**\r\n * @author astrodud / http://astrodud.isgreat.org/\r\n * @author zz85 / https://github.com/zz85\r\n * @author bhouston / http://exocortex.com\r\n */\r\n\r\n// points - to create a closed torus, one must use a set of points \r\n//    like so: [ a, b, c, d, a ], see first is the same as last.\r\n// segments - the number of circumference segments to create\r\n// phiStart - the starting radian\r\n// phiLength - the radian (0 to 2*PI) range of the lathed section\r\n//    2*pi is a closed lathe, less than 2PI is a portion.\r\n\r\nTHREE.LatheGeometry = function(points, segments, phiStart, phiLength) {\r\n\r\n  THREE.Geometry.call(this);\r\n\r\n  this.type = 'LatheGeometry';\r\n\r\n  this.parameters = {\r\n    points: points,\r\n    segments: segments,\r\n    phiStart: phiStart,\r\n    phiLength: phiLength\r\n  };\r\n\r\n  segments = segments || 12;\r\n  phiStart = phiStart || 0;\r\n  phiLength = phiLength || 2 * Math.PI;\r\n\r\n  var inversePointLength = 1.0 / (points.length - 1);\r\n  var inverseSegments = 1.0 / segments;\r\n\r\n  for (var i = 0, il = segments; i <= il; i++) {\r\n\r\n    var phi = phiStart + i * inverseSegments * phiLength;\r\n\r\n    var c = Math.cos(phi),\r\n      s = Math.sin(phi);\r\n\r\n    for (var j = 0, jl = points.length; j < jl; j++) {\r\n\r\n      var pt = points[j];\r\n\r\n      var vertex = new THREE.Vector3();\r\n\r\n      vertex.x = c * pt.x - s * pt.y;\r\n      vertex.y = s * pt.x + c * pt.y;\r\n      vertex.z = pt.z;\r\n\r\n      this.vertices.push(vertex);\r\n\r\n    }\r\n\r\n  }\r\n\r\n  var np = points.length;\r\n\r\n  for (var i = 0, il = segments; i < il; i++) {\r\n\r\n    for (var j = 0, jl = points.length - 1; j < jl; j++) {\r\n\r\n      var base = j + np * i;\r\n      var a = base;\r\n      var b = base + np;\r\n      var c = base + 1 + np;\r\n      var d = base + 1;\r\n\r\n      var u0 = i * inverseSegments;\r\n      var v0 = j * inversePointLength;\r\n      var u1 = u0 + inverseSegments;\r\n      var v1 = v0 + inversePointLength;\r\n\r\n      this.faces.push(new THREE.Face3(a, b, d));\r\n\r\n      this.faceVertexUvs[0].push([\r\n\r\n        new THREE.Vector2(u0, v0),\r\n        new THREE.Vector2(u1, v0),\r\n        new THREE.Vector2(u0, v1)\r\n\r\n      ]);\r\n\r\n      this.faces.push(new THREE.Face3(b, c, d));\r\n\r\n      this.faceVertexUvs[0].push([\r\n\r\n        new THREE.Vector2(u1, v0),\r\n        new THREE.Vector2(u1, v1),\r\n        new THREE.Vector2(u0, v1)\r\n\r\n      ]);\r\n\r\n\r\n    }\r\n\r\n  }\r\n\r\n  this.mergeVertices();\r\n  this.computeFaceNormals();\r\n  this.computeVertexNormals();\r\n\r\n};\r\n\r\nTHREE.LatheGeometry.prototype = Object.create(THREE.Geometry.prototype);\r\nTHREE.LatheGeometry.prototype.constructor = THREE.LatheGeometry;\r\n\r\n// File:src/extras/geometries/PlaneGeometry.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * based on http://papervision3d.googlecode.com/svn/trunk/as3/trunk/src/org/papervision3d/objects/primitives/Plane.as\r\n */\r\n\r\nTHREE.PlaneGeometry = function(width, height, widthSegments, heightSegments) {\r\n\r\n  console.info('THREE.PlaneGeometry: Consider using THREE.PlaneBufferGeometry for lower memory footprint.');\r\n\r\n  THREE.Geometry.call(this);\r\n\r\n  this.type = 'PlaneGeometry';\r\n\r\n  this.parameters = {\r\n    width: width,\r\n    height: height,\r\n    widthSegments: widthSegments,\r\n    heightSegments: heightSegments\r\n  };\r\n\r\n  this.fromBufferGeometry(new THREE.PlaneBufferGeometry(width, height, widthSegments, heightSegments));\r\n\r\n};\r\n\r\nTHREE.PlaneGeometry.prototype = Object.create(THREE.Geometry.prototype);\r\nTHREE.PlaneGeometry.prototype.constructor = THREE.PlaneGeometry;\r\n\r\n// File:src/extras/geometries/PlaneBufferGeometry.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * based on http://papervision3d.googlecode.com/svn/trunk/as3/trunk/src/org/papervision3d/objects/primitives/Plane.as\r\n */\r\n\r\nTHREE.PlaneBufferGeometry = function(width, height, widthSegments, heightSegments) {\r\n\r\n  THREE.BufferGeometry.call(this);\r\n\r\n  this.type = 'PlaneBufferGeometry';\r\n\r\n  this.parameters = {\r\n    width: width,\r\n    height: height,\r\n    widthSegments: widthSegments,\r\n    heightSegments: heightSegments\r\n  };\r\n\r\n  var width_half = width / 2;\r\n  var height_half = height / 2;\r\n\r\n  var gridX = widthSegments || 1;\r\n  var gridY = heightSegments || 1;\r\n\r\n  var gridX1 = gridX + 1;\r\n  var gridY1 = gridY + 1;\r\n\r\n  var segment_width = width / gridX;\r\n  var segment_height = height / gridY;\r\n\r\n  var vertices = new Float32Array(gridX1 * gridY1 * 3);\r\n  var normals = new Float32Array(gridX1 * gridY1 * 3);\r\n  var uvs = new Float32Array(gridX1 * gridY1 * 2);\r\n\r\n  var offset = 0;\r\n  var offset2 = 0;\r\n\r\n  for (var iy = 0; iy < gridY1; iy++) {\r\n\r\n    var y = iy * segment_height - height_half;\r\n\r\n    for (var ix = 0; ix < gridX1; ix++) {\r\n\r\n      var x = ix * segment_width - width_half;\r\n\r\n      vertices[offset] = x;\r\n      vertices[offset + 1] = -y;\r\n\r\n      normals[offset + 2] = 1;\r\n\r\n      uvs[offset2] = ix / gridX;\r\n      uvs[offset2 + 1] = 1 - (iy / gridY);\r\n\r\n      offset += 3;\r\n      offset2 += 2;\r\n\r\n    }\r\n\r\n  }\r\n\r\n  offset = 0;\r\n\r\n  var indices = new((vertices.length / 3) > 65535 ? Uint32Array : Uint16Array)(gridX * gridY * 6);\r\n\r\n  for (var iy = 0; iy < gridY; iy++) {\r\n\r\n    for (var ix = 0; ix < gridX; ix++) {\r\n\r\n      var a = ix + gridX1 * iy;\r\n      var b = ix + gridX1 * (iy + 1);\r\n      var c = (ix + 1) + gridX1 * (iy + 1);\r\n      var d = (ix + 1) + gridX1 * iy;\r\n\r\n      indices[offset] = a;\r\n      indices[offset + 1] = b;\r\n      indices[offset + 2] = d;\r\n\r\n      indices[offset + 3] = b;\r\n      indices[offset + 4] = c;\r\n      indices[offset + 5] = d;\r\n\r\n      offset += 6;\r\n\r\n    }\r\n\r\n  }\r\n\r\n  this.addAttribute('index', new THREE.BufferAttribute(indices, 1));\r\n  this.addAttribute('position', new THREE.BufferAttribute(vertices, 3));\r\n  this.addAttribute('normal', new THREE.BufferAttribute(normals, 3));\r\n  this.addAttribute('uv', new THREE.BufferAttribute(uvs, 2));\r\n\r\n};\r\n\r\nTHREE.PlaneBufferGeometry.prototype = Object.create(THREE.BufferGeometry.prototype);\r\nTHREE.PlaneBufferGeometry.prototype.constructor = THREE.PlaneBufferGeometry;\r\n\r\n// File:src/extras/geometries/RingGeometry.js\r\n\r\n/**\r\n * @author Kaleb Murphy\r\n */\r\n\r\nTHREE.RingGeometry = function(innerRadius, outerRadius, thetaSegments, phiSegments, thetaStart, thetaLength) {\r\n\r\n  THREE.Geometry.call(this);\r\n\r\n  this.type = 'RingGeometry';\r\n\r\n  this.parameters = {\r\n    innerRadius: innerRadius,\r\n    outerRadius: outerRadius,\r\n    thetaSegments: thetaSegments,\r\n    phiSegments: phiSegments,\r\n    thetaStart: thetaStart,\r\n    thetaLength: thetaLength\r\n  };\r\n\r\n  innerRadius = innerRadius || 0;\r\n  outerRadius = outerRadius || 50;\r\n\r\n  thetaStart = thetaStart !== undefined ? thetaStart : 0;\r\n  thetaLength = thetaLength !== undefined ? thetaLength : Math.PI * 2;\r\n\r\n  thetaSegments = thetaSegments !== undefined ? Math.max(3, thetaSegments) : 8;\r\n  phiSegments = phiSegments !== undefined ? Math.max(1, phiSegments) : 8;\r\n\r\n  var i, o, uvs = [],\r\n    radius = innerRadius,\r\n    radiusStep = ((outerRadius - innerRadius) / phiSegments);\r\n\r\n  for (i = 0; i < phiSegments + 1; i++) { // concentric circles inside ring\r\n\r\n    for (o = 0; o < thetaSegments + 1; o++) { // number of segments per circle\r\n\r\n      var vertex = new THREE.Vector3();\r\n      var segment = thetaStart + o / thetaSegments * thetaLength;\r\n      vertex.x = radius * Math.cos(segment);\r\n      vertex.y = radius * Math.sin(segment);\r\n\r\n      this.vertices.push(vertex);\r\n      uvs.push(new THREE.Vector2((vertex.x / outerRadius + 1) / 2, (vertex.y / outerRadius + 1) / 2));\r\n    }\r\n\r\n    radius += radiusStep;\r\n\r\n  }\r\n\r\n  var n = new THREE.Vector3(0, 0, 1);\r\n\r\n  for (i = 0; i < phiSegments; i++) { // concentric circles inside ring\r\n\r\n    var thetaSegment = i * (thetaSegments + 1);\r\n\r\n    for (o = 0; o < thetaSegments; o++) { // number of segments per circle\r\n\r\n      var segment = o + thetaSegment;\r\n\r\n      var v1 = segment;\r\n      var v2 = segment + thetaSegments + 1;\r\n      var v3 = segment + thetaSegments + 2;\r\n\r\n      this.faces.push(new THREE.Face3(v1, v2, v3, [n.clone(), n.clone(), n.clone()]));\r\n      this.faceVertexUvs[0].push([uvs[v1].clone(), uvs[v2].clone(), uvs[v3].clone()]);\r\n\r\n      v1 = segment;\r\n      v2 = segment + thetaSegments + 2;\r\n      v3 = segment + 1;\r\n\r\n      this.faces.push(new THREE.Face3(v1, v2, v3, [n.clone(), n.clone(), n.clone()]));\r\n      this.faceVertexUvs[0].push([uvs[v1].clone(), uvs[v2].clone(), uvs[v3].clone()]);\r\n\r\n    }\r\n  }\r\n\r\n  this.computeFaceNormals();\r\n\r\n  this.boundingSphere = new THREE.Sphere(new THREE.Vector3(), radius);\r\n\r\n};\r\n\r\nTHREE.RingGeometry.prototype = Object.create(THREE.Geometry.prototype);\r\nTHREE.RingGeometry.prototype.constructor = THREE.RingGeometry;\r\n\r\n\r\n// File:src/extras/geometries/SphereGeometry.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.SphereGeometry = function(radius, widthSegments, heightSegments, phiStart, phiLength, thetaStart, thetaLength) {\r\n\r\n  THREE.Geometry.call(this);\r\n\r\n  this.type = 'SphereGeometry';\r\n\r\n  this.parameters = {\r\n    radius: radius,\r\n    widthSegments: widthSegments,\r\n    heightSegments: heightSegments,\r\n    phiStart: phiStart,\r\n    phiLength: phiLength,\r\n    thetaStart: thetaStart,\r\n    thetaLength: thetaLength\r\n  };\r\n\r\n  radius = radius || 50;\r\n\r\n  widthSegments = Math.max(3, Math.floor(widthSegments) || 8);\r\n  heightSegments = Math.max(2, Math.floor(heightSegments) || 6);\r\n\r\n  phiStart = phiStart !== undefined ? phiStart : 0;\r\n  phiLength = phiLength !== undefined ? phiLength : Math.PI * 2;\r\n\r\n  thetaStart = thetaStart !== undefined ? thetaStart : 0;\r\n  thetaLength = thetaLength !== undefined ? thetaLength : Math.PI;\r\n\r\n  var x, y, vertices = [],\r\n    uvs = [];\r\n\r\n  for (y = 0; y <= heightSegments; y++) {\r\n\r\n    var verticesRow = [];\r\n    var uvsRow = [];\r\n\r\n    for (x = 0; x <= widthSegments; x++) {\r\n\r\n      var u = x / widthSegments;\r\n      var v = y / heightSegments;\r\n\r\n      var vertex = new THREE.Vector3();\r\n      vertex.x = -radius * Math.cos(phiStart + u * phiLength) * Math.sin(thetaStart + v * thetaLength);\r\n      vertex.y = radius * Math.cos(thetaStart + v * thetaLength);\r\n      vertex.z = radius * Math.sin(phiStart + u * phiLength) * Math.sin(thetaStart + v * thetaLength);\r\n\r\n      this.vertices.push(vertex);\r\n\r\n      verticesRow.push(this.vertices.length - 1);\r\n      uvsRow.push(new THREE.Vector2(u, 1 - v));\r\n\r\n    }\r\n\r\n    vertices.push(verticesRow);\r\n    uvs.push(uvsRow);\r\n\r\n  }\r\n\r\n  for (y = 0; y < heightSegments; y++) {\r\n\r\n    for (x = 0; x < widthSegments; x++) {\r\n\r\n      var v1 = vertices[y][x + 1];\r\n      var v2 = vertices[y][x];\r\n      var v3 = vertices[y + 1][x];\r\n      var v4 = vertices[y + 1][x + 1];\r\n\r\n      var n1 = this.vertices[v1].clone().normalize();\r\n      var n2 = this.vertices[v2].clone().normalize();\r\n      var n3 = this.vertices[v3].clone().normalize();\r\n      var n4 = this.vertices[v4].clone().normalize();\r\n\r\n      var uv1 = uvs[y][x + 1].clone();\r\n      var uv2 = uvs[y][x].clone();\r\n      var uv3 = uvs[y + 1][x].clone();\r\n      var uv4 = uvs[y + 1][x + 1].clone();\r\n\r\n      if (Math.abs(this.vertices[v1].y) === radius) {\r\n\r\n        uv1.x = (uv1.x + uv2.x) / 2;\r\n        this.faces.push(new THREE.Face3(v1, v3, v4, [n1, n3, n4]));\r\n        this.faceVertexUvs[0].push([uv1, uv3, uv4]);\r\n\r\n      }\r\n      else if (Math.abs(this.vertices[v3].y) === radius) {\r\n\r\n        uv3.x = (uv3.x + uv4.x) / 2;\r\n        this.faces.push(new THREE.Face3(v1, v2, v3, [n1, n2, n3]));\r\n        this.faceVertexUvs[0].push([uv1, uv2, uv3]);\r\n\r\n      }\r\n      else {\r\n\r\n        this.faces.push(new THREE.Face3(v1, v2, v4, [n1, n2, n4]));\r\n        this.faceVertexUvs[0].push([uv1, uv2, uv4]);\r\n\r\n        this.faces.push(new THREE.Face3(v2, v3, v4, [n2.clone(), n3, n4.clone()]));\r\n        this.faceVertexUvs[0].push([uv2.clone(), uv3, uv4.clone()]);\r\n\r\n      }\r\n\r\n    }\r\n\r\n  }\r\n\r\n  this.computeFaceNormals();\r\n\r\n  this.boundingSphere = new THREE.Sphere(new THREE.Vector3(), radius);\r\n\r\n};\r\n\r\nTHREE.SphereGeometry.prototype = Object.create(THREE.Geometry.prototype);\r\nTHREE.SphereGeometry.prototype.constructor = THREE.SphereGeometry;\r\n\r\n// File:src/extras/geometries/TextGeometry.js\r\n\r\n/**\r\n * @author zz85 / http://www.lab4games.net/zz85/blog\r\n * @author alteredq / http://alteredqualia.com/\r\n *\r\n * For creating 3D text geometry in three.js\r\n *\r\n * Text = 3D Text\r\n *\r\n * parameters = {\r\n *  size: \t\t\t<float>, \t// size of the text\r\n *  height: \t\t<float>, \t// thickness to extrude text\r\n *  curveSegments: \t<int>,\t\t// number of points on the curves\r\n *\r\n *  font: \t\t\t<string>,\t\t// font name\r\n *  weight: \t\t<string>,\t\t// font weight (normal, bold)\r\n *  style: \t\t\t<string>,\t\t// font style  (normal, italics)\r\n *\r\n *  bevelEnabled:\t<bool>,\t\t\t// turn on bevel\r\n *  bevelThickness: <float>, \t\t// how deep into text bevel goes\r\n *  bevelSize:\t\t<float>, \t\t// how far from text outline is bevel\r\n *  }\r\n *\r\n */\r\n\r\n/*\tUsage Examples\r\n\r\n\t// TextGeometry wrapper\r\n\r\n\tvar text3d = new TextGeometry( text, options );\r\n\r\n\t// Complete manner\r\n\r\n\tvar textShapes = THREE.FontUtils.generateShapes( text, options );\r\n\tvar text3d = new ExtrudeGeometry( textShapes, options );\r\n\r\n*/\r\n\r\n\r\nTHREE.TextGeometry = function(text, parameters) {\r\n\r\n  parameters = parameters || {};\r\n\r\n  var textShapes = THREE.FontUtils.generateShapes(text, parameters);\r\n\r\n  // translate parameters to ExtrudeGeometry API\r\n\r\n  parameters.amount = parameters.height !== undefined ? parameters.height : 50;\r\n\r\n  // defaults\r\n\r\n  if (parameters.bevelThickness === undefined) parameters.bevelThickness = 10;\r\n  if (parameters.bevelSize === undefined) parameters.bevelSize = 8;\r\n  if (parameters.bevelEnabled === undefined) parameters.bevelEnabled = false;\r\n\r\n  THREE.ExtrudeGeometry.call(this, textShapes, parameters);\r\n\r\n  this.type = 'TextGeometry';\r\n\r\n};\r\n\r\nTHREE.TextGeometry.prototype = Object.create(THREE.ExtrudeGeometry.prototype);\r\nTHREE.TextGeometry.prototype.constructor = THREE.TextGeometry;\r\n\r\n// File:src/extras/geometries/TorusGeometry.js\r\n\r\n/**\r\n * @author oosmoxiecode\r\n * @author mrdoob / http://mrdoob.com/\r\n * based on http://code.google.com/p/away3d/source/browse/trunk/fp10/Away3DLite/src/away3dlite/primitives/Torus.as?r=2888\r\n */\r\n\r\nTHREE.TorusGeometry = function(radius, tube, radialSegments, tubularSegments, arc) {\r\n\r\n  THREE.Geometry.call(this);\r\n\r\n  this.type = 'TorusGeometry';\r\n\r\n  this.parameters = {\r\n    radius: radius,\r\n    tube: tube,\r\n    radialSegments: radialSegments,\r\n    tubularSegments: tubularSegments,\r\n    arc: arc\r\n  };\r\n\r\n  radius = radius || 100;\r\n  tube = tube || 40;\r\n  radialSegments = radialSegments || 8;\r\n  tubularSegments = tubularSegments || 6;\r\n  arc = arc || Math.PI * 2;\r\n\r\n  var center = new THREE.Vector3(),\r\n    uvs = [],\r\n    normals = [];\r\n\r\n  for (var j = 0; j <= radialSegments; j++) {\r\n\r\n    for (var i = 0; i <= tubularSegments; i++) {\r\n\r\n      var u = i / tubularSegments * arc;\r\n      var v = j / radialSegments * Math.PI * 2;\r\n\r\n      center.x = radius * Math.cos(u);\r\n      center.y = radius * Math.sin(u);\r\n\r\n      var vertex = new THREE.Vector3();\r\n      vertex.x = (radius + tube * Math.cos(v)) * Math.cos(u);\r\n      vertex.y = (radius + tube * Math.cos(v)) * Math.sin(u);\r\n      vertex.z = tube * Math.sin(v);\r\n\r\n      this.vertices.push(vertex);\r\n\r\n      uvs.push(new THREE.Vector2(i / tubularSegments, j / radialSegments));\r\n      normals.push(vertex.clone().sub(center).normalize());\r\n\r\n    }\r\n\r\n  }\r\n\r\n  for (var j = 1; j <= radialSegments; j++) {\r\n\r\n    for (var i = 1; i <= tubularSegments; i++) {\r\n\r\n      var a = (tubularSegments + 1) * j + i - 1;\r\n      var b = (tubularSegments + 1) * (j - 1) + i - 1;\r\n      var c = (tubularSegments + 1) * (j - 1) + i;\r\n      var d = (tubularSegments + 1) * j + i;\r\n\r\n      var face = new THREE.Face3(a, b, d, [normals[a].clone(), normals[b].clone(), normals[d].clone()]);\r\n      this.faces.push(face);\r\n      this.faceVertexUvs[0].push([uvs[a].clone(), uvs[b].clone(), uvs[d].clone()]);\r\n\r\n      face = new THREE.Face3(b, c, d, [normals[b].clone(), normals[c].clone(), normals[d].clone()]);\r\n      this.faces.push(face);\r\n      this.faceVertexUvs[0].push([uvs[b].clone(), uvs[c].clone(), uvs[d].clone()]);\r\n\r\n    }\r\n\r\n  }\r\n\r\n  this.computeFaceNormals();\r\n\r\n};\r\n\r\nTHREE.TorusGeometry.prototype = Object.create(THREE.Geometry.prototype);\r\nTHREE.TorusGeometry.prototype.constructor = THREE.TorusGeometry;\r\n\r\n// File:src/extras/geometries/TorusKnotGeometry.js\r\n\r\n/**\r\n * @author oosmoxiecode\r\n * based on http://code.google.com/p/away3d/source/browse/trunk/fp10/Away3D/src/away3d/primitives/TorusKnot.as?spec=svn2473&r=2473\r\n */\r\n\r\nTHREE.TorusKnotGeometry = function(radius, tube, radialSegments, tubularSegments, p, q, heightScale) {\r\n\r\n  THREE.Geometry.call(this);\r\n\r\n  this.type = 'TorusKnotGeometry';\r\n\r\n  this.parameters = {\r\n    radius: radius,\r\n    tube: tube,\r\n    radialSegments: radialSegments,\r\n    tubularSegments: tubularSegments,\r\n    p: p,\r\n    q: q,\r\n    heightScale: heightScale\r\n  };\r\n\r\n  radius = radius || 100;\r\n  tube = tube || 40;\r\n  radialSegments = radialSegments || 64;\r\n  tubularSegments = tubularSegments || 8;\r\n  p = p || 2;\r\n  q = q || 3;\r\n  heightScale = heightScale || 1;\r\n\r\n  var grid = new Array(radialSegments);\r\n  var tang = new THREE.Vector3();\r\n  var n = new THREE.Vector3();\r\n  var bitan = new THREE.Vector3();\r\n\r\n  for (var i = 0; i < radialSegments; ++i) {\r\n\r\n    grid[i] = new Array(tubularSegments);\r\n    var u = i / radialSegments * 2 * p * Math.PI;\r\n    var p1 = getPos(u, q, p, radius, heightScale);\r\n    var p2 = getPos(u + 0.01, q, p, radius, heightScale);\r\n    tang.subVectors(p2, p1);\r\n    n.addVectors(p2, p1);\r\n\r\n    bitan.crossVectors(tang, n);\r\n    n.crossVectors(bitan, tang);\r\n    bitan.normalize();\r\n    n.normalize();\r\n\r\n    for (var j = 0; j < tubularSegments; ++j) {\r\n\r\n      var v = j / tubularSegments * 2 * Math.PI;\r\n      var cx = -tube * Math.cos(v); // TODO: Hack: Negating it so it faces outside.\r\n      var cy = tube * Math.sin(v);\r\n\r\n      var pos = new THREE.Vector3();\r\n      pos.x = p1.x + cx * n.x + cy * bitan.x;\r\n      pos.y = p1.y + cx * n.y + cy * bitan.y;\r\n      pos.z = p1.z + cx * n.z + cy * bitan.z;\r\n\r\n      grid[i][j] = this.vertices.push(pos) - 1;\r\n\r\n    }\r\n\r\n  }\r\n\r\n  for (var i = 0; i < radialSegments; ++i) {\r\n\r\n    for (var j = 0; j < tubularSegments; ++j) {\r\n\r\n      var ip = (i + 1) % radialSegments;\r\n      var jp = (j + 1) % tubularSegments;\r\n\r\n      var a = grid[i][j];\r\n      var b = grid[ip][j];\r\n      var c = grid[ip][jp];\r\n      var d = grid[i][jp];\r\n\r\n      var uva = new THREE.Vector2(i / radialSegments, j / tubularSegments);\r\n      var uvb = new THREE.Vector2((i + 1) / radialSegments, j / tubularSegments);\r\n      var uvc = new THREE.Vector2((i + 1) / radialSegments, (j + 1) / tubularSegments);\r\n      var uvd = new THREE.Vector2(i / radialSegments, (j + 1) / tubularSegments);\r\n\r\n      this.faces.push(new THREE.Face3(a, b, d));\r\n      this.faceVertexUvs[0].push([uva, uvb, uvd]);\r\n\r\n      this.faces.push(new THREE.Face3(b, c, d));\r\n      this.faceVertexUvs[0].push([uvb.clone(), uvc, uvd.clone()]);\r\n\r\n    }\r\n  }\r\n\r\n  this.computeFaceNormals();\r\n  this.computeVertexNormals();\r\n\r\n  function getPos(u, in_q, in_p, radius, heightScale) {\r\n\r\n    var cu = Math.cos(u);\r\n    var su = Math.sin(u);\r\n    var quOverP = in_q / in_p * u;\r\n    var cs = Math.cos(quOverP);\r\n\r\n    var tx = radius * (2 + cs) * 0.5 * cu;\r\n    var ty = radius * (2 + cs) * su * 0.5;\r\n    var tz = heightScale * radius * Math.sin(quOverP) * 0.5;\r\n\r\n    return new THREE.Vector3(tx, ty, tz);\r\n\r\n  }\r\n\r\n};\r\n\r\nTHREE.TorusKnotGeometry.prototype = Object.create(THREE.Geometry.prototype);\r\nTHREE.TorusKnotGeometry.prototype.constructor = THREE.TorusKnotGeometry;\r\n\r\n// File:src/extras/geometries/TubeGeometry.js\r\n\r\n/**\r\n * @author WestLangley / https://github.com/WestLangley\r\n * @author zz85 / https://github.com/zz85\r\n * @author miningold / https://github.com/miningold\r\n * @author jonobr1 / https://github.com/jonobr1\r\n *\r\n * Modified from the TorusKnotGeometry by @oosmoxiecode\r\n *\r\n * Creates a tube which extrudes along a 3d spline\r\n *\r\n * Uses parallel transport frames as described in\r\n * http://www.cs.indiana.edu/pub/techreports/TR425.pdf\r\n */\r\n\r\nTHREE.TubeGeometry = function(path, segments, radius, radialSegments, closed, taper) {\r\n\r\n  THREE.Geometry.call(this);\r\n\r\n  this.type = 'TubeGeometry';\r\n\r\n  this.parameters = {\r\n    path: path,\r\n    segments: segments,\r\n    radius: radius,\r\n    radialSegments: radialSegments,\r\n    closed: closed\r\n  };\r\n\r\n  segments = segments || 64;\r\n  radius = radius || 1;\r\n  radialSegments = radialSegments || 8;\r\n  closed = closed || false;\r\n  taper = taper || THREE.TubeGeometry.NoTaper;\r\n\r\n  var grid = [];\r\n\r\n  var scope = this,\r\n\r\n    tangent,\r\n    normal,\r\n    binormal,\r\n\r\n    numpoints = segments + 1,\r\n\r\n    u, v, r,\r\n\r\n    cx, cy,\r\n    pos, pos2 = new THREE.Vector3(),\r\n    i, j,\r\n    ip, jp,\r\n    a, b, c, d,\r\n    uva, uvb, uvc, uvd;\r\n\r\n  var frames = new THREE.TubeGeometry.FrenetFrames(path, segments, closed),\r\n    tangents = frames.tangents,\r\n    normals = frames.normals,\r\n    binormals = frames.binormals;\r\n\r\n  // proxy internals\r\n  this.tangents = tangents;\r\n  this.normals = normals;\r\n  this.binormals = binormals;\r\n\r\n  function vert(x, y, z) {\r\n\r\n    return scope.vertices.push(new THREE.Vector3(x, y, z)) - 1;\r\n\r\n  }\r\n\r\n  // consruct the grid\r\n\r\n  for (i = 0; i < numpoints; i++) {\r\n\r\n    grid[i] = [];\r\n\r\n    u = i / (numpoints - 1);\r\n\r\n    pos = path.getPointAt(u);\r\n\r\n    tangent = tangents[i];\r\n    normal = normals[i];\r\n    binormal = binormals[i];\r\n\r\n    r = radius * taper(u);\r\n\r\n    for (j = 0; j < radialSegments; j++) {\r\n\r\n      v = j / radialSegments * 2 * Math.PI;\r\n\r\n      cx = -r * Math.cos(v); // TODO: Hack: Negating it so it faces outside.\r\n      cy = r * Math.sin(v);\r\n\r\n      pos2.copy(pos);\r\n      pos2.x += cx * normal.x + cy * binormal.x;\r\n      pos2.y += cx * normal.y + cy * binormal.y;\r\n      pos2.z += cx * normal.z + cy * binormal.z;\r\n\r\n      grid[i][j] = vert(pos2.x, pos2.y, pos2.z);\r\n\r\n    }\r\n  }\r\n\r\n\r\n  // construct the mesh\r\n\r\n  for (i = 0; i < segments; i++) {\r\n\r\n    for (j = 0; j < radialSegments; j++) {\r\n\r\n      ip = (closed) ? (i + 1) % segments : i + 1;\r\n      jp = (j + 1) % radialSegments;\r\n\r\n      a = grid[i][j]; // *** NOT NECESSARILY PLANAR ! ***\r\n      b = grid[ip][j];\r\n      c = grid[ip][jp];\r\n      d = grid[i][jp];\r\n\r\n      uva = new THREE.Vector2(i / segments, j / radialSegments);\r\n      uvb = new THREE.Vector2((i + 1) / segments, j / radialSegments);\r\n      uvc = new THREE.Vector2((i + 1) / segments, (j + 1) / radialSegments);\r\n      uvd = new THREE.Vector2(i / segments, (j + 1) / radialSegments);\r\n\r\n      this.faces.push(new THREE.Face3(a, b, d));\r\n      this.faceVertexUvs[0].push([uva, uvb, uvd]);\r\n\r\n      this.faces.push(new THREE.Face3(b, c, d));\r\n      this.faceVertexUvs[0].push([uvb.clone(), uvc, uvd.clone()]);\r\n\r\n    }\r\n  }\r\n\r\n  this.computeFaceNormals();\r\n  this.computeVertexNormals();\r\n\r\n};\r\n\r\nTHREE.TubeGeometry.prototype = Object.create(THREE.Geometry.prototype);\r\nTHREE.TubeGeometry.prototype.constructor = THREE.TubeGeometry;\r\n\r\nTHREE.TubeGeometry.NoTaper = function(u) {\r\n\r\n  return 1;\r\n\r\n};\r\n\r\nTHREE.TubeGeometry.SinusoidalTaper = function(u) {\r\n\r\n  return Math.sin(Math.PI * u);\r\n\r\n};\r\n\r\n// For computing of Frenet frames, exposing the tangents, normals and binormals the spline\r\nTHREE.TubeGeometry.FrenetFrames = function(path, segments, closed) {\r\n\r\n  var normal = new THREE.Vector3(),\r\n\r\n    tangents = [],\r\n    normals = [],\r\n    binormals = [],\r\n\r\n    vec = new THREE.Vector3(),\r\n    mat = new THREE.Matrix4(),\r\n\r\n    numpoints = segments + 1,\r\n    theta,\r\n    epsilon = 0.0001,\r\n    smallest,\r\n\r\n    tx, ty, tz,\r\n    i, u;\r\n\r\n\r\n  // expose internals\r\n  this.tangents = tangents;\r\n  this.normals = normals;\r\n  this.binormals = binormals;\r\n\r\n  // compute the tangent vectors for each segment on the path\r\n\r\n  for (i = 0; i < numpoints; i++) {\r\n\r\n    u = i / (numpoints - 1);\r\n\r\n    tangents[i] = path.getTangentAt(u);\r\n    tangents[i].normalize();\r\n\r\n  }\r\n\r\n  initialNormal3();\r\n\r\n  /*\r\n  function initialNormal1(lastBinormal) {\r\n  \t// fixed start binormal. Has dangers of 0 vectors\r\n  \tnormals[ 0 ] = new THREE.Vector3();\r\n  \tbinormals[ 0 ] = new THREE.Vector3();\r\n  \tif (lastBinormal===undefined) lastBinormal = new THREE.Vector3( 0, 0, 1 );\r\n  \tnormals[ 0 ].crossVectors( lastBinormal, tangents[ 0 ] ).normalize();\r\n  \tbinormals[ 0 ].crossVectors( tangents[ 0 ], normals[ 0 ] ).normalize();\r\n  }\r\n\r\n  function initialNormal2() {\r\n\r\n  \t// This uses the Frenet-Serret formula for deriving binormal\r\n  \tvar t2 = path.getTangentAt( epsilon );\r\n\r\n  \tnormals[ 0 ] = new THREE.Vector3().subVectors( t2, tangents[ 0 ] ).normalize();\r\n  \tbinormals[ 0 ] = new THREE.Vector3().crossVectors( tangents[ 0 ], normals[ 0 ] );\r\n\r\n  \tnormals[ 0 ].crossVectors( binormals[ 0 ], tangents[ 0 ] ).normalize(); // last binormal x tangent\r\n  \tbinormals[ 0 ].crossVectors( tangents[ 0 ], normals[ 0 ] ).normalize();\r\n\r\n  }\r\n  */\r\n\r\n  function initialNormal3() {\r\n    // select an initial normal vector perpenicular to the first tangent vector,\r\n    // and in the direction of the smallest tangent xyz component\r\n\r\n    normals[0] = new THREE.Vector3();\r\n    binormals[0] = new THREE.Vector3();\r\n    smallest = Number.MAX_VALUE;\r\n    tx = Math.abs(tangents[0].x);\r\n    ty = Math.abs(tangents[0].y);\r\n    tz = Math.abs(tangents[0].z);\r\n\r\n    if (tx <= smallest) {\r\n      smallest = tx;\r\n      normal.set(1, 0, 0);\r\n    }\r\n\r\n    if (ty <= smallest) {\r\n      smallest = ty;\r\n      normal.set(0, 1, 0);\r\n    }\r\n\r\n    if (tz <= smallest) {\r\n      normal.set(0, 0, 1);\r\n    }\r\n\r\n    vec.crossVectors(tangents[0], normal).normalize();\r\n\r\n    normals[0].crossVectors(tangents[0], vec);\r\n    binormals[0].crossVectors(tangents[0], normals[0]);\r\n  }\r\n\r\n\r\n  // compute the slowly-varying normal and binormal vectors for each segment on the path\r\n\r\n  for (i = 1; i < numpoints; i++) {\r\n\r\n    normals[i] = normals[i - 1].clone();\r\n\r\n    binormals[i] = binormals[i - 1].clone();\r\n\r\n    vec.crossVectors(tangents[i - 1], tangents[i]);\r\n\r\n    if (vec.length() > epsilon) {\r\n\r\n      vec.normalize();\r\n\r\n      theta = Math.acos(THREE.Math.clamp(tangents[i - 1].dot(tangents[i]), -1, 1)); // clamp for floating pt errors\r\n\r\n      normals[i].applyMatrix4(mat.makeRotationAxis(vec, theta));\r\n\r\n    }\r\n\r\n    binormals[i].crossVectors(tangents[i], normals[i]);\r\n\r\n  }\r\n\r\n\r\n  // if the curve is closed, postprocess the vectors so the first and last normal vectors are the same\r\n\r\n  if (closed) {\r\n\r\n    theta = Math.acos(THREE.Math.clamp(normals[0].dot(normals[numpoints - 1]), -1, 1));\r\n    theta /= (numpoints - 1);\r\n\r\n    if (tangents[0].dot(vec.crossVectors(normals[0], normals[numpoints - 1])) > 0) {\r\n\r\n      theta = -theta;\r\n\r\n    }\r\n\r\n    for (i = 1; i < numpoints; i++) {\r\n\r\n      // twist a little...\r\n      normals[i].applyMatrix4(mat.makeRotationAxis(tangents[i], theta * i));\r\n      binormals[i].crossVectors(tangents[i], normals[i]);\r\n\r\n    }\r\n\r\n  }\r\n};\r\n\r\n// File:src/extras/geometries/PolyhedronGeometry.js\r\n\r\n/**\r\n * @author clockworkgeek / https://github.com/clockworkgeek\r\n * @author timothypratley / https://github.com/timothypratley\r\n * @author WestLangley / http://github.com/WestLangley\r\n */\r\n\r\nTHREE.PolyhedronGeometry = function(vertices, indices, radius, detail) {\r\n\r\n  THREE.Geometry.call(this);\r\n\r\n  this.type = 'PolyhedronGeometry';\r\n\r\n  this.parameters = {\r\n    vertices: vertices,\r\n    indices: indices,\r\n    radius: radius,\r\n    detail: detail\r\n  };\r\n\r\n  radius = radius || 1;\r\n  detail = detail || 0;\r\n\r\n  var that = this;\r\n\r\n  for (var i = 0, l = vertices.length; i < l; i += 3) {\r\n\r\n    prepare(new THREE.Vector3(vertices[i], vertices[i + 1], vertices[i + 2]));\r\n\r\n  }\r\n\r\n  var p = this.vertices;\r\n\r\n  var faces = [];\r\n\r\n  for (var i = 0, j = 0, l = indices.length; i < l; i += 3, j++) {\r\n\r\n    var v1 = p[indices[i]];\r\n    var v2 = p[indices[i + 1]];\r\n    var v3 = p[indices[i + 2]];\r\n\r\n    faces[j] = new THREE.Face3(v1.index, v2.index, v3.index, [v1.clone(), v2.clone(), v3.clone()]);\r\n\r\n  }\r\n\r\n  var centroid = new THREE.Vector3();\r\n\r\n  for (var i = 0, l = faces.length; i < l; i++) {\r\n\r\n    subdivide(faces[i], detail);\r\n\r\n  }\r\n\r\n\r\n  // Handle case when face straddles the seam\r\n\r\n  for (var i = 0, l = this.faceVertexUvs[0].length; i < l; i++) {\r\n\r\n    var uvs = this.faceVertexUvs[0][i];\r\n\r\n    var x0 = uvs[0].x;\r\n    var x1 = uvs[1].x;\r\n    var x2 = uvs[2].x;\r\n\r\n    var max = Math.max(x0, Math.max(x1, x2));\r\n    var min = Math.min(x0, Math.min(x1, x2));\r\n\r\n    if (max > 0.9 && min < 0.1) { // 0.9 is somewhat arbitrary\r\n\r\n      if (x0 < 0.2) uvs[0].x += 1;\r\n      if (x1 < 0.2) uvs[1].x += 1;\r\n      if (x2 < 0.2) uvs[2].x += 1;\r\n\r\n    }\r\n\r\n  }\r\n\r\n\r\n  // Apply radius\r\n\r\n  for (var i = 0, l = this.vertices.length; i < l; i++) {\r\n\r\n    this.vertices[i].multiplyScalar(radius);\r\n\r\n  }\r\n\r\n\r\n  // Merge vertices\r\n\r\n  this.mergeVertices();\r\n\r\n  this.computeFaceNormals();\r\n\r\n  this.boundingSphere = new THREE.Sphere(new THREE.Vector3(), radius);\r\n\r\n\r\n  // Project vector onto sphere's surface\r\n\r\n  function prepare(vector) {\r\n\r\n    var vertex = vector.normalize().clone();\r\n    vertex.index = that.vertices.push(vertex) - 1;\r\n\r\n    // Texture coords are equivalent to map coords, calculate angle and convert to fraction of a circle.\r\n\r\n    var u = azimuth(vector) / 2 / Math.PI + 0.5;\r\n    var v = inclination(vector) / Math.PI + 0.5;\r\n    vertex.uv = new THREE.Vector2(u, 1 - v);\r\n\r\n    return vertex;\r\n\r\n  }\r\n\r\n\r\n  // Approximate a curved face with recursively sub-divided triangles.\r\n\r\n  function make(v1, v2, v3) {\r\n\r\n    var face = new THREE.Face3(v1.index, v2.index, v3.index, [v1.clone(), v2.clone(), v3.clone()]);\r\n    that.faces.push(face);\r\n\r\n    centroid.copy(v1).add(v2).add(v3).divideScalar(3);\r\n\r\n    var azi = azimuth(centroid);\r\n\r\n    that.faceVertexUvs[0].push([\r\n      correctUV(v1.uv, v1, azi),\r\n      correctUV(v2.uv, v2, azi),\r\n      correctUV(v3.uv, v3, azi)\r\n    ]);\r\n\r\n  }\r\n\r\n\r\n  // Analytically subdivide a face to the required detail level.\r\n\r\n  function subdivide(face, detail) {\r\n\r\n    var cols = Math.pow(2, detail);\r\n    var a = prepare(that.vertices[face.a]);\r\n    var b = prepare(that.vertices[face.b]);\r\n    var c = prepare(that.vertices[face.c]);\r\n    var v = [];\r\n\r\n    // Construct all of the vertices for this subdivision.\r\n\r\n    for (var i = 0; i <= cols; i++) {\r\n\r\n      v[i] = [];\r\n\r\n      var aj = prepare(a.clone().lerp(c, i / cols));\r\n      var bj = prepare(b.clone().lerp(c, i / cols));\r\n      var rows = cols - i;\r\n\r\n      for (var j = 0; j <= rows; j++) {\r\n\r\n        if (j == 0 && i == cols) {\r\n\r\n          v[i][j] = aj;\r\n\r\n        }\r\n        else {\r\n\r\n          v[i][j] = prepare(aj.clone().lerp(bj, j / rows));\r\n\r\n        }\r\n\r\n      }\r\n\r\n    }\r\n\r\n    // Construct all of the faces.\r\n\r\n    for (var i = 0; i < cols; i++) {\r\n\r\n      for (var j = 0; j < 2 * (cols - i) - 1; j++) {\r\n\r\n        var k = Math.floor(j / 2);\r\n\r\n        if (j % 2 == 0) {\r\n\r\n          make(\r\n            v[i][k + 1],\r\n            v[i + 1][k],\r\n            v[i][k]\r\n          );\r\n\r\n        }\r\n        else {\r\n\r\n          make(\r\n            v[i][k + 1],\r\n            v[i + 1][k + 1],\r\n            v[i + 1][k]\r\n          );\r\n\r\n        }\r\n\r\n      }\r\n\r\n    }\r\n\r\n  }\r\n\r\n\r\n  // Angle around the Y axis, counter-clockwise when looking from above.\r\n\r\n  function azimuth(vector) {\r\n\r\n    return Math.atan2(vector.z, -vector.x);\r\n\r\n  }\r\n\r\n\r\n  // Angle above the XZ plane.\r\n\r\n  function inclination(vector) {\r\n\r\n    return Math.atan2(-vector.y, Math.sqrt((vector.x * vector.x) + (vector.z * vector.z)));\r\n\r\n  }\r\n\r\n\r\n  // Texture fixing helper. Spheres have some odd behaviours.\r\n\r\n  function correctUV(uv, vector, azimuth) {\r\n\r\n    if ((azimuth < 0) && (uv.x === 1)) uv = new THREE.Vector2(uv.x - 1, uv.y);\r\n    if ((vector.x === 0) && (vector.z === 0)) uv = new THREE.Vector2(azimuth / 2 / Math.PI + 0.5, uv.y);\r\n    return uv.clone();\r\n\r\n  }\r\n\r\n\r\n};\r\n\r\nTHREE.PolyhedronGeometry.prototype = Object.create(THREE.Geometry.prototype);\r\nTHREE.PolyhedronGeometry.prototype.constructor = THREE.PolyhedronGeometry;\r\n\r\n// File:src/extras/geometries/DodecahedronGeometry.js\r\n\r\n/**\r\n * @author Abe Pazos / https://hamoid.com\r\n */\r\n\r\nTHREE.DodecahedronGeometry = function(radius, detail) {\r\n\r\n  this.parameters = {\r\n    radius: radius,\r\n    detail: detail\r\n  };\r\n\r\n  var t = (1 + Math.sqrt(5)) / 2;\r\n  var r = 1 / t;\r\n\r\n  var vertices = [\r\n\r\n    // (1, 1, 1)\r\n    -1, -1, -1, -1, -1, 1, -1, 1, -1, -1, 1, 1,\r\n    1, -1, -1, 1, -1, 1,\r\n    1, 1, -1, 1, 1, 1,\r\n\r\n    // (0, 1/, )\r\n    0, -r, -t, 0, -r, t,\r\n    0, r, -t, 0, r, t,\r\n\r\n    // (1/, , 0)\r\n    -r, -t, 0, -r, t, 0,\r\n    r, -t, 0, r, t, 0,\r\n\r\n    // (, 0, 1/)\r\n    -t, 0, -r, t, 0, -r, -t, 0, r, t, 0, r\r\n  ];\r\n\r\n  var indices = [\r\n    3, 11, 7, 3, 7, 15, 3, 15, 13,\r\n    7, 19, 17, 7, 17, 6, 7, 6, 15,\r\n    17, 4, 8, 17, 8, 10, 17, 10, 6,\r\n    8, 0, 16, 8, 16, 2, 8, 2, 10,\r\n    0, 12, 1, 0, 1, 18, 0, 18, 16,\r\n    6, 10, 2, 6, 2, 13, 6, 13, 15,\r\n    2, 16, 18, 2, 18, 3, 2, 3, 13,\r\n    18, 1, 9, 18, 9, 11, 18, 11, 3,\r\n    4, 14, 12, 4, 12, 0, 4, 0, 8,\r\n    11, 9, 5, 11, 5, 19, 11, 19, 7,\r\n    19, 5, 14, 19, 14, 4, 19, 4, 17,\r\n    1, 12, 14, 1, 14, 5, 1, 5, 9\r\n  ];\r\n\r\n  THREE.PolyhedronGeometry.call(this, vertices, indices, radius, detail);\r\n\r\n};\r\n\r\nTHREE.DodecahedronGeometry.prototype = Object.create(THREE.Geometry.prototype);\r\nTHREE.DodecahedronGeometry.prototype.constructor = THREE.DodecahedronGeometry;\r\n\r\n// File:src/extras/geometries/IcosahedronGeometry.js\r\n\r\n/**\r\n * @author timothypratley / https://github.com/timothypratley\r\n */\r\n\r\nTHREE.IcosahedronGeometry = function(radius, detail) {\r\n\r\n  var t = (1 + Math.sqrt(5)) / 2;\r\n\r\n  var vertices = [-1, t, 0, 1, t, 0, -1, -t, 0, 1, -t, 0,\r\n    0, -1, t, 0, 1, t, 0, -1, -t, 0, 1, -t,\r\n    t, 0, -1, t, 0, 1, -t, 0, -1, -t, 0, 1\r\n  ];\r\n\r\n  var indices = [\r\n    0, 11, 5, 0, 5, 1, 0, 1, 7, 0, 7, 10, 0, 10, 11,\r\n    1, 5, 9, 5, 11, 4, 11, 10, 2, 10, 7, 6, 7, 1, 8,\r\n    3, 9, 4, 3, 4, 2, 3, 2, 6, 3, 6, 8, 3, 8, 9,\r\n    4, 9, 5, 2, 4, 11, 6, 2, 10, 8, 6, 7, 9, 8, 1\r\n  ];\r\n\r\n  THREE.PolyhedronGeometry.call(this, vertices, indices, radius, detail);\r\n\r\n  this.type = 'IcosahedronGeometry';\r\n\r\n  this.parameters = {\r\n    radius: radius,\r\n    detail: detail\r\n  };\r\n};\r\n\r\nTHREE.IcosahedronGeometry.prototype = Object.create(THREE.Geometry.prototype);\r\nTHREE.IcosahedronGeometry.prototype.constructor = THREE.IcosahedronGeometry;\r\n\r\n// File:src/extras/geometries/OctahedronGeometry.js\r\n\r\n/**\r\n * @author timothypratley / https://github.com/timothypratley\r\n */\r\n\r\nTHREE.OctahedronGeometry = function(radius, detail) {\r\n\r\n  this.parameters = {\r\n    radius: radius,\r\n    detail: detail\r\n  };\r\n\r\n  var vertices = [\r\n    1, 0, 0, -1, 0, 0, 0, 1, 0, 0, -1, 0, 0, 0, 1, 0, 0, -1\r\n  ];\r\n\r\n  var indices = [\r\n    0, 2, 4, 0, 4, 3, 0, 3, 5, 0, 5, 2, 1, 2, 5, 1, 5, 3, 1, 3, 4, 1, 4, 2\r\n  ];\r\n\r\n  THREE.PolyhedronGeometry.call(this, vertices, indices, radius, detail);\r\n\r\n  this.type = 'OctahedronGeometry';\r\n\r\n  this.parameters = {\r\n    radius: radius,\r\n    detail: detail\r\n  };\r\n};\r\n\r\nTHREE.OctahedronGeometry.prototype = Object.create(THREE.Geometry.prototype);\r\nTHREE.OctahedronGeometry.prototype.constructor = THREE.OctahedronGeometry;\r\n\r\n// File:src/extras/geometries/TetrahedronGeometry.js\r\n\r\n/**\r\n * @author timothypratley / https://github.com/timothypratley\r\n */\r\n\r\nTHREE.TetrahedronGeometry = function(radius, detail) {\r\n\r\n  var vertices = [\r\n    1, 1, 1, -1, -1, 1, -1, 1, -1, 1, -1, -1\r\n  ];\r\n\r\n  var indices = [\r\n    2, 1, 0, 0, 3, 2, 1, 3, 0, 2, 3, 1\r\n  ];\r\n\r\n  THREE.PolyhedronGeometry.call(this, vertices, indices, radius, detail);\r\n\r\n  this.type = 'TetrahedronGeometry';\r\n\r\n  this.parameters = {\r\n    radius: radius,\r\n    detail: detail\r\n  };\r\n\r\n};\r\n\r\nTHREE.TetrahedronGeometry.prototype = Object.create(THREE.Geometry.prototype);\r\nTHREE.TetrahedronGeometry.prototype.constructor = THREE.TetrahedronGeometry;\r\n\r\n// File:src/extras/geometries/ParametricGeometry.js\r\n\r\n/**\r\n * @author zz85 / https://github.com/zz85\r\n * Parametric Surfaces Geometry\r\n * based on the brilliant article by @prideout http://prideout.net/blog/?p=44\r\n *\r\n * new THREE.ParametricGeometry( parametricFunction, uSegments, ySegements );\r\n *\r\n */\r\n\r\nTHREE.ParametricGeometry = function(func, slices, stacks) {\r\n\r\n  THREE.Geometry.call(this);\r\n\r\n  this.type = 'ParametricGeometry';\r\n\r\n  this.parameters = {\r\n    func: func,\r\n    slices: slices,\r\n    stacks: stacks\r\n  };\r\n\r\n  var verts = this.vertices;\r\n  var faces = this.faces;\r\n  var uvs = this.faceVertexUvs[0];\r\n\r\n  var i, j, p;\r\n  var u, v;\r\n\r\n  var sliceCount = slices + 1;\r\n\r\n  for (i = 0; i <= stacks; i++) {\r\n\r\n    v = i / stacks;\r\n\r\n    for (j = 0; j <= slices; j++) {\r\n\r\n      u = j / slices;\r\n\r\n      p = func(u, v);\r\n      verts.push(p);\r\n\r\n    }\r\n  }\r\n\r\n  var a, b, c, d;\r\n  var uva, uvb, uvc, uvd;\r\n\r\n  for (i = 0; i < stacks; i++) {\r\n\r\n    for (j = 0; j < slices; j++) {\r\n\r\n      a = i * sliceCount + j;\r\n      b = i * sliceCount + j + 1;\r\n      c = (i + 1) * sliceCount + j + 1;\r\n      d = (i + 1) * sliceCount + j;\r\n\r\n      uva = new THREE.Vector2(j / slices, i / stacks);\r\n      uvb = new THREE.Vector2((j + 1) / slices, i / stacks);\r\n      uvc = new THREE.Vector2((j + 1) / slices, (i + 1) / stacks);\r\n      uvd = new THREE.Vector2(j / slices, (i + 1) / stacks);\r\n\r\n      faces.push(new THREE.Face3(a, b, d));\r\n      uvs.push([uva, uvb, uvd]);\r\n\r\n      faces.push(new THREE.Face3(b, c, d));\r\n      uvs.push([uvb.clone(), uvc, uvd.clone()]);\r\n\r\n    }\r\n\r\n  }\r\n\r\n  // console.log(this);\r\n\r\n  // magic bullet\r\n  // var diff = this.mergeVertices();\r\n  // console.log('removed ', diff, ' vertices by merging');\r\n\r\n  this.computeFaceNormals();\r\n  this.computeVertexNormals();\r\n\r\n};\r\n\r\nTHREE.ParametricGeometry.prototype = Object.create(THREE.Geometry.prototype);\r\nTHREE.ParametricGeometry.prototype.constructor = THREE.ParametricGeometry;\r\n\r\n// File:src/extras/helpers/AxisHelper.js\r\n\r\n/**\r\n * @author sroucheray / http://sroucheray.org/\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.AxisHelper = function(size) {\r\n\r\n  size = size || 1;\r\n\r\n  var vertices = new Float32Array([\r\n    0, 0, 0, size, 0, 0,\r\n    0, 0, 0, 0, size, 0,\r\n    0, 0, 0, 0, 0, size\r\n  ]);\r\n\r\n  var colors = new Float32Array([\r\n    1, 0, 0, 1, 0.6, 0,\r\n    0, 1, 0, 0.6, 1, 0,\r\n    0, 0, 1, 0, 0.6, 1\r\n  ]);\r\n\r\n  var geometry = new THREE.BufferGeometry();\r\n  geometry.addAttribute('position', new THREE.BufferAttribute(vertices, 3));\r\n  geometry.addAttribute('color', new THREE.BufferAttribute(colors, 3));\r\n\r\n  var material = new THREE.LineBasicMaterial({\r\n    vertexColors: THREE.VertexColors\r\n  });\r\n\r\n  THREE.Line.call(this, geometry, material, THREE.LinePieces);\r\n\r\n};\r\n\r\nTHREE.AxisHelper.prototype = Object.create(THREE.Line.prototype);\r\nTHREE.AxisHelper.prototype.constructor = THREE.AxisHelper;\r\n\r\n// File:src/extras/helpers/ArrowHelper.js\r\n\r\n/**\r\n * @author WestLangley / http://github.com/WestLangley\r\n * @author zz85 / http://github.com/zz85\r\n * @author bhouston / http://exocortex.com\r\n *\r\n * Creates an arrow for visualizing directions\r\n *\r\n * Parameters:\r\n *  dir - Vector3\r\n *  origin - Vector3\r\n *  length - Number\r\n *  color - color in hex value\r\n *  headLength - Number\r\n *  headWidth - Number\r\n */\r\n\r\nTHREE.ArrowHelper = (function() {\r\n\r\n  var lineGeometry = new THREE.Geometry();\r\n  lineGeometry.vertices.push(new THREE.Vector3(0, 0, 0), new THREE.Vector3(0, 1, 0));\r\n\r\n  var coneGeometry = new THREE.CylinderGeometry(0, 0.5, 1, 5, 1);\r\n  coneGeometry.applyMatrix(new THREE.Matrix4().makeTranslation(0, -0.5, 0));\r\n\r\n  return function(dir, origin, length, color, headLength, headWidth) {\r\n\r\n    // dir is assumed to be normalized\r\n\r\n    THREE.Object3D.call(this);\r\n\r\n    if (color === undefined) color = 0xffff00;\r\n    if (length === undefined) length = 1;\r\n    if (headLength === undefined) headLength = 0.2 * length;\r\n    if (headWidth === undefined) headWidth = 0.2 * headLength;\r\n\r\n    this.position.copy(origin);\r\n\r\n    this.line = new THREE.Line(lineGeometry, new THREE.LineBasicMaterial({\r\n      color: color\r\n    }));\r\n    this.line.matrixAutoUpdate = false;\r\n    this.add(this.line);\r\n\r\n    this.cone = new THREE.Mesh(coneGeometry, new THREE.MeshBasicMaterial({\r\n      color: color\r\n    }));\r\n    this.cone.matrixAutoUpdate = false;\r\n    this.add(this.cone);\r\n\r\n    this.setDirection(dir);\r\n    this.setLength(length, headLength, headWidth);\r\n\r\n  }\r\n\r\n}());\r\n\r\nTHREE.ArrowHelper.prototype = Object.create(THREE.Object3D.prototype);\r\nTHREE.ArrowHelper.prototype.constructor = THREE.ArrowHelper;\r\n\r\nTHREE.ArrowHelper.prototype.setDirection = (function() {\r\n\r\n  var axis = new THREE.Vector3();\r\n  var radians;\r\n\r\n  return function(dir) {\r\n\r\n    // dir is assumed to be normalized\r\n\r\n    if (dir.y > 0.99999) {\r\n\r\n      this.quaternion.set(0, 0, 0, 1);\r\n\r\n    }\r\n    else if (dir.y < -0.99999) {\r\n\r\n      this.quaternion.set(1, 0, 0, 0);\r\n\r\n    }\r\n    else {\r\n\r\n      axis.set(dir.z, 0, -dir.x).normalize();\r\n\r\n      radians = Math.acos(dir.y);\r\n\r\n      this.quaternion.setFromAxisAngle(axis, radians);\r\n\r\n    }\r\n\r\n  };\r\n\r\n}());\r\n\r\nTHREE.ArrowHelper.prototype.setLength = function(length, headLength, headWidth) {\r\n\r\n  if (headLength === undefined) headLength = 0.2 * length;\r\n  if (headWidth === undefined) headWidth = 0.2 * headLength;\r\n\r\n  this.line.scale.set(1, length - headLength, 1);\r\n  this.line.updateMatrix();\r\n\r\n  this.cone.scale.set(headWidth, headLength, headWidth);\r\n  this.cone.position.y = length;\r\n  this.cone.updateMatrix();\r\n\r\n};\r\n\r\nTHREE.ArrowHelper.prototype.setColor = function(color) {\r\n\r\n  this.line.material.color.set(color);\r\n  this.cone.material.color.set(color);\r\n\r\n};\r\n\r\n// File:src/extras/helpers/BoxHelper.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.BoxHelper = function(object) {\r\n\r\n  var geometry = new THREE.BufferGeometry();\r\n  geometry.addAttribute('position', new THREE.BufferAttribute(new Float32Array(72), 3));\r\n\r\n  THREE.Line.call(this, geometry, new THREE.LineBasicMaterial({\r\n    color: 0xffff00\r\n  }), THREE.LinePieces);\r\n\r\n  if (object !== undefined) {\r\n\r\n    this.update(object);\r\n\r\n  }\r\n\r\n};\r\n\r\nTHREE.BoxHelper.prototype = Object.create(THREE.Line.prototype);\r\nTHREE.BoxHelper.prototype.constructor = THREE.BoxHelper;\r\n\r\nTHREE.BoxHelper.prototype.update = function(object) {\r\n\r\n  var geometry = object.geometry;\r\n\r\n  if (geometry.boundingBox === null) {\r\n\r\n    geometry.computeBoundingBox();\r\n\r\n  }\r\n\r\n  var min = geometry.boundingBox.min;\r\n  var max = geometry.boundingBox.max;\r\n\r\n  /*\r\n    5____4\r\n  1/___0/|\r\n  | 6__|_7\r\n  2/___3/\r\n\r\n  0: max.x, max.y, max.z\r\n  1: min.x, max.y, max.z\r\n  2: min.x, min.y, max.z\r\n  3: max.x, min.y, max.z\r\n  4: max.x, max.y, min.z\r\n  5: min.x, max.y, min.z\r\n  6: min.x, min.y, min.z\r\n  7: max.x, min.y, min.z\r\n  */\r\n\r\n  var vertices = this.geometry.attributes.position.array;\r\n\r\n  vertices[0] = max.x;\r\n  vertices[1] = max.y;\r\n  vertices[2] = max.z;\r\n  vertices[3] = min.x;\r\n  vertices[4] = max.y;\r\n  vertices[5] = max.z;\r\n\r\n  vertices[6] = min.x;\r\n  vertices[7] = max.y;\r\n  vertices[8] = max.z;\r\n  vertices[9] = min.x;\r\n  vertices[10] = min.y;\r\n  vertices[11] = max.z;\r\n\r\n  vertices[12] = min.x;\r\n  vertices[13] = min.y;\r\n  vertices[14] = max.z;\r\n  vertices[15] = max.x;\r\n  vertices[16] = min.y;\r\n  vertices[17] = max.z;\r\n\r\n  vertices[18] = max.x;\r\n  vertices[19] = min.y;\r\n  vertices[20] = max.z;\r\n  vertices[21] = max.x;\r\n  vertices[22] = max.y;\r\n  vertices[23] = max.z;\r\n\r\n  //\r\n\r\n  vertices[24] = max.x;\r\n  vertices[25] = max.y;\r\n  vertices[26] = min.z;\r\n  vertices[27] = min.x;\r\n  vertices[28] = max.y;\r\n  vertices[29] = min.z;\r\n\r\n  vertices[30] = min.x;\r\n  vertices[31] = max.y;\r\n  vertices[32] = min.z;\r\n  vertices[33] = min.x;\r\n  vertices[34] = min.y;\r\n  vertices[35] = min.z;\r\n\r\n  vertices[36] = min.x;\r\n  vertices[37] = min.y;\r\n  vertices[38] = min.z;\r\n  vertices[39] = max.x;\r\n  vertices[40] = min.y;\r\n  vertices[41] = min.z;\r\n\r\n  vertices[42] = max.x;\r\n  vertices[43] = min.y;\r\n  vertices[44] = min.z;\r\n  vertices[45] = max.x;\r\n  vertices[46] = max.y;\r\n  vertices[47] = min.z;\r\n\r\n  //\r\n\r\n  vertices[48] = max.x;\r\n  vertices[49] = max.y;\r\n  vertices[50] = max.z;\r\n  vertices[51] = max.x;\r\n  vertices[52] = max.y;\r\n  vertices[53] = min.z;\r\n\r\n  vertices[54] = min.x;\r\n  vertices[55] = max.y;\r\n  vertices[56] = max.z;\r\n  vertices[57] = min.x;\r\n  vertices[58] = max.y;\r\n  vertices[59] = min.z;\r\n\r\n  vertices[60] = min.x;\r\n  vertices[61] = min.y;\r\n  vertices[62] = max.z;\r\n  vertices[63] = min.x;\r\n  vertices[64] = min.y;\r\n  vertices[65] = min.z;\r\n\r\n  vertices[66] = max.x;\r\n  vertices[67] = min.y;\r\n  vertices[68] = max.z;\r\n  vertices[69] = max.x;\r\n  vertices[70] = min.y;\r\n  vertices[71] = min.z;\r\n\r\n  this.geometry.attributes.position.needsUpdate = true;\r\n\r\n  this.geometry.computeBoundingSphere();\r\n\r\n  this.matrix = object.matrixWorld;\r\n  this.matrixAutoUpdate = false;\r\n\r\n};\r\n\r\n// File:src/extras/helpers/BoundingBoxHelper.js\r\n\r\n/**\r\n * @author WestLangley / http://github.com/WestLangley\r\n */\r\n\r\n// a helper to show the world-axis-aligned bounding box for an object\r\n\r\nTHREE.BoundingBoxHelper = function(object, hex) {\r\n\r\n  var color = (hex !== undefined) ? hex : 0x888888;\r\n\r\n  this.object = object;\r\n\r\n  this.box = new THREE.Box3();\r\n\r\n  THREE.Mesh.call(this, new THREE.BoxGeometry(1, 1, 1), new THREE.MeshBasicMaterial({\r\n    color: color,\r\n    wireframe: true\r\n  }));\r\n\r\n};\r\n\r\nTHREE.BoundingBoxHelper.prototype = Object.create(THREE.Mesh.prototype);\r\nTHREE.BoundingBoxHelper.prototype.constructor = THREE.BoundingBoxHelper;\r\n\r\nTHREE.BoundingBoxHelper.prototype.update = function() {\r\n\r\n  this.box.setFromObject(this.object);\r\n\r\n  this.box.size(this.scale);\r\n\r\n  this.box.center(this.position);\r\n\r\n};\r\n\r\n// File:src/extras/helpers/CameraHelper.js\r\n\r\n/**\r\n * @author alteredq / http://alteredqualia.com/\r\n *\r\n *\t- shows frustum, line of sight and up of the camera\r\n *\t- suitable for fast updates\r\n * \t- based on frustum visualization in lightgl.js shadowmap example\r\n *\t\thttp://evanw.github.com/lightgl.js/tests/shadowmap.html\r\n */\r\n\r\nTHREE.CameraHelper = function(camera) {\r\n\r\n  var geometry = new THREE.Geometry();\r\n  var material = new THREE.LineBasicMaterial({\r\n    color: 0xffffff,\r\n    vertexColors: THREE.FaceColors\r\n  });\r\n\r\n  var pointMap = {};\r\n\r\n  // colors\r\n\r\n  var hexFrustum = 0xffaa00;\r\n  var hexCone = 0xff0000;\r\n  var hexUp = 0x00aaff;\r\n  var hexTarget = 0xffffff;\r\n  var hexCross = 0x333333;\r\n\r\n  // near\r\n\r\n  addLine(\"n1\", \"n2\", hexFrustum);\r\n  addLine(\"n2\", \"n4\", hexFrustum);\r\n  addLine(\"n4\", \"n3\", hexFrustum);\r\n  addLine(\"n3\", \"n1\", hexFrustum);\r\n\r\n  // far\r\n\r\n  addLine(\"f1\", \"f2\", hexFrustum);\r\n  addLine(\"f2\", \"f4\", hexFrustum);\r\n  addLine(\"f4\", \"f3\", hexFrustum);\r\n  addLine(\"f3\", \"f1\", hexFrustum);\r\n\r\n  // sides\r\n\r\n  addLine(\"n1\", \"f1\", hexFrustum);\r\n  addLine(\"n2\", \"f2\", hexFrustum);\r\n  addLine(\"n3\", \"f3\", hexFrustum);\r\n  addLine(\"n4\", \"f4\", hexFrustum);\r\n\r\n  // cone\r\n\r\n  addLine(\"p\", \"n1\", hexCone);\r\n  addLine(\"p\", \"n2\", hexCone);\r\n  addLine(\"p\", \"n3\", hexCone);\r\n  addLine(\"p\", \"n4\", hexCone);\r\n\r\n  // up\r\n\r\n  addLine(\"u1\", \"u2\", hexUp);\r\n  addLine(\"u2\", \"u3\", hexUp);\r\n  addLine(\"u3\", \"u1\", hexUp);\r\n\r\n  // target\r\n\r\n  addLine(\"c\", \"t\", hexTarget);\r\n  addLine(\"p\", \"c\", hexCross);\r\n\r\n  // cross\r\n\r\n  addLine(\"cn1\", \"cn2\", hexCross);\r\n  addLine(\"cn3\", \"cn4\", hexCross);\r\n\r\n  addLine(\"cf1\", \"cf2\", hexCross);\r\n  addLine(\"cf3\", \"cf4\", hexCross);\r\n\r\n  function addLine(a, b, hex) {\r\n\r\n    addPoint(a, hex);\r\n    addPoint(b, hex);\r\n\r\n  }\r\n\r\n  function addPoint(id, hex) {\r\n\r\n    geometry.vertices.push(new THREE.Vector3());\r\n    geometry.colors.push(new THREE.Color(hex));\r\n\r\n    if (pointMap[id] === undefined) {\r\n\r\n      pointMap[id] = [];\r\n\r\n    }\r\n\r\n    pointMap[id].push(geometry.vertices.length - 1);\r\n\r\n  }\r\n\r\n  THREE.Line.call(this, geometry, material, THREE.LinePieces);\r\n\r\n  this.camera = camera;\r\n  this.matrix = camera.matrixWorld;\r\n  this.matrixAutoUpdate = false;\r\n\r\n  this.pointMap = pointMap;\r\n\r\n  this.update();\r\n\r\n};\r\n\r\nTHREE.CameraHelper.prototype = Object.create(THREE.Line.prototype);\r\nTHREE.CameraHelper.prototype.constructor = THREE.CameraHelper;\r\n\r\nTHREE.CameraHelper.prototype.update = function() {\r\n\r\n  var geometry, pointMap;\r\n\r\n  var vector = new THREE.Vector3();\r\n  var camera = new THREE.Camera();\r\n\r\n  var setPoint = function(point, x, y, z) {\r\n\r\n    vector.set(x, y, z).unproject(camera);\r\n\r\n    var points = pointMap[point];\r\n\r\n    if (points !== undefined) {\r\n\r\n      for (var i = 0, il = points.length; i < il; i++) {\r\n\r\n        geometry.vertices[points[i]].copy(vector);\r\n\r\n      }\r\n\r\n    }\r\n\r\n  };\r\n\r\n  return function() {\r\n\r\n    geometry = this.geometry;\r\n    pointMap = this.pointMap;\r\n\r\n    var w = 1,\r\n      h = 1;\r\n\r\n    // we need just camera projection matrix\r\n    // world matrix must be identity\r\n\r\n    camera.projectionMatrix.copy(this.camera.projectionMatrix);\r\n\r\n    // center / target\r\n\r\n    setPoint(\"c\", 0, 0, -1);\r\n    setPoint(\"t\", 0, 0, 1);\r\n\r\n    // near\r\n\r\n    setPoint(\"n1\", -w, -h, -1);\r\n    setPoint(\"n2\", w, -h, -1);\r\n    setPoint(\"n3\", -w, h, -1);\r\n    setPoint(\"n4\", w, h, -1);\r\n\r\n    // far\r\n\r\n    setPoint(\"f1\", -w, -h, 1);\r\n    setPoint(\"f2\", w, -h, 1);\r\n    setPoint(\"f3\", -w, h, 1);\r\n    setPoint(\"f4\", w, h, 1);\r\n\r\n    // up\r\n\r\n    setPoint(\"u1\", w * 0.7, h * 1.1, -1);\r\n    setPoint(\"u2\", -w * 0.7, h * 1.1, -1);\r\n    setPoint(\"u3\", 0, h * 2, -1);\r\n\r\n    // cross\r\n\r\n    setPoint(\"cf1\", -w, 0, 1);\r\n    setPoint(\"cf2\", w, 0, 1);\r\n    setPoint(\"cf3\", 0, -h, 1);\r\n    setPoint(\"cf4\", 0, h, 1);\r\n\r\n    setPoint(\"cn1\", -w, 0, -1);\r\n    setPoint(\"cn2\", w, 0, -1);\r\n    setPoint(\"cn3\", 0, -h, -1);\r\n    setPoint(\"cn4\", 0, h, -1);\r\n\r\n    geometry.verticesNeedUpdate = true;\r\n\r\n  };\r\n\r\n}();\r\n\r\n// File:src/extras/helpers/DirectionalLightHelper.js\r\n\r\n/**\r\n * @author alteredq / http://alteredqualia.com/\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author WestLangley / http://github.com/WestLangley\r\n */\r\n\r\nTHREE.DirectionalLightHelper = function(light, size) {\r\n\r\n  THREE.Object3D.call(this);\r\n\r\n  this.light = light;\r\n  this.light.updateMatrixWorld();\r\n\r\n  this.matrix = light.matrixWorld;\r\n  this.matrixAutoUpdate = false;\r\n\r\n  size = size || 1;\r\n\r\n  var geometry = new THREE.Geometry();\r\n  geometry.vertices.push(\r\n    new THREE.Vector3(-size, size, 0),\r\n    new THREE.Vector3(size, size, 0),\r\n    new THREE.Vector3(size, -size, 0),\r\n    new THREE.Vector3(-size, -size, 0),\r\n    new THREE.Vector3(-size, size, 0)\r\n  );\r\n\r\n  var material = new THREE.LineBasicMaterial({\r\n    fog: false\r\n  });\r\n  material.color.copy(this.light.color).multiplyScalar(this.light.intensity);\r\n\r\n  this.lightPlane = new THREE.Line(geometry, material);\r\n  this.add(this.lightPlane);\r\n\r\n  geometry = new THREE.Geometry();\r\n  geometry.vertices.push(\r\n    new THREE.Vector3(),\r\n    new THREE.Vector3()\r\n  );\r\n\r\n  material = new THREE.LineBasicMaterial({\r\n    fog: false\r\n  });\r\n  material.color.copy(this.light.color).multiplyScalar(this.light.intensity);\r\n\r\n  this.targetLine = new THREE.Line(geometry, material);\r\n  this.add(this.targetLine);\r\n\r\n  this.update();\r\n\r\n};\r\n\r\nTHREE.DirectionalLightHelper.prototype = Object.create(THREE.Object3D.prototype);\r\nTHREE.DirectionalLightHelper.prototype.constructor = THREE.DirectionalLightHelper;\r\n\r\nTHREE.DirectionalLightHelper.prototype.dispose = function() {\r\n\r\n  this.lightPlane.geometry.dispose();\r\n  this.lightPlane.material.dispose();\r\n  this.targetLine.geometry.dispose();\r\n  this.targetLine.material.dispose();\r\n};\r\n\r\nTHREE.DirectionalLightHelper.prototype.update = function() {\r\n\r\n  var v1 = new THREE.Vector3();\r\n  var v2 = new THREE.Vector3();\r\n  var v3 = new THREE.Vector3();\r\n\r\n  return function() {\r\n\r\n    v1.setFromMatrixPosition(this.light.matrixWorld);\r\n    v2.setFromMatrixPosition(this.light.target.matrixWorld);\r\n    v3.subVectors(v2, v1);\r\n\r\n    this.lightPlane.lookAt(v3);\r\n    this.lightPlane.material.color.copy(this.light.color).multiplyScalar(this.light.intensity);\r\n\r\n    this.targetLine.geometry.vertices[1].copy(v3);\r\n    this.targetLine.geometry.verticesNeedUpdate = true;\r\n    this.targetLine.material.color.copy(this.lightPlane.material.color);\r\n\r\n  };\r\n\r\n}();\r\n\r\n// File:src/extras/helpers/EdgesHelper.js\r\n\r\n/**\r\n * @author WestLangley / http://github.com/WestLangley\r\n * @param object THREE.Mesh whose geometry will be used\r\n * @param hex line color\r\n * @param thresholdAngle the minimim angle (in degrees),\r\n * between the face normals of adjacent faces,\r\n * that is required to render an edge. A value of 10 means\r\n * an edge is only rendered if the angle is at least 10 degrees.\r\n */\r\n\r\nTHREE.EdgesHelper = function(object, hex, thresholdAngle) {\r\n\r\n  var color = (hex !== undefined) ? hex : 0xffffff;\r\n  thresholdAngle = (thresholdAngle !== undefined) ? thresholdAngle : 1;\r\n\r\n  var thresholdDot = Math.cos(THREE.Math.degToRad(thresholdAngle));\r\n\r\n  var edge = [0, 0],\r\n    hash = {};\r\n  var sortFunction = function(a, b) {\r\n    return a - b\r\n  };\r\n\r\n  var keys = ['a', 'b', 'c'];\r\n  var geometry = new THREE.BufferGeometry();\r\n\r\n  var geometry2;\r\n\r\n  if (object.geometry instanceof THREE.BufferGeometry) {\r\n\r\n    geometry2 = new THREE.Geometry();\r\n    geometry2.fromBufferGeometry(object.geometry);\r\n\r\n  }\r\n  else {\r\n\r\n    geometry2 = object.geometry.clone();\r\n\r\n  }\r\n\r\n  geometry2.mergeVertices();\r\n  geometry2.computeFaceNormals();\r\n\r\n  var vertices = geometry2.vertices;\r\n  var faces = geometry2.faces;\r\n  var numEdges = 0;\r\n\r\n  for (var i = 0, l = faces.length; i < l; i++) {\r\n\r\n    var face = faces[i];\r\n\r\n    for (var j = 0; j < 3; j++) {\r\n\r\n      edge[0] = face[keys[j]];\r\n      edge[1] = face[keys[(j + 1) % 3]];\r\n      edge.sort(sortFunction);\r\n\r\n      var key = edge.toString();\r\n\r\n      if (hash[key] === undefined) {\r\n\r\n        hash[key] = {\r\n          vert1: edge[0],\r\n          vert2: edge[1],\r\n          face1: i,\r\n          face2: undefined\r\n        };\r\n        numEdges++;\r\n\r\n      }\r\n      else {\r\n\r\n        hash[key].face2 = i;\r\n\r\n      }\r\n\r\n    }\r\n\r\n  }\r\n\r\n  var coords = new Float32Array(numEdges * 2 * 3);\r\n\r\n  var index = 0;\r\n\r\n  for (var key in hash) {\r\n\r\n    var h = hash[key];\r\n\r\n    if (h.face2 === undefined || faces[h.face1].normal.dot(faces[h.face2].normal) <= thresholdDot) {\r\n\r\n      var vertex = vertices[h.vert1];\r\n      coords[index++] = vertex.x;\r\n      coords[index++] = vertex.y;\r\n      coords[index++] = vertex.z;\r\n\r\n      vertex = vertices[h.vert2];\r\n      coords[index++] = vertex.x;\r\n      coords[index++] = vertex.y;\r\n      coords[index++] = vertex.z;\r\n\r\n    }\r\n\r\n  }\r\n\r\n  geometry.addAttribute('position', new THREE.BufferAttribute(coords, 3));\r\n\r\n  THREE.Line.call(this, geometry, new THREE.LineBasicMaterial({\r\n    color: color\r\n  }), THREE.LinePieces);\r\n\r\n  this.matrix = object.matrixWorld;\r\n  this.matrixAutoUpdate = false;\r\n\r\n};\r\n\r\nTHREE.EdgesHelper.prototype = Object.create(THREE.Line.prototype);\r\nTHREE.EdgesHelper.prototype.constructor = THREE.EdgesHelper;\r\n\r\n// File:src/extras/helpers/FaceNormalsHelper.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author WestLangley / http://github.com/WestLangley\r\n */\r\n\r\nTHREE.FaceNormalsHelper = function(object, size, hex, linewidth) {\r\n\r\n  this.object = object;\r\n\r\n  this.size = (size !== undefined) ? size : 1;\r\n\r\n  var color = (hex !== undefined) ? hex : 0xffff00;\r\n\r\n  var width = (linewidth !== undefined) ? linewidth : 1;\r\n\r\n  var geometry = new THREE.Geometry();\r\n\r\n  var faces = this.object.geometry.faces;\r\n\r\n  for (var i = 0, l = faces.length; i < l; i++) {\r\n\r\n    geometry.vertices.push(new THREE.Vector3(), new THREE.Vector3());\r\n\r\n  }\r\n\r\n  THREE.Line.call(this, geometry, new THREE.LineBasicMaterial({\r\n    color: color,\r\n    linewidth: width\r\n  }), THREE.LinePieces);\r\n\r\n  this.matrixAutoUpdate = false;\r\n\r\n  this.normalMatrix = new THREE.Matrix3();\r\n\r\n  this.update();\r\n\r\n};\r\n\r\nTHREE.FaceNormalsHelper.prototype = Object.create(THREE.Line.prototype);\r\nTHREE.FaceNormalsHelper.prototype.constructor = THREE.FaceNormalsHelper;\r\n\r\nTHREE.FaceNormalsHelper.prototype.update = function() {\r\n\r\n  var vertices = this.geometry.vertices;\r\n\r\n  var object = this.object;\r\n  var objectVertices = object.geometry.vertices;\r\n  var objectFaces = object.geometry.faces;\r\n  var objectWorldMatrix = object.matrixWorld;\r\n\r\n  object.updateMatrixWorld(true);\r\n\r\n  this.normalMatrix.getNormalMatrix(objectWorldMatrix);\r\n\r\n  for (var i = 0, i2 = 0, l = objectFaces.length; i < l; i++, i2 += 2) {\r\n\r\n    var face = objectFaces[i];\r\n\r\n    vertices[i2].copy(objectVertices[face.a])\r\n      .add(objectVertices[face.b])\r\n      .add(objectVertices[face.c])\r\n      .divideScalar(3)\r\n      .applyMatrix4(objectWorldMatrix);\r\n\r\n    vertices[i2 + 1].copy(face.normal)\r\n      .applyMatrix3(this.normalMatrix)\r\n      .normalize()\r\n      .multiplyScalar(this.size)\r\n      .add(vertices[i2]);\r\n\r\n  }\r\n\r\n  this.geometry.verticesNeedUpdate = true;\r\n\r\n  return this;\r\n\r\n};\r\n\r\n\r\n// File:src/extras/helpers/GridHelper.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.GridHelper = function(size, step) {\r\n\r\n  var geometry = new THREE.Geometry();\r\n  var material = new THREE.LineBasicMaterial({\r\n    vertexColors: THREE.VertexColors\r\n  });\r\n\r\n  this.color1 = new THREE.Color(0x444444);\r\n  this.color2 = new THREE.Color(0x888888);\r\n\r\n  for (var i = -size; i <= size; i += step) {\r\n\r\n    geometry.vertices.push(\r\n      new THREE.Vector3(-size, 0, i), new THREE.Vector3(size, 0, i),\r\n      new THREE.Vector3(i, 0, -size), new THREE.Vector3(i, 0, size)\r\n    );\r\n\r\n    var color = i === 0 ? this.color1 : this.color2;\r\n\r\n    geometry.colors.push(color, color, color, color);\r\n\r\n  }\r\n\r\n  THREE.Line.call(this, geometry, material, THREE.LinePieces);\r\n\r\n};\r\n\r\nTHREE.GridHelper.prototype = Object.create(THREE.Line.prototype);\r\nTHREE.GridHelper.prototype.constructor = THREE.GridHelper;\r\n\r\nTHREE.GridHelper.prototype.setColors = function(colorCenterLine, colorGrid) {\r\n\r\n  this.color1.set(colorCenterLine);\r\n  this.color2.set(colorGrid);\r\n\r\n  this.geometry.colorsNeedUpdate = true;\r\n\r\n}\r\n\r\n// File:src/extras/helpers/HemisphereLightHelper.js\r\n\r\n/**\r\n * @author alteredq / http://alteredqualia.com/\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.HemisphereLightHelper = function(light, sphereSize) {\r\n\r\n  THREE.Object3D.call(this);\r\n\r\n  this.light = light;\r\n  this.light.updateMatrixWorld();\r\n\r\n  this.matrix = light.matrixWorld;\r\n  this.matrixAutoUpdate = false;\r\n\r\n  this.colors = [new THREE.Color(), new THREE.Color()];\r\n\r\n  var geometry = new THREE.SphereGeometry(sphereSize, 4, 2);\r\n  geometry.applyMatrix(new THREE.Matrix4().makeRotationX(-Math.PI / 2));\r\n\r\n  for (var i = 0, il = 8; i < il; i++) {\r\n\r\n    geometry.faces[i].color = this.colors[i < 4 ? 0 : 1];\r\n\r\n  }\r\n\r\n  var material = new THREE.MeshBasicMaterial({\r\n    vertexColors: THREE.FaceColors,\r\n    wireframe: true\r\n  });\r\n\r\n  this.lightSphere = new THREE.Mesh(geometry, material);\r\n  this.add(this.lightSphere);\r\n\r\n  this.update();\r\n\r\n};\r\n\r\nTHREE.HemisphereLightHelper.prototype = Object.create(THREE.Object3D.prototype);\r\nTHREE.HemisphereLightHelper.prototype.constructor = THREE.HemisphereLightHelper;\r\n\r\nTHREE.HemisphereLightHelper.prototype.dispose = function() {\r\n  this.lightSphere.geometry.dispose();\r\n  this.lightSphere.material.dispose();\r\n};\r\n\r\nTHREE.HemisphereLightHelper.prototype.update = function() {\r\n\r\n  var vector = new THREE.Vector3();\r\n\r\n  return function() {\r\n\r\n    this.colors[0].copy(this.light.color).multiplyScalar(this.light.intensity);\r\n    this.colors[1].copy(this.light.groundColor).multiplyScalar(this.light.intensity);\r\n\r\n    this.lightSphere.lookAt(vector.setFromMatrixPosition(this.light.matrixWorld).negate());\r\n    this.lightSphere.geometry.colorsNeedUpdate = true;\r\n\r\n  }\r\n\r\n}();\r\n\r\n// File:src/extras/helpers/PointLightHelper.js\r\n\r\n/**\r\n * @author alteredq / http://alteredqualia.com/\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.PointLightHelper = function(light, sphereSize) {\r\n\r\n  this.light = light;\r\n  this.light.updateMatrixWorld();\r\n\r\n  var geometry = new THREE.SphereGeometry(sphereSize, 4, 2);\r\n  var material = new THREE.MeshBasicMaterial({\r\n    wireframe: true,\r\n    fog: false\r\n  });\r\n  material.color.copy(this.light.color).multiplyScalar(this.light.intensity);\r\n\r\n  THREE.Mesh.call(this, geometry, material);\r\n\r\n  this.matrix = this.light.matrixWorld;\r\n  this.matrixAutoUpdate = false;\r\n\r\n  /*\r\n  var distanceGeometry = new THREE.IcosahedronGeometry( 1, 2 );\r\n  var distanceMaterial = new THREE.MeshBasicMaterial( { color: hexColor, fog: false, wireframe: true, opacity: 0.1, transparent: true } );\r\n\r\n  this.lightSphere = new THREE.Mesh( bulbGeometry, bulbMaterial );\r\n  this.lightDistance = new THREE.Mesh( distanceGeometry, distanceMaterial );\r\n\r\n  var d = light.distance;\r\n\r\n  if ( d === 0.0 ) {\r\n\r\n  \tthis.lightDistance.visible = false;\r\n\r\n  } else {\r\n\r\n  \tthis.lightDistance.scale.set( d, d, d );\r\n\r\n  }\r\n\r\n  this.add( this.lightDistance );\r\n  */\r\n\r\n};\r\n\r\nTHREE.PointLightHelper.prototype = Object.create(THREE.Mesh.prototype);\r\nTHREE.PointLightHelper.prototype.constructor = THREE.PointLightHelper;\r\n\r\nTHREE.PointLightHelper.prototype.dispose = function() {\r\n\r\n  this.geometry.dispose();\r\n  this.material.dispose();\r\n};\r\n\r\nTHREE.PointLightHelper.prototype.update = function() {\r\n\r\n  this.material.color.copy(this.light.color).multiplyScalar(this.light.intensity);\r\n\r\n  /*\r\n  var d = this.light.distance;\r\n\r\n  if ( d === 0.0 ) {\r\n\r\n  \tthis.lightDistance.visible = false;\r\n\r\n  } else {\r\n\r\n  \tthis.lightDistance.visible = true;\r\n  \tthis.lightDistance.scale.set( d, d, d );\r\n\r\n  }\r\n  */\r\n\r\n};\r\n\r\n// File:src/extras/helpers/SkeletonHelper.js\r\n\r\n/**\r\n * @author Sean Griffin / http://twitter.com/sgrif\r\n * @author Michael Guerrero / http://realitymeltdown.com\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author ikerr / http://verold.com\r\n */\r\n\r\nTHREE.SkeletonHelper = function(object) {\r\n\r\n  this.bones = this.getBoneList(object);\r\n\r\n  var geometry = new THREE.Geometry();\r\n\r\n  for (var i = 0; i < this.bones.length; i++) {\r\n\r\n    var bone = this.bones[i];\r\n\r\n    if (bone.parent instanceof THREE.Bone) {\r\n\r\n      geometry.vertices.push(new THREE.Vector3());\r\n      geometry.vertices.push(new THREE.Vector3());\r\n      geometry.colors.push(new THREE.Color(0, 0, 1));\r\n      geometry.colors.push(new THREE.Color(0, 1, 0));\r\n\r\n    }\r\n\r\n  }\r\n\r\n  var material = new THREE.LineBasicMaterial({\r\n    vertexColors: THREE.VertexColors,\r\n    depthTest: false,\r\n    depthWrite: false,\r\n    transparent: true\r\n  });\r\n\r\n  THREE.Line.call(this, geometry, material, THREE.LinePieces);\r\n\r\n  this.root = object;\r\n\r\n  this.matrix = object.matrixWorld;\r\n  this.matrixAutoUpdate = false;\r\n\r\n  this.update();\r\n\r\n};\r\n\r\n\r\nTHREE.SkeletonHelper.prototype = Object.create(THREE.Line.prototype);\r\nTHREE.SkeletonHelper.prototype.constructor = THREE.SkeletonHelper;\r\n\r\nTHREE.SkeletonHelper.prototype.getBoneList = function(object) {\r\n\r\n  var boneList = [];\r\n\r\n  if (object instanceof THREE.Bone) {\r\n\r\n    boneList.push(object);\r\n\r\n  }\r\n\r\n  for (var i = 0; i < object.children.length; i++) {\r\n\r\n    boneList.push.apply(boneList, this.getBoneList(object.children[i]));\r\n\r\n  }\r\n\r\n  return boneList;\r\n\r\n};\r\n\r\nTHREE.SkeletonHelper.prototype.update = function() {\r\n\r\n  var geometry = this.geometry;\r\n\r\n  var matrixWorldInv = new THREE.Matrix4().getInverse(this.root.matrixWorld);\r\n\r\n  var boneMatrix = new THREE.Matrix4();\r\n\r\n  var j = 0;\r\n\r\n  for (var i = 0; i < this.bones.length; i++) {\r\n\r\n    var bone = this.bones[i];\r\n\r\n    if (bone.parent instanceof THREE.Bone) {\r\n\r\n      boneMatrix.multiplyMatrices(matrixWorldInv, bone.matrixWorld);\r\n      geometry.vertices[j].setFromMatrixPosition(boneMatrix);\r\n\r\n      boneMatrix.multiplyMatrices(matrixWorldInv, bone.parent.matrixWorld);\r\n      geometry.vertices[j + 1].setFromMatrixPosition(boneMatrix);\r\n\r\n      j += 2;\r\n\r\n    }\r\n\r\n  }\r\n\r\n  geometry.verticesNeedUpdate = true;\r\n\r\n  geometry.computeBoundingSphere();\r\n\r\n};\r\n\r\n// File:src/extras/helpers/SpotLightHelper.js\r\n\r\n/**\r\n * @author alteredq / http://alteredqualia.com/\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author WestLangley / http://github.com/WestLangley\r\n */\r\n\r\nTHREE.SpotLightHelper = function(light) {\r\n\r\n  THREE.Object3D.call(this);\r\n\r\n  this.light = light;\r\n  this.light.updateMatrixWorld();\r\n\r\n  this.matrix = light.matrixWorld;\r\n  this.matrixAutoUpdate = false;\r\n\r\n  var geometry = new THREE.CylinderGeometry(0, 1, 1, 8, 1, true);\r\n\r\n  geometry.applyMatrix(new THREE.Matrix4().makeTranslation(0, -0.5, 0));\r\n  geometry.applyMatrix(new THREE.Matrix4().makeRotationX(-Math.PI / 2));\r\n\r\n  var material = new THREE.MeshBasicMaterial({\r\n    wireframe: true,\r\n    fog: false\r\n  });\r\n\r\n  this.cone = new THREE.Mesh(geometry, material);\r\n  this.add(this.cone);\r\n\r\n  this.update();\r\n\r\n};\r\n\r\nTHREE.SpotLightHelper.prototype = Object.create(THREE.Object3D.prototype);\r\nTHREE.SpotLightHelper.prototype.constructor = THREE.SpotLightHelper;\r\n\r\nTHREE.SpotLightHelper.prototype.dispose = function() {\r\n  this.cone.geometry.dispose();\r\n  this.cone.material.dispose();\r\n};\r\n\r\nTHREE.SpotLightHelper.prototype.update = function() {\r\n\r\n  var vector = new THREE.Vector3();\r\n  var vector2 = new THREE.Vector3();\r\n\r\n  return function() {\r\n\r\n    var coneLength = this.light.distance ? this.light.distance : 10000;\r\n    var coneWidth = coneLength * Math.tan(this.light.angle);\r\n\r\n    this.cone.scale.set(coneWidth, coneWidth, coneLength);\r\n\r\n    vector.setFromMatrixPosition(this.light.matrixWorld);\r\n    vector2.setFromMatrixPosition(this.light.target.matrixWorld);\r\n\r\n    this.cone.lookAt(vector2.sub(vector));\r\n\r\n    this.cone.material.color.copy(this.light.color).multiplyScalar(this.light.intensity);\r\n\r\n  };\r\n\r\n}();\r\n\r\n// File:src/extras/helpers/VertexNormalsHelper.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author WestLangley / http://github.com/WestLangley\r\n */\r\n\r\nTHREE.VertexNormalsHelper = function(object, size, hex, linewidth) {\r\n\r\n  this.object = object;\r\n\r\n  this.size = (size !== undefined) ? size : 1;\r\n\r\n  var color = (hex !== undefined) ? hex : 0xff0000;\r\n\r\n  var width = (linewidth !== undefined) ? linewidth : 1;\r\n\r\n  var geometry = new THREE.Geometry();\r\n\r\n  var faces = object.geometry.faces;\r\n\r\n  for (var i = 0, l = faces.length; i < l; i++) {\r\n\r\n    var face = faces[i];\r\n\r\n    for (var j = 0, jl = face.vertexNormals.length; j < jl; j++) {\r\n\r\n      geometry.vertices.push(new THREE.Vector3(), new THREE.Vector3());\r\n\r\n    }\r\n\r\n  }\r\n\r\n  THREE.Line.call(this, geometry, new THREE.LineBasicMaterial({\r\n    color: color,\r\n    linewidth: width\r\n  }), THREE.LinePieces);\r\n\r\n  this.matrixAutoUpdate = false;\r\n\r\n  this.normalMatrix = new THREE.Matrix3();\r\n\r\n  this.update();\r\n\r\n};\r\n\r\nTHREE.VertexNormalsHelper.prototype = Object.create(THREE.Line.prototype);\r\nTHREE.VertexNormalsHelper.prototype.constructor = THREE.VertexNormalsHelper;\r\n\r\nTHREE.VertexNormalsHelper.prototype.update = (function(object) {\r\n\r\n  var v1 = new THREE.Vector3();\r\n\r\n  return function(object) {\r\n\r\n    var keys = ['a', 'b', 'c', 'd'];\r\n\r\n    this.object.updateMatrixWorld(true);\r\n\r\n    this.normalMatrix.getNormalMatrix(this.object.matrixWorld);\r\n\r\n    var vertices = this.geometry.vertices;\r\n\r\n    var verts = this.object.geometry.vertices;\r\n\r\n    var faces = this.object.geometry.faces;\r\n\r\n    var worldMatrix = this.object.matrixWorld;\r\n\r\n    var idx = 0;\r\n\r\n    for (var i = 0, l = faces.length; i < l; i++) {\r\n\r\n      var face = faces[i];\r\n\r\n      for (var j = 0, jl = face.vertexNormals.length; j < jl; j++) {\r\n\r\n        var vertexId = face[keys[j]];\r\n        var vertex = verts[vertexId];\r\n\r\n        var normal = face.vertexNormals[j];\r\n\r\n        vertices[idx].copy(vertex).applyMatrix4(worldMatrix);\r\n\r\n        v1.copy(normal).applyMatrix3(this.normalMatrix).normalize().multiplyScalar(this.size);\r\n\r\n        v1.add(vertices[idx]);\r\n        idx = idx + 1;\r\n\r\n        vertices[idx].copy(v1);\r\n        idx = idx + 1;\r\n\r\n      }\r\n\r\n    }\r\n\r\n    this.geometry.verticesNeedUpdate = true;\r\n\r\n    return this;\r\n\r\n  }\r\n\r\n}());\r\n\r\n// File:src/extras/helpers/VertexTangentsHelper.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author WestLangley / http://github.com/WestLangley\r\n */\r\n\r\nTHREE.VertexTangentsHelper = function(object, size, hex, linewidth) {\r\n\r\n  this.object = object;\r\n\r\n  this.size = (size !== undefined) ? size : 1;\r\n\r\n  var color = (hex !== undefined) ? hex : 0x0000ff;\r\n\r\n  var width = (linewidth !== undefined) ? linewidth : 1;\r\n\r\n  var geometry = new THREE.Geometry();\r\n\r\n  var faces = object.geometry.faces;\r\n\r\n  for (var i = 0, l = faces.length; i < l; i++) {\r\n\r\n    var face = faces[i];\r\n\r\n    for (var j = 0, jl = face.vertexTangents.length; j < jl; j++) {\r\n\r\n      geometry.vertices.push(new THREE.Vector3());\r\n      geometry.vertices.push(new THREE.Vector3());\r\n\r\n    }\r\n\r\n  }\r\n\r\n  THREE.Line.call(this, geometry, new THREE.LineBasicMaterial({\r\n    color: color,\r\n    linewidth: width\r\n  }), THREE.LinePieces);\r\n\r\n  this.matrixAutoUpdate = false;\r\n\r\n  this.update();\r\n\r\n};\r\n\r\nTHREE.VertexTangentsHelper.prototype = Object.create(THREE.Line.prototype);\r\nTHREE.VertexTangentsHelper.prototype.constructor = THREE.VertexTangentsHelper;\r\n\r\nTHREE.VertexTangentsHelper.prototype.update = (function(object) {\r\n\r\n  var v1 = new THREE.Vector3();\r\n\r\n  return function(object) {\r\n\r\n    var keys = ['a', 'b', 'c', 'd'];\r\n\r\n    this.object.updateMatrixWorld(true);\r\n\r\n    var vertices = this.geometry.vertices;\r\n\r\n    var verts = this.object.geometry.vertices;\r\n\r\n    var faces = this.object.geometry.faces;\r\n\r\n    var worldMatrix = this.object.matrixWorld;\r\n\r\n    var idx = 0;\r\n\r\n    for (var i = 0, l = faces.length; i < l; i++) {\r\n\r\n      var face = faces[i];\r\n\r\n      for (var j = 0, jl = face.vertexTangents.length; j < jl; j++) {\r\n\r\n        var vertexId = face[keys[j]];\r\n        var vertex = verts[vertexId];\r\n\r\n        var tangent = face.vertexTangents[j];\r\n\r\n        vertices[idx].copy(vertex).applyMatrix4(worldMatrix);\r\n\r\n        v1.copy(tangent).transformDirection(worldMatrix).multiplyScalar(this.size);\r\n\r\n        v1.add(vertices[idx]);\r\n        idx = idx + 1;\r\n\r\n        vertices[idx].copy(v1);\r\n        idx = idx + 1;\r\n\r\n      }\r\n\r\n    }\r\n\r\n    this.geometry.verticesNeedUpdate = true;\r\n\r\n    return this;\r\n\r\n  }\r\n\r\n}());\r\n\r\n// File:src/extras/helpers/WireframeHelper.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.WireframeHelper = function(object, hex) {\r\n\r\n  var color = (hex !== undefined) ? hex : 0xffffff;\r\n\r\n  var edge = [0, 0],\r\n    hash = {};\r\n  var sortFunction = function(a, b) {\r\n    return a - b\r\n  };\r\n\r\n  var keys = ['a', 'b', 'c'];\r\n  var geometry = new THREE.BufferGeometry();\r\n\r\n  if (object.geometry instanceof THREE.Geometry) {\r\n\r\n    var vertices = object.geometry.vertices;\r\n    var faces = object.geometry.faces;\r\n    var numEdges = 0;\r\n\r\n    // allocate maximal size\r\n    var edges = new Uint32Array(6 * faces.length);\r\n\r\n    for (var i = 0, l = faces.length; i < l; i++) {\r\n\r\n      var face = faces[i];\r\n\r\n      for (var j = 0; j < 3; j++) {\r\n\r\n        edge[0] = face[keys[j]];\r\n        edge[1] = face[keys[(j + 1) % 3]];\r\n        edge.sort(sortFunction);\r\n\r\n        var key = edge.toString();\r\n\r\n        if (hash[key] === undefined) {\r\n\r\n          edges[2 * numEdges] = edge[0];\r\n          edges[2 * numEdges + 1] = edge[1];\r\n          hash[key] = true;\r\n          numEdges++;\r\n\r\n        }\r\n\r\n      }\r\n\r\n    }\r\n\r\n    var coords = new Float32Array(numEdges * 2 * 3);\r\n\r\n    for (var i = 0, l = numEdges; i < l; i++) {\r\n\r\n      for (var j = 0; j < 2; j++) {\r\n\r\n        var vertex = vertices[edges[2 * i + j]];\r\n\r\n        var index = 6 * i + 3 * j;\r\n        coords[index + 0] = vertex.x;\r\n        coords[index + 1] = vertex.y;\r\n        coords[index + 2] = vertex.z;\r\n\r\n      }\r\n\r\n    }\r\n\r\n    geometry.addAttribute('position', new THREE.BufferAttribute(coords, 3));\r\n\r\n  }\r\n  else if (object.geometry instanceof THREE.BufferGeometry) {\r\n\r\n    if (object.geometry.attributes.index !== undefined) { // Indexed BufferGeometry\r\n\r\n      var vertices = object.geometry.attributes.position.array;\r\n      var indices = object.geometry.attributes.index.array;\r\n      var drawcalls = object.geometry.drawcalls;\r\n      var numEdges = 0;\r\n\r\n      if (drawcalls.length === 0) {\r\n\r\n        drawcalls = [{\r\n          count: indices.length,\r\n          index: 0,\r\n          start: 0\r\n        }];\r\n\r\n      }\r\n\r\n      // allocate maximal size\r\n      var edges = new Uint32Array(2 * indices.length);\r\n\r\n      for (var o = 0, ol = drawcalls.length; o < ol; ++o) {\r\n\r\n        var start = drawcalls[o].start;\r\n        var count = drawcalls[o].count;\r\n        var index = drawcalls[o].index;\r\n\r\n        for (var i = start, il = start + count; i < il; i += 3) {\r\n\r\n          for (var j = 0; j < 3; j++) {\r\n\r\n            edge[0] = index + indices[i + j];\r\n            edge[1] = index + indices[i + (j + 1) % 3];\r\n            edge.sort(sortFunction);\r\n\r\n            var key = edge.toString();\r\n\r\n            if (hash[key] === undefined) {\r\n\r\n              edges[2 * numEdges] = edge[0];\r\n              edges[2 * numEdges + 1] = edge[1];\r\n              hash[key] = true;\r\n              numEdges++;\r\n\r\n            }\r\n\r\n          }\r\n\r\n        }\r\n\r\n      }\r\n\r\n      var coords = new Float32Array(numEdges * 2 * 3);\r\n\r\n      for (var i = 0, l = numEdges; i < l; i++) {\r\n\r\n        for (var j = 0; j < 2; j++) {\r\n\r\n          var index = 6 * i + 3 * j;\r\n          var index2 = 3 * edges[2 * i + j];\r\n          coords[index + 0] = vertices[index2];\r\n          coords[index + 1] = vertices[index2 + 1];\r\n          coords[index + 2] = vertices[index2 + 2];\r\n\r\n        }\r\n\r\n      }\r\n\r\n      geometry.addAttribute('position', new THREE.BufferAttribute(coords, 3));\r\n\r\n    }\r\n    else { // non-indexed BufferGeometry\r\n\r\n      var vertices = object.geometry.attributes.position.array;\r\n      var numEdges = vertices.length / 3;\r\n      var numTris = numEdges / 3;\r\n\r\n      var coords = new Float32Array(numEdges * 2 * 3);\r\n\r\n      for (var i = 0, l = numTris; i < l; i++) {\r\n\r\n        for (var j = 0; j < 3; j++) {\r\n\r\n          var index = 18 * i + 6 * j;\r\n\r\n          var index1 = 9 * i + 3 * j;\r\n          coords[index + 0] = vertices[index1];\r\n          coords[index + 1] = vertices[index1 + 1];\r\n          coords[index + 2] = vertices[index1 + 2];\r\n\r\n          var index2 = 9 * i + 3 * ((j + 1) % 3);\r\n          coords[index + 3] = vertices[index2];\r\n          coords[index + 4] = vertices[index2 + 1];\r\n          coords[index + 5] = vertices[index2 + 2];\r\n\r\n        }\r\n\r\n      }\r\n\r\n      geometry.addAttribute('position', new THREE.BufferAttribute(coords, 3));\r\n\r\n    }\r\n\r\n  }\r\n\r\n  THREE.Line.call(this, geometry, new THREE.LineBasicMaterial({\r\n    color: color\r\n  }), THREE.LinePieces);\r\n\r\n  this.matrix = object.matrixWorld;\r\n  this.matrixAutoUpdate = false;\r\n\r\n};\r\n\r\nTHREE.WireframeHelper.prototype = Object.create(THREE.Line.prototype);\r\nTHREE.WireframeHelper.prototype.constructor = THREE.WireframeHelper;\r\n\r\n// File:src/extras/objects/ImmediateRenderObject.js\r\n\r\n/**\r\n * @author alteredq / http://alteredqualia.com/\r\n */\r\n\r\nTHREE.ImmediateRenderObject = function() {\r\n\r\n  THREE.Object3D.call(this);\r\n\r\n  this.render = function(renderCallback) {};\r\n\r\n};\r\n\r\nTHREE.ImmediateRenderObject.prototype = Object.create(THREE.Object3D.prototype);\r\nTHREE.ImmediateRenderObject.prototype.constructor = THREE.ImmediateRenderObject;\r\n\r\n// File:src/extras/objects/MorphBlendMesh.js\r\n\r\n/**\r\n * @author alteredq / http://alteredqualia.com/\r\n */\r\n\r\nTHREE.MorphBlendMesh = function(geometry, material) {\r\n\r\n  THREE.Mesh.call(this, geometry, material);\r\n\r\n  this.animationsMap = {};\r\n  this.animationsList = [];\r\n\r\n  // prepare default animation\r\n  // (all frames played together in 1 second)\r\n\r\n  var numFrames = this.geometry.morphTargets.length;\r\n\r\n  var name = \"__default\";\r\n\r\n  var startFrame = 0;\r\n  var endFrame = numFrames - 1;\r\n\r\n  var fps = numFrames / 1;\r\n\r\n  this.createAnimation(name, startFrame, endFrame, fps);\r\n  this.setAnimationWeight(name, 1);\r\n\r\n};\r\n\r\nTHREE.MorphBlendMesh.prototype = Object.create(THREE.Mesh.prototype);\r\nTHREE.MorphBlendMesh.prototype.constructor = THREE.MorphBlendMesh;\r\n\r\nTHREE.MorphBlendMesh.prototype.createAnimation = function(name, start, end, fps) {\r\n\r\n  var animation = {\r\n\r\n    startFrame: start,\r\n    endFrame: end,\r\n\r\n    length: end - start + 1,\r\n\r\n    fps: fps,\r\n    duration: (end - start) / fps,\r\n\r\n    lastFrame: 0,\r\n    currentFrame: 0,\r\n\r\n    active: false,\r\n\r\n    time: 0,\r\n    direction: 1,\r\n    weight: 1,\r\n\r\n    directionBackwards: false,\r\n    mirroredLoop: false\r\n\r\n  };\r\n\r\n  this.animationsMap[name] = animation;\r\n  this.animationsList.push(animation);\r\n\r\n};\r\n\r\nTHREE.MorphBlendMesh.prototype.autoCreateAnimations = function(fps) {\r\n\r\n  var pattern = /([a-z]+)_?(\\d+)/;\r\n\r\n  var firstAnimation, frameRanges = {};\r\n\r\n  var geometry = this.geometry;\r\n\r\n  for (var i = 0, il = geometry.morphTargets.length; i < il; i++) {\r\n\r\n    var morph = geometry.morphTargets[i];\r\n    var chunks = morph.name.match(pattern);\r\n\r\n    if (chunks && chunks.length > 1) {\r\n\r\n      var name = chunks[1];\r\n\r\n      if (!frameRanges[name]) frameRanges[name] = {\r\n        start: Infinity,\r\n        end: -Infinity\r\n      };\r\n\r\n      var range = frameRanges[name];\r\n\r\n      if (i < range.start) range.start = i;\r\n      if (i > range.end) range.end = i;\r\n\r\n      if (!firstAnimation) firstAnimation = name;\r\n\r\n    }\r\n\r\n  }\r\n\r\n  for (var name in frameRanges) {\r\n\r\n    var range = frameRanges[name];\r\n    this.createAnimation(name, range.start, range.end, fps);\r\n\r\n  }\r\n\r\n  this.firstAnimation = firstAnimation;\r\n\r\n};\r\n\r\nTHREE.MorphBlendMesh.prototype.setAnimationDirectionForward = function(name) {\r\n\r\n  var animation = this.animationsMap[name];\r\n\r\n  if (animation) {\r\n\r\n    animation.direction = 1;\r\n    animation.directionBackwards = false;\r\n\r\n  }\r\n\r\n};\r\n\r\nTHREE.MorphBlendMesh.prototype.setAnimationDirectionBackward = function(name) {\r\n\r\n  var animation = this.animationsMap[name];\r\n\r\n  if (animation) {\r\n\r\n    animation.direction = -1;\r\n    animation.directionBackwards = true;\r\n\r\n  }\r\n\r\n};\r\n\r\nTHREE.MorphBlendMesh.prototype.setAnimationFPS = function(name, fps) {\r\n\r\n  var animation = this.animationsMap[name];\r\n\r\n  if (animation) {\r\n\r\n    animation.fps = fps;\r\n    animation.duration = (animation.end - animation.start) / animation.fps;\r\n\r\n  }\r\n\r\n};\r\n\r\nTHREE.MorphBlendMesh.prototype.setAnimationDuration = function(name, duration) {\r\n\r\n  var animation = this.animationsMap[name];\r\n\r\n  if (animation) {\r\n\r\n    animation.duration = duration;\r\n    animation.fps = (animation.end - animation.start) / animation.duration;\r\n\r\n  }\r\n\r\n};\r\n\r\nTHREE.MorphBlendMesh.prototype.setAnimationWeight = function(name, weight) {\r\n\r\n  var animation = this.animationsMap[name];\r\n\r\n  if (animation) {\r\n\r\n    animation.weight = weight;\r\n\r\n  }\r\n\r\n};\r\n\r\nTHREE.MorphBlendMesh.prototype.setAnimationTime = function(name, time) {\r\n\r\n  var animation = this.animationsMap[name];\r\n\r\n  if (animation) {\r\n\r\n    animation.time = time;\r\n\r\n  }\r\n\r\n};\r\n\r\nTHREE.MorphBlendMesh.prototype.getAnimationTime = function(name) {\r\n\r\n  var time = 0;\r\n\r\n  var animation = this.animationsMap[name];\r\n\r\n  if (animation) {\r\n\r\n    time = animation.time;\r\n\r\n  }\r\n\r\n  return time;\r\n\r\n};\r\n\r\nTHREE.MorphBlendMesh.prototype.getAnimationDuration = function(name) {\r\n\r\n  var duration = -1;\r\n\r\n  var animation = this.animationsMap[name];\r\n\r\n  if (animation) {\r\n\r\n    duration = animation.duration;\r\n\r\n  }\r\n\r\n  return duration;\r\n\r\n};\r\n\r\nTHREE.MorphBlendMesh.prototype.playAnimation = function(name) {\r\n\r\n  var animation = this.animationsMap[name];\r\n\r\n  if (animation) {\r\n\r\n    animation.time = 0;\r\n    animation.active = true;\r\n\r\n  }\r\n  else {\r\n\r\n    THREE.warn(\"THREE.MorphBlendMesh: animation[\" + name + \"] undefined in .playAnimation()\");\r\n\r\n  }\r\n\r\n};\r\n\r\nTHREE.MorphBlendMesh.prototype.stopAnimation = function(name) {\r\n\r\n  var animation = this.animationsMap[name];\r\n\r\n  if (animation) {\r\n\r\n    animation.active = false;\r\n\r\n  }\r\n\r\n};\r\n\r\nTHREE.MorphBlendMesh.prototype.update = function(delta) {\r\n\r\n  for (var i = 0, il = this.animationsList.length; i < il; i++) {\r\n\r\n    var animation = this.animationsList[i];\r\n\r\n    if (!animation.active) continue;\r\n\r\n    var frameTime = animation.duration / animation.length;\r\n\r\n    animation.time += animation.direction * delta;\r\n\r\n    if (animation.mirroredLoop) {\r\n\r\n      if (animation.time > animation.duration || animation.time < 0) {\r\n\r\n        animation.direction *= -1;\r\n\r\n        if (animation.time > animation.duration) {\r\n\r\n          animation.time = animation.duration;\r\n          animation.directionBackwards = true;\r\n\r\n        }\r\n\r\n        if (animation.time < 0) {\r\n\r\n          animation.time = 0;\r\n          animation.directionBackwards = false;\r\n\r\n        }\r\n\r\n      }\r\n\r\n    }\r\n    else {\r\n\r\n      animation.time = animation.time % animation.duration;\r\n\r\n      if (animation.time < 0) animation.time += animation.duration;\r\n\r\n    }\r\n\r\n    var keyframe = animation.startFrame + THREE.Math.clamp(Math.floor(animation.time / frameTime), 0, animation.length - 1);\r\n    var weight = animation.weight;\r\n\r\n    if (keyframe !== animation.currentFrame) {\r\n\r\n      this.morphTargetInfluences[animation.lastFrame] = 0;\r\n      this.morphTargetInfluences[animation.currentFrame] = 1 * weight;\r\n\r\n      this.morphTargetInfluences[keyframe] = 0;\r\n\r\n      animation.lastFrame = animation.currentFrame;\r\n      animation.currentFrame = keyframe;\r\n\r\n    }\r\n\r\n    var mix = (animation.time % frameTime) / frameTime;\r\n\r\n    if (animation.directionBackwards) mix = 1 - mix;\r\n\r\n    this.morphTargetInfluences[animation.currentFrame] = mix * weight;\r\n    this.morphTargetInfluences[animation.lastFrame] = (1 - mix) * weight;\r\n\r\n  }\r\n\r\n};\r\n\r\n\r\n// Export the THREE object for **Node.js**, with\r\n// backwards-compatibility for the old `require()` API. If we're in\r\n// the browser, add `_` as a global object via a string identifier,\r\n// for Closure Compiler \"advanced\" mode.\r\nif (typeof exports !== 'undefined') {\r\n  if (typeof module !== 'undefined' && module.exports) {\r\n    exports = module.exports = THREE;\r\n  }\r\n  exports.THREE = THREE;\r\n}\r\nelse {\r\n  this['THREE'] = THREE;\r\n}\r\n\r\n","module.exports = {\r\n  Position: require('./components/Position.js'),\r\n  Velocity: require('./components/Velocity.js'),\r\n  Jump: require('./components/Jump.js'),\r\n  Drawable: require('./components/Drawable.js'),\r\n  Expirable: require('./components/Expirable.js'),\r\n  CameraFollow: require('./components/CameraFollow.js'),\r\n  ShootDelay: require('./components/ShootDelay.js'),\r\n  OneTimeHit: require('./components/OneTimeHit.js'),\r\n  Hurt: require('./components/Hurt.js')\r\n};\r\n\r\n","module.exports = {\n\n  Entity         : require('./lib/Entity.js'),\n  EntityManager  : require('./lib/EntityManager.js'),\n  Messanger      : require('./lib/Messanger.js'),\n  ObjectPool     : require('./lib/ObjectPool.js'),\n  QuadTree       : require('./lib/QuadTree.js'),\n  Spatial        : require('./lib/Spatial.js'),\n  Vec2           : require('./lib/Vec2.js')\n\n};\n","module.exports = Velocity;\r\n\r\nfunction Velocity() {\r\n  this.x = 0;\r\n  this.y = 0;\r\n  this.z = 0;\r\n\r\n  this.rotationMatrix = null;\r\n}\r\n\r\n","module.exports = Position;\r\n\r\nfunction Position() {\r\n  this.x = 0;\r\n  this.y = 0;\r\n  this.z = 0;\r\n}\r\n\r\n","module.exports = Jump;\r\n\r\nfunction Jump() {\r\n  this.canJump = true;\r\n}\r\n\r\n","module.exports = Drawable;\r\n\r\nfunction Drawable() {\r\n  this.mesh = null;\r\n  this.scene = null;\r\n}\r\n\r\n","module.exports = Expirable;\r\n\r\nfunction Expirable() {\r\n  this.age = 0;\r\n  this.maxAge = 5;\r\n}\r\n\r\n","module.exports = CameraFollow;\r\n\r\nfunction CameraFollow() {\r\n  this.controls = null;\r\n  this.object = null;\r\n  this.offset = new THREE.Vector3();\r\n}\r\n\r\n","module.exports = ShootDelay;\r\n\r\nfunction ShootDelay() {\r\n  this.canShoot = true;\r\n\r\n  this.timer = 0;\r\n  this.delayTheshold = 0.2;\r\n}\r\n\r\n","module.exports = OneTimeHit;\r\n\r\nfunction OneTimeHit() {\r\n  this.alreadyHit = [];\r\n}\r\n\r\n","module.exports = Hurt;\r\n\r\nfunction Hurt() {\r\n  this.timer = 0;\r\n  this.invulnerabilityFrames = 1;\r\n\r\n  this.hurtColor = new THREE.Color(0xdd0000);\r\n  this.originalColor = 0xffffff;\r\n}\r\n\r\n","module.exports = EntityManager;\n\nvar Entity     = require('./Entity.js');\nvar ObjectPool = require('./ObjectPool.js');\nvar Messanger  = require('./Messanger.js');\nvar getName    = require('typedef').getName;\n\n/**\n * Manage, create, and destroy entities. Can use methods to mutate entities\n * (tags, components) directly or via the facade on the Entity.\n * @param {Messanger} messanger\n * @constructor\n */\nfunction EntityManager(messanger)\n{\n  this.messanger = messanger;\n  this._tags = {};\n\n  /**\n   * @type {Array.<Entity>}\n   */\n  this._entities = [];\n\n  /**\n   * @type {Array.<Group>}\n   */\n  this._groups = {};\n\n  this._entityPool = new ObjectPool(Entity);\n\n  this._componentPools = {};\n}\n\n/**\n * Fired AFTER an entity has be created.\n * @event\n */\nEntityManager.ENTITY_CREATED = 'EntityManager#ENTITY_CREATED';\n\n/**\n * Fired BEFORE an entity has been removed.\n * @event\n */\nEntityManager.ENTITY_REMOVE = 'EntityManager#ENTITY_REMOVE';\n\n/**\n * Fired AFTER a component has been removed.\n * @event\n */\nEntityManager.COMPONENT_ADDED = 'EntityManager#COMPONENT_ADDED';\n\n/**\n * Fired BEFORE a component has been removedt\n * @event\n */\nEntityManager.COMPONENT_REMOVE = 'EntityManager#COMPONENT_REMOVE';\n\n/**\n * @constructor\n * @param {Array.<Function>} Components\n * @param {Array<Entity>} entities\n */\nfunction Group(Components, entities)\n{\n  this.Components = Components || [];\n  this.entities = entities || [];\n}\n\n/**\n * Get a new entity.\n * @return {Entity}\n */\nEntityManager.prototype.createEntity = function()\n{\n  var entity = this._entityPool.aquire();\n\n  this._entities.push(entity);\n  entity._manager = this;\n  this._trigger(EntityManager.ENTITY_CREATED, entity);\n  return entity;\n};\n\n/**\n * Cleanly remove entities based on tag. Avoids loop issues.\n * @param {String} tag\n */\nEntityManager.prototype.removeEntitiesByTag = function(tag)\n{\n  var entities = this._tags[tag];\n\n  if (!entities) return;\n\n  for (var x = entities.length - 1; x >= 0; x--) {\n    var entity = entities[x];\n    entity.remove();\n  }\n};\n\n/**\n * Dump all entities out of the manager. Avoids loop issues.\n */\nEntityManager.prototype.removeAllEntities = function()\n{\n  for (var x = this._entities.length - 1; x >= 0; x--) {\n    this._entities[x].remove();\n  }\n};\n\n/**\n * Drop an entity. Returns it to the pool and fires all events for removing\n * components as well.\n * @param {Entity} entity\n */\nEntityManager.prototype.removeEntity = function(entity)\n{\n  var index = this._entities.indexOf(entity);\n\n  if (!~index)\n    throw new Error('Tried to remove entity not in list');\n\n  this.entityRemoveAllComponents(entity);\n\n  // Remove from entity list\n  this._trigger(EntityManager.ENTITY_REMOVE, entity);\n  this._entities.splice(index, 1);\n\n  // Remove entity from any tag groups\n  entity._tags = null;\n  for (var tag in this._tags) {\n    var entities = this._tags[tag];\n    var n = entities.indexOf(entity);\n    if (~n) entities.splice(n, 1);\n  }\n\n  // Prevent any acecss and free\n  entity._manager = null;\n  this._entityPool.release(entity);\n};\n\n/**\n * @param {Entity} entity\n * @param {String} tag\n */\nEntityManager.prototype.entityAddTag = function(entity, tag)\n{\n  var entities = this._tags[tag];\n\n  if (!entities)\n    entities = this._tags[tag] = [];\n\n  // Don't add if already there\n  if (~entities.indexOf(entity)) return;\n\n  entities.push(entity);\n  entity._tags.push(tag);\n};\n\n/**\n * @param {Entity} entity\n * @param {String} tag\n */\nEntityManager.prototype.entityRemoveTag = function(entity, tag)\n{\n  var entities = this._tags[tag];\n  if (!entities) return;\n\n  var index = entities.indexOf(entity);\n  if (!~index) return;\n\n  entities.splice(index, 1);\n  entity._tags.splice(entity._tags.indexOf(tag), 1);\n};\n\n/**\n * @param {Entity} entity\n * @param {Function} Component\n */\nEntityManager.prototype.entityAddComponent = function(entity, Component)\n{\n  if (~entity._Components.indexOf(Component)) return;\n\n  entity._Components.push(Component);\n\n  // Create the reference on the entity to this (aquired) component\n  var cName = componentPropertyName(Component);\n  var cPool = this._componentPools[cName];\n  if (!cPool)\n    cPool = this._componentPools[cName] = new ObjectPool(Component);\n  var component = cPool.aquire();\n  entity[cName] = component;\n\n  // Check each indexed group to see if we need to add this entity to the list\n  for (var groupName in this._groups) {\n    var group = this._groups[groupName];\n\n    if (!~group.Components.indexOf(Component))\n      continue;\n    if (!entity.hasAllComponents(group.Components))\n      continue;\n    if (~group.entities.indexOf(entity))\n      continue;\n\n    group.entities.push(entity);\n  }\n\n  this._trigger(EntityManager.COMPONENT_ADDED, entity, Component);\n};\n\n/**\n * Drop all components on an entity.\n * @param {Entity} entity\n */\nEntityManager.prototype.entityRemoveAllComponents = function(entity)\n{\n  var Cs = entity._Components;\n\n  for (var j = Cs.length - 1; j >= 0; j--) {\n    var C = Cs[j];\n    entity.removeComponent(C);\n  }\n};\n\n/**\n * @param {Entity} entity\n * @param {Function} Component\n */\nEntityManager.prototype.entityRemoveComponent = function(entity, Component)\n{\n  var index = entity._Components.indexOf(Component);\n  if (!~index) return;\n\n  this._trigger(EntityManager.COMPONENT_REMOVE, entity, Component);\n\n  // Check each indexed group to see if we need to remove it\n  for (var groupName in this._groups) {\n    var group = this._groups[groupName];\n\n    if (!~group.Components.indexOf(Component))\n      continue;\n    if (!entity.hasAllComponents(group.Components))\n      continue;\n\n    var loc = group.entities.indexOf(entity);\n    if (~loc) {\n      group.entities.splice(loc, 1);\n    }\n  }\n\n  // Remove T listing on entity and property ref, then free the component.\n  var propName = componentPropertyName(Component);\n  entity._Components.splice(index, 1);\n  var component = entity[propName];\n  delete entity[propName];\n  this._componentPools[propName].release(component);\n};\n\n/**\n * @param {Array.<Function>} Components\n * @return {Array.<Entity>}\n */\nEntityManager.prototype.queryComponents = function(Components)\n{\n  var group = this._groups[groupKey(Components)];\n\n  if (!group) {\n    group = this._indexGroup(Components);\n  }\n\n  return group.entities;\n};\n\n/**\n * @param {String} tag\n * @return {Array.<Entity>}\n */\nEntityManager.prototype.queryTag = function(tag)\n{\n  var entities = this._tags[tag];\n\n  if (entities === undefined)\n    entities = this._tags[tag] = [];\n\n  return entities;\n};\n\n/**\n * @return {Number} Total number of entities.\n */\nEntityManager.prototype.count = function()\n{\n  return this._entities.length;\n};\n\n/**\n * Get information about the object pools of the entities and the various\n * components.\n * @return {Object}\n */\nEntityManager.prototype.poolStats = function()\n{\n  var stats = {};\n  var e = this._entityPool;\n  stats.entity = {\n    used: this._entityPool.totalUsed(),\n    size: this._entityPool.count\n  };\n\n  for (var cName in this._componentPools) {\n    var pool = this._componentPools[cName];\n    stats[cName] = {\n      used: pool.totalUsed(),\n      size: pool.count\n    };\n  }\n\n  return stats;\n};\n\n/**\n * Create an index of entities with a set of components.\n * @param {Array.<Function>} Components\n * @private\n */\nEntityManager.prototype._indexGroup = function(Components)\n{\n  var key = groupKey(Components);\n\n  if (this._groups[key]) return;\n\n  var group = this._groups[key] = new Group(Components);\n\n  for (var n = 0; n < this._entities.length; n++) {\n    var entity = this._entities[n];\n    if (entity.hasAllComponents(Components)) {\n      group.entities.push(entity);\n    }\n  }\n\n  return group;\n};\n\n/**\n * Trigger the messanger if we have one.\n * @param {String} event\n * @param {Object=} a\n * @param {Object=} b\n */\nEntityManager.prototype._trigger = function(event, a, b)\n{\n  if (this.messanger)\n    this.messanger.trigger(event, a, b);\n};\n\n/**\n * @param {Function} Component\n * @return {String}\n * @private\n */\nfunction componentPropertyName(Component)\n{\n  var name = getName(Component);\n  return name.charAt(0).toLowerCase() + name.slice(1);\n}\n\n/**\n * @param {Array.<Function>} Components\n * @return {String}\n * @private\n */\nfunction groupKey(Components)\n{\n  var names = [];\n  for (var n = 0; n < Components.length; n++) {\n    var T = Components[n];\n    names.push(getName(T));\n  }\n\n  return names\n    .map(function(x) { return x.toLowerCase(); })\n    .sort()\n    .join('-');\n}\n\n","module.exports = ObjectPool;\n\n/**\n * Minimize garbage collector thrashing by re-using existing objects instead of\n * creating new ones. Requires manually lifecycle management.\n * @constructor\n * @param {Function} T\n */\nfunction ObjectPool(T)\n{\n  this.freeList = [];\n  this.count    = 0;\n  this.T        = T;\n}\n\n/**\n * Get a pooled object\n */\nObjectPool.prototype.aquire = function()\n{\n  // Grow the list by 20%ish if we're out\n  if (this.freeList.length <= 0) {\n    this.expand(Math.round(this.count*0.2) + 1);\n  }\n\n  var item = this.freeList.pop();\n\n  // We can provide explicit initing, otherwise re-call constructor (hackish)\n  if (item.__init)\n    item.__init();\n  else\n    this.T.call(item);\n\n  return item;\n};\n\n/**\n * Return an object back to the pool.\n */\nObjectPool.prototype.release = function(item)\n{\n  this.freeList.push(item);\n};\n\n/**\n * @param {Number} Amount of new objects to allocate for this pool.\n */\nObjectPool.prototype.expand = function(count)\n{\n  for (var n = 0; n < count; n++)\n    this.freeList.push(new this.T());\n  this.count += count;\n};\n\n/**\n * @return {Number} Total amount of allocated objects (available and in-use).\n */\nObjectPool.prototype.totalSize = function()\n{\n  return this.count;\n};\n\n/**\n * @return {Number} Total number of objects currently available.\n */\nObjectPool.prototype.totalFree = function()\n{\n  return this.freeList.length;\n};\n\n/**\n * @return {Number} Total number of objects currently in-use.\n */\nObjectPool.prototype.totalUsed = function()\n{\n  return this.count - this.freeList.length;\n};\n\n","module.exports = QuadTree;\n\nvar ObjectPool = require('./ObjectPool.js');\nvar Spatial    = require('./Spatial.js');\nvar Vec2       = require('./Vec2.js');\n\n/**\n * Effectively store positional and sized objects. Each tree has a position and\n * size, as well as up to 4 child nodes (other trees) and an array of entries.\n * @constructor\n */\nfunction QuadTree()\n{\n  this.level       = 0;\n  this.position    = new Vec2();\n  this.size        = new Vec2();\n  this.maxEntities = 15;\n  this.maxLevels   = 10;\n\n  /**\n   * Pool that is used for all internal quad trees. Only root node has one, all\n   * others have a refence.\n   */\n  this.pool = new ObjectPool(QuadTree);\n\n  /**\n   * @type {Array.<QuadTree>}\n   */\n  this.nodes = [];\n\n  /**\n   * @type {Array.<{spatial: Spatial}>}\n   */\n  this.entities = [];\n}\n\n/**\n * Reset for pool.\n * @private\n */\nQuadTree.prototype.__init = function()\n{\n  this.level = 0;\n  this.position.clear();\n  this.size.clear();\n  this.nodes.length = 0;\n  this.entities.length = 0;\n\n  // Only root node has actual ref to pool\n  this.pool = null;\n};\n\n/**\n * Add an entity to the tree\n * @param {{spatial: Spatial}} entity\n */\nQuadTree.prototype.insert = function(entity)\n{\n  // Recurse if we can\n  if (this.nodes.length) {\n    var index = this._getIndex(entity.spatial.absPosition(),\n      entity.spatial.absHwidth());\n    if (~index) return this.nodes[index].insert(entity);\n  }\n\n  // Actually add the entity\n  this.entities.push(entity);\n  this._splitAndRedistributeIfNeeded();\n  entity.spatial._node = this;\n  return entity;\n};\n\n/**\n * Remove an entity from this tree.\n * @param {{spatial: Spatial}} param\n */\nQuadTree.prototype.remove = function(entity)\n{\n  // Remove if we can\n  var n = this.entities.indexOf(entity);\n  if (~n) {\n    this.entities.splice(n, 1);\n    entity.spatial._node = null;\n    if (!this.totalSize())\n      this.clear();\n    return;\n  }\n\n  // Recuse if we can\n  if (this.nodes.length) {\n    var index = this._getIndex(entity.spatial.absPosition(),\n      entity.spatial.absHwidth());\n    if (~index) return this.nodes[index].remove(entity);\n  }\n};\n\n/**\n * Total recursive size of this tree.\n * @return {Number}\n */\nQuadTree.prototype.totalSize = function()\n{\n  var size = this.entities.length;\n\n  for (var n = 0; n < this.nodes.length; n++) {\n    var node = this.nodes[n];\n    size += node.totalSize();\n  }\n\n  return size;\n};\n\n/**\n * Empty the tree recursively.\n */\nQuadTree.prototype.clear = function()\n{\n  // Clear entity area\n  for (var m = 0; m < this.entities.length; m++) {\n    var entity = this.entities[m];\n    entity.spatial._node = null;\n  }\n  this.entities.length = 0;\n\n  // Recurse, free the node, and wipe out our node length\n  for (var n = 0; n < this.nodes.length; n++) {\n    var node = this.nodes[n];\n    node.clear();\n    this.pool.release(node);\n  }\n  this.nodes.length = 0;\n};\n\n/**\n * Get all tree entries that are interesected by a rectangle defined with\n * position and hwidth.\n * @param {Vec2} position\n * @param {Vec2} hwidth\n * @param {Array.<{spatial: Spatial}>=} out__objects Return objects.\n * @return {Array.<{spatial: Spatial}>} The out__objects parameter (filled up now)\n */\nQuadTree.prototype.queryArea = function(position, hwidth, out__entities)\n{\n  var entities = out__entities || [];\n\n  // If query belongs in ONLY a single node, then recurse\n  var index = this._getIndex(position, hwidth);\n  if (~index && this.nodes.length) {\n    this.nodes[index].queryArea(position, hwidth, entities);\n\n  // Otherwise, we have to add ALL of the nodes as it may be overlapping one\n  } else {\n    for (var j = 0; j < this.nodes.length; j++) {\n      var node = this.nodes[j];\n      node.queryArea(position, hwidth, entities);\n    }\n  }\n\n  // Also add everything from this node itself\n  for (var m = 0; m < this.entities.length; m++) {\n    var entity = this.entities[m];\n\n    var overlapping = Vec2.rectIntersect(\n      entity.spatial.absPosition(),\n      entity.spatial.absHwidth(),\n      position,\n      hwidth);\n\n    if (overlapping) {\n      entities.push(entity);\n    }\n  }\n\n  return entities;\n};\n\n/**\n * Do a complete reset of the tree.\n */\nQuadTree.prototype.reIndex = function()\n{\n  this._combine();\n  this._splitAndRedistributeIfNeeded();\n};\n\nvar tSize = new Vec2();\nvar tPos  = new Vec2();\n\n/**\n * Check to see if an entity is still valid.\n * @param {{spatial: Spatial}} entity\n * @return {Boolean} True if the entity is in this tree (non-recursive) in its\n * correct place. False implies we need to re-add it.\n */\nQuadTree.prototype.validateEntity = function(entity)\n{\n  var pos = entity.spatial.position;\n  var hw  = entity.spatial.hwidth;\n\n  // Check to see if we're still inside this node\n  tSize.assign(this.size).smult(0.5);\n  tPos.assign(tSize).add(this.position);\n  var inside = Vec2.rectContains(pos, hw, tPos, tSize);\n\n  if (!inside) return false;\n\n  // No children nodes, then we're good\n  if (!this.nodes.length)\n    return true;\n\n  // Or if children nodes and we overlap, still good\n  var index = this._getIndex(entity.spatial.absPosition(),\n    entity.spatial.absHwidth());\n  if (this.nodes.length && !~index)\n    return true;\n\n  // Didnt make it\n  return false;\n};\n\n/**\n * Return which of the 4 quandrants of this tree an object would go into.\n * @param {Vec2} position\n * @param {Vec2} hwidth\n * @return {Number} Which quandrant, or -1 if won't fit.\n * @private\n */\nQuadTree.prototype._getIndex = function(position, hwidth)\n{\n  var midX = this.position.x + this.size.x / 2;\n  var midY = this.position.y + this.size.y / 2;\n\n  var left   = position.x - hwidth.x < midX && position.x + hwidth.x < midX;\n  var right  = position.x - hwidth.x > midX && position.x + hwidth.x > midX;\n  var top    = position.y - hwidth.y < midY && position.y + hwidth.y < midY;\n  var bottom = position.y - hwidth.y > midY && position.y + hwidth.y > midY;\n\n  if (top && right) return 0;\n  if (top && left) return 1;\n  if (bottom && left) return 2;\n  if (bottom && right) return 3;\n\n  return -1;\n};\n\n/**\n * If we've overpacked this tree, then split into 4 smaller trees (if we\n * haven't already) and redistribute.\n * @private\n */\nQuadTree.prototype._splitAndRedistributeIfNeeded = function()\n{\n  if (this.entities.length > this.maxEntities &&\n    this.level < this.maxLevels)\n  {\n    this._split();\n    this._redistribute();\n  }\n};\n\n/**\n * Create a sub quad tree\n * @return {QuadTree}\n * @private\n */\nQuadTree.prototype._factory = function()\n{\n  var node = this.pool.aquire();\n\n  node.pool        = this.pool;\n  node.level       = this.level + 1;\n  node.maxEntities = this.maxEntities;\n  node.maxLevels   = this.maxLevels;\n\n  return node;\n};\n\n/**\n * Create 4 sub nodes for the tree (does not populate tho)\n * @private\n */\nQuadTree.prototype._split = function()\n{\n  if (this.nodes.length) return;\n\n  var x = this.position.x;\n  var y = this.position.y;\n\n  var w = this.size.x / 2;\n  var h = this.size.y / 2;\n\n  // Create the seperate nodes\n  for (var n = 0; n < 4; n++) {\n    var node = this._factory();\n    node.size.set(w, h);\n\n    switch(n) {\n      case 0:\n        node.position.set(x + w, y);\n        break;\n      case 1:\n        node.position.set(x, y);\n        break;\n      case 2:\n        node.position.set(x, y + h);\n        break;\n      case 3:\n        node.position.set(x + w, y + h);\n        break;\n    }\n\n    this.nodes.push(node);\n  }\n};\n\n/**\n * Distrubute all entities into child nodes if we can.\n * @private\n */\nQuadTree.prototype._redistribute = function()\n{\n  // Loop through all of our entries and if they can fit into a child node,\n  // move them there\n  var i = 0;\n  while (i < this.entities.length) {\n    var entity = this.entities[i];\n    var index = this._getIndex(entity.spatial.absPosition(),\n      entity.spatial.absHwidth());\n\n    // Insert into child, remove from our array if they belong in another node\n    if (~index) {\n      this.nodes[index].insert(entity);\n      this.entities.splice(i, 1);\n    } else {\n      i++;\n    }\n  }\n};\n\n/**\n * Unwinds this node. Move all child nodes into this node and remove child\n * nodes.\n * @private\n */\nQuadTree.prototype._combine = function()\n{\n  for (var n = 0; n < this.nodes.length; n++) {\n    var node = this.nodes[n];\n\n    // Combine all children first\n    node._combine();\n\n    // All entries combined on node, now add it to US\n    for (var m = 0; m < node.entities.length; m++) {\n      var entity = node.entities[m];\n      this.entities.push(entity);\n    }\n\n    // Clear out and ensure we release it\n    node.entities.length = 0;\n    node.clear();\n    this.pool.release(node);\n  }\n\n  // Clear nodes array\n  this.nodes.length = 0;\n};\n\n","module.exports = Entity;\n\n/**\n * Basic component-driven object with facade functions for interacting with the\n * injected EntityManager object.\n * @constructor\n */\nfunction Entity()\n{\n  // Injected by EntityManager\n  this._manager    = null;\n\n  /**\n   * @type {Array.<Function>}\n   * @private\n   */\n  this._Components = [];\n\n  /**\n   * @type {Array.<String>}\n   * @private\n   */\n  this._tags       = [];\n}\n\n/**\n * @param {Function} TComponent\n * @return {Entity} This entity.\n */\nEntity.prototype.addComponent = function(TComponent)\n{\n  this._manager.entityAddComponent(this, TComponent);\n  return this;\n};\n\n/**\n * @param {Function} TComponent\n * @return {Entity} This entity.\n */\nEntity.prototype.removeComponent = function(TComponent)\n{\n  this._manager.entityRemoveComponent(this, TComponent);\n  return this;\n};\n\n/**\n * @param {Function} TComponent\n * @return {boolean} True if this entity has TComponent.\n */\nEntity.prototype.hasComponent = function(TComponent)\n{\n  return !!~this._Components.indexOf(TComponent);\n};\n\n/**\n * @param {Array.<Function>} Components\n * @return {boolean} True if entity has all Components.\n */\nEntity.prototype.hasAllComponents = function(Components)\n{\n  var b = true;\n\n  for (var i = 0; i < Components.length; i++) {\n    var C = Components[i];\n    b &= !!~this._Components.indexOf(C);\n  }\n\n  return b;\n};\n\n/**\n * @param {String} tag\n * @return {boolean} True if entity has tag.\n */\nEntity.prototype.hasTag = function(tag)\n{\n  return !!~this._tags.indexOf(tag);\n};\n\n/**\n * @param {String} tag\n * @return {Entity} This entity.\n */\nEntity.prototype.addTag = function(tag)\n{\n  this._manager.entityAddTag(this, tag);\n  return this;\n};\n\n/**\n * @param {String} tag\n * @return {Entity} This entity.\n */\nEntity.prototype.removeTag = function(tag)\n{\n  this._manager.entityRemoveTag(this, tag);\n  return this;\n};\n\n/**\n * @return {void}\n */\nEntity.prototype.remove = function()\n{\n  return this._manager.removeEntity(this);\n};\n\n","module.exports = Messanger;\n\nvar Event = require('./Event.js');\n\n/**\n * General event aggregation with filtering on components or tags.\n * @constructor\n */\nfunction Messanger()\n{\n  this._events = {};\n  this.fired   = 0;\n  this.handled = 0;\n}\n\n/**\n * @param {String} eventName\n * @param {Function} callback\n * @return {Event}\n */\nMessanger.prototype.listenTo = function(eventName, callback)\n{\n  if (!this._events[eventName])\n    this._events[eventName] = [];\n\n  var event = new Event(eventName, callback);\n\n  // Dump and chump\n  this._events[eventName].push(event);\n  return event;\n};\n\n/**\n * @param {String} eventName\n * @param {Object=} entity\n * @param {Option=} option\n */\nMessanger.prototype.trigger = function(eventName, entity, option)\n{\n  this.fired++;\n\n  var events = this._events[eventName];\n  if (!events) return;\n\n  // Try all events\n  for (var n = 0; n < events.length; n++) {\n    var event = events[n];\n    if (event.fire(eventName, entity, option))\n      this.handled++;\n  }\n};\n\n","module.exports = Spatial;\n\nvar Vec2 = require('./Vec2.js');\n\n/**\n * Basic component giving an entity the concept of being located somewhere.\n * Creates basic spatial heirachy, positions, rotation, etc.\n * @constructor\n */\nfunction Spatial()\n{\n  // Alloc our types\n  this.position     = new Vec2();\n  this.scale        = new Vec2();\n  this.hwidth       = new Vec2();\n\n  this._absScale    = new Vec2();\n  this._absPosition = new Vec2();\n  this._absHwidth   = new Vec2();\n\n  // Setup\n  this.__init();\n}\n\n/**\n * Setup called by pool.\n * @private\n */\nSpatial.prototype.__init = function()\n{\n  this.rotation = 0;\n\n  // Ref to quad tree node this component is in\n  this._node = null;\n\n  // Parent component\n  this.parent = null;\n\n  this.position.clear();\n  this.scale.set(1, 1);\n  this.hwidth.clear();\n  this._absPosition.clear();\n  this._absScale.set(1, 1);\n  this._absHwidth.clear();\n};\n\n/**\n * Fired when spatials overlap.\n * @event\n */\nSpatial.COINCIDENT = 'Spatial#COINCIDENT';\n\n/**\n * Attach this component to another entity's Spatial.\n * @param {{spatial: Spatial}} entity An entity with a Spatial component\n */\nSpatial.prototype.attachTo = function(entity)\n{\n  if (this.parent)\n    throw new Error ('Entity already attached');\n\n  if (!entity || !entity.spatial)\n    throw new Error('Invalid / missing entity');\n\n  this.parent = entity.spatial;\n};\n\n/**\n * The absolute world position of this component.\n * @return {Vec2}\n */\nSpatial.prototype.absPosition = function()\n{\n  var v = this._absPosition.assign(this.position);\n\n  // Trivial case, no parent\n  if (!this.parent) {\n    return v;\n  }\n\n  var parent = this.parent;\n\n  // Rotate our angle by parent's angle\n  var r = this.absRotation();\n  v.rotate(parent.absRotation());\n\n  // Scale by parents scale\n  var pScale = parent.absScale();\n  v.set(v.x * pScale.x, v.y * pScale.y);\n\n  // Add parent's position\n  return v.add(parent.absPosition());\n};\n\n/**\n * The absolute world rotation of this component.\n * @return {Number}\n */\nSpatial.prototype.absRotation = function()\n{\n  // Trivial case\n  if (!this.parent)\n    return this.rotation;\n\n  // This + parent\n  var r = this.rotation + this.parent.absRotation();\n\n  return r % (Math.PI*2);\n};\n\n/**\n * The absolute world hwidth for this component.\n * @return {Vec2}\n */\nSpatial.prototype.absHwidth = function()\n{\n  var h = this._absHwidth.assign(this.hwidth);\n\n  if (!this.parent)\n    return h;\n\n  var scale = this.absScale();\n\n  return h.set(h.x * scale.x, h.y * scale.y);\n};\n\n/**\n * The absolute world scale of this component.\n * @return {Vec2}\n */\nSpatial.prototype.absScale = function()\n{\n  var v = this._absScale.assign(this.scale);\n\n  // Trivial case\n  if (!this.parent) {\n    return v;\n  }\n\n  var pScale = this.parent.absScale();\n\n  return v.set(v.x * pScale.x, v.y * pScale.y);\n};\n\n","module.exports = Vec2;\n\nvar ObjectPool = require('./ObjectPool.js');\n\n/**\n * 2-dimension Cartesian vector with built-in (optional) object pool.\n * @constructor\n * @param {Number} x\n * @param {Number} y\n */\nfunction Vec2(x, y)\n{\n  this.x = +x || 0.0;\n  this.y = +y || 0.0;\n}\n\n/**\n * Reset for pool.\n * @private\n */\nVec2.prototype.__init = function()\n{\n  this.clear();\n};\n\n// Interal static object pool\nvar pool = new ObjectPool(Vec2);\n\n/**\n * Get a vector from the pool.\n * @return {Vec2}\n */\nVec2.aquire = function()\n{\n  return pool.aquire();\n};\n\n/**\n * Return a vector to the pool.\n * @param {Vec2} v\n * @return {Number}\n */\nVec2.release = function(v)\n{\n  if (v) pool.release(v);\n  return pool.count - pool.freeList.length;\n};\n\n/**\n * Reset this vector to (0,0).\n * @return {Vec2} This vector.\n */\nVec2.prototype.clear = function()\n{\n  this.x = this.y = 0.0;\n  return this;\n};\n\n/**\n * Assign this vector the value of another.\n * @param {Vec2} v\n * @return {Vec2} This vector.\n */\nVec2.prototype.assign = function(v)\n{\n  this.x = v.x;\n  this.y = v.y;\n  return this;\n};\n\n/**\n * Determine if this vector is equal to another.\n * @param {Vec2} v\n * @return {Boolean} True if vectors are equal.\n */\nVec2.prototype.equals = function(v)\n{\n  return this.x === v.x && this.y === v.y;\n};\n\n/**\n * Set this vector to a set of coordinates.\n * @param {Number} x\n * @param {Number} y\n * @return {Vec2} This vector.\n */\nVec2.prototype.set = function(x, y)\n{\n  this.x = +x;\n  this.y = +y;\n  return this;\n};\n\n/**\n * Limit this vector to a specific magnitude.\n * @param {Number} size\n * @return {Vec2} This vector.\n */\nVec2.prototype.limit = function(size)\n{\n  size = +size;\n  if (!size)\n    return this;\n  else if (this.magnitude() > size)\n    return this.normalize(size);\n  else\n    return this;\n};\n\n/**\n * Normalize this vector.\n * @param {Number=} m Length.\n * @return {Vec2} This vector.\n */\nVec2.prototype.normalize = function(m)\n{\n  m = m || +1.0;\n  var length = Math.sqrt(this.x * this.x + this.y * this.y);\n  this.x = m * this.x / length;\n  this.y = m * this.y / length;\n  return this;\n};\n\n/**\n * Subtract some vector from this one.\n * @param {Vec2} v\n * @return {Vec2} This vector.\n */\nVec2.prototype.sub = function(v)\n{\n  this.x -= v.x;\n  this.y -= v.y;\n  return this;\n};\n\n/**\n * Add some vector to this one.\n * @param {Vec2} v\n * @return {Vec2} This vector.\n */\nVec2.prototype.add = function(v)\n{\n  this.x += v.x;\n  this.y += v.y;\n  return this;\n};\n\n/**\n * Scalar multiply this vector by a value.\n * @param {Number} n\n * @return {Vec2} This vector.\n */\nVec2.prototype.smult = function(n)\n{\n  n = +n;\n  this.x *= n;\n  this.y *= n;\n  return this;\n};\n\n/**\n * Rotate this vector clockwise about the origin by a certain angle.\n * @param {Number} theta\n * @return {Vec2} This vector.\n */\nVec2.prototype.rotate = function(theta)\n{\n  return this.set(\n    this.x * Math.cos(theta) - this.y * Math.sin(theta),\n    this.x * Math.sin(theta) + this.y * Math.cos(theta)\n  );\n};\n\n/**\n * Get the dot product of this vector and another.\n * @param {Vec2} v\n * @return {Number}\n */\nVec2.prototype.dot = function(v)\n{\n  return +(this.x * v.x + this.y * v.y);\n};\n\n/**\n * Get the determinate of this vector and another.\n * @param {Vec2} v\n * @return {Number}\n */\nVec2.prototype.det = function(v)\n{\n  return +(this.x * v.y - this.y * v.x);\n};\n\n/**\n * Get the magnitude of this vector.\n * @return {Number}\n */\nVec2.prototype.magnitude = function()\n{\n  return Math.sqrt(this.x * this.x + this.y * this.y);\n};\n\n/**\n * Get the squared magnitude of this vector.\n * @return {Number}\n */\nVec2.prototype.magnitude2 = function()\n{\n  return this.x * this.x + this.y * this.y;\n};\n\n/**\n * Get the angle of this vector.\n * @return {Number}\n */\nVec2.prototype.angle = function()\n{\n  return Math.atan2(this.y, this.x);\n};\n\n/**\n * Get the angle between this vector and another.\n * @param {Vec2} v\n * @return {Number}\n */\nVec2.prototype.angleBetween = function(v)\n{\n  return Math.atan2(this.det(v), this.dot(v));\n};\n\n/**\n * Make a pooled copy of this vector\n * @return {Vec2} A new vector.\n */\nVec2.prototype.pcopy = function()\n{\n  return Vec2.aquire().assign(this);\n};\n\n/**\n * Make a copy of this vector.\n * @return {Vec2} A new vector.\n */\nVec2.prototype.copy = function()\n{\n  return new Vec2().assign(this);\n};\n\n/**\n * Create a vector with a specific angle and magnitude.\n * @param {Number} theta\n * @param {Number=} m\n * @return {Vec2} A new vector.\n */\nVec2.fromAngle = function(theta, m)\n{\n  m = +m || 1.0;\n  return new Vec2(Math.cos(theta) * m, Math.sin(theta) * m);\n};\n\n/**\n * Create a pooled vector with a specific angle and magnitude.\n * @param {Number} theta\n * @param {Number} m\n * @return {Vec2} A new vector.\n */\nVec2.pfromAngle = function(theta, m)\n{\n  m = +m || 1.0;\n  return Vec2.aquire().set(\n    Math.cos(theta) * m,\n    Math.sin(theta) * m\n  );\n};\n\n/**\n * Determine if two rectangles, defined by a position and a halfwidth vector,\n * overlap.\n * @param {Vec2} p1 Position of rectangle 1\n * @param {Vec2} r1 Halfwidths of rectangle 1\n * @param {Vec2} p2 Position of rectangle 2\n * @param {Vec2} r2 Halfwidths of rectangle 2\n * @return {Boolean} True if they intersect\n */\nVec2.rectIntersect = function(p1, r1, p2, r2)\n{\n  // Basically, rectangles dont intersect if one's bottom is higher than ones\n  // top, ones left is more left than ones right, etc\n  var a = p1.x + r1.x < p2.x - r2.x;\n  var b = p1.x - r1.x > p2.x + r2.x;\n  var c = p1.y + r1.y < p2.y - r2.y;\n  var d = p1.y - r1.y > p2.y + r2.y;\n\n  // We want if they do\n  return !(a || b || c || d);\n};\n\n/**\n * Determines if rectangle 1 is entirely inside of rectangle 2.\n * @param {Vec2} p1 Position of rectangle 1\n * @param {Vec2} r1 Halfwidths of rectangle 1\n * @param {Vec2} p2 Position of rectangle 2\n * @param {Vec2} r2 Halfwidths of rectangle 2\n * @return {Boolean} True if they rectangle 1 is inside of rectangle 2\n */\nVec2.rectContains = function(p1, r1, p2, r2)\n{\n  if (p1.x - r1.x < p2.x - r2.x) return false;\n  if (p1.x + r1.x > p2.x + r2.x) return false;\n  if (p1.y - r1.y < p2.y - r2.y) return false;\n  if (p1.y + r1.y > p2.y + r2.y) return false;\n\n  return true;\n};\n\n/**\n * Convert a rectangle specified by top-left point + size into center location\n * + halfwidths.\n * @param {Vec2} position\n * @param {Vec2} size\n * @param {Vec2} out__position Output position\n * @param {Vec2} out__hwidth Output hwidths\n */\nVec2.sizeToHwidth = function(position, size, out__position, out__hwidth)\n{\n  out__hwidth.assign(size).smult(0.5);\n  out__position.assign(position).add(out__hwidth);\n};\n\n/**\n * Output this vector.\n */\nVec2.prototype.toString = function()\n{\n  return '' + (this.x.toFixed(2)) + ',' + (this.y.toFixed(2));\n};\n\n","module.exports = Event;\n\n/**\n * @constructor\n */\nfunction Event(name, callback)\n{\n  this._name     = name || 'name';\n  this._callback = callback || null;\n\n  // Additional filters\n  this._Components = [];\n}\n\n/**\n * @param {String} eventName\n * @param {{hasAllComponents:Function}} entity\n * @param {Object=} option\n * @return {Boolean} True if fired.\n */\nEvent.prototype.fire = function(eventName, entity, option)\n{\n  // Name check\n  if (eventName !== this._name)\n    return false;\n\n  // Component filters\n  var Comps = this._Components;\n  if (entity && entity.hasAllComponents && Comps.length) {\n    if (!entity || !entity.hasAllComponents(Comps))\n      return false;\n  }\n\n  // Made it\n  this._callback(entity, option);\n  return true;\n};\n\n/**\n * @param {Function} T\n * @return {Event} This object.\n */\nEvent.prototype.whereComponent = function(T)\n{\n  this._Components.push(T);\n};\n\n/**\n * @param {Array.<Function>} Components\n * @return {Event} This object.\n */\nEvent.prototype.whereComponents = function(Components)\n{\n  this._Components = this._Components.concat(Components);\n  return this;\n};\n\n","module.exports = {\n\n  'extends'      : require('./lib/extends.js'),\n  'mixin'        : require('./lib/mixin.js'),\n  'getArguments' : require('./lib/getArguments.js'),\n  'getName'      : require('./lib/getName.js')\n\n};\n\n\n","module.exports = mixin_;\n\n/**\n * Add all own properties of mixin to the prototype property of class T\n * @param {Function} T Class we want to mix into.\n * @param {Function|Object} mixin Mixin we want to mixt\n */\nfunction mixin_(T, mixin)\n{\n  // If we're mixing in a class (constructor function), then first mix in all\n  // things hanging directly off the mixin as \"statics\", then switch the mixin\n  // ref to point to the prototype\n  if (mixin instanceof Function) {\n    for (var k in mixin) {\n      T[k] = mixin[k];\n    }\n    mixin = mixin.prototype;\n  }\n\n  // Dump everything on the mixin into the prototype of our class\n  for (var key in mixin) {\n    if (mixin.hasOwnProperty(key)) {\n      T.prototype[key] = mixin[key];\n    }\n  }\n}\n\n","module.exports = extends_;\n\n/**\n * The well documented, oft-used (Coffeescript, Typescript, ES6... etc) extends\n * pattern to get some sort of single-inheritance in Javascript.  Modify a\n * Child class to have inherited the static members via copying and link the\n * prototypes.\n * @param {Function} Child Child constructor function.\n * @param {Function} Parent Parent contrusctor function.\n * @return {Function} The Child constructor.\n */\nfunction extends_(Child, Parent)\n{\n  // Drop in statics\n  for (var key in Parent) {\n    if (!Child.hasOwnProperty(key) && Parent.hasOwnProperty(key)) {\n      Child[key] = Parent[key];\n    }\n  }\n\n  // Give static to access parent\n  Child.Super = Parent;\n\n  // Child's prototype property is an object with the parent's prototype\n  // property its [[prototype]] + constructor\n  if (Object.create instanceof Function) {\n    Child.prototype = Object.create(Parent.prototype, {\n      constructor: { value: Child }\n    });\n  } else {\n    // IE8 and below shim\n    var T = makeT(Child);\n    T.prototype = Parent.prototype;\n    Child.prototype = new T();\n  }\n\n  return Child;\n}\n\n/**\n * @param {Function} Child\n * @return {Function}\n */\nfunction makeT(Child)\n{\n  return function T() { this.constructor = Child; };\n}\n\n","module.exports = getArguments;\n\nvar FUNCTION_ARGS = /^\\w*function[^\\(]*\\(([^\\)]+)/;\n\n/**\n * Get the parameter names of a function.\n * @param {Function} f A function.\n * @return {Array.<String>} An array of the argument names of a function.\n */\nfunction getArguments(f)\n{\n  var ret = [];\n  var args = f.toString().match(FUNCTION_ARGS);\n\n  if (args) {\n    args = args[1]\n      .replace(/[ ]*,[ ]*/, ',')\n      .split(',');\n    for (var n = 0; n < args.length; n++) {\n      var a = args[n].replace(/^\\s+|\\s+$/g, '');\n      if (a) ret.push(a);\n    }\n  }\n\n  return ret;\n}\n\n","module.exports = getName;\n\nvar FUNCTION_NAME = /function\\s+([^\\s(]+)/;\n\n/**\n * Get the name of a function (e.g. constructor)\n * @param {Function} f\n * @return {String} The function name.\n */\nfunction getName(f)\n{\n  var name = '';\n\n  if (f instanceof Function) {\n    if (f.name) {\n      return f.name;\n    }\n\n    var match = f.toString().match(FUNCTION_NAME);\n\n    if (match) {\n      name = match[1];\n    }\n  } else if (f && f.constructor instanceof Function) {\n    name = getName(f.constructor);\n  }\n\n  return name;\n}\n"]}