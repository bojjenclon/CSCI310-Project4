{"version":3,"sources":["../../../../AppData/Roaming/npm/node_modules/browserify/node_modules/browser-pack/_prelude.js","main.js","libgif.js","js/THREEx.KeyboardState.js","rubbable.js","RequestAnimationFrame.js","js/Utils.js","js/Game.js","js/Globals.js","js/ResourceManager.js","js/PointerLockControls.js","js/Systems.js","js/MouseController.js","js/EntityFactory.js","node_modules/physijs-browserify/physi.js","node_modules/js-class/class.js","node_modules/stats.js/src/Stats.js","node_modules/three/three.js","js/Components.js","b3core.0.1.0.js","node_modules/tiny-ecs/index.js","js/components/Position.js","js/components/Velocity.js","js/components/Identifier.js","js/components/Drawable.js","js/components/Jump.js","js/components/CameraFollow.js","js/components/ShootDelay.js","js/components/Expirable.js","js/components/Hurt.js","js/components/OneTimeHit.js","js/components/Ai.js","js/components/Steaming.js","js/components/CameraPitch.js","js/components/Health.js","js/components/Gun.js","js/components/Bullet.js","node_modules/tiny-ecs/lib/EntityManager.js","node_modules/tiny-ecs/lib/Entity.js","node_modules/tiny-ecs/lib/QuadTree.js","node_modules/tiny-ecs/lib/ObjectPool.js","node_modules/tiny-ecs/lib/Spatial.js","node_modules/tiny-ecs/lib/Vec2.js","node_modules/tiny-ecs/lib/Messanger.js","node_modules/tiny-ecs/lib/Event.js","node_modules/tiny-ecs/node_modules/typedef/index.js","node_modules/tiny-ecs/node_modules/typedef/lib/extends.js","node_modules/tiny-ecs/node_modules/typedef/lib/mixin.js","node_modules/tiny-ecs/node_modules/typedef/lib/getName.js","node_modules/tiny-ecs/node_modules/typedef/lib/getArguments.js"],"names":["init","Globals","instance","hudElement","document","getElementById","healthElement","scoreElement","reloadingElement","reloadImg","SuperGif","gif","load","overlayElement","gameOptions","container","loadingContainer","blocker","instructions","crosshair","modelsToPreload","game","Game","start","global","Class","require","THREE","THREEx","Physijs","Stats","Utils","scripts","worker","ammo","bitsToNum","ba","reduce","s","n","byteToBitArr","bite","a","i","push","Stream","data","this","len","length","pos","readByte","Error","Uint8Array","charCodeAt","readBytes","bytes","read","String","fromCharCode","readUnsigned","lzwDecode","minCodeSize","code","last","readCode","size","output","clearCode","eoiCode","codeSize","dict","clear","concat","apply","parseGIF","st","handler","parseCT","entries","ct","readSubBlocks","parseHeader","hdr","sig","ver","width","height","bits","gctFlag","shift","colorRes","splice","sorted","gctSize","bgColor","pixelAspectRatio","gct","parseExt","block","parseGCExt","reserved","disposalMethod","userInput","transparencyGiven","delayTime","transparencyIndex","terminator","gce","parseComExt","comment","com","parsePTExt","ptHeader","ptData","pte","parseAppExt","parseNetscapeExt","unknown","iterations","app","NETSCAPE","parseUnknownAppExt","appData","identifier","authCode","parseUnknownExt","label","extType","parseImg","img","deinterlace","pixels","newPixels","Array","rows","cpRow","toRow","fromRow","fromPixels","slice","offsets","steps","pass","leftPos","topPos","lctFlag","interlaced","lctSize","lct","lzwMinCodeSize","lzwData","parseBlock","sentinel","type","eof","toString","setTimeout","parse","opts","options","vp_l","vp_t","vp_w","vp_h","c_w","c_h","is_vp","stream","loadError","loading","transparency","delay","disposalRestoreFromIdx","lastDisposalMethod","frame","lastImg","playing","forward","ctx_scaled","frames","frameOffsets","auto_play","getAttribute","canvas","ctx","toolbar","tmpCanvas","onEndListener","hasOwnProperty","on_end","loopDelay","loop_delay","overrideLoopMode","loop_mode","drawWhileLoading","draw_while_loading","showProgressBar","show_progress_bar","doParse","err","doLoadError","setSizes","w","h","get_canvas_scale","style","minWidth","getContext","setTransform","setFrameOffset","offset","x","y","doShowProgress","draw","left","mid","top","fillStyle","fillRect","originOfError","drawError","strokeStyle","lineWidth","moveTo","lineTo","stroke","doHdr","_hdr","doGCE","pushFrame","getImageData","doImg","currIdx","putImageData","clearRect","imgData","cdd","forEach","pixel","set","scale","drawImage","player","iterationCount","getNextFrameNo","delta","stepFrame","amount","putFrame","completeLoop","step","stepping","doStep","nextFrameNo","parseInt","globalCompositeOperation","play","pause","move_relative","current_frame","move_to","frame_idx","doDecodeProgress","doNothing","withProgress","fn","load_callback","parent","parentNode","span","createElement","className","appendChild","insertBefore","removeChild","initialized","max_width","load_setup","callback","get_playing","get_canvas","get_loading","get_auto_play","get_length","get_current_frame","load_url","src","XMLHttpRequest","overrideMimeType","onloadstart","onload","e","responseText","onprogress","lengthComputable","loaded","total","onerror","open","send","load_raw","arr","set_frame_offset","module","exports","KeyboardState","domElement","keyCodes","modifiers","_this","_onKeyDown","event","_onKeyChange","_onKeyUp","addEventListener","_onBlur","prop","window","prototype","destroy","removeEventListener","MODIFIERS","ALIAS","up","right","down","space","pageup","pagedown","tab","escape","keyCode","pressed","shiftKey","ctrlKey","altKey","metaKey","keyDesc","keys","split","key","indexOf","Object","toUpperCase","eventMatches","aliases","aliasKeys","root","factory","define","amd","RubbableGif","sup","register_canvas_handers","isvp","maxDistance","Math","floor","startX","startTime","cantouch","aj","last_played","preventDefault","touches","layerX","progress","timeStamp","pageX","currentX","currentDistance","abs","currentTime","orig_load","requestAnimationFrame","webkitRequestAnimationFrame","mozRequestAnimationFrame","oRequestAnimationFrame","msRequestAnimationFrame","element","randomRange","min","max","random","constructor","stats","prevTime","performance","now","renderer","scene","camera","paused","controlsEnabled","controls","systems","postPhysicsSystems","percentModelsLoaded","systemsDelay","runImmediately","undefined","onResize","bind","onkeydown","onKeyDown","onMouseDown","onMouseUp","WebGLRenderer","antialias","setSize","innerWidth","innerHeight","setClearColor","setMode","position","bottom","body","Scene","setGravity","Vector3","aspectRatio","PerspectiveCamera","add","PointerLockControls","getObject","ambientLight","AmbientLight","dirLight","DirectionalLight","EntityFactory","makeGround","makePlayer","controlsObject","cameraOffset","gunOffset","hp","makeEnemy","aiTarget","bulletSpeed","PlayerInputSystem","entities","AISystem","MovementSystem","ExpirableSystem","CameraPitchSystem","ShootDelaySystem","HurtSystem","PlayerHealthSystem","HealthBarSystem","DeathSystem","SteamRemovalSystem","SteamUpdateSystem","PhysicsUpdateSystem","CameraFollowSystem","loadModels","model","ResourceManager","loadModel","modelLoaded","percentPerModel","visibility","display","scrollTop","documentElement","update","initPointerLock","animationFrame","time","dt","system","simulate","MouseController","render","aspect","updateProjectionMatrix","which","KEY_CODES","button","isDown","wasPressed","havePointerLock","pointerlockchange","pointerLockElement","mozPointerLockElement","webkitPointerLockElement","enabled","pointerlockerror","requestPointerLock","mozRequestPointerLock","webkitRequestPointerLock","test","navigator","userAgent","fullscreenchange","fullscreenElement","mozFullscreenElement","mozFullScreenElement","requestFullscreen","mozRequestFullscreen","mozRequestFullScreen","webkitRequestFullscreen","innerHTML","statics","score",{"end":{"file":"?","comments_before":[],"nlb":false,"endpos":326,"endcol":16,"endline":19,"pos":318,"col":8,"line":19,"value":"instance","type":"name"},"start":{"file":"?","comments_before":[],"nlb":false,"endpos":326,"endcol":16,"endline":19,"pos":318,"col":8,"line":19,"value":"instance","type":"name"},"name":"instance"},"_instance","DIR","ENTITY_TYPES","enemy","ground","obstacle","bullet","Model","geometry","material","clone","loadingManager","LoadingManager","jsonLoader","JSONLoader","textures","models","getTexture","path","ImageUtils","loadTexture","materials","MeshFaceMaterial","rotation","pitchObject","Object3D","yawObject","moveForward","moveBackward","moveLeft","moveRight","isOnObject","canJump","velocity","mass","moveSpeed","minimumY","onMouseMove","onKeyUp","movementX","mozMovementX","webkitMovementX","movementY","mozMovementY","webkitMovementY","PI_2","bool","getDirection","direction","Euler","v","copy","applyEuler","z","translateX","translateY","translateZ","PI","C","keyboard","jumped","players","queryTag","entity","dv","MOVE_SPEED","jump","JUMP_FORCE","applyMatrix4","rotationMatrix","shootDelay","canShoot","cameraFollow","bulletPos","setFromMatrixPosition","gun","mesh","matrixWorld","bulletOffset","yMatrix","Matrix4","extractRotation","matrix","multiply","bulletRot","object","makePotato","drawable","owner","baseDirection","basePos","piOver2","bulletDirection","makeFry","moveables","queryComponents","Position","Velocity","hasComponent","Drawable","applyCentralImpulse","expirables","Expirable","expirable","age","maxAge","remove","follows","CameraFollow","shooters","ShootDelay","timer","delayTheshold","hurtables","Hurt","hurt","invulnerabilityFrames","color","hurtColor","hasTag","backgroundColor","originalColor","removeComponent","health","changed","percent","maxHP","percentRounded","round","Color","getHexString","mortals","Health","healthBar","_physijs","collision_type","COLLISION_TYPES","singularities","AI","ai","tree","target","blackboard","tick","steaming","Steaming","particles","particleCount","vertices","particle","verticesNeedUpdate","Bullet","isHot","pitchables","CameraPitch","cameraPitch","getLinearVelocity","EntityManager","b3","createEntity","addTag","addComponent","Identifier","Jump","Gun","CapsuleMesh","createMaterial","MeshBasicMaterial","MASS","collision_masks","enemyBullet","setDamping","setAngularFactor","other_object","relative_velocity","relative_rotation","contact_normal","makeGun","cameraControls","MeshPhongMaterial","playerBullet","Mesh","BoxGeometry","FaceNode","Action","name","parameters","facing","__Action_initialize","initialize","settings","_manager","FAILURE","parentPos","followingPos","posDif","sub","angle","angleTo","SUCCESS","lookAtMatrix","lookAt","parentRotation","Quaternion","setFromEuler","targetRotation","setFromRotationMatrix","str","slerp","setFromQuaternion","__dirtyRotation","RUNNING","RandomChildNode","Composite","__Composite_initialize","chance","children","status","_execute","FollowNode","following","distance","distanceTo","difference","subVectors","normal","normalize","ShootNode","shootingAt","spawnLocation","spawnOffset","followingVel","multiplyScalar","predictedPos","velOffset","BehaviorTree","Sequence","Blackboard","potato","OneTimeHit","mat","setHex","hitPlayer","hitEnemy","oneTimeHit","alreadyHit","uuid","touchedGround","vel","Geometry","smokeTexture","smokeMaterial","PointCloudMaterial","map","transparent","depthWrite","blending","AdditiveBlending","PointCloud","sortParticles","Gyroscope","fry","BoxMesh","mainTex","wrapS","wrapT","RepeatWrapping","diffuseTex","specularTex","displacementMap","specularMap","nothing","SUPPORT_TRANSFERABLE","Eventable","getObjectId","getEulerXYZFromQuaternion","getQuatertionFromEuler","convertWorldPositionToObject","addObjectChildren","_temp1","_temp2","_is_simulating","_Physijs","_temp_vector3_1","_temp_vector3_2","_temp_matrix4_1","_quaternion_1","MESSAGE_TYPES","WORLDREPORT","COLLISIONREPORT","VEHICLEREPORT","CONSTRAINTREPORT","REPORT_ITEMSIZE","COLLISIONREPORT_ITEMSIZE","VEHICLEREPORT_ITEMSIZE","CONSTRAINTREPORT_ITEMSIZE","_eventListeners","event_name","index","dispatchEvent","call","arguments","make","obj","_id","atan2","asin","c1","s1","c2","s2","c3","s3","c1c2","s1s2","cos","sin","identity","makeRotationFromQuaternion","quaternion","getInverse","noConflict","friction","restitution","physijs_material","id","PointConstraint","objecta","objectb","appliedImpulse","positiona","positionb","getDefinition","HingeConstraint","axis","setLimits","low","high","bias_factor","relaxation_factor","execute","constraint","enableAngularMotor","acceleration","disableMotor","SliderConstraint","lin_lower","lin_upper","ang_lower","ang_upper","setRestitution","linear","angular","enableLinearMotor","disableLinearMotor","disableAngularMotor","ConeTwistConstraint","axisa","axisb","setLimit","enableMotor","setMaxMotorImpulse","max_impulse","setMotorTarget","DOFConstraint","setLinearLowerLimit","limit","setLinearUpperLimit","setAngularLowerLimit","setAngularUpperLimit","configureAngularMotor","low_angle","high_angle","max_force","params","self","_worker","Worker","transferableMessage","webkitPostMessage","postMessage","_materials_ref_counts","_objects","_vehicles","_constraints","ab","ArrayBuffer","byteLength","console","log","message","filename","lineno","onmessage","_temp","Float32Array","_updateScene","_updateCollisions","_updateVehicles","_updateConstraints","cmd","debug","dir","fixedTimeStep","rateLimit","num_objects","__dirtyPosition","linearVelocity","angularVelocity","buffer","vehicle","wheel","wheels","addVectors","j","object2","id1","id2","collisions","normal_offsets","getAngularVelocity","normal_offset","addConstraint","show_marker","marker","SphereGeometry","MeshNormalMaterial","onSimulationResume","removeConstraint","updateMatrix","updateMatrixWorld","position_offset","world","Vehicle","materialId","depth","pop","setFixedTimeStep","gravity","timeStep","maxSubSteps","object_id","quat","boundingBox","computeBoundingBox","__defineGetter__","__defineSetter__","force","applyImpulse","impulse_x","impulse_y","impulse_z","applyTorque","torque_x","torque_y","torque_z","applyCentralForce","applyForce","force_x","force_y","force_z","setAngularVelocity","setLinearVelocity","factor","setLinearFactor","setCcdMotionThreshold","threshold","setCcdSweptSphereRadius","radius","PlaneMesh","faces","HeightfieldMesh","xdiv","ydiv","xsize","ysize","xpts","sqrt","ypts","absMaxHeight","b","points","SphereMesh","boundingSphere","computeBoundingSphere","pow","CylinderMesh","ConeMesh","ConcaveMesh","face","triangles","Face3","c","Face4","d","ConvexMesh","tuning","VehicleTuning","rigidBody","suspension_stiffness","suspension_compression","suspension_damping","max_suspension_travel","friction_slip","max_suspension_force","addWheel","wheel_geometry","wheel_material","connection_point","wheel_direction","wheel_axle","suspension_rest_length","wheel_radius","is_front_wheel","castShadow","receiveShadow","setSteering","steering","setBrake","brake","applyEngineForce","inherit","dest","noParent","getOwnPropertyNames","desc","getOwnPropertyDescriptor","defineProperty","__proto__","findType","meta","implType","implMeta","proto","base","implements","classProto","isArray","implementedType","extend","theClass","value","enumerable","configurable","writable","Checker","typeOf","typeInfo","an","is","VERSION","Date","ms","msMin","Infinity","msMax","fps","fpsMin","fpsMax","mode","cssText","fpsDiv","fpsText","fpsGraph","bar","msDiv","msText","msGraph","updateGraph","dom","child","firstChild","REVISION","begin","end","textContent","sign","warn","error","MOUSE","LEFT","MIDDLE","RIGHT","CullFaceNone","CullFaceBack","CullFaceFront","CullFaceFrontBack","FrontFaceDirectionCW","FrontFaceDirectionCCW","BasicShadowMap","PCFShadowMap","PCFSoftShadowMap","FrontSide","BackSide","DoubleSide","NoShading","FlatShading","SmoothShading","NoColors","FaceColors","VertexColors","NoBlending","NormalBlending","SubtractiveBlending","MultiplyBlending","CustomBlending","AddEquation","SubtractEquation","ReverseSubtractEquation","MinEquation","MaxEquation","ZeroFactor","OneFactor","SrcColorFactor","OneMinusSrcColorFactor","SrcAlphaFactor","OneMinusSrcAlphaFactor","DstAlphaFactor","OneMinusDstAlphaFactor","DstColorFactor","OneMinusDstColorFactor","SrcAlphaSaturateFactor","MultiplyOperation","MixOperation","AddOperation","UVMapping","CubeReflectionMapping","CubeRefractionMapping","EquirectangularReflectionMapping","EquirectangularRefractionMapping","SphericalReflectionMapping","ClampToEdgeWrapping","MirroredRepeatWrapping","NearestFilter","NearestMipMapNearestFilter","NearestMipMapLinearFilter","LinearFilter","LinearMipMapNearestFilter","LinearMipMapLinearFilter","UnsignedByteType","ByteType","ShortType","UnsignedShortType","IntType","UnsignedIntType","FloatType","HalfFloatType","UnsignedShort4444Type","UnsignedShort5551Type","UnsignedShort565Type","AlphaFormat","RGBFormat","RGBAFormat","LuminanceFormat","LuminanceAlphaFormat","RGBEFormat","RGB_S3TC_DXT1_Format","RGBA_S3TC_DXT1_Format","RGBA_S3TC_DXT3_Format","RGBA_S3TC_DXT5_Format","RGB_PVRTC_4BPPV1_Format","RGB_PVRTC_2BPPV1_Format","RGBA_PVRTC_4BPPV1_Format","RGBA_PVRTC_2BPPV1_Format","Projector","projectVector","vector","project","unprojectVector","unproject","pickingRay","CanvasRenderer","setRGB","r","g","setStyle","hex","setHSL","l","hue2rgb","p","q","t","exec","ColorKeywords","copyGammaToLinear","gammaFactor","copyLinearToGamma","safeInverse","convertGammaToLinear","convertLinearToGamma","getHex","getHSL","optionalTarget","hue","saturation","hsl","lightness","getStyle","offsetHSL","addColors","color1","color2","addScalar","lerp","alpha","equals","fromArray","array","toArray","aliceblue","antiquewhite","aqua","aquamarine","azure","beige","bisque","black","blanchedalmond","blue","blueviolet","brown","burlywood","cadetblue","chartreuse","chocolate","coral","cornflowerblue","cornsilk","crimson","cyan","darkblue","darkcyan","darkgoldenrod","darkgray","darkgreen","darkgrey","darkkhaki","darkmagenta","darkolivegreen","darkorange","darkorchid","darkred","darksalmon","darkseagreen","darkslateblue","darkslategray","darkslategrey","darkturquoise","darkviolet","deeppink","deepskyblue","dimgray","dimgrey","dodgerblue","firebrick","floralwhite","forestgreen","fuchsia","gainsboro","ghostwhite","gold","goldenrod","gray","green","greenyellow","grey","honeydew","hotpink","indianred","indigo","ivory","khaki","lavender","lavenderblush","lawngreen","lemonchiffon","lightblue","lightcoral","lightcyan","lightgoldenrodyellow","lightgray","lightgreen","lightgrey","lightpink","lightsalmon","lightseagreen","lightskyblue","lightslategray","lightslategrey","lightsteelblue","lightyellow","lime","limegreen","linen","magenta","maroon","mediumaquamarine","mediumblue","mediumorchid","mediumpurple","mediumseagreen","mediumslateblue","mediumspringgreen","mediumturquoise","mediumvioletred","midnightblue","mintcream","mistyrose","moccasin","navajowhite","navy","oldlace","olive","olivedrab","orange","orangered","orchid","palegoldenrod","palegreen","paleturquoise","palevioletred","papayawhip","peachpuff","peru","pink","plum","powderblue","purple","red","rosybrown","royalblue","saddlebrown","salmon","sandybrown","seagreen","seashell","sienna","silver","skyblue","slateblue","slategray","slategrey","snow","springgreen","steelblue","tan","teal","thistle","tomato","turquoise","violet","wheat","white","whitesmoke","yellow","yellowgreen","_x","_y","_z","_w","onChangeCallback","euler","order","setFromAxisAngle","halfAngle","m","te","elements","m11","m12","m13","m21","m22","m23","m31","m32","m33","trace","setFromUnitVectors","v1","EPS","vFrom","vTo","dot","crossVectors","inverse","conjugate","lengthSq","multiplyQuaternions","qax","qay","qaz","qaw","qbx","qby","qbz","qbw","multiplyVector3","applyQuaternion","qb","cosHalfTheta","halfTheta","acos","sinHalfTheta","ratioA","ratioB","onChange","qa","qm","Vector2","setX","setY","setComponent","getComponent","subScalar","divide","divideScalar","scalar","invScalar","clamp","clampScalar","minVal","maxVal","ceil","roundToZero","negate","distanceToSquared","dx","dy","setLength","oldLength","lerpVectors","v2","fromAttribute","attribute","itemSize","setZ","multiplyVectors","applyAxisAngle","applyMatrix3","applyProjection","qx","qy","qz","qw","ix","iy","iz","iw","multiplyMatrices","projectionMatrix","transformDirection","lengthManhattan","cross","ax","ay","az","bx","by","bz","projectOnVector","projectOnPlane","planeNormal","reflect","theta","dz","setEulerFromRotationMatrix","setEulerFromQuaternion","getPositionFromMatrix","getScaleFromMatrix","setFromMatrixScale","getColumnFromMatrix","setFromMatrixColumn","sx","sy","sz","me","Vector4","setW","setAxisAngleFromQuaternion","setAxisAngleFromRotationMatrix","epsilon","epsilon2","xx","yy","zz","xy","xz","yz","_order","DefaultOrder","RotationOrders","setFromVector3","reorder","newOrder","toVector3","optionalResult","Line3","line","center","result","distanceSq","at","closestPointToPointParameter","startP","startEnd","point","clampToLine","startEnd2","startEnd_startP","closestPointToPoint","Box2","setFromPoints","makeEmpty","il","expandByPoint","setFromCenterAndSize","halfSize","box","empty","expandByVector","expandByScalar","containsPoint","containsBox","getParameter","isIntersectionBox","clampPoint","distanceToPoint","clampedPoint","intersect","union","translate","Box3","setFromObject","scope","traverse","node","BufferGeometry","attributes","positions","getBoundingSphere","Sphere","Matrix3","n11","n12","n13","n21","n22","n23","n31","n32","n33","multiplyVector3Array","applyToVector3Array","determinant","f","throwOnInvertible","det","msg","transpose","tmp","flattenToArrayOffset","getNormalMatrix","transposeIntoArray","n14","n24","n34","n41","n42","n43","n44","extractPosition","copyPosition","extractBasis","xAxis","yAxis","zAxis","makeBasis","scaleX","scaleY","scaleZ","makeRotationFromEuler","ae","af","be","bf","ce","cf","de","df","ac","ad","bc","bd","setRotationFromQuaternion","x2","y2","z2","wx","wy","wz","eye","a11","a12","a13","a14","a21","a22","a23","a24","a31","a32","a33","a34","a41","a42","a43","a44","b11","b12","b13","b14","b21","b22","b23","b24","b31","b32","b33","b34","b41","b42","b43","b44","multiplyToArray","multiplyVector4","rotateAxis","crossVector","getPosition","setPosition","rotateX","rotateY","rotateZ","rotateByAxis","getMaxScaleOnAxis","scaleXSq","scaleYSq","scaleZSq","makeTranslation","makeRotationX","makeRotationY","makeRotationZ","makeRotationAxis","tx","ty","makeScale","compose","decompose","invSX","invSY","invSZ","makeFrustum","near","far","makePerspective","fov","ymax","degToRad","ymin","xmin","xmax","makeOrthographic","Ray","origin","ray","recast","directionDistance","distanceSqToSegment","segCenter","segDir","diff","v0","optionalPointOnRay","optionalPointOnSegment","s0","sqrDist","extDet","segExtent","a01","b0","b1","invDet","isIntersectionSphere","sphere","intersectSphere","tca","d2","radius2","thc","t0","t1","isIntersectionPlane","plane","distToPoint","denominator","distanceToPlane","constant","intersectPlane","intersectBox","tmin","tmax","tymin","tymax","tzmin","tzmax","invdirx","invdiry","invdirz","intersectTriangle","edge1","edge2","backfaceCulling","DdN","DdQxE2","DdE1xQ","QdN","matrix4","optionalCenter","maxRadiusSq","intersectsSphere","radiusSum","deltaLengthSq","getBoundingBox","Frustum","p0","p1","p2","p3","p4","p5","planes","Plane","frustum","setFromMatrix","me0","me1","me2","me3","me4","me5","me6","me7","me8","me9","me10","me11","me12","me13","me14","me15","setComponents","intersectsObject","negRadius","intersectsBox","d1","setFromNormalAndCoplanarPoint","setFromCoplanarPoints","inverseNormalLength","distanceToSphere","projectPoint","orthoPoint","perpendicularMagnitude","isIntersectionLine","startSign","endSign","intersectLine","coplanarPoint","m1","optionalNormalMatrix","normalMatrix","newNormal","newCoplanarPoint","generateUUID","chars","rnd","join","clampBottom","mapLinear","a1","a2","b2","smoothstep","smootherstep","random16","randInt","randFloat","randFloatSpread","range","degreeToRadiansFactor","degrees","radToDeg","radianToDegreesFactor","radians","isPowerOfTwo","nextPowerOfTwo","Spline","interpolate","t2","t3","intPoint","weight","w2","w3","pa","pb","pc","pd","v3","initFromArray","getPoint","k","getControlPointsArray","coords","getLength","nSubDivisions","nSamples","oldIntPoint","oldPosition","tmpVec","chunkLengths","totalLength","chunks","reparametrizeByArcLength","samplingCoef","indexCurrent","indexNext","realDistance","sampling","newpoints","sl","Triangle","resultLengthSq","barycoordFromPoint","dot00","dot01","dot02","dot11","dot12","denom","invDenom","u","setFromPointsAndIndices","i0","i1","i2","triangle","area","midpoint","Clock","autoStart","oldTime","elapsedTime","running","stop","getElapsedTime","getDelta","newTime","EventDispatcher","hasEventListener","listener","_listeners","listeners","listenerArray","Raycaster","Sprite","LOD","Line","descSort","intersectObject","raycaster","intersects","recursive","raycast","precision","linePrecision","setFromCamera","OrthographicCamera","sort","intersectObjects","objects","Object3DIdCount","DefaultUp","onRotationChange","onQuaternionChange","defineProperties","rotationAutoUpdate","matrixAutoUpdate","matrixWorldNeedsUpdate","visible","frustumCulled","renderOrder","userData","eulerOrder","useQuaternion","applyMatrix","setRotationFromAxisAngle","setRotationFromEuler","setRotationFromMatrix","rotateOnAxis","q1","translateOnAxis","localToWorld","worldToLocal","getChildByName","getObjectByName","getObjectById","getObjectByProperty","getWorldPosition","getWorldQuaternion","getWorldRotation","getWorldScale","getWorldDirection","traverseVisible","traverseAncestors","toJSON","metadata","version","generator","geometries","parseGeometry","json","parseMaterial","parseObject","JSON","stringify","intensity","PointLight","decay","SpotLight","exponent","HemisphereLight","groundColor","materialIndex","vertexNormals","vertexColors","vertexTangents","BufferAttribute","needsUpdate","copyAt","index1","index2","setXY","setXYZ","setXYZW","Int8Attribute","Uint8Attribute","Uint8ClampedAttribute","Int16Attribute","Uint16Attribute","Int32Attribute","Uint32Attribute","Float32Attribute","Float64Attribute","DynamicBufferAttribute","updateRange","count","create","GeometryIdCount","attributesKeys","drawcalls","addAttribute","addDrawCall","indexOffset","fromGeometry","faceVertexUvs","hasFaceVertexUv","hasFaceVertexNormals","normals","colors","uvs","i3","na","nb","nc","fc","vca","vcb","vcc","uva","uvb","uvc","bb","isNaN","computeFaceNormals","computeVertexNormals","vA","vB","vC","pA","pB","pC","cb","indices","jl","normalizeNormals","computeTangents","handleTriangle","uvA","uvB","uvC","x1","y1","z1","sdir","tdir","tan1","tan2","handleVertex","n2","tmp2","tangents","uv","nVertices","tangent","iA","iB","iC","computeOffsets","facesCount","sortedIndices","Uint16Array","indexPtr","vertexPtr","duplicatedVertices","newVerticeMaps","faceVertices","Int32Array","vertexMap","revVertexMap","findex","vo","vid","faceMax","new_offset","new_vid","reorderBuffers","merge","attribute1","attributeArray1","attribute2","attributeArray2","attributeSize","indexBuffer","indexMap","vertexCount","sortedAttributes","attr","sourceArray","attrArray","attrSize","sortedAttr","numItems","sourceAttr","dispose","morphTargets","morphColors","morphNormals","skinWeights","skinIndices","lineDistances","hasTangents","dynamic","elementsNeedUpdate","uvsNeedUpdate","normalsNeedUpdate","tangentsNeedUpdate","colorsNeedUpdate","lineDistancesNeedUpdate","groupsNeedUpdate","vertex","fromBufferGeometry","tempNormals","tempUVs","addFace","drawcall","fl","areaWeighted","vl","computeMorphNormals","__originalFaceNormal","__originalVertexNormals","tmpGeo","faceNormals","faceNormal","dstNormalsFace","dstNormalsVertex","context","ua","ub","uc","vertexIndex","faceIndex","computeLineDistances","materialIndexOffset","vertexOffset","vertices1","vertices2","faces1","faces2","uvs1","uvs2","vertexCopy","faceCopy","faceVertexNormals","faceVertexColors","uvCopy","mergeMesh","mergeVertices","verticesMap","unique","changes","precisionPoints","faceIndicesToRemove","dupIndex","idx","setBit","getNormalIndex","hash","normalsHash","getColorIndex","colorsHash","getUvIndex","uvsHash","hasMaterial","hasFaceUv","hasFaceNormal","hasFaceVertexNormal","hasFaceColor","hasFaceVertexColor","faceType","uvsCopy","kl","Camera","matrixWorldInverse","CubeCamera","cubeResolution","cameraPX","cameraNX","cameraPY","cameraNY","cameraPZ","cameraNZ","renderTarget","WebGLRenderTargetCube","format","magFilter","minFilter","updateCubeMap","generateMipmaps","activeCubeFace","zoom","cx","cy","setLens","focalLength","frameHeight","atan","setViewOffset","fullWidth","fullHeight","Light","light","AreaLight","constantAttenuation","linearAttenuation","quadraticAttenuation","onlyShadow","shadowCameraNear","shadowCameraFar","shadowCameraLeft","shadowCameraRight","shadowCameraTop","shadowCameraBottom","shadowCameraVisible","shadowBias","shadowDarkness","shadowMapWidth","shadowMapHeight","shadowCascade","shadowCascadeOffset","shadowCascadeCount","shadowCascadeBias","shadowCascadeWidth","shadowCascadeHeight","shadowCascadeNearZ","shadowCascadeFarZ","shadowCascadeArray","shadowMap","shadowMapSize","shadowCamera","shadowMatrix","skyColor","shadowCameraFov","Cache","files","file","get","Loader","showStatus","statusDomElement","addStatusElement","imageLoader","ImageLoader","onLoadStart","onLoadProgress","onLoadComplete","crossOrigin","fontSize","textAlign","background","padding","zIndex","updateProgress","toFixed","extractUrlBase","url","parts","initMaterials","texturePath","needsTangents","ShaderMaterial","nearest_pow2","LN2","create_texture","where","sourceFile","repeat","wrap","anisotropy","texture","fullPath","loader","Handlers","Texture","image","wrapMap","mirror","rgb2hex","rgb","mtype","mpars","opacity","lightMap","normalMap","bumpMap","wireframe","shading","toLowerCase","depthTest","flipSided","side","doubleSided","colorDiffuse","DbgColor","colorSpecular","specular","colorEmissive","emissive","specularCoef","shininess","mapDiffuse","mapDiffuseRepeat","mapDiffuseOffset","mapDiffuseWrap","mapDiffuseAnisotropy","mapLight","mapLightRepeat","mapLightOffset","mapLightWrap","mapLightAnisotropy","mapBump","mapBumpRepeat","mapBumpOffset","mapBumpWrap","mapBumpAnisotropy","mapNormal","mapNormalRepeat","mapNormalOffset","mapNormalWrap","mapNormalAnisotropy","mapSpecular","mapSpecularRepeat","mapSpecularOffset","mapSpecularWrap","mapSpecularAnisotropy","mapAlpha","mapAlphaRepeat","mapAlphaOffset","mapAlphaWrap","mapAlphaAnisotropy","mapBumpScale","bumpScale","mapNormalFactor","normalScale","DbgName","handlers","regex","XHRLoader","manager","DefaultLoadingManager","onLoad","onProgress","onError","cached","request","response","itemEnd","responseType","itemStart","setResponseType","setCrossOrigin","withCredentials","loadAjaxJSON","callbackProgress","xhr","onreadystatechange","readyState","DONE","LOADING","getResponseHeader","HEADERS_RECEIVED","parseModel","isBitSet","fi","zLength","colorIndex","normalIndex","uvIndex","isQuad","faceA","faceB","uvLayer","nUvLayers","parseSkin","influencesPerVertex","bones","animation","animations","parseMorphing","dstVertices","srcVertices","cl","dstColors","srcColors","BufferGeometryLoader","text","typedArray","MaterialLoader","uniforms","vertexShader","fragmentShader","sizeAttenuation","ObjectLoader","substring","lastIndexOf","setTexturePath","parseGeometries","images","parseImages","parseTextures","parseMaterials","geometryLoader","bufferGeometryLoader","widthSegments","heightSegments","depthSegments","CircleGeometry","segments","CylinderGeometry","radiusTop","radiusBottom","radialSegments","openEnded","phiStart","phiLength","thetaStart","thetaLength","IcosahedronGeometry","detail","TorusGeometry","tube","tubularSegments","arc","TorusKnotGeometry","heightScale","alphaMap","envMap","loadImage","getGeometry","getMaterial","Group","TextureLoader","DataTextureLoader","BinaryTextureLoader","_parser","DataTexture","texData","mipmaps","mipmapCount","CompressedTextureLoader","CompressedTexture","texDatas","isCubemap","Material","MaterialIdCount","blendSrc","blendDst","blendEquation","blendSrcAlpha","blendDstAlpha","blendEquationAlpha","colorWrite","polygonOffset","polygonOffsetFactor","polygonOffsetUnits","alphaTest","overdraw","_needsUpdate","setValues","values","newValue","currentValue","Number","MeshLambertMaterial","MeshDepthMaterial","SpriteMaterial","LineBasicMaterial","linewidth","linecap","linejoin","fog","LineDashedMaterial","dashSize","gapSize","combine","reflectivity","refractionRatio","wireframeLinewidth","wireframeLinecap","wireframeLinejoin","skinning","wrapAround","wrapRGB","metal","ParticleBasicMaterial","ParticleSystemMaterial","defines","lights","defaultAttributeValues","uv2","index0AttributeName","UniformsUtils","RawShaderMaterial","mapping","TextureIdCount","DEFAULT_IMAGE","DEFAULT_MAPPING","premultiplyAlpha","flipY","unpackAlignment","onUpdate","CubeTexture","VideoTexture","video","HAVE_ENOUGH_DATA","inverseMatrix","localThreshold","testPoint","rayPointDistance","intersectPoint","distanceToRay","oi","ol","pointCount","ParticleSystem","LineStrip","LinePieces","precisionSq","vStart","vEnd","interSegment","interRay","distSq","offsetIndex","nbVertices","updateMorphTargets","morphTargetBase","morphTargetForcedOrder","morphTargetInfluences","morphTargetDictionary","ml","getMorphTargetIndexByName","intersectionPoint","isFaceMaterial","objectMaterials","morphInfluences","tl","influence","targets","Bone","skin","Skeleton","boneInverses","useVertexTexture","identityMatrix","boneTextureWidth","boneTextureHeight","boneMatrices","boneTexture","calculateInverses","bl","pose","bone","offsetMatrix","SkinnedMesh","bindMode","bindMatrix","bindMatrixInverse","gbone","rotq","scl","normalizeSkinWeights","skeleton","sw","MorphAnimMesh","duration","mirroredLoop","lastKeyframe","currentKeyframe","directionBackwards","setFrameRange","startKeyframe","endKeyframe","setDirectionForward","setDirectionBackward","parseAnimations","firstAnimation","pattern","morph","match","setAnimationLabel","playAnimation","updateAnimation","frameTime","keyframe","mix","interpolateTargets","influences","addLevel","getObjectForDistance","matrixPosition","Particle","LensFlare","lensFlares","positionScreen","customUpdateCallback","updateLensFlares","flare","vecX","vecY","wantedRotation","overrideMaterial","autoUpdate","Fog","FogExp2","density","ShaderChunk","merged","uniforms_src","uniforms_dst","parameter_src","UniformsLib","common","diffuse","offsetRepeat","flipEnvMap","bump","normalmap","fogDensity","fogNear","fogFar","fogColor","ambientLightColor","directionalLightDirection","directionalLightColor","hemisphereLightDirection","hemisphereLightSkyColor","hemisphereLightGroundColor","pointLightColor","pointLightPosition","pointLightDistance","pointLightDecay","spotLightColor","spotLightPosition","spotLightDirection","spotLightDistance","spotLightAngleCos","spotLightExponent","spotLightDecay","psColor","shadowmap","ShaderLib","basic","lambert","phong","particle_basic","dashed","totalSize","mNear","mFar","cube","tCube","tFlip","equirect","tEquirect","depthRGBA","createParticleBuffers","__webglVertexBuffer","_gl","createBuffer","__webglColorBuffer","info","memory","createLineBuffers","__webglLineDistanceBuffer","createMeshBuffers","geometryGroup","__webglNormalBuffer","__webglTangentBuffer","__webglUVBuffer","__webglUV2Buffer","__webglSkinIndicesBuffer","__webglSkinWeightsBuffer","__webglFaceBuffer","__webglLineBuffer","numMorphTargets","__webglMorphTargetsBuffers","numMorphNormals","__webglMorphNormalsBuffers","initCustomAttributes","nvertices","__webglCustomAttributesList","__webglInitialized","createUniqueBuffers","belongsToAttribute","initParticleBuffers","__vertexArray","__colorArray","__webglParticleCount","initLineBuffers","__lineDistanceArray","__webglLineCount","initMeshBuffers","faces3","ntris","nlines","getBufferMaterial","__normalArray","__uvArray","__uv2Array","__tangentArray","__skinIndexArray","__skinWeightArray","UintArray","extensions","Uint32Array","__typeArray","__faceArray","__lineArray","__morphTargetsArrays","__morphNormalsArrays","__webglFaceCount","originalAttribute","property","__original","__inittedArrays","materialNeedsFaceNormals","setParticleBuffers","hint","ca","cal","customAttribute","vertexArray","colorArray","dirtyVertices","dirtyColors","customAttributes","bindBuffer","ARRAY_BUFFER","bufferData","boundTo","setLineBuffers","dl","lineDistanceArray","dirtyLineDistances","setMeshBuffers","faceColor","n1","n3","sw1","sw2","sw3","si1","si2","si3","vn","uvi","uv2i","vk","vkl","vka","nka","chf","needsFaceNormals","offset_uv","offset_uv2","offset_face","offset_normal","offset_tangent","offset_line","offset_color","offset_skin","offset_morphTarget","offset_custom","uvArray","uv2Array","normalArray","tangentArray","skinIndexArray","skinWeightArray","morphTargetsArrays","morphNormalsArrays","faceArray","lineArray","dirtyElements","dirtyUvs","dirtyNormals","dirtyTangents","dirtyMorphTargets","morphTargetsNeedUpdate","chunk_faces3","obj_faces","obj_uvs","obj_uvs2","obj_skinIndices","obj_skinWeights","ELEMENT_ARRAY_BUFFER","pp","setupVertexAttributes","program","startIndex","geometryAttributes","programAttributes","programAttributesKeys","programAttribute","geometryAttribute","state","enableAttribute","vertexAttribPointer","FLOAT","vertexAttrib2fv","vertexAttrib3fv","disableUnusedAttributes","setupMorphTargets","numSupportedMorphTargets","__webglMorphTargetInfluences","activeInfluenceIndices","numericalSort","numSupportedMorphNormals","influenceIndex","uniform1fv","painterSortStable","reversePainterSortStable","projectObject","initObject","sprites","webglObjects","_webglObjects","_frustum","webglObject","unrollBufferMaterial","sortObjects","_vector3","_projScreenMatrix","renderObjects","renderList","setupMatrices","setMaterial","setMaterialFaces","renderBufferDirect","renderBuffer","renderObjectsImmediate","materialType","renderImmediateObject","unrollImmediateBufferMaterial","globject","opaque","transparentObjects","opaqueObjects","__webglInit","_modelViewMatrix","_normalMatrix","onObjectRemoved","onGeometryDispose","initGeometryGroups","__webglActive","addBuffer","geometryGroupsList","geometryGroups","ImmediateRenderObject","immediateRenderCallback","addBufferImmediate","_webglObjectsImmediate","makeGroups","usesFaceMaterial","groupHash","group","maxVerticesInGroup","hash_map","groups","groupsList","counter","geometryGroupCounter","addBuffers","objlist","updateObject","bufferType","DYNAMIC_DRAW","STATIC_DRAW","bufferSubData","BYTES_PER_ELEMENT","subarray","customAttributesDirty","areCustomAttributesDirty","clearCustomAttributes","removeObject","removeInstances","o","initMaterial","onMaterialDispose","shaderID","shaderIDs","shader","__webglShader","maxLightCount","allocateLights","maxShadows","allocateShadows","maxBones","allocateBones","_precision","supportsVertexTextures","_supportsVertexTextures","envMapMode","useFog","fogExp","flatShading","logarithmicDepthBuffer","_logarithmicDepthBuffer","_supportsBoneTextures","maxMorphTargets","maxMorphNormals","maxDirLights","directional","maxPointLights","maxSpotLights","spot","maxHemiLights","hemi","shadowMapEnabled","shadowMapType","shadowMapDebug","shadowMapCascade","pl","_programs","programInfo","usedTimes","WebGLProgram","programs","uniformsList","location","setBlending","setDepthTest","setDepthWrite","setColorWrite","setPolygonOffset","setProgram","_usedTextureUnits","deallocateMaterial","refreshProgram","refreshMaterial","refreshLights","p_uniforms","m_uniforms","_currentProgram","useProgram","_currentMaterialId","_currentCamera","uniformMatrix4fv","uniform1f","logDepthBufFC","cameraPosition","uniform3f","viewMatrix","textureUnit","getTextureUnit","uniform1i","setTexture","boneGlobalMatrices","refreshUniformsFog","_lightsNeedUpdate","setupLights","refreshUniformsLights","_lights","markUniformsLightsNeedsUpdate","refreshUniformsCommon","refreshUniformsLine","refreshUniformsDash","refreshUniformsParticle","refreshUniformsPhong","refreshUniformsLambert","_shadowPass","refreshUniformsShadow","loadUniformsGeneric","loadUniformsMatrices","modelMatrix","uvScaleMap","_canvas","ambient","distances","decays","directions","anglesCos","exponents","skyColors","groundColors","modelViewMatrix","uniformMatrix3fv","_maxTextures","uniform","uniform2f","uniform4f","uniform1iv","uniform3iv","uniform2fv","uniform3fv","uniform4fv","_array","setCubeTexture","setCubeTextureDynamic","setColorLinear","ll","zlights","dirColors","dirPositions","pointColors","pointPositions","pointDistances","pointDecays","spotColors","spotPositions","spotDistances","spotDirections","spotAnglesCos","spotExponents","spotDecays","hemiSkyColors","hemiGroundColors","hemiPositions","dirLength","pointLength","spotLength","hemiLength","dirCount","spotCount","hemiCount","dirOffset","pointOffset","spotOffset","hemiOffset","_direction","setTextureParameters","textureType","isImagePowerOfTwo","extension","texParameteri","TEXTURE_WRAP_S","paramThreeToGL","TEXTURE_WRAP_T","TEXTURE_MAG_FILTER","TEXTURE_MIN_FILTER","CLAMP_TO_EDGE","filterFallback","__currentAnisotropy","texParameterf","TEXTURE_MAX_ANISOTROPY_EXT","getMaxAnisotropy","clampToMaxSize","maxSize","slot","__webglTextureCube","onTextureDispose","createTexture","activeTexture","TEXTURE0","bindTexture","TEXTURE_CUBE_MAP","pixelStorei","UNPACK_FLIP_Y_WEBGL","isCompressed","isDataTexture","cubeImage","autoScaleCubemaps","_maxCubemapSize","glFormat","glType","mipmap","getCompressedTextureFormats","compressedTexImage2D","TEXTURE_CUBE_MAP_POSITIVE_X","texImage2D","generateMipmap","__webglTexture","setupFrameBuffer","framebuffer","textureTarget","bindFramebuffer","FRAMEBUFFER","framebufferTexture2D","COLOR_ATTACHMENT0","setupRenderBuffer","renderbuffer","bindRenderbuffer","RENDERBUFFER","depthBuffer","stencilBuffer","renderbufferStorage","DEPTH_COMPONENT16","framebufferRenderbuffer","DEPTH_ATTACHMENT","DEPTH_STENCIL","DEPTH_STENCIL_ATTACHMENT","RGBA4","updateRenderTargetMipmap","TEXTURE_2D","NEAREST","LINEAR","REPEAT","MIRRORED_REPEAT","NEAREST_MIPMAP_NEAREST","NEAREST_MIPMAP_LINEAR","LINEAR_MIPMAP_NEAREST","LINEAR_MIPMAP_LINEAR","UNSIGNED_BYTE","UNSIGNED_SHORT_4_4_4_4","UNSIGNED_SHORT_5_5_5_1","UNSIGNED_SHORT_5_6_5","BYTE","SHORT","UNSIGNED_SHORT","INT","UNSIGNED_INT","HALF_FLOAT_OES","ALPHA","RGB","RGBA","LUMINANCE","LUMINANCE_ALPHA","FUNC_ADD","FUNC_SUBTRACT","FUNC_REVERSE_SUBTRACT","ZERO","ONE","SRC_COLOR","ONE_MINUS_SRC_COLOR","SRC_ALPHA","ONE_MINUS_SRC_ALPHA","DST_ALPHA","ONE_MINUS_DST_ALPHA","DST_COLOR","ONE_MINUS_DST_COLOR","SRC_ALPHA_SATURATE","COMPRESSED_RGB_S3TC_DXT1_EXT","COMPRESSED_RGBA_S3TC_DXT1_EXT","COMPRESSED_RGBA_S3TC_DXT3_EXT","COMPRESSED_RGBA_S3TC_DXT5_EXT","COMPRESSED_RGB_PVRTC_4BPPV1_IMG","COMPRESSED_RGB_PVRTC_2BPPV1_IMG","COMPRESSED_RGBA_PVRTC_4BPPV1_IMG","COMPRESSED_RGBA_PVRTC_2BPPV1_IMG","MIN_EXT","MAX_EXT","nVertexUniforms","MAX_VERTEX_UNIFORM_VECTORS","nVertexMatrices","dirLights","pointLights","spotLights","hemiLights","_context","pixelRatio","_alpha","_depth","_stencil","stencil","_antialias","_premultipliedAlpha","premultipliedAlpha","_preserveDrawingBuffer","preserveDrawingBuffer","_clearColor","_clearAlpha","autoClear","autoClearColor","autoClearDepth","autoClearStencil","gammaInput","gammaOutput","shadowMapCullFace","calls","_currentFramebuffer","_currentGeometryProgram","_viewportX","_viewportY","_viewportWidth","_viewportHeight","_currentWidth","_currentHeight","resetGLState","setDefaultGLState","WebGLState","getShaderPrecisionFormat","rangeMin","rangeMax","WebGLExtensions","glClearColor","clearColor","clearDepth","clearStencil","enable","DEPTH_TEST","depthFunc","LEQUAL","frontFace","CCW","cullFace","BACK","CULL_FACE","BLEND","blendFunc","viewport","reset","MAX_TEXTURE_IMAGE_UNITS","_maxVertexTextures","MAX_VERTEX_TEXTURE_IMAGE_UNITS","_maxTextureSize","MAX_TEXTURE_SIZE","MAX_CUBE_MAP_TEXTURE_SIZE","_vertexShaderPrecisionHighpFloat","VERTEX_SHADER","HIGH_FLOAT","_vertexShaderPrecisionMediumpFloat","MEDIUM_FLOAT","_fragmentShaderPrecisionHighpFloat","FRAGMENT_SHADER","_fragmentShaderPrecisionMediumpFloat","formats","COMPRESSED_TEXTURE_FORMATS","highpAvailable","mediumpAvailable","shadowMapPlugin","ShadowMapPlugin","spritePlugin","SpritePlugin","lensFlarePlugin","LensFlarePlugin","forceContextLoss","loseContext","supportsFloatTextures","supportsHalfFloatTextures","supportsStandardDerivatives","supportsCompressedTextureS3TC","supportsCompressedTexturePVRTC","supportsBlendMinMax","MAX_TEXTURE_MAX_ANISOTROPY_EXT","getPrecision","getPixelRatio","setPixelRatio","updateStyle","setViewport","setScissor","scissor","enableScissorTest","SCISSOR_TEST","disable","getClearColor","getClearAlpha","setClearAlpha","COLOR_BUFFER_BIT","DEPTH_BUFFER_BIT","STENCIL_BUFFER_BIT","clearTarget","setRenderTarget","deallocateGeometry","deallocateTexture","onRenderTargetDispose","deallocateRenderTarget","deleteBuffers","buffers","deleteBuffer","deleteTexture","deleteFramebuffer","__webglFramebuffer","deleteRenderbuffer","__webglRenderbuffer","deleteProgram","newPrograms","renderBufferImmediate","initAttributes","hasPositions","hasNormals","hasUvs","__webglUvBuffer","hasColors","positionArray","nx","ny","nz","nax","nbx","ncx","nay","nby","ncy","naz","nbz","ncz","drawArrays","TRIANGLES","updateBuffers","wireframeBit","geometryProgram","LINES","drawElements","POINTS","LINE_STRIP","setLineWidth","skinIndex","skinWeight","lineDistance","forceClear","setFaceCulling","frontFaceDirection","CW","FRONT","FRONT_AND_BACK","setDoubleSided","setFlipSided","uploadTexture","UNPACK_PREMULTIPLY_ALPHA_WEBGL","UNPACK_ALIGNMENT","isCube","isTargetPowerOfTwo","createFramebuffer","createRenderbuffer","shareDepthFrom","vx","vy","readRenderTargetPixels","WebGLRenderTarget","restore","checkFramebufferStatus","FRAMEBUFFER_COMPLETE","readPixels","addPrePlugin","addPostPlugin","updateShadowMap","gl","getExtension","programIdCount","generateDefines","chunk","cacheUniformLocations","identifiers","getUniformLocation","cacheAttributeLocations","getAttribLocation","shadowMapTypeDefine","envMapTypeDefine","envMapModeDefine","envMapBlendingDefine","prefix_vertex","prefix_fragment","gammaFactorDefine","customDefines","createProgram","glVertexShader","WebGLShader","glFragmentShader","attachShader","bindAttribLocation","linkProgram","programLogInfo","getProgramInfoLog","getProgramParameter","LINK_STATUS","getError","VALIDATE_STATUS","deleteShader","addLineNumbers","string","lines","createShader","shaderSource","compileShader","getShaderParameter","COMPILE_STATUS","getShaderInfoLog","newAttributes","enabledAttributes","currentBlending","currentBlendEquation","currentBlendSrc","currentBlendDst","currentBlendEquationAlpha","currentBlendSrcAlpha","currentBlendDstAlpha","currentDepthTest","currentDepthWrite","currentColorWrite","currentDoubleSided","currentFlipSided","currentLineWidth","currentPolygonOffset","currentPolygonOffsetFactor","currentPolygonOffsetUnits","enableVertexAttribArray","disableVertexAttribArray","blendEquationSeparate","blendFuncSeparate","depthMask","colorMask","polygonoffset","units","POLYGON_OFFSET_FILL","flares","prefix","vertexBuffer","elementBuffer","hasVertexTexture","tempTexture","occlusionTexture","renderType","occlusionMap","screenPosition","viewportWidth","viewportHeight","tempPosition","invAspect","halfViewportWidth","halfViewportHeight","screenPositionPixels","TEXTURE1","copyTexImage2D","sprite","_renderer","_renderList","createVirtualLight","cascade","virtualLight","isVirtual","pointsWorld","pointsFrustum","nearZ","farZ","updateVirtualLight","updateShadowCamera","_min","_max","getObjectMaterial","_depthMaterial","_depthMaterialMorph","_depthMaterialSkin","_depthMaterialMorphSkin","_matrixPosition","depthShader","depthUniforms","originalCamera","gyro","shadowFilter","pars","cameraHelper","CameraHelper","objectMaterial","useMorphing","useSkinning","customDepthMaterial","clearAlpha","spritePosition","spriteRotation","spriteScale","uvOffset","uvScale","fogType","oldFogType","sceneFogType","GeometryUtils","geometry1","geometry2","loadTextureCube","loadCompressedTexture","loadCompressedTextureCube","getNormalMap","subtract","imageData","createImageData","ly","uy","lx","ux","num_points","generateDataTexture","SceneUtils","createMultiMaterialObject","detach","attach","FontUtils","divisions","getFace","loadFace","family","familyName","ThreeFont","cssFontWeight","cssFontStyle","drawText","resolution","fontPaths","Path","ret","extractGlyphPoints","paths","outline","action","cpx","cpy","cpx0","cpy0","cpx1","cpy1","cpx2","cpy2","laste","pts","glyph","glyphs","_cachedOutline","quadraticCurveTo","Shape","bezierCurveTo","ha","generateShapes","curveSegments","font","shapes","toShapes","namespace","EPSILON","process","contour","verts","vertIndices","nv","snip","px","py","aX","aY","bX","bY","cX","cY","apx","apy","bpx","bpy","cCROSSap","bCROSScp","aCROSSbp","Triangulate","_typeface_js","typeface_js","Audio","source","createBufferSource","onended","onEnded","gain","createGain","connect","destination","panner","createPanner","autoplay","isPlaying","decodeAudioData","loop","setLoop","setRefDistance","refDistance","setRolloffFactor","rolloffFactor","setVolume","AudioListener","AudioContext","webkitAudioContext","orientation","positionPrev","setOrientation","setVelocity","Curve","getPointAt","getUtoTmapping","getPoints","getSpacedPoints","lengths","getLengths","cacheArcLengths","current","cache","sum","updateArcLengths","targetArcLength","arcLengths","comparison","lengthBefore","lengthAfter","segmentLength","segmentFraction","getTangent","pt1","pt2","vec","getTangentAt","tangentQuadraticBezier","tangentCubicBezier","tangentSpline","h00","h10","h01","h11","getPointFunc","CurvePath","curves","bends","autoClose","curve","checkConnection","closePath","startPoint","endPoint","LineCurve","curveLengths","getCurveLengths","lens","cacheLengths","sums","maxX","maxY","maxZ","minX","minY","minZ","NEGATIVE_INFINITY","POSITIVE_INFINITY","createPointsGeometry","createGeometry","createSpacedPointsGeometry","addWrapPath","bendpath","getTransformedPoints","oldPts","getWrapPoints","getTransformedSpacedPoints","oldX","oldY","xNorm","bounds","pathPt","translationObject","quaternionObject","scaleObject","translationWorld","quaternionWorld","scaleWorld","actions","fromPoints","PathActions","MOVE_TO","LINE_TO","QUADRATIC_CURVE_TO","BEZIER_CURVE_TO","CSPLINE_THRU","ARC","ELLIPSE","vectors","vlen","args","lastargs","x0","y0","aCPx","aCPy","QuadraticBezierCurve","aCP1x","aCP1y","aCP2x","aCP2y","CubicBezierCurve","splineThru","npts","SplineCurve","aRadius","aStartAngle","aEndAngle","aClockwise","absarc","absellipse","ellipse","xRadius","yRadius","EllipseCurve","lastPoint","closedPath","useSpacedPoints","item","spts","spline","deltaAngle","tdivisions","isCCW","noHoles","extractSubpaths","inActions","subPaths","lastPath","toShapesNoHoles","inSubpaths","tmpPath","tmpShape","isPointInsidePolygon","inPt","inPolygon","polyLen","inside","edgeLowPt","edgeHighPt","edgeDx","edgeDy","perpEdge","solid","holesFirst","isClockWise","tmpPoints","betterShapeHoles","newShapes","newShapeHoles","mainIdx","ambigious","toChange","sIdx","sLen","sho","hIdx","ho","hole_unassigned","s2Idx","froms","tos","hole","tmpHoles","holes","extrude","extruded","ExtrudeGeometry","makeGeometry","ShapeGeometry","getPointsHoles","holesPts","getSpacedPointsHoles","extractAllPoints","shape","extractPoints","extractAllSpacedPoints","triangulateShape","point_in_segment_2D_colin","inSegPt1","inSegPt2","inOtherPt","intersect_segments_2D","inSeg1Pt1","inSeg1Pt2","inSeg2Pt1","inSeg2Pt2","inExcludeAdjacentSegs","seg1dx","seg1dy","seg2dx","seg2dy","seg1seg2dx","seg1seg2dy","perpSeg1","perpSeg2","factorSeg1","seg1Pt","seg2Pt","seg1min","seg1max","seg1minVal","seg1maxVal","seg2min","seg2max","seg2minVal","seg2maxVal","isPointInsideAngle","inVertex","inLegFromPt","inLegToPt","legFromPtX","legFromPtY","legToPtX","legToPtY","otherPtX","otherPtY","from2toAngle","from2otherAngle","other2toAngle","removeHoles","isCutLineInsideAngles","inShapeIdx","inHoleIdx","lastShapeIdx","prevShapeIdx","nextShapeIdx","insideAngle","lastHoleIdx","prevHoleIdx","nextHoleIdx","intersectsShapeEdge","inShapePt","inHolePt","nextIdx","intersection","intersectsHoleEdge","ihIdx","chkHole","indepHoles","holeIndex","shapeIndex","shapePt","holePt","holeIdx","cutKey","tmpShape1","tmpShape2","tmpHole1","tmpHole2","failedCuts","hl","minShapeIndex","h2","allPointsMap","allpoints","shapeWithoutHoles","b2p0","b2p1","b2p2","b3p0","b3p1","b3p2","b3p3","point0","point1","point2","point3","ArcCurve","LineCurve3","QuadraticBezierCurve3","CubicBezierCurve3","SplineCurve3","ClosedSplineCurve3","AnimationHandler","CATMULLROM","CATMULLROM_FORWARD","hierarchy","rot","usedMorphTargets","morphTargetName","morphTargetsInfluences","parseRecurseHierarchy","deltaTimeMS","resetBlendWeights","Animation","timeScale","interpolationType","keyTypes","animationCache","positionWeight","quaternionWeight","scaleWeight","prevKey","nextKey","originalMatrix","getNextKeyWith","newVector","newQuat","interpolateCatmullRom","prevXYZ","nextXYZ","proportionalWeight","getPrevKeyWith","currentPoint","forwardPoint","KeyFrameAnimation","isPaused","sids","sid","next","endTime","original","hasTarget","MorphAnimation","lastFrame","currentFrame","interpolation","buildPlane","udir","vdir","gridX","gridY","width_half","height_half","gridX1","gridY1","segment_width","segment_height","uvd","depth_half","centerUV","segment","CubeGeometry","heightHalf","verticesRow","uvsRow","tanTheta","v4","n4","uv1","uv3","uv4","addShapeList","addShape","scalePt2","pt","getBevelVec","inPrev","inNext","v_trans_x","v_trans_y","shrink_by","v_prev_x","v_prev_y","v_next_x","v_next_y","v_prev_lensq","colinear0","v_prev_len","v_next_len","ptPrevShift_x","ptPrevShift_y","ptNextShift_x","ptNextShift_y","sf","v_trans_lensq","direction_eq","buildLidFaces","bevelEnabled","layer","flen","f3","bevelSegments","buildSideFaces","layeroffset","sidewalls","ahole","slen1","slen2","f4","shapesOffset","uvgen","generateTopUV","wallContour","stepIndex","stepsLength","contourIndex1","contourIndex2","extrudeMaterial","generateSideWallUV","extrudePts","splineTube","binormal","position2","bevelThickness","bevelSize","extrudePath","extrudeByPath","UVGenerator","WorldUVGenerator","TubeGeometry","FrenetFrames","shapePoints","reverse","bs","vert","contourMovements","oneHoleMovements","holesMovements","verticesMovements","binormals","indexA","indexB","indexC","indexD","LatheGeometry","inversePointLength","inverseSegments","phi","np","u0","u1","PlaneGeometry","PlaneBufferGeometry","offset2","RingGeometry","innerRadius","outerRadius","thetaSegments","phiSegments","radiusStep","thetaSegment","TextGeometry","textShapes","getPos","in_q","in_p","cu","su","quOverP","cs","tz","grid","tang","bitan","ip","jp","closed","taper","NoTaper","numpoints","pos2","SinusoidalTaper","initialNormal3","smallest","MAX_VALUE","PolyhedronGeometry","prepare","that","azimuth","inclination","centroid","azi","correctUV","subdivide","cols","bj","DodecahedronGeometry","OctahedronGeometry","TetrahedronGeometry","ParametricGeometry","func","slices","stacks","sliceCount","AxisHelper","ArrowHelper","lineGeometry","coneGeometry","headLength","headWidth","cone","setDirection","setColor","BoxHelper","BoundingBoxHelper","addLine","addPoint","pointMap","hexFrustum","hexCone","hexUp","hexTarget","hexCross","setPoint","DirectionalLightHelper","lightPlane","targetLine","EdgesHelper","thresholdAngle","thresholdDot","edge","sortFunction","numEdges","vert1","vert2","face1","face2","FaceNormalsHelper","objectVertices","objectFaces","objectWorldMatrix","GridHelper","setColors","colorCenterLine","colorGrid","HemisphereLightHelper","sphereSize","lightSphere","PointLightHelper","SkeletonHelper","getBoneList","boneList","matrixWorldInv","boneMatrix","SpotLightHelper","vector2","coneLength","coneWidth","VertexNormalsHelper","worldMatrix","vertexId","VertexTangentsHelper","WireframeHelper","edges","numTris","renderCallback","MorphBlendMesh","animationsMap","animationsList","numFrames","startFrame","endFrame","createAnimation","setAnimationWeight","active","autoCreateAnimations","frameRanges","setAnimationDirectionForward","setAnimationDirectionBackward","setAnimationFPS","setAnimationDuration","setAnimationTime","getAnimationTime","getAnimationDuration","stopAnimation","ERROR","COMPOSITE","DECORATOR","ACTION","CONDITION","createUUID","hexDigits","substr","baseClass","cls","_baseMemory","_treeMemory","_getTreeMemory","treeScope","nodeMemory","openNodes","traversalDepth","traversalCycle","_getNodeMemory","treeMemory","nodeScope","_getMemory","Tick","_openNodes","_nodeCount","_enterNode","_openNode","_tickNode","_closeNode","_exitNode","title","description","properties","names","nodes","spec","EvalError","category","cid","dump","stack","lastOpenNodes","currOpenNodes","_close","BaseNode","_enter","_open","_tick","_exit","enter","close","exit","__BaseNode_initialize","Decorator","Condition","Priority","MemSequence","MemPriority","Inverter","Limiter","maxLoop","__Decorator_initialize","MaxTime","maxTime","getTime","currTime","Repeater","RepeatUntilFailure","RepeatUntilSuccess","Failer","Runner","Succeeder","Wait","milliseconds","Entity","Messanger","ObjectPool","QuadTree","Spatial","Vec2","Ai","messanger","_tags","_entities","_groups","_entityPool","_componentPools","Components","componentPropertyName","Component","getName","charAt","groupKey","T","ENTITY_CREATED","ENTITY_REMOVE","COMPONENT_ADDED","COMPONENT_REMOVE","aquire","_trigger","removeEntitiesByTag","tag","removeAllEntities","removeEntity","entityRemoveAllComponents","release","entityAddTag","entityRemoveTag","entityAddComponent","_Components","cName","cPool","component","groupName","hasAllComponents","Cs","entityRemoveComponent","loc","propName","_indexGroup","poolStats","used","totalUsed","pool","trigger","TComponent","removeTag","level","maxEntities","maxLevels","__init","insert","_getIndex","spatial","absPosition","absHwidth","_splitAndRedistributeIfNeeded","_node","queryArea","hwidth","out__entities","overlapping","rectIntersect","reIndex","_combine","tSize","tPos","validateEntity","hw","assign","smult","rectContains","midX","midY","_split","_redistribute","_factory","freeList","expand","totalFree","_absScale","_absPosition","_absHwidth","COINCIDENT","attachTo","absRotation","rotate","pScale","absScale","magnitude","magnitude2","angleBetween","pcopy","fromAngle","pfromAngle","r1","r2","sizeToHwidth","out__position","out__hwidth","_events","fired","handled","Event","listenTo","eventName","option","events","fire","_name","_callback","Comps","whereComponent","whereComponents","extends","mixin","getArguments","extends_","Child","Parent","Super","Function","makeT","mixin_","FUNCTION_NAME","FUNCTION_ARGS","replace"],"mappings":"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vE,KAAM,IACN83B,MAAO,KAGTk7C,uBACEhzE,KAAM,IACN83B,MAAO,IAKX0gD,MAEE5U,SACE5jE,KAAM,IACN83B,MAAO,MAET6uC,WACE3mE,KAAM,IACN83B,MAAO,IAKX2gD,WAEE9U,WACE3jE,KAAM,IACN83B,MAAO,MAET+uC,aACE7mE,KAAM,KACN83B,MAAO,GAAI7/B,OAAM82C,QAAQ,EAAG,KAIhCugC,KAEEoJ,YACE14E,KAAM,IACN83B,MAAO,OAET6gD,SACE34E,KAAM,IACN83B,MAAO,GAET8gD,QACE54E,KAAM,IACN83B,MAAO,KAET+gD,UACE74E,KAAM,IACN83B,MAAO,GAAI7/B,OAAMimB,MAAM,YAK3BqyD,QAEEuI,mBACE94E,KAAM,KACN83B,UAGFihD,2BACE/4E,KAAM,KACN83B,UAEFkhD,uBACEh5E,KAAM,KACN83B,UAGFmhD,0BACEj5E,KAAM,KACN83B,UAEFohD,yBACEl5E,KAAM,KACN83B,UAEFqhD,4BACEn5E,KAAM,KACN83B,UAGFshD,iBACEp5E,KAAM,KACN83B,UAEFuhD,oBACEr5E,KAAM,KACN83B,UAEFwhD,oBACEt5E,KAAM,MACN83B,UAEFyhD,iBACEv5E,KAAM,MACN83B,UAGF0hD,gBACEx5E,KAAM,KACN83B,UAEF2hD,mBACEz5E,KAAM,KACN83B,UAEF4hD,oBACE15E,KAAM,KACN83B,UAEF6hD,mBACE35E,KAAM,MACN83B,UAEF8hD,mBACE55E,KAAM,MACN83B,UAEF+hD,mBACE75E,KAAM,MACN83B,UAEFgiD,gBACE95E,KAAM,MACN83B,WAKJxY,UAEEy6D,SACE/5E,KAAM,IACN83B,MAAO,GAAI7/B,OAAMimB,MAAM,WAEzBulD,SACEzjE,KAAM,IACN83B,MAAO,GAETt9B,MACEwF,KAAM,IACN83B,MAAO,GAETtyB,OACExF,KAAM,IACN83B,MAAO,GAEThS,KACE9lB,KAAM,IACN83B,MAAO,MAETwgD,cACEt4E,KAAM,KACN83B,MAAO,GAAI7/B,OAAMk7C,QAAQ,EAAG,EAAG,EAAG,IAGpCulC,YACE14E,KA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","file":"bundle.js","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})","global.Class = require('js-class');\r\nglobal.THREE = require('three');\r\nglobal.THREEx = require('./js/THREEx.KeyboardState.js');\r\nglobal.Physijs = require('physijs-browserify')(THREE);\r\nglobal.Stats = require('stats.js');\r\n\r\nrequire('./RequestAnimationFrame.js');\r\nrequire('./rubbable.js');\r\nglobal.SuperGif = require('./libgif.js');\r\n\r\nglobal.Utils = require('./js/Utils.js');\r\n\r\nrequire('./js/Game.js');\r\nrequire('./js/Globals.js');\r\nrequire('./js/ResourceManager.js');\r\nrequire('./js/PointerLockControls.js');\r\nrequire('./js/EntityFactory.js');\r\nrequire('./js/Systems.js');\r\nrequire('./js/MouseController.js');\r\n\r\nPhysijs.scripts.worker = './libs/physijsWorker.js';\r\nPhysijs.scripts.ammo = './ammo.js';\r\n\r\n// purpose: function as a basic FPS game using an ECS (entity-component system) pattern\r\n//\r\n// requires: RequestAnimationFrame.js, three.js, three-pointerlockcontrols.js, stats.js, js-class.js, physijs, tiny-ecs\r\n//           Game.js, ResourceManager.js\r\n//\r\n// author: Cornell Daly\r\n//\r\n// date: November 3, 2015\r\n//\r\n// additional notes: code is separated into multiple files\r\n\r\nvar game = null;\r\n\r\nfunction init() {\r\n  Globals.instance.hudElement = document.getElementById(\"hud\");\r\n\r\n  Globals.instance.healthElement = document.getElementById(\"health\");\r\n  Globals.instance.scoreElement = document.getElementById(\"score\");\r\n\r\n  Globals.instance.reloadingElement = document.getElementById(\"reloading\");\r\n  Globals.instance.reloadImg = new SuperGif({\r\n    gif: document.getElementById(\"reloadImg\")\r\n  });\r\n  Globals.instance.reloadImg.load();\r\n\r\n  Globals.instance.overlayElement = document.getElementById(\"overlay\");\r\n\r\n  var gameOptions = {\r\n    container: document.getElementById(\"container\"),\r\n    loadingContainer: document.getElementById(\"loadingContainer\"),\r\n    blocker: document.getElementById(\"blocker\"),\r\n    instructions: document.getElementById(\"instructions\"),\r\n    crosshair: document.getElementById(\"crosshair\"),\r\n    modelsToPreload: [\r\n      \"models/potato.json\",\r\n      \"models/potatoCannon.json\",\r\n      \"models/character.json\",\r\n      \"models/fry.json\"\r\n    ]\r\n  };\r\n  game = new Game(gameOptions);\r\n\r\n  game.start();\r\n}\r\n\r\ninit();\r\n\r\n","/*\n    SuperGif\n\n    Example usage:\n\n        <img src=\"./example1_preview.gif\" rel:animated_src=\"./example1.gif\" width=\"360\" height=\"360\" rel:auto_play=\"1\" />\n\n        <script type=\"text/javascript\">\n            $$('img').each(function (img_tag) {\n                if (/.*\\.gif/.test(img_tag.src)) {\n                    var rub = new SuperGif({ gif: img_tag } );\n                    rub.load();\n                }\n            });\n        </script>\n\n    Image tag attributes:\n\n        rel:animated_src -  If this url is specified, it's loaded into the player instead of src.\n                            This allows a preview frame to be shown until animated gif data is streamed into the canvas\n\n        rel:auto_play -     Defaults to 1 if not specified. If set to zero, a call to the play() method is needed\n\n    Constructor options args\n\n        gif                 Required. The DOM element of an img tag.\n        loop_mode           Optional. Setting this to false will force disable looping of the gif.\n        auto_play           Optional. Same as the rel:auto_play attribute above, this arg overrides the img tag info.\n        max_width           Optional. Scale images over max_width down to max_width. Helpful with mobile.\n        on_end              Optional. Add a callback for when the gif reaches the end of a single loop (one iteration). The first argument passed will be the gif HTMLElement.\n        loop_delay          Optional. The amount of time to pause (in ms) after each single loop (iteration).\n        draw_while_loading  Optional. Determines whether the gif will be drawn to the canvas whilst it is loaded.\n        show_progress_bar   Optional. Only applies when draw_while_loading is set to true.\n\n    Instance methods\n\n        // loading\n        load( callback )        Loads the gif specified by the src or rel:animated_src sttributie of the img tag into a canvas element and then calls callback if one is passed\n        load_url( src, callback )   Loads the gif file specified in the src argument into a canvas element and then calls callback if one is passed\n\n        // play controls\n        play -              Start playing the gif\n        pause -             Stop playing the gif\n        move_to(i) -        Move to frame i of the gif\n        move_relative(i) -  Move i frames ahead (or behind if i < 0)\n\n        // getters\n        get_canvas          The canvas element that the gif is playing in. Handy for assigning event handlers to.\n        get_playing         Whether or not the gif is currently playing\n        get_loading         Whether or not the gif has finished loading/parsing\n        get_auto_play       Whether or not the gif is set to play automatically\n        get_length          The number of frames in the gif\n        get_current_frame   The index of the currently displayed frame of the gif\n\n        For additional customization (viewport inside iframe) these params may be passed:\n        c_w, c_h - width and height of canvas\n        vp_t, vp_l, vp_ w, vp_h - top, left, width and height of the viewport\n\n        A bonus: few articles to understand what is going on\n            http://enthusiasms.org/post/16976438906\n            http://www.matthewflickinger.com/lab/whatsinagif/bits_and_bytes.asp\n            http://humpy77.deviantart.com/journal/Frame-Delay-Times-for-Animated-GIFs-214150546\n\n*/\n\n// Generic functions\nvar bitsToNum = function(ba) {\n  return ba.reduce(function(s, n) {\n    return s * 2 + n;\n  }, 0);\n};\n\nvar byteToBitArr = function(bite) {\n  var a = [];\n  for (var i = 7; i >= 0; i--) {\n    a.push(!!(bite & (1 << i)));\n  }\n  return a;\n};\n\n// Stream\n/**\n * @constructor\n */\n// Make compiler happy.\nvar Stream = function(data) {\n  this.data = data;\n  this.len = this.data.length;\n  this.pos = 0;\n\n  this.readByte = function() {\n    if (this.pos >= this.data.length) {\n      throw new Error('Attempted to read past end of stream.');\n    }\n    if (data instanceof Uint8Array)\n      return data[this.pos++];\n    else\n      return data.charCodeAt(this.pos++) & 0xFF;\n  };\n\n  this.readBytes = function(n) {\n    var bytes = [];\n    for (var i = 0; i < n; i++) {\n      bytes.push(this.readByte());\n    }\n    return bytes;\n  };\n\n  this.read = function(n) {\n    var s = '';\n    for (var i = 0; i < n; i++) {\n      s += String.fromCharCode(this.readByte());\n    }\n    return s;\n  };\n\n  this.readUnsigned = function() { // Little-endian.\n    var a = this.readBytes(2);\n    return (a[1] << 8) + a[0];\n  };\n};\n\nvar lzwDecode = function(minCodeSize, data) {\n  // TODO: Now that the GIF parser is a bit different, maybe this should get an array of bytes instead of a String?\n  var pos = 0; // Maybe this streaming thing should be merged with the Stream?\n  var readCode = function(size) {\n    var code = 0;\n    for (var i = 0; i < size; i++) {\n      if (data.charCodeAt(pos >> 3) & (1 << (pos & 7))) {\n        code |= 1 << i;\n      }\n      pos++;\n    }\n    return code;\n  };\n\n  var output = [];\n\n  var clearCode = 1 << minCodeSize;\n  var eoiCode = clearCode + 1;\n\n  var codeSize = minCodeSize + 1;\n\n  var dict = [];\n\n  var clear = function() {\n    dict = [];\n    codeSize = minCodeSize + 1;\n    for (var i = 0; i < clearCode; i++) {\n      dict[i] = [i];\n    }\n    dict[clearCode] = [];\n    dict[eoiCode] = null;\n\n  };\n\n  var code;\n  var last;\n\n  while (true) {\n    last = code;\n    code = readCode(codeSize);\n\n    if (code === clearCode) {\n      clear();\n      continue;\n    }\n    if (code === eoiCode) break;\n\n    if (code < dict.length) {\n      if (last !== clearCode) {\n        dict.push(dict[last].concat(dict[code][0]));\n      }\n    }\n    else {\n      if (code !== dict.length) throw new Error('Invalid LZW code.');\n      dict.push(dict[last].concat(dict[last][0]));\n    }\n    output.push.apply(output, dict[code]);\n\n    if (dict.length === (1 << codeSize) && codeSize < 12) {\n      // If we're at the last code and codeSize is 12, the next code will be a clearCode, and it'll be 12 bits long.\n      codeSize++;\n    }\n  }\n\n  // I don't know if this is technically an error, but some GIFs do it.\n  //if (Math.ceil(pos / 8) !== data.length) throw new Error('Extraneous LZW bytes.');\n  return output;\n};\n\n\n// The actual parsing; returns an object with properties.\nvar parseGIF = function(st, handler) {\n  handler || (handler = {});\n\n  // LZW (GIF-specific)\n  var parseCT = function(entries) { // Each entry is 3 bytes, for RGB.\n    var ct = [];\n    for (var i = 0; i < entries; i++) {\n      ct.push(st.readBytes(3));\n    }\n    return ct;\n  };\n\n  var readSubBlocks = function() {\n    var size, data;\n    data = '';\n    do {\n      size = st.readByte();\n      data += st.read(size);\n    } while (size !== 0);\n    return data;\n  };\n\n  var parseHeader = function() {\n    var hdr = {};\n    hdr.sig = st.read(3);\n    hdr.ver = st.read(3);\n    if (hdr.sig !== 'GIF') throw new Error('Not a GIF file.'); // XXX: This should probably be handled more nicely.\n    hdr.width = st.readUnsigned();\n    hdr.height = st.readUnsigned();\n\n    var bits = byteToBitArr(st.readByte());\n    hdr.gctFlag = bits.shift();\n    hdr.colorRes = bitsToNum(bits.splice(0, 3));\n    hdr.sorted = bits.shift();\n    hdr.gctSize = bitsToNum(bits.splice(0, 3));\n\n    hdr.bgColor = st.readByte();\n    hdr.pixelAspectRatio = st.readByte(); // if not 0, aspectRatio = (pixelAspectRatio + 15) / 64\n    if (hdr.gctFlag) {\n      hdr.gct = parseCT(1 << (hdr.gctSize + 1));\n    }\n    handler.hdr && handler.hdr(hdr);\n  };\n\n  var parseExt = function(block) {\n    var parseGCExt = function(block) {\n      var blockSize = st.readByte(); // Always 4\n      var bits = byteToBitArr(st.readByte());\n      block.reserved = bits.splice(0, 3); // Reserved; should be 000.\n      block.disposalMethod = bitsToNum(bits.splice(0, 3));\n      block.userInput = bits.shift();\n      block.transparencyGiven = bits.shift();\n\n      block.delayTime = st.readUnsigned();\n\n      block.transparencyIndex = st.readByte();\n\n      block.terminator = st.readByte();\n\n      handler.gce && handler.gce(block);\n    };\n\n    var parseComExt = function(block) {\n      block.comment = readSubBlocks();\n      handler.com && handler.com(block);\n    };\n\n    var parsePTExt = function(block) {\n      // No one *ever* uses this. If you use it, deal with parsing it yourself.\n      var blockSize = st.readByte(); // Always 12\n      block.ptHeader = st.readBytes(12);\n      block.ptData = readSubBlocks();\n      handler.pte && handler.pte(block);\n    };\n\n    var parseAppExt = function(block) {\n      var parseNetscapeExt = function(block) {\n        var blockSize = st.readByte(); // Always 3\n        block.unknown = st.readByte(); // ??? Always 1? What is this?\n        block.iterations = st.readUnsigned();\n        block.terminator = st.readByte();\n        handler.app && handler.app.NETSCAPE && handler.app.NETSCAPE(block);\n      };\n\n      var parseUnknownAppExt = function(block) {\n        block.appData = readSubBlocks();\n        // FIXME: This won't work if a handler wants to match on any identifier.\n        handler.app && handler.app[block.identifier] && handler.app[block.identifier](block);\n      };\n\n      var blockSize = st.readByte(); // Always 11\n      block.identifier = st.read(8);\n      block.authCode = st.read(3);\n      switch (block.identifier) {\n        case 'NETSCAPE':\n          parseNetscapeExt(block);\n          break;\n        default:\n          parseUnknownAppExt(block);\n          break;\n      }\n    };\n\n    var parseUnknownExt = function(block) {\n      block.data = readSubBlocks();\n      handler.unknown && handler.unknown(block);\n    };\n\n    block.label = st.readByte();\n    switch (block.label) {\n      case 0xF9:\n        block.extType = 'gce';\n        parseGCExt(block);\n        break;\n      case 0xFE:\n        block.extType = 'com';\n        parseComExt(block);\n        break;\n      case 0x01:\n        block.extType = 'pte';\n        parsePTExt(block);\n        break;\n      case 0xFF:\n        block.extType = 'app';\n        parseAppExt(block);\n        break;\n      default:\n        block.extType = 'unknown';\n        parseUnknownExt(block);\n        break;\n    }\n  };\n\n  var parseImg = function(img) {\n    var deinterlace = function(pixels, width) {\n      // Of course this defeats the purpose of interlacing. And it's *probably*\n      // the least efficient way it's ever been implemented. But nevertheless...\n      var newPixels = new Array(pixels.length);\n      var rows = pixels.length / width;\n      var cpRow = function(toRow, fromRow) {\n        var fromPixels = pixels.slice(fromRow * width, (fromRow + 1) * width);\n        newPixels.splice.apply(newPixels, [toRow * width, width].concat(fromPixels));\n      };\n\n      // See appendix E.\n      var offsets = [0, 4, 2, 1];\n      var steps = [8, 8, 4, 2];\n\n      var fromRow = 0;\n      for (var pass = 0; pass < 4; pass++) {\n        for (var toRow = offsets[pass]; toRow < rows; toRow += steps[pass]) {\n          cpRow(toRow, fromRow)\n          fromRow++;\n        }\n      }\n\n      return newPixels;\n    };\n\n    img.leftPos = st.readUnsigned();\n    img.topPos = st.readUnsigned();\n    img.width = st.readUnsigned();\n    img.height = st.readUnsigned();\n\n    var bits = byteToBitArr(st.readByte());\n    img.lctFlag = bits.shift();\n    img.interlaced = bits.shift();\n    img.sorted = bits.shift();\n    img.reserved = bits.splice(0, 2);\n    img.lctSize = bitsToNum(bits.splice(0, 3));\n\n    if (img.lctFlag) {\n      img.lct = parseCT(1 << (img.lctSize + 1));\n    }\n\n    img.lzwMinCodeSize = st.readByte();\n\n    var lzwData = readSubBlocks();\n\n    img.pixels = lzwDecode(img.lzwMinCodeSize, lzwData);\n\n    if (img.interlaced) { // Move\n      img.pixels = deinterlace(img.pixels, img.width);\n    }\n\n    handler.img && handler.img(img);\n  };\n\n  var parseBlock = function() {\n    var block = {};\n    block.sentinel = st.readByte();\n\n    switch (String.fromCharCode(block.sentinel)) { // For ease of matching\n      case '!':\n        block.type = 'ext';\n        parseExt(block);\n        break;\n      case ',':\n        block.type = 'img';\n        parseImg(block);\n        break;\n      case ';':\n        block.type = 'eof';\n        handler.eof && handler.eof(block);\n        break;\n      default:\n        throw new Error('Unknown block: 0x' + block.sentinel.toString(16)); // TODO: Pad this with a 0.\n    }\n\n    if (block.type !== 'eof') setTimeout(parseBlock, 0);\n  };\n\n  var parse = function() {\n    parseHeader();\n    setTimeout(parseBlock, 0);\n  };\n\n  parse();\n};\n\nvar SuperGif = function(opts) {\n  var options = {\n    //viewport position\n    vp_l: 0,\n    vp_t: 0,\n    vp_w: null,\n    vp_h: null,\n    //canvas sizes\n    c_w: null,\n    c_h: null\n  };\n  for (var i in opts) {\n    options[i] = opts[i]\n  }\n  if (options.vp_w && options.vp_h) options.is_vp = true;\n\n  var stream;\n  var hdr;\n\n  var loadError = null;\n  var loading = false;\n\n  var transparency = null;\n  var delay = null;\n  var disposalMethod = null;\n  var disposalRestoreFromIdx = 0;\n  var lastDisposalMethod = null;\n  var frame = null;\n  var lastImg = null;\n\n  var playing = true;\n  var forward = true;\n\n  var ctx_scaled = false;\n\n  var frames = [];\n  var frameOffsets = []; // elements have .x and .y properties\n\n  var gif = options.gif;\n  if (typeof options.auto_play == 'undefined')\n    options.auto_play = (!gif.getAttribute('rel:auto_play') || gif.getAttribute('rel:auto_play') == '1');\n\n  var onEndListener = (options.hasOwnProperty('on_end') ? options.on_end : null);\n  var loopDelay = (options.hasOwnProperty('loop_delay') ? options.loop_delay : 0);\n  var overrideLoopMode = (options.hasOwnProperty('loop_mode') ? options.loop_mode : 'auto');\n  var drawWhileLoading = (options.hasOwnProperty('draw_while_loading') ? options.draw_while_loading : true);\n  var showProgressBar = drawWhileLoading ? (options.hasOwnProperty('show_progress_bar') ? options.show_progress_bar : true) : false;\n\n  var clear = function() {\n    transparency = null;\n    delay = null;\n    lastDisposalMethod = disposalMethod;\n    disposalMethod = null;\n    frame = null;\n  };\n\n  // XXX: There's probably a better way to handle catching exceptions when\n  // callbacks are involved.\n  var doParse = function() {\n    try {\n      parseGIF(stream, handler);\n    }\n    catch (err) {\n      doLoadError('parse');\n    }\n  };\n\n  var doText = function(text) {\n    toolbar.innerHTML = text; // innerText? Escaping? Whatever.\n    toolbar.style.visibility = 'visible';\n  };\n\n  var setSizes = function(w, h) {\n    canvas.width = w * get_canvas_scale();\n    canvas.height = h * get_canvas_scale();\n    toolbar.style.minWidth = (w * get_canvas_scale()) + 'px';\n\n    tmpCanvas.width = w;\n    tmpCanvas.height = h;\n    tmpCanvas.style.width = w + 'px';\n    tmpCanvas.style.height = h + 'px';\n    tmpCanvas.getContext('2d').setTransform(1, 0, 0, 1, 0, 0);\n  };\n\n  var setFrameOffset = function(frame, offset) {\n    if (!frameOffsets[frame]) {\n      frameOffsets[frame] = offset;\n      return;\n    }\n    if (typeof offset.x !== 'undefined') {\n      frameOffsets[frame].x = offset.x;\n    }\n    if (typeof offset.y !== 'undefined') {\n      frameOffsets[frame].y = offset.y;\n    }\n  };\n\n  var doShowProgress = function(pos, length, draw) {\n    if (draw && showProgressBar) {\n      var height = 25;\n      var left, mid, top, width;\n      if (options.is_vp) {\n        if (!ctx_scaled) {\n          top = (options.vp_t + options.vp_h - height);\n          height = height;\n          left = options.vp_l;\n          mid = left + (pos / length) * options.vp_w;\n          width = canvas.width;\n        }\n        else {\n          top = (options.vp_t + options.vp_h - height) / get_canvas_scale();\n          height = height / get_canvas_scale();\n          left = (options.vp_l / get_canvas_scale());\n          mid = left + (pos / length) * (options.vp_w / get_canvas_scale());\n          width = canvas.width / get_canvas_scale();\n        }\n        //some debugging, draw rect around viewport\n        if (false) {\n          if (!ctx_scaled) {\n            var l = options.vp_l,\n              t = options.vp_t;\n            var w = options.vp_w,\n              h = options.vp_h;\n          }\n          else {\n            var l = options.vp_l / get_canvas_scale(),\n              t = options.vp_t / get_canvas_scale();\n            var w = options.vp_w / get_canvas_scale(),\n              h = options.vp_h / get_canvas_scale();\n          }\n          ctx.rect(l, t, w, h);\n          ctx.stroke();\n        }\n      }\n      else {\n        top = (canvas.height - height) / (ctx_scaled ? get_canvas_scale() : 1);\n        mid = ((pos / length) * canvas.width) / (ctx_scaled ? get_canvas_scale() : 1);\n        width = canvas.width / (ctx_scaled ? get_canvas_scale() : 1);\n        height /= ctx_scaled ? get_canvas_scale() : 1;\n      }\n      // XXX Figure out alpha fillRect.\n      //ctx.fillStyle = 'salmon';\n      ctx.fillStyle = 'rgba(255,255,255,0.4)';\n      ctx.fillRect(mid, top, width - mid, height);\n\n      //ctx.fillStyle = 'teal';\n      ctx.fillStyle = 'rgba(255,0,22,.8)';\n      ctx.fillRect(0, top, mid, height);\n    }\n  };\n\n  var doLoadError = function(originOfError) {\n    var drawError = function() {\n      ctx.fillStyle = 'black';\n      ctx.fillRect(0, 0, options.c_w ? options.c_w : hdr.width, options.c_h ? options.c_h : hdr.height);\n      ctx.strokeStyle = 'red';\n      ctx.lineWidth = 3;\n      ctx.moveTo(0, 0);\n      ctx.lineTo(options.c_w ? options.c_w : hdr.width, options.c_h ? options.c_h : hdr.height);\n      ctx.moveTo(0, options.c_h ? options.c_h : hdr.height);\n      ctx.lineTo(options.c_w ? options.c_w : hdr.width, 0);\n      ctx.stroke();\n    };\n\n    loadError = originOfError;\n    hdr = {\n      width: gif.width,\n      height: gif.height\n    }; // Fake header.\n    frames = [];\n    drawError();\n  };\n\n  var doHdr = function(_hdr) {\n    hdr = _hdr;\n    setSizes(hdr.width, hdr.height)\n  };\n\n  var doGCE = function(gce) {\n    pushFrame();\n    clear();\n    transparency = gce.transparencyGiven ? gce.transparencyIndex : null;\n    delay = gce.delayTime;\n    disposalMethod = gce.disposalMethod;\n    // We don't have much to do with the rest of GCE.\n  };\n\n  var pushFrame = function() {\n    if (!frame) return;\n    frames.push({\n      data: frame.getImageData(0, 0, hdr.width, hdr.height),\n      delay: delay\n    });\n    frameOffsets.push({\n      x: 0,\n      y: 0\n    });\n  };\n\n  var doImg = function(img) {\n    if (!frame) frame = tmpCanvas.getContext('2d');\n\n    var currIdx = frames.length;\n\n    //ct = color table, gct = global color table\n    var ct = img.lctFlag ? img.lct : hdr.gct; // TODO: What if neither exists?\n\n    /*\n    Disposal method indicates the way in which the graphic is to\n    be treated after being displayed.\n\n    Values :    0 - No disposal specified. The decoder is\n                    not required to take any action.\n                1 - Do not dispose. The graphic is to be left\n                    in place.\n                2 - Restore to background color. The area used by the\n                    graphic must be restored to the background color.\n                3 - Restore to previous. The decoder is required to\n                    restore the area overwritten by the graphic with\n                    what was there prior to rendering the graphic.\n\n                    Importantly, \"previous\" means the frame state\n                    after the last disposal of method 0, 1, or 2.\n    */\n    if (currIdx > 0) {\n      if (lastDisposalMethod === 3) {\n        // Restore to previous\n        frame.putImageData(frames[disposalRestoreFromIdx].data, 0, 0);\n      }\n      else {\n        disposalRestoreFromIdx = currIdx - 1;\n      }\n\n      if (lastDisposalMethod === 2) {\n        // Restore to background color\n        // Browser implementations historically restore to transparent; we do the same.\n        // http://www.wizards-toolkit.org/discourse-server/viewtopic.php?f=1&t=21172#p86079\n        frame.clearRect(lastImg.leftPos, lastImg.topPos, lastImg.width, lastImg.height);\n      }\n    }\n    // else, Undefined/Do not dispose.\n    // frame contains final pixel data from the last frame; do nothing\n\n    //Get existing pixels for img region after applying disposal method\n    var imgData = frame.getImageData(img.leftPos, img.topPos, img.width, img.height);\n\n    //apply color table colors\n    var cdd = imgData.data;\n    img.pixels.forEach(function(pixel, i) {\n      // imgData.data === [R,G,B,A,R,G,B,A,...]\n      if (pixel !== transparency) {\n        cdd[i * 4 + 0] = ct[pixel][0];\n        cdd[i * 4 + 1] = ct[pixel][1];\n        cdd[i * 4 + 2] = ct[pixel][2];\n        cdd[i * 4 + 3] = 255; // Opaque.\n      }\n    });\n    imgData.data.set(cdd);\n\n    frame.putImageData(imgData, img.leftPos, img.topPos);\n\n    if (!ctx_scaled) {\n      ctx.scale(get_canvas_scale(), get_canvas_scale());\n      ctx_scaled = true;\n    }\n\n    // We could use the on-page canvas directly, except that we draw a progress\n    // bar for each image chunk (not just the final image).\n    if (drawWhileLoading)\n      ctx.drawImage(tmpCanvas, 0, 0);\n\n    lastImg = img;\n  };\n\n  var player = (function() {\n    var i = -1;\n    var iterationCount = 0;\n\n    var showingInfo = false;\n    var pinned = false;\n\n    /**\n     * Gets the index of the frame \"up next\".\n     * @returns {number}\n     */\n    var getNextFrameNo = function() {\n      var delta = (forward ? 1 : -1);\n      return (i + delta + frames.length) % frames.length;\n    };\n\n    var stepFrame = function(amount) { // XXX: Name is confusing.\n      i = i + amount;\n\n      putFrame();\n    };\n\n    var completeLoop = function() {\n      if (onEndListener !== null)\n        onEndListener(gif);\n      iterationCount++;\n    };\n\n    var step = (function() {\n      var stepping = false;\n\n      var doStep = function() {\n        stepping = playing;\n        if (!stepping) return;\n\n        stepFrame(1);\n        var delay = frames[i].delay * 10;\n        if (!delay) delay = 100; // FIXME: Should this even default at all? What should it be?\n\n        var nextFrameNo = getNextFrameNo();\n        if (nextFrameNo === 0) {\n          delay += loopDelay;\n          setTimeout(completeLoop, delay - 1);\n        }\n\n        if ((overrideLoopMode !== false || nextFrameNo !== 0 || iterationCount < 0))\n          setTimeout(doStep, delay);\n\n      };\n\n      return function() {\n        if (!stepping) setTimeout(doStep, 0);\n      };\n    }());\n\n    var putFrame = function() {\n      var offset;\n      i = parseInt(i, 10);\n\n      if (i > frames.length - 1) {\n        i = 0;\n      }\n\n      if (i < 0) {\n        i = 0;\n      }\n\n      offset = frameOffsets[i];\n\n      tmpCanvas.getContext(\"2d\").putImageData(frames[i].data, offset.x, offset.y);\n      ctx.globalCompositeOperation = \"copy\";\n      ctx.drawImage(tmpCanvas, 0, 0);\n    };\n\n    var play = function() {\n      playing = true;\n      step();\n    };\n\n    var pause = function() {\n      playing = false;\n    };\n\n\n    return {\n      init: function() {\n        if (loadError) return;\n\n        if (!(options.c_w && options.c_h)) {\n          ctx.scale(get_canvas_scale(), get_canvas_scale());\n        }\n\n        if (options.auto_play) {\n          step();\n        }\n        else {\n          i = 0;\n          putFrame();\n        }\n      },\n      step: step,\n      play: play,\n      pause: pause,\n      playing: playing,\n      move_relative: stepFrame,\n      current_frame: function() {\n        return i;\n      },\n      length: function() {\n        return frames.length\n      },\n      move_to: function(frame_idx) {\n        i = frame_idx;\n        putFrame();\n      }\n    }\n  }());\n\n  var doDecodeProgress = function(draw) {\n    doShowProgress(stream.pos, stream.data.length, draw);\n  };\n\n  var doNothing = function() {};\n  /**\n   * @param{boolean=} draw Whether to draw progress bar or not; this is not idempotent because of translucency.\n   *                       Note that this means that the text will be unsynchronized with the progress bar on non-frames;\n   *                       but those are typically so small (GCE etc.) that it doesn't really matter. TODO: Do this properly.\n   */\n  var withProgress = function(fn, draw) {\n    return function(block) {\n      fn(block);\n      doDecodeProgress(draw);\n    };\n  };\n\n\n  var handler = {\n    hdr: withProgress(doHdr),\n    gce: withProgress(doGCE),\n    com: withProgress(doNothing),\n    // I guess that's all for now.\n    app: {\n      // TODO: Is there much point in actually supporting iterations?\n      NETSCAPE: withProgress(doNothing)\n    },\n    img: withProgress(doImg, true),\n    eof: function(block) {\n      //toolbar.style.display = '';\n      pushFrame();\n      doDecodeProgress(false);\n      if (!(options.c_w && options.c_h)) {\n        canvas.width = hdr.width * get_canvas_scale();\n        canvas.height = hdr.height * get_canvas_scale();\n      }\n      player.init();\n      loading = false;\n      if (load_callback) {\n        load_callback(gif);\n      }\n\n    }\n  };\n\n  var init = function() {\n    var parent = gif.parentNode;\n\n    var span = document.createElement('span');\n    canvas = document.createElement('canvas');\n    ctx = canvas.getContext('2d');\n    toolbar = document.createElement('div');\n\n    tmpCanvas = document.createElement('canvas');\n\n    span.width = canvas.width = gif.width;\n    span.height = canvas.height = gif.height;\n    toolbar.style.minWidth = gif.width + 'px';\n\n    span.className = 'jsgif';\n    toolbar.className = 'jsgif_toolbar';\n    span.appendChild(canvas);\n    span.appendChild(toolbar);\n\n    parent.insertBefore(span, gif);\n    parent.removeChild(gif);\n\n    if (options.c_w && options.c_h) setSizes(options.c_w, options.c_h);\n    initialized = true;\n  };\n\n  var get_canvas_scale = function() {\n    var scale;\n    if (options.max_width && hdr && hdr.width > options.max_width) {\n      scale = options.max_width / hdr.width;\n    }\n    else {\n      scale = 1;\n    }\n    return scale;\n  }\n\n  var canvas, ctx, toolbar, tmpCanvas;\n  var initialized = false;\n  var load_callback = false;\n\n  var load_setup = function(callback) {\n    if (loading) return false;\n    if (callback) load_callback = callback;\n    else load_callback = false;\n\n    loading = true;\n    frames = [];\n    clear();\n    disposalRestoreFromIdx = 0;\n    lastDisposalMethod = null;\n    frame = null;\n    lastImg = null;\n\n    return true;\n  }\n\n  return {\n    // play controls\n    play: player.play,\n    pause: player.pause,\n    move_relative: player.move_relative,\n    move_to: player.move_to,\n\n    // getters for instance vars\n    get_playing: function() {\n      return player.playing\n    },\n    get_canvas: function() {\n      return canvas\n    },\n    get_canvas_scale: function() {\n      return get_canvas_scale()\n    },\n    get_loading: function() {\n      return loading\n    },\n    get_auto_play: function() {\n      return options.auto_play\n    },\n    get_length: function() {\n      return player.length()\n    },\n    get_current_frame: function() {\n      return player.current_frame()\n    },\n    load_url: function(src, callback) {\n      if (!load_setup(callback)) return;\n\n      var h = new XMLHttpRequest();\n      h.overrideMimeType('text/plain; charset=x-user-defined');\n      h.onloadstart = function() {\n        // Wait until connection is opened to replace the gif element with a canvas to avoid a blank img\n        if (!initialized) init();\n      };\n      h.onload = function(e) {\n        stream = new Stream(h.responseText);\n        setTimeout(doParse, 0);\n      };\n      h.onprogress = function(e) {\n        if (e.lengthComputable) doShowProgress(e.loaded, e.total, true);\n      };\n      h.onerror = function() {\n        doLoadError('xhr');\n      };\n      h.open('GET', src, true);\n      h.send();\n    },\n    load: function(callback) {\n      this.load_url(gif.getAttribute('rel:animated_src') || gif.src, callback);\n    },\n    load_raw: function(arr, callback) {\n      if (!load_setup(callback)) return;\n      if (!initialized) init();\n      stream = new Stream(arr);\n      setTimeout(doParse, 0);\n    },\n    set_frame_offset: setFrameOffset\n  };\n};\n\nmodule.exports = SuperGif;\n\n","// THREEx.KeyboardState.js keep the current state of the keyboard.\r\n// It is possible to query it at any time. No need of an event.\r\n// This is particularly convenient in loop driven case, like in\r\n// 3D demos or games.\r\n//\r\n// # Usage\r\n//\r\n// **Step 1**: Create the object\r\n//\r\n// ```var keyboard  = new THREEx.KeyboardState();```\r\n//\r\n// **Step 2**: Query the keyboard state\r\n//\r\n// This will return true if shift and A are pressed, false otherwise\r\n//\r\n// ```keyboard.pressed(\"shift+A\")```\r\n//\r\n// **Step 3**: Stop listening to the keyboard\r\n//\r\n// ```keyboard.destroy()```\r\n//\r\n// NOTE: this library may be nice as standaline. independant from three.js\r\n// - rename it keyboardForGame\r\n//\r\n// # Code\r\n//\r\n\r\n/** @namespace */\r\nvar THREEx = THREEx || {};\r\n\r\nif (typeof module === 'object') {\r\n\r\n  module.exports = THREEx;\r\n\r\n}\r\n\r\n/**\r\n * - NOTE: it would be quite easy to push event-driven too\r\n *   - microevent.js for events handling\r\n *   - in this._onkeyChange, generate a string from the DOM event\r\n *   - use this as event name\r\n */\r\nTHREEx.KeyboardState = function(domElement) {\r\n  this.domElement = domElement || document;\r\n  // to store the current state\r\n  this.keyCodes = {};\r\n  this.modifiers = {};\r\n\r\n  // create callback to bind/unbind keyboard events\r\n  var _this = this;\r\n  this._onKeyDown = function(event) {\r\n    _this._onKeyChange(event)\r\n  };\r\n  this._onKeyUp = function(event) {\r\n    _this._onKeyChange(event)\r\n  };\r\n\r\n  // bind keyEvents\r\n  this.domElement.addEventListener(\"keydown\", this._onKeyDown, false);\r\n  this.domElement.addEventListener(\"keyup\", this._onKeyUp, false);\r\n\r\n  // create callback to bind/unbind window blur event\r\n  this._onBlur = function() {\r\n    for (var prop in _this.keyCodes) _this.keyCodes[prop] = false;\r\n    for (var prop in _this.modifiers) _this.modifiers[prop] = false;\r\n  };\r\n\r\n  // bind window blur\r\n  window.addEventListener(\"blur\", this._onBlur, false);\r\n};\r\n\r\n/**\r\n * To stop listening of the keyboard events\r\n */\r\nTHREEx.KeyboardState.prototype.destroy = function() {\r\n  // unbind keyEvents\r\n  this.domElement.removeEventListener(\"keydown\", this._onKeyDown, false);\r\n  this.domElement.removeEventListener(\"keyup\", this._onKeyUp, false);\r\n\r\n  // unbind window blur event\r\n  window.removeEventListener(\"blur\", this._onBlur, false);\r\n};\r\n\r\nTHREEx.KeyboardState.MODIFIERS = ['shift', 'ctrl', 'alt', 'meta'];\r\nTHREEx.KeyboardState.ALIAS = {\r\n  'left': 37,\r\n  'up': 38,\r\n  'right': 39,\r\n  'down': 40,\r\n  'space': 32,\r\n  'pageup': 33,\r\n  'pagedown': 34,\r\n  'tab': 9,\r\n  'escape': 27\r\n};\r\n\r\n/**\r\n * to process the keyboard dom event\r\n */\r\nTHREEx.KeyboardState.prototype._onKeyChange = function(event) {\r\n  // log to debug\r\n  //console.log(\"onKeyChange\", event, event.keyCode, event.shiftKey, event.ctrlKey, event.altKey, event.metaKey)\r\n\r\n  // update this.keyCodes\r\n  var keyCode = event.keyCode\r\n  var pressed = event.type === 'keydown' ? true : false\r\n  this.keyCodes[keyCode] = pressed\r\n    // update this.modifiers\r\n  this.modifiers['shift'] = event.shiftKey\r\n  this.modifiers['ctrl'] = event.ctrlKey\r\n  this.modifiers['alt'] = event.altKey\r\n  this.modifiers['meta'] = event.metaKey\r\n};\r\n\r\n/**\r\n * query keyboard state to know if a key is pressed of not\r\n *\r\n * @param {String} keyDesc the description of the key. format : modifiers+key e.g shift+A\r\n * @returns {Boolean} true if the key is pressed, false otherwise\r\n */\r\nTHREEx.KeyboardState.prototype.pressed = function(keyDesc) {\r\n  var keys = keyDesc.split(\"+\");\r\n  for (var i = 0; i < keys.length; i++) {\r\n    var key = keys[i]\r\n    var pressed = false\r\n    if (THREEx.KeyboardState.MODIFIERS.indexOf(key) !== -1) {\r\n      pressed = this.modifiers[key];\r\n    }\r\n    else if (Object.keys(THREEx.KeyboardState.ALIAS).indexOf(key) != -1) {\r\n      pressed = this.keyCodes[THREEx.KeyboardState.ALIAS[key]];\r\n    }\r\n    else {\r\n      pressed = this.keyCodes[key.toUpperCase().charCodeAt(0)]\r\n    }\r\n    if (!pressed) return false;\r\n  };\r\n  return true;\r\n};\r\n\r\n/**\r\n * return true if an event match a keyDesc\r\n * @param  {KeyboardEvent} event   keyboard event\r\n * @param  {String} keyDesc string description of the key\r\n * @return {Boolean}         true if the event match keyDesc, false otherwise\r\n */\r\nTHREEx.KeyboardState.prototype.eventMatches = function(event, keyDesc) {\r\n  var aliases = THREEx.KeyboardState.ALIAS\r\n  var aliasKeys = Object.keys(aliases)\r\n  var keys = keyDesc.split(\"+\")\r\n    // log to debug\r\n    // console.log(\"eventMatches\", event, event.keyCode, event.shiftKey, event.ctrlKey, event.altKey, event.metaKey)\r\n  for (var i = 0; i < keys.length; i++) {\r\n    var key = keys[i];\r\n    var pressed = false;\r\n    if (key === 'shift') {\r\n      pressed = (event.shiftKey ? true : false)\r\n    }\r\n    else if (key === 'ctrl') {\r\n      pressed = (event.ctrlKey ? true : false)\r\n    }\r\n    else if (key === 'alt') {\r\n      pressed = (event.altKey ? true : false)\r\n    }\r\n    else if (key === 'meta') {\r\n      pressed = (event.metaKey ? true : false)\r\n    }\r\n    else if (aliasKeys.indexOf(key) !== -1) {\r\n      pressed = (event.keyCode === aliases[key] ? true : false);\r\n    }\r\n    else if (event.keyCode === key.toUpperCase().charCodeAt(0)) {\r\n      pressed = true;\r\n    }\r\n    if (!pressed) return false;\r\n  }\r\n  return true;\r\n};\r\n\r\nif (typeof exports !== 'undefined') {\r\n  if (typeof module !== 'undefined' && module.exports) {\r\n    exports = module.exports = THREEx;\r\n  }\r\n  else {\r\n    exports.THREEx = THREEx;\r\n  }\r\n}\r\nelse {\r\n  this['THREEx'] = THREEx;\r\n}\r\n\r\n","/*\n\tRubbableGif\n\n\tExample usage:\n\n\t\t<img src=\"./example1_preview.gif\" rel:animated_src=\"./example1.gif\" width=\"360\" height=\"360\" rel:auto_play=\"1\" />\n\n\t\t<script type=\"text/javascript\">\n\t\t\t$$('img').each(function (img_tag) {\n\t\t\t\tif (/.*\\.gif/.test(img_tag.src)) {\n\t\t\t\t\tvar rub = new RubbableGif({ gif: img_tag } );\n\t\t\t\t\trub.load();\n\t\t\t\t}\n\t\t\t});\n\t\t</script>\n\n\tImage tag attributes:\n\n\t\trel:animated_src -\tIf this url is specified, it's loaded into the player instead of src.\n\t\t\t\t\t\t\tThis allows a preview frame to be shown until animated gif data is streamed into the canvas\n\n\t\trel:auto_play -\t\tDefaults to 1 if not specified. If set to zero, the gif will be rubbable but will not \n\t\t\t\t\t\t\tanimate unless the user is rubbing it.\n\n\tConstructor options args\n\n\t\tgif \t\t\t\tRequired. The DOM element of an img tag.\n\t\tauto_play \t\t\tOptional. Same as the rel:auto_play attribute above, this arg overrides the img tag info.\n\t\tmax_width\t\t\tOptional. Scale images over max_width down to max_width. Helpful with mobile.\n\n\tInstance methods\n\n\t\t// loading\n\t\tload( callback )\tLoads the gif into a canvas element and then calls callback if one is passed\n\n\t\t// play controls\n\t\tplay -\t\t\t\tStart playing the gif\n\t\tpause -\t\t\t\tStop playing the gif\n\t\tmove_to(i) -\t\tMove to frame i of the gif\n\t\tmove_relative(i) -\tMove i frames ahead (or behind if i < 0)\n\n\t\t// getters\n\t\tget_canvas\t\t\tThe canvas element that the gif is playing in.\n\t\tget_playing\t\t\tWhether or not the gif is currently playing\n\t\tget_loading\t\t\tWhether or not the gif has finished loading/parsing\n\t\tget_auto_play\t\tWhether or not the gif is set to play automatically\n\t\tget_length\t\t\tThe number of frames in the gif\n\t\tget_current_frame\tThe index of the currently displayed frame of the gif\n\n\t\tFor additional customization (viewport inside iframe) these params may be passed:\n\t\tc_w, c_h - width and height of canvas\n\t\tvp_t, vp_l, vp_ w, vp_h - top, left, width and height of the viewport\n\n*/\n(function (root, factory) {\n    if (typeof define === 'function' && define.amd) {\n        define(['./libgif'], factory);\n    } else if (typeof exports === 'object') {\n        module.exports = factory(require('./libgif'));\n    } else {\n        root.RubbableGif = factory(root.SuperGif);\n    }\n}(this, function (SuperGif) {\n    var RubbableGif = function( options ) {\n        var sup = new SuperGif( options );\n\n        var register_canvas_handers = function () {\n\n            var isvp = function(x) {\n                return (options.vp_l ? ( x - options.vp_l ) : x );\n            }\n\n            var canvas = sup.get_canvas();\n            var maxTime = 1000,\n            // allow movement if < 1000 ms (1 sec)\n                w = ( options.vp_w ? options.vp_w : canvas.width ),\n                maxDistance = Math.floor(w / (sup.get_length() * 2)),\n            // swipe movement of 50 pixels triggers the swipe\n                startX = 0,\n                startTime = 0;\n\n            var cantouch = \"ontouchend\" in document;\n\n            var aj = 0;\n            var last_played = 0;\n\n            canvas.addEventListener((cantouch) ? 'touchstart' : 'mousedown', function (e) {\n                // prevent image drag (Firefox)\n                e.preventDefault();\n                if (sup.get_auto_play()) sup.pause();\n\n                var pos = (e.touches && e.touches.length > 0) ? e.touches[0] : e;\n\n                var x = (pos.layerX > 0) ? isvp(pos.layerX) : w / 2;\n                var progress = x / w;\n\n                sup.move_to( Math.floor(progress * (sup.get_length() - 1)) );\n\n                startTime = e.timeStamp;\n                startX = isvp(pos.pageX);\n            });\n\n            canvas.addEventListener((cantouch) ? 'touchend' : 'mouseup', function (e) {\n                startTime = 0;\n                startX = 0;\n                if (sup.get_auto_play()) sup.play();\n            });\n\n            canvas.addEventListener((cantouch) ? 'touchmove' : 'mousemove', function (e) {\n                e.preventDefault();\n                var pos = (e.touches && e.touches.length > 0) ? e.touches[0] : e;\n\n                var currentX = isvp(pos.pageX);\n                currentDistance = (startX === 0) ? 0 : Math.abs(currentX - startX);\n                // allow if movement < 1 sec\n                currentTime = e.timeStamp;\n                if (startTime !== 0 && currentDistance > maxDistance) {\n                    if (currentX < startX && sup.get_current_frame() > 0) {\n                        sup.move_relative(-1);\n                    }\n                    if (currentX > startX && sup.get_current_frame() < sup.get_length() - 1) {\n                        sup.move_relative(1);\n                    }\n                    startTime = e.timeStamp;\n                    startX = isvp(pos.pageX);\n                }\n\n                var time_since_last_play = e.timeStamp - last_played;\n                {\n                    aj++;\n                    if (document.getElementById('tickles' + ((aj % 5) + 1))) document.getElementById('tickles' + ((aj % 5) + 1)).play();\n                    last_played = e.timeStamp;\n                }\n\n\n            });\n        };\n\n        sup.orig_load = sup.load;\n        sup.load = function(callback) {\n            sup.orig_load( function() {\n                if (callback) callback();\n                register_canvas_handers( sup );\n            } );\n        }\n\n        return sup;\n    }\n\n    return RubbableGif;\n}));","/**\n * Provides requestAnimationFrame in a cross browser way.\n * http://paulirish.com/2011/requestanimationframe-for-smart-animating/\n */\n\nif ( !window.requestAnimationFrame ) {\n\n\twindow.requestAnimationFrame = ( function() {\n\n\t\treturn window.webkitRequestAnimationFrame ||\n\t\twindow.mozRequestAnimationFrame ||\n\t\twindow.oRequestAnimationFrame ||\n\t\twindow.msRequestAnimationFrame ||\n\t\tfunction( /* function FrameRequestCallback */ callback, /* DOMElement Element */ element ) {\n\n\t\t\twindow.setTimeout( callback, 1000 / 60 );\n\n\t\t};\n\n\t} )();\n\n}\n","var Utils = Utils || {};\r\n\r\nUtils.randomRange = function(min, max) {\r\n  return Math.random() * (max - min) + min;\r\n};\r\n\r\nmodule.exports = Utils;\r\n\r\n","Game = Class({\r\n  constructor: function(options) {\r\n    this.container = options.container;\r\n    this.loadingContainer = options.loadingContainer;\r\n    this.blocker = options.blocker;\r\n    this.instructions = options.instructions;\r\n    this.crosshair = options.crosshair;\r\n\r\n    this.stats = null;\r\n\r\n    this.prevTime = performance.now();\r\n\r\n    this.renderer = null;\r\n    this.scene = null;\r\n    this.camera = null;\r\n\r\n    this.paused = true;\r\n\r\n    this.controlsEnabled = false;\r\n    this.controls = null;\r\n\r\n    this.systems = [];\r\n    this.postPhysicsSystems = [];\r\n\r\n    this.modelsToPreload = options.modelsToPreload;\r\n    this.percentModelsLoaded = 0;\r\n\r\n    this.systemsDelay = 0;\r\n  },\r\n\r\n  start: function(runImmediately) {\r\n    if (runImmediately === undefined || runImmediately === null) {\r\n      runImmediately = true;\r\n    }\r\n\r\n    window.addEventListener('resize', this.onResize.bind(this));\r\n    window.onkeydown = this.onKeyDown.bind(this); // prevent spacebar from scrolling the page\r\n    window.addEventListener('mousedown', this.onMouseDown.bind(this));\r\n    window.addEventListener('mouseup', this.onMouseUp.bind(this));\r\n\r\n    this.renderer = new THREE.WebGLRenderer({\r\n      antialias: true\r\n    });\r\n    this.renderer.setSize(window.innerWidth, window.innerHeight);\r\n    //this.renderer.setClearColor(0xffffff, 1);\r\n    this.renderer.setClearColor(0xbc00bc, 1);\r\n    this.container.appendChild(this.renderer.domElement);\r\n\r\n    /* Stats.js Setup */\r\n    this.stats = new Stats();\r\n    this.stats.setMode(0);\r\n\r\n    this.stats.domElement.style.position = 'absolute';\r\n    this.stats.domElement.style.left = '10px';\r\n    this.stats.domElement.style.bottom = '10px';\r\n\r\n    document.body.appendChild(this.stats.domElement);\r\n\r\n    // Create a new Three.js scene\r\n    this.scene = new Physijs.Scene();\r\n    this.scene.setGravity(new THREE.Vector3(0, -32, 0));\r\n\r\n    // Put in a camera\r\n    var aspectRatio = window.innerWidth / window.innerHeight;\r\n    this.camera = new THREE.PerspectiveCamera(45, aspectRatio, 0.1, 1000);\r\n    this.scene.add(this.camera);\r\n\r\n    /* Camera Controller */\r\n    this.controls = new PointerLockControls({\r\n      camera: this.camera\r\n    });\r\n    this.scene.add(this.controls.getObject());\r\n\r\n    /* Setup Crosshair */\r\n\r\n    this.crosshair.style.left = ((window.innerWidth / 2) - 32) + 'px';\r\n    this.crosshair.style.top = ((window.innerHeight / 2) - 32) + 'px';\r\n\r\n    var ambientLight = new THREE.AmbientLight(0xcbcbcb);\r\n    this.scene.add(ambientLight);\r\n\r\n    var dirLight = new THREE.DirectionalLight(0xdcdcdc, 0.5);\r\n    this.scene.add(dirLight);\r\n\r\n    /* Create Entities */\r\n\r\n    EntityFactory.instance.makeGround({\r\n      scene: this.scene,\r\n      width: 2000,\r\n      height: 2000\r\n    });\r\n\r\n    this.player = EntityFactory.instance.makePlayer({\r\n      scene: this.scene,\r\n      position: new THREE.Vector3(0, 30, 0),\r\n      controls: this.controls,\r\n      controlsObject: this.controls.getObject(),\r\n      cameraOffset: new THREE.Vector3(0, 10, 0), // 10, 10, 25\r\n      gunOffset: new THREE.Vector3(9, 11, 0),\r\n      hp: 20\r\n    });\r\n\r\n    EntityFactory.instance.makeEnemy({\r\n      scene: this.scene,\r\n      position: new THREE.Vector3(0, 30, -200),\r\n      aiTarget: this.player,\r\n      bulletSpeed: Math.random() * (60 - 15) + 15,\r\n      hp: 15\r\n    });\r\n\r\n    EntityFactory.instance.makeEnemy({\r\n      scene: this.scene,\r\n      position: new THREE.Vector3(-100, 30, -150),\r\n      aiTarget: this.player,\r\n      bulletSpeed: Math.random() * (60 - 15) + 15,\r\n      hp: 15\r\n    });\r\n\r\n    /* Setup Systems */\r\n\r\n    this.systems.push(new PlayerInputSystem(EntityFactory.instance.entities));\r\n    this.systems.push(new AISystem(EntityFactory.instance.entities));\r\n    this.systems.push(new MovementSystem(EntityFactory.instance.entities));\r\n    this.systems.push(new ExpirableSystem(EntityFactory.instance.entities));\r\n    this.systems.push(new CameraPitchSystem(EntityFactory.instance.entities));\r\n    this.systems.push(new ShootDelaySystem(EntityFactory.instance.entities));\r\n    this.systems.push(new HurtSystem(EntityFactory.instance.entities));\r\n    this.systems.push(new PlayerHealthSystem(EntityFactory.instance.entities));\r\n    this.systems.push(new HealthBarSystem(EntityFactory.instance.entities));\r\n    this.systems.push(new DeathSystem(EntityFactory.instance.entities));\r\n    this.systems.push(new SteamRemovalSystem(EntityFactory.instance.entities));\r\n    this.systems.push(new SteamUpdateSystem(EntityFactory.instance.entities));\r\n\r\n    this.postPhysicsSystems.push(new PhysicsUpdateSystem(EntityFactory.instance.entities));\r\n    this.postPhysicsSystems.push(new CameraFollowSystem(EntityFactory.instance.entities));\r\n\r\n    this.loadModels();\r\n  },\r\n\r\n  loadModels: function() {\r\n    this.modelsToPreload.forEach(function(model) {\r\n      ResourceManager.instance.loadModel(model, this.modelLoaded.bind(this));\r\n    }.bind(this));\r\n  },\r\n\r\n  modelLoaded: function(model) {\r\n    var percentPerModel = 100.0 / this.modelsToPreload.length;\r\n    this.percentModelsLoaded += percentPerModel;\r\n\r\n    if (this.percentModelsLoaded > 99.0) {\r\n      // hide loading indicator and show instructions\r\n      this.loadingContainer.style.visibility = \"hidden\";\r\n      this.blocker.style.visibility = \"visible\";\r\n      this.instructions.style.visibility = \"visible\";\r\n      Globals.instance.hudElement.style.display = 'block';\r\n      //this.crosshair.style.display = 'block';\r\n\r\n      // ensure the user is at the top of the page\r\n      document.body.scrollTop = document.documentElement.scrollTop = 0;\r\n\r\n      this.update(false);\r\n\r\n      this.initPointerLock();\r\n\r\n      this.update(true);\r\n    }\r\n  },\r\n\r\n  update: function(animationFrame) {\r\n    if (animationFrame) {\r\n      requestAnimationFrame(this.update.bind(this));\r\n    }\r\n\r\n    var time = performance.now();\r\n    var dt = (time - this.prevTime) / 1000;\r\n    Globals.instance.dt = dt;\r\n\r\n    if (!this.paused) {\r\n      if (dt > 0.05) {\r\n        dt = 0.05;\r\n      }\r\n\r\n      this.systems.forEach(function(system) {\r\n        system.update(dt);\r\n      });\r\n\r\n      this.scene.simulate(dt);\r\n\r\n      this.postPhysicsSystems.forEach(function(system) {\r\n        system.update(dt);\r\n      });\r\n\r\n      MouseController.instance.update(dt);\r\n    }\r\n\r\n    this.renderer.render(this.scene, this.camera);\r\n    this.stats.update();\r\n\r\n    this.prevTime = time;\r\n  },\r\n\r\n  onResize: function(e) {\r\n    this.renderer.setSize(window.innerWidth, window.innerHeight);\r\n\r\n    this.camera.aspect = (window.innerWidth / window.innerHeight);\r\n    this.camera.updateProjectionMatrix();\r\n\r\n    this.crosshair.style.left = ((window.innerWidth / 2) - 32) + 'px';\r\n    this.crosshair.style.top = ((window.innerHeight / 2) - 32) + 'px';\r\n  },\r\n\r\n  onKeyDown: function(e) {\r\n    var keyCode = ('which' in event) ? event.which : event.keyCode;\r\n\r\n    return (keyCode !== Game.KEY_CODES.space);\r\n  },\r\n\r\n  onMouseDown: function(e) {\r\n    if (this.paused) {\r\n      return;\r\n    }\r\n\r\n    if (e.button === 0) {\r\n      MouseController.instance.isDown.left = true;\r\n    }\r\n    else if (e.button === 2) {\r\n      MouseController.instance.isDown.right = true;\r\n    }\r\n  },\r\n\r\n  onMouseUp: function(e) {\r\n    if (this.paused) {\r\n      return;\r\n    }\r\n\r\n    if (e.button === 0) {\r\n      MouseController.instance.isDown.left = false;\r\n      MouseController.instance.wasPressed.left = true;\r\n    }\r\n    else if (e.button === 2) {\r\n      MouseController.instance.isDown.right = false;\r\n      MouseController.instance.wasPressed.right = true;\r\n    }\r\n  },\r\n\r\n  initPointerLock: function() {\r\n    var havePointerLock = 'pointerLockElement' in document || 'mozPointerLockElement' in document || 'webkitPointerLockElement' in document;\r\n\r\n    if (havePointerLock) {\r\n\r\n      var element = document.body;\r\n\r\n      var pointerlockchange = function(event) {\r\n\r\n        if (document.pointerLockElement === element || document.mozPointerLockElement === element || document.webkitPointerLockElement === element) {\r\n\r\n          this.controlsEnabled = true;\r\n          this.controls.enabled = true;\r\n\r\n          this.blocker.style.display = 'none';\r\n\r\n          if (Globals.instance.reloadingElement.style.visibility === 'visible') {\r\n            Globals.instance.reloadImg.play();\r\n          }\r\n\r\n          this.paused = false;\r\n\r\n        }\r\n        else {\r\n\r\n          this.controls.enabled = false;\r\n\r\n          this.blocker.style.display = '-webkit-box';\r\n          this.blocker.style.display = '-moz-box';\r\n          this.blocker.style.display = 'box';\r\n\r\n          this.instructions.style.display = '';\r\n\r\n          if (Globals.instance.reloadImg.get_playing()) {\r\n            Globals.instance.reloadImg.pause();\r\n          }\r\n\r\n          this.paused = true;\r\n\r\n        }\r\n\r\n      }.bind(this);\r\n\r\n      var pointerlockerror = function(event) {\r\n\r\n        this.instructions.style.display = '';\r\n\r\n      }.bind(this);\r\n\r\n      // Hook pointer lock state change events\r\n      document.addEventListener('pointerlockchange', pointerlockchange, false);\r\n      document.addEventListener('mozpointerlockchange', pointerlockchange, false);\r\n      document.addEventListener('webkitpointerlockchange', pointerlockchange, false);\r\n\r\n      document.addEventListener('pointerlockerror', pointerlockerror, false);\r\n      document.addEventListener('mozpointerlockerror', pointerlockerror, false);\r\n      document.addEventListener('webkitpointerlockerror', pointerlockerror, false);\r\n\r\n      this.instructions.addEventListener('click', function(event) {\r\n\r\n        this.instructions.style.display = 'none';\r\n\r\n        // Ask the browser to lock the pointer\r\n        element.requestPointerLock = element.requestPointerLock || element.mozRequestPointerLock || element.webkitRequestPointerLock;\r\n\r\n        if (/Firefox/i.test(navigator.userAgent)) {\r\n\r\n          var fullscreenchange = function(event) {\r\n\r\n            if (document.fullscreenElement === element || document.mozFullscreenElement === element || document.mozFullScreenElement === element) {\r\n\r\n              document.removeEventListener('fullscreenchange', fullscreenchange);\r\n              document.removeEventListener('mozfullscreenchange', fullscreenchange);\r\n\r\n              element.requestPointerLock();\r\n            }\r\n\r\n          };\r\n\r\n          document.addEventListener('fullscreenchange', fullscreenchange, false);\r\n          document.addEventListener('mozfullscreenchange', fullscreenchange, false);\r\n\r\n          element.requestFullscreen = element.requestFullscreen || element.mozRequestFullscreen || element.mozRequestFullScreen || element.webkitRequestFullscreen;\r\n\r\n          element.requestFullscreen();\r\n\r\n        }\r\n        else {\r\n\r\n          element.requestPointerLock();\r\n\r\n        }\r\n\r\n      }.bind(this), false);\r\n\r\n    }\r\n    else {\r\n\r\n      this.instructions.innerHTML = 'Your browser doesn\\'t seem to support Pointer Lock API';\r\n\r\n    }\r\n  }\r\n}, {\r\n  statics: {\r\n    KEY_CODES: {\r\n      space: 32\r\n    }\r\n  }\r\n});\r\n\r\n","Globals = Class({\r\n  constructor: function() {\r\n    this.dt = 0;\r\n\r\n    this.hudElement = null;\r\n\r\n    this.healthElement = null;\r\n\r\n    this.scoreElement = null;\r\n    this.score = 0;\r\n\r\n    this.reloadingElement = null;\r\n    this.reloadImg = null;\r\n\r\n    this.overlayElement = null;\r\n  }\r\n}, {\r\n  statics: {\r\n    get instance() {\r\n      if (!Globals._instance) {\r\n        Globals._instance = new Globals();\r\n      }\r\n      return Globals._instance;\r\n    },\r\n\r\n    DIR: \"./\",\r\n\r\n    ENTITY_TYPES: {\r\n      player: 0,\r\n      enemy: 1,\r\n\r\n      ground: 2,\r\n      obstacle: 3,\r\n\r\n      bullet: 4\r\n    }\r\n  }\r\n});\r\n\r\n","Model = Class({\r\n  constructor: function(options) {\r\n    this.geometry = options.geometry;\r\n    this.material = options.material;\r\n  },\r\n\r\n  clone: function() {\r\n    return new Model({\r\n      geometry: this.geometry.clone(),\r\n      material: this.material.clone()\r\n    });\r\n  }\r\n});\r\n\r\nResourceManager = Class({\r\n  constructor: function() {\r\n    this.loadingManager = new THREE.LoadingManager();\r\n\r\n    this.jsonLoader = new THREE.JSONLoader(this.loadingManager);\r\n\r\n    this.textures = {};\r\n    this.models = {};\r\n  },\r\n\r\n  getTexture: function(path, callback) {\r\n    if (path === null || path === undefined) {\r\n      return null;\r\n    }\r\n    else if (path in this.textures) {\r\n      return this.textures[path];\r\n    }\r\n\r\n    this.textures[path] = THREE.ImageUtils.loadTexture(path, undefined, callback);\r\n\r\n    return this.textures[path];\r\n  },\r\n\r\n  loadModel: function(path, callback) {\r\n    if (path === null || path === undefined) {\r\n      return;\r\n    }\r\n    else if (path in this.models) {\r\n      callback(this.models[path]);\r\n\r\n      return;\r\n    }\r\n\r\n    this.jsonLoader.load(path, function(geometry, materials) {\r\n      var material = new THREE.MeshFaceMaterial(materials);\r\n\r\n      var model = new Model({\r\n        geometry: geometry,\r\n        material: material\r\n      });\r\n      this.models[path] = model;\r\n\r\n      callback(model);\r\n    }.bind(this));\r\n  }\r\n}, {\r\n  statics: {\r\n    get instance() {\r\n      if (!ResourceManager._instance) {\r\n        ResourceManager._instance = new ResourceManager();\r\n      }\r\n      return ResourceManager._instance;\r\n    }\r\n  }\r\n});\r\n\r\n","PointerLockControls = Class({\r\n  constructor: function(options) {\r\n    this.camera = options.camera;\r\n    this.camera.rotation.set(0, 0, 0);\r\n\r\n    this.pitchObject = new THREE.Object3D();\r\n    this.pitchObject.add(this.camera);\r\n\r\n    this.yawObject = new THREE.Object3D();\r\n    this.yawObject.position.y = 10;\r\n    this.yawObject.add(this.pitchObject);\r\n\r\n    this.moveForward = false;\r\n    this.moveBackward = false;\r\n    this.moveLeft = false;\r\n    this.moveRight = false;\r\n\r\n    this.isOnObject = false;\r\n    this.canJump = false;\r\n\r\n    this.prevTime = performance.now();\r\n\r\n    this.velocity = new THREE.Vector3();\r\n\r\n    this.enabled = false;\r\n\r\n    this.mass = options.mass || 100.0;\r\n    this.moveSpeed = options.moveSpeed || new THREE.Vector3(400.0, 350.0, 400.0);\r\n    this.minimumY = options.minimumY || 10;\r\n\r\n    document.addEventListener('mousemove', this.onMouseMove.bind(this), false);\r\n    document.addEventListener('keydown', this.onKeyDown.bind(this), false);\r\n    document.addEventListener('keyup', this.onKeyUp.bind(this), false);\r\n  },\r\n\r\n  onMouseMove: function(event) {\r\n    if (this.enabled === false) {\r\n      return;\r\n    }\r\n\r\n    var movementX = event.movementX || event.mozMovementX || event.webkitMovementX || 0;\r\n    var movementY = event.movementY || event.mozMovementY || event.webkitMovementY || 0;\r\n\r\n    this.yawObject.rotation.y -= movementX * 0.002;\r\n    this.pitchObject.rotation.x -= movementY * 0.002;\r\n\r\n    this.pitchObject.rotation.x = Math.max(-PointerLockControls.PI_2, Math.min(PointerLockControls.PI_2, this.pitchObject.rotation.x));\r\n  },\r\n\r\n  onKeyDown: function(event) {\r\n    switch (event.keyCode) {\r\n      case 38: // up\r\n      case 87: // w\r\n        this.moveForward = true;\r\n        break;\r\n\r\n      case 37: // left\r\n      case 65: // a\r\n        this.moveLeft = true;\r\n        break;\r\n\r\n      case 40: // down\r\n      case 83: // s\r\n        this.moveBackward = true;\r\n        break;\r\n\r\n      case 39: // right\r\n      case 68: // d\r\n        this.moveRight = true;\r\n        break;\r\n\r\n      case 32: // space\r\n        if (this.canJump === true) {\r\n          this.velocity.y += this.moveSpeed.y;\r\n        }\r\n\r\n        this.canJump = false;\r\n\r\n        break;\r\n\r\n      default:\r\n        break;\r\n    }\r\n  },\r\n\r\n  onKeyUp: function(event) {\r\n    switch (event.keyCode) {\r\n      case 38: // up\r\n      case 87: // w\r\n        this.moveForward = false;\r\n        break;\r\n\r\n      case 37: // left\r\n      case 65: // a\r\n        this.moveLeft = false;\r\n        break;\r\n\r\n      case 40: // down\r\n      case 83: // s\r\n        this.moveBackward = false;\r\n        break;\r\n\r\n      case 39: // right\r\n      case 68: // d\r\n        this.moveRight = false;\r\n        break;\r\n\r\n      default:\r\n        break;\r\n    }\r\n  },\r\n\r\n  getObject: function() {\r\n    return this.yawObject;\r\n  },\r\n\r\n  isOnObject: function(bool) {\r\n    this.isOnObject = bool;\r\n    this.canJump = bool;\r\n  },\r\n\r\n  getDirection: function() {\r\n    // assumes the camera itself is not rotated\r\n    var direction = new THREE.Vector3(0, 0, -1);\r\n    var rotation = new THREE.Euler(0, 0, 0, \"YXZ\");\r\n\r\n    return function(v) {\r\n      rotation.set(this.pitchObject.rotation.x, this.yawObject.rotation.y, 0);\r\n\r\n      v.copy(direction).applyEuler(rotation);\r\n\r\n      return v;\r\n    };\r\n  }(),\r\n\r\n  update: function(dt) {\r\n    if (this.enabled === false) {\r\n      return;\r\n    }\r\n\r\n    this.velocity.x -= this.velocity.x * 10.0 * dt;\r\n    this.velocity.z -= this.velocity.z * 10.0 * dt;\r\n\r\n    this.velocity.y -= 9.8 * this.mass * dt;\r\n\r\n    if (this.moveForward) {\r\n      this.velocity.z -= this.moveSpeed.z * dt;\r\n    }\r\n    if (this.moveBackward) {\r\n      this.velocity.z += this.moveSpeed.z * dt;\r\n    }\r\n\r\n    if (this.moveLeft) {\r\n      this.velocity.x -= this.moveSpeed.x * dt;\r\n    }\r\n    if (this.moveRight) {\r\n      this.velocity.x += this.moveSpeed.x * dt;\r\n    }\r\n\r\n    if (this.isOnObject === true) {\r\n      this.velocity.y = Math.max(0, this.velocity.y);\r\n    }\r\n\r\n    this.yawObject.translateX(this.velocity.x * dt);\r\n    this.yawObject.translateY(this.velocity.y * dt);\r\n    this.yawObject.translateZ(this.velocity.z * dt);\r\n\r\n    if (this.yawObject.position.y < this.minimumY) {\r\n      this.velocity.y = 0;\r\n      this.yawObject.position.y = this.minimumY;\r\n\r\n      this.canJump = true;\r\n    }\r\n  }\r\n}, {\r\n  statics: {\r\n    PI_2: Math.PI / 2\r\n  }\r\n});\r\n\r\n","var C = require('./Components.js');\r\n\r\nPlayerInputSystem = Class({\r\n  constructor: function(entities) {\r\n    this.entities = entities;\r\n\r\n    this.keyboard = new THREEx.KeyboardState();\r\n    this.jumped = false;\r\n  },\r\n\r\n  update: function(dt) {\r\n    var players = this.entities.queryTag(\"player\");\r\n\r\n    players.forEach(function(entity) {\r\n      var velocity = new THREE.Vector3(entity.velocity.x, entity.velocity.y, entity.velocity.z);\r\n      var dv = new THREE.Vector3(); // delta velocity\r\n\r\n      if (this.keyboard.pressed(\"w\")) {\r\n        dv.z = -PlayerInputSystem.MOVE_SPEED;\r\n      }\r\n      else if (this.keyboard.pressed(\"s\")) {\r\n        dv.z = PlayerInputSystem.MOVE_SPEED;\r\n      }\r\n\r\n      if (this.keyboard.pressed(\"a\")) {\r\n        dv.x = -PlayerInputSystem.MOVE_SPEED;\r\n      }\r\n      else if (this.keyboard.pressed(\"d\")) {\r\n        dv.x = PlayerInputSystem.MOVE_SPEED;\r\n      }\r\n\r\n      if (this.keyboard.pressed(\"space\") && entity.jump.canJump) {\r\n        dv.y = PlayerInputSystem.JUMP_FORCE;\r\n        entity.jump.canJump = false;\r\n      }\r\n\r\n      dv = dv.applyMatrix4(entity.velocity.rotationMatrix);\r\n\r\n      velocity.add(dv);\r\n\r\n      entity.velocity.x = velocity.x;\r\n      entity.velocity.y = velocity.y;\r\n      entity.velocity.z = velocity.z;\r\n\r\n      if (entity.shootDelay.canShoot) {\r\n        if (MouseController.instance.wasPressed.left) {\r\n          var direction = new THREE.Vector3();\r\n          entity.cameraFollow.controls.getDirection(direction);\r\n\r\n          var bulletPos = new THREE.Vector3().setFromMatrixPosition(entity.gun.mesh.matrixWorld);\r\n          var bulletOffset = new THREE.Vector3(0, 0.4, -25);\r\n\r\n          var rotationMatrix = entity.velocity.rotationMatrix.clone();\r\n          var yMatrix = new THREE.Matrix4().extractRotation(entity.cameraFollow.controls.pitchObject.matrix);\r\n          rotationMatrix.multiply(yMatrix);\r\n\r\n          bulletOffset.applyMatrix4(rotationMatrix);\r\n          bulletPos.add(bulletOffset);\r\n\r\n          var bulletRot = entity.cameraFollow.object.rotation.clone();\r\n          bulletRot.y += 90 * Math.PI / 180;\r\n\r\n          EntityFactory.instance.makePotato({\r\n            scene: entity.drawable.scene,\r\n            position: bulletPos,\r\n            rotation: bulletRot,\r\n            direction: direction,\r\n            rotationMatrix: entity.velocity.rotationMatrix,\r\n            velocity: 35,\r\n            owner: 'player'\r\n          });\r\n\r\n          entity.shootDelay.canShoot = false;\r\n\r\n          Globals.instance.reloadImg.move_to(0);\r\n          Globals.instance.reloadImg.play();\r\n          Globals.instance.reloadingElement.style.visibility = \"visible\";\r\n        }\r\n        else if (MouseController.instance.wasPressed.right) {\r\n          var baseDirection = new THREE.Vector3();\r\n          entity.cameraFollow.controls.getDirection(baseDirection);\r\n\r\n          var basePos = new THREE.Vector3().setFromMatrixPosition(entity.gun.mesh.matrixWorld);\r\n\r\n          var rotationMatrix = entity.velocity.rotationMatrix.clone();\r\n          var yMatrix = new THREE.Matrix4().extractRotation(entity.cameraFollow.controls.pitchObject.matrix);\r\n          rotationMatrix.multiply(yMatrix);\r\n\r\n          var bulletRot = entity.cameraFollow.object.rotation.clone();\r\n          bulletRot.y += 90 * Math.PI / 180;\r\n\r\n          for (var i = 0; i < Utils.randomRange(4, 9); i++) {\r\n            var bulletPos = basePos.clone();\r\n            var bulletOffset = new THREE.Vector3(Utils.randomRange(-1, 1), Utils.randomRange(-1, 1), -30);\r\n\r\n            bulletOffset.applyMatrix4(rotationMatrix);\r\n            bulletPos.add(bulletOffset);\r\n\r\n            var piOver2 = Math.PI / 2;\r\n\r\n            bulletRot.x += Utils.randomRange(-piOver2, piOver2);\r\n            bulletRot.z += Utils.randomRange(-piOver2, piOver2);\r\n\r\n            var bulletDirection = baseDirection.clone();\r\n            bulletDirection.x += Utils.randomRange(-0.2, 0.2);\r\n            bulletDirection.y += Utils.randomRange(-0.1, 0.2);\r\n            bulletDirection.z += Utils.randomRange(-0.2, 0.2);\r\n\r\n            EntityFactory.instance.makeFry({\r\n              scene: entity.drawable.scene,\r\n              position: bulletPos,\r\n              rotation: bulletRot,\r\n              direction: bulletDirection,\r\n              rotationMatrix: entity.velocity.rotationMatrix,\r\n              velocity: 0.5,\r\n              owner: 'player'\r\n            });\r\n          }\r\n\r\n          entity.shootDelay.canShoot = false;\r\n\r\n          Globals.instance.reloadImg.move_to(0);\r\n          Globals.instance.reloadImg.play();\r\n          Globals.instance.reloadingElement.style.visibility = \"visible\";\r\n        }\r\n      }\r\n    }.bind(this));\r\n  }\r\n}, {\r\n  statics: {\r\n    MOVE_SPEED: 120,\r\n    JUMP_FORCE: 2500\r\n  }\r\n});\r\n\r\nMovementSystem = Class({\r\n  constructor: function(entities) {\r\n    this.entities = entities;\r\n  },\r\n\r\n  update: function(dt) {\r\n    var moveables = this.entities.queryComponents([C.Position, C.Velocity]);\r\n\r\n    moveables.forEach(function(entity) {\r\n      var velocity = new THREE.Vector3(entity.velocity.x, entity.velocity.y, entity.velocity.z);\r\n\r\n      if (entity.hasComponent(C.Drawable)) {\r\n        entity.drawable.mesh.applyCentralImpulse(velocity);\r\n        //entity.drawable.mesh.setLinearVelocity(entity.velocity);\r\n      }\r\n      else {\r\n        entity.position.x += velocity.x * dt;\r\n        entity.position.y += velocity.y * dt;\r\n        entity.position.z += velocity.z * dt;\r\n      }\r\n    });\r\n  }\r\n});\r\n\r\nExpirableSystem = Class({\r\n  constructor: function(entities) {\r\n    this.entities = entities;\r\n  },\r\n\r\n  update: function(dt) {\r\n    var expirables = this.entities.queryComponents([C.Expirable]);\r\n\r\n    expirables.forEach(function(entity) {\r\n      entity.expirable.age += dt;\r\n\r\n      if (entity.expirable.age >= entity.expirable.maxAge) {\r\n        if (entity.hasComponent(C.Drawable)) {\r\n          entity.drawable.scene.remove(entity.drawable.mesh);\r\n        }\r\n\r\n        entity.remove();\r\n      }\r\n    });\r\n  }\r\n});\r\n\r\nCameraFollowSystem = Class({\r\n  constructor: function(entities) {\r\n    this.entities = entities;\r\n  },\r\n\r\n  update: function(dt) {\r\n    var follows = this.entities.queryComponents([C.CameraFollow, C.Position, C.Velocity]);\r\n\r\n    /*if (follows.length > 1) {\r\n      throw new Error(\"The camera can only follow one object at a time!\");\r\n    }*/\r\n\r\n    follows.forEach(function(entity) {\r\n      if (entity.velocity.rotationMatrix === null) {\r\n        return;\r\n      }\r\n\r\n      var offset = entity.cameraFollow.offset.clone();\r\n      offset = offset.applyMatrix4(entity.velocity.rotationMatrix);\r\n\r\n      entity.cameraFollow.object.position.x = entity.position.x + offset.x;\r\n      entity.cameraFollow.object.position.y = entity.position.y + offset.y;\r\n      entity.cameraFollow.object.position.z = entity.position.z + offset.z;\r\n\r\n      entity.drawable.mesh.rotation.x = entity.cameraFollow.object.rotation.x;\r\n      entity.drawable.mesh.rotation.y = entity.cameraFollow.object.rotation.y;\r\n      entity.drawable.mesh.rotation.z = entity.cameraFollow.object.rotation.z;\r\n    });\r\n  }\r\n});\r\n\r\nShootDelaySystem = Class({\r\n  constructor: function(entities) {\r\n    this.entities = entities;\r\n  },\r\n\r\n  update: function(dt) {\r\n    var shooters = this.entities.queryComponents([C.ShootDelay]);\r\n\r\n    shooters.forEach(function(entity) {\r\n      if (entity.shootDelay.canShoot === false) {\r\n        entity.shootDelay.timer += dt;\r\n\r\n        if (entity.shootDelay.timer > entity.shootDelay.delayTheshold) {\r\n          entity.shootDelay.canShoot = true;\r\n          entity.shootDelay.timer = 0;\r\n\r\n          Globals.instance.reloadImg.pause();\r\n          Globals.instance.reloadingElement.style.visibility = \"hidden\";\r\n        }\r\n      }\r\n    });\r\n  }\r\n});\r\n\r\nHurtSystem = Class({\r\n  constructor: function(entities) {\r\n    this.entities = entities;\r\n  },\r\n\r\n  update: function(dt) {\r\n    var hurtables = this.entities.queryComponents([C.Hurt, C.Drawable]);\r\n\r\n    hurtables.forEach(function(entity) {\r\n      entity.hurt.timer += dt;\r\n\r\n      if (entity.hurt.timer < entity.hurt.invulnerabilityFrames) {\r\n        entity.drawable.mesh.material.color = entity.hurt.hurtColor;\r\n\r\n        if (entity.hasTag(\"player\")) {\r\n          Globals.instance.overlayElement.style.backgroundColor = \"#bb0000\";\r\n          Globals.instance.overlayElement.style.visibility = \"visible\";\r\n        }\r\n      }\r\n      else {\r\n        entity.drawable.mesh.material.color = entity.hurt.originalColor;\r\n\r\n        entity.removeComponent(C.Hurt);\r\n\r\n        if (entity.hasTag(\"player\")) {\r\n          Globals.instance.overlayElement.style.visibility = \"hidden\";\r\n        }\r\n      }\r\n    });\r\n  }\r\n});\r\n\r\nPlayerHealthSystem = Class({\r\n  constructor: function(entities) {\r\n    this.entities = entities;\r\n\r\n    this.keyboard = new THREEx.KeyboardState();\r\n    this.jumped = false;\r\n  },\r\n\r\n  update: function(dt) {\r\n    var players = this.entities.queryTag(\"player\");\r\n\r\n    players.forEach(function(entity) {\r\n      if (entity.health.changed === false) {\r\n        return;\r\n      }\r\n\r\n      var percent = entity.health.hp / entity.health.maxHP;\r\n      var percentRounded = Math.round(percent * 100);\r\n\r\n      var healthElement = Globals.instance.healthElement;\r\n      var color = new THREE.Color(1 - percent, percent, 0);\r\n\r\n      healthElement.innerHTML = percentRounded + \"%\";\r\n      healthElement.style.color = \"#\" + color.getHexString();\r\n    });\r\n  }\r\n});\r\n\r\nHealthBarSystem = Class({\r\n  constructor: function(entities) {\r\n    this.entities = entities;\r\n  },\r\n\r\n  update: function(dt) {\r\n    var mortals = this.entities.queryComponents([C.Health]);\r\n\r\n    mortals.forEach(function(entity) {\r\n      if (entity.health.healthBar === null || entity.health.changed === false) {\r\n        return;\r\n      }\r\n\r\n      var percent = entity.health.hp / entity.health.maxHP;\r\n\r\n      entity.health.healthBar.scale.x = percent;\r\n      entity.health.healthBar.material.color = new THREE.Color(1 - percent, percent, 0);\r\n\r\n      entity.health.changed = false;\r\n    });\r\n  }\r\n});\r\n\r\nDeathSystem = Class({\r\n  constructor: function(entities) {\r\n    this.entities = entities;\r\n  },\r\n\r\n  update: function(dt) {\r\n    var mortals = this.entities.queryComponents([C.Health]);\r\n\r\n    mortals.forEach(function(entity) {\r\n      if (entity.health.hp <= 0) {\r\n        if (entity.hasComponent(C.Drawable)) {\r\n          if (entity.drawable.mesh._physijs.collision_type === EntityFactory.COLLISION_TYPES.enemy) {\r\n            Globals.instance.score += 10;\r\n\r\n            Globals.instance.scoreElement.innerHTML = Globals.instance.score;\r\n          }\r\n\r\n          entity.drawable.scene.remove(entity.drawable.mesh);\r\n        }\r\n\r\n        entity.remove();\r\n      }\r\n    });\r\n  }\r\n});\r\n\r\nAISystem = Class({\r\n  constructor: function(entities) {\r\n    this.entities = entities;\r\n  },\r\n\r\n  update: function(dt) {\r\n    var singularities = this.entities.queryComponents([C.AI]);\r\n\r\n    singularities.forEach(function(entity) {\r\n      if (entity.ai.tree === null || entity.ai.target === null || entity.ai.blackboard === null) {\r\n        return;\r\n      }\r\n\r\n      entity.ai.tree.tick(entity.ai.target, entity.ai.blackboard);\r\n    });\r\n  }\r\n});\r\n\r\nSteamUpdateSystem = Class({\r\n  constructor: function(entities) {\r\n    this.entities = entities;\r\n  },\r\n\r\n  update: function(dt) {\r\n    var steaming = this.entities.queryComponents([C.Steaming]);\r\n\r\n    steaming.forEach(function(entity) {\r\n      var particles = entity.steaming.particles;\r\n\r\n      var particleCount = particles.vertices.length;\r\n      while (particleCount--) {\r\n        var particle = particles.vertices[particleCount];\r\n        particle.y += dt * 50;\r\n\r\n        if (particle.y >= 5 + Utils.randomRange(-2, 4)) {\r\n          particle.y = Math.random();\r\n          particle.x = Math.random() * Utils.randomRange(-2, 2);\r\n          particle.z = Math.random() * Utils.randomRange(-2, 2);\r\n        }\r\n      }\r\n\r\n      particles.verticesNeedUpdate = true;\r\n    });\r\n  }\r\n});\r\n\r\nSteamRemovalSystem = Class({\r\n  constructor: function(entities) {\r\n    this.entities = entities;\r\n  },\r\n\r\n  update: function(dt) {\r\n    var steaming = this.entities.queryComponents([C.Steaming, C.Bullet, C.Drawable]);\r\n\r\n    steaming.forEach(function(entity) {\r\n      if (entity.bullet.isHot === false) {\r\n        entity.drawable.mesh.remove(entity.steaming.container);\r\n      }\r\n    });\r\n  }\r\n});\r\n\r\nCameraPitchSystem = Class({\r\n  constructor: function(entities) {\r\n    this.entities = entities;\r\n  },\r\n\r\n  update: function(dt) {\r\n    var pitchables = this.entities.queryComponents([C.CameraPitch, C.Drawable]);\r\n\r\n    pitchables.forEach(function(entity) {\r\n      entity.drawable.mesh.rotation.x = entity.cameraPitch.controls.pitchObject.rotation.x + entity.cameraPitch.offset;\r\n    });\r\n  }\r\n});\r\n\r\nPhysicsUpdateSystem = Class({\r\n  constructor: function(entities) {\r\n    this.entities = entities;\r\n  },\r\n\r\n  update: function(dt) {\r\n    var moveables = this.entities.queryComponents([C.Position, C.Velocity, C.Drawable]);\r\n\r\n    moveables.forEach(function(entity) {\r\n      entity.position.x = entity.drawable.mesh.position.x;\r\n      entity.position.y = entity.drawable.mesh.position.y;\r\n      entity.position.z = entity.drawable.mesh.position.z;\r\n\r\n      entity.velocity.x = entity.drawable.mesh.getLinearVelocity().x;\r\n      entity.velocity.y = entity.drawable.mesh.getLinearVelocity().y;\r\n      entity.velocity.z = entity.drawable.mesh.getLinearVelocity().z;\r\n\r\n      entity.velocity.rotationMatrix = new THREE.Matrix4().extractRotation(entity.drawable.mesh.matrix);\r\n    });\r\n  }\r\n});\r\n\r\n","MouseController = Class({\r\n  constructor: function() {\r\n    this.isDown = {\r\n      left: false,\r\n      right: false\r\n    };\r\n\r\n    this.wasPressed = {\r\n      left: false,\r\n      right: false\r\n    };\r\n  },\r\n\r\n  update: function(dt) {\r\n    this.wasPressed.left = false;\r\n    this.wasPressed.right = false;\r\n  }\r\n}, {\r\n  statics: {\r\n    get instance() {\r\n      if (!MouseController._instance) {\r\n        MouseController._instance = new MouseController();\r\n      }\r\n      return MouseController._instance;\r\n    }\r\n  }\r\n});\r\n\r\n","var EntityManager = require('tiny-ecs').EntityManager;\r\nvar C = require('./Components.js');\r\nvar b3 = require('./../b3core.0.1.0.js');\r\n\r\nEntityFactory = Class({\r\n  constructor: function() {\r\n    this.entities = new EntityManager();\r\n  },\r\n\r\n  makePlayer: function(options) {\r\n    var player = this.entities.createEntity();\r\n\r\n    ResourceManager.instance.loadModel('models/character.json', function(model) {\r\n      player.addTag(\"player\");\r\n\r\n      player.addComponent(C.Identifier);\r\n      player.addComponent(C.Position);\r\n      player.addComponent(C.Velocity);\r\n      player.addComponent(C.Jump);\r\n      player.addComponent(C.Drawable);\r\n      player.addComponent(C.CameraFollow);\r\n      player.addComponent(C.ShootDelay);\r\n      player.addComponent(C.Health);\r\n      player.addComponent(C.Gun);\r\n\r\n      player.identifier.type = Globals.ENTITY_TYPES.player;\r\n\r\n      player.drawable.scene = options.scene;\r\n\r\n      player.drawable.mesh = new Physijs.CapsuleMesh(\r\n        model.geometry,\r\n        Physijs.createMaterial(new THREE.MeshBasicMaterial({\r\n          color: 0xffff00\r\n        }), 0.9, 0.01), EntityFactory.MASS.player);\r\n      player.drawable.mesh.entity = player;\r\n\r\n      player.drawable.mesh.position.copy(options.position);\r\n      //player.drawable.mesh.rotation.copy(options.rotation);\r\n\r\n      player.drawable.mesh._physijs.collision_type = EntityFactory.COLLISION_TYPES.player;\r\n      player.drawable.mesh._physijs.collision_masks = (\r\n        EntityFactory.COLLISION_TYPES.obstacle |\r\n        EntityFactory.COLLISION_TYPES.enemy |\r\n        EntityFactory.COLLISION_TYPES.enemyBullet);\r\n\r\n      player.drawable.scene.add(player.drawable.mesh);\r\n\r\n      player.drawable.mesh.setDamping(0.99, 0);\r\n      player.drawable.mesh.setAngularFactor(new THREE.Vector3(0, 0, 0));\r\n\r\n      player.drawable.mesh.addEventListener('collision', function(other_object, relative_velocity, relative_rotation, contact_normal) {\r\n        if (contact_normal.y < 0 && other_object.entity.identifier.type === Globals.ENTITY_TYPES.ground) {\r\n          player.jump.canJump = true;\r\n        }\r\n\r\n        if (other_object.entity.identifier.type === Globals.ENTITY_TYPES.enemy && player.hasComponent(C.Hurt) === false) {\r\n          player.addComponent(C.Hurt);\r\n          player.hurt.originalColor = player.drawable.mesh.material.color;\r\n\r\n          player.health.hp--;\r\n          player.health.changed = true;\r\n        }\r\n      });\r\n\r\n      player.health.hp = player.health.maxHP = options.hp || 20;\r\n\r\n      player.position.x = options.position.x;\r\n      player.position.y = options.position.y;\r\n      player.position.z = options.position.z;\r\n\r\n      player.velocity.rotationMatrix = new THREE.Matrix4().extractRotation(player.drawable.mesh.matrix);\r\n\r\n      player.cameraFollow.controls = options.controls;\r\n      player.cameraFollow.object = options.controlsObject;\r\n      player.cameraFollow.offset = options.cameraOffset;\r\n\r\n      player.shootDelay.delayTheshold = 1.5;\r\n\r\n      this.makeGun({\r\n        parent: player.drawable.mesh,\r\n        cameraControls: options.controls,\r\n        offset: options.gunOffset,\r\n        callback: function(gun) {\r\n          player.gun.entity = gun;\r\n          player.gun.mesh = gun.drawable.mesh;\r\n        }\r\n      });\r\n    }.bind(this));\r\n\r\n    return player;\r\n  },\r\n\r\n  makeEnemy: function(options) {\r\n    ResourceManager.instance.loadModel('models/character.json', function(model) {\r\n      var enemy = this.entities.createEntity();\r\n\r\n      enemy.addTag(\"enemy\");\r\n\r\n      enemy.addComponent(C.Identifier);\r\n      enemy.addComponent(C.Position);\r\n      enemy.addComponent(C.Velocity);\r\n      enemy.addComponent(C.Drawable);\r\n      enemy.addComponent(C.Health);\r\n      enemy.addComponent(C.ShootDelay);\r\n      enemy.addComponent(C.AI);\r\n\r\n      enemy.identifier.type = Globals.ENTITY_TYPES.enemy;\r\n\r\n      enemy.drawable.scene = options.scene;\r\n\r\n      enemy.drawable.mesh = new Physijs.CapsuleMesh(\r\n        model.geometry,\r\n        Physijs.createMaterial(new THREE.MeshPhongMaterial({\r\n          color: 0x0000ff\r\n        }), 0.9, 0.1), EntityFactory.MASS.enemy);\r\n      enemy.drawable.mesh.entity = enemy;\r\n\r\n      enemy.drawable.mesh._physijs.collision_type = EntityFactory.COLLISION_TYPES.enemy;\r\n      enemy.drawable.mesh._physijs.collision_masks = (\r\n        EntityFactory.COLLISION_TYPES.obstacle |\r\n        EntityFactory.COLLISION_TYPES.player |\r\n        EntityFactory.COLLISION_TYPES.enemy |\r\n        EntityFactory.COLLISION_TYPES.playerBullet |\r\n        EntityFactory.COLLISION_TYPES.enemyBullet);\r\n\r\n      enemy.drawable.mesh.position.copy(options.position);\r\n      //enemy.drawable.mesh.rotation.copy(options.rotation);\r\n\r\n      enemy.drawable.scene.add(enemy.drawable.mesh);\r\n\r\n      enemy.drawable.mesh.setDamping(0.99, 0);\r\n      enemy.drawable.mesh.setAngularFactor(new THREE.Vector3(0, 1, 0));\r\n\r\n      enemy.position.x = options.position.x;\r\n      enemy.position.y = options.position.y;\r\n      enemy.position.z = options.position.z;\r\n\r\n      enemy.velocity.rotationMatrix = new THREE.Matrix4().extractRotation(enemy.drawable.mesh.matrix);\r\n\r\n      enemy.health.hp = enemy.health.maxHP = options.hp || 15;\r\n      enemy.health.healthBar = new THREE.Mesh(\r\n        new THREE.BoxGeometry(14, 1.5, 0.5),\r\n        new THREE.MeshBasicMaterial({\r\n          color: 0x00ff00\r\n        }));\r\n      enemy.health.healthBar.position.set(0, 25, 0);\r\n      enemy.drawable.mesh.add(enemy.health.healthBar);\r\n\r\n      enemy.shootDelay.delayTheshold = 1.5;\r\n\r\n      var FaceNode = b3.Class(b3.Action);\r\n      FaceNode.prototype.name = 'FaceNode';\r\n      FaceNode.prototype.parameters = {\r\n        'facing': null\r\n      };\r\n\r\n      FaceNode.prototype.__Action_initialize = FaceNode.prototype.initialize;\r\n      FaceNode.prototype.initialize = function(settings) {\r\n        settings = settings || {};\r\n\r\n        this.__Action_initialize();\r\n\r\n        this.facing = settings.facing;\r\n      };\r\n\r\n      FaceNode.prototype.tick = function(tick) {\r\n        if (this.facing._manager === null || this.facing._manager === undefined) {\r\n          return b3.FAILURE;\r\n        }\r\n\r\n        // http://forum.unity3d.com/threads/making-an-object-rotate-to-face-another.1211/\r\n        // http://answers.unity3d.com/questions/503934/chow-to-check-if-an-object-is-facing-another.html\r\n\r\n        var parentPos = tick.target.drawable.mesh.position.clone();\r\n        var followingPos = this.facing.drawable.mesh.position.clone();\r\n\r\n        parentPos.y = 0;\r\n        followingPos.y = 0;\r\n\r\n        var posDif = parentPos.clone();\r\n        posDif.sub(followingPos);\r\n\r\n        var direction = new THREE.Vector3(0, 0, -1);\r\n        var rotation = new THREE.Euler(0, 0, 0, \"YXZ\");\r\n        rotation.set(tick.target.drawable.mesh.rotation.x, tick.target.drawable.mesh.rotation.y, 0);\r\n\r\n        var forward = new THREE.Vector3();\r\n        forward.copy(direction).applyEuler(rotation);\r\n\r\n        var angle = forward.angleTo(posDif);\r\n\r\n        if (angle <= 0.1) {\r\n          return b3.SUCCESS;\r\n        }\r\n\r\n        var lookAtMatrix = new THREE.Matrix4();\r\n        lookAtMatrix.lookAt(followingPos, parentPos, new THREE.Vector3(0, 1, 0));\r\n\r\n        var parentRotation = new THREE.Quaternion().setFromEuler(tick.target.drawable.mesh.rotation);\r\n        var targetRotation = new THREE.Quaternion().setFromRotationMatrix(lookAtMatrix);\r\n\r\n        var str = Math.min(3 * Globals.instance.dt, 5);\r\n\r\n        parentRotation.slerp(targetRotation, str);\r\n\r\n        tick.target.drawable.mesh.rotation.setFromQuaternion(parentRotation);\r\n        tick.target.drawable.mesh.__dirtyRotation = true;\r\n\r\n        return b3.RUNNING;\r\n      };\r\n\r\n      var RandomChildNode = b3.Class(b3.Composite);\r\n      RandomChildNode.prototype.name = 'RandomChildNode';\r\n\r\n      RandomChildNode.prototype.__Composite_initialize = RandomChildNode.prototype.initialize;\r\n      RandomChildNode.prototype.initialize = function(settings) {\r\n        settings = settings || {};\r\n\r\n        this.__Composite_initialize(settings);\r\n\r\n        this.chance = settings.chance;\r\n      };\r\n\r\n      RandomChildNode.prototype.tick = function(tick) {\r\n        //var chance = 1 / this.children.length;\r\n\r\n        for (var i = 0; i < this.children.length; i++) {\r\n          if (Math.random() <= this.chance[i]) {\r\n            var status = this.children[i]._execute(tick);\r\n\r\n            if (status !== b3.SUCCESS) {\r\n              return status;\r\n            }\r\n          }\r\n        }\r\n\r\n        return b3.SUCCESS;\r\n      };\r\n\r\n      var FollowNode = b3.Class(b3.Action);\r\n      FollowNode.prototype.name = 'FollowNode';\r\n      FollowNode.prototype.parameters = {\r\n        'following': null\r\n      };\r\n\r\n      FollowNode.prototype.__Action_initialize = FollowNode.prototype.initialize;\r\n      FollowNode.prototype.initialize = function(settings) {\r\n        settings = settings || {};\r\n\r\n        this.__Action_initialize();\r\n\r\n        this.following = settings.following;\r\n      };\r\n\r\n      FollowNode.prototype.tick = function(tick) {\r\n        if (this.following._manager === null || this.following._manager === undefined) {\r\n          return b3.FAILURE;\r\n        }\r\n\r\n        var parentPos = tick.target.drawable.mesh.position.clone();\r\n        var followingPos = this.following.drawable.mesh.position.clone();\r\n\r\n        var distance = parentPos.distanceTo(followingPos);\r\n\r\n        if (distance < 50) {\r\n          return b3.SUCCESS;\r\n        }\r\n\r\n        var difference = new THREE.Vector3();\r\n        difference.subVectors(followingPos, parentPos);\r\n\r\n        var normal = difference.normalize();\r\n        var velocity = new THREE.Vector3(tick.target.velocity.x, tick.target.velocity.y, tick.target.velocity.z);\r\n        var dv = new THREE.Vector3(EntityFactory.MOVE_SPEED.enemy * normal.x, 0, EntityFactory.MOVE_SPEED.enemy * normal.z);\r\n\r\n        velocity.add(dv);\r\n\r\n        tick.target.velocity.x = velocity.x;\r\n        tick.target.velocity.y = velocity.y;\r\n        tick.target.velocity.z = velocity.z;\r\n\r\n        return b3.RUNNING;\r\n      };\r\n\r\n      var ShootNode = b3.Class(b3.Action);\r\n      ShootNode.prototype.name = 'ShootNode';\r\n      ShootNode.prototype.parameters = {\r\n        'shootingAt': null\r\n      };\r\n\r\n      ShootNode.prototype.__Action_initialize = ShootNode.prototype.initialize;\r\n      ShootNode.prototype.initialize = function(settings) {\r\n        settings = settings || {};\r\n\r\n        this.__Action_initialize();\r\n\r\n        this.shootingAt = settings.shootingAt;\r\n        this.bulletSpeed = settings.bulletSpeed;\r\n      };\r\n\r\n      ShootNode.prototype.tick = function(tick) {\r\n        if (this.shootingAt._manager === null || this.shootingAt._manager === undefined) {\r\n          return b3.FAILURE;\r\n        }\r\n        else if (tick.target.shootDelay.canShoot === false) {\r\n          return b3.FAILURE;\r\n        }\r\n\r\n        var parentPos = tick.target.drawable.mesh.position.clone();\r\n        var followingPos = this.shootingAt.drawable.mesh.position.clone();\r\n\r\n        var spawnLocation = parentPos.clone();\r\n        var spawnOffset = new THREE.Vector3(0, 10, 20);\r\n        spawnOffset.applyMatrix4(tick.target.velocity.rotationMatrix);\r\n        spawnLocation.add(spawnOffset);\r\n\r\n        var followingVel = new THREE.Vector3(this.shootingAt.velocity.x, this.shootingAt.velocity.y, this.shootingAt.velocity.z);\r\n        followingVel.multiplyScalar(Globals.instance.dt);\r\n        var predictedPos = followingPos.clone();\r\n        predictedPos.add(followingVel);\r\n\r\n        var rotation = new THREE.Euler(0, 0, 0, \"YXZ\");\r\n        rotation.set(tick.target.drawable.mesh.rotation.x, tick.target.drawable.mesh.rotation.y, 0);\r\n\r\n        var forward = new THREE.Vector3(0, 0, 1);\r\n        forward.applyEuler(rotation);\r\n\r\n        var distance = spawnLocation.distanceTo(followingPos);\r\n\r\n        var velocity = this.bulletSpeed;\r\n\r\n        // I have no clue why this works\r\n        //var velOffset = (Math.PI / 2) - (velocity / 250);\r\n        //var velOffset = 1.3 + (velocity / 1000);\r\n        var velOffset = 1 + (velocity / 100);\r\n        forward.y += distance / ((velocity - (velocity * velOffset * EntityFactory.MASS.bullet)) * velocity);\r\n\r\n        EntityFactory.instance.makePotato({\r\n          scene: tick.target.drawable.scene,\r\n          position: spawnLocation,\r\n          rotation: tick.target.drawable.mesh.rotation.clone(),\r\n          direction: forward,\r\n          velocity: velocity,\r\n          owner: 'enemy'\r\n        });\r\n\r\n        tick.target.shootDelay.canShoot = false;\r\n\r\n        return b3.SUCCESS;\r\n      };\r\n\r\n      enemy.ai.tree = new b3.BehaviorTree();\r\n      enemy.ai.tree.root = new b3.Sequence({\r\n        children: [\r\n          new b3.Sequence({\r\n            children: [\r\n              new FaceNode({\r\n                facing: options.aiTarget\r\n              }),\r\n              new RandomChildNode({\r\n                children: [\r\n                  new FollowNode({\r\n                    following: options.aiTarget\r\n                  }),\r\n                  new ShootNode({\r\n                    shootingAt: options.aiTarget,\r\n                    bulletSpeed: options.bulletSpeed\r\n                  })\r\n                ],\r\n                chance: [\r\n                  0.9,\r\n                  0.1\r\n                ]\r\n              })\r\n            ]\r\n          })\r\n        ]\r\n      });\r\n\r\n      enemy.ai.target = enemy;\r\n      enemy.ai.blackboard = new b3.Blackboard();\r\n    }.bind(this));\r\n  },\r\n\r\n  makeGun: function(options) {\r\n    ResourceManager.instance.loadModel('models/potatoCannon.json', function(model) {\r\n      var gun = this.entities.createEntity();\r\n\r\n      gun.addComponent(C.Position);\r\n      gun.addComponent(C.Drawable);\r\n\r\n      gun.drawable.scene = options.parent;\r\n      gun.drawable.mesh = new THREE.Mesh(\r\n        model.geometry,\r\n        model.material.clone());\r\n\r\n      gun.drawable.mesh.position.copy(options.offset);\r\n\r\n      gun.drawable.scene.add(gun.drawable.mesh);\r\n\r\n      if (options.cameraControls) {\r\n        gun.addComponent(C.CameraPitch);\r\n\r\n        gun.cameraPitch.controls = options.cameraControls;\r\n        //gun.cameraPitch.offset = 90 * Math.PI / 180;\r\n      }\r\n\r\n      if (options.callback) {\r\n        options.callback(gun);\r\n      }\r\n    }.bind(this));\r\n  },\r\n\r\n  makePotato: function(options) {\r\n    ResourceManager.instance.loadModel('models/potato.json', function(model) {\r\n      var potato = this.entities.createEntity();\r\n\r\n      potato.addTag(\"bullet\");\r\n      potato.addTag(\"potato\");\r\n\r\n      potato.addComponent(C.Identifier);\r\n      potato.addComponent(C.Position);\r\n      potato.addComponent(C.Drawable);\r\n      potato.addComponent(C.Bullet);\r\n      potato.addComponent(C.Expirable);\r\n      potato.addComponent(C.OneTimeHit);\r\n      potato.addComponent(C.Steaming);\r\n\r\n      potato.identifier.type = Globals.ENTITY_TYPES.bullet;\r\n      potato.bullet.owner = options.owner;\r\n\r\n      potato.drawable.scene = options.scene;\r\n\r\n      potato.drawable.mesh = new Physijs.CapsuleMesh(\r\n        model.geometry,\r\n        Physijs.createMaterial(model.material.clone(), 0.7, 0.01),\r\n        0.3);\r\n      potato.drawable.mesh.entity = potato;\r\n\r\n      // potatos are \"hot\" when created, so tint them red\r\n      potato.drawable.mesh.material.materials.forEach(function(mat) {\r\n        mat.color.setHex(0xE34D4D);\r\n      });\r\n\r\n      if (options.owner === 'player') {\r\n        potato.drawable.mesh._physijs.collision_type = EntityFactory.COLLISION_TYPES.playerBullet;\r\n      }\r\n      else {\r\n        potato.drawable.mesh._physijs.collision_type = EntityFactory.COLLISION_TYPES.enemyBullet;\r\n      }\r\n\r\n      potato.drawable.mesh._physijs.collision_masks = (\r\n        EntityFactory.COLLISION_TYPES.obstacle |\r\n        EntityFactory.COLLISION_TYPES.enemy |\r\n        EntityFactory.COLLISION_TYPES.player |\r\n        EntityFactory.COLLISION_TYPES.playerBullet |\r\n        EntityFactory.COLLISION_TYPES.enemyBullet);\r\n\r\n      potato.drawable.mesh.position.copy(options.position);\r\n      potato.drawable.mesh.rotation.copy(options.rotation);\r\n      if (options.scale) {\r\n        potato.drawable.mesh.scale.copy(options.scale);\r\n      }\r\n\r\n      potato.drawable.scene.add(potato.drawable.mesh);\r\n\r\n      potato.drawable.mesh.setDamping(0.1, 0);\r\n\r\n      potato.drawable.mesh.addEventListener('collision', function(other_object, relative_velocity, relative_rotation, contact_normal) {\r\n        if (potato.bullet.isHot === false) {\r\n          return;\r\n        }\r\n\r\n        var hitPlayer = potato.bullet.owner === 'enemy' && other_object.entity.identifier.type === Globals.ENTITY_TYPES.player;\r\n        var hitEnemy = potato.bullet.owner === 'player' && other_object.entity.identifier.type === Globals.ENTITY_TYPES.enemy;\r\n\r\n        if ((hitPlayer || hitEnemy) && other_object.entity.hasComponent(C.Hurt) === false && potato.oneTimeHit.alreadyHit.indexOf(other_object.uuid) < 0) {\r\n          other_object.entity.addComponent(C.Hurt);\r\n          other_object.entity.hurt.originalColor = other_object.material.color.clone();\r\n\r\n          other_object.entity.health.hp -= 5;\r\n          other_object.entity.health.changed = true;\r\n\r\n          potato.oneTimeHit.alreadyHit.push(other_object.uuid);\r\n        }\r\n        else if (other_object.entity.identifier.type === Globals.ENTITY_TYPES.ground) {\r\n          potato.bullet.touchedGround = true;\r\n        }\r\n        else if (potato.bullet.owner === 'player' && other_object.entity.identifier.type === Globals.ENTITY_TYPES.bullet && other_object.entity.bullet.owner === 'enemy' && potato.oneTimeHit.alreadyHit.indexOf(other_object.uuid) < 0) {\r\n          Globals.instance.score += 5;\r\n\r\n          Globals.instance.scoreElement.innerHTML = Globals.instance.score;\r\n\r\n          potato.oneTimeHit.alreadyHit.push(other_object.uuid);\r\n        }\r\n\r\n        potato.bullet.isHot = false;\r\n\r\n        // the potato is now \"cold,\" so tint it blue\r\n        potato.drawable.mesh.material.materials.forEach(function(mat) {\r\n          mat.color.setHex(0x45B7DE);\r\n        });\r\n      }.bind(this));\r\n\r\n      potato.position.x = options.position.x;\r\n      potato.position.y = options.position.y;\r\n      potato.position.z = options.position.z;\r\n\r\n      var vel = new THREE.Vector3(options.velocity, options.velocity, options.velocity);\r\n      vel.multiply(options.direction);\r\n      potato.drawable.mesh.applyCentralImpulse(vel);\r\n\r\n      potato.expirable.maxAge = 6;\r\n\r\n      potato.steaming.parent = potato.drawable.mesh;\r\n      potato.steaming.particles = new THREE.Geometry();\r\n      for (var i = 0; i < 25; i++) {\r\n        var particle = new THREE.Vector3(\r\n          Math.random() * Utils.randomRange(-2, 2),\r\n          Math.random() * 20,\r\n          Math.random() * Utils.randomRange(-2, 2));\r\n        potato.steaming.particles.vertices.push(particle);\r\n      }\r\n\r\n      var smokeTexture = ResourceManager.instance.getTexture(Globals.DIR + '/gfx/smoketex.jpg');\r\n      var smokeMaterial = new THREE.PointCloudMaterial({\r\n        map: smokeTexture,\r\n        transparent: true,\r\n        depthWrite: false,\r\n        blending: THREE.AdditiveBlending,\r\n        size: 2,\r\n        color: 0x111111\r\n      });\r\n\r\n      potato.steaming.system = new THREE.PointCloud(potato.steaming.particles, smokeMaterial);\r\n      potato.steaming.system.sortParticles = true;\r\n\r\n      potato.steaming.container = new THREE.Gyroscope();\r\n      potato.steaming.container.add(potato.steaming.system);\r\n      potato.drawable.mesh.add(potato.steaming.container);\r\n\r\n      if (options.callback) {\r\n        options.callback(potato);\r\n      }\r\n    }.bind(this));\r\n  },\r\n\r\n  makeFry: function(options) {\r\n    ResourceManager.instance.loadModel('models/fry.json', function(model) {\r\n      var fry = this.entities.createEntity();\r\n\r\n      fry.addTag(\"bullet\");\r\n      fry.addTag(\"fry\");\r\n\r\n      fry.addComponent(C.Identifier);\r\n      fry.addComponent(C.Position);\r\n      fry.addComponent(C.Drawable);\r\n      fry.addComponent(C.Bullet);\r\n      fry.addComponent(C.Expirable);\r\n      fry.addComponent(C.OneTimeHit);\r\n      fry.addComponent(C.Steaming);\r\n\r\n      fry.identifier.type = Globals.ENTITY_TYPES.bullet;\r\n      fry.bullet.owner = options.owner;\r\n\r\n      fry.drawable.scene = options.scene;\r\n\r\n      fry.drawable.mesh = new Physijs.BoxMesh(\r\n        model.geometry,\r\n        Physijs.createMaterial(model.material.clone(), 0.7, 0.01),\r\n        0.002);\r\n      fry.drawable.mesh.entity = fry;\r\n\r\n      // fries are \"hot\" when created, so tint them red\r\n      fry.drawable.mesh.material.materials.forEach(function(mat) {\r\n        mat.color.setHex(0xE34D4D);\r\n      });\r\n\r\n      if (options.owner === 'player') {\r\n        fry.drawable.mesh._physijs.collision_type = EntityFactory.COLLISION_TYPES.playerBullet;\r\n      }\r\n      else {\r\n        fry.drawable.mesh._physijs.collision_type = EntityFactory.COLLISION_TYPES.enemyBullet;\r\n      }\r\n\r\n      fry.drawable.mesh._physijs.collision_masks = (\r\n        EntityFactory.COLLISION_TYPES.obstacle |\r\n        EntityFactory.COLLISION_TYPES.enemy |\r\n        EntityFactory.COLLISION_TYPES.player |\r\n        EntityFactory.COLLISION_TYPES.playerBullet |\r\n        EntityFactory.COLLISION_TYPES.enemyBullet);\r\n\r\n      fry.drawable.mesh.position.copy(options.position);\r\n      fry.drawable.mesh.rotation.copy(options.rotation);\r\n      if (options.scale) {\r\n        fry.drawable.mesh.scale.copy(options.scale);\r\n      }\r\n\r\n      fry.drawable.scene.add(fry.drawable.mesh);\r\n\r\n      fry.drawable.mesh.setDamping(0.1, 0);\r\n\r\n      fry.drawable.mesh.addEventListener('collision', function(other_object, relative_velocity, relative_rotation, contact_normal) {\r\n        if (fry.bullet.isHot === false) {\r\n          return;\r\n        }\r\n\r\n        var hitPlayer = fry.bullet.owner === 'enemy' && other_object.entity.identifier.type === Globals.ENTITY_TYPES.player;\r\n        var hitEnemy = fry.bullet.owner === 'player' && other_object.entity.identifier.type === Globals.ENTITY_TYPES.enemy;\r\n\r\n        if ((hitPlayer || hitEnemy) && other_object.entity.hasComponent(C.Hurt) === false && fry.oneTimeHit.alreadyHit.indexOf(other_object.uuid) < 0) {\r\n          other_object.entity.addComponent(C.Hurt);\r\n          other_object.entity.hurt.originalColor = other_object.material.color.clone();\r\n\r\n          other_object.entity.health.hp -= 1;\r\n          other_object.entity.health.changed = true;\r\n\r\n          fry.oneTimeHit.alreadyHit.push(other_object.uuid);\r\n        }\r\n        else if (other_object.entity.identifier.type === Globals.ENTITY_TYPES.ground) {\r\n          fry.bullet.touchedGround = true;\r\n        }\r\n        else if (fry.bullet.owner === 'player' && other_object.entity.identifier.type === Globals.ENTITY_TYPES.bullet && other_object.entity.bullet.owner === 'enemy' && fry.oneTimeHit.alreadyHit.indexOf(other_object.uuid) < 0) {\r\n          Globals.instance.score += 5;\r\n\r\n          Globals.instance.scoreElement.innerHTML = Globals.instance.score;\r\n\r\n          fry.oneTimeHit.alreadyHit.push(other_object.uuid);\r\n        }\r\n\r\n        fry.bullet.isHot = other_object.entity.hasTag(\"fry\");\r\n\r\n        if (fry.bullet.isHot === false) {\r\n          // the fry is now \"cold,\" so tint it blue\r\n          fry.drawable.mesh.material.materials.forEach(function(mat) {\r\n            mat.color.setHex(0x45B7DE);\r\n          });\r\n        }\r\n      }.bind(this));\r\n\r\n      fry.position.x = options.position.x;\r\n      fry.position.y = options.position.y;\r\n      fry.position.z = options.position.z;\r\n\r\n      var vel = new THREE.Vector3(options.velocity, options.velocity, options.velocity);\r\n      vel.multiply(options.direction);\r\n      fry.drawable.mesh.applyCentralImpulse(vel);\r\n\r\n      fry.expirable.maxAge = 6;\r\n\r\n      fry.steaming.parent = fry.drawable.mesh;\r\n      fry.steaming.particles = new THREE.Geometry();\r\n      for (var i = 0; i < 25; i++) {\r\n        var particle = new THREE.Vector3(\r\n          Math.random() * Utils.randomRange(-2, 2),\r\n          Math.random() * 20,\r\n          Math.random() * Utils.randomRange(-2, 2));\r\n        fry.steaming.particles.vertices.push(particle);\r\n      }\r\n\r\n      var smokeTexture = ResourceManager.instance.getTexture(Globals.DIR + '/gfx/smoketex.jpg');\r\n      var smokeMaterial = new THREE.PointCloudMaterial({\r\n        map: smokeTexture,\r\n        transparent: true,\r\n        depthWrite: false,\r\n        blending: THREE.AdditiveBlending,\r\n        size: 2,\r\n        color: 0x111111\r\n      });\r\n\r\n      fry.steaming.system = new THREE.PointCloud(fry.steaming.particles, smokeMaterial);\r\n      fry.steaming.system.sortParticles = true;\r\n\r\n      fry.steaming.container = new THREE.Gyroscope();\r\n      fry.steaming.container.add(fry.steaming.system);\r\n      fry.drawable.mesh.add(fry.steaming.container);\r\n\r\n      if (options.callback) {\r\n        options.callback(fry);\r\n      }\r\n    }.bind(this));\r\n  },\r\n\r\n  makeGround: function(options) {\r\n    var ground = this.entities.createEntity();\r\n\r\n    ground.addComponent(C.Identifier);\r\n    ground.addComponent(C.Position);\r\n    ground.addComponent(C.Drawable);\r\n\r\n    ground.identifier.type = Globals.ENTITY_TYPES.ground;\r\n\r\n    ground.drawable.scene = options.scene;\r\n\r\n    var mainTex = ResourceManager.instance.getTexture('gfx/brick-floor-tileable_COLOR.jpg');\r\n    mainTex.wrapS = mainTex.wrapT = THREE.RepeatWrapping;\r\n    var diffuseTex = ResourceManager.instance.getTexture('gfx/brick-floor-tileable_DISP.jpg');\r\n    diffuseTex.wrapS = mainTex.wrapT = THREE.RepeatWrapping;\r\n    var specularTex = ResourceManager.instance.getTexture('gfx/brick-floor-tileable_SPEC.jpg');\r\n    specularTex.wrapS = mainTex.wrapT = THREE.RepeatWrapping;\r\n\r\n    ground.drawable.mesh = new Physijs.BoxMesh(\r\n      new THREE.BoxGeometry(options.width, 1, options.height),\r\n      new THREE.MeshPhongMaterial({\r\n        map: ResourceManager.instance.getTexture('gfx/brick-floor-tileable_COLOR.jpg'),\r\n        displacementMap: ResourceManager.instance.getTexture('gfx/brick-floor-tileable_DISP.jpg'),\r\n        specularMap: ResourceManager.instance.getTexture('gfx/brick-floor-tileable_SPEC.jpg')\r\n          //color: 0x00ff00\r\n      }), 0);\r\n    ground.drawable.mesh.entity = ground;\r\n\r\n    ground.drawable.mesh._physijs.collision_type = EntityFactory.COLLISION_TYPES.obstacle;\r\n    ground.drawable.mesh._physijs.collision_masks = (\r\n      EntityFactory.COLLISION_TYPES.obstacle |\r\n      EntityFactory.COLLISION_TYPES.player |\r\n      EntityFactory.COLLISION_TYPES.enemy |\r\n      EntityFactory.COLLISION_TYPES.playerBullet |\r\n      EntityFactory.COLLISION_TYPES.enemyBullet);\r\n\r\n    ground.drawable.scene.add(ground.drawable.mesh);\r\n  }\r\n}, {\r\n  statics: {\r\n    get instance() {\r\n      if (!EntityFactory._instance) {\r\n        EntityFactory._instance = new EntityFactory();\r\n      }\r\n      return EntityFactory._instance;\r\n    },\r\n\r\n    COLLISION_TYPES: {\r\n      nothing: 0, // collide with nothing\r\n\r\n      obstacle: 1 << 0,\r\n      player: 1 << 2,\r\n      enemy: 1 << 3,\r\n\r\n      playerBullet: 1 << 4,\r\n      enemyBullet: 1 << 5\r\n    },\r\n\r\n    MOVE_SPEED: {\r\n      enemy: 160\r\n    },\r\n\r\n    MASS: {\r\n      player: 73,\r\n      enemy: 81,\r\n      bullet: 0.3\r\n    }\r\n  }\r\n});\r\n\r\n","module.exports = function(THREE) {\n  'use strict';\n\n  var SUPPORT_TRANSFERABLE,\n    _is_simulating = false,\n    _Physijs = Physijs, // used for noConflict method\n    Physijs = {}, // object assigned to window.Physijs\n    Eventable, // class to provide simple event methods\n    getObjectId, // returns a unique ID for a Physijs mesh object\n    getEulerXYZFromQuaternion, getQuatertionFromEuler,\n    convertWorldPositionToObject, // Converts a world-space position to object-space\n    addObjectChildren,\n\n    _temp1, _temp2,\n    _temp_vector3_1 = new THREE.Vector3,\n    _temp_vector3_2 = new THREE.Vector3,\n    _temp_matrix4_1 = new THREE.Matrix4,\n    _quaternion_1 = new THREE.Quaternion,\n\n    // constants\n    MESSAGE_TYPES = {\n      WORLDREPORT: 0,\n      COLLISIONREPORT: 1,\n      VEHICLEREPORT: 2,\n      CONSTRAINTREPORT: 3\n    },\n    REPORT_ITEMSIZE = 14,\n    COLLISIONREPORT_ITEMSIZE = 5,\n    VEHICLEREPORT_ITEMSIZE = 9,\n    CONSTRAINTREPORT_ITEMSIZE = 6;\n\n  Physijs.scripts = {};\n\n  Eventable = function() {\n    this._eventListeners = {};\n  };\n  Eventable.prototype.addEventListener = function(event_name, callback) {\n    if (!this._eventListeners.hasOwnProperty(event_name)) {\n      this._eventListeners[event_name] = [];\n    }\n    this._eventListeners[event_name].push(callback);\n  };\n  Eventable.prototype.removeEventListener = function(event_name, callback) {\n    var index;\n\n    if (!this._eventListeners.hasOwnProperty(event_name)) return false;\n\n    if ((index = this._eventListeners[event_name].indexOf(callback)) >= 0) {\n      this._eventListeners[event_name].splice(index, 1);\n      return true;\n    }\n\n    return false;\n  };\n  Eventable.prototype.dispatchEvent = function(event_name) {\n    var i,\n      parameters = Array.prototype.splice.call(arguments, 1);\n\n    if (this._eventListeners.hasOwnProperty(event_name)) {\n      for (i = 0; i < this._eventListeners[event_name].length; i++) {\n        this._eventListeners[event_name][i].apply(this, parameters);\n      }\n    }\n  };\n  Eventable.make = function(obj) {\n    obj.prototype.addEventListener = Eventable.prototype.addEventListener;\n    obj.prototype.removeEventListener = Eventable.prototype.removeEventListener;\n    obj.prototype.dispatchEvent = Eventable.prototype.dispatchEvent;\n  };\n\n  getObjectId = (function() {\n    var _id = 1;\n    return function() {\n      return _id++;\n    };\n  })();\n\n  getEulerXYZFromQuaternion = function(x, y, z, w) {\n    return new THREE.Vector3(\n      Math.atan2(2 * (x * w - y * z), (w * w - x * x - y * y + z * z)),\n      Math.asin(2 * (x * z + y * w)),\n      Math.atan2(2 * (z * w - x * y), (w * w + x * x - y * y - z * z))\n    );\n  };\n\n  getQuatertionFromEuler = function(x, y, z) {\n    var c1, s1, c2, s2, c3, s3, c1c2, s1s2;\n    c1 = Math.cos(y);\n    s1 = Math.sin(y);\n    c2 = Math.cos(-z);\n    s2 = Math.sin(-z);\n    c3 = Math.cos(x);\n    s3 = Math.sin(x);\n\n    c1c2 = c1 * c2;\n    s1s2 = s1 * s2;\n\n    return {\n      w: c1c2 * c3 - s1s2 * s3,\n      x: c1c2 * s3 + s1s2 * c3,\n      y: s1 * c2 * c3 + c1 * s2 * s3,\n      z: c1 * s2 * c3 - s1 * c2 * s3\n    };\n  };\n\n  convertWorldPositionToObject = function(position, object) {\n    _temp_matrix4_1.identity(); // reset temp matrix\n\n    // Set the temp matrix's rotation to the object's rotation\n    _temp_matrix4_1.identity().makeRotationFromQuaternion(object.quaternion);\n\n    // Invert rotation matrix in order to \"unrotate\" a point back to object space\n    _temp_matrix4_1.getInverse(_temp_matrix4_1);\n\n    // Yay! Temp vars!\n    _temp_vector3_1.copy(position);\n    _temp_vector3_2.copy(object.position);\n\n    // Apply the rotation\n\n    return _temp_vector3_1.sub(_temp_vector3_2).applyMatrix4(_temp_matrix4_1);\n  };\n\n\n\n  // Physijs.noConflict\n  Physijs.noConflict = function() {\n    window.Physijs = _Physijs;\n    return Physijs;\n  };\n\n\n  // Physijs.createMaterial\n  Physijs.createMaterial = function(material, friction, restitution) {\n    var physijs_material = function() {};\n    physijs_material.prototype = material;\n    physijs_material = new physijs_material;\n\n    physijs_material._physijs = {\n      id: material.id,\n      friction: friction === undefined ? .8 : friction,\n      restitution: restitution === undefined ? .2 : restitution\n    };\n\n    return physijs_material;\n  };\n\n\n  // Constraints\n  Physijs.PointConstraint = function(objecta, objectb, position) {\n    if (position === undefined) {\n      position = objectb;\n      objectb = undefined;\n    }\n\n    this.type = 'point';\n    this.appliedImpulse = 0;\n    this.id = getObjectId();\n    this.objecta = objecta._physijs.id;\n    this.positiona = convertWorldPositionToObject(position, objecta).clone();\n\n    if (objectb) {\n      this.objectb = objectb._physijs.id;\n      this.positionb = convertWorldPositionToObject(position, objectb).clone();\n    }\n  };\n  Physijs.PointConstraint.prototype.getDefinition = function() {\n    return {\n      type: this.type,\n      id: this.id,\n      objecta: this.objecta,\n      objectb: this.objectb,\n      positiona: this.positiona,\n      positionb: this.positionb\n    };\n  };\n\n  Physijs.HingeConstraint = function(objecta, objectb, position, axis) {\n    if (axis === undefined) {\n      axis = position;\n      position = objectb;\n      objectb = undefined;\n    }\n\n    this.type = 'hinge';\n    this.appliedImpulse = 0;\n    this.id = getObjectId();\n    this.scene = objecta.parent;\n    this.objecta = objecta._physijs.id;\n    this.positiona = convertWorldPositionToObject(position, objecta).clone();\n    this.position = position.clone();\n    this.axis = axis;\n\n    if (objectb) {\n      this.objectb = objectb._physijs.id;\n      this.positionb = convertWorldPositionToObject(position, objectb).clone();\n    }\n  };\n  Physijs.HingeConstraint.prototype.getDefinition = function() {\n    return {\n      type: this.type,\n      id: this.id,\n      objecta: this.objecta,\n      objectb: this.objectb,\n      positiona: this.positiona,\n      positionb: this.positionb,\n      axis: this.axis\n    };\n  };\n  /*\n   * low = minimum angle in radians\n   * high = maximum angle in radians\n   * bias_factor = applied as a factor to constraint error\n   * relaxation_factor = controls bounce (0.0 == no bounce)\n   */\n  Physijs.HingeConstraint.prototype.setLimits = function(low, high, bias_factor, relaxation_factor) {\n    this.scene.execute('hinge_setLimits', {\n      constraint: this.id,\n      low: low,\n      high: high,\n      bias_factor: bias_factor,\n      relaxation_factor: relaxation_factor\n    });\n  };\n  Physijs.HingeConstraint.prototype.enableAngularMotor = function(velocity, acceleration) {\n    this.scene.execute('hinge_enableAngularMotor', {\n      constraint: this.id,\n      velocity: velocity,\n      acceleration: acceleration\n    });\n  };\n  Physijs.HingeConstraint.prototype.disableMotor = function(velocity, acceleration) {\n    this.scene.execute('hinge_disableMotor', {\n      constraint: this.id\n    });\n  };\n\n  Physijs.SliderConstraint = function(objecta, objectb, position, axis) {\n    if (axis === undefined) {\n      axis = position;\n      position = objectb;\n      objectb = undefined;\n    }\n\n    this.type = 'slider';\n    this.appliedImpulse = 0;\n    this.id = getObjectId();\n    this.scene = objecta.parent;\n    this.objecta = objecta._physijs.id;\n    this.positiona = convertWorldPositionToObject(position, objecta).clone();\n    this.axis = axis;\n\n    if (objectb) {\n      this.objectb = objectb._physijs.id;\n      this.positionb = convertWorldPositionToObject(position, objectb).clone();\n    }\n  };\n  Physijs.SliderConstraint.prototype.getDefinition = function() {\n    return {\n      type: this.type,\n      id: this.id,\n      objecta: this.objecta,\n      objectb: this.objectb,\n      positiona: this.positiona,\n      positionb: this.positionb,\n      axis: this.axis\n    };\n  };\n  Physijs.SliderConstraint.prototype.setLimits = function(lin_lower, lin_upper, ang_lower, ang_upper) {\n    this.scene.execute('slider_setLimits', {\n      constraint: this.id,\n      lin_lower: lin_lower,\n      lin_upper: lin_upper,\n      ang_lower: ang_lower,\n      ang_upper: ang_upper\n    });\n  };\n  Physijs.SliderConstraint.prototype.setRestitution = function(linear, angular) {\n    this.scene.execute(\n      'slider_setRestitution', {\n        constraint: this.id,\n        linear: linear,\n        angular: angular\n      }\n    );\n  };\n  Physijs.SliderConstraint.prototype.enableLinearMotor = function(velocity, acceleration) {\n    this.scene.execute('slider_enableLinearMotor', {\n      constraint: this.id,\n      velocity: velocity,\n      acceleration: acceleration\n    });\n  };\n  Physijs.SliderConstraint.prototype.disableLinearMotor = function() {\n    this.scene.execute('slider_disableLinearMotor', {\n      constraint: this.id\n    });\n  };\n  Physijs.SliderConstraint.prototype.enableAngularMotor = function(velocity, acceleration) {\n    this.scene.execute('slider_enableAngularMotor', {\n      constraint: this.id,\n      velocity: velocity,\n      acceleration: acceleration\n    });\n  };\n  Physijs.SliderConstraint.prototype.disableAngularMotor = function() {\n    this.scene.execute('slider_disableAngularMotor', {\n      constraint: this.id\n    });\n  };\n\n  Physijs.ConeTwistConstraint = function(objecta, objectb, position) {\n    if (position === undefined) {\n      throw 'Both objects must be defined in a ConeTwistConstraint.';\n    }\n    this.type = 'conetwist';\n    this.appliedImpulse = 0;\n    this.id = getObjectId();\n    this.scene = objecta.parent;\n    this.objecta = objecta._physijs.id;\n    this.positiona = convertWorldPositionToObject(position, objecta).clone();\n    this.objectb = objectb._physijs.id;\n    this.positionb = convertWorldPositionToObject(position, objectb).clone();\n    this.axisa = {\n      x: objecta.rotation.x,\n      y: objecta.rotation.y,\n      z: objecta.rotation.z\n    };\n    this.axisb = {\n      x: objectb.rotation.x,\n      y: objectb.rotation.y,\n      z: objectb.rotation.z\n    };\n  };\n  Physijs.ConeTwistConstraint.prototype.getDefinition = function() {\n    return {\n      type: this.type,\n      id: this.id,\n      objecta: this.objecta,\n      objectb: this.objectb,\n      positiona: this.positiona,\n      positionb: this.positionb,\n      axisa: this.axisa,\n      axisb: this.axisb\n    };\n  };\n  Physijs.ConeTwistConstraint.prototype.setLimit = function(x, y, z) {\n    this.scene.execute('conetwist_setLimit', {\n      constraint: this.id,\n      x: x,\n      y: y,\n      z: z\n    });\n  };\n  Physijs.ConeTwistConstraint.prototype.enableMotor = function() {\n    this.scene.execute('conetwist_enableMotor', {\n      constraint: this.id\n    });\n  };\n  Physijs.ConeTwistConstraint.prototype.setMaxMotorImpulse = function(max_impulse) {\n    this.scene.execute('conetwist_setMaxMotorImpulse', {\n      constraint: this.id,\n      max_impulse: max_impulse\n    });\n  };\n  Physijs.ConeTwistConstraint.prototype.setMotorTarget = function(target) {\n    if (target instanceof THREE.Vector3) {\n      target = new THREE.Quaternion().setFromEuler(new THREE.Euler(target.x, target.y, target.z));\n    }\n    else if (target instanceof THREE.Euler) {\n      target = new THREE.Quaternion().setFromEuler(target);\n    }\n    else if (target instanceof THREE.Matrix4) {\n      target = new THREE.Quaternion().setFromRotationMatrix(target);\n    }\n    this.scene.execute('conetwist_setMotorTarget', {\n      constraint: this.id,\n      x: target.x,\n      y: target.y,\n      z: target.z,\n      w: target.w\n    });\n  };\n  Physijs.ConeTwistConstraint.prototype.disableMotor = function() {\n    this.scene.execute('conetwist_disableMotor', {\n      constraint: this.id\n    });\n  };\n\n  Physijs.DOFConstraint = function(objecta, objectb, position) {\n    if (position === undefined) {\n      position = objectb;\n      objectb = undefined;\n    }\n    this.type = 'dof';\n    this.appliedImpulse = 0;\n    this.id = getObjectId();\n    this.scene = objecta.parent;\n    this.objecta = objecta._physijs.id;\n    this.positiona = convertWorldPositionToObject(position, objecta).clone();\n    this.axisa = {\n      x: objecta.rotation.x,\n      y: objecta.rotation.y,\n      z: objecta.rotation.z\n    };\n\n    if (objectb) {\n      this.objectb = objectb._physijs.id;\n      this.positionb = convertWorldPositionToObject(position, objectb).clone();\n      this.axisb = {\n        x: objectb.rotation.x,\n        y: objectb.rotation.y,\n        z: objectb.rotation.z\n      };\n    }\n  };\n  Physijs.DOFConstraint.prototype.getDefinition = function() {\n    return {\n      type: this.type,\n      id: this.id,\n      objecta: this.objecta,\n      objectb: this.objectb,\n      positiona: this.positiona,\n      positionb: this.positionb,\n      axisa: this.axisa,\n      axisb: this.axisb\n    };\n  };\n  Physijs.DOFConstraint.prototype.setLinearLowerLimit = function(limit) {\n    this.scene.execute('dof_setLinearLowerLimit', {\n      constraint: this.id,\n      x: limit.x,\n      y: limit.y,\n      z: limit.z\n    });\n  };\n  Physijs.DOFConstraint.prototype.setLinearUpperLimit = function(limit) {\n    this.scene.execute('dof_setLinearUpperLimit', {\n      constraint: this.id,\n      x: limit.x,\n      y: limit.y,\n      z: limit.z\n    });\n  };\n  Physijs.DOFConstraint.prototype.setAngularLowerLimit = function(limit) {\n    this.scene.execute('dof_setAngularLowerLimit', {\n      constraint: this.id,\n      x: limit.x,\n      y: limit.y,\n      z: limit.z\n    });\n  };\n  Physijs.DOFConstraint.prototype.setAngularUpperLimit = function(limit) {\n    this.scene.execute('dof_setAngularUpperLimit', {\n      constraint: this.id,\n      x: limit.x,\n      y: limit.y,\n      z: limit.z\n    });\n  };\n  Physijs.DOFConstraint.prototype.enableAngularMotor = function(which) {\n    this.scene.execute('dof_enableAngularMotor', {\n      constraint: this.id,\n      which: which\n    });\n  };\n  Physijs.DOFConstraint.prototype.configureAngularMotor = function(which, low_angle, high_angle, velocity, max_force) {\n    this.scene.execute('dof_configureAngularMotor', {\n      constraint: this.id,\n      which: which,\n      low_angle: low_angle,\n      high_angle: high_angle,\n      velocity: velocity,\n      max_force: max_force\n    });\n  };\n  Physijs.DOFConstraint.prototype.disableAngularMotor = function(which) {\n    this.scene.execute('dof_disableAngularMotor', {\n      constraint: this.id,\n      which: which\n    });\n  };\n\n  // Physijs.Scene\n  Physijs.Scene = function(params) {\n    var self = this;\n\n    Eventable.call(this);\n    THREE.Scene.call(this);\n\n    this._worker = new Worker(Physijs.scripts.worker || 'physijsWorker.js');\n    this._worker.transferableMessage = this._worker.webkitPostMessage || this._worker.postMessage;\n    this._materials_ref_counts = {};\n    this._objects = {};\n    this._vehicles = {};\n    this._constraints = {};\n\n    var ab = new ArrayBuffer(1);\n    this._worker.transferableMessage(ab, [ab]);\n    SUPPORT_TRANSFERABLE = (ab.byteLength === 0);\n\n    this._worker.onerror = function(event) {\n      console.log(event.message);\n      console.log(event.filename);\n      console.log(event.lineno);\n    };\n\n    this._worker.onmessage = function(event) {\n      var _temp,\n        data = event.data;\n\n      if (data instanceof ArrayBuffer && data.byteLength !== 1) { // byteLength === 1 is the worker making a SUPPORT_TRANSFERABLE test\n        data = new Float32Array(data);\n      }\n\n      if (data instanceof Float32Array) {\n\n        // transferable object\n        switch (data[0]) {\n          case MESSAGE_TYPES.WORLDREPORT:\n            self._updateScene(data);\n            break;\n\n          case MESSAGE_TYPES.COLLISIONREPORT:\n            self._updateCollisions(data);\n            break;\n\n          case MESSAGE_TYPES.VEHICLEREPORT:\n            self._updateVehicles(data);\n            break;\n\n          case MESSAGE_TYPES.CONSTRAINTREPORT:\n            self._updateConstraints(data);\n            break;\n        }\n\n      }\n      else {\n\n        if (data.cmd) {\n\n          // non-transferable object\n          switch (data.cmd) {\n            case 'objectReady':\n              _temp = data.params;\n              if (self._objects[_temp]) {\n                self._objects[_temp].dispatchEvent('ready');\n              }\n              break;\n\n            case 'worldReady':\n              self.dispatchEvent('ready');\n              break;\n\n            case 'vehicle':\n              window.test = data;\n              break;\n\n            default:\n              // Do nothing, just show the message\n              console.debug('Received: ' + data.cmd);\n              console.dir(data.params);\n              break;\n          }\n\n        }\n        else {\n\n          switch (data[0]) {\n            case MESSAGE_TYPES.WORLDREPORT:\n              self._updateScene(data);\n              break;\n\n            case MESSAGE_TYPES.COLLISIONREPORT:\n              self._updateCollisions(data);\n              break;\n\n            case MESSAGE_TYPES.VEHICLEREPORT:\n              self._updateVehicles(data);\n              break;\n\n            case MESSAGE_TYPES.CONSTRAINTREPORT:\n              self._updateConstraints(data);\n              break;\n          }\n\n        }\n\n      }\n    };\n\n\n    params = params || {};\n    params.ammo = Physijs.scripts.ammo || 'ammo.js';\n    params.fixedTimeStep = params.fixedTimeStep || 1 / 60;\n    params.rateLimit = params.rateLimit || true;\n    this.execute('init', params);\n  };\n  Physijs.Scene.prototype = new THREE.Scene;\n  Physijs.Scene.prototype.constructor = Physijs.Scene;\n  Eventable.make(Physijs.Scene);\n\n  Physijs.Scene.prototype._updateScene = function(data) {\n    var num_objects = data[1],\n      object,\n      i, offset;\n\n    for (i = 0; i < num_objects; i++) {\n      offset = 2 + i * REPORT_ITEMSIZE;\n      object = this._objects[data[offset]];\n\n      if (object === undefined) {\n        continue;\n      }\n\n      if (object.__dirtyPosition === false) {\n        object.position.set(\n          data[offset + 1],\n          data[offset + 2],\n          data[offset + 3]\n        );\n      }\n\n      if (object.__dirtyRotation === false) {\n        object.quaternion.set(\n          data[offset + 4],\n          data[offset + 5],\n          data[offset + 6],\n          data[offset + 7]\n        );\n      }\n\n      object._physijs.linearVelocity.set(\n        data[offset + 8],\n        data[offset + 9],\n        data[offset + 10]\n      );\n\n      object._physijs.angularVelocity.set(\n        data[offset + 11],\n        data[offset + 12],\n        data[offset + 13]\n      );\n\n    }\n\n    if (SUPPORT_TRANSFERABLE) {\n      // Give the typed array back to the worker\n      this._worker.transferableMessage(data.buffer, [data.buffer]);\n    }\n\n    _is_simulating = false;\n    this.dispatchEvent('update');\n  };\n\n  Physijs.Scene.prototype._updateVehicles = function(data) {\n    var vehicle, wheel,\n      i, offset;\n\n    for (i = 0; i < (data.length - 1) / VEHICLEREPORT_ITEMSIZE; i++) {\n      offset = 1 + i * VEHICLEREPORT_ITEMSIZE;\n      vehicle = this._vehicles[data[offset]];\n\n      if (vehicle === undefined) {\n        continue;\n      }\n\n      wheel = vehicle.wheels[data[offset + 1]];\n\n      wheel.position.set(\n        data[offset + 2],\n        data[offset + 3],\n        data[offset + 4]\n      );\n\n      wheel.quaternion.set(\n        data[offset + 5],\n        data[offset + 6],\n        data[offset + 7],\n        data[offset + 8]\n      );\n    }\n\n    if (SUPPORT_TRANSFERABLE) {\n      // Give the typed array back to the worker\n      this._worker.transferableMessage(data.buffer, [data.buffer]);\n    }\n  };\n\n  Physijs.Scene.prototype._updateConstraints = function(data) {\n    var constraint, object,\n      i, offset;\n\n    for (i = 0; i < (data.length - 1) / CONSTRAINTREPORT_ITEMSIZE; i++) {\n      offset = 1 + i * CONSTRAINTREPORT_ITEMSIZE;\n      constraint = this._constraints[data[offset]];\n      object = this._objects[data[offset + 1]];\n\n      if (constraint === undefined || object === undefined) {\n        continue;\n      }\n\n      _temp_vector3_1.set(\n        data[offset + 2],\n        data[offset + 3],\n        data[offset + 4]\n      );\n      _temp_matrix4_1.extractRotation(object.matrix);\n      _temp_vector3_1.applyMatrix4(_temp_matrix4_1);\n\n      constraint.positiona.addVectors(object.position, _temp_vector3_1);\n      constraint.appliedImpulse = data[offset + 5];\n    }\n\n    if (SUPPORT_TRANSFERABLE) {\n      // Give the typed array back to the worker\n      this._worker.transferableMessage(data.buffer, [data.buffer]);\n    }\n  };\n\n  Physijs.Scene.prototype._updateCollisions = function(data) {\n    /**\n     * #TODO\n     * This is probably the worst way ever to handle collisions. The inherent evilness is a residual\n     * effect from the previous version's evilness which mutated when switching to transferable objects.\n     *\n     * If you feel inclined to make this better, please do so.\n     */\n\n    var i, j, offset, object, object2, id1, id2,\n      collisions = {},\n      normal_offsets = {};\n\n    // Build collision manifest\n    for (i = 0; i < data[1]; i++) {\n      offset = 2 + i * COLLISIONREPORT_ITEMSIZE;\n      object = data[offset];\n      object2 = data[offset + 1];\n\n      normal_offsets[object + '-' + object2] = offset + 2;\n      normal_offsets[object2 + '-' + object] = -1 * (offset + 2);\n\n      // Register collisions for both the object colliding and the object being collided with\n      if (!collisions[object]) collisions[object] = [];\n      collisions[object].push(object2);\n\n      if (!collisions[object2]) collisions[object2] = [];\n      collisions[object2].push(object);\n    }\n\n    // Deal with collisions\n    for (id1 in this._objects) {\n      if (!this._objects.hasOwnProperty(id1)) continue;\n      object = this._objects[id1];\n\n      // If object touches anything, ...\n      if (collisions[id1]) {\n\n        // Clean up touches array\n        for (j = 0; j < object._physijs.touches.length; j++) {\n          if (collisions[id1].indexOf(object._physijs.touches[j]) === -1) {\n            object._physijs.touches.splice(j--, 1);\n          }\n        }\n\n        // Handle each colliding object\n        for (j = 0; j < collisions[id1].length; j++) {\n          id2 = collisions[id1][j];\n          object2 = this._objects[id2];\n\n          if (object2) {\n            // If object was not already touching object2, notify object\n            if (object._physijs.touches.indexOf(id2) === -1) {\n              object._physijs.touches.push(id2);\n\n              _temp_vector3_1.subVectors(object.getLinearVelocity(), object2.getLinearVelocity());\n              _temp1 = _temp_vector3_1.clone();\n\n              _temp_vector3_1.subVectors(object.getAngularVelocity(), object2.getAngularVelocity());\n              _temp2 = _temp_vector3_1.clone();\n\n              var normal_offset = normal_offsets[object._physijs.id + '-' + object2._physijs.id];\n              if (normal_offset > 0) {\n                _temp_vector3_1.set(-data[normal_offset], -data[normal_offset + 1], -data[normal_offset + 2]);\n              }\n              else {\n                normal_offset *= -1;\n                _temp_vector3_1.set(\n                  data[normal_offset],\n                  data[normal_offset + 1],\n                  data[normal_offset + 2]\n                );\n              }\n\n              object.dispatchEvent('collision', object2, _temp1, _temp2, _temp_vector3_1);\n            }\n          }\n        }\n\n      }\n      else {\n\n        // not touching other objects\n        object._physijs.touches.length = 0;\n\n      }\n\n    }\n\n    this.collisions = collisions;\n\n    if (SUPPORT_TRANSFERABLE) {\n      // Give the typed array back to the worker\n      this._worker.transferableMessage(data.buffer, [data.buffer]);\n    }\n  };\n\n  Physijs.Scene.prototype.addConstraint = function(constraint, show_marker) {\n    this._constraints[constraint.id] = constraint;\n    this.execute('addConstraint', constraint.getDefinition());\n\n    if (show_marker) {\n      var marker;\n\n      switch (constraint.type) {\n        case 'point':\n          marker = new THREE.Mesh(\n            new THREE.SphereGeometry(1.5),\n            new THREE.MeshNormalMaterial\n          );\n          marker.position.copy(constraint.positiona);\n          this._objects[constraint.objecta].add(marker);\n          break;\n\n        case 'hinge':\n          marker = new THREE.Mesh(\n            new THREE.SphereGeometry(1.5),\n            new THREE.MeshNormalMaterial\n          );\n          marker.position.copy(constraint.positiona);\n          this._objects[constraint.objecta].add(marker);\n          break;\n\n        case 'slider':\n          marker = new THREE.Mesh(\n            new THREE.BoxGeometry(10, 1, 1),\n            new THREE.MeshNormalMaterial\n          );\n          marker.position.copy(constraint.positiona);\n          // This rotation isn't right if all three axis are non-0 values\n          // TODO: change marker's rotation order to ZYX\n          marker.rotation.set(\n            constraint.axis.y, // yes, y and\n            constraint.axis.x, // x axis are swapped\n            constraint.axis.z\n          );\n          this._objects[constraint.objecta].add(marker);\n          break;\n\n        case 'conetwist':\n          marker = new THREE.Mesh(\n            new THREE.SphereGeometry(1.5),\n            new THREE.MeshNormalMaterial\n          );\n          marker.position.copy(constraint.positiona);\n          this._objects[constraint.objecta].add(marker);\n          break;\n\n        case 'dof':\n          marker = new THREE.Mesh(\n            new THREE.SphereGeometry(1.5),\n            new THREE.MeshNormalMaterial\n          );\n          marker.position.copy(constraint.positiona);\n          this._objects[constraint.objecta].add(marker);\n          break;\n      }\n    }\n\n    return constraint;\n  };\n\n  Physijs.Scene.prototype.onSimulationResume = function() {\n    this.execute('onSimulationResume', {});\n  };\n\n  Physijs.Scene.prototype.removeConstraint = function(constraint) {\n    if (this._constraints[constraint.id] !== undefined) {\n      this.execute('removeConstraint', {\n        id: constraint.id\n      });\n      delete this._constraints[constraint.id];\n    }\n  };\n\n  Physijs.Scene.prototype.execute = function(cmd, params) {\n    this._worker.postMessage({\n      cmd: cmd,\n      params: params\n    });\n  };\n\n  addObjectChildren = function(parent, object) {\n    var i;\n\n    for (i = 0; i < object.children.length; i++) {\n      if (object.children[i]._physijs) {\n        object.children[i].updateMatrix();\n        object.children[i].updateMatrixWorld();\n\n        _temp_vector3_1.setFromMatrixPosition(object.children[i].matrixWorld);\n        _quaternion_1.setFromRotationMatrix(object.children[i].matrixWorld);\n\n        object.children[i]._physijs.position_offset = {\n          x: _temp_vector3_1.x,\n          y: _temp_vector3_1.y,\n          z: _temp_vector3_1.z\n        };\n\n        object.children[i]._physijs.rotation = {\n          x: _quaternion_1.x,\n          y: _quaternion_1.y,\n          z: _quaternion_1.z,\n          w: _quaternion_1.w\n        };\n\n        parent._physijs.children.push(object.children[i]._physijs);\n      }\n\n      addObjectChildren(parent, object.children[i]);\n    }\n  };\n\n  Physijs.Scene.prototype.add = function(object) {\n    THREE.Mesh.prototype.add.call(this, object);\n\n    if (object._physijs) {\n\n      object.world = this;\n\n      if (object instanceof Physijs.Vehicle) {\n\n        this.add(object.mesh);\n        this._vehicles[object._physijs.id] = object;\n        this.execute('addVehicle', object._physijs);\n\n      }\n      else {\n\n        object.__dirtyPosition = false;\n        object.__dirtyRotation = false;\n        this._objects[object._physijs.id] = object;\n\n        if (object.children.length) {\n          object._physijs.children = [];\n          addObjectChildren(object, object);\n        }\n\n        if (object.material._physijs) {\n          if (!this._materials_ref_counts.hasOwnProperty(object.material._physijs.id)) {\n            this.execute('registerMaterial', object.material._physijs);\n            object._physijs.materialId = object.material._physijs.id;\n            this._materials_ref_counts[object.material._physijs.id] = 1;\n          }\n          else {\n            this._materials_ref_counts[object.material._physijs.id]++;\n          }\n        }\n\n        // Object starting position + rotation\n        object._physijs.position = {\n          x: object.position.x,\n          y: object.position.y,\n          z: object.position.z\n        };\n        object._physijs.rotation = {\n          x: object.quaternion.x,\n          y: object.quaternion.y,\n          z: object.quaternion.z,\n          w: object.quaternion.w\n        };\n\n        // Check for scaling\n        var mass_scaling = new THREE.Vector3(1, 1, 1);\n        if (object._physijs.width) {\n          object._physijs.width *= object.scale.x;\n        }\n        if (object._physijs.height) {\n          object._physijs.height *= object.scale.y;\n        }\n        if (object._physijs.depth) {\n          object._physijs.depth *= object.scale.z;\n        }\n\n        this.execute('addObject', object._physijs);\n\n      }\n    }\n  };\n\n  Physijs.Scene.prototype.remove = function(object) {\n    if (object instanceof Physijs.Vehicle) {\n      this.execute('removeVehicle', {\n        id: object._physijs.id\n      });\n      while (object.wheels.length) {\n        this.remove(object.wheels.pop());\n      }\n      this.remove(object.mesh);\n      delete this._vehicles[object._physijs.id];\n    }\n    else {\n      THREE.Mesh.prototype.remove.call(this, object);\n      if (object._physijs) {\n        delete this._objects[object._physijs.id];\n        this.execute('removeObject', {\n          id: object._physijs.id\n        });\n      }\n    }\n    if (object.material && object.material._physijs && this._materials_ref_counts.hasOwnProperty(object.material._physijs.id)) {\n      this._materials_ref_counts[object.material._physijs.id]--;\n      if (this._materials_ref_counts[object.material._physijs.id] == 0) {\n        this.execute('unRegisterMaterial', object.material._physijs);\n        delete this._materials_ref_counts[object.material._physijs.id];\n      }\n    }\n  };\n\n  Physijs.Scene.prototype.setFixedTimeStep = function(fixedTimeStep) {\n    if (fixedTimeStep) {\n      this.execute('setFixedTimeStep', fixedTimeStep);\n    }\n  };\n\n  Physijs.Scene.prototype.setGravity = function(gravity) {\n    if (gravity) {\n      this.execute('setGravity', gravity);\n    }\n  };\n\n  Physijs.Scene.prototype.simulate = function(timeStep, maxSubSteps) {\n    var object_id, object, update;\n\n    if (_is_simulating) {\n      return false;\n    }\n\n    _is_simulating = true;\n\n    for (object_id in this._objects) {\n      if (!this._objects.hasOwnProperty(object_id)) continue;\n\n      object = this._objects[object_id];\n\n      if (object.__dirtyPosition || object.__dirtyRotation) {\n        update = {\n          id: object._physijs.id\n        };\n\n        if (object.__dirtyPosition) {\n          update.pos = {\n            x: object.position.x,\n            y: object.position.y,\n            z: object.position.z\n          };\n          object.__dirtyPosition = false;\n        }\n\n        if (object.__dirtyRotation) {\n          update.quat = {\n            x: object.quaternion.x,\n            y: object.quaternion.y,\n            z: object.quaternion.z,\n            w: object.quaternion.w\n          };\n          object.__dirtyRotation = false;\n        }\n\n        this.execute('updateTransform', update);\n      }\n    }\n\n    this.execute('simulate', {\n      timeStep: timeStep,\n      maxSubSteps: maxSubSteps\n    });\n\n    return true;\n  };\n\n\n  // Phsijs.Mesh\n  Physijs.Mesh = function(geometry, material, mass) {\n    var index;\n\n    if (!geometry) {\n      return;\n    }\n\n    Eventable.call(this);\n    THREE.Mesh.call(this, geometry, material);\n\n    if (!geometry.boundingBox) {\n      geometry.computeBoundingBox();\n    }\n\n    this._physijs = {\n      type: null,\n      id: getObjectId(),\n      mass: mass || 0,\n      touches: [],\n      linearVelocity: new THREE.Vector3,\n      angularVelocity: new THREE.Vector3\n    };\n  };\n  Physijs.Mesh.prototype = new THREE.Mesh;\n  Physijs.Mesh.prototype.constructor = Physijs.Mesh;\n  Eventable.make(Physijs.Mesh);\n\n  // Physijs.Mesh.mass\n  Physijs.Mesh.prototype.__defineGetter__('mass', function() {\n    return this._physijs.mass;\n  });\n  Physijs.Mesh.prototype.__defineSetter__('mass', function(mass) {\n    this._physijs.mass = mass;\n    if (this.world) {\n      this.world.execute('updateMass', {\n        id: this._physijs.id,\n        mass: mass\n      });\n    }\n  });\n\n  // Physijs.Mesh.applyCentralImpulse\n  Physijs.Mesh.prototype.applyCentralImpulse = function(force) {\n    if (this.world) {\n      this.world.execute('applyCentralImpulse', {\n        id: this._physijs.id,\n        x: force.x,\n        y: force.y,\n        z: force.z\n      });\n    }\n  };\n\n  // Physijs.Mesh.applyImpulse\n  Physijs.Mesh.prototype.applyImpulse = function(force, offset) {\n    if (this.world) {\n      this.world.execute('applyImpulse', {\n        id: this._physijs.id,\n        impulse_x: force.x,\n        impulse_y: force.y,\n        impulse_z: force.z,\n        x: offset.x,\n        y: offset.y,\n        z: offset.z\n      });\n    }\n  };\n\n  // Physijs.Mesh.applyTorque\n  Physijs.Mesh.prototype.applyTorque = function(force) {\n    if (this.world) {\n      this.world.execute('applyTorque', {\n        id: this._physijs.id,\n        torque_x: force.x,\n        torque_y: force.y,\n        torque_z: force.z\n      });\n    }\n  };\n\n  // Physijs.Mesh.applyCentralForce\n  Physijs.Mesh.prototype.applyCentralForce = function(force) {\n    if (this.world) {\n      this.world.execute('applyCentralForce', {\n        id: this._physijs.id,\n        x: force.x,\n        y: force.y,\n        z: force.z\n      });\n    }\n  };\n\n  // Physijs.Mesh.applyForce\n  Physijs.Mesh.prototype.applyForce = function(force, offset) {\n    if (this.world) {\n      this.world.execute('applyForce', {\n        id: this._physijs.id,\n        force_x: force.x,\n        force_y: force.y,\n        force_z: force.z,\n        x: offset.x,\n        y: offset.y,\n        z: offset.z\n      });\n    }\n  };\n\n  // Physijs.Mesh.getAngularVelocity\n  Physijs.Mesh.prototype.getAngularVelocity = function() {\n    return this._physijs.angularVelocity;\n  };\n\n  // Physijs.Mesh.setAngularVelocity\n  Physijs.Mesh.prototype.setAngularVelocity = function(velocity) {\n    if (this.world) {\n      this.world.execute('setAngularVelocity', {\n        id: this._physijs.id,\n        x: velocity.x,\n        y: velocity.y,\n        z: velocity.z\n      });\n    }\n  };\n\n  // Physijs.Mesh.getLinearVelocity\n  Physijs.Mesh.prototype.getLinearVelocity = function() {\n    return this._physijs.linearVelocity;\n  };\n\n  // Physijs.Mesh.setLinearVelocity\n  Physijs.Mesh.prototype.setLinearVelocity = function(velocity) {\n    if (this.world) {\n      this.world.execute('setLinearVelocity', {\n        id: this._physijs.id,\n        x: velocity.x,\n        y: velocity.y,\n        z: velocity.z\n      });\n    }\n  };\n\n  // Physijs.Mesh.setAngularFactor\n  Physijs.Mesh.prototype.setAngularFactor = function(factor) {\n    if (this.world) {\n      this.world.execute('setAngularFactor', {\n        id: this._physijs.id,\n        x: factor.x,\n        y: factor.y,\n        z: factor.z\n      });\n    }\n  };\n\n  // Physijs.Mesh.setLinearFactor\n  Physijs.Mesh.prototype.setLinearFactor = function(factor) {\n    if (this.world) {\n      this.world.execute('setLinearFactor', {\n        id: this._physijs.id,\n        x: factor.x,\n        y: factor.y,\n        z: factor.z\n      });\n    }\n  };\n\n  // Physijs.Mesh.setDamping\n  Physijs.Mesh.prototype.setDamping = function(linear, angular) {\n    if (this.world) {\n      this.world.execute('setDamping', {\n        id: this._physijs.id,\n        linear: linear,\n        angular: angular\n      });\n    }\n  };\n\n  // Physijs.Mesh.setCcdMotionThreshold\n  Physijs.Mesh.prototype.setCcdMotionThreshold = function(threshold) {\n    if (this.world) {\n      this.world.execute('setCcdMotionThreshold', {\n        id: this._physijs.id,\n        threshold: threshold\n      });\n    }\n  };\n\n  // Physijs.Mesh.setCcdSweptSphereRadius\n  Physijs.Mesh.prototype.setCcdSweptSphereRadius = function(radius) {\n    if (this.world) {\n      this.world.execute('setCcdSweptSphereRadius', {\n        id: this._physijs.id,\n        radius: radius\n      });\n    }\n  };\n\n\n  // Physijs.PlaneMesh\n  Physijs.PlaneMesh = function(geometry, material, mass) {\n    var width, height;\n\n    Physijs.Mesh.call(this, geometry, material, mass);\n\n    if (!geometry.boundingBox) {\n      geometry.computeBoundingBox();\n    }\n\n    width = geometry.boundingBox.max.x - geometry.boundingBox.min.x;\n    height = geometry.boundingBox.max.y - geometry.boundingBox.min.y;\n\n    this._physijs.type = 'plane';\n    this._physijs.normal = geometry.faces[0].normal.clone();\n    this._physijs.mass = (typeof mass === 'undefined') ? width * height : mass;\n  };\n  Physijs.PlaneMesh.prototype = new Physijs.Mesh;\n  Physijs.PlaneMesh.prototype.constructor = Physijs.PlaneMesh;\n\n  // Physijs.HeightfieldMesh\n  Physijs.HeightfieldMesh = function(geometry, material, mass, xdiv, ydiv) {\n    Physijs.Mesh.call(this, geometry, material, mass);\n\n    this._physijs.type = 'heightfield';\n    this._physijs.xsize = geometry.boundingBox.max.x - geometry.boundingBox.min.x;\n    this._physijs.ysize = geometry.boundingBox.max.y - geometry.boundingBox.min.y;\n    this._physijs.xpts = (typeof xdiv === 'undefined') ? Math.sqrt(geometry.vertices.length) : xdiv + 1;\n    this._physijs.ypts = (typeof ydiv === 'undefined') ? Math.sqrt(geometry.vertices.length) : ydiv + 1;\n    // note - this assumes our plane geometry is square, unless we pass in specific xdiv and ydiv\n    this._physijs.absMaxHeight = Math.max(geometry.boundingBox.max.z, Math.abs(geometry.boundingBox.min.z));\n\n    var points = [];\n\n    var a, b;\n    for (var i = 0; i < geometry.vertices.length; i++) {\n\n      a = i % this._physijs.xpts;\n      b = Math.round((i / this._physijs.xpts) - ((i % this._physijs.xpts) / this._physijs.xpts));\n      points[i] = geometry.vertices[a + ((this._physijs.ypts - b - 1) * this._physijs.ypts)].z;\n\n      //points[i] = geometry.vertices[i];\n    }\n\n    this._physijs.points = points;\n  };\n  Physijs.HeightfieldMesh.prototype = new Physijs.Mesh;\n  Physijs.HeightfieldMesh.prototype.constructor = Physijs.HeightfieldMesh;\n\n  // Physijs.BoxMesh\n  Physijs.BoxMesh = function(geometry, material, mass) {\n    var width, height, depth;\n\n    Physijs.Mesh.call(this, geometry, material, mass);\n\n    if (!geometry.boundingBox) {\n      geometry.computeBoundingBox();\n    }\n\n    width = geometry.boundingBox.max.x - geometry.boundingBox.min.x;\n    height = geometry.boundingBox.max.y - geometry.boundingBox.min.y;\n    depth = geometry.boundingBox.max.z - geometry.boundingBox.min.z;\n\n    this._physijs.type = 'box';\n    this._physijs.width = width;\n    this._physijs.height = height;\n    this._physijs.depth = depth;\n    this._physijs.mass = (typeof mass === 'undefined') ? width * height * depth : mass;\n  };\n  Physijs.BoxMesh.prototype = new Physijs.Mesh;\n  Physijs.BoxMesh.prototype.constructor = Physijs.BoxMesh;\n\n\n  // Physijs.SphereMesh\n  Physijs.SphereMesh = function(geometry, material, mass) {\n    Physijs.Mesh.call(this, geometry, material, mass);\n\n    if (!geometry.boundingSphere) {\n      geometry.computeBoundingSphere();\n    }\n\n    this._physijs.type = 'sphere';\n    this._physijs.radius = geometry.boundingSphere.radius;\n    this._physijs.mass = (typeof mass === 'undefined') ? (4 / 3) * Math.PI * Math.pow(this._physijs.radius, 3) : mass;\n  };\n  Physijs.SphereMesh.prototype = new Physijs.Mesh;\n  Physijs.SphereMesh.prototype.constructor = Physijs.SphereMesh;\n\n\n  // Physijs.CylinderMesh\n  Physijs.CylinderMesh = function(geometry, material, mass) {\n    var width, height, depth;\n\n    Physijs.Mesh.call(this, geometry, material, mass);\n\n    if (!geometry.boundingBox) {\n      geometry.computeBoundingBox();\n    }\n\n    width = geometry.boundingBox.max.x - geometry.boundingBox.min.x;\n    height = geometry.boundingBox.max.y - geometry.boundingBox.min.y;\n    depth = geometry.boundingBox.max.z - geometry.boundingBox.min.z;\n\n    this._physijs.type = 'cylinder';\n    this._physijs.width = width;\n    this._physijs.height = height;\n    this._physijs.depth = depth;\n    this._physijs.mass = (typeof mass === 'undefined') ? width * height * depth : mass;\n  };\n  Physijs.CylinderMesh.prototype = new Physijs.Mesh;\n  Physijs.CylinderMesh.prototype.constructor = Physijs.CylinderMesh;\n\n\n  // Physijs.CapsuleMesh\n  Physijs.CapsuleMesh = function(geometry, material, mass) {\n    var width, height, depth;\n\n    Physijs.Mesh.call(this, geometry, material, mass);\n\n    if (!geometry.boundingBox) {\n      geometry.computeBoundingBox();\n    }\n\n    width = geometry.boundingBox.max.x - geometry.boundingBox.min.x;\n    height = geometry.boundingBox.max.y - geometry.boundingBox.min.y;\n    depth = geometry.boundingBox.max.z - geometry.boundingBox.min.z;\n\n    this._physijs.type = 'capsule';\n    this._physijs.radius = Math.max(width / 2, depth / 2);\n    this._physijs.height = height;\n    this._physijs.mass = (typeof mass === 'undefined') ? width * height * depth : mass;\n  };\n  Physijs.CapsuleMesh.prototype = new Physijs.Mesh;\n  Physijs.CapsuleMesh.prototype.constructor = Physijs.CapsuleMesh;\n\n\n  // Physijs.ConeMesh\n  Physijs.ConeMesh = function(geometry, material, mass) {\n    var width, height, depth;\n\n    Physijs.Mesh.call(this, geometry, material, mass);\n\n    if (!geometry.boundingBox) {\n      geometry.computeBoundingBox();\n    }\n\n    width = geometry.boundingBox.max.x - geometry.boundingBox.min.x;\n    height = geometry.boundingBox.max.y - geometry.boundingBox.min.y;\n\n    this._physijs.type = 'cone';\n    this._physijs.radius = width / 2;\n    this._physijs.height = height;\n    this._physijs.mass = (typeof mass === 'undefined') ? width * height : mass;\n  };\n  Physijs.ConeMesh.prototype = new Physijs.Mesh;\n  Physijs.ConeMesh.prototype.constructor = Physijs.ConeMesh;\n\n\n  // Physijs.ConcaveMesh\n  Physijs.ConcaveMesh = function(geometry, material, mass) {\n    var i,\n      width, height, depth,\n      vertices, face, triangles = [];\n\n    Physijs.Mesh.call(this, geometry, material, mass);\n\n    if (!geometry.boundingBox) {\n      geometry.computeBoundingBox();\n    }\n\n    vertices = geometry.vertices;\n\n    for (i = 0; i < geometry.faces.length; i++) {\n      face = geometry.faces[i];\n      if (face instanceof THREE.Face3) {\n\n        triangles.push([{\n          x: vertices[face.a].x,\n          y: vertices[face.a].y,\n          z: vertices[face.a].z\n        }, {\n          x: vertices[face.b].x,\n          y: vertices[face.b].y,\n          z: vertices[face.b].z\n        }, {\n          x: vertices[face.c].x,\n          y: vertices[face.c].y,\n          z: vertices[face.c].z\n        }]);\n\n      }\n      else if (face instanceof THREE.Face4) {\n\n        triangles.push([{\n          x: vertices[face.a].x,\n          y: vertices[face.a].y,\n          z: vertices[face.a].z\n        }, {\n          x: vertices[face.b].x,\n          y: vertices[face.b].y,\n          z: vertices[face.b].z\n        }, {\n          x: vertices[face.d].x,\n          y: vertices[face.d].y,\n          z: vertices[face.d].z\n        }]);\n        triangles.push([{\n          x: vertices[face.b].x,\n          y: vertices[face.b].y,\n          z: vertices[face.b].z\n        }, {\n          x: vertices[face.c].x,\n          y: vertices[face.c].y,\n          z: vertices[face.c].z\n        }, {\n          x: vertices[face.d].x,\n          y: vertices[face.d].y,\n          z: vertices[face.d].z\n        }]);\n\n      }\n    }\n\n    width = geometry.boundingBox.max.x - geometry.boundingBox.min.x;\n    height = geometry.boundingBox.max.y - geometry.boundingBox.min.y;\n    depth = geometry.boundingBox.max.z - geometry.boundingBox.min.z;\n\n    this._physijs.type = 'concave';\n    this._physijs.triangles = triangles;\n    this._physijs.mass = (typeof mass === 'undefined') ? width * height * depth : mass;\n  };\n  Physijs.ConcaveMesh.prototype = new Physijs.Mesh;\n  Physijs.ConcaveMesh.prototype.constructor = Physijs.ConcaveMesh;\n\n\n  // Physijs.ConvexMesh\n  Physijs.ConvexMesh = function(geometry, material, mass) {\n    var i,\n      width, height, depth,\n      points = [];\n\n    Physijs.Mesh.call(this, geometry, material, mass);\n\n    if (!geometry.boundingBox) {\n      geometry.computeBoundingBox();\n    }\n\n    for (i = 0; i < geometry.vertices.length; i++) {\n      points.push({\n        x: geometry.vertices[i].x,\n        y: geometry.vertices[i].y,\n        z: geometry.vertices[i].z\n      });\n    }\n\n\n    width = geometry.boundingBox.max.x - geometry.boundingBox.min.x;\n    height = geometry.boundingBox.max.y - geometry.boundingBox.min.y;\n    depth = geometry.boundingBox.max.z - geometry.boundingBox.min.z;\n\n    this._physijs.type = 'convex';\n    this._physijs.points = points;\n    this._physijs.mass = (typeof mass === 'undefined') ? width * height * depth : mass;\n  };\n  Physijs.ConvexMesh.prototype = new Physijs.Mesh;\n  Physijs.ConvexMesh.prototype.constructor = Physijs.ConvexMesh;\n\n\n  // Physijs.Vehicle\n  Physijs.Vehicle = function(mesh, tuning) {\n    tuning = tuning || new Physijs.VehicleTuning;\n    this.mesh = mesh;\n    this.wheels = [];\n    this._physijs = {\n      id: getObjectId(),\n      rigidBody: mesh._physijs.id,\n      suspension_stiffness: tuning.suspension_stiffness,\n      suspension_compression: tuning.suspension_compression,\n      suspension_damping: tuning.suspension_damping,\n      max_suspension_travel: tuning.max_suspension_travel,\n      friction_slip: tuning.friction_slip,\n      max_suspension_force: tuning.max_suspension_force\n    };\n  };\n  Physijs.Vehicle.prototype.addWheel = function(wheel_geometry, wheel_material, connection_point, wheel_direction, wheel_axle, suspension_rest_length, wheel_radius, is_front_wheel, tuning) {\n    var wheel = new THREE.Mesh(wheel_geometry, wheel_material);\n    wheel.castShadow = wheel.receiveShadow = true;\n    wheel.position.copy(wheel_direction).multiplyScalar(suspension_rest_length / 100).add(connection_point);\n    this.world.add(wheel);\n    this.wheels.push(wheel);\n\n    this.world.execute('addWheel', {\n      id: this._physijs.id,\n      connection_point: {\n        x: connection_point.x,\n        y: connection_point.y,\n        z: connection_point.z\n      },\n      wheel_direction: {\n        x: wheel_direction.x,\n        y: wheel_direction.y,\n        z: wheel_direction.z\n      },\n      wheel_axle: {\n        x: wheel_axle.x,\n        y: wheel_axle.y,\n        z: wheel_axle.z\n      },\n      suspension_rest_length: suspension_rest_length,\n      wheel_radius: wheel_radius,\n      is_front_wheel: is_front_wheel,\n      tuning: tuning\n    });\n  };\n  Physijs.Vehicle.prototype.setSteering = function(amount, wheel) {\n    if (wheel !== undefined && this.wheels[wheel] !== undefined) {\n      this.world.execute('setSteering', {\n        id: this._physijs.id,\n        wheel: wheel,\n        steering: amount\n      });\n    }\n    else if (this.wheels.length > 0) {\n      for (var i = 0; i < this.wheels.length; i++) {\n        this.world.execute('setSteering', {\n          id: this._physijs.id,\n          wheel: i,\n          steering: amount\n        });\n      }\n    }\n  };\n  Physijs.Vehicle.prototype.setBrake = function(amount, wheel) {\n    if (wheel !== undefined && this.wheels[wheel] !== undefined) {\n      this.world.execute('setBrake', {\n        id: this._physijs.id,\n        wheel: wheel,\n        brake: amount\n      });\n    }\n    else if (this.wheels.length > 0) {\n      for (var i = 0; i < this.wheels.length; i++) {\n        this.world.execute('setBrake', {\n          id: this._physijs.id,\n          wheel: i,\n          brake: amount\n        });\n      }\n    }\n  };\n  Physijs.Vehicle.prototype.applyEngineForce = function(amount, wheel) {\n    if (wheel !== undefined && this.wheels[wheel] !== undefined) {\n      this.world.execute('applyEngineForce', {\n        id: this._physijs.id,\n        wheel: wheel,\n        force: amount\n      });\n    }\n    else if (this.wheels.length > 0) {\n      for (var i = 0; i < this.wheels.length; i++) {\n        this.world.execute('applyEngineForce', {\n          id: this._physijs.id,\n          wheel: i,\n          force: amount\n        });\n      }\n    }\n  };\n\n  // Physijs.VehicleTuning\n  Physijs.VehicleTuning = function(suspension_stiffness, suspension_compression, suspension_damping, max_suspension_travel, friction_slip, max_suspension_force) {\n    this.suspension_stiffness = suspension_stiffness !== undefined ? suspension_stiffness : 5.88;\n    this.suspension_compression = suspension_compression !== undefined ? suspension_compression : 0.83;\n    this.suspension_damping = suspension_damping !== undefined ? suspension_damping : 0.88;\n    this.max_suspension_travel = max_suspension_travel !== undefined ? max_suspension_travel : 500;\n    this.friction_slip = friction_slip !== undefined ? friction_slip : 10.5;\n    this.max_suspension_force = max_suspension_force !== undefined ? max_suspension_force : 6000;\n  };\n\n  return Physijs;\n}\n\n","/** @preserve http://github.com/easeway/js-class */\n\n// Class Definition using ECMA5 prototype chain\n\nfunction inherit(dest, src, noParent) {\n    while (src && src !== Object.prototype) {\n        Object.getOwnPropertyNames(src).forEach(function (name) {\n            if (name != '.class' && !dest.hasOwnProperty(name)) {\n                var desc = Object.getOwnPropertyDescriptor(src, name);\n                Object.defineProperty(dest, name, desc);\n            }\n        });\n        if (noParent) {\n            break;\n        }\n        src = src.__proto__;\n    }\n    return dest;\n}\n\nvar Class = function (base, proto, options) {\n    if (typeof(base) != 'function') {\n        options = proto;\n        proto = base;\n        base = Object;\n    }\n    if (!proto) {\n        proto = {};\n    }\n    if (!options) {\n        options = {};\n    }\n    \n    var meta = {\n        name: options.name,\n        base: base,\n        implements: []\n    }\n    var classProto = Class.clone(proto);\n    if (options.implements) {\n        (Array.isArray(options.implements) ? options.implements : [options.implements])\n            .forEach(function (implementedType) {\n                if (typeof(implementedType) == 'function' && implementedType.prototype) {\n                    meta.implements.push(implementedType);\n                    Class.extend(classProto, implementedType.prototype);\n                }\n            });\n    }\n    classProto.__proto__ = base.prototype;\n    var theClass = function () {\n        if (typeof(this.constructor) == 'function') {\n            this.constructor.apply(this, arguments);\n        }\n    };\n    meta.type = theClass;\n    theClass.prototype = classProto;\n    Object.defineProperty(theClass, '.class.meta', { value: meta, enumerable: false, configurable: false, writable: false });\n    Object.defineProperty(classProto, '.class', { value: theClass, enumerable: false, configurable: false, writable: false });\n    if (options.statics) {\n        Class.extend(theClass, options.statics);\n    }\n    return theClass;\n};\n\nClass.extend = inherit;\n\nClass.clone = function (object) {\n    return inherit({}, object);\n};\n\nfunction findType(meta, type) {\n    while (meta) {\n        if (meta.type.prototype === type.prototype) {\n            return true;\n        }\n        for (var i in meta.implements) {\n            var implType = meta.implements[i];\n            var implMeta = implType['.class.meta'];\n            if (implMeta) {\n                if (findType(implMeta, type)) {\n                    return true;\n                }\n            } else {\n                for (var proto = implType.prototype; proto; proto = proto.__proto__) {\n                    if (proto === type.prototype) {\n                        return true;\n                    }\n                }\n            }\n        }\n        meta = meta.base ? meta.base['.class.meta'] : undefined;\n    }\n    return false;\n}\n\nvar Checker = Class({\n    constructor: function (object) {\n        this.object = object;\n    },\n    \n    typeOf: function (type) {\n        if (this.object instanceof type) {\n            return true;\n        }\n        var meta = Class.typeInfo(this.object);\n        return meta && findType(meta, type);\n    }\n});\n\n// aliases\nChecker.prototype.a = Checker.prototype.typeOf;\nChecker.prototype.an = Checker.prototype.typeOf;\n\nClass.is = function (object) {\n    return new Checker(object);\n};\n\nClass.typeInfo = function (object) {\n    var theClass = object.__proto__['.class'];\n    return theClass ? theClass['.class.meta'] : undefined;\n};\n\nClass.VERSION = [0, 0, 2];\n\nif (module) {\n    module.exports = Class;\n} else {\n    global.Class = Class;   // for browser\n}","/**\n * @author mrdoob / http://mrdoob.com/\n */\n\nvar Stats = function () {\n\n\tvar startTime = Date.now(), prevTime = startTime;\n\tvar ms = 0, msMin = Infinity, msMax = 0;\n\tvar fps = 0, fpsMin = Infinity, fpsMax = 0;\n\tvar frames = 0, mode = 0;\n\n\tvar container = document.createElement( 'div' );\n\tcontainer.id = 'stats';\n\tcontainer.addEventListener( 'mousedown', function ( event ) { event.preventDefault(); setMode( ++ mode % 2 ) }, false );\n\tcontainer.style.cssText = 'width:80px;opacity:0.9;cursor:pointer';\n\n\tvar fpsDiv = document.createElement( 'div' );\n\tfpsDiv.id = 'fps';\n\tfpsDiv.style.cssText = 'padding:0 0 3px 3px;text-align:left;background-color:#002';\n\tcontainer.appendChild( fpsDiv );\n\n\tvar fpsText = document.createElement( 'div' );\n\tfpsText.id = 'fpsText';\n\tfpsText.style.cssText = 'color:#0ff;font-family:Helvetica,Arial,sans-serif;font-size:9px;font-weight:bold;line-height:15px';\n\tfpsText.innerHTML = 'FPS';\n\tfpsDiv.appendChild( fpsText );\n\n\tvar fpsGraph = document.createElement( 'div' );\n\tfpsGraph.id = 'fpsGraph';\n\tfpsGraph.style.cssText = 'position:relative;width:74px;height:30px;background-color:#0ff';\n\tfpsDiv.appendChild( fpsGraph );\n\n\twhile ( fpsGraph.children.length < 74 ) {\n\n\t\tvar bar = document.createElement( 'span' );\n\t\tbar.style.cssText = 'width:1px;height:30px;float:left;background-color:#113';\n\t\tfpsGraph.appendChild( bar );\n\n\t}\n\n\tvar msDiv = document.createElement( 'div' );\n\tmsDiv.id = 'ms';\n\tmsDiv.style.cssText = 'padding:0 0 3px 3px;text-align:left;background-color:#020;display:none';\n\tcontainer.appendChild( msDiv );\n\n\tvar msText = document.createElement( 'div' );\n\tmsText.id = 'msText';\n\tmsText.style.cssText = 'color:#0f0;font-family:Helvetica,Arial,sans-serif;font-size:9px;font-weight:bold;line-height:15px';\n\tmsText.innerHTML = 'MS';\n\tmsDiv.appendChild( msText );\n\n\tvar msGraph = document.createElement( 'div' );\n\tmsGraph.id = 'msGraph';\n\tmsGraph.style.cssText = 'position:relative;width:74px;height:30px;background-color:#0f0';\n\tmsDiv.appendChild( msGraph );\n\n\twhile ( msGraph.children.length < 74 ) {\n\n\t\tvar bar = document.createElement( 'span' );\n\t\tbar.style.cssText = 'width:1px;height:30px;float:left;background-color:#131';\n\t\tmsGraph.appendChild( bar );\n\n\t}\n\n\tvar setMode = function ( value ) {\n\n\t\tmode = value;\n\n\t\tswitch ( mode ) {\n\n\t\t\tcase 0:\n\t\t\t\tfpsDiv.style.display = 'block';\n\t\t\t\tmsDiv.style.display = 'none';\n\t\t\t\tbreak;\n\t\t\tcase 1:\n\t\t\t\tfpsDiv.style.display = 'none';\n\t\t\t\tmsDiv.style.display = 'block';\n\t\t\t\tbreak;\n\t\t}\n\n\t};\n\n\tvar updateGraph = function ( dom, value ) {\n\n\t\tvar child = dom.appendChild( dom.firstChild );\n\t\tchild.style.height = value + 'px';\n\n\t};\n\n\treturn {\n\n\t\tREVISION: 12,\n\n\t\tdomElement: container,\n\n\t\tsetMode: setMode,\n\n\t\tbegin: function () {\n\n\t\t\tstartTime = Date.now();\n\n\t\t},\n\n\t\tend: function () {\n\n\t\t\tvar time = Date.now();\n\n\t\t\tms = time - startTime;\n\t\t\tmsMin = Math.min( msMin, ms );\n\t\t\tmsMax = Math.max( msMax, ms );\n\n\t\t\tmsText.textContent = ms + ' MS (' + msMin + '-' + msMax + ')';\n\t\t\tupdateGraph( msGraph, Math.min( 30, 30 - ( ms / 200 ) * 30 ) );\n\n\t\t\tframes ++;\n\n\t\t\tif ( time > prevTime + 1000 ) {\n\n\t\t\t\tfps = Math.round( ( frames * 1000 ) / ( time - prevTime ) );\n\t\t\t\tfpsMin = Math.min( fpsMin, fps );\n\t\t\t\tfpsMax = Math.max( fpsMax, fps );\n\n\t\t\t\tfpsText.textContent = fps + ' FPS (' + fpsMin + '-' + fpsMax + ')';\n\t\t\t\tupdateGraph( fpsGraph, Math.min( 30, 30 - ( fps / 100 ) * 30 ) );\n\n\t\t\t\tprevTime = time;\n\t\t\t\tframes = 0;\n\n\t\t\t}\n\n\t\t\treturn time;\n\n\t\t},\n\n\t\tupdate: function () {\n\n\t\t\tstartTime = this.end();\n\n\t\t}\n\n\t}\n\n};\n\nif ( typeof module === 'object' ) {\n\n\tmodule.exports = Stats;\n\n}","var self = self || {}; // File:src/Three.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nvar THREE = {\r\n  REVISION: '71'\r\n};\r\n\r\n// browserify support\r\n\r\nif (typeof module === 'object') {\r\n\r\n  module.exports = THREE;\r\n\r\n}\r\n\r\n// polyfills\r\n\r\nif (Math.sign === undefined) {\r\n\r\n  // https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Math/sign\r\n\r\n  Math.sign = function(x) {\r\n\r\n    return (x < 0) ? -1 : (x > 0) ? 1 : +x;\r\n\r\n  };\r\n\r\n}\r\n\r\n\r\n// set the default log handlers\r\nTHREE.log = function() {\r\n  console.log.apply(console, arguments);\r\n}\r\nTHREE.warn = function() {\r\n  console.warn.apply(console, arguments);\r\n}\r\nTHREE.error = function() {\r\n  console.error.apply(console, arguments);\r\n}\r\n\r\n\r\n// https://developer.mozilla.org/en-US/docs/Web/API/MouseEvent.button\r\n\r\nTHREE.MOUSE = {\r\n  LEFT: 0,\r\n  MIDDLE: 1,\r\n  RIGHT: 2\r\n};\r\n\r\n// GL STATE CONSTANTS\r\n\r\nTHREE.CullFaceNone = 0;\r\nTHREE.CullFaceBack = 1;\r\nTHREE.CullFaceFront = 2;\r\nTHREE.CullFaceFrontBack = 3;\r\n\r\nTHREE.FrontFaceDirectionCW = 0;\r\nTHREE.FrontFaceDirectionCCW = 1;\r\n\r\n// SHADOWING TYPES\r\n\r\nTHREE.BasicShadowMap = 0;\r\nTHREE.PCFShadowMap = 1;\r\nTHREE.PCFSoftShadowMap = 2;\r\n\r\n// MATERIAL CONSTANTS\r\n\r\n// side\r\n\r\nTHREE.FrontSide = 0;\r\nTHREE.BackSide = 1;\r\nTHREE.DoubleSide = 2;\r\n\r\n// shading\r\n\r\nTHREE.NoShading = 0;\r\nTHREE.FlatShading = 1;\r\nTHREE.SmoothShading = 2;\r\n\r\n// colors\r\n\r\nTHREE.NoColors = 0;\r\nTHREE.FaceColors = 1;\r\nTHREE.VertexColors = 2;\r\n\r\n// blending modes\r\n\r\nTHREE.NoBlending = 0;\r\nTHREE.NormalBlending = 1;\r\nTHREE.AdditiveBlending = 2;\r\nTHREE.SubtractiveBlending = 3;\r\nTHREE.MultiplyBlending = 4;\r\nTHREE.CustomBlending = 5;\r\n\r\n// custom blending equations\r\n// (numbers start from 100 not to clash with other\r\n//  mappings to OpenGL constants defined in Texture.js)\r\n\r\nTHREE.AddEquation = 100;\r\nTHREE.SubtractEquation = 101;\r\nTHREE.ReverseSubtractEquation = 102;\r\nTHREE.MinEquation = 103;\r\nTHREE.MaxEquation = 104;\r\n\r\n// custom blending destination factors\r\n\r\nTHREE.ZeroFactor = 200;\r\nTHREE.OneFactor = 201;\r\nTHREE.SrcColorFactor = 202;\r\nTHREE.OneMinusSrcColorFactor = 203;\r\nTHREE.SrcAlphaFactor = 204;\r\nTHREE.OneMinusSrcAlphaFactor = 205;\r\nTHREE.DstAlphaFactor = 206;\r\nTHREE.OneMinusDstAlphaFactor = 207;\r\n\r\n// custom blending source factors\r\n\r\n//THREE.ZeroFactor = 200;\r\n//THREE.OneFactor = 201;\r\n//THREE.SrcAlphaFactor = 204;\r\n//THREE.OneMinusSrcAlphaFactor = 205;\r\n//THREE.DstAlphaFactor = 206;\r\n//THREE.OneMinusDstAlphaFactor = 207;\r\nTHREE.DstColorFactor = 208;\r\nTHREE.OneMinusDstColorFactor = 209;\r\nTHREE.SrcAlphaSaturateFactor = 210;\r\n\r\n\r\n// TEXTURE CONSTANTS\r\n\r\nTHREE.MultiplyOperation = 0;\r\nTHREE.MixOperation = 1;\r\nTHREE.AddOperation = 2;\r\n\r\n// Mapping modes\r\n\r\nTHREE.UVMapping = 300;\r\n\r\nTHREE.CubeReflectionMapping = 301;\r\nTHREE.CubeRefractionMapping = 302;\r\n\r\nTHREE.EquirectangularReflectionMapping = 303;\r\nTHREE.EquirectangularRefractionMapping = 304;\r\n\r\nTHREE.SphericalReflectionMapping = 305;\r\n\r\n// Wrapping modes\r\n\r\nTHREE.RepeatWrapping = 1000;\r\nTHREE.ClampToEdgeWrapping = 1001;\r\nTHREE.MirroredRepeatWrapping = 1002;\r\n\r\n// Filters\r\n\r\nTHREE.NearestFilter = 1003;\r\nTHREE.NearestMipMapNearestFilter = 1004;\r\nTHREE.NearestMipMapLinearFilter = 1005;\r\nTHREE.LinearFilter = 1006;\r\nTHREE.LinearMipMapNearestFilter = 1007;\r\nTHREE.LinearMipMapLinearFilter = 1008;\r\n\r\n// Data types\r\n\r\nTHREE.UnsignedByteType = 1009;\r\nTHREE.ByteType = 1010;\r\nTHREE.ShortType = 1011;\r\nTHREE.UnsignedShortType = 1012;\r\nTHREE.IntType = 1013;\r\nTHREE.UnsignedIntType = 1014;\r\nTHREE.FloatType = 1015;\r\nTHREE.HalfFloatType = 1025;\r\n\r\n// Pixel types\r\n\r\n//THREE.UnsignedByteType = 1009;\r\nTHREE.UnsignedShort4444Type = 1016;\r\nTHREE.UnsignedShort5551Type = 1017;\r\nTHREE.UnsignedShort565Type = 1018;\r\n\r\n// Pixel formats\r\n\r\nTHREE.AlphaFormat = 1019;\r\nTHREE.RGBFormat = 1020;\r\nTHREE.RGBAFormat = 1021;\r\nTHREE.LuminanceFormat = 1022;\r\nTHREE.LuminanceAlphaFormat = 1023;\r\n// THREE.RGBEFormat handled as THREE.RGBAFormat in shaders\r\nTHREE.RGBEFormat = THREE.RGBAFormat; //1024;\r\n\r\n// DDS / ST3C Compressed texture formats\r\n\r\nTHREE.RGB_S3TC_DXT1_Format = 2001;\r\nTHREE.RGBA_S3TC_DXT1_Format = 2002;\r\nTHREE.RGBA_S3TC_DXT3_Format = 2003;\r\nTHREE.RGBA_S3TC_DXT5_Format = 2004;\r\n\r\n\r\n// PVRTC compressed texture formats\r\n\r\nTHREE.RGB_PVRTC_4BPPV1_Format = 2100;\r\nTHREE.RGB_PVRTC_2BPPV1_Format = 2101;\r\nTHREE.RGBA_PVRTC_4BPPV1_Format = 2102;\r\nTHREE.RGBA_PVRTC_2BPPV1_Format = 2103;\r\n\r\n\r\n// DEPRECATED\r\n\r\nTHREE.Projector = function() {\r\n\r\n  THREE.error('THREE.Projector has been moved to /examples/js/renderers/Projector.js.');\r\n\r\n  this.projectVector = function(vector, camera) {\r\n\r\n    THREE.warn('THREE.Projector: .projectVector() is now vector.project().');\r\n    vector.project(camera);\r\n\r\n  };\r\n\r\n  this.unprojectVector = function(vector, camera) {\r\n\r\n    THREE.warn('THREE.Projector: .unprojectVector() is now vector.unproject().');\r\n    vector.unproject(camera);\r\n\r\n  };\r\n\r\n  this.pickingRay = function(vector, camera) {\r\n\r\n    THREE.error('THREE.Projector: .pickingRay() is now raycaster.setFromCamera().');\r\n\r\n  };\r\n\r\n};\r\n\r\nTHREE.CanvasRenderer = function() {\r\n\r\n  THREE.error('THREE.CanvasRenderer has been moved to /examples/js/renderers/CanvasRenderer.js');\r\n\r\n  this.domElement = document.createElement('canvas');\r\n  this.clear = function() {};\r\n  this.render = function() {};\r\n  this.setClearColor = function() {};\r\n  this.setSize = function() {};\r\n\r\n};\r\n\r\n// File:src/math/Color.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.Color = function(color) {\r\n\r\n  if (arguments.length === 3) {\r\n\r\n    return this.setRGB(arguments[0], arguments[1], arguments[2]);\r\n\r\n  }\r\n\r\n  return this.set(color)\r\n\r\n};\r\n\r\nTHREE.Color.prototype = {\r\n\r\n  constructor: THREE.Color,\r\n\r\n  r: 1,\r\n  g: 1,\r\n  b: 1,\r\n\r\n  set: function(value) {\r\n\r\n    if (value instanceof THREE.Color) {\r\n\r\n      this.copy(value);\r\n\r\n    }\r\n    else if (typeof value === 'number') {\r\n\r\n      this.setHex(value);\r\n\r\n    }\r\n    else if (typeof value === 'string') {\r\n\r\n      this.setStyle(value);\r\n\r\n    }\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  setHex: function(hex) {\r\n\r\n    hex = Math.floor(hex);\r\n\r\n    this.r = (hex >> 16 & 255) / 255;\r\n    this.g = (hex >> 8 & 255) / 255;\r\n    this.b = (hex & 255) / 255;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  setRGB: function(r, g, b) {\r\n\r\n    this.r = r;\r\n    this.g = g;\r\n    this.b = b;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  setHSL: function(h, s, l) {\r\n\r\n    // h,s,l ranges are in 0.0 - 1.0\r\n\r\n    if (s === 0) {\r\n\r\n      this.r = this.g = this.b = l;\r\n\r\n    }\r\n    else {\r\n\r\n      var hue2rgb = function(p, q, t) {\r\n\r\n        if (t < 0) t += 1;\r\n        if (t > 1) t -= 1;\r\n        if (t < 1 / 6) return p + (q - p) * 6 * t;\r\n        if (t < 1 / 2) return q;\r\n        if (t < 2 / 3) return p + (q - p) * 6 * (2 / 3 - t);\r\n        return p;\r\n\r\n      };\r\n\r\n      var p = l <= 0.5 ? l * (1 + s) : l + s - (l * s);\r\n      var q = (2 * l) - p;\r\n\r\n      this.r = hue2rgb(q, p, h + 1 / 3);\r\n      this.g = hue2rgb(q, p, h);\r\n      this.b = hue2rgb(q, p, h - 1 / 3);\r\n\r\n    }\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  setStyle: function(style) {\r\n\r\n    // rgb(255,0,0)\r\n\r\n    if (/^rgb\\((\\d+), ?(\\d+), ?(\\d+)\\)$/i.test(style)) {\r\n\r\n      var color = /^rgb\\((\\d+), ?(\\d+), ?(\\d+)\\)$/i.exec(style);\r\n\r\n      this.r = Math.min(255, parseInt(color[1], 10)) / 255;\r\n      this.g = Math.min(255, parseInt(color[2], 10)) / 255;\r\n      this.b = Math.min(255, parseInt(color[3], 10)) / 255;\r\n\r\n      return this;\r\n\r\n    }\r\n\r\n    // rgb(100%,0%,0%)\r\n\r\n    if (/^rgb\\((\\d+)\\%, ?(\\d+)\\%, ?(\\d+)\\%\\)$/i.test(style)) {\r\n\r\n      var color = /^rgb\\((\\d+)\\%, ?(\\d+)\\%, ?(\\d+)\\%\\)$/i.exec(style);\r\n\r\n      this.r = Math.min(100, parseInt(color[1], 10)) / 100;\r\n      this.g = Math.min(100, parseInt(color[2], 10)) / 100;\r\n      this.b = Math.min(100, parseInt(color[3], 10)) / 100;\r\n\r\n      return this;\r\n\r\n    }\r\n\r\n    // #ff0000\r\n\r\n    if (/^\\#([0-9a-f]{6})$/i.test(style)) {\r\n\r\n      var color = /^\\#([0-9a-f]{6})$/i.exec(style);\r\n\r\n      this.setHex(parseInt(color[1], 16));\r\n\r\n      return this;\r\n\r\n    }\r\n\r\n    // #f00\r\n\r\n    if (/^\\#([0-9a-f])([0-9a-f])([0-9a-f])$/i.test(style)) {\r\n\r\n      var color = /^\\#([0-9a-f])([0-9a-f])([0-9a-f])$/i.exec(style);\r\n\r\n      this.setHex(parseInt(color[1] + color[1] + color[2] + color[2] + color[3] + color[3], 16));\r\n\r\n      return this;\r\n\r\n    }\r\n\r\n    // red\r\n\r\n    if (/^(\\w+)$/i.test(style)) {\r\n\r\n      this.setHex(THREE.ColorKeywords[style]);\r\n\r\n      return this;\r\n\r\n    }\r\n\r\n\r\n  },\r\n\r\n  copy: function(color) {\r\n\r\n    this.r = color.r;\r\n    this.g = color.g;\r\n    this.b = color.b;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  copyGammaToLinear: function(color, gammaFactor) {\r\n\r\n    if (gammaFactor === undefined) gammaFactor = 2.0;\r\n\r\n    this.r = Math.pow(color.r, gammaFactor);\r\n    this.g = Math.pow(color.g, gammaFactor);\r\n    this.b = Math.pow(color.b, gammaFactor);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  copyLinearToGamma: function(color, gammaFactor) {\r\n\r\n    if (gammaFactor === undefined) gammaFactor = 2.0;\r\n\r\n    var safeInverse = (gammaFactor > 0) ? (1.0 / gammaFactor) : 1.0;\r\n\r\n    this.r = Math.pow(color.r, safeInverse);\r\n    this.g = Math.pow(color.g, safeInverse);\r\n    this.b = Math.pow(color.b, safeInverse);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  convertGammaToLinear: function() {\r\n\r\n    var r = this.r,\r\n      g = this.g,\r\n      b = this.b;\r\n\r\n    this.r = r * r;\r\n    this.g = g * g;\r\n    this.b = b * b;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  convertLinearToGamma: function() {\r\n\r\n    this.r = Math.sqrt(this.r);\r\n    this.g = Math.sqrt(this.g);\r\n    this.b = Math.sqrt(this.b);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  getHex: function() {\r\n\r\n    return (this.r * 255) << 16 ^ (this.g * 255) << 8 ^ (this.b * 255) << 0;\r\n\r\n  },\r\n\r\n  getHexString: function() {\r\n\r\n    return ('000000' + this.getHex().toString(16)).slice(-6);\r\n\r\n  },\r\n\r\n  getHSL: function(optionalTarget) {\r\n\r\n    // h,s,l ranges are in 0.0 - 1.0\r\n\r\n    var hsl = optionalTarget || {\r\n      h: 0,\r\n      s: 0,\r\n      l: 0\r\n    };\r\n\r\n    var r = this.r,\r\n      g = this.g,\r\n      b = this.b;\r\n\r\n    var max = Math.max(r, g, b);\r\n    var min = Math.min(r, g, b);\r\n\r\n    var hue, saturation;\r\n    var lightness = (min + max) / 2.0;\r\n\r\n    if (min === max) {\r\n\r\n      hue = 0;\r\n      saturation = 0;\r\n\r\n    }\r\n    else {\r\n\r\n      var delta = max - min;\r\n\r\n      saturation = lightness <= 0.5 ? delta / (max + min) : delta / (2 - max - min);\r\n\r\n      switch (max) {\r\n\r\n        case r:\r\n          hue = (g - b) / delta + (g < b ? 6 : 0);\r\n          break;\r\n        case g:\r\n          hue = (b - r) / delta + 2;\r\n          break;\r\n        case b:\r\n          hue = (r - g) / delta + 4;\r\n          break;\r\n\r\n      }\r\n\r\n      hue /= 6;\r\n\r\n    }\r\n\r\n    hsl.h = hue;\r\n    hsl.s = saturation;\r\n    hsl.l = lightness;\r\n\r\n    return hsl;\r\n\r\n  },\r\n\r\n  getStyle: function() {\r\n\r\n    return 'rgb(' + ((this.r * 255) | 0) + ',' + ((this.g * 255) | 0) + ',' + ((this.b * 255) | 0) + ')';\r\n\r\n  },\r\n\r\n  offsetHSL: function(h, s, l) {\r\n\r\n    var hsl = this.getHSL();\r\n\r\n    hsl.h += h;\r\n    hsl.s += s;\r\n    hsl.l += l;\r\n\r\n    this.setHSL(hsl.h, hsl.s, hsl.l);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  add: function(color) {\r\n\r\n    this.r += color.r;\r\n    this.g += color.g;\r\n    this.b += color.b;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  addColors: function(color1, color2) {\r\n\r\n    this.r = color1.r + color2.r;\r\n    this.g = color1.g + color2.g;\r\n    this.b = color1.b + color2.b;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  addScalar: function(s) {\r\n\r\n    this.r += s;\r\n    this.g += s;\r\n    this.b += s;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  multiply: function(color) {\r\n\r\n    this.r *= color.r;\r\n    this.g *= color.g;\r\n    this.b *= color.b;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  multiplyScalar: function(s) {\r\n\r\n    this.r *= s;\r\n    this.g *= s;\r\n    this.b *= s;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  lerp: function(color, alpha) {\r\n\r\n    this.r += (color.r - this.r) * alpha;\r\n    this.g += (color.g - this.g) * alpha;\r\n    this.b += (color.b - this.b) * alpha;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  equals: function(c) {\r\n\r\n    return (c.r === this.r) && (c.g === this.g) && (c.b === this.b);\r\n\r\n  },\r\n\r\n  fromArray: function(array) {\r\n\r\n    this.r = array[0];\r\n    this.g = array[1];\r\n    this.b = array[2];\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  toArray: function(array, offset) {\r\n\r\n    if (array === undefined) array = [];\r\n    if (offset === undefined) offset = 0;\r\n\r\n    array[offset] = this.r;\r\n    array[offset + 1] = this.g;\r\n    array[offset + 2] = this.b;\r\n\r\n    return array;\r\n  },\r\n\r\n  clone: function() {\r\n\r\n    return new THREE.Color().setRGB(this.r, this.g, this.b);\r\n\r\n  }\r\n\r\n};\r\n\r\nTHREE.ColorKeywords = {\r\n  'aliceblue': 0xF0F8FF,\r\n  'antiquewhite': 0xFAEBD7,\r\n  'aqua': 0x00FFFF,\r\n  'aquamarine': 0x7FFFD4,\r\n  'azure': 0xF0FFFF,\r\n  'beige': 0xF5F5DC,\r\n  'bisque': 0xFFE4C4,\r\n  'black': 0x000000,\r\n  'blanchedalmond': 0xFFEBCD,\r\n  'blue': 0x0000FF,\r\n  'blueviolet': 0x8A2BE2,\r\n  'brown': 0xA52A2A,\r\n  'burlywood': 0xDEB887,\r\n  'cadetblue': 0x5F9EA0,\r\n  'chartreuse': 0x7FFF00,\r\n  'chocolate': 0xD2691E,\r\n  'coral': 0xFF7F50,\r\n  'cornflowerblue': 0x6495ED,\r\n  'cornsilk': 0xFFF8DC,\r\n  'crimson': 0xDC143C,\r\n  'cyan': 0x00FFFF,\r\n  'darkblue': 0x00008B,\r\n  'darkcyan': 0x008B8B,\r\n  'darkgoldenrod': 0xB8860B,\r\n  'darkgray': 0xA9A9A9,\r\n  'darkgreen': 0x006400,\r\n  'darkgrey': 0xA9A9A9,\r\n  'darkkhaki': 0xBDB76B,\r\n  'darkmagenta': 0x8B008B,\r\n  'darkolivegreen': 0x556B2F,\r\n  'darkorange': 0xFF8C00,\r\n  'darkorchid': 0x9932CC,\r\n  'darkred': 0x8B0000,\r\n  'darksalmon': 0xE9967A,\r\n  'darkseagreen': 0x8FBC8F,\r\n  'darkslateblue': 0x483D8B,\r\n  'darkslategray': 0x2F4F4F,\r\n  'darkslategrey': 0x2F4F4F,\r\n  'darkturquoise': 0x00CED1,\r\n  'darkviolet': 0x9400D3,\r\n  'deeppink': 0xFF1493,\r\n  'deepskyblue': 0x00BFFF,\r\n  'dimgray': 0x696969,\r\n  'dimgrey': 0x696969,\r\n  'dodgerblue': 0x1E90FF,\r\n  'firebrick': 0xB22222,\r\n  'floralwhite': 0xFFFAF0,\r\n  'forestgreen': 0x228B22,\r\n  'fuchsia': 0xFF00FF,\r\n  'gainsboro': 0xDCDCDC,\r\n  'ghostwhite': 0xF8F8FF,\r\n  'gold': 0xFFD700,\r\n  'goldenrod': 0xDAA520,\r\n  'gray': 0x808080,\r\n  'green': 0x008000,\r\n  'greenyellow': 0xADFF2F,\r\n  'grey': 0x808080,\r\n  'honeydew': 0xF0FFF0,\r\n  'hotpink': 0xFF69B4,\r\n  'indianred': 0xCD5C5C,\r\n  'indigo': 0x4B0082,\r\n  'ivory': 0xFFFFF0,\r\n  'khaki': 0xF0E68C,\r\n  'lavender': 0xE6E6FA,\r\n  'lavenderblush': 0xFFF0F5,\r\n  'lawngreen': 0x7CFC00,\r\n  'lemonchiffon': 0xFFFACD,\r\n  'lightblue': 0xADD8E6,\r\n  'lightcoral': 0xF08080,\r\n  'lightcyan': 0xE0FFFF,\r\n  'lightgoldenrodyellow': 0xFAFAD2,\r\n  'lightgray': 0xD3D3D3,\r\n  'lightgreen': 0x90EE90,\r\n  'lightgrey': 0xD3D3D3,\r\n  'lightpink': 0xFFB6C1,\r\n  'lightsalmon': 0xFFA07A,\r\n  'lightseagreen': 0x20B2AA,\r\n  'lightskyblue': 0x87CEFA,\r\n  'lightslategray': 0x778899,\r\n  'lightslategrey': 0x778899,\r\n  'lightsteelblue': 0xB0C4DE,\r\n  'lightyellow': 0xFFFFE0,\r\n  'lime': 0x00FF00,\r\n  'limegreen': 0x32CD32,\r\n  'linen': 0xFAF0E6,\r\n  'magenta': 0xFF00FF,\r\n  'maroon': 0x800000,\r\n  'mediumaquamarine': 0x66CDAA,\r\n  'mediumblue': 0x0000CD,\r\n  'mediumorchid': 0xBA55D3,\r\n  'mediumpurple': 0x9370DB,\r\n  'mediumseagreen': 0x3CB371,\r\n  'mediumslateblue': 0x7B68EE,\r\n  'mediumspringgreen': 0x00FA9A,\r\n  'mediumturquoise': 0x48D1CC,\r\n  'mediumvioletred': 0xC71585,\r\n  'midnightblue': 0x191970,\r\n  'mintcream': 0xF5FFFA,\r\n  'mistyrose': 0xFFE4E1,\r\n  'moccasin': 0xFFE4B5,\r\n  'navajowhite': 0xFFDEAD,\r\n  'navy': 0x000080,\r\n  'oldlace': 0xFDF5E6,\r\n  'olive': 0x808000,\r\n  'olivedrab': 0x6B8E23,\r\n  'orange': 0xFFA500,\r\n  'orangered': 0xFF4500,\r\n  'orchid': 0xDA70D6,\r\n  'palegoldenrod': 0xEEE8AA,\r\n  'palegreen': 0x98FB98,\r\n  'paleturquoise': 0xAFEEEE,\r\n  'palevioletred': 0xDB7093,\r\n  'papayawhip': 0xFFEFD5,\r\n  'peachpuff': 0xFFDAB9,\r\n  'peru': 0xCD853F,\r\n  'pink': 0xFFC0CB,\r\n  'plum': 0xDDA0DD,\r\n  'powderblue': 0xB0E0E6,\r\n  'purple': 0x800080,\r\n  'red': 0xFF0000,\r\n  'rosybrown': 0xBC8F8F,\r\n  'royalblue': 0x4169E1,\r\n  'saddlebrown': 0x8B4513,\r\n  'salmon': 0xFA8072,\r\n  'sandybrown': 0xF4A460,\r\n  'seagreen': 0x2E8B57,\r\n  'seashell': 0xFFF5EE,\r\n  'sienna': 0xA0522D,\r\n  'silver': 0xC0C0C0,\r\n  'skyblue': 0x87CEEB,\r\n  'slateblue': 0x6A5ACD,\r\n  'slategray': 0x708090,\r\n  'slategrey': 0x708090,\r\n  'snow': 0xFFFAFA,\r\n  'springgreen': 0x00FF7F,\r\n  'steelblue': 0x4682B4,\r\n  'tan': 0xD2B48C,\r\n  'teal': 0x008080,\r\n  'thistle': 0xD8BFD8,\r\n  'tomato': 0xFF6347,\r\n  'turquoise': 0x40E0D0,\r\n  'violet': 0xEE82EE,\r\n  'wheat': 0xF5DEB3,\r\n  'white': 0xFFFFFF,\r\n  'whitesmoke': 0xF5F5F5,\r\n  'yellow': 0xFFFF00,\r\n  'yellowgreen': 0x9ACD32\r\n};\r\n\r\n// File:src/math/Quaternion.js\r\n\r\n/**\r\n * @author mikael emtinger / http://gomo.se/\r\n * @author alteredq / http://alteredqualia.com/\r\n * @author WestLangley / http://github.com/WestLangley\r\n * @author bhouston / http://exocortex.com\r\n */\r\n\r\nTHREE.Quaternion = function(x, y, z, w) {\r\n\r\n  this._x = x || 0;\r\n  this._y = y || 0;\r\n  this._z = z || 0;\r\n  this._w = (w !== undefined) ? w : 1;\r\n\r\n};\r\n\r\nTHREE.Quaternion.prototype = {\r\n\r\n  constructor: THREE.Quaternion,\r\n\r\n  _x: 0,\r\n  _y: 0,\r\n  _z: 0,\r\n  _w: 0,\r\n\r\n  get x() {\r\n\r\n    return this._x;\r\n\r\n  },\r\n\r\n  set x(value) {\r\n\r\n    this._x = value;\r\n    this.onChangeCallback();\r\n\r\n  },\r\n\r\n  get y() {\r\n\r\n    return this._y;\r\n\r\n  },\r\n\r\n  set y(value) {\r\n\r\n    this._y = value;\r\n    this.onChangeCallback();\r\n\r\n  },\r\n\r\n  get z() {\r\n\r\n    return this._z;\r\n\r\n  },\r\n\r\n  set z(value) {\r\n\r\n    this._z = value;\r\n    this.onChangeCallback();\r\n\r\n  },\r\n\r\n  get w() {\r\n\r\n    return this._w;\r\n\r\n  },\r\n\r\n  set w(value) {\r\n\r\n    this._w = value;\r\n    this.onChangeCallback();\r\n\r\n  },\r\n\r\n  set: function(x, y, z, w) {\r\n\r\n    this._x = x;\r\n    this._y = y;\r\n    this._z = z;\r\n    this._w = w;\r\n\r\n    this.onChangeCallback();\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  copy: function(quaternion) {\r\n\r\n    this._x = quaternion.x;\r\n    this._y = quaternion.y;\r\n    this._z = quaternion.z;\r\n    this._w = quaternion.w;\r\n\r\n    this.onChangeCallback();\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  setFromEuler: function(euler, update) {\r\n\r\n    if (euler instanceof THREE.Euler === false) {\r\n\r\n      throw new Error('THREE.Quaternion: .setFromEuler() now expects a Euler rotation rather than a Vector3 and order.');\r\n    }\r\n\r\n    // http://www.mathworks.com/matlabcentral/fileexchange/\r\n    // \t20696-function-to-convert-between-dcm-euler-angles-quaternions-and-euler-vectors/\r\n    //\tcontent/SpinCalc.m\r\n\r\n    var c1 = Math.cos(euler._x / 2);\r\n    var c2 = Math.cos(euler._y / 2);\r\n    var c3 = Math.cos(euler._z / 2);\r\n    var s1 = Math.sin(euler._x / 2);\r\n    var s2 = Math.sin(euler._y / 2);\r\n    var s3 = Math.sin(euler._z / 2);\r\n\r\n    if (euler.order === 'XYZ') {\r\n\r\n      this._x = s1 * c2 * c3 + c1 * s2 * s3;\r\n      this._y = c1 * s2 * c3 - s1 * c2 * s3;\r\n      this._z = c1 * c2 * s3 + s1 * s2 * c3;\r\n      this._w = c1 * c2 * c3 - s1 * s2 * s3;\r\n\r\n    }\r\n    else if (euler.order === 'YXZ') {\r\n\r\n      this._x = s1 * c2 * c3 + c1 * s2 * s3;\r\n      this._y = c1 * s2 * c3 - s1 * c2 * s3;\r\n      this._z = c1 * c2 * s3 - s1 * s2 * c3;\r\n      this._w = c1 * c2 * c3 + s1 * s2 * s3;\r\n\r\n    }\r\n    else if (euler.order === 'ZXY') {\r\n\r\n      this._x = s1 * c2 * c3 - c1 * s2 * s3;\r\n      this._y = c1 * s2 * c3 + s1 * c2 * s3;\r\n      this._z = c1 * c2 * s3 + s1 * s2 * c3;\r\n      this._w = c1 * c2 * c3 - s1 * s2 * s3;\r\n\r\n    }\r\n    else if (euler.order === 'ZYX') {\r\n\r\n      this._x = s1 * c2 * c3 - c1 * s2 * s3;\r\n      this._y = c1 * s2 * c3 + s1 * c2 * s3;\r\n      this._z = c1 * c2 * s3 - s1 * s2 * c3;\r\n      this._w = c1 * c2 * c3 + s1 * s2 * s3;\r\n\r\n    }\r\n    else if (euler.order === 'YZX') {\r\n\r\n      this._x = s1 * c2 * c3 + c1 * s2 * s3;\r\n      this._y = c1 * s2 * c3 + s1 * c2 * s3;\r\n      this._z = c1 * c2 * s3 - s1 * s2 * c3;\r\n      this._w = c1 * c2 * c3 - s1 * s2 * s3;\r\n\r\n    }\r\n    else if (euler.order === 'XZY') {\r\n\r\n      this._x = s1 * c2 * c3 - c1 * s2 * s3;\r\n      this._y = c1 * s2 * c3 - s1 * c2 * s3;\r\n      this._z = c1 * c2 * s3 + s1 * s2 * c3;\r\n      this._w = c1 * c2 * c3 + s1 * s2 * s3;\r\n\r\n    }\r\n\r\n    if (update !== false) this.onChangeCallback();\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  setFromAxisAngle: function(axis, angle) {\r\n\r\n    // http://www.euclideanspace.com/maths/geometry/rotations/conversions/angleToQuaternion/index.htm\r\n\r\n    // assumes axis is normalized\r\n\r\n    var halfAngle = angle / 2,\r\n      s = Math.sin(halfAngle);\r\n\r\n    this._x = axis.x * s;\r\n    this._y = axis.y * s;\r\n    this._z = axis.z * s;\r\n    this._w = Math.cos(halfAngle);\r\n\r\n    this.onChangeCallback();\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  setFromRotationMatrix: function(m) {\r\n\r\n    // http://www.euclideanspace.com/maths/geometry/rotations/conversions/matrixToQuaternion/index.htm\r\n\r\n    // assumes the upper 3x3 of m is a pure rotation matrix (i.e, unscaled)\r\n\r\n    var te = m.elements,\r\n\r\n      m11 = te[0],\r\n      m12 = te[4],\r\n      m13 = te[8],\r\n      m21 = te[1],\r\n      m22 = te[5],\r\n      m23 = te[9],\r\n      m31 = te[2],\r\n      m32 = te[6],\r\n      m33 = te[10],\r\n\r\n      trace = m11 + m22 + m33,\r\n      s;\r\n\r\n    if (trace > 0) {\r\n\r\n      s = 0.5 / Math.sqrt(trace + 1.0);\r\n\r\n      this._w = 0.25 / s;\r\n      this._x = (m32 - m23) * s;\r\n      this._y = (m13 - m31) * s;\r\n      this._z = (m21 - m12) * s;\r\n\r\n    }\r\n    else if (m11 > m22 && m11 > m33) {\r\n\r\n      s = 2.0 * Math.sqrt(1.0 + m11 - m22 - m33);\r\n\r\n      this._w = (m32 - m23) / s;\r\n      this._x = 0.25 * s;\r\n      this._y = (m12 + m21) / s;\r\n      this._z = (m13 + m31) / s;\r\n\r\n    }\r\n    else if (m22 > m33) {\r\n\r\n      s = 2.0 * Math.sqrt(1.0 + m22 - m11 - m33);\r\n\r\n      this._w = (m13 - m31) / s;\r\n      this._x = (m12 + m21) / s;\r\n      this._y = 0.25 * s;\r\n      this._z = (m23 + m32) / s;\r\n\r\n    }\r\n    else {\r\n\r\n      s = 2.0 * Math.sqrt(1.0 + m33 - m11 - m22);\r\n\r\n      this._w = (m21 - m12) / s;\r\n      this._x = (m13 + m31) / s;\r\n      this._y = (m23 + m32) / s;\r\n      this._z = 0.25 * s;\r\n\r\n    }\r\n\r\n    this.onChangeCallback();\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  setFromUnitVectors: function() {\r\n\r\n    // http://lolengine.net/blog/2014/02/24/quaternion-from-two-vectors-final\r\n\r\n    // assumes direction vectors vFrom and vTo are normalized\r\n\r\n    var v1, r;\r\n\r\n    var EPS = 0.000001;\r\n\r\n    return function(vFrom, vTo) {\r\n\r\n      if (v1 === undefined) v1 = new THREE.Vector3();\r\n\r\n      r = vFrom.dot(vTo) + 1;\r\n\r\n      if (r < EPS) {\r\n\r\n        r = 0;\r\n\r\n        if (Math.abs(vFrom.x) > Math.abs(vFrom.z)) {\r\n\r\n          v1.set(-vFrom.y, vFrom.x, 0);\r\n\r\n        }\r\n        else {\r\n\r\n          v1.set(0, -vFrom.z, vFrom.y);\r\n\r\n        }\r\n\r\n      }\r\n      else {\r\n\r\n        v1.crossVectors(vFrom, vTo);\r\n\r\n      }\r\n\r\n      this._x = v1.x;\r\n      this._y = v1.y;\r\n      this._z = v1.z;\r\n      this._w = r;\r\n\r\n      this.normalize();\r\n\r\n      return this;\r\n\r\n    }\r\n\r\n  }(),\r\n\r\n  inverse: function() {\r\n\r\n    this.conjugate().normalize();\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  conjugate: function() {\r\n\r\n    this._x *= -1;\r\n    this._y *= -1;\r\n    this._z *= -1;\r\n\r\n    this.onChangeCallback();\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  dot: function(v) {\r\n\r\n    return this._x * v._x + this._y * v._y + this._z * v._z + this._w * v._w;\r\n\r\n  },\r\n\r\n  lengthSq: function() {\r\n\r\n    return this._x * this._x + this._y * this._y + this._z * this._z + this._w * this._w;\r\n\r\n  },\r\n\r\n  length: function() {\r\n\r\n    return Math.sqrt(this._x * this._x + this._y * this._y + this._z * this._z + this._w * this._w);\r\n\r\n  },\r\n\r\n  normalize: function() {\r\n\r\n    var l = this.length();\r\n\r\n    if (l === 0) {\r\n\r\n      this._x = 0;\r\n      this._y = 0;\r\n      this._z = 0;\r\n      this._w = 1;\r\n\r\n    }\r\n    else {\r\n\r\n      l = 1 / l;\r\n\r\n      this._x = this._x * l;\r\n      this._y = this._y * l;\r\n      this._z = this._z * l;\r\n      this._w = this._w * l;\r\n\r\n    }\r\n\r\n    this.onChangeCallback();\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  multiply: function(q, p) {\r\n\r\n    if (p !== undefined) {\r\n\r\n      THREE.warn('THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead.');\r\n      return this.multiplyQuaternions(q, p);\r\n\r\n    }\r\n\r\n    return this.multiplyQuaternions(this, q);\r\n\r\n  },\r\n\r\n  multiplyQuaternions: function(a, b) {\r\n\r\n    // from http://www.euclideanspace.com/maths/algebra/realNormedAlgebra/quaternions/code/index.htm\r\n\r\n    var qax = a._x,\r\n      qay = a._y,\r\n      qaz = a._z,\r\n      qaw = a._w;\r\n    var qbx = b._x,\r\n      qby = b._y,\r\n      qbz = b._z,\r\n      qbw = b._w;\r\n\r\n    this._x = qax * qbw + qaw * qbx + qay * qbz - qaz * qby;\r\n    this._y = qay * qbw + qaw * qby + qaz * qbx - qax * qbz;\r\n    this._z = qaz * qbw + qaw * qbz + qax * qby - qay * qbx;\r\n    this._w = qaw * qbw - qax * qbx - qay * qby - qaz * qbz;\r\n\r\n    this.onChangeCallback();\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  multiplyVector3: function(vector) {\r\n\r\n    THREE.warn('THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead.');\r\n    return vector.applyQuaternion(this);\r\n\r\n  },\r\n\r\n  slerp: function(qb, t) {\r\n\r\n    if (t === 0) return this;\r\n    if (t === 1) return this.copy(qb);\r\n\r\n    var x = this._x,\r\n      y = this._y,\r\n      z = this._z,\r\n      w = this._w;\r\n\r\n    // http://www.euclideanspace.com/maths/algebra/realNormedAlgebra/quaternions/slerp/\r\n\r\n    var cosHalfTheta = w * qb._w + x * qb._x + y * qb._y + z * qb._z;\r\n\r\n    if (cosHalfTheta < 0) {\r\n\r\n      this._w = -qb._w;\r\n      this._x = -qb._x;\r\n      this._y = -qb._y;\r\n      this._z = -qb._z;\r\n\r\n      cosHalfTheta = -cosHalfTheta;\r\n\r\n    }\r\n    else {\r\n\r\n      this.copy(qb);\r\n\r\n    }\r\n\r\n    if (cosHalfTheta >= 1.0) {\r\n\r\n      this._w = w;\r\n      this._x = x;\r\n      this._y = y;\r\n      this._z = z;\r\n\r\n      return this;\r\n\r\n    }\r\n\r\n    var halfTheta = Math.acos(cosHalfTheta);\r\n    var sinHalfTheta = Math.sqrt(1.0 - cosHalfTheta * cosHalfTheta);\r\n\r\n    if (Math.abs(sinHalfTheta) < 0.001) {\r\n\r\n      this._w = 0.5 * (w + this._w);\r\n      this._x = 0.5 * (x + this._x);\r\n      this._y = 0.5 * (y + this._y);\r\n      this._z = 0.5 * (z + this._z);\r\n\r\n      return this;\r\n\r\n    }\r\n\r\n    var ratioA = Math.sin((1 - t) * halfTheta) / sinHalfTheta,\r\n      ratioB = Math.sin(t * halfTheta) / sinHalfTheta;\r\n\r\n    this._w = (w * ratioA + this._w * ratioB);\r\n    this._x = (x * ratioA + this._x * ratioB);\r\n    this._y = (y * ratioA + this._y * ratioB);\r\n    this._z = (z * ratioA + this._z * ratioB);\r\n\r\n    this.onChangeCallback();\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  equals: function(quaternion) {\r\n\r\n    return (quaternion._x === this._x) && (quaternion._y === this._y) && (quaternion._z === this._z) && (quaternion._w === this._w);\r\n\r\n  },\r\n\r\n  fromArray: function(array, offset) {\r\n\r\n    if (offset === undefined) offset = 0;\r\n\r\n    this._x = array[offset];\r\n    this._y = array[offset + 1];\r\n    this._z = array[offset + 2];\r\n    this._w = array[offset + 3];\r\n\r\n    this.onChangeCallback();\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  toArray: function(array, offset) {\r\n\r\n    if (array === undefined) array = [];\r\n    if (offset === undefined) offset = 0;\r\n\r\n    array[offset] = this._x;\r\n    array[offset + 1] = this._y;\r\n    array[offset + 2] = this._z;\r\n    array[offset + 3] = this._w;\r\n\r\n    return array;\r\n\r\n  },\r\n\r\n  onChange: function(callback) {\r\n\r\n    this.onChangeCallback = callback;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  onChangeCallback: function() {},\r\n\r\n  clone: function() {\r\n\r\n    return new THREE.Quaternion(this._x, this._y, this._z, this._w);\r\n\r\n  }\r\n\r\n};\r\n\r\nTHREE.Quaternion.slerp = function(qa, qb, qm, t) {\r\n\r\n  return qm.copy(qa).slerp(qb, t);\r\n\r\n}\r\n\r\n// File:src/math/Vector2.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author philogb / http://blog.thejit.org/\r\n * @author egraether / http://egraether.com/\r\n * @author zz85 / http://www.lab4games.net/zz85/blog\r\n */\r\n\r\nTHREE.Vector2 = function(x, y) {\r\n\r\n  this.x = x || 0;\r\n  this.y = y || 0;\r\n\r\n};\r\n\r\nTHREE.Vector2.prototype = {\r\n\r\n  constructor: THREE.Vector2,\r\n\r\n  set: function(x, y) {\r\n\r\n    this.x = x;\r\n    this.y = y;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  setX: function(x) {\r\n\r\n    this.x = x;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  setY: function(y) {\r\n\r\n    this.y = y;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  setComponent: function(index, value) {\r\n\r\n    switch (index) {\r\n\r\n      case 0:\r\n        this.x = value;\r\n        break;\r\n      case 1:\r\n        this.y = value;\r\n        break;\r\n      default:\r\n        throw new Error('index is out of range: ' + index);\r\n\r\n    }\r\n\r\n  },\r\n\r\n  getComponent: function(index) {\r\n\r\n    switch (index) {\r\n\r\n      case 0:\r\n        return this.x;\r\n      case 1:\r\n        return this.y;\r\n      default:\r\n        throw new Error('index is out of range: ' + index);\r\n\r\n    }\r\n\r\n  },\r\n\r\n  copy: function(v) {\r\n\r\n    this.x = v.x;\r\n    this.y = v.y;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  add: function(v, w) {\r\n\r\n    if (w !== undefined) {\r\n\r\n      THREE.warn('THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead.');\r\n      return this.addVectors(v, w);\r\n\r\n    }\r\n\r\n    this.x += v.x;\r\n    this.y += v.y;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  addScalar: function(s) {\r\n\r\n    this.x += s;\r\n    this.y += s;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  addVectors: function(a, b) {\r\n\r\n    this.x = a.x + b.x;\r\n    this.y = a.y + b.y;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  sub: function(v, w) {\r\n\r\n    if (w !== undefined) {\r\n\r\n      THREE.warn('THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead.');\r\n      return this.subVectors(v, w);\r\n\r\n    }\r\n\r\n    this.x -= v.x;\r\n    this.y -= v.y;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  subScalar: function(s) {\r\n\r\n    this.x -= s;\r\n    this.y -= s;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  subVectors: function(a, b) {\r\n\r\n    this.x = a.x - b.x;\r\n    this.y = a.y - b.y;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  multiply: function(v) {\r\n\r\n    this.x *= v.x;\r\n    this.y *= v.y;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  multiplyScalar: function(s) {\r\n\r\n    this.x *= s;\r\n    this.y *= s;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  divide: function(v) {\r\n\r\n    this.x /= v.x;\r\n    this.y /= v.y;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  divideScalar: function(scalar) {\r\n\r\n    if (scalar !== 0) {\r\n\r\n      var invScalar = 1 / scalar;\r\n\r\n      this.x *= invScalar;\r\n      this.y *= invScalar;\r\n\r\n    }\r\n    else {\r\n\r\n      this.x = 0;\r\n      this.y = 0;\r\n\r\n    }\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  min: function(v) {\r\n\r\n    if (this.x > v.x) {\r\n\r\n      this.x = v.x;\r\n\r\n    }\r\n\r\n    if (this.y > v.y) {\r\n\r\n      this.y = v.y;\r\n\r\n    }\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  max: function(v) {\r\n\r\n    if (this.x < v.x) {\r\n\r\n      this.x = v.x;\r\n\r\n    }\r\n\r\n    if (this.y < v.y) {\r\n\r\n      this.y = v.y;\r\n\r\n    }\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  clamp: function(min, max) {\r\n\r\n    // This function assumes min < max, if this assumption isn't true it will not operate correctly\r\n\r\n    if (this.x < min.x) {\r\n\r\n      this.x = min.x;\r\n\r\n    }\r\n    else if (this.x > max.x) {\r\n\r\n      this.x = max.x;\r\n\r\n    }\r\n\r\n    if (this.y < min.y) {\r\n\r\n      this.y = min.y;\r\n\r\n    }\r\n    else if (this.y > max.y) {\r\n\r\n      this.y = max.y;\r\n\r\n    }\r\n\r\n    return this;\r\n  },\r\n\r\n  clampScalar: (function() {\r\n\r\n    var min, max;\r\n\r\n    return function(minVal, maxVal) {\r\n\r\n      if (min === undefined) {\r\n\r\n        min = new THREE.Vector2();\r\n        max = new THREE.Vector2();\r\n\r\n      }\r\n\r\n      min.set(minVal, minVal);\r\n      max.set(maxVal, maxVal);\r\n\r\n      return this.clamp(min, max);\r\n\r\n    };\r\n\r\n  })(),\r\n\r\n  floor: function() {\r\n\r\n    this.x = Math.floor(this.x);\r\n    this.y = Math.floor(this.y);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  ceil: function() {\r\n\r\n    this.x = Math.ceil(this.x);\r\n    this.y = Math.ceil(this.y);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  round: function() {\r\n\r\n    this.x = Math.round(this.x);\r\n    this.y = Math.round(this.y);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  roundToZero: function() {\r\n\r\n    this.x = (this.x < 0) ? Math.ceil(this.x) : Math.floor(this.x);\r\n    this.y = (this.y < 0) ? Math.ceil(this.y) : Math.floor(this.y);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  negate: function() {\r\n\r\n    this.x = -this.x;\r\n    this.y = -this.y;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  dot: function(v) {\r\n\r\n    return this.x * v.x + this.y * v.y;\r\n\r\n  },\r\n\r\n  lengthSq: function() {\r\n\r\n    return this.x * this.x + this.y * this.y;\r\n\r\n  },\r\n\r\n  length: function() {\r\n\r\n    return Math.sqrt(this.x * this.x + this.y * this.y);\r\n\r\n  },\r\n\r\n  normalize: function() {\r\n\r\n    return this.divideScalar(this.length());\r\n\r\n  },\r\n\r\n  distanceTo: function(v) {\r\n\r\n    return Math.sqrt(this.distanceToSquared(v));\r\n\r\n  },\r\n\r\n  distanceToSquared: function(v) {\r\n\r\n    var dx = this.x - v.x,\r\n      dy = this.y - v.y;\r\n    return dx * dx + dy * dy;\r\n\r\n  },\r\n\r\n  setLength: function(l) {\r\n\r\n    var oldLength = this.length();\r\n\r\n    if (oldLength !== 0 && l !== oldLength) {\r\n\r\n      this.multiplyScalar(l / oldLength);\r\n    }\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  lerp: function(v, alpha) {\r\n\r\n    this.x += (v.x - this.x) * alpha;\r\n    this.y += (v.y - this.y) * alpha;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  lerpVectors: function(v1, v2, alpha) {\r\n\r\n    this.subVectors(v2, v1).multiplyScalar(alpha).add(v1);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  equals: function(v) {\r\n\r\n    return ((v.x === this.x) && (v.y === this.y));\r\n\r\n  },\r\n\r\n  fromArray: function(array, offset) {\r\n\r\n    if (offset === undefined) offset = 0;\r\n\r\n    this.x = array[offset];\r\n    this.y = array[offset + 1];\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  toArray: function(array, offset) {\r\n\r\n    if (array === undefined) array = [];\r\n    if (offset === undefined) offset = 0;\r\n\r\n    array[offset] = this.x;\r\n    array[offset + 1] = this.y;\r\n\r\n    return array;\r\n\r\n  },\r\n\r\n  fromAttribute: function(attribute, index, offset) {\r\n\r\n    if (offset === undefined) offset = 0;\r\n\r\n    index = index * attribute.itemSize + offset;\r\n\r\n    this.x = attribute.array[index];\r\n    this.y = attribute.array[index + 1];\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  clone: function() {\r\n\r\n    return new THREE.Vector2(this.x, this.y);\r\n\r\n  }\r\n\r\n};\r\n\r\n// File:src/math/Vector3.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author *kile / http://kile.stravaganza.org/\r\n * @author philogb / http://blog.thejit.org/\r\n * @author mikael emtinger / http://gomo.se/\r\n * @author egraether / http://egraether.com/\r\n * @author WestLangley / http://github.com/WestLangley\r\n */\r\n\r\nTHREE.Vector3 = function(x, y, z) {\r\n\r\n  this.x = x || 0;\r\n  this.y = y || 0;\r\n  this.z = z || 0;\r\n\r\n};\r\n\r\nTHREE.Vector3.prototype = {\r\n\r\n  constructor: THREE.Vector3,\r\n\r\n  set: function(x, y, z) {\r\n\r\n    this.x = x;\r\n    this.y = y;\r\n    this.z = z;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  setX: function(x) {\r\n\r\n    this.x = x;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  setY: function(y) {\r\n\r\n    this.y = y;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  setZ: function(z) {\r\n\r\n    this.z = z;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  setComponent: function(index, value) {\r\n\r\n    switch (index) {\r\n\r\n      case 0:\r\n        this.x = value;\r\n        break;\r\n      case 1:\r\n        this.y = value;\r\n        break;\r\n      case 2:\r\n        this.z = value;\r\n        break;\r\n      default:\r\n        throw new Error('index is out of range: ' + index);\r\n\r\n    }\r\n\r\n  },\r\n\r\n  getComponent: function(index) {\r\n\r\n    switch (index) {\r\n\r\n      case 0:\r\n        return this.x;\r\n      case 1:\r\n        return this.y;\r\n      case 2:\r\n        return this.z;\r\n      default:\r\n        throw new Error('index is out of range: ' + index);\r\n\r\n    }\r\n\r\n  },\r\n\r\n  copy: function(v) {\r\n\r\n    this.x = v.x;\r\n    this.y = v.y;\r\n    this.z = v.z;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  add: function(v, w) {\r\n\r\n    if (w !== undefined) {\r\n\r\n      THREE.warn('THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead.');\r\n      return this.addVectors(v, w);\r\n\r\n    }\r\n\r\n    this.x += v.x;\r\n    this.y += v.y;\r\n    this.z += v.z;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  addScalar: function(s) {\r\n\r\n    this.x += s;\r\n    this.y += s;\r\n    this.z += s;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  addVectors: function(a, b) {\r\n\r\n    this.x = a.x + b.x;\r\n    this.y = a.y + b.y;\r\n    this.z = a.z + b.z;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  sub: function(v, w) {\r\n\r\n    if (w !== undefined) {\r\n\r\n      THREE.warn('THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead.');\r\n      return this.subVectors(v, w);\r\n\r\n    }\r\n\r\n    this.x -= v.x;\r\n    this.y -= v.y;\r\n    this.z -= v.z;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  subScalar: function(s) {\r\n\r\n    this.x -= s;\r\n    this.y -= s;\r\n    this.z -= s;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  subVectors: function(a, b) {\r\n\r\n    this.x = a.x - b.x;\r\n    this.y = a.y - b.y;\r\n    this.z = a.z - b.z;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  multiply: function(v, w) {\r\n\r\n    if (w !== undefined) {\r\n\r\n      THREE.warn('THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead.');\r\n      return this.multiplyVectors(v, w);\r\n\r\n    }\r\n\r\n    this.x *= v.x;\r\n    this.y *= v.y;\r\n    this.z *= v.z;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  multiplyScalar: function(scalar) {\r\n\r\n    this.x *= scalar;\r\n    this.y *= scalar;\r\n    this.z *= scalar;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  multiplyVectors: function(a, b) {\r\n\r\n    this.x = a.x * b.x;\r\n    this.y = a.y * b.y;\r\n    this.z = a.z * b.z;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  applyEuler: function() {\r\n\r\n    var quaternion;\r\n\r\n    return function(euler) {\r\n\r\n      if (euler instanceof THREE.Euler === false) {\r\n\r\n        THREE.error('THREE.Vector3: .applyEuler() now expects a Euler rotation rather than a Vector3 and order.');\r\n\r\n      }\r\n\r\n      if (quaternion === undefined) quaternion = new THREE.Quaternion();\r\n\r\n      this.applyQuaternion(quaternion.setFromEuler(euler));\r\n\r\n      return this;\r\n\r\n    };\r\n\r\n  }(),\r\n\r\n  applyAxisAngle: function() {\r\n\r\n    var quaternion;\r\n\r\n    return function(axis, angle) {\r\n\r\n      if (quaternion === undefined) quaternion = new THREE.Quaternion();\r\n\r\n      this.applyQuaternion(quaternion.setFromAxisAngle(axis, angle));\r\n\r\n      return this;\r\n\r\n    };\r\n\r\n  }(),\r\n\r\n  applyMatrix3: function(m) {\r\n\r\n    var x = this.x;\r\n    var y = this.y;\r\n    var z = this.z;\r\n\r\n    var e = m.elements;\r\n\r\n    this.x = e[0] * x + e[3] * y + e[6] * z;\r\n    this.y = e[1] * x + e[4] * y + e[7] * z;\r\n    this.z = e[2] * x + e[5] * y + e[8] * z;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  applyMatrix4: function(m) {\r\n\r\n    // input: THREE.Matrix4 affine matrix\r\n\r\n    var x = this.x,\r\n      y = this.y,\r\n      z = this.z;\r\n\r\n    var e = m.elements;\r\n\r\n    this.x = e[0] * x + e[4] * y + e[8] * z + e[12];\r\n    this.y = e[1] * x + e[5] * y + e[9] * z + e[13];\r\n    this.z = e[2] * x + e[6] * y + e[10] * z + e[14];\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  applyProjection: function(m) {\r\n\r\n    // input: THREE.Matrix4 projection matrix\r\n\r\n    var x = this.x,\r\n      y = this.y,\r\n      z = this.z;\r\n\r\n    var e = m.elements;\r\n    var d = 1 / (e[3] * x + e[7] * y + e[11] * z + e[15]); // perspective divide\r\n\r\n    this.x = (e[0] * x + e[4] * y + e[8] * z + e[12]) * d;\r\n    this.y = (e[1] * x + e[5] * y + e[9] * z + e[13]) * d;\r\n    this.z = (e[2] * x + e[6] * y + e[10] * z + e[14]) * d;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  applyQuaternion: function(q) {\r\n\r\n    var x = this.x;\r\n    var y = this.y;\r\n    var z = this.z;\r\n\r\n    var qx = q.x;\r\n    var qy = q.y;\r\n    var qz = q.z;\r\n    var qw = q.w;\r\n\r\n    // calculate quat * vector\r\n\r\n    var ix = qw * x + qy * z - qz * y;\r\n    var iy = qw * y + qz * x - qx * z;\r\n    var iz = qw * z + qx * y - qy * x;\r\n    var iw = -qx * x - qy * y - qz * z;\r\n\r\n    // calculate result * inverse quat\r\n\r\n    this.x = ix * qw + iw * -qx + iy * -qz - iz * -qy;\r\n    this.y = iy * qw + iw * -qy + iz * -qx - ix * -qz;\r\n    this.z = iz * qw + iw * -qz + ix * -qy - iy * -qx;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  project: function() {\r\n\r\n    var matrix;\r\n\r\n    return function(camera) {\r\n\r\n      if (matrix === undefined) matrix = new THREE.Matrix4();\r\n\r\n      matrix.multiplyMatrices(camera.projectionMatrix, matrix.getInverse(camera.matrixWorld));\r\n      return this.applyProjection(matrix);\r\n\r\n    };\r\n\r\n  }(),\r\n\r\n  unproject: function() {\r\n\r\n    var matrix;\r\n\r\n    return function(camera) {\r\n\r\n      if (matrix === undefined) matrix = new THREE.Matrix4();\r\n\r\n      matrix.multiplyMatrices(camera.matrixWorld, matrix.getInverse(camera.projectionMatrix));\r\n      return this.applyProjection(matrix);\r\n\r\n    };\r\n\r\n  }(),\r\n\r\n  transformDirection: function(m) {\r\n\r\n    // input: THREE.Matrix4 affine matrix\r\n    // vector interpreted as a direction\r\n\r\n    var x = this.x,\r\n      y = this.y,\r\n      z = this.z;\r\n\r\n    var e = m.elements;\r\n\r\n    this.x = e[0] * x + e[4] * y + e[8] * z;\r\n    this.y = e[1] * x + e[5] * y + e[9] * z;\r\n    this.z = e[2] * x + e[6] * y + e[10] * z;\r\n\r\n    this.normalize();\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  divide: function(v) {\r\n\r\n    this.x /= v.x;\r\n    this.y /= v.y;\r\n    this.z /= v.z;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  divideScalar: function(scalar) {\r\n\r\n    if (scalar !== 0) {\r\n\r\n      var invScalar = 1 / scalar;\r\n\r\n      this.x *= invScalar;\r\n      this.y *= invScalar;\r\n      this.z *= invScalar;\r\n\r\n    }\r\n    else {\r\n\r\n      this.x = 0;\r\n      this.y = 0;\r\n      this.z = 0;\r\n\r\n    }\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  min: function(v) {\r\n\r\n    if (this.x > v.x) {\r\n\r\n      this.x = v.x;\r\n\r\n    }\r\n\r\n    if (this.y > v.y) {\r\n\r\n      this.y = v.y;\r\n\r\n    }\r\n\r\n    if (this.z > v.z) {\r\n\r\n      this.z = v.z;\r\n\r\n    }\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  max: function(v) {\r\n\r\n    if (this.x < v.x) {\r\n\r\n      this.x = v.x;\r\n\r\n    }\r\n\r\n    if (this.y < v.y) {\r\n\r\n      this.y = v.y;\r\n\r\n    }\r\n\r\n    if (this.z < v.z) {\r\n\r\n      this.z = v.z;\r\n\r\n    }\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  clamp: function(min, max) {\r\n\r\n    // This function assumes min < max, if this assumption isn't true it will not operate correctly\r\n\r\n    if (this.x < min.x) {\r\n\r\n      this.x = min.x;\r\n\r\n    }\r\n    else if (this.x > max.x) {\r\n\r\n      this.x = max.x;\r\n\r\n    }\r\n\r\n    if (this.y < min.y) {\r\n\r\n      this.y = min.y;\r\n\r\n    }\r\n    else if (this.y > max.y) {\r\n\r\n      this.y = max.y;\r\n\r\n    }\r\n\r\n    if (this.z < min.z) {\r\n\r\n      this.z = min.z;\r\n\r\n    }\r\n    else if (this.z > max.z) {\r\n\r\n      this.z = max.z;\r\n\r\n    }\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  clampScalar: (function() {\r\n\r\n    var min, max;\r\n\r\n    return function(minVal, maxVal) {\r\n\r\n      if (min === undefined) {\r\n\r\n        min = new THREE.Vector3();\r\n        max = new THREE.Vector3();\r\n\r\n      }\r\n\r\n      min.set(minVal, minVal, minVal);\r\n      max.set(maxVal, maxVal, maxVal);\r\n\r\n      return this.clamp(min, max);\r\n\r\n    };\r\n\r\n  })(),\r\n\r\n  floor: function() {\r\n\r\n    this.x = Math.floor(this.x);\r\n    this.y = Math.floor(this.y);\r\n    this.z = Math.floor(this.z);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  ceil: function() {\r\n\r\n    this.x = Math.ceil(this.x);\r\n    this.y = Math.ceil(this.y);\r\n    this.z = Math.ceil(this.z);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  round: function() {\r\n\r\n    this.x = Math.round(this.x);\r\n    this.y = Math.round(this.y);\r\n    this.z = Math.round(this.z);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  roundToZero: function() {\r\n\r\n    this.x = (this.x < 0) ? Math.ceil(this.x) : Math.floor(this.x);\r\n    this.y = (this.y < 0) ? Math.ceil(this.y) : Math.floor(this.y);\r\n    this.z = (this.z < 0) ? Math.ceil(this.z) : Math.floor(this.z);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  negate: function() {\r\n\r\n    this.x = -this.x;\r\n    this.y = -this.y;\r\n    this.z = -this.z;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  dot: function(v) {\r\n\r\n    return this.x * v.x + this.y * v.y + this.z * v.z;\r\n\r\n  },\r\n\r\n  lengthSq: function() {\r\n\r\n    return this.x * this.x + this.y * this.y + this.z * this.z;\r\n\r\n  },\r\n\r\n  length: function() {\r\n\r\n    return Math.sqrt(this.x * this.x + this.y * this.y + this.z * this.z);\r\n\r\n  },\r\n\r\n  lengthManhattan: function() {\r\n\r\n    return Math.abs(this.x) + Math.abs(this.y) + Math.abs(this.z);\r\n\r\n  },\r\n\r\n  normalize: function() {\r\n\r\n    return this.divideScalar(this.length());\r\n\r\n  },\r\n\r\n  setLength: function(l) {\r\n\r\n    var oldLength = this.length();\r\n\r\n    if (oldLength !== 0 && l !== oldLength) {\r\n\r\n      this.multiplyScalar(l / oldLength);\r\n    }\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  lerp: function(v, alpha) {\r\n\r\n    this.x += (v.x - this.x) * alpha;\r\n    this.y += (v.y - this.y) * alpha;\r\n    this.z += (v.z - this.z) * alpha;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  lerpVectors: function(v1, v2, alpha) {\r\n\r\n    this.subVectors(v2, v1).multiplyScalar(alpha).add(v1);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  cross: function(v, w) {\r\n\r\n    if (w !== undefined) {\r\n\r\n      THREE.warn('THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead.');\r\n      return this.crossVectors(v, w);\r\n\r\n    }\r\n\r\n    var x = this.x,\r\n      y = this.y,\r\n      z = this.z;\r\n\r\n    this.x = y * v.z - z * v.y;\r\n    this.y = z * v.x - x * v.z;\r\n    this.z = x * v.y - y * v.x;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  crossVectors: function(a, b) {\r\n\r\n    var ax = a.x,\r\n      ay = a.y,\r\n      az = a.z;\r\n    var bx = b.x,\r\n      by = b.y,\r\n      bz = b.z;\r\n\r\n    this.x = ay * bz - az * by;\r\n    this.y = az * bx - ax * bz;\r\n    this.z = ax * by - ay * bx;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  projectOnVector: function() {\r\n\r\n    var v1, dot;\r\n\r\n    return function(vector) {\r\n\r\n      if (v1 === undefined) v1 = new THREE.Vector3();\r\n\r\n      v1.copy(vector).normalize();\r\n\r\n      dot = this.dot(v1);\r\n\r\n      return this.copy(v1).multiplyScalar(dot);\r\n\r\n    };\r\n\r\n  }(),\r\n\r\n  projectOnPlane: function() {\r\n\r\n    var v1;\r\n\r\n    return function(planeNormal) {\r\n\r\n      if (v1 === undefined) v1 = new THREE.Vector3();\r\n\r\n      v1.copy(this).projectOnVector(planeNormal);\r\n\r\n      return this.sub(v1);\r\n\r\n    }\r\n\r\n  }(),\r\n\r\n  reflect: function() {\r\n\r\n    // reflect incident vector off plane orthogonal to normal\r\n    // normal is assumed to have unit length\r\n\r\n    var v1;\r\n\r\n    return function(normal) {\r\n\r\n      if (v1 === undefined) v1 = new THREE.Vector3();\r\n\r\n      return this.sub(v1.copy(normal).multiplyScalar(2 * this.dot(normal)));\r\n\r\n    }\r\n\r\n  }(),\r\n\r\n  angleTo: function(v) {\r\n\r\n    var theta = this.dot(v) / (this.length() * v.length());\r\n\r\n    // clamp, to handle numerical problems\r\n\r\n    return Math.acos(THREE.Math.clamp(theta, -1, 1));\r\n\r\n  },\r\n\r\n  distanceTo: function(v) {\r\n\r\n    return Math.sqrt(this.distanceToSquared(v));\r\n\r\n  },\r\n\r\n  distanceToSquared: function(v) {\r\n\r\n    var dx = this.x - v.x;\r\n    var dy = this.y - v.y;\r\n    var dz = this.z - v.z;\r\n\r\n    return dx * dx + dy * dy + dz * dz;\r\n\r\n  },\r\n\r\n  setEulerFromRotationMatrix: function(m, order) {\r\n\r\n    THREE.error('THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.');\r\n\r\n  },\r\n\r\n  setEulerFromQuaternion: function(q, order) {\r\n\r\n    THREE.error('THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.');\r\n\r\n  },\r\n\r\n  getPositionFromMatrix: function(m) {\r\n\r\n    THREE.warn('THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition().');\r\n\r\n    return this.setFromMatrixPosition(m);\r\n\r\n  },\r\n\r\n  getScaleFromMatrix: function(m) {\r\n\r\n    THREE.warn('THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale().');\r\n\r\n    return this.setFromMatrixScale(m);\r\n  },\r\n\r\n  getColumnFromMatrix: function(index, matrix) {\r\n\r\n    THREE.warn('THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn().');\r\n\r\n    return this.setFromMatrixColumn(index, matrix);\r\n\r\n  },\r\n\r\n  setFromMatrixPosition: function(m) {\r\n\r\n    this.x = m.elements[12];\r\n    this.y = m.elements[13];\r\n    this.z = m.elements[14];\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  setFromMatrixScale: function(m) {\r\n\r\n    var sx = this.set(m.elements[0], m.elements[1], m.elements[2]).length();\r\n    var sy = this.set(m.elements[4], m.elements[5], m.elements[6]).length();\r\n    var sz = this.set(m.elements[8], m.elements[9], m.elements[10]).length();\r\n\r\n    this.x = sx;\r\n    this.y = sy;\r\n    this.z = sz;\r\n\r\n    return this;\r\n  },\r\n\r\n  setFromMatrixColumn: function(index, matrix) {\r\n\r\n    var offset = index * 4;\r\n\r\n    var me = matrix.elements;\r\n\r\n    this.x = me[offset];\r\n    this.y = me[offset + 1];\r\n    this.z = me[offset + 2];\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  equals: function(v) {\r\n\r\n    return ((v.x === this.x) && (v.y === this.y) && (v.z === this.z));\r\n\r\n  },\r\n\r\n  fromArray: function(array, offset) {\r\n\r\n    if (offset === undefined) offset = 0;\r\n\r\n    this.x = array[offset];\r\n    this.y = array[offset + 1];\r\n    this.z = array[offset + 2];\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  toArray: function(array, offset) {\r\n\r\n    if (array === undefined) array = [];\r\n    if (offset === undefined) offset = 0;\r\n\r\n    array[offset] = this.x;\r\n    array[offset + 1] = this.y;\r\n    array[offset + 2] = this.z;\r\n\r\n    return array;\r\n\r\n  },\r\n\r\n  fromAttribute: function(attribute, index, offset) {\r\n\r\n    if (offset === undefined) offset = 0;\r\n\r\n    index = index * attribute.itemSize + offset;\r\n\r\n    this.x = attribute.array[index];\r\n    this.y = attribute.array[index + 1];\r\n    this.z = attribute.array[index + 2];\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  clone: function() {\r\n\r\n    return new THREE.Vector3(this.x, this.y, this.z);\r\n\r\n  }\r\n\r\n};\r\n\r\n// File:src/math/Vector4.js\r\n\r\n/**\r\n * @author supereggbert / http://www.paulbrunt.co.uk/\r\n * @author philogb / http://blog.thejit.org/\r\n * @author mikael emtinger / http://gomo.se/\r\n * @author egraether / http://egraether.com/\r\n * @author WestLangley / http://github.com/WestLangley\r\n */\r\n\r\nTHREE.Vector4 = function(x, y, z, w) {\r\n\r\n  this.x = x || 0;\r\n  this.y = y || 0;\r\n  this.z = z || 0;\r\n  this.w = (w !== undefined) ? w : 1;\r\n\r\n};\r\n\r\nTHREE.Vector4.prototype = {\r\n\r\n  constructor: THREE.Vector4,\r\n\r\n  set: function(x, y, z, w) {\r\n\r\n    this.x = x;\r\n    this.y = y;\r\n    this.z = z;\r\n    this.w = w;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  setX: function(x) {\r\n\r\n    this.x = x;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  setY: function(y) {\r\n\r\n    this.y = y;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  setZ: function(z) {\r\n\r\n    this.z = z;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  setW: function(w) {\r\n\r\n    this.w = w;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  setComponent: function(index, value) {\r\n\r\n    switch (index) {\r\n\r\n      case 0:\r\n        this.x = value;\r\n        break;\r\n      case 1:\r\n        this.y = value;\r\n        break;\r\n      case 2:\r\n        this.z = value;\r\n        break;\r\n      case 3:\r\n        this.w = value;\r\n        break;\r\n      default:\r\n        throw new Error('index is out of range: ' + index);\r\n\r\n    }\r\n\r\n  },\r\n\r\n  getComponent: function(index) {\r\n\r\n    switch (index) {\r\n\r\n      case 0:\r\n        return this.x;\r\n      case 1:\r\n        return this.y;\r\n      case 2:\r\n        return this.z;\r\n      case 3:\r\n        return this.w;\r\n      default:\r\n        throw new Error('index is out of range: ' + index);\r\n\r\n    }\r\n\r\n  },\r\n\r\n  copy: function(v) {\r\n\r\n    this.x = v.x;\r\n    this.y = v.y;\r\n    this.z = v.z;\r\n    this.w = (v.w !== undefined) ? v.w : 1;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  add: function(v, w) {\r\n\r\n    if (w !== undefined) {\r\n\r\n      THREE.warn('THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead.');\r\n      return this.addVectors(v, w);\r\n\r\n    }\r\n\r\n    this.x += v.x;\r\n    this.y += v.y;\r\n    this.z += v.z;\r\n    this.w += v.w;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  addScalar: function(s) {\r\n\r\n    this.x += s;\r\n    this.y += s;\r\n    this.z += s;\r\n    this.w += s;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  addVectors: function(a, b) {\r\n\r\n    this.x = a.x + b.x;\r\n    this.y = a.y + b.y;\r\n    this.z = a.z + b.z;\r\n    this.w = a.w + b.w;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  sub: function(v, w) {\r\n\r\n    if (w !== undefined) {\r\n\r\n      THREE.warn('THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead.');\r\n      return this.subVectors(v, w);\r\n\r\n    }\r\n\r\n    this.x -= v.x;\r\n    this.y -= v.y;\r\n    this.z -= v.z;\r\n    this.w -= v.w;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  subScalar: function(s) {\r\n\r\n    this.x -= s;\r\n    this.y -= s;\r\n    this.z -= s;\r\n    this.w -= s;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  subVectors: function(a, b) {\r\n\r\n    this.x = a.x - b.x;\r\n    this.y = a.y - b.y;\r\n    this.z = a.z - b.z;\r\n    this.w = a.w - b.w;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  multiplyScalar: function(scalar) {\r\n\r\n    this.x *= scalar;\r\n    this.y *= scalar;\r\n    this.z *= scalar;\r\n    this.w *= scalar;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  applyMatrix4: function(m) {\r\n\r\n    var x = this.x;\r\n    var y = this.y;\r\n    var z = this.z;\r\n    var w = this.w;\r\n\r\n    var e = m.elements;\r\n\r\n    this.x = e[0] * x + e[4] * y + e[8] * z + e[12] * w;\r\n    this.y = e[1] * x + e[5] * y + e[9] * z + e[13] * w;\r\n    this.z = e[2] * x + e[6] * y + e[10] * z + e[14] * w;\r\n    this.w = e[3] * x + e[7] * y + e[11] * z + e[15] * w;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  divideScalar: function(scalar) {\r\n\r\n    if (scalar !== 0) {\r\n\r\n      var invScalar = 1 / scalar;\r\n\r\n      this.x *= invScalar;\r\n      this.y *= invScalar;\r\n      this.z *= invScalar;\r\n      this.w *= invScalar;\r\n\r\n    }\r\n    else {\r\n\r\n      this.x = 0;\r\n      this.y = 0;\r\n      this.z = 0;\r\n      this.w = 1;\r\n\r\n    }\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  setAxisAngleFromQuaternion: function(q) {\r\n\r\n    // http://www.euclideanspace.com/maths/geometry/rotations/conversions/quaternionToAngle/index.htm\r\n\r\n    // q is assumed to be normalized\r\n\r\n    this.w = 2 * Math.acos(q.w);\r\n\r\n    var s = Math.sqrt(1 - q.w * q.w);\r\n\r\n    if (s < 0.0001) {\r\n\r\n      this.x = 1;\r\n      this.y = 0;\r\n      this.z = 0;\r\n\r\n    }\r\n    else {\r\n\r\n      this.x = q.x / s;\r\n      this.y = q.y / s;\r\n      this.z = q.z / s;\r\n\r\n    }\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  setAxisAngleFromRotationMatrix: function(m) {\r\n\r\n    // http://www.euclideanspace.com/maths/geometry/rotations/conversions/matrixToAngle/index.htm\r\n\r\n    // assumes the upper 3x3 of m is a pure rotation matrix (i.e, unscaled)\r\n\r\n    var angle, x, y, z, // variables for result\r\n      epsilon = 0.01, // margin to allow for rounding errors\r\n      epsilon2 = 0.1, // margin to distinguish between 0 and 180 degrees\r\n\r\n      te = m.elements,\r\n\r\n      m11 = te[0],\r\n      m12 = te[4],\r\n      m13 = te[8],\r\n      m21 = te[1],\r\n      m22 = te[5],\r\n      m23 = te[9],\r\n      m31 = te[2],\r\n      m32 = te[6],\r\n      m33 = te[10];\r\n\r\n    if ((Math.abs(m12 - m21) < epsilon) && (Math.abs(m13 - m31) < epsilon) && (Math.abs(m23 - m32) < epsilon)) {\r\n\r\n      // singularity found\r\n      // first check for identity matrix which must have +1 for all terms\r\n      // in leading diagonal and zero in other terms\r\n\r\n      if ((Math.abs(m12 + m21) < epsilon2) && (Math.abs(m13 + m31) < epsilon2) && (Math.abs(m23 + m32) < epsilon2) && (Math.abs(m11 + m22 + m33 - 3) < epsilon2)) {\r\n\r\n        // this singularity is identity matrix so angle = 0\r\n\r\n        this.set(1, 0, 0, 0);\r\n\r\n        return this; // zero angle, arbitrary axis\r\n\r\n      }\r\n\r\n      // otherwise this singularity is angle = 180\r\n\r\n      angle = Math.PI;\r\n\r\n      var xx = (m11 + 1) / 2;\r\n      var yy = (m22 + 1) / 2;\r\n      var zz = (m33 + 1) / 2;\r\n      var xy = (m12 + m21) / 4;\r\n      var xz = (m13 + m31) / 4;\r\n      var yz = (m23 + m32) / 4;\r\n\r\n      if ((xx > yy) && (xx > zz)) { // m11 is the largest diagonal term\r\n\r\n        if (xx < epsilon) {\r\n\r\n          x = 0;\r\n          y = 0.707106781;\r\n          z = 0.707106781;\r\n\r\n        }\r\n        else {\r\n\r\n          x = Math.sqrt(xx);\r\n          y = xy / x;\r\n          z = xz / x;\r\n\r\n        }\r\n\r\n      }\r\n      else if (yy > zz) { // m22 is the largest diagonal term\r\n\r\n        if (yy < epsilon) {\r\n\r\n          x = 0.707106781;\r\n          y = 0;\r\n          z = 0.707106781;\r\n\r\n        }\r\n        else {\r\n\r\n          y = Math.sqrt(yy);\r\n          x = xy / y;\r\n          z = yz / y;\r\n\r\n        }\r\n\r\n      }\r\n      else { // m33 is the largest diagonal term so base result on this\r\n\r\n        if (zz < epsilon) {\r\n\r\n          x = 0.707106781;\r\n          y = 0.707106781;\r\n          z = 0;\r\n\r\n        }\r\n        else {\r\n\r\n          z = Math.sqrt(zz);\r\n          x = xz / z;\r\n          y = yz / z;\r\n\r\n        }\r\n\r\n      }\r\n\r\n      this.set(x, y, z, angle);\r\n\r\n      return this; // return 180 deg rotation\r\n\r\n    }\r\n\r\n    // as we have reached here there are no singularities so we can handle normally\r\n\r\n    var s = Math.sqrt((m32 - m23) * (m32 - m23) + (m13 - m31) * (m13 - m31) + (m21 - m12) * (m21 - m12)); // used to normalize\r\n\r\n    if (Math.abs(s) < 0.001) s = 1;\r\n\r\n    // prevent divide by zero, should not happen if matrix is orthogonal and should be\r\n    // caught by singularity test above, but I've left it in just in case\r\n\r\n    this.x = (m32 - m23) / s;\r\n    this.y = (m13 - m31) / s;\r\n    this.z = (m21 - m12) / s;\r\n    this.w = Math.acos((m11 + m22 + m33 - 1) / 2);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  min: function(v) {\r\n\r\n    if (this.x > v.x) {\r\n\r\n      this.x = v.x;\r\n\r\n    }\r\n\r\n    if (this.y > v.y) {\r\n\r\n      this.y = v.y;\r\n\r\n    }\r\n\r\n    if (this.z > v.z) {\r\n\r\n      this.z = v.z;\r\n\r\n    }\r\n\r\n    if (this.w > v.w) {\r\n\r\n      this.w = v.w;\r\n\r\n    }\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  max: function(v) {\r\n\r\n    if (this.x < v.x) {\r\n\r\n      this.x = v.x;\r\n\r\n    }\r\n\r\n    if (this.y < v.y) {\r\n\r\n      this.y = v.y;\r\n\r\n    }\r\n\r\n    if (this.z < v.z) {\r\n\r\n      this.z = v.z;\r\n\r\n    }\r\n\r\n    if (this.w < v.w) {\r\n\r\n      this.w = v.w;\r\n\r\n    }\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  clamp: function(min, max) {\r\n\r\n    // This function assumes min < max, if this assumption isn't true it will not operate correctly\r\n\r\n    if (this.x < min.x) {\r\n\r\n      this.x = min.x;\r\n\r\n    }\r\n    else if (this.x > max.x) {\r\n\r\n      this.x = max.x;\r\n\r\n    }\r\n\r\n    if (this.y < min.y) {\r\n\r\n      this.y = min.y;\r\n\r\n    }\r\n    else if (this.y > max.y) {\r\n\r\n      this.y = max.y;\r\n\r\n    }\r\n\r\n    if (this.z < min.z) {\r\n\r\n      this.z = min.z;\r\n\r\n    }\r\n    else if (this.z > max.z) {\r\n\r\n      this.z = max.z;\r\n\r\n    }\r\n\r\n    if (this.w < min.w) {\r\n\r\n      this.w = min.w;\r\n\r\n    }\r\n    else if (this.w > max.w) {\r\n\r\n      this.w = max.w;\r\n\r\n    }\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  clampScalar: (function() {\r\n\r\n    var min, max;\r\n\r\n    return function(minVal, maxVal) {\r\n\r\n      if (min === undefined) {\r\n\r\n        min = new THREE.Vector4();\r\n        max = new THREE.Vector4();\r\n\r\n      }\r\n\r\n      min.set(minVal, minVal, minVal, minVal);\r\n      max.set(maxVal, maxVal, maxVal, maxVal);\r\n\r\n      return this.clamp(min, max);\r\n\r\n    };\r\n\r\n  })(),\r\n\r\n  floor: function() {\r\n\r\n    this.x = Math.floor(this.x);\r\n    this.y = Math.floor(this.y);\r\n    this.z = Math.floor(this.z);\r\n    this.w = Math.floor(this.w);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  ceil: function() {\r\n\r\n    this.x = Math.ceil(this.x);\r\n    this.y = Math.ceil(this.y);\r\n    this.z = Math.ceil(this.z);\r\n    this.w = Math.ceil(this.w);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  round: function() {\r\n\r\n    this.x = Math.round(this.x);\r\n    this.y = Math.round(this.y);\r\n    this.z = Math.round(this.z);\r\n    this.w = Math.round(this.w);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  roundToZero: function() {\r\n\r\n    this.x = (this.x < 0) ? Math.ceil(this.x) : Math.floor(this.x);\r\n    this.y = (this.y < 0) ? Math.ceil(this.y) : Math.floor(this.y);\r\n    this.z = (this.z < 0) ? Math.ceil(this.z) : Math.floor(this.z);\r\n    this.w = (this.w < 0) ? Math.ceil(this.w) : Math.floor(this.w);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  negate: function() {\r\n\r\n    this.x = -this.x;\r\n    this.y = -this.y;\r\n    this.z = -this.z;\r\n    this.w = -this.w;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  dot: function(v) {\r\n\r\n    return this.x * v.x + this.y * v.y + this.z * v.z + this.w * v.w;\r\n\r\n  },\r\n\r\n  lengthSq: function() {\r\n\r\n    return this.x * this.x + this.y * this.y + this.z * this.z + this.w * this.w;\r\n\r\n  },\r\n\r\n  length: function() {\r\n\r\n    return Math.sqrt(this.x * this.x + this.y * this.y + this.z * this.z + this.w * this.w);\r\n\r\n  },\r\n\r\n  lengthManhattan: function() {\r\n\r\n    return Math.abs(this.x) + Math.abs(this.y) + Math.abs(this.z) + Math.abs(this.w);\r\n\r\n  },\r\n\r\n  normalize: function() {\r\n\r\n    return this.divideScalar(this.length());\r\n\r\n  },\r\n\r\n  setLength: function(l) {\r\n\r\n    var oldLength = this.length();\r\n\r\n    if (oldLength !== 0 && l !== oldLength) {\r\n\r\n      this.multiplyScalar(l / oldLength);\r\n\r\n    }\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  lerp: function(v, alpha) {\r\n\r\n    this.x += (v.x - this.x) * alpha;\r\n    this.y += (v.y - this.y) * alpha;\r\n    this.z += (v.z - this.z) * alpha;\r\n    this.w += (v.w - this.w) * alpha;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  lerpVectors: function(v1, v2, alpha) {\r\n\r\n    this.subVectors(v2, v1).multiplyScalar(alpha).add(v1);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  equals: function(v) {\r\n\r\n    return ((v.x === this.x) && (v.y === this.y) && (v.z === this.z) && (v.w === this.w));\r\n\r\n  },\r\n\r\n  fromArray: function(array, offset) {\r\n\r\n    if (offset === undefined) offset = 0;\r\n\r\n    this.x = array[offset];\r\n    this.y = array[offset + 1];\r\n    this.z = array[offset + 2];\r\n    this.w = array[offset + 3];\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  toArray: function(array, offset) {\r\n\r\n    if (array === undefined) array = [];\r\n    if (offset === undefined) offset = 0;\r\n\r\n    array[offset] = this.x;\r\n    array[offset + 1] = this.y;\r\n    array[offset + 2] = this.z;\r\n    array[offset + 3] = this.w;\r\n\r\n    return array;\r\n\r\n  },\r\n\r\n  fromAttribute: function(attribute, index, offset) {\r\n\r\n    if (offset === undefined) offset = 0;\r\n\r\n    index = index * attribute.itemSize + offset;\r\n\r\n    this.x = attribute.array[index];\r\n    this.y = attribute.array[index + 1];\r\n    this.z = attribute.array[index + 2];\r\n    this.w = attribute.array[index + 3];\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  clone: function() {\r\n\r\n    return new THREE.Vector4(this.x, this.y, this.z, this.w);\r\n\r\n  }\r\n\r\n};\r\n\r\n// File:src/math/Euler.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author WestLangley / http://github.com/WestLangley\r\n * @author bhouston / http://exocortex.com\r\n */\r\n\r\nTHREE.Euler = function(x, y, z, order) {\r\n\r\n  this._x = x || 0;\r\n  this._y = y || 0;\r\n  this._z = z || 0;\r\n  this._order = order || THREE.Euler.DefaultOrder;\r\n\r\n};\r\n\r\nTHREE.Euler.RotationOrders = ['XYZ', 'YZX', 'ZXY', 'XZY', 'YXZ', 'ZYX'];\r\n\r\nTHREE.Euler.DefaultOrder = 'XYZ';\r\n\r\nTHREE.Euler.prototype = {\r\n\r\n  constructor: THREE.Euler,\r\n\r\n  _x: 0,\r\n  _y: 0,\r\n  _z: 0,\r\n  _order: THREE.Euler.DefaultOrder,\r\n\r\n  get x() {\r\n\r\n    return this._x;\r\n\r\n  },\r\n\r\n  set x(value) {\r\n\r\n    this._x = value;\r\n    this.onChangeCallback();\r\n\r\n  },\r\n\r\n  get y() {\r\n\r\n    return this._y;\r\n\r\n  },\r\n\r\n  set y(value) {\r\n\r\n    this._y = value;\r\n    this.onChangeCallback();\r\n\r\n  },\r\n\r\n  get z() {\r\n\r\n    return this._z;\r\n\r\n  },\r\n\r\n  set z(value) {\r\n\r\n    this._z = value;\r\n    this.onChangeCallback();\r\n\r\n  },\r\n\r\n  get order() {\r\n\r\n    return this._order;\r\n\r\n  },\r\n\r\n  set order(value) {\r\n\r\n    this._order = value;\r\n    this.onChangeCallback();\r\n\r\n  },\r\n\r\n  set: function(x, y, z, order) {\r\n\r\n    this._x = x;\r\n    this._y = y;\r\n    this._z = z;\r\n    this._order = order || this._order;\r\n\r\n    this.onChangeCallback();\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  copy: function(euler) {\r\n\r\n    this._x = euler._x;\r\n    this._y = euler._y;\r\n    this._z = euler._z;\r\n    this._order = euler._order;\r\n\r\n    this.onChangeCallback();\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  setFromRotationMatrix: function(m, order, update) {\r\n\r\n    var clamp = THREE.Math.clamp;\r\n\r\n    // assumes the upper 3x3 of m is a pure rotation matrix (i.e, unscaled)\r\n\r\n    var te = m.elements;\r\n    var m11 = te[0],\r\n      m12 = te[4],\r\n      m13 = te[8];\r\n    var m21 = te[1],\r\n      m22 = te[5],\r\n      m23 = te[9];\r\n    var m31 = te[2],\r\n      m32 = te[6],\r\n      m33 = te[10];\r\n\r\n    order = order || this._order;\r\n\r\n    if (order === 'XYZ') {\r\n\r\n      this._y = Math.asin(clamp(m13, -1, 1));\r\n\r\n      if (Math.abs(m13) < 0.99999) {\r\n\r\n        this._x = Math.atan2(-m23, m33);\r\n        this._z = Math.atan2(-m12, m11);\r\n\r\n      }\r\n      else {\r\n\r\n        this._x = Math.atan2(m32, m22);\r\n        this._z = 0;\r\n\r\n      }\r\n\r\n    }\r\n    else if (order === 'YXZ') {\r\n\r\n      this._x = Math.asin(-clamp(m23, -1, 1));\r\n\r\n      if (Math.abs(m23) < 0.99999) {\r\n\r\n        this._y = Math.atan2(m13, m33);\r\n        this._z = Math.atan2(m21, m22);\r\n\r\n      }\r\n      else {\r\n\r\n        this._y = Math.atan2(-m31, m11);\r\n        this._z = 0;\r\n\r\n      }\r\n\r\n    }\r\n    else if (order === 'ZXY') {\r\n\r\n      this._x = Math.asin(clamp(m32, -1, 1));\r\n\r\n      if (Math.abs(m32) < 0.99999) {\r\n\r\n        this._y = Math.atan2(-m31, m33);\r\n        this._z = Math.atan2(-m12, m22);\r\n\r\n      }\r\n      else {\r\n\r\n        this._y = 0;\r\n        this._z = Math.atan2(m21, m11);\r\n\r\n      }\r\n\r\n    }\r\n    else if (order === 'ZYX') {\r\n\r\n      this._y = Math.asin(-clamp(m31, -1, 1));\r\n\r\n      if (Math.abs(m31) < 0.99999) {\r\n\r\n        this._x = Math.atan2(m32, m33);\r\n        this._z = Math.atan2(m21, m11);\r\n\r\n      }\r\n      else {\r\n\r\n        this._x = 0;\r\n        this._z = Math.atan2(-m12, m22);\r\n\r\n      }\r\n\r\n    }\r\n    else if (order === 'YZX') {\r\n\r\n      this._z = Math.asin(clamp(m21, -1, 1));\r\n\r\n      if (Math.abs(m21) < 0.99999) {\r\n\r\n        this._x = Math.atan2(-m23, m22);\r\n        this._y = Math.atan2(-m31, m11);\r\n\r\n      }\r\n      else {\r\n\r\n        this._x = 0;\r\n        this._y = Math.atan2(m13, m33);\r\n\r\n      }\r\n\r\n    }\r\n    else if (order === 'XZY') {\r\n\r\n      this._z = Math.asin(-clamp(m12, -1, 1));\r\n\r\n      if (Math.abs(m12) < 0.99999) {\r\n\r\n        this._x = Math.atan2(m32, m22);\r\n        this._y = Math.atan2(m13, m11);\r\n\r\n      }\r\n      else {\r\n\r\n        this._x = Math.atan2(-m23, m33);\r\n        this._y = 0;\r\n\r\n      }\r\n\r\n    }\r\n    else {\r\n\r\n      THREE.warn('THREE.Euler: .setFromRotationMatrix() given unsupported order: ' + order)\r\n\r\n    }\r\n\r\n    this._order = order;\r\n\r\n    if (update !== false) this.onChangeCallback();\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  setFromQuaternion: function() {\r\n\r\n    var matrix;\r\n\r\n    return function(q, order, update) {\r\n\r\n      if (matrix === undefined) matrix = new THREE.Matrix4();\r\n      matrix.makeRotationFromQuaternion(q);\r\n      this.setFromRotationMatrix(matrix, order, update);\r\n\r\n      return this;\r\n\r\n    };\r\n\r\n  }(),\r\n\r\n  setFromVector3: function(v, order) {\r\n\r\n    return this.set(v.x, v.y, v.z, order || this._order);\r\n\r\n  },\r\n\r\n  reorder: function() {\r\n\r\n    // WARNING: this discards revolution information -bhouston\r\n\r\n    var q = new THREE.Quaternion();\r\n\r\n    return function(newOrder) {\r\n\r\n      q.setFromEuler(this);\r\n      this.setFromQuaternion(q, newOrder);\r\n\r\n    };\r\n\r\n  }(),\r\n\r\n  equals: function(euler) {\r\n\r\n    return (euler._x === this._x) && (euler._y === this._y) && (euler._z === this._z) && (euler._order === this._order);\r\n\r\n  },\r\n\r\n  fromArray: function(array) {\r\n\r\n    this._x = array[0];\r\n    this._y = array[1];\r\n    this._z = array[2];\r\n    if (array[3] !== undefined) this._order = array[3];\r\n\r\n    this.onChangeCallback();\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  toArray: function(array, offset) {\r\n\r\n    if (array === undefined) array = [];\r\n    if (offset === undefined) offset = 0;\r\n\r\n    array[offset] = this._x;\r\n    array[offset + 1] = this._y;\r\n    array[offset + 2] = this._z;\r\n    array[offset + 3] = this._order;\r\n\r\n    return array;\r\n  },\r\n\r\n  toVector3: function(optionalResult) {\r\n\r\n    if (optionalResult) {\r\n\r\n      return optionalResult.set(this._x, this._y, this._z);\r\n\r\n    }\r\n    else {\r\n\r\n      return new THREE.Vector3(this._x, this._y, this._z);\r\n\r\n    }\r\n\r\n  },\r\n\r\n  onChange: function(callback) {\r\n\r\n    this.onChangeCallback = callback;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  onChangeCallback: function() {},\r\n\r\n  clone: function() {\r\n\r\n    return new THREE.Euler(this._x, this._y, this._z, this._order);\r\n\r\n  }\r\n\r\n};\r\n\r\n// File:src/math/Line3.js\r\n\r\n/**\r\n * @author bhouston / http://exocortex.com\r\n */\r\n\r\nTHREE.Line3 = function(start, end) {\r\n\r\n  this.start = (start !== undefined) ? start : new THREE.Vector3();\r\n  this.end = (end !== undefined) ? end : new THREE.Vector3();\r\n\r\n};\r\n\r\nTHREE.Line3.prototype = {\r\n\r\n  constructor: THREE.Line3,\r\n\r\n  set: function(start, end) {\r\n\r\n    this.start.copy(start);\r\n    this.end.copy(end);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  copy: function(line) {\r\n\r\n    this.start.copy(line.start);\r\n    this.end.copy(line.end);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  center: function(optionalTarget) {\r\n\r\n    var result = optionalTarget || new THREE.Vector3();\r\n    return result.addVectors(this.start, this.end).multiplyScalar(0.5);\r\n\r\n  },\r\n\r\n  delta: function(optionalTarget) {\r\n\r\n    var result = optionalTarget || new THREE.Vector3();\r\n    return result.subVectors(this.end, this.start);\r\n\r\n  },\r\n\r\n  distanceSq: function() {\r\n\r\n    return this.start.distanceToSquared(this.end);\r\n\r\n  },\r\n\r\n  distance: function() {\r\n\r\n    return this.start.distanceTo(this.end);\r\n\r\n  },\r\n\r\n  at: function(t, optionalTarget) {\r\n\r\n    var result = optionalTarget || new THREE.Vector3();\r\n\r\n    return this.delta(result).multiplyScalar(t).add(this.start);\r\n\r\n  },\r\n\r\n  closestPointToPointParameter: function() {\r\n\r\n    var startP = new THREE.Vector3();\r\n    var startEnd = new THREE.Vector3();\r\n\r\n    return function(point, clampToLine) {\r\n\r\n      startP.subVectors(point, this.start);\r\n      startEnd.subVectors(this.end, this.start);\r\n\r\n      var startEnd2 = startEnd.dot(startEnd);\r\n      var startEnd_startP = startEnd.dot(startP);\r\n\r\n      var t = startEnd_startP / startEnd2;\r\n\r\n      if (clampToLine) {\r\n\r\n        t = THREE.Math.clamp(t, 0, 1);\r\n\r\n      }\r\n\r\n      return t;\r\n\r\n    };\r\n\r\n  }(),\r\n\r\n  closestPointToPoint: function(point, clampToLine, optionalTarget) {\r\n\r\n    var t = this.closestPointToPointParameter(point, clampToLine);\r\n\r\n    var result = optionalTarget || new THREE.Vector3();\r\n\r\n    return this.delta(result).multiplyScalar(t).add(this.start);\r\n\r\n  },\r\n\r\n  applyMatrix4: function(matrix) {\r\n\r\n    this.start.applyMatrix4(matrix);\r\n    this.end.applyMatrix4(matrix);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  equals: function(line) {\r\n\r\n    return line.start.equals(this.start) && line.end.equals(this.end);\r\n\r\n  },\r\n\r\n  clone: function() {\r\n\r\n    return new THREE.Line3().copy(this);\r\n\r\n  }\r\n\r\n};\r\n\r\n// File:src/math/Box2.js\r\n\r\n/**\r\n * @author bhouston / http://exocortex.com\r\n */\r\n\r\nTHREE.Box2 = function(min, max) {\r\n\r\n  this.min = (min !== undefined) ? min : new THREE.Vector2(Infinity, Infinity);\r\n  this.max = (max !== undefined) ? max : new THREE.Vector2(-Infinity, -Infinity);\r\n\r\n};\r\n\r\nTHREE.Box2.prototype = {\r\n\r\n  constructor: THREE.Box2,\r\n\r\n  set: function(min, max) {\r\n\r\n    this.min.copy(min);\r\n    this.max.copy(max);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  setFromPoints: function(points) {\r\n\r\n    this.makeEmpty();\r\n\r\n    for (var i = 0, il = points.length; i < il; i++) {\r\n\r\n      this.expandByPoint(points[i])\r\n\r\n    }\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  setFromCenterAndSize: function() {\r\n\r\n    var v1 = new THREE.Vector2();\r\n\r\n    return function(center, size) {\r\n\r\n      var halfSize = v1.copy(size).multiplyScalar(0.5);\r\n      this.min.copy(center).sub(halfSize);\r\n      this.max.copy(center).add(halfSize);\r\n\r\n      return this;\r\n\r\n    };\r\n\r\n  }(),\r\n\r\n  copy: function(box) {\r\n\r\n    this.min.copy(box.min);\r\n    this.max.copy(box.max);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  makeEmpty: function() {\r\n\r\n    this.min.x = this.min.y = Infinity;\r\n    this.max.x = this.max.y = -Infinity;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  empty: function() {\r\n\r\n    // this is a more robust check for empty than ( volume <= 0 ) because volume can get positive with two negative axes\r\n\r\n    return (this.max.x < this.min.x) || (this.max.y < this.min.y);\r\n\r\n  },\r\n\r\n  center: function(optionalTarget) {\r\n\r\n    var result = optionalTarget || new THREE.Vector2();\r\n    return result.addVectors(this.min, this.max).multiplyScalar(0.5);\r\n\r\n  },\r\n\r\n  size: function(optionalTarget) {\r\n\r\n    var result = optionalTarget || new THREE.Vector2();\r\n    return result.subVectors(this.max, this.min);\r\n\r\n  },\r\n\r\n  expandByPoint: function(point) {\r\n\r\n    this.min.min(point);\r\n    this.max.max(point);\r\n\r\n    return this;\r\n  },\r\n\r\n  expandByVector: function(vector) {\r\n\r\n    this.min.sub(vector);\r\n    this.max.add(vector);\r\n\r\n    return this;\r\n  },\r\n\r\n  expandByScalar: function(scalar) {\r\n\r\n    this.min.addScalar(-scalar);\r\n    this.max.addScalar(scalar);\r\n\r\n    return this;\r\n  },\r\n\r\n  containsPoint: function(point) {\r\n\r\n    if (point.x < this.min.x || point.x > this.max.x ||\r\n      point.y < this.min.y || point.y > this.max.y) {\r\n\r\n      return false;\r\n\r\n    }\r\n\r\n    return true;\r\n\r\n  },\r\n\r\n  containsBox: function(box) {\r\n\r\n    if ((this.min.x <= box.min.x) && (box.max.x <= this.max.x) &&\r\n      (this.min.y <= box.min.y) && (box.max.y <= this.max.y)) {\r\n\r\n      return true;\r\n\r\n    }\r\n\r\n    return false;\r\n\r\n  },\r\n\r\n  getParameter: function(point, optionalTarget) {\r\n\r\n    // This can potentially have a divide by zero if the box\r\n    // has a size dimension of 0.\r\n\r\n    var result = optionalTarget || new THREE.Vector2();\r\n\r\n    return result.set(\r\n      (point.x - this.min.x) / (this.max.x - this.min.x), (point.y - this.min.y) / (this.max.y - this.min.y)\r\n    );\r\n\r\n  },\r\n\r\n  isIntersectionBox: function(box) {\r\n\r\n    // using 6 splitting planes to rule out intersections.\r\n\r\n    if (box.max.x < this.min.x || box.min.x > this.max.x ||\r\n      box.max.y < this.min.y || box.min.y > this.max.y) {\r\n\r\n      return false;\r\n\r\n    }\r\n\r\n    return true;\r\n\r\n  },\r\n\r\n  clampPoint: function(point, optionalTarget) {\r\n\r\n    var result = optionalTarget || new THREE.Vector2();\r\n    return result.copy(point).clamp(this.min, this.max);\r\n\r\n  },\r\n\r\n  distanceToPoint: function() {\r\n\r\n    var v1 = new THREE.Vector2();\r\n\r\n    return function(point) {\r\n\r\n      var clampedPoint = v1.copy(point).clamp(this.min, this.max);\r\n      return clampedPoint.sub(point).length();\r\n\r\n    };\r\n\r\n  }(),\r\n\r\n  intersect: function(box) {\r\n\r\n    this.min.max(box.min);\r\n    this.max.min(box.max);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  union: function(box) {\r\n\r\n    this.min.min(box.min);\r\n    this.max.max(box.max);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  translate: function(offset) {\r\n\r\n    this.min.add(offset);\r\n    this.max.add(offset);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  equals: function(box) {\r\n\r\n    return box.min.equals(this.min) && box.max.equals(this.max);\r\n\r\n  },\r\n\r\n  clone: function() {\r\n\r\n    return new THREE.Box2().copy(this);\r\n\r\n  }\r\n\r\n};\r\n\r\n// File:src/math/Box3.js\r\n\r\n/**\r\n * @author bhouston / http://exocortex.com\r\n * @author WestLangley / http://github.com/WestLangley\r\n */\r\n\r\nTHREE.Box3 = function(min, max) {\r\n\r\n  this.min = (min !== undefined) ? min : new THREE.Vector3(Infinity, Infinity, Infinity);\r\n  this.max = (max !== undefined) ? max : new THREE.Vector3(-Infinity, -Infinity, -Infinity);\r\n\r\n};\r\n\r\nTHREE.Box3.prototype = {\r\n\r\n  constructor: THREE.Box3,\r\n\r\n  set: function(min, max) {\r\n\r\n    this.min.copy(min);\r\n    this.max.copy(max);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  setFromPoints: function(points) {\r\n\r\n    this.makeEmpty();\r\n\r\n    for (var i = 0, il = points.length; i < il; i++) {\r\n\r\n      this.expandByPoint(points[i])\r\n\r\n    }\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  setFromCenterAndSize: function() {\r\n\r\n    var v1 = new THREE.Vector3();\r\n\r\n    return function(center, size) {\r\n\r\n      var halfSize = v1.copy(size).multiplyScalar(0.5);\r\n\r\n      this.min.copy(center).sub(halfSize);\r\n      this.max.copy(center).add(halfSize);\r\n\r\n      return this;\r\n\r\n    };\r\n\r\n  }(),\r\n\r\n  setFromObject: function() {\r\n\r\n    // Computes the world-axis-aligned bounding box of an object (including its children),\r\n    // accounting for both the object's, and childrens', world transforms\r\n\r\n    var v1 = new THREE.Vector3();\r\n\r\n    return function(object) {\r\n\r\n      var scope = this;\r\n\r\n      object.updateMatrixWorld(true);\r\n\r\n      this.makeEmpty();\r\n\r\n      object.traverse(function(node) {\r\n\r\n        var geometry = node.geometry;\r\n\r\n        if (geometry !== undefined) {\r\n\r\n          if (geometry instanceof THREE.Geometry) {\r\n\r\n            var vertices = geometry.vertices;\r\n\r\n            for (var i = 0, il = vertices.length; i < il; i++) {\r\n\r\n              v1.copy(vertices[i]);\r\n\r\n              v1.applyMatrix4(node.matrixWorld);\r\n\r\n              scope.expandByPoint(v1);\r\n\r\n            }\r\n\r\n          }\r\n          else if (geometry instanceof THREE.BufferGeometry && geometry.attributes['position'] !== undefined) {\r\n\r\n            var positions = geometry.attributes['position'].array;\r\n\r\n            for (var i = 0, il = positions.length; i < il; i += 3) {\r\n\r\n              v1.set(positions[i], positions[i + 1], positions[i + 2]);\r\n\r\n              v1.applyMatrix4(node.matrixWorld);\r\n\r\n              scope.expandByPoint(v1);\r\n\r\n            }\r\n\r\n          }\r\n\r\n        }\r\n\r\n      });\r\n\r\n      return this;\r\n\r\n    };\r\n\r\n  }(),\r\n\r\n  copy: function(box) {\r\n\r\n    this.min.copy(box.min);\r\n    this.max.copy(box.max);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  makeEmpty: function() {\r\n\r\n    this.min.x = this.min.y = this.min.z = Infinity;\r\n    this.max.x = this.max.y = this.max.z = -Infinity;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  empty: function() {\r\n\r\n    // this is a more robust check for empty than ( volume <= 0 ) because volume can get positive with two negative axes\r\n\r\n    return (this.max.x < this.min.x) || (this.max.y < this.min.y) || (this.max.z < this.min.z);\r\n\r\n  },\r\n\r\n  center: function(optionalTarget) {\r\n\r\n    var result = optionalTarget || new THREE.Vector3();\r\n    return result.addVectors(this.min, this.max).multiplyScalar(0.5);\r\n\r\n  },\r\n\r\n  size: function(optionalTarget) {\r\n\r\n    var result = optionalTarget || new THREE.Vector3();\r\n    return result.subVectors(this.max, this.min);\r\n\r\n  },\r\n\r\n  expandByPoint: function(point) {\r\n\r\n    this.min.min(point);\r\n    this.max.max(point);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  expandByVector: function(vector) {\r\n\r\n    this.min.sub(vector);\r\n    this.max.add(vector);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  expandByScalar: function(scalar) {\r\n\r\n    this.min.addScalar(-scalar);\r\n    this.max.addScalar(scalar);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  containsPoint: function(point) {\r\n\r\n    if (point.x < this.min.x || point.x > this.max.x ||\r\n      point.y < this.min.y || point.y > this.max.y ||\r\n      point.z < this.min.z || point.z > this.max.z) {\r\n\r\n      return false;\r\n\r\n    }\r\n\r\n    return true;\r\n\r\n  },\r\n\r\n  containsBox: function(box) {\r\n\r\n    if ((this.min.x <= box.min.x) && (box.max.x <= this.max.x) &&\r\n      (this.min.y <= box.min.y) && (box.max.y <= this.max.y) &&\r\n      (this.min.z <= box.min.z) && (box.max.z <= this.max.z)) {\r\n\r\n      return true;\r\n\r\n    }\r\n\r\n    return false;\r\n\r\n  },\r\n\r\n  getParameter: function(point, optionalTarget) {\r\n\r\n    // This can potentially have a divide by zero if the box\r\n    // has a size dimension of 0.\r\n\r\n    var result = optionalTarget || new THREE.Vector3();\r\n\r\n    return result.set(\r\n      (point.x - this.min.x) / (this.max.x - this.min.x), (point.y - this.min.y) / (this.max.y - this.min.y), (point.z - this.min.z) / (this.max.z - this.min.z)\r\n    );\r\n\r\n  },\r\n\r\n  isIntersectionBox: function(box) {\r\n\r\n    // using 6 splitting planes to rule out intersections.\r\n\r\n    if (box.max.x < this.min.x || box.min.x > this.max.x ||\r\n      box.max.y < this.min.y || box.min.y > this.max.y ||\r\n      box.max.z < this.min.z || box.min.z > this.max.z) {\r\n\r\n      return false;\r\n\r\n    }\r\n\r\n    return true;\r\n\r\n  },\r\n\r\n  clampPoint: function(point, optionalTarget) {\r\n\r\n    var result = optionalTarget || new THREE.Vector3();\r\n    return result.copy(point).clamp(this.min, this.max);\r\n\r\n  },\r\n\r\n  distanceToPoint: function() {\r\n\r\n    var v1 = new THREE.Vector3();\r\n\r\n    return function(point) {\r\n\r\n      var clampedPoint = v1.copy(point).clamp(this.min, this.max);\r\n      return clampedPoint.sub(point).length();\r\n\r\n    };\r\n\r\n  }(),\r\n\r\n  getBoundingSphere: function() {\r\n\r\n    var v1 = new THREE.Vector3();\r\n\r\n    return function(optionalTarget) {\r\n\r\n      var result = optionalTarget || new THREE.Sphere();\r\n\r\n      result.center = this.center();\r\n      result.radius = this.size(v1).length() * 0.5;\r\n\r\n      return result;\r\n\r\n    };\r\n\r\n  }(),\r\n\r\n  intersect: function(box) {\r\n\r\n    this.min.max(box.min);\r\n    this.max.min(box.max);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  union: function(box) {\r\n\r\n    this.min.min(box.min);\r\n    this.max.max(box.max);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  applyMatrix4: function() {\r\n\r\n    var points = [\r\n      new THREE.Vector3(),\r\n      new THREE.Vector3(),\r\n      new THREE.Vector3(),\r\n      new THREE.Vector3(),\r\n      new THREE.Vector3(),\r\n      new THREE.Vector3(),\r\n      new THREE.Vector3(),\r\n      new THREE.Vector3()\r\n    ];\r\n\r\n    return function(matrix) {\r\n\r\n      // NOTE: I am using a binary pattern to specify all 2^3 combinations below\r\n      points[0].set(this.min.x, this.min.y, this.min.z).applyMatrix4(matrix); // 000\r\n      points[1].set(this.min.x, this.min.y, this.max.z).applyMatrix4(matrix); // 001\r\n      points[2].set(this.min.x, this.max.y, this.min.z).applyMatrix4(matrix); // 010\r\n      points[3].set(this.min.x, this.max.y, this.max.z).applyMatrix4(matrix); // 011\r\n      points[4].set(this.max.x, this.min.y, this.min.z).applyMatrix4(matrix); // 100\r\n      points[5].set(this.max.x, this.min.y, this.max.z).applyMatrix4(matrix); // 101\r\n      points[6].set(this.max.x, this.max.y, this.min.z).applyMatrix4(matrix); // 110\r\n      points[7].set(this.max.x, this.max.y, this.max.z).applyMatrix4(matrix); // 111\r\n\r\n      this.makeEmpty();\r\n      this.setFromPoints(points);\r\n\r\n      return this;\r\n\r\n    };\r\n\r\n  }(),\r\n\r\n  translate: function(offset) {\r\n\r\n    this.min.add(offset);\r\n    this.max.add(offset);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  equals: function(box) {\r\n\r\n    return box.min.equals(this.min) && box.max.equals(this.max);\r\n\r\n  },\r\n\r\n  clone: function() {\r\n\r\n    return new THREE.Box3().copy(this);\r\n\r\n  }\r\n\r\n};\r\n\r\n// File:src/math/Matrix3.js\r\n\r\n/**\r\n * @author alteredq / http://alteredqualia.com/\r\n * @author WestLangley / http://github.com/WestLangley\r\n * @author bhouston / http://exocortex.com\r\n */\r\n\r\nTHREE.Matrix3 = function() {\r\n\r\n  this.elements = new Float32Array([\r\n\r\n    1, 0, 0,\r\n    0, 1, 0,\r\n    0, 0, 1\r\n\r\n  ]);\r\n\r\n  if (arguments.length > 0) {\r\n\r\n    THREE.error('THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.');\r\n\r\n  }\r\n\r\n};\r\n\r\nTHREE.Matrix3.prototype = {\r\n\r\n  constructor: THREE.Matrix3,\r\n\r\n  set: function(n11, n12, n13, n21, n22, n23, n31, n32, n33) {\r\n\r\n    var te = this.elements;\r\n\r\n    te[0] = n11;\r\n    te[3] = n12;\r\n    te[6] = n13;\r\n    te[1] = n21;\r\n    te[4] = n22;\r\n    te[7] = n23;\r\n    te[2] = n31;\r\n    te[5] = n32;\r\n    te[8] = n33;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  identity: function() {\r\n\r\n    this.set(\r\n\r\n      1, 0, 0,\r\n      0, 1, 0,\r\n      0, 0, 1\r\n\r\n    );\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  copy: function(m) {\r\n\r\n    var me = m.elements;\r\n\r\n    this.set(\r\n\r\n      me[0], me[3], me[6],\r\n      me[1], me[4], me[7],\r\n      me[2], me[5], me[8]\r\n\r\n    );\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  multiplyVector3: function(vector) {\r\n\r\n    THREE.warn('THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead.');\r\n    return vector.applyMatrix3(this);\r\n\r\n  },\r\n\r\n  multiplyVector3Array: function(a) {\r\n\r\n    THREE.warn('THREE.Matrix3: .multiplyVector3Array() has been renamed. Use matrix.applyToVector3Array( array ) instead.');\r\n    return this.applyToVector3Array(a);\r\n\r\n  },\r\n\r\n  applyToVector3Array: function() {\r\n\r\n    var v1 = new THREE.Vector3();\r\n\r\n    return function(array, offset, length) {\r\n\r\n      if (offset === undefined) offset = 0;\r\n      if (length === undefined) length = array.length;\r\n\r\n      for (var i = 0, j = offset; i < length; i += 3, j += 3) {\r\n\r\n        v1.x = array[j];\r\n        v1.y = array[j + 1];\r\n        v1.z = array[j + 2];\r\n\r\n        v1.applyMatrix3(this);\r\n\r\n        array[j] = v1.x;\r\n        array[j + 1] = v1.y;\r\n        array[j + 2] = v1.z;\r\n\r\n      }\r\n\r\n      return array;\r\n\r\n    };\r\n\r\n  }(),\r\n\r\n  multiplyScalar: function(s) {\r\n\r\n    var te = this.elements;\r\n\r\n    te[0] *= s;\r\n    te[3] *= s;\r\n    te[6] *= s;\r\n    te[1] *= s;\r\n    te[4] *= s;\r\n    te[7] *= s;\r\n    te[2] *= s;\r\n    te[5] *= s;\r\n    te[8] *= s;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  determinant: function() {\r\n\r\n    var te = this.elements;\r\n\r\n    var a = te[0],\r\n      b = te[1],\r\n      c = te[2],\r\n      d = te[3],\r\n      e = te[4],\r\n      f = te[5],\r\n      g = te[6],\r\n      h = te[7],\r\n      i = te[8];\r\n\r\n    return a * e * i - a * f * h - b * d * i + b * f * g + c * d * h - c * e * g;\r\n\r\n  },\r\n\r\n  getInverse: function(matrix, throwOnInvertible) {\r\n\r\n    // input: THREE.Matrix4\r\n    // ( based on http://code.google.com/p/webgl-mjs/ )\r\n\r\n    var me = matrix.elements;\r\n    var te = this.elements;\r\n\r\n    te[0] = me[10] * me[5] - me[6] * me[9];\r\n    te[1] = -me[10] * me[1] + me[2] * me[9];\r\n    te[2] = me[6] * me[1] - me[2] * me[5];\r\n    te[3] = -me[10] * me[4] + me[6] * me[8];\r\n    te[4] = me[10] * me[0] - me[2] * me[8];\r\n    te[5] = -me[6] * me[0] + me[2] * me[4];\r\n    te[6] = me[9] * me[4] - me[5] * me[8];\r\n    te[7] = -me[9] * me[0] + me[1] * me[8];\r\n    te[8] = me[5] * me[0] - me[1] * me[4];\r\n\r\n    var det = me[0] * te[0] + me[1] * te[3] + me[2] * te[6];\r\n\r\n    // no inverse\r\n\r\n    if (det === 0) {\r\n\r\n      var msg = \"Matrix3.getInverse(): can't invert matrix, determinant is 0\";\r\n\r\n      if (throwOnInvertible || false) {\r\n\r\n        throw new Error(msg);\r\n\r\n      }\r\n      else {\r\n\r\n        THREE.warn(msg);\r\n\r\n      }\r\n\r\n      this.identity();\r\n\r\n      return this;\r\n\r\n    }\r\n\r\n    this.multiplyScalar(1.0 / det);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  transpose: function() {\r\n\r\n    var tmp, m = this.elements;\r\n\r\n    tmp = m[1];\r\n    m[1] = m[3];\r\n    m[3] = tmp;\r\n    tmp = m[2];\r\n    m[2] = m[6];\r\n    m[6] = tmp;\r\n    tmp = m[5];\r\n    m[5] = m[7];\r\n    m[7] = tmp;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  flattenToArrayOffset: function(array, offset) {\r\n\r\n    var te = this.elements;\r\n\r\n    array[offset] = te[0];\r\n    array[offset + 1] = te[1];\r\n    array[offset + 2] = te[2];\r\n\r\n    array[offset + 3] = te[3];\r\n    array[offset + 4] = te[4];\r\n    array[offset + 5] = te[5];\r\n\r\n    array[offset + 6] = te[6];\r\n    array[offset + 7] = te[7];\r\n    array[offset + 8] = te[8];\r\n\r\n    return array;\r\n\r\n  },\r\n\r\n  getNormalMatrix: function(m) {\r\n\r\n    // input: THREE.Matrix4\r\n\r\n    this.getInverse(m).transpose();\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  transposeIntoArray: function(r) {\r\n\r\n    var m = this.elements;\r\n\r\n    r[0] = m[0];\r\n    r[1] = m[3];\r\n    r[2] = m[6];\r\n    r[3] = m[1];\r\n    r[4] = m[4];\r\n    r[5] = m[7];\r\n    r[6] = m[2];\r\n    r[7] = m[5];\r\n    r[8] = m[8];\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  fromArray: function(array) {\r\n\r\n    this.elements.set(array);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  toArray: function() {\r\n\r\n    var te = this.elements;\r\n\r\n    return [\r\n      te[0], te[1], te[2],\r\n      te[3], te[4], te[5],\r\n      te[6], te[7], te[8]\r\n    ];\r\n\r\n  },\r\n\r\n  clone: function() {\r\n\r\n    return new THREE.Matrix3().fromArray(this.elements);\r\n\r\n  }\r\n\r\n};\r\n\r\n// File:src/math/Matrix4.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author supereggbert / http://www.paulbrunt.co.uk/\r\n * @author philogb / http://blog.thejit.org/\r\n * @author jordi_ros / http://plattsoft.com\r\n * @author D1plo1d / http://github.com/D1plo1d\r\n * @author alteredq / http://alteredqualia.com/\r\n * @author mikael emtinger / http://gomo.se/\r\n * @author timknip / http://www.floorplanner.com/\r\n * @author bhouston / http://exocortex.com\r\n * @author WestLangley / http://github.com/WestLangley\r\n */\r\n\r\nTHREE.Matrix4 = function() {\r\n\r\n  this.elements = new Float32Array([\r\n\r\n    1, 0, 0, 0,\r\n    0, 1, 0, 0,\r\n    0, 0, 1, 0,\r\n    0, 0, 0, 1\r\n\r\n  ]);\r\n\r\n  if (arguments.length > 0) {\r\n\r\n    THREE.error('THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.');\r\n\r\n  }\r\n\r\n};\r\n\r\nTHREE.Matrix4.prototype = {\r\n\r\n  constructor: THREE.Matrix4,\r\n\r\n  set: function(n11, n12, n13, n14, n21, n22, n23, n24, n31, n32, n33, n34, n41, n42, n43, n44) {\r\n\r\n    var te = this.elements;\r\n\r\n    te[0] = n11;\r\n    te[4] = n12;\r\n    te[8] = n13;\r\n    te[12] = n14;\r\n    te[1] = n21;\r\n    te[5] = n22;\r\n    te[9] = n23;\r\n    te[13] = n24;\r\n    te[2] = n31;\r\n    te[6] = n32;\r\n    te[10] = n33;\r\n    te[14] = n34;\r\n    te[3] = n41;\r\n    te[7] = n42;\r\n    te[11] = n43;\r\n    te[15] = n44;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  identity: function() {\r\n\r\n    this.set(\r\n\r\n      1, 0, 0, 0,\r\n      0, 1, 0, 0,\r\n      0, 0, 1, 0,\r\n      0, 0, 0, 1\r\n\r\n    );\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  copy: function(m) {\r\n\r\n    this.elements.set(m.elements);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  extractPosition: function(m) {\r\n\r\n    THREE.warn('THREE.Matrix4: .extractPosition() has been renamed to .copyPosition().');\r\n    return this.copyPosition(m);\r\n\r\n  },\r\n\r\n  copyPosition: function(m) {\r\n\r\n    var te = this.elements;\r\n    var me = m.elements;\r\n\r\n    te[12] = me[12];\r\n    te[13] = me[13];\r\n    te[14] = me[14];\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  extractBasis: function(xAxis, yAxis, zAxis) {\r\n\r\n    var te = this.elements;\r\n\r\n    xAxis.set(te[0], te[1], te[2]);\r\n    yAxis.set(te[4], te[5], te[6]);\r\n    zAxis.set(te[8], te[9], te[10]);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  makeBasis: function(xAxis, yAxis, zAxis) {\r\n\r\n    this.set(\r\n      xAxis.x, yAxis.x, zAxis.x, 0,\r\n      xAxis.y, yAxis.y, zAxis.y, 0,\r\n      xAxis.z, yAxis.z, zAxis.z, 0,\r\n      0, 0, 0, 1\r\n    );\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  extractRotation: function() {\r\n\r\n    var v1 = new THREE.Vector3();\r\n\r\n    return function(m) {\r\n\r\n      var te = this.elements;\r\n      var me = m.elements;\r\n\r\n      var scaleX = 1 / v1.set(me[0], me[1], me[2]).length();\r\n      var scaleY = 1 / v1.set(me[4], me[5], me[6]).length();\r\n      var scaleZ = 1 / v1.set(me[8], me[9], me[10]).length();\r\n\r\n      te[0] = me[0] * scaleX;\r\n      te[1] = me[1] * scaleX;\r\n      te[2] = me[2] * scaleX;\r\n\r\n      te[4] = me[4] * scaleY;\r\n      te[5] = me[5] * scaleY;\r\n      te[6] = me[6] * scaleY;\r\n\r\n      te[8] = me[8] * scaleZ;\r\n      te[9] = me[9] * scaleZ;\r\n      te[10] = me[10] * scaleZ;\r\n\r\n      return this;\r\n\r\n    };\r\n\r\n  }(),\r\n\r\n  makeRotationFromEuler: function(euler) {\r\n\r\n    if (euler instanceof THREE.Euler === false) {\r\n\r\n      THREE.error('THREE.Matrix: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.');\r\n\r\n    }\r\n\r\n    var te = this.elements;\r\n\r\n    var x = euler.x,\r\n      y = euler.y,\r\n      z = euler.z;\r\n    var a = Math.cos(x),\r\n      b = Math.sin(x);\r\n    var c = Math.cos(y),\r\n      d = Math.sin(y);\r\n    var e = Math.cos(z),\r\n      f = Math.sin(z);\r\n\r\n    if (euler.order === 'XYZ') {\r\n\r\n      var ae = a * e,\r\n        af = a * f,\r\n        be = b * e,\r\n        bf = b * f;\r\n\r\n      te[0] = c * e;\r\n      te[4] = -c * f;\r\n      te[8] = d;\r\n\r\n      te[1] = af + be * d;\r\n      te[5] = ae - bf * d;\r\n      te[9] = -b * c;\r\n\r\n      te[2] = bf - ae * d;\r\n      te[6] = be + af * d;\r\n      te[10] = a * c;\r\n\r\n    }\r\n    else if (euler.order === 'YXZ') {\r\n\r\n      var ce = c * e,\r\n        cf = c * f,\r\n        de = d * e,\r\n        df = d * f;\r\n\r\n      te[0] = ce + df * b;\r\n      te[4] = de * b - cf;\r\n      te[8] = a * d;\r\n\r\n      te[1] = a * f;\r\n      te[5] = a * e;\r\n      te[9] = -b;\r\n\r\n      te[2] = cf * b - de;\r\n      te[6] = df + ce * b;\r\n      te[10] = a * c;\r\n\r\n    }\r\n    else if (euler.order === 'ZXY') {\r\n\r\n      var ce = c * e,\r\n        cf = c * f,\r\n        de = d * e,\r\n        df = d * f;\r\n\r\n      te[0] = ce - df * b;\r\n      te[4] = -a * f;\r\n      te[8] = de + cf * b;\r\n\r\n      te[1] = cf + de * b;\r\n      te[5] = a * e;\r\n      te[9] = df - ce * b;\r\n\r\n      te[2] = -a * d;\r\n      te[6] = b;\r\n      te[10] = a * c;\r\n\r\n    }\r\n    else if (euler.order === 'ZYX') {\r\n\r\n      var ae = a * e,\r\n        af = a * f,\r\n        be = b * e,\r\n        bf = b * f;\r\n\r\n      te[0] = c * e;\r\n      te[4] = be * d - af;\r\n      te[8] = ae * d + bf;\r\n\r\n      te[1] = c * f;\r\n      te[5] = bf * d + ae;\r\n      te[9] = af * d - be;\r\n\r\n      te[2] = -d;\r\n      te[6] = b * c;\r\n      te[10] = a * c;\r\n\r\n    }\r\n    else if (euler.order === 'YZX') {\r\n\r\n      var ac = a * c,\r\n        ad = a * d,\r\n        bc = b * c,\r\n        bd = b * d;\r\n\r\n      te[0] = c * e;\r\n      te[4] = bd - ac * f;\r\n      te[8] = bc * f + ad;\r\n\r\n      te[1] = f;\r\n      te[5] = a * e;\r\n      te[9] = -b * e;\r\n\r\n      te[2] = -d * e;\r\n      te[6] = ad * f + bc;\r\n      te[10] = ac - bd * f;\r\n\r\n    }\r\n    else if (euler.order === 'XZY') {\r\n\r\n      var ac = a * c,\r\n        ad = a * d,\r\n        bc = b * c,\r\n        bd = b * d;\r\n\r\n      te[0] = c * e;\r\n      te[4] = -f;\r\n      te[8] = d * e;\r\n\r\n      te[1] = ac * f + bd;\r\n      te[5] = a * e;\r\n      te[9] = ad * f - bc;\r\n\r\n      te[2] = bc * f - ad;\r\n      te[6] = b * e;\r\n      te[10] = bd * f + ac;\r\n\r\n    }\r\n\r\n    // last column\r\n    te[3] = 0;\r\n    te[7] = 0;\r\n    te[11] = 0;\r\n\r\n    // bottom row\r\n    te[12] = 0;\r\n    te[13] = 0;\r\n    te[14] = 0;\r\n    te[15] = 1;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  setRotationFromQuaternion: function(q) {\r\n\r\n    THREE.warn('THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion().');\r\n\r\n    return this.makeRotationFromQuaternion(q);\r\n\r\n  },\r\n\r\n  makeRotationFromQuaternion: function(q) {\r\n\r\n    var te = this.elements;\r\n\r\n    var x = q.x,\r\n      y = q.y,\r\n      z = q.z,\r\n      w = q.w;\r\n    var x2 = x + x,\r\n      y2 = y + y,\r\n      z2 = z + z;\r\n    var xx = x * x2,\r\n      xy = x * y2,\r\n      xz = x * z2;\r\n    var yy = y * y2,\r\n      yz = y * z2,\r\n      zz = z * z2;\r\n    var wx = w * x2,\r\n      wy = w * y2,\r\n      wz = w * z2;\r\n\r\n    te[0] = 1 - (yy + zz);\r\n    te[4] = xy - wz;\r\n    te[8] = xz + wy;\r\n\r\n    te[1] = xy + wz;\r\n    te[5] = 1 - (xx + zz);\r\n    te[9] = yz - wx;\r\n\r\n    te[2] = xz - wy;\r\n    te[6] = yz + wx;\r\n    te[10] = 1 - (xx + yy);\r\n\r\n    // last column\r\n    te[3] = 0;\r\n    te[7] = 0;\r\n    te[11] = 0;\r\n\r\n    // bottom row\r\n    te[12] = 0;\r\n    te[13] = 0;\r\n    te[14] = 0;\r\n    te[15] = 1;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  lookAt: function() {\r\n\r\n    var x = new THREE.Vector3();\r\n    var y = new THREE.Vector3();\r\n    var z = new THREE.Vector3();\r\n\r\n    return function(eye, target, up) {\r\n\r\n      var te = this.elements;\r\n\r\n      z.subVectors(eye, target).normalize();\r\n\r\n      if (z.length() === 0) {\r\n\r\n        z.z = 1;\r\n\r\n      }\r\n\r\n      x.crossVectors(up, z).normalize();\r\n\r\n      if (x.length() === 0) {\r\n\r\n        z.x += 0.0001;\r\n        x.crossVectors(up, z).normalize();\r\n\r\n      }\r\n\r\n      y.crossVectors(z, x);\r\n\r\n\r\n      te[0] = x.x;\r\n      te[4] = y.x;\r\n      te[8] = z.x;\r\n      te[1] = x.y;\r\n      te[5] = y.y;\r\n      te[9] = z.y;\r\n      te[2] = x.z;\r\n      te[6] = y.z;\r\n      te[10] = z.z;\r\n\r\n      return this;\r\n\r\n    };\r\n\r\n  }(),\r\n\r\n  multiply: function(m, n) {\r\n\r\n    if (n !== undefined) {\r\n\r\n      THREE.warn('THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead.');\r\n      return this.multiplyMatrices(m, n);\r\n\r\n    }\r\n\r\n    return this.multiplyMatrices(this, m);\r\n\r\n  },\r\n\r\n  multiplyMatrices: function(a, b) {\r\n\r\n    var ae = a.elements;\r\n    var be = b.elements;\r\n    var te = this.elements;\r\n\r\n    var a11 = ae[0],\r\n      a12 = ae[4],\r\n      a13 = ae[8],\r\n      a14 = ae[12];\r\n    var a21 = ae[1],\r\n      a22 = ae[5],\r\n      a23 = ae[9],\r\n      a24 = ae[13];\r\n    var a31 = ae[2],\r\n      a32 = ae[6],\r\n      a33 = ae[10],\r\n      a34 = ae[14];\r\n    var a41 = ae[3],\r\n      a42 = ae[7],\r\n      a43 = ae[11],\r\n      a44 = ae[15];\r\n\r\n    var b11 = be[0],\r\n      b12 = be[4],\r\n      b13 = be[8],\r\n      b14 = be[12];\r\n    var b21 = be[1],\r\n      b22 = be[5],\r\n      b23 = be[9],\r\n      b24 = be[13];\r\n    var b31 = be[2],\r\n      b32 = be[6],\r\n      b33 = be[10],\r\n      b34 = be[14];\r\n    var b41 = be[3],\r\n      b42 = be[7],\r\n      b43 = be[11],\r\n      b44 = be[15];\r\n\r\n    te[0] = a11 * b11 + a12 * b21 + a13 * b31 + a14 * b41;\r\n    te[4] = a11 * b12 + a12 * b22 + a13 * b32 + a14 * b42;\r\n    te[8] = a11 * b13 + a12 * b23 + a13 * b33 + a14 * b43;\r\n    te[12] = a11 * b14 + a12 * b24 + a13 * b34 + a14 * b44;\r\n\r\n    te[1] = a21 * b11 + a22 * b21 + a23 * b31 + a24 * b41;\r\n    te[5] = a21 * b12 + a22 * b22 + a23 * b32 + a24 * b42;\r\n    te[9] = a21 * b13 + a22 * b23 + a23 * b33 + a24 * b43;\r\n    te[13] = a21 * b14 + a22 * b24 + a23 * b34 + a24 * b44;\r\n\r\n    te[2] = a31 * b11 + a32 * b21 + a33 * b31 + a34 * b41;\r\n    te[6] = a31 * b12 + a32 * b22 + a33 * b32 + a34 * b42;\r\n    te[10] = a31 * b13 + a32 * b23 + a33 * b33 + a34 * b43;\r\n    te[14] = a31 * b14 + a32 * b24 + a33 * b34 + a34 * b44;\r\n\r\n    te[3] = a41 * b11 + a42 * b21 + a43 * b31 + a44 * b41;\r\n    te[7] = a41 * b12 + a42 * b22 + a43 * b32 + a44 * b42;\r\n    te[11] = a41 * b13 + a42 * b23 + a43 * b33 + a44 * b43;\r\n    te[15] = a41 * b14 + a42 * b24 + a43 * b34 + a44 * b44;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  multiplyToArray: function(a, b, r) {\r\n\r\n    var te = this.elements;\r\n\r\n    this.multiplyMatrices(a, b);\r\n\r\n    r[0] = te[0];\r\n    r[1] = te[1];\r\n    r[2] = te[2];\r\n    r[3] = te[3];\r\n    r[4] = te[4];\r\n    r[5] = te[5];\r\n    r[6] = te[6];\r\n    r[7] = te[7];\r\n    r[8] = te[8];\r\n    r[9] = te[9];\r\n    r[10] = te[10];\r\n    r[11] = te[11];\r\n    r[12] = te[12];\r\n    r[13] = te[13];\r\n    r[14] = te[14];\r\n    r[15] = te[15];\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  multiplyScalar: function(s) {\r\n\r\n    var te = this.elements;\r\n\r\n    te[0] *= s;\r\n    te[4] *= s;\r\n    te[8] *= s;\r\n    te[12] *= s;\r\n    te[1] *= s;\r\n    te[5] *= s;\r\n    te[9] *= s;\r\n    te[13] *= s;\r\n    te[2] *= s;\r\n    te[6] *= s;\r\n    te[10] *= s;\r\n    te[14] *= s;\r\n    te[3] *= s;\r\n    te[7] *= s;\r\n    te[11] *= s;\r\n    te[15] *= s;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  multiplyVector3: function(vector) {\r\n\r\n    THREE.warn('THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) or vector.applyProjection( matrix ) instead.');\r\n    return vector.applyProjection(this);\r\n\r\n  },\r\n\r\n  multiplyVector4: function(vector) {\r\n\r\n    THREE.warn('THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead.');\r\n    return vector.applyMatrix4(this);\r\n\r\n  },\r\n\r\n  multiplyVector3Array: function(a) {\r\n\r\n    THREE.warn('THREE.Matrix4: .multiplyVector3Array() has been renamed. Use matrix.applyToVector3Array( array ) instead.');\r\n    return this.applyToVector3Array(a);\r\n\r\n  },\r\n\r\n  applyToVector3Array: function() {\r\n\r\n    var v1 = new THREE.Vector3();\r\n\r\n    return function(array, offset, length) {\r\n\r\n      if (offset === undefined) offset = 0;\r\n      if (length === undefined) length = array.length;\r\n\r\n      for (var i = 0, j = offset; i < length; i += 3, j += 3) {\r\n\r\n        v1.x = array[j];\r\n        v1.y = array[j + 1];\r\n        v1.z = array[j + 2];\r\n\r\n        v1.applyMatrix4(this);\r\n\r\n        array[j] = v1.x;\r\n        array[j + 1] = v1.y;\r\n        array[j + 2] = v1.z;\r\n\r\n      }\r\n\r\n      return array;\r\n\r\n    };\r\n\r\n  }(),\r\n\r\n  rotateAxis: function(v) {\r\n\r\n    THREE.warn('THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead.');\r\n\r\n    v.transformDirection(this);\r\n\r\n  },\r\n\r\n  crossVector: function(vector) {\r\n\r\n    THREE.warn('THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead.');\r\n    return vector.applyMatrix4(this);\r\n\r\n  },\r\n\r\n  determinant: function() {\r\n\r\n    var te = this.elements;\r\n\r\n    var n11 = te[0],\r\n      n12 = te[4],\r\n      n13 = te[8],\r\n      n14 = te[12];\r\n    var n21 = te[1],\r\n      n22 = te[5],\r\n      n23 = te[9],\r\n      n24 = te[13];\r\n    var n31 = te[2],\r\n      n32 = te[6],\r\n      n33 = te[10],\r\n      n34 = te[14];\r\n    var n41 = te[3],\r\n      n42 = te[7],\r\n      n43 = te[11],\r\n      n44 = te[15];\r\n\r\n    //TODO: make this more efficient\r\n    //( based on http://www.euclideanspace.com/maths/algebra/matrix/functions/inverse/fourD/index.htm )\r\n\r\n    return (\r\n      n41 * (+n14 * n23 * n32 - n13 * n24 * n32 - n14 * n22 * n33 + n12 * n24 * n33 + n13 * n22 * n34 - n12 * n23 * n34) +\r\n      n42 * (+n11 * n23 * n34 - n11 * n24 * n33 + n14 * n21 * n33 - n13 * n21 * n34 + n13 * n24 * n31 - n14 * n23 * n31) +\r\n      n43 * (+n11 * n24 * n32 - n11 * n22 * n34 - n14 * n21 * n32 + n12 * n21 * n34 + n14 * n22 * n31 - n12 * n24 * n31) +\r\n      n44 * (-n13 * n22 * n31 - n11 * n23 * n32 + n11 * n22 * n33 + n13 * n21 * n32 - n12 * n21 * n33 + n12 * n23 * n31)\r\n\r\n    );\r\n\r\n  },\r\n\r\n  transpose: function() {\r\n\r\n    var te = this.elements;\r\n    var tmp;\r\n\r\n    tmp = te[1];\r\n    te[1] = te[4];\r\n    te[4] = tmp;\r\n    tmp = te[2];\r\n    te[2] = te[8];\r\n    te[8] = tmp;\r\n    tmp = te[6];\r\n    te[6] = te[9];\r\n    te[9] = tmp;\r\n\r\n    tmp = te[3];\r\n    te[3] = te[12];\r\n    te[12] = tmp;\r\n    tmp = te[7];\r\n    te[7] = te[13];\r\n    te[13] = tmp;\r\n    tmp = te[11];\r\n    te[11] = te[14];\r\n    te[14] = tmp;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  flattenToArrayOffset: function(array, offset) {\r\n\r\n    var te = this.elements;\r\n\r\n    array[offset] = te[0];\r\n    array[offset + 1] = te[1];\r\n    array[offset + 2] = te[2];\r\n    array[offset + 3] = te[3];\r\n\r\n    array[offset + 4] = te[4];\r\n    array[offset + 5] = te[5];\r\n    array[offset + 6] = te[6];\r\n    array[offset + 7] = te[7];\r\n\r\n    array[offset + 8] = te[8];\r\n    array[offset + 9] = te[9];\r\n    array[offset + 10] = te[10];\r\n    array[offset + 11] = te[11];\r\n\r\n    array[offset + 12] = te[12];\r\n    array[offset + 13] = te[13];\r\n    array[offset + 14] = te[14];\r\n    array[offset + 15] = te[15];\r\n\r\n    return array;\r\n\r\n  },\r\n\r\n  getPosition: function() {\r\n\r\n    var v1 = new THREE.Vector3();\r\n\r\n    return function() {\r\n\r\n      THREE.warn('THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead.');\r\n\r\n      var te = this.elements;\r\n      return v1.set(te[12], te[13], te[14]);\r\n\r\n    };\r\n\r\n  }(),\r\n\r\n  setPosition: function(v) {\r\n\r\n    var te = this.elements;\r\n\r\n    te[12] = v.x;\r\n    te[13] = v.y;\r\n    te[14] = v.z;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  getInverse: function(m, throwOnInvertible) {\r\n\r\n    // based on http://www.euclideanspace.com/maths/algebra/matrix/functions/inverse/fourD/index.htm\r\n    var te = this.elements;\r\n    var me = m.elements;\r\n\r\n    var n11 = me[0],\r\n      n12 = me[4],\r\n      n13 = me[8],\r\n      n14 = me[12];\r\n    var n21 = me[1],\r\n      n22 = me[5],\r\n      n23 = me[9],\r\n      n24 = me[13];\r\n    var n31 = me[2],\r\n      n32 = me[6],\r\n      n33 = me[10],\r\n      n34 = me[14];\r\n    var n41 = me[3],\r\n      n42 = me[7],\r\n      n43 = me[11],\r\n      n44 = me[15];\r\n\r\n    te[0] = n23 * n34 * n42 - n24 * n33 * n42 + n24 * n32 * n43 - n22 * n34 * n43 - n23 * n32 * n44 + n22 * n33 * n44;\r\n    te[4] = n14 * n33 * n42 - n13 * n34 * n42 - n14 * n32 * n43 + n12 * n34 * n43 + n13 * n32 * n44 - n12 * n33 * n44;\r\n    te[8] = n13 * n24 * n42 - n14 * n23 * n42 + n14 * n22 * n43 - n12 * n24 * n43 - n13 * n22 * n44 + n12 * n23 * n44;\r\n    te[12] = n14 * n23 * n32 - n13 * n24 * n32 - n14 * n22 * n33 + n12 * n24 * n33 + n13 * n22 * n34 - n12 * n23 * n34;\r\n    te[1] = n24 * n33 * n41 - n23 * n34 * n41 - n24 * n31 * n43 + n21 * n34 * n43 + n23 * n31 * n44 - n21 * n33 * n44;\r\n    te[5] = n13 * n34 * n41 - n14 * n33 * n41 + n14 * n31 * n43 - n11 * n34 * n43 - n13 * n31 * n44 + n11 * n33 * n44;\r\n    te[9] = n14 * n23 * n41 - n13 * n24 * n41 - n14 * n21 * n43 + n11 * n24 * n43 + n13 * n21 * n44 - n11 * n23 * n44;\r\n    te[13] = n13 * n24 * n31 - n14 * n23 * n31 + n14 * n21 * n33 - n11 * n24 * n33 - n13 * n21 * n34 + n11 * n23 * n34;\r\n    te[2] = n22 * n34 * n41 - n24 * n32 * n41 + n24 * n31 * n42 - n21 * n34 * n42 - n22 * n31 * n44 + n21 * n32 * n44;\r\n    te[6] = n14 * n32 * n41 - n12 * n34 * n41 - n14 * n31 * n42 + n11 * n34 * n42 + n12 * n31 * n44 - n11 * n32 * n44;\r\n    te[10] = n12 * n24 * n41 - n14 * n22 * n41 + n14 * n21 * n42 - n11 * n24 * n42 - n12 * n21 * n44 + n11 * n22 * n44;\r\n    te[14] = n14 * n22 * n31 - n12 * n24 * n31 - n14 * n21 * n32 + n11 * n24 * n32 + n12 * n21 * n34 - n11 * n22 * n34;\r\n    te[3] = n23 * n32 * n41 - n22 * n33 * n41 - n23 * n31 * n42 + n21 * n33 * n42 + n22 * n31 * n43 - n21 * n32 * n43;\r\n    te[7] = n12 * n33 * n41 - n13 * n32 * n41 + n13 * n31 * n42 - n11 * n33 * n42 - n12 * n31 * n43 + n11 * n32 * n43;\r\n    te[11] = n13 * n22 * n41 - n12 * n23 * n41 - n13 * n21 * n42 + n11 * n23 * n42 + n12 * n21 * n43 - n11 * n22 * n43;\r\n    te[15] = n12 * n23 * n31 - n13 * n22 * n31 + n13 * n21 * n32 - n11 * n23 * n32 - n12 * n21 * n33 + n11 * n22 * n33;\r\n\r\n    var det = n11 * te[0] + n21 * te[4] + n31 * te[8] + n41 * te[12];\r\n\r\n    if (det == 0) {\r\n\r\n      var msg = \"THREE.Matrix4.getInverse(): can't invert matrix, determinant is 0\";\r\n\r\n      if (throwOnInvertible || false) {\r\n\r\n        throw new Error(msg);\r\n\r\n      }\r\n      else {\r\n\r\n        THREE.warn(msg);\r\n\r\n      }\r\n\r\n      this.identity();\r\n\r\n      return this;\r\n    }\r\n\r\n    this.multiplyScalar(1 / det);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  translate: function(v) {\r\n\r\n    THREE.error('THREE.Matrix4: .translate() has been removed.');\r\n\r\n  },\r\n\r\n  rotateX: function(angle) {\r\n\r\n    THREE.error('THREE.Matrix4: .rotateX() has been removed.');\r\n\r\n  },\r\n\r\n  rotateY: function(angle) {\r\n\r\n    THREE.error('THREE.Matrix4: .rotateY() has been removed.');\r\n\r\n  },\r\n\r\n  rotateZ: function(angle) {\r\n\r\n    THREE.error('THREE.Matrix4: .rotateZ() has been removed.');\r\n\r\n  },\r\n\r\n  rotateByAxis: function(axis, angle) {\r\n\r\n    THREE.error('THREE.Matrix4: .rotateByAxis() has been removed.');\r\n\r\n  },\r\n\r\n  scale: function(v) {\r\n\r\n    var te = this.elements;\r\n    var x = v.x,\r\n      y = v.y,\r\n      z = v.z;\r\n\r\n    te[0] *= x;\r\n    te[4] *= y;\r\n    te[8] *= z;\r\n    te[1] *= x;\r\n    te[5] *= y;\r\n    te[9] *= z;\r\n    te[2] *= x;\r\n    te[6] *= y;\r\n    te[10] *= z;\r\n    te[3] *= x;\r\n    te[7] *= y;\r\n    te[11] *= z;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  getMaxScaleOnAxis: function() {\r\n\r\n    var te = this.elements;\r\n\r\n    var scaleXSq = te[0] * te[0] + te[1] * te[1] + te[2] * te[2];\r\n    var scaleYSq = te[4] * te[4] + te[5] * te[5] + te[6] * te[6];\r\n    var scaleZSq = te[8] * te[8] + te[9] * te[9] + te[10] * te[10];\r\n\r\n    return Math.sqrt(Math.max(scaleXSq, Math.max(scaleYSq, scaleZSq)));\r\n\r\n  },\r\n\r\n  makeTranslation: function(x, y, z) {\r\n\r\n    this.set(\r\n\r\n      1, 0, 0, x,\r\n      0, 1, 0, y,\r\n      0, 0, 1, z,\r\n      0, 0, 0, 1\r\n\r\n    );\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  makeRotationX: function(theta) {\r\n\r\n    var c = Math.cos(theta),\r\n      s = Math.sin(theta);\r\n\r\n    this.set(\r\n\r\n      1, 0, 0, 0,\r\n      0, c, -s, 0,\r\n      0, s, c, 0,\r\n      0, 0, 0, 1\r\n\r\n    );\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  makeRotationY: function(theta) {\r\n\r\n    var c = Math.cos(theta),\r\n      s = Math.sin(theta);\r\n\r\n    this.set(\r\n\r\n      c, 0, s, 0,\r\n      0, 1, 0, 0, -s, 0, c, 0,\r\n      0, 0, 0, 1\r\n\r\n    );\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  makeRotationZ: function(theta) {\r\n\r\n    var c = Math.cos(theta),\r\n      s = Math.sin(theta);\r\n\r\n    this.set(\r\n\r\n      c, -s, 0, 0,\r\n      s, c, 0, 0,\r\n      0, 0, 1, 0,\r\n      0, 0, 0, 1\r\n\r\n    );\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  makeRotationAxis: function(axis, angle) {\r\n\r\n    // Based on http://www.gamedev.net/reference/articles/article1199.asp\r\n\r\n    var c = Math.cos(angle);\r\n    var s = Math.sin(angle);\r\n    var t = 1 - c;\r\n    var x = axis.x,\r\n      y = axis.y,\r\n      z = axis.z;\r\n    var tx = t * x,\r\n      ty = t * y;\r\n\r\n    this.set(\r\n\r\n      tx * x + c, tx * y - s * z, tx * z + s * y, 0,\r\n      tx * y + s * z, ty * y + c, ty * z - s * x, 0,\r\n      tx * z - s * y, ty * z + s * x, t * z * z + c, 0,\r\n      0, 0, 0, 1\r\n\r\n    );\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  makeScale: function(x, y, z) {\r\n\r\n    this.set(\r\n\r\n      x, 0, 0, 0,\r\n      0, y, 0, 0,\r\n      0, 0, z, 0,\r\n      0, 0, 0, 1\r\n\r\n    );\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  compose: function(position, quaternion, scale) {\r\n\r\n    this.makeRotationFromQuaternion(quaternion);\r\n    this.scale(scale);\r\n    this.setPosition(position);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  decompose: function() {\r\n\r\n    var vector = new THREE.Vector3();\r\n    var matrix = new THREE.Matrix4();\r\n\r\n    return function(position, quaternion, scale) {\r\n\r\n      var te = this.elements;\r\n\r\n      var sx = vector.set(te[0], te[1], te[2]).length();\r\n      var sy = vector.set(te[4], te[5], te[6]).length();\r\n      var sz = vector.set(te[8], te[9], te[10]).length();\r\n\r\n      // if determine is negative, we need to invert one scale\r\n      var det = this.determinant();\r\n      if (det < 0) {\r\n        sx = -sx;\r\n      }\r\n\r\n      position.x = te[12];\r\n      position.y = te[13];\r\n      position.z = te[14];\r\n\r\n      // scale the rotation part\r\n\r\n      matrix.elements.set(this.elements); // at this point matrix is incomplete so we can't use .copy()\r\n\r\n      var invSX = 1 / sx;\r\n      var invSY = 1 / sy;\r\n      var invSZ = 1 / sz;\r\n\r\n      matrix.elements[0] *= invSX;\r\n      matrix.elements[1] *= invSX;\r\n      matrix.elements[2] *= invSX;\r\n\r\n      matrix.elements[4] *= invSY;\r\n      matrix.elements[5] *= invSY;\r\n      matrix.elements[6] *= invSY;\r\n\r\n      matrix.elements[8] *= invSZ;\r\n      matrix.elements[9] *= invSZ;\r\n      matrix.elements[10] *= invSZ;\r\n\r\n      quaternion.setFromRotationMatrix(matrix);\r\n\r\n      scale.x = sx;\r\n      scale.y = sy;\r\n      scale.z = sz;\r\n\r\n      return this;\r\n\r\n    };\r\n\r\n  }(),\r\n\r\n  makeFrustum: function(left, right, bottom, top, near, far) {\r\n\r\n    var te = this.elements;\r\n    var x = 2 * near / (right - left);\r\n    var y = 2 * near / (top - bottom);\r\n\r\n    var a = (right + left) / (right - left);\r\n    var b = (top + bottom) / (top - bottom);\r\n    var c = -(far + near) / (far - near);\r\n    var d = -2 * far * near / (far - near);\r\n\r\n    te[0] = x;\r\n    te[4] = 0;\r\n    te[8] = a;\r\n    te[12] = 0;\r\n    te[1] = 0;\r\n    te[5] = y;\r\n    te[9] = b;\r\n    te[13] = 0;\r\n    te[2] = 0;\r\n    te[6] = 0;\r\n    te[10] = c;\r\n    te[14] = d;\r\n    te[3] = 0;\r\n    te[7] = 0;\r\n    te[11] = -1;\r\n    te[15] = 0;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  makePerspective: function(fov, aspect, near, far) {\r\n\r\n    var ymax = near * Math.tan(THREE.Math.degToRad(fov * 0.5));\r\n    var ymin = -ymax;\r\n    var xmin = ymin * aspect;\r\n    var xmax = ymax * aspect;\r\n\r\n    return this.makeFrustum(xmin, xmax, ymin, ymax, near, far);\r\n\r\n  },\r\n\r\n  makeOrthographic: function(left, right, top, bottom, near, far) {\r\n\r\n    var te = this.elements;\r\n    var w = right - left;\r\n    var h = top - bottom;\r\n    var p = far - near;\r\n\r\n    var x = (right + left) / w;\r\n    var y = (top + bottom) / h;\r\n    var z = (far + near) / p;\r\n\r\n    te[0] = 2 / w;\r\n    te[4] = 0;\r\n    te[8] = 0;\r\n    te[12] = -x;\r\n    te[1] = 0;\r\n    te[5] = 2 / h;\r\n    te[9] = 0;\r\n    te[13] = -y;\r\n    te[2] = 0;\r\n    te[6] = 0;\r\n    te[10] = -2 / p;\r\n    te[14] = -z;\r\n    te[3] = 0;\r\n    te[7] = 0;\r\n    te[11] = 0;\r\n    te[15] = 1;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  fromArray: function(array) {\r\n\r\n    this.elements.set(array);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  toArray: function() {\r\n\r\n    var te = this.elements;\r\n\r\n    return [\r\n      te[0], te[1], te[2], te[3],\r\n      te[4], te[5], te[6], te[7],\r\n      te[8], te[9], te[10], te[11],\r\n      te[12], te[13], te[14], te[15]\r\n    ];\r\n\r\n  },\r\n\r\n  clone: function() {\r\n\r\n    return new THREE.Matrix4().fromArray(this.elements);\r\n\r\n  }\r\n\r\n};\r\n\r\n// File:src/math/Ray.js\r\n\r\n/**\r\n * @author bhouston / http://exocortex.com\r\n */\r\n\r\nTHREE.Ray = function(origin, direction) {\r\n\r\n  this.origin = (origin !== undefined) ? origin : new THREE.Vector3();\r\n  this.direction = (direction !== undefined) ? direction : new THREE.Vector3();\r\n\r\n};\r\n\r\nTHREE.Ray.prototype = {\r\n\r\n  constructor: THREE.Ray,\r\n\r\n  set: function(origin, direction) {\r\n\r\n    this.origin.copy(origin);\r\n    this.direction.copy(direction);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  copy: function(ray) {\r\n\r\n    this.origin.copy(ray.origin);\r\n    this.direction.copy(ray.direction);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  at: function(t, optionalTarget) {\r\n\r\n    var result = optionalTarget || new THREE.Vector3();\r\n\r\n    return result.copy(this.direction).multiplyScalar(t).add(this.origin);\r\n\r\n  },\r\n\r\n  recast: function() {\r\n\r\n    var v1 = new THREE.Vector3();\r\n\r\n    return function(t) {\r\n\r\n      this.origin.copy(this.at(t, v1));\r\n\r\n      return this;\r\n\r\n    };\r\n\r\n  }(),\r\n\r\n  closestPointToPoint: function(point, optionalTarget) {\r\n\r\n    var result = optionalTarget || new THREE.Vector3();\r\n    result.subVectors(point, this.origin);\r\n    var directionDistance = result.dot(this.direction);\r\n\r\n    if (directionDistance < 0) {\r\n\r\n      return result.copy(this.origin);\r\n\r\n    }\r\n\r\n    return result.copy(this.direction).multiplyScalar(directionDistance).add(this.origin);\r\n\r\n  },\r\n\r\n  distanceToPoint: function() {\r\n\r\n    var v1 = new THREE.Vector3();\r\n\r\n    return function(point) {\r\n\r\n      var directionDistance = v1.subVectors(point, this.origin).dot(this.direction);\r\n\r\n      // point behind the ray\r\n\r\n      if (directionDistance < 0) {\r\n\r\n        return this.origin.distanceTo(point);\r\n\r\n      }\r\n\r\n      v1.copy(this.direction).multiplyScalar(directionDistance).add(this.origin);\r\n\r\n      return v1.distanceTo(point);\r\n\r\n    };\r\n\r\n  }(),\r\n\r\n  distanceSqToSegment: function() {\r\n\r\n    var segCenter = new THREE.Vector3();\r\n    var segDir = new THREE.Vector3();\r\n    var diff = new THREE.Vector3();\r\n\r\n    return function(v0, v1, optionalPointOnRay, optionalPointOnSegment) {\r\n\r\n      // from http://www.geometrictools.com/LibMathematics/Distance/Wm5DistRay3Segment3.cpp\r\n      // It returns the min distance between the ray and the segment\r\n      // defined by v0 and v1\r\n      // It can also set two optional targets :\r\n      // - The closest point on the ray\r\n      // - The closest point on the segment\r\n\r\n      segCenter.copy(v0).add(v1).multiplyScalar(0.5);\r\n      segDir.copy(v1).sub(v0).normalize();\r\n      diff.copy(this.origin).sub(segCenter);\r\n\r\n      var segExtent = v0.distanceTo(v1) * 0.5;\r\n      var a01 = -this.direction.dot(segDir);\r\n      var b0 = diff.dot(this.direction);\r\n      var b1 = -diff.dot(segDir);\r\n      var c = diff.lengthSq();\r\n      var det = Math.abs(1 - a01 * a01);\r\n      var s0, s1, sqrDist, extDet;\r\n\r\n      if (det > 0) {\r\n\r\n        // The ray and segment are not parallel.\r\n\r\n        s0 = a01 * b1 - b0;\r\n        s1 = a01 * b0 - b1;\r\n        extDet = segExtent * det;\r\n\r\n        if (s0 >= 0) {\r\n\r\n          if (s1 >= -extDet) {\r\n\r\n            if (s1 <= extDet) {\r\n\r\n              // region 0\r\n              // Minimum at interior points of ray and segment.\r\n\r\n              var invDet = 1 / det;\r\n              s0 *= invDet;\r\n              s1 *= invDet;\r\n              sqrDist = s0 * (s0 + a01 * s1 + 2 * b0) + s1 * (a01 * s0 + s1 + 2 * b1) + c;\r\n\r\n            }\r\n            else {\r\n\r\n              // region 1\r\n\r\n              s1 = segExtent;\r\n              s0 = Math.max(0, -(a01 * s1 + b0));\r\n              sqrDist = -s0 * s0 + s1 * (s1 + 2 * b1) + c;\r\n\r\n            }\r\n\r\n          }\r\n          else {\r\n\r\n            // region 5\r\n\r\n            s1 = -segExtent;\r\n            s0 = Math.max(0, -(a01 * s1 + b0));\r\n            sqrDist = -s0 * s0 + s1 * (s1 + 2 * b1) + c;\r\n\r\n          }\r\n\r\n        }\r\n        else {\r\n\r\n          if (s1 <= -extDet) {\r\n\r\n            // region 4\r\n\r\n            s0 = Math.max(0, -(-a01 * segExtent + b0));\r\n            s1 = (s0 > 0) ? -segExtent : Math.min(Math.max(-segExtent, -b1), segExtent);\r\n            sqrDist = -s0 * s0 + s1 * (s1 + 2 * b1) + c;\r\n\r\n          }\r\n          else if (s1 <= extDet) {\r\n\r\n            // region 3\r\n\r\n            s0 = 0;\r\n            s1 = Math.min(Math.max(-segExtent, -b1), segExtent);\r\n            sqrDist = s1 * (s1 + 2 * b1) + c;\r\n\r\n          }\r\n          else {\r\n\r\n            // region 2\r\n\r\n            s0 = Math.max(0, -(a01 * segExtent + b0));\r\n            s1 = (s0 > 0) ? segExtent : Math.min(Math.max(-segExtent, -b1), segExtent);\r\n            sqrDist = -s0 * s0 + s1 * (s1 + 2 * b1) + c;\r\n\r\n          }\r\n\r\n        }\r\n\r\n      }\r\n      else {\r\n\r\n        // Ray and segment are parallel.\r\n\r\n        s1 = (a01 > 0) ? -segExtent : segExtent;\r\n        s0 = Math.max(0, -(a01 * s1 + b0));\r\n        sqrDist = -s0 * s0 + s1 * (s1 + 2 * b1) + c;\r\n\r\n      }\r\n\r\n      if (optionalPointOnRay) {\r\n\r\n        optionalPointOnRay.copy(this.direction).multiplyScalar(s0).add(this.origin);\r\n\r\n      }\r\n\r\n      if (optionalPointOnSegment) {\r\n\r\n        optionalPointOnSegment.copy(segDir).multiplyScalar(s1).add(segCenter);\r\n\r\n      }\r\n\r\n      return sqrDist;\r\n\r\n    };\r\n\r\n  }(),\r\n\r\n\r\n  isIntersectionSphere: function(sphere) {\r\n\r\n    return this.distanceToPoint(sphere.center) <= sphere.radius;\r\n\r\n  },\r\n\r\n  intersectSphere: function() {\r\n\r\n    // from http://www.scratchapixel.com/lessons/3d-basic-lessons/lesson-7-intersecting-simple-shapes/ray-sphere-intersection/\r\n\r\n    var v1 = new THREE.Vector3();\r\n\r\n    return function(sphere, optionalTarget) {\r\n\r\n      v1.subVectors(sphere.center, this.origin);\r\n\r\n      var tca = v1.dot(this.direction);\r\n\r\n      var d2 = v1.dot(v1) - tca * tca;\r\n\r\n      var radius2 = sphere.radius * sphere.radius;\r\n\r\n      if (d2 > radius2) return null;\r\n\r\n      var thc = Math.sqrt(radius2 - d2);\r\n\r\n      // t0 = first intersect point - entrance on front of sphere\r\n      var t0 = tca - thc;\r\n\r\n      // t1 = second intersect point - exit point on back of sphere\r\n      var t1 = tca + thc;\r\n\r\n      // test to see if both t0 and t1 are behind the ray - if so, return null\r\n      if (t0 < 0 && t1 < 0) return null;\r\n\r\n      // test to see if t0 is behind the ray:\r\n      // if it is, the ray is inside the sphere, so return the second exit point scaled by t1,\r\n      // in order to always return an intersect point that is in front of the ray.\r\n      if (t0 < 0) return this.at(t1, optionalTarget);\r\n\r\n      // else t0 is in front of the ray, so return the first collision point scaled by t0 \r\n      return this.at(t0, optionalTarget);\r\n\r\n    }\r\n\r\n  }(),\r\n\r\n  isIntersectionPlane: function(plane) {\r\n\r\n    // check if the ray lies on the plane first\r\n\r\n    var distToPoint = plane.distanceToPoint(this.origin);\r\n\r\n    if (distToPoint === 0) {\r\n\r\n      return true;\r\n\r\n    }\r\n\r\n    var denominator = plane.normal.dot(this.direction);\r\n\r\n    if (denominator * distToPoint < 0) {\r\n\r\n      return true;\r\n\r\n    }\r\n\r\n    // ray origin is behind the plane (and is pointing behind it)\r\n\r\n    return false;\r\n\r\n  },\r\n\r\n  distanceToPlane: function(plane) {\r\n\r\n    var denominator = plane.normal.dot(this.direction);\r\n    if (denominator == 0) {\r\n\r\n      // line is coplanar, return origin\r\n      if (plane.distanceToPoint(this.origin) == 0) {\r\n\r\n        return 0;\r\n\r\n      }\r\n\r\n      // Null is preferable to undefined since undefined means.... it is undefined\r\n\r\n      return null;\r\n\r\n    }\r\n\r\n    var t = -(this.origin.dot(plane.normal) + plane.constant) / denominator;\r\n\r\n    // Return if the ray never intersects the plane\r\n\r\n    return t >= 0 ? t : null;\r\n\r\n  },\r\n\r\n  intersectPlane: function(plane, optionalTarget) {\r\n\r\n    var t = this.distanceToPlane(plane);\r\n\r\n    if (t === null) {\r\n\r\n      return null;\r\n    }\r\n\r\n    return this.at(t, optionalTarget);\r\n\r\n  },\r\n\r\n  isIntersectionBox: function() {\r\n\r\n    var v = new THREE.Vector3();\r\n\r\n    return function(box) {\r\n\r\n      return this.intersectBox(box, v) !== null;\r\n\r\n    };\r\n\r\n  }(),\r\n\r\n  intersectBox: function(box, optionalTarget) {\r\n\r\n    // http://www.scratchapixel.com/lessons/3d-basic-lessons/lesson-7-intersecting-simple-shapes/ray-box-intersection/\r\n\r\n    var tmin, tmax, tymin, tymax, tzmin, tzmax;\r\n\r\n    var invdirx = 1 / this.direction.x,\r\n      invdiry = 1 / this.direction.y,\r\n      invdirz = 1 / this.direction.z;\r\n\r\n    var origin = this.origin;\r\n\r\n    if (invdirx >= 0) {\r\n\r\n      tmin = (box.min.x - origin.x) * invdirx;\r\n      tmax = (box.max.x - origin.x) * invdirx;\r\n\r\n    }\r\n    else {\r\n\r\n      tmin = (box.max.x - origin.x) * invdirx;\r\n      tmax = (box.min.x - origin.x) * invdirx;\r\n    }\r\n\r\n    if (invdiry >= 0) {\r\n\r\n      tymin = (box.min.y - origin.y) * invdiry;\r\n      tymax = (box.max.y - origin.y) * invdiry;\r\n\r\n    }\r\n    else {\r\n\r\n      tymin = (box.max.y - origin.y) * invdiry;\r\n      tymax = (box.min.y - origin.y) * invdiry;\r\n    }\r\n\r\n    if ((tmin > tymax) || (tymin > tmax)) return null;\r\n\r\n    // These lines also handle the case where tmin or tmax is NaN\r\n    // (result of 0 * Infinity). x !== x returns true if x is NaN\r\n\r\n    if (tymin > tmin || tmin !== tmin) tmin = tymin;\r\n\r\n    if (tymax < tmax || tmax !== tmax) tmax = tymax;\r\n\r\n    if (invdirz >= 0) {\r\n\r\n      tzmin = (box.min.z - origin.z) * invdirz;\r\n      tzmax = (box.max.z - origin.z) * invdirz;\r\n\r\n    }\r\n    else {\r\n\r\n      tzmin = (box.max.z - origin.z) * invdirz;\r\n      tzmax = (box.min.z - origin.z) * invdirz;\r\n    }\r\n\r\n    if ((tmin > tzmax) || (tzmin > tmax)) return null;\r\n\r\n    if (tzmin > tmin || tmin !== tmin) tmin = tzmin;\r\n\r\n    if (tzmax < tmax || tmax !== tmax) tmax = tzmax;\r\n\r\n    //return point closest to the ray (positive side)\r\n\r\n    if (tmax < 0) return null;\r\n\r\n    return this.at(tmin >= 0 ? tmin : tmax, optionalTarget);\r\n\r\n  },\r\n\r\n  intersectTriangle: function() {\r\n\r\n    // Compute the offset origin, edges, and normal.\r\n    var diff = new THREE.Vector3();\r\n    var edge1 = new THREE.Vector3();\r\n    var edge2 = new THREE.Vector3();\r\n    var normal = new THREE.Vector3();\r\n\r\n    return function(a, b, c, backfaceCulling, optionalTarget) {\r\n\r\n      // from http://www.geometrictools.com/LibMathematics/Intersection/Wm5IntrRay3Triangle3.cpp\r\n\r\n      edge1.subVectors(b, a);\r\n      edge2.subVectors(c, a);\r\n      normal.crossVectors(edge1, edge2);\r\n\r\n      // Solve Q + t*D = b1*E1 + b2*E2 (Q = kDiff, D = ray direction,\r\n      // E1 = kEdge1, E2 = kEdge2, N = Cross(E1,E2)) by\r\n      //   |Dot(D,N)|*b1 = sign(Dot(D,N))*Dot(D,Cross(Q,E2))\r\n      //   |Dot(D,N)|*b2 = sign(Dot(D,N))*Dot(D,Cross(E1,Q))\r\n      //   |Dot(D,N)|*t = -sign(Dot(D,N))*Dot(Q,N)\r\n      var DdN = this.direction.dot(normal);\r\n      var sign;\r\n\r\n      if (DdN > 0) {\r\n\r\n        if (backfaceCulling) return null;\r\n        sign = 1;\r\n\r\n      }\r\n      else if (DdN < 0) {\r\n\r\n        sign = -1;\r\n        DdN = -DdN;\r\n\r\n      }\r\n      else {\r\n\r\n        return null;\r\n\r\n      }\r\n\r\n      diff.subVectors(this.origin, a);\r\n      var DdQxE2 = sign * this.direction.dot(edge2.crossVectors(diff, edge2));\r\n\r\n      // b1 < 0, no intersection\r\n      if (DdQxE2 < 0) {\r\n\r\n        return null;\r\n\r\n      }\r\n\r\n      var DdE1xQ = sign * this.direction.dot(edge1.cross(diff));\r\n\r\n      // b2 < 0, no intersection\r\n      if (DdE1xQ < 0) {\r\n\r\n        return null;\r\n\r\n      }\r\n\r\n      // b1+b2 > 1, no intersection\r\n      if (DdQxE2 + DdE1xQ > DdN) {\r\n\r\n        return null;\r\n\r\n      }\r\n\r\n      // Line intersects triangle, check if ray does.\r\n      var QdN = -sign * diff.dot(normal);\r\n\r\n      // t < 0, no intersection\r\n      if (QdN < 0) {\r\n\r\n        return null;\r\n\r\n      }\r\n\r\n      // Ray intersects triangle.\r\n      return this.at(QdN / DdN, optionalTarget);\r\n\r\n    };\r\n\r\n  }(),\r\n\r\n  applyMatrix4: function(matrix4) {\r\n\r\n    this.direction.add(this.origin).applyMatrix4(matrix4);\r\n    this.origin.applyMatrix4(matrix4);\r\n    this.direction.sub(this.origin);\r\n    this.direction.normalize();\r\n\r\n    return this;\r\n  },\r\n\r\n  equals: function(ray) {\r\n\r\n    return ray.origin.equals(this.origin) && ray.direction.equals(this.direction);\r\n\r\n  },\r\n\r\n  clone: function() {\r\n\r\n    return new THREE.Ray().copy(this);\r\n\r\n  }\r\n\r\n};\r\n\r\n// File:src/math/Sphere.js\r\n\r\n/**\r\n * @author bhouston / http://exocortex.com\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.Sphere = function(center, radius) {\r\n\r\n  this.center = (center !== undefined) ? center : new THREE.Vector3();\r\n  this.radius = (radius !== undefined) ? radius : 0;\r\n\r\n};\r\n\r\nTHREE.Sphere.prototype = {\r\n\r\n  constructor: THREE.Sphere,\r\n\r\n  set: function(center, radius) {\r\n\r\n    this.center.copy(center);\r\n    this.radius = radius;\r\n\r\n    return this;\r\n  },\r\n\r\n  setFromPoints: function() {\r\n\r\n    var box = new THREE.Box3();\r\n\r\n    return function(points, optionalCenter) {\r\n\r\n      var center = this.center;\r\n\r\n      if (optionalCenter !== undefined) {\r\n\r\n        center.copy(optionalCenter);\r\n\r\n      }\r\n      else {\r\n\r\n        box.setFromPoints(points).center(center);\r\n\r\n      }\r\n\r\n      var maxRadiusSq = 0;\r\n\r\n      for (var i = 0, il = points.length; i < il; i++) {\r\n\r\n        maxRadiusSq = Math.max(maxRadiusSq, center.distanceToSquared(points[i]));\r\n\r\n      }\r\n\r\n      this.radius = Math.sqrt(maxRadiusSq);\r\n\r\n      return this;\r\n\r\n    };\r\n\r\n  }(),\r\n\r\n  copy: function(sphere) {\r\n\r\n    this.center.copy(sphere.center);\r\n    this.radius = sphere.radius;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  empty: function() {\r\n\r\n    return (this.radius <= 0);\r\n\r\n  },\r\n\r\n  containsPoint: function(point) {\r\n\r\n    return (point.distanceToSquared(this.center) <= (this.radius * this.radius));\r\n\r\n  },\r\n\r\n  distanceToPoint: function(point) {\r\n\r\n    return (point.distanceTo(this.center) - this.radius);\r\n\r\n  },\r\n\r\n  intersectsSphere: function(sphere) {\r\n\r\n    var radiusSum = this.radius + sphere.radius;\r\n\r\n    return sphere.center.distanceToSquared(this.center) <= (radiusSum * radiusSum);\r\n\r\n  },\r\n\r\n  clampPoint: function(point, optionalTarget) {\r\n\r\n    var deltaLengthSq = this.center.distanceToSquared(point);\r\n\r\n    var result = optionalTarget || new THREE.Vector3();\r\n    result.copy(point);\r\n\r\n    if (deltaLengthSq > (this.radius * this.radius)) {\r\n\r\n      result.sub(this.center).normalize();\r\n      result.multiplyScalar(this.radius).add(this.center);\r\n\r\n    }\r\n\r\n    return result;\r\n\r\n  },\r\n\r\n  getBoundingBox: function(optionalTarget) {\r\n\r\n    var box = optionalTarget || new THREE.Box3();\r\n\r\n    box.set(this.center, this.center);\r\n    box.expandByScalar(this.radius);\r\n\r\n    return box;\r\n\r\n  },\r\n\r\n  applyMatrix4: function(matrix) {\r\n\r\n    this.center.applyMatrix4(matrix);\r\n    this.radius = this.radius * matrix.getMaxScaleOnAxis();\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  translate: function(offset) {\r\n\r\n    this.center.add(offset);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  equals: function(sphere) {\r\n\r\n    return sphere.center.equals(this.center) && (sphere.radius === this.radius);\r\n\r\n  },\r\n\r\n  clone: function() {\r\n\r\n    return new THREE.Sphere().copy(this);\r\n\r\n  }\r\n\r\n};\r\n\r\n// File:src/math/Frustum.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author alteredq / http://alteredqualia.com/\r\n * @author bhouston / http://exocortex.com\r\n */\r\n\r\nTHREE.Frustum = function(p0, p1, p2, p3, p4, p5) {\r\n\r\n  this.planes = [\r\n\r\n    (p0 !== undefined) ? p0 : new THREE.Plane(), (p1 !== undefined) ? p1 : new THREE.Plane(), (p2 !== undefined) ? p2 : new THREE.Plane(), (p3 !== undefined) ? p3 : new THREE.Plane(), (p4 !== undefined) ? p4 : new THREE.Plane(), (p5 !== undefined) ? p5 : new THREE.Plane()\r\n\r\n  ];\r\n\r\n};\r\n\r\nTHREE.Frustum.prototype = {\r\n\r\n  constructor: THREE.Frustum,\r\n\r\n  set: function(p0, p1, p2, p3, p4, p5) {\r\n\r\n    var planes = this.planes;\r\n\r\n    planes[0].copy(p0);\r\n    planes[1].copy(p1);\r\n    planes[2].copy(p2);\r\n    planes[3].copy(p3);\r\n    planes[4].copy(p4);\r\n    planes[5].copy(p5);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  copy: function(frustum) {\r\n\r\n    var planes = this.planes;\r\n\r\n    for (var i = 0; i < 6; i++) {\r\n\r\n      planes[i].copy(frustum.planes[i]);\r\n\r\n    }\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  setFromMatrix: function(m) {\r\n\r\n    var planes = this.planes;\r\n    var me = m.elements;\r\n    var me0 = me[0],\r\n      me1 = me[1],\r\n      me2 = me[2],\r\n      me3 = me[3];\r\n    var me4 = me[4],\r\n      me5 = me[5],\r\n      me6 = me[6],\r\n      me7 = me[7];\r\n    var me8 = me[8],\r\n      me9 = me[9],\r\n      me10 = me[10],\r\n      me11 = me[11];\r\n    var me12 = me[12],\r\n      me13 = me[13],\r\n      me14 = me[14],\r\n      me15 = me[15];\r\n\r\n    planes[0].setComponents(me3 - me0, me7 - me4, me11 - me8, me15 - me12).normalize();\r\n    planes[1].setComponents(me3 + me0, me7 + me4, me11 + me8, me15 + me12).normalize();\r\n    planes[2].setComponents(me3 + me1, me7 + me5, me11 + me9, me15 + me13).normalize();\r\n    planes[3].setComponents(me3 - me1, me7 - me5, me11 - me9, me15 - me13).normalize();\r\n    planes[4].setComponents(me3 - me2, me7 - me6, me11 - me10, me15 - me14).normalize();\r\n    planes[5].setComponents(me3 + me2, me7 + me6, me11 + me10, me15 + me14).normalize();\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  intersectsObject: function() {\r\n\r\n    var sphere = new THREE.Sphere();\r\n\r\n    return function(object) {\r\n\r\n      var geometry = object.geometry;\r\n\r\n      if (geometry.boundingSphere === null) geometry.computeBoundingSphere();\r\n\r\n      sphere.copy(geometry.boundingSphere);\r\n      sphere.applyMatrix4(object.matrixWorld);\r\n\r\n      return this.intersectsSphere(sphere);\r\n\r\n    };\r\n\r\n  }(),\r\n\r\n  intersectsSphere: function(sphere) {\r\n\r\n    var planes = this.planes;\r\n    var center = sphere.center;\r\n    var negRadius = -sphere.radius;\r\n\r\n    for (var i = 0; i < 6; i++) {\r\n\r\n      var distance = planes[i].distanceToPoint(center);\r\n\r\n      if (distance < negRadius) {\r\n\r\n        return false;\r\n\r\n      }\r\n\r\n    }\r\n\r\n    return true;\r\n\r\n  },\r\n\r\n  intersectsBox: function() {\r\n\r\n    var p1 = new THREE.Vector3(),\r\n      p2 = new THREE.Vector3();\r\n\r\n    return function(box) {\r\n\r\n      var planes = this.planes;\r\n\r\n      for (var i = 0; i < 6; i++) {\r\n\r\n        var plane = planes[i];\r\n\r\n        p1.x = plane.normal.x > 0 ? box.min.x : box.max.x;\r\n        p2.x = plane.normal.x > 0 ? box.max.x : box.min.x;\r\n        p1.y = plane.normal.y > 0 ? box.min.y : box.max.y;\r\n        p2.y = plane.normal.y > 0 ? box.max.y : box.min.y;\r\n        p1.z = plane.normal.z > 0 ? box.min.z : box.max.z;\r\n        p2.z = plane.normal.z > 0 ? box.max.z : box.min.z;\r\n\r\n        var d1 = plane.distanceToPoint(p1);\r\n        var d2 = plane.distanceToPoint(p2);\r\n\r\n        // if both outside plane, no intersection\r\n\r\n        if (d1 < 0 && d2 < 0) {\r\n\r\n          return false;\r\n\r\n        }\r\n      }\r\n\r\n      return true;\r\n    };\r\n\r\n  }(),\r\n\r\n\r\n  containsPoint: function(point) {\r\n\r\n    var planes = this.planes;\r\n\r\n    for (var i = 0; i < 6; i++) {\r\n\r\n      if (planes[i].distanceToPoint(point) < 0) {\r\n\r\n        return false;\r\n\r\n      }\r\n\r\n    }\r\n\r\n    return true;\r\n\r\n  },\r\n\r\n  clone: function() {\r\n\r\n    return new THREE.Frustum().copy(this);\r\n\r\n  }\r\n\r\n};\r\n\r\n// File:src/math/Plane.js\r\n\r\n/**\r\n * @author bhouston / http://exocortex.com\r\n */\r\n\r\nTHREE.Plane = function(normal, constant) {\r\n\r\n  this.normal = (normal !== undefined) ? normal : new THREE.Vector3(1, 0, 0);\r\n  this.constant = (constant !== undefined) ? constant : 0;\r\n\r\n};\r\n\r\nTHREE.Plane.prototype = {\r\n\r\n  constructor: THREE.Plane,\r\n\r\n  set: function(normal, constant) {\r\n\r\n    this.normal.copy(normal);\r\n    this.constant = constant;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  setComponents: function(x, y, z, w) {\r\n\r\n    this.normal.set(x, y, z);\r\n    this.constant = w;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  setFromNormalAndCoplanarPoint: function(normal, point) {\r\n\r\n    this.normal.copy(normal);\r\n    this.constant = -point.dot(this.normal); // must be this.normal, not normal, as this.normal is normalized\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  setFromCoplanarPoints: function() {\r\n\r\n    var v1 = new THREE.Vector3();\r\n    var v2 = new THREE.Vector3();\r\n\r\n    return function(a, b, c) {\r\n\r\n      var normal = v1.subVectors(c, b).cross(v2.subVectors(a, b)).normalize();\r\n\r\n      // Q: should an error be thrown if normal is zero (e.g. degenerate plane)?\r\n\r\n      this.setFromNormalAndCoplanarPoint(normal, a);\r\n\r\n      return this;\r\n\r\n    };\r\n\r\n  }(),\r\n\r\n\r\n  copy: function(plane) {\r\n\r\n    this.normal.copy(plane.normal);\r\n    this.constant = plane.constant;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  normalize: function() {\r\n\r\n    // Note: will lead to a divide by zero if the plane is invalid.\r\n\r\n    var inverseNormalLength = 1.0 / this.normal.length();\r\n    this.normal.multiplyScalar(inverseNormalLength);\r\n    this.constant *= inverseNormalLength;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  negate: function() {\r\n\r\n    this.constant *= -1;\r\n    this.normal.negate();\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  distanceToPoint: function(point) {\r\n\r\n    return this.normal.dot(point) + this.constant;\r\n\r\n  },\r\n\r\n  distanceToSphere: function(sphere) {\r\n\r\n    return this.distanceToPoint(sphere.center) - sphere.radius;\r\n\r\n  },\r\n\r\n  projectPoint: function(point, optionalTarget) {\r\n\r\n    return this.orthoPoint(point, optionalTarget).sub(point).negate();\r\n\r\n  },\r\n\r\n  orthoPoint: function(point, optionalTarget) {\r\n\r\n    var perpendicularMagnitude = this.distanceToPoint(point);\r\n\r\n    var result = optionalTarget || new THREE.Vector3();\r\n    return result.copy(this.normal).multiplyScalar(perpendicularMagnitude);\r\n\r\n  },\r\n\r\n  isIntersectionLine: function(line) {\r\n\r\n    // Note: this tests if a line intersects the plane, not whether it (or its end-points) are coplanar with it.\r\n\r\n    var startSign = this.distanceToPoint(line.start);\r\n    var endSign = this.distanceToPoint(line.end);\r\n\r\n    return (startSign < 0 && endSign > 0) || (endSign < 0 && startSign > 0);\r\n\r\n  },\r\n\r\n  intersectLine: function() {\r\n\r\n    var v1 = new THREE.Vector3();\r\n\r\n    return function(line, optionalTarget) {\r\n\r\n      var result = optionalTarget || new THREE.Vector3();\r\n\r\n      var direction = line.delta(v1);\r\n\r\n      var denominator = this.normal.dot(direction);\r\n\r\n      if (denominator == 0) {\r\n\r\n        // line is coplanar, return origin\r\n        if (this.distanceToPoint(line.start) == 0) {\r\n\r\n          return result.copy(line.start);\r\n\r\n        }\r\n\r\n        // Unsure if this is the correct method to handle this case.\r\n        return undefined;\r\n\r\n      }\r\n\r\n      var t = -(line.start.dot(this.normal) + this.constant) / denominator;\r\n\r\n      if (t < 0 || t > 1) {\r\n\r\n        return undefined;\r\n\r\n      }\r\n\r\n      return result.copy(direction).multiplyScalar(t).add(line.start);\r\n\r\n    };\r\n\r\n  }(),\r\n\r\n\r\n  coplanarPoint: function(optionalTarget) {\r\n\r\n    var result = optionalTarget || new THREE.Vector3();\r\n    return result.copy(this.normal).multiplyScalar(-this.constant);\r\n\r\n  },\r\n\r\n  applyMatrix4: function() {\r\n\r\n    var v1 = new THREE.Vector3();\r\n    var v2 = new THREE.Vector3();\r\n    var m1 = new THREE.Matrix3();\r\n\r\n    return function(matrix, optionalNormalMatrix) {\r\n\r\n      // compute new normal based on theory here:\r\n      // http://www.songho.ca/opengl/gl_normaltransform.html\r\n      var normalMatrix = optionalNormalMatrix || m1.getNormalMatrix(matrix);\r\n      var newNormal = v1.copy(this.normal).applyMatrix3(normalMatrix);\r\n\r\n      var newCoplanarPoint = this.coplanarPoint(v2);\r\n      newCoplanarPoint.applyMatrix4(matrix);\r\n\r\n      this.setFromNormalAndCoplanarPoint(newNormal, newCoplanarPoint);\r\n\r\n      return this;\r\n\r\n    };\r\n\r\n  }(),\r\n\r\n  translate: function(offset) {\r\n\r\n    this.constant = this.constant - offset.dot(this.normal);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  equals: function(plane) {\r\n\r\n    return plane.normal.equals(this.normal) && (plane.constant == this.constant);\r\n\r\n  },\r\n\r\n  clone: function() {\r\n\r\n    return new THREE.Plane().copy(this);\r\n\r\n  }\r\n\r\n};\r\n\r\n// File:src/math/Math.js\r\n\r\n/**\r\n * @author alteredq / http://alteredqualia.com/\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.Math = {\r\n\r\n  generateUUID: function() {\r\n\r\n    // http://www.broofa.com/Tools/Math.uuid.htm\r\n\r\n    var chars = '0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz'.split('');\r\n    var uuid = new Array(36);\r\n    var rnd = 0,\r\n      r;\r\n\r\n    return function() {\r\n\r\n      for (var i = 0; i < 36; i++) {\r\n\r\n        if (i == 8 || i == 13 || i == 18 || i == 23) {\r\n\r\n          uuid[i] = '-';\r\n\r\n        }\r\n        else if (i == 14) {\r\n\r\n          uuid[i] = '4';\r\n\r\n        }\r\n        else {\r\n\r\n          if (rnd <= 0x02) rnd = 0x2000000 + (Math.random() * 0x1000000) | 0;\r\n          r = rnd & 0xf;\r\n          rnd = rnd >> 4;\r\n          uuid[i] = chars[(i == 19) ? (r & 0x3) | 0x8 : r];\r\n\r\n        }\r\n      }\r\n\r\n      return uuid.join('');\r\n\r\n    };\r\n\r\n  }(),\r\n\r\n  // Clamp value to range <a, b>\r\n\r\n  clamp: function(x, a, b) {\r\n\r\n    return (x < a) ? a : ((x > b) ? b : x);\r\n\r\n  },\r\n\r\n  // Clamp value to range <a, inf)\r\n\r\n  clampBottom: function(x, a) {\r\n\r\n    return x < a ? a : x;\r\n\r\n  },\r\n\r\n  // Linear mapping from range <a1, a2> to range <b1, b2>\r\n\r\n  mapLinear: function(x, a1, a2, b1, b2) {\r\n\r\n    return b1 + (x - a1) * (b2 - b1) / (a2 - a1);\r\n\r\n  },\r\n\r\n  // http://en.wikipedia.org/wiki/Smoothstep\r\n\r\n  smoothstep: function(x, min, max) {\r\n\r\n    if (x <= min) return 0;\r\n    if (x >= max) return 1;\r\n\r\n    x = (x - min) / (max - min);\r\n\r\n    return x * x * (3 - 2 * x);\r\n\r\n  },\r\n\r\n  smootherstep: function(x, min, max) {\r\n\r\n    if (x <= min) return 0;\r\n    if (x >= max) return 1;\r\n\r\n    x = (x - min) / (max - min);\r\n\r\n    return x * x * x * (x * (x * 6 - 15) + 10);\r\n\r\n  },\r\n\r\n  // Random float from <0, 1> with 16 bits of randomness\r\n  // (standard Math.random() creates repetitive patterns when applied over larger space)\r\n\r\n  random16: function() {\r\n\r\n    return (65280 * Math.random() + 255 * Math.random()) / 65535;\r\n\r\n  },\r\n\r\n  // Random integer from <low, high> interval\r\n\r\n  randInt: function(low, high) {\r\n\r\n    return Math.floor(this.randFloat(low, high));\r\n\r\n  },\r\n\r\n  // Random float from <low, high> interval\r\n\r\n  randFloat: function(low, high) {\r\n\r\n    return low + Math.random() * (high - low);\r\n\r\n  },\r\n\r\n  // Random float from <-range/2, range/2> interval\r\n\r\n  randFloatSpread: function(range) {\r\n\r\n    return range * (0.5 - Math.random());\r\n\r\n  },\r\n\r\n  degToRad: function() {\r\n\r\n    var degreeToRadiansFactor = Math.PI / 180;\r\n\r\n    return function(degrees) {\r\n\r\n      return degrees * degreeToRadiansFactor;\r\n\r\n    };\r\n\r\n  }(),\r\n\r\n  radToDeg: function() {\r\n\r\n    var radianToDegreesFactor = 180 / Math.PI;\r\n\r\n    return function(radians) {\r\n\r\n      return radians * radianToDegreesFactor;\r\n\r\n    };\r\n\r\n  }(),\r\n\r\n  isPowerOfTwo: function(value) {\r\n\r\n    return (value & (value - 1)) === 0 && value !== 0;\r\n\r\n  },\r\n\r\n  nextPowerOfTwo: function(value) {\r\n\r\n    value--;\r\n    value |= value >> 1;\r\n    value |= value >> 2;\r\n    value |= value >> 4;\r\n    value |= value >> 8;\r\n    value |= value >> 16;\r\n    value++;\r\n\r\n    return value;\r\n\r\n  }\r\n\r\n};\r\n\r\n// File:src/math/Spline.js\r\n\r\n/**\r\n * Spline from Tween.js, slightly optimized (and trashed)\r\n * http://sole.github.com/tween.js/examples/05_spline.html\r\n *\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author alteredq / http://alteredqualia.com/\r\n */\r\n\r\nTHREE.Spline = function(points) {\r\n\r\n  this.points = points;\r\n\r\n  var c = [],\r\n    v3 = {\r\n      x: 0,\r\n      y: 0,\r\n      z: 0\r\n    },\r\n    point, intPoint, weight, w2, w3,\r\n    pa, pb, pc, pd;\r\n\r\n  this.initFromArray = function(a) {\r\n\r\n    this.points = [];\r\n\r\n    for (var i = 0; i < a.length; i++) {\r\n\r\n      this.points[i] = {\r\n        x: a[i][0],\r\n        y: a[i][1],\r\n        z: a[i][2]\r\n      };\r\n\r\n    }\r\n\r\n  };\r\n\r\n  this.getPoint = function(k) {\r\n\r\n    point = (this.points.length - 1) * k;\r\n    intPoint = Math.floor(point);\r\n    weight = point - intPoint;\r\n\r\n    c[0] = intPoint === 0 ? intPoint : intPoint - 1;\r\n    c[1] = intPoint;\r\n    c[2] = intPoint > this.points.length - 2 ? this.points.length - 1 : intPoint + 1;\r\n    c[3] = intPoint > this.points.length - 3 ? this.points.length - 1 : intPoint + 2;\r\n\r\n    pa = this.points[c[0]];\r\n    pb = this.points[c[1]];\r\n    pc = this.points[c[2]];\r\n    pd = this.points[c[3]];\r\n\r\n    w2 = weight * weight;\r\n    w3 = weight * w2;\r\n\r\n    v3.x = interpolate(pa.x, pb.x, pc.x, pd.x, weight, w2, w3);\r\n    v3.y = interpolate(pa.y, pb.y, pc.y, pd.y, weight, w2, w3);\r\n    v3.z = interpolate(pa.z, pb.z, pc.z, pd.z, weight, w2, w3);\r\n\r\n    return v3;\r\n\r\n  };\r\n\r\n  this.getControlPointsArray = function() {\r\n\r\n    var i, p, l = this.points.length,\r\n      coords = [];\r\n\r\n    for (i = 0; i < l; i++) {\r\n\r\n      p = this.points[i];\r\n      coords[i] = [p.x, p.y, p.z];\r\n\r\n    }\r\n\r\n    return coords;\r\n\r\n  };\r\n\r\n  // approximate length by summing linear segments\r\n\r\n  this.getLength = function(nSubDivisions) {\r\n\r\n    var i, index, nSamples, position,\r\n      point = 0,\r\n      intPoint = 0,\r\n      oldIntPoint = 0,\r\n      oldPosition = new THREE.Vector3(),\r\n      tmpVec = new THREE.Vector3(),\r\n      chunkLengths = [],\r\n      totalLength = 0;\r\n\r\n    // first point has 0 length\r\n\r\n    chunkLengths[0] = 0;\r\n\r\n    if (!nSubDivisions) nSubDivisions = 100;\r\n\r\n    nSamples = this.points.length * nSubDivisions;\r\n\r\n    oldPosition.copy(this.points[0]);\r\n\r\n    for (i = 1; i < nSamples; i++) {\r\n\r\n      index = i / nSamples;\r\n\r\n      position = this.getPoint(index);\r\n      tmpVec.copy(position);\r\n\r\n      totalLength += tmpVec.distanceTo(oldPosition);\r\n\r\n      oldPosition.copy(position);\r\n\r\n      point = (this.points.length - 1) * index;\r\n      intPoint = Math.floor(point);\r\n\r\n      if (intPoint != oldIntPoint) {\r\n\r\n        chunkLengths[intPoint] = totalLength;\r\n        oldIntPoint = intPoint;\r\n\r\n      }\r\n\r\n    }\r\n\r\n    // last point ends with total length\r\n\r\n    chunkLengths[chunkLengths.length] = totalLength;\r\n\r\n    return {\r\n      chunks: chunkLengths,\r\n      total: totalLength\r\n    };\r\n\r\n  };\r\n\r\n  this.reparametrizeByArcLength = function(samplingCoef) {\r\n\r\n    var i, j,\r\n      index, indexCurrent, indexNext,\r\n      realDistance,\r\n      sampling, position,\r\n      newpoints = [],\r\n      tmpVec = new THREE.Vector3(),\r\n      sl = this.getLength();\r\n\r\n    newpoints.push(tmpVec.copy(this.points[0]).clone());\r\n\r\n    for (i = 1; i < this.points.length; i++) {\r\n\r\n      //tmpVec.copy( this.points[ i - 1 ] );\r\n      //linearDistance = tmpVec.distanceTo( this.points[ i ] );\r\n\r\n      realDistance = sl.chunks[i] - sl.chunks[i - 1];\r\n\r\n      sampling = Math.ceil(samplingCoef * realDistance / sl.total);\r\n\r\n      indexCurrent = (i - 1) / (this.points.length - 1);\r\n      indexNext = i / (this.points.length - 1);\r\n\r\n      for (j = 1; j < sampling - 1; j++) {\r\n\r\n        index = indexCurrent + j * (1 / sampling) * (indexNext - indexCurrent);\r\n\r\n        position = this.getPoint(index);\r\n        newpoints.push(tmpVec.copy(position).clone());\r\n\r\n      }\r\n\r\n      newpoints.push(tmpVec.copy(this.points[i]).clone());\r\n\r\n    }\r\n\r\n    this.points = newpoints;\r\n\r\n  };\r\n\r\n  // Catmull-Rom\r\n\r\n  function interpolate(p0, p1, p2, p3, t, t2, t3) {\r\n\r\n    var v0 = (p2 - p0) * 0.5,\r\n      v1 = (p3 - p1) * 0.5;\r\n\r\n    return (2 * (p1 - p2) + v0 + v1) * t3 + (-3 * (p1 - p2) - 2 * v0 - v1) * t2 + v0 * t + p1;\r\n\r\n  };\r\n\r\n};\r\n\r\n// File:src/math/Triangle.js\r\n\r\n/**\r\n * @author bhouston / http://exocortex.com\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.Triangle = function(a, b, c) {\r\n\r\n  this.a = (a !== undefined) ? a : new THREE.Vector3();\r\n  this.b = (b !== undefined) ? b : new THREE.Vector3();\r\n  this.c = (c !== undefined) ? c : new THREE.Vector3();\r\n\r\n};\r\n\r\nTHREE.Triangle.normal = function() {\r\n\r\n  var v0 = new THREE.Vector3();\r\n\r\n  return function(a, b, c, optionalTarget) {\r\n\r\n    var result = optionalTarget || new THREE.Vector3();\r\n\r\n    result.subVectors(c, b);\r\n    v0.subVectors(a, b);\r\n    result.cross(v0);\r\n\r\n    var resultLengthSq = result.lengthSq();\r\n    if (resultLengthSq > 0) {\r\n\r\n      return result.multiplyScalar(1 / Math.sqrt(resultLengthSq));\r\n\r\n    }\r\n\r\n    return result.set(0, 0, 0);\r\n\r\n  };\r\n\r\n}();\r\n\r\n// static/instance method to calculate barycoordinates\r\n// based on: http://www.blackpawn.com/texts/pointinpoly/default.html\r\nTHREE.Triangle.barycoordFromPoint = function() {\r\n\r\n  var v0 = new THREE.Vector3();\r\n  var v1 = new THREE.Vector3();\r\n  var v2 = new THREE.Vector3();\r\n\r\n  return function(point, a, b, c, optionalTarget) {\r\n\r\n    v0.subVectors(c, a);\r\n    v1.subVectors(b, a);\r\n    v2.subVectors(point, a);\r\n\r\n    var dot00 = v0.dot(v0);\r\n    var dot01 = v0.dot(v1);\r\n    var dot02 = v0.dot(v2);\r\n    var dot11 = v1.dot(v1);\r\n    var dot12 = v1.dot(v2);\r\n\r\n    var denom = (dot00 * dot11 - dot01 * dot01);\r\n\r\n    var result = optionalTarget || new THREE.Vector3();\r\n\r\n    // colinear or singular triangle\r\n    if (denom == 0) {\r\n      // arbitrary location outside of triangle?\r\n      // not sure if this is the best idea, maybe should be returning undefined\r\n      return result.set(-2, -1, -1);\r\n    }\r\n\r\n    var invDenom = 1 / denom;\r\n    var u = (dot11 * dot02 - dot01 * dot12) * invDenom;\r\n    var v = (dot00 * dot12 - dot01 * dot02) * invDenom;\r\n\r\n    // barycoordinates must always sum to 1\r\n    return result.set(1 - u - v, v, u);\r\n\r\n  };\r\n\r\n}();\r\n\r\nTHREE.Triangle.containsPoint = function() {\r\n\r\n  var v1 = new THREE.Vector3();\r\n\r\n  return function(point, a, b, c) {\r\n\r\n    var result = THREE.Triangle.barycoordFromPoint(point, a, b, c, v1);\r\n\r\n    return (result.x >= 0) && (result.y >= 0) && ((result.x + result.y) <= 1);\r\n\r\n  };\r\n\r\n}();\r\n\r\nTHREE.Triangle.prototype = {\r\n\r\n  constructor: THREE.Triangle,\r\n\r\n  set: function(a, b, c) {\r\n\r\n    this.a.copy(a);\r\n    this.b.copy(b);\r\n    this.c.copy(c);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  setFromPointsAndIndices: function(points, i0, i1, i2) {\r\n\r\n    this.a.copy(points[i0]);\r\n    this.b.copy(points[i1]);\r\n    this.c.copy(points[i2]);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  copy: function(triangle) {\r\n\r\n    this.a.copy(triangle.a);\r\n    this.b.copy(triangle.b);\r\n    this.c.copy(triangle.c);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  area: function() {\r\n\r\n    var v0 = new THREE.Vector3();\r\n    var v1 = new THREE.Vector3();\r\n\r\n    return function() {\r\n\r\n      v0.subVectors(this.c, this.b);\r\n      v1.subVectors(this.a, this.b);\r\n\r\n      return v0.cross(v1).length() * 0.5;\r\n\r\n    };\r\n\r\n  }(),\r\n\r\n  midpoint: function(optionalTarget) {\r\n\r\n    var result = optionalTarget || new THREE.Vector3();\r\n    return result.addVectors(this.a, this.b).add(this.c).multiplyScalar(1 / 3);\r\n\r\n  },\r\n\r\n  normal: function(optionalTarget) {\r\n\r\n    return THREE.Triangle.normal(this.a, this.b, this.c, optionalTarget);\r\n\r\n  },\r\n\r\n  plane: function(optionalTarget) {\r\n\r\n    var result = optionalTarget || new THREE.Plane();\r\n\r\n    return result.setFromCoplanarPoints(this.a, this.b, this.c);\r\n\r\n  },\r\n\r\n  barycoordFromPoint: function(point, optionalTarget) {\r\n\r\n    return THREE.Triangle.barycoordFromPoint(point, this.a, this.b, this.c, optionalTarget);\r\n\r\n  },\r\n\r\n  containsPoint: function(point) {\r\n\r\n    return THREE.Triangle.containsPoint(point, this.a, this.b, this.c);\r\n\r\n  },\r\n\r\n  equals: function(triangle) {\r\n\r\n    return triangle.a.equals(this.a) && triangle.b.equals(this.b) && triangle.c.equals(this.c);\r\n\r\n  },\r\n\r\n  clone: function() {\r\n\r\n    return new THREE.Triangle().copy(this);\r\n\r\n  }\r\n\r\n};\r\n\r\n// File:src/core/Clock.js\r\n\r\n/**\r\n * @author alteredq / http://alteredqualia.com/\r\n */\r\n\r\nTHREE.Clock = function(autoStart) {\r\n\r\n  this.autoStart = (autoStart !== undefined) ? autoStart : true;\r\n\r\n  this.startTime = 0;\r\n  this.oldTime = 0;\r\n  this.elapsedTime = 0;\r\n\r\n  this.running = false;\r\n\r\n};\r\n\r\nTHREE.Clock.prototype = {\r\n\r\n  constructor: THREE.Clock,\r\n\r\n  start: function() {\r\n\r\n    this.startTime = self.performance !== undefined && self.performance.now !== undefined ? self.performance.now() : Date.now();\r\n\r\n    this.oldTime = this.startTime;\r\n    this.running = true;\r\n  },\r\n\r\n  stop: function() {\r\n\r\n    this.getElapsedTime();\r\n    this.running = false;\r\n\r\n  },\r\n\r\n  getElapsedTime: function() {\r\n\r\n    this.getDelta();\r\n    return this.elapsedTime;\r\n\r\n  },\r\n\r\n  getDelta: function() {\r\n\r\n    var diff = 0;\r\n\r\n    if (this.autoStart && !this.running) {\r\n\r\n      this.start();\r\n\r\n    }\r\n\r\n    if (this.running) {\r\n\r\n      var newTime = self.performance !== undefined && self.performance.now !== undefined ? self.performance.now() : Date.now();\r\n\r\n      diff = 0.001 * (newTime - this.oldTime);\r\n      this.oldTime = newTime;\r\n\r\n      this.elapsedTime += diff;\r\n\r\n    }\r\n\r\n    return diff;\r\n\r\n  }\r\n\r\n};\r\n\r\n// File:src/core/EventDispatcher.js\r\n\r\n/**\r\n * https://github.com/mrdoob/eventdispatcher.js/\r\n */\r\n\r\nTHREE.EventDispatcher = function() {}\r\n\r\nTHREE.EventDispatcher.prototype = {\r\n\r\n  constructor: THREE.EventDispatcher,\r\n\r\n  apply: function(object) {\r\n\r\n    object.addEventListener = THREE.EventDispatcher.prototype.addEventListener;\r\n    object.hasEventListener = THREE.EventDispatcher.prototype.hasEventListener;\r\n    object.removeEventListener = THREE.EventDispatcher.prototype.removeEventListener;\r\n    object.dispatchEvent = THREE.EventDispatcher.prototype.dispatchEvent;\r\n\r\n  },\r\n\r\n  addEventListener: function(type, listener) {\r\n\r\n    if (this._listeners === undefined) this._listeners = {};\r\n\r\n    var listeners = this._listeners;\r\n\r\n    if (listeners[type] === undefined) {\r\n\r\n      listeners[type] = [];\r\n\r\n    }\r\n\r\n    if (listeners[type].indexOf(listener) === -1) {\r\n\r\n      listeners[type].push(listener);\r\n\r\n    }\r\n\r\n  },\r\n\r\n  hasEventListener: function(type, listener) {\r\n\r\n    if (this._listeners === undefined) return false;\r\n\r\n    var listeners = this._listeners;\r\n\r\n    if (listeners[type] !== undefined && listeners[type].indexOf(listener) !== -1) {\r\n\r\n      return true;\r\n\r\n    }\r\n\r\n    return false;\r\n\r\n  },\r\n\r\n  removeEventListener: function(type, listener) {\r\n\r\n    if (this._listeners === undefined) return;\r\n\r\n    var listeners = this._listeners;\r\n    var listenerArray = listeners[type];\r\n\r\n    if (listenerArray !== undefined) {\r\n\r\n      var index = listenerArray.indexOf(listener);\r\n\r\n      if (index !== -1) {\r\n\r\n        listenerArray.splice(index, 1);\r\n\r\n      }\r\n\r\n    }\r\n\r\n  },\r\n\r\n  dispatchEvent: function(event) {\r\n\r\n    if (this._listeners === undefined) return;\r\n\r\n    var listeners = this._listeners;\r\n    var listenerArray = listeners[event.type];\r\n\r\n    if (listenerArray !== undefined) {\r\n\r\n      event.target = this;\r\n\r\n      var array = [];\r\n      var length = listenerArray.length;\r\n\r\n      for (var i = 0; i < length; i++) {\r\n\r\n        array[i] = listenerArray[i];\r\n\r\n      }\r\n\r\n      for (var i = 0; i < length; i++) {\r\n\r\n        array[i].call(this, event);\r\n\r\n      }\r\n\r\n    }\r\n\r\n  }\r\n\r\n};\r\n\r\n// File:src/core/Raycaster.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author bhouston / http://exocortex.com/\r\n * @author stephomi / http://stephaneginier.com/\r\n */\r\n\r\n(function(THREE) {\r\n\r\n  THREE.Raycaster = function(origin, direction, near, far) {\r\n\r\n    this.ray = new THREE.Ray(origin, direction);\r\n    // direction is assumed to be normalized (for accurate distance calculations)\r\n\r\n    this.near = near || 0;\r\n    this.far = far || Infinity;\r\n\r\n    this.params = {\r\n      Sprite: {},\r\n      Mesh: {},\r\n      PointCloud: {\r\n        threshold: 1\r\n      },\r\n      LOD: {},\r\n      Line: {}\r\n    };\r\n\r\n  };\r\n\r\n  var descSort = function(a, b) {\r\n\r\n    return a.distance - b.distance;\r\n\r\n  };\r\n\r\n  var intersectObject = function(object, raycaster, intersects, recursive) {\r\n\r\n    object.raycast(raycaster, intersects);\r\n\r\n    if (recursive === true) {\r\n\r\n      var children = object.children;\r\n\r\n      for (var i = 0, l = children.length; i < l; i++) {\r\n\r\n        intersectObject(children[i], raycaster, intersects, true);\r\n\r\n      }\r\n\r\n    }\r\n\r\n  };\r\n\r\n  //\r\n\r\n  THREE.Raycaster.prototype = {\r\n\r\n    constructor: THREE.Raycaster,\r\n\r\n    precision: 0.0001,\r\n    linePrecision: 1,\r\n\r\n    set: function(origin, direction) {\r\n\r\n      // direction is assumed to be normalized (for accurate distance calculations)\r\n\r\n      this.ray.set(origin, direction);\r\n\r\n    },\r\n\r\n    setFromCamera: function(coords, camera) {\r\n\r\n      // camera is assumed _not_ to be a child of a transformed object\r\n\r\n      if (camera instanceof THREE.PerspectiveCamera) {\r\n\r\n        this.ray.origin.copy(camera.position);\r\n        this.ray.direction.set(coords.x, coords.y, 0.5).unproject(camera).sub(camera.position).normalize();\r\n\r\n      }\r\n      else if (camera instanceof THREE.OrthographicCamera) {\r\n\r\n        this.ray.origin.set(coords.x, coords.y, -1).unproject(camera);\r\n        this.ray.direction.set(0, 0, -1).transformDirection(camera.matrixWorld);\r\n\r\n      }\r\n      else {\r\n\r\n        THREE.error('THREE.Raycaster: Unsupported camera type.');\r\n\r\n      }\r\n\r\n    },\r\n\r\n    intersectObject: function(object, recursive) {\r\n\r\n      var intersects = [];\r\n\r\n      intersectObject(object, this, intersects, recursive);\r\n\r\n      intersects.sort(descSort);\r\n\r\n      return intersects;\r\n\r\n    },\r\n\r\n    intersectObjects: function(objects, recursive) {\r\n\r\n      var intersects = [];\r\n\r\n      if (objects instanceof Array === false) {\r\n\r\n        THREE.warn('THREE.Raycaster.intersectObjects: objects is not an Array.');\r\n        return intersects;\r\n\r\n      }\r\n\r\n      for (var i = 0, l = objects.length; i < l; i++) {\r\n\r\n        intersectObject(objects[i], this, intersects, recursive);\r\n\r\n      }\r\n\r\n      intersects.sort(descSort);\r\n\r\n      return intersects;\r\n\r\n    }\r\n\r\n  };\r\n\r\n}(THREE));\r\n\r\n// File:src/core/Object3D.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author mikael emtinger / http://gomo.se/\r\n * @author alteredq / http://alteredqualia.com/\r\n * @author WestLangley / http://github.com/WestLangley\r\n */\r\n\r\nTHREE.Object3D = function() {\r\n\r\n  Object.defineProperty(this, 'id', {\r\n    value: THREE.Object3DIdCount++\r\n  });\r\n\r\n  this.uuid = THREE.Math.generateUUID();\r\n\r\n  this.name = '';\r\n  this.type = 'Object3D';\r\n\r\n  this.parent = undefined;\r\n  this.children = [];\r\n\r\n  this.up = THREE.Object3D.DefaultUp.clone();\r\n\r\n  var position = new THREE.Vector3();\r\n  var rotation = new THREE.Euler();\r\n  var quaternion = new THREE.Quaternion();\r\n  var scale = new THREE.Vector3(1, 1, 1);\r\n\r\n  var onRotationChange = function() {\r\n    quaternion.setFromEuler(rotation, false);\r\n  };\r\n\r\n  var onQuaternionChange = function() {\r\n    rotation.setFromQuaternion(quaternion, undefined, false);\r\n  };\r\n\r\n  rotation.onChange(onRotationChange);\r\n  quaternion.onChange(onQuaternionChange);\r\n\r\n  Object.defineProperties(this, {\r\n    position: {\r\n      enumerable: true,\r\n      value: position\r\n    },\r\n    rotation: {\r\n      enumerable: true,\r\n      value: rotation\r\n    },\r\n    quaternion: {\r\n      enumerable: true,\r\n      value: quaternion\r\n    },\r\n    scale: {\r\n      enumerable: true,\r\n      value: scale\r\n    }\r\n  });\r\n\r\n  this.rotationAutoUpdate = true;\r\n\r\n  this.matrix = new THREE.Matrix4();\r\n  this.matrixWorld = new THREE.Matrix4();\r\n\r\n  this.matrixAutoUpdate = true;\r\n  this.matrixWorldNeedsUpdate = false;\r\n\r\n  this.visible = true;\r\n\r\n  this.castShadow = false;\r\n  this.receiveShadow = false;\r\n\r\n  this.frustumCulled = true;\r\n  this.renderOrder = 0;\r\n\r\n  this.userData = {};\r\n\r\n};\r\n\r\nTHREE.Object3D.DefaultUp = new THREE.Vector3(0, 1, 0);\r\n\r\nTHREE.Object3D.prototype = {\r\n\r\n  constructor: THREE.Object3D,\r\n\r\n  get eulerOrder() {\r\n\r\n    THREE.warn('THREE.Object3D: .eulerOrder has been moved to .rotation.order.');\r\n\r\n    return this.rotation.order;\r\n\r\n  },\r\n\r\n  set eulerOrder(value) {\r\n\r\n    THREE.warn('THREE.Object3D: .eulerOrder has been moved to .rotation.order.');\r\n\r\n    this.rotation.order = value;\r\n\r\n  },\r\n\r\n  get useQuaternion() {\r\n\r\n    THREE.warn('THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.');\r\n\r\n  },\r\n\r\n  set useQuaternion(value) {\r\n\r\n    THREE.warn('THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.');\r\n\r\n  },\r\n\r\n  applyMatrix: function(matrix) {\r\n\r\n    this.matrix.multiplyMatrices(matrix, this.matrix);\r\n\r\n    this.matrix.decompose(this.position, this.quaternion, this.scale);\r\n\r\n  },\r\n\r\n  setRotationFromAxisAngle: function(axis, angle) {\r\n\r\n    // assumes axis is normalized\r\n\r\n    this.quaternion.setFromAxisAngle(axis, angle);\r\n\r\n  },\r\n\r\n  setRotationFromEuler: function(euler) {\r\n\r\n    this.quaternion.setFromEuler(euler, true);\r\n\r\n  },\r\n\r\n  setRotationFromMatrix: function(m) {\r\n\r\n    // assumes the upper 3x3 of m is a pure rotation matrix (i.e, unscaled)\r\n\r\n    this.quaternion.setFromRotationMatrix(m);\r\n\r\n  },\r\n\r\n  setRotationFromQuaternion: function(q) {\r\n\r\n    // assumes q is normalized\r\n\r\n    this.quaternion.copy(q);\r\n\r\n  },\r\n\r\n  rotateOnAxis: function() {\r\n\r\n    // rotate object on axis in object space\r\n    // axis is assumed to be normalized\r\n\r\n    var q1 = new THREE.Quaternion();\r\n\r\n    return function(axis, angle) {\r\n\r\n      q1.setFromAxisAngle(axis, angle);\r\n\r\n      this.quaternion.multiply(q1);\r\n\r\n      return this;\r\n\r\n    }\r\n\r\n  }(),\r\n\r\n  rotateX: function() {\r\n\r\n    var v1 = new THREE.Vector3(1, 0, 0);\r\n\r\n    return function(angle) {\r\n\r\n      return this.rotateOnAxis(v1, angle);\r\n\r\n    };\r\n\r\n  }(),\r\n\r\n  rotateY: function() {\r\n\r\n    var v1 = new THREE.Vector3(0, 1, 0);\r\n\r\n    return function(angle) {\r\n\r\n      return this.rotateOnAxis(v1, angle);\r\n\r\n    };\r\n\r\n  }(),\r\n\r\n  rotateZ: function() {\r\n\r\n    var v1 = new THREE.Vector3(0, 0, 1);\r\n\r\n    return function(angle) {\r\n\r\n      return this.rotateOnAxis(v1, angle);\r\n\r\n    };\r\n\r\n  }(),\r\n\r\n  translateOnAxis: function() {\r\n\r\n    // translate object by distance along axis in object space\r\n    // axis is assumed to be normalized\r\n\r\n    var v1 = new THREE.Vector3();\r\n\r\n    return function(axis, distance) {\r\n\r\n      v1.copy(axis).applyQuaternion(this.quaternion);\r\n\r\n      this.position.add(v1.multiplyScalar(distance));\r\n\r\n      return this;\r\n\r\n    }\r\n\r\n  }(),\r\n\r\n  translate: function(distance, axis) {\r\n\r\n    THREE.warn('THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead.');\r\n    return this.translateOnAxis(axis, distance);\r\n\r\n  },\r\n\r\n  translateX: function() {\r\n\r\n    var v1 = new THREE.Vector3(1, 0, 0);\r\n\r\n    return function(distance) {\r\n\r\n      return this.translateOnAxis(v1, distance);\r\n\r\n    };\r\n\r\n  }(),\r\n\r\n  translateY: function() {\r\n\r\n    var v1 = new THREE.Vector3(0, 1, 0);\r\n\r\n    return function(distance) {\r\n\r\n      return this.translateOnAxis(v1, distance);\r\n\r\n    };\r\n\r\n  }(),\r\n\r\n  translateZ: function() {\r\n\r\n    var v1 = new THREE.Vector3(0, 0, 1);\r\n\r\n    return function(distance) {\r\n\r\n      return this.translateOnAxis(v1, distance);\r\n\r\n    };\r\n\r\n  }(),\r\n\r\n  localToWorld: function(vector) {\r\n\r\n    return vector.applyMatrix4(this.matrixWorld);\r\n\r\n  },\r\n\r\n  worldToLocal: function() {\r\n\r\n    var m1 = new THREE.Matrix4();\r\n\r\n    return function(vector) {\r\n\r\n      return vector.applyMatrix4(m1.getInverse(this.matrixWorld));\r\n\r\n    };\r\n\r\n  }(),\r\n\r\n  lookAt: function() {\r\n\r\n    // This routine does not support objects with rotated and/or translated parent(s)\r\n\r\n    var m1 = new THREE.Matrix4();\r\n\r\n    return function(vector) {\r\n\r\n      m1.lookAt(vector, this.position, this.up);\r\n\r\n      this.quaternion.setFromRotationMatrix(m1);\r\n\r\n    };\r\n\r\n  }(),\r\n\r\n  add: function(object) {\r\n\r\n    if (arguments.length > 1) {\r\n\r\n      for (var i = 0; i < arguments.length; i++) {\r\n\r\n        this.add(arguments[i]);\r\n\r\n      }\r\n\r\n      return this;\r\n\r\n    };\r\n\r\n    if (object === this) {\r\n\r\n      THREE.error(\"THREE.Object3D.add: object can't be added as a child of itself.\", object);\r\n      return this;\r\n\r\n    }\r\n\r\n    if (object instanceof THREE.Object3D) {\r\n\r\n      if (object.parent !== undefined) {\r\n\r\n        object.parent.remove(object);\r\n\r\n      }\r\n\r\n      object.parent = this;\r\n      object.dispatchEvent({\r\n        type: 'added'\r\n      });\r\n\r\n      this.children.push(object);\r\n\r\n    }\r\n    else {\r\n\r\n      THREE.error(\"THREE.Object3D.add: object not an instance of THREE.Object3D.\", object);\r\n\r\n    }\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  remove: function(object) {\r\n\r\n    if (arguments.length > 1) {\r\n\r\n      for (var i = 0; i < arguments.length; i++) {\r\n\r\n        this.remove(arguments[i]);\r\n\r\n      }\r\n\r\n    };\r\n\r\n    var index = this.children.indexOf(object);\r\n\r\n    if (index !== -1) {\r\n\r\n      object.parent = undefined;\r\n\r\n      object.dispatchEvent({\r\n        type: 'removed'\r\n      });\r\n\r\n      this.children.splice(index, 1);\r\n\r\n    }\r\n\r\n  },\r\n\r\n  getChildByName: function(name) {\r\n\r\n    THREE.warn('THREE.Object3D: .getChildByName() has been renamed to .getObjectByName().');\r\n    return this.getObjectByName(name);\r\n\r\n  },\r\n\r\n  getObjectById: function(id) {\r\n\r\n    return this.getObjectByProperty('id', id);\r\n\r\n  },\r\n\r\n  getObjectByName: function(name) {\r\n\r\n    return this.getObjectByProperty('name', name);\r\n\r\n  },\r\n\r\n  getObjectByProperty: function(name, value) {\r\n\r\n    if (this[name] === value) return this;\r\n\r\n    for (var i = 0, l = this.children.length; i < l; i++) {\r\n\r\n      var child = this.children[i];\r\n      var object = child.getObjectByProperty(name, value);\r\n\r\n      if (object !== undefined) {\r\n\r\n        return object;\r\n\r\n      }\r\n\r\n    }\r\n\r\n    return undefined;\r\n\r\n  },\r\n\r\n  getWorldPosition: function(optionalTarget) {\r\n\r\n    var result = optionalTarget || new THREE.Vector3();\r\n\r\n    this.updateMatrixWorld(true);\r\n\r\n    return result.setFromMatrixPosition(this.matrixWorld);\r\n\r\n  },\r\n\r\n  getWorldQuaternion: function() {\r\n\r\n    var position = new THREE.Vector3();\r\n    var scale = new THREE.Vector3();\r\n\r\n    return function(optionalTarget) {\r\n\r\n      var result = optionalTarget || new THREE.Quaternion();\r\n\r\n      this.updateMatrixWorld(true);\r\n\r\n      this.matrixWorld.decompose(position, result, scale);\r\n\r\n      return result;\r\n\r\n    }\r\n\r\n  }(),\r\n\r\n  getWorldRotation: function() {\r\n\r\n    var quaternion = new THREE.Quaternion();\r\n\r\n    return function(optionalTarget) {\r\n\r\n      var result = optionalTarget || new THREE.Euler();\r\n\r\n      this.getWorldQuaternion(quaternion);\r\n\r\n      return result.setFromQuaternion(quaternion, this.rotation.order, false);\r\n\r\n    }\r\n\r\n  }(),\r\n\r\n  getWorldScale: function() {\r\n\r\n    var position = new THREE.Vector3();\r\n    var quaternion = new THREE.Quaternion();\r\n\r\n    return function(optionalTarget) {\r\n\r\n      var result = optionalTarget || new THREE.Vector3();\r\n\r\n      this.updateMatrixWorld(true);\r\n\r\n      this.matrixWorld.decompose(position, quaternion, result);\r\n\r\n      return result;\r\n\r\n    }\r\n\r\n  }(),\r\n\r\n  getWorldDirection: function() {\r\n\r\n    var quaternion = new THREE.Quaternion();\r\n\r\n    return function(optionalTarget) {\r\n\r\n      var result = optionalTarget || new THREE.Vector3();\r\n\r\n      this.getWorldQuaternion(quaternion);\r\n\r\n      return result.set(0, 0, 1).applyQuaternion(quaternion);\r\n\r\n    }\r\n\r\n  }(),\r\n\r\n  raycast: function() {},\r\n\r\n  traverse: function(callback) {\r\n\r\n    callback(this);\r\n\r\n    for (var i = 0, l = this.children.length; i < l; i++) {\r\n\r\n      this.children[i].traverse(callback);\r\n\r\n    }\r\n\r\n  },\r\n\r\n  traverseVisible: function(callback) {\r\n\r\n    if (this.visible === false) return;\r\n\r\n    callback(this);\r\n\r\n    for (var i = 0, l = this.children.length; i < l; i++) {\r\n\r\n      this.children[i].traverseVisible(callback);\r\n\r\n    }\r\n\r\n  },\r\n\r\n  traverseAncestors: function(callback) {\r\n\r\n    if (this.parent) {\r\n\r\n      callback(this.parent);\r\n\r\n      this.parent.traverseAncestors(callback);\r\n\r\n    }\r\n\r\n  },\r\n\r\n  updateMatrix: function() {\r\n\r\n    this.matrix.compose(this.position, this.quaternion, this.scale);\r\n\r\n    this.matrixWorldNeedsUpdate = true;\r\n\r\n  },\r\n\r\n  updateMatrixWorld: function(force) {\r\n\r\n    if (this.matrixAutoUpdate === true) this.updateMatrix();\r\n\r\n    if (this.matrixWorldNeedsUpdate === true || force === true) {\r\n\r\n      if (this.parent === undefined) {\r\n\r\n        this.matrixWorld.copy(this.matrix);\r\n\r\n      }\r\n      else {\r\n\r\n        this.matrixWorld.multiplyMatrices(this.parent.matrixWorld, this.matrix);\r\n\r\n      }\r\n\r\n      this.matrixWorldNeedsUpdate = false;\r\n\r\n      force = true;\r\n\r\n    }\r\n\r\n    // update children\r\n\r\n    for (var i = 0, l = this.children.length; i < l; i++) {\r\n\r\n      this.children[i].updateMatrixWorld(force);\r\n\r\n    }\r\n\r\n  },\r\n\r\n  toJSON: function() {\r\n\r\n    var output = {\r\n      metadata: {\r\n        version: 4.3,\r\n        type: 'Object',\r\n        generator: 'ObjectExporter'\r\n      }\r\n    };\r\n\r\n    //\r\n\r\n    var geometries = {};\r\n\r\n    var parseGeometry = function(geometry) {\r\n\r\n      if (output.geometries === undefined) {\r\n\r\n        output.geometries = [];\r\n\r\n      }\r\n\r\n      if (geometries[geometry.uuid] === undefined) {\r\n\r\n        var json = geometry.toJSON();\r\n\r\n        delete json.metadata;\r\n\r\n        geometries[geometry.uuid] = json;\r\n\r\n        output.geometries.push(json);\r\n\r\n      }\r\n\r\n      return geometry.uuid;\r\n\r\n    };\r\n\r\n    //\r\n\r\n    var materials = {};\r\n\r\n    var parseMaterial = function(material) {\r\n\r\n      if (output.materials === undefined) {\r\n\r\n        output.materials = [];\r\n\r\n      }\r\n\r\n      if (materials[material.uuid] === undefined) {\r\n\r\n        var json = material.toJSON();\r\n\r\n        delete json.metadata;\r\n\r\n        materials[material.uuid] = json;\r\n\r\n        output.materials.push(json);\r\n\r\n      }\r\n\r\n      return material.uuid;\r\n\r\n    };\r\n\r\n    //\r\n\r\n    var parseObject = function(object) {\r\n\r\n      var data = {};\r\n\r\n      data.uuid = object.uuid;\r\n      data.type = object.type;\r\n\r\n      if (object.name !== '') data.name = object.name;\r\n      if (JSON.stringify(object.userData) !== '{}') data.userData = object.userData;\r\n      if (object.visible !== true) data.visible = object.visible;\r\n\r\n      if (object instanceof THREE.PerspectiveCamera) {\r\n\r\n        data.fov = object.fov;\r\n        data.aspect = object.aspect;\r\n        data.near = object.near;\r\n        data.far = object.far;\r\n\r\n      }\r\n      else if (object instanceof THREE.OrthographicCamera) {\r\n\r\n        data.left = object.left;\r\n        data.right = object.right;\r\n        data.top = object.top;\r\n        data.bottom = object.bottom;\r\n        data.near = object.near;\r\n        data.far = object.far;\r\n\r\n      }\r\n      else if (object instanceof THREE.AmbientLight) {\r\n\r\n        data.color = object.color.getHex();\r\n\r\n      }\r\n      else if (object instanceof THREE.DirectionalLight) {\r\n\r\n        data.color = object.color.getHex();\r\n        data.intensity = object.intensity;\r\n\r\n      }\r\n      else if (object instanceof THREE.PointLight) {\r\n\r\n        data.color = object.color.getHex();\r\n        data.intensity = object.intensity;\r\n        data.distance = object.distance;\r\n        data.decay = object.decay;\r\n\r\n      }\r\n      else if (object instanceof THREE.SpotLight) {\r\n\r\n        data.color = object.color.getHex();\r\n        data.intensity = object.intensity;\r\n        data.distance = object.distance;\r\n        data.angle = object.angle;\r\n        data.exponent = object.exponent;\r\n        data.decay = object.decay;\r\n\r\n      }\r\n      else if (object instanceof THREE.HemisphereLight) {\r\n\r\n        data.color = object.color.getHex();\r\n        data.groundColor = object.groundColor.getHex();\r\n\r\n      }\r\n      else if (object instanceof THREE.Mesh || object instanceof THREE.Line || object instanceof THREE.PointCloud) {\r\n\r\n        data.geometry = parseGeometry(object.geometry);\r\n        data.material = parseMaterial(object.material);\r\n\r\n        if (object instanceof THREE.Line) data.mode = object.mode;\r\n\r\n      }\r\n      else if (object instanceof THREE.Sprite) {\r\n\r\n        data.material = parseMaterial(object.material);\r\n\r\n      }\r\n\r\n      data.matrix = object.matrix.toArray();\r\n\r\n      if (object.children.length > 0) {\r\n\r\n        data.children = [];\r\n\r\n        for (var i = 0; i < object.children.length; i++) {\r\n\r\n          data.children.push(parseObject(object.children[i]));\r\n\r\n        }\r\n\r\n      }\r\n\r\n      return data;\r\n\r\n    }\r\n\r\n    output.object = parseObject(this);\r\n\r\n    return output;\r\n\r\n  },\r\n\r\n  clone: function(object, recursive) {\r\n\r\n    if (object === undefined) object = new THREE.Object3D();\r\n    if (recursive === undefined) recursive = true;\r\n\r\n    object.name = this.name;\r\n\r\n    object.up.copy(this.up);\r\n\r\n    object.position.copy(this.position);\r\n    object.quaternion.copy(this.quaternion);\r\n    object.scale.copy(this.scale);\r\n\r\n    object.rotationAutoUpdate = this.rotationAutoUpdate;\r\n\r\n    object.matrix.copy(this.matrix);\r\n    object.matrixWorld.copy(this.matrixWorld);\r\n\r\n    object.matrixAutoUpdate = this.matrixAutoUpdate;\r\n    object.matrixWorldNeedsUpdate = this.matrixWorldNeedsUpdate;\r\n\r\n    object.visible = this.visible;\r\n\r\n    object.castShadow = this.castShadow;\r\n    object.receiveShadow = this.receiveShadow;\r\n\r\n    object.frustumCulled = this.frustumCulled;\r\n\r\n    object.userData = JSON.parse(JSON.stringify(this.userData));\r\n\r\n    if (recursive === true) {\r\n\r\n      for (var i = 0; i < this.children.length; i++) {\r\n\r\n        var child = this.children[i];\r\n        object.add(child.clone());\r\n\r\n      }\r\n\r\n    }\r\n\r\n    return object;\r\n\r\n  }\r\n\r\n};\r\n\r\nTHREE.EventDispatcher.prototype.apply(THREE.Object3D.prototype);\r\n\r\nTHREE.Object3DIdCount = 0;\r\n\r\n// File:src/core/Face3.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author alteredq / http://alteredqualia.com/\r\n */\r\n\r\nTHREE.Face3 = function(a, b, c, normal, color, materialIndex) {\r\n\r\n  this.a = a;\r\n  this.b = b;\r\n  this.c = c;\r\n\r\n  this.normal = normal instanceof THREE.Vector3 ? normal : new THREE.Vector3();\r\n  this.vertexNormals = normal instanceof Array ? normal : [];\r\n\r\n  this.color = color instanceof THREE.Color ? color : new THREE.Color();\r\n  this.vertexColors = color instanceof Array ? color : [];\r\n\r\n  this.vertexTangents = [];\r\n\r\n  this.materialIndex = materialIndex !== undefined ? materialIndex : 0;\r\n\r\n};\r\n\r\nTHREE.Face3.prototype = {\r\n\r\n  constructor: THREE.Face3,\r\n\r\n  clone: function() {\r\n\r\n    var face = new THREE.Face3(this.a, this.b, this.c);\r\n\r\n    face.normal.copy(this.normal);\r\n    face.color.copy(this.color);\r\n\r\n    face.materialIndex = this.materialIndex;\r\n\r\n    for (var i = 0, il = this.vertexNormals.length; i < il; i++) {\r\n\r\n      face.vertexNormals[i] = this.vertexNormals[i].clone();\r\n\r\n    }\r\n\r\n    for (var i = 0, il = this.vertexColors.length; i < il; i++) {\r\n\r\n      face.vertexColors[i] = this.vertexColors[i].clone();\r\n\r\n    }\r\n\r\n    for (var i = 0, il = this.vertexTangents.length; i < il; i++) {\r\n\r\n      face.vertexTangents[i] = this.vertexTangents[i].clone();\r\n\r\n    }\r\n\r\n    return face;\r\n\r\n  }\r\n\r\n};\r\n\r\n// File:src/core/Face4.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.Face4 = function(a, b, c, d, normal, color, materialIndex) {\r\n\r\n  THREE.warn('THREE.Face4 has been removed. A THREE.Face3 will be created instead.')\r\n  return new THREE.Face3(a, b, c, normal, color, materialIndex);\r\n\r\n};\r\n\r\n// File:src/core/BufferAttribute.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.BufferAttribute = function(array, itemSize) {\r\n\r\n  this.array = array;\r\n  this.itemSize = itemSize;\r\n\r\n  this.needsUpdate = false;\r\n\r\n};\r\n\r\nTHREE.BufferAttribute.prototype = {\r\n\r\n  constructor: THREE.BufferAttribute,\r\n\r\n  get length() {\r\n\r\n    return this.array.length;\r\n\r\n  },\r\n\r\n  copyAt: function(index1, attribute, index2) {\r\n\r\n    index1 *= this.itemSize;\r\n    index2 *= attribute.itemSize;\r\n\r\n    for (var i = 0, l = this.itemSize; i < l; i++) {\r\n\r\n      this.array[index1 + i] = attribute.array[index2 + i];\r\n\r\n    }\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  set: function(value, offset) {\r\n\r\n    if (offset === undefined) offset = 0;\r\n\r\n    this.array.set(value, offset);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  setX: function(index, x) {\r\n\r\n    this.array[index * this.itemSize] = x;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  setY: function(index, y) {\r\n\r\n    this.array[index * this.itemSize + 1] = y;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  setZ: function(index, z) {\r\n\r\n    this.array[index * this.itemSize + 2] = z;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  setXY: function(index, x, y) {\r\n\r\n    index *= this.itemSize;\r\n\r\n    this.array[index] = x;\r\n    this.array[index + 1] = y;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  setXYZ: function(index, x, y, z) {\r\n\r\n    index *= this.itemSize;\r\n\r\n    this.array[index] = x;\r\n    this.array[index + 1] = y;\r\n    this.array[index + 2] = z;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  setXYZW: function(index, x, y, z, w) {\r\n\r\n    index *= this.itemSize;\r\n\r\n    this.array[index] = x;\r\n    this.array[index + 1] = y;\r\n    this.array[index + 2] = z;\r\n    this.array[index + 3] = w;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  clone: function() {\r\n\r\n    return new THREE.BufferAttribute(new this.array.constructor(this.array), this.itemSize);\r\n\r\n  }\r\n\r\n};\r\n\r\n//\r\n\r\nTHREE.Int8Attribute = function(data, itemSize) {\r\n\r\n  THREE.warn('THREE.Int8Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead.');\r\n  return new THREE.BufferAttribute(data, itemSize);\r\n\r\n};\r\n\r\nTHREE.Uint8Attribute = function(data, itemSize) {\r\n\r\n  THREE.warn('THREE.Uint8Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead.');\r\n  return new THREE.BufferAttribute(data, itemSize);\r\n\r\n};\r\n\r\nTHREE.Uint8ClampedAttribute = function(data, itemSize) {\r\n\r\n  THREE.warn('THREE.Uint8ClampedAttribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead.');\r\n  return new THREE.BufferAttribute(data, itemSize);\r\n\r\n\r\n};\r\n\r\nTHREE.Int16Attribute = function(data, itemSize) {\r\n\r\n  THREE.warn('THREE.Int16Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead.');\r\n  return new THREE.BufferAttribute(data, itemSize);\r\n\r\n};\r\n\r\nTHREE.Uint16Attribute = function(data, itemSize) {\r\n\r\n  THREE.warn('THREE.Uint16Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead.');\r\n  return new THREE.BufferAttribute(data, itemSize);\r\n\r\n};\r\n\r\nTHREE.Int32Attribute = function(data, itemSize) {\r\n\r\n  THREE.warn('THREE.Int32Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead.');\r\n  return new THREE.BufferAttribute(data, itemSize);\r\n\r\n};\r\n\r\nTHREE.Uint32Attribute = function(data, itemSize) {\r\n\r\n  THREE.warn('THREE.Uint32Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead.');\r\n  return new THREE.BufferAttribute(data, itemSize);\r\n\r\n};\r\n\r\nTHREE.Float32Attribute = function(data, itemSize) {\r\n\r\n  THREE.warn('THREE.Float32Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead.');\r\n  return new THREE.BufferAttribute(data, itemSize);\r\n\r\n};\r\n\r\nTHREE.Float64Attribute = function(data, itemSize) {\r\n\r\n  THREE.warn('THREE.Float64Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead.');\r\n  return new THREE.BufferAttribute(data, itemSize);\r\n\r\n};\r\n\r\n// File:src/core/DynamicBufferAttribute.js\r\n\r\n/**\r\n * @author benaadams / https://twitter.com/ben_a_adams\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.DynamicBufferAttribute = function(array, itemSize) {\r\n\r\n  THREE.BufferAttribute.call(this, array, itemSize);\r\n\r\n  this.updateRange = {\r\n    offset: 0,\r\n    count: -1\r\n  };\r\n\r\n};\r\n\r\nTHREE.DynamicBufferAttribute.prototype = Object.create(THREE.BufferAttribute.prototype);\r\nTHREE.DynamicBufferAttribute.prototype.constructor = THREE.DynamicBufferAttribute;\r\n\r\nTHREE.DynamicBufferAttribute.prototype.clone = function() {\r\n\r\n  return new THREE.DynamicBufferAttribute(new this.array.constructor(this.array), this.itemSize);\r\n\r\n};\r\n\r\n// File:src/core/BufferGeometry.js\r\n\r\n/**\r\n * @author alteredq / http://alteredqualia.com/\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.BufferGeometry = function() {\r\n\r\n  Object.defineProperty(this, 'id', {\r\n    value: THREE.GeometryIdCount++\r\n  });\r\n\r\n  this.uuid = THREE.Math.generateUUID();\r\n\r\n  this.name = '';\r\n  this.type = 'BufferGeometry';\r\n\r\n  this.attributes = {};\r\n  this.attributesKeys = [];\r\n\r\n  this.drawcalls = [];\r\n  this.offsets = this.drawcalls; // backwards compatibility\r\n\r\n  this.boundingBox = null;\r\n  this.boundingSphere = null;\r\n\r\n};\r\n\r\nTHREE.BufferGeometry.prototype = {\r\n\r\n  constructor: THREE.BufferGeometry,\r\n\r\n  addAttribute: function(name, attribute) {\r\n\r\n    if (attribute instanceof THREE.BufferAttribute === false) {\r\n\r\n      THREE.warn('THREE.BufferGeometry: .addAttribute() now expects ( name, attribute ).');\r\n\r\n      this.attributes[name] = {\r\n        array: arguments[1],\r\n        itemSize: arguments[2]\r\n      };\r\n\r\n      return;\r\n\r\n    }\r\n\r\n    this.attributes[name] = attribute;\r\n    this.attributesKeys = Object.keys(this.attributes);\r\n\r\n  },\r\n\r\n  getAttribute: function(name) {\r\n\r\n    return this.attributes[name];\r\n\r\n  },\r\n\r\n  addDrawCall: function(start, count, indexOffset) {\r\n\r\n    this.drawcalls.push({\r\n\r\n      start: start,\r\n      count: count,\r\n      index: indexOffset !== undefined ? indexOffset : 0\r\n\r\n    });\r\n\r\n  },\r\n\r\n  applyMatrix: function(matrix) {\r\n\r\n    var position = this.attributes.position;\r\n\r\n    if (position !== undefined) {\r\n\r\n      matrix.applyToVector3Array(position.array);\r\n      position.needsUpdate = true;\r\n\r\n    }\r\n\r\n    var normal = this.attributes.normal;\r\n\r\n    if (normal !== undefined) {\r\n\r\n      var normalMatrix = new THREE.Matrix3().getNormalMatrix(matrix);\r\n\r\n      normalMatrix.applyToVector3Array(normal.array);\r\n      normal.needsUpdate = true;\r\n\r\n    }\r\n\r\n    if (this.boundingBox !== null) {\r\n\r\n      this.computeBoundingBox();\r\n\r\n    }\r\n\r\n    if (this.boundingSphere !== null) {\r\n\r\n      this.computeBoundingSphere();\r\n\r\n    }\r\n\r\n  },\r\n\r\n  center: function() {\r\n\r\n    this.computeBoundingBox();\r\n\r\n    var offset = this.boundingBox.center().negate();\r\n\r\n    this.applyMatrix(new THREE.Matrix4().setPosition(offset));\r\n\r\n    return offset;\r\n\r\n  },\r\n\r\n  fromGeometry: function(geometry, settings) {\r\n\r\n    settings = settings || {\r\n      'vertexColors': THREE.NoColors\r\n    };\r\n\r\n    var vertices = geometry.vertices;\r\n    var faces = geometry.faces;\r\n    var faceVertexUvs = geometry.faceVertexUvs;\r\n    var vertexColors = settings.vertexColors;\r\n    var hasFaceVertexUv = faceVertexUvs[0].length > 0;\r\n    var hasFaceVertexNormals = faces[0].vertexNormals.length == 3;\r\n\r\n    var positions = new Float32Array(faces.length * 3 * 3);\r\n    this.addAttribute('position', new THREE.BufferAttribute(positions, 3));\r\n\r\n    var normals = new Float32Array(faces.length * 3 * 3);\r\n    this.addAttribute('normal', new THREE.BufferAttribute(normals, 3));\r\n\r\n    if (vertexColors !== THREE.NoColors) {\r\n\r\n      var colors = new Float32Array(faces.length * 3 * 3);\r\n      this.addAttribute('color', new THREE.BufferAttribute(colors, 3));\r\n\r\n    }\r\n\r\n    if (hasFaceVertexUv === true) {\r\n\r\n      var uvs = new Float32Array(faces.length * 3 * 2);\r\n      this.addAttribute('uv', new THREE.BufferAttribute(uvs, 2));\r\n\r\n    }\r\n\r\n    for (var i = 0, i2 = 0, i3 = 0; i < faces.length; i++, i2 += 6, i3 += 9) {\r\n\r\n      var face = faces[i];\r\n\r\n      var a = vertices[face.a];\r\n      var b = vertices[face.b];\r\n      var c = vertices[face.c];\r\n\r\n      positions[i3] = a.x;\r\n      positions[i3 + 1] = a.y;\r\n      positions[i3 + 2] = a.z;\r\n\r\n      positions[i3 + 3] = b.x;\r\n      positions[i3 + 4] = b.y;\r\n      positions[i3 + 5] = b.z;\r\n\r\n      positions[i3 + 6] = c.x;\r\n      positions[i3 + 7] = c.y;\r\n      positions[i3 + 8] = c.z;\r\n\r\n      if (hasFaceVertexNormals === true) {\r\n\r\n        var na = face.vertexNormals[0];\r\n        var nb = face.vertexNormals[1];\r\n        var nc = face.vertexNormals[2];\r\n\r\n        normals[i3] = na.x;\r\n        normals[i3 + 1] = na.y;\r\n        normals[i3 + 2] = na.z;\r\n\r\n        normals[i3 + 3] = nb.x;\r\n        normals[i3 + 4] = nb.y;\r\n        normals[i3 + 5] = nb.z;\r\n\r\n        normals[i3 + 6] = nc.x;\r\n        normals[i3 + 7] = nc.y;\r\n        normals[i3 + 8] = nc.z;\r\n\r\n      }\r\n      else {\r\n\r\n        var n = face.normal;\r\n\r\n        normals[i3] = n.x;\r\n        normals[i3 + 1] = n.y;\r\n        normals[i3 + 2] = n.z;\r\n\r\n        normals[i3 + 3] = n.x;\r\n        normals[i3 + 4] = n.y;\r\n        normals[i3 + 5] = n.z;\r\n\r\n        normals[i3 + 6] = n.x;\r\n        normals[i3 + 7] = n.y;\r\n        normals[i3 + 8] = n.z;\r\n\r\n      }\r\n\r\n      if (vertexColors === THREE.FaceColors) {\r\n\r\n        var fc = face.color;\r\n\r\n        colors[i3] = fc.r;\r\n        colors[i3 + 1] = fc.g;\r\n        colors[i3 + 2] = fc.b;\r\n\r\n        colors[i3 + 3] = fc.r;\r\n        colors[i3 + 4] = fc.g;\r\n        colors[i3 + 5] = fc.b;\r\n\r\n        colors[i3 + 6] = fc.r;\r\n        colors[i3 + 7] = fc.g;\r\n        colors[i3 + 8] = fc.b;\r\n\r\n      }\r\n      else if (vertexColors === THREE.VertexColors) {\r\n\r\n        var vca = face.vertexColors[0];\r\n        var vcb = face.vertexColors[1];\r\n        var vcc = face.vertexColors[2];\r\n\r\n        colors[i3] = vca.r;\r\n        colors[i3 + 1] = vca.g;\r\n        colors[i3 + 2] = vca.b;\r\n\r\n        colors[i3 + 3] = vcb.r;\r\n        colors[i3 + 4] = vcb.g;\r\n        colors[i3 + 5] = vcb.b;\r\n\r\n        colors[i3 + 6] = vcc.r;\r\n        colors[i3 + 7] = vcc.g;\r\n        colors[i3 + 8] = vcc.b;\r\n\r\n      }\r\n\r\n      if (hasFaceVertexUv === true) {\r\n\r\n        var uva = faceVertexUvs[0][i][0];\r\n        var uvb = faceVertexUvs[0][i][1];\r\n        var uvc = faceVertexUvs[0][i][2];\r\n\r\n        uvs[i2] = uva.x;\r\n        uvs[i2 + 1] = uva.y;\r\n\r\n        uvs[i2 + 2] = uvb.x;\r\n        uvs[i2 + 3] = uvb.y;\r\n\r\n        uvs[i2 + 4] = uvc.x;\r\n        uvs[i2 + 5] = uvc.y;\r\n\r\n      }\r\n\r\n    }\r\n\r\n    this.computeBoundingSphere()\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  computeBoundingBox: function() {\r\n\r\n    var vector = new THREE.Vector3();\r\n\r\n    return function() {\r\n\r\n      if (this.boundingBox === null) {\r\n\r\n        this.boundingBox = new THREE.Box3();\r\n\r\n      }\r\n\r\n      var positions = this.attributes.position.array;\r\n\r\n      if (positions) {\r\n\r\n        var bb = this.boundingBox;\r\n        bb.makeEmpty();\r\n\r\n        for (var i = 0, il = positions.length; i < il; i += 3) {\r\n\r\n          vector.set(positions[i], positions[i + 1], positions[i + 2]);\r\n          bb.expandByPoint(vector);\r\n\r\n        }\r\n\r\n      }\r\n\r\n      if (positions === undefined || positions.length === 0) {\r\n\r\n        this.boundingBox.min.set(0, 0, 0);\r\n        this.boundingBox.max.set(0, 0, 0);\r\n\r\n      }\r\n\r\n      if (isNaN(this.boundingBox.min.x) || isNaN(this.boundingBox.min.y) || isNaN(this.boundingBox.min.z)) {\r\n\r\n        THREE.error('THREE.BufferGeometry.computeBoundingBox: Computed min/max have NaN values. The \"position\" attribute is likely to have NaN values.');\r\n\r\n      }\r\n\r\n    }\r\n\r\n  }(),\r\n\r\n  computeBoundingSphere: function() {\r\n\r\n    var box = new THREE.Box3();\r\n    var vector = new THREE.Vector3();\r\n\r\n    return function() {\r\n\r\n      if (this.boundingSphere === null) {\r\n\r\n        this.boundingSphere = new THREE.Sphere();\r\n\r\n      }\r\n\r\n      var positions = this.attributes.position.array;\r\n\r\n      if (positions) {\r\n\r\n        box.makeEmpty();\r\n\r\n        var center = this.boundingSphere.center;\r\n\r\n        for (var i = 0, il = positions.length; i < il; i += 3) {\r\n\r\n          vector.set(positions[i], positions[i + 1], positions[i + 2]);\r\n          box.expandByPoint(vector);\r\n\r\n        }\r\n\r\n        box.center(center);\r\n\r\n        // hoping to find a boundingSphere with a radius smaller than the\r\n        // boundingSphere of the boundingBox:  sqrt(3) smaller in the best case\r\n\r\n        var maxRadiusSq = 0;\r\n\r\n        for (var i = 0, il = positions.length; i < il; i += 3) {\r\n\r\n          vector.set(positions[i], positions[i + 1], positions[i + 2]);\r\n          maxRadiusSq = Math.max(maxRadiusSq, center.distanceToSquared(vector));\r\n\r\n        }\r\n\r\n        this.boundingSphere.radius = Math.sqrt(maxRadiusSq);\r\n\r\n        if (isNaN(this.boundingSphere.radius)) {\r\n\r\n          THREE.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The \"position\" attribute is likely to have NaN values.');\r\n\r\n        }\r\n\r\n      }\r\n\r\n    }\r\n\r\n  }(),\r\n\r\n  computeFaceNormals: function() {\r\n\r\n    // backwards compatibility\r\n\r\n  },\r\n\r\n  computeVertexNormals: function() {\r\n\r\n    var attributes = this.attributes;\r\n\r\n    if (attributes.position) {\r\n\r\n      var positions = attributes.position.array;\r\n\r\n      if (attributes.normal === undefined) {\r\n\r\n        this.addAttribute('normal', new THREE.BufferAttribute(new Float32Array(positions.length), 3));\r\n\r\n      }\r\n      else {\r\n\r\n        // reset existing normals to zero\r\n\r\n        var normals = attributes.normal.array;\r\n\r\n        for (var i = 0, il = normals.length; i < il; i++) {\r\n\r\n          normals[i] = 0;\r\n\r\n        }\r\n\r\n      }\r\n\r\n      var normals = attributes.normal.array;\r\n\r\n      var vA, vB, vC,\r\n\r\n        pA = new THREE.Vector3(),\r\n        pB = new THREE.Vector3(),\r\n        pC = new THREE.Vector3(),\r\n\r\n        cb = new THREE.Vector3(),\r\n        ab = new THREE.Vector3();\r\n\r\n      // indexed elements\r\n\r\n      if (attributes.index) {\r\n\r\n        var indices = attributes.index.array;\r\n\r\n        var offsets = (this.offsets.length > 0 ? this.offsets : [{\r\n          start: 0,\r\n          count: indices.length,\r\n          index: 0\r\n        }]);\r\n\r\n        for (var j = 0, jl = offsets.length; j < jl; ++j) {\r\n\r\n          var start = offsets[j].start;\r\n          var count = offsets[j].count;\r\n          var index = offsets[j].index;\r\n\r\n          for (var i = start, il = start + count; i < il; i += 3) {\r\n\r\n            vA = (index + indices[i]) * 3;\r\n            vB = (index + indices[i + 1]) * 3;\r\n            vC = (index + indices[i + 2]) * 3;\r\n\r\n            pA.fromArray(positions, vA);\r\n            pB.fromArray(positions, vB);\r\n            pC.fromArray(positions, vC);\r\n\r\n            cb.subVectors(pC, pB);\r\n            ab.subVectors(pA, pB);\r\n            cb.cross(ab);\r\n\r\n            normals[vA] += cb.x;\r\n            normals[vA + 1] += cb.y;\r\n            normals[vA + 2] += cb.z;\r\n\r\n            normals[vB] += cb.x;\r\n            normals[vB + 1] += cb.y;\r\n            normals[vB + 2] += cb.z;\r\n\r\n            normals[vC] += cb.x;\r\n            normals[vC + 1] += cb.y;\r\n            normals[vC + 2] += cb.z;\r\n\r\n          }\r\n\r\n        }\r\n\r\n      }\r\n      else {\r\n\r\n        // non-indexed elements (unconnected triangle soup)\r\n\r\n        for (var i = 0, il = positions.length; i < il; i += 9) {\r\n\r\n          pA.fromArray(positions, i);\r\n          pB.fromArray(positions, i + 3);\r\n          pC.fromArray(positions, i + 6);\r\n\r\n          cb.subVectors(pC, pB);\r\n          ab.subVectors(pA, pB);\r\n          cb.cross(ab);\r\n\r\n          normals[i] = cb.x;\r\n          normals[i + 1] = cb.y;\r\n          normals[i + 2] = cb.z;\r\n\r\n          normals[i + 3] = cb.x;\r\n          normals[i + 4] = cb.y;\r\n          normals[i + 5] = cb.z;\r\n\r\n          normals[i + 6] = cb.x;\r\n          normals[i + 7] = cb.y;\r\n          normals[i + 8] = cb.z;\r\n\r\n        }\r\n\r\n      }\r\n\r\n      this.normalizeNormals();\r\n\r\n      attributes.normal.needsUpdate = true;\r\n\r\n    }\r\n\r\n  },\r\n\r\n  computeTangents: function() {\r\n\r\n    // based on http://www.terathon.com/code/tangent.html\r\n    // (per vertex tangents)\r\n\r\n    if (this.attributes.index === undefined ||\r\n      this.attributes.position === undefined ||\r\n      this.attributes.normal === undefined ||\r\n      this.attributes.uv === undefined) {\r\n\r\n      THREE.warn('THREE.BufferGeometry: Missing required attributes (index, position, normal or uv) in BufferGeometry.computeTangents()');\r\n      return;\r\n\r\n    }\r\n\r\n    var indices = this.attributes.index.array;\r\n    var positions = this.attributes.position.array;\r\n    var normals = this.attributes.normal.array;\r\n    var uvs = this.attributes.uv.array;\r\n\r\n    var nVertices = positions.length / 3;\r\n\r\n    if (this.attributes.tangent === undefined) {\r\n\r\n      this.addAttribute('tangent', new THREE.BufferAttribute(new Float32Array(4 * nVertices), 4));\r\n\r\n    }\r\n\r\n    var tangents = this.attributes.tangent.array;\r\n\r\n    var tan1 = [],\r\n      tan2 = [];\r\n\r\n    for (var k = 0; k < nVertices; k++) {\r\n\r\n      tan1[k] = new THREE.Vector3();\r\n      tan2[k] = new THREE.Vector3();\r\n\r\n    }\r\n\r\n    var vA = new THREE.Vector3(),\r\n      vB = new THREE.Vector3(),\r\n      vC = new THREE.Vector3(),\r\n\r\n      uvA = new THREE.Vector2(),\r\n      uvB = new THREE.Vector2(),\r\n      uvC = new THREE.Vector2(),\r\n\r\n      x1, x2, y1, y2, z1, z2,\r\n      s1, s2, t1, t2, r;\r\n\r\n    var sdir = new THREE.Vector3(),\r\n      tdir = new THREE.Vector3();\r\n\r\n    function handleTriangle(a, b, c) {\r\n\r\n      vA.fromArray(positions, a * 3);\r\n      vB.fromArray(positions, b * 3);\r\n      vC.fromArray(positions, c * 3);\r\n\r\n      uvA.fromArray(uvs, a * 2);\r\n      uvB.fromArray(uvs, b * 2);\r\n      uvC.fromArray(uvs, c * 2);\r\n\r\n      x1 = vB.x - vA.x;\r\n      x2 = vC.x - vA.x;\r\n\r\n      y1 = vB.y - vA.y;\r\n      y2 = vC.y - vA.y;\r\n\r\n      z1 = vB.z - vA.z;\r\n      z2 = vC.z - vA.z;\r\n\r\n      s1 = uvB.x - uvA.x;\r\n      s2 = uvC.x - uvA.x;\r\n\r\n      t1 = uvB.y - uvA.y;\r\n      t2 = uvC.y - uvA.y;\r\n\r\n      r = 1.0 / (s1 * t2 - s2 * t1);\r\n\r\n      sdir.set(\r\n        (t2 * x1 - t1 * x2) * r, (t2 * y1 - t1 * y2) * r, (t2 * z1 - t1 * z2) * r\r\n      );\r\n\r\n      tdir.set(\r\n        (s1 * x2 - s2 * x1) * r, (s1 * y2 - s2 * y1) * r, (s1 * z2 - s2 * z1) * r\r\n      );\r\n\r\n      tan1[a].add(sdir);\r\n      tan1[b].add(sdir);\r\n      tan1[c].add(sdir);\r\n\r\n      tan2[a].add(tdir);\r\n      tan2[b].add(tdir);\r\n      tan2[c].add(tdir);\r\n\r\n    }\r\n\r\n    var i, il;\r\n    var j, jl;\r\n    var iA, iB, iC;\r\n\r\n    if (this.drawcalls.length === 0) {\r\n\r\n      this.addDrawCall(0, indices.length, 0);\r\n\r\n    }\r\n\r\n    var drawcalls = this.drawcalls;\r\n\r\n    for (j = 0, jl = drawcalls.length; j < jl; ++j) {\r\n\r\n      var start = drawcalls[j].start;\r\n      var count = drawcalls[j].count;\r\n      var index = drawcalls[j].index;\r\n\r\n      for (i = start, il = start + count; i < il; i += 3) {\r\n\r\n        iA = index + indices[i];\r\n        iB = index + indices[i + 1];\r\n        iC = index + indices[i + 2];\r\n\r\n        handleTriangle(iA, iB, iC);\r\n\r\n      }\r\n\r\n    }\r\n\r\n    var tmp = new THREE.Vector3(),\r\n      tmp2 = new THREE.Vector3();\r\n    var n = new THREE.Vector3(),\r\n      n2 = new THREE.Vector3();\r\n    var w, t, test;\r\n\r\n    function handleVertex(v) {\r\n\r\n      n.fromArray(normals, v * 3);\r\n      n2.copy(n);\r\n\r\n      t = tan1[v];\r\n\r\n      // Gram-Schmidt orthogonalize\r\n\r\n      tmp.copy(t);\r\n      tmp.sub(n.multiplyScalar(n.dot(t))).normalize();\r\n\r\n      // Calculate handedness\r\n\r\n      tmp2.crossVectors(n2, t);\r\n      test = tmp2.dot(tan2[v]);\r\n      w = (test < 0.0) ? -1.0 : 1.0;\r\n\r\n      tangents[v * 4] = tmp.x;\r\n      tangents[v * 4 + 1] = tmp.y;\r\n      tangents[v * 4 + 2] = tmp.z;\r\n      tangents[v * 4 + 3] = w;\r\n\r\n    }\r\n\r\n    for (j = 0, jl = drawcalls.length; j < jl; ++j) {\r\n\r\n      var start = drawcalls[j].start;\r\n      var count = drawcalls[j].count;\r\n      var index = drawcalls[j].index;\r\n\r\n      for (i = start, il = start + count; i < il; i += 3) {\r\n\r\n        iA = index + indices[i];\r\n        iB = index + indices[i + 1];\r\n        iC = index + indices[i + 2];\r\n\r\n        handleVertex(iA);\r\n        handleVertex(iB);\r\n        handleVertex(iC);\r\n\r\n      }\r\n\r\n    }\r\n\r\n  },\r\n\r\n  /*\r\n  Compute the draw offset for large models by chunking the index buffer into chunks of 65k addressable vertices.\r\n  This method will effectively rewrite the index buffer and remap all attributes to match the new indices.\r\n  WARNING: This method will also expand the vertex count to prevent sprawled triangles across draw offsets.\r\n  size - Defaults to 65535, but allows for larger or smaller chunks.\r\n  */\r\n  computeOffsets: function(size) {\r\n\r\n    if (size === undefined) size = 65535; // WebGL limits type of index buffer values to 16-bit.\r\n\r\n    var indices = this.attributes.index.array;\r\n    var vertices = this.attributes.position.array;\r\n\r\n    var facesCount = (indices.length / 3);\r\n\r\n    /*\r\n    console.log(\"Computing buffers in offsets of \"+size+\" -> indices:\"+indices.length+\" vertices:\"+vertices.length);\r\n    console.log(\"Faces to process: \"+(indices.length/3));\r\n    console.log(\"Reordering \"+verticesCount+\" vertices.\");\r\n    */\r\n\r\n    var sortedIndices = new Uint16Array(indices.length); //16-bit buffers\r\n    var indexPtr = 0;\r\n    var vertexPtr = 0;\r\n\r\n    var offsets = [{\r\n      start: 0,\r\n      count: 0,\r\n      index: 0\r\n    }];\r\n    var offset = offsets[0];\r\n\r\n    var duplicatedVertices = 0;\r\n    var newVerticeMaps = 0;\r\n    var faceVertices = new Int32Array(6);\r\n    var vertexMap = new Int32Array(vertices.length);\r\n    var revVertexMap = new Int32Array(vertices.length);\r\n    for (var j = 0; j < vertices.length; j++) {\r\n      vertexMap[j] = -1;\r\n      revVertexMap[j] = -1;\r\n    }\r\n\r\n    /*\r\n    \tTraverse every face and reorder vertices in the proper offsets of 65k.\r\n    \tWe can have more than 65k entries in the index buffer per offset, but only reference 65k values.\r\n    */\r\n    for (var findex = 0; findex < facesCount; findex++) {\r\n      newVerticeMaps = 0;\r\n\r\n      for (var vo = 0; vo < 3; vo++) {\r\n        var vid = indices[findex * 3 + vo];\r\n        if (vertexMap[vid] == -1) {\r\n          //Unmapped vertice\r\n          faceVertices[vo * 2] = vid;\r\n          faceVertices[vo * 2 + 1] = -1;\r\n          newVerticeMaps++;\r\n        }\r\n        else if (vertexMap[vid] < offset.index) {\r\n          //Reused vertices from previous block (duplicate)\r\n          faceVertices[vo * 2] = vid;\r\n          faceVertices[vo * 2 + 1] = -1;\r\n          duplicatedVertices++;\r\n        }\r\n        else {\r\n          //Reused vertice in the current block\r\n          faceVertices[vo * 2] = vid;\r\n          faceVertices[vo * 2 + 1] = vertexMap[vid];\r\n        }\r\n      }\r\n\r\n      var faceMax = vertexPtr + newVerticeMaps;\r\n      if (faceMax > (offset.index + size)) {\r\n        var new_offset = {\r\n          start: indexPtr,\r\n          count: 0,\r\n          index: vertexPtr\r\n        };\r\n        offsets.push(new_offset);\r\n        offset = new_offset;\r\n\r\n        //Re-evaluate reused vertices in light of new offset.\r\n        for (var v = 0; v < 6; v += 2) {\r\n          var new_vid = faceVertices[v + 1];\r\n          if (new_vid > -1 && new_vid < offset.index)\r\n            faceVertices[v + 1] = -1;\r\n        }\r\n      }\r\n\r\n      //Reindex the face.\r\n      for (var v = 0; v < 6; v += 2) {\r\n        var vid = faceVertices[v];\r\n        var new_vid = faceVertices[v + 1];\r\n\r\n        if (new_vid === -1)\r\n          new_vid = vertexPtr++;\r\n\r\n        vertexMap[vid] = new_vid;\r\n        revVertexMap[new_vid] = vid;\r\n        sortedIndices[indexPtr++] = new_vid - offset.index; //XXX overflows at 16bit\r\n        offset.count++;\r\n      }\r\n    }\r\n\r\n    /* Move all attribute values to map to the new computed indices , also expand the vertice stack to match our new vertexPtr. */\r\n    this.reorderBuffers(sortedIndices, revVertexMap, vertexPtr);\r\n    this.offsets = offsets; // TODO: Deprecate\r\n    this.drawcalls = offsets;\r\n\r\n    /*\r\n    var orderTime = Date.now();\r\n    console.log(\"Reorder time: \"+(orderTime-s)+\"ms\");\r\n    console.log(\"Duplicated \"+duplicatedVertices+\" vertices.\");\r\n    console.log(\"Compute Buffers time: \"+(Date.now()-s)+\"ms\");\r\n    console.log(\"Draw offsets: \"+offsets.length);\r\n    */\r\n\r\n    return offsets;\r\n\r\n  },\r\n\r\n  merge: function(geometry, offset) {\r\n\r\n    if (geometry instanceof THREE.BufferGeometry === false) {\r\n\r\n      THREE.error('THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.', geometry);\r\n      return;\r\n\r\n    }\r\n\r\n    if (offset === undefined) offset = 0;\r\n\r\n    var attributes = this.attributes;\r\n\r\n    for (var key in attributes) {\r\n\r\n      if (geometry.attributes[key] === undefined) continue;\r\n\r\n      var attribute1 = attributes[key];\r\n      var attributeArray1 = attribute1.array;\r\n\r\n      var attribute2 = geometry.attributes[key];\r\n      var attributeArray2 = attribute2.array;\r\n\r\n      var attributeSize = attribute2.itemSize;\r\n\r\n      for (var i = 0, j = attributeSize * offset; i < attributeArray2.length; i++, j++) {\r\n\r\n        attributeArray1[j] = attributeArray2[i];\r\n\r\n      }\r\n\r\n    }\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  normalizeNormals: function() {\r\n\r\n    var normals = this.attributes.normal.array;\r\n\r\n    var x, y, z, n;\r\n\r\n    for (var i = 0, il = normals.length; i < il; i += 3) {\r\n\r\n      x = normals[i];\r\n      y = normals[i + 1];\r\n      z = normals[i + 2];\r\n\r\n      n = 1.0 / Math.sqrt(x * x + y * y + z * z);\r\n\r\n      normals[i] *= n;\r\n      normals[i + 1] *= n;\r\n      normals[i + 2] *= n;\r\n\r\n    }\r\n\r\n  },\r\n\r\n  /*\r\n  \treoderBuffers:\r\n  \tReorder attributes based on a new indexBuffer and indexMap.\r\n  \tindexBuffer - Uint16Array of the new ordered indices.\r\n  \tindexMap - Int32Array where the position is the new vertex ID and the value the old vertex ID for each vertex.\r\n  \tvertexCount - Amount of total vertices considered in this reordering (in case you want to grow the vertice stack).\r\n  */\r\n  reorderBuffers: function(indexBuffer, indexMap, vertexCount) {\r\n\r\n    /* Create a copy of all attributes for reordering. */\r\n    var sortedAttributes = {};\r\n    for (var attr in this.attributes) {\r\n      if (attr == 'index')\r\n        continue;\r\n      var sourceArray = this.attributes[attr].array;\r\n      sortedAttributes[attr] = new sourceArray.constructor(this.attributes[attr].itemSize * vertexCount);\r\n    }\r\n\r\n    /* Move attribute positions based on the new index map */\r\n    for (var new_vid = 0; new_vid < vertexCount; new_vid++) {\r\n      var vid = indexMap[new_vid];\r\n      for (var attr in this.attributes) {\r\n        if (attr == 'index')\r\n          continue;\r\n        var attrArray = this.attributes[attr].array;\r\n        var attrSize = this.attributes[attr].itemSize;\r\n        var sortedAttr = sortedAttributes[attr];\r\n        for (var k = 0; k < attrSize; k++)\r\n          sortedAttr[new_vid * attrSize + k] = attrArray[vid * attrSize + k];\r\n      }\r\n    }\r\n\r\n    /* Carry the new sorted buffers locally */\r\n    this.attributes['index'].array = indexBuffer;\r\n    for (var attr in this.attributes) {\r\n      if (attr == 'index')\r\n        continue;\r\n      this.attributes[attr].array = sortedAttributes[attr];\r\n      this.attributes[attr].numItems = this.attributes[attr].itemSize * vertexCount;\r\n    }\r\n  },\r\n\r\n  toJSON: function() {\r\n\r\n    var output = {\r\n      metadata: {\r\n        version: 4.0,\r\n        type: 'BufferGeometry',\r\n        generator: 'BufferGeometryExporter'\r\n      },\r\n      uuid: this.uuid,\r\n      type: this.type,\r\n      data: {\r\n        attributes: {}\r\n      }\r\n    };\r\n\r\n    var attributes = this.attributes;\r\n    var offsets = this.offsets;\r\n    var boundingSphere = this.boundingSphere;\r\n\r\n    for (var key in attributes) {\r\n\r\n      var attribute = attributes[key];\r\n\r\n      var array = Array.prototype.slice.call(attribute.array);\r\n\r\n      output.data.attributes[key] = {\r\n        itemSize: attribute.itemSize,\r\n        type: attribute.array.constructor.name,\r\n        array: array\r\n      }\r\n\r\n    }\r\n\r\n    if (offsets.length > 0) {\r\n\r\n      output.data.offsets = JSON.parse(JSON.stringify(offsets));\r\n\r\n    }\r\n\r\n    if (boundingSphere !== null) {\r\n\r\n      output.data.boundingSphere = {\r\n        center: boundingSphere.center.toArray(),\r\n        radius: boundingSphere.radius\r\n      }\r\n\r\n    }\r\n\r\n    return output;\r\n\r\n  },\r\n\r\n  clone: function() {\r\n\r\n    var geometry = new THREE.BufferGeometry();\r\n\r\n    for (var attr in this.attributes) {\r\n\r\n      var sourceAttr = this.attributes[attr];\r\n      geometry.addAttribute(attr, sourceAttr.clone());\r\n\r\n    }\r\n\r\n    for (var i = 0, il = this.offsets.length; i < il; i++) {\r\n\r\n      var offset = this.offsets[i];\r\n\r\n      geometry.offsets.push({\r\n\r\n        start: offset.start,\r\n        index: offset.index,\r\n        count: offset.count\r\n\r\n      });\r\n\r\n    }\r\n\r\n    return geometry;\r\n\r\n  },\r\n\r\n  dispose: function() {\r\n\r\n    this.dispatchEvent({\r\n      type: 'dispose'\r\n    });\r\n\r\n  }\r\n\r\n};\r\n\r\nTHREE.EventDispatcher.prototype.apply(THREE.BufferGeometry.prototype);\r\n\r\n// File:src/core/Geometry.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author kile / http://kile.stravaganza.org/\r\n * @author alteredq / http://alteredqualia.com/\r\n * @author mikael emtinger / http://gomo.se/\r\n * @author zz85 / http://www.lab4games.net/zz85/blog\r\n * @author bhouston / http://exocortex.com\r\n */\r\n\r\nTHREE.Geometry = function() {\r\n\r\n  Object.defineProperty(this, 'id', {\r\n    value: THREE.GeometryIdCount++\r\n  });\r\n\r\n  this.uuid = THREE.Math.generateUUID();\r\n\r\n  this.name = '';\r\n  this.type = 'Geometry';\r\n\r\n  this.vertices = [];\r\n  this.colors = []; // one-to-one vertex colors, used in Points and Line\r\n\r\n  this.faces = [];\r\n\r\n  this.faceVertexUvs = [\r\n    []\r\n  ];\r\n\r\n  this.morphTargets = [];\r\n  this.morphColors = [];\r\n  this.morphNormals = [];\r\n\r\n  this.skinWeights = [];\r\n  this.skinIndices = [];\r\n\r\n  this.lineDistances = [];\r\n\r\n  this.boundingBox = null;\r\n  this.boundingSphere = null;\r\n\r\n  this.hasTangents = false;\r\n\r\n  this.dynamic = true; // the intermediate typed arrays will be deleted when set to false\r\n\r\n  // update flags\r\n\r\n  this.verticesNeedUpdate = false;\r\n  this.elementsNeedUpdate = false;\r\n  this.uvsNeedUpdate = false;\r\n  this.normalsNeedUpdate = false;\r\n  this.tangentsNeedUpdate = false;\r\n  this.colorsNeedUpdate = false;\r\n  this.lineDistancesNeedUpdate = false;\r\n\r\n  this.groupsNeedUpdate = false;\r\n\r\n};\r\n\r\nTHREE.Geometry.prototype = {\r\n\r\n  constructor: THREE.Geometry,\r\n\r\n  applyMatrix: function(matrix) {\r\n\r\n    var normalMatrix = new THREE.Matrix3().getNormalMatrix(matrix);\r\n\r\n    for (var i = 0, il = this.vertices.length; i < il; i++) {\r\n\r\n      var vertex = this.vertices[i];\r\n      vertex.applyMatrix4(matrix);\r\n\r\n    }\r\n\r\n    for (var i = 0, il = this.faces.length; i < il; i++) {\r\n\r\n      var face = this.faces[i];\r\n      face.normal.applyMatrix3(normalMatrix).normalize();\r\n\r\n      for (var j = 0, jl = face.vertexNormals.length; j < jl; j++) {\r\n\r\n        face.vertexNormals[j].applyMatrix3(normalMatrix).normalize();\r\n\r\n      }\r\n\r\n    }\r\n\r\n    if (this.boundingBox !== null) {\r\n\r\n      this.computeBoundingBox();\r\n\r\n    }\r\n\r\n    if (this.boundingSphere !== null) {\r\n\r\n      this.computeBoundingSphere();\r\n\r\n    }\r\n\r\n    this.verticesNeedUpdate = true;\r\n    this.normalsNeedUpdate = true;\r\n\r\n  },\r\n\r\n  fromBufferGeometry: function(geometry) {\r\n\r\n    var scope = this;\r\n\r\n    var attributes = geometry.attributes;\r\n\r\n    var vertices = attributes.position.array;\r\n    var indices = attributes.index !== undefined ? attributes.index.array : undefined;\r\n    var normals = attributes.normal !== undefined ? attributes.normal.array : undefined;\r\n    var colors = attributes.color !== undefined ? attributes.color.array : undefined;\r\n    var uvs = attributes.uv !== undefined ? attributes.uv.array : undefined;\r\n\r\n    var tempNormals = [];\r\n    var tempUVs = [];\r\n\r\n    for (var i = 0, j = 0; i < vertices.length; i += 3, j += 2) {\r\n\r\n      scope.vertices.push(new THREE.Vector3(vertices[i], vertices[i + 1], vertices[i + 2]));\r\n\r\n      if (normals !== undefined) {\r\n\r\n        tempNormals.push(new THREE.Vector3(normals[i], normals[i + 1], normals[i + 2]));\r\n\r\n      }\r\n\r\n      if (colors !== undefined) {\r\n\r\n        scope.colors.push(new THREE.Color(colors[i], colors[i + 1], colors[i + 2]));\r\n\r\n      }\r\n\r\n      if (uvs !== undefined) {\r\n\r\n        tempUVs.push(new THREE.Vector2(uvs[j], uvs[j + 1]));\r\n\r\n      }\r\n\r\n    }\r\n\r\n    var addFace = function(a, b, c) {\r\n\r\n      var vertexNormals = normals !== undefined ? [tempNormals[a].clone(), tempNormals[b].clone(), tempNormals[c].clone()] : [];\r\n      var vertexColors = colors !== undefined ? [scope.colors[a].clone(), scope.colors[b].clone(), scope.colors[c].clone()] : [];\r\n\r\n      scope.faces.push(new THREE.Face3(a, b, c, vertexNormals, vertexColors));\r\n\r\n      if (uvs !== undefined) {\r\n\r\n        scope.faceVertexUvs[0].push([tempUVs[a].clone(), tempUVs[b].clone(), tempUVs[c].clone()]);\r\n\r\n      }\r\n\r\n    };\r\n\r\n    if (indices !== undefined) {\r\n\r\n      var drawcalls = geometry.drawcalls;\r\n\r\n      if (drawcalls.length > 0) {\r\n\r\n        for (var i = 0; i < drawcalls.length; i++) {\r\n\r\n          var drawcall = drawcalls[i];\r\n\r\n          var start = drawcall.start;\r\n          var count = drawcall.count;\r\n          var index = drawcall.index;\r\n\r\n          for (var j = start, jl = start + count; j < jl; j += 3) {\r\n\r\n            addFace(index + indices[j], index + indices[j + 1], index + indices[j + 2]);\r\n\r\n          }\r\n\r\n        }\r\n\r\n      }\r\n      else {\r\n\r\n        for (var i = 0; i < indices.length; i += 3) {\r\n\r\n          addFace(indices[i], indices[i + 1], indices[i + 2]);\r\n\r\n        }\r\n\r\n      }\r\n\r\n    }\r\n    else {\r\n\r\n      for (var i = 0; i < vertices.length / 3; i += 3) {\r\n\r\n        addFace(i, i + 1, i + 2);\r\n\r\n      }\r\n\r\n    }\r\n\r\n    this.computeFaceNormals();\r\n\r\n    if (geometry.boundingBox !== null) {\r\n\r\n      this.boundingBox = geometry.boundingBox.clone();\r\n\r\n    }\r\n\r\n    if (geometry.boundingSphere !== null) {\r\n\r\n      this.boundingSphere = geometry.boundingSphere.clone();\r\n\r\n    }\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  center: function() {\r\n\r\n    this.computeBoundingBox();\r\n\r\n    var offset = this.boundingBox.center().negate();\r\n\r\n    this.applyMatrix(new THREE.Matrix4().setPosition(offset));\r\n\r\n    return offset;\r\n\r\n  },\r\n\r\n  computeFaceNormals: function() {\r\n\r\n    var cb = new THREE.Vector3(),\r\n      ab = new THREE.Vector3();\r\n\r\n    for (var f = 0, fl = this.faces.length; f < fl; f++) {\r\n\r\n      var face = this.faces[f];\r\n\r\n      var vA = this.vertices[face.a];\r\n      var vB = this.vertices[face.b];\r\n      var vC = this.vertices[face.c];\r\n\r\n      cb.subVectors(vC, vB);\r\n      ab.subVectors(vA, vB);\r\n      cb.cross(ab);\r\n\r\n      cb.normalize();\r\n\r\n      face.normal.copy(cb);\r\n\r\n    }\r\n\r\n  },\r\n\r\n  computeVertexNormals: function(areaWeighted) {\r\n\r\n    var v, vl, f, fl, face, vertices;\r\n\r\n    vertices = new Array(this.vertices.length);\r\n\r\n    for (v = 0, vl = this.vertices.length; v < vl; v++) {\r\n\r\n      vertices[v] = new THREE.Vector3();\r\n\r\n    }\r\n\r\n    if (areaWeighted) {\r\n\r\n      // vertex normals weighted by triangle areas\r\n      // http://www.iquilezles.org/www/articles/normals/normals.htm\r\n\r\n      var vA, vB, vC;\r\n      var cb = new THREE.Vector3(),\r\n        ab = new THREE.Vector3();\r\n\r\n      for (f = 0, fl = this.faces.length; f < fl; f++) {\r\n\r\n        face = this.faces[f];\r\n\r\n        vA = this.vertices[face.a];\r\n        vB = this.vertices[face.b];\r\n        vC = this.vertices[face.c];\r\n\r\n        cb.subVectors(vC, vB);\r\n        ab.subVectors(vA, vB);\r\n        cb.cross(ab);\r\n\r\n        vertices[face.a].add(cb);\r\n        vertices[face.b].add(cb);\r\n        vertices[face.c].add(cb);\r\n\r\n      }\r\n\r\n    }\r\n    else {\r\n\r\n      for (f = 0, fl = this.faces.length; f < fl; f++) {\r\n\r\n        face = this.faces[f];\r\n\r\n        vertices[face.a].add(face.normal);\r\n        vertices[face.b].add(face.normal);\r\n        vertices[face.c].add(face.normal);\r\n\r\n      }\r\n\r\n    }\r\n\r\n    for (v = 0, vl = this.vertices.length; v < vl; v++) {\r\n\r\n      vertices[v].normalize();\r\n\r\n    }\r\n\r\n    for (f = 0, fl = this.faces.length; f < fl; f++) {\r\n\r\n      face = this.faces[f];\r\n\r\n      face.vertexNormals[0] = vertices[face.a].clone();\r\n      face.vertexNormals[1] = vertices[face.b].clone();\r\n      face.vertexNormals[2] = vertices[face.c].clone();\r\n\r\n    }\r\n\r\n  },\r\n\r\n  computeMorphNormals: function() {\r\n\r\n    var i, il, f, fl, face;\r\n\r\n    // save original normals\r\n    // - create temp variables on first access\r\n    //   otherwise just copy (for faster repeated calls)\r\n\r\n    for (f = 0, fl = this.faces.length; f < fl; f++) {\r\n\r\n      face = this.faces[f];\r\n\r\n      if (!face.__originalFaceNormal) {\r\n\r\n        face.__originalFaceNormal = face.normal.clone();\r\n\r\n      }\r\n      else {\r\n\r\n        face.__originalFaceNormal.copy(face.normal);\r\n\r\n      }\r\n\r\n      if (!face.__originalVertexNormals) face.__originalVertexNormals = [];\r\n\r\n      for (i = 0, il = face.vertexNormals.length; i < il; i++) {\r\n\r\n        if (!face.__originalVertexNormals[i]) {\r\n\r\n          face.__originalVertexNormals[i] = face.vertexNormals[i].clone();\r\n\r\n        }\r\n        else {\r\n\r\n          face.__originalVertexNormals[i].copy(face.vertexNormals[i]);\r\n\r\n        }\r\n\r\n      }\r\n\r\n    }\r\n\r\n    // use temp geometry to compute face and vertex normals for each morph\r\n\r\n    var tmpGeo = new THREE.Geometry();\r\n    tmpGeo.faces = this.faces;\r\n\r\n    for (i = 0, il = this.morphTargets.length; i < il; i++) {\r\n\r\n      // create on first access\r\n\r\n      if (!this.morphNormals[i]) {\r\n\r\n        this.morphNormals[i] = {};\r\n        this.morphNormals[i].faceNormals = [];\r\n        this.morphNormals[i].vertexNormals = [];\r\n\r\n        var dstNormalsFace = this.morphNormals[i].faceNormals;\r\n        var dstNormalsVertex = this.morphNormals[i].vertexNormals;\r\n\r\n        var faceNormal, vertexNormals;\r\n\r\n        for (f = 0, fl = this.faces.length; f < fl; f++) {\r\n\r\n          faceNormal = new THREE.Vector3();\r\n          vertexNormals = {\r\n            a: new THREE.Vector3(),\r\n            b: new THREE.Vector3(),\r\n            c: new THREE.Vector3()\r\n          };\r\n\r\n          dstNormalsFace.push(faceNormal);\r\n          dstNormalsVertex.push(vertexNormals);\r\n\r\n        }\r\n\r\n      }\r\n\r\n      var morphNormals = this.morphNormals[i];\r\n\r\n      // set vertices to morph target\r\n\r\n      tmpGeo.vertices = this.morphTargets[i].vertices;\r\n\r\n      // compute morph normals\r\n\r\n      tmpGeo.computeFaceNormals();\r\n      tmpGeo.computeVertexNormals();\r\n\r\n      // store morph normals\r\n\r\n      var faceNormal, vertexNormals;\r\n\r\n      for (f = 0, fl = this.faces.length; f < fl; f++) {\r\n\r\n        face = this.faces[f];\r\n\r\n        faceNormal = morphNormals.faceNormals[f];\r\n        vertexNormals = morphNormals.vertexNormals[f];\r\n\r\n        faceNormal.copy(face.normal);\r\n\r\n        vertexNormals.a.copy(face.vertexNormals[0]);\r\n        vertexNormals.b.copy(face.vertexNormals[1]);\r\n        vertexNormals.c.copy(face.vertexNormals[2]);\r\n\r\n      }\r\n\r\n    }\r\n\r\n    // restore original normals\r\n\r\n    for (f = 0, fl = this.faces.length; f < fl; f++) {\r\n\r\n      face = this.faces[f];\r\n\r\n      face.normal = face.__originalFaceNormal;\r\n      face.vertexNormals = face.__originalVertexNormals;\r\n\r\n    }\r\n\r\n  },\r\n\r\n  computeTangents: function() {\r\n\r\n    // based on http://www.terathon.com/code/tangent.html\r\n    // tangents go to vertices\r\n\r\n    var f, fl, v, vl, i, vertexIndex,\r\n      face, uv, vA, vB, vC, uvA, uvB, uvC,\r\n      x1, x2, y1, y2, z1, z2,\r\n      s1, s2, t1, t2, r, t, test,\r\n      tan1 = [],\r\n      tan2 = [],\r\n      sdir = new THREE.Vector3(),\r\n      tdir = new THREE.Vector3(),\r\n      tmp = new THREE.Vector3(),\r\n      tmp2 = new THREE.Vector3(),\r\n      n = new THREE.Vector3(),\r\n      w;\r\n\r\n    for (v = 0, vl = this.vertices.length; v < vl; v++) {\r\n\r\n      tan1[v] = new THREE.Vector3();\r\n      tan2[v] = new THREE.Vector3();\r\n\r\n    }\r\n\r\n    function handleTriangle(context, a, b, c, ua, ub, uc) {\r\n\r\n      vA = context.vertices[a];\r\n      vB = context.vertices[b];\r\n      vC = context.vertices[c];\r\n\r\n      uvA = uv[ua];\r\n      uvB = uv[ub];\r\n      uvC = uv[uc];\r\n\r\n      x1 = vB.x - vA.x;\r\n      x2 = vC.x - vA.x;\r\n      y1 = vB.y - vA.y;\r\n      y2 = vC.y - vA.y;\r\n      z1 = vB.z - vA.z;\r\n      z2 = vC.z - vA.z;\r\n\r\n      s1 = uvB.x - uvA.x;\r\n      s2 = uvC.x - uvA.x;\r\n      t1 = uvB.y - uvA.y;\r\n      t2 = uvC.y - uvA.y;\r\n\r\n      r = 1.0 / (s1 * t2 - s2 * t1);\r\n      sdir.set((t2 * x1 - t1 * x2) * r, (t2 * y1 - t1 * y2) * r, (t2 * z1 - t1 * z2) * r);\r\n      tdir.set((s1 * x2 - s2 * x1) * r, (s1 * y2 - s2 * y1) * r, (s1 * z2 - s2 * z1) * r);\r\n\r\n      tan1[a].add(sdir);\r\n      tan1[b].add(sdir);\r\n      tan1[c].add(sdir);\r\n\r\n      tan2[a].add(tdir);\r\n      tan2[b].add(tdir);\r\n      tan2[c].add(tdir);\r\n\r\n    }\r\n\r\n    for (f = 0, fl = this.faces.length; f < fl; f++) {\r\n\r\n      face = this.faces[f];\r\n      uv = this.faceVertexUvs[0][f]; // use UV layer 0 for tangents\r\n\r\n      handleTriangle(this, face.a, face.b, face.c, 0, 1, 2);\r\n\r\n    }\r\n\r\n    var faceIndex = ['a', 'b', 'c', 'd'];\r\n\r\n    for (f = 0, fl = this.faces.length; f < fl; f++) {\r\n\r\n      face = this.faces[f];\r\n\r\n      for (i = 0; i < Math.min(face.vertexNormals.length, 3); i++) {\r\n\r\n        n.copy(face.vertexNormals[i]);\r\n\r\n        vertexIndex = face[faceIndex[i]];\r\n\r\n        t = tan1[vertexIndex];\r\n\r\n        // Gram-Schmidt orthogonalize\r\n\r\n        tmp.copy(t);\r\n        tmp.sub(n.multiplyScalar(n.dot(t))).normalize();\r\n\r\n        // Calculate handedness\r\n\r\n        tmp2.crossVectors(face.vertexNormals[i], t);\r\n        test = tmp2.dot(tan2[vertexIndex]);\r\n        w = (test < 0.0) ? -1.0 : 1.0;\r\n\r\n        face.vertexTangents[i] = new THREE.Vector4(tmp.x, tmp.y, tmp.z, w);\r\n\r\n      }\r\n\r\n    }\r\n\r\n    this.hasTangents = true;\r\n\r\n  },\r\n\r\n  computeLineDistances: function() {\r\n\r\n    var d = 0;\r\n    var vertices = this.vertices;\r\n\r\n    for (var i = 0, il = vertices.length; i < il; i++) {\r\n\r\n      if (i > 0) {\r\n\r\n        d += vertices[i].distanceTo(vertices[i - 1]);\r\n\r\n      }\r\n\r\n      this.lineDistances[i] = d;\r\n\r\n    }\r\n\r\n  },\r\n\r\n  computeBoundingBox: function() {\r\n\r\n    if (this.boundingBox === null) {\r\n\r\n      this.boundingBox = new THREE.Box3();\r\n\r\n    }\r\n\r\n    this.boundingBox.setFromPoints(this.vertices);\r\n\r\n  },\r\n\r\n  computeBoundingSphere: function() {\r\n\r\n    if (this.boundingSphere === null) {\r\n\r\n      this.boundingSphere = new THREE.Sphere();\r\n\r\n    }\r\n\r\n    this.boundingSphere.setFromPoints(this.vertices);\r\n\r\n  },\r\n\r\n  merge: function(geometry, matrix, materialIndexOffset) {\r\n\r\n    if (geometry instanceof THREE.Geometry === false) {\r\n\r\n      THREE.error('THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.', geometry);\r\n      return;\r\n\r\n    }\r\n\r\n    var normalMatrix,\r\n      vertexOffset = this.vertices.length,\r\n      vertices1 = this.vertices,\r\n      vertices2 = geometry.vertices,\r\n      faces1 = this.faces,\r\n      faces2 = geometry.faces,\r\n      uvs1 = this.faceVertexUvs[0],\r\n      uvs2 = geometry.faceVertexUvs[0];\r\n\r\n    if (materialIndexOffset === undefined) materialIndexOffset = 0;\r\n\r\n    if (matrix !== undefined) {\r\n\r\n      normalMatrix = new THREE.Matrix3().getNormalMatrix(matrix);\r\n\r\n    }\r\n\r\n    // vertices\r\n\r\n    for (var i = 0, il = vertices2.length; i < il; i++) {\r\n\r\n      var vertex = vertices2[i];\r\n\r\n      var vertexCopy = vertex.clone();\r\n\r\n      if (matrix !== undefined) vertexCopy.applyMatrix4(matrix);\r\n\r\n      vertices1.push(vertexCopy);\r\n\r\n    }\r\n\r\n    // faces\r\n\r\n    for (i = 0, il = faces2.length; i < il; i++) {\r\n\r\n      var face = faces2[i],\r\n        faceCopy, normal, color,\r\n        faceVertexNormals = face.vertexNormals,\r\n        faceVertexColors = face.vertexColors;\r\n\r\n      faceCopy = new THREE.Face3(face.a + vertexOffset, face.b + vertexOffset, face.c + vertexOffset);\r\n      faceCopy.normal.copy(face.normal);\r\n\r\n      if (normalMatrix !== undefined) {\r\n\r\n        faceCopy.normal.applyMatrix3(normalMatrix).normalize();\r\n\r\n      }\r\n\r\n      for (var j = 0, jl = faceVertexNormals.length; j < jl; j++) {\r\n\r\n        normal = faceVertexNormals[j].clone();\r\n\r\n        if (normalMatrix !== undefined) {\r\n\r\n          normal.applyMatrix3(normalMatrix).normalize();\r\n\r\n        }\r\n\r\n        faceCopy.vertexNormals.push(normal);\r\n\r\n      }\r\n\r\n      faceCopy.color.copy(face.color);\r\n\r\n      for (var j = 0, jl = faceVertexColors.length; j < jl; j++) {\r\n\r\n        color = faceVertexColors[j];\r\n        faceCopy.vertexColors.push(color.clone());\r\n\r\n      }\r\n\r\n      faceCopy.materialIndex = face.materialIndex + materialIndexOffset;\r\n\r\n      faces1.push(faceCopy);\r\n\r\n    }\r\n\r\n    // uvs\r\n\r\n    for (i = 0, il = uvs2.length; i < il; i++) {\r\n\r\n      var uv = uvs2[i],\r\n        uvCopy = [];\r\n\r\n      if (uv === undefined) {\r\n\r\n        continue;\r\n\r\n      }\r\n\r\n      for (var j = 0, jl = uv.length; j < jl; j++) {\r\n\r\n        uvCopy.push(uv[j].clone());\r\n\r\n      }\r\n\r\n      uvs1.push(uvCopy);\r\n\r\n    }\r\n\r\n  },\r\n\r\n  mergeMesh: function(mesh) {\r\n\r\n    if (mesh instanceof THREE.Mesh === false) {\r\n\r\n      THREE.error('THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.', mesh);\r\n      return;\r\n\r\n    }\r\n\r\n    mesh.matrixAutoUpdate && mesh.updateMatrix();\r\n\r\n    this.merge(mesh.geometry, mesh.matrix);\r\n\r\n  },\r\n\r\n  /*\r\n   * Checks for duplicate vertices with hashmap.\r\n   * Duplicated vertices are removed\r\n   * and faces' vertices are updated.\r\n   */\r\n\r\n  mergeVertices: function() {\r\n\r\n    var verticesMap = {}; // Hashmap for looking up vertice by position coordinates (and making sure they are unique)\r\n    var unique = [],\r\n      changes = [];\r\n\r\n    var v, key;\r\n    var precisionPoints = 4; // number of decimal points, eg. 4 for epsilon of 0.0001\r\n    var precision = Math.pow(10, precisionPoints);\r\n    var i, il, face;\r\n    var indices, j, jl;\r\n\r\n    for (i = 0, il = this.vertices.length; i < il; i++) {\r\n\r\n      v = this.vertices[i];\r\n      key = Math.round(v.x * precision) + '_' + Math.round(v.y * precision) + '_' + Math.round(v.z * precision);\r\n\r\n      if (verticesMap[key] === undefined) {\r\n\r\n        verticesMap[key] = i;\r\n        unique.push(this.vertices[i]);\r\n        changes[i] = unique.length - 1;\r\n\r\n      }\r\n      else {\r\n\r\n        //console.log('Duplicate vertex found. ', i, ' could be using ', verticesMap[key]);\r\n        changes[i] = changes[verticesMap[key]];\r\n\r\n      }\r\n\r\n    };\r\n\r\n\r\n    // if faces are completely degenerate after merging vertices, we\r\n    // have to remove them from the geometry.\r\n    var faceIndicesToRemove = [];\r\n\r\n    for (i = 0, il = this.faces.length; i < il; i++) {\r\n\r\n      face = this.faces[i];\r\n\r\n      face.a = changes[face.a];\r\n      face.b = changes[face.b];\r\n      face.c = changes[face.c];\r\n\r\n      indices = [face.a, face.b, face.c];\r\n\r\n      var dupIndex = -1;\r\n\r\n      // if any duplicate vertices are found in a Face3\r\n      // we have to remove the face as nothing can be saved\r\n      for (var n = 0; n < 3; n++) {\r\n        if (indices[n] == indices[(n + 1) % 3]) {\r\n\r\n          dupIndex = n;\r\n          faceIndicesToRemove.push(i);\r\n          break;\r\n\r\n        }\r\n      }\r\n\r\n    }\r\n\r\n    for (i = faceIndicesToRemove.length - 1; i >= 0; i--) {\r\n      var idx = faceIndicesToRemove[i];\r\n\r\n      this.faces.splice(idx, 1);\r\n\r\n      for (j = 0, jl = this.faceVertexUvs.length; j < jl; j++) {\r\n\r\n        this.faceVertexUvs[j].splice(idx, 1);\r\n\r\n      }\r\n\r\n    }\r\n\r\n    // Use unique set of vertices\r\n\r\n    var diff = this.vertices.length - unique.length;\r\n    this.vertices = unique;\r\n    return diff;\r\n\r\n  },\r\n\r\n  toJSON: function() {\r\n\r\n    var output = {\r\n      metadata: {\r\n        version: 4.0,\r\n        type: 'BufferGeometry',\r\n        generator: 'BufferGeometryExporter'\r\n      },\r\n      uuid: this.uuid,\r\n      type: this.type\r\n    };\r\n\r\n    if (this.name !== \"\") output.name = this.name;\r\n\r\n    if (this.parameters !== undefined) {\r\n\r\n      var parameters = this.parameters;\r\n\r\n      for (var key in parameters) {\r\n\r\n        if (parameters[key] !== undefined) output[key] = parameters[key];\r\n\r\n      }\r\n\r\n      return output;\r\n\r\n    }\r\n\r\n    var vertices = [];\r\n\r\n    for (var i = 0; i < this.vertices.length; i++) {\r\n\r\n      var vertex = this.vertices[i];\r\n      vertices.push(vertex.x, vertex.y, vertex.z);\r\n\r\n    }\r\n\r\n    var faces = [];\r\n    var normals = [];\r\n    var normalsHash = {};\r\n    var colors = [];\r\n    var colorsHash = {};\r\n    var uvs = [];\r\n    var uvsHash = {};\r\n\r\n    for (var i = 0; i < this.faces.length; i++) {\r\n\r\n      var face = this.faces[i];\r\n\r\n      var hasMaterial = false; // face.materialIndex !== undefined;\r\n      var hasFaceUv = false; // deprecated\r\n      var hasFaceVertexUv = this.faceVertexUvs[0][i] !== undefined;\r\n      var hasFaceNormal = face.normal.length() > 0;\r\n      var hasFaceVertexNormal = face.vertexNormals.length > 0;\r\n      var hasFaceColor = face.color.r !== 1 || face.color.g !== 1 || face.color.b !== 1;\r\n      var hasFaceVertexColor = face.vertexColors.length > 0;\r\n\r\n      var faceType = 0;\r\n\r\n      faceType = setBit(faceType, 0, 0);\r\n      faceType = setBit(faceType, 1, hasMaterial);\r\n      faceType = setBit(faceType, 2, hasFaceUv);\r\n      faceType = setBit(faceType, 3, hasFaceVertexUv);\r\n      faceType = setBit(faceType, 4, hasFaceNormal);\r\n      faceType = setBit(faceType, 5, hasFaceVertexNormal);\r\n      faceType = setBit(faceType, 6, hasFaceColor);\r\n      faceType = setBit(faceType, 7, hasFaceVertexColor);\r\n\r\n      faces.push(faceType);\r\n      faces.push(face.a, face.b, face.c);\r\n\r\n\r\n      /*\r\n      if ( hasMaterial ) {\r\n\r\n      \tfaces.push( face.materialIndex );\r\n\r\n      }\r\n      */\r\n\r\n      if (hasFaceVertexUv) {\r\n\r\n        var faceVertexUvs = this.faceVertexUvs[0][i];\r\n\r\n        faces.push(\r\n          getUvIndex(faceVertexUvs[0]),\r\n          getUvIndex(faceVertexUvs[1]),\r\n          getUvIndex(faceVertexUvs[2])\r\n        );\r\n\r\n      }\r\n\r\n      if (hasFaceNormal) {\r\n\r\n        faces.push(getNormalIndex(face.normal));\r\n\r\n      }\r\n\r\n      if (hasFaceVertexNormal) {\r\n\r\n        var vertexNormals = face.vertexNormals;\r\n\r\n        faces.push(\r\n          getNormalIndex(vertexNormals[0]),\r\n          getNormalIndex(vertexNormals[1]),\r\n          getNormalIndex(vertexNormals[2])\r\n        );\r\n\r\n      }\r\n\r\n      if (hasFaceColor) {\r\n\r\n        faces.push(getColorIndex(face.color));\r\n\r\n      }\r\n\r\n      if (hasFaceVertexColor) {\r\n\r\n        var vertexColors = face.vertexColors;\r\n\r\n        faces.push(\r\n          getColorIndex(vertexColors[0]),\r\n          getColorIndex(vertexColors[1]),\r\n          getColorIndex(vertexColors[2])\r\n        );\r\n\r\n      }\r\n\r\n    }\r\n\r\n    function setBit(value, position, enabled) {\r\n\r\n      return enabled ? value | (1 << position) : value & (~(1 << position));\r\n\r\n    }\r\n\r\n    function getNormalIndex(normal) {\r\n\r\n      var hash = normal.x.toString() + normal.y.toString() + normal.z.toString();\r\n\r\n      if (normalsHash[hash] !== undefined) {\r\n\r\n        return normalsHash[hash];\r\n\r\n      }\r\n\r\n      normalsHash[hash] = normals.length / 3;\r\n      normals.push(normal.x, normal.y, normal.z);\r\n\r\n      return normalsHash[hash];\r\n\r\n    }\r\n\r\n    function getColorIndex(color) {\r\n\r\n      var hash = color.r.toString() + color.g.toString() + color.b.toString();\r\n\r\n      if (colorsHash[hash] !== undefined) {\r\n\r\n        return colorsHash[hash];\r\n\r\n      }\r\n\r\n      colorsHash[hash] = colors.length;\r\n      colors.push(color.getHex());\r\n\r\n      return colorsHash[hash];\r\n\r\n    }\r\n\r\n    function getUvIndex(uv) {\r\n\r\n      var hash = uv.x.toString() + uv.y.toString();\r\n\r\n      if (uvsHash[hash] !== undefined) {\r\n\r\n        return uvsHash[hash];\r\n\r\n      }\r\n\r\n      uvsHash[hash] = uvs.length / 2;\r\n      uvs.push(uv.x, uv.y);\r\n\r\n      return uvsHash[hash];\r\n\r\n    }\r\n\r\n    output.data = {};\r\n\r\n    output.data.vertices = vertices;\r\n    output.data.normals = normals;\r\n    if (colors.length > 0) output.data.colors = colors;\r\n    if (uvs.length > 0) output.data.uvs = [uvs]; // temporal backward compatibility\r\n    output.data.faces = faces;\r\n\r\n    //\r\n\r\n    return output;\r\n\r\n  },\r\n\r\n  clone: function() {\r\n\r\n    var geometry = new THREE.Geometry();\r\n\r\n    var vertices = this.vertices;\r\n\r\n    for (var i = 0, il = vertices.length; i < il; i++) {\r\n\r\n      geometry.vertices.push(vertices[i].clone());\r\n\r\n    }\r\n\r\n    var faces = this.faces;\r\n\r\n    for (var i = 0, il = faces.length; i < il; i++) {\r\n\r\n      geometry.faces.push(faces[i].clone());\r\n\r\n    }\r\n\r\n    for (var i = 0, il = this.faceVertexUvs.length; i < il; i++) {\r\n\r\n      var faceVertexUvs = this.faceVertexUvs[i];\r\n\r\n      if (geometry.faceVertexUvs[i] === undefined) {\r\n\r\n        geometry.faceVertexUvs[i] = [];\r\n\r\n      }\r\n\r\n      for (var j = 0, jl = faceVertexUvs.length; j < jl; j++) {\r\n\r\n        var uvs = faceVertexUvs[j],\r\n          uvsCopy = [];\r\n\r\n        for (var k = 0, kl = uvs.length; k < kl; k++) {\r\n\r\n          var uv = uvs[k];\r\n\r\n          uvsCopy.push(uv.clone());\r\n\r\n        }\r\n\r\n        geometry.faceVertexUvs[i].push(uvsCopy);\r\n\r\n      }\r\n\r\n    }\r\n\r\n    return geometry;\r\n\r\n  },\r\n\r\n  dispose: function() {\r\n\r\n    this.dispatchEvent({\r\n      type: 'dispose'\r\n    });\r\n\r\n  }\r\n\r\n};\r\n\r\nTHREE.EventDispatcher.prototype.apply(THREE.Geometry.prototype);\r\n\r\nTHREE.GeometryIdCount = 0;\r\n\r\n// File:src/cameras/Camera.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author mikael emtinger / http://gomo.se/\r\n * @author WestLangley / http://github.com/WestLangley\r\n */\r\n\r\nTHREE.Camera = function() {\r\n\r\n  THREE.Object3D.call(this);\r\n\r\n  this.type = 'Camera';\r\n\r\n  this.matrixWorldInverse = new THREE.Matrix4();\r\n  this.projectionMatrix = new THREE.Matrix4();\r\n\r\n};\r\n\r\nTHREE.Camera.prototype = Object.create(THREE.Object3D.prototype);\r\nTHREE.Camera.prototype.constructor = THREE.Camera;\r\n\r\nTHREE.Camera.prototype.getWorldDirection = function() {\r\n\r\n  var quaternion = new THREE.Quaternion();\r\n\r\n  return function(optionalTarget) {\r\n\r\n    var result = optionalTarget || new THREE.Vector3();\r\n\r\n    this.getWorldQuaternion(quaternion);\r\n\r\n    return result.set(0, 0, -1).applyQuaternion(quaternion);\r\n\r\n  }\r\n\r\n}();\r\n\r\nTHREE.Camera.prototype.lookAt = function() {\r\n\r\n  // This routine does not support cameras with rotated and/or translated parent(s)\r\n\r\n  var m1 = new THREE.Matrix4();\r\n\r\n  return function(vector) {\r\n\r\n    m1.lookAt(this.position, vector, this.up);\r\n\r\n    this.quaternion.setFromRotationMatrix(m1);\r\n\r\n  };\r\n\r\n}();\r\n\r\nTHREE.Camera.prototype.clone = function(camera) {\r\n\r\n  if (camera === undefined) camera = new THREE.Camera();\r\n\r\n  THREE.Object3D.prototype.clone.call(this, camera);\r\n\r\n  camera.matrixWorldInverse.copy(this.matrixWorldInverse);\r\n  camera.projectionMatrix.copy(this.projectionMatrix);\r\n\r\n  return camera;\r\n};\r\n\r\n// File:src/cameras/CubeCamera.js\r\n\r\n/**\r\n * Camera for rendering cube maps\r\n *\t- renders scene into axis-aligned cube\r\n *\r\n * @author alteredq / http://alteredqualia.com/\r\n */\r\n\r\nTHREE.CubeCamera = function(near, far, cubeResolution) {\r\n\r\n  THREE.Object3D.call(this);\r\n\r\n  this.type = 'CubeCamera';\r\n\r\n  var fov = 90,\r\n    aspect = 1;\r\n\r\n  var cameraPX = new THREE.PerspectiveCamera(fov, aspect, near, far);\r\n  cameraPX.up.set(0, -1, 0);\r\n  cameraPX.lookAt(new THREE.Vector3(1, 0, 0));\r\n  this.add(cameraPX);\r\n\r\n  var cameraNX = new THREE.PerspectiveCamera(fov, aspect, near, far);\r\n  cameraNX.up.set(0, -1, 0);\r\n  cameraNX.lookAt(new THREE.Vector3(-1, 0, 0));\r\n  this.add(cameraNX);\r\n\r\n  var cameraPY = new THREE.PerspectiveCamera(fov, aspect, near, far);\r\n  cameraPY.up.set(0, 0, 1);\r\n  cameraPY.lookAt(new THREE.Vector3(0, 1, 0));\r\n  this.add(cameraPY);\r\n\r\n  var cameraNY = new THREE.PerspectiveCamera(fov, aspect, near, far);\r\n  cameraNY.up.set(0, 0, -1);\r\n  cameraNY.lookAt(new THREE.Vector3(0, -1, 0));\r\n  this.add(cameraNY);\r\n\r\n  var cameraPZ = new THREE.PerspectiveCamera(fov, aspect, near, far);\r\n  cameraPZ.up.set(0, -1, 0);\r\n  cameraPZ.lookAt(new THREE.Vector3(0, 0, 1));\r\n  this.add(cameraPZ);\r\n\r\n  var cameraNZ = new THREE.PerspectiveCamera(fov, aspect, near, far);\r\n  cameraNZ.up.set(0, -1, 0);\r\n  cameraNZ.lookAt(new THREE.Vector3(0, 0, -1));\r\n  this.add(cameraNZ);\r\n\r\n  this.renderTarget = new THREE.WebGLRenderTargetCube(cubeResolution, cubeResolution, {\r\n    format: THREE.RGBFormat,\r\n    magFilter: THREE.LinearFilter,\r\n    minFilter: THREE.LinearFilter\r\n  });\r\n\r\n  this.updateCubeMap = function(renderer, scene) {\r\n\r\n    var renderTarget = this.renderTarget;\r\n    var generateMipmaps = renderTarget.generateMipmaps;\r\n\r\n    renderTarget.generateMipmaps = false;\r\n\r\n    renderTarget.activeCubeFace = 0;\r\n    renderer.render(scene, cameraPX, renderTarget);\r\n\r\n    renderTarget.activeCubeFace = 1;\r\n    renderer.render(scene, cameraNX, renderTarget);\r\n\r\n    renderTarget.activeCubeFace = 2;\r\n    renderer.render(scene, cameraPY, renderTarget);\r\n\r\n    renderTarget.activeCubeFace = 3;\r\n    renderer.render(scene, cameraNY, renderTarget);\r\n\r\n    renderTarget.activeCubeFace = 4;\r\n    renderer.render(scene, cameraPZ, renderTarget);\r\n\r\n    renderTarget.generateMipmaps = generateMipmaps;\r\n\r\n    renderTarget.activeCubeFace = 5;\r\n    renderer.render(scene, cameraNZ, renderTarget);\r\n\r\n  };\r\n\r\n};\r\n\r\nTHREE.CubeCamera.prototype = Object.create(THREE.Object3D.prototype);\r\nTHREE.CubeCamera.prototype.constructor = THREE.CubeCamera;\r\n\r\n// File:src/cameras/OrthographicCamera.js\r\n\r\n/**\r\n * @author alteredq / http://alteredqualia.com/\r\n */\r\n\r\nTHREE.OrthographicCamera = function(left, right, top, bottom, near, far) {\r\n\r\n  THREE.Camera.call(this);\r\n\r\n  this.type = 'OrthographicCamera';\r\n\r\n  this.zoom = 1;\r\n\r\n  this.left = left;\r\n  this.right = right;\r\n  this.top = top;\r\n  this.bottom = bottom;\r\n\r\n  this.near = (near !== undefined) ? near : 0.1;\r\n  this.far = (far !== undefined) ? far : 2000;\r\n\r\n  this.updateProjectionMatrix();\r\n\r\n};\r\n\r\nTHREE.OrthographicCamera.prototype = Object.create(THREE.Camera.prototype);\r\nTHREE.OrthographicCamera.prototype.constructor = THREE.OrthographicCamera;\r\n\r\nTHREE.OrthographicCamera.prototype.updateProjectionMatrix = function() {\r\n\r\n  var dx = (this.right - this.left) / (2 * this.zoom);\r\n  var dy = (this.top - this.bottom) / (2 * this.zoom);\r\n  var cx = (this.right + this.left) / 2;\r\n  var cy = (this.top + this.bottom) / 2;\r\n\r\n  this.projectionMatrix.makeOrthographic(cx - dx, cx + dx, cy + dy, cy - dy, this.near, this.far);\r\n\r\n};\r\n\r\nTHREE.OrthographicCamera.prototype.clone = function() {\r\n\r\n  var camera = new THREE.OrthographicCamera();\r\n\r\n  THREE.Camera.prototype.clone.call(this, camera);\r\n\r\n  camera.zoom = this.zoom;\r\n\r\n  camera.left = this.left;\r\n  camera.right = this.right;\r\n  camera.top = this.top;\r\n  camera.bottom = this.bottom;\r\n\r\n  camera.near = this.near;\r\n  camera.far = this.far;\r\n\r\n  camera.projectionMatrix.copy(this.projectionMatrix);\r\n\r\n  return camera;\r\n};\r\n\r\n// File:src/cameras/PerspectiveCamera.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author greggman / http://games.greggman.com/\r\n * @author zz85 / http://www.lab4games.net/zz85/blog\r\n */\r\n\r\nTHREE.PerspectiveCamera = function(fov, aspect, near, far) {\r\n\r\n  THREE.Camera.call(this);\r\n\r\n  this.type = 'PerspectiveCamera';\r\n\r\n  this.zoom = 1;\r\n\r\n  this.fov = fov !== undefined ? fov : 50;\r\n  this.aspect = aspect !== undefined ? aspect : 1;\r\n  this.near = near !== undefined ? near : 0.1;\r\n  this.far = far !== undefined ? far : 2000;\r\n\r\n  this.updateProjectionMatrix();\r\n\r\n};\r\n\r\nTHREE.PerspectiveCamera.prototype = Object.create(THREE.Camera.prototype);\r\nTHREE.PerspectiveCamera.prototype.constructor = THREE.PerspectiveCamera;\r\n\r\n\r\n/**\r\n * Uses Focal Length (in mm) to estimate and set FOV\r\n * 35mm (fullframe) camera is used if frame size is not specified;\r\n * Formula based on http://www.bobatkins.com/photography/technical/field_of_view.html\r\n */\r\n\r\nTHREE.PerspectiveCamera.prototype.setLens = function(focalLength, frameHeight) {\r\n\r\n  if (frameHeight === undefined) frameHeight = 24;\r\n\r\n  this.fov = 2 * THREE.Math.radToDeg(Math.atan(frameHeight / (focalLength * 2)));\r\n  this.updateProjectionMatrix();\r\n\r\n}\r\n\r\n\r\n/**\r\n * Sets an offset in a larger frustum. This is useful for multi-window or\r\n * multi-monitor/multi-machine setups.\r\n *\r\n * For example, if you have 3x2 monitors and each monitor is 1920x1080 and\r\n * the monitors are in grid like this\r\n *\r\n *   +---+---+---+\r\n *   | A | B | C |\r\n *   +---+---+---+\r\n *   | D | E | F |\r\n *   +---+---+---+\r\n *\r\n * then for each monitor you would call it like this\r\n *\r\n *   var w = 1920;\r\n *   var h = 1080;\r\n *   var fullWidth = w * 3;\r\n *   var fullHeight = h * 2;\r\n *\r\n *   --A--\r\n *   camera.setOffset( fullWidth, fullHeight, w * 0, h * 0, w, h );\r\n *   --B--\r\n *   camera.setOffset( fullWidth, fullHeight, w * 1, h * 0, w, h );\r\n *   --C--\r\n *   camera.setOffset( fullWidth, fullHeight, w * 2, h * 0, w, h );\r\n *   --D--\r\n *   camera.setOffset( fullWidth, fullHeight, w * 0, h * 1, w, h );\r\n *   --E--\r\n *   camera.setOffset( fullWidth, fullHeight, w * 1, h * 1, w, h );\r\n *   --F--\r\n *   camera.setOffset( fullWidth, fullHeight, w * 2, h * 1, w, h );\r\n *\r\n *   Note there is no reason monitors have to be the same size or in a grid.\r\n */\r\n\r\nTHREE.PerspectiveCamera.prototype.setViewOffset = function(fullWidth, fullHeight, x, y, width, height) {\r\n\r\n  this.fullWidth = fullWidth;\r\n  this.fullHeight = fullHeight;\r\n  this.x = x;\r\n  this.y = y;\r\n  this.width = width;\r\n  this.height = height;\r\n\r\n  this.updateProjectionMatrix();\r\n\r\n};\r\n\r\n\r\nTHREE.PerspectiveCamera.prototype.updateProjectionMatrix = function() {\r\n\r\n  var fov = THREE.Math.radToDeg(2 * Math.atan(Math.tan(THREE.Math.degToRad(this.fov) * 0.5) / this.zoom));\r\n\r\n  if (this.fullWidth) {\r\n\r\n    var aspect = this.fullWidth / this.fullHeight;\r\n    var top = Math.tan(THREE.Math.degToRad(fov * 0.5)) * this.near;\r\n    var bottom = -top;\r\n    var left = aspect * bottom;\r\n    var right = aspect * top;\r\n    var width = Math.abs(right - left);\r\n    var height = Math.abs(top - bottom);\r\n\r\n    this.projectionMatrix.makeFrustum(\r\n      left + this.x * width / this.fullWidth,\r\n      left + (this.x + this.width) * width / this.fullWidth,\r\n      top - (this.y + this.height) * height / this.fullHeight,\r\n      top - this.y * height / this.fullHeight,\r\n      this.near,\r\n      this.far\r\n    );\r\n\r\n  }\r\n  else {\r\n\r\n    this.projectionMatrix.makePerspective(fov, this.aspect, this.near, this.far);\r\n\r\n  }\r\n\r\n};\r\n\r\nTHREE.PerspectiveCamera.prototype.clone = function() {\r\n\r\n  var camera = new THREE.PerspectiveCamera();\r\n\r\n  THREE.Camera.prototype.clone.call(this, camera);\r\n\r\n  camera.zoom = this.zoom;\r\n\r\n  camera.fov = this.fov;\r\n  camera.aspect = this.aspect;\r\n  camera.near = this.near;\r\n  camera.far = this.far;\r\n\r\n  camera.projectionMatrix.copy(this.projectionMatrix);\r\n\r\n  return camera;\r\n\r\n};\r\n\r\n// File:src/lights/Light.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author alteredq / http://alteredqualia.com/\r\n */\r\n\r\nTHREE.Light = function(color) {\r\n\r\n  THREE.Object3D.call(this);\r\n\r\n  this.type = 'Light';\r\n\r\n  this.color = new THREE.Color(color);\r\n\r\n};\r\n\r\nTHREE.Light.prototype = Object.create(THREE.Object3D.prototype);\r\nTHREE.Light.prototype.constructor = THREE.Light;\r\n\r\nTHREE.Light.prototype.clone = function(light) {\r\n\r\n  if (light === undefined) light = new THREE.Light();\r\n\r\n  THREE.Object3D.prototype.clone.call(this, light);\r\n\r\n  light.color.copy(this.color);\r\n\r\n  return light;\r\n\r\n};\r\n\r\n// File:src/lights/AmbientLight.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.AmbientLight = function(color) {\r\n\r\n  THREE.Light.call(this, color);\r\n\r\n  this.type = 'AmbientLight';\r\n\r\n};\r\n\r\nTHREE.AmbientLight.prototype = Object.create(THREE.Light.prototype);\r\nTHREE.AmbientLight.prototype.constructor = THREE.AmbientLight;\r\n\r\nTHREE.AmbientLight.prototype.clone = function() {\r\n\r\n  var light = new THREE.AmbientLight();\r\n\r\n  THREE.Light.prototype.clone.call(this, light);\r\n\r\n  return light;\r\n\r\n};\r\n\r\n// File:src/lights/AreaLight.js\r\n\r\n/**\r\n * @author MPanknin / http://www.redplant.de/\r\n * @author alteredq / http://alteredqualia.com/\r\n */\r\n\r\nTHREE.AreaLight = function(color, intensity) {\r\n\r\n  THREE.Light.call(this, color);\r\n\r\n  this.type = 'AreaLight';\r\n\r\n  this.normal = new THREE.Vector3(0, -1, 0);\r\n  this.right = new THREE.Vector3(1, 0, 0);\r\n\r\n  this.intensity = (intensity !== undefined) ? intensity : 1;\r\n\r\n  this.width = 1.0;\r\n  this.height = 1.0;\r\n\r\n  this.constantAttenuation = 1.5;\r\n  this.linearAttenuation = 0.5;\r\n  this.quadraticAttenuation = 0.1;\r\n\r\n};\r\n\r\nTHREE.AreaLight.prototype = Object.create(THREE.Light.prototype);\r\nTHREE.AreaLight.prototype.constructor = THREE.AreaLight;\r\n\r\n\r\n// File:src/lights/DirectionalLight.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author alteredq / http://alteredqualia.com/\r\n */\r\n\r\nTHREE.DirectionalLight = function(color, intensity) {\r\n\r\n  THREE.Light.call(this, color);\r\n\r\n  this.type = 'DirectionalLight';\r\n\r\n  this.position.set(0, 1, 0);\r\n  this.target = new THREE.Object3D();\r\n\r\n  this.intensity = (intensity !== undefined) ? intensity : 1;\r\n\r\n  this.castShadow = false;\r\n  this.onlyShadow = false;\r\n\r\n  //\r\n\r\n  this.shadowCameraNear = 50;\r\n  this.shadowCameraFar = 5000;\r\n\r\n  this.shadowCameraLeft = -500;\r\n  this.shadowCameraRight = 500;\r\n  this.shadowCameraTop = 500;\r\n  this.shadowCameraBottom = -500;\r\n\r\n  this.shadowCameraVisible = false;\r\n\r\n  this.shadowBias = 0;\r\n  this.shadowDarkness = 0.5;\r\n\r\n  this.shadowMapWidth = 512;\r\n  this.shadowMapHeight = 512;\r\n\r\n  //\r\n\r\n  this.shadowCascade = false;\r\n\r\n  this.shadowCascadeOffset = new THREE.Vector3(0, 0, -1000);\r\n  this.shadowCascadeCount = 2;\r\n\r\n  this.shadowCascadeBias = [0, 0, 0];\r\n  this.shadowCascadeWidth = [512, 512, 512];\r\n  this.shadowCascadeHeight = [512, 512, 512];\r\n\r\n  this.shadowCascadeNearZ = [-1.000, 0.990, 0.998];\r\n  this.shadowCascadeFarZ = [0.990, 0.998, 1.000];\r\n\r\n  this.shadowCascadeArray = [];\r\n\r\n  //\r\n\r\n  this.shadowMap = null;\r\n  this.shadowMapSize = null;\r\n  this.shadowCamera = null;\r\n  this.shadowMatrix = null;\r\n\r\n};\r\n\r\nTHREE.DirectionalLight.prototype = Object.create(THREE.Light.prototype);\r\nTHREE.DirectionalLight.prototype.constructor = THREE.DirectionalLight;\r\n\r\nTHREE.DirectionalLight.prototype.clone = function() {\r\n\r\n  var light = new THREE.DirectionalLight();\r\n\r\n  THREE.Light.prototype.clone.call(this, light);\r\n\r\n  light.target = this.target.clone();\r\n\r\n  light.intensity = this.intensity;\r\n\r\n  light.castShadow = this.castShadow;\r\n  light.onlyShadow = this.onlyShadow;\r\n\r\n  //\r\n\r\n  light.shadowCameraNear = this.shadowCameraNear;\r\n  light.shadowCameraFar = this.shadowCameraFar;\r\n\r\n  light.shadowCameraLeft = this.shadowCameraLeft;\r\n  light.shadowCameraRight = this.shadowCameraRight;\r\n  light.shadowCameraTop = this.shadowCameraTop;\r\n  light.shadowCameraBottom = this.shadowCameraBottom;\r\n\r\n  light.shadowCameraVisible = this.shadowCameraVisible;\r\n\r\n  light.shadowBias = this.shadowBias;\r\n  light.shadowDarkness = this.shadowDarkness;\r\n\r\n  light.shadowMapWidth = this.shadowMapWidth;\r\n  light.shadowMapHeight = this.shadowMapHeight;\r\n\r\n  //\r\n\r\n  light.shadowCascade = this.shadowCascade;\r\n\r\n  light.shadowCascadeOffset.copy(this.shadowCascadeOffset);\r\n  light.shadowCascadeCount = this.shadowCascadeCount;\r\n\r\n  light.shadowCascadeBias = this.shadowCascadeBias.slice(0);\r\n  light.shadowCascadeWidth = this.shadowCascadeWidth.slice(0);\r\n  light.shadowCascadeHeight = this.shadowCascadeHeight.slice(0);\r\n\r\n  light.shadowCascadeNearZ = this.shadowCascadeNearZ.slice(0);\r\n  light.shadowCascadeFarZ = this.shadowCascadeFarZ.slice(0);\r\n\r\n  return light;\r\n\r\n};\r\n\r\n// File:src/lights/HemisphereLight.js\r\n\r\n/**\r\n * @author alteredq / http://alteredqualia.com/\r\n */\r\n\r\nTHREE.HemisphereLight = function(skyColor, groundColor, intensity) {\r\n\r\n  THREE.Light.call(this, skyColor);\r\n\r\n  this.type = 'HemisphereLight';\r\n\r\n  this.position.set(0, 100, 0);\r\n\r\n  this.groundColor = new THREE.Color(groundColor);\r\n  this.intensity = (intensity !== undefined) ? intensity : 1;\r\n\r\n};\r\n\r\nTHREE.HemisphereLight.prototype = Object.create(THREE.Light.prototype);\r\nTHREE.HemisphereLight.prototype.constructor = THREE.HemisphereLight;\r\n\r\nTHREE.HemisphereLight.prototype.clone = function() {\r\n\r\n  var light = new THREE.HemisphereLight();\r\n\r\n  THREE.Light.prototype.clone.call(this, light);\r\n\r\n  light.groundColor.copy(this.groundColor);\r\n  light.intensity = this.intensity;\r\n\r\n  return light;\r\n\r\n};\r\n\r\n// File:src/lights/PointLight.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.PointLight = function(color, intensity, distance, decay) {\r\n\r\n  THREE.Light.call(this, color);\r\n\r\n  this.type = 'PointLight';\r\n\r\n  this.intensity = (intensity !== undefined) ? intensity : 1;\r\n  this.distance = (distance !== undefined) ? distance : 0;\r\n  this.decay = (decay !== undefined) ? decay : 1; // for physically correct lights, should be 2.\r\n\r\n};\r\n\r\nTHREE.PointLight.prototype = Object.create(THREE.Light.prototype);\r\nTHREE.PointLight.prototype.constructor = THREE.PointLight;\r\n\r\nTHREE.PointLight.prototype.clone = function() {\r\n\r\n  var light = new THREE.PointLight();\r\n\r\n  THREE.Light.prototype.clone.call(this, light);\r\n\r\n  light.intensity = this.intensity;\r\n  light.distance = this.distance;\r\n  light.decay = this.decay;\r\n\r\n  return light;\r\n\r\n};\r\n\r\n// File:src/lights/SpotLight.js\r\n\r\n/**\r\n * @author alteredq / http://alteredqualia.com/\r\n */\r\n\r\nTHREE.SpotLight = function(color, intensity, distance, angle, exponent, decay) {\r\n\r\n  THREE.Light.call(this, color);\r\n\r\n  this.type = 'SpotLight';\r\n\r\n  this.position.set(0, 1, 0);\r\n  this.target = new THREE.Object3D();\r\n\r\n  this.intensity = (intensity !== undefined) ? intensity : 1;\r\n  this.distance = (distance !== undefined) ? distance : 0;\r\n  this.angle = (angle !== undefined) ? angle : Math.PI / 3;\r\n  this.exponent = (exponent !== undefined) ? exponent : 10;\r\n  this.decay = (decay !== undefined) ? decay : 1; // for physically correct lights, should be 2.\r\n\r\n  this.castShadow = false;\r\n  this.onlyShadow = false;\r\n\r\n  //\r\n\r\n  this.shadowCameraNear = 50;\r\n  this.shadowCameraFar = 5000;\r\n  this.shadowCameraFov = 50;\r\n\r\n  this.shadowCameraVisible = false;\r\n\r\n  this.shadowBias = 0;\r\n  this.shadowDarkness = 0.5;\r\n\r\n  this.shadowMapWidth = 512;\r\n  this.shadowMapHeight = 512;\r\n\r\n  //\r\n\r\n  this.shadowMap = null;\r\n  this.shadowMapSize = null;\r\n  this.shadowCamera = null;\r\n  this.shadowMatrix = null;\r\n\r\n};\r\n\r\nTHREE.SpotLight.prototype = Object.create(THREE.Light.prototype);\r\nTHREE.SpotLight.prototype.constructor = THREE.SpotLight;\r\n\r\nTHREE.SpotLight.prototype.clone = function() {\r\n\r\n  var light = new THREE.SpotLight();\r\n\r\n  THREE.Light.prototype.clone.call(this, light);\r\n\r\n  light.target = this.target.clone();\r\n\r\n  light.intensity = this.intensity;\r\n  light.distance = this.distance;\r\n  light.angle = this.angle;\r\n  light.exponent = this.exponent;\r\n  light.decay = this.decay;\r\n\r\n  light.castShadow = this.castShadow;\r\n  light.onlyShadow = this.onlyShadow;\r\n\r\n  //\r\n\r\n  light.shadowCameraNear = this.shadowCameraNear;\r\n  light.shadowCameraFar = this.shadowCameraFar;\r\n  light.shadowCameraFov = this.shadowCameraFov;\r\n\r\n  light.shadowCameraVisible = this.shadowCameraVisible;\r\n\r\n  light.shadowBias = this.shadowBias;\r\n  light.shadowDarkness = this.shadowDarkness;\r\n\r\n  light.shadowMapWidth = this.shadowMapWidth;\r\n  light.shadowMapHeight = this.shadowMapHeight;\r\n\r\n  return light;\r\n\r\n};\r\n\r\n// File:src/loaders/Cache.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.Cache = {\r\n\r\n  files: {},\r\n\r\n  add: function(key, file) {\r\n\r\n    // console.log( 'THREE.Cache', 'Adding key:', key );\r\n\r\n    this.files[key] = file;\r\n\r\n  },\r\n\r\n  get: function(key) {\r\n\r\n    // console.log( 'THREE.Cache', 'Checking key:', key );\r\n\r\n    return this.files[key];\r\n\r\n  },\r\n\r\n  remove: function(key) {\r\n\r\n    delete this.files[key];\r\n\r\n  },\r\n\r\n  clear: function() {\r\n\r\n    this.files = {}\r\n\r\n  }\r\n\r\n};\r\n\r\n// File:src/loaders/Loader.js\r\n\r\n/**\r\n * @author alteredq / http://alteredqualia.com/\r\n */\r\n\r\nTHREE.Loader = function(showStatus) {\r\n\r\n  this.showStatus = showStatus;\r\n  this.statusDomElement = showStatus ? THREE.Loader.prototype.addStatusElement() : null;\r\n\r\n  this.imageLoader = new THREE.ImageLoader();\r\n\r\n  this.onLoadStart = function() {};\r\n  this.onLoadProgress = function() {};\r\n  this.onLoadComplete = function() {};\r\n\r\n};\r\n\r\nTHREE.Loader.prototype = {\r\n\r\n  constructor: THREE.Loader,\r\n\r\n  crossOrigin: undefined,\r\n\r\n  addStatusElement: function() {\r\n\r\n    var e = document.createElement('div');\r\n\r\n    e.style.position = 'absolute';\r\n    e.style.right = '0px';\r\n    e.style.top = '0px';\r\n    e.style.fontSize = '0.8em';\r\n    e.style.textAlign = 'left';\r\n    e.style.background = 'rgba(0,0,0,0.25)';\r\n    e.style.color = '#fff';\r\n    e.style.width = '120px';\r\n    e.style.padding = '0.5em 0.5em 0.5em 0.5em';\r\n    e.style.zIndex = 1000;\r\n\r\n    e.innerHTML = 'Loading ...';\r\n\r\n    return e;\r\n\r\n  },\r\n\r\n  updateProgress: function(progress) {\r\n\r\n    var message = 'Loaded ';\r\n\r\n    if (progress.total) {\r\n\r\n      message += (100 * progress.loaded / progress.total).toFixed(0) + '%';\r\n\r\n\r\n    }\r\n    else {\r\n\r\n      message += (progress.loaded / 1024).toFixed(2) + ' KB';\r\n\r\n    }\r\n\r\n    this.statusDomElement.innerHTML = message;\r\n\r\n  },\r\n\r\n  extractUrlBase: function(url) {\r\n\r\n    var parts = url.split('/');\r\n\r\n    if (parts.length === 1) return './';\r\n\r\n    parts.pop();\r\n\r\n    return parts.join('/') + '/';\r\n\r\n  },\r\n\r\n  initMaterials: function(materials, texturePath) {\r\n\r\n    var array = [];\r\n\r\n    for (var i = 0; i < materials.length; ++i) {\r\n\r\n      array[i] = this.createMaterial(materials[i], texturePath);\r\n\r\n    }\r\n\r\n    return array;\r\n\r\n  },\r\n\r\n  needsTangents: function(materials) {\r\n\r\n    for (var i = 0, il = materials.length; i < il; i++) {\r\n\r\n      var m = materials[i];\r\n\r\n      if (m instanceof THREE.ShaderMaterial) return true;\r\n\r\n    }\r\n\r\n    return false;\r\n\r\n  },\r\n\r\n  createMaterial: function(m, texturePath) {\r\n\r\n    var scope = this;\r\n\r\n    function nearest_pow2(n) {\r\n\r\n      var l = Math.log(n) / Math.LN2;\r\n      return Math.pow(2, Math.round(l));\r\n\r\n    }\r\n\r\n    function create_texture(where, name, sourceFile, repeat, offset, wrap, anisotropy) {\r\n\r\n      var fullPath = texturePath + sourceFile;\r\n\r\n      var texture;\r\n\r\n      var loader = THREE.Loader.Handlers.get(fullPath);\r\n\r\n      if (loader !== null) {\r\n\r\n        texture = loader.load(fullPath);\r\n\r\n      }\r\n      else {\r\n\r\n        texture = new THREE.Texture();\r\n\r\n        loader = scope.imageLoader;\r\n        loader.crossOrigin = scope.crossOrigin;\r\n        loader.load(fullPath, function(image) {\r\n\r\n          if (THREE.Math.isPowerOfTwo(image.width) === false ||\r\n            THREE.Math.isPowerOfTwo(image.height) === false) {\r\n\r\n            var width = nearest_pow2(image.width);\r\n            var height = nearest_pow2(image.height);\r\n\r\n            var canvas = document.createElement('canvas');\r\n            canvas.width = width;\r\n            canvas.height = height;\r\n\r\n            var context = canvas.getContext('2d');\r\n            context.drawImage(image, 0, 0, width, height);\r\n\r\n            texture.image = canvas;\r\n\r\n          }\r\n          else {\r\n\r\n            texture.image = image;\r\n\r\n          }\r\n\r\n          texture.needsUpdate = true;\r\n\r\n        });\r\n\r\n      }\r\n\r\n      texture.sourceFile = sourceFile;\r\n\r\n      if (repeat) {\r\n\r\n        texture.repeat.set(repeat[0], repeat[1]);\r\n\r\n        if (repeat[0] !== 1) texture.wrapS = THREE.RepeatWrapping;\r\n        if (repeat[1] !== 1) texture.wrapT = THREE.RepeatWrapping;\r\n\r\n      }\r\n\r\n      if (offset) {\r\n\r\n        texture.offset.set(offset[0], offset[1]);\r\n\r\n      }\r\n\r\n      if (wrap) {\r\n\r\n        var wrapMap = {\r\n          'repeat': THREE.RepeatWrapping,\r\n          'mirror': THREE.MirroredRepeatWrapping\r\n        }\r\n\r\n        if (wrapMap[wrap[0]] !== undefined) texture.wrapS = wrapMap[wrap[0]];\r\n        if (wrapMap[wrap[1]] !== undefined) texture.wrapT = wrapMap[wrap[1]];\r\n\r\n      }\r\n\r\n      if (anisotropy) {\r\n\r\n        texture.anisotropy = anisotropy;\r\n\r\n      }\r\n\r\n      where[name] = texture;\r\n\r\n    }\r\n\r\n    function rgb2hex(rgb) {\r\n\r\n      return (rgb[0] * 255 << 16) + (rgb[1] * 255 << 8) + rgb[2] * 255;\r\n\r\n    }\r\n\r\n    // defaults\r\n\r\n    var mtype = 'MeshLambertMaterial';\r\n    var mpars = {\r\n      color: 0xeeeeee,\r\n      opacity: 1.0,\r\n      map: null,\r\n      lightMap: null,\r\n      normalMap: null,\r\n      bumpMap: null,\r\n      wireframe: false\r\n    };\r\n\r\n    // parameters from model file\r\n\r\n    if (m.shading) {\r\n\r\n      var shading = m.shading.toLowerCase();\r\n\r\n      if (shading === 'phong') mtype = 'MeshPhongMaterial';\r\n      else if (shading === 'basic') mtype = 'MeshBasicMaterial';\r\n\r\n    }\r\n\r\n    if (m.blending !== undefined && THREE[m.blending] !== undefined) {\r\n\r\n      mpars.blending = THREE[m.blending];\r\n\r\n    }\r\n\r\n    if (m.transparent !== undefined) {\r\n\r\n      mpars.transparent = m.transparent;\r\n\r\n    }\r\n\r\n    if (m.opacity !== undefined && m.opacity < 1.0) {\r\n\r\n      mpars.transparent = true;\r\n\r\n    }\r\n\r\n    if (m.depthTest !== undefined) {\r\n\r\n      mpars.depthTest = m.depthTest;\r\n\r\n    }\r\n\r\n    if (m.depthWrite !== undefined) {\r\n\r\n      mpars.depthWrite = m.depthWrite;\r\n\r\n    }\r\n\r\n    if (m.visible !== undefined) {\r\n\r\n      mpars.visible = m.visible;\r\n\r\n    }\r\n\r\n    if (m.flipSided !== undefined) {\r\n\r\n      mpars.side = THREE.BackSide;\r\n\r\n    }\r\n\r\n    if (m.doubleSided !== undefined) {\r\n\r\n      mpars.side = THREE.DoubleSide;\r\n\r\n    }\r\n\r\n    if (m.wireframe !== undefined) {\r\n\r\n      mpars.wireframe = m.wireframe;\r\n\r\n    }\r\n\r\n    if (m.vertexColors !== undefined) {\r\n\r\n      if (m.vertexColors === 'face') {\r\n\r\n        mpars.vertexColors = THREE.FaceColors;\r\n\r\n      }\r\n      else if (m.vertexColors) {\r\n\r\n        mpars.vertexColors = THREE.VertexColors;\r\n\r\n      }\r\n\r\n    }\r\n\r\n    // colors\r\n\r\n    if (m.colorDiffuse) {\r\n\r\n      mpars.color = rgb2hex(m.colorDiffuse);\r\n\r\n    }\r\n    else if (m.DbgColor) {\r\n\r\n      mpars.color = m.DbgColor;\r\n\r\n    }\r\n\r\n    if (m.colorSpecular) {\r\n\r\n      mpars.specular = rgb2hex(m.colorSpecular);\r\n\r\n    }\r\n\r\n    if (m.colorEmissive) {\r\n\r\n      mpars.emissive = rgb2hex(m.colorEmissive);\r\n\r\n    }\r\n\r\n    // modifiers\r\n\r\n    if (m.transparency !== undefined) {\r\n\r\n      console.warn('THREE.Loader: transparency has been renamed to opacity');\r\n      m.opacity = m.transparency;\r\n\r\n    }\r\n\r\n    if (m.opacity !== undefined) {\r\n\r\n      mpars.opacity = m.opacity;\r\n\r\n    }\r\n\r\n    if (m.specularCoef) {\r\n\r\n      mpars.shininess = m.specularCoef;\r\n\r\n    }\r\n\r\n    // textures\r\n\r\n    if (m.mapDiffuse && texturePath) {\r\n\r\n      create_texture(mpars, 'map', m.mapDiffuse, m.mapDiffuseRepeat, m.mapDiffuseOffset, m.mapDiffuseWrap, m.mapDiffuseAnisotropy);\r\n\r\n    }\r\n\r\n    if (m.mapLight && texturePath) {\r\n\r\n      create_texture(mpars, 'lightMap', m.mapLight, m.mapLightRepeat, m.mapLightOffset, m.mapLightWrap, m.mapLightAnisotropy);\r\n\r\n    }\r\n\r\n    if (m.mapBump && texturePath) {\r\n\r\n      create_texture(mpars, 'bumpMap', m.mapBump, m.mapBumpRepeat, m.mapBumpOffset, m.mapBumpWrap, m.mapBumpAnisotropy);\r\n\r\n    }\r\n\r\n    if (m.mapNormal && texturePath) {\r\n\r\n      create_texture(mpars, 'normalMap', m.mapNormal, m.mapNormalRepeat, m.mapNormalOffset, m.mapNormalWrap, m.mapNormalAnisotropy);\r\n\r\n    }\r\n\r\n    if (m.mapSpecular && texturePath) {\r\n\r\n      create_texture(mpars, 'specularMap', m.mapSpecular, m.mapSpecularRepeat, m.mapSpecularOffset, m.mapSpecularWrap, m.mapSpecularAnisotropy);\r\n\r\n    }\r\n\r\n    if (m.mapAlpha && texturePath) {\r\n\r\n      create_texture(mpars, 'alphaMap', m.mapAlpha, m.mapAlphaRepeat, m.mapAlphaOffset, m.mapAlphaWrap, m.mapAlphaAnisotropy);\r\n\r\n    }\r\n\r\n    //\r\n\r\n    if (m.mapBumpScale) {\r\n\r\n      mpars.bumpScale = m.mapBumpScale;\r\n\r\n    }\r\n\r\n    if (m.mapNormalFactor) {\r\n\r\n      mpars.normalScale = new THREE.Vector2(m.mapNormalFactor, m.mapNormalFactor);\r\n\r\n    }\r\n\r\n    var material = new THREE[mtype](mpars);\r\n\r\n    if (m.DbgName !== undefined) material.name = m.DbgName;\r\n\r\n    return material;\r\n\r\n  }\r\n\r\n};\r\n\r\nTHREE.Loader.Handlers = {\r\n\r\n  handlers: [],\r\n\r\n  add: function(regex, loader) {\r\n\r\n    this.handlers.push(regex, loader);\r\n\r\n  },\r\n\r\n  get: function(file) {\r\n\r\n    for (var i = 0, l = this.handlers.length; i < l; i += 2) {\r\n\r\n      var regex = this.handlers[i];\r\n      var loader = this.handlers[i + 1];\r\n\r\n      if (regex.test(file)) {\r\n\r\n        return loader;\r\n\r\n      }\r\n\r\n    }\r\n\r\n    return null;\r\n\r\n  }\r\n\r\n};\r\n\r\n// File:src/loaders/XHRLoader.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.XHRLoader = function(manager) {\r\n\r\n  this.manager = (manager !== undefined) ? manager : THREE.DefaultLoadingManager;\r\n\r\n};\r\n\r\nTHREE.XHRLoader.prototype = {\r\n\r\n  constructor: THREE.XHRLoader,\r\n\r\n  load: function(url, onLoad, onProgress, onError) {\r\n\r\n    var scope = this;\r\n\r\n    var cached = THREE.Cache.get(url);\r\n\r\n    if (cached !== undefined) {\r\n\r\n      if (onLoad) onLoad(cached);\r\n      return;\r\n\r\n    }\r\n\r\n    var request = new XMLHttpRequest();\r\n    request.open('GET', url, true);\r\n\r\n    request.addEventListener('load', function(event) {\r\n\r\n      THREE.Cache.add(url, this.response);\r\n\r\n      if (onLoad) onLoad(this.response);\r\n\r\n      scope.manager.itemEnd(url);\r\n\r\n    }, false);\r\n\r\n    if (onProgress !== undefined) {\r\n\r\n      request.addEventListener('progress', function(event) {\r\n\r\n        onProgress(event);\r\n\r\n      }, false);\r\n\r\n    }\r\n\r\n    if (onError !== undefined) {\r\n\r\n      request.addEventListener('error', function(event) {\r\n\r\n        onError(event);\r\n\r\n      }, false);\r\n\r\n    }\r\n\r\n    if (this.crossOrigin !== undefined) request.crossOrigin = this.crossOrigin;\r\n    if (this.responseType !== undefined) request.responseType = this.responseType;\r\n\r\n    request.send(null);\r\n\r\n    scope.manager.itemStart(url);\r\n\r\n  },\r\n\r\n  setResponseType: function(value) {\r\n\r\n    this.responseType = value;\r\n\r\n  },\r\n\r\n  setCrossOrigin: function(value) {\r\n\r\n    this.crossOrigin = value;\r\n\r\n  }\r\n\r\n};\r\n\r\n// File:src/loaders/ImageLoader.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.ImageLoader = function(manager) {\r\n\r\n  this.manager = (manager !== undefined) ? manager : THREE.DefaultLoadingManager;\r\n\r\n};\r\n\r\nTHREE.ImageLoader.prototype = {\r\n\r\n  constructor: THREE.ImageLoader,\r\n\r\n  load: function(url, onLoad, onProgress, onError) {\r\n\r\n    var scope = this;\r\n\r\n    var cached = THREE.Cache.get(url);\r\n\r\n    if (cached !== undefined) {\r\n\r\n      onLoad(cached);\r\n      return;\r\n\r\n    }\r\n\r\n    var image = document.createElement('img');\r\n\r\n    image.addEventListener('load', function(event) {\r\n\r\n      THREE.Cache.add(url, this);\r\n\r\n      if (onLoad) onLoad(this);\r\n\r\n      scope.manager.itemEnd(url);\r\n\r\n    }, false);\r\n\r\n    if (onProgress !== undefined) {\r\n\r\n      image.addEventListener('progress', function(event) {\r\n\r\n        onProgress(event);\r\n\r\n      }, false);\r\n\r\n    }\r\n\r\n    if (onError !== undefined) {\r\n\r\n      image.addEventListener('error', function(event) {\r\n\r\n        onError(event);\r\n\r\n      }, false);\r\n\r\n    }\r\n\r\n    if (this.crossOrigin !== undefined) image.crossOrigin = this.crossOrigin;\r\n\r\n    image.src = url;\r\n\r\n    scope.manager.itemStart(url);\r\n\r\n    return image;\r\n\r\n  },\r\n\r\n  setCrossOrigin: function(value) {\r\n\r\n    this.crossOrigin = value;\r\n\r\n  }\r\n\r\n}\r\n\r\n// File:src/loaders/JSONLoader.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author alteredq / http://alteredqualia.com/\r\n */\r\n\r\nTHREE.JSONLoader = function(showStatus) {\r\n\r\n  THREE.Loader.call(this, showStatus);\r\n\r\n  this.withCredentials = false;\r\n\r\n};\r\n\r\nTHREE.JSONLoader.prototype = Object.create(THREE.Loader.prototype);\r\nTHREE.JSONLoader.prototype.constructor = THREE.JSONLoader;\r\n\r\nTHREE.JSONLoader.prototype.load = function(url, callback, texturePath) {\r\n\r\n  // todo: unify load API to for easier SceneLoader use\r\n\r\n  texturePath = texturePath && (typeof texturePath === 'string') ? texturePath : this.extractUrlBase(url);\r\n\r\n  this.onLoadStart();\r\n  this.loadAjaxJSON(this, url, callback, texturePath);\r\n\r\n};\r\n\r\nTHREE.JSONLoader.prototype.loadAjaxJSON = function(context, url, callback, texturePath, callbackProgress) {\r\n\r\n  var xhr = new XMLHttpRequest();\r\n\r\n  var length = 0;\r\n\r\n  xhr.onreadystatechange = function() {\r\n\r\n    if (xhr.readyState === xhr.DONE) {\r\n\r\n      if (xhr.status === 200 || xhr.status === 0) {\r\n\r\n        if (xhr.responseText) {\r\n\r\n          var json = JSON.parse(xhr.responseText);\r\n          var metadata = json.metadata;\r\n\r\n          if (metadata !== undefined) {\r\n\r\n            if (metadata.type === 'object') {\r\n\r\n              THREE.error('THREE.JSONLoader: ' + url + ' should be loaded with THREE.ObjectLoader instead.');\r\n              return;\r\n\r\n            }\r\n\r\n            if (metadata.type === 'scene') {\r\n\r\n              THREE.error('THREE.JSONLoader: ' + url + ' seems to be a Scene. Use THREE.SceneLoader instead.');\r\n              return;\r\n\r\n            }\r\n\r\n          }\r\n\r\n          var result = context.parse(json, texturePath);\r\n          callback(result.geometry, result.materials);\r\n\r\n        }\r\n        else {\r\n\r\n          THREE.error('THREE.JSONLoader: ' + url + ' seems to be unreachable or the file is empty.');\r\n\r\n        }\r\n\r\n        // in context of more complex asset initialization\r\n        // do not block on single failed file\r\n        // maybe should go even one more level up\r\n\r\n        context.onLoadComplete();\r\n\r\n      }\r\n      else {\r\n\r\n        THREE.error('THREE.JSONLoader: Couldn\\'t load ' + url + ' (' + xhr.status + ')');\r\n\r\n      }\r\n\r\n    }\r\n    else if (xhr.readyState === xhr.LOADING) {\r\n\r\n      if (callbackProgress) {\r\n\r\n        if (length === 0) {\r\n\r\n          length = xhr.getResponseHeader('Content-Length');\r\n\r\n        }\r\n\r\n        callbackProgress({\r\n          total: length,\r\n          loaded: xhr.responseText.length\r\n        });\r\n\r\n      }\r\n\r\n    }\r\n    else if (xhr.readyState === xhr.HEADERS_RECEIVED) {\r\n\r\n      if (callbackProgress !== undefined) {\r\n\r\n        length = xhr.getResponseHeader('Content-Length');\r\n\r\n      }\r\n\r\n    }\r\n\r\n  };\r\n\r\n  xhr.open('GET', url, true);\r\n  xhr.withCredentials = this.withCredentials;\r\n  xhr.send(null);\r\n\r\n};\r\n\r\nTHREE.JSONLoader.prototype.parse = function(json, texturePath) {\r\n\r\n  var geometry = new THREE.Geometry(),\r\n    scale = (json.scale !== undefined) ? 1.0 / json.scale : 1.0;\r\n\r\n  parseModel(scale);\r\n\r\n  parseSkin();\r\n  parseMorphing(scale);\r\n\r\n  geometry.computeFaceNormals();\r\n  geometry.computeBoundingSphere();\r\n\r\n  function parseModel(scale) {\r\n\r\n    function isBitSet(value, position) {\r\n\r\n      return value & (1 << position);\r\n\r\n    }\r\n\r\n    var i, j, fi,\r\n\r\n      offset, zLength,\r\n\r\n      colorIndex, normalIndex, uvIndex, materialIndex,\r\n\r\n      type,\r\n      isQuad,\r\n      hasMaterial,\r\n      hasFaceVertexUv,\r\n      hasFaceNormal, hasFaceVertexNormal,\r\n      hasFaceColor, hasFaceVertexColor,\r\n\r\n      vertex, face, faceA, faceB, hex, normal,\r\n\r\n      uvLayer, uv, u, v,\r\n\r\n      faces = json.faces,\r\n      vertices = json.vertices,\r\n      normals = json.normals,\r\n      colors = json.colors,\r\n\r\n      nUvLayers = 0;\r\n\r\n    if (json.uvs !== undefined) {\r\n\r\n      // disregard empty arrays\r\n\r\n      for (i = 0; i < json.uvs.length; i++) {\r\n\r\n        if (json.uvs[i].length) nUvLayers++;\r\n\r\n      }\r\n\r\n      for (i = 0; i < nUvLayers; i++) {\r\n\r\n        geometry.faceVertexUvs[i] = [];\r\n\r\n      }\r\n\r\n    }\r\n\r\n    offset = 0;\r\n    zLength = vertices.length;\r\n\r\n    while (offset < zLength) {\r\n\r\n      vertex = new THREE.Vector3();\r\n\r\n      vertex.x = vertices[offset++] * scale;\r\n      vertex.y = vertices[offset++] * scale;\r\n      vertex.z = vertices[offset++] * scale;\r\n\r\n      geometry.vertices.push(vertex);\r\n\r\n    }\r\n\r\n    offset = 0;\r\n    zLength = faces.length;\r\n\r\n    while (offset < zLength) {\r\n\r\n      type = faces[offset++];\r\n\r\n\r\n      isQuad = isBitSet(type, 0);\r\n      hasMaterial = isBitSet(type, 1);\r\n      hasFaceVertexUv = isBitSet(type, 3);\r\n      hasFaceNormal = isBitSet(type, 4);\r\n      hasFaceVertexNormal = isBitSet(type, 5);\r\n      hasFaceColor = isBitSet(type, 6);\r\n      hasFaceVertexColor = isBitSet(type, 7);\r\n\r\n      // console.log(\"type\", type, \"bits\", isQuad, hasMaterial, hasFaceVertexUv, hasFaceNormal, hasFaceVertexNormal, hasFaceColor, hasFaceVertexColor);\r\n\r\n      if (isQuad) {\r\n\r\n        faceA = new THREE.Face3();\r\n        faceA.a = faces[offset];\r\n        faceA.b = faces[offset + 1];\r\n        faceA.c = faces[offset + 3];\r\n\r\n        faceB = new THREE.Face3();\r\n        faceB.a = faces[offset + 1];\r\n        faceB.b = faces[offset + 2];\r\n        faceB.c = faces[offset + 3];\r\n\r\n        offset += 4;\r\n\r\n        if (hasMaterial) {\r\n\r\n          materialIndex = faces[offset++];\r\n          faceA.materialIndex = materialIndex;\r\n          faceB.materialIndex = materialIndex;\r\n\r\n        }\r\n\r\n        // to get face <=> uv index correspondence\r\n\r\n        fi = geometry.faces.length;\r\n\r\n        if (hasFaceVertexUv) {\r\n\r\n          for (i = 0; i < nUvLayers; i++) {\r\n\r\n            uvLayer = json.uvs[i];\r\n\r\n            geometry.faceVertexUvs[i][fi] = [];\r\n            geometry.faceVertexUvs[i][fi + 1] = []\r\n\r\n            for (j = 0; j < 4; j++) {\r\n\r\n              uvIndex = faces[offset++];\r\n\r\n              u = uvLayer[uvIndex * 2];\r\n              v = uvLayer[uvIndex * 2 + 1];\r\n\r\n              uv = new THREE.Vector2(u, v);\r\n\r\n              if (j !== 2) geometry.faceVertexUvs[i][fi].push(uv);\r\n              if (j !== 0) geometry.faceVertexUvs[i][fi + 1].push(uv);\r\n\r\n            }\r\n\r\n          }\r\n\r\n        }\r\n\r\n        if (hasFaceNormal) {\r\n\r\n          normalIndex = faces[offset++] * 3;\r\n\r\n          faceA.normal.set(\r\n            normals[normalIndex++],\r\n            normals[normalIndex++],\r\n            normals[normalIndex]\r\n          );\r\n\r\n          faceB.normal.copy(faceA.normal);\r\n\r\n        }\r\n\r\n        if (hasFaceVertexNormal) {\r\n\r\n          for (i = 0; i < 4; i++) {\r\n\r\n            normalIndex = faces[offset++] * 3;\r\n\r\n            normal = new THREE.Vector3(\r\n              normals[normalIndex++],\r\n              normals[normalIndex++],\r\n              normals[normalIndex]\r\n            );\r\n\r\n\r\n            if (i !== 2) faceA.vertexNormals.push(normal);\r\n            if (i !== 0) faceB.vertexNormals.push(normal);\r\n\r\n          }\r\n\r\n        }\r\n\r\n\r\n        if (hasFaceColor) {\r\n\r\n          colorIndex = faces[offset++];\r\n          hex = colors[colorIndex];\r\n\r\n          faceA.color.setHex(hex);\r\n          faceB.color.setHex(hex);\r\n\r\n        }\r\n\r\n\r\n        if (hasFaceVertexColor) {\r\n\r\n          for (i = 0; i < 4; i++) {\r\n\r\n            colorIndex = faces[offset++];\r\n            hex = colors[colorIndex];\r\n\r\n            if (i !== 2) faceA.vertexColors.push(new THREE.Color(hex));\r\n            if (i !== 0) faceB.vertexColors.push(new THREE.Color(hex));\r\n\r\n          }\r\n\r\n        }\r\n\r\n        geometry.faces.push(faceA);\r\n        geometry.faces.push(faceB);\r\n\r\n      }\r\n      else {\r\n\r\n        face = new THREE.Face3();\r\n        face.a = faces[offset++];\r\n        face.b = faces[offset++];\r\n        face.c = faces[offset++];\r\n\r\n        if (hasMaterial) {\r\n\r\n          materialIndex = faces[offset++];\r\n          face.materialIndex = materialIndex;\r\n\r\n        }\r\n\r\n        // to get face <=> uv index correspondence\r\n\r\n        fi = geometry.faces.length;\r\n\r\n        if (hasFaceVertexUv) {\r\n\r\n          for (i = 0; i < nUvLayers; i++) {\r\n\r\n            uvLayer = json.uvs[i];\r\n\r\n            geometry.faceVertexUvs[i][fi] = [];\r\n\r\n            for (j = 0; j < 3; j++) {\r\n\r\n              uvIndex = faces[offset++];\r\n\r\n              u = uvLayer[uvIndex * 2];\r\n              v = uvLayer[uvIndex * 2 + 1];\r\n\r\n              uv = new THREE.Vector2(u, v);\r\n\r\n              geometry.faceVertexUvs[i][fi].push(uv);\r\n\r\n            }\r\n\r\n          }\r\n\r\n        }\r\n\r\n        if (hasFaceNormal) {\r\n\r\n          normalIndex = faces[offset++] * 3;\r\n\r\n          face.normal.set(\r\n            normals[normalIndex++],\r\n            normals[normalIndex++],\r\n            normals[normalIndex]\r\n          );\r\n\r\n        }\r\n\r\n        if (hasFaceVertexNormal) {\r\n\r\n          for (i = 0; i < 3; i++) {\r\n\r\n            normalIndex = faces[offset++] * 3;\r\n\r\n            normal = new THREE.Vector3(\r\n              normals[normalIndex++],\r\n              normals[normalIndex++],\r\n              normals[normalIndex]\r\n            );\r\n\r\n            face.vertexNormals.push(normal);\r\n\r\n          }\r\n\r\n        }\r\n\r\n\r\n        if (hasFaceColor) {\r\n\r\n          colorIndex = faces[offset++];\r\n          face.color.setHex(colors[colorIndex]);\r\n\r\n        }\r\n\r\n\r\n        if (hasFaceVertexColor) {\r\n\r\n          for (i = 0; i < 3; i++) {\r\n\r\n            colorIndex = faces[offset++];\r\n            face.vertexColors.push(new THREE.Color(colors[colorIndex]));\r\n\r\n          }\r\n\r\n        }\r\n\r\n        geometry.faces.push(face);\r\n\r\n      }\r\n\r\n    }\r\n\r\n  };\r\n\r\n  function parseSkin() {\r\n    var influencesPerVertex = (json.influencesPerVertex !== undefined) ? json.influencesPerVertex : 2;\r\n\r\n    if (json.skinWeights) {\r\n\r\n      for (var i = 0, l = json.skinWeights.length; i < l; i += influencesPerVertex) {\r\n\r\n        var x = json.skinWeights[i];\r\n        var y = (influencesPerVertex > 1) ? json.skinWeights[i + 1] : 0;\r\n        var z = (influencesPerVertex > 2) ? json.skinWeights[i + 2] : 0;\r\n        var w = (influencesPerVertex > 3) ? json.skinWeights[i + 3] : 0;\r\n\r\n        geometry.skinWeights.push(new THREE.Vector4(x, y, z, w));\r\n\r\n      }\r\n\r\n    }\r\n\r\n    if (json.skinIndices) {\r\n\r\n      for (var i = 0, l = json.skinIndices.length; i < l; i += influencesPerVertex) {\r\n\r\n        var a = json.skinIndices[i];\r\n        var b = (influencesPerVertex > 1) ? json.skinIndices[i + 1] : 0;\r\n        var c = (influencesPerVertex > 2) ? json.skinIndices[i + 2] : 0;\r\n        var d = (influencesPerVertex > 3) ? json.skinIndices[i + 3] : 0;\r\n\r\n        geometry.skinIndices.push(new THREE.Vector4(a, b, c, d));\r\n\r\n      }\r\n\r\n    }\r\n\r\n    geometry.bones = json.bones;\r\n\r\n    if (geometry.bones && geometry.bones.length > 0 && (geometry.skinWeights.length !== geometry.skinIndices.length || geometry.skinIndices.length !== geometry.vertices.length)) {\r\n\r\n      THREE.warn('THREE.JSONLoader: When skinning, number of vertices (' + geometry.vertices.length + '), skinIndices (' +\r\n        geometry.skinIndices.length + '), and skinWeights (' + geometry.skinWeights.length + ') should match.');\r\n\r\n    }\r\n\r\n\r\n    // could change this to json.animations[0] or remove completely\r\n\r\n    geometry.animation = json.animation;\r\n    geometry.animations = json.animations;\r\n\r\n  };\r\n\r\n  function parseMorphing(scale) {\r\n\r\n    if (json.morphTargets !== undefined) {\r\n\r\n      var i, l, v, vl, dstVertices, srcVertices;\r\n\r\n      for (i = 0, l = json.morphTargets.length; i < l; i++) {\r\n\r\n        geometry.morphTargets[i] = {};\r\n        geometry.morphTargets[i].name = json.morphTargets[i].name;\r\n        geometry.morphTargets[i].vertices = [];\r\n\r\n        dstVertices = geometry.morphTargets[i].vertices;\r\n        srcVertices = json.morphTargets[i].vertices;\r\n\r\n        for (v = 0, vl = srcVertices.length; v < vl; v += 3) {\r\n\r\n          var vertex = new THREE.Vector3();\r\n          vertex.x = srcVertices[v] * scale;\r\n          vertex.y = srcVertices[v + 1] * scale;\r\n          vertex.z = srcVertices[v + 2] * scale;\r\n\r\n          dstVertices.push(vertex);\r\n\r\n        }\r\n\r\n      }\r\n\r\n    }\r\n\r\n    if (json.morphColors !== undefined) {\r\n\r\n      var i, l, c, cl, dstColors, srcColors, color;\r\n\r\n      for (i = 0, l = json.morphColors.length; i < l; i++) {\r\n\r\n        geometry.morphColors[i] = {};\r\n        geometry.morphColors[i].name = json.morphColors[i].name;\r\n        geometry.morphColors[i].colors = [];\r\n\r\n        dstColors = geometry.morphColors[i].colors;\r\n        srcColors = json.morphColors[i].colors;\r\n\r\n        for (c = 0, cl = srcColors.length; c < cl; c += 3) {\r\n\r\n          color = new THREE.Color(0xffaa00);\r\n          color.setRGB(srcColors[c], srcColors[c + 1], srcColors[c + 2]);\r\n          dstColors.push(color);\r\n\r\n        }\r\n\r\n      }\r\n\r\n    }\r\n\r\n  };\r\n\r\n  if (json.materials === undefined || json.materials.length === 0) {\r\n\r\n    return {\r\n      geometry: geometry\r\n    };\r\n\r\n  }\r\n  else {\r\n\r\n    var materials = this.initMaterials(json.materials, texturePath);\r\n\r\n    if (this.needsTangents(materials)) {\r\n\r\n      geometry.computeTangents();\r\n\r\n    }\r\n\r\n    return {\r\n      geometry: geometry,\r\n      materials: materials\r\n    };\r\n\r\n  }\r\n\r\n};\r\n\r\n// File:src/loaders/LoadingManager.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.LoadingManager = function(onLoad, onProgress, onError) {\r\n\r\n  var scope = this;\r\n\r\n  var loaded = 0,\r\n    total = 0;\r\n\r\n  this.onLoad = onLoad;\r\n  this.onProgress = onProgress;\r\n  this.onError = onError;\r\n\r\n  this.itemStart = function(url) {\r\n\r\n    total++;\r\n\r\n  };\r\n\r\n  this.itemEnd = function(url) {\r\n\r\n    loaded++;\r\n\r\n    if (scope.onProgress !== undefined) {\r\n\r\n      scope.onProgress(url, loaded, total);\r\n\r\n    }\r\n\r\n    if (loaded === total && scope.onLoad !== undefined) {\r\n\r\n      scope.onLoad();\r\n\r\n    }\r\n\r\n  };\r\n\r\n};\r\n\r\nTHREE.DefaultLoadingManager = new THREE.LoadingManager();\r\n\r\n// File:src/loaders/BufferGeometryLoader.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.BufferGeometryLoader = function(manager) {\r\n\r\n  this.manager = (manager !== undefined) ? manager : THREE.DefaultLoadingManager;\r\n\r\n};\r\n\r\nTHREE.BufferGeometryLoader.prototype = {\r\n\r\n  constructor: THREE.BufferGeometryLoader,\r\n\r\n  load: function(url, onLoad, onProgress, onError) {\r\n\r\n    var scope = this;\r\n\r\n    var loader = new THREE.XHRLoader(scope.manager);\r\n    loader.setCrossOrigin(this.crossOrigin);\r\n    loader.load(url, function(text) {\r\n\r\n      onLoad(scope.parse(JSON.parse(text)));\r\n\r\n    }, onProgress, onError);\r\n\r\n  },\r\n\r\n  setCrossOrigin: function(value) {\r\n\r\n    this.crossOrigin = value;\r\n\r\n  },\r\n\r\n  parse: function(json) {\r\n\r\n    var geometry = new THREE.BufferGeometry();\r\n\r\n    var attributes = json.data.attributes;\r\n\r\n    for (var key in attributes) {\r\n\r\n      var attribute = attributes[key];\r\n      var typedArray = new self[attribute.type](attribute.array);\r\n\r\n      geometry.addAttribute(key, new THREE.BufferAttribute(typedArray, attribute.itemSize));\r\n\r\n    }\r\n\r\n    var offsets = json.data.offsets;\r\n\r\n    if (offsets !== undefined) {\r\n\r\n      geometry.offsets = JSON.parse(JSON.stringify(offsets));\r\n\r\n    }\r\n\r\n    var boundingSphere = json.data.boundingSphere;\r\n\r\n    if (boundingSphere !== undefined) {\r\n\r\n      var center = new THREE.Vector3();\r\n\r\n      if (boundingSphere.center !== undefined) {\r\n\r\n        center.fromArray(boundingSphere.center);\r\n\r\n      }\r\n\r\n      geometry.boundingSphere = new THREE.Sphere(center, boundingSphere.radius);\r\n\r\n    }\r\n\r\n    return geometry;\r\n\r\n  }\r\n\r\n};\r\n\r\n// File:src/loaders/MaterialLoader.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.MaterialLoader = function(manager) {\r\n\r\n  this.manager = (manager !== undefined) ? manager : THREE.DefaultLoadingManager;\r\n\r\n};\r\n\r\nTHREE.MaterialLoader.prototype = {\r\n\r\n  constructor: THREE.MaterialLoader,\r\n\r\n  load: function(url, onLoad, onProgress, onError) {\r\n\r\n    var scope = this;\r\n\r\n    var loader = new THREE.XHRLoader(scope.manager);\r\n    loader.setCrossOrigin(this.crossOrigin);\r\n    loader.load(url, function(text) {\r\n\r\n      onLoad(scope.parse(JSON.parse(text)));\r\n\r\n    }, onProgress, onError);\r\n\r\n  },\r\n\r\n  setCrossOrigin: function(value) {\r\n\r\n    this.crossOrigin = value;\r\n\r\n  },\r\n\r\n  parse: function(json) {\r\n\r\n    var material = new THREE[json.type];\r\n\r\n    if (json.color !== undefined) material.color.setHex(json.color);\r\n    if (json.emissive !== undefined) material.emissive.setHex(json.emissive);\r\n    if (json.specular !== undefined) material.specular.setHex(json.specular);\r\n    if (json.shininess !== undefined) material.shininess = json.shininess;\r\n    if (json.uniforms !== undefined) material.uniforms = json.uniforms;\r\n    if (json.vertexShader !== undefined) material.vertexShader = json.vertexShader;\r\n    if (json.fragmentShader !== undefined) material.fragmentShader = json.fragmentShader;\r\n    if (json.vertexColors !== undefined) material.vertexColors = json.vertexColors;\r\n    if (json.shading !== undefined) material.shading = json.shading;\r\n    if (json.blending !== undefined) material.blending = json.blending;\r\n    if (json.side !== undefined) material.side = json.side;\r\n    if (json.opacity !== undefined) material.opacity = json.opacity;\r\n    if (json.transparent !== undefined) material.transparent = json.transparent;\r\n    if (json.wireframe !== undefined) material.wireframe = json.wireframe;\r\n\r\n    // for PointCloudMaterial\r\n    if (json.size !== undefined) material.size = json.size;\r\n    if (json.sizeAttenuation !== undefined) material.sizeAttenuation = json.sizeAttenuation;\r\n\r\n    if (json.materials !== undefined) {\r\n\r\n      for (var i = 0, l = json.materials.length; i < l; i++) {\r\n\r\n        material.materials.push(this.parse(json.materials[i]));\r\n\r\n      }\r\n\r\n    }\r\n\r\n    return material;\r\n\r\n  }\r\n\r\n};\r\n\r\n// File:src/loaders/ObjectLoader.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.ObjectLoader = function(manager) {\r\n\r\n  this.manager = (manager !== undefined) ? manager : THREE.DefaultLoadingManager;\r\n  this.texturePath = '';\r\n\r\n};\r\n\r\nTHREE.ObjectLoader.prototype = {\r\n\r\n  constructor: THREE.ObjectLoader,\r\n\r\n  load: function(url, onLoad, onProgress, onError) {\r\n\r\n    if (this.texturePath === '') {\r\n\r\n      this.texturePath = url.substring(0, url.lastIndexOf('/') + 1);\r\n\r\n    }\r\n\r\n    var scope = this;\r\n\r\n    var loader = new THREE.XHRLoader(scope.manager);\r\n    loader.setCrossOrigin(this.crossOrigin);\r\n    loader.load(url, function(text) {\r\n\r\n      scope.parse(JSON.parse(text), onLoad);\r\n\r\n    }, onProgress, onError);\r\n\r\n  },\r\n\r\n  setTexturePath: function(value) {\r\n\r\n    this.texturePath = value;\r\n\r\n  },\r\n\r\n  setCrossOrigin: function(value) {\r\n\r\n    this.crossOrigin = value;\r\n\r\n  },\r\n\r\n  parse: function(json, onLoad) {\r\n\r\n    var geometries = this.parseGeometries(json.geometries);\r\n\r\n    var images = this.parseImages(json.images, function() {\r\n\r\n      if (onLoad !== undefined) onLoad(object);\r\n\r\n    });\r\n    var textures = this.parseTextures(json.textures, images);\r\n    var materials = this.parseMaterials(json.materials, textures);\r\n    var object = this.parseObject(json.object, geometries, materials);\r\n\r\n    if (json.images === undefined || json.images.length === 0) {\r\n\r\n      if (onLoad !== undefined) onLoad(object);\r\n\r\n    }\r\n\r\n    return object;\r\n\r\n  },\r\n\r\n  parseGeometries: function(json) {\r\n\r\n    var geometries = {};\r\n\r\n    if (json !== undefined) {\r\n\r\n      var geometryLoader = new THREE.JSONLoader();\r\n      var bufferGeometryLoader = new THREE.BufferGeometryLoader();\r\n\r\n      for (var i = 0, l = json.length; i < l; i++) {\r\n\r\n        var geometry;\r\n        var data = json[i];\r\n\r\n        switch (data.type) {\r\n\r\n          case 'PlaneGeometry':\r\n          case 'PlaneBufferGeometry':\r\n\r\n            geometry = new THREE[data.type](\r\n              data.width,\r\n              data.height,\r\n              data.widthSegments,\r\n              data.heightSegments\r\n            );\r\n\r\n            break;\r\n\r\n          case 'BoxGeometry':\r\n          case 'CubeGeometry': // backwards compatible\r\n\r\n            geometry = new THREE.BoxGeometry(\r\n              data.width,\r\n              data.height,\r\n              data.depth,\r\n              data.widthSegments,\r\n              data.heightSegments,\r\n              data.depthSegments\r\n            );\r\n\r\n            break;\r\n\r\n          case 'CircleGeometry':\r\n\r\n            geometry = new THREE.CircleGeometry(\r\n              data.radius,\r\n              data.segments\r\n            );\r\n\r\n            break;\r\n\r\n          case 'CylinderGeometry':\r\n\r\n            geometry = new THREE.CylinderGeometry(\r\n              data.radiusTop,\r\n              data.radiusBottom,\r\n              data.height,\r\n              data.radialSegments,\r\n              data.heightSegments,\r\n              data.openEnded\r\n            );\r\n\r\n            break;\r\n\r\n          case 'SphereGeometry':\r\n\r\n            geometry = new THREE.SphereGeometry(\r\n              data.radius,\r\n              data.widthSegments,\r\n              data.heightSegments,\r\n              data.phiStart,\r\n              data.phiLength,\r\n              data.thetaStart,\r\n              data.thetaLength\r\n            );\r\n\r\n            break;\r\n\r\n          case 'IcosahedronGeometry':\r\n\r\n            geometry = new THREE.IcosahedronGeometry(\r\n              data.radius,\r\n              data.detail\r\n            );\r\n\r\n            break;\r\n\r\n          case 'TorusGeometry':\r\n\r\n            geometry = new THREE.TorusGeometry(\r\n              data.radius,\r\n              data.tube,\r\n              data.radialSegments,\r\n              data.tubularSegments,\r\n              data.arc\r\n            );\r\n\r\n            break;\r\n\r\n          case 'TorusKnotGeometry':\r\n\r\n            geometry = new THREE.TorusKnotGeometry(\r\n              data.radius,\r\n              data.tube,\r\n              data.radialSegments,\r\n              data.tubularSegments,\r\n              data.p,\r\n              data.q,\r\n              data.heightScale\r\n            );\r\n\r\n            break;\r\n\r\n          case 'BufferGeometry':\r\n\r\n            geometry = bufferGeometryLoader.parse(data);\r\n\r\n            break;\r\n\r\n          case 'Geometry':\r\n\r\n            geometry = geometryLoader.parse(data.data).geometry;\r\n\r\n            break;\r\n\r\n        }\r\n\r\n        geometry.uuid = data.uuid;\r\n\r\n        if (data.name !== undefined) geometry.name = data.name;\r\n\r\n        geometries[data.uuid] = geometry;\r\n\r\n      }\r\n\r\n    }\r\n\r\n    return geometries;\r\n\r\n  },\r\n\r\n  parseMaterials: function(json, textures) {\r\n\r\n    var materials = {};\r\n\r\n    if (json !== undefined) {\r\n\r\n      var getTexture = function(name) {\r\n\r\n        if (textures[name] === undefined) {\r\n\r\n          THREE.warn('THREE.ObjectLoader: Undefined texture', name);\r\n\r\n        }\r\n\r\n        return textures[name];\r\n\r\n      };\r\n\r\n      var loader = new THREE.MaterialLoader();\r\n\r\n      for (var i = 0, l = json.length; i < l; i++) {\r\n\r\n        var data = json[i];\r\n        var material = loader.parse(data);\r\n\r\n        material.uuid = data.uuid;\r\n\r\n        if (data.name !== undefined) material.name = data.name;\r\n\r\n        if (data.map !== undefined) {\r\n\r\n          material.map = getTexture(data.map);\r\n\r\n        }\r\n\r\n        if (data.bumpMap !== undefined) {\r\n\r\n          material.bumpMap = getTexture(data.bumpMap);\r\n          if (data.bumpScale) {\r\n            material.bumpScale = new THREE.Vector2(data.bumpScale, data.bumpScale);\r\n          }\r\n\r\n        }\r\n\r\n        if (data.alphaMap !== undefined) {\r\n\r\n          material.alphaMap = getTexture(data.alphaMap);\r\n\r\n        }\r\n\r\n        if (data.envMap !== undefined) {\r\n\r\n          material.envMap = getTexture(data.envMap);\r\n\r\n        }\r\n\r\n        if (data.normalMap !== undefined) {\r\n\r\n          material.normalMap = getTexture(data.normalMap);\r\n          if (data.normalScale) {\r\n            material.normalScale = new THREE.Vector2(data.normalScale, data.normalScale);\r\n          }\r\n\r\n        }\r\n\r\n        if (data.lightMap !== undefined) {\r\n\r\n          material.lightMap = getTexture(data.lightMap);\r\n\r\n        }\r\n\r\n        if (data.specularMap !== undefined) {\r\n\r\n          material.specularMap = getTexture(data.specularMap);\r\n\r\n        }\r\n\r\n        materials[data.uuid] = material;\r\n\r\n      }\r\n\r\n    }\r\n\r\n    return materials;\r\n\r\n  },\r\n\r\n  parseImages: function(json, onLoad) {\r\n\r\n    var scope = this;\r\n    var images = {};\r\n\r\n    if (json !== undefined && json.length > 0) {\r\n\r\n      var manager = new THREE.LoadingManager(onLoad);\r\n\r\n      var loader = new THREE.ImageLoader(manager);\r\n      loader.setCrossOrigin(this.crossOrigin);\r\n\r\n      var loadImage = function(url) {\r\n\r\n        scope.manager.itemStart(url);\r\n\r\n        return loader.load(url, function() {\r\n\r\n          scope.manager.itemEnd(url);\r\n\r\n        });\r\n\r\n      };\r\n\r\n      for (var i = 0, l = json.length; i < l; i++) {\r\n\r\n        var image = json[i];\r\n        var path = /^(\\/\\/)|([a-z]+:(\\/\\/)?)/i.test(image.url) ? image.url : scope.texturePath + image.url;\r\n\r\n        images[image.uuid] = loadImage(path);\r\n\r\n      }\r\n\r\n    }\r\n\r\n    return images;\r\n\r\n  },\r\n\r\n  parseTextures: function(json, images) {\r\n\r\n    var textures = {};\r\n\r\n    if (json !== undefined) {\r\n\r\n      for (var i = 0, l = json.length; i < l; i++) {\r\n\r\n        var data = json[i];\r\n\r\n        if (data.image === undefined) {\r\n\r\n          THREE.warn('THREE.ObjectLoader: No \"image\" speficied for', data.uuid);\r\n\r\n        }\r\n\r\n        if (images[data.image] === undefined) {\r\n\r\n          THREE.warn('THREE.ObjectLoader: Undefined image', data.image);\r\n\r\n        }\r\n\r\n        var texture = new THREE.Texture(images[data.image]);\r\n        texture.needsUpdate = true;\r\n\r\n        texture.uuid = data.uuid;\r\n\r\n        if (data.name !== undefined) texture.name = data.name;\r\n        if (data.repeat !== undefined) texture.repeat = new THREE.Vector2(data.repeat[0], data.repeat[1]);\r\n        if (data.minFilter !== undefined) texture.minFilter = THREE[data.minFilter];\r\n        if (data.magFilter !== undefined) texture.magFilter = THREE[data.magFilter];\r\n        if (data.anisotropy !== undefined) texture.anisotropy = data.anisotropy;\r\n        if (data.wrap instanceof Array) {\r\n\r\n          texture.wrapS = THREE[data.wrap[0]];\r\n          texture.wrapT = THREE[data.wrap[1]];\r\n\r\n        }\r\n\r\n        textures[data.uuid] = texture;\r\n\r\n      }\r\n\r\n    }\r\n\r\n    return textures;\r\n\r\n  },\r\n\r\n  parseObject: function() {\r\n\r\n    var matrix = new THREE.Matrix4();\r\n\r\n    return function(data, geometries, materials) {\r\n\r\n      var object;\r\n\r\n      var getGeometry = function(name) {\r\n\r\n        if (geometries[name] === undefined) {\r\n\r\n          THREE.warn('THREE.ObjectLoader: Undefined geometry', name);\r\n\r\n        }\r\n\r\n        return geometries[name];\r\n\r\n      };\r\n\r\n      var getMaterial = function(name) {\r\n\r\n        if (materials[name] === undefined) {\r\n\r\n          THREE.warn('THREE.ObjectLoader: Undefined material', name);\r\n\r\n        }\r\n\r\n        return materials[name];\r\n\r\n      };\r\n\r\n      switch (data.type) {\r\n\r\n        case 'Scene':\r\n\r\n          object = new THREE.Scene();\r\n\r\n          break;\r\n\r\n        case 'PerspectiveCamera':\r\n\r\n          object = new THREE.PerspectiveCamera(data.fov, data.aspect, data.near, data.far);\r\n\r\n          break;\r\n\r\n        case 'OrthographicCamera':\r\n\r\n          object = new THREE.OrthographicCamera(data.left, data.right, data.top, data.bottom, data.near, data.far);\r\n\r\n          break;\r\n\r\n        case 'AmbientLight':\r\n\r\n          object = new THREE.AmbientLight(data.color);\r\n\r\n          break;\r\n\r\n        case 'DirectionalLight':\r\n\r\n          object = new THREE.DirectionalLight(data.color, data.intensity);\r\n\r\n          break;\r\n\r\n        case 'PointLight':\r\n\r\n          object = new THREE.PointLight(data.color, data.intensity, data.distance, data.decay);\r\n\r\n          break;\r\n\r\n        case 'SpotLight':\r\n\r\n          object = new THREE.SpotLight(data.color, data.intensity, data.distance, data.angle, data.exponent, data.decay);\r\n\r\n          break;\r\n\r\n        case 'HemisphereLight':\r\n\r\n          object = new THREE.HemisphereLight(data.color, data.groundColor, data.intensity);\r\n\r\n          break;\r\n\r\n        case 'Mesh':\r\n\r\n          object = new THREE.Mesh(getGeometry(data.geometry), getMaterial(data.material));\r\n\r\n          break;\r\n\r\n        case 'Line':\r\n\r\n          object = new THREE.Line(getGeometry(data.geometry), getMaterial(data.material), data.mode);\r\n\r\n          break;\r\n\r\n        case 'PointCloud':\r\n\r\n          object = new THREE.PointCloud(getGeometry(data.geometry), getMaterial(data.material));\r\n\r\n          break;\r\n\r\n        case 'Sprite':\r\n\r\n          object = new THREE.Sprite(getMaterial(data.material));\r\n\r\n          break;\r\n\r\n        case 'Group':\r\n\r\n          object = new THREE.Group();\r\n\r\n          break;\r\n\r\n        default:\r\n\r\n          object = new THREE.Object3D();\r\n\r\n      }\r\n\r\n      object.uuid = data.uuid;\r\n\r\n      if (data.name !== undefined) object.name = data.name;\r\n      if (data.matrix !== undefined) {\r\n\r\n        matrix.fromArray(data.matrix);\r\n        matrix.decompose(object.position, object.quaternion, object.scale);\r\n\r\n      }\r\n      else {\r\n\r\n        if (data.position !== undefined) object.position.fromArray(data.position);\r\n        if (data.rotation !== undefined) object.rotation.fromArray(data.rotation);\r\n        if (data.scale !== undefined) object.scale.fromArray(data.scale);\r\n\r\n      }\r\n\r\n      if (data.visible !== undefined) object.visible = data.visible;\r\n      if (data.userData !== undefined) object.userData = data.userData;\r\n\r\n      if (data.children !== undefined) {\r\n\r\n        for (var child in data.children) {\r\n\r\n          object.add(this.parseObject(data.children[child], geometries, materials));\r\n\r\n        }\r\n\r\n      }\r\n\r\n      return object;\r\n\r\n    }\r\n\r\n  }()\r\n\r\n};\r\n\r\n// File:src/loaders/TextureLoader.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.TextureLoader = function(manager) {\r\n\r\n  this.manager = (manager !== undefined) ? manager : THREE.DefaultLoadingManager;\r\n\r\n};\r\n\r\nTHREE.TextureLoader.prototype = {\r\n\r\n  constructor: THREE.TextureLoader,\r\n\r\n  load: function(url, onLoad, onProgress, onError) {\r\n\r\n    var scope = this;\r\n\r\n    var loader = new THREE.ImageLoader(scope.manager);\r\n    loader.setCrossOrigin(this.crossOrigin);\r\n    loader.load(url, function(image) {\r\n\r\n      var texture = new THREE.Texture(image);\r\n      texture.needsUpdate = true;\r\n\r\n      if (onLoad !== undefined) {\r\n\r\n        onLoad(texture);\r\n\r\n      }\r\n\r\n    }, onProgress, onError);\r\n\r\n  },\r\n\r\n  setCrossOrigin: function(value) {\r\n\r\n    this.crossOrigin = value;\r\n\r\n  }\r\n\r\n};\r\n\r\n// File:src/loaders/BinaryTextureLoader.js\r\n\r\n/**\r\n * @author Nikos M. / https://github.com/foo123/\r\n *\r\n * Abstract Base class to load generic binary textures formats (rgbe, hdr, ...)\r\n */\r\n\r\nTHREE.DataTextureLoader = THREE.BinaryTextureLoader = function() {\r\n\r\n  // override in sub classes\r\n  this._parser = null;\r\n\r\n};\r\n\r\nTHREE.BinaryTextureLoader.prototype = {\r\n\r\n  constructor: THREE.BinaryTextureLoader,\r\n\r\n  load: function(url, onLoad, onProgress, onError) {\r\n\r\n    var scope = this;\r\n\r\n    var texture = new THREE.DataTexture();\r\n\r\n    var loader = new THREE.XHRLoader();\r\n    loader.setResponseType('arraybuffer');\r\n\r\n    loader.load(url, function(buffer) {\r\n\r\n      var texData = scope._parser(buffer);\r\n\r\n      if (!texData) return;\r\n\r\n      if (undefined !== texData.image) {\r\n\r\n        texture.image = texData.image;\r\n\r\n      }\r\n      else if (undefined !== texData.data) {\r\n\r\n        texture.image.width = texData.width;\r\n        texture.image.height = texData.height;\r\n        texture.image.data = texData.data;\r\n\r\n      }\r\n\r\n      texture.wrapS = undefined !== texData.wrapS ? texData.wrapS : THREE.ClampToEdgeWrapping;\r\n      texture.wrapT = undefined !== texData.wrapT ? texData.wrapT : THREE.ClampToEdgeWrapping;\r\n\r\n      texture.magFilter = undefined !== texData.magFilter ? texData.magFilter : THREE.LinearFilter;\r\n      texture.minFilter = undefined !== texData.minFilter ? texData.minFilter : THREE.LinearMipMapLinearFilter;\r\n\r\n      texture.anisotropy = undefined !== texData.anisotropy ? texData.anisotropy : 1;\r\n\r\n      if (undefined !== texData.format) {\r\n\r\n        texture.format = texData.format;\r\n\r\n      }\r\n      if (undefined !== texData.type) {\r\n\r\n        texture.type = texData.type;\r\n\r\n      }\r\n\r\n      if (undefined !== texData.mipmaps) {\r\n\r\n        texture.mipmaps = texData.mipmaps;\r\n\r\n      }\r\n\r\n      if (1 === texData.mipmapCount) {\r\n\r\n        texture.minFilter = THREE.LinearFilter;\r\n\r\n      }\r\n\r\n      texture.needsUpdate = true;\r\n\r\n      if (onLoad) onLoad(texture, texData);\r\n\r\n    }, onProgress, onError);\r\n\r\n\r\n    return texture;\r\n\r\n  }\r\n\r\n};\r\n\r\n// File:src/loaders/CompressedTextureLoader.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n *\r\n * Abstract Base class to block based textures loader (dds, pvr, ...)\r\n */\r\n\r\nTHREE.CompressedTextureLoader = function() {\r\n\r\n  // override in sub classes\r\n  this._parser = null;\r\n\r\n};\r\n\r\n\r\nTHREE.CompressedTextureLoader.prototype = {\r\n\r\n  constructor: THREE.CompressedTextureLoader,\r\n\r\n  load: function(url, onLoad, onError) {\r\n\r\n    var scope = this;\r\n\r\n    var images = [];\r\n\r\n    var texture = new THREE.CompressedTexture();\r\n    texture.image = images;\r\n\r\n    var loader = new THREE.XHRLoader();\r\n    loader.setResponseType('arraybuffer');\r\n\r\n    if (url instanceof Array) {\r\n\r\n      var loaded = 0;\r\n\r\n      var loadTexture = function(i) {\r\n\r\n        loader.load(url[i], function(buffer) {\r\n\r\n          var texDatas = scope._parser(buffer, true);\r\n\r\n          images[i] = {\r\n            width: texDatas.width,\r\n            height: texDatas.height,\r\n            format: texDatas.format,\r\n            mipmaps: texDatas.mipmaps\r\n          };\r\n\r\n          loaded += 1;\r\n\r\n          if (loaded === 6) {\r\n\r\n            if (texDatas.mipmapCount == 1)\r\n              texture.minFilter = THREE.LinearFilter;\r\n\r\n            texture.format = texDatas.format;\r\n            texture.needsUpdate = true;\r\n\r\n            if (onLoad) onLoad(texture);\r\n\r\n          }\r\n\r\n        });\r\n\r\n      };\r\n\r\n      for (var i = 0, il = url.length; i < il; ++i) {\r\n\r\n        loadTexture(i);\r\n\r\n      }\r\n\r\n    }\r\n    else {\r\n\r\n      // compressed cubemap texture stored in a single DDS file\r\n\r\n      loader.load(url, function(buffer) {\r\n\r\n        var texDatas = scope._parser(buffer, true);\r\n\r\n        if (texDatas.isCubemap) {\r\n\r\n          var faces = texDatas.mipmaps.length / texDatas.mipmapCount;\r\n\r\n          for (var f = 0; f < faces; f++) {\r\n\r\n            images[f] = {\r\n              mipmaps: []\r\n            };\r\n\r\n            for (var i = 0; i < texDatas.mipmapCount; i++) {\r\n\r\n              images[f].mipmaps.push(texDatas.mipmaps[f * texDatas.mipmapCount + i]);\r\n              images[f].format = texDatas.format;\r\n              images[f].width = texDatas.width;\r\n              images[f].height = texDatas.height;\r\n\r\n            }\r\n\r\n          }\r\n\r\n        }\r\n        else {\r\n\r\n          texture.image.width = texDatas.width;\r\n          texture.image.height = texDatas.height;\r\n          texture.mipmaps = texDatas.mipmaps;\r\n\r\n        }\r\n\r\n        if (texDatas.mipmapCount === 1) {\r\n\r\n          texture.minFilter = THREE.LinearFilter;\r\n\r\n        }\r\n\r\n        texture.format = texDatas.format;\r\n        texture.needsUpdate = true;\r\n\r\n        if (onLoad) onLoad(texture);\r\n\r\n      });\r\n\r\n    }\r\n\r\n    return texture;\r\n\r\n  }\r\n\r\n};\r\n\r\n// File:src/materials/Material.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author alteredq / http://alteredqualia.com/\r\n */\r\n\r\nTHREE.Material = function() {\r\n\r\n  Object.defineProperty(this, 'id', {\r\n    value: THREE.MaterialIdCount++\r\n  });\r\n\r\n  this.uuid = THREE.Math.generateUUID();\r\n\r\n  this.name = '';\r\n  this.type = 'Material';\r\n\r\n  this.side = THREE.FrontSide;\r\n\r\n  this.opacity = 1;\r\n  this.transparent = false;\r\n\r\n  this.blending = THREE.NormalBlending;\r\n\r\n  this.blendSrc = THREE.SrcAlphaFactor;\r\n  this.blendDst = THREE.OneMinusSrcAlphaFactor;\r\n  this.blendEquation = THREE.AddEquation;\r\n  this.blendSrcAlpha = null;\r\n  this.blendDstAlpha = null;\r\n  this.blendEquationAlpha = null;\r\n\r\n  this.depthTest = true;\r\n  this.depthWrite = true;\r\n\r\n  this.colorWrite = true;\r\n\r\n  this.polygonOffset = false;\r\n  this.polygonOffsetFactor = 0;\r\n  this.polygonOffsetUnits = 0;\r\n\r\n  this.alphaTest = 0;\r\n\r\n  this.overdraw = 0; // Overdrawn pixels (typically between 0 and 1) for fixing antialiasing gaps in CanvasRenderer\r\n\r\n  this.visible = true;\r\n\r\n  this._needsUpdate = true;\r\n\r\n};\r\n\r\nTHREE.Material.prototype = {\r\n\r\n  constructor: THREE.Material,\r\n\r\n  get needsUpdate() {\r\n\r\n    return this._needsUpdate;\r\n\r\n  },\r\n\r\n  set needsUpdate(value) {\r\n\r\n    if (value === true) this.update();\r\n\r\n    this._needsUpdate = value;\r\n\r\n  },\r\n\r\n  setValues: function(values) {\r\n\r\n    if (values === undefined) return;\r\n\r\n    for (var key in values) {\r\n\r\n      var newValue = values[key];\r\n\r\n      if (newValue === undefined) {\r\n\r\n        THREE.warn(\"THREE.Material: '\" + key + \"' parameter is undefined.\");\r\n        continue;\r\n\r\n      }\r\n\r\n      if (key in this) {\r\n\r\n        var currentValue = this[key];\r\n\r\n        if (currentValue instanceof THREE.Color) {\r\n\r\n          currentValue.set(newValue);\r\n\r\n        }\r\n        else if (currentValue instanceof THREE.Vector3 && newValue instanceof THREE.Vector3) {\r\n\r\n          currentValue.copy(newValue);\r\n\r\n        }\r\n        else if (key == 'overdraw') {\r\n\r\n          // ensure overdraw is backwards-compatable with legacy boolean type\r\n          this[key] = Number(newValue);\r\n\r\n        }\r\n        else {\r\n\r\n          this[key] = newValue;\r\n\r\n        }\r\n\r\n      }\r\n\r\n    }\r\n\r\n  },\r\n\r\n  toJSON: function() {\r\n\r\n    var output = {\r\n      metadata: {\r\n        version: 4.2,\r\n        type: 'material',\r\n        generator: 'MaterialExporter'\r\n      },\r\n      uuid: this.uuid,\r\n      type: this.type\r\n    };\r\n\r\n    if (this.name !== \"\") output.name = this.name;\r\n\r\n    if (this instanceof THREE.MeshBasicMaterial) {\r\n\r\n      output.color = this.color.getHex();\r\n      if (this.vertexColors !== THREE.NoColors) output.vertexColors = this.vertexColors;\r\n      if (this.blending !== THREE.NormalBlending) output.blending = this.blending;\r\n      if (this.side !== THREE.FrontSide) output.side = this.side;\r\n\r\n    }\r\n    else if (this instanceof THREE.MeshLambertMaterial) {\r\n\r\n      output.color = this.color.getHex();\r\n      output.emissive = this.emissive.getHex();\r\n      if (this.vertexColors !== THREE.NoColors) output.vertexColors = this.vertexColors;\r\n      if (this.shading !== THREE.SmoothShading) output.shading = this.shading;\r\n      if (this.blending !== THREE.NormalBlending) output.blending = this.blending;\r\n      if (this.side !== THREE.FrontSide) output.side = this.side;\r\n\r\n    }\r\n    else if (this instanceof THREE.MeshPhongMaterial) {\r\n\r\n      output.color = this.color.getHex();\r\n      output.emissive = this.emissive.getHex();\r\n      output.specular = this.specular.getHex();\r\n      output.shininess = this.shininess;\r\n      if (this.vertexColors !== THREE.NoColors) output.vertexColors = this.vertexColors;\r\n      if (this.shading !== THREE.SmoothShading) output.shading = this.shading;\r\n      if (this.blending !== THREE.NormalBlending) output.blending = this.blending;\r\n      if (this.side !== THREE.FrontSide) output.side = this.side;\r\n\r\n    }\r\n    else if (this instanceof THREE.MeshNormalMaterial) {\r\n\r\n      if (this.blending !== THREE.NormalBlending) output.blending = this.blending;\r\n      if (this.side !== THREE.FrontSide) output.side = this.side;\r\n\r\n    }\r\n    else if (this instanceof THREE.MeshDepthMaterial) {\r\n\r\n      if (this.blending !== THREE.NormalBlending) output.blending = this.blending;\r\n      if (this.side !== THREE.FrontSide) output.side = this.side;\r\n\r\n    }\r\n    else if (this instanceof THREE.PointCloudMaterial) {\r\n\r\n      output.size = this.size;\r\n      output.sizeAttenuation = this.sizeAttenuation;\r\n      output.color = this.color.getHex();\r\n\r\n      if (this.vertexColors !== THREE.NoColors) output.vertexColors = this.vertexColors;\r\n      if (this.blending !== THREE.NormalBlending) output.blending = this.blending;\r\n\r\n    }\r\n    else if (this instanceof THREE.ShaderMaterial) {\r\n\r\n      output.uniforms = this.uniforms;\r\n      output.vertexShader = this.vertexShader;\r\n      output.fragmentShader = this.fragmentShader;\r\n\r\n    }\r\n    else if (this instanceof THREE.SpriteMaterial) {\r\n\r\n      output.color = this.color.getHex();\r\n\r\n    }\r\n\r\n    if (this.opacity < 1) output.opacity = this.opacity;\r\n    if (this.transparent !== false) output.transparent = this.transparent;\r\n    if (this.wireframe !== false) output.wireframe = this.wireframe;\r\n\r\n    return output;\r\n\r\n  },\r\n\r\n  clone: function(material) {\r\n\r\n    if (material === undefined) material = new THREE.Material();\r\n\r\n    material.name = this.name;\r\n\r\n    material.side = this.side;\r\n\r\n    material.opacity = this.opacity;\r\n    material.transparent = this.transparent;\r\n\r\n    material.blending = this.blending;\r\n\r\n    material.blendSrc = this.blendSrc;\r\n    material.blendDst = this.blendDst;\r\n    material.blendEquation = this.blendEquation;\r\n    material.blendSrcAlpha = this.blendSrcAlpha;\r\n    material.blendDstAlpha = this.blendDstAlpha;\r\n    material.blendEquationAlpha = this.blendEquationAlpha;\r\n\r\n    material.depthTest = this.depthTest;\r\n    material.depthWrite = this.depthWrite;\r\n\r\n    material.polygonOffset = this.polygonOffset;\r\n    material.polygonOffsetFactor = this.polygonOffsetFactor;\r\n    material.polygonOffsetUnits = this.polygonOffsetUnits;\r\n\r\n    material.alphaTest = this.alphaTest;\r\n\r\n    material.overdraw = this.overdraw;\r\n\r\n    material.visible = this.visible;\r\n\r\n    return material;\r\n\r\n  },\r\n\r\n  update: function() {\r\n\r\n    this.dispatchEvent({\r\n      type: 'update'\r\n    });\r\n\r\n  },\r\n\r\n  dispose: function() {\r\n\r\n    this.dispatchEvent({\r\n      type: 'dispose'\r\n    });\r\n\r\n  }\r\n\r\n};\r\n\r\nTHREE.EventDispatcher.prototype.apply(THREE.Material.prototype);\r\n\r\nTHREE.MaterialIdCount = 0;\r\n\r\n// File:src/materials/LineBasicMaterial.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author alteredq / http://alteredqualia.com/\r\n *\r\n * parameters = {\r\n *  color: <hex>,\r\n *  opacity: <float>,\r\n *\r\n *  blending: THREE.NormalBlending,\r\n *  depthTest: <bool>,\r\n *  depthWrite: <bool>,\r\n *\r\n *  linewidth: <float>,\r\n *  linecap: \"round\",\r\n *  linejoin: \"round\",\r\n *\r\n *  vertexColors: <bool>\r\n *\r\n *  fog: <bool>\r\n * }\r\n */\r\n\r\nTHREE.LineBasicMaterial = function(parameters) {\r\n\r\n  THREE.Material.call(this);\r\n\r\n  this.type = 'LineBasicMaterial';\r\n\r\n  this.color = new THREE.Color(0xffffff);\r\n\r\n  this.linewidth = 1;\r\n  this.linecap = 'round';\r\n  this.linejoin = 'round';\r\n\r\n  this.vertexColors = THREE.NoColors;\r\n\r\n  this.fog = true;\r\n\r\n  this.setValues(parameters);\r\n\r\n};\r\n\r\nTHREE.LineBasicMaterial.prototype = Object.create(THREE.Material.prototype);\r\nTHREE.LineBasicMaterial.prototype.constructor = THREE.LineBasicMaterial;\r\n\r\nTHREE.LineBasicMaterial.prototype.clone = function() {\r\n\r\n  var material = new THREE.LineBasicMaterial();\r\n\r\n  THREE.Material.prototype.clone.call(this, material);\r\n\r\n  material.color.copy(this.color);\r\n\r\n  material.linewidth = this.linewidth;\r\n  material.linecap = this.linecap;\r\n  material.linejoin = this.linejoin;\r\n\r\n  material.vertexColors = this.vertexColors;\r\n\r\n  material.fog = this.fog;\r\n\r\n  return material;\r\n\r\n};\r\n\r\n// File:src/materials/LineDashedMaterial.js\r\n\r\n/**\r\n * @author alteredq / http://alteredqualia.com/\r\n *\r\n * parameters = {\r\n *  color: <hex>,\r\n *  opacity: <float>,\r\n *\r\n *  blending: THREE.NormalBlending,\r\n *  depthTest: <bool>,\r\n *  depthWrite: <bool>,\r\n *\r\n *  linewidth: <float>,\r\n *\r\n *  scale: <float>,\r\n *  dashSize: <float>,\r\n *  gapSize: <float>,\r\n *\r\n *  vertexColors: <bool>\r\n *\r\n *  fog: <bool>\r\n * }\r\n */\r\n\r\nTHREE.LineDashedMaterial = function(parameters) {\r\n\r\n  THREE.Material.call(this);\r\n\r\n  this.type = 'LineDashedMaterial';\r\n\r\n  this.color = new THREE.Color(0xffffff);\r\n\r\n  this.linewidth = 1;\r\n\r\n  this.scale = 1;\r\n  this.dashSize = 3;\r\n  this.gapSize = 1;\r\n\r\n  this.vertexColors = false;\r\n\r\n  this.fog = true;\r\n\r\n  this.setValues(parameters);\r\n\r\n};\r\n\r\nTHREE.LineDashedMaterial.prototype = Object.create(THREE.Material.prototype);\r\nTHREE.LineDashedMaterial.prototype.constructor = THREE.LineDashedMaterial;\r\n\r\nTHREE.LineDashedMaterial.prototype.clone = function() {\r\n\r\n  var material = new THREE.LineDashedMaterial();\r\n\r\n  THREE.Material.prototype.clone.call(this, material);\r\n\r\n  material.color.copy(this.color);\r\n\r\n  material.linewidth = this.linewidth;\r\n\r\n  material.scale = this.scale;\r\n  material.dashSize = this.dashSize;\r\n  material.gapSize = this.gapSize;\r\n\r\n  material.vertexColors = this.vertexColors;\r\n\r\n  material.fog = this.fog;\r\n\r\n  return material;\r\n\r\n};\r\n\r\n// File:src/materials/MeshBasicMaterial.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author alteredq / http://alteredqualia.com/\r\n *\r\n * parameters = {\r\n *  color: <hex>,\r\n *  opacity: <float>,\r\n *  map: new THREE.Texture( <Image> ),\r\n *\r\n *  lightMap: new THREE.Texture( <Image> ),\r\n *\r\n *  specularMap: new THREE.Texture( <Image> ),\r\n *\r\n *  alphaMap: new THREE.Texture( <Image> ),\r\n *\r\n *  envMap: new THREE.TextureCube( [posx, negx, posy, negy, posz, negz] ),\r\n *  combine: THREE.Multiply,\r\n *  reflectivity: <float>,\r\n *  refractionRatio: <float>,\r\n *\r\n *  shading: THREE.SmoothShading,\r\n *  blending: THREE.NormalBlending,\r\n *  depthTest: <bool>,\r\n *  depthWrite: <bool>,\r\n *\r\n *  wireframe: <boolean>,\r\n *  wireframeLinewidth: <float>,\r\n *\r\n *  vertexColors: THREE.NoColors / THREE.VertexColors / THREE.FaceColors,\r\n *\r\n *  skinning: <bool>,\r\n *  morphTargets: <bool>,\r\n *\r\n *  fog: <bool>\r\n * }\r\n */\r\n\r\nTHREE.MeshBasicMaterial = function(parameters) {\r\n\r\n  THREE.Material.call(this);\r\n\r\n  this.type = 'MeshBasicMaterial';\r\n\r\n  this.color = new THREE.Color(0xffffff); // emissive\r\n\r\n  this.map = null;\r\n\r\n  this.lightMap = null;\r\n\r\n  this.specularMap = null;\r\n\r\n  this.alphaMap = null;\r\n\r\n  this.envMap = null;\r\n  this.combine = THREE.MultiplyOperation;\r\n  this.reflectivity = 1;\r\n  this.refractionRatio = 0.98;\r\n\r\n  this.fog = true;\r\n\r\n  this.shading = THREE.SmoothShading;\r\n\r\n  this.wireframe = false;\r\n  this.wireframeLinewidth = 1;\r\n  this.wireframeLinecap = 'round';\r\n  this.wireframeLinejoin = 'round';\r\n\r\n  this.vertexColors = THREE.NoColors;\r\n\r\n  this.skinning = false;\r\n  this.morphTargets = false;\r\n\r\n  this.setValues(parameters);\r\n\r\n};\r\n\r\nTHREE.MeshBasicMaterial.prototype = Object.create(THREE.Material.prototype);\r\nTHREE.MeshBasicMaterial.prototype.constructor = THREE.MeshBasicMaterial;\r\n\r\nTHREE.MeshBasicMaterial.prototype.clone = function() {\r\n\r\n  var material = new THREE.MeshBasicMaterial();\r\n\r\n  THREE.Material.prototype.clone.call(this, material);\r\n\r\n  material.color.copy(this.color);\r\n\r\n  material.map = this.map;\r\n\r\n  material.lightMap = this.lightMap;\r\n\r\n  material.specularMap = this.specularMap;\r\n\r\n  material.alphaMap = this.alphaMap;\r\n\r\n  material.envMap = this.envMap;\r\n  material.combine = this.combine;\r\n  material.reflectivity = this.reflectivity;\r\n  material.refractionRatio = this.refractionRatio;\r\n\r\n  material.fog = this.fog;\r\n\r\n  material.shading = this.shading;\r\n\r\n  material.wireframe = this.wireframe;\r\n  material.wireframeLinewidth = this.wireframeLinewidth;\r\n  material.wireframeLinecap = this.wireframeLinecap;\r\n  material.wireframeLinejoin = this.wireframeLinejoin;\r\n\r\n  material.vertexColors = this.vertexColors;\r\n\r\n  material.skinning = this.skinning;\r\n  material.morphTargets = this.morphTargets;\r\n\r\n  return material;\r\n\r\n};\r\n\r\n// File:src/materials/MeshLambertMaterial.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author alteredq / http://alteredqualia.com/\r\n *\r\n * parameters = {\r\n *  color: <hex>,\r\n *  emissive: <hex>,\r\n *  opacity: <float>,\r\n *\r\n *  map: new THREE.Texture( <Image> ),\r\n *\r\n *  lightMap: new THREE.Texture( <Image> ),\r\n *\r\n *  specularMap: new THREE.Texture( <Image> ),\r\n *\r\n *  alphaMap: new THREE.Texture( <Image> ),\r\n *\r\n *  envMap: new THREE.TextureCube( [posx, negx, posy, negy, posz, negz] ),\r\n *  combine: THREE.Multiply,\r\n *  reflectivity: <float>,\r\n *  refractionRatio: <float>,\r\n *\r\n *  shading: THREE.SmoothShading,\r\n *  blending: THREE.NormalBlending,\r\n *  depthTest: <bool>,\r\n *  depthWrite: <bool>,\r\n *\r\n *  wireframe: <boolean>,\r\n *  wireframeLinewidth: <float>,\r\n *\r\n *  vertexColors: THREE.NoColors / THREE.VertexColors / THREE.FaceColors,\r\n *\r\n *  skinning: <bool>,\r\n *  morphTargets: <bool>,\r\n *  morphNormals: <bool>,\r\n *\r\n *\tfog: <bool>\r\n * }\r\n */\r\n\r\nTHREE.MeshLambertMaterial = function(parameters) {\r\n\r\n  THREE.Material.call(this);\r\n\r\n  this.type = 'MeshLambertMaterial';\r\n\r\n  this.color = new THREE.Color(0xffffff); // diffuse\r\n  this.emissive = new THREE.Color(0x000000);\r\n\r\n  this.wrapAround = false;\r\n  this.wrapRGB = new THREE.Vector3(1, 1, 1);\r\n\r\n  this.map = null;\r\n\r\n  this.lightMap = null;\r\n\r\n  this.specularMap = null;\r\n\r\n  this.alphaMap = null;\r\n\r\n  this.envMap = null;\r\n  this.combine = THREE.MultiplyOperation;\r\n  this.reflectivity = 1;\r\n  this.refractionRatio = 0.98;\r\n\r\n  this.fog = true;\r\n\r\n  this.shading = THREE.SmoothShading;\r\n\r\n  this.wireframe = false;\r\n  this.wireframeLinewidth = 1;\r\n  this.wireframeLinecap = 'round';\r\n  this.wireframeLinejoin = 'round';\r\n\r\n  this.vertexColors = THREE.NoColors;\r\n\r\n  this.skinning = false;\r\n  this.morphTargets = false;\r\n  this.morphNormals = false;\r\n\r\n  this.setValues(parameters);\r\n\r\n};\r\n\r\nTHREE.MeshLambertMaterial.prototype = Object.create(THREE.Material.prototype);\r\nTHREE.MeshLambertMaterial.prototype.constructor = THREE.MeshLambertMaterial;\r\n\r\nTHREE.MeshLambertMaterial.prototype.clone = function() {\r\n\r\n  var material = new THREE.MeshLambertMaterial();\r\n\r\n  THREE.Material.prototype.clone.call(this, material);\r\n\r\n  material.color.copy(this.color);\r\n  material.emissive.copy(this.emissive);\r\n\r\n  material.wrapAround = this.wrapAround;\r\n  material.wrapRGB.copy(this.wrapRGB);\r\n\r\n  material.map = this.map;\r\n\r\n  material.lightMap = this.lightMap;\r\n\r\n  material.specularMap = this.specularMap;\r\n\r\n  material.alphaMap = this.alphaMap;\r\n\r\n  material.envMap = this.envMap;\r\n  material.combine = this.combine;\r\n  material.reflectivity = this.reflectivity;\r\n  material.refractionRatio = this.refractionRatio;\r\n\r\n  material.fog = this.fog;\r\n\r\n  material.shading = this.shading;\r\n\r\n  material.wireframe = this.wireframe;\r\n  material.wireframeLinewidth = this.wireframeLinewidth;\r\n  material.wireframeLinecap = this.wireframeLinecap;\r\n  material.wireframeLinejoin = this.wireframeLinejoin;\r\n\r\n  material.vertexColors = this.vertexColors;\r\n\r\n  material.skinning = this.skinning;\r\n  material.morphTargets = this.morphTargets;\r\n  material.morphNormals = this.morphNormals;\r\n\r\n  return material;\r\n\r\n};\r\n\r\n// File:src/materials/MeshPhongMaterial.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author alteredq / http://alteredqualia.com/\r\n *\r\n * parameters = {\r\n *  color: <hex>,\r\n *  emissive: <hex>,\r\n *  specular: <hex>,\r\n *  shininess: <float>,\r\n *  opacity: <float>,\r\n *\r\n *  map: new THREE.Texture( <Image> ),\r\n *\r\n *  lightMap: new THREE.Texture( <Image> ),\r\n *\r\n *  bumpMap: new THREE.Texture( <Image> ),\r\n *  bumpScale: <float>,\r\n *\r\n *  normalMap: new THREE.Texture( <Image> ),\r\n *  normalScale: <Vector2>,\r\n *\r\n *  specularMap: new THREE.Texture( <Image> ),\r\n *\r\n *  alphaMap: new THREE.Texture( <Image> ),\r\n *\r\n *  envMap: new THREE.TextureCube( [posx, negx, posy, negy, posz, negz] ),\r\n *  combine: THREE.Multiply,\r\n *  reflectivity: <float>,\r\n *  refractionRatio: <float>,\r\n *\r\n *  shading: THREE.SmoothShading,\r\n *  blending: THREE.NormalBlending,\r\n *  depthTest: <bool>,\r\n *  depthWrite: <bool>,\r\n *\r\n *  wireframe: <boolean>,\r\n *  wireframeLinewidth: <float>,\r\n *\r\n *  vertexColors: THREE.NoColors / THREE.VertexColors / THREE.FaceColors,\r\n *\r\n *  skinning: <bool>,\r\n *  morphTargets: <bool>,\r\n *  morphNormals: <bool>,\r\n *\r\n *\tfog: <bool>\r\n * }\r\n */\r\n\r\nTHREE.MeshPhongMaterial = function(parameters) {\r\n\r\n  THREE.Material.call(this);\r\n\r\n  this.type = 'MeshPhongMaterial';\r\n\r\n  this.color = new THREE.Color(0xffffff); // diffuse\r\n  this.emissive = new THREE.Color(0x000000);\r\n  this.specular = new THREE.Color(0x111111);\r\n  this.shininess = 30;\r\n\r\n  this.metal = false;\r\n\r\n  this.wrapAround = false;\r\n  this.wrapRGB = new THREE.Vector3(1, 1, 1);\r\n\r\n  this.map = null;\r\n\r\n  this.lightMap = null;\r\n\r\n  this.bumpMap = null;\r\n  this.bumpScale = 1;\r\n\r\n  this.normalMap = null;\r\n  this.normalScale = new THREE.Vector2(1, 1);\r\n\r\n  this.specularMap = null;\r\n\r\n  this.alphaMap = null;\r\n\r\n  this.envMap = null;\r\n  this.combine = THREE.MultiplyOperation;\r\n  this.reflectivity = 1;\r\n  this.refractionRatio = 0.98;\r\n\r\n  this.fog = true;\r\n\r\n  this.shading = THREE.SmoothShading;\r\n\r\n  this.wireframe = false;\r\n  this.wireframeLinewidth = 1;\r\n  this.wireframeLinecap = 'round';\r\n  this.wireframeLinejoin = 'round';\r\n\r\n  this.vertexColors = THREE.NoColors;\r\n\r\n  this.skinning = false;\r\n  this.morphTargets = false;\r\n  this.morphNormals = false;\r\n\r\n  this.setValues(parameters);\r\n\r\n};\r\n\r\nTHREE.MeshPhongMaterial.prototype = Object.create(THREE.Material.prototype);\r\nTHREE.MeshPhongMaterial.prototype.constructor = THREE.MeshPhongMaterial;\r\n\r\nTHREE.MeshPhongMaterial.prototype.clone = function() {\r\n\r\n  var material = new THREE.MeshPhongMaterial();\r\n\r\n  THREE.Material.prototype.clone.call(this, material);\r\n\r\n  material.color.copy(this.color);\r\n  material.emissive.copy(this.emissive);\r\n  material.specular.copy(this.specular);\r\n  material.shininess = this.shininess;\r\n\r\n  material.metal = this.metal;\r\n\r\n  material.wrapAround = this.wrapAround;\r\n  material.wrapRGB.copy(this.wrapRGB);\r\n\r\n  material.map = this.map;\r\n\r\n  material.lightMap = this.lightMap;\r\n\r\n  material.bumpMap = this.bumpMap;\r\n  material.bumpScale = this.bumpScale;\r\n\r\n  material.normalMap = this.normalMap;\r\n  material.normalScale.copy(this.normalScale);\r\n\r\n  material.specularMap = this.specularMap;\r\n\r\n  material.alphaMap = this.alphaMap;\r\n\r\n  material.envMap = this.envMap;\r\n  material.combine = this.combine;\r\n  material.reflectivity = this.reflectivity;\r\n  material.refractionRatio = this.refractionRatio;\r\n\r\n  material.fog = this.fog;\r\n\r\n  material.shading = this.shading;\r\n\r\n  material.wireframe = this.wireframe;\r\n  material.wireframeLinewidth = this.wireframeLinewidth;\r\n  material.wireframeLinecap = this.wireframeLinecap;\r\n  material.wireframeLinejoin = this.wireframeLinejoin;\r\n\r\n  material.vertexColors = this.vertexColors;\r\n\r\n  material.skinning = this.skinning;\r\n  material.morphTargets = this.morphTargets;\r\n  material.morphNormals = this.morphNormals;\r\n\r\n  return material;\r\n\r\n};\r\n\r\n// File:src/materials/MeshDepthMaterial.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author alteredq / http://alteredqualia.com/\r\n *\r\n * parameters = {\r\n *  opacity: <float>,\r\n *\r\n *  blending: THREE.NormalBlending,\r\n *  depthTest: <bool>,\r\n *  depthWrite: <bool>,\r\n *\r\n *  wireframe: <boolean>,\r\n *  wireframeLinewidth: <float>\r\n * }\r\n */\r\n\r\nTHREE.MeshDepthMaterial = function(parameters) {\r\n\r\n  THREE.Material.call(this);\r\n\r\n  this.type = 'MeshDepthMaterial';\r\n\r\n  this.morphTargets = false;\r\n  this.wireframe = false;\r\n  this.wireframeLinewidth = 1;\r\n\r\n  this.setValues(parameters);\r\n\r\n};\r\n\r\nTHREE.MeshDepthMaterial.prototype = Object.create(THREE.Material.prototype);\r\nTHREE.MeshDepthMaterial.prototype.constructor = THREE.MeshDepthMaterial;\r\n\r\nTHREE.MeshDepthMaterial.prototype.clone = function() {\r\n\r\n  var material = new THREE.MeshDepthMaterial();\r\n\r\n  THREE.Material.prototype.clone.call(this, material);\r\n\r\n  material.wireframe = this.wireframe;\r\n  material.wireframeLinewidth = this.wireframeLinewidth;\r\n\r\n  return material;\r\n\r\n};\r\n\r\n// File:src/materials/MeshNormalMaterial.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n *\r\n * parameters = {\r\n *  opacity: <float>,\r\n *\r\n *  shading: THREE.FlatShading,\r\n *  blending: THREE.NormalBlending,\r\n *  depthTest: <bool>,\r\n *  depthWrite: <bool>,\r\n *\r\n *  wireframe: <boolean>,\r\n *  wireframeLinewidth: <float>\r\n * }\r\n */\r\n\r\nTHREE.MeshNormalMaterial = function(parameters) {\r\n\r\n  THREE.Material.call(this, parameters);\r\n\r\n  this.type = 'MeshNormalMaterial';\r\n\r\n  this.wireframe = false;\r\n  this.wireframeLinewidth = 1;\r\n\r\n  this.morphTargets = false;\r\n\r\n  this.setValues(parameters);\r\n\r\n};\r\n\r\nTHREE.MeshNormalMaterial.prototype = Object.create(THREE.Material.prototype);\r\nTHREE.MeshNormalMaterial.prototype.constructor = THREE.MeshNormalMaterial;\r\n\r\nTHREE.MeshNormalMaterial.prototype.clone = function() {\r\n\r\n  var material = new THREE.MeshNormalMaterial();\r\n\r\n  THREE.Material.prototype.clone.call(this, material);\r\n\r\n  material.wireframe = this.wireframe;\r\n  material.wireframeLinewidth = this.wireframeLinewidth;\r\n\r\n  return material;\r\n\r\n};\r\n\r\n// File:src/materials/MeshFaceMaterial.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.MeshFaceMaterial = function(materials) {\r\n\r\n  this.uuid = THREE.Math.generateUUID();\r\n\r\n  this.type = 'MeshFaceMaterial';\r\n\r\n  this.materials = materials instanceof Array ? materials : [];\r\n\r\n};\r\n\r\nTHREE.MeshFaceMaterial.prototype = {\r\n\r\n  constructor: THREE.MeshFaceMaterial,\r\n\r\n  toJSON: function() {\r\n\r\n    var output = {\r\n      metadata: {\r\n        version: 4.2,\r\n        type: 'material',\r\n        generator: 'MaterialExporter'\r\n      },\r\n      uuid: this.uuid,\r\n      type: this.type,\r\n      materials: []\r\n    };\r\n\r\n    for (var i = 0, l = this.materials.length; i < l; i++) {\r\n\r\n      output.materials.push(this.materials[i].toJSON());\r\n\r\n    }\r\n\r\n    return output;\r\n\r\n  },\r\n\r\n  clone: function() {\r\n\r\n    var material = new THREE.MeshFaceMaterial();\r\n\r\n    for (var i = 0; i < this.materials.length; i++) {\r\n\r\n      material.materials.push(this.materials[i].clone());\r\n\r\n    }\r\n\r\n    return material;\r\n\r\n  }\r\n\r\n};\r\n\r\n// File:src/materials/PointCloudMaterial.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author alteredq / http://alteredqualia.com/\r\n *\r\n * parameters = {\r\n *  color: <hex>,\r\n *  opacity: <float>,\r\n *  map: new THREE.Texture( <Image> ),\r\n *\r\n *  size: <float>,\r\n *  sizeAttenuation: <bool>,\r\n *\r\n *  blending: THREE.NormalBlending,\r\n *  depthTest: <bool>,\r\n *  depthWrite: <bool>,\r\n *\r\n *  vertexColors: <bool>,\r\n *\r\n *  fog: <bool>\r\n * }\r\n */\r\n\r\nTHREE.PointCloudMaterial = function(parameters) {\r\n\r\n  THREE.Material.call(this);\r\n\r\n  this.type = 'PointCloudMaterial';\r\n\r\n  this.color = new THREE.Color(0xffffff);\r\n\r\n  this.map = null;\r\n\r\n  this.size = 1;\r\n  this.sizeAttenuation = true;\r\n\r\n  this.vertexColors = THREE.NoColors;\r\n\r\n  this.fog = true;\r\n\r\n  this.setValues(parameters);\r\n\r\n};\r\n\r\nTHREE.PointCloudMaterial.prototype = Object.create(THREE.Material.prototype);\r\nTHREE.PointCloudMaterial.prototype.constructor = THREE.PointCloudMaterial;\r\n\r\nTHREE.PointCloudMaterial.prototype.clone = function() {\r\n\r\n  var material = new THREE.PointCloudMaterial();\r\n\r\n  THREE.Material.prototype.clone.call(this, material);\r\n\r\n  material.color.copy(this.color);\r\n\r\n  material.map = this.map;\r\n\r\n  material.size = this.size;\r\n  material.sizeAttenuation = this.sizeAttenuation;\r\n\r\n  material.vertexColors = this.vertexColors;\r\n\r\n  material.fog = this.fog;\r\n\r\n  return material;\r\n\r\n};\r\n\r\n// backwards compatibility\r\n\r\nTHREE.ParticleBasicMaterial = function(parameters) {\r\n\r\n  THREE.warn('THREE.ParticleBasicMaterial has been renamed to THREE.PointCloudMaterial.');\r\n  return new THREE.PointCloudMaterial(parameters);\r\n\r\n};\r\n\r\nTHREE.ParticleSystemMaterial = function(parameters) {\r\n\r\n  THREE.warn('THREE.ParticleSystemMaterial has been renamed to THREE.PointCloudMaterial.');\r\n  return new THREE.PointCloudMaterial(parameters);\r\n\r\n};\r\n\r\n// File:src/materials/ShaderMaterial.js\r\n\r\n/**\r\n * @author alteredq / http://alteredqualia.com/\r\n *\r\n * parameters = {\r\n *  defines: { \"label\" : \"value\" },\r\n *  uniforms: { \"parameter1\": { type: \"f\", value: 1.0 }, \"parameter2\": { type: \"i\" value2: 2 } },\r\n *\r\n *  fragmentShader: <string>,\r\n *  vertexShader: <string>,\r\n *\r\n *  shading: THREE.SmoothShading,\r\n *  blending: THREE.NormalBlending,\r\n *  depthTest: <bool>,\r\n *  depthWrite: <bool>,\r\n *\r\n *  wireframe: <boolean>,\r\n *  wireframeLinewidth: <float>,\r\n *\r\n *  lights: <bool>,\r\n *\r\n *  vertexColors: THREE.NoColors / THREE.VertexColors / THREE.FaceColors,\r\n *\r\n *  skinning: <bool>,\r\n *  morphTargets: <bool>,\r\n *  morphNormals: <bool>,\r\n *\r\n *\tfog: <bool>\r\n * }\r\n */\r\n\r\nTHREE.ShaderMaterial = function(parameters) {\r\n\r\n  THREE.Material.call(this);\r\n\r\n  this.type = 'ShaderMaterial';\r\n\r\n  this.defines = {};\r\n  this.uniforms = {};\r\n  this.attributes = null;\r\n\r\n  this.vertexShader = 'void main() {\\n\\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\\n}';\r\n  this.fragmentShader = 'void main() {\\n\\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\\n}';\r\n\r\n  this.shading = THREE.SmoothShading;\r\n\r\n  this.linewidth = 1;\r\n\r\n  this.wireframe = false;\r\n  this.wireframeLinewidth = 1;\r\n\r\n  this.fog = false; // set to use scene fog\r\n\r\n  this.lights = false; // set to use scene lights\r\n\r\n  this.vertexColors = THREE.NoColors; // set to use \"color\" attribute stream\r\n\r\n  this.skinning = false; // set to use skinning attribute streams\r\n\r\n  this.morphTargets = false; // set to use morph targets\r\n  this.morphNormals = false; // set to use morph normals\r\n\r\n  // When rendered geometry doesn't include these attributes but the material does,\r\n  // use these default values in WebGL. This avoids errors when buffer data is missing.\r\n  this.defaultAttributeValues = {\r\n    'color': [1, 1, 1],\r\n    'uv': [0, 0],\r\n    'uv2': [0, 0]\r\n  };\r\n\r\n  this.index0AttributeName = undefined;\r\n\r\n  this.setValues(parameters);\r\n\r\n};\r\n\r\nTHREE.ShaderMaterial.prototype = Object.create(THREE.Material.prototype);\r\nTHREE.ShaderMaterial.prototype.constructor = THREE.ShaderMaterial;\r\n\r\nTHREE.ShaderMaterial.prototype.clone = function() {\r\n\r\n  var material = new THREE.ShaderMaterial();\r\n\r\n  THREE.Material.prototype.clone.call(this, material);\r\n\r\n  material.fragmentShader = this.fragmentShader;\r\n  material.vertexShader = this.vertexShader;\r\n\r\n  material.uniforms = THREE.UniformsUtils.clone(this.uniforms);\r\n\r\n  material.attributes = this.attributes;\r\n  material.defines = this.defines;\r\n\r\n  material.shading = this.shading;\r\n\r\n  material.wireframe = this.wireframe;\r\n  material.wireframeLinewidth = this.wireframeLinewidth;\r\n\r\n  material.fog = this.fog;\r\n\r\n  material.lights = this.lights;\r\n\r\n  material.vertexColors = this.vertexColors;\r\n\r\n  material.skinning = this.skinning;\r\n\r\n  material.morphTargets = this.morphTargets;\r\n  material.morphNormals = this.morphNormals;\r\n\r\n  return material;\r\n\r\n};\r\n\r\n// File:src/materials/RawShaderMaterial.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.RawShaderMaterial = function(parameters) {\r\n\r\n  THREE.ShaderMaterial.call(this, parameters);\r\n\r\n  this.type = 'RawShaderMaterial';\r\n\r\n};\r\n\r\nTHREE.RawShaderMaterial.prototype = Object.create(THREE.ShaderMaterial.prototype);\r\nTHREE.RawShaderMaterial.prototype.constructor = THREE.RawShaderMaterial;\r\n\r\nTHREE.RawShaderMaterial.prototype.clone = function() {\r\n\r\n  var material = new THREE.RawShaderMaterial();\r\n\r\n  THREE.ShaderMaterial.prototype.clone.call(this, material);\r\n\r\n  return material;\r\n\r\n};\r\n\r\n// File:src/materials/SpriteMaterial.js\r\n\r\n/**\r\n * @author alteredq / http://alteredqualia.com/\r\n *\r\n * parameters = {\r\n *  color: <hex>,\r\n *  opacity: <float>,\r\n *  map: new THREE.Texture( <Image> ),\r\n *\r\n *  blending: THREE.NormalBlending,\r\n *  depthTest: <bool>,\r\n *  depthWrite: <bool>,\r\n *\r\n *\tuvOffset: new THREE.Vector2(),\r\n *\tuvScale: new THREE.Vector2(),\r\n *\r\n *  fog: <bool>\r\n * }\r\n */\r\n\r\nTHREE.SpriteMaterial = function(parameters) {\r\n\r\n  THREE.Material.call(this);\r\n\r\n  this.type = 'SpriteMaterial';\r\n\r\n  this.color = new THREE.Color(0xffffff);\r\n  this.map = null;\r\n\r\n  this.rotation = 0;\r\n\r\n  this.fog = false;\r\n\r\n  // set parameters\r\n\r\n  this.setValues(parameters);\r\n\r\n};\r\n\r\nTHREE.SpriteMaterial.prototype = Object.create(THREE.Material.prototype);\r\nTHREE.SpriteMaterial.prototype.constructor = THREE.SpriteMaterial;\r\n\r\nTHREE.SpriteMaterial.prototype.clone = function() {\r\n\r\n  var material = new THREE.SpriteMaterial();\r\n\r\n  THREE.Material.prototype.clone.call(this, material);\r\n\r\n  material.color.copy(this.color);\r\n  material.map = this.map;\r\n\r\n  material.rotation = this.rotation;\r\n\r\n  material.fog = this.fog;\r\n\r\n  return material;\r\n\r\n};\r\n\r\n// File:src/textures/Texture.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author alteredq / http://alteredqualia.com/\r\n * @author szimek / https://github.com/szimek/\r\n */\r\n\r\nTHREE.Texture = function(image, mapping, wrapS, wrapT, magFilter, minFilter, format, type, anisotropy) {\r\n\r\n  Object.defineProperty(this, 'id', {\r\n    value: THREE.TextureIdCount++\r\n  });\r\n\r\n  this.uuid = THREE.Math.generateUUID();\r\n\r\n  this.name = '';\r\n  this.sourceFile = '';\r\n\r\n  this.image = image !== undefined ? image : THREE.Texture.DEFAULT_IMAGE;\r\n  this.mipmaps = [];\r\n\r\n  this.mapping = mapping !== undefined ? mapping : THREE.Texture.DEFAULT_MAPPING;\r\n\r\n  this.wrapS = wrapS !== undefined ? wrapS : THREE.ClampToEdgeWrapping;\r\n  this.wrapT = wrapT !== undefined ? wrapT : THREE.ClampToEdgeWrapping;\r\n\r\n  this.magFilter = magFilter !== undefined ? magFilter : THREE.LinearFilter;\r\n  this.minFilter = minFilter !== undefined ? minFilter : THREE.LinearMipMapLinearFilter;\r\n\r\n  this.anisotropy = anisotropy !== undefined ? anisotropy : 1;\r\n\r\n  this.format = format !== undefined ? format : THREE.RGBAFormat;\r\n  this.type = type !== undefined ? type : THREE.UnsignedByteType;\r\n\r\n  this.offset = new THREE.Vector2(0, 0);\r\n  this.repeat = new THREE.Vector2(1, 1);\r\n\r\n  this.generateMipmaps = true;\r\n  this.premultiplyAlpha = false;\r\n  this.flipY = true;\r\n  this.unpackAlignment = 4; // valid values: 1, 2, 4, 8 (see http://www.khronos.org/opengles/sdk/docs/man/xhtml/glPixelStorei.xml)\r\n\r\n  this._needsUpdate = false;\r\n  this.onUpdate = null;\r\n\r\n};\r\n\r\nTHREE.Texture.DEFAULT_IMAGE = undefined;\r\nTHREE.Texture.DEFAULT_MAPPING = THREE.UVMapping;\r\n\r\nTHREE.Texture.prototype = {\r\n\r\n  constructor: THREE.Texture,\r\n\r\n  get needsUpdate() {\r\n\r\n    return this._needsUpdate;\r\n\r\n  },\r\n\r\n  set needsUpdate(value) {\r\n\r\n    if (value === true) this.update();\r\n\r\n    this._needsUpdate = value;\r\n\r\n  },\r\n\r\n  clone: function(texture) {\r\n\r\n    if (texture === undefined) texture = new THREE.Texture();\r\n\r\n    texture.image = this.image;\r\n    texture.mipmaps = this.mipmaps.slice(0);\r\n\r\n    texture.mapping = this.mapping;\r\n\r\n    texture.wrapS = this.wrapS;\r\n    texture.wrapT = this.wrapT;\r\n\r\n    texture.magFilter = this.magFilter;\r\n    texture.minFilter = this.minFilter;\r\n\r\n    texture.anisotropy = this.anisotropy;\r\n\r\n    texture.format = this.format;\r\n    texture.type = this.type;\r\n\r\n    texture.offset.copy(this.offset);\r\n    texture.repeat.copy(this.repeat);\r\n\r\n    texture.generateMipmaps = this.generateMipmaps;\r\n    texture.premultiplyAlpha = this.premultiplyAlpha;\r\n    texture.flipY = this.flipY;\r\n    texture.unpackAlignment = this.unpackAlignment;\r\n\r\n    return texture;\r\n\r\n  },\r\n\r\n  update: function() {\r\n\r\n    this.dispatchEvent({\r\n      type: 'update'\r\n    });\r\n\r\n  },\r\n\r\n  dispose: function() {\r\n\r\n    this.dispatchEvent({\r\n      type: 'dispose'\r\n    });\r\n\r\n  }\r\n\r\n};\r\n\r\nTHREE.EventDispatcher.prototype.apply(THREE.Texture.prototype);\r\n\r\nTHREE.TextureIdCount = 0;\r\n\r\n// File:src/textures/CubeTexture.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.CubeTexture = function(images, mapping, wrapS, wrapT, magFilter, minFilter, format, type, anisotropy) {\r\n\r\n  mapping = mapping !== undefined ? mapping : THREE.CubeReflectionMapping;\r\n\r\n  THREE.Texture.call(this, images, mapping, wrapS, wrapT, magFilter, minFilter, format, type, anisotropy);\r\n\r\n  this.images = images;\r\n\r\n};\r\n\r\nTHREE.CubeTexture.prototype = Object.create(THREE.Texture.prototype);\r\nTHREE.CubeTexture.prototype.constructor = THREE.CubeTexture;\r\n\r\nTHREE.CubeTexture.clone = function(texture) {\r\n\r\n  if (texture === undefined) texture = new THREE.CubeTexture();\r\n\r\n  THREE.Texture.prototype.clone.call(this, texture);\r\n\r\n  texture.images = this.images;\r\n\r\n  return texture;\r\n\r\n};\r\n\r\n// File:src/textures/CompressedTexture.js\r\n\r\n/**\r\n * @author alteredq / http://alteredqualia.com/\r\n */\r\n\r\nTHREE.CompressedTexture = function(mipmaps, width, height, format, type, mapping, wrapS, wrapT, magFilter, minFilter, anisotropy) {\r\n\r\n  THREE.Texture.call(this, null, mapping, wrapS, wrapT, magFilter, minFilter, format, type, anisotropy);\r\n\r\n  this.image = {\r\n    width: width,\r\n    height: height\r\n  };\r\n  this.mipmaps = mipmaps;\r\n\r\n  // no flipping for cube textures\r\n  // (also flipping doesn't work for compressed textures )\r\n\r\n  this.flipY = false;\r\n\r\n  // can't generate mipmaps for compressed textures\r\n  // mips must be embedded in DDS files\r\n\r\n  this.generateMipmaps = false;\r\n\r\n};\r\n\r\nTHREE.CompressedTexture.prototype = Object.create(THREE.Texture.prototype);\r\nTHREE.CompressedTexture.prototype.constructor = THREE.CompressedTexture;\r\n\r\nTHREE.CompressedTexture.prototype.clone = function() {\r\n\r\n  var texture = new THREE.CompressedTexture();\r\n\r\n  THREE.Texture.prototype.clone.call(this, texture);\r\n\r\n  return texture;\r\n\r\n};\r\n\r\n// File:src/textures/DataTexture.js\r\n\r\n/**\r\n * @author alteredq / http://alteredqualia.com/\r\n */\r\n\r\nTHREE.DataTexture = function(data, width, height, format, type, mapping, wrapS, wrapT, magFilter, minFilter, anisotropy) {\r\n\r\n  THREE.Texture.call(this, null, mapping, wrapS, wrapT, magFilter, minFilter, format, type, anisotropy);\r\n\r\n  this.image = {\r\n    data: data,\r\n    width: width,\r\n    height: height\r\n  };\r\n\r\n};\r\n\r\nTHREE.DataTexture.prototype = Object.create(THREE.Texture.prototype);\r\nTHREE.DataTexture.prototype.constructor = THREE.DataTexture;\r\n\r\nTHREE.DataTexture.prototype.clone = function() {\r\n\r\n  var texture = new THREE.DataTexture();\r\n\r\n  THREE.Texture.prototype.clone.call(this, texture);\r\n\r\n  return texture;\r\n\r\n};\r\n\r\n// File:src/textures/VideoTexture.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.VideoTexture = function(video, mapping, wrapS, wrapT, magFilter, minFilter, format, type, anisotropy) {\r\n\r\n  THREE.Texture.call(this, video, mapping, wrapS, wrapT, magFilter, minFilter, format, type, anisotropy);\r\n\r\n  this.generateMipmaps = false;\r\n\r\n  var scope = this;\r\n\r\n  var update = function() {\r\n\r\n    requestAnimationFrame(update);\r\n\r\n    if (video.readyState === video.HAVE_ENOUGH_DATA) {\r\n\r\n      scope.needsUpdate = true;\r\n\r\n    }\r\n\r\n  };\r\n\r\n  update();\r\n\r\n};\r\n\r\nTHREE.VideoTexture.prototype = Object.create(THREE.Texture.prototype);\r\nTHREE.VideoTexture.prototype.constructor = THREE.VideoTexture;\r\n\r\n// File:src/objects/Group.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.Group = function() {\r\n\r\n  THREE.Object3D.call(this);\r\n\r\n  this.type = 'Group';\r\n\r\n};\r\n\r\nTHREE.Group.prototype = Object.create(THREE.Object3D.prototype);\r\nTHREE.Group.prototype.constructor = THREE.Group;\r\n\r\n// File:src/objects/PointCloud.js\r\n\r\n/**\r\n * @author alteredq / http://alteredqualia.com/\r\n */\r\n\r\nTHREE.PointCloud = function(geometry, material) {\r\n\r\n  THREE.Object3D.call(this);\r\n\r\n  this.type = 'PointCloud';\r\n\r\n  this.geometry = geometry !== undefined ? geometry : new THREE.Geometry();\r\n  this.material = material !== undefined ? material : new THREE.PointCloudMaterial({\r\n    color: Math.random() * 0xffffff\r\n  });\r\n\r\n};\r\n\r\nTHREE.PointCloud.prototype = Object.create(THREE.Object3D.prototype);\r\nTHREE.PointCloud.prototype.constructor = THREE.PointCloud;\r\n\r\nTHREE.PointCloud.prototype.raycast = (function() {\r\n\r\n  var inverseMatrix = new THREE.Matrix4();\r\n  var ray = new THREE.Ray();\r\n\r\n  return function(raycaster, intersects) {\r\n\r\n    var object = this;\r\n    var geometry = object.geometry;\r\n    var threshold = raycaster.params.PointCloud.threshold;\r\n\r\n    inverseMatrix.getInverse(this.matrixWorld);\r\n    ray.copy(raycaster.ray).applyMatrix4(inverseMatrix);\r\n\r\n    if (geometry.boundingBox !== null) {\r\n\r\n      if (ray.isIntersectionBox(geometry.boundingBox) === false) {\r\n\r\n        return;\r\n\r\n      }\r\n\r\n    }\r\n\r\n    var localThreshold = threshold / ((this.scale.x + this.scale.y + this.scale.z) / 3);\r\n    var position = new THREE.Vector3();\r\n\r\n    var testPoint = function(point, index) {\r\n\r\n      var rayPointDistance = ray.distanceToPoint(point);\r\n\r\n      if (rayPointDistance < localThreshold) {\r\n\r\n        var intersectPoint = ray.closestPointToPoint(point);\r\n        intersectPoint.applyMatrix4(object.matrixWorld);\r\n\r\n        var distance = raycaster.ray.origin.distanceTo(intersectPoint);\r\n\r\n        intersects.push({\r\n\r\n          distance: distance,\r\n          distanceToRay: rayPointDistance,\r\n          point: intersectPoint.clone(),\r\n          index: index,\r\n          face: null,\r\n          object: object\r\n\r\n        });\r\n\r\n      }\r\n\r\n    };\r\n\r\n    if (geometry instanceof THREE.BufferGeometry) {\r\n\r\n      var attributes = geometry.attributes;\r\n      var positions = attributes.position.array;\r\n\r\n      if (attributes.index !== undefined) {\r\n\r\n        var indices = attributes.index.array;\r\n        var offsets = geometry.offsets;\r\n\r\n        if (offsets.length === 0) {\r\n\r\n          var offset = {\r\n            start: 0,\r\n            count: indices.length,\r\n            index: 0\r\n          };\r\n\r\n          offsets = [offset];\r\n\r\n        }\r\n\r\n        for (var oi = 0, ol = offsets.length; oi < ol; ++oi) {\r\n\r\n          var start = offsets[oi].start;\r\n          var count = offsets[oi].count;\r\n          var index = offsets[oi].index;\r\n\r\n          for (var i = start, il = start + count; i < il; i++) {\r\n\r\n            var a = index + indices[i];\r\n\r\n            position.fromArray(positions, a * 3);\r\n\r\n            testPoint(position, a);\r\n\r\n          }\r\n\r\n        }\r\n\r\n      }\r\n      else {\r\n\r\n        var pointCount = positions.length / 3;\r\n\r\n        for (var i = 0; i < pointCount; i++) {\r\n\r\n          position.set(\r\n            positions[3 * i],\r\n            positions[3 * i + 1],\r\n            positions[3 * i + 2]\r\n          );\r\n\r\n          testPoint(position, i);\r\n\r\n        }\r\n\r\n      }\r\n\r\n    }\r\n    else {\r\n\r\n      var vertices = this.geometry.vertices;\r\n\r\n      for (var i = 0; i < vertices.length; i++) {\r\n\r\n        testPoint(vertices[i], i);\r\n\r\n      }\r\n\r\n    }\r\n\r\n  };\r\n\r\n}());\r\n\r\nTHREE.PointCloud.prototype.clone = function(object) {\r\n\r\n  if (object === undefined) object = new THREE.PointCloud(this.geometry, this.material);\r\n\r\n  THREE.Object3D.prototype.clone.call(this, object);\r\n\r\n  return object;\r\n\r\n};\r\n\r\n// Backwards compatibility\r\n\r\nTHREE.ParticleSystem = function(geometry, material) {\r\n\r\n  THREE.warn('THREE.ParticleSystem has been renamed to THREE.PointCloud.');\r\n  return new THREE.PointCloud(geometry, material);\r\n\r\n};\r\n\r\n// File:src/objects/Line.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.Line = function(geometry, material, mode) {\r\n\r\n  THREE.Object3D.call(this);\r\n\r\n  this.type = 'Line';\r\n\r\n  this.geometry = geometry !== undefined ? geometry : new THREE.Geometry();\r\n  this.material = material !== undefined ? material : new THREE.LineBasicMaterial({\r\n    color: Math.random() * 0xffffff\r\n  });\r\n\r\n  this.mode = mode !== undefined ? mode : THREE.LineStrip;\r\n\r\n};\r\n\r\nTHREE.LineStrip = 0;\r\nTHREE.LinePieces = 1;\r\n\r\nTHREE.Line.prototype = Object.create(THREE.Object3D.prototype);\r\nTHREE.Line.prototype.constructor = THREE.Line;\r\n\r\nTHREE.Line.prototype.raycast = (function() {\r\n\r\n  var inverseMatrix = new THREE.Matrix4();\r\n  var ray = new THREE.Ray();\r\n  var sphere = new THREE.Sphere();\r\n\r\n  return function(raycaster, intersects) {\r\n\r\n    var precision = raycaster.linePrecision;\r\n    var precisionSq = precision * precision;\r\n\r\n    var geometry = this.geometry;\r\n\r\n    if (geometry.boundingSphere === null) geometry.computeBoundingSphere();\r\n\r\n    // Checking boundingSphere distance to ray\r\n\r\n    sphere.copy(geometry.boundingSphere);\r\n    sphere.applyMatrix4(this.matrixWorld);\r\n\r\n    if (raycaster.ray.isIntersectionSphere(sphere) === false) {\r\n\r\n      return;\r\n\r\n    }\r\n\r\n    inverseMatrix.getInverse(this.matrixWorld);\r\n    ray.copy(raycaster.ray).applyMatrix4(inverseMatrix);\r\n\r\n    var vStart = new THREE.Vector3();\r\n    var vEnd = new THREE.Vector3();\r\n    var interSegment = new THREE.Vector3();\r\n    var interRay = new THREE.Vector3();\r\n    var step = this.mode === THREE.LineStrip ? 1 : 2;\r\n\r\n    if (geometry instanceof THREE.BufferGeometry) {\r\n\r\n      var attributes = geometry.attributes;\r\n\r\n      if (attributes.index !== undefined) {\r\n\r\n        var indices = attributes.index.array;\r\n        var positions = attributes.position.array;\r\n        var offsets = geometry.offsets;\r\n\r\n        if (offsets.length === 0) {\r\n\r\n          offsets = [{\r\n            start: 0,\r\n            count: indices.length,\r\n            index: 0\r\n          }];\r\n\r\n        }\r\n\r\n        for (var oi = 0; oi < offsets.length; oi++) {\r\n\r\n          var start = offsets[oi].start;\r\n          var count = offsets[oi].count;\r\n          var index = offsets[oi].index;\r\n\r\n          for (var i = start; i < start + count - 1; i += step) {\r\n\r\n            var a = index + indices[i];\r\n            var b = index + indices[i + 1];\r\n\r\n            vStart.fromArray(positions, a * 3);\r\n            vEnd.fromArray(positions, b * 3);\r\n\r\n            var distSq = ray.distanceSqToSegment(vStart, vEnd, interRay, interSegment);\r\n\r\n            if (distSq > precisionSq) continue;\r\n\r\n            var distance = ray.origin.distanceTo(interRay);\r\n\r\n            if (distance < raycaster.near || distance > raycaster.far) continue;\r\n\r\n            intersects.push({\r\n\r\n              distance: distance,\r\n              // What do we want? intersection point on the ray or on the segment??\r\n              // point: raycaster.ray.at( distance ),\r\n              point: interSegment.clone().applyMatrix4(this.matrixWorld),\r\n              index: i,\r\n              offsetIndex: oi,\r\n              face: null,\r\n              faceIndex: null,\r\n              object: this\r\n\r\n            });\r\n\r\n          }\r\n\r\n        }\r\n\r\n      }\r\n      else {\r\n\r\n        var positions = attributes.position.array;\r\n\r\n        for (var i = 0; i < positions.length / 3 - 1; i += step) {\r\n\r\n          vStart.fromArray(positions, 3 * i);\r\n          vEnd.fromArray(positions, 3 * i + 3);\r\n\r\n          var distSq = ray.distanceSqToSegment(vStart, vEnd, interRay, interSegment);\r\n\r\n          if (distSq > precisionSq) continue;\r\n\r\n          var distance = ray.origin.distanceTo(interRay);\r\n\r\n          if (distance < raycaster.near || distance > raycaster.far) continue;\r\n\r\n          intersects.push({\r\n\r\n            distance: distance,\r\n            // What do we want? intersection point on the ray or on the segment??\r\n            // point: raycaster.ray.at( distance ),\r\n            point: interSegment.clone().applyMatrix4(this.matrixWorld),\r\n            index: i,\r\n            face: null,\r\n            faceIndex: null,\r\n            object: this\r\n\r\n          });\r\n\r\n        }\r\n\r\n      }\r\n\r\n    }\r\n    else if (geometry instanceof THREE.Geometry) {\r\n\r\n      var vertices = geometry.vertices;\r\n      var nbVertices = vertices.length;\r\n\r\n      for (var i = 0; i < nbVertices - 1; i += step) {\r\n\r\n        var distSq = ray.distanceSqToSegment(vertices[i], vertices[i + 1], interRay, interSegment);\r\n\r\n        if (distSq > precisionSq) continue;\r\n\r\n        var distance = ray.origin.distanceTo(interRay);\r\n\r\n        if (distance < raycaster.near || distance > raycaster.far) continue;\r\n\r\n        intersects.push({\r\n\r\n          distance: distance,\r\n          // What do we want? intersection point on the ray or on the segment??\r\n          // point: raycaster.ray.at( distance ),\r\n          point: interSegment.clone().applyMatrix4(this.matrixWorld),\r\n          index: i,\r\n          face: null,\r\n          faceIndex: null,\r\n          object: this\r\n\r\n        });\r\n\r\n      }\r\n\r\n    }\r\n\r\n  };\r\n\r\n}());\r\n\r\nTHREE.Line.prototype.clone = function(object) {\r\n\r\n  if (object === undefined) object = new THREE.Line(this.geometry, this.material, this.mode);\r\n\r\n  THREE.Object3D.prototype.clone.call(this, object);\r\n\r\n  return object;\r\n\r\n};\r\n\r\n// File:src/objects/Mesh.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author alteredq / http://alteredqualia.com/\r\n * @author mikael emtinger / http://gomo.se/\r\n * @author jonobr1 / http://jonobr1.com/\r\n */\r\n\r\nTHREE.Mesh = function(geometry, material) {\r\n\r\n  THREE.Object3D.call(this);\r\n\r\n  this.type = 'Mesh';\r\n\r\n  this.geometry = geometry !== undefined ? geometry : new THREE.Geometry();\r\n  this.material = material !== undefined ? material : new THREE.MeshBasicMaterial({\r\n    color: Math.random() * 0xffffff\r\n  });\r\n\r\n  this.updateMorphTargets();\r\n\r\n};\r\n\r\nTHREE.Mesh.prototype = Object.create(THREE.Object3D.prototype);\r\nTHREE.Mesh.prototype.constructor = THREE.Mesh;\r\n\r\nTHREE.Mesh.prototype.updateMorphTargets = function() {\r\n\r\n  if (this.geometry.morphTargets !== undefined && this.geometry.morphTargets.length > 0) {\r\n\r\n    this.morphTargetBase = -1;\r\n    this.morphTargetForcedOrder = [];\r\n    this.morphTargetInfluences = [];\r\n    this.morphTargetDictionary = {};\r\n\r\n    for (var m = 0, ml = this.geometry.morphTargets.length; m < ml; m++) {\r\n\r\n      this.morphTargetInfluences.push(0);\r\n      this.morphTargetDictionary[this.geometry.morphTargets[m].name] = m;\r\n\r\n    }\r\n\r\n  }\r\n\r\n};\r\n\r\nTHREE.Mesh.prototype.getMorphTargetIndexByName = function(name) {\r\n\r\n  if (this.morphTargetDictionary[name] !== undefined) {\r\n\r\n    return this.morphTargetDictionary[name];\r\n\r\n  }\r\n\r\n  THREE.warn('THREE.Mesh.getMorphTargetIndexByName: morph target ' + name + ' does not exist. Returning 0.');\r\n\r\n  return 0;\r\n\r\n};\r\n\r\n\r\nTHREE.Mesh.prototype.raycast = (function() {\r\n\r\n  var inverseMatrix = new THREE.Matrix4();\r\n  var ray = new THREE.Ray();\r\n  var sphere = new THREE.Sphere();\r\n\r\n  var vA = new THREE.Vector3();\r\n  var vB = new THREE.Vector3();\r\n  var vC = new THREE.Vector3();\r\n\r\n  return function(raycaster, intersects) {\r\n\r\n    var geometry = this.geometry;\r\n\r\n    // Checking boundingSphere distance to ray\r\n\r\n    if (geometry.boundingSphere === null) geometry.computeBoundingSphere();\r\n\r\n    sphere.copy(geometry.boundingSphere);\r\n    sphere.applyMatrix4(this.matrixWorld);\r\n\r\n    if (raycaster.ray.isIntersectionSphere(sphere) === false) {\r\n\r\n      return;\r\n\r\n    }\r\n\r\n    // Check boundingBox before continuing\r\n\r\n    inverseMatrix.getInverse(this.matrixWorld);\r\n    ray.copy(raycaster.ray).applyMatrix4(inverseMatrix);\r\n\r\n    if (geometry.boundingBox !== null) {\r\n\r\n      if (ray.isIntersectionBox(geometry.boundingBox) === false) {\r\n\r\n        return;\r\n\r\n      }\r\n\r\n    }\r\n\r\n    if (geometry instanceof THREE.BufferGeometry) {\r\n\r\n      var material = this.material;\r\n\r\n      if (material === undefined) return;\r\n\r\n      var attributes = geometry.attributes;\r\n\r\n      var a, b, c;\r\n      var precision = raycaster.precision;\r\n\r\n      if (attributes.index !== undefined) {\r\n\r\n        var indices = attributes.index.array;\r\n        var positions = attributes.position.array;\r\n        var offsets = geometry.offsets;\r\n\r\n        if (offsets.length === 0) {\r\n\r\n          offsets = [{\r\n            start: 0,\r\n            count: indices.length,\r\n            index: 0\r\n          }];\r\n\r\n        }\r\n\r\n        for (var oi = 0, ol = offsets.length; oi < ol; ++oi) {\r\n\r\n          var start = offsets[oi].start;\r\n          var count = offsets[oi].count;\r\n          var index = offsets[oi].index;\r\n\r\n          for (var i = start, il = start + count; i < il; i += 3) {\r\n\r\n            a = index + indices[i];\r\n            b = index + indices[i + 1];\r\n            c = index + indices[i + 2];\r\n\r\n            vA.fromArray(positions, a * 3);\r\n            vB.fromArray(positions, b * 3);\r\n            vC.fromArray(positions, c * 3);\r\n\r\n            if (material.side === THREE.BackSide) {\r\n\r\n              var intersectionPoint = ray.intersectTriangle(vC, vB, vA, true);\r\n\r\n            }\r\n            else {\r\n\r\n              var intersectionPoint = ray.intersectTriangle(vA, vB, vC, material.side !== THREE.DoubleSide);\r\n\r\n            }\r\n\r\n            if (intersectionPoint === null) continue;\r\n\r\n            intersectionPoint.applyMatrix4(this.matrixWorld);\r\n\r\n            var distance = raycaster.ray.origin.distanceTo(intersectionPoint);\r\n\r\n            if (distance < precision || distance < raycaster.near || distance > raycaster.far) continue;\r\n\r\n            intersects.push({\r\n\r\n              distance: distance,\r\n              point: intersectionPoint,\r\n              face: new THREE.Face3(a, b, c, THREE.Triangle.normal(vA, vB, vC)),\r\n              faceIndex: null,\r\n              object: this\r\n\r\n            });\r\n\r\n          }\r\n\r\n        }\r\n\r\n      }\r\n      else {\r\n\r\n        var positions = attributes.position.array;\r\n\r\n        for (var i = 0, j = 0, il = positions.length; i < il; i += 3, j += 9) {\r\n\r\n          a = i;\r\n          b = i + 1;\r\n          c = i + 2;\r\n\r\n          vA.fromArray(positions, j);\r\n          vB.fromArray(positions, j + 3);\r\n          vC.fromArray(positions, j + 6);\r\n\r\n          if (material.side === THREE.BackSide) {\r\n\r\n            var intersectionPoint = ray.intersectTriangle(vC, vB, vA, true);\r\n\r\n          }\r\n          else {\r\n\r\n            var intersectionPoint = ray.intersectTriangle(vA, vB, vC, material.side !== THREE.DoubleSide);\r\n\r\n          }\r\n\r\n          if (intersectionPoint === null) continue;\r\n\r\n          intersectionPoint.applyMatrix4(this.matrixWorld);\r\n\r\n          var distance = raycaster.ray.origin.distanceTo(intersectionPoint);\r\n\r\n          if (distance < precision || distance < raycaster.near || distance > raycaster.far) continue;\r\n\r\n          intersects.push({\r\n\r\n            distance: distance,\r\n            point: intersectionPoint,\r\n            face: new THREE.Face3(a, b, c, THREE.Triangle.normal(vA, vB, vC)),\r\n            faceIndex: null,\r\n            object: this\r\n\r\n          });\r\n\r\n        }\r\n\r\n      }\r\n\r\n    }\r\n    else if (geometry instanceof THREE.Geometry) {\r\n\r\n      var isFaceMaterial = this.material instanceof THREE.MeshFaceMaterial;\r\n      var objectMaterials = isFaceMaterial === true ? this.material.materials : null;\r\n\r\n      var a, b, c;\r\n      var precision = raycaster.precision;\r\n\r\n      var vertices = geometry.vertices;\r\n\r\n      for (var f = 0, fl = geometry.faces.length; f < fl; f++) {\r\n\r\n        var face = geometry.faces[f];\r\n\r\n        var material = isFaceMaterial === true ? objectMaterials[face.materialIndex] : this.material;\r\n\r\n        if (material === undefined) continue;\r\n\r\n        a = vertices[face.a];\r\n        b = vertices[face.b];\r\n        c = vertices[face.c];\r\n\r\n        if (material.morphTargets === true) {\r\n\r\n          var morphTargets = geometry.morphTargets;\r\n          var morphInfluences = this.morphTargetInfluences;\r\n\r\n          vA.set(0, 0, 0);\r\n          vB.set(0, 0, 0);\r\n          vC.set(0, 0, 0);\r\n\r\n          for (var t = 0, tl = morphTargets.length; t < tl; t++) {\r\n\r\n            var influence = morphInfluences[t];\r\n\r\n            if (influence === 0) continue;\r\n\r\n            var targets = morphTargets[t].vertices;\r\n\r\n            vA.x += (targets[face.a].x - a.x) * influence;\r\n            vA.y += (targets[face.a].y - a.y) * influence;\r\n            vA.z += (targets[face.a].z - a.z) * influence;\r\n\r\n            vB.x += (targets[face.b].x - b.x) * influence;\r\n            vB.y += (targets[face.b].y - b.y) * influence;\r\n            vB.z += (targets[face.b].z - b.z) * influence;\r\n\r\n            vC.x += (targets[face.c].x - c.x) * influence;\r\n            vC.y += (targets[face.c].y - c.y) * influence;\r\n            vC.z += (targets[face.c].z - c.z) * influence;\r\n\r\n          }\r\n\r\n          vA.add(a);\r\n          vB.add(b);\r\n          vC.add(c);\r\n\r\n          a = vA;\r\n          b = vB;\r\n          c = vC;\r\n\r\n        }\r\n\r\n        if (material.side === THREE.BackSide) {\r\n\r\n          var intersectionPoint = ray.intersectTriangle(c, b, a, true);\r\n\r\n        }\r\n        else {\r\n\r\n          var intersectionPoint = ray.intersectTriangle(a, b, c, material.side !== THREE.DoubleSide);\r\n\r\n        }\r\n\r\n        if (intersectionPoint === null) continue;\r\n\r\n        intersectionPoint.applyMatrix4(this.matrixWorld);\r\n\r\n        var distance = raycaster.ray.origin.distanceTo(intersectionPoint);\r\n\r\n        if (distance < precision || distance < raycaster.near || distance > raycaster.far) continue;\r\n\r\n        intersects.push({\r\n\r\n          distance: distance,\r\n          point: intersectionPoint,\r\n          face: face,\r\n          faceIndex: f,\r\n          object: this\r\n\r\n        });\r\n\r\n      }\r\n\r\n    }\r\n\r\n  };\r\n\r\n}());\r\n\r\nTHREE.Mesh.prototype.clone = function(object, recursive) {\r\n\r\n  if (object === undefined) object = new THREE.Mesh(this.geometry, this.material);\r\n\r\n  THREE.Object3D.prototype.clone.call(this, object, recursive);\r\n\r\n  return object;\r\n\r\n};\r\n\r\n// File:src/objects/Bone.js\r\n\r\n/**\r\n * @author mikael emtinger / http://gomo.se/\r\n * @author alteredq / http://alteredqualia.com/\r\n * @author ikerr / http://verold.com\r\n */\r\n\r\nTHREE.Bone = function(skin) {\r\n\r\n  THREE.Object3D.call(this);\r\n\r\n  this.type = 'Bone';\r\n\r\n  this.skin = skin;\r\n\r\n};\r\n\r\nTHREE.Bone.prototype = Object.create(THREE.Object3D.prototype);\r\nTHREE.Bone.prototype.constructor = THREE.Bone;\r\n\r\n// File:src/objects/Skeleton.js\r\n\r\n/**\r\n * @author mikael emtinger / http://gomo.se/\r\n * @author alteredq / http://alteredqualia.com/\r\n * @author michael guerrero / http://realitymeltdown.com\r\n * @author ikerr / http://verold.com\r\n */\r\n\r\nTHREE.Skeleton = function(bones, boneInverses, useVertexTexture) {\r\n\r\n  this.useVertexTexture = useVertexTexture !== undefined ? useVertexTexture : true;\r\n\r\n  this.identityMatrix = new THREE.Matrix4();\r\n\r\n  // copy the bone array\r\n\r\n  bones = bones || [];\r\n\r\n  this.bones = bones.slice(0);\r\n\r\n  // create a bone texture or an array of floats\r\n\r\n  if (this.useVertexTexture) {\r\n\r\n    // layout (1 matrix = 4 pixels)\r\n    //      RGBA RGBA RGBA RGBA (=> column1, column2, column3, column4)\r\n    //  with  8x8  pixel texture max   16 bones  (8 * 8  / 4)\r\n    //       16x16 pixel texture max   64 bones (16 * 16 / 4)\r\n    //       32x32 pixel texture max  256 bones (32 * 32 / 4)\r\n    //       64x64 pixel texture max 1024 bones (64 * 64 / 4)\r\n\r\n    var size;\r\n\r\n    if (this.bones.length > 256)\r\n      size = 64;\r\n    else if (this.bones.length > 64)\r\n      size = 32;\r\n    else if (this.bones.length > 16)\r\n      size = 16;\r\n    else\r\n      size = 8;\r\n\r\n    this.boneTextureWidth = size;\r\n    this.boneTextureHeight = size;\r\n\r\n    this.boneMatrices = new Float32Array(this.boneTextureWidth * this.boneTextureHeight * 4); // 4 floats per RGBA pixel\r\n    this.boneTexture = new THREE.DataTexture(this.boneMatrices, this.boneTextureWidth, this.boneTextureHeight, THREE.RGBAFormat, THREE.FloatType);\r\n    this.boneTexture.minFilter = THREE.NearestFilter;\r\n    this.boneTexture.magFilter = THREE.NearestFilter;\r\n    this.boneTexture.generateMipmaps = false;\r\n    this.boneTexture.flipY = false;\r\n\r\n  }\r\n  else {\r\n\r\n    this.boneMatrices = new Float32Array(16 * this.bones.length);\r\n\r\n  }\r\n\r\n  // use the supplied bone inverses or calculate the inverses\r\n\r\n  if (boneInverses === undefined) {\r\n\r\n    this.calculateInverses();\r\n\r\n  }\r\n  else {\r\n\r\n    if (this.bones.length === boneInverses.length) {\r\n\r\n      this.boneInverses = boneInverses.slice(0);\r\n\r\n    }\r\n    else {\r\n\r\n      THREE.warn('THREE.Skeleton bonInverses is the wrong length.');\r\n\r\n      this.boneInverses = [];\r\n\r\n      for (var b = 0, bl = this.bones.length; b < bl; b++) {\r\n\r\n        this.boneInverses.push(new THREE.Matrix4());\r\n\r\n      }\r\n\r\n    }\r\n\r\n  }\r\n\r\n};\r\n\r\nTHREE.Skeleton.prototype.calculateInverses = function() {\r\n\r\n  this.boneInverses = [];\r\n\r\n  for (var b = 0, bl = this.bones.length; b < bl; b++) {\r\n\r\n    var inverse = new THREE.Matrix4();\r\n\r\n    if (this.bones[b]) {\r\n\r\n      inverse.getInverse(this.bones[b].matrixWorld);\r\n\r\n    }\r\n\r\n    this.boneInverses.push(inverse);\r\n\r\n  }\r\n\r\n};\r\n\r\nTHREE.Skeleton.prototype.pose = function() {\r\n\r\n  var bone;\r\n\r\n  // recover the bind-time world matrices\r\n\r\n  for (var b = 0, bl = this.bones.length; b < bl; b++) {\r\n\r\n    bone = this.bones[b];\r\n\r\n    if (bone) {\r\n\r\n      bone.matrixWorld.getInverse(this.boneInverses[b]);\r\n\r\n    }\r\n\r\n  }\r\n\r\n  // compute the local matrices, positions, rotations and scales\r\n\r\n  for (var b = 0, bl = this.bones.length; b < bl; b++) {\r\n\r\n    bone = this.bones[b];\r\n\r\n    if (bone) {\r\n\r\n      if (bone.parent) {\r\n\r\n        bone.matrix.getInverse(bone.parent.matrixWorld);\r\n        bone.matrix.multiply(bone.matrixWorld);\r\n\r\n      }\r\n      else {\r\n\r\n        bone.matrix.copy(bone.matrixWorld);\r\n\r\n      }\r\n\r\n      bone.matrix.decompose(bone.position, bone.quaternion, bone.scale);\r\n\r\n    }\r\n\r\n  }\r\n\r\n};\r\n\r\nTHREE.Skeleton.prototype.update = (function() {\r\n\r\n  var offsetMatrix = new THREE.Matrix4();\r\n\r\n  return function() {\r\n\r\n    // flatten bone matrices to array\r\n\r\n    for (var b = 0, bl = this.bones.length; b < bl; b++) {\r\n\r\n      // compute the offset between the current and the original transform\r\n\r\n      var matrix = this.bones[b] ? this.bones[b].matrixWorld : this.identityMatrix;\r\n\r\n      offsetMatrix.multiplyMatrices(matrix, this.boneInverses[b]);\r\n      offsetMatrix.flattenToArrayOffset(this.boneMatrices, b * 16);\r\n\r\n    }\r\n\r\n    if (this.useVertexTexture) {\r\n\r\n      this.boneTexture.needsUpdate = true;\r\n\r\n    }\r\n\r\n  };\r\n\r\n})();\r\n\r\n\r\n// File:src/objects/SkinnedMesh.js\r\n\r\n/**\r\n * @author mikael emtinger / http://gomo.se/\r\n * @author alteredq / http://alteredqualia.com/\r\n * @author ikerr / http://verold.com\r\n */\r\n\r\nTHREE.SkinnedMesh = function(geometry, material, useVertexTexture) {\r\n\r\n  THREE.Mesh.call(this, geometry, material);\r\n\r\n  this.type = 'SkinnedMesh';\r\n\r\n  this.bindMode = \"attached\";\r\n  this.bindMatrix = new THREE.Matrix4();\r\n  this.bindMatrixInverse = new THREE.Matrix4();\r\n\r\n  // init bones\r\n\r\n  // TODO: remove bone creation as there is no reason (other than\r\n  // convenience) for THREE.SkinnedMesh to do this.\r\n\r\n  var bones = [];\r\n\r\n  if (this.geometry && this.geometry.bones !== undefined) {\r\n\r\n    var bone, gbone, p, q, s;\r\n\r\n    for (var b = 0, bl = this.geometry.bones.length; b < bl; ++b) {\r\n\r\n      gbone = this.geometry.bones[b];\r\n\r\n      p = gbone.pos;\r\n      q = gbone.rotq;\r\n      s = gbone.scl;\r\n\r\n      bone = new THREE.Bone(this);\r\n      bones.push(bone);\r\n\r\n      bone.name = gbone.name;\r\n      bone.position.set(p[0], p[1], p[2]);\r\n      bone.quaternion.set(q[0], q[1], q[2], q[3]);\r\n\r\n      if (s !== undefined) {\r\n\r\n        bone.scale.set(s[0], s[1], s[2]);\r\n\r\n      }\r\n      else {\r\n\r\n        bone.scale.set(1, 1, 1);\r\n\r\n      }\r\n\r\n    }\r\n\r\n    for (var b = 0, bl = this.geometry.bones.length; b < bl; ++b) {\r\n\r\n      gbone = this.geometry.bones[b];\r\n\r\n      if (gbone.parent !== -1) {\r\n\r\n        bones[gbone.parent].add(bones[b]);\r\n\r\n      }\r\n      else {\r\n\r\n        this.add(bones[b]);\r\n\r\n      }\r\n\r\n    }\r\n\r\n  }\r\n\r\n  this.normalizeSkinWeights();\r\n\r\n  this.updateMatrixWorld(true);\r\n  this.bind(new THREE.Skeleton(bones, undefined, useVertexTexture));\r\n\r\n};\r\n\r\n\r\nTHREE.SkinnedMesh.prototype = Object.create(THREE.Mesh.prototype);\r\nTHREE.SkinnedMesh.prototype.constructor = THREE.SkinnedMesh;\r\n\r\nTHREE.SkinnedMesh.prototype.bind = function(skeleton, bindMatrix) {\r\n\r\n  this.skeleton = skeleton;\r\n\r\n  if (bindMatrix === undefined) {\r\n\r\n    this.updateMatrixWorld(true);\r\n\r\n    bindMatrix = this.matrixWorld;\r\n\r\n  }\r\n\r\n  this.bindMatrix.copy(bindMatrix);\r\n  this.bindMatrixInverse.getInverse(bindMatrix);\r\n\r\n};\r\n\r\nTHREE.SkinnedMesh.prototype.pose = function() {\r\n\r\n  this.skeleton.pose();\r\n\r\n};\r\n\r\nTHREE.SkinnedMesh.prototype.normalizeSkinWeights = function() {\r\n\r\n  if (this.geometry instanceof THREE.Geometry) {\r\n\r\n    for (var i = 0; i < this.geometry.skinIndices.length; i++) {\r\n\r\n      var sw = this.geometry.skinWeights[i];\r\n\r\n      var scale = 1.0 / sw.lengthManhattan();\r\n\r\n      if (scale !== Infinity) {\r\n\r\n        sw.multiplyScalar(scale);\r\n\r\n      }\r\n      else {\r\n\r\n        sw.set(1); // this will be normalized by the shader anyway\r\n\r\n      }\r\n\r\n    }\r\n\r\n  }\r\n  else {\r\n\r\n    // skinning weights assumed to be normalized for THREE.BufferGeometry\r\n\r\n  }\r\n\r\n};\r\n\r\nTHREE.SkinnedMesh.prototype.updateMatrixWorld = function(force) {\r\n\r\n  THREE.Mesh.prototype.updateMatrixWorld.call(this, true);\r\n\r\n  if (this.bindMode === \"attached\") {\r\n\r\n    this.bindMatrixInverse.getInverse(this.matrixWorld);\r\n\r\n  }\r\n  else if (this.bindMode === \"detached\") {\r\n\r\n    this.bindMatrixInverse.getInverse(this.bindMatrix);\r\n\r\n  }\r\n  else {\r\n\r\n    THREE.warn('THREE.SkinnedMesh unreckognized bindMode: ' + this.bindMode);\r\n\r\n  }\r\n\r\n};\r\n\r\nTHREE.SkinnedMesh.prototype.clone = function(object) {\r\n\r\n  if (object === undefined) {\r\n\r\n    object = new THREE.SkinnedMesh(this.geometry, this.material, this.useVertexTexture);\r\n\r\n  }\r\n\r\n  THREE.Mesh.prototype.clone.call(this, object);\r\n\r\n  return object;\r\n\r\n};\r\n\r\n\r\n// File:src/objects/MorphAnimMesh.js\r\n\r\n/**\r\n * @author alteredq / http://alteredqualia.com/\r\n */\r\n\r\nTHREE.MorphAnimMesh = function(geometry, material) {\r\n\r\n  THREE.Mesh.call(this, geometry, material);\r\n\r\n  this.type = 'MorphAnimMesh';\r\n\r\n  // API\r\n\r\n  this.duration = 1000; // milliseconds\r\n  this.mirroredLoop = false;\r\n  this.time = 0;\r\n\r\n  // internals\r\n\r\n  this.lastKeyframe = 0;\r\n  this.currentKeyframe = 0;\r\n\r\n  this.direction = 1;\r\n  this.directionBackwards = false;\r\n\r\n  this.setFrameRange(0, this.geometry.morphTargets.length - 1);\r\n\r\n};\r\n\r\nTHREE.MorphAnimMesh.prototype = Object.create(THREE.Mesh.prototype);\r\nTHREE.MorphAnimMesh.prototype.constructor = THREE.MorphAnimMesh;\r\n\r\nTHREE.MorphAnimMesh.prototype.setFrameRange = function(start, end) {\r\n\r\n  this.startKeyframe = start;\r\n  this.endKeyframe = end;\r\n\r\n  this.length = this.endKeyframe - this.startKeyframe + 1;\r\n\r\n};\r\n\r\nTHREE.MorphAnimMesh.prototype.setDirectionForward = function() {\r\n\r\n  this.direction = 1;\r\n  this.directionBackwards = false;\r\n\r\n};\r\n\r\nTHREE.MorphAnimMesh.prototype.setDirectionBackward = function() {\r\n\r\n  this.direction = -1;\r\n  this.directionBackwards = true;\r\n\r\n};\r\n\r\nTHREE.MorphAnimMesh.prototype.parseAnimations = function() {\r\n\r\n  var geometry = this.geometry;\r\n\r\n  if (!geometry.animations) geometry.animations = {};\r\n\r\n  var firstAnimation, animations = geometry.animations;\r\n\r\n  var pattern = /([a-z]+)_?(\\d+)/;\r\n\r\n  for (var i = 0, il = geometry.morphTargets.length; i < il; i++) {\r\n\r\n    var morph = geometry.morphTargets[i];\r\n    var parts = morph.name.match(pattern);\r\n\r\n    if (parts && parts.length > 1) {\r\n\r\n      var label = parts[1];\r\n\r\n      if (!animations[label]) animations[label] = {\r\n        start: Infinity,\r\n        end: -Infinity\r\n      };\r\n\r\n      var animation = animations[label];\r\n\r\n      if (i < animation.start) animation.start = i;\r\n      if (i > animation.end) animation.end = i;\r\n\r\n      if (!firstAnimation) firstAnimation = label;\r\n\r\n    }\r\n\r\n  }\r\n\r\n  geometry.firstAnimation = firstAnimation;\r\n\r\n};\r\n\r\nTHREE.MorphAnimMesh.prototype.setAnimationLabel = function(label, start, end) {\r\n\r\n  if (!this.geometry.animations) this.geometry.animations = {};\r\n\r\n  this.geometry.animations[label] = {\r\n    start: start,\r\n    end: end\r\n  };\r\n\r\n};\r\n\r\nTHREE.MorphAnimMesh.prototype.playAnimation = function(label, fps) {\r\n\r\n  var animation = this.geometry.animations[label];\r\n\r\n  if (animation) {\r\n\r\n    this.setFrameRange(animation.start, animation.end);\r\n    this.duration = 1000 * ((animation.end - animation.start) / fps);\r\n    this.time = 0;\r\n\r\n  }\r\n  else {\r\n\r\n    THREE.warn('THREE.MorphAnimMesh: animation[' + label + '] undefined in .playAnimation()');\r\n\r\n  }\r\n\r\n};\r\n\r\nTHREE.MorphAnimMesh.prototype.updateAnimation = function(delta) {\r\n\r\n  var frameTime = this.duration / this.length;\r\n\r\n  this.time += this.direction * delta;\r\n\r\n  if (this.mirroredLoop) {\r\n\r\n    if (this.time > this.duration || this.time < 0) {\r\n\r\n      this.direction *= -1;\r\n\r\n      if (this.time > this.duration) {\r\n\r\n        this.time = this.duration;\r\n        this.directionBackwards = true;\r\n\r\n      }\r\n\r\n      if (this.time < 0) {\r\n\r\n        this.time = 0;\r\n        this.directionBackwards = false;\r\n\r\n      }\r\n\r\n    }\r\n\r\n  }\r\n  else {\r\n\r\n    this.time = this.time % this.duration;\r\n\r\n    if (this.time < 0) this.time += this.duration;\r\n\r\n  }\r\n\r\n  var keyframe = this.startKeyframe + THREE.Math.clamp(Math.floor(this.time / frameTime), 0, this.length - 1);\r\n\r\n  if (keyframe !== this.currentKeyframe) {\r\n\r\n    this.morphTargetInfluences[this.lastKeyframe] = 0;\r\n    this.morphTargetInfluences[this.currentKeyframe] = 1;\r\n\r\n    this.morphTargetInfluences[keyframe] = 0;\r\n\r\n    this.lastKeyframe = this.currentKeyframe;\r\n    this.currentKeyframe = keyframe;\r\n\r\n  }\r\n\r\n  var mix = (this.time % frameTime) / frameTime;\r\n\r\n  if (this.directionBackwards) {\r\n\r\n    mix = 1 - mix;\r\n\r\n  }\r\n\r\n  this.morphTargetInfluences[this.currentKeyframe] = mix;\r\n  this.morphTargetInfluences[this.lastKeyframe] = 1 - mix;\r\n\r\n};\r\n\r\nTHREE.MorphAnimMesh.prototype.interpolateTargets = function(a, b, t) {\r\n\r\n  var influences = this.morphTargetInfluences;\r\n\r\n  for (var i = 0, l = influences.length; i < l; i++) {\r\n\r\n    influences[i] = 0;\r\n\r\n  }\r\n\r\n  if (a > -1) influences[a] = 1 - t;\r\n  if (b > -1) influences[b] = t;\r\n\r\n};\r\n\r\nTHREE.MorphAnimMesh.prototype.clone = function(object) {\r\n\r\n  if (object === undefined) object = new THREE.MorphAnimMesh(this.geometry, this.material);\r\n\r\n  object.duration = this.duration;\r\n  object.mirroredLoop = this.mirroredLoop;\r\n  object.time = this.time;\r\n\r\n  object.lastKeyframe = this.lastKeyframe;\r\n  object.currentKeyframe = this.currentKeyframe;\r\n\r\n  object.direction = this.direction;\r\n  object.directionBackwards = this.directionBackwards;\r\n\r\n  THREE.Mesh.prototype.clone.call(this, object);\r\n\r\n  return object;\r\n\r\n};\r\n\r\n// File:src/objects/LOD.js\r\n\r\n/**\r\n * @author mikael emtinger / http://gomo.se/\r\n * @author alteredq / http://alteredqualia.com/\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.LOD = function() {\r\n\r\n  THREE.Object3D.call(this);\r\n\r\n  this.objects = [];\r\n\r\n};\r\n\r\n\r\nTHREE.LOD.prototype = Object.create(THREE.Object3D.prototype);\r\nTHREE.LOD.prototype.constructor = THREE.LOD;\r\n\r\nTHREE.LOD.prototype.addLevel = function(object, distance) {\r\n\r\n  if (distance === undefined) distance = 0;\r\n\r\n  distance = Math.abs(distance);\r\n\r\n  for (var l = 0; l < this.objects.length; l++) {\r\n\r\n    if (distance < this.objects[l].distance) {\r\n\r\n      break;\r\n\r\n    }\r\n\r\n  }\r\n\r\n  this.objects.splice(l, 0, {\r\n    distance: distance,\r\n    object: object\r\n  });\r\n  this.add(object);\r\n\r\n};\r\n\r\nTHREE.LOD.prototype.getObjectForDistance = function(distance) {\r\n\r\n  for (var i = 1, l = this.objects.length; i < l; i++) {\r\n\r\n    if (distance < this.objects[i].distance) {\r\n\r\n      break;\r\n\r\n    }\r\n\r\n  }\r\n\r\n  return this.objects[i - 1].object;\r\n\r\n};\r\n\r\nTHREE.LOD.prototype.raycast = (function() {\r\n\r\n  var matrixPosition = new THREE.Vector3();\r\n\r\n  return function(raycaster, intersects) {\r\n\r\n    matrixPosition.setFromMatrixPosition(this.matrixWorld);\r\n\r\n    var distance = raycaster.ray.origin.distanceTo(matrixPosition);\r\n\r\n    this.getObjectForDistance(distance).raycast(raycaster, intersects);\r\n\r\n  };\r\n\r\n}());\r\n\r\nTHREE.LOD.prototype.update = function() {\r\n\r\n  var v1 = new THREE.Vector3();\r\n  var v2 = new THREE.Vector3();\r\n\r\n  return function(camera) {\r\n\r\n    if (this.objects.length > 1) {\r\n\r\n      v1.setFromMatrixPosition(camera.matrixWorld);\r\n      v2.setFromMatrixPosition(this.matrixWorld);\r\n\r\n      var distance = v1.distanceTo(v2);\r\n\r\n      this.objects[0].object.visible = true;\r\n\r\n      for (var i = 1, l = this.objects.length; i < l; i++) {\r\n\r\n        if (distance >= this.objects[i].distance) {\r\n\r\n          this.objects[i - 1].object.visible = false;\r\n          this.objects[i].object.visible = true;\r\n\r\n        }\r\n        else {\r\n\r\n          break;\r\n\r\n        }\r\n\r\n      }\r\n\r\n      for (; i < l; i++) {\r\n\r\n        this.objects[i].object.visible = false;\r\n\r\n      }\r\n\r\n    }\r\n\r\n  };\r\n\r\n}();\r\n\r\nTHREE.LOD.prototype.clone = function(object) {\r\n\r\n  if (object === undefined) object = new THREE.LOD();\r\n\r\n  THREE.Object3D.prototype.clone.call(this, object);\r\n\r\n  for (var i = 0, l = this.objects.length; i < l; i++) {\r\n    var x = this.objects[i].object.clone();\r\n    x.visible = i === 0;\r\n    object.addLevel(x, this.objects[i].distance);\r\n  }\r\n\r\n  return object;\r\n\r\n};\r\n\r\n// File:src/objects/Sprite.js\r\n\r\n/**\r\n * @author mikael emtinger / http://gomo.se/\r\n * @author alteredq / http://alteredqualia.com/\r\n */\r\n\r\nTHREE.Sprite = (function() {\r\n\r\n  var indices = new Uint16Array([0, 1, 2, 0, 2, 3]);\r\n  var vertices = new Float32Array([-0.5, -0.5, 0, 0.5, -0.5, 0, 0.5, 0.5, 0, -0.5, 0.5, 0]);\r\n  var uvs = new Float32Array([0, 0, 1, 0, 1, 1, 0, 1]);\r\n\r\n  var geometry = new THREE.BufferGeometry();\r\n  geometry.addAttribute('index', new THREE.BufferAttribute(indices, 1));\r\n  geometry.addAttribute('position', new THREE.BufferAttribute(vertices, 3));\r\n  geometry.addAttribute('uv', new THREE.BufferAttribute(uvs, 2));\r\n\r\n  return function(material) {\r\n\r\n    THREE.Object3D.call(this);\r\n\r\n    this.type = 'Sprite';\r\n\r\n    this.geometry = geometry;\r\n    this.material = (material !== undefined) ? material : new THREE.SpriteMaterial();\r\n\r\n  };\r\n\r\n})();\r\n\r\nTHREE.Sprite.prototype = Object.create(THREE.Object3D.prototype);\r\nTHREE.Sprite.prototype.constructor = THREE.Sprite;\r\n\r\nTHREE.Sprite.prototype.raycast = (function() {\r\n\r\n  var matrixPosition = new THREE.Vector3();\r\n\r\n  return function(raycaster, intersects) {\r\n\r\n    matrixPosition.setFromMatrixPosition(this.matrixWorld);\r\n\r\n    var distance = raycaster.ray.distanceToPoint(matrixPosition);\r\n\r\n    if (distance > this.scale.x) {\r\n\r\n      return;\r\n\r\n    }\r\n\r\n    intersects.push({\r\n\r\n      distance: distance,\r\n      point: this.position,\r\n      face: null,\r\n      object: this\r\n\r\n    });\r\n\r\n  };\r\n\r\n}());\r\n\r\nTHREE.Sprite.prototype.clone = function(object) {\r\n\r\n  if (object === undefined) object = new THREE.Sprite(this.material);\r\n\r\n  THREE.Object3D.prototype.clone.call(this, object);\r\n\r\n  return object;\r\n\r\n};\r\n\r\n// Backwards compatibility\r\n\r\nTHREE.Particle = THREE.Sprite;\r\n\r\n// File:src/objects/LensFlare.js\r\n\r\n/**\r\n * @author mikael emtinger / http://gomo.se/\r\n * @author alteredq / http://alteredqualia.com/\r\n */\r\n\r\nTHREE.LensFlare = function(texture, size, distance, blending, color) {\r\n\r\n  THREE.Object3D.call(this);\r\n\r\n  this.lensFlares = [];\r\n\r\n  this.positionScreen = new THREE.Vector3();\r\n  this.customUpdateCallback = undefined;\r\n\r\n  if (texture !== undefined) {\r\n\r\n    this.add(texture, size, distance, blending, color);\r\n\r\n  }\r\n\r\n};\r\n\r\nTHREE.LensFlare.prototype = Object.create(THREE.Object3D.prototype);\r\nTHREE.LensFlare.prototype.constructor = THREE.LensFlare;\r\n\r\n\r\n/*\r\n * Add: adds another flare\r\n */\r\n\r\nTHREE.LensFlare.prototype.add = function(texture, size, distance, blending, color, opacity) {\r\n\r\n  if (size === undefined) size = -1;\r\n  if (distance === undefined) distance = 0;\r\n  if (opacity === undefined) opacity = 1;\r\n  if (color === undefined) color = new THREE.Color(0xffffff);\r\n  if (blending === undefined) blending = THREE.NormalBlending;\r\n\r\n  distance = Math.min(distance, Math.max(0, distance));\r\n\r\n  this.lensFlares.push({\r\n    texture: texture, // THREE.Texture\r\n    size: size, // size in pixels (-1 = use texture.width)\r\n    distance: distance, // distance (0-1) from light source (0=at light source)\r\n    x: 0,\r\n    y: 0,\r\n    z: 0, // screen position (-1 => 1) z = 0 is ontop z = 1 is back\r\n    scale: 1, // scale\r\n    rotation: 1, // rotation\r\n    opacity: opacity, // opacity\r\n    color: color, // color\r\n    blending: blending // blending\r\n  });\r\n\r\n};\r\n\r\n/*\r\n * Update lens flares update positions on all flares based on the screen position\r\n * Set myLensFlare.customUpdateCallback to alter the flares in your project specific way.\r\n */\r\n\r\nTHREE.LensFlare.prototype.updateLensFlares = function() {\r\n\r\n  var f, fl = this.lensFlares.length;\r\n  var flare;\r\n  var vecX = -this.positionScreen.x * 2;\r\n  var vecY = -this.positionScreen.y * 2;\r\n\r\n  for (f = 0; f < fl; f++) {\r\n\r\n    flare = this.lensFlares[f];\r\n\r\n    flare.x = this.positionScreen.x + vecX * flare.distance;\r\n    flare.y = this.positionScreen.y + vecY * flare.distance;\r\n\r\n    flare.wantedRotation = flare.x * Math.PI * 0.25;\r\n    flare.rotation += (flare.wantedRotation - flare.rotation) * 0.25;\r\n\r\n  }\r\n\r\n};\r\n\r\n\r\n// File:src/scenes/Scene.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.Scene = function() {\r\n\r\n  THREE.Object3D.call(this);\r\n\r\n  this.type = 'Scene';\r\n\r\n  this.fog = null;\r\n  this.overrideMaterial = null;\r\n\r\n  this.autoUpdate = true; // checked by the renderer\r\n\r\n};\r\n\r\nTHREE.Scene.prototype = Object.create(THREE.Object3D.prototype);\r\nTHREE.Scene.prototype.constructor = THREE.Scene;\r\n\r\nTHREE.Scene.prototype.clone = function(object) {\r\n\r\n  if (object === undefined) object = new THREE.Scene();\r\n\r\n  THREE.Object3D.prototype.clone.call(this, object);\r\n\r\n  if (this.fog !== null) object.fog = this.fog.clone();\r\n  if (this.overrideMaterial !== null) object.overrideMaterial = this.overrideMaterial.clone();\r\n\r\n  object.autoUpdate = this.autoUpdate;\r\n  object.matrixAutoUpdate = this.matrixAutoUpdate;\r\n\r\n  return object;\r\n\r\n};\r\n\r\n// File:src/scenes/Fog.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author alteredq / http://alteredqualia.com/\r\n */\r\n\r\nTHREE.Fog = function(color, near, far) {\r\n\r\n  this.name = '';\r\n\r\n  this.color = new THREE.Color(color);\r\n\r\n  this.near = (near !== undefined) ? near : 1;\r\n  this.far = (far !== undefined) ? far : 1000;\r\n\r\n};\r\n\r\nTHREE.Fog.prototype.clone = function() {\r\n\r\n  return new THREE.Fog(this.color.getHex(), this.near, this.far);\r\n\r\n};\r\n\r\n// File:src/scenes/FogExp2.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author alteredq / http://alteredqualia.com/\r\n */\r\n\r\nTHREE.FogExp2 = function(color, density) {\r\n\r\n  this.name = '';\r\n\r\n  this.color = new THREE.Color(color);\r\n  this.density = (density !== undefined) ? density : 0.00025;\r\n\r\n};\r\n\r\nTHREE.FogExp2.prototype.clone = function() {\r\n\r\n  return new THREE.FogExp2(this.color.getHex(), this.density);\r\n\r\n};\r\n\r\n// File:src/renderers/shaders/ShaderChunk.js\r\n\r\nTHREE.ShaderChunk = {};\r\n\r\n// File:src/renderers/shaders/ShaderChunk/common.glsl\r\n\r\nTHREE.ShaderChunk['common'] = \"#define PI 3.14159\\n#define PI2 6.28318\\n#define RECIPROCAL_PI2 0.15915494\\n#define LOG2 1.442695\\n#define EPSILON 1e-6\\n\\nfloat square( in float a ) { return a*a; }\\nvec2  square( in vec2 a )  { return vec2( a.x*a.x, a.y*a.y ); }\\nvec3  square( in vec3 a )  { return vec3( a.x*a.x, a.y*a.y, a.z*a.z ); }\\nvec4  square( in vec4 a )  { return vec4( a.x*a.x, a.y*a.y, a.z*a.z, a.w*a.w ); }\\nfloat saturate( in float a ) { return clamp( a, 0.0, 1.0 ); }\\nvec2  saturate( in vec2 a )  { return clamp( a, 0.0, 1.0 ); }\\nvec3  saturate( in vec3 a )  { return clamp( a, 0.0, 1.0 ); }\\nvec4  saturate( in vec4 a )  { return clamp( a, 0.0, 1.0 ); }\\nfloat average( in float a ) { return a; }\\nfloat average( in vec2 a )  { return ( a.x + a.y) * 0.5; }\\nfloat average( in vec3 a )  { return ( a.x + a.y + a.z) / 3.0; }\\nfloat average( in vec4 a )  { return ( a.x + a.y + a.z + a.w) * 0.25; }\\nfloat whiteCompliment( in float a ) { return saturate( 1.0 - a ); }\\nvec2  whiteCompliment( in vec2 a )  { return saturate( vec2(1.0) - a ); }\\nvec3  whiteCompliment( in vec3 a )  { return saturate( vec3(1.0) - a ); }\\nvec4  whiteCompliment( in vec4 a )  { return saturate( vec4(1.0) - a ); }\\nvec3 transformDirection( in vec3 normal, in mat4 matrix ) {\\n\treturn normalize( ( matrix * vec4( normal, 0.0 ) ).xyz );\\n}\\n// http://en.wikibooks.org/wiki/GLSL_Programming/Applying_Matrix_Transformations\\nvec3 inverseTransformDirection( in vec3 normal, in mat4 matrix ) {\\n\treturn normalize( ( vec4( normal, 0.0 ) * matrix ).xyz );\\n}\\nvec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal) {\\n\tfloat distance = dot( planeNormal, point-pointOnPlane );\\n\treturn point - distance * planeNormal;\\n}\\nfloat sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\\n\treturn sign( dot( point - pointOnPlane, planeNormal ) );\\n}\\nvec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {\\n\treturn pointOnLine + lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) );\\n}\\nfloat calcLightAttenuation( float lightDistance, float cutoffDistance, float decayExponent ) {\\n\tif ( decayExponent > 0.0 ) {\\n\t  return pow( saturate( 1.0 - lightDistance / cutoffDistance ), decayExponent );\\n\t}\\n\treturn 1.0;\\n}\\n\\nvec3 inputToLinear( in vec3 a ) {\\n#ifdef GAMMA_INPUT\\n\treturn pow( a, vec3( float( GAMMA_FACTOR ) ) );\\n#else\\n\treturn a;\\n#endif\\n}\\nvec3 linearToOutput( in vec3 a ) {\\n#ifdef GAMMA_OUTPUT\\n\treturn pow( a, vec3( 1.0 / float( GAMMA_FACTOR ) ) );\\n#else\\n\treturn a;\\n#endif\\n}\\n\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/alphatest_fragment.glsl\r\n\r\nTHREE.ShaderChunk['alphatest_fragment'] = \"#ifdef ALPHATEST\\n\\n\tif ( diffuseColor.a < ALPHATEST ) discard;\\n\\n#endif\\n\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/lights_lambert_vertex.glsl\r\n\r\nTHREE.ShaderChunk['lights_lambert_vertex'] = \"vLightFront = vec3( 0.0 );\\n\\n#ifdef DOUBLE_SIDED\\n\\n\tvLightBack = vec3( 0.0 );\\n\\n#endif\\n\\ntransformedNormal = normalize( transformedNormal );\\n\\n#if MAX_DIR_LIGHTS > 0\\n\\nfor( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {\\n\\n\tvec3 dirVector = transformDirection( directionalLightDirection[ i ], viewMatrix );\\n\\n\tfloat dotProduct = dot( transformedNormal, dirVector );\\n\tvec3 directionalLightWeighting = vec3( max( dotProduct, 0.0 ) );\\n\\n\t#ifdef DOUBLE_SIDED\\n\\n\t\tvec3 directionalLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );\\n\\n\t\t#ifdef WRAP_AROUND\\n\\n\t\t\tvec3 directionalLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );\\n\\n\t\t#endif\\n\\n\t#endif\\n\\n\t#ifdef WRAP_AROUND\\n\\n\t\tvec3 directionalLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );\\n\t\tdirectionalLightWeighting = mix( directionalLightWeighting, directionalLightWeightingHalf, wrapRGB );\\n\\n\t\t#ifdef DOUBLE_SIDED\\n\\n\t\t\tdirectionalLightWeightingBack = mix( directionalLightWeightingBack, directionalLightWeightingHalfBack, wrapRGB );\\n\\n\t\t#endif\\n\\n\t#endif\\n\\n\tvLightFront += directionalLightColor[ i ] * directionalLightWeighting;\\n\\n\t#ifdef DOUBLE_SIDED\\n\\n\t\tvLightBack += directionalLightColor[ i ] * directionalLightWeightingBack;\\n\\n\t#endif\\n\\n}\\n\\n#endif\\n\\n#if MAX_POINT_LIGHTS > 0\\n\\n\tfor( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\\n\\n\t\tvec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\\n\t\tvec3 lVector = lPosition.xyz - mvPosition.xyz;\\n\\n\t\tfloat attenuation = calcLightAttenuation( length( lVector ), pointLightDistance[ i ], pointLightDecay[ i ] );\\n\\n\t\tlVector = normalize( lVector );\\n\t\tfloat dotProduct = dot( transformedNormal, lVector );\\n\\n\t\tvec3 pointLightWeighting = vec3( max( dotProduct, 0.0 ) );\\n\\n\t\t#ifdef DOUBLE_SIDED\\n\\n\t\t\tvec3 pointLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );\\n\\n\t\t\t#ifdef WRAP_AROUND\\n\\n\t\t\t\tvec3 pointLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );\\n\\n\t\t\t#endif\\n\\n\t\t#endif\\n\\n\t\t#ifdef WRAP_AROUND\\n\\n\t\t\tvec3 pointLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );\\n\t\t\tpointLightWeighting = mix( pointLightWeighting, pointLightWeightingHalf, wrapRGB );\\n\\n\t\t\t#ifdef DOUBLE_SIDED\\n\\n\t\t\t\tpointLightWeightingBack = mix( pointLightWeightingBack, pointLightWeightingHalfBack, wrapRGB );\\n\\n\t\t\t#endif\\n\\n\t\t#endif\\n\\n\t\tvLightFront += pointLightColor[ i ] * pointLightWeighting * attenuation;\\n\\n\t\t#ifdef DOUBLE_SIDED\\n\\n\t\t\tvLightBack += pointLightColor[ i ] * pointLightWeightingBack * attenuation;\\n\\n\t\t#endif\\n\\n\t}\\n\\n#endif\\n\\n#if MAX_SPOT_LIGHTS > 0\\n\\n\tfor( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {\\n\\n\t\tvec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );\\n\t\tvec3 lVector = lPosition.xyz - mvPosition.xyz;\\n\\n\t\tfloat spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - worldPosition.xyz ) );\\n\\n\t\tif ( spotEffect > spotLightAngleCos[ i ] ) {\\n\\n\t\t\tspotEffect = max( pow( max( spotEffect, 0.0 ), spotLightExponent[ i ] ), 0.0 );\\n\\n\t\t\tfloat attenuation = calcLightAttenuation( length( lVector ), spotLightDistance[ i ], spotLightDecay[ i ] );\\n\\n\t\t\tlVector = normalize( lVector );\\n\\n\t\t\tfloat dotProduct = dot( transformedNormal, lVector );\\n\t\t\tvec3 spotLightWeighting = vec3( max( dotProduct, 0.0 ) );\\n\\n\t\t\t#ifdef DOUBLE_SIDED\\n\\n\t\t\t\tvec3 spotLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );\\n\\n\t\t\t\t#ifdef WRAP_AROUND\\n\\n\t\t\t\t\tvec3 spotLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );\\n\\n\t\t\t\t#endif\\n\\n\t\t\t#endif\\n\\n\t\t\t#ifdef WRAP_AROUND\\n\\n\t\t\t\tvec3 spotLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );\\n\t\t\t\tspotLightWeighting = mix( spotLightWeighting, spotLightWeightingHalf, wrapRGB );\\n\\n\t\t\t\t#ifdef DOUBLE_SIDED\\n\\n\t\t\t\t\tspotLightWeightingBack = mix( spotLightWeightingBack, spotLightWeightingHalfBack, wrapRGB );\\n\\n\t\t\t\t#endif\\n\\n\t\t\t#endif\\n\\n\t\t\tvLightFront += spotLightColor[ i ] * spotLightWeighting * attenuation * spotEffect;\\n\\n\t\t\t#ifdef DOUBLE_SIDED\\n\\n\t\t\t\tvLightBack += spotLightColor[ i ] * spotLightWeightingBack * attenuation * spotEffect;\\n\\n\t\t\t#endif\\n\\n\t\t}\\n\\n\t}\\n\\n#endif\\n\\n#if MAX_HEMI_LIGHTS > 0\\n\\n\tfor( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {\\n\\n\t\tvec3 lVector = transformDirection( hemisphereLightDirection[ i ], viewMatrix );\\n\\n\t\tfloat dotProduct = dot( transformedNormal, lVector );\\n\\n\t\tfloat hemiDiffuseWeight = 0.5 * dotProduct + 0.5;\\n\t\tfloat hemiDiffuseWeightBack = -0.5 * dotProduct + 0.5;\\n\\n\t\tvLightFront += mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );\\n\\n\t\t#ifdef DOUBLE_SIDED\\n\\n\t\t\tvLightBack += mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeightBack );\\n\\n\t\t#endif\\n\\n\t}\\n\\n#endif\\n\\nvLightFront += ambientLightColor;\\n\\n#ifdef DOUBLE_SIDED\\n\\n\tvLightBack += ambientLightColor;\\n\\n#endif\\n\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/map_particle_pars_fragment.glsl\r\n\r\nTHREE.ShaderChunk['map_particle_pars_fragment'] = \"#ifdef USE_MAP\\n\\n\tuniform vec4 offsetRepeat;\\n\tuniform sampler2D map;\\n\\n#endif\\n\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/default_vertex.glsl\r\n\r\nTHREE.ShaderChunk['default_vertex'] = \"#ifdef USE_SKINNING\\n\\n\tvec4 mvPosition = modelViewMatrix * skinned;\\n\\n#elif defined( USE_MORPHTARGETS )\\n\\n\tvec4 mvPosition = modelViewMatrix * vec4( morphed, 1.0 );\\n\\n#else\\n\\n\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\\n\\n#endif\\n\\ngl_Position = projectionMatrix * mvPosition;\\n\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/map_pars_fragment.glsl\r\n\r\nTHREE.ShaderChunk['map_pars_fragment'] = \"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP )\\n\\n\tvarying vec2 vUv;\\n\\n#endif\\n\\n#ifdef USE_MAP\\n\\n\tuniform sampler2D map;\\n\\n#endif\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/skinnormal_vertex.glsl\r\n\r\nTHREE.ShaderChunk['skinnormal_vertex'] = \"#ifdef USE_SKINNING\\n\\n\tmat4 skinMatrix = mat4( 0.0 );\\n\tskinMatrix += skinWeight.x * boneMatX;\\n\tskinMatrix += skinWeight.y * boneMatY;\\n\tskinMatrix += skinWeight.z * boneMatZ;\\n\tskinMatrix += skinWeight.w * boneMatW;\\n\tskinMatrix  = bindMatrixInverse * skinMatrix * bindMatrix;\\n\\n\t#ifdef USE_MORPHNORMALS\\n\\n\tvec4 skinnedNormal = skinMatrix * vec4( morphedNormal, 0.0 );\\n\\n\t#else\\n\\n\tvec4 skinnedNormal = skinMatrix * vec4( normal, 0.0 );\\n\\n\t#endif\\n\\n#endif\\n\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/logdepthbuf_pars_vertex.glsl\r\n\r\nTHREE.ShaderChunk['logdepthbuf_pars_vertex'] = \"#ifdef USE_LOGDEPTHBUF\\n\\n\t#ifdef USE_LOGDEPTHBUF_EXT\\n\\n\t\tvarying float vFragDepth;\\n\\n\t#endif\\n\\n\tuniform float logDepthBufFC;\\n\\n#endif\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/lightmap_pars_vertex.glsl\r\n\r\nTHREE.ShaderChunk['lightmap_pars_vertex'] = \"#ifdef USE_LIGHTMAP\\n\\n\tvarying vec2 vUv2;\\n\\n#endif\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/lights_phong_fragment.glsl\r\n\r\nTHREE.ShaderChunk['lights_phong_fragment'] = \"#ifndef FLAT_SHADED\\n\\n\tvec3 normal = normalize( vNormal );\\n\\n\t#ifdef DOUBLE_SIDED\\n\\n\t\tnormal = normal * ( -1.0 + 2.0 * float( gl_FrontFacing ) );\\n\\n\t#endif\\n\\n#else\\n\\n\tvec3 fdx = dFdx( vViewPosition );\\n\tvec3 fdy = dFdy( vViewPosition );\\n\tvec3 normal = normalize( cross( fdx, fdy ) );\\n\\n#endif\\n\\nvec3 viewPosition = normalize( vViewPosition );\\n\\n#ifdef USE_NORMALMAP\\n\\n\tnormal = perturbNormal2Arb( -vViewPosition, normal );\\n\\n#elif defined( USE_BUMPMAP )\\n\\n\tnormal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );\\n\\n#endif\\n\\nvec3 totalDiffuseLight = vec3( 0.0 );\\nvec3 totalSpecularLight = vec3( 0.0 );\\n\\n#if MAX_POINT_LIGHTS > 0\\n\\n\tfor ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\\n\\n\t\tvec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\\n\t\tvec3 lVector = lPosition.xyz + vViewPosition.xyz;\\n\\n\t\tfloat attenuation = calcLightAttenuation( length( lVector ), pointLightDistance[ i ], pointLightDecay[ i ] );\\n\\n\t\tlVector = normalize( lVector );\\n\\n\t\t// diffuse\\n\\n\t\tfloat dotProduct = dot( normal, lVector );\\n\\n\t\t#ifdef WRAP_AROUND\\n\\n\t\t\tfloat pointDiffuseWeightFull = max( dotProduct, 0.0 );\\n\t\t\tfloat pointDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );\\n\\n\t\t\tvec3 pointDiffuseWeight = mix( vec3( pointDiffuseWeightFull ), vec3( pointDiffuseWeightHalf ), wrapRGB );\\n\\n\t\t#else\\n\\n\t\t\tfloat pointDiffuseWeight = max( dotProduct, 0.0 );\\n\\n\t\t#endif\\n\\n\t\ttotalDiffuseLight += pointLightColor[ i ] * pointDiffuseWeight * attenuation;\\n\\n\t\t\t\t// specular\\n\\n\t\tvec3 pointHalfVector = normalize( lVector + viewPosition );\\n\t\tfloat pointDotNormalHalf = max( dot( normal, pointHalfVector ), 0.0 );\\n\t\tfloat pointSpecularWeight = specularStrength * max( pow( pointDotNormalHalf, shininess ), 0.0 );\\n\\n\t\tfloat specularNormalization = ( shininess + 2.0 ) / 8.0;\\n\\n\t\tvec3 schlick = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVector, pointHalfVector ), 0.0 ), 5.0 );\\n\t\ttotalSpecularLight += schlick * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * attenuation * specularNormalization;\\n\\n\t}\\n\\n#endif\\n\\n#if MAX_SPOT_LIGHTS > 0\\n\\n\tfor ( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {\\n\\n\t\tvec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );\\n\t\tvec3 lVector = lPosition.xyz + vViewPosition.xyz;\\n\\n\t\tfloat attenuation = calcLightAttenuation( length( lVector ), spotLightDistance[ i ], spotLightDecay[ i ] );\\n\\n\t\tlVector = normalize( lVector );\\n\\n\t\tfloat spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - vWorldPosition ) );\\n\\n\t\tif ( spotEffect > spotLightAngleCos[ i ] ) {\\n\\n\t\t\tspotEffect = max( pow( max( spotEffect, 0.0 ), spotLightExponent[ i ] ), 0.0 );\\n\\n\t\t\t// diffuse\\n\\n\t\t\tfloat dotProduct = dot( normal, lVector );\\n\\n\t\t\t#ifdef WRAP_AROUND\\n\\n\t\t\t\tfloat spotDiffuseWeightFull = max( dotProduct, 0.0 );\\n\t\t\t\tfloat spotDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );\\n\\n\t\t\t\tvec3 spotDiffuseWeight = mix( vec3( spotDiffuseWeightFull ), vec3( spotDiffuseWeightHalf ), wrapRGB );\\n\\n\t\t\t#else\\n\\n\t\t\t\tfloat spotDiffuseWeight = max( dotProduct, 0.0 );\\n\\n\t\t\t#endif\\n\\n\t\t\ttotalDiffuseLight += spotLightColor[ i ] * spotDiffuseWeight * attenuation * spotEffect;\\n\\n\t\t\t// specular\\n\\n\t\t\tvec3 spotHalfVector = normalize( lVector + viewPosition );\\n\t\t\tfloat spotDotNormalHalf = max( dot( normal, spotHalfVector ), 0.0 );\\n\t\t\tfloat spotSpecularWeight = specularStrength * max( pow( spotDotNormalHalf, shininess ), 0.0 );\\n\\n\t\t\tfloat specularNormalization = ( shininess + 2.0 ) / 8.0;\\n\\n\t\t\tvec3 schlick = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVector, spotHalfVector ), 0.0 ), 5.0 );\\n\t\t\ttotalSpecularLight += schlick * spotLightColor[ i ] * spotSpecularWeight * spotDiffuseWeight * attenuation * specularNormalization * spotEffect;\\n\\n\t\t}\\n\\n\t}\\n\\n#endif\\n\\n#if MAX_DIR_LIGHTS > 0\\n\\n\tfor( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {\\n\\n\t\tvec3 dirVector = transformDirection( directionalLightDirection[ i ], viewMatrix );\\n\\n\t\t// diffuse\\n\\n\t\tfloat dotProduct = dot( normal, dirVector );\\n\\n\t\t#ifdef WRAP_AROUND\\n\\n\t\t\tfloat dirDiffuseWeightFull = max( dotProduct, 0.0 );\\n\t\t\tfloat dirDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );\\n\\n\t\t\tvec3 dirDiffuseWeight = mix( vec3( dirDiffuseWeightFull ), vec3( dirDiffuseWeightHalf ), wrapRGB );\\n\\n\t\t#else\\n\\n\t\t\tfloat dirDiffuseWeight = max( dotProduct, 0.0 );\\n\\n\t\t#endif\\n\\n\t\ttotalDiffuseLight += directionalLightColor[ i ] * dirDiffuseWeight;\\n\\n\t\t// specular\\n\\n\t\tvec3 dirHalfVector = normalize( dirVector + viewPosition );\\n\t\tfloat dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );\\n\t\tfloat dirSpecularWeight = specularStrength * max( pow( dirDotNormalHalf, shininess ), 0.0 );\\n\\n\t\t/*\\n\t\t// fresnel term from skin shader\\n\t\tconst float F0 = 0.128;\\n\\n\t\tfloat base = 1.0 - dot( viewPosition, dirHalfVector );\\n\t\tfloat exponential = pow( base, 5.0 );\\n\\n\t\tfloat fresnel = exponential + F0 * ( 1.0 - exponential );\\n\t\t*/\\n\\n\t\t/*\\n\t\t// fresnel term from fresnel shader\\n\t\tconst float mFresnelBias = 0.08;\\n\t\tconst float mFresnelScale = 0.3;\\n\t\tconst float mFresnelPower = 5.0;\\n\\n\t\tfloat fresnel = mFresnelBias + mFresnelScale * pow( 1.0 + dot( normalize( -viewPosition ), normal ), mFresnelPower );\\n\t\t*/\\n\\n\t\tfloat specularNormalization = ( shininess + 2.0 ) / 8.0;\\n\\n\t\t// \t\tdirSpecular += specular * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight * specularNormalization * fresnel;\\n\\n\t\tvec3 schlick = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( dirVector, dirHalfVector ), 0.0 ), 5.0 );\\n\t\ttotalSpecularLight += schlick * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight * specularNormalization;\\n\\n\\n\t}\\n\\n#endif\\n\\n#if MAX_HEMI_LIGHTS > 0\\n\\n\tfor( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {\\n\\n\t\tvec3 lVector = transformDirection( hemisphereLightDirection[ i ], viewMatrix );\\n\\n\t\t// diffuse\\n\\n\t\tfloat dotProduct = dot( normal, lVector );\\n\t\tfloat hemiDiffuseWeight = 0.5 * dotProduct + 0.5;\\n\\n\t\tvec3 hemiColor = mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );\\n\\n\t\ttotalDiffuseLight += hemiColor;\\n\\n\t\t// specular (sky light)\\n\\n\t\tvec3 hemiHalfVectorSky = normalize( lVector + viewPosition );\\n\t\tfloat hemiDotNormalHalfSky = 0.5 * dot( normal, hemiHalfVectorSky ) + 0.5;\\n\t\tfloat hemiSpecularWeightSky = specularStrength * max( pow( max( hemiDotNormalHalfSky, 0.0 ), shininess ), 0.0 );\\n\\n\t\t// specular (ground light)\\n\\n\t\tvec3 lVectorGround = -lVector;\\n\\n\t\tvec3 hemiHalfVectorGround = normalize( lVectorGround + viewPosition );\\n\t\tfloat hemiDotNormalHalfGround = 0.5 * dot( normal, hemiHalfVectorGround ) + 0.5;\\n\t\tfloat hemiSpecularWeightGround = specularStrength * max( pow( max( hemiDotNormalHalfGround, 0.0 ), shininess ), 0.0 );\\n\\n\t\tfloat dotProductGround = dot( normal, lVectorGround );\\n\\n\t\tfloat specularNormalization = ( shininess + 2.0 ) / 8.0;\\n\\n\t\tvec3 schlickSky = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVector, hemiHalfVectorSky ), 0.0 ), 5.0 );\\n\t\tvec3 schlickGround = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVectorGround, hemiHalfVectorGround ), 0.0 ), 5.0 );\\n\t\ttotalSpecularLight += hemiColor * specularNormalization * ( schlickSky * hemiSpecularWeightSky * max( dotProduct, 0.0 ) + schlickGround * hemiSpecularWeightGround * max( dotProductGround, 0.0 ) );\\n\\n\t}\\n\\n#endif\\n\\n#ifdef METAL\\n\\n\toutgoingLight += diffuseColor.rgb * ( totalDiffuseLight + ambientLightColor ) * specular + totalSpecularLight + emissive;\\n\\n#else\\n\\n\toutgoingLight += diffuseColor.rgb * ( totalDiffuseLight + ambientLightColor ) + totalSpecularLight + emissive;\\n\\n#endif\\n\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/fog_pars_fragment.glsl\r\n\r\nTHREE.ShaderChunk['fog_pars_fragment'] = \"#ifdef USE_FOG\\n\\n\tuniform vec3 fogColor;\\n\\n\t#ifdef FOG_EXP2\\n\\n\t\tuniform float fogDensity;\\n\\n\t#else\\n\\n\t\tuniform float fogNear;\\n\t\tuniform float fogFar;\\n\t#endif\\n\\n#endif\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/morphnormal_vertex.glsl\r\n\r\nTHREE.ShaderChunk['morphnormal_vertex'] = \"#ifdef USE_MORPHNORMALS\\n\\n\tvec3 morphedNormal = vec3( 0.0 );\\n\\n\tmorphedNormal += ( morphNormal0 - normal ) * morphTargetInfluences[ 0 ];\\n\tmorphedNormal += ( morphNormal1 - normal ) * morphTargetInfluences[ 1 ];\\n\tmorphedNormal += ( morphNormal2 - normal ) * morphTargetInfluences[ 2 ];\\n\tmorphedNormal += ( morphNormal3 - normal ) * morphTargetInfluences[ 3 ];\\n\\n\tmorphedNormal += normal;\\n\\n#endif\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/envmap_pars_fragment.glsl\r\n\r\nTHREE.ShaderChunk['envmap_pars_fragment'] = \"#ifdef USE_ENVMAP\\n\\n\tuniform float reflectivity;\\n\t#ifdef ENVMAP_TYPE_CUBE\\n\t\tuniform samplerCube envMap;\\n\t#else\\n\t\tuniform sampler2D envMap;\\n\t#endif\\n\tuniform float flipEnvMap;\\n\\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\\n\\n\t\tuniform float refractionRatio;\\n\\n\t#else\\n\\n\t\tvarying vec3 vReflect;\\n\\n\t#endif\\n\\n#endif\\n\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/logdepthbuf_fragment.glsl\r\n\r\nTHREE.ShaderChunk['logdepthbuf_fragment'] = \"#if defined(USE_LOGDEPTHBUF) && defined(USE_LOGDEPTHBUF_EXT)\\n\\n\tgl_FragDepthEXT = log2(vFragDepth) * logDepthBufFC * 0.5;\\n\\n#endif\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/normalmap_pars_fragment.glsl\r\n\r\nTHREE.ShaderChunk['normalmap_pars_fragment'] = \"#ifdef USE_NORMALMAP\\n\\n\tuniform sampler2D normalMap;\\n\tuniform vec2 normalScale;\\n\\n\t// Per-Pixel Tangent Space Normal Mapping\\n\t// http://hacksoflife.blogspot.ch/2009/11/per-pixel-tangent-space-normal-mapping.html\\n\\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm ) {\\n\\n\t\tvec3 q0 = dFdx( eye_pos.xyz );\\n\t\tvec3 q1 = dFdy( eye_pos.xyz );\\n\t\tvec2 st0 = dFdx( vUv.st );\\n\t\tvec2 st1 = dFdy( vUv.st );\\n\\n\t\tvec3 S = normalize( q0 * st1.t - q1 * st0.t );\\n\t\tvec3 T = normalize( -q0 * st1.s + q1 * st0.s );\\n\t\tvec3 N = normalize( surf_norm );\\n\\n\t\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\\n\t\tmapN.xy = normalScale * mapN.xy;\\n\t\tmat3 tsn = mat3( S, T, N );\\n\t\treturn normalize( tsn * mapN );\\n\\n\t}\\n\\n#endif\\n\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/lights_phong_pars_vertex.glsl\r\n\r\nTHREE.ShaderChunk['lights_phong_pars_vertex'] = \"#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP ) || defined( USE_ENVMAP )\\n\\n\tvarying vec3 vWorldPosition;\\n\\n#endif\\n\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/lightmap_pars_fragment.glsl\r\n\r\nTHREE.ShaderChunk['lightmap_pars_fragment'] = \"#ifdef USE_LIGHTMAP\\n\\n\tvarying vec2 vUv2;\\n\tuniform sampler2D lightMap;\\n\\n#endif\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/shadowmap_vertex.glsl\r\n\r\nTHREE.ShaderChunk['shadowmap_vertex'] = \"#ifdef USE_SHADOWMAP\\n\\n\tfor( int i = 0; i < MAX_SHADOWS; i ++ ) {\\n\\n\t\tvShadowCoord[ i ] = shadowMatrix[ i ] * worldPosition;\\n\\n\t}\\n\\n#endif\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/lights_phong_vertex.glsl\r\n\r\nTHREE.ShaderChunk['lights_phong_vertex'] = \"#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP ) || defined( USE_ENVMAP )\\n\\n\tvWorldPosition = worldPosition.xyz;\\n\\n#endif\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/map_fragment.glsl\r\n\r\nTHREE.ShaderChunk['map_fragment'] = \"#ifdef USE_MAP\\n\\n\tvec4 texelColor = texture2D( map, vUv );\\n\\n\ttexelColor.xyz = inputToLinear( texelColor.xyz );\\n\\n\tdiffuseColor *= texelColor;\\n\\n#endif\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/lightmap_vertex.glsl\r\n\r\nTHREE.ShaderChunk['lightmap_vertex'] = \"#ifdef USE_LIGHTMAP\\n\\n\tvUv2 = uv2;\\n\\n#endif\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/map_particle_fragment.glsl\r\n\r\nTHREE.ShaderChunk['map_particle_fragment'] = \"#ifdef USE_MAP\\n\\n\tdiffuseColor *= texture2D( map, vec2( gl_PointCoord.x, 1.0 - gl_PointCoord.y ) * offsetRepeat.zw + offsetRepeat.xy );\\n\\n#endif\\n\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/color_pars_fragment.glsl\r\n\r\nTHREE.ShaderChunk['color_pars_fragment'] = \"#ifdef USE_COLOR\\n\\n\tvarying vec3 vColor;\\n\\n#endif\\n\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/color_vertex.glsl\r\n\r\nTHREE.ShaderChunk['color_vertex'] = \"#ifdef USE_COLOR\\n\\n\tvColor.xyz = inputToLinear( color.xyz );\\n\\n#endif\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/skinning_vertex.glsl\r\n\r\nTHREE.ShaderChunk['skinning_vertex'] = \"#ifdef USE_SKINNING\\n\\n\t#ifdef USE_MORPHTARGETS\\n\\n\tvec4 skinVertex = bindMatrix * vec4( morphed, 1.0 );\\n\\n\t#else\\n\\n\tvec4 skinVertex = bindMatrix * vec4( position, 1.0 );\\n\\n\t#endif\\n\\n\tvec4 skinned = vec4( 0.0 );\\n\tskinned += boneMatX * skinVertex * skinWeight.x;\\n\tskinned += boneMatY * skinVertex * skinWeight.y;\\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\\n\tskinned += boneMatW * skinVertex * skinWeight.w;\\n\tskinned  = bindMatrixInverse * skinned;\\n\\n#endif\\n\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/envmap_pars_vertex.glsl\r\n\r\nTHREE.ShaderChunk['envmap_pars_vertex'] = \"#if defined( USE_ENVMAP ) && ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP ) && ! defined( PHONG )\\n\\n\tvarying vec3 vReflect;\\n\\n\tuniform float refractionRatio;\\n\\n#endif\\n\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/linear_to_gamma_fragment.glsl\r\n\r\nTHREE.ShaderChunk['linear_to_gamma_fragment'] = \"\\n\toutgoingLight = linearToOutput( outgoingLight );\\n\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/color_pars_vertex.glsl\r\n\r\nTHREE.ShaderChunk['color_pars_vertex'] = \"#ifdef USE_COLOR\\n\\n\tvarying vec3 vColor;\\n\\n#endif\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/lights_lambert_pars_vertex.glsl\r\n\r\nTHREE.ShaderChunk['lights_lambert_pars_vertex'] = \"uniform vec3 ambientLightColor;\\n\\n#if MAX_DIR_LIGHTS > 0\\n\\n\tuniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\\n\tuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\\n\\n#endif\\n\\n#if MAX_HEMI_LIGHTS > 0\\n\\n\tuniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];\\n\tuniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];\\n\tuniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];\\n\\n#endif\\n\\n#if MAX_POINT_LIGHTS > 0\\n\\n\tuniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\\n\tuniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\\n\tuniform float pointLightDistance[ MAX_POINT_LIGHTS ];\\n\tuniform float pointLightDecay[ MAX_POINT_LIGHTS ];\\n\\n#endif\\n\\n#if MAX_SPOT_LIGHTS > 0\\n\\n\tuniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];\\n\tuniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];\\n\tuniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];\\n\tuniform float spotLightDistance[ MAX_SPOT_LIGHTS ];\\n\tuniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];\\n\tuniform float spotLightExponent[ MAX_SPOT_LIGHTS ];\\n\tuniform float spotLightDecay[ MAX_SPOT_LIGHTS ];\\n\\n#endif\\n\\n#ifdef WRAP_AROUND\\n\\n\tuniform vec3 wrapRGB;\\n\\n#endif\\n\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/map_pars_vertex.glsl\r\n\r\nTHREE.ShaderChunk['map_pars_vertex'] = \"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP )\\n\\n\tvarying vec2 vUv;\\n\tuniform vec4 offsetRepeat;\\n\\n#endif\\n\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/envmap_fragment.glsl\r\n\r\nTHREE.ShaderChunk['envmap_fragment'] = \"#ifdef USE_ENVMAP\\n\\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\\n\\n\t\tvec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );\\n\\n\t\t// Transforming Normal Vectors with the Inverse Transformation\\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\\n\\n\t\t#ifdef ENVMAP_MODE_REFLECTION\\n\\n\t\t\tvec3 reflectVec = reflect( cameraToVertex, worldNormal );\\n\\n\t\t#else\\n\\n\t\t\tvec3 reflectVec = refract( cameraToVertex, worldNormal, refractionRatio );\\n\\n\t\t#endif\\n\\n\t#else\\n\\n\t\tvec3 reflectVec = vReflect;\\n\\n\t#endif\\n\\n\t#ifdef DOUBLE_SIDED\\n\t\tfloat flipNormal = ( -1.0 + 2.0 * float( gl_FrontFacing ) );\\n\t#else\\n\t\tfloat flipNormal = 1.0;\\n\t#endif\\n\\n\t#ifdef ENVMAP_TYPE_CUBE\\n\t\tvec4 envColor = textureCube( envMap, flipNormal * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\\n\\n\t#elif defined( ENVMAP_TYPE_EQUIREC )\\n\t\tvec2 sampleUV;\\n\t\tsampleUV.y = saturate( flipNormal * reflectVec.y * 0.5 + 0.5 );\\n\t\tsampleUV.x = atan( flipNormal * reflectVec.z, flipNormal * reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\\n\t\tvec4 envColor = texture2D( envMap, sampleUV );\\n\\n\t#elif defined( ENVMAP_TYPE_SPHERE )\\n\t\tvec3 reflectView = flipNormal * normalize((viewMatrix * vec4( reflectVec, 0.0 )).xyz + vec3(0.0,0.0,1.0));\\n\t\tvec4 envColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5 );\\n\t#endif\\n\\n\tenvColor.xyz = inputToLinear( envColor.xyz );\\n\\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\\n\\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\\n\\n\t#elif defined( ENVMAP_BLENDING_MIX )\\n\\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\\n\\n\t#elif defined( ENVMAP_BLENDING_ADD )\\n\\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\\n\\n\t#endif\\n\\n#endif\\n\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/specularmap_pars_fragment.glsl\r\n\r\nTHREE.ShaderChunk['specularmap_pars_fragment'] = \"#ifdef USE_SPECULARMAP\\n\\n\tuniform sampler2D specularMap;\\n\\n#endif\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/logdepthbuf_vertex.glsl\r\n\r\nTHREE.ShaderChunk['logdepthbuf_vertex'] = \"#ifdef USE_LOGDEPTHBUF\\n\\n\tgl_Position.z = log2(max( EPSILON, gl_Position.w + 1.0 )) * logDepthBufFC;\\n\\n\t#ifdef USE_LOGDEPTHBUF_EXT\\n\\n\t\tvFragDepth = 1.0 + gl_Position.w;\\n\\n#else\\n\\n\t\tgl_Position.z = (gl_Position.z - 1.0) * gl_Position.w;\\n\\n\t#endif\\n\\n#endif\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/morphtarget_pars_vertex.glsl\r\n\r\nTHREE.ShaderChunk['morphtarget_pars_vertex'] = \"#ifdef USE_MORPHTARGETS\\n\\n\t#ifndef USE_MORPHNORMALS\\n\\n\tuniform float morphTargetInfluences[ 8 ];\\n\\n\t#else\\n\\n\tuniform float morphTargetInfluences[ 4 ];\\n\\n\t#endif\\n\\n#endif\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/specularmap_fragment.glsl\r\n\r\nTHREE.ShaderChunk['specularmap_fragment'] = \"float specularStrength;\\n\\n#ifdef USE_SPECULARMAP\\n\\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\\n\tspecularStrength = texelSpecular.r;\\n\\n#else\\n\\n\tspecularStrength = 1.0;\\n\\n#endif\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/fog_fragment.glsl\r\n\r\nTHREE.ShaderChunk['fog_fragment'] = \"#ifdef USE_FOG\\n\\n\t#ifdef USE_LOGDEPTHBUF_EXT\\n\\n\t\tfloat depth = gl_FragDepthEXT / gl_FragCoord.w;\\n\\n\t#else\\n\\n\t\tfloat depth = gl_FragCoord.z / gl_FragCoord.w;\\n\\n\t#endif\\n\\n\t#ifdef FOG_EXP2\\n\\n\t\tfloat fogFactor = exp2( - square( fogDensity ) * square( depth ) * LOG2 );\\n\t\tfogFactor = whiteCompliment( fogFactor );\\n\\n\t#else\\n\\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, depth );\\n\\n\t#endif\\n\t\\n\toutgoingLight = mix( outgoingLight, fogColor, fogFactor );\\n\\n#endif\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/bumpmap_pars_fragment.glsl\r\n\r\nTHREE.ShaderChunk['bumpmap_pars_fragment'] = \"#ifdef USE_BUMPMAP\\n\\n\tuniform sampler2D bumpMap;\\n\tuniform float bumpScale;\\n\\n\t// Derivative maps - bump mapping unparametrized surfaces by Morten Mikkelsen\\n\t// http://mmikkelsen3d.blogspot.sk/2011/07/derivative-maps.html\\n\\n\t// Evaluate the derivative of the height w.r.t. screen-space using forward differencing (listing 2)\\n\\n\tvec2 dHdxy_fwd() {\\n\\n\t\tvec2 dSTdx = dFdx( vUv );\\n\t\tvec2 dSTdy = dFdy( vUv );\\n\\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\\n\\n\t\treturn vec2( dBx, dBy );\\n\\n\t}\\n\\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\\n\\n\t\tvec3 vSigmaX = dFdx( surf_pos );\\n\t\tvec3 vSigmaY = dFdy( surf_pos );\\n\t\tvec3 vN = surf_norm;\t\t// normalized\\n\\n\t\tvec3 R1 = cross( vSigmaY, vN );\\n\t\tvec3 R2 = cross( vN, vSigmaX );\\n\\n\t\tfloat fDet = dot( vSigmaX, R1 );\\n\\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\\n\\n\t}\\n\\n#endif\\n\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/defaultnormal_vertex.glsl\r\n\r\nTHREE.ShaderChunk['defaultnormal_vertex'] = \"#ifdef USE_SKINNING\\n\\n\tvec3 objectNormal = skinnedNormal.xyz;\\n\\n#elif defined( USE_MORPHNORMALS )\\n\\n\tvec3 objectNormal = morphedNormal;\\n\\n#else\\n\\n\tvec3 objectNormal = normal;\\n\\n#endif\\n\\n#ifdef FLIP_SIDED\\n\\n\tobjectNormal = -objectNormal;\\n\\n#endif\\n\\nvec3 transformedNormal = normalMatrix * objectNormal;\\n\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/lights_phong_pars_fragment.glsl\r\n\r\nTHREE.ShaderChunk['lights_phong_pars_fragment'] = \"uniform vec3 ambientLightColor;\\n\\n#if MAX_DIR_LIGHTS > 0\\n\\n\tuniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\\n\tuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\\n\\n#endif\\n\\n#if MAX_HEMI_LIGHTS > 0\\n\\n\tuniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];\\n\tuniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];\\n\tuniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];\\n\\n#endif\\n\\n#if MAX_POINT_LIGHTS > 0\\n\\n\tuniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\\n\\n\tuniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\\n\tuniform float pointLightDistance[ MAX_POINT_LIGHTS ];\\n\tuniform float pointLightDecay[ MAX_POINT_LIGHTS ];\\n\\n#endif\\n\\n#if MAX_SPOT_LIGHTS > 0\\n\\n\tuniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];\\n\tuniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];\\n\tuniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];\\n\tuniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];\\n\tuniform float spotLightExponent[ MAX_SPOT_LIGHTS ];\\n\tuniform float spotLightDistance[ MAX_SPOT_LIGHTS ];\\n\tuniform float spotLightDecay[ MAX_SPOT_LIGHTS ];\\n\\n#endif\\n\\n#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP ) || defined( USE_ENVMAP )\\n\\n\tvarying vec3 vWorldPosition;\\n\\n#endif\\n\\n#ifdef WRAP_AROUND\\n\\n\tuniform vec3 wrapRGB;\\n\\n#endif\\n\\nvarying vec3 vViewPosition;\\n\\n#ifndef FLAT_SHADED\\n\\n\tvarying vec3 vNormal;\\n\\n#endif\\n\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/skinbase_vertex.glsl\r\n\r\nTHREE.ShaderChunk['skinbase_vertex'] = \"#ifdef USE_SKINNING\\n\\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\\n\\n#endif\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/map_vertex.glsl\r\n\r\nTHREE.ShaderChunk['map_vertex'] = \"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP )\\n\\n\tvUv = uv * offsetRepeat.zw + offsetRepeat.xy;\\n\\n#endif\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/lightmap_fragment.glsl\r\n\r\nTHREE.ShaderChunk['lightmap_fragment'] = \"#ifdef USE_LIGHTMAP\\n\\n\toutgoingLight *= diffuseColor.xyz * texture2D( lightMap, vUv2 ).xyz;\\n\\n#endif\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/shadowmap_pars_vertex.glsl\r\n\r\nTHREE.ShaderChunk['shadowmap_pars_vertex'] = \"#ifdef USE_SHADOWMAP\\n\\n\tvarying vec4 vShadowCoord[ MAX_SHADOWS ];\\n\tuniform mat4 shadowMatrix[ MAX_SHADOWS ];\\n\\n#endif\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/color_fragment.glsl\r\n\r\nTHREE.ShaderChunk['color_fragment'] = \"#ifdef USE_COLOR\\n\\n\tdiffuseColor.rgb *= vColor;\\n\\n#endif\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/morphtarget_vertex.glsl\r\n\r\nTHREE.ShaderChunk['morphtarget_vertex'] = \"#ifdef USE_MORPHTARGETS\\n\\n\tvec3 morphed = vec3( 0.0 );\\n\tmorphed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];\\n\tmorphed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];\\n\tmorphed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];\\n\tmorphed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];\\n\\n\t#ifndef USE_MORPHNORMALS\\n\\n\tmorphed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];\\n\tmorphed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];\\n\tmorphed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];\\n\tmorphed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];\\n\\n\t#endif\\n\\n\tmorphed += position;\\n\\n#endif\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/envmap_vertex.glsl\r\n\r\nTHREE.ShaderChunk['envmap_vertex'] = \"#if defined( USE_ENVMAP ) && ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP ) && ! defined( PHONG )\\n\\n\tvec3 worldNormal = transformDirection( objectNormal, modelMatrix );\\n\\n\tvec3 cameraToVertex = normalize( worldPosition.xyz - cameraPosition );\\n\\n\t#ifdef ENVMAP_MODE_REFLECTION\\n\\n\t\tvReflect = reflect( cameraToVertex, worldNormal );\\n\\n\t#else\\n\\n\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\\n\\n\t#endif\\n\\n#endif\\n\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/shadowmap_fragment.glsl\r\n\r\nTHREE.ShaderChunk['shadowmap_fragment'] = \"#ifdef USE_SHADOWMAP\\n\\n\t#ifdef SHADOWMAP_DEBUG\\n\\n\t\tvec3 frustumColors[3];\\n\t\tfrustumColors[0] = vec3( 1.0, 0.5, 0.0 );\\n\t\tfrustumColors[1] = vec3( 0.0, 1.0, 0.8 );\\n\t\tfrustumColors[2] = vec3( 0.0, 0.5, 1.0 );\\n\\n\t#endif\\n\\n\t#ifdef SHADOWMAP_CASCADE\\n\\n\t\tint inFrustumCount = 0;\\n\\n\t#endif\\n\\n\tfloat fDepth;\\n\tvec3 shadowColor = vec3( 1.0 );\\n\\n\tfor( int i = 0; i < MAX_SHADOWS; i ++ ) {\\n\\n\t\tvec3 shadowCoord = vShadowCoord[ i ].xyz / vShadowCoord[ i ].w;\\n\\n\t\t\t\t// if ( something && something ) breaks ATI OpenGL shader compiler\\n\t\t\t\t// if ( all( something, something ) ) using this instead\\n\\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\\n\t\tbool inFrustum = all( inFrustumVec );\\n\\n\t\t\t\t// don't shadow pixels outside of light frustum\\n\t\t\t\t// use just first frustum (for cascades)\\n\t\t\t\t// don't shadow pixels behind far plane of light frustum\\n\\n\t\t#ifdef SHADOWMAP_CASCADE\\n\\n\t\t\tinFrustumCount += int( inFrustum );\\n\t\t\tbvec3 frustumTestVec = bvec3( inFrustum, inFrustumCount == 1, shadowCoord.z <= 1.0 );\\n\\n\t\t#else\\n\\n\t\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\\n\\n\t\t#endif\\n\\n\t\tbool frustumTest = all( frustumTestVec );\\n\\n\t\tif ( frustumTest ) {\\n\\n\t\t\tshadowCoord.z += shadowBias[ i ];\\n\\n\t\t\t#if defined( SHADOWMAP_TYPE_PCF )\\n\\n\t\t\t\t\t\t// Percentage-close filtering\\n\t\t\t\t\t\t// (9 pixel kernel)\\n\t\t\t\t\t\t// http://fabiensanglard.net/shadowmappingPCF/\\n\\n\t\t\t\tfloat shadow = 0.0;\\n\\n\t\t/*\\n\t\t\t\t\t\t// nested loops breaks shader compiler / validator on some ATI cards when using OpenGL\\n\t\t\t\t\t\t// must enroll loop manually\\n\\n\t\t\t\tfor ( float y = -1.25; y <= 1.25; y += 1.25 )\\n\t\t\t\t\tfor ( float x = -1.25; x <= 1.25; x += 1.25 ) {\\n\\n\t\t\t\t\t\tvec4 rgbaDepth = texture2D( shadowMap[ i ], vec2( x * xPixelOffset, y * yPixelOffset ) + shadowCoord.xy );\\n\\n\t\t\t\t\t\t\t\t// doesn't seem to produce any noticeable visual difference compared to simple texture2D lookup\\n\t\t\t\t\t\t\t\t//vec4 rgbaDepth = texture2DProj( shadowMap[ i ], vec4( vShadowCoord[ i ].w * ( vec2( x * xPixelOffset, y * yPixelOffset ) + shadowCoord.xy ), 0.05, vShadowCoord[ i ].w ) );\\n\\n\t\t\t\t\t\tfloat fDepth = unpackDepth( rgbaDepth );\\n\\n\t\t\t\t\t\tif ( fDepth < shadowCoord.z )\\n\t\t\t\t\t\t\tshadow += 1.0;\\n\\n\t\t\t\t}\\n\\n\t\t\t\tshadow /= 9.0;\\n\\n\t\t*/\\n\\n\t\t\t\tconst float shadowDelta = 1.0 / 9.0;\\n\\n\t\t\t\tfloat xPixelOffset = 1.0 / shadowMapSize[ i ].x;\\n\t\t\t\tfloat yPixelOffset = 1.0 / shadowMapSize[ i ].y;\\n\\n\t\t\t\tfloat dx0 = -1.25 * xPixelOffset;\\n\t\t\t\tfloat dy0 = -1.25 * yPixelOffset;\\n\t\t\t\tfloat dx1 = 1.25 * xPixelOffset;\\n\t\t\t\tfloat dy1 = 1.25 * yPixelOffset;\\n\\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy0 ) ) );\\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\\n\\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy0 ) ) );\\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\\n\\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy0 ) ) );\\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\\n\\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, 0.0 ) ) );\\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\\n\\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy ) );\\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\\n\\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, 0.0 ) ) );\\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\\n\\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy1 ) ) );\\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\\n\\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy1 ) ) );\\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\\n\\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy1 ) ) );\\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\\n\\n\t\t\t\tshadowColor = shadowColor * vec3( ( 1.0 - shadowDarkness[ i ] * shadow ) );\\n\\n\t\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\\n\\n\t\t\t\t\t\t// Percentage-close filtering\\n\t\t\t\t\t\t// (9 pixel kernel)\\n\t\t\t\t\t\t// http://fabiensanglard.net/shadowmappingPCF/\\n\\n\t\t\t\tfloat shadow = 0.0;\\n\\n\t\t\t\tfloat xPixelOffset = 1.0 / shadowMapSize[ i ].x;\\n\t\t\t\tfloat yPixelOffset = 1.0 / shadowMapSize[ i ].y;\\n\\n\t\t\t\tfloat dx0 = -1.0 * xPixelOffset;\\n\t\t\t\tfloat dy0 = -1.0 * yPixelOffset;\\n\t\t\t\tfloat dx1 = 1.0 * xPixelOffset;\\n\t\t\t\tfloat dy1 = 1.0 * yPixelOffset;\\n\\n\t\t\t\tmat3 shadowKernel;\\n\t\t\t\tmat3 depthKernel;\\n\\n\t\t\t\tdepthKernel[0][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy0 ) ) );\\n\t\t\t\tdepthKernel[0][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, 0.0 ) ) );\\n\t\t\t\tdepthKernel[0][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy1 ) ) );\\n\t\t\t\tdepthKernel[1][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy0 ) ) );\\n\t\t\t\tdepthKernel[1][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy ) );\\n\t\t\t\tdepthKernel[1][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy1 ) ) );\\n\t\t\t\tdepthKernel[2][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy0 ) ) );\\n\t\t\t\tdepthKernel[2][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, 0.0 ) ) );\\n\t\t\t\tdepthKernel[2][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy1 ) ) );\\n\\n\t\t\t\tvec3 shadowZ = vec3( shadowCoord.z );\\n\t\t\t\tshadowKernel[0] = vec3(lessThan(depthKernel[0], shadowZ ));\\n\t\t\t\tshadowKernel[0] *= vec3(0.25);\\n\\n\t\t\t\tshadowKernel[1] = vec3(lessThan(depthKernel[1], shadowZ ));\\n\t\t\t\tshadowKernel[1] *= vec3(0.25);\\n\\n\t\t\t\tshadowKernel[2] = vec3(lessThan(depthKernel[2], shadowZ ));\\n\t\t\t\tshadowKernel[2] *= vec3(0.25);\\n\\n\t\t\t\tvec2 fractionalCoord = 1.0 - fract( shadowCoord.xy * shadowMapSize[i].xy );\\n\\n\t\t\t\tshadowKernel[0] = mix( shadowKernel[1], shadowKernel[0], fractionalCoord.x );\\n\t\t\t\tshadowKernel[1] = mix( shadowKernel[2], shadowKernel[1], fractionalCoord.x );\\n\\n\t\t\t\tvec4 shadowValues;\\n\t\t\t\tshadowValues.x = mix( shadowKernel[0][1], shadowKernel[0][0], fractionalCoord.y );\\n\t\t\t\tshadowValues.y = mix( shadowKernel[0][2], shadowKernel[0][1], fractionalCoord.y );\\n\t\t\t\tshadowValues.z = mix( shadowKernel[1][1], shadowKernel[1][0], fractionalCoord.y );\\n\t\t\t\tshadowValues.w = mix( shadowKernel[1][2], shadowKernel[1][1], fractionalCoord.y );\\n\\n\t\t\t\tshadow = dot( shadowValues, vec4( 1.0 ) );\\n\\n\t\t\t\tshadowColor = shadowColor * vec3( ( 1.0 - shadowDarkness[ i ] * shadow ) );\\n\\n\t\t\t#else\\n\\n\t\t\t\tvec4 rgbaDepth = texture2D( shadowMap[ i ], shadowCoord.xy );\\n\t\t\t\tfloat fDepth = unpackDepth( rgbaDepth );\\n\\n\t\t\t\tif ( fDepth < shadowCoord.z )\\n\\n\t\t// spot with multiple shadows is darker\\n\\n\t\t\t\t\tshadowColor = shadowColor * vec3( 1.0 - shadowDarkness[ i ] );\\n\\n\t\t// spot with multiple shadows has the same color as single shadow spot\\n\\n\t\t// \t\t\t\t\tshadowColor = min( shadowColor, vec3( shadowDarkness[ i ] ) );\\n\\n\t\t\t#endif\\n\\n\t\t}\\n\\n\\n\t\t#ifdef SHADOWMAP_DEBUG\\n\\n\t\t\t#ifdef SHADOWMAP_CASCADE\\n\\n\t\t\t\tif ( inFrustum && inFrustumCount == 1 ) outgoingLight *= frustumColors[ i ];\\n\\n\t\t\t#else\\n\\n\t\t\t\tif ( inFrustum ) outgoingLight *= frustumColors[ i ];\\n\\n\t\t\t#endif\\n\\n\t\t#endif\\n\\n\t}\\n\\n\t// NOTE: I am unsure if this is correct in linear space.  -bhouston, Dec 29, 2014\\n\tshadowColor = inputToLinear( shadowColor );\\n\\n\toutgoingLight = outgoingLight * shadowColor;\\n\\n#endif\\n\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/worldpos_vertex.glsl\r\n\r\nTHREE.ShaderChunk['worldpos_vertex'] = \"#if defined( USE_ENVMAP ) || defined( PHONG ) || defined( LAMBERT ) || defined ( USE_SHADOWMAP )\\n\\n\t#ifdef USE_SKINNING\\n\\n\t\tvec4 worldPosition = modelMatrix * skinned;\\n\\n\t#elif defined( USE_MORPHTARGETS )\\n\\n\t\tvec4 worldPosition = modelMatrix * vec4( morphed, 1.0 );\\n\\n\t#else\\n\\n\t\tvec4 worldPosition = modelMatrix * vec4( position, 1.0 );\\n\\n\t#endif\\n\\n#endif\\n\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/shadowmap_pars_fragment.glsl\r\n\r\nTHREE.ShaderChunk['shadowmap_pars_fragment'] = \"#ifdef USE_SHADOWMAP\\n\\n\tuniform sampler2D shadowMap[ MAX_SHADOWS ];\\n\tuniform vec2 shadowMapSize[ MAX_SHADOWS ];\\n\\n\tuniform float shadowDarkness[ MAX_SHADOWS ];\\n\tuniform float shadowBias[ MAX_SHADOWS ];\\n\\n\tvarying vec4 vShadowCoord[ MAX_SHADOWS ];\\n\\n\tfloat unpackDepth( const in vec4 rgba_depth ) {\\n\\n\t\tconst vec4 bit_shift = vec4( 1.0 / ( 256.0 * 256.0 * 256.0 ), 1.0 / ( 256.0 * 256.0 ), 1.0 / 256.0, 1.0 );\\n\t\tfloat depth = dot( rgba_depth, bit_shift );\\n\t\treturn depth;\\n\\n\t}\\n\\n#endif\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/skinning_pars_vertex.glsl\r\n\r\nTHREE.ShaderChunk['skinning_pars_vertex'] = \"#ifdef USE_SKINNING\\n\\n\tuniform mat4 bindMatrix;\\n\tuniform mat4 bindMatrixInverse;\\n\\n\t#ifdef BONE_TEXTURE\\n\\n\t\tuniform sampler2D boneTexture;\\n\t\tuniform int boneTextureWidth;\\n\t\tuniform int boneTextureHeight;\\n\\n\t\tmat4 getBoneMatrix( const in float i ) {\\n\\n\t\t\tfloat j = i * 4.0;\\n\t\t\tfloat x = mod( j, float( boneTextureWidth ) );\\n\t\t\tfloat y = floor( j / float( boneTextureWidth ) );\\n\\n\t\t\tfloat dx = 1.0 / float( boneTextureWidth );\\n\t\t\tfloat dy = 1.0 / float( boneTextureHeight );\\n\\n\t\t\ty = dy * ( y + 0.5 );\\n\\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\\n\\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\\n\\n\t\t\treturn bone;\\n\\n\t\t}\\n\\n\t#else\\n\\n\t\tuniform mat4 boneGlobalMatrices[ MAX_BONES ];\\n\\n\t\tmat4 getBoneMatrix( const in float i ) {\\n\\n\t\t\tmat4 bone = boneGlobalMatrices[ int(i) ];\\n\t\t\treturn bone;\\n\\n\t\t}\\n\\n\t#endif\\n\\n#endif\\n\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/logdepthbuf_pars_fragment.glsl\r\n\r\nTHREE.ShaderChunk['logdepthbuf_pars_fragment'] = \"#ifdef USE_LOGDEPTHBUF\\n\\n\tuniform float logDepthBufFC;\\n\\n\t#ifdef USE_LOGDEPTHBUF_EXT\\n\\n\t\t#extension GL_EXT_frag_depth : enable\\n\t\tvarying float vFragDepth;\\n\\n\t#endif\\n\\n#endif\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/alphamap_fragment.glsl\r\n\r\nTHREE.ShaderChunk['alphamap_fragment'] = \"#ifdef USE_ALPHAMAP\\n\\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\\n\\n#endif\\n\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/alphamap_pars_fragment.glsl\r\n\r\nTHREE.ShaderChunk['alphamap_pars_fragment'] = \"#ifdef USE_ALPHAMAP\\n\\n\tuniform sampler2D alphaMap;\\n\\n#endif\\n\";\r\n\r\n// File:src/renderers/shaders/UniformsUtils.js\r\n\r\n/**\r\n * Uniform Utilities\r\n */\r\n\r\nTHREE.UniformsUtils = {\r\n\r\n  merge: function(uniforms) {\r\n\r\n    var merged = {};\r\n\r\n    for (var u = 0; u < uniforms.length; u++) {\r\n\r\n      var tmp = this.clone(uniforms[u]);\r\n\r\n      for (var p in tmp) {\r\n\r\n        merged[p] = tmp[p];\r\n\r\n      }\r\n\r\n    }\r\n\r\n    return merged;\r\n\r\n  },\r\n\r\n  clone: function(uniforms_src) {\r\n\r\n    var uniforms_dst = {};\r\n\r\n    for (var u in uniforms_src) {\r\n\r\n      uniforms_dst[u] = {};\r\n\r\n      for (var p in uniforms_src[u]) {\r\n\r\n        var parameter_src = uniforms_src[u][p];\r\n\r\n        if (parameter_src instanceof THREE.Color ||\r\n          parameter_src instanceof THREE.Vector2 ||\r\n          parameter_src instanceof THREE.Vector3 ||\r\n          parameter_src instanceof THREE.Vector4 ||\r\n          parameter_src instanceof THREE.Matrix4 ||\r\n          parameter_src instanceof THREE.Texture) {\r\n\r\n          uniforms_dst[u][p] = parameter_src.clone();\r\n\r\n        }\r\n        else if (parameter_src instanceof Array) {\r\n\r\n          uniforms_dst[u][p] = parameter_src.slice();\r\n\r\n        }\r\n        else {\r\n\r\n          uniforms_dst[u][p] = parameter_src;\r\n\r\n        }\r\n\r\n      }\r\n\r\n    }\r\n\r\n    return uniforms_dst;\r\n\r\n  }\r\n\r\n};\r\n\r\n// File:src/renderers/shaders/UniformsLib.js\r\n\r\n/**\r\n * Uniforms library for shared webgl shaders\r\n */\r\n\r\nTHREE.UniformsLib = {\r\n\r\n  common: {\r\n\r\n    \"diffuse\": {\r\n      type: \"c\",\r\n      value: new THREE.Color(0xeeeeee)\r\n    },\r\n    \"opacity\": {\r\n      type: \"f\",\r\n      value: 1.0\r\n    },\r\n\r\n    \"map\": {\r\n      type: \"t\",\r\n      value: null\r\n    },\r\n    \"offsetRepeat\": {\r\n      type: \"v4\",\r\n      value: new THREE.Vector4(0, 0, 1, 1)\r\n    },\r\n\r\n    \"lightMap\": {\r\n      type: \"t\",\r\n      value: null\r\n    },\r\n    \"specularMap\": {\r\n      type: \"t\",\r\n      value: null\r\n    },\r\n    \"alphaMap\": {\r\n      type: \"t\",\r\n      value: null\r\n    },\r\n\r\n    \"envMap\": {\r\n      type: \"t\",\r\n      value: null\r\n    },\r\n    \"flipEnvMap\": {\r\n      type: \"f\",\r\n      value: -1\r\n    },\r\n    \"reflectivity\": {\r\n      type: \"f\",\r\n      value: 1.0\r\n    },\r\n    \"refractionRatio\": {\r\n      type: \"f\",\r\n      value: 0.98\r\n    },\r\n\r\n    \"morphTargetInfluences\": {\r\n      type: \"f\",\r\n      value: 0\r\n    }\r\n\r\n  },\r\n\r\n  bump: {\r\n\r\n    \"bumpMap\": {\r\n      type: \"t\",\r\n      value: null\r\n    },\r\n    \"bumpScale\": {\r\n      type: \"f\",\r\n      value: 1\r\n    }\r\n\r\n  },\r\n\r\n  normalmap: {\r\n\r\n    \"normalMap\": {\r\n      type: \"t\",\r\n      value: null\r\n    },\r\n    \"normalScale\": {\r\n      type: \"v2\",\r\n      value: new THREE.Vector2(1, 1)\r\n    }\r\n  },\r\n\r\n  fog: {\r\n\r\n    \"fogDensity\": {\r\n      type: \"f\",\r\n      value: 0.00025\r\n    },\r\n    \"fogNear\": {\r\n      type: \"f\",\r\n      value: 1\r\n    },\r\n    \"fogFar\": {\r\n      type: \"f\",\r\n      value: 2000\r\n    },\r\n    \"fogColor\": {\r\n      type: \"c\",\r\n      value: new THREE.Color(0xffffff)\r\n    }\r\n\r\n  },\r\n\r\n  lights: {\r\n\r\n    \"ambientLightColor\": {\r\n      type: \"fv\",\r\n      value: []\r\n    },\r\n\r\n    \"directionalLightDirection\": {\r\n      type: \"fv\",\r\n      value: []\r\n    },\r\n    \"directionalLightColor\": {\r\n      type: \"fv\",\r\n      value: []\r\n    },\r\n\r\n    \"hemisphereLightDirection\": {\r\n      type: \"fv\",\r\n      value: []\r\n    },\r\n    \"hemisphereLightSkyColor\": {\r\n      type: \"fv\",\r\n      value: []\r\n    },\r\n    \"hemisphereLightGroundColor\": {\r\n      type: \"fv\",\r\n      value: []\r\n    },\r\n\r\n    \"pointLightColor\": {\r\n      type: \"fv\",\r\n      value: []\r\n    },\r\n    \"pointLightPosition\": {\r\n      type: \"fv\",\r\n      value: []\r\n    },\r\n    \"pointLightDistance\": {\r\n      type: \"fv1\",\r\n      value: []\r\n    },\r\n    \"pointLightDecay\": {\r\n      type: \"fv1\",\r\n      value: []\r\n    },\r\n\r\n    \"spotLightColor\": {\r\n      type: \"fv\",\r\n      value: []\r\n    },\r\n    \"spotLightPosition\": {\r\n      type: \"fv\",\r\n      value: []\r\n    },\r\n    \"spotLightDirection\": {\r\n      type: \"fv\",\r\n      value: []\r\n    },\r\n    \"spotLightDistance\": {\r\n      type: \"fv1\",\r\n      value: []\r\n    },\r\n    \"spotLightAngleCos\": {\r\n      type: \"fv1\",\r\n      value: []\r\n    },\r\n    \"spotLightExponent\": {\r\n      type: \"fv1\",\r\n      value: []\r\n    },\r\n    \"spotLightDecay\": {\r\n      type: \"fv1\",\r\n      value: []\r\n    }\r\n\r\n  },\r\n\r\n  particle: {\r\n\r\n    \"psColor\": {\r\n      type: \"c\",\r\n      value: new THREE.Color(0xeeeeee)\r\n    },\r\n    \"opacity\": {\r\n      type: \"f\",\r\n      value: 1.0\r\n    },\r\n    \"size\": {\r\n      type: \"f\",\r\n      value: 1.0\r\n    },\r\n    \"scale\": {\r\n      type: \"f\",\r\n      value: 1.0\r\n    },\r\n    \"map\": {\r\n      type: \"t\",\r\n      value: null\r\n    },\r\n    \"offsetRepeat\": {\r\n      type: \"v4\",\r\n      value: new THREE.Vector4(0, 0, 1, 1)\r\n    },\r\n\r\n    \"fogDensity\": {\r\n      type: \"f\",\r\n      value: 0.00025\r\n    },\r\n    \"fogNear\": {\r\n      type: \"f\",\r\n      value: 1\r\n    },\r\n    \"fogFar\": {\r\n      type: \"f\",\r\n      value: 2000\r\n    },\r\n    \"fogColor\": {\r\n      type: \"c\",\r\n      value: new THREE.Color(0xffffff)\r\n    }\r\n\r\n  },\r\n\r\n  shadowmap: {\r\n\r\n    \"shadowMap\": {\r\n      type: \"tv\",\r\n      value: []\r\n    },\r\n    \"shadowMapSize\": {\r\n      type: \"v2v\",\r\n      value: []\r\n    },\r\n\r\n    \"shadowBias\": {\r\n      type: \"fv1\",\r\n      value: []\r\n    },\r\n    \"shadowDarkness\": {\r\n      type: \"fv1\",\r\n      value: []\r\n    },\r\n\r\n    \"shadowMatrix\": {\r\n      type: \"m4v\",\r\n      value: []\r\n    }\r\n\r\n  }\r\n\r\n};\r\n\r\n// File:src/renderers/shaders/ShaderLib.js\r\n\r\n/**\r\n * Webgl Shader Library for three.js\r\n *\r\n * @author alteredq / http://alteredqualia.com/\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author mikael emtinger / http://gomo.se/\r\n */\r\n\r\n\r\nTHREE.ShaderLib = {\r\n\r\n  'basic': {\r\n\r\n    uniforms: THREE.UniformsUtils.merge([\r\n\r\n      THREE.UniformsLib[\"common\"],\r\n      THREE.UniformsLib[\"fog\"],\r\n      THREE.UniformsLib[\"shadowmap\"]\r\n\r\n    ]),\r\n\r\n    vertexShader: [\r\n\r\n      THREE.ShaderChunk[\"common\"],\r\n      THREE.ShaderChunk[\"map_pars_vertex\"],\r\n      THREE.ShaderChunk[\"lightmap_pars_vertex\"],\r\n      THREE.ShaderChunk[\"envmap_pars_vertex\"],\r\n      THREE.ShaderChunk[\"color_pars_vertex\"],\r\n      THREE.ShaderChunk[\"morphtarget_pars_vertex\"],\r\n      THREE.ShaderChunk[\"skinning_pars_vertex\"],\r\n      THREE.ShaderChunk[\"shadowmap_pars_vertex\"],\r\n      THREE.ShaderChunk[\"logdepthbuf_pars_vertex\"],\r\n\r\n      \"void main() {\",\r\n\r\n      THREE.ShaderChunk[\"map_vertex\"],\r\n      THREE.ShaderChunk[\"lightmap_vertex\"],\r\n      THREE.ShaderChunk[\"color_vertex\"],\r\n      THREE.ShaderChunk[\"skinbase_vertex\"],\r\n\r\n      \"\t#ifdef USE_ENVMAP\",\r\n\r\n      THREE.ShaderChunk[\"morphnormal_vertex\"],\r\n      THREE.ShaderChunk[\"skinnormal_vertex\"],\r\n      THREE.ShaderChunk[\"defaultnormal_vertex\"],\r\n\r\n      \"\t#endif\",\r\n\r\n      THREE.ShaderChunk[\"morphtarget_vertex\"],\r\n      THREE.ShaderChunk[\"skinning_vertex\"],\r\n      THREE.ShaderChunk[\"default_vertex\"],\r\n      THREE.ShaderChunk[\"logdepthbuf_vertex\"],\r\n\r\n      THREE.ShaderChunk[\"worldpos_vertex\"],\r\n      THREE.ShaderChunk[\"envmap_vertex\"],\r\n      THREE.ShaderChunk[\"shadowmap_vertex\"],\r\n\r\n      \"}\"\r\n\r\n    ].join(\"\\n\"),\r\n\r\n    fragmentShader: [\r\n\r\n      \"uniform vec3 diffuse;\",\r\n      \"uniform float opacity;\",\r\n\r\n      THREE.ShaderChunk[\"common\"],\r\n      THREE.ShaderChunk[\"color_pars_fragment\"],\r\n      THREE.ShaderChunk[\"map_pars_fragment\"],\r\n      THREE.ShaderChunk[\"alphamap_pars_fragment\"],\r\n      THREE.ShaderChunk[\"lightmap_pars_fragment\"],\r\n      THREE.ShaderChunk[\"envmap_pars_fragment\"],\r\n      THREE.ShaderChunk[\"fog_pars_fragment\"],\r\n      THREE.ShaderChunk[\"shadowmap_pars_fragment\"],\r\n      THREE.ShaderChunk[\"specularmap_pars_fragment\"],\r\n      THREE.ShaderChunk[\"logdepthbuf_pars_fragment\"],\r\n\r\n      \"void main() {\",\r\n\r\n      \"\tvec3 outgoingLight = vec3( 0.0 );\", // outgoing light does not have an alpha, the surface does\r\n      \"\tvec4 diffuseColor = vec4( diffuse, opacity );\",\r\n\r\n      THREE.ShaderChunk[\"logdepthbuf_fragment\"],\r\n      THREE.ShaderChunk[\"map_fragment\"],\r\n      THREE.ShaderChunk[\"color_fragment\"],\r\n      THREE.ShaderChunk[\"alphamap_fragment\"],\r\n      THREE.ShaderChunk[\"alphatest_fragment\"],\r\n      THREE.ShaderChunk[\"specularmap_fragment\"],\r\n\r\n      \"\toutgoingLight = diffuseColor.rgb;\", // simple shader\r\n\r\n      THREE.ShaderChunk[\"lightmap_fragment\"], // TODO: Light map on an otherwise unlit surface doesn't make sense.\r\n      THREE.ShaderChunk[\"envmap_fragment\"],\r\n      THREE.ShaderChunk[\"shadowmap_fragment\"], // TODO: Shadows on an otherwise unlit surface doesn't make sense.\r\n\r\n      THREE.ShaderChunk[\"linear_to_gamma_fragment\"],\r\n\r\n      THREE.ShaderChunk[\"fog_fragment\"],\r\n\r\n      \"\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\", // TODO, this should be pre-multiplied to allow for bright highlights on very transparent objects\r\n\r\n      \"}\"\r\n\r\n    ].join(\"\\n\")\r\n\r\n  },\r\n\r\n  'lambert': {\r\n\r\n    uniforms: THREE.UniformsUtils.merge([\r\n\r\n      THREE.UniformsLib[\"common\"],\r\n      THREE.UniformsLib[\"fog\"],\r\n      THREE.UniformsLib[\"lights\"],\r\n      THREE.UniformsLib[\"shadowmap\"],\r\n\r\n      {\r\n        \"emissive\": {\r\n          type: \"c\",\r\n          value: new THREE.Color(0x000000)\r\n        },\r\n        \"wrapRGB\": {\r\n          type: \"v3\",\r\n          value: new THREE.Vector3(1, 1, 1)\r\n        }\r\n      }\r\n\r\n    ]),\r\n\r\n    vertexShader: [\r\n\r\n      \"#define LAMBERT\",\r\n\r\n      \"varying vec3 vLightFront;\",\r\n\r\n      \"#ifdef DOUBLE_SIDED\",\r\n\r\n      \"\tvarying vec3 vLightBack;\",\r\n\r\n      \"#endif\",\r\n\r\n      THREE.ShaderChunk[\"common\"],\r\n      THREE.ShaderChunk[\"map_pars_vertex\"],\r\n      THREE.ShaderChunk[\"lightmap_pars_vertex\"],\r\n      THREE.ShaderChunk[\"envmap_pars_vertex\"],\r\n      THREE.ShaderChunk[\"lights_lambert_pars_vertex\"],\r\n      THREE.ShaderChunk[\"color_pars_vertex\"],\r\n      THREE.ShaderChunk[\"morphtarget_pars_vertex\"],\r\n      THREE.ShaderChunk[\"skinning_pars_vertex\"],\r\n      THREE.ShaderChunk[\"shadowmap_pars_vertex\"],\r\n      THREE.ShaderChunk[\"logdepthbuf_pars_vertex\"],\r\n\r\n      \"void main() {\",\r\n\r\n      THREE.ShaderChunk[\"map_vertex\"],\r\n      THREE.ShaderChunk[\"lightmap_vertex\"],\r\n      THREE.ShaderChunk[\"color_vertex\"],\r\n\r\n      THREE.ShaderChunk[\"morphnormal_vertex\"],\r\n      THREE.ShaderChunk[\"skinbase_vertex\"],\r\n      THREE.ShaderChunk[\"skinnormal_vertex\"],\r\n      THREE.ShaderChunk[\"defaultnormal_vertex\"],\r\n\r\n      THREE.ShaderChunk[\"morphtarget_vertex\"],\r\n      THREE.ShaderChunk[\"skinning_vertex\"],\r\n      THREE.ShaderChunk[\"default_vertex\"],\r\n      THREE.ShaderChunk[\"logdepthbuf_vertex\"],\r\n\r\n      THREE.ShaderChunk[\"worldpos_vertex\"],\r\n      THREE.ShaderChunk[\"envmap_vertex\"],\r\n      THREE.ShaderChunk[\"lights_lambert_vertex\"],\r\n      THREE.ShaderChunk[\"shadowmap_vertex\"],\r\n\r\n      \"}\"\r\n\r\n    ].join(\"\\n\"),\r\n\r\n    fragmentShader: [\r\n\r\n      \"uniform vec3 diffuse;\",\r\n      \"uniform vec3 emissive;\",\r\n      \"uniform float opacity;\",\r\n\r\n      \"varying vec3 vLightFront;\",\r\n\r\n      \"#ifdef DOUBLE_SIDED\",\r\n\r\n      \"\tvarying vec3 vLightBack;\",\r\n\r\n      \"#endif\",\r\n\r\n      THREE.ShaderChunk[\"common\"],\r\n      THREE.ShaderChunk[\"color_pars_fragment\"],\r\n      THREE.ShaderChunk[\"map_pars_fragment\"],\r\n      THREE.ShaderChunk[\"alphamap_pars_fragment\"],\r\n      THREE.ShaderChunk[\"lightmap_pars_fragment\"],\r\n      THREE.ShaderChunk[\"envmap_pars_fragment\"],\r\n      THREE.ShaderChunk[\"fog_pars_fragment\"],\r\n      THREE.ShaderChunk[\"shadowmap_pars_fragment\"],\r\n      THREE.ShaderChunk[\"specularmap_pars_fragment\"],\r\n      THREE.ShaderChunk[\"logdepthbuf_pars_fragment\"],\r\n\r\n      \"void main() {\",\r\n\r\n      \"\tvec3 outgoingLight = vec3( 0.0 );\", // outgoing light does not have an alpha, the surface does\r\n      \"\tvec4 diffuseColor = vec4( diffuse, opacity );\",\r\n\r\n      THREE.ShaderChunk[\"logdepthbuf_fragment\"],\r\n      THREE.ShaderChunk[\"map_fragment\"],\r\n      THREE.ShaderChunk[\"color_fragment\"],\r\n      THREE.ShaderChunk[\"alphamap_fragment\"],\r\n      THREE.ShaderChunk[\"alphatest_fragment\"],\r\n      THREE.ShaderChunk[\"specularmap_fragment\"],\r\n\r\n      \"\t#ifdef DOUBLE_SIDED\",\r\n\r\n      //\"float isFront = float( gl_FrontFacing );\",\r\n      //\"gl_FragColor.xyz *= isFront * vLightFront + ( 1.0 - isFront ) * vLightBack;\",\r\n\r\n      \"\t\tif ( gl_FrontFacing )\",\r\n      \"\t\t\toutgoingLight += diffuseColor.rgb * vLightFront + emissive;\",\r\n      \"\t\telse\",\r\n      \"\t\t\toutgoingLight += diffuseColor.rgb * vLightBack + emissive;\",\r\n\r\n      \"\t#else\",\r\n\r\n      \"\t\toutgoingLight += diffuseColor.rgb * vLightFront + emissive;\",\r\n\r\n      \"\t#endif\",\r\n\r\n      THREE.ShaderChunk[\"lightmap_fragment\"],\r\n      THREE.ShaderChunk[\"envmap_fragment\"],\r\n      THREE.ShaderChunk[\"shadowmap_fragment\"],\r\n\r\n      THREE.ShaderChunk[\"linear_to_gamma_fragment\"],\r\n\r\n      THREE.ShaderChunk[\"fog_fragment\"],\r\n\r\n      \"\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\", // TODO, this should be pre-multiplied to allow for bright highlights on very transparent objects\r\n\r\n      \"}\"\r\n\r\n    ].join(\"\\n\")\r\n\r\n  },\r\n\r\n  'phong': {\r\n\r\n    uniforms: THREE.UniformsUtils.merge([\r\n\r\n      THREE.UniformsLib[\"common\"],\r\n      THREE.UniformsLib[\"bump\"],\r\n      THREE.UniformsLib[\"normalmap\"],\r\n      THREE.UniformsLib[\"fog\"],\r\n      THREE.UniformsLib[\"lights\"],\r\n      THREE.UniformsLib[\"shadowmap\"],\r\n\r\n      {\r\n        \"emissive\": {\r\n          type: \"c\",\r\n          value: new THREE.Color(0x000000)\r\n        },\r\n        \"specular\": {\r\n          type: \"c\",\r\n          value: new THREE.Color(0x111111)\r\n        },\r\n        \"shininess\": {\r\n          type: \"f\",\r\n          value: 30\r\n        },\r\n        \"wrapRGB\": {\r\n          type: \"v3\",\r\n          value: new THREE.Vector3(1, 1, 1)\r\n        }\r\n      }\r\n\r\n    ]),\r\n\r\n    vertexShader: [\r\n\r\n      \"#define PHONG\",\r\n\r\n      \"varying vec3 vViewPosition;\",\r\n\r\n      \"#ifndef FLAT_SHADED\",\r\n\r\n      \"\tvarying vec3 vNormal;\",\r\n\r\n      \"#endif\",\r\n\r\n      THREE.ShaderChunk[\"common\"],\r\n      THREE.ShaderChunk[\"map_pars_vertex\"],\r\n      THREE.ShaderChunk[\"lightmap_pars_vertex\"],\r\n      THREE.ShaderChunk[\"envmap_pars_vertex\"],\r\n      THREE.ShaderChunk[\"lights_phong_pars_vertex\"],\r\n      THREE.ShaderChunk[\"color_pars_vertex\"],\r\n      THREE.ShaderChunk[\"morphtarget_pars_vertex\"],\r\n      THREE.ShaderChunk[\"skinning_pars_vertex\"],\r\n      THREE.ShaderChunk[\"shadowmap_pars_vertex\"],\r\n      THREE.ShaderChunk[\"logdepthbuf_pars_vertex\"],\r\n\r\n      \"void main() {\",\r\n\r\n      THREE.ShaderChunk[\"map_vertex\"],\r\n      THREE.ShaderChunk[\"lightmap_vertex\"],\r\n      THREE.ShaderChunk[\"color_vertex\"],\r\n\r\n      THREE.ShaderChunk[\"morphnormal_vertex\"],\r\n      THREE.ShaderChunk[\"skinbase_vertex\"],\r\n      THREE.ShaderChunk[\"skinnormal_vertex\"],\r\n      THREE.ShaderChunk[\"defaultnormal_vertex\"],\r\n\r\n      \"#ifndef FLAT_SHADED\", // Normal computed with derivatives when FLAT_SHADED\r\n\r\n      \"\tvNormal = normalize( transformedNormal );\",\r\n\r\n      \"#endif\",\r\n\r\n      THREE.ShaderChunk[\"morphtarget_vertex\"],\r\n      THREE.ShaderChunk[\"skinning_vertex\"],\r\n      THREE.ShaderChunk[\"default_vertex\"],\r\n      THREE.ShaderChunk[\"logdepthbuf_vertex\"],\r\n\r\n      \"\tvViewPosition = -mvPosition.xyz;\",\r\n\r\n      THREE.ShaderChunk[\"worldpos_vertex\"],\r\n      THREE.ShaderChunk[\"envmap_vertex\"],\r\n      THREE.ShaderChunk[\"lights_phong_vertex\"],\r\n      THREE.ShaderChunk[\"shadowmap_vertex\"],\r\n\r\n      \"}\"\r\n\r\n    ].join(\"\\n\"),\r\n\r\n    fragmentShader: [\r\n\r\n      \"#define PHONG\",\r\n\r\n      \"uniform vec3 diffuse;\",\r\n      \"uniform vec3 emissive;\",\r\n      \"uniform vec3 specular;\",\r\n      \"uniform float shininess;\",\r\n      \"uniform float opacity;\",\r\n\r\n      THREE.ShaderChunk[\"common\"],\r\n      THREE.ShaderChunk[\"color_pars_fragment\"],\r\n      THREE.ShaderChunk[\"map_pars_fragment\"],\r\n      THREE.ShaderChunk[\"alphamap_pars_fragment\"],\r\n      THREE.ShaderChunk[\"lightmap_pars_fragment\"],\r\n      THREE.ShaderChunk[\"envmap_pars_fragment\"],\r\n      THREE.ShaderChunk[\"fog_pars_fragment\"],\r\n      THREE.ShaderChunk[\"lights_phong_pars_fragment\"],\r\n      THREE.ShaderChunk[\"shadowmap_pars_fragment\"],\r\n      THREE.ShaderChunk[\"bumpmap_pars_fragment\"],\r\n      THREE.ShaderChunk[\"normalmap_pars_fragment\"],\r\n      THREE.ShaderChunk[\"specularmap_pars_fragment\"],\r\n      THREE.ShaderChunk[\"logdepthbuf_pars_fragment\"],\r\n\r\n      \"void main() {\",\r\n\r\n      \"\tvec3 outgoingLight = vec3( 0.0 );\", // outgoing light does not have an alpha, the surface does\r\n      \"\tvec4 diffuseColor = vec4( diffuse, opacity );\",\r\n\r\n      THREE.ShaderChunk[\"logdepthbuf_fragment\"],\r\n      THREE.ShaderChunk[\"map_fragment\"],\r\n      THREE.ShaderChunk[\"color_fragment\"],\r\n      THREE.ShaderChunk[\"alphamap_fragment\"],\r\n      THREE.ShaderChunk[\"alphatest_fragment\"],\r\n      THREE.ShaderChunk[\"specularmap_fragment\"],\r\n\r\n      THREE.ShaderChunk[\"lights_phong_fragment\"],\r\n\r\n      THREE.ShaderChunk[\"lightmap_fragment\"],\r\n      THREE.ShaderChunk[\"envmap_fragment\"],\r\n      THREE.ShaderChunk[\"shadowmap_fragment\"],\r\n\r\n      THREE.ShaderChunk[\"linear_to_gamma_fragment\"],\r\n\r\n      THREE.ShaderChunk[\"fog_fragment\"],\r\n\r\n      \"\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\", // TODO, this should be pre-multiplied to allow for bright highlights on very transparent objects\r\n\r\n      \"}\"\r\n\r\n    ].join(\"\\n\")\r\n\r\n  },\r\n\r\n  'particle_basic': {\r\n\r\n    uniforms: THREE.UniformsUtils.merge([\r\n\r\n      THREE.UniformsLib[\"particle\"],\r\n      THREE.UniformsLib[\"shadowmap\"]\r\n\r\n    ]),\r\n\r\n    vertexShader: [\r\n\r\n      \"uniform float size;\",\r\n      \"uniform float scale;\",\r\n\r\n      THREE.ShaderChunk[\"common\"],\r\n      THREE.ShaderChunk[\"color_pars_vertex\"],\r\n      THREE.ShaderChunk[\"shadowmap_pars_vertex\"],\r\n      THREE.ShaderChunk[\"logdepthbuf_pars_vertex\"],\r\n\r\n      \"void main() {\",\r\n\r\n      THREE.ShaderChunk[\"color_vertex\"],\r\n\r\n      \"\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\",\r\n\r\n      \"\t#ifdef USE_SIZEATTENUATION\",\r\n      \"\t\tgl_PointSize = size * ( scale / length( mvPosition.xyz ) );\",\r\n      \"\t#else\",\r\n      \"\t\tgl_PointSize = size;\",\r\n      \"\t#endif\",\r\n\r\n      \"\tgl_Position = projectionMatrix * mvPosition;\",\r\n\r\n      THREE.ShaderChunk[\"logdepthbuf_vertex\"],\r\n      THREE.ShaderChunk[\"worldpos_vertex\"],\r\n      THREE.ShaderChunk[\"shadowmap_vertex\"],\r\n\r\n      \"}\"\r\n\r\n    ].join(\"\\n\"),\r\n\r\n    fragmentShader: [\r\n\r\n      \"uniform vec3 psColor;\",\r\n      \"uniform float opacity;\",\r\n\r\n      THREE.ShaderChunk[\"common\"],\r\n      THREE.ShaderChunk[\"color_pars_fragment\"],\r\n      THREE.ShaderChunk[\"map_particle_pars_fragment\"],\r\n      THREE.ShaderChunk[\"fog_pars_fragment\"],\r\n      THREE.ShaderChunk[\"shadowmap_pars_fragment\"],\r\n      THREE.ShaderChunk[\"logdepthbuf_pars_fragment\"],\r\n\r\n      \"void main() {\",\r\n\r\n      \"\tvec3 outgoingLight = vec3( 0.0 );\", // outgoing light does not have an alpha, the surface does\r\n      \"\tvec4 diffuseColor = vec4( psColor, opacity );\",\r\n\r\n      THREE.ShaderChunk[\"logdepthbuf_fragment\"],\r\n      THREE.ShaderChunk[\"map_particle_fragment\"],\r\n      THREE.ShaderChunk[\"color_fragment\"],\r\n      THREE.ShaderChunk[\"alphatest_fragment\"],\r\n\r\n      \"\toutgoingLight = diffuseColor.rgb;\", // simple shader\r\n\r\n      THREE.ShaderChunk[\"shadowmap_fragment\"],\r\n      THREE.ShaderChunk[\"fog_fragment\"],\r\n\r\n      \"\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\", // TODO, this should be pre-multiplied to allow for bright highlights on very transparent objects\r\n\r\n      \"}\"\r\n\r\n    ].join(\"\\n\")\r\n\r\n  },\r\n\r\n  'dashed': {\r\n\r\n    uniforms: THREE.UniformsUtils.merge([\r\n\r\n      THREE.UniformsLib[\"common\"],\r\n      THREE.UniformsLib[\"fog\"],\r\n\r\n      {\r\n        \"scale\": {\r\n          type: \"f\",\r\n          value: 1\r\n        },\r\n        \"dashSize\": {\r\n          type: \"f\",\r\n          value: 1\r\n        },\r\n        \"totalSize\": {\r\n          type: \"f\",\r\n          value: 2\r\n        }\r\n      }\r\n\r\n    ]),\r\n\r\n    vertexShader: [\r\n\r\n      \"uniform float scale;\",\r\n      \"attribute float lineDistance;\",\r\n\r\n      \"varying float vLineDistance;\",\r\n\r\n      THREE.ShaderChunk[\"common\"],\r\n      THREE.ShaderChunk[\"color_pars_vertex\"],\r\n      THREE.ShaderChunk[\"logdepthbuf_pars_vertex\"],\r\n\r\n      \"void main() {\",\r\n\r\n      THREE.ShaderChunk[\"color_vertex\"],\r\n\r\n      \"\tvLineDistance = scale * lineDistance;\",\r\n\r\n      \"\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\",\r\n      \"\tgl_Position = projectionMatrix * mvPosition;\",\r\n\r\n      THREE.ShaderChunk[\"logdepthbuf_vertex\"],\r\n\r\n      \"}\"\r\n\r\n    ].join(\"\\n\"),\r\n\r\n    fragmentShader: [\r\n\r\n      \"uniform vec3 diffuse;\",\r\n      \"uniform float opacity;\",\r\n\r\n      \"uniform float dashSize;\",\r\n      \"uniform float totalSize;\",\r\n\r\n      \"varying float vLineDistance;\",\r\n\r\n      THREE.ShaderChunk[\"common\"],\r\n      THREE.ShaderChunk[\"color_pars_fragment\"],\r\n      THREE.ShaderChunk[\"fog_pars_fragment\"],\r\n      THREE.ShaderChunk[\"logdepthbuf_pars_fragment\"],\r\n\r\n      \"void main() {\",\r\n\r\n      \"\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\",\r\n\r\n      \"\t\tdiscard;\",\r\n\r\n      \"\t}\",\r\n\r\n      \"\tvec3 outgoingLight = vec3( 0.0 );\", // outgoing light does not have an alpha, the surface does\r\n      \"\tvec4 diffuseColor = vec4( diffuse, opacity );\",\r\n\r\n      THREE.ShaderChunk[\"logdepthbuf_fragment\"],\r\n      THREE.ShaderChunk[\"color_fragment\"],\r\n\r\n      \"\toutgoingLight = diffuseColor.rgb;\", // simple shader\r\n\r\n      THREE.ShaderChunk[\"fog_fragment\"],\r\n\r\n      \"\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\", // TODO, this should be pre-multiplied to allow for bright highlights on very transparent objects\r\n\r\n      \"}\"\r\n\r\n    ].join(\"\\n\")\r\n\r\n  },\r\n\r\n  'depth': {\r\n\r\n    uniforms: {\r\n\r\n      \"mNear\": {\r\n        type: \"f\",\r\n        value: 1.0\r\n      },\r\n      \"mFar\": {\r\n        type: \"f\",\r\n        value: 2000.0\r\n      },\r\n      \"opacity\": {\r\n        type: \"f\",\r\n        value: 1.0\r\n      }\r\n\r\n    },\r\n\r\n    vertexShader: [\r\n\r\n      THREE.ShaderChunk[\"common\"],\r\n      THREE.ShaderChunk[\"morphtarget_pars_vertex\"],\r\n      THREE.ShaderChunk[\"logdepthbuf_pars_vertex\"],\r\n\r\n      \"void main() {\",\r\n\r\n      THREE.ShaderChunk[\"morphtarget_vertex\"],\r\n      THREE.ShaderChunk[\"default_vertex\"],\r\n      THREE.ShaderChunk[\"logdepthbuf_vertex\"],\r\n\r\n      \"}\"\r\n\r\n    ].join(\"\\n\"),\r\n\r\n    fragmentShader: [\r\n\r\n      \"uniform float mNear;\",\r\n      \"uniform float mFar;\",\r\n      \"uniform float opacity;\",\r\n\r\n      THREE.ShaderChunk[\"common\"],\r\n      THREE.ShaderChunk[\"logdepthbuf_pars_fragment\"],\r\n\r\n      \"void main() {\",\r\n\r\n      THREE.ShaderChunk[\"logdepthbuf_fragment\"],\r\n\r\n      \"\t#ifdef USE_LOGDEPTHBUF_EXT\",\r\n\r\n      \"\t\tfloat depth = gl_FragDepthEXT / gl_FragCoord.w;\",\r\n\r\n      \"\t#else\",\r\n\r\n      \"\t\tfloat depth = gl_FragCoord.z / gl_FragCoord.w;\",\r\n\r\n      \"\t#endif\",\r\n\r\n      \"\tfloat color = 1.0 - smoothstep( mNear, mFar, depth );\",\r\n      \"\tgl_FragColor = vec4( vec3( color ), opacity );\", // TODO, this should be pre-multiplied to allow for bright highlights on very transparent objects\r\n\r\n      \"}\"\r\n\r\n    ].join(\"\\n\")\r\n\r\n  },\r\n\r\n  'normal': {\r\n\r\n    uniforms: {\r\n\r\n      \"opacity\": {\r\n        type: \"f\",\r\n        value: 1.0\r\n      }\r\n\r\n    },\r\n\r\n    vertexShader: [\r\n\r\n      \"varying vec3 vNormal;\",\r\n\r\n      THREE.ShaderChunk[\"common\"],\r\n      THREE.ShaderChunk[\"morphtarget_pars_vertex\"],\r\n      THREE.ShaderChunk[\"logdepthbuf_pars_vertex\"],\r\n\r\n      \"void main() {\",\r\n\r\n      \"\tvNormal = normalize( normalMatrix * normal );\",\r\n\r\n      THREE.ShaderChunk[\"morphtarget_vertex\"],\r\n      THREE.ShaderChunk[\"default_vertex\"],\r\n      THREE.ShaderChunk[\"logdepthbuf_vertex\"],\r\n\r\n      \"}\"\r\n\r\n    ].join(\"\\n\"),\r\n\r\n    fragmentShader: [\r\n\r\n      \"uniform float opacity;\",\r\n      \"varying vec3 vNormal;\",\r\n\r\n      THREE.ShaderChunk[\"common\"],\r\n      THREE.ShaderChunk[\"logdepthbuf_pars_fragment\"],\r\n\r\n      \"void main() {\",\r\n\r\n      \"\tgl_FragColor = vec4( 0.5 * normalize( vNormal ) + 0.5, opacity );\",\r\n\r\n      THREE.ShaderChunk[\"logdepthbuf_fragment\"],\r\n\r\n      \"}\"\r\n\r\n    ].join(\"\\n\")\r\n\r\n  },\r\n\r\n  /* -------------------------------------------------------------------------\r\n  //\tCube map shader\r\n   ------------------------------------------------------------------------- */\r\n\r\n  'cube': {\r\n\r\n    uniforms: {\r\n      \"tCube\": {\r\n        type: \"t\",\r\n        value: null\r\n      },\r\n      \"tFlip\": {\r\n        type: \"f\",\r\n        value: -1\r\n      }\r\n    },\r\n\r\n    vertexShader: [\r\n\r\n      \"varying vec3 vWorldPosition;\",\r\n\r\n      THREE.ShaderChunk[\"common\"],\r\n      THREE.ShaderChunk[\"logdepthbuf_pars_vertex\"],\r\n\r\n      \"void main() {\",\r\n\r\n      \"\tvWorldPosition = transformDirection( position, modelMatrix );\",\r\n\r\n      \"\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\",\r\n\r\n      THREE.ShaderChunk[\"logdepthbuf_vertex\"],\r\n\r\n      \"}\"\r\n\r\n    ].join(\"\\n\"),\r\n\r\n    fragmentShader: [\r\n\r\n      \"uniform samplerCube tCube;\",\r\n      \"uniform float tFlip;\",\r\n\r\n      \"varying vec3 vWorldPosition;\",\r\n\r\n      THREE.ShaderChunk[\"common\"],\r\n      THREE.ShaderChunk[\"logdepthbuf_pars_fragment\"],\r\n\r\n      \"void main() {\",\r\n\r\n      \"\tgl_FragColor = textureCube( tCube, vec3( tFlip * vWorldPosition.x, vWorldPosition.yz ) );\",\r\n\r\n      THREE.ShaderChunk[\"logdepthbuf_fragment\"],\r\n\r\n      \"}\"\r\n\r\n    ].join(\"\\n\")\r\n\r\n  },\r\n\r\n  /* -------------------------------------------------------------------------\r\n  //\tCube map shader\r\n   ------------------------------------------------------------------------- */\r\n\r\n  'equirect': {\r\n\r\n    uniforms: {\r\n      \"tEquirect\": {\r\n        type: \"t\",\r\n        value: null\r\n      },\r\n      \"tFlip\": {\r\n        type: \"f\",\r\n        value: -1\r\n      }\r\n    },\r\n\r\n    vertexShader: [\r\n\r\n      \"varying vec3 vWorldPosition;\",\r\n\r\n      THREE.ShaderChunk[\"common\"],\r\n      THREE.ShaderChunk[\"logdepthbuf_pars_vertex\"],\r\n\r\n      \"void main() {\",\r\n\r\n      \"\tvWorldPosition = transformDirection( position, modelMatrix );\",\r\n\r\n      \"\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\",\r\n\r\n      THREE.ShaderChunk[\"logdepthbuf_vertex\"],\r\n\r\n      \"}\"\r\n\r\n    ].join(\"\\n\"),\r\n\r\n    fragmentShader: [\r\n\r\n      \"uniform sampler2D tEquirect;\",\r\n      \"uniform float tFlip;\",\r\n\r\n      \"varying vec3 vWorldPosition;\",\r\n\r\n      THREE.ShaderChunk[\"common\"],\r\n      THREE.ShaderChunk[\"logdepthbuf_pars_fragment\"],\r\n\r\n      \"void main() {\",\r\n\r\n      // \"\tgl_FragColor = textureCube( tCube, vec3( tFlip * vWorldPosition.x, vWorldPosition.yz ) );\",\r\n      \"vec3 direction = normalize( vWorldPosition );\",\r\n      \"vec2 sampleUV;\",\r\n      \"sampleUV.y = saturate( tFlip * direction.y * -0.5 + 0.5 );\",\r\n      \"sampleUV.x = atan( direction.z, direction.x ) * RECIPROCAL_PI2 + 0.5;\",\r\n      \"gl_FragColor = texture2D( tEquirect, sampleUV );\",\r\n\r\n      THREE.ShaderChunk[\"logdepthbuf_fragment\"],\r\n\r\n      \"}\"\r\n\r\n    ].join(\"\\n\")\r\n\r\n  },\r\n\r\n  /* Depth encoding into RGBA texture\r\n   *\r\n   * based on SpiderGL shadow map example\r\n   * http://spidergl.org/example.php?id=6\r\n   *\r\n   * originally from\r\n   * http://www.gamedev.net/topic/442138-packing-a-float-into-a-a8r8g8b8-texture-shader/page__whichpage__1%25EF%25BF%25BD\r\n   *\r\n   * see also\r\n   * http://aras-p.info/blog/2009/07/30/encoding-floats-to-rgba-the-final/\r\n   */\r\n\r\n  'depthRGBA': {\r\n\r\n    uniforms: {},\r\n\r\n    vertexShader: [\r\n\r\n      THREE.ShaderChunk[\"common\"],\r\n      THREE.ShaderChunk[\"morphtarget_pars_vertex\"],\r\n      THREE.ShaderChunk[\"skinning_pars_vertex\"],\r\n      THREE.ShaderChunk[\"logdepthbuf_pars_vertex\"],\r\n\r\n      \"void main() {\",\r\n\r\n      THREE.ShaderChunk[\"skinbase_vertex\"],\r\n      THREE.ShaderChunk[\"morphtarget_vertex\"],\r\n      THREE.ShaderChunk[\"skinning_vertex\"],\r\n      THREE.ShaderChunk[\"default_vertex\"],\r\n      THREE.ShaderChunk[\"logdepthbuf_vertex\"],\r\n\r\n      \"}\"\r\n\r\n    ].join(\"\\n\"),\r\n\r\n    fragmentShader: [\r\n\r\n      THREE.ShaderChunk[\"common\"],\r\n      THREE.ShaderChunk[\"logdepthbuf_pars_fragment\"],\r\n\r\n      \"vec4 pack_depth( const in float depth ) {\",\r\n\r\n      \"\tconst vec4 bit_shift = vec4( 256.0 * 256.0 * 256.0, 256.0 * 256.0, 256.0, 1.0 );\",\r\n      \"\tconst vec4 bit_mask = vec4( 0.0, 1.0 / 256.0, 1.0 / 256.0, 1.0 / 256.0 );\",\r\n      \"\tvec4 res = mod( depth * bit_shift * vec4( 255 ), vec4( 256 ) ) / vec4( 255 );\", // \"\tvec4 res = fract( depth * bit_shift );\",\r\n      \"\tres -= res.xxyz * bit_mask;\",\r\n      \"\treturn res;\",\r\n\r\n      \"}\",\r\n\r\n      \"void main() {\",\r\n\r\n      THREE.ShaderChunk[\"logdepthbuf_fragment\"],\r\n\r\n      \"\t#ifdef USE_LOGDEPTHBUF_EXT\",\r\n\r\n      \"\t\tgl_FragData[ 0 ] = pack_depth( gl_FragDepthEXT );\",\r\n\r\n      \"\t#else\",\r\n\r\n      \"\t\tgl_FragData[ 0 ] = pack_depth( gl_FragCoord.z );\",\r\n\r\n      \"\t#endif\",\r\n\r\n      //\"gl_FragData[ 0 ] = pack_depth( gl_FragCoord.z / gl_FragCoord.w );\",\r\n      //\"float z = ( ( gl_FragCoord.z / gl_FragCoord.w ) - 3.0 ) / ( 4000.0 - 3.0 );\",\r\n      //\"gl_FragData[ 0 ] = pack_depth( z );\",\r\n      //\"gl_FragData[ 0 ] = vec4( z, z, z, 1.0 );\",\r\n\r\n      \"}\"\r\n\r\n    ].join(\"\\n\")\r\n\r\n  }\r\n\r\n};\r\n\r\n// File:src/renderers/WebGLRenderer.js\r\n\r\n/**\r\n * @author supereggbert / http://www.paulbrunt.co.uk/\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author alteredq / http://alteredqualia.com/\r\n * @author szimek / https://github.com/szimek/\r\n */\r\n\r\nTHREE.WebGLRenderer = function(parameters) {\r\n\r\n  console.log('THREE.WebGLRenderer', THREE.REVISION);\r\n\r\n  parameters = parameters || {};\r\n\r\n  var _canvas = parameters.canvas !== undefined ? parameters.canvas : document.createElement('canvas'),\r\n    _context = parameters.context !== undefined ? parameters.context : null,\r\n\r\n    pixelRatio = 1,\r\n\r\n    _precision = parameters.precision !== undefined ? parameters.precision : 'highp',\r\n\r\n    _alpha = parameters.alpha !== undefined ? parameters.alpha : false,\r\n    _depth = parameters.depth !== undefined ? parameters.depth : true,\r\n    _stencil = parameters.stencil !== undefined ? parameters.stencil : true,\r\n    _antialias = parameters.antialias !== undefined ? parameters.antialias : false,\r\n    _premultipliedAlpha = parameters.premultipliedAlpha !== undefined ? parameters.premultipliedAlpha : true,\r\n    _preserveDrawingBuffer = parameters.preserveDrawingBuffer !== undefined ? parameters.preserveDrawingBuffer : false,\r\n    _logarithmicDepthBuffer = parameters.logarithmicDepthBuffer !== undefined ? parameters.logarithmicDepthBuffer : false,\r\n\r\n    _clearColor = new THREE.Color(0x000000),\r\n    _clearAlpha = 0;\r\n\r\n  var lights = [];\r\n\r\n  var _webglObjects = {};\r\n  var _webglObjectsImmediate = [];\r\n\r\n  var opaqueObjects = [];\r\n  var transparentObjects = [];\r\n\r\n  var sprites = [];\r\n  var lensFlares = [];\r\n\r\n  // public properties\r\n\r\n  this.domElement = _canvas;\r\n  this.context = null;\r\n\r\n  // clearing\r\n\r\n  this.autoClear = true;\r\n  this.autoClearColor = true;\r\n  this.autoClearDepth = true;\r\n  this.autoClearStencil = true;\r\n\r\n  // scene graph\r\n\r\n  this.sortObjects = true;\r\n\r\n  // physically based shading\r\n\r\n  this.gammaFactor = 2.0; // for backwards compatibility\r\n  this.gammaInput = false;\r\n  this.gammaOutput = false;\r\n\r\n  // shadow map\r\n\r\n  this.shadowMapEnabled = false;\r\n  this.shadowMapType = THREE.PCFShadowMap;\r\n  this.shadowMapCullFace = THREE.CullFaceFront;\r\n  this.shadowMapDebug = false;\r\n  this.shadowMapCascade = false;\r\n\r\n  // morphs\r\n\r\n  this.maxMorphTargets = 8;\r\n  this.maxMorphNormals = 4;\r\n\r\n  // flags\r\n\r\n  this.autoScaleCubemaps = true;\r\n\r\n  // info\r\n\r\n  this.info = {\r\n\r\n    memory: {\r\n\r\n      programs: 0,\r\n      geometries: 0,\r\n      textures: 0\r\n\r\n    },\r\n\r\n    render: {\r\n\r\n      calls: 0,\r\n      vertices: 0,\r\n      faces: 0,\r\n      points: 0\r\n\r\n    }\r\n\r\n  };\r\n\r\n  // internal properties\r\n\r\n  var _this = this,\r\n\r\n    _programs = [],\r\n\r\n    // internal state cache\r\n\r\n    _currentProgram = null,\r\n    _currentFramebuffer = null,\r\n    _currentMaterialId = -1,\r\n    _currentGeometryProgram = '',\r\n    _currentCamera = null,\r\n\r\n    _usedTextureUnits = 0,\r\n\r\n    _viewportX = 0,\r\n    _viewportY = 0,\r\n    _viewportWidth = _canvas.width,\r\n    _viewportHeight = _canvas.height,\r\n    _currentWidth = 0,\r\n    _currentHeight = 0,\r\n\r\n    // frustum\r\n\r\n    _frustum = new THREE.Frustum(),\r\n\r\n    // camera matrices cache\r\n\r\n    _projScreenMatrix = new THREE.Matrix4(),\r\n\r\n    _vector3 = new THREE.Vector3(),\r\n\r\n    // light arrays cache\r\n\r\n    _direction = new THREE.Vector3(),\r\n\r\n    _lightsNeedUpdate = true,\r\n\r\n    _lights = {\r\n\r\n      ambient: [0, 0, 0],\r\n      directional: {\r\n        length: 0,\r\n        colors: [],\r\n        positions: []\r\n      },\r\n      point: {\r\n        length: 0,\r\n        colors: [],\r\n        positions: [],\r\n        distances: [],\r\n        decays: []\r\n      },\r\n      spot: {\r\n        length: 0,\r\n        colors: [],\r\n        positions: [],\r\n        distances: [],\r\n        directions: [],\r\n        anglesCos: [],\r\n        exponents: [],\r\n        decays: []\r\n      },\r\n      hemi: {\r\n        length: 0,\r\n        skyColors: [],\r\n        groundColors: [],\r\n        positions: []\r\n      }\r\n\r\n    };\r\n\r\n  // initialize\r\n\r\n  var _gl;\r\n\r\n  try {\r\n\r\n    var attributes = {\r\n      alpha: _alpha,\r\n      depth: _depth,\r\n      stencil: _stencil,\r\n      antialias: _antialias,\r\n      premultipliedAlpha: _premultipliedAlpha,\r\n      preserveDrawingBuffer: _preserveDrawingBuffer\r\n    };\r\n\r\n    _gl = _context || _canvas.getContext('webgl', attributes) || _canvas.getContext('experimental-webgl', attributes);\r\n\r\n    if (_gl === null) {\r\n\r\n      if (_canvas.getContext('webgl') !== null) {\r\n\r\n        throw 'Error creating WebGL context with your selected attributes.';\r\n\r\n      }\r\n      else {\r\n\r\n        throw 'Error creating WebGL context.';\r\n\r\n      }\r\n\r\n    }\r\n\r\n    _canvas.addEventListener('webglcontextlost', function(event) {\r\n\r\n      event.preventDefault();\r\n\r\n      resetGLState();\r\n      setDefaultGLState();\r\n\r\n      _webglObjects = {};\r\n\r\n    }, false);\r\n\r\n  }\r\n  catch (error) {\r\n\r\n    THREE.error('THREE.WebGLRenderer: ' + error);\r\n\r\n  }\r\n\r\n  var state = new THREE.WebGLState(_gl, paramThreeToGL);\r\n\r\n  if (_gl.getShaderPrecisionFormat === undefined) {\r\n\r\n    _gl.getShaderPrecisionFormat = function() {\r\n\r\n      return {\r\n        'rangeMin': 1,\r\n        'rangeMax': 1,\r\n        'precision': 1\r\n      };\r\n\r\n    }\r\n\r\n  }\r\n\r\n  var extensions = new THREE.WebGLExtensions(_gl);\r\n\r\n  extensions.get('OES_texture_float');\r\n  extensions.get('OES_texture_float_linear');\r\n  extensions.get('OES_texture_half_float');\r\n  extensions.get('OES_texture_half_float_linear');\r\n  extensions.get('OES_standard_derivatives');\r\n\r\n  if (_logarithmicDepthBuffer) {\r\n\r\n    extensions.get('EXT_frag_depth');\r\n\r\n  }\r\n\r\n  //\r\n\r\n  var glClearColor = function(r, g, b, a) {\r\n\r\n    if (_premultipliedAlpha === true) {\r\n\r\n      r *= a;\r\n      g *= a;\r\n      b *= a;\r\n\r\n    }\r\n\r\n    _gl.clearColor(r, g, b, a);\r\n\r\n  };\r\n\r\n  var setDefaultGLState = function() {\r\n\r\n    _gl.clearColor(0, 0, 0, 1);\r\n    _gl.clearDepth(1);\r\n    _gl.clearStencil(0);\r\n\r\n    _gl.enable(_gl.DEPTH_TEST);\r\n    _gl.depthFunc(_gl.LEQUAL);\r\n\r\n    _gl.frontFace(_gl.CCW);\r\n    _gl.cullFace(_gl.BACK);\r\n    _gl.enable(_gl.CULL_FACE);\r\n\r\n    _gl.enable(_gl.BLEND);\r\n    _gl.blendEquation(_gl.FUNC_ADD);\r\n    _gl.blendFunc(_gl.SRC_ALPHA, _gl.ONE_MINUS_SRC_ALPHA);\r\n\r\n    _gl.viewport(_viewportX, _viewportY, _viewportWidth, _viewportHeight);\r\n\r\n    glClearColor(_clearColor.r, _clearColor.g, _clearColor.b, _clearAlpha);\r\n\r\n  };\r\n\r\n  var resetGLState = function() {\r\n\r\n    _currentProgram = null;\r\n    _currentCamera = null;\r\n\r\n    _currentGeometryProgram = '';\r\n    _currentMaterialId = -1;\r\n\r\n    _lightsNeedUpdate = true;\r\n\r\n    state.reset();\r\n\r\n  };\r\n\r\n  setDefaultGLState();\r\n\r\n  this.context = _gl;\r\n  this.state = state;\r\n\r\n  // GPU capabilities\r\n\r\n  var _maxTextures = _gl.getParameter(_gl.MAX_TEXTURE_IMAGE_UNITS);\r\n  var _maxVertexTextures = _gl.getParameter(_gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS);\r\n  var _maxTextureSize = _gl.getParameter(_gl.MAX_TEXTURE_SIZE);\r\n  var _maxCubemapSize = _gl.getParameter(_gl.MAX_CUBE_MAP_TEXTURE_SIZE);\r\n\r\n  var _supportsVertexTextures = _maxVertexTextures > 0;\r\n  var _supportsBoneTextures = _supportsVertexTextures && extensions.get('OES_texture_float');\r\n\r\n  //\r\n\r\n  var _vertexShaderPrecisionHighpFloat = _gl.getShaderPrecisionFormat(_gl.VERTEX_SHADER, _gl.HIGH_FLOAT);\r\n  var _vertexShaderPrecisionMediumpFloat = _gl.getShaderPrecisionFormat(_gl.VERTEX_SHADER, _gl.MEDIUM_FLOAT);\r\n\r\n  var _fragmentShaderPrecisionHighpFloat = _gl.getShaderPrecisionFormat(_gl.FRAGMENT_SHADER, _gl.HIGH_FLOAT);\r\n  var _fragmentShaderPrecisionMediumpFloat = _gl.getShaderPrecisionFormat(_gl.FRAGMENT_SHADER, _gl.MEDIUM_FLOAT);\r\n\r\n  var getCompressedTextureFormats = (function() {\r\n\r\n    var array;\r\n\r\n    return function() {\r\n\r\n      if (array !== undefined) {\r\n\r\n        return array;\r\n\r\n      }\r\n\r\n      array = [];\r\n\r\n      if (extensions.get('WEBGL_compressed_texture_pvrtc') || extensions.get('WEBGL_compressed_texture_s3tc')) {\r\n\r\n        var formats = _gl.getParameter(_gl.COMPRESSED_TEXTURE_FORMATS);\r\n\r\n        for (var i = 0; i < formats.length; i++) {\r\n\r\n          array.push(formats[i]);\r\n\r\n        }\r\n\r\n      }\r\n\r\n      return array;\r\n\r\n    };\r\n\r\n  })();\r\n\r\n  // clamp precision to maximum available\r\n\r\n  var highpAvailable = _vertexShaderPrecisionHighpFloat.precision > 0 && _fragmentShaderPrecisionHighpFloat.precision > 0;\r\n  var mediumpAvailable = _vertexShaderPrecisionMediumpFloat.precision > 0 && _fragmentShaderPrecisionMediumpFloat.precision > 0;\r\n\r\n  if (_precision === 'highp' && !highpAvailable) {\r\n\r\n    if (mediumpAvailable) {\r\n\r\n      _precision = 'mediump';\r\n      THREE.warn('THREE.WebGLRenderer: highp not supported, using mediump.');\r\n\r\n    }\r\n    else {\r\n\r\n      _precision = 'lowp';\r\n      THREE.warn('THREE.WebGLRenderer: highp and mediump not supported, using lowp.');\r\n\r\n    }\r\n\r\n  }\r\n\r\n  if (_precision === 'mediump' && !mediumpAvailable) {\r\n\r\n    _precision = 'lowp';\r\n    THREE.warn('THREE.WebGLRenderer: mediump not supported, using lowp.');\r\n\r\n  }\r\n\r\n  // Plugins\r\n\r\n  var shadowMapPlugin = new THREE.ShadowMapPlugin(this, lights, _webglObjects, _webglObjectsImmediate);\r\n\r\n  var spritePlugin = new THREE.SpritePlugin(this, sprites);\r\n  var lensFlarePlugin = new THREE.LensFlarePlugin(this, lensFlares);\r\n\r\n  // API\r\n\r\n  this.getContext = function() {\r\n\r\n    return _gl;\r\n\r\n  };\r\n\r\n  this.forceContextLoss = function() {\r\n\r\n    extensions.get('WEBGL_lose_context').loseContext();\r\n\r\n  };\r\n\r\n  this.supportsVertexTextures = function() {\r\n\r\n    return _supportsVertexTextures;\r\n\r\n  };\r\n\r\n  this.supportsFloatTextures = function() {\r\n\r\n    return extensions.get('OES_texture_float');\r\n\r\n  };\r\n\r\n  this.supportsHalfFloatTextures = function() {\r\n\r\n    return extensions.get('OES_texture_half_float');\r\n\r\n  };\r\n\r\n  this.supportsStandardDerivatives = function() {\r\n\r\n    return extensions.get('OES_standard_derivatives');\r\n\r\n  };\r\n\r\n  this.supportsCompressedTextureS3TC = function() {\r\n\r\n    return extensions.get('WEBGL_compressed_texture_s3tc');\r\n\r\n  };\r\n\r\n  this.supportsCompressedTexturePVRTC = function() {\r\n\r\n    return extensions.get('WEBGL_compressed_texture_pvrtc');\r\n\r\n  };\r\n\r\n  this.supportsBlendMinMax = function() {\r\n\r\n    return extensions.get('EXT_blend_minmax');\r\n\r\n  };\r\n\r\n  this.getMaxAnisotropy = (function() {\r\n\r\n    var value;\r\n\r\n    return function() {\r\n\r\n      if (value !== undefined) {\r\n\r\n        return value;\r\n\r\n      }\r\n\r\n      var extension = extensions.get('EXT_texture_filter_anisotropic');\r\n\r\n      value = extension !== null ? _gl.getParameter(extension.MAX_TEXTURE_MAX_ANISOTROPY_EXT) : 0;\r\n\r\n      return value;\r\n\r\n    }\r\n\r\n  })();\r\n\r\n  this.getPrecision = function() {\r\n\r\n    return _precision;\r\n\r\n  };\r\n\r\n  this.getPixelRatio = function() {\r\n\r\n    return pixelRatio;\r\n\r\n  };\r\n\r\n  this.setPixelRatio = function(value) {\r\n\r\n    pixelRatio = value;\r\n\r\n  };\r\n\r\n  this.setSize = function(width, height, updateStyle) {\r\n\r\n    _canvas.width = width * pixelRatio;\r\n    _canvas.height = height * pixelRatio;\r\n\r\n    if (updateStyle !== false) {\r\n\r\n      _canvas.style.width = width + 'px';\r\n      _canvas.style.height = height + 'px';\r\n\r\n    }\r\n\r\n    this.setViewport(0, 0, width, height);\r\n\r\n  };\r\n\r\n  this.setViewport = function(x, y, width, height) {\r\n\r\n    _viewportX = x * pixelRatio;\r\n    _viewportY = y * pixelRatio;\r\n\r\n    _viewportWidth = width * pixelRatio;\r\n    _viewportHeight = height * pixelRatio;\r\n\r\n    _gl.viewport(_viewportX, _viewportY, _viewportWidth, _viewportHeight);\r\n\r\n  };\r\n\r\n  this.setScissor = function(x, y, width, height) {\r\n\r\n    _gl.scissor(\r\n      x * pixelRatio,\r\n      y * pixelRatio,\r\n      width * pixelRatio,\r\n      height * pixelRatio\r\n    );\r\n\r\n  };\r\n\r\n  this.enableScissorTest = function(enable) {\r\n\r\n    enable ? _gl.enable(_gl.SCISSOR_TEST) : _gl.disable(_gl.SCISSOR_TEST);\r\n\r\n  };\r\n\r\n  // Clearing\r\n\r\n  this.getClearColor = function() {\r\n\r\n    return _clearColor;\r\n\r\n  };\r\n\r\n  this.setClearColor = function(color, alpha) {\r\n\r\n    _clearColor.set(color);\r\n\r\n    _clearAlpha = alpha !== undefined ? alpha : 1;\r\n\r\n    glClearColor(_clearColor.r, _clearColor.g, _clearColor.b, _clearAlpha);\r\n\r\n  };\r\n\r\n  this.getClearAlpha = function() {\r\n\r\n    return _clearAlpha;\r\n\r\n  };\r\n\r\n  this.setClearAlpha = function(alpha) {\r\n\r\n    _clearAlpha = alpha;\r\n\r\n    glClearColor(_clearColor.r, _clearColor.g, _clearColor.b, _clearAlpha);\r\n\r\n  };\r\n\r\n  this.clear = function(color, depth, stencil) {\r\n\r\n    var bits = 0;\r\n\r\n    if (color === undefined || color) bits |= _gl.COLOR_BUFFER_BIT;\r\n    if (depth === undefined || depth) bits |= _gl.DEPTH_BUFFER_BIT;\r\n    if (stencil === undefined || stencil) bits |= _gl.STENCIL_BUFFER_BIT;\r\n\r\n    _gl.clear(bits);\r\n\r\n  };\r\n\r\n  this.clearColor = function() {\r\n\r\n    _gl.clear(_gl.COLOR_BUFFER_BIT);\r\n\r\n  };\r\n\r\n  this.clearDepth = function() {\r\n\r\n    _gl.clear(_gl.DEPTH_BUFFER_BIT);\r\n\r\n  };\r\n\r\n  this.clearStencil = function() {\r\n\r\n    _gl.clear(_gl.STENCIL_BUFFER_BIT);\r\n\r\n  };\r\n\r\n  this.clearTarget = function(renderTarget, color, depth, stencil) {\r\n\r\n    this.setRenderTarget(renderTarget);\r\n    this.clear(color, depth, stencil);\r\n\r\n  };\r\n\r\n  // Reset\r\n\r\n  this.resetGLState = resetGLState;\r\n\r\n  // Buffer allocation\r\n\r\n  function createParticleBuffers(geometry) {\r\n\r\n    geometry.__webglVertexBuffer = _gl.createBuffer();\r\n    geometry.__webglColorBuffer = _gl.createBuffer();\r\n\r\n    _this.info.memory.geometries++;\r\n\r\n  };\r\n\r\n  function createLineBuffers(geometry) {\r\n\r\n    geometry.__webglVertexBuffer = _gl.createBuffer();\r\n    geometry.__webglColorBuffer = _gl.createBuffer();\r\n    geometry.__webglLineDistanceBuffer = _gl.createBuffer();\r\n\r\n    _this.info.memory.geometries++;\r\n\r\n  };\r\n\r\n  function createMeshBuffers(geometryGroup) {\r\n\r\n    geometryGroup.__webglVertexBuffer = _gl.createBuffer();\r\n    geometryGroup.__webglNormalBuffer = _gl.createBuffer();\r\n    geometryGroup.__webglTangentBuffer = _gl.createBuffer();\r\n    geometryGroup.__webglColorBuffer = _gl.createBuffer();\r\n    geometryGroup.__webglUVBuffer = _gl.createBuffer();\r\n    geometryGroup.__webglUV2Buffer = _gl.createBuffer();\r\n\r\n    geometryGroup.__webglSkinIndicesBuffer = _gl.createBuffer();\r\n    geometryGroup.__webglSkinWeightsBuffer = _gl.createBuffer();\r\n\r\n    geometryGroup.__webglFaceBuffer = _gl.createBuffer();\r\n    geometryGroup.__webglLineBuffer = _gl.createBuffer();\r\n\r\n    var numMorphTargets = geometryGroup.numMorphTargets;\r\n\r\n    if (numMorphTargets) {\r\n\r\n      geometryGroup.__webglMorphTargetsBuffers = [];\r\n\r\n      for (var m = 0, ml = numMorphTargets; m < ml; m++) {\r\n\r\n        geometryGroup.__webglMorphTargetsBuffers.push(_gl.createBuffer());\r\n\r\n      }\r\n\r\n    }\r\n\r\n    var numMorphNormals = geometryGroup.numMorphNormals;\r\n\r\n    if (numMorphNormals) {\r\n\r\n      geometryGroup.__webglMorphNormalsBuffers = [];\r\n\r\n      for (var m = 0, ml = numMorphNormals; m < ml; m++) {\r\n\r\n        geometryGroup.__webglMorphNormalsBuffers.push(_gl.createBuffer());\r\n\r\n      }\r\n\r\n    }\r\n\r\n    _this.info.memory.geometries++;\r\n\r\n  };\r\n\r\n  // Events\r\n\r\n  var onObjectRemoved = function(event) {\r\n\r\n    var object = event.target;\r\n\r\n    object.traverse(function(child) {\r\n\r\n      child.removeEventListener('remove', onObjectRemoved);\r\n\r\n      removeObject(child);\r\n\r\n    });\r\n\r\n  };\r\n\r\n  var onGeometryDispose = function(event) {\r\n\r\n    var geometry = event.target;\r\n\r\n    geometry.removeEventListener('dispose', onGeometryDispose);\r\n\r\n    deallocateGeometry(geometry);\r\n\r\n  };\r\n\r\n  var onTextureDispose = function(event) {\r\n\r\n    var texture = event.target;\r\n\r\n    texture.removeEventListener('dispose', onTextureDispose);\r\n\r\n    deallocateTexture(texture);\r\n\r\n    _this.info.memory.textures--;\r\n\r\n\r\n  };\r\n\r\n  var onRenderTargetDispose = function(event) {\r\n\r\n    var renderTarget = event.target;\r\n\r\n    renderTarget.removeEventListener('dispose', onRenderTargetDispose);\r\n\r\n    deallocateRenderTarget(renderTarget);\r\n\r\n    _this.info.memory.textures--;\r\n\r\n  };\r\n\r\n  var onMaterialDispose = function(event) {\r\n\r\n    var material = event.target;\r\n\r\n    material.removeEventListener('dispose', onMaterialDispose);\r\n\r\n    deallocateMaterial(material);\r\n\r\n  };\r\n\r\n  // Buffer deallocation\r\n\r\n  var deleteBuffers = function(geometry) {\r\n\r\n    var buffers = [\r\n      '__webglVertexBuffer',\r\n      '__webglNormalBuffer',\r\n      '__webglTangentBuffer',\r\n      '__webglColorBuffer',\r\n      '__webglUVBuffer',\r\n      '__webglUV2Buffer',\r\n\r\n      '__webglSkinIndicesBuffer',\r\n      '__webglSkinWeightsBuffer',\r\n\r\n      '__webglFaceBuffer',\r\n      '__webglLineBuffer',\r\n\r\n      '__webglLineDistanceBuffer'\r\n    ];\r\n\r\n    for (var i = 0, l = buffers.length; i < l; i++) {\r\n\r\n      var name = buffers[i];\r\n\r\n      if (geometry[name] !== undefined) {\r\n\r\n        _gl.deleteBuffer(geometry[name]);\r\n\r\n        delete geometry[name];\r\n\r\n      }\r\n\r\n    }\r\n\r\n    // custom attributes\r\n\r\n    if (geometry.__webglCustomAttributesList !== undefined) {\r\n\r\n      for (var name in geometry.__webglCustomAttributesList) {\r\n\r\n        _gl.deleteBuffer(geometry.__webglCustomAttributesList[name].buffer);\r\n\r\n      }\r\n\r\n      delete geometry.__webglCustomAttributesList;\r\n\r\n    }\r\n\r\n    _this.info.memory.geometries--;\r\n\r\n  };\r\n\r\n  var deallocateGeometry = function(geometry) {\r\n\r\n    delete geometry.__webglInit;\r\n\r\n    if (geometry instanceof THREE.BufferGeometry) {\r\n\r\n      for (var name in geometry.attributes) {\r\n\r\n        var attribute = geometry.attributes[name];\r\n\r\n        if (attribute.buffer !== undefined) {\r\n\r\n          _gl.deleteBuffer(attribute.buffer);\r\n\r\n          delete attribute.buffer;\r\n\r\n        }\r\n\r\n      }\r\n\r\n      _this.info.memory.geometries--;\r\n\r\n    }\r\n    else {\r\n\r\n      var geometryGroupsList = geometryGroups[geometry.id];\r\n\r\n      if (geometryGroupsList !== undefined) {\r\n\r\n        for (var i = 0, l = geometryGroupsList.length; i < l; i++) {\r\n\r\n          var geometryGroup = geometryGroupsList[i];\r\n\r\n          if (geometryGroup.numMorphTargets !== undefined) {\r\n\r\n            for (var m = 0, ml = geometryGroup.numMorphTargets; m < ml; m++) {\r\n\r\n              _gl.deleteBuffer(geometryGroup.__webglMorphTargetsBuffers[m]);\r\n\r\n            }\r\n\r\n            delete geometryGroup.__webglMorphTargetsBuffers;\r\n\r\n          }\r\n\r\n          if (geometryGroup.numMorphNormals !== undefined) {\r\n\r\n            for (var m = 0, ml = geometryGroup.numMorphNormals; m < ml; m++) {\r\n\r\n              _gl.deleteBuffer(geometryGroup.__webglMorphNormalsBuffers[m]);\r\n\r\n            }\r\n\r\n            delete geometryGroup.__webglMorphNormalsBuffers;\r\n\r\n          }\r\n\r\n          deleteBuffers(geometryGroup);\r\n\r\n        }\r\n\r\n        delete geometryGroups[geometry.id];\r\n\r\n      }\r\n      else {\r\n\r\n        deleteBuffers(geometry);\r\n\r\n      }\r\n\r\n    }\r\n\r\n    // TOFIX: Workaround for deleted geometry being currently bound\r\n\r\n    _currentGeometryProgram = '';\r\n\r\n  };\r\n\r\n  var deallocateTexture = function(texture) {\r\n\r\n    if (texture.image && texture.image.__webglTextureCube) {\r\n\r\n      // cube texture\r\n\r\n      _gl.deleteTexture(texture.image.__webglTextureCube);\r\n\r\n      delete texture.image.__webglTextureCube;\r\n\r\n    }\r\n    else {\r\n\r\n      // 2D texture\r\n\r\n      if (texture.__webglInit === undefined) return;\r\n\r\n      _gl.deleteTexture(texture.__webglTexture);\r\n\r\n      delete texture.__webglTexture;\r\n      delete texture.__webglInit;\r\n\r\n    }\r\n\r\n  };\r\n\r\n  var deallocateRenderTarget = function(renderTarget) {\r\n\r\n    if (!renderTarget || renderTarget.__webglTexture === undefined) return;\r\n\r\n    _gl.deleteTexture(renderTarget.__webglTexture);\r\n\r\n    delete renderTarget.__webglTexture;\r\n\r\n    if (renderTarget instanceof THREE.WebGLRenderTargetCube) {\r\n\r\n      for (var i = 0; i < 6; i++) {\r\n\r\n        _gl.deleteFramebuffer(renderTarget.__webglFramebuffer[i]);\r\n        _gl.deleteRenderbuffer(renderTarget.__webglRenderbuffer[i]);\r\n\r\n      }\r\n\r\n    }\r\n    else {\r\n\r\n      _gl.deleteFramebuffer(renderTarget.__webglFramebuffer);\r\n      _gl.deleteRenderbuffer(renderTarget.__webglRenderbuffer);\r\n\r\n    }\r\n\r\n    delete renderTarget.__webglFramebuffer;\r\n    delete renderTarget.__webglRenderbuffer;\r\n\r\n  };\r\n\r\n  var deallocateMaterial = function(material) {\r\n\r\n    var program = material.program.program;\r\n\r\n    if (program === undefined) return;\r\n\r\n    material.program = undefined;\r\n\r\n    // only deallocate GL program if this was the last use of shared program\r\n    // assumed there is only single copy of any program in the _programs list\r\n    // (that's how it's constructed)\r\n\r\n    var i, il, programInfo;\r\n    var deleteProgram = false;\r\n\r\n    for (i = 0, il = _programs.length; i < il; i++) {\r\n\r\n      programInfo = _programs[i];\r\n\r\n      if (programInfo.program === program) {\r\n\r\n        programInfo.usedTimes--;\r\n\r\n        if (programInfo.usedTimes === 0) {\r\n\r\n          deleteProgram = true;\r\n\r\n        }\r\n\r\n        break;\r\n\r\n      }\r\n\r\n    }\r\n\r\n    if (deleteProgram === true) {\r\n\r\n      // avoid using array.splice, this is costlier than creating new array from scratch\r\n\r\n      var newPrograms = [];\r\n\r\n      for (i = 0, il = _programs.length; i < il; i++) {\r\n\r\n        programInfo = _programs[i];\r\n\r\n        if (programInfo.program !== program) {\r\n\r\n          newPrograms.push(programInfo);\r\n\r\n        }\r\n\r\n      }\r\n\r\n      _programs = newPrograms;\r\n\r\n      _gl.deleteProgram(program);\r\n\r\n      _this.info.memory.programs--;\r\n\r\n    }\r\n\r\n  };\r\n\r\n  // Buffer initialization\r\n\r\n  function initCustomAttributes(object) {\r\n\r\n    var geometry = object.geometry;\r\n    var material = object.material;\r\n\r\n    var nvertices = geometry.vertices.length;\r\n\r\n    if (material.attributes) {\r\n\r\n      if (geometry.__webglCustomAttributesList === undefined) {\r\n\r\n        geometry.__webglCustomAttributesList = [];\r\n\r\n      }\r\n\r\n      for (var name in material.attributes) {\r\n\r\n        var attribute = material.attributes[name];\r\n\r\n        if (!attribute.__webglInitialized || attribute.createUniqueBuffers) {\r\n\r\n          attribute.__webglInitialized = true;\r\n\r\n          var size = 1; // \"f\" and \"i\"\r\n\r\n          if (attribute.type === 'v2') size = 2;\r\n          else if (attribute.type === 'v3') size = 3;\r\n          else if (attribute.type === 'v4') size = 4;\r\n          else if (attribute.type === 'c') size = 3;\r\n\r\n          attribute.size = size;\r\n\r\n          attribute.array = new Float32Array(nvertices * size);\r\n\r\n          attribute.buffer = _gl.createBuffer();\r\n          attribute.buffer.belongsToAttribute = name;\r\n\r\n          attribute.needsUpdate = true;\r\n\r\n        }\r\n\r\n        geometry.__webglCustomAttributesList.push(attribute);\r\n\r\n      }\r\n\r\n    }\r\n\r\n  };\r\n\r\n  function initParticleBuffers(geometry, object) {\r\n\r\n    var nvertices = geometry.vertices.length;\r\n\r\n    geometry.__vertexArray = new Float32Array(nvertices * 3);\r\n    geometry.__colorArray = new Float32Array(nvertices * 3);\r\n\r\n    geometry.__webglParticleCount = nvertices;\r\n\r\n    initCustomAttributes(object);\r\n\r\n  };\r\n\r\n  function initLineBuffers(geometry, object) {\r\n\r\n    var nvertices = geometry.vertices.length;\r\n\r\n    geometry.__vertexArray = new Float32Array(nvertices * 3);\r\n    geometry.__colorArray = new Float32Array(nvertices * 3);\r\n    geometry.__lineDistanceArray = new Float32Array(nvertices * 1);\r\n\r\n    geometry.__webglLineCount = nvertices;\r\n\r\n    initCustomAttributes(object);\r\n\r\n  };\r\n\r\n  function initMeshBuffers(geometryGroup, object) {\r\n\r\n    var geometry = object.geometry,\r\n      faces3 = geometryGroup.faces3,\r\n\r\n      nvertices = faces3.length * 3,\r\n      ntris = faces3.length * 1,\r\n      nlines = faces3.length * 3,\r\n\r\n      material = getBufferMaterial(object, geometryGroup);\r\n\r\n    geometryGroup.__vertexArray = new Float32Array(nvertices * 3);\r\n    geometryGroup.__normalArray = new Float32Array(nvertices * 3);\r\n    geometryGroup.__colorArray = new Float32Array(nvertices * 3);\r\n    geometryGroup.__uvArray = new Float32Array(nvertices * 2);\r\n\r\n    if (geometry.faceVertexUvs.length > 1) {\r\n\r\n      geometryGroup.__uv2Array = new Float32Array(nvertices * 2);\r\n\r\n    }\r\n\r\n    if (geometry.hasTangents) {\r\n\r\n      geometryGroup.__tangentArray = new Float32Array(nvertices * 4);\r\n\r\n    }\r\n\r\n    if (object.geometry.skinWeights.length && object.geometry.skinIndices.length) {\r\n\r\n      geometryGroup.__skinIndexArray = new Float32Array(nvertices * 4);\r\n      geometryGroup.__skinWeightArray = new Float32Array(nvertices * 4);\r\n\r\n    }\r\n\r\n    var UintArray = extensions.get('OES_element_index_uint') !== null && ntris > 21845 ? Uint32Array : Uint16Array; // 65535 / 3\r\n\r\n    geometryGroup.__typeArray = UintArray;\r\n    geometryGroup.__faceArray = new UintArray(ntris * 3);\r\n    geometryGroup.__lineArray = new UintArray(nlines * 2);\r\n\r\n    var numMorphTargets = geometryGroup.numMorphTargets;\r\n\r\n    if (numMorphTargets) {\r\n\r\n      geometryGroup.__morphTargetsArrays = [];\r\n\r\n      for (var m = 0, ml = numMorphTargets; m < ml; m++) {\r\n\r\n        geometryGroup.__morphTargetsArrays.push(new Float32Array(nvertices * 3));\r\n\r\n      }\r\n\r\n    }\r\n\r\n    var numMorphNormals = geometryGroup.numMorphNormals;\r\n\r\n    if (numMorphNormals) {\r\n\r\n      geometryGroup.__morphNormalsArrays = [];\r\n\r\n      for (var m = 0, ml = numMorphNormals; m < ml; m++) {\r\n\r\n        geometryGroup.__morphNormalsArrays.push(new Float32Array(nvertices * 3));\r\n\r\n      }\r\n\r\n    }\r\n\r\n    geometryGroup.__webglFaceCount = ntris * 3;\r\n    geometryGroup.__webglLineCount = nlines * 2;\r\n\r\n\r\n    // custom attributes\r\n\r\n    if (material.attributes) {\r\n\r\n      if (geometryGroup.__webglCustomAttributesList === undefined) {\r\n\r\n        geometryGroup.__webglCustomAttributesList = [];\r\n\r\n      }\r\n\r\n      for (var name in material.attributes) {\r\n\r\n        // Do a shallow copy of the attribute object so different geometryGroup chunks use different\r\n        // attribute buffers which are correctly indexed in the setMeshBuffers function\r\n\r\n        var originalAttribute = material.attributes[name];\r\n\r\n        var attribute = {};\r\n\r\n        for (var property in originalAttribute) {\r\n\r\n          attribute[property] = originalAttribute[property];\r\n\r\n        }\r\n\r\n        if (!attribute.__webglInitialized || attribute.createUniqueBuffers) {\r\n\r\n          attribute.__webglInitialized = true;\r\n\r\n          var size = 1; // \"f\" and \"i\"\r\n\r\n          if (attribute.type === 'v2') size = 2;\r\n          else if (attribute.type === 'v3') size = 3;\r\n          else if (attribute.type === 'v4') size = 4;\r\n          else if (attribute.type === 'c') size = 3;\r\n\r\n          attribute.size = size;\r\n\r\n          attribute.array = new Float32Array(nvertices * size);\r\n\r\n          attribute.buffer = _gl.createBuffer();\r\n          attribute.buffer.belongsToAttribute = name;\r\n\r\n          originalAttribute.needsUpdate = true;\r\n          attribute.__original = originalAttribute;\r\n\r\n        }\r\n\r\n        geometryGroup.__webglCustomAttributesList.push(attribute);\r\n\r\n      }\r\n\r\n    }\r\n\r\n    geometryGroup.__inittedArrays = true;\r\n\r\n  };\r\n\r\n  function getBufferMaterial(object, geometryGroup) {\r\n\r\n    return object.material instanceof THREE.MeshFaceMaterial ? object.material.materials[geometryGroup.materialIndex] : object.material;\r\n\r\n  }\r\n\r\n  function materialNeedsFaceNormals(material) {\r\n\r\n    return material instanceof THREE.MeshPhongMaterial === false && material.shading === THREE.FlatShading;\r\n\r\n  }\r\n\r\n  // Buffer setting\r\n\r\n  function setParticleBuffers(geometry, hint, object) {\r\n\r\n    var v, c, vertex, offset, color,\r\n\r\n      vertices = geometry.vertices,\r\n      vl = vertices.length,\r\n\r\n      colors = geometry.colors,\r\n      cl = colors.length,\r\n\r\n      vertexArray = geometry.__vertexArray,\r\n      colorArray = geometry.__colorArray,\r\n\r\n      dirtyVertices = geometry.verticesNeedUpdate,\r\n      dirtyColors = geometry.colorsNeedUpdate,\r\n\r\n      customAttributes = geometry.__webglCustomAttributesList,\r\n      i, il,\r\n      ca, cal, value,\r\n      customAttribute;\r\n\r\n    if (dirtyVertices) {\r\n\r\n      for (v = 0; v < vl; v++) {\r\n\r\n        vertex = vertices[v];\r\n\r\n        offset = v * 3;\r\n\r\n        vertexArray[offset] = vertex.x;\r\n        vertexArray[offset + 1] = vertex.y;\r\n        vertexArray[offset + 2] = vertex.z;\r\n\r\n      }\r\n\r\n      _gl.bindBuffer(_gl.ARRAY_BUFFER, geometry.__webglVertexBuffer);\r\n      _gl.bufferData(_gl.ARRAY_BUFFER, vertexArray, hint);\r\n\r\n    }\r\n\r\n    if (dirtyColors) {\r\n\r\n      for (c = 0; c < cl; c++) {\r\n\r\n        color = colors[c];\r\n\r\n        offset = c * 3;\r\n\r\n        colorArray[offset] = color.r;\r\n        colorArray[offset + 1] = color.g;\r\n        colorArray[offset + 2] = color.b;\r\n\r\n      }\r\n\r\n      _gl.bindBuffer(_gl.ARRAY_BUFFER, geometry.__webglColorBuffer);\r\n      _gl.bufferData(_gl.ARRAY_BUFFER, colorArray, hint);\r\n\r\n    }\r\n\r\n    if (customAttributes) {\r\n\r\n      for (i = 0, il = customAttributes.length; i < il; i++) {\r\n\r\n        customAttribute = customAttributes[i];\r\n\r\n        if (customAttribute.needsUpdate && (customAttribute.boundTo === undefined || customAttribute.boundTo === 'vertices')) {\r\n\r\n          cal = customAttribute.value.length;\r\n\r\n          offset = 0;\r\n\r\n          if (customAttribute.size === 1) {\r\n\r\n            for (ca = 0; ca < cal; ca++) {\r\n\r\n              customAttribute.array[ca] = customAttribute.value[ca];\r\n\r\n            }\r\n\r\n          }\r\n          else if (customAttribute.size === 2) {\r\n\r\n            for (ca = 0; ca < cal; ca++) {\r\n\r\n              value = customAttribute.value[ca];\r\n\r\n              customAttribute.array[offset] = value.x;\r\n              customAttribute.array[offset + 1] = value.y;\r\n\r\n              offset += 2;\r\n\r\n            }\r\n\r\n          }\r\n          else if (customAttribute.size === 3) {\r\n\r\n            if (customAttribute.type === 'c') {\r\n\r\n              for (ca = 0; ca < cal; ca++) {\r\n\r\n                value = customAttribute.value[ca];\r\n\r\n                customAttribute.array[offset] = value.r;\r\n                customAttribute.array[offset + 1] = value.g;\r\n                customAttribute.array[offset + 2] = value.b;\r\n\r\n                offset += 3;\r\n\r\n              }\r\n\r\n            }\r\n            else {\r\n\r\n              for (ca = 0; ca < cal; ca++) {\r\n\r\n                value = customAttribute.value[ca];\r\n\r\n                customAttribute.array[offset] = value.x;\r\n                customAttribute.array[offset + 1] = value.y;\r\n                customAttribute.array[offset + 2] = value.z;\r\n\r\n                offset += 3;\r\n\r\n              }\r\n\r\n            }\r\n\r\n          }\r\n          else if (customAttribute.size === 4) {\r\n\r\n            for (ca = 0; ca < cal; ca++) {\r\n\r\n              value = customAttribute.value[ca];\r\n\r\n              customAttribute.array[offset] = value.x;\r\n              customAttribute.array[offset + 1] = value.y;\r\n              customAttribute.array[offset + 2] = value.z;\r\n              customAttribute.array[offset + 3] = value.w;\r\n\r\n              offset += 4;\r\n\r\n            }\r\n\r\n          }\r\n\r\n        }\r\n\r\n        _gl.bindBuffer(_gl.ARRAY_BUFFER, customAttribute.buffer);\r\n        _gl.bufferData(_gl.ARRAY_BUFFER, customAttribute.array, hint);\r\n\r\n        customAttribute.needsUpdate = false;\r\n\r\n      }\r\n\r\n    }\r\n\r\n  }\r\n\r\n  function setLineBuffers(geometry, hint) {\r\n\r\n    var v, c, d, vertex, offset, color,\r\n\r\n      vertices = geometry.vertices,\r\n      colors = geometry.colors,\r\n      lineDistances = geometry.lineDistances,\r\n\r\n      vl = vertices.length,\r\n      cl = colors.length,\r\n      dl = lineDistances.length,\r\n\r\n      vertexArray = geometry.__vertexArray,\r\n      colorArray = geometry.__colorArray,\r\n      lineDistanceArray = geometry.__lineDistanceArray,\r\n\r\n      dirtyVertices = geometry.verticesNeedUpdate,\r\n      dirtyColors = geometry.colorsNeedUpdate,\r\n      dirtyLineDistances = geometry.lineDistancesNeedUpdate,\r\n\r\n      customAttributes = geometry.__webglCustomAttributesList,\r\n\r\n      i, il,\r\n      ca, cal, value,\r\n      customAttribute;\r\n\r\n    if (dirtyVertices) {\r\n\r\n      for (v = 0; v < vl; v++) {\r\n\r\n        vertex = vertices[v];\r\n\r\n        offset = v * 3;\r\n\r\n        vertexArray[offset] = vertex.x;\r\n        vertexArray[offset + 1] = vertex.y;\r\n        vertexArray[offset + 2] = vertex.z;\r\n\r\n      }\r\n\r\n      _gl.bindBuffer(_gl.ARRAY_BUFFER, geometry.__webglVertexBuffer);\r\n      _gl.bufferData(_gl.ARRAY_BUFFER, vertexArray, hint);\r\n\r\n    }\r\n\r\n    if (dirtyColors) {\r\n\r\n      for (c = 0; c < cl; c++) {\r\n\r\n        color = colors[c];\r\n\r\n        offset = c * 3;\r\n\r\n        colorArray[offset] = color.r;\r\n        colorArray[offset + 1] = color.g;\r\n        colorArray[offset + 2] = color.b;\r\n\r\n      }\r\n\r\n      _gl.bindBuffer(_gl.ARRAY_BUFFER, geometry.__webglColorBuffer);\r\n      _gl.bufferData(_gl.ARRAY_BUFFER, colorArray, hint);\r\n\r\n    }\r\n\r\n    if (dirtyLineDistances) {\r\n\r\n      for (d = 0; d < dl; d++) {\r\n\r\n        lineDistanceArray[d] = lineDistances[d];\r\n\r\n      }\r\n\r\n      _gl.bindBuffer(_gl.ARRAY_BUFFER, geometry.__webglLineDistanceBuffer);\r\n      _gl.bufferData(_gl.ARRAY_BUFFER, lineDistanceArray, hint);\r\n\r\n    }\r\n\r\n    if (customAttributes) {\r\n\r\n      for (i = 0, il = customAttributes.length; i < il; i++) {\r\n\r\n        customAttribute = customAttributes[i];\r\n\r\n        if (customAttribute.needsUpdate && (customAttribute.boundTo === undefined || customAttribute.boundTo === 'vertices')) {\r\n\r\n          offset = 0;\r\n\r\n          cal = customAttribute.value.length;\r\n\r\n          if (customAttribute.size === 1) {\r\n\r\n            for (ca = 0; ca < cal; ca++) {\r\n\r\n              customAttribute.array[ca] = customAttribute.value[ca];\r\n\r\n            }\r\n\r\n          }\r\n          else if (customAttribute.size === 2) {\r\n\r\n            for (ca = 0; ca < cal; ca++) {\r\n\r\n              value = customAttribute.value[ca];\r\n\r\n              customAttribute.array[offset] = value.x;\r\n              customAttribute.array[offset + 1] = value.y;\r\n\r\n              offset += 2;\r\n\r\n            }\r\n\r\n          }\r\n          else if (customAttribute.size === 3) {\r\n\r\n            if (customAttribute.type === 'c') {\r\n\r\n              for (ca = 0; ca < cal; ca++) {\r\n\r\n                value = customAttribute.value[ca];\r\n\r\n                customAttribute.array[offset] = value.r;\r\n                customAttribute.array[offset + 1] = value.g;\r\n                customAttribute.array[offset + 2] = value.b;\r\n\r\n                offset += 3;\r\n\r\n              }\r\n\r\n            }\r\n            else {\r\n\r\n              for (ca = 0; ca < cal; ca++) {\r\n\r\n                value = customAttribute.value[ca];\r\n\r\n                customAttribute.array[offset] = value.x;\r\n                customAttribute.array[offset + 1] = value.y;\r\n                customAttribute.array[offset + 2] = value.z;\r\n\r\n                offset += 3;\r\n\r\n              }\r\n\r\n            }\r\n\r\n          }\r\n          else if (customAttribute.size === 4) {\r\n\r\n            for (ca = 0; ca < cal; ca++) {\r\n\r\n              value = customAttribute.value[ca];\r\n\r\n              customAttribute.array[offset] = value.x;\r\n              customAttribute.array[offset + 1] = value.y;\r\n              customAttribute.array[offset + 2] = value.z;\r\n              customAttribute.array[offset + 3] = value.w;\r\n\r\n              offset += 4;\r\n\r\n            }\r\n\r\n          }\r\n\r\n          _gl.bindBuffer(_gl.ARRAY_BUFFER, customAttribute.buffer);\r\n          _gl.bufferData(_gl.ARRAY_BUFFER, customAttribute.array, hint);\r\n\r\n          customAttribute.needsUpdate = false;\r\n\r\n        }\r\n\r\n      }\r\n\r\n    }\r\n\r\n  }\r\n\r\n  function setMeshBuffers(geometryGroup, object, hint, dispose, material) {\r\n\r\n    if (!geometryGroup.__inittedArrays) {\r\n\r\n      return;\r\n\r\n    }\r\n\r\n    var needsFaceNormals = materialNeedsFaceNormals(material);\r\n\r\n    var f, fl, fi, face,\r\n      vertexNormals, faceNormal,\r\n      vertexColors, faceColor,\r\n      vertexTangents,\r\n      uv, uv2, v1, v2, v3, t1, t2, t3, n1, n2, n3,\r\n      c1, c2, c3,\r\n      sw1, sw2, sw3,\r\n      si1, si2, si3,\r\n      i, il,\r\n      vn, uvi, uv2i,\r\n      vk, vkl, vka,\r\n      nka, chf, faceVertexNormals,\r\n\r\n      vertexIndex = 0,\r\n\r\n      offset = 0,\r\n      offset_uv = 0,\r\n      offset_uv2 = 0,\r\n      offset_face = 0,\r\n      offset_normal = 0,\r\n      offset_tangent = 0,\r\n      offset_line = 0,\r\n      offset_color = 0,\r\n      offset_skin = 0,\r\n      offset_morphTarget = 0,\r\n      offset_custom = 0,\r\n\r\n      value,\r\n\r\n      vertexArray = geometryGroup.__vertexArray,\r\n      uvArray = geometryGroup.__uvArray,\r\n      uv2Array = geometryGroup.__uv2Array,\r\n      normalArray = geometryGroup.__normalArray,\r\n      tangentArray = geometryGroup.__tangentArray,\r\n      colorArray = geometryGroup.__colorArray,\r\n\r\n      skinIndexArray = geometryGroup.__skinIndexArray,\r\n      skinWeightArray = geometryGroup.__skinWeightArray,\r\n\r\n      morphTargetsArrays = geometryGroup.__morphTargetsArrays,\r\n      morphNormalsArrays = geometryGroup.__morphNormalsArrays,\r\n\r\n      customAttributes = geometryGroup.__webglCustomAttributesList,\r\n      customAttribute,\r\n\r\n      faceArray = geometryGroup.__faceArray,\r\n      lineArray = geometryGroup.__lineArray,\r\n\r\n      geometry = object.geometry, // this is shared for all chunks\r\n\r\n      dirtyVertices = geometry.verticesNeedUpdate,\r\n      dirtyElements = geometry.elementsNeedUpdate,\r\n      dirtyUvs = geometry.uvsNeedUpdate,\r\n      dirtyNormals = geometry.normalsNeedUpdate,\r\n      dirtyTangents = geometry.tangentsNeedUpdate,\r\n      dirtyColors = geometry.colorsNeedUpdate,\r\n      dirtyMorphTargets = geometry.morphTargetsNeedUpdate,\r\n\r\n      vertices = geometry.vertices,\r\n      chunk_faces3 = geometryGroup.faces3,\r\n      obj_faces = geometry.faces,\r\n\r\n      obj_uvs = geometry.faceVertexUvs[0],\r\n      obj_uvs2 = geometry.faceVertexUvs[1],\r\n\r\n      obj_skinIndices = geometry.skinIndices,\r\n      obj_skinWeights = geometry.skinWeights,\r\n\r\n      morphTargets = geometry.morphTargets,\r\n      morphNormals = geometry.morphNormals;\r\n\r\n    if (dirtyVertices) {\r\n\r\n      for (f = 0, fl = chunk_faces3.length; f < fl; f++) {\r\n\r\n        face = obj_faces[chunk_faces3[f]];\r\n\r\n        v1 = vertices[face.a];\r\n        v2 = vertices[face.b];\r\n        v3 = vertices[face.c];\r\n\r\n        vertexArray[offset] = v1.x;\r\n        vertexArray[offset + 1] = v1.y;\r\n        vertexArray[offset + 2] = v1.z;\r\n\r\n        vertexArray[offset + 3] = v2.x;\r\n        vertexArray[offset + 4] = v2.y;\r\n        vertexArray[offset + 5] = v2.z;\r\n\r\n        vertexArray[offset + 6] = v3.x;\r\n        vertexArray[offset + 7] = v3.y;\r\n        vertexArray[offset + 8] = v3.z;\r\n\r\n        offset += 9;\r\n\r\n      }\r\n\r\n      _gl.bindBuffer(_gl.ARRAY_BUFFER, geometryGroup.__webglVertexBuffer);\r\n      _gl.bufferData(_gl.ARRAY_BUFFER, vertexArray, hint);\r\n\r\n    }\r\n\r\n    if (dirtyMorphTargets) {\r\n\r\n      for (vk = 0, vkl = morphTargets.length; vk < vkl; vk++) {\r\n\r\n        offset_morphTarget = 0;\r\n\r\n        for (f = 0, fl = chunk_faces3.length; f < fl; f++) {\r\n\r\n          chf = chunk_faces3[f];\r\n          face = obj_faces[chf];\r\n\r\n          // morph positions\r\n\r\n          v1 = morphTargets[vk].vertices[face.a];\r\n          v2 = morphTargets[vk].vertices[face.b];\r\n          v3 = morphTargets[vk].vertices[face.c];\r\n\r\n          vka = morphTargetsArrays[vk];\r\n\r\n          vka[offset_morphTarget] = v1.x;\r\n          vka[offset_morphTarget + 1] = v1.y;\r\n          vka[offset_morphTarget + 2] = v1.z;\r\n\r\n          vka[offset_morphTarget + 3] = v2.x;\r\n          vka[offset_morphTarget + 4] = v2.y;\r\n          vka[offset_morphTarget + 5] = v2.z;\r\n\r\n          vka[offset_morphTarget + 6] = v3.x;\r\n          vka[offset_morphTarget + 7] = v3.y;\r\n          vka[offset_morphTarget + 8] = v3.z;\r\n\r\n          // morph normals\r\n\r\n          if (material.morphNormals) {\r\n\r\n            if (needsFaceNormals) {\r\n\r\n              n1 = morphNormals[vk].faceNormals[chf];\r\n              n2 = n1;\r\n              n3 = n1;\r\n\r\n            }\r\n            else {\r\n\r\n              faceVertexNormals = morphNormals[vk].vertexNormals[chf];\r\n\r\n              n1 = faceVertexNormals.a;\r\n              n2 = faceVertexNormals.b;\r\n              n3 = faceVertexNormals.c;\r\n\r\n            }\r\n\r\n            nka = morphNormalsArrays[vk];\r\n\r\n            nka[offset_morphTarget] = n1.x;\r\n            nka[offset_morphTarget + 1] = n1.y;\r\n            nka[offset_morphTarget + 2] = n1.z;\r\n\r\n            nka[offset_morphTarget + 3] = n2.x;\r\n            nka[offset_morphTarget + 4] = n2.y;\r\n            nka[offset_morphTarget + 5] = n2.z;\r\n\r\n            nka[offset_morphTarget + 6] = n3.x;\r\n            nka[offset_morphTarget + 7] = n3.y;\r\n            nka[offset_morphTarget + 8] = n3.z;\r\n\r\n          }\r\n\r\n          //\r\n\r\n          offset_morphTarget += 9;\r\n\r\n        }\r\n\r\n        _gl.bindBuffer(_gl.ARRAY_BUFFER, geometryGroup.__webglMorphTargetsBuffers[vk]);\r\n        _gl.bufferData(_gl.ARRAY_BUFFER, morphTargetsArrays[vk], hint);\r\n\r\n        if (material.morphNormals) {\r\n\r\n          _gl.bindBuffer(_gl.ARRAY_BUFFER, geometryGroup.__webglMorphNormalsBuffers[vk]);\r\n          _gl.bufferData(_gl.ARRAY_BUFFER, morphNormalsArrays[vk], hint);\r\n\r\n        }\r\n\r\n      }\r\n\r\n    }\r\n\r\n    if (obj_skinWeights.length) {\r\n\r\n      for (f = 0, fl = chunk_faces3.length; f < fl; f++) {\r\n\r\n        face = obj_faces[chunk_faces3[f]];\r\n\r\n        // weights\r\n\r\n        sw1 = obj_skinWeights[face.a];\r\n        sw2 = obj_skinWeights[face.b];\r\n        sw3 = obj_skinWeights[face.c];\r\n\r\n        skinWeightArray[offset_skin] = sw1.x;\r\n        skinWeightArray[offset_skin + 1] = sw1.y;\r\n        skinWeightArray[offset_skin + 2] = sw1.z;\r\n        skinWeightArray[offset_skin + 3] = sw1.w;\r\n\r\n        skinWeightArray[offset_skin + 4] = sw2.x;\r\n        skinWeightArray[offset_skin + 5] = sw2.y;\r\n        skinWeightArray[offset_skin + 6] = sw2.z;\r\n        skinWeightArray[offset_skin + 7] = sw2.w;\r\n\r\n        skinWeightArray[offset_skin + 8] = sw3.x;\r\n        skinWeightArray[offset_skin + 9] = sw3.y;\r\n        skinWeightArray[offset_skin + 10] = sw3.z;\r\n        skinWeightArray[offset_skin + 11] = sw3.w;\r\n\r\n        // indices\r\n\r\n        si1 = obj_skinIndices[face.a];\r\n        si2 = obj_skinIndices[face.b];\r\n        si3 = obj_skinIndices[face.c];\r\n\r\n        skinIndexArray[offset_skin] = si1.x;\r\n        skinIndexArray[offset_skin + 1] = si1.y;\r\n        skinIndexArray[offset_skin + 2] = si1.z;\r\n        skinIndexArray[offset_skin + 3] = si1.w;\r\n\r\n        skinIndexArray[offset_skin + 4] = si2.x;\r\n        skinIndexArray[offset_skin + 5] = si2.y;\r\n        skinIndexArray[offset_skin + 6] = si2.z;\r\n        skinIndexArray[offset_skin + 7] = si2.w;\r\n\r\n        skinIndexArray[offset_skin + 8] = si3.x;\r\n        skinIndexArray[offset_skin + 9] = si3.y;\r\n        skinIndexArray[offset_skin + 10] = si3.z;\r\n        skinIndexArray[offset_skin + 11] = si3.w;\r\n\r\n        offset_skin += 12;\r\n\r\n      }\r\n\r\n      if (offset_skin > 0) {\r\n\r\n        _gl.bindBuffer(_gl.ARRAY_BUFFER, geometryGroup.__webglSkinIndicesBuffer);\r\n        _gl.bufferData(_gl.ARRAY_BUFFER, skinIndexArray, hint);\r\n\r\n        _gl.bindBuffer(_gl.ARRAY_BUFFER, geometryGroup.__webglSkinWeightsBuffer);\r\n        _gl.bufferData(_gl.ARRAY_BUFFER, skinWeightArray, hint);\r\n\r\n      }\r\n\r\n    }\r\n\r\n    if (dirtyColors) {\r\n\r\n      for (f = 0, fl = chunk_faces3.length; f < fl; f++) {\r\n\r\n        face = obj_faces[chunk_faces3[f]];\r\n\r\n        vertexColors = face.vertexColors;\r\n        faceColor = face.color;\r\n\r\n        if (vertexColors.length === 3 && material.vertexColors === THREE.VertexColors) {\r\n\r\n          c1 = vertexColors[0];\r\n          c2 = vertexColors[1];\r\n          c3 = vertexColors[2];\r\n\r\n        }\r\n        else {\r\n\r\n          c1 = faceColor;\r\n          c2 = faceColor;\r\n          c3 = faceColor;\r\n\r\n        }\r\n\r\n        colorArray[offset_color] = c1.r;\r\n        colorArray[offset_color + 1] = c1.g;\r\n        colorArray[offset_color + 2] = c1.b;\r\n\r\n        colorArray[offset_color + 3] = c2.r;\r\n        colorArray[offset_color + 4] = c2.g;\r\n        colorArray[offset_color + 5] = c2.b;\r\n\r\n        colorArray[offset_color + 6] = c3.r;\r\n        colorArray[offset_color + 7] = c3.g;\r\n        colorArray[offset_color + 8] = c3.b;\r\n\r\n        offset_color += 9;\r\n\r\n      }\r\n\r\n      if (offset_color > 0) {\r\n\r\n        _gl.bindBuffer(_gl.ARRAY_BUFFER, geometryGroup.__webglColorBuffer);\r\n        _gl.bufferData(_gl.ARRAY_BUFFER, colorArray, hint);\r\n\r\n      }\r\n\r\n    }\r\n\r\n    if (dirtyTangents && geometry.hasTangents) {\r\n\r\n      for (f = 0, fl = chunk_faces3.length; f < fl; f++) {\r\n\r\n        face = obj_faces[chunk_faces3[f]];\r\n\r\n        vertexTangents = face.vertexTangents;\r\n\r\n        t1 = vertexTangents[0];\r\n        t2 = vertexTangents[1];\r\n        t3 = vertexTangents[2];\r\n\r\n        tangentArray[offset_tangent] = t1.x;\r\n        tangentArray[offset_tangent + 1] = t1.y;\r\n        tangentArray[offset_tangent + 2] = t1.z;\r\n        tangentArray[offset_tangent + 3] = t1.w;\r\n\r\n        tangentArray[offset_tangent + 4] = t2.x;\r\n        tangentArray[offset_tangent + 5] = t2.y;\r\n        tangentArray[offset_tangent + 6] = t2.z;\r\n        tangentArray[offset_tangent + 7] = t2.w;\r\n\r\n        tangentArray[offset_tangent + 8] = t3.x;\r\n        tangentArray[offset_tangent + 9] = t3.y;\r\n        tangentArray[offset_tangent + 10] = t3.z;\r\n        tangentArray[offset_tangent + 11] = t3.w;\r\n\r\n        offset_tangent += 12;\r\n\r\n      }\r\n\r\n      _gl.bindBuffer(_gl.ARRAY_BUFFER, geometryGroup.__webglTangentBuffer);\r\n      _gl.bufferData(_gl.ARRAY_BUFFER, tangentArray, hint);\r\n\r\n    }\r\n\r\n    if (dirtyNormals) {\r\n\r\n      for (f = 0, fl = chunk_faces3.length; f < fl; f++) {\r\n\r\n        face = obj_faces[chunk_faces3[f]];\r\n\r\n        vertexNormals = face.vertexNormals;\r\n        faceNormal = face.normal;\r\n\r\n        if (vertexNormals.length === 3 && needsFaceNormals === false) {\r\n\r\n          for (i = 0; i < 3; i++) {\r\n\r\n            vn = vertexNormals[i];\r\n\r\n            normalArray[offset_normal] = vn.x;\r\n            normalArray[offset_normal + 1] = vn.y;\r\n            normalArray[offset_normal + 2] = vn.z;\r\n\r\n            offset_normal += 3;\r\n\r\n          }\r\n\r\n        }\r\n        else {\r\n\r\n          for (i = 0; i < 3; i++) {\r\n\r\n            normalArray[offset_normal] = faceNormal.x;\r\n            normalArray[offset_normal + 1] = faceNormal.y;\r\n            normalArray[offset_normal + 2] = faceNormal.z;\r\n\r\n            offset_normal += 3;\r\n\r\n          }\r\n\r\n        }\r\n\r\n      }\r\n\r\n      _gl.bindBuffer(_gl.ARRAY_BUFFER, geometryGroup.__webglNormalBuffer);\r\n      _gl.bufferData(_gl.ARRAY_BUFFER, normalArray, hint);\r\n\r\n    }\r\n\r\n    if (dirtyUvs && obj_uvs) {\r\n\r\n      for (f = 0, fl = chunk_faces3.length; f < fl; f++) {\r\n\r\n        fi = chunk_faces3[f];\r\n\r\n        uv = obj_uvs[fi];\r\n\r\n        if (uv === undefined) continue;\r\n\r\n        for (i = 0; i < 3; i++) {\r\n\r\n          uvi = uv[i];\r\n\r\n          uvArray[offset_uv] = uvi.x;\r\n          uvArray[offset_uv + 1] = uvi.y;\r\n\r\n          offset_uv += 2;\r\n\r\n        }\r\n\r\n      }\r\n\r\n      if (offset_uv > 0) {\r\n\r\n        _gl.bindBuffer(_gl.ARRAY_BUFFER, geometryGroup.__webglUVBuffer);\r\n        _gl.bufferData(_gl.ARRAY_BUFFER, uvArray, hint);\r\n\r\n      }\r\n\r\n    }\r\n\r\n    if (dirtyUvs && obj_uvs2) {\r\n\r\n      for (f = 0, fl = chunk_faces3.length; f < fl; f++) {\r\n\r\n        fi = chunk_faces3[f];\r\n\r\n        uv2 = obj_uvs2[fi];\r\n\r\n        if (uv2 === undefined) continue;\r\n\r\n        for (i = 0; i < 3; i++) {\r\n\r\n          uv2i = uv2[i];\r\n\r\n          uv2Array[offset_uv2] = uv2i.x;\r\n          uv2Array[offset_uv2 + 1] = uv2i.y;\r\n\r\n          offset_uv2 += 2;\r\n\r\n        }\r\n\r\n      }\r\n\r\n      if (offset_uv2 > 0) {\r\n\r\n        _gl.bindBuffer(_gl.ARRAY_BUFFER, geometryGroup.__webglUV2Buffer);\r\n        _gl.bufferData(_gl.ARRAY_BUFFER, uv2Array, hint);\r\n\r\n      }\r\n\r\n    }\r\n\r\n    if (dirtyElements) {\r\n\r\n      for (f = 0, fl = chunk_faces3.length; f < fl; f++) {\r\n\r\n        faceArray[offset_face] = vertexIndex;\r\n        faceArray[offset_face + 1] = vertexIndex + 1;\r\n        faceArray[offset_face + 2] = vertexIndex + 2;\r\n\r\n        offset_face += 3;\r\n\r\n        lineArray[offset_line] = vertexIndex;\r\n        lineArray[offset_line + 1] = vertexIndex + 1;\r\n\r\n        lineArray[offset_line + 2] = vertexIndex;\r\n        lineArray[offset_line + 3] = vertexIndex + 2;\r\n\r\n        lineArray[offset_line + 4] = vertexIndex + 1;\r\n        lineArray[offset_line + 5] = vertexIndex + 2;\r\n\r\n        offset_line += 6;\r\n\r\n        vertexIndex += 3;\r\n\r\n      }\r\n\r\n      _gl.bindBuffer(_gl.ELEMENT_ARRAY_BUFFER, geometryGroup.__webglFaceBuffer);\r\n      _gl.bufferData(_gl.ELEMENT_ARRAY_BUFFER, faceArray, hint);\r\n\r\n      _gl.bindBuffer(_gl.ELEMENT_ARRAY_BUFFER, geometryGroup.__webglLineBuffer);\r\n      _gl.bufferData(_gl.ELEMENT_ARRAY_BUFFER, lineArray, hint);\r\n\r\n    }\r\n\r\n    if (customAttributes) {\r\n\r\n      for (i = 0, il = customAttributes.length; i < il; i++) {\r\n\r\n        customAttribute = customAttributes[i];\r\n\r\n        if (!customAttribute.__original.needsUpdate) continue;\r\n\r\n        offset_custom = 0;\r\n\r\n        if (customAttribute.size === 1) {\r\n\r\n          if (customAttribute.boundTo === undefined || customAttribute.boundTo === 'vertices') {\r\n\r\n            for (f = 0, fl = chunk_faces3.length; f < fl; f++) {\r\n\r\n              face = obj_faces[chunk_faces3[f]];\r\n\r\n              customAttribute.array[offset_custom] = customAttribute.value[face.a];\r\n              customAttribute.array[offset_custom + 1] = customAttribute.value[face.b];\r\n              customAttribute.array[offset_custom + 2] = customAttribute.value[face.c];\r\n\r\n              offset_custom += 3;\r\n\r\n            }\r\n\r\n          }\r\n          else if (customAttribute.boundTo === 'faces') {\r\n\r\n            for (f = 0, fl = chunk_faces3.length; f < fl; f++) {\r\n\r\n              value = customAttribute.value[chunk_faces3[f]];\r\n\r\n              customAttribute.array[offset_custom] = value;\r\n              customAttribute.array[offset_custom + 1] = value;\r\n              customAttribute.array[offset_custom + 2] = value;\r\n\r\n              offset_custom += 3;\r\n\r\n            }\r\n\r\n          }\r\n\r\n        }\r\n        else if (customAttribute.size === 2) {\r\n\r\n          if (customAttribute.boundTo === undefined || customAttribute.boundTo === 'vertices') {\r\n\r\n            for (f = 0, fl = chunk_faces3.length; f < fl; f++) {\r\n\r\n              face = obj_faces[chunk_faces3[f]];\r\n\r\n              v1 = customAttribute.value[face.a];\r\n              v2 = customAttribute.value[face.b];\r\n              v3 = customAttribute.value[face.c];\r\n\r\n              customAttribute.array[offset_custom] = v1.x;\r\n              customAttribute.array[offset_custom + 1] = v1.y;\r\n\r\n              customAttribute.array[offset_custom + 2] = v2.x;\r\n              customAttribute.array[offset_custom + 3] = v2.y;\r\n\r\n              customAttribute.array[offset_custom + 4] = v3.x;\r\n              customAttribute.array[offset_custom + 5] = v3.y;\r\n\r\n              offset_custom += 6;\r\n\r\n            }\r\n\r\n          }\r\n          else if (customAttribute.boundTo === 'faces') {\r\n\r\n            for (f = 0, fl = chunk_faces3.length; f < fl; f++) {\r\n\r\n              value = customAttribute.value[chunk_faces3[f]];\r\n\r\n              v1 = value;\r\n              v2 = value;\r\n              v3 = value;\r\n\r\n              customAttribute.array[offset_custom] = v1.x;\r\n              customAttribute.array[offset_custom + 1] = v1.y;\r\n\r\n              customAttribute.array[offset_custom + 2] = v2.x;\r\n              customAttribute.array[offset_custom + 3] = v2.y;\r\n\r\n              customAttribute.array[offset_custom + 4] = v3.x;\r\n              customAttribute.array[offset_custom + 5] = v3.y;\r\n\r\n              offset_custom += 6;\r\n\r\n            }\r\n\r\n          }\r\n\r\n        }\r\n        else if (customAttribute.size === 3) {\r\n\r\n          var pp;\r\n\r\n          if (customAttribute.type === 'c') {\r\n\r\n            pp = ['r', 'g', 'b'];\r\n\r\n          }\r\n          else {\r\n\r\n            pp = ['x', 'y', 'z'];\r\n\r\n          }\r\n\r\n          if (customAttribute.boundTo === undefined || customAttribute.boundTo === 'vertices') {\r\n\r\n            for (f = 0, fl = chunk_faces3.length; f < fl; f++) {\r\n\r\n              face = obj_faces[chunk_faces3[f]];\r\n\r\n              v1 = customAttribute.value[face.a];\r\n              v2 = customAttribute.value[face.b];\r\n              v3 = customAttribute.value[face.c];\r\n\r\n              customAttribute.array[offset_custom] = v1[pp[0]];\r\n              customAttribute.array[offset_custom + 1] = v1[pp[1]];\r\n              customAttribute.array[offset_custom + 2] = v1[pp[2]];\r\n\r\n              customAttribute.array[offset_custom + 3] = v2[pp[0]];\r\n              customAttribute.array[offset_custom + 4] = v2[pp[1]];\r\n              customAttribute.array[offset_custom + 5] = v2[pp[2]];\r\n\r\n              customAttribute.array[offset_custom + 6] = v3[pp[0]];\r\n              customAttribute.array[offset_custom + 7] = v3[pp[1]];\r\n              customAttribute.array[offset_custom + 8] = v3[pp[2]];\r\n\r\n              offset_custom += 9;\r\n\r\n            }\r\n\r\n          }\r\n          else if (customAttribute.boundTo === 'faces') {\r\n\r\n            for (f = 0, fl = chunk_faces3.length; f < fl; f++) {\r\n\r\n              value = customAttribute.value[chunk_faces3[f]];\r\n\r\n              v1 = value;\r\n              v2 = value;\r\n              v3 = value;\r\n\r\n              customAttribute.array[offset_custom] = v1[pp[0]];\r\n              customAttribute.array[offset_custom + 1] = v1[pp[1]];\r\n              customAttribute.array[offset_custom + 2] = v1[pp[2]];\r\n\r\n              customAttribute.array[offset_custom + 3] = v2[pp[0]];\r\n              customAttribute.array[offset_custom + 4] = v2[pp[1]];\r\n              customAttribute.array[offset_custom + 5] = v2[pp[2]];\r\n\r\n              customAttribute.array[offset_custom + 6] = v3[pp[0]];\r\n              customAttribute.array[offset_custom + 7] = v3[pp[1]];\r\n              customAttribute.array[offset_custom + 8] = v3[pp[2]];\r\n\r\n              offset_custom += 9;\r\n\r\n            }\r\n\r\n          }\r\n          else if (customAttribute.boundTo === 'faceVertices') {\r\n\r\n            for (f = 0, fl = chunk_faces3.length; f < fl; f++) {\r\n\r\n              value = customAttribute.value[chunk_faces3[f]];\r\n\r\n              v1 = value[0];\r\n              v2 = value[1];\r\n              v3 = value[2];\r\n\r\n              customAttribute.array[offset_custom] = v1[pp[0]];\r\n              customAttribute.array[offset_custom + 1] = v1[pp[1]];\r\n              customAttribute.array[offset_custom + 2] = v1[pp[2]];\r\n\r\n              customAttribute.array[offset_custom + 3] = v2[pp[0]];\r\n              customAttribute.array[offset_custom + 4] = v2[pp[1]];\r\n              customAttribute.array[offset_custom + 5] = v2[pp[2]];\r\n\r\n              customAttribute.array[offset_custom + 6] = v3[pp[0]];\r\n              customAttribute.array[offset_custom + 7] = v3[pp[1]];\r\n              customAttribute.array[offset_custom + 8] = v3[pp[2]];\r\n\r\n              offset_custom += 9;\r\n\r\n            }\r\n\r\n          }\r\n\r\n        }\r\n        else if (customAttribute.size === 4) {\r\n\r\n          if (customAttribute.boundTo === undefined || customAttribute.boundTo === 'vertices') {\r\n\r\n            for (f = 0, fl = chunk_faces3.length; f < fl; f++) {\r\n\r\n              face = obj_faces[chunk_faces3[f]];\r\n\r\n              v1 = customAttribute.value[face.a];\r\n              v2 = customAttribute.value[face.b];\r\n              v3 = customAttribute.value[face.c];\r\n\r\n              customAttribute.array[offset_custom] = v1.x;\r\n              customAttribute.array[offset_custom + 1] = v1.y;\r\n              customAttribute.array[offset_custom + 2] = v1.z;\r\n              customAttribute.array[offset_custom + 3] = v1.w;\r\n\r\n              customAttribute.array[offset_custom + 4] = v2.x;\r\n              customAttribute.array[offset_custom + 5] = v2.y;\r\n              customAttribute.array[offset_custom + 6] = v2.z;\r\n              customAttribute.array[offset_custom + 7] = v2.w;\r\n\r\n              customAttribute.array[offset_custom + 8] = v3.x;\r\n              customAttribute.array[offset_custom + 9] = v3.y;\r\n              customAttribute.array[offset_custom + 10] = v3.z;\r\n              customAttribute.array[offset_custom + 11] = v3.w;\r\n\r\n              offset_custom += 12;\r\n\r\n            }\r\n\r\n          }\r\n          else if (customAttribute.boundTo === 'faces') {\r\n\r\n            for (f = 0, fl = chunk_faces3.length; f < fl; f++) {\r\n\r\n              value = customAttribute.value[chunk_faces3[f]];\r\n\r\n              v1 = value;\r\n              v2 = value;\r\n              v3 = value;\r\n\r\n              customAttribute.array[offset_custom] = v1.x;\r\n              customAttribute.array[offset_custom + 1] = v1.y;\r\n              customAttribute.array[offset_custom + 2] = v1.z;\r\n              customAttribute.array[offset_custom + 3] = v1.w;\r\n\r\n              customAttribute.array[offset_custom + 4] = v2.x;\r\n              customAttribute.array[offset_custom + 5] = v2.y;\r\n              customAttribute.array[offset_custom + 6] = v2.z;\r\n              customAttribute.array[offset_custom + 7] = v2.w;\r\n\r\n              customAttribute.array[offset_custom + 8] = v3.x;\r\n              customAttribute.array[offset_custom + 9] = v3.y;\r\n              customAttribute.array[offset_custom + 10] = v3.z;\r\n              customAttribute.array[offset_custom + 11] = v3.w;\r\n\r\n              offset_custom += 12;\r\n\r\n            }\r\n\r\n          }\r\n          else if (customAttribute.boundTo === 'faceVertices') {\r\n\r\n            for (f = 0, fl = chunk_faces3.length; f < fl; f++) {\r\n\r\n              value = customAttribute.value[chunk_faces3[f]];\r\n\r\n              v1 = value[0];\r\n              v2 = value[1];\r\n              v3 = value[2];\r\n\r\n              customAttribute.array[offset_custom] = v1.x;\r\n              customAttribute.array[offset_custom + 1] = v1.y;\r\n              customAttribute.array[offset_custom + 2] = v1.z;\r\n              customAttribute.array[offset_custom + 3] = v1.w;\r\n\r\n              customAttribute.array[offset_custom + 4] = v2.x;\r\n              customAttribute.array[offset_custom + 5] = v2.y;\r\n              customAttribute.array[offset_custom + 6] = v2.z;\r\n              customAttribute.array[offset_custom + 7] = v2.w;\r\n\r\n              customAttribute.array[offset_custom + 8] = v3.x;\r\n              customAttribute.array[offset_custom + 9] = v3.y;\r\n              customAttribute.array[offset_custom + 10] = v3.z;\r\n              customAttribute.array[offset_custom + 11] = v3.w;\r\n\r\n              offset_custom += 12;\r\n\r\n            }\r\n\r\n          }\r\n\r\n        }\r\n\r\n        _gl.bindBuffer(_gl.ARRAY_BUFFER, customAttribute.buffer);\r\n        _gl.bufferData(_gl.ARRAY_BUFFER, customAttribute.array, hint);\r\n\r\n      }\r\n\r\n    }\r\n\r\n    if (dispose) {\r\n\r\n      delete geometryGroup.__inittedArrays;\r\n      delete geometryGroup.__colorArray;\r\n      delete geometryGroup.__normalArray;\r\n      delete geometryGroup.__tangentArray;\r\n      delete geometryGroup.__uvArray;\r\n      delete geometryGroup.__uv2Array;\r\n      delete geometryGroup.__faceArray;\r\n      delete geometryGroup.__vertexArray;\r\n      delete geometryGroup.__lineArray;\r\n      delete geometryGroup.__skinIndexArray;\r\n      delete geometryGroup.__skinWeightArray;\r\n\r\n    }\r\n\r\n  };\r\n\r\n  // Buffer rendering\r\n\r\n  this.renderBufferImmediate = function(object, program, material) {\r\n\r\n    state.initAttributes();\r\n\r\n    if (object.hasPositions && !object.__webglVertexBuffer) object.__webglVertexBuffer = _gl.createBuffer();\r\n    if (object.hasNormals && !object.__webglNormalBuffer) object.__webglNormalBuffer = _gl.createBuffer();\r\n    if (object.hasUvs && !object.__webglUvBuffer) object.__webglUvBuffer = _gl.createBuffer();\r\n    if (object.hasColors && !object.__webglColorBuffer) object.__webglColorBuffer = _gl.createBuffer();\r\n\r\n    if (object.hasPositions) {\r\n\r\n      _gl.bindBuffer(_gl.ARRAY_BUFFER, object.__webglVertexBuffer);\r\n      _gl.bufferData(_gl.ARRAY_BUFFER, object.positionArray, _gl.DYNAMIC_DRAW);\r\n\r\n      state.enableAttribute(program.attributes.position);\r\n\r\n      _gl.vertexAttribPointer(program.attributes.position, 3, _gl.FLOAT, false, 0, 0);\r\n\r\n    }\r\n\r\n    if (object.hasNormals) {\r\n\r\n      _gl.bindBuffer(_gl.ARRAY_BUFFER, object.__webglNormalBuffer);\r\n\r\n      if (material instanceof THREE.MeshPhongMaterial === false &&\r\n        material.shading === THREE.FlatShading) {\r\n\r\n        var nx, ny, nz,\r\n          nax, nbx, ncx, nay, nby, ncy, naz, nbz, ncz,\r\n          normalArray,\r\n          i, il = object.count * 3;\r\n\r\n        for (i = 0; i < il; i += 9) {\r\n\r\n          normalArray = object.normalArray;\r\n\r\n          nax = normalArray[i];\r\n          nay = normalArray[i + 1];\r\n          naz = normalArray[i + 2];\r\n\r\n          nbx = normalArray[i + 3];\r\n          nby = normalArray[i + 4];\r\n          nbz = normalArray[i + 5];\r\n\r\n          ncx = normalArray[i + 6];\r\n          ncy = normalArray[i + 7];\r\n          ncz = normalArray[i + 8];\r\n\r\n          nx = (nax + nbx + ncx) / 3;\r\n          ny = (nay + nby + ncy) / 3;\r\n          nz = (naz + nbz + ncz) / 3;\r\n\r\n          normalArray[i] = nx;\r\n          normalArray[i + 1] = ny;\r\n          normalArray[i + 2] = nz;\r\n\r\n          normalArray[i + 3] = nx;\r\n          normalArray[i + 4] = ny;\r\n          normalArray[i + 5] = nz;\r\n\r\n          normalArray[i + 6] = nx;\r\n          normalArray[i + 7] = ny;\r\n          normalArray[i + 8] = nz;\r\n\r\n        }\r\n\r\n      }\r\n\r\n      _gl.bufferData(_gl.ARRAY_BUFFER, object.normalArray, _gl.DYNAMIC_DRAW);\r\n\r\n      state.enableAttribute(program.attributes.normal);\r\n\r\n      _gl.vertexAttribPointer(program.attributes.normal, 3, _gl.FLOAT, false, 0, 0);\r\n\r\n    }\r\n\r\n    if (object.hasUvs && material.map) {\r\n\r\n      _gl.bindBuffer(_gl.ARRAY_BUFFER, object.__webglUvBuffer);\r\n      _gl.bufferData(_gl.ARRAY_BUFFER, object.uvArray, _gl.DYNAMIC_DRAW);\r\n\r\n      state.enableAttribute(program.attributes.uv);\r\n\r\n      _gl.vertexAttribPointer(program.attributes.uv, 2, _gl.FLOAT, false, 0, 0);\r\n\r\n    }\r\n\r\n    if (object.hasColors && material.vertexColors !== THREE.NoColors) {\r\n\r\n      _gl.bindBuffer(_gl.ARRAY_BUFFER, object.__webglColorBuffer);\r\n      _gl.bufferData(_gl.ARRAY_BUFFER, object.colorArray, _gl.DYNAMIC_DRAW);\r\n\r\n      state.enableAttribute(program.attributes.color);\r\n\r\n      _gl.vertexAttribPointer(program.attributes.color, 3, _gl.FLOAT, false, 0, 0);\r\n\r\n    }\r\n\r\n    state.disableUnusedAttributes();\r\n\r\n    _gl.drawArrays(_gl.TRIANGLES, 0, object.count);\r\n\r\n    object.count = 0;\r\n\r\n  };\r\n\r\n  function setupVertexAttributes(material, program, geometry, startIndex) {\r\n\r\n    var geometryAttributes = geometry.attributes;\r\n\r\n    var programAttributes = program.attributes;\r\n    var programAttributesKeys = program.attributesKeys;\r\n\r\n    for (var i = 0, l = programAttributesKeys.length; i < l; i++) {\r\n\r\n      var key = programAttributesKeys[i];\r\n      var programAttribute = programAttributes[key];\r\n\r\n      if (programAttribute >= 0) {\r\n\r\n        var geometryAttribute = geometryAttributes[key];\r\n\r\n        if (geometryAttribute !== undefined) {\r\n\r\n          var size = geometryAttribute.itemSize;\r\n\r\n          _gl.bindBuffer(_gl.ARRAY_BUFFER, geometryAttribute.buffer);\r\n\r\n          state.enableAttribute(programAttribute);\r\n\r\n          _gl.vertexAttribPointer(programAttribute, size, _gl.FLOAT, false, 0, startIndex * size * 4); // 4 bytes per Float32\r\n\r\n        }\r\n        else if (material.defaultAttributeValues !== undefined) {\r\n\r\n          if (material.defaultAttributeValues[key].length === 2) {\r\n\r\n            _gl.vertexAttrib2fv(programAttribute, material.defaultAttributeValues[key]);\r\n\r\n          }\r\n          else if (material.defaultAttributeValues[key].length === 3) {\r\n\r\n            _gl.vertexAttrib3fv(programAttribute, material.defaultAttributeValues[key]);\r\n\r\n          }\r\n\r\n        }\r\n\r\n      }\r\n\r\n    }\r\n\r\n    state.disableUnusedAttributes();\r\n\r\n  }\r\n\r\n  this.renderBufferDirect = function(camera, lights, fog, material, geometry, object) {\r\n\r\n    if (material.visible === false) return;\r\n\r\n    updateObject(object);\r\n\r\n    var program = setProgram(camera, lights, fog, material, object);\r\n\r\n    var updateBuffers = false,\r\n      wireframeBit = material.wireframe ? 1 : 0,\r\n      geometryProgram = 'direct_' + geometry.id + '_' + program.id + '_' + wireframeBit;\r\n\r\n    if (geometryProgram !== _currentGeometryProgram) {\r\n\r\n      _currentGeometryProgram = geometryProgram;\r\n      updateBuffers = true;\r\n\r\n    }\r\n\r\n    if (updateBuffers) {\r\n\r\n      state.initAttributes();\r\n\r\n    }\r\n\r\n    // render mesh\r\n\r\n    if (object instanceof THREE.Mesh) {\r\n\r\n      var mode = material.wireframe === true ? _gl.LINES : _gl.TRIANGLES;\r\n\r\n      var index = geometry.attributes.index;\r\n\r\n      if (index) {\r\n\r\n        // indexed triangles\r\n\r\n        var type, size;\r\n\r\n        if (index.array instanceof Uint32Array && extensions.get('OES_element_index_uint')) {\r\n\r\n          type = _gl.UNSIGNED_INT;\r\n          size = 4;\r\n\r\n        }\r\n        else {\r\n\r\n          type = _gl.UNSIGNED_SHORT;\r\n          size = 2;\r\n\r\n        }\r\n\r\n        var offsets = geometry.offsets;\r\n\r\n        if (offsets.length === 0) {\r\n\r\n          if (updateBuffers) {\r\n\r\n            setupVertexAttributes(material, program, geometry, 0);\r\n            _gl.bindBuffer(_gl.ELEMENT_ARRAY_BUFFER, index.buffer);\r\n\r\n          }\r\n\r\n          _gl.drawElements(mode, index.array.length, type, 0);\r\n\r\n          _this.info.render.calls++;\r\n          _this.info.render.vertices += index.array.length; // not really true, here vertices can be shared\r\n          _this.info.render.faces += index.array.length / 3;\r\n\r\n        }\r\n        else {\r\n\r\n          // if there is more than 1 chunk\r\n          // must set attribute pointers to use new offsets for each chunk\r\n          // even if geometry and materials didn't change\r\n\r\n          updateBuffers = true;\r\n\r\n          for (var i = 0, il = offsets.length; i < il; i++) {\r\n\r\n            var startIndex = offsets[i].index;\r\n\r\n            if (updateBuffers) {\r\n\r\n              setupVertexAttributes(material, program, geometry, startIndex);\r\n              _gl.bindBuffer(_gl.ELEMENT_ARRAY_BUFFER, index.buffer);\r\n\r\n            }\r\n\r\n            // render indexed triangles\r\n\r\n            _gl.drawElements(mode, offsets[i].count, type, offsets[i].start * size);\r\n\r\n            _this.info.render.calls++;\r\n            _this.info.render.vertices += offsets[i].count; // not really true, here vertices can be shared\r\n            _this.info.render.faces += offsets[i].count / 3;\r\n\r\n          }\r\n\r\n        }\r\n\r\n      }\r\n      else {\r\n\r\n        // non-indexed triangles\r\n\r\n        if (updateBuffers) {\r\n\r\n          setupVertexAttributes(material, program, geometry, 0);\r\n\r\n        }\r\n\r\n        var position = geometry.attributes['position'];\r\n\r\n        // render non-indexed triangles\r\n\r\n        _gl.drawArrays(mode, 0, position.array.length / position.itemSize);\r\n\r\n        _this.info.render.calls++;\r\n        _this.info.render.vertices += position.array.length / position.itemSize;\r\n        _this.info.render.faces += position.array.length / (3 * position.itemSize);\r\n\r\n      }\r\n\r\n    }\r\n    else if (object instanceof THREE.PointCloud) {\r\n\r\n      // render particles\r\n\r\n      var mode = _gl.POINTS;\r\n\r\n      var index = geometry.attributes.index;\r\n\r\n      if (index) {\r\n\r\n        // indexed points\r\n\r\n        var type, size;\r\n\r\n        if (index.array instanceof Uint32Array && extensions.get('OES_element_index_uint')) {\r\n\r\n          type = _gl.UNSIGNED_INT;\r\n          size = 4;\r\n\r\n        }\r\n        else {\r\n\r\n          type = _gl.UNSIGNED_SHORT;\r\n          size = 2;\r\n\r\n        }\r\n\r\n        var offsets = geometry.offsets;\r\n\r\n        if (offsets.length === 0) {\r\n\r\n          if (updateBuffers) {\r\n\r\n            setupVertexAttributes(material, program, geometry, 0);\r\n            _gl.bindBuffer(_gl.ELEMENT_ARRAY_BUFFER, index.buffer);\r\n\r\n          }\r\n\r\n          _gl.drawElements(mode, index.array.length, type, 0);\r\n\r\n          _this.info.render.calls++;\r\n          _this.info.render.points += index.array.length;\r\n\r\n        }\r\n        else {\r\n\r\n          // if there is more than 1 chunk\r\n          // must set attribute pointers to use new offsets for each chunk\r\n          // even if geometry and materials didn't change\r\n\r\n          if (offsets.length > 1) updateBuffers = true;\r\n\r\n          for (var i = 0, il = offsets.length; i < il; i++) {\r\n\r\n            var startIndex = offsets[i].index;\r\n\r\n            if (updateBuffers) {\r\n\r\n              setupVertexAttributes(material, program, geometry, startIndex);\r\n              _gl.bindBuffer(_gl.ELEMENT_ARRAY_BUFFER, index.buffer);\r\n\r\n            }\r\n\r\n            // render indexed points\r\n\r\n            _gl.drawElements(mode, offsets[i].count, type, offsets[i].start * size);\r\n\r\n            _this.info.render.calls++;\r\n            _this.info.render.points += offsets[i].count;\r\n\r\n          }\r\n\r\n        }\r\n\r\n      }\r\n      else {\r\n\r\n        // non-indexed points\r\n\r\n        if (updateBuffers) {\r\n\r\n          setupVertexAttributes(material, program, geometry, 0);\r\n\r\n        }\r\n\r\n        var position = geometry.attributes.position;\r\n        var offsets = geometry.offsets;\r\n\r\n        if (offsets.length === 0) {\r\n\r\n          _gl.drawArrays(mode, 0, position.array.length / 3);\r\n\r\n          _this.info.render.calls++;\r\n          _this.info.render.points += position.array.length / 3;\r\n\r\n        }\r\n        else {\r\n\r\n          for (var i = 0, il = offsets.length; i < il; i++) {\r\n\r\n            _gl.drawArrays(mode, offsets[i].index, offsets[i].count);\r\n\r\n            _this.info.render.calls++;\r\n            _this.info.render.points += offsets[i].count;\r\n\r\n          }\r\n\r\n        }\r\n\r\n      }\r\n\r\n    }\r\n    else if (object instanceof THREE.Line) {\r\n\r\n      var mode = (object.mode === THREE.LineStrip) ? _gl.LINE_STRIP : _gl.LINES;\r\n\r\n      state.setLineWidth(material.linewidth * pixelRatio);\r\n\r\n      var index = geometry.attributes.index;\r\n\r\n      if (index) {\r\n\r\n        // indexed lines\r\n\r\n        var type, size;\r\n\r\n        if (index.array instanceof Uint32Array) {\r\n\r\n          type = _gl.UNSIGNED_INT;\r\n          size = 4;\r\n\r\n        }\r\n        else {\r\n\r\n          type = _gl.UNSIGNED_SHORT;\r\n          size = 2;\r\n\r\n        }\r\n\r\n        var offsets = geometry.offsets;\r\n\r\n        if (offsets.length === 0) {\r\n\r\n          if (updateBuffers) {\r\n\r\n            setupVertexAttributes(material, program, geometry, 0);\r\n            _gl.bindBuffer(_gl.ELEMENT_ARRAY_BUFFER, index.buffer);\r\n\r\n          }\r\n\r\n          _gl.drawElements(mode, index.array.length, type, 0); // 2 bytes per Uint16Array\r\n\r\n          _this.info.render.calls++;\r\n          _this.info.render.vertices += index.array.length; // not really true, here vertices can be shared\r\n\r\n        }\r\n        else {\r\n\r\n          // if there is more than 1 chunk\r\n          // must set attribute pointers to use new offsets for each chunk\r\n          // even if geometry and materials didn't change\r\n\r\n          if (offsets.length > 1) updateBuffers = true;\r\n\r\n          for (var i = 0, il = offsets.length; i < il; i++) {\r\n\r\n            var startIndex = offsets[i].index;\r\n\r\n            if (updateBuffers) {\r\n\r\n              setupVertexAttributes(material, program, geometry, startIndex);\r\n              _gl.bindBuffer(_gl.ELEMENT_ARRAY_BUFFER, index.buffer);\r\n\r\n            }\r\n\r\n            // render indexed lines\r\n\r\n            _gl.drawElements(mode, offsets[i].count, type, offsets[i].start * size); // 2 bytes per Uint16Array\r\n\r\n            _this.info.render.calls++;\r\n            _this.info.render.vertices += offsets[i].count; // not really true, here vertices can be shared\r\n\r\n          }\r\n\r\n        }\r\n\r\n      }\r\n      else {\r\n\r\n        // non-indexed lines\r\n\r\n        if (updateBuffers) {\r\n\r\n          setupVertexAttributes(material, program, geometry, 0);\r\n\r\n        }\r\n\r\n        var position = geometry.attributes.position;\r\n        var offsets = geometry.offsets;\r\n\r\n        if (offsets.length === 0) {\r\n\r\n          _gl.drawArrays(mode, 0, position.array.length / 3);\r\n\r\n          _this.info.render.calls++;\r\n          _this.info.render.vertices += position.array.length / 3;\r\n\r\n        }\r\n        else {\r\n\r\n          for (var i = 0, il = offsets.length; i < il; i++) {\r\n\r\n            _gl.drawArrays(mode, offsets[i].index, offsets[i].count);\r\n\r\n            _this.info.render.calls++;\r\n            _this.info.render.vertices += offsets[i].count;\r\n\r\n          }\r\n\r\n        }\r\n\r\n      }\r\n\r\n    }\r\n\r\n  };\r\n\r\n  this.renderBuffer = function(camera, lights, fog, material, geometryGroup, object) {\r\n\r\n    if (material.visible === false) return;\r\n\r\n    updateObject(object);\r\n\r\n    var program = setProgram(camera, lights, fog, material, object);\r\n\r\n    var attributes = program.attributes;\r\n\r\n    var updateBuffers = false,\r\n      wireframeBit = material.wireframe ? 1 : 0,\r\n      geometryProgram = geometryGroup.id + '_' + program.id + '_' + wireframeBit;\r\n\r\n    if (geometryProgram !== _currentGeometryProgram) {\r\n\r\n      _currentGeometryProgram = geometryProgram;\r\n      updateBuffers = true;\r\n\r\n    }\r\n\r\n    if (updateBuffers) {\r\n\r\n      state.initAttributes();\r\n\r\n    }\r\n\r\n    // vertices\r\n\r\n    if (!material.morphTargets && attributes.position >= 0) {\r\n\r\n      if (updateBuffers) {\r\n\r\n        _gl.bindBuffer(_gl.ARRAY_BUFFER, geometryGroup.__webglVertexBuffer);\r\n\r\n        state.enableAttribute(attributes.position);\r\n\r\n        _gl.vertexAttribPointer(attributes.position, 3, _gl.FLOAT, false, 0, 0);\r\n\r\n      }\r\n\r\n    }\r\n    else {\r\n\r\n      if (object.morphTargetBase) {\r\n\r\n        setupMorphTargets(material, geometryGroup, object);\r\n\r\n      }\r\n\r\n    }\r\n\r\n\r\n    if (updateBuffers) {\r\n\r\n      // custom attributes\r\n\r\n      // Use the per-geometryGroup custom attribute arrays which are setup in initMeshBuffers\r\n\r\n      if (geometryGroup.__webglCustomAttributesList) {\r\n\r\n        for (var i = 0, il = geometryGroup.__webglCustomAttributesList.length; i < il; i++) {\r\n\r\n          var attribute = geometryGroup.__webglCustomAttributesList[i];\r\n\r\n          if (attributes[attribute.buffer.belongsToAttribute] >= 0) {\r\n\r\n            _gl.bindBuffer(_gl.ARRAY_BUFFER, attribute.buffer);\r\n\r\n            state.enableAttribute(attributes[attribute.buffer.belongsToAttribute]);\r\n\r\n            _gl.vertexAttribPointer(attributes[attribute.buffer.belongsToAttribute], attribute.size, _gl.FLOAT, false, 0, 0);\r\n\r\n          }\r\n\r\n        }\r\n\r\n      }\r\n\r\n\r\n      // colors\r\n\r\n      if (attributes.color >= 0) {\r\n\r\n        if (object.geometry.colors.length > 0 || object.geometry.faces.length > 0) {\r\n\r\n          _gl.bindBuffer(_gl.ARRAY_BUFFER, geometryGroup.__webglColorBuffer);\r\n\r\n          state.enableAttribute(attributes.color);\r\n\r\n          _gl.vertexAttribPointer(attributes.color, 3, _gl.FLOAT, false, 0, 0);\r\n\r\n        }\r\n        else if (material.defaultAttributeValues !== undefined) {\r\n\r\n\r\n          _gl.vertexAttrib3fv(attributes.color, material.defaultAttributeValues.color);\r\n\r\n        }\r\n\r\n      }\r\n\r\n      // normals\r\n\r\n      if (attributes.normal >= 0) {\r\n\r\n        _gl.bindBuffer(_gl.ARRAY_BUFFER, geometryGroup.__webglNormalBuffer);\r\n\r\n        state.enableAttribute(attributes.normal);\r\n\r\n        _gl.vertexAttribPointer(attributes.normal, 3, _gl.FLOAT, false, 0, 0);\r\n\r\n      }\r\n\r\n      // tangents\r\n\r\n      if (attributes.tangent >= 0) {\r\n\r\n        _gl.bindBuffer(_gl.ARRAY_BUFFER, geometryGroup.__webglTangentBuffer);\r\n\r\n        state.enableAttribute(attributes.tangent);\r\n\r\n        _gl.vertexAttribPointer(attributes.tangent, 4, _gl.FLOAT, false, 0, 0);\r\n\r\n      }\r\n\r\n      // uvs\r\n\r\n      if (attributes.uv >= 0) {\r\n\r\n        if (object.geometry.faceVertexUvs[0]) {\r\n\r\n          _gl.bindBuffer(_gl.ARRAY_BUFFER, geometryGroup.__webglUVBuffer);\r\n\r\n          state.enableAttribute(attributes.uv);\r\n\r\n          _gl.vertexAttribPointer(attributes.uv, 2, _gl.FLOAT, false, 0, 0);\r\n\r\n        }\r\n        else if (material.defaultAttributeValues !== undefined) {\r\n\r\n\r\n          _gl.vertexAttrib2fv(attributes.uv, material.defaultAttributeValues.uv);\r\n\r\n        }\r\n\r\n      }\r\n\r\n      if (attributes.uv2 >= 0) {\r\n\r\n        if (object.geometry.faceVertexUvs[1]) {\r\n\r\n          _gl.bindBuffer(_gl.ARRAY_BUFFER, geometryGroup.__webglUV2Buffer);\r\n\r\n          state.enableAttribute(attributes.uv2);\r\n\r\n          _gl.vertexAttribPointer(attributes.uv2, 2, _gl.FLOAT, false, 0, 0);\r\n\r\n        }\r\n        else if (material.defaultAttributeValues !== undefined) {\r\n\r\n\r\n          _gl.vertexAttrib2fv(attributes.uv2, material.defaultAttributeValues.uv2);\r\n\r\n        }\r\n\r\n      }\r\n\r\n      if (material.skinning &&\r\n        attributes.skinIndex >= 0 && attributes.skinWeight >= 0) {\r\n\r\n        _gl.bindBuffer(_gl.ARRAY_BUFFER, geometryGroup.__webglSkinIndicesBuffer);\r\n\r\n        state.enableAttribute(attributes.skinIndex);\r\n\r\n        _gl.vertexAttribPointer(attributes.skinIndex, 4, _gl.FLOAT, false, 0, 0);\r\n\r\n        _gl.bindBuffer(_gl.ARRAY_BUFFER, geometryGroup.__webglSkinWeightsBuffer);\r\n\r\n        state.enableAttribute(attributes.skinWeight);\r\n\r\n        _gl.vertexAttribPointer(attributes.skinWeight, 4, _gl.FLOAT, false, 0, 0);\r\n\r\n      }\r\n\r\n      // line distances\r\n\r\n      if (attributes.lineDistance >= 0) {\r\n\r\n        _gl.bindBuffer(_gl.ARRAY_BUFFER, geometryGroup.__webglLineDistanceBuffer);\r\n\r\n        state.enableAttribute(attributes.lineDistance);\r\n\r\n        _gl.vertexAttribPointer(attributes.lineDistance, 1, _gl.FLOAT, false, 0, 0);\r\n\r\n      }\r\n\r\n    }\r\n\r\n    state.disableUnusedAttributes();\r\n\r\n    // render mesh\r\n\r\n    if (object instanceof THREE.Mesh) {\r\n\r\n      var type = geometryGroup.__typeArray === Uint32Array ? _gl.UNSIGNED_INT : _gl.UNSIGNED_SHORT;\r\n\r\n      // wireframe\r\n\r\n      if (material.wireframe) {\r\n\r\n        state.setLineWidth(material.wireframeLinewidth * pixelRatio);\r\n\r\n        if (updateBuffers) _gl.bindBuffer(_gl.ELEMENT_ARRAY_BUFFER, geometryGroup.__webglLineBuffer);\r\n        _gl.drawElements(_gl.LINES, geometryGroup.__webglLineCount, type, 0);\r\n\r\n        // triangles\r\n\r\n      }\r\n      else {\r\n\r\n        if (updateBuffers) _gl.bindBuffer(_gl.ELEMENT_ARRAY_BUFFER, geometryGroup.__webglFaceBuffer);\r\n        _gl.drawElements(_gl.TRIANGLES, geometryGroup.__webglFaceCount, type, 0);\r\n\r\n      }\r\n\r\n      _this.info.render.calls++;\r\n      _this.info.render.vertices += geometryGroup.__webglFaceCount;\r\n      _this.info.render.faces += geometryGroup.__webglFaceCount / 3;\r\n\r\n      // render lines\r\n\r\n    }\r\n    else if (object instanceof THREE.Line) {\r\n\r\n      var mode = (object.mode === THREE.LineStrip) ? _gl.LINE_STRIP : _gl.LINES;\r\n\r\n      state.setLineWidth(material.linewidth * pixelRatio);\r\n\r\n      _gl.drawArrays(mode, 0, geometryGroup.__webglLineCount);\r\n\r\n      _this.info.render.calls++;\r\n\r\n      // render particles\r\n\r\n    }\r\n    else if (object instanceof THREE.PointCloud) {\r\n\r\n      _gl.drawArrays(_gl.POINTS, 0, geometryGroup.__webglParticleCount);\r\n\r\n      _this.info.render.calls++;\r\n      _this.info.render.points += geometryGroup.__webglParticleCount;\r\n\r\n    }\r\n\r\n  };\r\n\r\n  function setupMorphTargets(material, geometryGroup, object) {\r\n\r\n    // set base\r\n\r\n    var attributes = material.program.attributes;\r\n\r\n    if (object.morphTargetBase !== -1 && attributes.position >= 0) {\r\n\r\n      _gl.bindBuffer(_gl.ARRAY_BUFFER, geometryGroup.__webglMorphTargetsBuffers[object.morphTargetBase]);\r\n\r\n      state.enableAttribute(attributes.position);\r\n\r\n      _gl.vertexAttribPointer(attributes.position, 3, _gl.FLOAT, false, 0, 0);\r\n\r\n    }\r\n    else if (attributes.position >= 0) {\r\n\r\n      _gl.bindBuffer(_gl.ARRAY_BUFFER, geometryGroup.__webglVertexBuffer);\r\n\r\n      state.enableAttribute(attributes.position);\r\n\r\n      _gl.vertexAttribPointer(attributes.position, 3, _gl.FLOAT, false, 0, 0);\r\n\r\n    }\r\n\r\n    if (object.morphTargetForcedOrder.length) {\r\n\r\n      // set forced order\r\n\r\n      var m = 0;\r\n      var order = object.morphTargetForcedOrder;\r\n      var influences = object.morphTargetInfluences;\r\n\r\n      var attribute;\r\n\r\n      while (m < material.numSupportedMorphTargets && m < order.length) {\r\n\r\n        attribute = attributes['morphTarget' + m];\r\n\r\n        if (attribute >= 0) {\r\n\r\n          _gl.bindBuffer(_gl.ARRAY_BUFFER, geometryGroup.__webglMorphTargetsBuffers[order[m]]);\r\n\r\n          state.enableAttribute(attribute);\r\n\r\n          _gl.vertexAttribPointer(attribute, 3, _gl.FLOAT, false, 0, 0);\r\n\r\n        }\r\n\r\n        attribute = attributes['morphNormal' + m];\r\n\r\n        if (attribute >= 0 && material.morphNormals) {\r\n\r\n          _gl.bindBuffer(_gl.ARRAY_BUFFER, geometryGroup.__webglMorphNormalsBuffers[order[m]]);\r\n\r\n          state.enableAttribute(attribute);\r\n\r\n          _gl.vertexAttribPointer(attribute, 3, _gl.FLOAT, false, 0, 0);\r\n\r\n        }\r\n\r\n        object.__webglMorphTargetInfluences[m] = influences[order[m]];\r\n\r\n        m++;\r\n\r\n      }\r\n\r\n    }\r\n    else {\r\n\r\n      // find the most influencing\r\n\r\n      var activeInfluenceIndices = [];\r\n      var influences = object.morphTargetInfluences;\r\n      var morphTargets = object.geometry.morphTargets;\r\n\r\n      if (influences.length > morphTargets.length) {\r\n\r\n        console.warn('THREE.WebGLRenderer: Influences array is bigger than morphTargets array.');\r\n        influences.length = morphTargets.length;\r\n\r\n      }\r\n\r\n      for (var i = 0, il = influences.length; i < il; i++) {\r\n\r\n        var influence = influences[i];\r\n\r\n        activeInfluenceIndices.push([influence, i]);\r\n\r\n      }\r\n\r\n      if (activeInfluenceIndices.length > material.numSupportedMorphTargets) {\r\n\r\n        activeInfluenceIndices.sort(numericalSort);\r\n        activeInfluenceIndices.length = material.numSupportedMorphTargets;\r\n\r\n      }\r\n      else if (activeInfluenceIndices.length > material.numSupportedMorphNormals) {\r\n\r\n        activeInfluenceIndices.sort(numericalSort);\r\n\r\n      }\r\n      else if (activeInfluenceIndices.length === 0) {\r\n\r\n        activeInfluenceIndices.push([0, 0]);\r\n\r\n      }\r\n\r\n      var attribute;\r\n\r\n      for (var m = 0, ml = material.numSupportedMorphTargets; m < ml; m++) {\r\n\r\n        if (activeInfluenceIndices[m]) {\r\n\r\n          var influenceIndex = activeInfluenceIndices[m][1];\r\n\r\n          attribute = attributes['morphTarget' + m];\r\n\r\n          if (attribute >= 0) {\r\n\r\n            _gl.bindBuffer(_gl.ARRAY_BUFFER, geometryGroup.__webglMorphTargetsBuffers[influenceIndex]);\r\n\r\n            state.enableAttribute(attribute);\r\n\r\n            _gl.vertexAttribPointer(attribute, 3, _gl.FLOAT, false, 0, 0);\r\n\r\n          }\r\n\r\n          attribute = attributes['morphNormal' + m];\r\n\r\n          if (attribute >= 0 && material.morphNormals) {\r\n\r\n            _gl.bindBuffer(_gl.ARRAY_BUFFER, geometryGroup.__webglMorphNormalsBuffers[influenceIndex]);\r\n\r\n            state.enableAttribute(attribute);\r\n\r\n            _gl.vertexAttribPointer(attribute, 3, _gl.FLOAT, false, 0, 0);\r\n\r\n          }\r\n\r\n          object.__webglMorphTargetInfluences[m] = influences[influenceIndex];\r\n\r\n        }\r\n        else {\r\n\r\n          /*\r\n          _gl.vertexAttribPointer( attributes[ \"morphTarget\" + m ], 3, _gl.FLOAT, false, 0, 0 );\r\n\r\n          if ( material.morphNormals ) {\r\n\r\n          \t_gl.vertexAttribPointer( attributes[ \"morphNormal\" + m ], 3, _gl.FLOAT, false, 0, 0 );\r\n\r\n          }\r\n          */\r\n\r\n          object.__webglMorphTargetInfluences[m] = 0;\r\n\r\n        }\r\n\r\n      }\r\n\r\n    }\r\n\r\n    // load updated influences uniform\r\n\r\n    if (material.program.uniforms.morphTargetInfluences !== null) {\r\n\r\n      _gl.uniform1fv(material.program.uniforms.morphTargetInfluences, object.__webglMorphTargetInfluences);\r\n\r\n    }\r\n\r\n  }\r\n\r\n  // Sorting\r\n\r\n  function painterSortStable(a, b) {\r\n\r\n    if (a.object.renderOrder !== b.object.renderOrder) {\r\n\r\n      return a.object.renderOrder - b.object.renderOrder;\r\n\r\n    }\r\n    else if (a.material.id !== b.material.id) {\r\n\r\n      return a.material.id - b.material.id;\r\n\r\n    }\r\n    else if (a.z !== b.z) {\r\n\r\n      return a.z - b.z;\r\n\r\n    }\r\n    else {\r\n\r\n      return a.id - b.id;\r\n\r\n    }\r\n\r\n  }\r\n\r\n  function reversePainterSortStable(a, b) {\r\n\r\n    if (a.object.renderOrder !== b.object.renderOrder) {\r\n\r\n      return a.object.renderOrder - b.object.renderOrder;\r\n\r\n    }\r\n    if (a.z !== b.z) {\r\n\r\n      return b.z - a.z;\r\n\r\n    }\r\n    else {\r\n\r\n      return a.id - b.id;\r\n\r\n    }\r\n\r\n  }\r\n\r\n  function numericalSort(a, b) {\r\n\r\n    return b[0] - a[0];\r\n\r\n  }\r\n\r\n  // Rendering\r\n\r\n  this.render = function(scene, camera, renderTarget, forceClear) {\r\n\r\n    if (camera instanceof THREE.Camera === false) {\r\n\r\n      THREE.error('THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.');\r\n      return;\r\n\r\n    }\r\n\r\n    var fog = scene.fog;\r\n\r\n    // reset caching for this frame\r\n\r\n    _currentGeometryProgram = '';\r\n    _currentMaterialId = -1;\r\n    _currentCamera = null;\r\n    _lightsNeedUpdate = true;\r\n\r\n    // update scene graph\r\n\r\n    if (scene.autoUpdate === true) scene.updateMatrixWorld();\r\n\r\n    // update camera matrices and frustum\r\n\r\n    if (camera.parent === undefined) camera.updateMatrixWorld();\r\n\r\n    // update Skeleton objects\r\n\r\n    scene.traverse(function(object) {\r\n\r\n      if (object instanceof THREE.SkinnedMesh) {\r\n\r\n        object.skeleton.update();\r\n\r\n      }\r\n\r\n    });\r\n\r\n    camera.matrixWorldInverse.getInverse(camera.matrixWorld);\r\n\r\n    _projScreenMatrix.multiplyMatrices(camera.projectionMatrix, camera.matrixWorldInverse);\r\n    _frustum.setFromMatrix(_projScreenMatrix);\r\n\r\n    lights.length = 0;\r\n    opaqueObjects.length = 0;\r\n    transparentObjects.length = 0;\r\n\r\n    sprites.length = 0;\r\n    lensFlares.length = 0;\r\n\r\n    projectObject(scene);\r\n\r\n    if (_this.sortObjects === true) {\r\n\r\n      opaqueObjects.sort(painterSortStable);\r\n      transparentObjects.sort(reversePainterSortStable);\r\n\r\n    }\r\n\r\n    // custom render plugins (pre pass)\r\n\r\n    shadowMapPlugin.render(scene, camera);\r\n\r\n    //\r\n\r\n    _this.info.render.calls = 0;\r\n    _this.info.render.vertices = 0;\r\n    _this.info.render.faces = 0;\r\n    _this.info.render.points = 0;\r\n\r\n    this.setRenderTarget(renderTarget);\r\n\r\n    if (this.autoClear || forceClear) {\r\n\r\n      this.clear(this.autoClearColor, this.autoClearDepth, this.autoClearStencil);\r\n\r\n    }\r\n\r\n    // set matrices for immediate objects\r\n\r\n    for (var i = 0, il = _webglObjectsImmediate.length; i < il; i++) {\r\n\r\n      var webglObject = _webglObjectsImmediate[i];\r\n      var object = webglObject.object;\r\n\r\n      if (object.visible) {\r\n\r\n        setupMatrices(object, camera);\r\n\r\n        unrollImmediateBufferMaterial(webglObject);\r\n\r\n      }\r\n\r\n    }\r\n\r\n    if (scene.overrideMaterial) {\r\n\r\n      var overrideMaterial = scene.overrideMaterial;\r\n\r\n      setMaterial(overrideMaterial);\r\n\r\n      renderObjects(opaqueObjects, camera, lights, fog, overrideMaterial);\r\n      renderObjects(transparentObjects, camera, lights, fog, overrideMaterial);\r\n      renderObjectsImmediate(_webglObjectsImmediate, '', camera, lights, fog, overrideMaterial);\r\n\r\n    }\r\n    else {\r\n\r\n      // opaque pass (front-to-back order)\r\n\r\n      state.setBlending(THREE.NoBlending);\r\n\r\n      renderObjects(opaqueObjects, camera, lights, fog, null);\r\n      renderObjectsImmediate(_webglObjectsImmediate, 'opaque', camera, lights, fog, null);\r\n\r\n      // transparent pass (back-to-front order)\r\n\r\n      renderObjects(transparentObjects, camera, lights, fog, null);\r\n      renderObjectsImmediate(_webglObjectsImmediate, 'transparent', camera, lights, fog, null);\r\n\r\n    }\r\n\r\n    // custom render plugins (post pass)\r\n\r\n    spritePlugin.render(scene, camera);\r\n    lensFlarePlugin.render(scene, camera, _currentWidth, _currentHeight);\r\n\r\n    // Generate mipmap if we're using any kind of mipmap filtering\r\n\r\n    if (renderTarget && renderTarget.generateMipmaps && renderTarget.minFilter !== THREE.NearestFilter && renderTarget.minFilter !== THREE.LinearFilter) {\r\n\r\n      updateRenderTargetMipmap(renderTarget);\r\n\r\n    }\r\n\r\n    // Ensure depth buffer writing is enabled so it can be cleared on next render\r\n\r\n    state.setDepthTest(true);\r\n    state.setDepthWrite(true);\r\n    state.setColorWrite(true);\r\n\r\n    // _gl.finish();\r\n\r\n  };\r\n\r\n  function projectObject(object) {\r\n\r\n    if (object.visible === false) return;\r\n\r\n    if (object instanceof THREE.Scene || object instanceof THREE.Group) {\r\n\r\n      // skip\r\n\r\n    }\r\n    else {\r\n\r\n      initObject(object);\r\n\r\n      if (object instanceof THREE.Light) {\r\n\r\n        lights.push(object);\r\n\r\n      }\r\n      else if (object instanceof THREE.Sprite) {\r\n\r\n        sprites.push(object);\r\n\r\n      }\r\n      else if (object instanceof THREE.LensFlare) {\r\n\r\n        lensFlares.push(object);\r\n\r\n      }\r\n      else {\r\n\r\n        var webglObjects = _webglObjects[object.id];\r\n\r\n        if (webglObjects && (object.frustumCulled === false || _frustum.intersectsObject(object) === true)) {\r\n\r\n          for (var i = 0, l = webglObjects.length; i < l; i++) {\r\n\r\n            var webglObject = webglObjects[i];\r\n\r\n            unrollBufferMaterial(webglObject);\r\n\r\n            webglObject.render = true;\r\n\r\n            if (_this.sortObjects === true) {\r\n\r\n              _vector3.setFromMatrixPosition(object.matrixWorld);\r\n              _vector3.applyProjection(_projScreenMatrix);\r\n\r\n              webglObject.z = _vector3.z;\r\n\r\n            }\r\n\r\n          }\r\n\r\n        }\r\n\r\n      }\r\n\r\n    }\r\n\r\n    for (var i = 0, l = object.children.length; i < l; i++) {\r\n\r\n      projectObject(object.children[i]);\r\n\r\n    }\r\n\r\n  }\r\n\r\n  function renderObjects(renderList, camera, lights, fog, overrideMaterial) {\r\n\r\n    var material;\r\n\r\n    for (var i = 0, l = renderList.length; i < l; i++) {\r\n\r\n      var webglObject = renderList[i];\r\n\r\n      var object = webglObject.object;\r\n      var buffer = webglObject.buffer;\r\n\r\n      setupMatrices(object, camera);\r\n\r\n      if (overrideMaterial) {\r\n\r\n        material = overrideMaterial;\r\n\r\n      }\r\n      else {\r\n\r\n        material = webglObject.material;\r\n\r\n        if (!material) continue;\r\n\r\n        setMaterial(material);\r\n\r\n      }\r\n\r\n      _this.setMaterialFaces(material);\r\n\r\n      if (buffer instanceof THREE.BufferGeometry) {\r\n\r\n        _this.renderBufferDirect(camera, lights, fog, material, buffer, object);\r\n\r\n      }\r\n      else {\r\n\r\n        _this.renderBuffer(camera, lights, fog, material, buffer, object);\r\n\r\n      }\r\n\r\n    }\r\n\r\n  }\r\n\r\n  function renderObjectsImmediate(renderList, materialType, camera, lights, fog, overrideMaterial) {\r\n\r\n    var material;\r\n\r\n    for (var i = 0, l = renderList.length; i < l; i++) {\r\n\r\n      var webglObject = renderList[i];\r\n      var object = webglObject.object;\r\n\r\n      if (object.visible) {\r\n\r\n        if (overrideMaterial) {\r\n\r\n          material = overrideMaterial;\r\n\r\n        }\r\n        else {\r\n\r\n          material = webglObject[materialType];\r\n\r\n          if (!material) continue;\r\n\r\n          setMaterial(material);\r\n\r\n        }\r\n\r\n        _this.renderImmediateObject(camera, lights, fog, material, object);\r\n\r\n      }\r\n\r\n    }\r\n\r\n  }\r\n\r\n  this.renderImmediateObject = function(camera, lights, fog, material, object) {\r\n\r\n    var program = setProgram(camera, lights, fog, material, object);\r\n\r\n    _currentGeometryProgram = '';\r\n\r\n    _this.setMaterialFaces(material);\r\n\r\n    if (object.immediateRenderCallback) {\r\n\r\n      object.immediateRenderCallback(program, _gl, _frustum);\r\n\r\n    }\r\n    else {\r\n\r\n      object.render(function(object) {\r\n        _this.renderBufferImmediate(object, program, material);\r\n      });\r\n\r\n    }\r\n\r\n  };\r\n\r\n  function unrollImmediateBufferMaterial(globject) {\r\n\r\n    var object = globject.object,\r\n      material = object.material;\r\n\r\n    if (material.transparent) {\r\n\r\n      globject.transparent = material;\r\n      globject.opaque = null;\r\n\r\n    }\r\n    else {\r\n\r\n      globject.opaque = material;\r\n      globject.transparent = null;\r\n\r\n    }\r\n\r\n  }\r\n\r\n  function unrollBufferMaterial(globject) {\r\n\r\n    var object = globject.object;\r\n    var buffer = globject.buffer;\r\n\r\n    var geometry = object.geometry;\r\n    var material = object.material;\r\n\r\n    if (material instanceof THREE.MeshFaceMaterial) {\r\n\r\n      var materialIndex = geometry instanceof THREE.BufferGeometry ? 0 : buffer.materialIndex;\r\n\r\n      material = material.materials[materialIndex];\r\n\r\n      globject.material = material;\r\n\r\n      if (material.transparent) {\r\n\r\n        transparentObjects.push(globject);\r\n\r\n      }\r\n      else {\r\n\r\n        opaqueObjects.push(globject);\r\n\r\n      }\r\n\r\n    }\r\n    else if (material) {\r\n\r\n      globject.material = material;\r\n\r\n      if (material.transparent) {\r\n\r\n        transparentObjects.push(globject);\r\n\r\n      }\r\n      else {\r\n\r\n        opaqueObjects.push(globject);\r\n\r\n      }\r\n\r\n    }\r\n\r\n  }\r\n\r\n  function initObject(object) {\r\n\r\n    if (object.__webglInit === undefined) {\r\n\r\n      object.__webglInit = true;\r\n      object._modelViewMatrix = new THREE.Matrix4();\r\n      object._normalMatrix = new THREE.Matrix3();\r\n\r\n      object.addEventListener('removed', onObjectRemoved);\r\n\r\n    }\r\n\r\n    var geometry = object.geometry;\r\n\r\n    if (geometry === undefined) {\r\n\r\n      // ImmediateRenderObject\r\n\r\n    }\r\n    else if (geometry.__webglInit === undefined) {\r\n\r\n      geometry.__webglInit = true;\r\n      geometry.addEventListener('dispose', onGeometryDispose);\r\n\r\n      if (geometry instanceof THREE.BufferGeometry) {\r\n\r\n        _this.info.memory.geometries++;\r\n\r\n      }\r\n      else if (object instanceof THREE.Mesh) {\r\n\r\n        initGeometryGroups(object, geometry);\r\n\r\n      }\r\n      else if (object instanceof THREE.Line) {\r\n\r\n        if (geometry.__webglVertexBuffer === undefined) {\r\n\r\n          createLineBuffers(geometry);\r\n          initLineBuffers(geometry, object);\r\n\r\n          geometry.verticesNeedUpdate = true;\r\n          geometry.colorsNeedUpdate = true;\r\n          geometry.lineDistancesNeedUpdate = true;\r\n\r\n        }\r\n\r\n      }\r\n      else if (object instanceof THREE.PointCloud) {\r\n\r\n        if (geometry.__webglVertexBuffer === undefined) {\r\n\r\n          createParticleBuffers(geometry);\r\n          initParticleBuffers(geometry, object);\r\n\r\n          geometry.verticesNeedUpdate = true;\r\n          geometry.colorsNeedUpdate = true;\r\n\r\n        }\r\n\r\n      }\r\n\r\n    }\r\n\r\n    if (object.__webglActive === undefined) {\r\n\r\n      object.__webglActive = true;\r\n\r\n      if (object instanceof THREE.Mesh) {\r\n\r\n        if (geometry instanceof THREE.BufferGeometry) {\r\n\r\n          addBuffer(_webglObjects, geometry, object);\r\n\r\n        }\r\n        else if (geometry instanceof THREE.Geometry) {\r\n\r\n          var geometryGroupsList = geometryGroups[geometry.id];\r\n\r\n          for (var i = 0, l = geometryGroupsList.length; i < l; i++) {\r\n\r\n            addBuffer(_webglObjects, geometryGroupsList[i], object);\r\n\r\n          }\r\n\r\n        }\r\n\r\n      }\r\n      else if (object instanceof THREE.Line || object instanceof THREE.PointCloud) {\r\n\r\n        addBuffer(_webglObjects, geometry, object);\r\n\r\n      }\r\n      else if (object instanceof THREE.ImmediateRenderObject || object.immediateRenderCallback) {\r\n\r\n        addBufferImmediate(_webglObjectsImmediate, object);\r\n\r\n      }\r\n\r\n    }\r\n\r\n  }\r\n\r\n  // Geometry splitting\r\n\r\n  var geometryGroups = {};\r\n  var geometryGroupCounter = 0;\r\n\r\n  function makeGroups(geometry, usesFaceMaterial) {\r\n\r\n    var maxVerticesInGroup = extensions.get('OES_element_index_uint') ? 4294967296 : 65535;\r\n\r\n    var groupHash, hash_map = {};\r\n\r\n    var numMorphTargets = geometry.morphTargets.length;\r\n    var numMorphNormals = geometry.morphNormals.length;\r\n\r\n    var group;\r\n    var groups = {};\r\n    var groupsList = [];\r\n\r\n    for (var f = 0, fl = geometry.faces.length; f < fl; f++) {\r\n\r\n      var face = geometry.faces[f];\r\n      var materialIndex = usesFaceMaterial ? face.materialIndex : 0;\r\n\r\n      if (!(materialIndex in hash_map)) {\r\n\r\n        hash_map[materialIndex] = {\r\n          hash: materialIndex,\r\n          counter: 0\r\n        };\r\n\r\n      }\r\n\r\n      groupHash = hash_map[materialIndex].hash + '_' + hash_map[materialIndex].counter;\r\n\r\n      if (!(groupHash in groups)) {\r\n\r\n        group = {\r\n          id: geometryGroupCounter++,\r\n          faces3: [],\r\n          materialIndex: materialIndex,\r\n          vertices: 0,\r\n          numMorphTargets: numMorphTargets,\r\n          numMorphNormals: numMorphNormals\r\n        };\r\n\r\n        groups[groupHash] = group;\r\n        groupsList.push(group);\r\n\r\n      }\r\n\r\n      if (groups[groupHash].vertices + 3 > maxVerticesInGroup) {\r\n\r\n        hash_map[materialIndex].counter += 1;\r\n        groupHash = hash_map[materialIndex].hash + '_' + hash_map[materialIndex].counter;\r\n\r\n        if (!(groupHash in groups)) {\r\n\r\n          group = {\r\n            id: geometryGroupCounter++,\r\n            faces3: [],\r\n            materialIndex: materialIndex,\r\n            vertices: 0,\r\n            numMorphTargets: numMorphTargets,\r\n            numMorphNormals: numMorphNormals\r\n          };\r\n\r\n          groups[groupHash] = group;\r\n          groupsList.push(group);\r\n\r\n        }\r\n\r\n      }\r\n\r\n      groups[groupHash].faces3.push(f);\r\n      groups[groupHash].vertices += 3;\r\n\r\n    }\r\n\r\n    return groupsList;\r\n\r\n  }\r\n\r\n  function initGeometryGroups(object, geometry) {\r\n\r\n    var material = object.material,\r\n      addBuffers = false;\r\n\r\n    if (geometryGroups[geometry.id] === undefined || geometry.groupsNeedUpdate === true) {\r\n\r\n      delete _webglObjects[object.id];\r\n\r\n      geometryGroups[geometry.id] = makeGroups(geometry, material instanceof THREE.MeshFaceMaterial);\r\n\r\n      geometry.groupsNeedUpdate = false;\r\n\r\n    }\r\n\r\n    var geometryGroupsList = geometryGroups[geometry.id];\r\n\r\n    // create separate VBOs per geometry chunk\r\n\r\n    for (var i = 0, il = geometryGroupsList.length; i < il; i++) {\r\n\r\n      var geometryGroup = geometryGroupsList[i];\r\n\r\n      // initialise VBO on the first access\r\n\r\n      if (geometryGroup.__webglVertexBuffer === undefined) {\r\n\r\n        createMeshBuffers(geometryGroup);\r\n        initMeshBuffers(geometryGroup, object);\r\n\r\n        geometry.verticesNeedUpdate = true;\r\n        geometry.morphTargetsNeedUpdate = true;\r\n        geometry.elementsNeedUpdate = true;\r\n        geometry.uvsNeedUpdate = true;\r\n        geometry.normalsNeedUpdate = true;\r\n        geometry.tangentsNeedUpdate = true;\r\n        geometry.colorsNeedUpdate = true;\r\n\r\n        addBuffers = true;\r\n\r\n      }\r\n      else {\r\n\r\n        addBuffers = false;\r\n\r\n      }\r\n\r\n      if (addBuffers || object.__webglActive === undefined) {\r\n\r\n        addBuffer(_webglObjects, geometryGroup, object);\r\n\r\n      }\r\n\r\n    }\r\n\r\n    object.__webglActive = true;\r\n\r\n  }\r\n\r\n  function addBuffer(objlist, buffer, object) {\r\n\r\n    var id = object.id;\r\n    objlist[id] = objlist[id] || [];\r\n    objlist[id].push({\r\n      id: id,\r\n      buffer: buffer,\r\n      object: object,\r\n      material: null,\r\n      z: 0\r\n    });\r\n\r\n  };\r\n\r\n  function addBufferImmediate(objlist, object) {\r\n\r\n    objlist.push({\r\n      id: null,\r\n      object: object,\r\n      opaque: null,\r\n      transparent: null,\r\n      z: 0\r\n    });\r\n\r\n  };\r\n\r\n  // Objects updates\r\n\r\n  function updateObject(object) {\r\n\r\n    var geometry = object.geometry;\r\n\r\n    if (geometry instanceof THREE.BufferGeometry) {\r\n\r\n      var attributes = geometry.attributes;\r\n      var attributesKeys = geometry.attributesKeys;\r\n\r\n      for (var i = 0, l = attributesKeys.length; i < l; i++) {\r\n\r\n        var key = attributesKeys[i];\r\n        var attribute = attributes[key];\r\n        var bufferType = (key === 'index') ? _gl.ELEMENT_ARRAY_BUFFER : _gl.ARRAY_BUFFER;\r\n\r\n        if (attribute.buffer === undefined) {\r\n\r\n          attribute.buffer = _gl.createBuffer();\r\n          _gl.bindBuffer(bufferType, attribute.buffer);\r\n          _gl.bufferData(bufferType, attribute.array, (attribute instanceof THREE.DynamicBufferAttribute) ? _gl.DYNAMIC_DRAW : _gl.STATIC_DRAW);\r\n\r\n          attribute.needsUpdate = false;\r\n\r\n        }\r\n        else if (attribute.needsUpdate === true) {\r\n\r\n          _gl.bindBuffer(bufferType, attribute.buffer);\r\n\r\n          if (attribute.updateRange === undefined || attribute.updateRange.count === -1) { // Not using update ranges\r\n\r\n            _gl.bufferSubData(bufferType, 0, attribute.array);\r\n\r\n          }\r\n          else if (attribute.updateRange.count === 0) {\r\n\r\n            console.error('THREE.WebGLRenderer.updateObject: using updateRange for THREE.DynamicBufferAttribute and marked as needsUpdate but count is 0, ensure you are using set methods or updating manually.');\r\n\r\n          }\r\n          else {\r\n\r\n            _gl.bufferSubData(bufferType, attribute.updateRange.offset * attribute.array.BYTES_PER_ELEMENT,\r\n              attribute.array.subarray(attribute.updateRange.offset, attribute.updateRange.offset + attribute.updateRange.count));\r\n\r\n            attribute.updateRange.count = 0; // reset range\r\n\r\n          }\r\n\r\n          attribute.needsUpdate = false;\r\n\r\n        }\r\n\r\n      }\r\n\r\n    }\r\n    else if (object instanceof THREE.Mesh) {\r\n\r\n      // check all geometry groups\r\n\r\n      if (geometry.groupsNeedUpdate === true) {\r\n\r\n        initGeometryGroups(object, geometry);\r\n\r\n      }\r\n\r\n      var geometryGroupsList = geometryGroups[geometry.id];\r\n\r\n      for (var i = 0, il = geometryGroupsList.length; i < il; i++) {\r\n\r\n        var geometryGroup = geometryGroupsList[i];\r\n        var material = getBufferMaterial(object, geometryGroup);\r\n\r\n        var customAttributesDirty = material.attributes && areCustomAttributesDirty(material);\r\n\r\n        if (geometry.verticesNeedUpdate || geometry.morphTargetsNeedUpdate || geometry.elementsNeedUpdate ||\r\n          geometry.uvsNeedUpdate || geometry.normalsNeedUpdate ||\r\n          geometry.colorsNeedUpdate || geometry.tangentsNeedUpdate || customAttributesDirty) {\r\n\r\n          setMeshBuffers(geometryGroup, object, _gl.DYNAMIC_DRAW, !geometry.dynamic, material);\r\n\r\n        }\r\n\r\n      }\r\n\r\n      geometry.verticesNeedUpdate = false;\r\n      geometry.morphTargetsNeedUpdate = false;\r\n      geometry.elementsNeedUpdate = false;\r\n      geometry.uvsNeedUpdate = false;\r\n      geometry.normalsNeedUpdate = false;\r\n      geometry.colorsNeedUpdate = false;\r\n      geometry.tangentsNeedUpdate = false;\r\n\r\n      material.attributes && clearCustomAttributes(material);\r\n\r\n    }\r\n    else if (object instanceof THREE.Line) {\r\n\r\n      var material = getBufferMaterial(object, geometry);\r\n      var customAttributesDirty = material.attributes && areCustomAttributesDirty(material);\r\n\r\n      if (geometry.verticesNeedUpdate || geometry.colorsNeedUpdate || geometry.lineDistancesNeedUpdate || customAttributesDirty) {\r\n\r\n        setLineBuffers(geometry, _gl.DYNAMIC_DRAW);\r\n\r\n      }\r\n\r\n      geometry.verticesNeedUpdate = false;\r\n      geometry.colorsNeedUpdate = false;\r\n      geometry.lineDistancesNeedUpdate = false;\r\n\r\n      material.attributes && clearCustomAttributes(material);\r\n\r\n    }\r\n    else if (object instanceof THREE.PointCloud) {\r\n\r\n      var material = getBufferMaterial(object, geometry);\r\n      var customAttributesDirty = material.attributes && areCustomAttributesDirty(material);\r\n\r\n      if (geometry.verticesNeedUpdate || geometry.colorsNeedUpdate || customAttributesDirty) {\r\n\r\n        setParticleBuffers(geometry, _gl.DYNAMIC_DRAW, object);\r\n\r\n      }\r\n\r\n      geometry.verticesNeedUpdate = false;\r\n      geometry.colorsNeedUpdate = false;\r\n\r\n      material.attributes && clearCustomAttributes(material);\r\n\r\n    }\r\n\r\n  }\r\n\r\n  // Objects updates - custom attributes check\r\n\r\n  function areCustomAttributesDirty(material) {\r\n\r\n    for (var name in material.attributes) {\r\n\r\n      if (material.attributes[name].needsUpdate) return true;\r\n\r\n    }\r\n\r\n    return false;\r\n\r\n  }\r\n\r\n  function clearCustomAttributes(material) {\r\n\r\n    for (var name in material.attributes) {\r\n\r\n      material.attributes[name].needsUpdate = false;\r\n\r\n    }\r\n\r\n  }\r\n\r\n  // Objects removal\r\n\r\n  function removeObject(object) {\r\n\r\n    if (object instanceof THREE.Mesh ||\r\n      object instanceof THREE.PointCloud ||\r\n      object instanceof THREE.Line) {\r\n\r\n      delete _webglObjects[object.id];\r\n\r\n    }\r\n    else if (object instanceof THREE.ImmediateRenderObject || object.immediateRenderCallback) {\r\n\r\n      removeInstances(_webglObjectsImmediate, object);\r\n\r\n    }\r\n\r\n    delete object.__webglInit;\r\n    delete object._modelViewMatrix;\r\n    delete object._normalMatrix;\r\n\r\n    delete object.__webglActive;\r\n\r\n  }\r\n\r\n  function removeInstances(objlist, object) {\r\n\r\n    for (var o = objlist.length - 1; o >= 0; o--) {\r\n\r\n      if (objlist[o].object === object) {\r\n\r\n        objlist.splice(o, 1);\r\n\r\n      }\r\n\r\n    }\r\n\r\n  }\r\n\r\n  // Materials\r\n\r\n  var shaderIDs = {\r\n    MeshDepthMaterial: 'depth',\r\n    MeshNormalMaterial: 'normal',\r\n    MeshBasicMaterial: 'basic',\r\n    MeshLambertMaterial: 'lambert',\r\n    MeshPhongMaterial: 'phong',\r\n    LineBasicMaterial: 'basic',\r\n    LineDashedMaterial: 'dashed',\r\n    PointCloudMaterial: 'particle_basic'\r\n  };\r\n\r\n  function initMaterial(material, lights, fog, object) {\r\n\r\n    material.addEventListener('dispose', onMaterialDispose);\r\n\r\n    var shaderID = shaderIDs[material.type];\r\n\r\n    if (shaderID) {\r\n\r\n      var shader = THREE.ShaderLib[shaderID];\r\n\r\n      material.__webglShader = {\r\n        uniforms: THREE.UniformsUtils.clone(shader.uniforms),\r\n        vertexShader: shader.vertexShader,\r\n        fragmentShader: shader.fragmentShader\r\n      }\r\n\r\n    }\r\n    else {\r\n\r\n      material.__webglShader = {\r\n        uniforms: material.uniforms,\r\n        vertexShader: material.vertexShader,\r\n        fragmentShader: material.fragmentShader\r\n      }\r\n\r\n    }\r\n\r\n    // heuristics to create shader parameters according to lights in the scene\r\n    // (not to blow over maxLights budget)\r\n\r\n    var maxLightCount = allocateLights(lights);\r\n    var maxShadows = allocateShadows(lights);\r\n    var maxBones = allocateBones(object);\r\n\r\n    var parameters = {\r\n\r\n      precision: _precision,\r\n      supportsVertexTextures: _supportsVertexTextures,\r\n\r\n      map: !!material.map,\r\n      envMap: !!material.envMap,\r\n      envMapMode: material.envMap && material.envMap.mapping,\r\n      lightMap: !!material.lightMap,\r\n      bumpMap: !!material.bumpMap,\r\n      normalMap: !!material.normalMap,\r\n      specularMap: !!material.specularMap,\r\n      alphaMap: !!material.alphaMap,\r\n\r\n      combine: material.combine,\r\n\r\n      vertexColors: material.vertexColors,\r\n\r\n      fog: fog,\r\n      useFog: material.fog,\r\n      fogExp: fog instanceof THREE.FogExp2,\r\n\r\n      flatShading: material.shading === THREE.FlatShading,\r\n\r\n      sizeAttenuation: material.sizeAttenuation,\r\n      logarithmicDepthBuffer: _logarithmicDepthBuffer,\r\n\r\n      skinning: material.skinning,\r\n      maxBones: maxBones,\r\n      useVertexTexture: _supportsBoneTextures && object && object.skeleton && object.skeleton.useVertexTexture,\r\n\r\n      morphTargets: material.morphTargets,\r\n      morphNormals: material.morphNormals,\r\n      maxMorphTargets: _this.maxMorphTargets,\r\n      maxMorphNormals: _this.maxMorphNormals,\r\n\r\n      maxDirLights: maxLightCount.directional,\r\n      maxPointLights: maxLightCount.point,\r\n      maxSpotLights: maxLightCount.spot,\r\n      maxHemiLights: maxLightCount.hemi,\r\n\r\n      maxShadows: maxShadows,\r\n      shadowMapEnabled: _this.shadowMapEnabled && object.receiveShadow && maxShadows > 0,\r\n      shadowMapType: _this.shadowMapType,\r\n      shadowMapDebug: _this.shadowMapDebug,\r\n      shadowMapCascade: _this.shadowMapCascade,\r\n\r\n      alphaTest: material.alphaTest,\r\n      metal: material.metal,\r\n      wrapAround: material.wrapAround,\r\n      doubleSided: material.side === THREE.DoubleSide,\r\n      flipSided: material.side === THREE.BackSide\r\n\r\n    };\r\n\r\n    // Generate code\r\n\r\n    var chunks = [];\r\n\r\n    if (shaderID) {\r\n\r\n      chunks.push(shaderID);\r\n\r\n    }\r\n    else {\r\n\r\n      chunks.push(material.fragmentShader);\r\n      chunks.push(material.vertexShader);\r\n\r\n    }\r\n\r\n    if (material.defines !== undefined) {\r\n\r\n      for (var name in material.defines) {\r\n\r\n        chunks.push(name);\r\n        chunks.push(material.defines[name]);\r\n\r\n      }\r\n\r\n    }\r\n\r\n    for (var name in parameters) {\r\n\r\n      chunks.push(name);\r\n      chunks.push(parameters[name]);\r\n\r\n    }\r\n\r\n    var code = chunks.join();\r\n\r\n    var program;\r\n\r\n    // Check if code has been already compiled\r\n\r\n    for (var p = 0, pl = _programs.length; p < pl; p++) {\r\n\r\n      var programInfo = _programs[p];\r\n\r\n      if (programInfo.code === code) {\r\n\r\n        program = programInfo;\r\n        program.usedTimes++;\r\n\r\n        break;\r\n\r\n      }\r\n\r\n    }\r\n\r\n    if (program === undefined) {\r\n\r\n      program = new THREE.WebGLProgram(_this, code, material, parameters);\r\n      _programs.push(program);\r\n\r\n      _this.info.memory.programs = _programs.length;\r\n\r\n    }\r\n\r\n    material.program = program;\r\n\r\n    var attributes = program.attributes;\r\n\r\n    if (material.morphTargets) {\r\n\r\n      material.numSupportedMorphTargets = 0;\r\n\r\n      var id, base = 'morphTarget';\r\n\r\n      for (var i = 0; i < _this.maxMorphTargets; i++) {\r\n\r\n        id = base + i;\r\n\r\n        if (attributes[id] >= 0) {\r\n\r\n          material.numSupportedMorphTargets++;\r\n\r\n        }\r\n\r\n      }\r\n\r\n    }\r\n\r\n    if (material.morphNormals) {\r\n\r\n      material.numSupportedMorphNormals = 0;\r\n\r\n      var id, base = 'morphNormal';\r\n\r\n      for (i = 0; i < _this.maxMorphNormals; i++) {\r\n\r\n        id = base + i;\r\n\r\n        if (attributes[id] >= 0) {\r\n\r\n          material.numSupportedMorphNormals++;\r\n\r\n        }\r\n\r\n      }\r\n\r\n    }\r\n\r\n    material.uniformsList = [];\r\n\r\n    for (var u in material.__webglShader.uniforms) {\r\n\r\n      var location = material.program.uniforms[u];\r\n\r\n      if (location) {\r\n        material.uniformsList.push([material.__webglShader.uniforms[u], location]);\r\n      }\r\n\r\n    }\r\n\r\n  }\r\n\r\n  function setMaterial(material) {\r\n\r\n    if (material.transparent === true) {\r\n\r\n      state.setBlending(material.blending, material.blendEquation, material.blendSrc, material.blendDst, material.blendEquationAlpha, material.blendSrcAlpha, material.blendDstAlpha);\r\n\r\n    }\r\n    else {\r\n\r\n      state.setBlending(THREE.NoBlending);\r\n\r\n    }\r\n\r\n    state.setDepthTest(material.depthTest);\r\n    state.setDepthWrite(material.depthWrite);\r\n    state.setColorWrite(material.colorWrite);\r\n    state.setPolygonOffset(material.polygonOffset, material.polygonOffsetFactor, material.polygonOffsetUnits);\r\n\r\n  }\r\n\r\n  function setProgram(camera, lights, fog, material, object) {\r\n\r\n    _usedTextureUnits = 0;\r\n\r\n    if (material.needsUpdate) {\r\n\r\n      if (material.program) deallocateMaterial(material);\r\n\r\n      initMaterial(material, lights, fog, object);\r\n      material.needsUpdate = false;\r\n\r\n    }\r\n\r\n    if (material.morphTargets) {\r\n\r\n      if (!object.__webglMorphTargetInfluences) {\r\n\r\n        object.__webglMorphTargetInfluences = new Float32Array(_this.maxMorphTargets);\r\n\r\n      }\r\n\r\n    }\r\n\r\n    var refreshProgram = false;\r\n    var refreshMaterial = false;\r\n    var refreshLights = false;\r\n\r\n    var program = material.program,\r\n      p_uniforms = program.uniforms,\r\n      m_uniforms = material.__webglShader.uniforms;\r\n\r\n    if (program.id !== _currentProgram) {\r\n\r\n      _gl.useProgram(program.program);\r\n      _currentProgram = program.id;\r\n\r\n      refreshProgram = true;\r\n      refreshMaterial = true;\r\n      refreshLights = true;\r\n\r\n    }\r\n\r\n    if (material.id !== _currentMaterialId) {\r\n\r\n      if (_currentMaterialId === -1) refreshLights = true;\r\n      _currentMaterialId = material.id;\r\n\r\n      refreshMaterial = true;\r\n\r\n    }\r\n\r\n    if (refreshProgram || camera !== _currentCamera) {\r\n\r\n      _gl.uniformMatrix4fv(p_uniforms.projectionMatrix, false, camera.projectionMatrix.elements);\r\n\r\n      if (_logarithmicDepthBuffer) {\r\n\r\n        _gl.uniform1f(p_uniforms.logDepthBufFC, 2.0 / (Math.log(camera.far + 1.0) / Math.LN2));\r\n\r\n      }\r\n\r\n\r\n      if (camera !== _currentCamera) _currentCamera = camera;\r\n\r\n      // load material specific uniforms\r\n      // (shader material also gets them for the sake of genericity)\r\n\r\n      if (material instanceof THREE.ShaderMaterial ||\r\n        material instanceof THREE.MeshPhongMaterial ||\r\n        material.envMap) {\r\n\r\n        if (p_uniforms.cameraPosition !== null) {\r\n\r\n          _vector3.setFromMatrixPosition(camera.matrixWorld);\r\n          _gl.uniform3f(p_uniforms.cameraPosition, _vector3.x, _vector3.y, _vector3.z);\r\n\r\n        }\r\n\r\n      }\r\n\r\n      if (material instanceof THREE.MeshPhongMaterial ||\r\n        material instanceof THREE.MeshLambertMaterial ||\r\n        material instanceof THREE.MeshBasicMaterial ||\r\n        material instanceof THREE.ShaderMaterial ||\r\n        material.skinning) {\r\n\r\n        if (p_uniforms.viewMatrix !== null) {\r\n\r\n          _gl.uniformMatrix4fv(p_uniforms.viewMatrix, false, camera.matrixWorldInverse.elements);\r\n\r\n        }\r\n\r\n      }\r\n\r\n    }\r\n\r\n    // skinning uniforms must be set even if material didn't change\r\n    // auto-setting of texture unit for bone texture must go before other textures\r\n    // not sure why, but otherwise weird things happen\r\n\r\n    if (material.skinning) {\r\n\r\n      if (object.bindMatrix && p_uniforms.bindMatrix !== null) {\r\n\r\n        _gl.uniformMatrix4fv(p_uniforms.bindMatrix, false, object.bindMatrix.elements);\r\n\r\n      }\r\n\r\n      if (object.bindMatrixInverse && p_uniforms.bindMatrixInverse !== null) {\r\n\r\n        _gl.uniformMatrix4fv(p_uniforms.bindMatrixInverse, false, object.bindMatrixInverse.elements);\r\n\r\n      }\r\n\r\n      if (_supportsBoneTextures && object.skeleton && object.skeleton.useVertexTexture) {\r\n\r\n        if (p_uniforms.boneTexture !== null) {\r\n\r\n          var textureUnit = getTextureUnit();\r\n\r\n          _gl.uniform1i(p_uniforms.boneTexture, textureUnit);\r\n          _this.setTexture(object.skeleton.boneTexture, textureUnit);\r\n\r\n        }\r\n\r\n        if (p_uniforms.boneTextureWidth !== null) {\r\n\r\n          _gl.uniform1i(p_uniforms.boneTextureWidth, object.skeleton.boneTextureWidth);\r\n\r\n        }\r\n\r\n        if (p_uniforms.boneTextureHeight !== null) {\r\n\r\n          _gl.uniform1i(p_uniforms.boneTextureHeight, object.skeleton.boneTextureHeight);\r\n\r\n        }\r\n\r\n      }\r\n      else if (object.skeleton && object.skeleton.boneMatrices) {\r\n\r\n        if (p_uniforms.boneGlobalMatrices !== null) {\r\n\r\n          _gl.uniformMatrix4fv(p_uniforms.boneGlobalMatrices, false, object.skeleton.boneMatrices);\r\n\r\n        }\r\n\r\n      }\r\n\r\n    }\r\n\r\n    if (refreshMaterial) {\r\n\r\n      // refresh uniforms common to several materials\r\n\r\n      if (fog && material.fog) {\r\n\r\n        refreshUniformsFog(m_uniforms, fog);\r\n\r\n      }\r\n\r\n      if (material instanceof THREE.MeshPhongMaterial ||\r\n        material instanceof THREE.MeshLambertMaterial ||\r\n        material.lights) {\r\n\r\n        if (_lightsNeedUpdate) {\r\n\r\n          refreshLights = true;\r\n          setupLights(lights);\r\n          _lightsNeedUpdate = false;\r\n        }\r\n\r\n        if (refreshLights) {\r\n          refreshUniformsLights(m_uniforms, _lights);\r\n          markUniformsLightsNeedsUpdate(m_uniforms, true);\r\n        }\r\n        else {\r\n          markUniformsLightsNeedsUpdate(m_uniforms, false);\r\n        }\r\n\r\n      }\r\n\r\n      if (material instanceof THREE.MeshBasicMaterial ||\r\n        material instanceof THREE.MeshLambertMaterial ||\r\n        material instanceof THREE.MeshPhongMaterial) {\r\n\r\n        refreshUniformsCommon(m_uniforms, material);\r\n\r\n      }\r\n\r\n      // refresh single material specific uniforms\r\n\r\n      if (material instanceof THREE.LineBasicMaterial) {\r\n\r\n        refreshUniformsLine(m_uniforms, material);\r\n\r\n      }\r\n      else if (material instanceof THREE.LineDashedMaterial) {\r\n\r\n        refreshUniformsLine(m_uniforms, material);\r\n        refreshUniformsDash(m_uniforms, material);\r\n\r\n      }\r\n      else if (material instanceof THREE.PointCloudMaterial) {\r\n\r\n        refreshUniformsParticle(m_uniforms, material);\r\n\r\n      }\r\n      else if (material instanceof THREE.MeshPhongMaterial) {\r\n\r\n        refreshUniformsPhong(m_uniforms, material);\r\n\r\n      }\r\n      else if (material instanceof THREE.MeshLambertMaterial) {\r\n\r\n        refreshUniformsLambert(m_uniforms, material);\r\n\r\n      }\r\n      else if (material instanceof THREE.MeshDepthMaterial) {\r\n\r\n        m_uniforms.mNear.value = camera.near;\r\n        m_uniforms.mFar.value = camera.far;\r\n        m_uniforms.opacity.value = material.opacity;\r\n\r\n      }\r\n      else if (material instanceof THREE.MeshNormalMaterial) {\r\n\r\n        m_uniforms.opacity.value = material.opacity;\r\n\r\n      }\r\n\r\n      if (object.receiveShadow && !material._shadowPass) {\r\n\r\n        refreshUniformsShadow(m_uniforms, lights);\r\n\r\n      }\r\n\r\n      // load common uniforms\r\n\r\n      loadUniformsGeneric(material.uniformsList);\r\n\r\n    }\r\n\r\n    loadUniformsMatrices(p_uniforms, object);\r\n\r\n    if (p_uniforms.modelMatrix !== null) {\r\n\r\n      _gl.uniformMatrix4fv(p_uniforms.modelMatrix, false, object.matrixWorld.elements);\r\n\r\n    }\r\n\r\n    return program;\r\n\r\n  }\r\n\r\n  // Uniforms (refresh uniforms objects)\r\n\r\n  function refreshUniformsCommon(uniforms, material) {\r\n\r\n    uniforms.opacity.value = material.opacity;\r\n\r\n    uniforms.diffuse.value = material.color;\r\n\r\n    uniforms.map.value = material.map;\r\n    uniforms.lightMap.value = material.lightMap;\r\n    uniforms.specularMap.value = material.specularMap;\r\n    uniforms.alphaMap.value = material.alphaMap;\r\n\r\n    if (material.bumpMap) {\r\n\r\n      uniforms.bumpMap.value = material.bumpMap;\r\n      uniforms.bumpScale.value = material.bumpScale;\r\n\r\n    }\r\n\r\n    if (material.normalMap) {\r\n\r\n      uniforms.normalMap.value = material.normalMap;\r\n      uniforms.normalScale.value.copy(material.normalScale);\r\n\r\n    }\r\n\r\n    // uv repeat and offset setting priorities\r\n    //  1. color map\r\n    //  2. specular map\r\n    //  3. normal map\r\n    //  4. bump map\r\n    //  5. alpha map\r\n\r\n    var uvScaleMap;\r\n\r\n    if (material.map) {\r\n\r\n      uvScaleMap = material.map;\r\n\r\n    }\r\n    else if (material.specularMap) {\r\n\r\n      uvScaleMap = material.specularMap;\r\n\r\n    }\r\n    else if (material.normalMap) {\r\n\r\n      uvScaleMap = material.normalMap;\r\n\r\n    }\r\n    else if (material.bumpMap) {\r\n\r\n      uvScaleMap = material.bumpMap;\r\n\r\n    }\r\n    else if (material.alphaMap) {\r\n\r\n      uvScaleMap = material.alphaMap;\r\n\r\n    }\r\n\r\n    if (uvScaleMap !== undefined) {\r\n\r\n      var offset = uvScaleMap.offset;\r\n      var repeat = uvScaleMap.repeat;\r\n\r\n      uniforms.offsetRepeat.value.set(offset.x, offset.y, repeat.x, repeat.y);\r\n\r\n    }\r\n\r\n    uniforms.envMap.value = material.envMap;\r\n    uniforms.flipEnvMap.value = (material.envMap instanceof THREE.WebGLRenderTargetCube) ? 1 : -1;\r\n\r\n    uniforms.reflectivity.value = material.reflectivity;\r\n    uniforms.refractionRatio.value = material.refractionRatio;\r\n\r\n  }\r\n\r\n  function refreshUniformsLine(uniforms, material) {\r\n\r\n    uniforms.diffuse.value = material.color;\r\n    uniforms.opacity.value = material.opacity;\r\n\r\n  }\r\n\r\n  function refreshUniformsDash(uniforms, material) {\r\n\r\n    uniforms.dashSize.value = material.dashSize;\r\n    uniforms.totalSize.value = material.dashSize + material.gapSize;\r\n    uniforms.scale.value = material.scale;\r\n\r\n  }\r\n\r\n  function refreshUniformsParticle(uniforms, material) {\r\n\r\n    uniforms.psColor.value = material.color;\r\n    uniforms.opacity.value = material.opacity;\r\n    uniforms.size.value = material.size;\r\n    uniforms.scale.value = _canvas.height / 2.0; // TODO: Cache this.\r\n\r\n    uniforms.map.value = material.map;\r\n\r\n    if (material.map !== null) {\r\n\r\n      var offset = material.map.offset;\r\n      var repeat = material.map.repeat;\r\n\r\n      uniforms.offsetRepeat.value.set(offset.x, offset.y, repeat.x, repeat.y);\r\n\r\n    }\r\n\r\n  }\r\n\r\n  function refreshUniformsFog(uniforms, fog) {\r\n\r\n    uniforms.fogColor.value = fog.color;\r\n\r\n    if (fog instanceof THREE.Fog) {\r\n\r\n      uniforms.fogNear.value = fog.near;\r\n      uniforms.fogFar.value = fog.far;\r\n\r\n    }\r\n    else if (fog instanceof THREE.FogExp2) {\r\n\r\n      uniforms.fogDensity.value = fog.density;\r\n\r\n    }\r\n\r\n  }\r\n\r\n  function refreshUniformsPhong(uniforms, material) {\r\n\r\n    uniforms.shininess.value = material.shininess;\r\n\r\n    uniforms.emissive.value = material.emissive;\r\n    uniforms.specular.value = material.specular;\r\n\r\n    if (material.wrapAround) {\r\n\r\n      uniforms.wrapRGB.value.copy(material.wrapRGB);\r\n\r\n    }\r\n\r\n  }\r\n\r\n  function refreshUniformsLambert(uniforms, material) {\r\n\r\n    uniforms.emissive.value = material.emissive;\r\n\r\n    if (material.wrapAround) {\r\n\r\n      uniforms.wrapRGB.value.copy(material.wrapRGB);\r\n\r\n    }\r\n\r\n  }\r\n\r\n  function refreshUniformsLights(uniforms, lights) {\r\n\r\n    uniforms.ambientLightColor.value = lights.ambient;\r\n\r\n    uniforms.directionalLightColor.value = lights.directional.colors;\r\n    uniforms.directionalLightDirection.value = lights.directional.positions;\r\n\r\n    uniforms.pointLightColor.value = lights.point.colors;\r\n    uniforms.pointLightPosition.value = lights.point.positions;\r\n    uniforms.pointLightDistance.value = lights.point.distances;\r\n    uniforms.pointLightDecay.value = lights.point.decays;\r\n\r\n    uniforms.spotLightColor.value = lights.spot.colors;\r\n    uniforms.spotLightPosition.value = lights.spot.positions;\r\n    uniforms.spotLightDistance.value = lights.spot.distances;\r\n    uniforms.spotLightDirection.value = lights.spot.directions;\r\n    uniforms.spotLightAngleCos.value = lights.spot.anglesCos;\r\n    uniforms.spotLightExponent.value = lights.spot.exponents;\r\n    uniforms.spotLightDecay.value = lights.spot.decays;\r\n\r\n    uniforms.hemisphereLightSkyColor.value = lights.hemi.skyColors;\r\n    uniforms.hemisphereLightGroundColor.value = lights.hemi.groundColors;\r\n    uniforms.hemisphereLightDirection.value = lights.hemi.positions;\r\n\r\n  }\r\n\r\n  // If uniforms are marked as clean, they don't need to be loaded to the GPU.\r\n\r\n  function markUniformsLightsNeedsUpdate(uniforms, value) {\r\n\r\n    uniforms.ambientLightColor.needsUpdate = value;\r\n\r\n    uniforms.directionalLightColor.needsUpdate = value;\r\n    uniforms.directionalLightDirection.needsUpdate = value;\r\n\r\n    uniforms.pointLightColor.needsUpdate = value;\r\n    uniforms.pointLightPosition.needsUpdate = value;\r\n    uniforms.pointLightDistance.needsUpdate = value;\r\n    uniforms.pointLightDecay.needsUpdate = value;\r\n\r\n    uniforms.spotLightColor.needsUpdate = value;\r\n    uniforms.spotLightPosition.needsUpdate = value;\r\n    uniforms.spotLightDistance.needsUpdate = value;\r\n    uniforms.spotLightDirection.needsUpdate = value;\r\n    uniforms.spotLightAngleCos.needsUpdate = value;\r\n    uniforms.spotLightExponent.needsUpdate = value;\r\n    uniforms.spotLightDecay.needsUpdate = value;\r\n\r\n    uniforms.hemisphereLightSkyColor.needsUpdate = value;\r\n    uniforms.hemisphereLightGroundColor.needsUpdate = value;\r\n    uniforms.hemisphereLightDirection.needsUpdate = value;\r\n\r\n  }\r\n\r\n  function refreshUniformsShadow(uniforms, lights) {\r\n\r\n    if (uniforms.shadowMatrix) {\r\n\r\n      var j = 0;\r\n\r\n      for (var i = 0, il = lights.length; i < il; i++) {\r\n\r\n        var light = lights[i];\r\n\r\n        if (!light.castShadow) continue;\r\n\r\n        if (light instanceof THREE.SpotLight || (light instanceof THREE.DirectionalLight && !light.shadowCascade)) {\r\n\r\n          uniforms.shadowMap.value[j] = light.shadowMap;\r\n          uniforms.shadowMapSize.value[j] = light.shadowMapSize;\r\n\r\n          uniforms.shadowMatrix.value[j] = light.shadowMatrix;\r\n\r\n          uniforms.shadowDarkness.value[j] = light.shadowDarkness;\r\n          uniforms.shadowBias.value[j] = light.shadowBias;\r\n\r\n          j++;\r\n\r\n        }\r\n\r\n      }\r\n\r\n    }\r\n\r\n  }\r\n\r\n  // Uniforms (load to GPU)\r\n\r\n  function loadUniformsMatrices(uniforms, object) {\r\n\r\n    _gl.uniformMatrix4fv(uniforms.modelViewMatrix, false, object._modelViewMatrix.elements);\r\n\r\n    if (uniforms.normalMatrix) {\r\n\r\n      _gl.uniformMatrix3fv(uniforms.normalMatrix, false, object._normalMatrix.elements);\r\n\r\n    }\r\n\r\n  }\r\n\r\n  function getTextureUnit() {\r\n\r\n    var textureUnit = _usedTextureUnits;\r\n\r\n    if (textureUnit >= _maxTextures) {\r\n\r\n      THREE.warn('WebGLRenderer: trying to use ' + textureUnit + ' texture units while this GPU supports only ' + _maxTextures);\r\n\r\n    }\r\n\r\n    _usedTextureUnits += 1;\r\n\r\n    return textureUnit;\r\n\r\n  }\r\n\r\n  function loadUniformsGeneric(uniforms) {\r\n\r\n    var texture, textureUnit, offset;\r\n\r\n    for (var j = 0, jl = uniforms.length; j < jl; j++) {\r\n\r\n      var uniform = uniforms[j][0];\r\n\r\n      // needsUpdate property is not added to all uniforms.\r\n      if (uniform.needsUpdate === false) continue;\r\n\r\n      var type = uniform.type;\r\n      var value = uniform.value;\r\n      var location = uniforms[j][1];\r\n\r\n      switch (type) {\r\n\r\n        case '1i':\r\n          _gl.uniform1i(location, value);\r\n          break;\r\n\r\n        case '1f':\r\n          _gl.uniform1f(location, value);\r\n          break;\r\n\r\n        case '2f':\r\n          _gl.uniform2f(location, value[0], value[1]);\r\n          break;\r\n\r\n        case '3f':\r\n          _gl.uniform3f(location, value[0], value[1], value[2]);\r\n          break;\r\n\r\n        case '4f':\r\n          _gl.uniform4f(location, value[0], value[1], value[2], value[3]);\r\n          break;\r\n\r\n        case '1iv':\r\n          _gl.uniform1iv(location, value);\r\n          break;\r\n\r\n        case '3iv':\r\n          _gl.uniform3iv(location, value);\r\n          break;\r\n\r\n        case '1fv':\r\n          _gl.uniform1fv(location, value);\r\n          break;\r\n\r\n        case '2fv':\r\n          _gl.uniform2fv(location, value);\r\n          break;\r\n\r\n        case '3fv':\r\n          _gl.uniform3fv(location, value);\r\n          break;\r\n\r\n        case '4fv':\r\n          _gl.uniform4fv(location, value);\r\n          break;\r\n\r\n        case 'Matrix3fv':\r\n          _gl.uniformMatrix3fv(location, false, value);\r\n          break;\r\n\r\n        case 'Matrix4fv':\r\n          _gl.uniformMatrix4fv(location, false, value);\r\n          break;\r\n\r\n          //\r\n\r\n        case 'i':\r\n\r\n          // single integer\r\n          _gl.uniform1i(location, value);\r\n\r\n          break;\r\n\r\n        case 'f':\r\n\r\n          // single float\r\n          _gl.uniform1f(location, value);\r\n\r\n          break;\r\n\r\n        case 'v2':\r\n\r\n          // single THREE.Vector2\r\n          _gl.uniform2f(location, value.x, value.y);\r\n\r\n          break;\r\n\r\n        case 'v3':\r\n\r\n          // single THREE.Vector3\r\n          _gl.uniform3f(location, value.x, value.y, value.z);\r\n\r\n          break;\r\n\r\n        case 'v4':\r\n\r\n          // single THREE.Vector4\r\n          _gl.uniform4f(location, value.x, value.y, value.z, value.w);\r\n\r\n          break;\r\n\r\n        case 'c':\r\n\r\n          // single THREE.Color\r\n          _gl.uniform3f(location, value.r, value.g, value.b);\r\n\r\n          break;\r\n\r\n        case 'iv1':\r\n\r\n          // flat array of integers (JS or typed array)\r\n          _gl.uniform1iv(location, value);\r\n\r\n          break;\r\n\r\n        case 'iv':\r\n\r\n          // flat array of integers with 3 x N size (JS or typed array)\r\n          _gl.uniform3iv(location, value);\r\n\r\n          break;\r\n\r\n        case 'fv1':\r\n\r\n          // flat array of floats (JS or typed array)\r\n          _gl.uniform1fv(location, value);\r\n\r\n          break;\r\n\r\n        case 'fv':\r\n\r\n          // flat array of floats with 3 x N size (JS or typed array)\r\n          _gl.uniform3fv(location, value);\r\n\r\n          break;\r\n\r\n        case 'v2v':\r\n\r\n          // array of THREE.Vector2\r\n\r\n          if (uniform._array === undefined) {\r\n\r\n            uniform._array = new Float32Array(2 * value.length);\r\n\r\n          }\r\n\r\n          for (var i = 0, il = value.length; i < il; i++) {\r\n\r\n            offset = i * 2;\r\n\r\n            uniform._array[offset] = value[i].x;\r\n            uniform._array[offset + 1] = value[i].y;\r\n\r\n          }\r\n\r\n          _gl.uniform2fv(location, uniform._array);\r\n\r\n          break;\r\n\r\n        case 'v3v':\r\n\r\n          // array of THREE.Vector3\r\n\r\n          if (uniform._array === undefined) {\r\n\r\n            uniform._array = new Float32Array(3 * value.length);\r\n\r\n          }\r\n\r\n          for (var i = 0, il = value.length; i < il; i++) {\r\n\r\n            offset = i * 3;\r\n\r\n            uniform._array[offset] = value[i].x;\r\n            uniform._array[offset + 1] = value[i].y;\r\n            uniform._array[offset + 2] = value[i].z;\r\n\r\n          }\r\n\r\n          _gl.uniform3fv(location, uniform._array);\r\n\r\n          break;\r\n\r\n        case 'v4v':\r\n\r\n          // array of THREE.Vector4\r\n\r\n          if (uniform._array === undefined) {\r\n\r\n            uniform._array = new Float32Array(4 * value.length);\r\n\r\n          }\r\n\r\n          for (var i = 0, il = value.length; i < il; i++) {\r\n\r\n            offset = i * 4;\r\n\r\n            uniform._array[offset] = value[i].x;\r\n            uniform._array[offset + 1] = value[i].y;\r\n            uniform._array[offset + 2] = value[i].z;\r\n            uniform._array[offset + 3] = value[i].w;\r\n\r\n          }\r\n\r\n          _gl.uniform4fv(location, uniform._array);\r\n\r\n          break;\r\n\r\n        case 'm3':\r\n\r\n          // single THREE.Matrix3\r\n          _gl.uniformMatrix3fv(location, false, value.elements);\r\n\r\n          break;\r\n\r\n        case 'm3v':\r\n\r\n          // array of THREE.Matrix3\r\n\r\n          if (uniform._array === undefined) {\r\n\r\n            uniform._array = new Float32Array(9 * value.length);\r\n\r\n          }\r\n\r\n          for (var i = 0, il = value.length; i < il; i++) {\r\n\r\n            value[i].flattenToArrayOffset(uniform._array, i * 9);\r\n\r\n          }\r\n\r\n          _gl.uniformMatrix3fv(location, false, uniform._array);\r\n\r\n          break;\r\n\r\n        case 'm4':\r\n\r\n          // single THREE.Matrix4\r\n          _gl.uniformMatrix4fv(location, false, value.elements);\r\n\r\n          break;\r\n\r\n        case 'm4v':\r\n\r\n          // array of THREE.Matrix4\r\n\r\n          if (uniform._array === undefined) {\r\n\r\n            uniform._array = new Float32Array(16 * value.length);\r\n\r\n          }\r\n\r\n          for (var i = 0, il = value.length; i < il; i++) {\r\n\r\n            value[i].flattenToArrayOffset(uniform._array, i * 16);\r\n\r\n          }\r\n\r\n          _gl.uniformMatrix4fv(location, false, uniform._array);\r\n\r\n          break;\r\n\r\n        case 't':\r\n\r\n          // single THREE.Texture (2d or cube)\r\n\r\n          texture = value;\r\n          textureUnit = getTextureUnit();\r\n\r\n          _gl.uniform1i(location, textureUnit);\r\n\r\n          if (!texture) continue;\r\n\r\n          if (texture instanceof THREE.CubeTexture ||\r\n            (texture.image instanceof Array && texture.image.length === 6)) { // CompressedTexture can have Array in image :/\r\n\r\n            setCubeTexture(texture, textureUnit);\r\n\r\n          }\r\n          else if (texture instanceof THREE.WebGLRenderTargetCube) {\r\n\r\n            setCubeTextureDynamic(texture, textureUnit);\r\n\r\n          }\r\n          else {\r\n\r\n            _this.setTexture(texture, textureUnit);\r\n\r\n          }\r\n\r\n          break;\r\n\r\n        case 'tv':\r\n\r\n          // array of THREE.Texture (2d)\r\n\r\n          if (uniform._array === undefined) {\r\n\r\n            uniform._array = [];\r\n\r\n          }\r\n\r\n          for (var i = 0, il = uniform.value.length; i < il; i++) {\r\n\r\n            uniform._array[i] = getTextureUnit();\r\n\r\n          }\r\n\r\n          _gl.uniform1iv(location, uniform._array);\r\n\r\n          for (var i = 0, il = uniform.value.length; i < il; i++) {\r\n\r\n            texture = uniform.value[i];\r\n            textureUnit = uniform._array[i];\r\n\r\n            if (!texture) continue;\r\n\r\n            _this.setTexture(texture, textureUnit);\r\n\r\n          }\r\n\r\n          break;\r\n\r\n        default:\r\n\r\n          THREE.warn('THREE.WebGLRenderer: Unknown uniform type: ' + type);\r\n\r\n      }\r\n\r\n    }\r\n\r\n  }\r\n\r\n  function setupMatrices(object, camera) {\r\n\r\n    object._modelViewMatrix.multiplyMatrices(camera.matrixWorldInverse, object.matrixWorld);\r\n    object._normalMatrix.getNormalMatrix(object._modelViewMatrix);\r\n\r\n  }\r\n\r\n  function setColorLinear(array, offset, color, intensity) {\r\n\r\n    array[offset] = color.r * intensity;\r\n    array[offset + 1] = color.g * intensity;\r\n    array[offset + 2] = color.b * intensity;\r\n\r\n  }\r\n\r\n  function setupLights(lights) {\r\n\r\n    var l, ll, light,\r\n      r = 0,\r\n      g = 0,\r\n      b = 0,\r\n      color, skyColor, groundColor,\r\n      intensity,\r\n      distance,\r\n\r\n      zlights = _lights,\r\n\r\n      dirColors = zlights.directional.colors,\r\n      dirPositions = zlights.directional.positions,\r\n\r\n      pointColors = zlights.point.colors,\r\n      pointPositions = zlights.point.positions,\r\n      pointDistances = zlights.point.distances,\r\n      pointDecays = zlights.point.decays,\r\n\r\n      spotColors = zlights.spot.colors,\r\n      spotPositions = zlights.spot.positions,\r\n      spotDistances = zlights.spot.distances,\r\n      spotDirections = zlights.spot.directions,\r\n      spotAnglesCos = zlights.spot.anglesCos,\r\n      spotExponents = zlights.spot.exponents,\r\n      spotDecays = zlights.spot.decays,\r\n\r\n      hemiSkyColors = zlights.hemi.skyColors,\r\n      hemiGroundColors = zlights.hemi.groundColors,\r\n      hemiPositions = zlights.hemi.positions,\r\n\r\n      dirLength = 0,\r\n      pointLength = 0,\r\n      spotLength = 0,\r\n      hemiLength = 0,\r\n\r\n      dirCount = 0,\r\n      pointCount = 0,\r\n      spotCount = 0,\r\n      hemiCount = 0,\r\n\r\n      dirOffset = 0,\r\n      pointOffset = 0,\r\n      spotOffset = 0,\r\n      hemiOffset = 0;\r\n\r\n    for (l = 0, ll = lights.length; l < ll; l++) {\r\n\r\n      light = lights[l];\r\n\r\n      if (light.onlyShadow) continue;\r\n\r\n      color = light.color;\r\n      intensity = light.intensity;\r\n      distance = light.distance;\r\n\r\n      if (light instanceof THREE.AmbientLight) {\r\n\r\n        if (!light.visible) continue;\r\n\r\n        r += color.r;\r\n        g += color.g;\r\n        b += color.b;\r\n\r\n      }\r\n      else if (light instanceof THREE.DirectionalLight) {\r\n\r\n        dirCount += 1;\r\n\r\n        if (!light.visible) continue;\r\n\r\n        _direction.setFromMatrixPosition(light.matrixWorld);\r\n        _vector3.setFromMatrixPosition(light.target.matrixWorld);\r\n        _direction.sub(_vector3);\r\n        _direction.normalize();\r\n\r\n        dirOffset = dirLength * 3;\r\n\r\n        dirPositions[dirOffset] = _direction.x;\r\n        dirPositions[dirOffset + 1] = _direction.y;\r\n        dirPositions[dirOffset + 2] = _direction.z;\r\n\r\n        setColorLinear(dirColors, dirOffset, color, intensity);\r\n\r\n        dirLength += 1;\r\n\r\n      }\r\n      else if (light instanceof THREE.PointLight) {\r\n\r\n        pointCount += 1;\r\n\r\n        if (!light.visible) continue;\r\n\r\n        pointOffset = pointLength * 3;\r\n\r\n        setColorLinear(pointColors, pointOffset, color, intensity);\r\n\r\n        _vector3.setFromMatrixPosition(light.matrixWorld);\r\n\r\n        pointPositions[pointOffset] = _vector3.x;\r\n        pointPositions[pointOffset + 1] = _vector3.y;\r\n        pointPositions[pointOffset + 2] = _vector3.z;\r\n\r\n        // distance is 0 if decay is 0, because there is no attenuation at all.\r\n        pointDistances[pointLength] = distance;\r\n        pointDecays[pointLength] = (light.distance === 0) ? 0.0 : light.decay;\r\n\r\n        pointLength += 1;\r\n\r\n      }\r\n      else if (light instanceof THREE.SpotLight) {\r\n\r\n        spotCount += 1;\r\n\r\n        if (!light.visible) continue;\r\n\r\n        spotOffset = spotLength * 3;\r\n\r\n        setColorLinear(spotColors, spotOffset, color, intensity);\r\n\r\n        _direction.setFromMatrixPosition(light.matrixWorld);\r\n\r\n        spotPositions[spotOffset] = _direction.x;\r\n        spotPositions[spotOffset + 1] = _direction.y;\r\n        spotPositions[spotOffset + 2] = _direction.z;\r\n\r\n        spotDistances[spotLength] = distance;\r\n\r\n        _vector3.setFromMatrixPosition(light.target.matrixWorld);\r\n        _direction.sub(_vector3);\r\n        _direction.normalize();\r\n\r\n        spotDirections[spotOffset] = _direction.x;\r\n        spotDirections[spotOffset + 1] = _direction.y;\r\n        spotDirections[spotOffset + 2] = _direction.z;\r\n\r\n        spotAnglesCos[spotLength] = Math.cos(light.angle);\r\n        spotExponents[spotLength] = light.exponent;\r\n        spotDecays[spotLength] = (light.distance === 0) ? 0.0 : light.decay;\r\n\r\n        spotLength += 1;\r\n\r\n      }\r\n      else if (light instanceof THREE.HemisphereLight) {\r\n\r\n        hemiCount += 1;\r\n\r\n        if (!light.visible) continue;\r\n\r\n        _direction.setFromMatrixPosition(light.matrixWorld);\r\n        _direction.normalize();\r\n\r\n        hemiOffset = hemiLength * 3;\r\n\r\n        hemiPositions[hemiOffset] = _direction.x;\r\n        hemiPositions[hemiOffset + 1] = _direction.y;\r\n        hemiPositions[hemiOffset + 2] = _direction.z;\r\n\r\n        skyColor = light.color;\r\n        groundColor = light.groundColor;\r\n\r\n        setColorLinear(hemiSkyColors, hemiOffset, skyColor, intensity);\r\n        setColorLinear(hemiGroundColors, hemiOffset, groundColor, intensity);\r\n\r\n        hemiLength += 1;\r\n\r\n      }\r\n\r\n    }\r\n\r\n    // null eventual remains from removed lights\r\n    // (this is to avoid if in shader)\r\n\r\n    for (l = dirLength * 3, ll = Math.max(dirColors.length, dirCount * 3); l < ll; l++) dirColors[l] = 0.0;\r\n    for (l = pointLength * 3, ll = Math.max(pointColors.length, pointCount * 3); l < ll; l++) pointColors[l] = 0.0;\r\n    for (l = spotLength * 3, ll = Math.max(spotColors.length, spotCount * 3); l < ll; l++) spotColors[l] = 0.0;\r\n    for (l = hemiLength * 3, ll = Math.max(hemiSkyColors.length, hemiCount * 3); l < ll; l++) hemiSkyColors[l] = 0.0;\r\n    for (l = hemiLength * 3, ll = Math.max(hemiGroundColors.length, hemiCount * 3); l < ll; l++) hemiGroundColors[l] = 0.0;\r\n\r\n    zlights.directional.length = dirLength;\r\n    zlights.point.length = pointLength;\r\n    zlights.spot.length = spotLength;\r\n    zlights.hemi.length = hemiLength;\r\n\r\n    zlights.ambient[0] = r;\r\n    zlights.ambient[1] = g;\r\n    zlights.ambient[2] = b;\r\n\r\n  }\r\n\r\n  // GL state setting\r\n\r\n  this.setFaceCulling = function(cullFace, frontFaceDirection) {\r\n\r\n    if (cullFace === THREE.CullFaceNone) {\r\n\r\n      _gl.disable(_gl.CULL_FACE);\r\n\r\n    }\r\n    else {\r\n\r\n      if (frontFaceDirection === THREE.FrontFaceDirectionCW) {\r\n\r\n        _gl.frontFace(_gl.CW);\r\n\r\n      }\r\n      else {\r\n\r\n        _gl.frontFace(_gl.CCW);\r\n\r\n      }\r\n\r\n      if (cullFace === THREE.CullFaceBack) {\r\n\r\n        _gl.cullFace(_gl.BACK);\r\n\r\n      }\r\n      else if (cullFace === THREE.CullFaceFront) {\r\n\r\n        _gl.cullFace(_gl.FRONT);\r\n\r\n      }\r\n      else {\r\n\r\n        _gl.cullFace(_gl.FRONT_AND_BACK);\r\n\r\n      }\r\n\r\n      _gl.enable(_gl.CULL_FACE);\r\n\r\n    }\r\n\r\n  };\r\n\r\n  this.setMaterialFaces = function(material) {\r\n\r\n    state.setDoubleSided(material.side === THREE.DoubleSide);\r\n    state.setFlipSided(material.side === THREE.BackSide);\r\n\r\n  };\r\n\r\n  // Textures\r\n\r\n  function setTextureParameters(textureType, texture, isImagePowerOfTwo) {\r\n\r\n    var extension;\r\n\r\n    if (isImagePowerOfTwo) {\r\n\r\n      _gl.texParameteri(textureType, _gl.TEXTURE_WRAP_S, paramThreeToGL(texture.wrapS));\r\n      _gl.texParameteri(textureType, _gl.TEXTURE_WRAP_T, paramThreeToGL(texture.wrapT));\r\n\r\n      _gl.texParameteri(textureType, _gl.TEXTURE_MAG_FILTER, paramThreeToGL(texture.magFilter));\r\n      _gl.texParameteri(textureType, _gl.TEXTURE_MIN_FILTER, paramThreeToGL(texture.minFilter));\r\n\r\n    }\r\n    else {\r\n\r\n      _gl.texParameteri(textureType, _gl.TEXTURE_WRAP_S, _gl.CLAMP_TO_EDGE);\r\n      _gl.texParameteri(textureType, _gl.TEXTURE_WRAP_T, _gl.CLAMP_TO_EDGE);\r\n\r\n      if (texture.wrapS !== THREE.ClampToEdgeWrapping || texture.wrapT !== THREE.ClampToEdgeWrapping) {\r\n\r\n        THREE.warn('THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping. ( ' + texture.sourceFile + ' )');\r\n\r\n      }\r\n\r\n      _gl.texParameteri(textureType, _gl.TEXTURE_MAG_FILTER, filterFallback(texture.magFilter));\r\n      _gl.texParameteri(textureType, _gl.TEXTURE_MIN_FILTER, filterFallback(texture.minFilter));\r\n\r\n      if (texture.minFilter !== THREE.NearestFilter && texture.minFilter !== THREE.LinearFilter) {\r\n\r\n        THREE.warn('THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter. ( ' + texture.sourceFile + ' )');\r\n\r\n      }\r\n\r\n    }\r\n\r\n    extension = extensions.get('EXT_texture_filter_anisotropic');\r\n\r\n    if (extension && texture.type !== THREE.FloatType && texture.type !== THREE.HalfFloatType) {\r\n\r\n      if (texture.anisotropy > 1 || texture.__currentAnisotropy) {\r\n\r\n        _gl.texParameterf(textureType, extension.TEXTURE_MAX_ANISOTROPY_EXT, Math.min(texture.anisotropy, _this.getMaxAnisotropy()));\r\n        texture.__currentAnisotropy = texture.anisotropy;\r\n\r\n      }\r\n\r\n    }\r\n\r\n  }\r\n\r\n  this.uploadTexture = function(texture) {\r\n\r\n    if (texture.__webglInit === undefined) {\r\n\r\n      texture.__webglInit = true;\r\n\r\n      texture.addEventListener('dispose', onTextureDispose);\r\n\r\n      texture.__webglTexture = _gl.createTexture();\r\n\r\n      _this.info.memory.textures++;\r\n\r\n    }\r\n\r\n    _gl.bindTexture(_gl.TEXTURE_2D, texture.__webglTexture);\r\n\r\n    _gl.pixelStorei(_gl.UNPACK_FLIP_Y_WEBGL, texture.flipY);\r\n    _gl.pixelStorei(_gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL, texture.premultiplyAlpha);\r\n    _gl.pixelStorei(_gl.UNPACK_ALIGNMENT, texture.unpackAlignment);\r\n\r\n    texture.image = clampToMaxSize(texture.image, _maxTextureSize);\r\n\r\n    var image = texture.image,\r\n      isImagePowerOfTwo = THREE.Math.isPowerOfTwo(image.width) && THREE.Math.isPowerOfTwo(image.height),\r\n      glFormat = paramThreeToGL(texture.format),\r\n      glType = paramThreeToGL(texture.type);\r\n\r\n    setTextureParameters(_gl.TEXTURE_2D, texture, isImagePowerOfTwo);\r\n\r\n    var mipmap, mipmaps = texture.mipmaps;\r\n\r\n    if (texture instanceof THREE.DataTexture) {\r\n\r\n      // use manually created mipmaps if available\r\n      // if there are no manual mipmaps\r\n      // set 0 level mipmap and then use GL to generate other mipmap levels\r\n\r\n      if (mipmaps.length > 0 && isImagePowerOfTwo) {\r\n\r\n        for (var i = 0, il = mipmaps.length; i < il; i++) {\r\n\r\n          mipmap = mipmaps[i];\r\n          _gl.texImage2D(_gl.TEXTURE_2D, i, glFormat, mipmap.width, mipmap.height, 0, glFormat, glType, mipmap.data);\r\n\r\n        }\r\n\r\n        texture.generateMipmaps = false;\r\n\r\n      }\r\n      else {\r\n\r\n        _gl.texImage2D(_gl.TEXTURE_2D, 0, glFormat, image.width, image.height, 0, glFormat, glType, image.data);\r\n\r\n      }\r\n\r\n    }\r\n    else if (texture instanceof THREE.CompressedTexture) {\r\n\r\n      for (var i = 0, il = mipmaps.length; i < il; i++) {\r\n\r\n        mipmap = mipmaps[i];\r\n\r\n        if (texture.format !== THREE.RGBAFormat && texture.format !== THREE.RGBFormat) {\r\n\r\n          if (getCompressedTextureFormats().indexOf(glFormat) > -1) {\r\n\r\n            _gl.compressedTexImage2D(_gl.TEXTURE_2D, i, glFormat, mipmap.width, mipmap.height, 0, mipmap.data);\r\n\r\n          }\r\n          else {\r\n\r\n            THREE.warn(\"THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()\");\r\n\r\n          }\r\n\r\n        }\r\n        else {\r\n\r\n          _gl.texImage2D(_gl.TEXTURE_2D, i, glFormat, mipmap.width, mipmap.height, 0, glFormat, glType, mipmap.data);\r\n\r\n        }\r\n\r\n      }\r\n\r\n    }\r\n    else { // regular Texture (image, video, canvas)\r\n\r\n      // use manually created mipmaps if available\r\n      // if there are no manual mipmaps\r\n      // set 0 level mipmap and then use GL to generate other mipmap levels\r\n\r\n      if (mipmaps.length > 0 && isImagePowerOfTwo) {\r\n\r\n        for (var i = 0, il = mipmaps.length; i < il; i++) {\r\n\r\n          mipmap = mipmaps[i];\r\n          _gl.texImage2D(_gl.TEXTURE_2D, i, glFormat, glFormat, glType, mipmap);\r\n\r\n        }\r\n\r\n        texture.generateMipmaps = false;\r\n\r\n      }\r\n      else {\r\n\r\n        _gl.texImage2D(_gl.TEXTURE_2D, 0, glFormat, glFormat, glType, texture.image);\r\n\r\n      }\r\n\r\n    }\r\n\r\n    if (texture.generateMipmaps && isImagePowerOfTwo) _gl.generateMipmap(_gl.TEXTURE_2D);\r\n\r\n    texture.needsUpdate = false;\r\n\r\n    if (texture.onUpdate) texture.onUpdate();\r\n\r\n  };\r\n\r\n  this.setTexture = function(texture, slot) {\r\n\r\n    _gl.activeTexture(_gl.TEXTURE0 + slot);\r\n\r\n    if (texture.needsUpdate) {\r\n\r\n      _this.uploadTexture(texture);\r\n\r\n    }\r\n    else {\r\n\r\n      _gl.bindTexture(_gl.TEXTURE_2D, texture.__webglTexture);\r\n\r\n    }\r\n\r\n  };\r\n\r\n  function clampToMaxSize(image, maxSize) {\r\n\r\n    if (image.width > maxSize || image.height > maxSize) {\r\n\r\n      // Warning: Scaling through the canvas will only work with images that use\r\n      // premultiplied alpha.\r\n\r\n      var scale = maxSize / Math.max(image.width, image.height);\r\n\r\n      var canvas = document.createElement('canvas');\r\n      canvas.width = Math.floor(image.width * scale);\r\n      canvas.height = Math.floor(image.height * scale);\r\n\r\n      var context = canvas.getContext('2d');\r\n      context.drawImage(image, 0, 0, image.width, image.height, 0, 0, canvas.width, canvas.height);\r\n\r\n      THREE.warn('THREE.WebGLRenderer: image is too big (' + image.width + 'x' + image.height + '). Resized to ' + canvas.width + 'x' + canvas.height, image);\r\n\r\n      return canvas;\r\n\r\n    }\r\n\r\n    return image;\r\n\r\n  }\r\n\r\n  function setCubeTexture(texture, slot) {\r\n\r\n    if (texture.image.length === 6) {\r\n\r\n      if (texture.needsUpdate) {\r\n\r\n        if (!texture.image.__webglTextureCube) {\r\n\r\n          texture.addEventListener('dispose', onTextureDispose);\r\n\r\n          texture.image.__webglTextureCube = _gl.createTexture();\r\n\r\n          _this.info.memory.textures++;\r\n\r\n        }\r\n\r\n        _gl.activeTexture(_gl.TEXTURE0 + slot);\r\n        _gl.bindTexture(_gl.TEXTURE_CUBE_MAP, texture.image.__webglTextureCube);\r\n\r\n        _gl.pixelStorei(_gl.UNPACK_FLIP_Y_WEBGL, texture.flipY);\r\n\r\n        var isCompressed = texture instanceof THREE.CompressedTexture;\r\n        var isDataTexture = texture.image[0] instanceof THREE.DataTexture;\r\n\r\n        var cubeImage = [];\r\n\r\n        for (var i = 0; i < 6; i++) {\r\n\r\n          if (_this.autoScaleCubemaps && !isCompressed && !isDataTexture) {\r\n\r\n            cubeImage[i] = clampToMaxSize(texture.image[i], _maxCubemapSize);\r\n\r\n          }\r\n          else {\r\n\r\n            cubeImage[i] = isDataTexture ? texture.image[i].image : texture.image[i];\r\n\r\n          }\r\n\r\n        }\r\n\r\n        var image = cubeImage[0],\r\n          isImagePowerOfTwo = THREE.Math.isPowerOfTwo(image.width) && THREE.Math.isPowerOfTwo(image.height),\r\n          glFormat = paramThreeToGL(texture.format),\r\n          glType = paramThreeToGL(texture.type);\r\n\r\n        setTextureParameters(_gl.TEXTURE_CUBE_MAP, texture, isImagePowerOfTwo);\r\n\r\n        for (var i = 0; i < 6; i++) {\r\n\r\n          if (!isCompressed) {\r\n\r\n            if (isDataTexture) {\r\n\r\n              _gl.texImage2D(_gl.TEXTURE_CUBE_MAP_POSITIVE_X + i, 0, glFormat, cubeImage[i].width, cubeImage[i].height, 0, glFormat, glType, cubeImage[i].data);\r\n\r\n            }\r\n            else {\r\n\r\n              _gl.texImage2D(_gl.TEXTURE_CUBE_MAP_POSITIVE_X + i, 0, glFormat, glFormat, glType, cubeImage[i]);\r\n\r\n            }\r\n\r\n          }\r\n          else {\r\n\r\n            var mipmap, mipmaps = cubeImage[i].mipmaps;\r\n\r\n            for (var j = 0, jl = mipmaps.length; j < jl; j++) {\r\n\r\n              mipmap = mipmaps[j];\r\n\r\n              if (texture.format !== THREE.RGBAFormat && texture.format !== THREE.RGBFormat) {\r\n\r\n                if (getCompressedTextureFormats().indexOf(glFormat) > -1) {\r\n\r\n                  _gl.compressedTexImage2D(_gl.TEXTURE_CUBE_MAP_POSITIVE_X + i, j, glFormat, mipmap.width, mipmap.height, 0, mipmap.data);\r\n\r\n                }\r\n                else {\r\n\r\n                  THREE.warn(\"THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setCubeTexture()\");\r\n\r\n                }\r\n\r\n              }\r\n              else {\r\n\r\n                _gl.texImage2D(_gl.TEXTURE_CUBE_MAP_POSITIVE_X + i, j, glFormat, mipmap.width, mipmap.height, 0, glFormat, glType, mipmap.data);\r\n\r\n              }\r\n\r\n            }\r\n\r\n          }\r\n\r\n        }\r\n\r\n        if (texture.generateMipmaps && isImagePowerOfTwo) {\r\n\r\n          _gl.generateMipmap(_gl.TEXTURE_CUBE_MAP);\r\n\r\n        }\r\n\r\n        texture.needsUpdate = false;\r\n\r\n        if (texture.onUpdate) texture.onUpdate();\r\n\r\n      }\r\n      else {\r\n\r\n        _gl.activeTexture(_gl.TEXTURE0 + slot);\r\n        _gl.bindTexture(_gl.TEXTURE_CUBE_MAP, texture.image.__webglTextureCube);\r\n\r\n      }\r\n\r\n    }\r\n\r\n  }\r\n\r\n  function setCubeTextureDynamic(texture, slot) {\r\n\r\n    _gl.activeTexture(_gl.TEXTURE0 + slot);\r\n    _gl.bindTexture(_gl.TEXTURE_CUBE_MAP, texture.__webglTexture);\r\n\r\n  }\r\n\r\n  // Render targets\r\n\r\n  function setupFrameBuffer(framebuffer, renderTarget, textureTarget) {\r\n\r\n    _gl.bindFramebuffer(_gl.FRAMEBUFFER, framebuffer);\r\n    _gl.framebufferTexture2D(_gl.FRAMEBUFFER, _gl.COLOR_ATTACHMENT0, textureTarget, renderTarget.__webglTexture, 0);\r\n\r\n  }\r\n\r\n  function setupRenderBuffer(renderbuffer, renderTarget) {\r\n\r\n    _gl.bindRenderbuffer(_gl.RENDERBUFFER, renderbuffer);\r\n\r\n    if (renderTarget.depthBuffer && !renderTarget.stencilBuffer) {\r\n\r\n      _gl.renderbufferStorage(_gl.RENDERBUFFER, _gl.DEPTH_COMPONENT16, renderTarget.width, renderTarget.height);\r\n      _gl.framebufferRenderbuffer(_gl.FRAMEBUFFER, _gl.DEPTH_ATTACHMENT, _gl.RENDERBUFFER, renderbuffer);\r\n\r\n      /* For some reason this is not working. Defaulting to RGBA4.\r\n      } else if ( ! renderTarget.depthBuffer && renderTarget.stencilBuffer ) {\r\n\r\n      \t_gl.renderbufferStorage( _gl.RENDERBUFFER, _gl.STENCIL_INDEX8, renderTarget.width, renderTarget.height );\r\n      \t_gl.framebufferRenderbuffer( _gl.FRAMEBUFFER, _gl.STENCIL_ATTACHMENT, _gl.RENDERBUFFER, renderbuffer );\r\n      */\r\n    }\r\n    else if (renderTarget.depthBuffer && renderTarget.stencilBuffer) {\r\n\r\n      _gl.renderbufferStorage(_gl.RENDERBUFFER, _gl.DEPTH_STENCIL, renderTarget.width, renderTarget.height);\r\n      _gl.framebufferRenderbuffer(_gl.FRAMEBUFFER, _gl.DEPTH_STENCIL_ATTACHMENT, _gl.RENDERBUFFER, renderbuffer);\r\n\r\n    }\r\n    else {\r\n\r\n      _gl.renderbufferStorage(_gl.RENDERBUFFER, _gl.RGBA4, renderTarget.width, renderTarget.height);\r\n\r\n    }\r\n\r\n  }\r\n\r\n  this.setRenderTarget = function(renderTarget) {\r\n\r\n    var isCube = (renderTarget instanceof THREE.WebGLRenderTargetCube);\r\n\r\n    if (renderTarget && renderTarget.__webglFramebuffer === undefined) {\r\n\r\n      if (renderTarget.depthBuffer === undefined) renderTarget.depthBuffer = true;\r\n      if (renderTarget.stencilBuffer === undefined) renderTarget.stencilBuffer = true;\r\n\r\n      renderTarget.addEventListener('dispose', onRenderTargetDispose);\r\n\r\n      renderTarget.__webglTexture = _gl.createTexture();\r\n\r\n      _this.info.memory.textures++;\r\n\r\n      // Setup texture, create render and frame buffers\r\n\r\n      var isTargetPowerOfTwo = THREE.Math.isPowerOfTwo(renderTarget.width) && THREE.Math.isPowerOfTwo(renderTarget.height),\r\n        glFormat = paramThreeToGL(renderTarget.format),\r\n        glType = paramThreeToGL(renderTarget.type);\r\n\r\n      if (isCube) {\r\n\r\n        renderTarget.__webglFramebuffer = [];\r\n        renderTarget.__webglRenderbuffer = [];\r\n\r\n        _gl.bindTexture(_gl.TEXTURE_CUBE_MAP, renderTarget.__webglTexture);\r\n        setTextureParameters(_gl.TEXTURE_CUBE_MAP, renderTarget, isTargetPowerOfTwo);\r\n\r\n        for (var i = 0; i < 6; i++) {\r\n\r\n          renderTarget.__webglFramebuffer[i] = _gl.createFramebuffer();\r\n          renderTarget.__webglRenderbuffer[i] = _gl.createRenderbuffer();\r\n\r\n          _gl.texImage2D(_gl.TEXTURE_CUBE_MAP_POSITIVE_X + i, 0, glFormat, renderTarget.width, renderTarget.height, 0, glFormat, glType, null);\r\n\r\n          setupFrameBuffer(renderTarget.__webglFramebuffer[i], renderTarget, _gl.TEXTURE_CUBE_MAP_POSITIVE_X + i);\r\n          setupRenderBuffer(renderTarget.__webglRenderbuffer[i], renderTarget);\r\n\r\n        }\r\n\r\n        if (isTargetPowerOfTwo) _gl.generateMipmap(_gl.TEXTURE_CUBE_MAP);\r\n\r\n      }\r\n      else {\r\n\r\n        renderTarget.__webglFramebuffer = _gl.createFramebuffer();\r\n\r\n        if (renderTarget.shareDepthFrom) {\r\n\r\n          renderTarget.__webglRenderbuffer = renderTarget.shareDepthFrom.__webglRenderbuffer;\r\n\r\n        }\r\n        else {\r\n\r\n          renderTarget.__webglRenderbuffer = _gl.createRenderbuffer();\r\n\r\n        }\r\n\r\n        _gl.bindTexture(_gl.TEXTURE_2D, renderTarget.__webglTexture);\r\n        setTextureParameters(_gl.TEXTURE_2D, renderTarget, isTargetPowerOfTwo);\r\n\r\n        _gl.texImage2D(_gl.TEXTURE_2D, 0, glFormat, renderTarget.width, renderTarget.height, 0, glFormat, glType, null);\r\n\r\n        setupFrameBuffer(renderTarget.__webglFramebuffer, renderTarget, _gl.TEXTURE_2D);\r\n\r\n        if (renderTarget.shareDepthFrom) {\r\n\r\n          if (renderTarget.depthBuffer && !renderTarget.stencilBuffer) {\r\n\r\n            _gl.framebufferRenderbuffer(_gl.FRAMEBUFFER, _gl.DEPTH_ATTACHMENT, _gl.RENDERBUFFER, renderTarget.__webglRenderbuffer);\r\n\r\n          }\r\n          else if (renderTarget.depthBuffer && renderTarget.stencilBuffer) {\r\n\r\n            _gl.framebufferRenderbuffer(_gl.FRAMEBUFFER, _gl.DEPTH_STENCIL_ATTACHMENT, _gl.RENDERBUFFER, renderTarget.__webglRenderbuffer);\r\n\r\n          }\r\n\r\n        }\r\n        else {\r\n\r\n          setupRenderBuffer(renderTarget.__webglRenderbuffer, renderTarget);\r\n\r\n        }\r\n\r\n        if (isTargetPowerOfTwo) _gl.generateMipmap(_gl.TEXTURE_2D);\r\n\r\n      }\r\n\r\n      // Release everything\r\n\r\n      if (isCube) {\r\n\r\n        _gl.bindTexture(_gl.TEXTURE_CUBE_MAP, null);\r\n\r\n      }\r\n      else {\r\n\r\n        _gl.bindTexture(_gl.TEXTURE_2D, null);\r\n\r\n      }\r\n\r\n      _gl.bindRenderbuffer(_gl.RENDERBUFFER, null);\r\n      _gl.bindFramebuffer(_gl.FRAMEBUFFER, null);\r\n\r\n    }\r\n\r\n    var framebuffer, width, height, vx, vy;\r\n\r\n    if (renderTarget) {\r\n\r\n      if (isCube) {\r\n\r\n        framebuffer = renderTarget.__webglFramebuffer[renderTarget.activeCubeFace];\r\n\r\n      }\r\n      else {\r\n\r\n        framebuffer = renderTarget.__webglFramebuffer;\r\n\r\n      }\r\n\r\n      width = renderTarget.width;\r\n      height = renderTarget.height;\r\n\r\n      vx = 0;\r\n      vy = 0;\r\n\r\n    }\r\n    else {\r\n\r\n      framebuffer = null;\r\n\r\n      width = _viewportWidth;\r\n      height = _viewportHeight;\r\n\r\n      vx = _viewportX;\r\n      vy = _viewportY;\r\n\r\n    }\r\n\r\n    if (framebuffer !== _currentFramebuffer) {\r\n\r\n      _gl.bindFramebuffer(_gl.FRAMEBUFFER, framebuffer);\r\n      _gl.viewport(vx, vy, width, height);\r\n\r\n      _currentFramebuffer = framebuffer;\r\n\r\n    }\r\n\r\n    _currentWidth = width;\r\n    _currentHeight = height;\r\n\r\n  };\r\n\r\n  this.readRenderTargetPixels = function(renderTarget, x, y, width, height, buffer) {\r\n\r\n    if (!(renderTarget instanceof THREE.WebGLRenderTarget)) {\r\n\r\n      console.error('THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.');\r\n      return;\r\n\r\n    }\r\n\r\n    if (renderTarget.__webglFramebuffer) {\r\n\r\n      if (renderTarget.format !== THREE.RGBAFormat) {\r\n\r\n        console.error('THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA format. readPixels can read only RGBA format.');\r\n        return;\r\n\r\n      }\r\n\r\n      var restore = false;\r\n\r\n      if (renderTarget.__webglFramebuffer !== _currentFramebuffer) {\r\n\r\n        _gl.bindFramebuffer(_gl.FRAMEBUFFER, renderTarget.__webglFramebuffer);\r\n\r\n        restore = true;\r\n\r\n      }\r\n\r\n      if (_gl.checkFramebufferStatus(_gl.FRAMEBUFFER) === _gl.FRAMEBUFFER_COMPLETE) {\r\n\r\n        _gl.readPixels(x, y, width, height, _gl.RGBA, _gl.UNSIGNED_BYTE, buffer);\r\n\r\n      }\r\n      else {\r\n\r\n        console.error('THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.');\r\n\r\n      }\r\n\r\n      if (restore) {\r\n\r\n        _gl.bindFramebuffer(_gl.FRAMEBUFFER, _currentFramebuffer);\r\n\r\n      }\r\n\r\n    }\r\n\r\n  };\r\n\r\n  function updateRenderTargetMipmap(renderTarget) {\r\n\r\n    if (renderTarget instanceof THREE.WebGLRenderTargetCube) {\r\n\r\n      _gl.bindTexture(_gl.TEXTURE_CUBE_MAP, renderTarget.__webglTexture);\r\n      _gl.generateMipmap(_gl.TEXTURE_CUBE_MAP);\r\n      _gl.bindTexture(_gl.TEXTURE_CUBE_MAP, null);\r\n\r\n    }\r\n    else {\r\n\r\n      _gl.bindTexture(_gl.TEXTURE_2D, renderTarget.__webglTexture);\r\n      _gl.generateMipmap(_gl.TEXTURE_2D);\r\n      _gl.bindTexture(_gl.TEXTURE_2D, null);\r\n\r\n    }\r\n\r\n  }\r\n\r\n  // Fallback filters for non-power-of-2 textures\r\n\r\n  function filterFallback(f) {\r\n\r\n    if (f === THREE.NearestFilter || f === THREE.NearestMipMapNearestFilter || f === THREE.NearestMipMapLinearFilter) {\r\n\r\n      return _gl.NEAREST;\r\n\r\n    }\r\n\r\n    return _gl.LINEAR;\r\n\r\n  }\r\n\r\n  // Map three.js constants to WebGL constants\r\n\r\n  function paramThreeToGL(p) {\r\n\r\n    var extension;\r\n\r\n    if (p === THREE.RepeatWrapping) return _gl.REPEAT;\r\n    if (p === THREE.ClampToEdgeWrapping) return _gl.CLAMP_TO_EDGE;\r\n    if (p === THREE.MirroredRepeatWrapping) return _gl.MIRRORED_REPEAT;\r\n\r\n    if (p === THREE.NearestFilter) return _gl.NEAREST;\r\n    if (p === THREE.NearestMipMapNearestFilter) return _gl.NEAREST_MIPMAP_NEAREST;\r\n    if (p === THREE.NearestMipMapLinearFilter) return _gl.NEAREST_MIPMAP_LINEAR;\r\n\r\n    if (p === THREE.LinearFilter) return _gl.LINEAR;\r\n    if (p === THREE.LinearMipMapNearestFilter) return _gl.LINEAR_MIPMAP_NEAREST;\r\n    if (p === THREE.LinearMipMapLinearFilter) return _gl.LINEAR_MIPMAP_LINEAR;\r\n\r\n    if (p === THREE.UnsignedByteType) return _gl.UNSIGNED_BYTE;\r\n    if (p === THREE.UnsignedShort4444Type) return _gl.UNSIGNED_SHORT_4_4_4_4;\r\n    if (p === THREE.UnsignedShort5551Type) return _gl.UNSIGNED_SHORT_5_5_5_1;\r\n    if (p === THREE.UnsignedShort565Type) return _gl.UNSIGNED_SHORT_5_6_5;\r\n\r\n    if (p === THREE.ByteType) return _gl.BYTE;\r\n    if (p === THREE.ShortType) return _gl.SHORT;\r\n    if (p === THREE.UnsignedShortType) return _gl.UNSIGNED_SHORT;\r\n    if (p === THREE.IntType) return _gl.INT;\r\n    if (p === THREE.UnsignedIntType) return _gl.UNSIGNED_INT;\r\n    if (p === THREE.FloatType) return _gl.FLOAT;\r\n\r\n    extension = extensions.get('OES_texture_half_float');\r\n\r\n    if (extension !== null) {\r\n\r\n      if (p === THREE.HalfFloatType) return extension.HALF_FLOAT_OES;\r\n\r\n    }\r\n\r\n    if (p === THREE.AlphaFormat) return _gl.ALPHA;\r\n    if (p === THREE.RGBFormat) return _gl.RGB;\r\n    if (p === THREE.RGBAFormat) return _gl.RGBA;\r\n    if (p === THREE.LuminanceFormat) return _gl.LUMINANCE;\r\n    if (p === THREE.LuminanceAlphaFormat) return _gl.LUMINANCE_ALPHA;\r\n\r\n    if (p === THREE.AddEquation) return _gl.FUNC_ADD;\r\n    if (p === THREE.SubtractEquation) return _gl.FUNC_SUBTRACT;\r\n    if (p === THREE.ReverseSubtractEquation) return _gl.FUNC_REVERSE_SUBTRACT;\r\n\r\n    if (p === THREE.ZeroFactor) return _gl.ZERO;\r\n    if (p === THREE.OneFactor) return _gl.ONE;\r\n    if (p === THREE.SrcColorFactor) return _gl.SRC_COLOR;\r\n    if (p === THREE.OneMinusSrcColorFactor) return _gl.ONE_MINUS_SRC_COLOR;\r\n    if (p === THREE.SrcAlphaFactor) return _gl.SRC_ALPHA;\r\n    if (p === THREE.OneMinusSrcAlphaFactor) return _gl.ONE_MINUS_SRC_ALPHA;\r\n    if (p === THREE.DstAlphaFactor) return _gl.DST_ALPHA;\r\n    if (p === THREE.OneMinusDstAlphaFactor) return _gl.ONE_MINUS_DST_ALPHA;\r\n\r\n    if (p === THREE.DstColorFactor) return _gl.DST_COLOR;\r\n    if (p === THREE.OneMinusDstColorFactor) return _gl.ONE_MINUS_DST_COLOR;\r\n    if (p === THREE.SrcAlphaSaturateFactor) return _gl.SRC_ALPHA_SATURATE;\r\n\r\n    extension = extensions.get('WEBGL_compressed_texture_s3tc');\r\n\r\n    if (extension !== null) {\r\n\r\n      if (p === THREE.RGB_S3TC_DXT1_Format) return extension.COMPRESSED_RGB_S3TC_DXT1_EXT;\r\n      if (p === THREE.RGBA_S3TC_DXT1_Format) return extension.COMPRESSED_RGBA_S3TC_DXT1_EXT;\r\n      if (p === THREE.RGBA_S3TC_DXT3_Format) return extension.COMPRESSED_RGBA_S3TC_DXT3_EXT;\r\n      if (p === THREE.RGBA_S3TC_DXT5_Format) return extension.COMPRESSED_RGBA_S3TC_DXT5_EXT;\r\n\r\n    }\r\n\r\n    extension = extensions.get('WEBGL_compressed_texture_pvrtc');\r\n\r\n    if (extension !== null) {\r\n\r\n      if (p === THREE.RGB_PVRTC_4BPPV1_Format) return extension.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;\r\n      if (p === THREE.RGB_PVRTC_2BPPV1_Format) return extension.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;\r\n      if (p === THREE.RGBA_PVRTC_4BPPV1_Format) return extension.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;\r\n      if (p === THREE.RGBA_PVRTC_2BPPV1_Format) return extension.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG;\r\n\r\n    }\r\n\r\n    extension = extensions.get('EXT_blend_minmax');\r\n\r\n    if (extension !== null) {\r\n\r\n      if (p === THREE.MinEquation) return extension.MIN_EXT;\r\n      if (p === THREE.MaxEquation) return extension.MAX_EXT;\r\n\r\n    }\r\n\r\n    return 0;\r\n\r\n  }\r\n\r\n  // Allocations\r\n\r\n  function allocateBones(object) {\r\n\r\n    if (_supportsBoneTextures && object && object.skeleton && object.skeleton.useVertexTexture) {\r\n\r\n      return 1024;\r\n\r\n    }\r\n    else {\r\n\r\n      // default for when object is not specified\r\n      // ( for example when prebuilding shader\r\n      //   to be used with multiple objects )\r\n      //\r\n      //  - leave some extra space for other uniforms\r\n      //  - limit here is ANGLE's 254 max uniform vectors\r\n      //    (up to 54 should be safe)\r\n\r\n      var nVertexUniforms = _gl.getParameter(_gl.MAX_VERTEX_UNIFORM_VECTORS);\r\n      var nVertexMatrices = Math.floor((nVertexUniforms - 20) / 4);\r\n\r\n      var maxBones = nVertexMatrices;\r\n\r\n      if (object !== undefined && object instanceof THREE.SkinnedMesh) {\r\n\r\n        maxBones = Math.min(object.skeleton.bones.length, maxBones);\r\n\r\n        if (maxBones < object.skeleton.bones.length) {\r\n\r\n          THREE.warn('WebGLRenderer: too many bones - ' + object.skeleton.bones.length + ', this GPU supports just ' + maxBones + ' (try OpenGL instead of ANGLE)');\r\n\r\n        }\r\n\r\n      }\r\n\r\n      return maxBones;\r\n\r\n    }\r\n\r\n  }\r\n\r\n  function allocateLights(lights) {\r\n\r\n    var dirLights = 0;\r\n    var pointLights = 0;\r\n    var spotLights = 0;\r\n    var hemiLights = 0;\r\n\r\n    for (var l = 0, ll = lights.length; l < ll; l++) {\r\n\r\n      var light = lights[l];\r\n\r\n      if (light.onlyShadow || light.visible === false) continue;\r\n\r\n      if (light instanceof THREE.DirectionalLight) dirLights++;\r\n      if (light instanceof THREE.PointLight) pointLights++;\r\n      if (light instanceof THREE.SpotLight) spotLights++;\r\n      if (light instanceof THREE.HemisphereLight) hemiLights++;\r\n\r\n    }\r\n\r\n    return {\r\n      'directional': dirLights,\r\n      'point': pointLights,\r\n      'spot': spotLights,\r\n      'hemi': hemiLights\r\n    };\r\n\r\n  }\r\n\r\n  function allocateShadows(lights) {\r\n\r\n    var maxShadows = 0;\r\n\r\n    for (var l = 0, ll = lights.length; l < ll; l++) {\r\n\r\n      var light = lights[l];\r\n\r\n      if (!light.castShadow) continue;\r\n\r\n      if (light instanceof THREE.SpotLight) maxShadows++;\r\n      if (light instanceof THREE.DirectionalLight && !light.shadowCascade) maxShadows++;\r\n\r\n    }\r\n\r\n    return maxShadows;\r\n\r\n  }\r\n\r\n  // DEPRECATED\r\n\r\n  this.initMaterial = function() {\r\n\r\n    THREE.warn('THREE.WebGLRenderer: .initMaterial() has been removed.');\r\n\r\n  };\r\n\r\n  this.addPrePlugin = function() {\r\n\r\n    THREE.warn('THREE.WebGLRenderer: .addPrePlugin() has been removed.');\r\n\r\n  };\r\n\r\n  this.addPostPlugin = function() {\r\n\r\n    THREE.warn('THREE.WebGLRenderer: .addPostPlugin() has been removed.');\r\n\r\n  };\r\n\r\n  this.updateShadowMap = function() {\r\n\r\n    THREE.warn('THREE.WebGLRenderer: .updateShadowMap() has been removed.');\r\n\r\n  };\r\n\r\n};\r\n\r\n// File:src/renderers/WebGLRenderTarget.js\r\n\r\n/**\r\n * @author szimek / https://github.com/szimek/\r\n * @author alteredq / http://alteredqualia.com/\r\n */\r\n\r\nTHREE.WebGLRenderTarget = function(width, height, options) {\r\n\r\n  this.width = width;\r\n  this.height = height;\r\n\r\n  options = options || {};\r\n\r\n  this.wrapS = options.wrapS !== undefined ? options.wrapS : THREE.ClampToEdgeWrapping;\r\n  this.wrapT = options.wrapT !== undefined ? options.wrapT : THREE.ClampToEdgeWrapping;\r\n\r\n  this.magFilter = options.magFilter !== undefined ? options.magFilter : THREE.LinearFilter;\r\n  this.minFilter = options.minFilter !== undefined ? options.minFilter : THREE.LinearMipMapLinearFilter;\r\n\r\n  this.anisotropy = options.anisotropy !== undefined ? options.anisotropy : 1;\r\n\r\n  this.offset = new THREE.Vector2(0, 0);\r\n  this.repeat = new THREE.Vector2(1, 1);\r\n\r\n  this.format = options.format !== undefined ? options.format : THREE.RGBAFormat;\r\n  this.type = options.type !== undefined ? options.type : THREE.UnsignedByteType;\r\n\r\n  this.depthBuffer = options.depthBuffer !== undefined ? options.depthBuffer : true;\r\n  this.stencilBuffer = options.stencilBuffer !== undefined ? options.stencilBuffer : true;\r\n\r\n  this.generateMipmaps = true;\r\n\r\n  this.shareDepthFrom = options.shareDepthFrom !== undefined ? options.shareDepthFrom : null;\r\n\r\n};\r\n\r\nTHREE.WebGLRenderTarget.prototype = {\r\n\r\n  constructor: THREE.WebGLRenderTarget,\r\n\r\n  setSize: function(width, height) {\r\n\r\n    this.width = width;\r\n    this.height = height;\r\n\r\n  },\r\n\r\n  clone: function() {\r\n\r\n    var tmp = new THREE.WebGLRenderTarget(this.width, this.height);\r\n\r\n    tmp.wrapS = this.wrapS;\r\n    tmp.wrapT = this.wrapT;\r\n\r\n    tmp.magFilter = this.magFilter;\r\n    tmp.minFilter = this.minFilter;\r\n\r\n    tmp.anisotropy = this.anisotropy;\r\n\r\n    tmp.offset.copy(this.offset);\r\n    tmp.repeat.copy(this.repeat);\r\n\r\n    tmp.format = this.format;\r\n    tmp.type = this.type;\r\n\r\n    tmp.depthBuffer = this.depthBuffer;\r\n    tmp.stencilBuffer = this.stencilBuffer;\r\n\r\n    tmp.generateMipmaps = this.generateMipmaps;\r\n\r\n    tmp.shareDepthFrom = this.shareDepthFrom;\r\n\r\n    return tmp;\r\n\r\n  },\r\n\r\n  dispose: function() {\r\n\r\n    this.dispatchEvent({\r\n      type: 'dispose'\r\n    });\r\n\r\n  }\r\n\r\n};\r\n\r\nTHREE.EventDispatcher.prototype.apply(THREE.WebGLRenderTarget.prototype);\r\n\r\n// File:src/renderers/WebGLRenderTargetCube.js\r\n\r\n/**\r\n * @author alteredq / http://alteredqualia.com\r\n */\r\n\r\nTHREE.WebGLRenderTargetCube = function(width, height, options) {\r\n\r\n  THREE.WebGLRenderTarget.call(this, width, height, options);\r\n\r\n  this.activeCubeFace = 0; // PX 0, NX 1, PY 2, NY 3, PZ 4, NZ 5\r\n\r\n};\r\n\r\nTHREE.WebGLRenderTargetCube.prototype = Object.create(THREE.WebGLRenderTarget.prototype);\r\nTHREE.WebGLRenderTargetCube.prototype.constructor = THREE.WebGLRenderTargetCube;\r\n\r\n// File:src/renderers/webgl/WebGLExtensions.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.WebGLExtensions = function(gl) {\r\n\r\n  var extensions = {};\r\n\r\n  this.get = function(name) {\r\n\r\n    if (extensions[name] !== undefined) {\r\n\r\n      return extensions[name];\r\n\r\n    }\r\n\r\n    var extension;\r\n\r\n    switch (name) {\r\n\r\n      case 'EXT_texture_filter_anisotropic':\r\n        extension = gl.getExtension('EXT_texture_filter_anisotropic') || gl.getExtension('MOZ_EXT_texture_filter_anisotropic') || gl.getExtension('WEBKIT_EXT_texture_filter_anisotropic');\r\n        break;\r\n\r\n      case 'WEBGL_compressed_texture_s3tc':\r\n        extension = gl.getExtension('WEBGL_compressed_texture_s3tc') || gl.getExtension('MOZ_WEBGL_compressed_texture_s3tc') || gl.getExtension('WEBKIT_WEBGL_compressed_texture_s3tc');\r\n        break;\r\n\r\n      case 'WEBGL_compressed_texture_pvrtc':\r\n        extension = gl.getExtension('WEBGL_compressed_texture_pvrtc') || gl.getExtension('WEBKIT_WEBGL_compressed_texture_pvrtc');\r\n        break;\r\n\r\n      default:\r\n        extension = gl.getExtension(name);\r\n\r\n    }\r\n\r\n    if (extension === null) {\r\n\r\n      THREE.warn('THREE.WebGLRenderer: ' + name + ' extension not supported.');\r\n\r\n    }\r\n\r\n    extensions[name] = extension;\r\n\r\n    return extension;\r\n\r\n  };\r\n\r\n};\r\n\r\n// File:src/renderers/webgl/WebGLProgram.js\r\n\r\nTHREE.WebGLProgram = (function() {\r\n\r\n  var programIdCount = 0;\r\n\r\n  var generateDefines = function(defines) {\r\n\r\n    var value, chunk, chunks = [];\r\n\r\n    for (var d in defines) {\r\n\r\n      value = defines[d];\r\n      if (value === false) continue;\r\n\r\n      chunk = '#define ' + d + ' ' + value;\r\n      chunks.push(chunk);\r\n\r\n    }\r\n\r\n    return chunks.join('\\n');\r\n\r\n  };\r\n\r\n  var cacheUniformLocations = function(gl, program, identifiers) {\r\n\r\n    var uniforms = {};\r\n\r\n    for (var i = 0, l = identifiers.length; i < l; i++) {\r\n\r\n      var id = identifiers[i];\r\n      uniforms[id] = gl.getUniformLocation(program, id);\r\n\r\n    }\r\n\r\n    return uniforms;\r\n\r\n  };\r\n\r\n  var cacheAttributeLocations = function(gl, program, identifiers) {\r\n\r\n    var attributes = {};\r\n\r\n    for (var i = 0, l = identifiers.length; i < l; i++) {\r\n\r\n      var id = identifiers[i];\r\n      attributes[id] = gl.getAttribLocation(program, id);\r\n\r\n    }\r\n\r\n    return attributes;\r\n\r\n  };\r\n\r\n  return function(renderer, code, material, parameters) {\r\n\r\n    var _this = renderer;\r\n    var _gl = _this.context;\r\n\r\n    var defines = material.defines;\r\n    var uniforms = material.__webglShader.uniforms;\r\n    var attributes = material.attributes;\r\n\r\n    var vertexShader = material.__webglShader.vertexShader;\r\n    var fragmentShader = material.__webglShader.fragmentShader;\r\n\r\n    var index0AttributeName = material.index0AttributeName;\r\n\r\n    if (index0AttributeName === undefined && parameters.morphTargets === true) {\r\n\r\n      // programs with morphTargets displace position out of attribute 0\r\n\r\n      index0AttributeName = 'position';\r\n\r\n    }\r\n\r\n    var shadowMapTypeDefine = 'SHADOWMAP_TYPE_BASIC';\r\n\r\n    if (parameters.shadowMapType === THREE.PCFShadowMap) {\r\n\r\n      shadowMapTypeDefine = 'SHADOWMAP_TYPE_PCF';\r\n\r\n    }\r\n    else if (parameters.shadowMapType === THREE.PCFSoftShadowMap) {\r\n\r\n      shadowMapTypeDefine = 'SHADOWMAP_TYPE_PCF_SOFT';\r\n\r\n    }\r\n\r\n    var envMapTypeDefine = 'ENVMAP_TYPE_CUBE';\r\n    var envMapModeDefine = 'ENVMAP_MODE_REFLECTION';\r\n    var envMapBlendingDefine = 'ENVMAP_BLENDING_MULTIPLY';\r\n\r\n    if (parameters.envMap) {\r\n\r\n      switch (material.envMap.mapping) {\r\n\r\n        case THREE.CubeReflectionMapping:\r\n        case THREE.CubeRefractionMapping:\r\n          envMapTypeDefine = 'ENVMAP_TYPE_CUBE';\r\n          break;\r\n\r\n        case THREE.EquirectangularReflectionMapping:\r\n        case THREE.EquirectangularRefractionMapping:\r\n          envMapTypeDefine = 'ENVMAP_TYPE_EQUIREC';\r\n          break;\r\n\r\n        case THREE.SphericalReflectionMapping:\r\n          envMapTypeDefine = 'ENVMAP_TYPE_SPHERE';\r\n          break;\r\n\r\n      }\r\n\r\n      switch (material.envMap.mapping) {\r\n\r\n        case THREE.CubeRefractionMapping:\r\n        case THREE.EquirectangularRefractionMapping:\r\n          envMapModeDefine = 'ENVMAP_MODE_REFRACTION';\r\n          break;\r\n\r\n      }\r\n\r\n      switch (material.combine) {\r\n\r\n        case THREE.MultiplyOperation:\r\n          envMapBlendingDefine = 'ENVMAP_BLENDING_MULTIPLY';\r\n          break;\r\n\r\n        case THREE.MixOperation:\r\n          envMapBlendingDefine = 'ENVMAP_BLENDING_MIX';\r\n          break;\r\n\r\n        case THREE.AddOperation:\r\n          envMapBlendingDefine = 'ENVMAP_BLENDING_ADD';\r\n          break;\r\n\r\n      }\r\n\r\n    }\r\n\r\n    var gammaFactorDefine = (renderer.gammaFactor > 0) ? renderer.gammaFactor : 1.0;\r\n\r\n    // console.log( 'building new program ' );\r\n\r\n    //\r\n\r\n    var customDefines = generateDefines(defines);\r\n\r\n    //\r\n\r\n    var program = _gl.createProgram();\r\n\r\n    var prefix_vertex, prefix_fragment;\r\n\r\n    if (material instanceof THREE.RawShaderMaterial) {\r\n\r\n      prefix_vertex = '';\r\n      prefix_fragment = '';\r\n\r\n    }\r\n    else {\r\n\r\n      prefix_vertex = [\r\n\r\n        'precision ' + parameters.precision + ' float;',\r\n        'precision ' + parameters.precision + ' int;',\r\n\r\n        customDefines,\r\n\r\n        parameters.supportsVertexTextures ? '#define VERTEX_TEXTURES' : '',\r\n\r\n        _this.gammaInput ? '#define GAMMA_INPUT' : '',\r\n        _this.gammaOutput ? '#define GAMMA_OUTPUT' : '',\r\n        '#define GAMMA_FACTOR ' + gammaFactorDefine,\r\n\r\n        '#define MAX_DIR_LIGHTS ' + parameters.maxDirLights,\r\n        '#define MAX_POINT_LIGHTS ' + parameters.maxPointLights,\r\n        '#define MAX_SPOT_LIGHTS ' + parameters.maxSpotLights,\r\n        '#define MAX_HEMI_LIGHTS ' + parameters.maxHemiLights,\r\n\r\n        '#define MAX_SHADOWS ' + parameters.maxShadows,\r\n\r\n        '#define MAX_BONES ' + parameters.maxBones,\r\n\r\n        parameters.map ? '#define USE_MAP' : '',\r\n        parameters.envMap ? '#define USE_ENVMAP' : '',\r\n        parameters.envMap ? '#define ' + envMapModeDefine : '',\r\n        parameters.lightMap ? '#define USE_LIGHTMAP' : '',\r\n        parameters.bumpMap ? '#define USE_BUMPMAP' : '',\r\n        parameters.normalMap ? '#define USE_NORMALMAP' : '',\r\n        parameters.specularMap ? '#define USE_SPECULARMAP' : '',\r\n        parameters.alphaMap ? '#define USE_ALPHAMAP' : '',\r\n        parameters.vertexColors ? '#define USE_COLOR' : '',\r\n\r\n        parameters.flatShading ? '#define FLAT_SHADED' : '',\r\n\r\n        parameters.skinning ? '#define USE_SKINNING' : '',\r\n        parameters.useVertexTexture ? '#define BONE_TEXTURE' : '',\r\n\r\n        parameters.morphTargets ? '#define USE_MORPHTARGETS' : '',\r\n        parameters.morphNormals ? '#define USE_MORPHNORMALS' : '',\r\n        parameters.wrapAround ? '#define WRAP_AROUND' : '',\r\n        parameters.doubleSided ? '#define DOUBLE_SIDED' : '',\r\n        parameters.flipSided ? '#define FLIP_SIDED' : '',\r\n\r\n        parameters.shadowMapEnabled ? '#define USE_SHADOWMAP' : '',\r\n        parameters.shadowMapEnabled ? '#define ' + shadowMapTypeDefine : '',\r\n        parameters.shadowMapDebug ? '#define SHADOWMAP_DEBUG' : '',\r\n        parameters.shadowMapCascade ? '#define SHADOWMAP_CASCADE' : '',\r\n\r\n        parameters.sizeAttenuation ? '#define USE_SIZEATTENUATION' : '',\r\n\r\n        parameters.logarithmicDepthBuffer ? '#define USE_LOGDEPTHBUF' : '',\r\n        //_this._glExtensionFragDepth ? '#define USE_LOGDEPTHBUF_EXT' : '',\r\n\r\n\r\n        'uniform mat4 modelMatrix;',\r\n        'uniform mat4 modelViewMatrix;',\r\n        'uniform mat4 projectionMatrix;',\r\n        'uniform mat4 viewMatrix;',\r\n        'uniform mat3 normalMatrix;',\r\n        'uniform vec3 cameraPosition;',\r\n\r\n        'attribute vec3 position;',\r\n        'attribute vec3 normal;',\r\n        'attribute vec2 uv;',\r\n        'attribute vec2 uv2;',\r\n\r\n        '#ifdef USE_COLOR',\r\n\r\n        '\tattribute vec3 color;',\r\n\r\n        '#endif',\r\n\r\n        '#ifdef USE_MORPHTARGETS',\r\n\r\n        '\tattribute vec3 morphTarget0;',\r\n        '\tattribute vec3 morphTarget1;',\r\n        '\tattribute vec3 morphTarget2;',\r\n        '\tattribute vec3 morphTarget3;',\r\n\r\n        '\t#ifdef USE_MORPHNORMALS',\r\n\r\n        '\t\tattribute vec3 morphNormal0;',\r\n        '\t\tattribute vec3 morphNormal1;',\r\n        '\t\tattribute vec3 morphNormal2;',\r\n        '\t\tattribute vec3 morphNormal3;',\r\n\r\n        '\t#else',\r\n\r\n        '\t\tattribute vec3 morphTarget4;',\r\n        '\t\tattribute vec3 morphTarget5;',\r\n        '\t\tattribute vec3 morphTarget6;',\r\n        '\t\tattribute vec3 morphTarget7;',\r\n\r\n        '\t#endif',\r\n\r\n        '#endif',\r\n\r\n        '#ifdef USE_SKINNING',\r\n\r\n        '\tattribute vec4 skinIndex;',\r\n        '\tattribute vec4 skinWeight;',\r\n\r\n        '#endif',\r\n\r\n        ''\r\n\r\n      ].join('\\n');\r\n\r\n      prefix_fragment = [\r\n\r\n        'precision ' + parameters.precision + ' float;',\r\n        'precision ' + parameters.precision + ' int;',\r\n\r\n        (parameters.bumpMap || parameters.normalMap || parameters.flatShading) ? '#extension GL_OES_standard_derivatives : enable' : '',\r\n\r\n        customDefines,\r\n\r\n        '#define MAX_DIR_LIGHTS ' + parameters.maxDirLights,\r\n        '#define MAX_POINT_LIGHTS ' + parameters.maxPointLights,\r\n        '#define MAX_SPOT_LIGHTS ' + parameters.maxSpotLights,\r\n        '#define MAX_HEMI_LIGHTS ' + parameters.maxHemiLights,\r\n\r\n        '#define MAX_SHADOWS ' + parameters.maxShadows,\r\n\r\n        parameters.alphaTest ? '#define ALPHATEST ' + parameters.alphaTest : '',\r\n\r\n        _this.gammaInput ? '#define GAMMA_INPUT' : '',\r\n        _this.gammaOutput ? '#define GAMMA_OUTPUT' : '',\r\n        '#define GAMMA_FACTOR ' + gammaFactorDefine,\r\n\r\n        (parameters.useFog && parameters.fog) ? '#define USE_FOG' : '', (parameters.useFog && parameters.fogExp) ? '#define FOG_EXP2' : '',\r\n\r\n        parameters.map ? '#define USE_MAP' : '',\r\n        parameters.envMap ? '#define USE_ENVMAP' : '',\r\n        parameters.envMap ? '#define ' + envMapTypeDefine : '',\r\n        parameters.envMap ? '#define ' + envMapModeDefine : '',\r\n        parameters.envMap ? '#define ' + envMapBlendingDefine : '',\r\n        parameters.lightMap ? '#define USE_LIGHTMAP' : '',\r\n        parameters.bumpMap ? '#define USE_BUMPMAP' : '',\r\n        parameters.normalMap ? '#define USE_NORMALMAP' : '',\r\n        parameters.specularMap ? '#define USE_SPECULARMAP' : '',\r\n        parameters.alphaMap ? '#define USE_ALPHAMAP' : '',\r\n        parameters.vertexColors ? '#define USE_COLOR' : '',\r\n\r\n        parameters.flatShading ? '#define FLAT_SHADED' : '',\r\n\r\n        parameters.metal ? '#define METAL' : '',\r\n        parameters.wrapAround ? '#define WRAP_AROUND' : '',\r\n        parameters.doubleSided ? '#define DOUBLE_SIDED' : '',\r\n        parameters.flipSided ? '#define FLIP_SIDED' : '',\r\n\r\n        parameters.shadowMapEnabled ? '#define USE_SHADOWMAP' : '',\r\n        parameters.shadowMapEnabled ? '#define ' + shadowMapTypeDefine : '',\r\n        parameters.shadowMapDebug ? '#define SHADOWMAP_DEBUG' : '',\r\n        parameters.shadowMapCascade ? '#define SHADOWMAP_CASCADE' : '',\r\n\r\n        parameters.logarithmicDepthBuffer ? '#define USE_LOGDEPTHBUF' : '',\r\n        //_this._glExtensionFragDepth ? '#define USE_LOGDEPTHBUF_EXT' : '',\r\n\r\n        'uniform mat4 viewMatrix;',\r\n        'uniform vec3 cameraPosition;',\r\n        ''\r\n\r\n      ].join('\\n');\r\n\r\n    }\r\n\r\n    var glVertexShader = new THREE.WebGLShader(_gl, _gl.VERTEX_SHADER, prefix_vertex + vertexShader);\r\n    var glFragmentShader = new THREE.WebGLShader(_gl, _gl.FRAGMENT_SHADER, prefix_fragment + fragmentShader);\r\n\r\n    _gl.attachShader(program, glVertexShader);\r\n    _gl.attachShader(program, glFragmentShader);\r\n\r\n    if (index0AttributeName !== undefined) {\r\n\r\n      // Force a particular attribute to index 0.\r\n      // because potentially expensive emulation is done by browser if attribute 0 is disabled.\r\n      // And, color, for example is often automatically bound to index 0 so disabling it\r\n\r\n      _gl.bindAttribLocation(program, 0, index0AttributeName);\r\n\r\n    }\r\n\r\n    _gl.linkProgram(program);\r\n\r\n    var programLogInfo = _gl.getProgramInfoLog(program);\r\n\r\n    if (_gl.getProgramParameter(program, _gl.LINK_STATUS) === false) {\r\n\r\n      THREE.error('THREE.WebGLProgram: shader error: ' + _gl.getError(), 'gl.VALIDATE_STATUS', _gl.getProgramParameter(program, _gl.VALIDATE_STATUS), 'gl.getPRogramInfoLog', programLogInfo);\r\n\r\n    }\r\n\r\n    if (programLogInfo !== '') {\r\n\r\n      THREE.warn('THREE.WebGLProgram: gl.getProgramInfoLog()' + programLogInfo);\r\n      // THREE.warn( _gl.getExtension( 'WEBGL_debug_shaders' ).getTranslatedShaderSource( glVertexShader ) );\r\n      // THREE.warn( _gl.getExtension( 'WEBGL_debug_shaders' ).getTranslatedShaderSource( glFragmentShader ) );\r\n\r\n    }\r\n\r\n    // clean up\r\n\r\n    _gl.deleteShader(glVertexShader);\r\n    _gl.deleteShader(glFragmentShader);\r\n\r\n    // cache uniform locations\r\n\r\n    var identifiers = [\r\n\r\n      'viewMatrix',\r\n      'modelViewMatrix',\r\n      'projectionMatrix',\r\n      'normalMatrix',\r\n      'modelMatrix',\r\n      'cameraPosition',\r\n      'morphTargetInfluences',\r\n      'bindMatrix',\r\n      'bindMatrixInverse'\r\n\r\n    ];\r\n\r\n    if (parameters.useVertexTexture) {\r\n\r\n      identifiers.push('boneTexture');\r\n      identifiers.push('boneTextureWidth');\r\n      identifiers.push('boneTextureHeight');\r\n\r\n    }\r\n    else {\r\n\r\n      identifiers.push('boneGlobalMatrices');\r\n\r\n    }\r\n\r\n    if (parameters.logarithmicDepthBuffer) {\r\n\r\n      identifiers.push('logDepthBufFC');\r\n\r\n    }\r\n\r\n\r\n    for (var u in uniforms) {\r\n\r\n      identifiers.push(u);\r\n\r\n    }\r\n\r\n    this.uniforms = cacheUniformLocations(_gl, program, identifiers);\r\n\r\n    // cache attributes locations\r\n\r\n    identifiers = [\r\n\r\n      'position',\r\n      'normal',\r\n      'uv',\r\n      'uv2',\r\n      'tangent',\r\n      'color',\r\n      'skinIndex',\r\n      'skinWeight',\r\n      'lineDistance'\r\n\r\n    ];\r\n\r\n    for (var i = 0; i < parameters.maxMorphTargets; i++) {\r\n\r\n      identifiers.push('morphTarget' + i);\r\n\r\n    }\r\n\r\n    for (var i = 0; i < parameters.maxMorphNormals; i++) {\r\n\r\n      identifiers.push('morphNormal' + i);\r\n\r\n    }\r\n\r\n    for (var a in attributes) {\r\n\r\n      identifiers.push(a);\r\n\r\n    }\r\n\r\n    this.attributes = cacheAttributeLocations(_gl, program, identifiers);\r\n    this.attributesKeys = Object.keys(this.attributes);\r\n\r\n    //\r\n\r\n    this.id = programIdCount++;\r\n    this.code = code;\r\n    this.usedTimes = 1;\r\n    this.program = program;\r\n    this.vertexShader = glVertexShader;\r\n    this.fragmentShader = glFragmentShader;\r\n\r\n    return this;\r\n\r\n  };\r\n\r\n})();\r\n\r\n// File:src/renderers/webgl/WebGLShader.js\r\n\r\nTHREE.WebGLShader = (function() {\r\n\r\n  var addLineNumbers = function(string) {\r\n\r\n    var lines = string.split('\\n');\r\n\r\n    for (var i = 0; i < lines.length; i++) {\r\n\r\n      lines[i] = (i + 1) + ': ' + lines[i];\r\n\r\n    }\r\n\r\n    return lines.join('\\n');\r\n\r\n  };\r\n\r\n  return function(gl, type, string) {\r\n\r\n    var shader = gl.createShader(type);\r\n\r\n    gl.shaderSource(shader, string);\r\n    gl.compileShader(shader);\r\n\r\n    if (gl.getShaderParameter(shader, gl.COMPILE_STATUS) === false) {\r\n\r\n      THREE.error('THREE.WebGLShader: Shader couldn\\'t compile.');\r\n\r\n    }\r\n\r\n    if (gl.getShaderInfoLog(shader) !== '') {\r\n\r\n      THREE.warn('THREE.WebGLShader: gl.getShaderInfoLog()', gl.getShaderInfoLog(shader), addLineNumbers(string));\r\n\r\n    }\r\n\r\n    // --enable-privileged-webgl-extension\r\n    // console.log( type, gl.getExtension( 'WEBGL_debug_shaders' ).getTranslatedShaderSource( shader ) );\r\n\r\n    return shader;\r\n\r\n  };\r\n\r\n})();\r\n\r\n// File:src/renderers/webgl/WebGLState.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.WebGLState = function(gl, paramThreeToGL) {\r\n\r\n  var newAttributes = new Uint8Array(16);\r\n  var enabledAttributes = new Uint8Array(16);\r\n\r\n  var currentBlending = null;\r\n  var currentBlendEquation = null;\r\n  var currentBlendSrc = null;\r\n  var currentBlendDst = null;\r\n  var currentBlendEquationAlpha = null;\r\n  var currentBlendSrcAlpha = null;\r\n  var currentBlendDstAlpha = null;\r\n\r\n  var currentDepthTest = null;\r\n  var currentDepthWrite = null;\r\n\r\n  var currentColorWrite = null;\r\n\r\n  var currentDoubleSided = null;\r\n  var currentFlipSided = null;\r\n\r\n  var currentLineWidth = null;\r\n\r\n  var currentPolygonOffset = null;\r\n  var currentPolygonOffsetFactor = null;\r\n  var currentPolygonOffsetUnits = null;\r\n\r\n  this.initAttributes = function() {\r\n\r\n    for (var i = 0, l = newAttributes.length; i < l; i++) {\r\n\r\n      newAttributes[i] = 0;\r\n\r\n    }\r\n\r\n  };\r\n\r\n  this.enableAttribute = function(attribute) {\r\n\r\n    newAttributes[attribute] = 1;\r\n\r\n    if (enabledAttributes[attribute] === 0) {\r\n\r\n      gl.enableVertexAttribArray(attribute);\r\n      enabledAttributes[attribute] = 1;\r\n\r\n    }\r\n\r\n  };\r\n\r\n  this.disableUnusedAttributes = function() {\r\n\r\n    for (var i = 0, l = enabledAttributes.length; i < l; i++) {\r\n\r\n      if (enabledAttributes[i] !== newAttributes[i]) {\r\n\r\n        gl.disableVertexAttribArray(i);\r\n        enabledAttributes[i] = 0;\r\n\r\n      }\r\n\r\n    }\r\n\r\n  };\r\n\r\n  this.setBlending = function(blending, blendEquation, blendSrc, blendDst, blendEquationAlpha, blendSrcAlpha, blendDstAlpha) {\r\n\r\n    if (blending !== currentBlending) {\r\n\r\n      if (blending === THREE.NoBlending) {\r\n\r\n        gl.disable(gl.BLEND);\r\n\r\n      }\r\n      else if (blending === THREE.AdditiveBlending) {\r\n\r\n        gl.enable(gl.BLEND);\r\n        gl.blendEquation(gl.FUNC_ADD);\r\n        gl.blendFunc(gl.SRC_ALPHA, gl.ONE);\r\n\r\n      }\r\n      else if (blending === THREE.SubtractiveBlending) {\r\n\r\n        // TODO: Find blendFuncSeparate() combination\r\n        gl.enable(gl.BLEND);\r\n        gl.blendEquation(gl.FUNC_ADD);\r\n        gl.blendFunc(gl.ZERO, gl.ONE_MINUS_SRC_COLOR);\r\n\r\n      }\r\n      else if (blending === THREE.MultiplyBlending) {\r\n\r\n        // TODO: Find blendFuncSeparate() combination\r\n        gl.enable(gl.BLEND);\r\n        gl.blendEquation(gl.FUNC_ADD);\r\n        gl.blendFunc(gl.ZERO, gl.SRC_COLOR);\r\n\r\n      }\r\n      else if (blending === THREE.CustomBlending) {\r\n\r\n        gl.enable(gl.BLEND);\r\n\r\n      }\r\n      else {\r\n\r\n        gl.enable(gl.BLEND);\r\n        gl.blendEquationSeparate(gl.FUNC_ADD, gl.FUNC_ADD);\r\n        gl.blendFuncSeparate(gl.SRC_ALPHA, gl.ONE_MINUS_SRC_ALPHA, gl.ONE, gl.ONE_MINUS_SRC_ALPHA);\r\n\r\n      }\r\n\r\n      currentBlending = blending;\r\n\r\n    }\r\n\r\n    if (blending === THREE.CustomBlending) {\r\n\r\n      blendEquationAlpha = blendEquationAlpha || blendEquation;\r\n      blendSrcAlpha = blendSrcAlpha || blendSrc;\r\n      blendDstAlpha = blendDstAlpha || blendDst;\r\n\r\n      if (blendEquation !== currentBlendEquation || blendEquationAlpha !== currentBlendEquationAlpha) {\r\n\r\n        gl.blendEquationSeparate(paramThreeToGL(blendEquation), paramThreeToGL(blendEquationAlpha));\r\n\r\n        currentBlendEquation = blendEquation;\r\n        currentBlendEquationAlpha = blendEquationAlpha;\r\n\r\n      }\r\n\r\n      if (blendSrc !== currentBlendSrc || blendDst !== currentBlendDst || blendSrcAlpha !== currentBlendSrcAlpha || blendDstAlpha !== currentBlendDstAlpha) {\r\n\r\n        gl.blendFuncSeparate(paramThreeToGL(blendSrc), paramThreeToGL(blendDst), paramThreeToGL(blendSrcAlpha), paramThreeToGL(blendDstAlpha));\r\n\r\n        currentBlendSrc = blendSrc;\r\n        currentBlendDst = blendDst;\r\n        currentBlendSrcAlpha = blendSrcAlpha;\r\n        currentBlendDstAlpha = blendDstAlpha;\r\n\r\n      }\r\n\r\n    }\r\n    else {\r\n\r\n      currentBlendEquation = null;\r\n      currentBlendSrc = null;\r\n      currentBlendDst = null;\r\n      currentBlendEquationAlpha = null;\r\n      currentBlendSrcAlpha = null;\r\n      currentBlendDstAlpha = null;\r\n\r\n    }\r\n\r\n  };\r\n\r\n  this.setDepthTest = function(depthTest) {\r\n\r\n    if (currentDepthTest !== depthTest) {\r\n\r\n      if (depthTest) {\r\n\r\n        gl.enable(gl.DEPTH_TEST);\r\n\r\n      }\r\n      else {\r\n\r\n        gl.disable(gl.DEPTH_TEST);\r\n\r\n      }\r\n\r\n      currentDepthTest = depthTest;\r\n\r\n    }\r\n\r\n  };\r\n\r\n  this.setDepthWrite = function(depthWrite) {\r\n\r\n    if (currentDepthWrite !== depthWrite) {\r\n\r\n      gl.depthMask(depthWrite);\r\n      currentDepthWrite = depthWrite;\r\n\r\n    }\r\n\r\n  };\r\n\r\n  this.setColorWrite = function(colorWrite) {\r\n\r\n    if (currentColorWrite !== colorWrite) {\r\n\r\n      gl.colorMask(colorWrite, colorWrite, colorWrite, colorWrite);\r\n      currentColorWrite = colorWrite;\r\n\r\n    }\r\n\r\n  };\r\n\r\n  this.setDoubleSided = function(doubleSided) {\r\n\r\n    if (currentDoubleSided !== doubleSided) {\r\n\r\n      if (doubleSided) {\r\n\r\n        gl.disable(gl.CULL_FACE);\r\n\r\n      }\r\n      else {\r\n\r\n        gl.enable(gl.CULL_FACE);\r\n\r\n      }\r\n\r\n      currentDoubleSided = doubleSided;\r\n\r\n    }\r\n\r\n  };\r\n\r\n  this.setFlipSided = function(flipSided) {\r\n\r\n    if (currentFlipSided !== flipSided) {\r\n\r\n      if (flipSided) {\r\n\r\n        gl.frontFace(gl.CW);\r\n\r\n      }\r\n      else {\r\n\r\n        gl.frontFace(gl.CCW);\r\n\r\n      }\r\n\r\n      currentFlipSided = flipSided;\r\n\r\n    }\r\n\r\n  };\r\n\r\n  this.setLineWidth = function(width) {\r\n\r\n    if (width !== currentLineWidth) {\r\n\r\n      gl.lineWidth(width);\r\n\r\n      currentLineWidth = width;\r\n\r\n    }\r\n\r\n  };\r\n\r\n  this.setPolygonOffset = function(polygonoffset, factor, units) {\r\n\r\n    if (currentPolygonOffset !== polygonoffset) {\r\n\r\n      if (polygonoffset) {\r\n\r\n        gl.enable(gl.POLYGON_OFFSET_FILL);\r\n\r\n      }\r\n      else {\r\n\r\n        gl.disable(gl.POLYGON_OFFSET_FILL);\r\n\r\n      }\r\n\r\n      currentPolygonOffset = polygonoffset;\r\n\r\n    }\r\n\r\n    if (polygonoffset && (currentPolygonOffsetFactor !== factor || currentPolygonOffsetUnits !== units)) {\r\n\r\n      gl.polygonOffset(factor, units);\r\n\r\n      currentPolygonOffsetFactor = factor;\r\n      currentPolygonOffsetUnits = units;\r\n\r\n    }\r\n\r\n  };\r\n\r\n  this.reset = function() {\r\n\r\n    for (var i = 0; i < enabledAttributes.length; i++) {\r\n\r\n      enabledAttributes[i] = 0;\r\n\r\n    }\r\n\r\n    currentBlending = null;\r\n    currentDepthTest = null;\r\n    currentDepthWrite = null;\r\n    currentColorWrite = null;\r\n    currentDoubleSided = null;\r\n    currentFlipSided = null;\r\n\r\n  };\r\n\r\n};\r\n\r\n// File:src/renderers/webgl/plugins/LensFlarePlugin.js\r\n\r\n/**\r\n * @author mikael emtinger / http://gomo.se/\r\n * @author alteredq / http://alteredqualia.com/\r\n */\r\n\r\nTHREE.LensFlarePlugin = function(renderer, flares) {\r\n\r\n  var gl = renderer.context;\r\n\r\n  var vertexBuffer, elementBuffer;\r\n  var program, attributes, uniforms;\r\n  var hasVertexTexture;\r\n\r\n  var tempTexture, occlusionTexture;\r\n\r\n  var init = function() {\r\n\r\n    var vertices = new Float32Array([-1, -1, 0, 0,\r\n      1, -1, 1, 0,\r\n      1, 1, 1, 1, -1, 1, 0, 1\r\n    ]);\r\n\r\n    var faces = new Uint16Array([\r\n      0, 1, 2,\r\n      0, 2, 3\r\n    ]);\r\n\r\n    // buffers\r\n\r\n    vertexBuffer = gl.createBuffer();\r\n    elementBuffer = gl.createBuffer();\r\n\r\n    gl.bindBuffer(gl.ARRAY_BUFFER, vertexBuffer);\r\n    gl.bufferData(gl.ARRAY_BUFFER, vertices, gl.STATIC_DRAW);\r\n\r\n    gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, elementBuffer);\r\n    gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, faces, gl.STATIC_DRAW);\r\n\r\n    // textures\r\n\r\n    tempTexture = gl.createTexture();\r\n    occlusionTexture = gl.createTexture();\r\n\r\n    gl.bindTexture(gl.TEXTURE_2D, tempTexture);\r\n    gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGB, 16, 16, 0, gl.RGB, gl.UNSIGNED_BYTE, null);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);\r\n\r\n    gl.bindTexture(gl.TEXTURE_2D, occlusionTexture);\r\n    gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, 16, 16, 0, gl.RGBA, gl.UNSIGNED_BYTE, null);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);\r\n\r\n    hasVertexTexture = gl.getParameter(gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS) > 0;\r\n\r\n    var shader;\r\n\r\n    if (hasVertexTexture) {\r\n\r\n      shader = {\r\n\r\n        vertexShader: [\r\n\r\n          \"uniform lowp int renderType;\",\r\n\r\n          \"uniform vec3 screenPosition;\",\r\n          \"uniform vec2 scale;\",\r\n          \"uniform float rotation;\",\r\n\r\n          \"uniform sampler2D occlusionMap;\",\r\n\r\n          \"attribute vec2 position;\",\r\n          \"attribute vec2 uv;\",\r\n\r\n          \"varying vec2 vUV;\",\r\n          \"varying float vVisibility;\",\r\n\r\n          \"void main() {\",\r\n\r\n          \"vUV = uv;\",\r\n\r\n          \"vec2 pos = position;\",\r\n\r\n          \"if( renderType == 2 ) {\",\r\n\r\n          \"vec4 visibility = texture2D( occlusionMap, vec2( 0.1, 0.1 ) );\",\r\n          \"visibility += texture2D( occlusionMap, vec2( 0.5, 0.1 ) );\",\r\n          \"visibility += texture2D( occlusionMap, vec2( 0.9, 0.1 ) );\",\r\n          \"visibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) );\",\r\n          \"visibility += texture2D( occlusionMap, vec2( 0.9, 0.9 ) );\",\r\n          \"visibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) );\",\r\n          \"visibility += texture2D( occlusionMap, vec2( 0.1, 0.9 ) );\",\r\n          \"visibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) );\",\r\n          \"visibility += texture2D( occlusionMap, vec2( 0.5, 0.5 ) );\",\r\n\r\n          \"vVisibility =        visibility.r / 9.0;\",\r\n          \"vVisibility *= 1.0 - visibility.g / 9.0;\",\r\n          \"vVisibility *=       visibility.b / 9.0;\",\r\n          \"vVisibility *= 1.0 - visibility.a / 9.0;\",\r\n\r\n          \"pos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;\",\r\n          \"pos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;\",\r\n\r\n          \"}\",\r\n\r\n          \"gl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );\",\r\n\r\n          \"}\"\r\n\r\n        ].join(\"\\n\"),\r\n\r\n        fragmentShader: [\r\n\r\n          \"uniform lowp int renderType;\",\r\n\r\n          \"uniform sampler2D map;\",\r\n          \"uniform float opacity;\",\r\n          \"uniform vec3 color;\",\r\n\r\n          \"varying vec2 vUV;\",\r\n          \"varying float vVisibility;\",\r\n\r\n          \"void main() {\",\r\n\r\n          // pink square\r\n\r\n          \"if( renderType == 0 ) {\",\r\n\r\n          \"gl_FragColor = vec4( 1.0, 0.0, 1.0, 0.0 );\",\r\n\r\n          // restore\r\n\r\n          \"} else if( renderType == 1 ) {\",\r\n\r\n          \"gl_FragColor = texture2D( map, vUV );\",\r\n\r\n          // flare\r\n\r\n          \"} else {\",\r\n\r\n          \"vec4 texture = texture2D( map, vUV );\",\r\n          \"texture.a *= opacity * vVisibility;\",\r\n          \"gl_FragColor = texture;\",\r\n          \"gl_FragColor.rgb *= color;\",\r\n\r\n          \"}\",\r\n\r\n          \"}\"\r\n\r\n        ].join(\"\\n\")\r\n\r\n      };\r\n\r\n    }\r\n    else {\r\n\r\n      shader = {\r\n\r\n        vertexShader: [\r\n\r\n          \"uniform lowp int renderType;\",\r\n\r\n          \"uniform vec3 screenPosition;\",\r\n          \"uniform vec2 scale;\",\r\n          \"uniform float rotation;\",\r\n\r\n          \"attribute vec2 position;\",\r\n          \"attribute vec2 uv;\",\r\n\r\n          \"varying vec2 vUV;\",\r\n\r\n          \"void main() {\",\r\n\r\n          \"vUV = uv;\",\r\n\r\n          \"vec2 pos = position;\",\r\n\r\n          \"if( renderType == 2 ) {\",\r\n\r\n          \"pos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;\",\r\n          \"pos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;\",\r\n\r\n          \"}\",\r\n\r\n          \"gl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );\",\r\n\r\n          \"}\"\r\n\r\n        ].join(\"\\n\"),\r\n\r\n        fragmentShader: [\r\n\r\n          \"precision mediump float;\",\r\n\r\n          \"uniform lowp int renderType;\",\r\n\r\n          \"uniform sampler2D map;\",\r\n          \"uniform sampler2D occlusionMap;\",\r\n          \"uniform float opacity;\",\r\n          \"uniform vec3 color;\",\r\n\r\n          \"varying vec2 vUV;\",\r\n\r\n          \"void main() {\",\r\n\r\n          // pink square\r\n\r\n          \"if( renderType == 0 ) {\",\r\n\r\n          \"gl_FragColor = vec4( texture2D( map, vUV ).rgb, 0.0 );\",\r\n\r\n          // restore\r\n\r\n          \"} else if( renderType == 1 ) {\",\r\n\r\n          \"gl_FragColor = texture2D( map, vUV );\",\r\n\r\n          // flare\r\n\r\n          \"} else {\",\r\n\r\n          \"float visibility = texture2D( occlusionMap, vec2( 0.5, 0.1 ) ).a;\",\r\n          \"visibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) ).a;\",\r\n          \"visibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) ).a;\",\r\n          \"visibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) ).a;\",\r\n          \"visibility = ( 1.0 - visibility / 4.0 );\",\r\n\r\n          \"vec4 texture = texture2D( map, vUV );\",\r\n          \"texture.a *= opacity * visibility;\",\r\n          \"gl_FragColor = texture;\",\r\n          \"gl_FragColor.rgb *= color;\",\r\n\r\n          \"}\",\r\n\r\n          \"}\"\r\n\r\n        ].join(\"\\n\")\r\n\r\n      };\r\n\r\n    }\r\n\r\n    program = createProgram(shader);\r\n\r\n    attributes = {\r\n      vertex: gl.getAttribLocation(program, \"position\"),\r\n      uv: gl.getAttribLocation(program, \"uv\")\r\n    }\r\n\r\n    uniforms = {\r\n      renderType: gl.getUniformLocation(program, \"renderType\"),\r\n      map: gl.getUniformLocation(program, \"map\"),\r\n      occlusionMap: gl.getUniformLocation(program, \"occlusionMap\"),\r\n      opacity: gl.getUniformLocation(program, \"opacity\"),\r\n      color: gl.getUniformLocation(program, \"color\"),\r\n      scale: gl.getUniformLocation(program, \"scale\"),\r\n      rotation: gl.getUniformLocation(program, \"rotation\"),\r\n      screenPosition: gl.getUniformLocation(program, \"screenPosition\")\r\n    };\r\n\r\n  };\r\n\r\n  /*\r\n   * Render lens flares\r\n   * Method: renders 16x16 0xff00ff-colored points scattered over the light source area,\r\n   *         reads these back and calculates occlusion.\r\n   */\r\n\r\n  this.render = function(scene, camera, viewportWidth, viewportHeight) {\r\n\r\n    if (flares.length === 0) return;\r\n\r\n    var tempPosition = new THREE.Vector3();\r\n\r\n    var invAspect = viewportHeight / viewportWidth,\r\n      halfViewportWidth = viewportWidth * 0.5,\r\n      halfViewportHeight = viewportHeight * 0.5;\r\n\r\n    var size = 16 / viewportHeight,\r\n      scale = new THREE.Vector2(size * invAspect, size);\r\n\r\n    var screenPosition = new THREE.Vector3(1, 1, 0),\r\n      screenPositionPixels = new THREE.Vector2(1, 1);\r\n\r\n    if (program === undefined) {\r\n\r\n      init();\r\n\r\n    }\r\n\r\n    gl.useProgram(program);\r\n\r\n    gl.enableVertexAttribArray(attributes.vertex);\r\n    gl.enableVertexAttribArray(attributes.uv);\r\n\r\n    // loop through all lens flares to update their occlusion and positions\r\n    // setup gl and common used attribs/unforms\r\n\r\n    gl.uniform1i(uniforms.occlusionMap, 0);\r\n    gl.uniform1i(uniforms.map, 1);\r\n\r\n    gl.bindBuffer(gl.ARRAY_BUFFER, vertexBuffer);\r\n    gl.vertexAttribPointer(attributes.vertex, 2, gl.FLOAT, false, 2 * 8, 0);\r\n    gl.vertexAttribPointer(attributes.uv, 2, gl.FLOAT, false, 2 * 8, 8);\r\n\r\n    gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, elementBuffer);\r\n\r\n    gl.disable(gl.CULL_FACE);\r\n    gl.depthMask(false);\r\n\r\n    for (var i = 0, l = flares.length; i < l; i++) {\r\n\r\n      size = 16 / viewportHeight;\r\n      scale.set(size * invAspect, size);\r\n\r\n      // calc object screen position\r\n\r\n      var flare = flares[i];\r\n\r\n      tempPosition.set(flare.matrixWorld.elements[12], flare.matrixWorld.elements[13], flare.matrixWorld.elements[14]);\r\n\r\n      tempPosition.applyMatrix4(camera.matrixWorldInverse);\r\n      tempPosition.applyProjection(camera.projectionMatrix);\r\n\r\n      // setup arrays for gl programs\r\n\r\n      screenPosition.copy(tempPosition)\r\n\r\n      screenPositionPixels.x = screenPosition.x * halfViewportWidth + halfViewportWidth;\r\n      screenPositionPixels.y = screenPosition.y * halfViewportHeight + halfViewportHeight;\r\n\r\n      // screen cull\r\n\r\n      if (hasVertexTexture || (\r\n          screenPositionPixels.x > 0 &&\r\n          screenPositionPixels.x < viewportWidth &&\r\n          screenPositionPixels.y > 0 &&\r\n          screenPositionPixels.y < viewportHeight)) {\r\n\r\n        // save current RGB to temp texture\r\n\r\n        gl.activeTexture(gl.TEXTURE1);\r\n        gl.bindTexture(gl.TEXTURE_2D, tempTexture);\r\n        gl.copyTexImage2D(gl.TEXTURE_2D, 0, gl.RGB, screenPositionPixels.x - 8, screenPositionPixels.y - 8, 16, 16, 0);\r\n\r\n\r\n        // render pink quad\r\n\r\n        gl.uniform1i(uniforms.renderType, 0);\r\n        gl.uniform2f(uniforms.scale, scale.x, scale.y);\r\n        gl.uniform3f(uniforms.screenPosition, screenPosition.x, screenPosition.y, screenPosition.z);\r\n\r\n        gl.disable(gl.BLEND);\r\n        gl.enable(gl.DEPTH_TEST);\r\n\r\n        gl.drawElements(gl.TRIANGLES, 6, gl.UNSIGNED_SHORT, 0);\r\n\r\n\r\n        // copy result to occlusionMap\r\n\r\n        gl.activeTexture(gl.TEXTURE0);\r\n        gl.bindTexture(gl.TEXTURE_2D, occlusionTexture);\r\n        gl.copyTexImage2D(gl.TEXTURE_2D, 0, gl.RGBA, screenPositionPixels.x - 8, screenPositionPixels.y - 8, 16, 16, 0);\r\n\r\n\r\n        // restore graphics\r\n\r\n        gl.uniform1i(uniforms.renderType, 1);\r\n        gl.disable(gl.DEPTH_TEST);\r\n\r\n        gl.activeTexture(gl.TEXTURE1);\r\n        gl.bindTexture(gl.TEXTURE_2D, tempTexture);\r\n        gl.drawElements(gl.TRIANGLES, 6, gl.UNSIGNED_SHORT, 0);\r\n\r\n\r\n        // update object positions\r\n\r\n        flare.positionScreen.copy(screenPosition)\r\n\r\n        if (flare.customUpdateCallback) {\r\n\r\n          flare.customUpdateCallback(flare);\r\n\r\n        }\r\n        else {\r\n\r\n          flare.updateLensFlares();\r\n\r\n        }\r\n\r\n        // render flares\r\n\r\n        gl.uniform1i(uniforms.renderType, 2);\r\n        gl.enable(gl.BLEND);\r\n\r\n        for (var j = 0, jl = flare.lensFlares.length; j < jl; j++) {\r\n\r\n          var sprite = flare.lensFlares[j];\r\n\r\n          if (sprite.opacity > 0.001 && sprite.scale > 0.001) {\r\n\r\n            screenPosition.x = sprite.x;\r\n            screenPosition.y = sprite.y;\r\n            screenPosition.z = sprite.z;\r\n\r\n            size = sprite.size * sprite.scale / viewportHeight;\r\n\r\n            scale.x = size * invAspect;\r\n            scale.y = size;\r\n\r\n            gl.uniform3f(uniforms.screenPosition, screenPosition.x, screenPosition.y, screenPosition.z);\r\n            gl.uniform2f(uniforms.scale, scale.x, scale.y);\r\n            gl.uniform1f(uniforms.rotation, sprite.rotation);\r\n\r\n            gl.uniform1f(uniforms.opacity, sprite.opacity);\r\n            gl.uniform3f(uniforms.color, sprite.color.r, sprite.color.g, sprite.color.b);\r\n\r\n            renderer.state.setBlending(sprite.blending, sprite.blendEquation, sprite.blendSrc, sprite.blendDst);\r\n            renderer.setTexture(sprite.texture, 1);\r\n\r\n            gl.drawElements(gl.TRIANGLES, 6, gl.UNSIGNED_SHORT, 0);\r\n\r\n          }\r\n\r\n        }\r\n\r\n      }\r\n\r\n    }\r\n\r\n    // restore gl\r\n\r\n    gl.enable(gl.CULL_FACE);\r\n    gl.enable(gl.DEPTH_TEST);\r\n    gl.depthMask(true);\r\n\r\n    renderer.resetGLState();\r\n\r\n  };\r\n\r\n  function createProgram(shader) {\r\n\r\n    var program = gl.createProgram();\r\n\r\n    var fragmentShader = gl.createShader(gl.FRAGMENT_SHADER);\r\n    var vertexShader = gl.createShader(gl.VERTEX_SHADER);\r\n\r\n    var prefix = \"precision \" + renderer.getPrecision() + \" float;\\n\";\r\n\r\n    gl.shaderSource(fragmentShader, prefix + shader.fragmentShader);\r\n    gl.shaderSource(vertexShader, prefix + shader.vertexShader);\r\n\r\n    gl.compileShader(fragmentShader);\r\n    gl.compileShader(vertexShader);\r\n\r\n    gl.attachShader(program, fragmentShader);\r\n    gl.attachShader(program, vertexShader);\r\n\r\n    gl.linkProgram(program);\r\n\r\n    return program;\r\n\r\n  }\r\n\r\n};\r\n\r\n// File:src/renderers/webgl/plugins/ShadowMapPlugin.js\r\n\r\n/**\r\n * @author alteredq / http://alteredqualia.com/\r\n */\r\n\r\nTHREE.ShadowMapPlugin = function(_renderer, _lights, _webglObjects, _webglObjectsImmediate) {\r\n\r\n  var _gl = _renderer.context;\r\n\r\n  var _depthMaterial, _depthMaterialMorph, _depthMaterialSkin, _depthMaterialMorphSkin,\r\n\r\n    _frustum = new THREE.Frustum(),\r\n    _projScreenMatrix = new THREE.Matrix4(),\r\n\r\n    _min = new THREE.Vector3(),\r\n    _max = new THREE.Vector3(),\r\n\r\n    _matrixPosition = new THREE.Vector3(),\r\n\r\n    _renderList = [];\r\n\r\n  // init\r\n\r\n  var depthShader = THREE.ShaderLib[\"depthRGBA\"];\r\n  var depthUniforms = THREE.UniformsUtils.clone(depthShader.uniforms);\r\n\r\n  _depthMaterial = new THREE.ShaderMaterial({\r\n    uniforms: depthUniforms,\r\n    vertexShader: depthShader.vertexShader,\r\n    fragmentShader: depthShader.fragmentShader\r\n  });\r\n\r\n  _depthMaterialMorph = new THREE.ShaderMaterial({\r\n    uniforms: depthUniforms,\r\n    vertexShader: depthShader.vertexShader,\r\n    fragmentShader: depthShader.fragmentShader,\r\n    morphTargets: true\r\n  });\r\n\r\n  _depthMaterialSkin = new THREE.ShaderMaterial({\r\n    uniforms: depthUniforms,\r\n    vertexShader: depthShader.vertexShader,\r\n    fragmentShader: depthShader.fragmentShader,\r\n    skinning: true\r\n  });\r\n\r\n  _depthMaterialMorphSkin = new THREE.ShaderMaterial({\r\n    uniforms: depthUniforms,\r\n    vertexShader: depthShader.vertexShader,\r\n    fragmentShader: depthShader.fragmentShader,\r\n    morphTargets: true,\r\n    skinning: true\r\n  });\r\n\r\n  _depthMaterial._shadowPass = true;\r\n  _depthMaterialMorph._shadowPass = true;\r\n  _depthMaterialSkin._shadowPass = true;\r\n  _depthMaterialMorphSkin._shadowPass = true;\r\n\r\n  this.render = function(scene, camera) {\r\n\r\n    if (_renderer.shadowMapEnabled === false) return;\r\n\r\n    var i, il, j, jl, n,\r\n\r\n      shadowMap, shadowMatrix, shadowCamera,\r\n      buffer, material,\r\n      webglObject, object, light,\r\n\r\n      lights = [],\r\n      k = 0,\r\n\r\n      fog = null;\r\n\r\n    // set GL state for depth map\r\n\r\n    _gl.clearColor(1, 1, 1, 1);\r\n    _gl.disable(_gl.BLEND);\r\n\r\n    _gl.enable(_gl.CULL_FACE);\r\n    _gl.frontFace(_gl.CCW);\r\n\r\n    if (_renderer.shadowMapCullFace === THREE.CullFaceFront) {\r\n\r\n      _gl.cullFace(_gl.FRONT);\r\n\r\n    }\r\n    else {\r\n\r\n      _gl.cullFace(_gl.BACK);\r\n\r\n    }\r\n\r\n    _renderer.state.setDepthTest(true);\r\n\r\n    // preprocess lights\r\n    // \t- skip lights that are not casting shadows\r\n    //\t- create virtual lights for cascaded shadow maps\r\n\r\n    for (i = 0, il = _lights.length; i < il; i++) {\r\n\r\n      light = _lights[i];\r\n\r\n      if (!light.castShadow) continue;\r\n\r\n      if ((light instanceof THREE.DirectionalLight) && light.shadowCascade) {\r\n\r\n        for (n = 0; n < light.shadowCascadeCount; n++) {\r\n\r\n          var virtualLight;\r\n\r\n          if (!light.shadowCascadeArray[n]) {\r\n\r\n            virtualLight = createVirtualLight(light, n);\r\n            virtualLight.originalCamera = camera;\r\n\r\n            var gyro = new THREE.Gyroscope();\r\n            gyro.position.copy(light.shadowCascadeOffset);\r\n\r\n            gyro.add(virtualLight);\r\n            gyro.add(virtualLight.target);\r\n\r\n            camera.add(gyro);\r\n\r\n            light.shadowCascadeArray[n] = virtualLight;\r\n\r\n            //console.log( \"Created virtualLight\", virtualLight );\r\n\r\n          }\r\n          else {\r\n\r\n            virtualLight = light.shadowCascadeArray[n];\r\n\r\n          }\r\n\r\n          updateVirtualLight(light, n);\r\n\r\n          lights[k] = virtualLight;\r\n          k++;\r\n\r\n        }\r\n\r\n      }\r\n      else {\r\n\r\n        lights[k] = light;\r\n        k++;\r\n\r\n      }\r\n\r\n    }\r\n\r\n    // render depth map\r\n\r\n    for (i = 0, il = lights.length; i < il; i++) {\r\n\r\n      light = lights[i];\r\n\r\n      if (!light.shadowMap) {\r\n\r\n        var shadowFilter = THREE.LinearFilter;\r\n\r\n        if (_renderer.shadowMapType === THREE.PCFSoftShadowMap) {\r\n\r\n          shadowFilter = THREE.NearestFilter;\r\n\r\n        }\r\n\r\n        var pars = {\r\n          minFilter: shadowFilter,\r\n          magFilter: shadowFilter,\r\n          format: THREE.RGBAFormat\r\n        };\r\n\r\n        light.shadowMap = new THREE.WebGLRenderTarget(light.shadowMapWidth, light.shadowMapHeight, pars);\r\n        light.shadowMapSize = new THREE.Vector2(light.shadowMapWidth, light.shadowMapHeight);\r\n\r\n        light.shadowMatrix = new THREE.Matrix4();\r\n\r\n      }\r\n\r\n      if (!light.shadowCamera) {\r\n\r\n        if (light instanceof THREE.SpotLight) {\r\n\r\n          light.shadowCamera = new THREE.PerspectiveCamera(light.shadowCameraFov, light.shadowMapWidth / light.shadowMapHeight, light.shadowCameraNear, light.shadowCameraFar);\r\n\r\n        }\r\n        else if (light instanceof THREE.DirectionalLight) {\r\n\r\n          light.shadowCamera = new THREE.OrthographicCamera(light.shadowCameraLeft, light.shadowCameraRight, light.shadowCameraTop, light.shadowCameraBottom, light.shadowCameraNear, light.shadowCameraFar);\r\n\r\n        }\r\n        else {\r\n\r\n          THREE.error(\"THREE.ShadowMapPlugin: Unsupported light type for shadow\", light);\r\n          continue;\r\n\r\n        }\r\n\r\n        scene.add(light.shadowCamera);\r\n\r\n        if (scene.autoUpdate === true) scene.updateMatrixWorld();\r\n\r\n      }\r\n\r\n      if (light.shadowCameraVisible && !light.cameraHelper) {\r\n\r\n        light.cameraHelper = new THREE.CameraHelper(light.shadowCamera);\r\n        scene.add(light.cameraHelper);\r\n\r\n      }\r\n\r\n      if (light.isVirtual && virtualLight.originalCamera == camera) {\r\n\r\n        updateShadowCamera(camera, light);\r\n\r\n      }\r\n\r\n      shadowMap = light.shadowMap;\r\n      shadowMatrix = light.shadowMatrix;\r\n      shadowCamera = light.shadowCamera;\r\n\r\n      //\r\n\r\n      shadowCamera.position.setFromMatrixPosition(light.matrixWorld);\r\n      _matrixPosition.setFromMatrixPosition(light.target.matrixWorld);\r\n      shadowCamera.lookAt(_matrixPosition);\r\n      shadowCamera.updateMatrixWorld();\r\n\r\n      shadowCamera.matrixWorldInverse.getInverse(shadowCamera.matrixWorld);\r\n\r\n      //\r\n\r\n      if (light.cameraHelper) light.cameraHelper.visible = light.shadowCameraVisible;\r\n      if (light.shadowCameraVisible) light.cameraHelper.update();\r\n\r\n      // compute shadow matrix\r\n\r\n      shadowMatrix.set(\r\n        0.5, 0.0, 0.0, 0.5,\r\n        0.0, 0.5, 0.0, 0.5,\r\n        0.0, 0.0, 0.5, 0.5,\r\n        0.0, 0.0, 0.0, 1.0\r\n      );\r\n\r\n      shadowMatrix.multiply(shadowCamera.projectionMatrix);\r\n      shadowMatrix.multiply(shadowCamera.matrixWorldInverse);\r\n\r\n      // update camera matrices and frustum\r\n\r\n      _projScreenMatrix.multiplyMatrices(shadowCamera.projectionMatrix, shadowCamera.matrixWorldInverse);\r\n      _frustum.setFromMatrix(_projScreenMatrix);\r\n\r\n      // render shadow map\r\n\r\n      _renderer.setRenderTarget(shadowMap);\r\n      _renderer.clear();\r\n\r\n      // set object matrices & frustum culling\r\n\r\n      _renderList.length = 0;\r\n\r\n      projectObject(scene, scene, shadowCamera);\r\n\r\n\r\n      // render regular objects\r\n\r\n      var objectMaterial, useMorphing, useSkinning;\r\n\r\n      for (j = 0, jl = _renderList.length; j < jl; j++) {\r\n\r\n        webglObject = _renderList[j];\r\n\r\n        object = webglObject.object;\r\n        buffer = webglObject.buffer;\r\n\r\n        // culling is overriden globally for all objects\r\n        // while rendering depth map\r\n\r\n        // need to deal with MeshFaceMaterial somehow\r\n        // in that case just use the first of material.materials for now\r\n        // (proper solution would require to break objects by materials\r\n        //  similarly to regular rendering and then set corresponding\r\n        //  depth materials per each chunk instead of just once per object)\r\n\r\n        objectMaterial = getObjectMaterial(object);\r\n\r\n        useMorphing = object.geometry.morphTargets !== undefined && object.geometry.morphTargets.length > 0 && objectMaterial.morphTargets;\r\n        useSkinning = object instanceof THREE.SkinnedMesh && objectMaterial.skinning;\r\n\r\n        if (object.customDepthMaterial) {\r\n\r\n          material = object.customDepthMaterial;\r\n\r\n        }\r\n        else if (useSkinning) {\r\n\r\n          material = useMorphing ? _depthMaterialMorphSkin : _depthMaterialSkin;\r\n\r\n        }\r\n        else if (useMorphing) {\r\n\r\n          material = _depthMaterialMorph;\r\n\r\n        }\r\n        else {\r\n\r\n          material = _depthMaterial;\r\n\r\n        }\r\n\r\n        _renderer.setMaterialFaces(objectMaterial);\r\n\r\n        if (buffer instanceof THREE.BufferGeometry) {\r\n\r\n          _renderer.renderBufferDirect(shadowCamera, _lights, fog, material, buffer, object);\r\n\r\n        }\r\n        else {\r\n\r\n          _renderer.renderBuffer(shadowCamera, _lights, fog, material, buffer, object);\r\n\r\n        }\r\n\r\n      }\r\n\r\n      // set matrices and render immediate objects\r\n\r\n      for (j = 0, jl = _webglObjectsImmediate.length; j < jl; j++) {\r\n\r\n        webglObject = _webglObjectsImmediate[j];\r\n        object = webglObject.object;\r\n\r\n        if (object.visible && object.castShadow) {\r\n\r\n          object._modelViewMatrix.multiplyMatrices(shadowCamera.matrixWorldInverse, object.matrixWorld);\r\n\r\n          _renderer.renderImmediateObject(shadowCamera, _lights, fog, _depthMaterial, object);\r\n\r\n        }\r\n\r\n      }\r\n\r\n    }\r\n\r\n    // restore GL state\r\n\r\n    var clearColor = _renderer.getClearColor(),\r\n      clearAlpha = _renderer.getClearAlpha();\r\n\r\n    _gl.clearColor(clearColor.r, clearColor.g, clearColor.b, clearAlpha);\r\n    _gl.enable(_gl.BLEND);\r\n\r\n    if (_renderer.shadowMapCullFace === THREE.CullFaceFront) {\r\n\r\n      _gl.cullFace(_gl.BACK);\r\n\r\n    }\r\n\r\n    _renderer.resetGLState();\r\n\r\n  };\r\n\r\n  function projectObject(scene, object, shadowCamera) {\r\n\r\n    if (object.visible) {\r\n\r\n      var webglObjects = _webglObjects[object.id];\r\n\r\n      if (webglObjects && object.castShadow && (object.frustumCulled === false || _frustum.intersectsObject(object) === true)) {\r\n\r\n        for (var i = 0, l = webglObjects.length; i < l; i++) {\r\n\r\n          var webglObject = webglObjects[i];\r\n\r\n          object._modelViewMatrix.multiplyMatrices(shadowCamera.matrixWorldInverse, object.matrixWorld);\r\n          _renderList.push(webglObject);\r\n\r\n        }\r\n\r\n      }\r\n\r\n      for (var i = 0, l = object.children.length; i < l; i++) {\r\n\r\n        projectObject(scene, object.children[i], shadowCamera);\r\n\r\n      }\r\n\r\n    }\r\n\r\n  }\r\n\r\n  function createVirtualLight(light, cascade) {\r\n\r\n    var virtualLight = new THREE.DirectionalLight();\r\n\r\n    virtualLight.isVirtual = true;\r\n\r\n    virtualLight.onlyShadow = true;\r\n    virtualLight.castShadow = true;\r\n\r\n    virtualLight.shadowCameraNear = light.shadowCameraNear;\r\n    virtualLight.shadowCameraFar = light.shadowCameraFar;\r\n\r\n    virtualLight.shadowCameraLeft = light.shadowCameraLeft;\r\n    virtualLight.shadowCameraRight = light.shadowCameraRight;\r\n    virtualLight.shadowCameraBottom = light.shadowCameraBottom;\r\n    virtualLight.shadowCameraTop = light.shadowCameraTop;\r\n\r\n    virtualLight.shadowCameraVisible = light.shadowCameraVisible;\r\n\r\n    virtualLight.shadowDarkness = light.shadowDarkness;\r\n\r\n    virtualLight.shadowBias = light.shadowCascadeBias[cascade];\r\n    virtualLight.shadowMapWidth = light.shadowCascadeWidth[cascade];\r\n    virtualLight.shadowMapHeight = light.shadowCascadeHeight[cascade];\r\n\r\n    virtualLight.pointsWorld = [];\r\n    virtualLight.pointsFrustum = [];\r\n\r\n    var pointsWorld = virtualLight.pointsWorld,\r\n      pointsFrustum = virtualLight.pointsFrustum;\r\n\r\n    for (var i = 0; i < 8; i++) {\r\n\r\n      pointsWorld[i] = new THREE.Vector3();\r\n      pointsFrustum[i] = new THREE.Vector3();\r\n\r\n    }\r\n\r\n    var nearZ = light.shadowCascadeNearZ[cascade];\r\n    var farZ = light.shadowCascadeFarZ[cascade];\r\n\r\n    pointsFrustum[0].set(-1, -1, nearZ);\r\n    pointsFrustum[1].set(1, -1, nearZ);\r\n    pointsFrustum[2].set(-1, 1, nearZ);\r\n    pointsFrustum[3].set(1, 1, nearZ);\r\n\r\n    pointsFrustum[4].set(-1, -1, farZ);\r\n    pointsFrustum[5].set(1, -1, farZ);\r\n    pointsFrustum[6].set(-1, 1, farZ);\r\n    pointsFrustum[7].set(1, 1, farZ);\r\n\r\n    return virtualLight;\r\n\r\n  }\r\n\r\n  // Synchronize virtual light with the original light\r\n\r\n  function updateVirtualLight(light, cascade) {\r\n\r\n    var virtualLight = light.shadowCascadeArray[cascade];\r\n\r\n    virtualLight.position.copy(light.position);\r\n    virtualLight.target.position.copy(light.target.position);\r\n    virtualLight.lookAt(virtualLight.target);\r\n\r\n    virtualLight.shadowCameraVisible = light.shadowCameraVisible;\r\n    virtualLight.shadowDarkness = light.shadowDarkness;\r\n\r\n    virtualLight.shadowBias = light.shadowCascadeBias[cascade];\r\n\r\n    var nearZ = light.shadowCascadeNearZ[cascade];\r\n    var farZ = light.shadowCascadeFarZ[cascade];\r\n\r\n    var pointsFrustum = virtualLight.pointsFrustum;\r\n\r\n    pointsFrustum[0].z = nearZ;\r\n    pointsFrustum[1].z = nearZ;\r\n    pointsFrustum[2].z = nearZ;\r\n    pointsFrustum[3].z = nearZ;\r\n\r\n    pointsFrustum[4].z = farZ;\r\n    pointsFrustum[5].z = farZ;\r\n    pointsFrustum[6].z = farZ;\r\n    pointsFrustum[7].z = farZ;\r\n\r\n  }\r\n\r\n  // Fit shadow camera's ortho frustum to camera frustum\r\n\r\n  function updateShadowCamera(camera, light) {\r\n\r\n    var shadowCamera = light.shadowCamera,\r\n      pointsFrustum = light.pointsFrustum,\r\n      pointsWorld = light.pointsWorld;\r\n\r\n    _min.set(Infinity, Infinity, Infinity);\r\n    _max.set(-Infinity, -Infinity, -Infinity);\r\n\r\n    for (var i = 0; i < 8; i++) {\r\n\r\n      var p = pointsWorld[i];\r\n\r\n      p.copy(pointsFrustum[i]);\r\n      p.unproject(camera);\r\n\r\n      p.applyMatrix4(shadowCamera.matrixWorldInverse);\r\n\r\n      if (p.x < _min.x) _min.x = p.x;\r\n      if (p.x > _max.x) _max.x = p.x;\r\n\r\n      if (p.y < _min.y) _min.y = p.y;\r\n      if (p.y > _max.y) _max.y = p.y;\r\n\r\n      if (p.z < _min.z) _min.z = p.z;\r\n      if (p.z > _max.z) _max.z = p.z;\r\n\r\n    }\r\n\r\n    shadowCamera.left = _min.x;\r\n    shadowCamera.right = _max.x;\r\n    shadowCamera.top = _max.y;\r\n    shadowCamera.bottom = _min.y;\r\n\r\n    // can't really fit near/far\r\n    //shadowCamera.near = _min.z;\r\n    //shadowCamera.far = _max.z;\r\n\r\n    shadowCamera.updateProjectionMatrix();\r\n\r\n  }\r\n\r\n  // For the moment just ignore objects that have multiple materials with different animation methods\r\n  // Only the first material will be taken into account for deciding which depth material to use for shadow maps\r\n\r\n  function getObjectMaterial(object) {\r\n\r\n    return object.material instanceof THREE.MeshFaceMaterial ? object.material.materials[0] : object.material;\r\n\r\n  };\r\n\r\n};\r\n\r\n// File:src/renderers/webgl/plugins/SpritePlugin.js\r\n\r\n/**\r\n * @author mikael emtinger / http://gomo.se/\r\n * @author alteredq / http://alteredqualia.com/\r\n */\r\n\r\nTHREE.SpritePlugin = function(renderer, sprites) {\r\n\r\n  var gl = renderer.context;\r\n\r\n  var vertexBuffer, elementBuffer;\r\n  var program, attributes, uniforms;\r\n\r\n  var texture;\r\n\r\n  // decompose matrixWorld\r\n\r\n  var spritePosition = new THREE.Vector3();\r\n  var spriteRotation = new THREE.Quaternion();\r\n  var spriteScale = new THREE.Vector3();\r\n\r\n  var init = function() {\r\n\r\n    var vertices = new Float32Array([-0.5, -0.5, 0, 0,\r\n      0.5, -0.5, 1, 0,\r\n      0.5, 0.5, 1, 1, -0.5, 0.5, 0, 1\r\n    ]);\r\n\r\n    var faces = new Uint16Array([\r\n      0, 1, 2,\r\n      0, 2, 3\r\n    ]);\r\n\r\n    vertexBuffer = gl.createBuffer();\r\n    elementBuffer = gl.createBuffer();\r\n\r\n    gl.bindBuffer(gl.ARRAY_BUFFER, vertexBuffer);\r\n    gl.bufferData(gl.ARRAY_BUFFER, vertices, gl.STATIC_DRAW);\r\n\r\n    gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, elementBuffer);\r\n    gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, faces, gl.STATIC_DRAW);\r\n\r\n    program = createProgram();\r\n\r\n    attributes = {\r\n      position: gl.getAttribLocation(program, 'position'),\r\n      uv: gl.getAttribLocation(program, 'uv')\r\n    };\r\n\r\n    uniforms = {\r\n      uvOffset: gl.getUniformLocation(program, 'uvOffset'),\r\n      uvScale: gl.getUniformLocation(program, 'uvScale'),\r\n\r\n      rotation: gl.getUniformLocation(program, 'rotation'),\r\n      scale: gl.getUniformLocation(program, 'scale'),\r\n\r\n      color: gl.getUniformLocation(program, 'color'),\r\n      map: gl.getUniformLocation(program, 'map'),\r\n      opacity: gl.getUniformLocation(program, 'opacity'),\r\n\r\n      modelViewMatrix: gl.getUniformLocation(program, 'modelViewMatrix'),\r\n      projectionMatrix: gl.getUniformLocation(program, 'projectionMatrix'),\r\n\r\n      fogType: gl.getUniformLocation(program, 'fogType'),\r\n      fogDensity: gl.getUniformLocation(program, 'fogDensity'),\r\n      fogNear: gl.getUniformLocation(program, 'fogNear'),\r\n      fogFar: gl.getUniformLocation(program, 'fogFar'),\r\n      fogColor: gl.getUniformLocation(program, 'fogColor'),\r\n\r\n      alphaTest: gl.getUniformLocation(program, 'alphaTest')\r\n    };\r\n\r\n    var canvas = document.createElement('canvas');\r\n    canvas.width = 8;\r\n    canvas.height = 8;\r\n\r\n    var context = canvas.getContext('2d');\r\n    context.fillStyle = 'white';\r\n    context.fillRect(0, 0, 8, 8);\r\n\r\n    texture = new THREE.Texture(canvas);\r\n    texture.needsUpdate = true;\r\n\r\n  };\r\n\r\n  this.render = function(scene, camera) {\r\n\r\n    if (sprites.length === 0) return;\r\n\r\n    // setup gl\r\n\r\n    if (program === undefined) {\r\n\r\n      init();\r\n\r\n    }\r\n\r\n    gl.useProgram(program);\r\n\r\n    gl.enableVertexAttribArray(attributes.position);\r\n    gl.enableVertexAttribArray(attributes.uv);\r\n\r\n    gl.disable(gl.CULL_FACE);\r\n    gl.enable(gl.BLEND);\r\n\r\n    gl.bindBuffer(gl.ARRAY_BUFFER, vertexBuffer);\r\n    gl.vertexAttribPointer(attributes.position, 2, gl.FLOAT, false, 2 * 8, 0);\r\n    gl.vertexAttribPointer(attributes.uv, 2, gl.FLOAT, false, 2 * 8, 8);\r\n\r\n    gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, elementBuffer);\r\n\r\n    gl.uniformMatrix4fv(uniforms.projectionMatrix, false, camera.projectionMatrix.elements);\r\n\r\n    gl.activeTexture(gl.TEXTURE0);\r\n    gl.uniform1i(uniforms.map, 0);\r\n\r\n    var oldFogType = 0;\r\n    var sceneFogType = 0;\r\n    var fog = scene.fog;\r\n\r\n    if (fog) {\r\n\r\n      gl.uniform3f(uniforms.fogColor, fog.color.r, fog.color.g, fog.color.b);\r\n\r\n      if (fog instanceof THREE.Fog) {\r\n\r\n        gl.uniform1f(uniforms.fogNear, fog.near);\r\n        gl.uniform1f(uniforms.fogFar, fog.far);\r\n\r\n        gl.uniform1i(uniforms.fogType, 1);\r\n        oldFogType = 1;\r\n        sceneFogType = 1;\r\n\r\n      }\r\n      else if (fog instanceof THREE.FogExp2) {\r\n\r\n        gl.uniform1f(uniforms.fogDensity, fog.density);\r\n\r\n        gl.uniform1i(uniforms.fogType, 2);\r\n        oldFogType = 2;\r\n        sceneFogType = 2;\r\n\r\n      }\r\n\r\n    }\r\n    else {\r\n\r\n      gl.uniform1i(uniforms.fogType, 0);\r\n      oldFogType = 0;\r\n      sceneFogType = 0;\r\n\r\n    }\r\n\r\n\r\n    // update positions and sort\r\n\r\n    for (var i = 0, l = sprites.length; i < l; i++) {\r\n\r\n      var sprite = sprites[i];\r\n\r\n      sprite._modelViewMatrix.multiplyMatrices(camera.matrixWorldInverse, sprite.matrixWorld);\r\n      sprite.z = -sprite._modelViewMatrix.elements[14];\r\n\r\n    }\r\n\r\n    sprites.sort(painterSortStable);\r\n\r\n    // render all sprites\r\n\r\n    var scale = [];\r\n\r\n    for (var i = 0, l = sprites.length; i < l; i++) {\r\n\r\n      var sprite = sprites[i];\r\n      var material = sprite.material;\r\n\r\n      gl.uniform1f(uniforms.alphaTest, material.alphaTest);\r\n      gl.uniformMatrix4fv(uniforms.modelViewMatrix, false, sprite._modelViewMatrix.elements);\r\n\r\n      sprite.matrixWorld.decompose(spritePosition, spriteRotation, spriteScale);\r\n\r\n      scale[0] = spriteScale.x;\r\n      scale[1] = spriteScale.y;\r\n\r\n      var fogType = 0;\r\n\r\n      if (scene.fog && material.fog) {\r\n\r\n        fogType = sceneFogType;\r\n\r\n      }\r\n\r\n      if (oldFogType !== fogType) {\r\n\r\n        gl.uniform1i(uniforms.fogType, fogType);\r\n        oldFogType = fogType;\r\n\r\n      }\r\n\r\n      if (material.map !== null) {\r\n\r\n        gl.uniform2f(uniforms.uvOffset, material.map.offset.x, material.map.offset.y);\r\n        gl.uniform2f(uniforms.uvScale, material.map.repeat.x, material.map.repeat.y);\r\n\r\n      }\r\n      else {\r\n\r\n        gl.uniform2f(uniforms.uvOffset, 0, 0);\r\n        gl.uniform2f(uniforms.uvScale, 1, 1);\r\n\r\n      }\r\n\r\n      gl.uniform1f(uniforms.opacity, material.opacity);\r\n      gl.uniform3f(uniforms.color, material.color.r, material.color.g, material.color.b);\r\n\r\n      gl.uniform1f(uniforms.rotation, material.rotation);\r\n      gl.uniform2fv(uniforms.scale, scale);\r\n\r\n      renderer.state.setBlending(material.blending, material.blendEquation, material.blendSrc, material.blendDst);\r\n      renderer.state.setDepthTest(material.depthTest);\r\n      renderer.state.setDepthWrite(material.depthWrite);\r\n\r\n      if (material.map && material.map.image && material.map.image.width) {\r\n\r\n        renderer.setTexture(material.map, 0);\r\n\r\n      }\r\n      else {\r\n\r\n        renderer.setTexture(texture, 0);\r\n\r\n      }\r\n\r\n      gl.drawElements(gl.TRIANGLES, 6, gl.UNSIGNED_SHORT, 0);\r\n\r\n    }\r\n\r\n    // restore gl\r\n\r\n    gl.enable(gl.CULL_FACE);\r\n\r\n    renderer.resetGLState();\r\n\r\n  };\r\n\r\n  function createProgram() {\r\n\r\n    var program = gl.createProgram();\r\n\r\n    var vertexShader = gl.createShader(gl.VERTEX_SHADER);\r\n    var fragmentShader = gl.createShader(gl.FRAGMENT_SHADER);\r\n\r\n    gl.shaderSource(vertexShader, [\r\n\r\n      'precision ' + renderer.getPrecision() + ' float;',\r\n\r\n      'uniform mat4 modelViewMatrix;',\r\n      'uniform mat4 projectionMatrix;',\r\n      'uniform float rotation;',\r\n      'uniform vec2 scale;',\r\n      'uniform vec2 uvOffset;',\r\n      'uniform vec2 uvScale;',\r\n\r\n      'attribute vec2 position;',\r\n      'attribute vec2 uv;',\r\n\r\n      'varying vec2 vUV;',\r\n\r\n      'void main() {',\r\n\r\n      'vUV = uvOffset + uv * uvScale;',\r\n\r\n      'vec2 alignedPosition = position * scale;',\r\n\r\n      'vec2 rotatedPosition;',\r\n      'rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;',\r\n      'rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;',\r\n\r\n      'vec4 finalPosition;',\r\n\r\n      'finalPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );',\r\n      'finalPosition.xy += rotatedPosition;',\r\n      'finalPosition = projectionMatrix * finalPosition;',\r\n\r\n      'gl_Position = finalPosition;',\r\n\r\n      '}'\r\n\r\n    ].join('\\n'));\r\n\r\n    gl.shaderSource(fragmentShader, [\r\n\r\n      'precision ' + renderer.getPrecision() + ' float;',\r\n\r\n      'uniform vec3 color;',\r\n      'uniform sampler2D map;',\r\n      'uniform float opacity;',\r\n\r\n      'uniform int fogType;',\r\n      'uniform vec3 fogColor;',\r\n      'uniform float fogDensity;',\r\n      'uniform float fogNear;',\r\n      'uniform float fogFar;',\r\n      'uniform float alphaTest;',\r\n\r\n      'varying vec2 vUV;',\r\n\r\n      'void main() {',\r\n\r\n      'vec4 texture = texture2D( map, vUV );',\r\n\r\n      'if ( texture.a < alphaTest ) discard;',\r\n\r\n      'gl_FragColor = vec4( color * texture.xyz, texture.a * opacity );',\r\n\r\n      'if ( fogType > 0 ) {',\r\n\r\n      'float depth = gl_FragCoord.z / gl_FragCoord.w;',\r\n      'float fogFactor = 0.0;',\r\n\r\n      'if ( fogType == 1 ) {',\r\n\r\n      'fogFactor = smoothstep( fogNear, fogFar, depth );',\r\n\r\n      '} else {',\r\n\r\n      'const float LOG2 = 1.442695;',\r\n      'float fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );',\r\n      'fogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );',\r\n\r\n      '}',\r\n\r\n      'gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );',\r\n\r\n      '}',\r\n\r\n      '}'\r\n\r\n    ].join('\\n'));\r\n\r\n    gl.compileShader(vertexShader);\r\n    gl.compileShader(fragmentShader);\r\n\r\n    gl.attachShader(program, vertexShader);\r\n    gl.attachShader(program, fragmentShader);\r\n\r\n    gl.linkProgram(program);\r\n\r\n    return program;\r\n\r\n  };\r\n\r\n  function painterSortStable(a, b) {\r\n\r\n    if (a.z !== b.z) {\r\n\r\n      return b.z - a.z;\r\n\r\n    }\r\n    else {\r\n\r\n      return b.id - a.id;\r\n\r\n    }\r\n\r\n  };\r\n\r\n};\r\n\r\n// File:src/extras/GeometryUtils.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.GeometryUtils = {\r\n\r\n  merge: function(geometry1, geometry2, materialIndexOffset) {\r\n\r\n    THREE.warn('THREE.GeometryUtils: .merge() has been moved to Geometry. Use geometry.merge( geometry2, matrix, materialIndexOffset ) instead.');\r\n\r\n    var matrix;\r\n\r\n    if (geometry2 instanceof THREE.Mesh) {\r\n\r\n      geometry2.matrixAutoUpdate && geometry2.updateMatrix();\r\n\r\n      matrix = geometry2.matrix;\r\n      geometry2 = geometry2.geometry;\r\n\r\n    }\r\n\r\n    geometry1.merge(geometry2, matrix, materialIndexOffset);\r\n\r\n  },\r\n\r\n  center: function(geometry) {\r\n\r\n    THREE.warn('THREE.GeometryUtils: .center() has been moved to Geometry. Use geometry.center() instead.');\r\n    return geometry.center();\r\n\r\n  }\r\n\r\n};\r\n\r\n// File:src/extras/ImageUtils.js\r\n\r\n/**\r\n * @author alteredq / http://alteredqualia.com/\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author Daosheng Mu / https://github.com/DaoshengMu/\r\n */\r\n\r\nTHREE.ImageUtils = {\r\n\r\n  crossOrigin: undefined,\r\n\r\n  loadTexture: function(url, mapping, onLoad, onError) {\r\n\r\n    var loader = new THREE.ImageLoader();\r\n    loader.crossOrigin = this.crossOrigin;\r\n\r\n    var texture = new THREE.Texture(undefined, mapping);\r\n\r\n    loader.load(url, function(image) {\r\n\r\n      texture.image = image;\r\n      texture.needsUpdate = true;\r\n\r\n      if (onLoad) onLoad(texture);\r\n\r\n    }, undefined, function(event) {\r\n\r\n      if (onError) onError(event);\r\n\r\n    });\r\n\r\n    texture.sourceFile = url;\r\n\r\n    return texture;\r\n\r\n  },\r\n\r\n  loadTextureCube: function(array, mapping, onLoad, onError) {\r\n\r\n    var images = [];\r\n\r\n    var loader = new THREE.ImageLoader();\r\n    loader.crossOrigin = this.crossOrigin;\r\n\r\n    var texture = new THREE.CubeTexture(images, mapping);\r\n\r\n    // no flipping needed for cube textures\r\n\r\n    texture.flipY = false;\r\n\r\n    var loaded = 0;\r\n\r\n    var loadTexture = function(i) {\r\n\r\n      loader.load(array[i], function(image) {\r\n\r\n        texture.images[i] = image;\r\n\r\n        loaded += 1;\r\n\r\n        if (loaded === 6) {\r\n\r\n          texture.needsUpdate = true;\r\n\r\n          if (onLoad) onLoad(texture);\r\n\r\n        }\r\n\r\n      }, undefined, onError);\r\n\r\n    }\r\n\r\n    for (var i = 0, il = array.length; i < il; ++i) {\r\n\r\n      loadTexture(i);\r\n\r\n    }\r\n\r\n    return texture;\r\n\r\n  },\r\n\r\n  loadCompressedTexture: function() {\r\n\r\n    THREE.error('THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.')\r\n\r\n  },\r\n\r\n  loadCompressedTextureCube: function() {\r\n\r\n    THREE.error('THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.')\r\n\r\n  },\r\n\r\n  getNormalMap: function(image, depth) {\r\n\r\n    // Adapted from http://www.paulbrunt.co.uk/lab/heightnormal/\r\n\r\n    var cross = function(a, b) {\r\n\r\n      return [a[1] * b[2] - a[2] * b[1], a[2] * b[0] - a[0] * b[2], a[0] * b[1] - a[1] * b[0]];\r\n\r\n    }\r\n\r\n    var subtract = function(a, b) {\r\n\r\n      return [a[0] - b[0], a[1] - b[1], a[2] - b[2]];\r\n\r\n    }\r\n\r\n    var normalize = function(a) {\r\n\r\n      var l = Math.sqrt(a[0] * a[0] + a[1] * a[1] + a[2] * a[2]);\r\n      return [a[0] / l, a[1] / l, a[2] / l];\r\n\r\n    }\r\n\r\n    depth = depth | 1;\r\n\r\n    var width = image.width;\r\n    var height = image.height;\r\n\r\n    var canvas = document.createElement('canvas');\r\n    canvas.width = width;\r\n    canvas.height = height;\r\n\r\n    var context = canvas.getContext('2d');\r\n    context.drawImage(image, 0, 0);\r\n\r\n    var data = context.getImageData(0, 0, width, height).data;\r\n    var imageData = context.createImageData(width, height);\r\n    var output = imageData.data;\r\n\r\n    for (var x = 0; x < width; x++) {\r\n\r\n      for (var y = 0; y < height; y++) {\r\n\r\n        var ly = y - 1 < 0 ? 0 : y - 1;\r\n        var uy = y + 1 > height - 1 ? height - 1 : y + 1;\r\n        var lx = x - 1 < 0 ? 0 : x - 1;\r\n        var ux = x + 1 > width - 1 ? width - 1 : x + 1;\r\n\r\n        var points = [];\r\n        var origin = [0, 0, data[(y * width + x) * 4] / 255 * depth];\r\n        points.push([-1, 0, data[(y * width + lx) * 4] / 255 * depth]);\r\n        points.push([-1, -1, data[(ly * width + lx) * 4] / 255 * depth]);\r\n        points.push([0, -1, data[(ly * width + x) * 4] / 255 * depth]);\r\n        points.push([1, -1, data[(ly * width + ux) * 4] / 255 * depth]);\r\n        points.push([1, 0, data[(y * width + ux) * 4] / 255 * depth]);\r\n        points.push([1, 1, data[(uy * width + ux) * 4] / 255 * depth]);\r\n        points.push([0, 1, data[(uy * width + x) * 4] / 255 * depth]);\r\n        points.push([-1, 1, data[(uy * width + lx) * 4] / 255 * depth]);\r\n\r\n        var normals = [];\r\n        var num_points = points.length;\r\n\r\n        for (var i = 0; i < num_points; i++) {\r\n\r\n          var v1 = points[i];\r\n          var v2 = points[(i + 1) % num_points];\r\n          v1 = subtract(v1, origin);\r\n          v2 = subtract(v2, origin);\r\n          normals.push(normalize(cross(v1, v2)));\r\n\r\n        }\r\n\r\n        var normal = [0, 0, 0];\r\n\r\n        for (var i = 0; i < normals.length; i++) {\r\n\r\n          normal[0] += normals[i][0];\r\n          normal[1] += normals[i][1];\r\n          normal[2] += normals[i][2];\r\n\r\n        }\r\n\r\n        normal[0] /= normals.length;\r\n        normal[1] /= normals.length;\r\n        normal[2] /= normals.length;\r\n\r\n        var idx = (y * width + x) * 4;\r\n\r\n        output[idx] = ((normal[0] + 1.0) / 2.0 * 255) | 0;\r\n        output[idx + 1] = ((normal[1] + 1.0) / 2.0 * 255) | 0;\r\n        output[idx + 2] = (normal[2] * 255) | 0;\r\n        output[idx + 3] = 255;\r\n\r\n      }\r\n\r\n    }\r\n\r\n    context.putImageData(imageData, 0, 0);\r\n\r\n    return canvas;\r\n\r\n  },\r\n\r\n  generateDataTexture: function(width, height, color) {\r\n\r\n    var size = width * height;\r\n    var data = new Uint8Array(3 * size);\r\n\r\n    var r = Math.floor(color.r * 255);\r\n    var g = Math.floor(color.g * 255);\r\n    var b = Math.floor(color.b * 255);\r\n\r\n    for (var i = 0; i < size; i++) {\r\n\r\n      data[i * 3] = r;\r\n      data[i * 3 + 1] = g;\r\n      data[i * 3 + 2] = b;\r\n\r\n    }\r\n\r\n    var texture = new THREE.DataTexture(data, width, height, THREE.RGBFormat);\r\n    texture.needsUpdate = true;\r\n\r\n    return texture;\r\n\r\n  }\r\n\r\n};\r\n\r\n// File:src/extras/SceneUtils.js\r\n\r\n/**\r\n * @author alteredq / http://alteredqualia.com/\r\n */\r\n\r\nTHREE.SceneUtils = {\r\n\r\n  createMultiMaterialObject: function(geometry, materials) {\r\n\r\n    var group = new THREE.Object3D();\r\n\r\n    for (var i = 0, l = materials.length; i < l; i++) {\r\n\r\n      group.add(new THREE.Mesh(geometry, materials[i]));\r\n\r\n    }\r\n\r\n    return group;\r\n\r\n  },\r\n\r\n  detach: function(child, parent, scene) {\r\n\r\n    child.applyMatrix(parent.matrixWorld);\r\n    parent.remove(child);\r\n    scene.add(child);\r\n\r\n  },\r\n\r\n  attach: function(child, scene, parent) {\r\n\r\n    var matrixWorldInverse = new THREE.Matrix4();\r\n    matrixWorldInverse.getInverse(parent.matrixWorld);\r\n    child.applyMatrix(matrixWorldInverse);\r\n\r\n    scene.remove(child);\r\n    parent.add(child);\r\n\r\n  }\r\n\r\n};\r\n\r\n// File:src/extras/FontUtils.js\r\n\r\n/**\r\n * @author zz85 / http://www.lab4games.net/zz85/blog\r\n * @author alteredq / http://alteredqualia.com/\r\n *\r\n * For Text operations in three.js (See TextGeometry)\r\n *\r\n * It uses techniques used in:\r\n *\r\n * \ttypeface.js and canvastext\r\n * \t\tFor converting fonts and rendering with javascript\r\n *\t\thttp://typeface.neocracy.org\r\n *\r\n *\tTriangulation ported from AS3\r\n *\t\tSimple Polygon Triangulation\r\n *\t\thttp://actionsnippet.com/?p=1462\r\n *\r\n * \tA Method to triangulate shapes with holes\r\n *\t\thttp://www.sakri.net/blog/2009/06/12/an-approach-to-triangulating-polygons-with-holes/\r\n *\r\n */\r\n\r\nTHREE.FontUtils = {\r\n\r\n  faces: {},\r\n\r\n  // Just for now. face[weight][style]\r\n\r\n  face: 'helvetiker',\r\n  weight: 'normal',\r\n  style: 'normal',\r\n  size: 150,\r\n  divisions: 10,\r\n\r\n  getFace: function() {\r\n\r\n    try {\r\n\r\n      return this.faces[this.face][this.weight][this.style];\r\n\r\n    }\r\n    catch (e) {\r\n\r\n      throw \"The font \" + this.face + \" with \" + this.weight + \" weight and \" + this.style + \" style is missing.\"\r\n\r\n    };\r\n\r\n  },\r\n\r\n  loadFace: function(data) {\r\n\r\n    var family = data.familyName.toLowerCase();\r\n\r\n    var ThreeFont = this;\r\n\r\n    ThreeFont.faces[family] = ThreeFont.faces[family] || {};\r\n\r\n    ThreeFont.faces[family][data.cssFontWeight] = ThreeFont.faces[family][data.cssFontWeight] || {};\r\n    ThreeFont.faces[family][data.cssFontWeight][data.cssFontStyle] = data;\r\n\r\n    ThreeFont.faces[family][data.cssFontWeight][data.cssFontStyle] = data;\r\n\r\n    return data;\r\n\r\n  },\r\n\r\n  drawText: function(text) {\r\n\r\n    // RenderText\r\n\r\n    var i,\r\n      face = this.getFace(),\r\n      scale = this.size / face.resolution,\r\n      offset = 0,\r\n      chars = String(text).split(''),\r\n      length = chars.length;\r\n\r\n    var fontPaths = [];\r\n\r\n    for (i = 0; i < length; i++) {\r\n\r\n      var path = new THREE.Path();\r\n\r\n      var ret = this.extractGlyphPoints(chars[i], face, scale, offset, path);\r\n      offset += ret.offset;\r\n\r\n      fontPaths.push(ret.path);\r\n\r\n    }\r\n\r\n    // get the width\r\n\r\n    var width = offset / 2;\r\n    //\r\n    // for ( p = 0; p < allPts.length; p++ ) {\r\n    //\r\n    // \tallPts[ p ].x -= width;\r\n    //\r\n    // }\r\n\r\n    //var extract = this.extractPoints( allPts, characterPts );\r\n    //extract.contour = allPts;\r\n\r\n    //extract.paths = fontPaths;\r\n    //extract.offset = width;\r\n\r\n    return {\r\n      paths: fontPaths,\r\n      offset: width\r\n    };\r\n\r\n  },\r\n\r\n\r\n\r\n\r\n  extractGlyphPoints: function(c, face, scale, offset, path) {\r\n\r\n    var pts = [];\r\n\r\n    var i, i2, divisions,\r\n      outline, action, length,\r\n      scaleX, scaleY,\r\n      x, y, cpx, cpy, cpx0, cpy0, cpx1, cpy1, cpx2, cpy2,\r\n      laste,\r\n      glyph = face.glyphs[c] || face.glyphs['?'];\r\n\r\n    if (!glyph) return;\r\n\r\n    if (glyph.o) {\r\n\r\n      outline = glyph._cachedOutline || (glyph._cachedOutline = glyph.o.split(' '));\r\n      length = outline.length;\r\n\r\n      scaleX = scale;\r\n      scaleY = scale;\r\n\r\n      for (i = 0; i < length;) {\r\n\r\n        action = outline[i++];\r\n\r\n        //console.log( action );\r\n\r\n        switch (action) {\r\n\r\n          case 'm':\r\n\r\n            // Move To\r\n\r\n            x = outline[i++] * scaleX + offset;\r\n            y = outline[i++] * scaleY;\r\n\r\n            path.moveTo(x, y);\r\n            break;\r\n\r\n          case 'l':\r\n\r\n            // Line To\r\n\r\n            x = outline[i++] * scaleX + offset;\r\n            y = outline[i++] * scaleY;\r\n            path.lineTo(x, y);\r\n            break;\r\n\r\n          case 'q':\r\n\r\n            // QuadraticCurveTo\r\n\r\n            cpx = outline[i++] * scaleX + offset;\r\n            cpy = outline[i++] * scaleY;\r\n            cpx1 = outline[i++] * scaleX + offset;\r\n            cpy1 = outline[i++] * scaleY;\r\n\r\n            path.quadraticCurveTo(cpx1, cpy1, cpx, cpy);\r\n\r\n            laste = pts[pts.length - 1];\r\n\r\n            if (laste) {\r\n\r\n              cpx0 = laste.x;\r\n              cpy0 = laste.y;\r\n\r\n              for (i2 = 1, divisions = this.divisions; i2 <= divisions; i2++) {\r\n\r\n                var t = i2 / divisions;\r\n                THREE.Shape.Utils.b2(t, cpx0, cpx1, cpx);\r\n                THREE.Shape.Utils.b2(t, cpy0, cpy1, cpy);\r\n              }\r\n\r\n            }\r\n\r\n            break;\r\n\r\n          case 'b':\r\n\r\n            // Cubic Bezier Curve\r\n\r\n            cpx = outline[i++] * scaleX + offset;\r\n            cpy = outline[i++] * scaleY;\r\n            cpx1 = outline[i++] * scaleX + offset;\r\n            cpy1 = outline[i++] * scaleY;\r\n            cpx2 = outline[i++] * scaleX + offset;\r\n            cpy2 = outline[i++] * scaleY;\r\n\r\n            path.bezierCurveTo(cpx1, cpy1, cpx2, cpy2, cpx, cpy);\r\n\r\n            laste = pts[pts.length - 1];\r\n\r\n            if (laste) {\r\n\r\n              cpx0 = laste.x;\r\n              cpy0 = laste.y;\r\n\r\n              for (i2 = 1, divisions = this.divisions; i2 <= divisions; i2++) {\r\n\r\n                var t = i2 / divisions;\r\n                THREE.Shape.Utils.b3(t, cpx0, cpx1, cpx2, cpx);\r\n                THREE.Shape.Utils.b3(t, cpy0, cpy1, cpy2, cpy);\r\n\r\n              }\r\n\r\n            }\r\n\r\n            break;\r\n\r\n        }\r\n\r\n      }\r\n    }\r\n\r\n\r\n\r\n    return {\r\n      offset: glyph.ha * scale,\r\n      path: path\r\n    };\r\n  }\r\n\r\n};\r\n\r\n\r\nTHREE.FontUtils.generateShapes = function(text, parameters) {\r\n\r\n  // Parameters \r\n\r\n  parameters = parameters || {};\r\n\r\n  var size = parameters.size !== undefined ? parameters.size : 100;\r\n  var curveSegments = parameters.curveSegments !== undefined ? parameters.curveSegments : 4;\r\n\r\n  var font = parameters.font !== undefined ? parameters.font : 'helvetiker';\r\n  var weight = parameters.weight !== undefined ? parameters.weight : 'normal';\r\n  var style = parameters.style !== undefined ? parameters.style : 'normal';\r\n\r\n  THREE.FontUtils.size = size;\r\n  THREE.FontUtils.divisions = curveSegments;\r\n\r\n  THREE.FontUtils.face = font;\r\n  THREE.FontUtils.weight = weight;\r\n  THREE.FontUtils.style = style;\r\n\r\n  // Get a Font data json object\r\n\r\n  var data = THREE.FontUtils.drawText(text);\r\n\r\n  var paths = data.paths;\r\n  var shapes = [];\r\n\r\n  for (var p = 0, pl = paths.length; p < pl; p++) {\r\n\r\n    Array.prototype.push.apply(shapes, paths[p].toShapes());\r\n\r\n  }\r\n\r\n  return shapes;\r\n\r\n};\r\n\r\n\r\n/**\r\n * This code is a quick port of code written in C++ which was submitted to\r\n * flipcode.com by John W. Ratcliff  // July 22, 2000\r\n * See original code and more information here:\r\n * http://www.flipcode.com/archives/Efficient_Polygon_Triangulation.shtml\r\n *\r\n * ported to actionscript by Zevan Rosser\r\n * www.actionsnippet.com\r\n *\r\n * ported to javascript by Joshua Koo\r\n * http://www.lab4games.net/zz85/blog\r\n *\r\n */\r\n\r\n\r\n(function(namespace) {\r\n\r\n  var EPSILON = 0.0000000001;\r\n\r\n  // takes in an contour array and returns\r\n\r\n  var process = function(contour, indices) {\r\n\r\n    var n = contour.length;\r\n\r\n    if (n < 3) return null;\r\n\r\n    var result = [],\r\n      verts = [],\r\n      vertIndices = [];\r\n\r\n    /* we want a counter-clockwise polygon in verts */\r\n\r\n    var u, v, w;\r\n\r\n    if (area(contour) > 0.0) {\r\n\r\n      for (v = 0; v < n; v++) verts[v] = v;\r\n\r\n    }\r\n    else {\r\n\r\n      for (v = 0; v < n; v++) verts[v] = (n - 1) - v;\r\n\r\n    }\r\n\r\n    var nv = n;\r\n\r\n    /*  remove nv - 2 vertices, creating 1 triangle every time */\r\n\r\n    var count = 2 * nv; /* error detection */\r\n\r\n    for (v = nv - 1; nv > 2;) {\r\n\r\n      /* if we loop, it is probably a non-simple polygon */\r\n\r\n      if ((count--) <= 0) {\r\n\r\n        //** Triangulate: ERROR - probable bad polygon!\r\n\r\n        //throw ( \"Warning, unable to triangulate polygon!\" );\r\n        //return null;\r\n        // Sometimes warning is fine, especially polygons are triangulated in reverse.\r\n        THREE.warn('THREE.FontUtils: Warning, unable to triangulate polygon! in Triangulate.process()');\r\n\r\n        if (indices) return vertIndices;\r\n        return result;\r\n\r\n      }\r\n\r\n      /* three consecutive vertices in current polygon, <u,v,w> */\r\n\r\n      u = v;\r\n      if (nv <= u) u = 0; /* previous */\r\n      v = u + 1;\r\n      if (nv <= v) v = 0; /* new v    */\r\n      w = v + 1;\r\n      if (nv <= w) w = 0; /* next     */\r\n\r\n      if (snip(contour, u, v, w, nv, verts)) {\r\n\r\n        var a, b, c, s, t;\r\n\r\n        /* true names of the vertices */\r\n\r\n        a = verts[u];\r\n        b = verts[v];\r\n        c = verts[w];\r\n\r\n        /* output Triangle */\r\n\r\n        result.push([contour[a],\r\n          contour[b],\r\n          contour[c]\r\n        ]);\r\n\r\n\r\n        vertIndices.push([verts[u], verts[v], verts[w]]);\r\n\r\n        /* remove v from the remaining polygon */\r\n\r\n        for (s = v, t = v + 1; t < nv; s++, t++) {\r\n\r\n          verts[s] = verts[t];\r\n\r\n        }\r\n\r\n        nv--;\r\n\r\n        /* reset error detection counter */\r\n\r\n        count = 2 * nv;\r\n\r\n      }\r\n\r\n    }\r\n\r\n    if (indices) return vertIndices;\r\n    return result;\r\n\r\n  };\r\n\r\n  // calculate area of the contour polygon\r\n\r\n  var area = function(contour) {\r\n\r\n    var n = contour.length;\r\n    var a = 0.0;\r\n\r\n    for (var p = n - 1, q = 0; q < n; p = q++) {\r\n\r\n      a += contour[p].x * contour[q].y - contour[q].x * contour[p].y;\r\n\r\n    }\r\n\r\n    return a * 0.5;\r\n\r\n  };\r\n\r\n  var snip = function(contour, u, v, w, n, verts) {\r\n\r\n    var p;\r\n    var ax, ay, bx, by;\r\n    var cx, cy, px, py;\r\n\r\n    ax = contour[verts[u]].x;\r\n    ay = contour[verts[u]].y;\r\n\r\n    bx = contour[verts[v]].x;\r\n    by = contour[verts[v]].y;\r\n\r\n    cx = contour[verts[w]].x;\r\n    cy = contour[verts[w]].y;\r\n\r\n    if (EPSILON > (((bx - ax) * (cy - ay)) - ((by - ay) * (cx - ax)))) return false;\r\n\r\n    var aX, aY, bX, bY, cX, cY;\r\n    var apx, apy, bpx, bpy, cpx, cpy;\r\n    var cCROSSap, bCROSScp, aCROSSbp;\r\n\r\n    aX = cx - bx;\r\n    aY = cy - by;\r\n    bX = ax - cx;\r\n    bY = ay - cy;\r\n    cX = bx - ax;\r\n    cY = by - ay;\r\n\r\n    for (p = 0; p < n; p++) {\r\n\r\n      px = contour[verts[p]].x\r\n      py = contour[verts[p]].y\r\n\r\n      if (((px === ax) && (py === ay)) ||\r\n        ((px === bx) && (py === by)) ||\r\n        ((px === cx) && (py === cy))) continue;\r\n\r\n      apx = px - ax;\r\n      apy = py - ay;\r\n      bpx = px - bx;\r\n      bpy = py - by;\r\n      cpx = px - cx;\r\n      cpy = py - cy;\r\n\r\n      // see if p is inside triangle abc\r\n\r\n      aCROSSbp = aX * bpy - aY * bpx;\r\n      cCROSSap = cX * apy - cY * apx;\r\n      bCROSScp = bX * cpy - bY * cpx;\r\n\r\n      if ((aCROSSbp >= -EPSILON) && (bCROSScp >= -EPSILON) && (cCROSSap >= -EPSILON)) return false;\r\n\r\n    }\r\n\r\n    return true;\r\n\r\n  };\r\n\r\n\r\n  namespace.Triangulate = process;\r\n  namespace.Triangulate.area = area;\r\n\r\n  return namespace;\r\n\r\n})(THREE.FontUtils);\r\n\r\n// To use the typeface.js face files, hook up the API\r\nself._typeface_js = {\r\n  faces: THREE.FontUtils.faces,\r\n  loadFace: THREE.FontUtils.loadFace\r\n};\r\nTHREE.typeface_js = self._typeface_js;\r\n\r\n// File:src/extras/audio/Audio.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.Audio = function(listener) {\r\n\r\n  THREE.Object3D.call(this);\r\n\r\n  this.type = 'Audio';\r\n\r\n  this.context = listener.context;\r\n  this.source = this.context.createBufferSource();\r\n  this.source.onended = this.onEnded.bind(this);\r\n\r\n  this.gain = this.context.createGain();\r\n  this.gain.connect(this.context.destination);\r\n\r\n  this.panner = this.context.createPanner();\r\n  this.panner.connect(this.gain);\r\n\r\n  this.autoplay = false;\r\n\r\n  this.startTime = 0;\r\n  this.isPlaying = false;\r\n\r\n};\r\n\r\nTHREE.Audio.prototype = Object.create(THREE.Object3D.prototype);\r\nTHREE.Audio.prototype.constructor = THREE.Audio;\r\n\r\nTHREE.Audio.prototype.load = function(file) {\r\n\r\n  var scope = this;\r\n\r\n  var request = new XMLHttpRequest();\r\n  request.open('GET', file, true);\r\n  request.responseType = 'arraybuffer';\r\n  request.onload = function(e) {\r\n\r\n    scope.context.decodeAudioData(this.response, function(buffer) {\r\n\r\n      scope.source.buffer = buffer;\r\n\r\n      if (scope.autoplay) scope.play();\r\n\r\n    });\r\n\r\n  };\r\n  request.send();\r\n\r\n  return this;\r\n\r\n};\r\n\r\nTHREE.Audio.prototype.play = function() {\r\n\r\n  if (this.isPlaying === true) {\r\n\r\n    THREE.warn('THREE.Audio: Audio is already playing.');\r\n    return;\r\n\r\n  }\r\n\r\n  var source = this.context.createBufferSource();\r\n\r\n  source.buffer = this.source.buffer;\r\n  source.loop = this.source.loop;\r\n  source.onended = this.source.onended;\r\n  source.connect(this.panner);\r\n  source.start(0, this.startTime);\r\n\r\n  this.isPlaying = true;\r\n\r\n  this.source = source;\r\n\r\n};\r\n\r\nTHREE.Audio.prototype.pause = function() {\r\n\r\n  this.source.stop();\r\n  this.startTime = this.context.currentTime;\r\n\r\n};\r\n\r\nTHREE.Audio.prototype.stop = function() {\r\n\r\n  this.source.stop();\r\n  this.startTime = 0;\r\n\r\n};\r\n\r\nTHREE.Audio.prototype.onEnded = function() {\r\n\r\n  this.isPlaying = false;\r\n\r\n};\r\n\r\nTHREE.Audio.prototype.setLoop = function(value) {\r\n\r\n  this.source.loop = value;\r\n\r\n};\r\n\r\nTHREE.Audio.prototype.setRefDistance = function(value) {\r\n\r\n  this.panner.refDistance = value;\r\n\r\n};\r\n\r\nTHREE.Audio.prototype.setRolloffFactor = function(value) {\r\n\r\n  this.panner.rolloffFactor = value;\r\n\r\n};\r\n\r\nTHREE.Audio.prototype.setVolume = function(value) {\r\n\r\n  this.gain.gain.value = value;\r\n\r\n};\r\n\r\nTHREE.Audio.prototype.updateMatrixWorld = (function() {\r\n\r\n  var position = new THREE.Vector3();\r\n\r\n  return function(force) {\r\n\r\n    THREE.Object3D.prototype.updateMatrixWorld.call(this, force);\r\n\r\n    position.setFromMatrixPosition(this.matrixWorld);\r\n\r\n    this.panner.setPosition(position.x, position.y, position.z);\r\n\r\n  };\r\n\r\n})();\r\n\r\n// File:src/extras/audio/AudioListener.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.AudioListener = function() {\r\n\r\n  THREE.Object3D.call(this);\r\n\r\n  this.type = 'AudioListener';\r\n\r\n  this.context = new(window.AudioContext || window.webkitAudioContext)();\r\n\r\n};\r\n\r\nTHREE.AudioListener.prototype = Object.create(THREE.Object3D.prototype);\r\nTHREE.AudioListener.prototype.constructor = THREE.AudioListener;\r\n\r\nTHREE.AudioListener.prototype.updateMatrixWorld = (function() {\r\n\r\n  var position = new THREE.Vector3();\r\n  var quaternion = new THREE.Quaternion();\r\n  var scale = new THREE.Vector3();\r\n\r\n  var orientation = new THREE.Vector3();\r\n  var velocity = new THREE.Vector3();\r\n\r\n  var positionPrev = new THREE.Vector3();\r\n\r\n  return function(force) {\r\n\r\n    THREE.Object3D.prototype.updateMatrixWorld.call(this, force);\r\n\r\n    var listener = this.context.listener;\r\n    var up = this.up;\r\n\r\n    this.matrixWorld.decompose(position, quaternion, scale);\r\n\r\n    orientation.set(0, 0, -1).applyQuaternion(quaternion);\r\n    velocity.subVectors(position, positionPrev);\r\n\r\n    listener.setPosition(position.x, position.y, position.z);\r\n    listener.setOrientation(orientation.x, orientation.y, orientation.z, up.x, up.y, up.z);\r\n    listener.setVelocity(velocity.x, velocity.y, velocity.z);\r\n\r\n    positionPrev.copy(position);\r\n\r\n  };\r\n\r\n})();\r\n\r\n// File:src/extras/core/Curve.js\r\n\r\n/**\r\n * @author zz85 / http://www.lab4games.net/zz85/blog\r\n * Extensible curve object\r\n *\r\n * Some common of Curve methods\r\n * .getPoint(t), getTangent(t)\r\n * .getPointAt(u), getTagentAt(u)\r\n * .getPoints(), .getSpacedPoints()\r\n * .getLength()\r\n * .updateArcLengths()\r\n *\r\n * This following classes subclasses THREE.Curve:\r\n *\r\n * -- 2d classes --\r\n * THREE.LineCurve\r\n * THREE.QuadraticBezierCurve\r\n * THREE.CubicBezierCurve\r\n * THREE.SplineCurve\r\n * THREE.ArcCurve\r\n * THREE.EllipseCurve\r\n *\r\n * -- 3d classes --\r\n * THREE.LineCurve3\r\n * THREE.QuadraticBezierCurve3\r\n * THREE.CubicBezierCurve3\r\n * THREE.SplineCurve3\r\n * THREE.ClosedSplineCurve3\r\n *\r\n * A series of curves can be represented as a THREE.CurvePath\r\n *\r\n **/\r\n\r\n/**************************************************************\r\n *\tAbstract Curve base class\r\n **************************************************************/\r\n\r\nTHREE.Curve = function() {\r\n\r\n};\r\n\r\n// Virtual base class method to overwrite and implement in subclasses\r\n//\t- t [0 .. 1]\r\n\r\nTHREE.Curve.prototype.getPoint = function(t) {\r\n\r\n  THREE.warn(\"THREE.Curve: Warning, getPoint() not implemented!\");\r\n  return null;\r\n\r\n};\r\n\r\n// Get point at relative position in curve according to arc length\r\n// - u [0 .. 1]\r\n\r\nTHREE.Curve.prototype.getPointAt = function(u) {\r\n\r\n  var t = this.getUtoTmapping(u);\r\n  return this.getPoint(t);\r\n\r\n};\r\n\r\n// Get sequence of points using getPoint( t )\r\n\r\nTHREE.Curve.prototype.getPoints = function(divisions) {\r\n\r\n  if (!divisions) divisions = 5;\r\n\r\n  var d, pts = [];\r\n\r\n  for (d = 0; d <= divisions; d++) {\r\n\r\n    pts.push(this.getPoint(d / divisions));\r\n\r\n  }\r\n\r\n  return pts;\r\n\r\n};\r\n\r\n// Get sequence of points using getPointAt( u )\r\n\r\nTHREE.Curve.prototype.getSpacedPoints = function(divisions) {\r\n\r\n  if (!divisions) divisions = 5;\r\n\r\n  var d, pts = [];\r\n\r\n  for (d = 0; d <= divisions; d++) {\r\n\r\n    pts.push(this.getPointAt(d / divisions));\r\n\r\n  }\r\n\r\n  return pts;\r\n\r\n};\r\n\r\n// Get total curve arc length\r\n\r\nTHREE.Curve.prototype.getLength = function() {\r\n\r\n  var lengths = this.getLengths();\r\n  return lengths[lengths.length - 1];\r\n\r\n};\r\n\r\n// Get list of cumulative segment lengths\r\n\r\nTHREE.Curve.prototype.getLengths = function(divisions) {\r\n\r\n  if (!divisions) divisions = (this.__arcLengthDivisions) ? (this.__arcLengthDivisions) : 200;\r\n\r\n  if (this.cacheArcLengths && (this.cacheArcLengths.length == divisions + 1) && !this.needsUpdate) {\r\n\r\n    //console.log( \"cached\", this.cacheArcLengths );\r\n    return this.cacheArcLengths;\r\n\r\n  }\r\n\r\n  this.needsUpdate = false;\r\n\r\n  var cache = [];\r\n  var current, last = this.getPoint(0);\r\n  var p, sum = 0;\r\n\r\n  cache.push(0);\r\n\r\n  for (p = 1; p <= divisions; p++) {\r\n\r\n    current = this.getPoint(p / divisions);\r\n    sum += current.distanceTo(last);\r\n    cache.push(sum);\r\n    last = current;\r\n\r\n  }\r\n\r\n  this.cacheArcLengths = cache;\r\n\r\n  return cache; // { sums: cache, sum:sum }; Sum is in the last element.\r\n\r\n};\r\n\r\n\r\nTHREE.Curve.prototype.updateArcLengths = function() {\r\n  this.needsUpdate = true;\r\n  this.getLengths();\r\n};\r\n\r\n// Given u ( 0 .. 1 ), get a t to find p. This gives you points which are equi distance\r\n\r\nTHREE.Curve.prototype.getUtoTmapping = function(u, distance) {\r\n\r\n  var arcLengths = this.getLengths();\r\n\r\n  var i = 0,\r\n    il = arcLengths.length;\r\n\r\n  var targetArcLength; // The targeted u distance value to get\r\n\r\n  if (distance) {\r\n\r\n    targetArcLength = distance;\r\n\r\n  }\r\n  else {\r\n\r\n    targetArcLength = u * arcLengths[il - 1];\r\n\r\n  }\r\n\r\n  //var time = Date.now();\r\n\r\n  // binary search for the index with largest value smaller than target u distance\r\n\r\n  var low = 0,\r\n    high = il - 1,\r\n    comparison;\r\n\r\n  while (low <= high) {\r\n\r\n    i = Math.floor(low + (high - low) / 2); // less likely to overflow, though probably not issue here, JS doesn't really have integers, all numbers are floats\r\n\r\n    comparison = arcLengths[i] - targetArcLength;\r\n\r\n    if (comparison < 0) {\r\n\r\n      low = i + 1;\r\n\r\n    }\r\n    else if (comparison > 0) {\r\n\r\n      high = i - 1;\r\n\r\n    }\r\n    else {\r\n\r\n      high = i;\r\n      break;\r\n\r\n      // DONE\r\n\r\n    }\r\n\r\n  }\r\n\r\n  i = high;\r\n\r\n  //console.log('b' , i, low, high, Date.now()- time);\r\n\r\n  if (arcLengths[i] == targetArcLength) {\r\n\r\n    var t = i / (il - 1);\r\n    return t;\r\n\r\n  }\r\n\r\n  // we could get finer grain at lengths, or use simple interpolatation between two points\r\n\r\n  var lengthBefore = arcLengths[i];\r\n  var lengthAfter = arcLengths[i + 1];\r\n\r\n  var segmentLength = lengthAfter - lengthBefore;\r\n\r\n  // determine where we are between the 'before' and 'after' points\r\n\r\n  var segmentFraction = (targetArcLength - lengthBefore) / segmentLength;\r\n\r\n  // add that fractional amount to t\r\n\r\n  var t = (i + segmentFraction) / (il - 1);\r\n\r\n  return t;\r\n\r\n};\r\n\r\n// Returns a unit vector tangent at t\r\n// In case any sub curve does not implement its tangent derivation,\r\n// 2 points a small delta apart will be used to find its gradient\r\n// which seems to give a reasonable approximation\r\n\r\nTHREE.Curve.prototype.getTangent = function(t) {\r\n\r\n  var delta = 0.0001;\r\n  var t1 = t - delta;\r\n  var t2 = t + delta;\r\n\r\n  // Capping in case of danger\r\n\r\n  if (t1 < 0) t1 = 0;\r\n  if (t2 > 1) t2 = 1;\r\n\r\n  var pt1 = this.getPoint(t1);\r\n  var pt2 = this.getPoint(t2);\r\n\r\n  var vec = pt2.clone().sub(pt1);\r\n  return vec.normalize();\r\n\r\n};\r\n\r\n\r\nTHREE.Curve.prototype.getTangentAt = function(u) {\r\n\r\n  var t = this.getUtoTmapping(u);\r\n  return this.getTangent(t);\r\n\r\n};\r\n\r\n\r\n\r\n\r\n\r\n/**************************************************************\r\n *\tUtils\r\n **************************************************************/\r\n\r\nTHREE.Curve.Utils = {\r\n\r\n  tangentQuadraticBezier: function(t, p0, p1, p2) {\r\n\r\n    return 2 * (1 - t) * (p1 - p0) + 2 * t * (p2 - p1);\r\n\r\n  },\r\n\r\n  // Puay Bing, thanks for helping with this derivative!\r\n\r\n  tangentCubicBezier: function(t, p0, p1, p2, p3) {\r\n\r\n    return -3 * p0 * (1 - t) * (1 - t) +\r\n      3 * p1 * (1 - t) * (1 - t) - 6 * t * p1 * (1 - t) +\r\n      6 * t * p2 * (1 - t) - 3 * t * t * p2 +\r\n      3 * t * t * p3;\r\n\r\n  },\r\n\r\n  tangentSpline: function(t, p0, p1, p2, p3) {\r\n\r\n    // To check if my formulas are correct\r\n\r\n    var h00 = 6 * t * t - 6 * t; // derived from 2t^3  3t^2 + 1\r\n    var h10 = 3 * t * t - 4 * t + 1; // t^3  2t^2 + t\r\n    var h01 = -6 * t * t + 6 * t; //  2t3 + 3t2\r\n    var h11 = 3 * t * t - 2 * t; // t3  t2\r\n\r\n    return h00 + h10 + h01 + h11;\r\n\r\n  },\r\n\r\n  // Catmull-Rom\r\n\r\n  interpolate: function(p0, p1, p2, p3, t) {\r\n\r\n    var v0 = (p2 - p0) * 0.5;\r\n    var v1 = (p3 - p1) * 0.5;\r\n    var t2 = t * t;\r\n    var t3 = t * t2;\r\n    return (2 * p1 - 2 * p2 + v0 + v1) * t3 + (-3 * p1 + 3 * p2 - 2 * v0 - v1) * t2 + v0 * t + p1;\r\n\r\n  }\r\n\r\n};\r\n\r\n\r\n// TODO: Transformation for Curves?\r\n\r\n/**************************************************************\r\n *\t3D Curves\r\n **************************************************************/\r\n\r\n// A Factory method for creating new curve subclasses\r\n\r\nTHREE.Curve.create = function(constructor, getPointFunc) {\r\n\r\n  constructor.prototype = Object.create(THREE.Curve.prototype);\r\n  constructor.prototype.constructor = constructor;\r\n  constructor.prototype.getPoint = getPointFunc;\r\n\r\n  return constructor;\r\n\r\n};\r\n\r\n// File:src/extras/core/CurvePath.js\r\n\r\n/**\r\n * @author zz85 / http://www.lab4games.net/zz85/blog\r\n *\r\n **/\r\n\r\n/**************************************************************\r\n *\tCurved Path - a curve path is simply a array of connected\r\n *  curves, but retains the api of a curve\r\n **************************************************************/\r\n\r\nTHREE.CurvePath = function() {\r\n\r\n  this.curves = [];\r\n  this.bends = [];\r\n\r\n  this.autoClose = false; // Automatically closes the path\r\n};\r\n\r\nTHREE.CurvePath.prototype = Object.create(THREE.Curve.prototype);\r\nTHREE.CurvePath.prototype.constructor = THREE.CurvePath;\r\n\r\nTHREE.CurvePath.prototype.add = function(curve) {\r\n\r\n  this.curves.push(curve);\r\n\r\n};\r\n\r\nTHREE.CurvePath.prototype.checkConnection = function() {\r\n  // TODO\r\n  // If the ending of curve is not connected to the starting\r\n  // or the next curve, then, this is not a real path\r\n};\r\n\r\nTHREE.CurvePath.prototype.closePath = function() {\r\n  // TODO Test\r\n  // and verify for vector3 (needs to implement equals)\r\n  // Add a line curve if start and end of lines are not connected\r\n  var startPoint = this.curves[0].getPoint(0);\r\n  var endPoint = this.curves[this.curves.length - 1].getPoint(1);\r\n\r\n  if (!startPoint.equals(endPoint)) {\r\n    this.curves.push(new THREE.LineCurve(endPoint, startPoint));\r\n  }\r\n\r\n};\r\n\r\n// To get accurate point with reference to\r\n// entire path distance at time t,\r\n// following has to be done:\r\n\r\n// 1. Length of each sub path have to be known\r\n// 2. Locate and identify type of curve\r\n// 3. Get t for the curve\r\n// 4. Return curve.getPointAt(t')\r\n\r\nTHREE.CurvePath.prototype.getPoint = function(t) {\r\n\r\n  var d = t * this.getLength();\r\n  var curveLengths = this.getCurveLengths();\r\n  var i = 0,\r\n    diff, curve;\r\n\r\n  // To think about boundaries points.\r\n\r\n  while (i < curveLengths.length) {\r\n\r\n    if (curveLengths[i] >= d) {\r\n\r\n      diff = curveLengths[i] - d;\r\n      curve = this.curves[i];\r\n\r\n      var u = 1 - diff / curve.getLength();\r\n\r\n      return curve.getPointAt(u);\r\n\r\n    }\r\n\r\n    i++;\r\n\r\n  }\r\n\r\n  return null;\r\n\r\n  // loop where sum != 0, sum > d , sum+1 <d\r\n\r\n};\r\n\r\n/*\r\nTHREE.CurvePath.prototype.getTangent = function( t ) {\r\n};*/\r\n\r\n\r\n// We cannot use the default THREE.Curve getPoint() with getLength() because in\r\n// THREE.Curve, getLength() depends on getPoint() but in THREE.CurvePath\r\n// getPoint() depends on getLength\r\n\r\nTHREE.CurvePath.prototype.getLength = function() {\r\n\r\n  var lens = this.getCurveLengths();\r\n  return lens[lens.length - 1];\r\n\r\n};\r\n\r\n// Compute lengths and cache them\r\n// We cannot overwrite getLengths() because UtoT mapping uses it.\r\n\r\nTHREE.CurvePath.prototype.getCurveLengths = function() {\r\n\r\n  // We use cache values if curves and cache array are same length\r\n\r\n  if (this.cacheLengths && this.cacheLengths.length == this.curves.length) {\r\n\r\n    return this.cacheLengths;\r\n\r\n  };\r\n\r\n  // Get length of subsurve\r\n  // Push sums into cached array\r\n\r\n  var lengths = [],\r\n    sums = 0;\r\n  var i, il = this.curves.length;\r\n\r\n  for (i = 0; i < il; i++) {\r\n\r\n    sums += this.curves[i].getLength();\r\n    lengths.push(sums);\r\n\r\n  }\r\n\r\n  this.cacheLengths = lengths;\r\n\r\n  return lengths;\r\n\r\n};\r\n\r\n\r\n\r\n// Returns min and max coordinates\r\n\r\nTHREE.CurvePath.prototype.getBoundingBox = function() {\r\n\r\n  var points = this.getPoints();\r\n\r\n  var maxX, maxY, maxZ;\r\n  var minX, minY, minZ;\r\n\r\n  maxX = maxY = Number.NEGATIVE_INFINITY;\r\n  minX = minY = Number.POSITIVE_INFINITY;\r\n\r\n  var p, i, il, sum;\r\n\r\n  var v3 = points[0] instanceof THREE.Vector3;\r\n\r\n  sum = v3 ? new THREE.Vector3() : new THREE.Vector2();\r\n\r\n  for (i = 0, il = points.length; i < il; i++) {\r\n\r\n    p = points[i];\r\n\r\n    if (p.x > maxX) maxX = p.x;\r\n    else if (p.x < minX) minX = p.x;\r\n\r\n    if (p.y > maxY) maxY = p.y;\r\n    else if (p.y < minY) minY = p.y;\r\n\r\n    if (v3) {\r\n\r\n      if (p.z > maxZ) maxZ = p.z;\r\n      else if (p.z < minZ) minZ = p.z;\r\n\r\n    }\r\n\r\n    sum.add(p);\r\n\r\n  }\r\n\r\n  var ret = {\r\n\r\n    minX: minX,\r\n    minY: minY,\r\n    maxX: maxX,\r\n    maxY: maxY\r\n\r\n  };\r\n\r\n  if (v3) {\r\n\r\n    ret.maxZ = maxZ;\r\n    ret.minZ = minZ;\r\n\r\n  }\r\n\r\n  return ret;\r\n\r\n};\r\n\r\n/**************************************************************\r\n *\tCreate Geometries Helpers\r\n **************************************************************/\r\n\r\n/// Generate geometry from path points (for Line or Points objects)\r\n\r\nTHREE.CurvePath.prototype.createPointsGeometry = function(divisions) {\r\n\r\n  var pts = this.getPoints(divisions, true);\r\n  return this.createGeometry(pts);\r\n\r\n};\r\n\r\n// Generate geometry from equidistance sampling along the path\r\n\r\nTHREE.CurvePath.prototype.createSpacedPointsGeometry = function(divisions) {\r\n\r\n  var pts = this.getSpacedPoints(divisions, true);\r\n  return this.createGeometry(pts);\r\n\r\n};\r\n\r\nTHREE.CurvePath.prototype.createGeometry = function(points) {\r\n\r\n  var geometry = new THREE.Geometry();\r\n\r\n  for (var i = 0; i < points.length; i++) {\r\n\r\n    geometry.vertices.push(new THREE.Vector3(points[i].x, points[i].y, points[i].z || 0));\r\n\r\n  }\r\n\r\n  return geometry;\r\n\r\n};\r\n\r\n\r\n/**************************************************************\r\n *\tBend / Wrap Helper Methods\r\n **************************************************************/\r\n\r\n// Wrap path / Bend modifiers?\r\n\r\nTHREE.CurvePath.prototype.addWrapPath = function(bendpath) {\r\n\r\n  this.bends.push(bendpath);\r\n\r\n};\r\n\r\nTHREE.CurvePath.prototype.getTransformedPoints = function(segments, bends) {\r\n\r\n  var oldPts = this.getPoints(segments); // getPoints getSpacedPoints\r\n  var i, il;\r\n\r\n  if (!bends) {\r\n\r\n    bends = this.bends;\r\n\r\n  }\r\n\r\n  for (i = 0, il = bends.length; i < il; i++) {\r\n\r\n    oldPts = this.getWrapPoints(oldPts, bends[i]);\r\n\r\n  }\r\n\r\n  return oldPts;\r\n\r\n};\r\n\r\nTHREE.CurvePath.prototype.getTransformedSpacedPoints = function(segments, bends) {\r\n\r\n  var oldPts = this.getSpacedPoints(segments);\r\n\r\n  var i, il;\r\n\r\n  if (!bends) {\r\n\r\n    bends = this.bends;\r\n\r\n  }\r\n\r\n  for (i = 0, il = bends.length; i < il; i++) {\r\n\r\n    oldPts = this.getWrapPoints(oldPts, bends[i]);\r\n\r\n  }\r\n\r\n  return oldPts;\r\n\r\n};\r\n\r\n// This returns getPoints() bend/wrapped around the contour of a path.\r\n// Read http://www.planetclegg.com/projects/WarpingTextToSplines.html\r\n\r\nTHREE.CurvePath.prototype.getWrapPoints = function(oldPts, path) {\r\n\r\n  var bounds = this.getBoundingBox();\r\n\r\n  var i, il, p, oldX, oldY, xNorm;\r\n\r\n  for (i = 0, il = oldPts.length; i < il; i++) {\r\n\r\n    p = oldPts[i];\r\n\r\n    oldX = p.x;\r\n    oldY = p.y;\r\n\r\n    xNorm = oldX / bounds.maxX;\r\n\r\n    // If using actual distance, for length > path, requires line extrusions\r\n    //xNorm = path.getUtoTmapping(xNorm, oldX); // 3 styles. 1) wrap stretched. 2) wrap stretch by arc length 3) warp by actual distance\r\n\r\n    xNorm = path.getUtoTmapping(xNorm, oldX);\r\n\r\n    // check for out of bounds?\r\n\r\n    var pathPt = path.getPoint(xNorm);\r\n    var normal = path.getTangent(xNorm);\r\n    normal.set(-normal.y, normal.x).multiplyScalar(oldY);\r\n\r\n    p.x = pathPt.x + normal.x;\r\n    p.y = pathPt.y + normal.y;\r\n\r\n  }\r\n\r\n  return oldPts;\r\n\r\n};\r\n\r\n\r\n// File:src/extras/core/Gyroscope.js\r\n\r\n/**\r\n * @author alteredq / http://alteredqualia.com/\r\n */\r\n\r\nTHREE.Gyroscope = function() {\r\n\r\n  THREE.Object3D.call(this);\r\n\r\n};\r\n\r\nTHREE.Gyroscope.prototype = Object.create(THREE.Object3D.prototype);\r\nTHREE.Gyroscope.prototype.constructor = THREE.Gyroscope;\r\n\r\nTHREE.Gyroscope.prototype.updateMatrixWorld = (function() {\r\n\r\n  var translationObject = new THREE.Vector3();\r\n  var quaternionObject = new THREE.Quaternion();\r\n  var scaleObject = new THREE.Vector3();\r\n\r\n  var translationWorld = new THREE.Vector3();\r\n  var quaternionWorld = new THREE.Quaternion();\r\n  var scaleWorld = new THREE.Vector3();\r\n\r\n  return function(force) {\r\n\r\n    this.matrixAutoUpdate && this.updateMatrix();\r\n\r\n    // update matrixWorld\r\n\r\n    if (this.matrixWorldNeedsUpdate || force) {\r\n\r\n      if (this.parent) {\r\n\r\n        this.matrixWorld.multiplyMatrices(this.parent.matrixWorld, this.matrix);\r\n\r\n        this.matrixWorld.decompose(translationWorld, quaternionWorld, scaleWorld);\r\n        this.matrix.decompose(translationObject, quaternionObject, scaleObject);\r\n\r\n        this.matrixWorld.compose(translationWorld, quaternionObject, scaleWorld);\r\n\r\n\r\n      }\r\n      else {\r\n\r\n        this.matrixWorld.copy(this.matrix);\r\n\r\n      }\r\n\r\n\r\n      this.matrixWorldNeedsUpdate = false;\r\n\r\n      force = true;\r\n\r\n    }\r\n\r\n    // update children\r\n\r\n    for (var i = 0, l = this.children.length; i < l; i++) {\r\n\r\n      this.children[i].updateMatrixWorld(force);\r\n\r\n    }\r\n\r\n  };\r\n\r\n}());\r\n\r\n// File:src/extras/core/Path.js\r\n\r\n/**\r\n * @author zz85 / http://www.lab4games.net/zz85/blog\r\n * Creates free form 2d path using series of points, lines or curves.\r\n *\r\n **/\r\n\r\nTHREE.Path = function(points) {\r\n\r\n  THREE.CurvePath.call(this);\r\n\r\n  this.actions = [];\r\n\r\n  if (points) {\r\n\r\n    this.fromPoints(points);\r\n\r\n  }\r\n\r\n};\r\n\r\nTHREE.Path.prototype = Object.create(THREE.CurvePath.prototype);\r\nTHREE.Path.prototype.constructor = THREE.Path;\r\n\r\nTHREE.PathActions = {\r\n\r\n  MOVE_TO: 'moveTo',\r\n  LINE_TO: 'lineTo',\r\n  QUADRATIC_CURVE_TO: 'quadraticCurveTo', // Bezier quadratic curve\r\n  BEZIER_CURVE_TO: 'bezierCurveTo', // Bezier cubic curve\r\n  CSPLINE_THRU: 'splineThru', // Catmull-rom spline\r\n  ARC: 'arc', // Circle\r\n  ELLIPSE: 'ellipse'\r\n};\r\n\r\n// TODO Clean up PATH API\r\n\r\n// Create path using straight lines to connect all points\r\n// - vectors: array of Vector2\r\n\r\nTHREE.Path.prototype.fromPoints = function(vectors) {\r\n\r\n  this.moveTo(vectors[0].x, vectors[0].y);\r\n\r\n  for (var v = 1, vlen = vectors.length; v < vlen; v++) {\r\n\r\n    this.lineTo(vectors[v].x, vectors[v].y);\r\n\r\n  };\r\n\r\n};\r\n\r\n// startPath() endPath()?\r\n\r\nTHREE.Path.prototype.moveTo = function(x, y) {\r\n\r\n  var args = Array.prototype.slice.call(arguments);\r\n  this.actions.push({\r\n    action: THREE.PathActions.MOVE_TO,\r\n    args: args\r\n  });\r\n\r\n};\r\n\r\nTHREE.Path.prototype.lineTo = function(x, y) {\r\n\r\n  var args = Array.prototype.slice.call(arguments);\r\n\r\n  var lastargs = this.actions[this.actions.length - 1].args;\r\n\r\n  var x0 = lastargs[lastargs.length - 2];\r\n  var y0 = lastargs[lastargs.length - 1];\r\n\r\n  var curve = new THREE.LineCurve(new THREE.Vector2(x0, y0), new THREE.Vector2(x, y));\r\n  this.curves.push(curve);\r\n\r\n  this.actions.push({\r\n    action: THREE.PathActions.LINE_TO,\r\n    args: args\r\n  });\r\n\r\n};\r\n\r\nTHREE.Path.prototype.quadraticCurveTo = function(aCPx, aCPy, aX, aY) {\r\n\r\n  var args = Array.prototype.slice.call(arguments);\r\n\r\n  var lastargs = this.actions[this.actions.length - 1].args;\r\n\r\n  var x0 = lastargs[lastargs.length - 2];\r\n  var y0 = lastargs[lastargs.length - 1];\r\n\r\n  var curve = new THREE.QuadraticBezierCurve(new THREE.Vector2(x0, y0),\r\n    new THREE.Vector2(aCPx, aCPy),\r\n    new THREE.Vector2(aX, aY));\r\n  this.curves.push(curve);\r\n\r\n  this.actions.push({\r\n    action: THREE.PathActions.QUADRATIC_CURVE_TO,\r\n    args: args\r\n  });\r\n\r\n};\r\n\r\nTHREE.Path.prototype.bezierCurveTo = function(aCP1x, aCP1y,\r\n  aCP2x, aCP2y,\r\n  aX, aY) {\r\n\r\n  var args = Array.prototype.slice.call(arguments);\r\n\r\n  var lastargs = this.actions[this.actions.length - 1].args;\r\n\r\n  var x0 = lastargs[lastargs.length - 2];\r\n  var y0 = lastargs[lastargs.length - 1];\r\n\r\n  var curve = new THREE.CubicBezierCurve(new THREE.Vector2(x0, y0),\r\n    new THREE.Vector2(aCP1x, aCP1y),\r\n    new THREE.Vector2(aCP2x, aCP2y),\r\n    new THREE.Vector2(aX, aY));\r\n  this.curves.push(curve);\r\n\r\n  this.actions.push({\r\n    action: THREE.PathActions.BEZIER_CURVE_TO,\r\n    args: args\r\n  });\r\n\r\n};\r\n\r\nTHREE.Path.prototype.splineThru = function(pts /*Array of Vector*/ ) {\r\n\r\n  var args = Array.prototype.slice.call(arguments);\r\n  var lastargs = this.actions[this.actions.length - 1].args;\r\n\r\n  var x0 = lastargs[lastargs.length - 2];\r\n  var y0 = lastargs[lastargs.length - 1];\r\n  //---\r\n  var npts = [new THREE.Vector2(x0, y0)];\r\n  Array.prototype.push.apply(npts, pts);\r\n\r\n  var curve = new THREE.SplineCurve(npts);\r\n  this.curves.push(curve);\r\n\r\n  this.actions.push({\r\n    action: THREE.PathActions.CSPLINE_THRU,\r\n    args: args\r\n  });\r\n\r\n};\r\n\r\n// FUTURE: Change the API or follow canvas API?\r\n\r\nTHREE.Path.prototype.arc = function(aX, aY, aRadius,\r\n  aStartAngle, aEndAngle, aClockwise) {\r\n\r\n  var lastargs = this.actions[this.actions.length - 1].args;\r\n  var x0 = lastargs[lastargs.length - 2];\r\n  var y0 = lastargs[lastargs.length - 1];\r\n\r\n  this.absarc(aX + x0, aY + y0, aRadius,\r\n    aStartAngle, aEndAngle, aClockwise);\r\n\r\n};\r\n\r\nTHREE.Path.prototype.absarc = function(aX, aY, aRadius,\r\n  aStartAngle, aEndAngle, aClockwise) {\r\n  this.absellipse(aX, aY, aRadius, aRadius, aStartAngle, aEndAngle, aClockwise);\r\n};\r\n\r\nTHREE.Path.prototype.ellipse = function(aX, aY, xRadius, yRadius,\r\n  aStartAngle, aEndAngle, aClockwise) {\r\n\r\n  var lastargs = this.actions[this.actions.length - 1].args;\r\n  var x0 = lastargs[lastargs.length - 2];\r\n  var y0 = lastargs[lastargs.length - 1];\r\n\r\n  this.absellipse(aX + x0, aY + y0, xRadius, yRadius,\r\n    aStartAngle, aEndAngle, aClockwise);\r\n\r\n};\r\n\r\n\r\nTHREE.Path.prototype.absellipse = function(aX, aY, xRadius, yRadius,\r\n  aStartAngle, aEndAngle, aClockwise) {\r\n\r\n  var args = Array.prototype.slice.call(arguments);\r\n  var curve = new THREE.EllipseCurve(aX, aY, xRadius, yRadius,\r\n    aStartAngle, aEndAngle, aClockwise);\r\n  this.curves.push(curve);\r\n\r\n  var lastPoint = curve.getPoint(1);\r\n  args.push(lastPoint.x);\r\n  args.push(lastPoint.y);\r\n\r\n  this.actions.push({\r\n    action: THREE.PathActions.ELLIPSE,\r\n    args: args\r\n  });\r\n\r\n};\r\n\r\nTHREE.Path.prototype.getSpacedPoints = function(divisions, closedPath) {\r\n\r\n  if (!divisions) divisions = 40;\r\n\r\n  var points = [];\r\n\r\n  for (var i = 0; i < divisions; i++) {\r\n\r\n    points.push(this.getPoint(i / divisions));\r\n\r\n    //if( !this.getPoint( i / divisions ) ) throw \"DIE\";\r\n\r\n  }\r\n\r\n  // if ( closedPath ) {\r\n  //\r\n  // \tpoints.push( points[ 0 ] );\r\n  //\r\n  // }\r\n\r\n  return points;\r\n\r\n};\r\n\r\n/* Return an array of vectors based on contour of the path */\r\n\r\nTHREE.Path.prototype.getPoints = function(divisions, closedPath) {\r\n\r\n  if (this.useSpacedPoints) {\r\n    console.log('tata');\r\n    return this.getSpacedPoints(divisions, closedPath);\r\n  }\r\n\r\n  divisions = divisions || 12;\r\n\r\n  var points = [];\r\n\r\n  var i, il, item, action, args;\r\n  var cpx, cpy, cpx2, cpy2, cpx1, cpy1, cpx0, cpy0,\r\n    laste, j,\r\n    t, tx, ty;\r\n\r\n  for (i = 0, il = this.actions.length; i < il; i++) {\r\n\r\n    item = this.actions[i];\r\n\r\n    action = item.action;\r\n    args = item.args;\r\n\r\n    switch (action) {\r\n\r\n      case THREE.PathActions.MOVE_TO:\r\n\r\n        points.push(new THREE.Vector2(args[0], args[1]));\r\n\r\n        break;\r\n\r\n      case THREE.PathActions.LINE_TO:\r\n\r\n        points.push(new THREE.Vector2(args[0], args[1]));\r\n\r\n        break;\r\n\r\n      case THREE.PathActions.QUADRATIC_CURVE_TO:\r\n\r\n        cpx = args[2];\r\n        cpy = args[3];\r\n\r\n        cpx1 = args[0];\r\n        cpy1 = args[1];\r\n\r\n        if (points.length > 0) {\r\n\r\n          laste = points[points.length - 1];\r\n\r\n          cpx0 = laste.x;\r\n          cpy0 = laste.y;\r\n\r\n        }\r\n        else {\r\n\r\n          laste = this.actions[i - 1].args;\r\n\r\n          cpx0 = laste[laste.length - 2];\r\n          cpy0 = laste[laste.length - 1];\r\n\r\n        }\r\n\r\n        for (j = 1; j <= divisions; j++) {\r\n\r\n          t = j / divisions;\r\n\r\n          tx = THREE.Shape.Utils.b2(t, cpx0, cpx1, cpx);\r\n          ty = THREE.Shape.Utils.b2(t, cpy0, cpy1, cpy);\r\n\r\n          points.push(new THREE.Vector2(tx, ty));\r\n\r\n        }\r\n\r\n        break;\r\n\r\n      case THREE.PathActions.BEZIER_CURVE_TO:\r\n\r\n        cpx = args[4];\r\n        cpy = args[5];\r\n\r\n        cpx1 = args[0];\r\n        cpy1 = args[1];\r\n\r\n        cpx2 = args[2];\r\n        cpy2 = args[3];\r\n\r\n        if (points.length > 0) {\r\n\r\n          laste = points[points.length - 1];\r\n\r\n          cpx0 = laste.x;\r\n          cpy0 = laste.y;\r\n\r\n        }\r\n        else {\r\n\r\n          laste = this.actions[i - 1].args;\r\n\r\n          cpx0 = laste[laste.length - 2];\r\n          cpy0 = laste[laste.length - 1];\r\n\r\n        }\r\n\r\n\r\n        for (j = 1; j <= divisions; j++) {\r\n\r\n          t = j / divisions;\r\n\r\n          tx = THREE.Shape.Utils.b3(t, cpx0, cpx1, cpx2, cpx);\r\n          ty = THREE.Shape.Utils.b3(t, cpy0, cpy1, cpy2, cpy);\r\n\r\n          points.push(new THREE.Vector2(tx, ty));\r\n\r\n        }\r\n\r\n        break;\r\n\r\n      case THREE.PathActions.CSPLINE_THRU:\r\n\r\n        laste = this.actions[i - 1].args;\r\n\r\n        var last = new THREE.Vector2(laste[laste.length - 2], laste[laste.length - 1]);\r\n        var spts = [last];\r\n\r\n        var n = divisions * args[0].length;\r\n\r\n        spts = spts.concat(args[0]);\r\n\r\n        var spline = new THREE.SplineCurve(spts);\r\n\r\n        for (j = 1; j <= n; j++) {\r\n\r\n          points.push(spline.getPointAt(j / n));\r\n\r\n        }\r\n\r\n        break;\r\n\r\n      case THREE.PathActions.ARC:\r\n\r\n        var aX = args[0],\r\n          aY = args[1],\r\n          aRadius = args[2],\r\n          aStartAngle = args[3],\r\n          aEndAngle = args[4],\r\n          aClockwise = !!args[5];\r\n\r\n        var deltaAngle = aEndAngle - aStartAngle;\r\n        var angle;\r\n        var tdivisions = divisions * 2;\r\n\r\n        for (j = 1; j <= tdivisions; j++) {\r\n\r\n          t = j / tdivisions;\r\n\r\n          if (!aClockwise) {\r\n\r\n            t = 1 - t;\r\n\r\n          }\r\n\r\n          angle = aStartAngle + t * deltaAngle;\r\n\r\n          tx = aX + aRadius * Math.cos(angle);\r\n          ty = aY + aRadius * Math.sin(angle);\r\n\r\n          //console.log('t', t, 'angle', angle, 'tx', tx, 'ty', ty);\r\n\r\n          points.push(new THREE.Vector2(tx, ty));\r\n\r\n        }\r\n\r\n        //console.log(points);\r\n\r\n        break;\r\n\r\n      case THREE.PathActions.ELLIPSE:\r\n\r\n        var aX = args[0],\r\n          aY = args[1],\r\n          xRadius = args[2],\r\n          yRadius = args[3],\r\n          aStartAngle = args[4],\r\n          aEndAngle = args[5],\r\n          aClockwise = !!args[6];\r\n\r\n\r\n        var deltaAngle = aEndAngle - aStartAngle;\r\n        var angle;\r\n        var tdivisions = divisions * 2;\r\n\r\n        for (j = 1; j <= tdivisions; j++) {\r\n\r\n          t = j / tdivisions;\r\n\r\n          if (!aClockwise) {\r\n\r\n            t = 1 - t;\r\n\r\n          }\r\n\r\n          angle = aStartAngle + t * deltaAngle;\r\n\r\n          tx = aX + xRadius * Math.cos(angle);\r\n          ty = aY + yRadius * Math.sin(angle);\r\n\r\n          //console.log('t', t, 'angle', angle, 'tx', tx, 'ty', ty);\r\n\r\n          points.push(new THREE.Vector2(tx, ty));\r\n\r\n        }\r\n\r\n        //console.log(points);\r\n\r\n        break;\r\n\r\n    } // end switch\r\n\r\n  }\r\n\r\n\r\n\r\n  // Normalize to remove the closing point by default.\r\n  var lastPoint = points[points.length - 1];\r\n  var EPSILON = 0.0000000001;\r\n  if (Math.abs(lastPoint.x - points[0].x) < EPSILON &&\r\n    Math.abs(lastPoint.y - points[0].y) < EPSILON)\r\n    points.splice(points.length - 1, 1);\r\n  if (closedPath) {\r\n\r\n    points.push(points[0]);\r\n\r\n  }\r\n\r\n  return points;\r\n\r\n};\r\n\r\n//\r\n// Breaks path into shapes\r\n//\r\n//\tAssumptions (if parameter isCCW==true the opposite holds):\r\n//\t- solid shapes are defined clockwise (CW)\r\n//\t- holes are defined counterclockwise (CCW)\r\n//\r\n//\tIf parameter noHoles==true:\r\n//  - all subPaths are regarded as solid shapes\r\n//  - definition order CW/CCW has no relevance\r\n//\r\n\r\nTHREE.Path.prototype.toShapes = function(isCCW, noHoles) {\r\n\r\n  function extractSubpaths(inActions) {\r\n\r\n    var i, il, item, action, args;\r\n\r\n    var subPaths = [],\r\n      lastPath = new THREE.Path();\r\n\r\n    for (i = 0, il = inActions.length; i < il; i++) {\r\n\r\n      item = inActions[i];\r\n\r\n      args = item.args;\r\n      action = item.action;\r\n\r\n      if (action == THREE.PathActions.MOVE_TO) {\r\n\r\n        if (lastPath.actions.length != 0) {\r\n\r\n          subPaths.push(lastPath);\r\n          lastPath = new THREE.Path();\r\n\r\n        }\r\n\r\n      }\r\n\r\n      lastPath[action].apply(lastPath, args);\r\n\r\n    }\r\n\r\n    if (lastPath.actions.length != 0) {\r\n\r\n      subPaths.push(lastPath);\r\n\r\n    }\r\n\r\n    // console.log(subPaths);\r\n\r\n    return subPaths;\r\n  }\r\n\r\n  function toShapesNoHoles(inSubpaths) {\r\n\r\n    var shapes = [];\r\n\r\n    for (var i = 0, il = inSubpaths.length; i < il; i++) {\r\n\r\n      var tmpPath = inSubpaths[i];\r\n\r\n      var tmpShape = new THREE.Shape();\r\n      tmpShape.actions = tmpPath.actions;\r\n      tmpShape.curves = tmpPath.curves;\r\n\r\n      shapes.push(tmpShape);\r\n    }\r\n\r\n    //console.log(\"shape\", shapes);\r\n\r\n    return shapes;\r\n  };\r\n\r\n  function isPointInsidePolygon(inPt, inPolygon) {\r\n    var EPSILON = 0.0000000001;\r\n\r\n    var polyLen = inPolygon.length;\r\n\r\n    // inPt on polygon contour => immediate success    or\r\n    // toggling of inside/outside at every single! intersection point of an edge\r\n    //  with the horizontal line through inPt, left of inPt\r\n    //  not counting lowerY endpoints of edges and whole edges on that line\r\n    var inside = false;\r\n    for (var p = polyLen - 1, q = 0; q < polyLen; p = q++) {\r\n      var edgeLowPt = inPolygon[p];\r\n      var edgeHighPt = inPolygon[q];\r\n\r\n      var edgeDx = edgeHighPt.x - edgeLowPt.x;\r\n      var edgeDy = edgeHighPt.y - edgeLowPt.y;\r\n\r\n      if (Math.abs(edgeDy) > EPSILON) { // not parallel\r\n        if (edgeDy < 0) {\r\n          edgeLowPt = inPolygon[q];\r\n          edgeDx = -edgeDx;\r\n          edgeHighPt = inPolygon[p];\r\n          edgeDy = -edgeDy;\r\n        }\r\n        if ((inPt.y < edgeLowPt.y) || (inPt.y > edgeHighPt.y)) continue;\r\n\r\n        if (inPt.y == edgeLowPt.y) {\r\n          if (inPt.x == edgeLowPt.x) return true; // inPt is on contour ?\r\n          // continue;\t\t\t\t// no intersection or edgeLowPt => doesn't count !!!\r\n        }\r\n        else {\r\n          var perpEdge = edgeDy * (inPt.x - edgeLowPt.x) - edgeDx * (inPt.y - edgeLowPt.y);\r\n          if (perpEdge == 0) return true; // inPt is on contour ?\r\n          if (perpEdge < 0) continue;\r\n          inside = !inside; // true intersection left of inPt\r\n        }\r\n      }\r\n      else { // parallel or colinear\r\n        if (inPt.y != edgeLowPt.y) continue; // parallel\r\n        // egde lies on the same horizontal line as inPt\r\n        if (((edgeHighPt.x <= inPt.x) && (inPt.x <= edgeLowPt.x)) ||\r\n          ((edgeLowPt.x <= inPt.x) && (inPt.x <= edgeHighPt.x))) return true; // inPt: Point on contour !\r\n        // continue;\r\n      }\r\n    }\r\n\r\n    return inside;\r\n  }\r\n\r\n\r\n  var subPaths = extractSubpaths(this.actions);\r\n  if (subPaths.length == 0) return [];\r\n\r\n  if (noHoles === true) return toShapesNoHoles(subPaths);\r\n\r\n\r\n  var solid, tmpPath, tmpShape, shapes = [];\r\n\r\n  if (subPaths.length == 1) {\r\n\r\n    tmpPath = subPaths[0];\r\n    tmpShape = new THREE.Shape();\r\n    tmpShape.actions = tmpPath.actions;\r\n    tmpShape.curves = tmpPath.curves;\r\n    shapes.push(tmpShape);\r\n    return shapes;\r\n\r\n  }\r\n\r\n  var holesFirst = !THREE.Shape.Utils.isClockWise(subPaths[0].getPoints());\r\n  holesFirst = isCCW ? !holesFirst : holesFirst;\r\n\r\n  // console.log(\"Holes first\", holesFirst);\r\n\r\n  var betterShapeHoles = [];\r\n  var newShapes = [];\r\n  var newShapeHoles = [];\r\n  var mainIdx = 0;\r\n  var tmpPoints;\r\n\r\n  newShapes[mainIdx] = undefined;\r\n  newShapeHoles[mainIdx] = [];\r\n\r\n  var i, il;\r\n\r\n  for (i = 0, il = subPaths.length; i < il; i++) {\r\n\r\n    tmpPath = subPaths[i];\r\n    tmpPoints = tmpPath.getPoints();\r\n    solid = THREE.Shape.Utils.isClockWise(tmpPoints);\r\n    solid = isCCW ? !solid : solid;\r\n\r\n    if (solid) {\r\n\r\n      if ((!holesFirst) && (newShapes[mainIdx])) mainIdx++;\r\n\r\n      newShapes[mainIdx] = {\r\n        s: new THREE.Shape(),\r\n        p: tmpPoints\r\n      };\r\n      newShapes[mainIdx].s.actions = tmpPath.actions;\r\n      newShapes[mainIdx].s.curves = tmpPath.curves;\r\n\r\n      if (holesFirst) mainIdx++;\r\n      newShapeHoles[mainIdx] = [];\r\n\r\n      //console.log('cw', i);\r\n\r\n    }\r\n    else {\r\n\r\n      newShapeHoles[mainIdx].push({\r\n        h: tmpPath,\r\n        p: tmpPoints[0]\r\n      });\r\n\r\n      //console.log('ccw', i);\r\n\r\n    }\r\n\r\n  }\r\n\r\n  // only Holes? -> probably all Shapes with wrong orientation\r\n  if (!newShapes[0]) return toShapesNoHoles(subPaths);\r\n\r\n\r\n  if (newShapes.length > 1) {\r\n    var ambigious = false;\r\n    var toChange = [];\r\n\r\n    for (var sIdx = 0, sLen = newShapes.length; sIdx < sLen; sIdx++) {\r\n      betterShapeHoles[sIdx] = [];\r\n    }\r\n    for (var sIdx = 0, sLen = newShapes.length; sIdx < sLen; sIdx++) {\r\n      var sho = newShapeHoles[sIdx];\r\n      for (var hIdx = 0; hIdx < sho.length; hIdx++) {\r\n        var ho = sho[hIdx];\r\n        var hole_unassigned = true;\r\n        for (var s2Idx = 0; s2Idx < newShapes.length; s2Idx++) {\r\n          if (isPointInsidePolygon(ho.p, newShapes[s2Idx].p)) {\r\n            if (sIdx != s2Idx) toChange.push({\r\n              froms: sIdx,\r\n              tos: s2Idx,\r\n              hole: hIdx\r\n            });\r\n            if (hole_unassigned) {\r\n              hole_unassigned = false;\r\n              betterShapeHoles[s2Idx].push(ho);\r\n            }\r\n            else {\r\n              ambigious = true;\r\n            }\r\n          }\r\n        }\r\n        if (hole_unassigned) {\r\n          betterShapeHoles[sIdx].push(ho);\r\n        }\r\n      }\r\n    }\r\n    // console.log(\"ambigious: \", ambigious);\r\n    if (toChange.length > 0) {\r\n      // console.log(\"to change: \", toChange);\r\n      if (!ambigious) newShapeHoles = betterShapeHoles;\r\n    }\r\n  }\r\n\r\n  var tmpHoles, j, jl;\r\n  for (i = 0, il = newShapes.length; i < il; i++) {\r\n    tmpShape = newShapes[i].s;\r\n    shapes.push(tmpShape);\r\n    tmpHoles = newShapeHoles[i];\r\n    for (j = 0, jl = tmpHoles.length; j < jl; j++) {\r\n      tmpShape.holes.push(tmpHoles[j].h);\r\n    }\r\n  }\r\n\r\n  //console.log(\"shape\", shapes);\r\n\r\n  return shapes;\r\n\r\n};\r\n\r\n// File:src/extras/core/Shape.js\r\n\r\n/**\r\n * @author zz85 / http://www.lab4games.net/zz85/blog\r\n * Defines a 2d shape plane using paths.\r\n **/\r\n\r\n// STEP 1 Create a path.\r\n// STEP 2 Turn path into shape.\r\n// STEP 3 ExtrudeGeometry takes in Shape/Shapes\r\n// STEP 3a - Extract points from each shape, turn to vertices\r\n// STEP 3b - Triangulate each shape, add faces.\r\n\r\nTHREE.Shape = function() {\r\n\r\n  THREE.Path.apply(this, arguments);\r\n  this.holes = [];\r\n\r\n};\r\n\r\nTHREE.Shape.prototype = Object.create(THREE.Path.prototype);\r\nTHREE.Shape.prototype.constructor = THREE.Shape;\r\n\r\n// Convenience method to return ExtrudeGeometry\r\n\r\nTHREE.Shape.prototype.extrude = function(options) {\r\n\r\n  var extruded = new THREE.ExtrudeGeometry(this, options);\r\n  return extruded;\r\n\r\n};\r\n\r\n// Convenience method to return ShapeGeometry\r\n\r\nTHREE.Shape.prototype.makeGeometry = function(options) {\r\n\r\n  var geometry = new THREE.ShapeGeometry(this, options);\r\n  return geometry;\r\n\r\n};\r\n\r\n// Get points of holes\r\n\r\nTHREE.Shape.prototype.getPointsHoles = function(divisions) {\r\n\r\n  var i, il = this.holes.length,\r\n    holesPts = [];\r\n\r\n  for (i = 0; i < il; i++) {\r\n\r\n    holesPts[i] = this.holes[i].getTransformedPoints(divisions, this.bends);\r\n\r\n  }\r\n\r\n  return holesPts;\r\n\r\n};\r\n\r\n// Get points of holes (spaced by regular distance)\r\n\r\nTHREE.Shape.prototype.getSpacedPointsHoles = function(divisions) {\r\n\r\n  var i, il = this.holes.length,\r\n    holesPts = [];\r\n\r\n  for (i = 0; i < il; i++) {\r\n\r\n    holesPts[i] = this.holes[i].getTransformedSpacedPoints(divisions, this.bends);\r\n\r\n  }\r\n\r\n  return holesPts;\r\n\r\n};\r\n\r\n\r\n// Get points of shape and holes (keypoints based on segments parameter)\r\n\r\nTHREE.Shape.prototype.extractAllPoints = function(divisions) {\r\n\r\n  return {\r\n\r\n    shape: this.getTransformedPoints(divisions),\r\n    holes: this.getPointsHoles(divisions)\r\n\r\n  };\r\n\r\n};\r\n\r\nTHREE.Shape.prototype.extractPoints = function(divisions) {\r\n\r\n  if (this.useSpacedPoints) {\r\n    return this.extractAllSpacedPoints(divisions);\r\n  }\r\n\r\n  return this.extractAllPoints(divisions);\r\n\r\n};\r\n\r\n//\r\n// THREE.Shape.prototype.extractAllPointsWithBend = function ( divisions, bend ) {\r\n//\r\n// \treturn {\r\n//\r\n// \t\tshape: this.transform( bend, divisions ),\r\n// \t\tholes: this.getPointsHoles( divisions, bend )\r\n//\r\n// \t};\r\n//\r\n// };\r\n\r\n// Get points of shape and holes (spaced by regular distance)\r\n\r\nTHREE.Shape.prototype.extractAllSpacedPoints = function(divisions) {\r\n\r\n  return {\r\n\r\n    shape: this.getTransformedSpacedPoints(divisions),\r\n    holes: this.getSpacedPointsHoles(divisions)\r\n\r\n  };\r\n\r\n};\r\n\r\n/**************************************************************\r\n *\tUtils\r\n **************************************************************/\r\n\r\nTHREE.Shape.Utils = {\r\n\r\n  triangulateShape: function(contour, holes) {\r\n\r\n    function point_in_segment_2D_colin(inSegPt1, inSegPt2, inOtherPt) {\r\n      // inOtherPt needs to be colinear to the inSegment\r\n      if (inSegPt1.x != inSegPt2.x) {\r\n        if (inSegPt1.x < inSegPt2.x) {\r\n          return ((inSegPt1.x <= inOtherPt.x) && (inOtherPt.x <= inSegPt2.x));\r\n        }\r\n        else {\r\n          return ((inSegPt2.x <= inOtherPt.x) && (inOtherPt.x <= inSegPt1.x));\r\n        }\r\n      }\r\n      else {\r\n        if (inSegPt1.y < inSegPt2.y) {\r\n          return ((inSegPt1.y <= inOtherPt.y) && (inOtherPt.y <= inSegPt2.y));\r\n        }\r\n        else {\r\n          return ((inSegPt2.y <= inOtherPt.y) && (inOtherPt.y <= inSegPt1.y));\r\n        }\r\n      }\r\n    }\r\n\r\n    function intersect_segments_2D(inSeg1Pt1, inSeg1Pt2, inSeg2Pt1, inSeg2Pt2, inExcludeAdjacentSegs) {\r\n      var EPSILON = 0.0000000001;\r\n\r\n      var seg1dx = inSeg1Pt2.x - inSeg1Pt1.x,\r\n        seg1dy = inSeg1Pt2.y - inSeg1Pt1.y;\r\n      var seg2dx = inSeg2Pt2.x - inSeg2Pt1.x,\r\n        seg2dy = inSeg2Pt2.y - inSeg2Pt1.y;\r\n\r\n      var seg1seg2dx = inSeg1Pt1.x - inSeg2Pt1.x;\r\n      var seg1seg2dy = inSeg1Pt1.y - inSeg2Pt1.y;\r\n\r\n      var limit = seg1dy * seg2dx - seg1dx * seg2dy;\r\n      var perpSeg1 = seg1dy * seg1seg2dx - seg1dx * seg1seg2dy;\r\n\r\n      if (Math.abs(limit) > EPSILON) { // not parallel\r\n\r\n        var perpSeg2;\r\n        if (limit > 0) {\r\n          if ((perpSeg1 < 0) || (perpSeg1 > limit)) return [];\r\n          perpSeg2 = seg2dy * seg1seg2dx - seg2dx * seg1seg2dy;\r\n          if ((perpSeg2 < 0) || (perpSeg2 > limit)) return [];\r\n        }\r\n        else {\r\n          if ((perpSeg1 > 0) || (perpSeg1 < limit)) return [];\r\n          perpSeg2 = seg2dy * seg1seg2dx - seg2dx * seg1seg2dy;\r\n          if ((perpSeg2 > 0) || (perpSeg2 < limit)) return [];\r\n        }\r\n\r\n        // i.e. to reduce rounding errors\r\n        // intersection at endpoint of segment#1?\r\n        if (perpSeg2 == 0) {\r\n          if ((inExcludeAdjacentSegs) &&\r\n            ((perpSeg1 == 0) || (perpSeg1 == limit))) return [];\r\n          return [inSeg1Pt1];\r\n        }\r\n        if (perpSeg2 == limit) {\r\n          if ((inExcludeAdjacentSegs) &&\r\n            ((perpSeg1 == 0) || (perpSeg1 == limit))) return [];\r\n          return [inSeg1Pt2];\r\n        }\r\n        // intersection at endpoint of segment#2?\r\n        if (perpSeg1 == 0) return [inSeg2Pt1];\r\n        if (perpSeg1 == limit) return [inSeg2Pt2];\r\n\r\n        // return real intersection point\r\n        var factorSeg1 = perpSeg2 / limit;\r\n        return [{\r\n          x: inSeg1Pt1.x + factorSeg1 * seg1dx,\r\n          y: inSeg1Pt1.y + factorSeg1 * seg1dy\r\n        }];\r\n\r\n      }\r\n      else { // parallel or colinear\r\n        if ((perpSeg1 != 0) ||\r\n          (seg2dy * seg1seg2dx != seg2dx * seg1seg2dy)) return [];\r\n\r\n        // they are collinear or degenerate\r\n        var seg1Pt = ((seg1dx == 0) && (seg1dy == 0)); // segment1 ist just a point?\r\n        var seg2Pt = ((seg2dx == 0) && (seg2dy == 0)); // segment2 ist just a point?\r\n        // both segments are points\r\n        if (seg1Pt && seg2Pt) {\r\n          if ((inSeg1Pt1.x != inSeg2Pt1.x) ||\r\n            (inSeg1Pt1.y != inSeg2Pt1.y)) return []; // they are distinct  points\r\n          return [inSeg1Pt1]; // they are the same point\r\n        }\r\n        // segment#1  is a single point\r\n        if (seg1Pt) {\r\n          if (!point_in_segment_2D_colin(inSeg2Pt1, inSeg2Pt2, inSeg1Pt1)) return []; // but not in segment#2\r\n          return [inSeg1Pt1];\r\n        }\r\n        // segment#2  is a single point\r\n        if (seg2Pt) {\r\n          if (!point_in_segment_2D_colin(inSeg1Pt1, inSeg1Pt2, inSeg2Pt1)) return []; // but not in segment#1\r\n          return [inSeg2Pt1];\r\n        }\r\n\r\n        // they are collinear segments, which might overlap\r\n        var seg1min, seg1max, seg1minVal, seg1maxVal;\r\n        var seg2min, seg2max, seg2minVal, seg2maxVal;\r\n        if (seg1dx != 0) { // the segments are NOT on a vertical line\r\n          if (inSeg1Pt1.x < inSeg1Pt2.x) {\r\n            seg1min = inSeg1Pt1;\r\n            seg1minVal = inSeg1Pt1.x;\r\n            seg1max = inSeg1Pt2;\r\n            seg1maxVal = inSeg1Pt2.x;\r\n          }\r\n          else {\r\n            seg1min = inSeg1Pt2;\r\n            seg1minVal = inSeg1Pt2.x;\r\n            seg1max = inSeg1Pt1;\r\n            seg1maxVal = inSeg1Pt1.x;\r\n          }\r\n          if (inSeg2Pt1.x < inSeg2Pt2.x) {\r\n            seg2min = inSeg2Pt1;\r\n            seg2minVal = inSeg2Pt1.x;\r\n            seg2max = inSeg2Pt2;\r\n            seg2maxVal = inSeg2Pt2.x;\r\n          }\r\n          else {\r\n            seg2min = inSeg2Pt2;\r\n            seg2minVal = inSeg2Pt2.x;\r\n            seg2max = inSeg2Pt1;\r\n            seg2maxVal = inSeg2Pt1.x;\r\n          }\r\n        }\r\n        else { // the segments are on a vertical line\r\n          if (inSeg1Pt1.y < inSeg1Pt2.y) {\r\n            seg1min = inSeg1Pt1;\r\n            seg1minVal = inSeg1Pt1.y;\r\n            seg1max = inSeg1Pt2;\r\n            seg1maxVal = inSeg1Pt2.y;\r\n          }\r\n          else {\r\n            seg1min = inSeg1Pt2;\r\n            seg1minVal = inSeg1Pt2.y;\r\n            seg1max = inSeg1Pt1;\r\n            seg1maxVal = inSeg1Pt1.y;\r\n          }\r\n          if (inSeg2Pt1.y < inSeg2Pt2.y) {\r\n            seg2min = inSeg2Pt1;\r\n            seg2minVal = inSeg2Pt1.y;\r\n            seg2max = inSeg2Pt2;\r\n            seg2maxVal = inSeg2Pt2.y;\r\n          }\r\n          else {\r\n            seg2min = inSeg2Pt2;\r\n            seg2minVal = inSeg2Pt2.y;\r\n            seg2max = inSeg2Pt1;\r\n            seg2maxVal = inSeg2Pt1.y;\r\n          }\r\n        }\r\n        if (seg1minVal <= seg2minVal) {\r\n          if (seg1maxVal < seg2minVal) return [];\r\n          if (seg1maxVal == seg2minVal) {\r\n            if (inExcludeAdjacentSegs) return [];\r\n            return [seg2min];\r\n          }\r\n          if (seg1maxVal <= seg2maxVal) return [seg2min, seg1max];\r\n          return [seg2min, seg2max];\r\n        }\r\n        else {\r\n          if (seg1minVal > seg2maxVal) return [];\r\n          if (seg1minVal == seg2maxVal) {\r\n            if (inExcludeAdjacentSegs) return [];\r\n            return [seg1min];\r\n          }\r\n          if (seg1maxVal <= seg2maxVal) return [seg1min, seg1max];\r\n          return [seg1min, seg2max];\r\n        }\r\n      }\r\n    }\r\n\r\n    function isPointInsideAngle(inVertex, inLegFromPt, inLegToPt, inOtherPt) {\r\n      // The order of legs is important\r\n\r\n      var EPSILON = 0.0000000001;\r\n\r\n      // translation of all points, so that Vertex is at (0,0)\r\n      var legFromPtX = inLegFromPt.x - inVertex.x,\r\n        legFromPtY = inLegFromPt.y - inVertex.y;\r\n      var legToPtX = inLegToPt.x - inVertex.x,\r\n        legToPtY = inLegToPt.y - inVertex.y;\r\n      var otherPtX = inOtherPt.x - inVertex.x,\r\n        otherPtY = inOtherPt.y - inVertex.y;\r\n\r\n      // main angle >0: < 180 deg.; 0: 180 deg.; <0: > 180 deg.\r\n      var from2toAngle = legFromPtX * legToPtY - legFromPtY * legToPtX;\r\n      var from2otherAngle = legFromPtX * otherPtY - legFromPtY * otherPtX;\r\n\r\n      if (Math.abs(from2toAngle) > EPSILON) { // angle != 180 deg.\r\n\r\n        var other2toAngle = otherPtX * legToPtY - otherPtY * legToPtX;\r\n        // console.log( \"from2to: \" + from2toAngle + \", from2other: \" + from2otherAngle + \", other2to: \" + other2toAngle );\r\n\r\n        if (from2toAngle > 0) { // main angle < 180 deg.\r\n          return ((from2otherAngle >= 0) && (other2toAngle >= 0));\r\n        }\r\n        else { // main angle > 180 deg.\r\n          return ((from2otherAngle >= 0) || (other2toAngle >= 0));\r\n        }\r\n      }\r\n      else { // angle == 180 deg.\r\n        // console.log( \"from2to: 180 deg., from2other: \" + from2otherAngle  );\r\n        return (from2otherAngle > 0);\r\n      }\r\n    }\r\n\r\n\r\n    function removeHoles(contour, holes) {\r\n\r\n      var shape = contour.concat(); // work on this shape\r\n      var hole;\r\n\r\n      function isCutLineInsideAngles(inShapeIdx, inHoleIdx) {\r\n        // Check if hole point lies within angle around shape point\r\n        var lastShapeIdx = shape.length - 1;\r\n\r\n        var prevShapeIdx = inShapeIdx - 1;\r\n        if (prevShapeIdx < 0) prevShapeIdx = lastShapeIdx;\r\n\r\n        var nextShapeIdx = inShapeIdx + 1;\r\n        if (nextShapeIdx > lastShapeIdx) nextShapeIdx = 0;\r\n\r\n        var insideAngle = isPointInsideAngle(shape[inShapeIdx], shape[prevShapeIdx], shape[nextShapeIdx], hole[inHoleIdx]);\r\n        if (!insideAngle) {\r\n          // console.log( \"Vertex (Shape): \" + inShapeIdx + \", Point: \" + hole[inHoleIdx].x + \"/\" + hole[inHoleIdx].y );\r\n          return false;\r\n        }\r\n\r\n        // Check if shape point lies within angle around hole point\r\n        var lastHoleIdx = hole.length - 1;\r\n\r\n        var prevHoleIdx = inHoleIdx - 1;\r\n        if (prevHoleIdx < 0) prevHoleIdx = lastHoleIdx;\r\n\r\n        var nextHoleIdx = inHoleIdx + 1;\r\n        if (nextHoleIdx > lastHoleIdx) nextHoleIdx = 0;\r\n\r\n        insideAngle = isPointInsideAngle(hole[inHoleIdx], hole[prevHoleIdx], hole[nextHoleIdx], shape[inShapeIdx]);\r\n        if (!insideAngle) {\r\n          // console.log( \"Vertex (Hole): \" + inHoleIdx + \", Point: \" + shape[inShapeIdx].x + \"/\" + shape[inShapeIdx].y );\r\n          return false;\r\n        }\r\n\r\n        return true;\r\n      }\r\n\r\n      function intersectsShapeEdge(inShapePt, inHolePt) {\r\n        // checks for intersections with shape edges\r\n        var sIdx, nextIdx, intersection;\r\n        for (sIdx = 0; sIdx < shape.length; sIdx++) {\r\n          nextIdx = sIdx + 1;\r\n          nextIdx %= shape.length;\r\n          intersection = intersect_segments_2D(inShapePt, inHolePt, shape[sIdx], shape[nextIdx], true);\r\n          if (intersection.length > 0) return true;\r\n        }\r\n\r\n        return false;\r\n      }\r\n\r\n      var indepHoles = [];\r\n\r\n      function intersectsHoleEdge(inShapePt, inHolePt) {\r\n        // checks for intersections with hole edges\r\n        var ihIdx, chkHole,\r\n          hIdx, nextIdx, intersection;\r\n        for (ihIdx = 0; ihIdx < indepHoles.length; ihIdx++) {\r\n          chkHole = holes[indepHoles[ihIdx]];\r\n          for (hIdx = 0; hIdx < chkHole.length; hIdx++) {\r\n            nextIdx = hIdx + 1;\r\n            nextIdx %= chkHole.length;\r\n            intersection = intersect_segments_2D(inShapePt, inHolePt, chkHole[hIdx], chkHole[nextIdx], true);\r\n            if (intersection.length > 0) return true;\r\n          }\r\n        }\r\n        return false;\r\n      }\r\n\r\n      var holeIndex, shapeIndex,\r\n        shapePt, holePt,\r\n        holeIdx, cutKey, failedCuts = [],\r\n        tmpShape1, tmpShape2,\r\n        tmpHole1, tmpHole2;\r\n\r\n      for (var h = 0, hl = holes.length; h < hl; h++) {\r\n\r\n        indepHoles.push(h);\r\n\r\n      }\r\n\r\n      var minShapeIndex = 0;\r\n      var counter = indepHoles.length * 2;\r\n      while (indepHoles.length > 0) {\r\n        counter--;\r\n        if (counter < 0) {\r\n          console.log(\"Infinite Loop! Holes left:\" + indepHoles.length + \", Probably Hole outside Shape!\");\r\n          break;\r\n        }\r\n\r\n        // search for shape-vertex and hole-vertex,\r\n        // which can be connected without intersections\r\n        for (shapeIndex = minShapeIndex; shapeIndex < shape.length; shapeIndex++) {\r\n\r\n          shapePt = shape[shapeIndex];\r\n          holeIndex = -1;\r\n\r\n          // search for hole which can be reached without intersections\r\n          for (var h = 0; h < indepHoles.length; h++) {\r\n            holeIdx = indepHoles[h];\r\n\r\n            // prevent multiple checks\r\n            cutKey = shapePt.x + \":\" + shapePt.y + \":\" + holeIdx;\r\n            if (failedCuts[cutKey] !== undefined) continue;\r\n\r\n            hole = holes[holeIdx];\r\n            for (var h2 = 0; h2 < hole.length; h2++) {\r\n              holePt = hole[h2];\r\n              if (!isCutLineInsideAngles(shapeIndex, h2)) continue;\r\n              if (intersectsShapeEdge(shapePt, holePt)) continue;\r\n              if (intersectsHoleEdge(shapePt, holePt)) continue;\r\n\r\n              holeIndex = h2;\r\n              indepHoles.splice(h, 1);\r\n\r\n              tmpShape1 = shape.slice(0, shapeIndex + 1);\r\n              tmpShape2 = shape.slice(shapeIndex);\r\n              tmpHole1 = hole.slice(holeIndex);\r\n              tmpHole2 = hole.slice(0, holeIndex + 1);\r\n\r\n              shape = tmpShape1.concat(tmpHole1).concat(tmpHole2).concat(tmpShape2);\r\n\r\n              minShapeIndex = shapeIndex;\r\n\r\n              // Debug only, to show the selected cuts\r\n              // glob_CutLines.push( [ shapePt, holePt ] );\r\n\r\n              break;\r\n            }\r\n            if (holeIndex >= 0) break; // hole-vertex found\r\n\r\n            failedCuts[cutKey] = true; // remember failure\r\n          }\r\n          if (holeIndex >= 0) break; // hole-vertex found\r\n        }\r\n      }\r\n\r\n      return shape; /* shape with no holes */\r\n    }\r\n\r\n\r\n    var i, il, f, face,\r\n      key, index,\r\n      allPointsMap = {};\r\n\r\n    // To maintain reference to old shape, one must match coordinates, or offset the indices from original arrays. It's probably easier to do the first.\r\n\r\n    var allpoints = contour.concat();\r\n\r\n    for (var h = 0, hl = holes.length; h < hl; h++) {\r\n\r\n      Array.prototype.push.apply(allpoints, holes[h]);\r\n\r\n    }\r\n\r\n    //console.log( \"allpoints\",allpoints, allpoints.length );\r\n\r\n    // prepare all points map\r\n\r\n    for (i = 0, il = allpoints.length; i < il; i++) {\r\n\r\n      key = allpoints[i].x + \":\" + allpoints[i].y;\r\n\r\n      if (allPointsMap[key] !== undefined) {\r\n\r\n        THREE.warn(\"THREE.Shape: Duplicate point\", key);\r\n\r\n      }\r\n\r\n      allPointsMap[key] = i;\r\n\r\n    }\r\n\r\n    // remove holes by cutting paths to holes and adding them to the shape\r\n    var shapeWithoutHoles = removeHoles(contour, holes);\r\n\r\n    var triangles = THREE.FontUtils.Triangulate(shapeWithoutHoles, false); // True returns indices for points of spooled shape\r\n    //console.log( \"triangles\",triangles, triangles.length );\r\n\r\n    // check all face vertices against all points map\r\n\r\n    for (i = 0, il = triangles.length; i < il; i++) {\r\n\r\n      face = triangles[i];\r\n\r\n      for (f = 0; f < 3; f++) {\r\n\r\n        key = face[f].x + \":\" + face[f].y;\r\n\r\n        index = allPointsMap[key];\r\n\r\n        if (index !== undefined) {\r\n\r\n          face[f] = index;\r\n\r\n        }\r\n\r\n      }\r\n\r\n    }\r\n\r\n    return triangles.concat();\r\n\r\n  },\r\n\r\n  isClockWise: function(pts) {\r\n\r\n    return THREE.FontUtils.Triangulate.area(pts) < 0;\r\n\r\n  },\r\n\r\n  // Bezier Curves formulas obtained from\r\n  // http://en.wikipedia.org/wiki/B%C3%A9zier_curve\r\n\r\n  // Quad Bezier Functions\r\n\r\n  b2p0: function(t, p) {\r\n\r\n    var k = 1 - t;\r\n    return k * k * p;\r\n\r\n  },\r\n\r\n  b2p1: function(t, p) {\r\n\r\n    return 2 * (1 - t) * t * p;\r\n\r\n  },\r\n\r\n  b2p2: function(t, p) {\r\n\r\n    return t * t * p;\r\n\r\n  },\r\n\r\n  b2: function(t, p0, p1, p2) {\r\n\r\n    return this.b2p0(t, p0) + this.b2p1(t, p1) + this.b2p2(t, p2);\r\n\r\n  },\r\n\r\n  // Cubic Bezier Functions\r\n\r\n  b3p0: function(t, p) {\r\n\r\n    var k = 1 - t;\r\n    return k * k * k * p;\r\n\r\n  },\r\n\r\n  b3p1: function(t, p) {\r\n\r\n    var k = 1 - t;\r\n    return 3 * k * k * t * p;\r\n\r\n  },\r\n\r\n  b3p2: function(t, p) {\r\n\r\n    var k = 1 - t;\r\n    return 3 * k * t * t * p;\r\n\r\n  },\r\n\r\n  b3p3: function(t, p) {\r\n\r\n    return t * t * t * p;\r\n\r\n  },\r\n\r\n  b3: function(t, p0, p1, p2, p3) {\r\n\r\n    return this.b3p0(t, p0) + this.b3p1(t, p1) + this.b3p2(t, p2) + this.b3p3(t, p3);\r\n\r\n  }\r\n\r\n};\r\n\r\n\r\n// File:src/extras/curves/LineCurve.js\r\n\r\n/**************************************************************\r\n *\tLine\r\n **************************************************************/\r\n\r\nTHREE.LineCurve = function(v1, v2) {\r\n\r\n  this.v1 = v1;\r\n  this.v2 = v2;\r\n\r\n};\r\n\r\nTHREE.LineCurve.prototype = Object.create(THREE.Curve.prototype);\r\nTHREE.LineCurve.prototype.constructor = THREE.LineCurve;\r\n\r\nTHREE.LineCurve.prototype.getPoint = function(t) {\r\n\r\n  var point = this.v2.clone().sub(this.v1);\r\n  point.multiplyScalar(t).add(this.v1);\r\n\r\n  return point;\r\n\r\n};\r\n\r\n// Line curve is linear, so we can overwrite default getPointAt\r\n\r\nTHREE.LineCurve.prototype.getPointAt = function(u) {\r\n\r\n  return this.getPoint(u);\r\n\r\n};\r\n\r\nTHREE.LineCurve.prototype.getTangent = function(t) {\r\n\r\n  var tangent = this.v2.clone().sub(this.v1);\r\n\r\n  return tangent.normalize();\r\n\r\n};\r\n\r\n// File:src/extras/curves/QuadraticBezierCurve.js\r\n\r\n/**************************************************************\r\n *\tQuadratic Bezier curve\r\n **************************************************************/\r\n\r\n\r\nTHREE.QuadraticBezierCurve = function(v0, v1, v2) {\r\n\r\n  this.v0 = v0;\r\n  this.v1 = v1;\r\n  this.v2 = v2;\r\n\r\n};\r\n\r\nTHREE.QuadraticBezierCurve.prototype = Object.create(THREE.Curve.prototype);\r\nTHREE.QuadraticBezierCurve.prototype.constructor = THREE.QuadraticBezierCurve;\r\n\r\n\r\nTHREE.QuadraticBezierCurve.prototype.getPoint = function(t) {\r\n\r\n  var vector = new THREE.Vector2();\r\n\r\n  vector.x = THREE.Shape.Utils.b2(t, this.v0.x, this.v1.x, this.v2.x);\r\n  vector.y = THREE.Shape.Utils.b2(t, this.v0.y, this.v1.y, this.v2.y);\r\n\r\n  return vector;\r\n\r\n};\r\n\r\n\r\nTHREE.QuadraticBezierCurve.prototype.getTangent = function(t) {\r\n\r\n  var vector = new THREE.Vector2();\r\n\r\n  vector.x = THREE.Curve.Utils.tangentQuadraticBezier(t, this.v0.x, this.v1.x, this.v2.x);\r\n  vector.y = THREE.Curve.Utils.tangentQuadraticBezier(t, this.v0.y, this.v1.y, this.v2.y);\r\n\r\n  // returns unit vector\r\n\r\n  return vector.normalize();\r\n\r\n};\r\n\r\n// File:src/extras/curves/CubicBezierCurve.js\r\n\r\n/**************************************************************\r\n *\tCubic Bezier curve\r\n **************************************************************/\r\n\r\nTHREE.CubicBezierCurve = function(v0, v1, v2, v3) {\r\n\r\n  this.v0 = v0;\r\n  this.v1 = v1;\r\n  this.v2 = v2;\r\n  this.v3 = v3;\r\n\r\n};\r\n\r\nTHREE.CubicBezierCurve.prototype = Object.create(THREE.Curve.prototype);\r\nTHREE.CubicBezierCurve.prototype.constructor = THREE.CubicBezierCurve;\r\n\r\nTHREE.CubicBezierCurve.prototype.getPoint = function(t) {\r\n\r\n  var tx, ty;\r\n\r\n  tx = THREE.Shape.Utils.b3(t, this.v0.x, this.v1.x, this.v2.x, this.v3.x);\r\n  ty = THREE.Shape.Utils.b3(t, this.v0.y, this.v1.y, this.v2.y, this.v3.y);\r\n\r\n  return new THREE.Vector2(tx, ty);\r\n\r\n};\r\n\r\nTHREE.CubicBezierCurve.prototype.getTangent = function(t) {\r\n\r\n  var tx, ty;\r\n\r\n  tx = THREE.Curve.Utils.tangentCubicBezier(t, this.v0.x, this.v1.x, this.v2.x, this.v3.x);\r\n  ty = THREE.Curve.Utils.tangentCubicBezier(t, this.v0.y, this.v1.y, this.v2.y, this.v3.y);\r\n\r\n  var tangent = new THREE.Vector2(tx, ty);\r\n  tangent.normalize();\r\n\r\n  return tangent;\r\n\r\n};\r\n\r\n// File:src/extras/curves/SplineCurve.js\r\n\r\n/**************************************************************\r\n *\tSpline curve\r\n **************************************************************/\r\n\r\nTHREE.SplineCurve = function(points /* array of Vector2 */ ) {\r\n\r\n  this.points = (points == undefined) ? [] : points;\r\n\r\n};\r\n\r\nTHREE.SplineCurve.prototype = Object.create(THREE.Curve.prototype);\r\nTHREE.SplineCurve.prototype.constructor = THREE.SplineCurve;\r\n\r\nTHREE.SplineCurve.prototype.getPoint = function(t) {\r\n\r\n  var points = this.points;\r\n  var point = (points.length - 1) * t;\r\n\r\n  var intPoint = Math.floor(point);\r\n  var weight = point - intPoint;\r\n\r\n  var point0 = points[intPoint == 0 ? intPoint : intPoint - 1]\r\n  var point1 = points[intPoint]\r\n  var point2 = points[intPoint > points.length - 2 ? points.length - 1 : intPoint + 1]\r\n  var point3 = points[intPoint > points.length - 3 ? points.length - 1 : intPoint + 2]\r\n\r\n  var vector = new THREE.Vector2();\r\n\r\n  vector.x = THREE.Curve.Utils.interpolate(point0.x, point1.x, point2.x, point3.x, weight);\r\n  vector.y = THREE.Curve.Utils.interpolate(point0.y, point1.y, point2.y, point3.y, weight);\r\n\r\n  return vector;\r\n\r\n};\r\n\r\n// File:src/extras/curves/EllipseCurve.js\r\n\r\n/**************************************************************\r\n *\tEllipse curve\r\n **************************************************************/\r\n\r\nTHREE.EllipseCurve = function(aX, aY, xRadius, yRadius, aStartAngle, aEndAngle, aClockwise) {\r\n\r\n  this.aX = aX;\r\n  this.aY = aY;\r\n\r\n  this.xRadius = xRadius;\r\n  this.yRadius = yRadius;\r\n\r\n  this.aStartAngle = aStartAngle;\r\n  this.aEndAngle = aEndAngle;\r\n\r\n  this.aClockwise = aClockwise;\r\n\r\n};\r\n\r\nTHREE.EllipseCurve.prototype = Object.create(THREE.Curve.prototype);\r\nTHREE.EllipseCurve.prototype.constructor = THREE.EllipseCurve;\r\n\r\nTHREE.EllipseCurve.prototype.getPoint = function(t) {\r\n\r\n  var deltaAngle = this.aEndAngle - this.aStartAngle;\r\n\r\n  if (deltaAngle < 0) deltaAngle += Math.PI * 2;\r\n  if (deltaAngle > Math.PI * 2) deltaAngle -= Math.PI * 2;\r\n\r\n  var angle;\r\n\r\n  if (this.aClockwise === true) {\r\n\r\n    angle = this.aEndAngle + (1 - t) * (Math.PI * 2 - deltaAngle);\r\n\r\n  }\r\n  else {\r\n\r\n    angle = this.aStartAngle + t * deltaAngle;\r\n\r\n  }\r\n\r\n  var vector = new THREE.Vector2();\r\n\r\n  vector.x = this.aX + this.xRadius * Math.cos(angle);\r\n  vector.y = this.aY + this.yRadius * Math.sin(angle);\r\n\r\n  return vector;\r\n\r\n};\r\n\r\n// File:src/extras/curves/ArcCurve.js\r\n\r\n/**************************************************************\r\n *\tArc curve\r\n **************************************************************/\r\n\r\nTHREE.ArcCurve = function(aX, aY, aRadius, aStartAngle, aEndAngle, aClockwise) {\r\n\r\n  THREE.EllipseCurve.call(this, aX, aY, aRadius, aRadius, aStartAngle, aEndAngle, aClockwise);\r\n};\r\n\r\nTHREE.ArcCurve.prototype = Object.create(THREE.EllipseCurve.prototype);\r\nTHREE.ArcCurve.prototype.constructor = THREE.ArcCurve;\r\n\r\n// File:src/extras/curves/LineCurve3.js\r\n\r\n/**************************************************************\r\n *\tLine3D\r\n **************************************************************/\r\n\r\nTHREE.LineCurve3 = THREE.Curve.create(\r\n\r\n  function(v1, v2) {\r\n\r\n    this.v1 = v1;\r\n    this.v2 = v2;\r\n\r\n  },\r\n\r\n  function(t) {\r\n\r\n    var vector = new THREE.Vector3();\r\n\r\n    vector.subVectors(this.v2, this.v1); // diff\r\n    vector.multiplyScalar(t);\r\n    vector.add(this.v1);\r\n\r\n    return vector;\r\n\r\n  }\r\n\r\n);\r\n\r\n// File:src/extras/curves/QuadraticBezierCurve3.js\r\n\r\n/**************************************************************\r\n *\tQuadratic Bezier 3D curve\r\n **************************************************************/\r\n\r\nTHREE.QuadraticBezierCurve3 = THREE.Curve.create(\r\n\r\n  function(v0, v1, v2) {\r\n\r\n    this.v0 = v0;\r\n    this.v1 = v1;\r\n    this.v2 = v2;\r\n\r\n  },\r\n\r\n  function(t) {\r\n\r\n    var vector = new THREE.Vector3();\r\n\r\n    vector.x = THREE.Shape.Utils.b2(t, this.v0.x, this.v1.x, this.v2.x);\r\n    vector.y = THREE.Shape.Utils.b2(t, this.v0.y, this.v1.y, this.v2.y);\r\n    vector.z = THREE.Shape.Utils.b2(t, this.v0.z, this.v1.z, this.v2.z);\r\n\r\n    return vector;\r\n\r\n  }\r\n\r\n);\r\n\r\n// File:src/extras/curves/CubicBezierCurve3.js\r\n\r\n/**************************************************************\r\n *\tCubic Bezier 3D curve\r\n **************************************************************/\r\n\r\nTHREE.CubicBezierCurve3 = THREE.Curve.create(\r\n\r\n  function(v0, v1, v2, v3) {\r\n\r\n    this.v0 = v0;\r\n    this.v1 = v1;\r\n    this.v2 = v2;\r\n    this.v3 = v3;\r\n\r\n  },\r\n\r\n  function(t) {\r\n\r\n    var vector = new THREE.Vector3();\r\n\r\n    vector.x = THREE.Shape.Utils.b3(t, this.v0.x, this.v1.x, this.v2.x, this.v3.x);\r\n    vector.y = THREE.Shape.Utils.b3(t, this.v0.y, this.v1.y, this.v2.y, this.v3.y);\r\n    vector.z = THREE.Shape.Utils.b3(t, this.v0.z, this.v1.z, this.v2.z, this.v3.z);\r\n\r\n    return vector;\r\n\r\n  }\r\n\r\n);\r\n\r\n// File:src/extras/curves/SplineCurve3.js\r\n\r\n/**************************************************************\r\n *\tSpline 3D curve\r\n **************************************************************/\r\n\r\n\r\nTHREE.SplineCurve3 = THREE.Curve.create(\r\n\r\n  function(points /* array of Vector3 */ ) {\r\n\r\n    this.points = (points == undefined) ? [] : points;\r\n\r\n  },\r\n\r\n  function(t) {\r\n\r\n    var points = this.points;\r\n    var point = (points.length - 1) * t;\r\n\r\n    var intPoint = Math.floor(point);\r\n    var weight = point - intPoint;\r\n\r\n    var point0 = points[intPoint == 0 ? intPoint : intPoint - 1];\r\n    var point1 = points[intPoint];\r\n    var point2 = points[intPoint > points.length - 2 ? points.length - 1 : intPoint + 1];\r\n    var point3 = points[intPoint > points.length - 3 ? points.length - 1 : intPoint + 2];\r\n\r\n    var vector = new THREE.Vector3();\r\n\r\n    vector.x = THREE.Curve.Utils.interpolate(point0.x, point1.x, point2.x, point3.x, weight);\r\n    vector.y = THREE.Curve.Utils.interpolate(point0.y, point1.y, point2.y, point3.y, weight);\r\n    vector.z = THREE.Curve.Utils.interpolate(point0.z, point1.z, point2.z, point3.z, weight);\r\n\r\n    return vector;\r\n\r\n  }\r\n\r\n);\r\n\r\n// File:src/extras/curves/ClosedSplineCurve3.js\r\n\r\n/**************************************************************\r\n *\tClosed Spline 3D curve\r\n **************************************************************/\r\n\r\n\r\nTHREE.ClosedSplineCurve3 = THREE.Curve.create(\r\n\r\n  function(points /* array of Vector3 */ ) {\r\n\r\n    this.points = (points == undefined) ? [] : points;\r\n\r\n  },\r\n\r\n  function(t) {\r\n\r\n    var points = this.points;\r\n    var point = (points.length - 0) * t; // This needs to be from 0-length +1\r\n\r\n    var intPoint = Math.floor(point);\r\n    var weight = point - intPoint;\r\n\r\n    intPoint += intPoint > 0 ? 0 : (Math.floor(Math.abs(intPoint) / points.length) + 1) * points.length;\r\n\r\n    var point0 = points[(intPoint - 1) % points.length];\r\n    var point1 = points[(intPoint) % points.length];\r\n    var point2 = points[(intPoint + 1) % points.length];\r\n    var point3 = points[(intPoint + 2) % points.length];\r\n\r\n    var vector = new THREE.Vector3();\r\n\r\n    vector.x = THREE.Curve.Utils.interpolate(point0.x, point1.x, point2.x, point3.x, weight);\r\n    vector.y = THREE.Curve.Utils.interpolate(point0.y, point1.y, point2.y, point3.y, weight);\r\n    vector.z = THREE.Curve.Utils.interpolate(point0.z, point1.z, point2.z, point3.z, weight);\r\n\r\n    return vector;\r\n\r\n  }\r\n\r\n);\r\n\r\n// File:src/extras/animation/AnimationHandler.js\r\n\r\n/**\r\n * @author mikael emtinger / http://gomo.se/\r\n */\r\n\r\nTHREE.AnimationHandler = {\r\n\r\n  LINEAR: 0,\r\n  CATMULLROM: 1,\r\n  CATMULLROM_FORWARD: 2,\r\n\r\n  //\r\n\r\n  add: function() {\r\n    THREE.warn('THREE.AnimationHandler.add() has been deprecated.');\r\n  },\r\n  get: function() {\r\n    THREE.warn('THREE.AnimationHandler.get() has been deprecated.');\r\n  },\r\n  remove: function() {\r\n    THREE.warn('THREE.AnimationHandler.remove() has been deprecated.');\r\n  },\r\n\r\n  //\r\n\r\n  animations: [],\r\n\r\n  init: function(data) {\r\n\r\n    if (data.initialized === true) return data;\r\n\r\n    // loop through all keys\r\n\r\n    for (var h = 0; h < data.hierarchy.length; h++) {\r\n\r\n      for (var k = 0; k < data.hierarchy[h].keys.length; k++) {\r\n\r\n        // remove minus times\r\n\r\n        if (data.hierarchy[h].keys[k].time < 0) {\r\n\r\n          data.hierarchy[h].keys[k].time = 0;\r\n\r\n        }\r\n\r\n        // create quaternions\r\n\r\n        if (data.hierarchy[h].keys[k].rot !== undefined &&\r\n          !(data.hierarchy[h].keys[k].rot instanceof THREE.Quaternion)) {\r\n\r\n          var quat = data.hierarchy[h].keys[k].rot;\r\n          data.hierarchy[h].keys[k].rot = new THREE.Quaternion().fromArray(quat);\r\n\r\n        }\r\n\r\n      }\r\n\r\n      // prepare morph target keys\r\n\r\n      if (data.hierarchy[h].keys.length && data.hierarchy[h].keys[0].morphTargets !== undefined) {\r\n\r\n        // get all used\r\n\r\n        var usedMorphTargets = {};\r\n\r\n        for (var k = 0; k < data.hierarchy[h].keys.length; k++) {\r\n\r\n          for (var m = 0; m < data.hierarchy[h].keys[k].morphTargets.length; m++) {\r\n\r\n            var morphTargetName = data.hierarchy[h].keys[k].morphTargets[m];\r\n            usedMorphTargets[morphTargetName] = -1;\r\n\r\n          }\r\n\r\n        }\r\n\r\n        data.hierarchy[h].usedMorphTargets = usedMorphTargets;\r\n\r\n\r\n        // set all used on all frames\r\n\r\n        for (var k = 0; k < data.hierarchy[h].keys.length; k++) {\r\n\r\n          var influences = {};\r\n\r\n          for (var morphTargetName in usedMorphTargets) {\r\n\r\n            for (var m = 0; m < data.hierarchy[h].keys[k].morphTargets.length; m++) {\r\n\r\n              if (data.hierarchy[h].keys[k].morphTargets[m] === morphTargetName) {\r\n\r\n                influences[morphTargetName] = data.hierarchy[h].keys[k].morphTargetsInfluences[m];\r\n                break;\r\n\r\n              }\r\n\r\n            }\r\n\r\n            if (m === data.hierarchy[h].keys[k].morphTargets.length) {\r\n\r\n              influences[morphTargetName] = 0;\r\n\r\n            }\r\n\r\n          }\r\n\r\n          data.hierarchy[h].keys[k].morphTargetsInfluences = influences;\r\n\r\n        }\r\n\r\n      }\r\n\r\n\r\n      // remove all keys that are on the same time\r\n\r\n      for (var k = 1; k < data.hierarchy[h].keys.length; k++) {\r\n\r\n        if (data.hierarchy[h].keys[k].time === data.hierarchy[h].keys[k - 1].time) {\r\n\r\n          data.hierarchy[h].keys.splice(k, 1);\r\n          k--;\r\n\r\n        }\r\n\r\n      }\r\n\r\n\r\n      // set index\r\n\r\n      for (var k = 0; k < data.hierarchy[h].keys.length; k++) {\r\n\r\n        data.hierarchy[h].keys[k].index = k;\r\n\r\n      }\r\n\r\n    }\r\n\r\n    data.initialized = true;\r\n\r\n    return data;\r\n\r\n  },\r\n\r\n  parse: function(root) {\r\n\r\n    var parseRecurseHierarchy = function(root, hierarchy) {\r\n\r\n      hierarchy.push(root);\r\n\r\n      for (var c = 0; c < root.children.length; c++)\r\n        parseRecurseHierarchy(root.children[c], hierarchy);\r\n\r\n    };\r\n\r\n    // setup hierarchy\r\n\r\n    var hierarchy = [];\r\n\r\n    if (root instanceof THREE.SkinnedMesh) {\r\n\r\n      for (var b = 0; b < root.skeleton.bones.length; b++) {\r\n\r\n        hierarchy.push(root.skeleton.bones[b]);\r\n\r\n      }\r\n\r\n    }\r\n    else {\r\n\r\n      parseRecurseHierarchy(root, hierarchy);\r\n\r\n    }\r\n\r\n    return hierarchy;\r\n\r\n  },\r\n\r\n  play: function(animation) {\r\n\r\n    if (this.animations.indexOf(animation) === -1) {\r\n\r\n      this.animations.push(animation);\r\n\r\n    }\r\n\r\n  },\r\n\r\n  stop: function(animation) {\r\n\r\n    var index = this.animations.indexOf(animation);\r\n\r\n    if (index !== -1) {\r\n\r\n      this.animations.splice(index, 1);\r\n\r\n    }\r\n\r\n  },\r\n\r\n  update: function(deltaTimeMS) {\r\n\r\n    for (var i = 0; i < this.animations.length; i++) {\r\n\r\n      this.animations[i].resetBlendWeights();\r\n\r\n    }\r\n\r\n    for (var i = 0; i < this.animations.length; i++) {\r\n\r\n      this.animations[i].update(deltaTimeMS);\r\n\r\n    }\r\n\r\n  }\r\n\r\n};\r\n\r\n// File:src/extras/animation/Animation.js\r\n\r\n/**\r\n * @author mikael emtinger / http://gomo.se/\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author alteredq / http://alteredqualia.com/\r\n */\r\n\r\nTHREE.Animation = function(root, data) {\r\n\r\n  this.root = root;\r\n  this.data = THREE.AnimationHandler.init(data);\r\n  this.hierarchy = THREE.AnimationHandler.parse(root);\r\n\r\n  this.currentTime = 0;\r\n  this.timeScale = 1;\r\n\r\n  this.isPlaying = false;\r\n  this.loop = true;\r\n  this.weight = 0;\r\n\r\n  this.interpolationType = THREE.AnimationHandler.LINEAR;\r\n\r\n};\r\n\r\nTHREE.Animation.prototype = {\r\n\r\n  constructor: THREE.Animation,\r\n\r\n  keyTypes: [\"pos\", \"rot\", \"scl\"],\r\n\r\n  play: function(startTime, weight) {\r\n\r\n    this.currentTime = startTime !== undefined ? startTime : 0;\r\n    this.weight = weight !== undefined ? weight : 1;\r\n\r\n    this.isPlaying = true;\r\n\r\n    this.reset();\r\n\r\n    THREE.AnimationHandler.play(this);\r\n\r\n  },\r\n\r\n  stop: function() {\r\n\r\n    this.isPlaying = false;\r\n\r\n    THREE.AnimationHandler.stop(this);\r\n\r\n  },\r\n\r\n  reset: function() {\r\n\r\n    for (var h = 0, hl = this.hierarchy.length; h < hl; h++) {\r\n\r\n      var object = this.hierarchy[h];\r\n\r\n      if (object.animationCache === undefined) {\r\n\r\n        object.animationCache = {\r\n          animations: {},\r\n          blending: {\r\n            positionWeight: 0.0,\r\n            quaternionWeight: 0.0,\r\n            scaleWeight: 0.0\r\n          }\r\n        };\r\n      }\r\n\r\n      var name = this.data.name;\r\n      var animations = object.animationCache.animations;\r\n      var animationCache = animations[name];\r\n\r\n      if (animationCache === undefined) {\r\n\r\n        animationCache = {\r\n          prevKey: {\r\n            pos: 0,\r\n            rot: 0,\r\n            scl: 0\r\n          },\r\n          nextKey: {\r\n            pos: 0,\r\n            rot: 0,\r\n            scl: 0\r\n          },\r\n          originalMatrix: object.matrix\r\n        };\r\n\r\n        animations[name] = animationCache;\r\n\r\n      }\r\n\r\n      // Get keys to match our current time\r\n\r\n      for (var t = 0; t < 3; t++) {\r\n\r\n        var type = this.keyTypes[t];\r\n\r\n        var prevKey = this.data.hierarchy[h].keys[0];\r\n        var nextKey = this.getNextKeyWith(type, h, 1);\r\n\r\n        while (nextKey.time < this.currentTime && nextKey.index > prevKey.index) {\r\n\r\n          prevKey = nextKey;\r\n          nextKey = this.getNextKeyWith(type, h, nextKey.index + 1);\r\n\r\n        }\r\n\r\n        animationCache.prevKey[type] = prevKey;\r\n        animationCache.nextKey[type] = nextKey;\r\n\r\n      }\r\n\r\n    }\r\n\r\n  },\r\n\r\n  resetBlendWeights: function() {\r\n\r\n    for (var h = 0, hl = this.hierarchy.length; h < hl; h++) {\r\n\r\n      var object = this.hierarchy[h];\r\n      var animationCache = object.animationCache;\r\n\r\n      if (animationCache !== undefined) {\r\n\r\n        var blending = animationCache.blending;\r\n\r\n        blending.positionWeight = 0.0;\r\n        blending.quaternionWeight = 0.0;\r\n        blending.scaleWeight = 0.0;\r\n\r\n      }\r\n\r\n    }\r\n\r\n  },\r\n\r\n  update: (function() {\r\n\r\n    var points = [];\r\n    var target = new THREE.Vector3();\r\n    var newVector = new THREE.Vector3();\r\n    var newQuat = new THREE.Quaternion();\r\n\r\n    // Catmull-Rom spline\r\n\r\n    var interpolateCatmullRom = function(points, scale) {\r\n\r\n      var c = [],\r\n        v3 = [],\r\n        point, intPoint, weight, w2, w3,\r\n        pa, pb, pc, pd;\r\n\r\n      point = (points.length - 1) * scale;\r\n      intPoint = Math.floor(point);\r\n      weight = point - intPoint;\r\n\r\n      c[0] = intPoint === 0 ? intPoint : intPoint - 1;\r\n      c[1] = intPoint;\r\n      c[2] = intPoint > points.length - 2 ? intPoint : intPoint + 1;\r\n      c[3] = intPoint > points.length - 3 ? intPoint : intPoint + 2;\r\n\r\n      pa = points[c[0]];\r\n      pb = points[c[1]];\r\n      pc = points[c[2]];\r\n      pd = points[c[3]];\r\n\r\n      w2 = weight * weight;\r\n      w3 = weight * w2;\r\n\r\n      v3[0] = interpolate(pa[0], pb[0], pc[0], pd[0], weight, w2, w3);\r\n      v3[1] = interpolate(pa[1], pb[1], pc[1], pd[1], weight, w2, w3);\r\n      v3[2] = interpolate(pa[2], pb[2], pc[2], pd[2], weight, w2, w3);\r\n\r\n      return v3;\r\n\r\n    };\r\n\r\n    var interpolate = function(p0, p1, p2, p3, t, t2, t3) {\r\n\r\n      var v0 = (p2 - p0) * 0.5,\r\n        v1 = (p3 - p1) * 0.5;\r\n\r\n      return (2 * (p1 - p2) + v0 + v1) * t3 + (-3 * (p1 - p2) - 2 * v0 - v1) * t2 + v0 * t + p1;\r\n\r\n    };\r\n\r\n    return function(delta) {\r\n\r\n      if (this.isPlaying === false) return;\r\n\r\n      this.currentTime += delta * this.timeScale;\r\n\r\n      if (this.weight === 0)\r\n        return;\r\n\r\n      //\r\n\r\n      var duration = this.data.length;\r\n\r\n      if (this.currentTime > duration || this.currentTime < 0) {\r\n\r\n        if (this.loop) {\r\n\r\n          this.currentTime %= duration;\r\n\r\n          if (this.currentTime < 0)\r\n            this.currentTime += duration;\r\n\r\n          this.reset();\r\n\r\n        }\r\n        else {\r\n\r\n          this.stop();\r\n\r\n        }\r\n\r\n      }\r\n\r\n      for (var h = 0, hl = this.hierarchy.length; h < hl; h++) {\r\n\r\n        var object = this.hierarchy[h];\r\n        var animationCache = object.animationCache.animations[this.data.name];\r\n        var blending = object.animationCache.blending;\r\n\r\n        // loop through pos/rot/scl\r\n\r\n        for (var t = 0; t < 3; t++) {\r\n\r\n          // get keys\r\n\r\n          var type = this.keyTypes[t];\r\n          var prevKey = animationCache.prevKey[type];\r\n          var nextKey = animationCache.nextKey[type];\r\n\r\n          if ((this.timeScale > 0 && nextKey.time <= this.currentTime) ||\r\n            (this.timeScale < 0 && prevKey.time >= this.currentTime)) {\r\n\r\n            prevKey = this.data.hierarchy[h].keys[0];\r\n            nextKey = this.getNextKeyWith(type, h, 1);\r\n\r\n            while (nextKey.time < this.currentTime && nextKey.index > prevKey.index) {\r\n\r\n              prevKey = nextKey;\r\n              nextKey = this.getNextKeyWith(type, h, nextKey.index + 1);\r\n\r\n            }\r\n\r\n            animationCache.prevKey[type] = prevKey;\r\n            animationCache.nextKey[type] = nextKey;\r\n\r\n          }\r\n\r\n          var scale = (this.currentTime - prevKey.time) / (nextKey.time - prevKey.time);\r\n\r\n          var prevXYZ = prevKey[type];\r\n          var nextXYZ = nextKey[type];\r\n\r\n          if (scale < 0) scale = 0;\r\n          if (scale > 1) scale = 1;\r\n\r\n          // interpolate\r\n\r\n          if (type === \"pos\") {\r\n\r\n            if (this.interpolationType === THREE.AnimationHandler.LINEAR) {\r\n\r\n              newVector.x = prevXYZ[0] + (nextXYZ[0] - prevXYZ[0]) * scale;\r\n              newVector.y = prevXYZ[1] + (nextXYZ[1] - prevXYZ[1]) * scale;\r\n              newVector.z = prevXYZ[2] + (nextXYZ[2] - prevXYZ[2]) * scale;\r\n\r\n              // blend\r\n              var proportionalWeight = this.weight / (this.weight + blending.positionWeight);\r\n              object.position.lerp(newVector, proportionalWeight);\r\n              blending.positionWeight += this.weight;\r\n\r\n            }\r\n            else if (this.interpolationType === THREE.AnimationHandler.CATMULLROM ||\r\n              this.interpolationType === THREE.AnimationHandler.CATMULLROM_FORWARD) {\r\n\r\n              points[0] = this.getPrevKeyWith(\"pos\", h, prevKey.index - 1)[\"pos\"];\r\n              points[1] = prevXYZ;\r\n              points[2] = nextXYZ;\r\n              points[3] = this.getNextKeyWith(\"pos\", h, nextKey.index + 1)[\"pos\"];\r\n\r\n              scale = scale * 0.33 + 0.33;\r\n\r\n              var currentPoint = interpolateCatmullRom(points, scale);\r\n              var proportionalWeight = this.weight / (this.weight + blending.positionWeight);\r\n              blending.positionWeight += this.weight;\r\n\r\n              // blend\r\n\r\n              var vector = object.position;\r\n\r\n              vector.x = vector.x + (currentPoint[0] - vector.x) * proportionalWeight;\r\n              vector.y = vector.y + (currentPoint[1] - vector.y) * proportionalWeight;\r\n              vector.z = vector.z + (currentPoint[2] - vector.z) * proportionalWeight;\r\n\r\n              if (this.interpolationType === THREE.AnimationHandler.CATMULLROM_FORWARD) {\r\n\r\n                var forwardPoint = interpolateCatmullRom(points, scale * 1.01);\r\n\r\n                target.set(forwardPoint[0], forwardPoint[1], forwardPoint[2]);\r\n                target.sub(vector);\r\n                target.y = 0;\r\n                target.normalize();\r\n\r\n                var angle = Math.atan2(target.x, target.z);\r\n                object.rotation.set(0, angle, 0);\r\n\r\n              }\r\n\r\n            }\r\n\r\n          }\r\n          else if (type === \"rot\") {\r\n\r\n            THREE.Quaternion.slerp(prevXYZ, nextXYZ, newQuat, scale);\r\n\r\n            // Avoid paying the cost of an additional slerp if we don't have to\r\n            if (blending.quaternionWeight === 0) {\r\n\r\n              object.quaternion.copy(newQuat);\r\n              blending.quaternionWeight = this.weight;\r\n\r\n            }\r\n            else {\r\n\r\n              var proportionalWeight = this.weight / (this.weight + blending.quaternionWeight);\r\n              THREE.Quaternion.slerp(object.quaternion, newQuat, object.quaternion, proportionalWeight);\r\n              blending.quaternionWeight += this.weight;\r\n\r\n            }\r\n\r\n          }\r\n          else if (type === \"scl\") {\r\n\r\n            newVector.x = prevXYZ[0] + (nextXYZ[0] - prevXYZ[0]) * scale;\r\n            newVector.y = prevXYZ[1] + (nextXYZ[1] - prevXYZ[1]) * scale;\r\n            newVector.z = prevXYZ[2] + (nextXYZ[2] - prevXYZ[2]) * scale;\r\n\r\n            var proportionalWeight = this.weight / (this.weight + blending.scaleWeight);\r\n            object.scale.lerp(newVector, proportionalWeight);\r\n            blending.scaleWeight += this.weight;\r\n\r\n          }\r\n\r\n        }\r\n\r\n      }\r\n\r\n      return true;\r\n\r\n    };\r\n\r\n  })(),\r\n\r\n  getNextKeyWith: function(type, h, key) {\r\n\r\n    var keys = this.data.hierarchy[h].keys;\r\n\r\n    if (this.interpolationType === THREE.AnimationHandler.CATMULLROM ||\r\n      this.interpolationType === THREE.AnimationHandler.CATMULLROM_FORWARD) {\r\n\r\n      key = key < keys.length - 1 ? key : keys.length - 1;\r\n\r\n    }\r\n    else {\r\n\r\n      key = key % keys.length;\r\n\r\n    }\r\n\r\n    for (; key < keys.length; key++) {\r\n\r\n      if (keys[key][type] !== undefined) {\r\n\r\n        return keys[key];\r\n\r\n      }\r\n\r\n    }\r\n\r\n    return this.data.hierarchy[h].keys[0];\r\n\r\n  },\r\n\r\n  getPrevKeyWith: function(type, h, key) {\r\n\r\n    var keys = this.data.hierarchy[h].keys;\r\n\r\n    if (this.interpolationType === THREE.AnimationHandler.CATMULLROM ||\r\n      this.interpolationType === THREE.AnimationHandler.CATMULLROM_FORWARD) {\r\n\r\n      key = key > 0 ? key : 0;\r\n\r\n    }\r\n    else {\r\n\r\n      key = key >= 0 ? key : key + keys.length;\r\n\r\n    }\r\n\r\n\r\n    for (; key >= 0; key--) {\r\n\r\n      if (keys[key][type] !== undefined) {\r\n\r\n        return keys[key];\r\n\r\n      }\r\n\r\n    }\r\n\r\n    return this.data.hierarchy[h].keys[keys.length - 1];\r\n\r\n  }\r\n\r\n};\r\n\r\n// File:src/extras/animation/KeyFrameAnimation.js\r\n\r\n/**\r\n * @author mikael emtinger / http://gomo.se/\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author alteredq / http://alteredqualia.com/\r\n * @author khang duong\r\n * @author erik kitson\r\n */\r\n\r\nTHREE.KeyFrameAnimation = function(data) {\r\n\r\n  this.root = data.node;\r\n  this.data = THREE.AnimationHandler.init(data);\r\n  this.hierarchy = THREE.AnimationHandler.parse(this.root);\r\n  this.currentTime = 0;\r\n  this.timeScale = 0.001;\r\n  this.isPlaying = false;\r\n  this.isPaused = true;\r\n  this.loop = true;\r\n\r\n  // initialize to first keyframes\r\n\r\n  for (var h = 0, hl = this.hierarchy.length; h < hl; h++) {\r\n\r\n    var keys = this.data.hierarchy[h].keys,\r\n      sids = this.data.hierarchy[h].sids,\r\n      obj = this.hierarchy[h];\r\n\r\n    if (keys.length && sids) {\r\n\r\n      for (var s = 0; s < sids.length; s++) {\r\n\r\n        var sid = sids[s],\r\n          next = this.getNextKeyWith(sid, h, 0);\r\n\r\n        if (next) {\r\n\r\n          next.apply(sid);\r\n\r\n        }\r\n\r\n      }\r\n\r\n      obj.matrixAutoUpdate = false;\r\n      this.data.hierarchy[h].node.updateMatrix();\r\n      obj.matrixWorldNeedsUpdate = true;\r\n\r\n    }\r\n\r\n  }\r\n\r\n};\r\n\r\nTHREE.KeyFrameAnimation.prototype = {\r\n\r\n  constructor: THREE.KeyFrameAnimation,\r\n\r\n  play: function(startTime) {\r\n\r\n    this.currentTime = startTime !== undefined ? startTime : 0;\r\n\r\n    if (this.isPlaying === false) {\r\n\r\n      this.isPlaying = true;\r\n\r\n      // reset key cache\r\n\r\n      var h, hl = this.hierarchy.length,\r\n        object,\r\n        node;\r\n\r\n      for (h = 0; h < hl; h++) {\r\n\r\n        object = this.hierarchy[h];\r\n        node = this.data.hierarchy[h];\r\n\r\n        if (node.animationCache === undefined) {\r\n\r\n          node.animationCache = {};\r\n          node.animationCache.prevKey = null;\r\n          node.animationCache.nextKey = null;\r\n          node.animationCache.originalMatrix = object.matrix;\r\n\r\n        }\r\n\r\n        var keys = this.data.hierarchy[h].keys;\r\n\r\n        if (keys.length) {\r\n\r\n          node.animationCache.prevKey = keys[0];\r\n          node.animationCache.nextKey = keys[1];\r\n\r\n          this.startTime = Math.min(keys[0].time, this.startTime);\r\n          this.endTime = Math.max(keys[keys.length - 1].time, this.endTime);\r\n\r\n        }\r\n\r\n      }\r\n\r\n      this.update(0);\r\n\r\n    }\r\n\r\n    this.isPaused = false;\r\n\r\n    THREE.AnimationHandler.play(this);\r\n\r\n  },\r\n\r\n  stop: function() {\r\n\r\n    this.isPlaying = false;\r\n    this.isPaused = false;\r\n\r\n    THREE.AnimationHandler.stop(this);\r\n\r\n    // reset JIT matrix and remove cache\r\n\r\n    for (var h = 0; h < this.data.hierarchy.length; h++) {\r\n\r\n      var obj = this.hierarchy[h];\r\n      var node = this.data.hierarchy[h];\r\n\r\n      if (node.animationCache !== undefined) {\r\n\r\n        var original = node.animationCache.originalMatrix;\r\n\r\n        original.copy(obj.matrix);\r\n        obj.matrix = original;\r\n\r\n        delete node.animationCache;\r\n\r\n      }\r\n\r\n    }\r\n\r\n  },\r\n\r\n  update: function(delta) {\r\n\r\n    if (this.isPlaying === false) return;\r\n\r\n    this.currentTime += delta * this.timeScale;\r\n\r\n    //\r\n\r\n    var duration = this.data.length;\r\n\r\n    if (this.loop === true && this.currentTime > duration) {\r\n\r\n      this.currentTime %= duration;\r\n\r\n    }\r\n\r\n    this.currentTime = Math.min(this.currentTime, duration);\r\n\r\n    for (var h = 0, hl = this.hierarchy.length; h < hl; h++) {\r\n\r\n      var object = this.hierarchy[h];\r\n      var node = this.data.hierarchy[h];\r\n\r\n      var keys = node.keys,\r\n        animationCache = node.animationCache;\r\n\r\n\r\n      if (keys.length) {\r\n\r\n        var prevKey = animationCache.prevKey;\r\n        var nextKey = animationCache.nextKey;\r\n\r\n        if (nextKey.time <= this.currentTime) {\r\n\r\n          while (nextKey.time < this.currentTime && nextKey.index > prevKey.index) {\r\n\r\n            prevKey = nextKey;\r\n            nextKey = keys[prevKey.index + 1];\r\n\r\n          }\r\n\r\n          animationCache.prevKey = prevKey;\r\n          animationCache.nextKey = nextKey;\r\n\r\n        }\r\n\r\n        if (nextKey.time >= this.currentTime) {\r\n\r\n          prevKey.interpolate(nextKey, this.currentTime);\r\n\r\n        }\r\n        else {\r\n\r\n          prevKey.interpolate(nextKey, nextKey.time);\r\n\r\n        }\r\n\r\n        this.data.hierarchy[h].node.updateMatrix();\r\n        object.matrixWorldNeedsUpdate = true;\r\n\r\n      }\r\n\r\n    }\r\n\r\n  },\r\n\r\n  getNextKeyWith: function(sid, h, key) {\r\n\r\n    var keys = this.data.hierarchy[h].keys;\r\n    key = key % keys.length;\r\n\r\n    for (; key < keys.length; key++) {\r\n\r\n      if (keys[key].hasTarget(sid)) {\r\n\r\n        return keys[key];\r\n\r\n      }\r\n\r\n    }\r\n\r\n    return keys[0];\r\n\r\n  },\r\n\r\n  getPrevKeyWith: function(sid, h, key) {\r\n\r\n    var keys = this.data.hierarchy[h].keys;\r\n    key = key >= 0 ? key : key + keys.length;\r\n\r\n    for (; key >= 0; key--) {\r\n\r\n      if (keys[key].hasTarget(sid)) {\r\n\r\n        return keys[key];\r\n\r\n      }\r\n\r\n    }\r\n\r\n    return keys[keys.length - 1];\r\n\r\n  }\r\n\r\n};\r\n\r\n// File:src/extras/animation/MorphAnimation.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com\r\n * @author willy-vvu / http://willy-vvu.github.io\r\n */\r\n\r\nTHREE.MorphAnimation = function(mesh) {\r\n\r\n  this.mesh = mesh;\r\n  this.frames = mesh.morphTargetInfluences.length;\r\n  this.currentTime = 0;\r\n  this.duration = 1000;\r\n  this.loop = true;\r\n  this.lastFrame = 0;\r\n  this.currentFrame = 0;\r\n\r\n  this.isPlaying = false;\r\n\r\n};\r\n\r\nTHREE.MorphAnimation.prototype = {\r\n\r\n  constructor: THREE.MorphAnimation,\r\n\r\n  play: function() {\r\n\r\n    this.isPlaying = true;\r\n\r\n  },\r\n\r\n  pause: function() {\r\n\r\n    this.isPlaying = false;\r\n\r\n  },\r\n\r\n  update: function(delta) {\r\n\r\n    if (this.isPlaying === false) return;\r\n\r\n    this.currentTime += delta;\r\n\r\n    if (this.loop === true && this.currentTime > this.duration) {\r\n\r\n      this.currentTime %= this.duration;\r\n\r\n    }\r\n\r\n    this.currentTime = Math.min(this.currentTime, this.duration);\r\n\r\n    var interpolation = this.duration / this.frames;\r\n    var frame = Math.floor(this.currentTime / interpolation);\r\n\r\n    var influences = this.mesh.morphTargetInfluences;\r\n\r\n    if (frame != this.currentFrame) {\r\n\r\n      influences[this.lastFrame] = 0;\r\n      influences[this.currentFrame] = 1;\r\n      influences[frame] = 0;\r\n\r\n      this.lastFrame = this.currentFrame;\r\n      this.currentFrame = frame;\r\n\r\n    }\r\n\r\n    influences[frame] = (this.currentTime % interpolation) / interpolation;\r\n    influences[this.lastFrame] = 1 - influences[frame];\r\n\r\n  }\r\n\r\n};\r\n\r\n// File:src/extras/geometries/BoxGeometry.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * based on http://papervision3d.googlecode.com/svn/trunk/as3/trunk/src/org/papervision3d/objects/primitives/Cube.as\r\n */\r\n\r\nTHREE.BoxGeometry = function(width, height, depth, widthSegments, heightSegments, depthSegments) {\r\n\r\n  THREE.Geometry.call(this);\r\n\r\n  this.type = 'BoxGeometry';\r\n\r\n  this.parameters = {\r\n    width: width,\r\n    height: height,\r\n    depth: depth,\r\n    widthSegments: widthSegments,\r\n    heightSegments: heightSegments,\r\n    depthSegments: depthSegments\r\n  };\r\n\r\n  this.widthSegments = widthSegments || 1;\r\n  this.heightSegments = heightSegments || 1;\r\n  this.depthSegments = depthSegments || 1;\r\n\r\n  var scope = this;\r\n\r\n  var width_half = width / 2;\r\n  var height_half = height / 2;\r\n  var depth_half = depth / 2;\r\n\r\n  buildPlane('z', 'y', -1, -1, depth, height, width_half, 0); // px\r\n  buildPlane('z', 'y', 1, -1, depth, height, -width_half, 1); // nx\r\n  buildPlane('x', 'z', 1, 1, width, depth, height_half, 2); // py\r\n  buildPlane('x', 'z', 1, -1, width, depth, -height_half, 3); // ny\r\n  buildPlane('x', 'y', 1, -1, width, height, depth_half, 4); // pz\r\n  buildPlane('x', 'y', -1, -1, width, height, -depth_half, 5); // nz\r\n\r\n  function buildPlane(u, v, udir, vdir, width, height, depth, materialIndex) {\r\n\r\n    var w, ix, iy,\r\n      gridX = scope.widthSegments,\r\n      gridY = scope.heightSegments,\r\n      width_half = width / 2,\r\n      height_half = height / 2,\r\n      offset = scope.vertices.length;\r\n\r\n    if ((u === 'x' && v === 'y') || (u === 'y' && v === 'x')) {\r\n\r\n      w = 'z';\r\n\r\n    }\r\n    else if ((u === 'x' && v === 'z') || (u === 'z' && v === 'x')) {\r\n\r\n      w = 'y';\r\n      gridY = scope.depthSegments;\r\n\r\n    }\r\n    else if ((u === 'z' && v === 'y') || (u === 'y' && v === 'z')) {\r\n\r\n      w = 'x';\r\n      gridX = scope.depthSegments;\r\n\r\n    }\r\n\r\n    var gridX1 = gridX + 1,\r\n      gridY1 = gridY + 1,\r\n      segment_width = width / gridX,\r\n      segment_height = height / gridY,\r\n      normal = new THREE.Vector3();\r\n\r\n    normal[w] = depth > 0 ? 1 : -1;\r\n\r\n    for (iy = 0; iy < gridY1; iy++) {\r\n\r\n      for (ix = 0; ix < gridX1; ix++) {\r\n\r\n        var vector = new THREE.Vector3();\r\n        vector[u] = (ix * segment_width - width_half) * udir;\r\n        vector[v] = (iy * segment_height - height_half) * vdir;\r\n        vector[w] = depth;\r\n\r\n        scope.vertices.push(vector);\r\n\r\n      }\r\n\r\n    }\r\n\r\n    for (iy = 0; iy < gridY; iy++) {\r\n\r\n      for (ix = 0; ix < gridX; ix++) {\r\n\r\n        var a = ix + gridX1 * iy;\r\n        var b = ix + gridX1 * (iy + 1);\r\n        var c = (ix + 1) + gridX1 * (iy + 1);\r\n        var d = (ix + 1) + gridX1 * iy;\r\n\r\n        var uva = new THREE.Vector2(ix / gridX, 1 - iy / gridY);\r\n        var uvb = new THREE.Vector2(ix / gridX, 1 - (iy + 1) / gridY);\r\n        var uvc = new THREE.Vector2((ix + 1) / gridX, 1 - (iy + 1) / gridY);\r\n        var uvd = new THREE.Vector2((ix + 1) / gridX, 1 - iy / gridY);\r\n\r\n        var face = new THREE.Face3(a + offset, b + offset, d + offset);\r\n        face.normal.copy(normal);\r\n        face.vertexNormals.push(normal.clone(), normal.clone(), normal.clone());\r\n        face.materialIndex = materialIndex;\r\n\r\n        scope.faces.push(face);\r\n        scope.faceVertexUvs[0].push([uva, uvb, uvd]);\r\n\r\n        face = new THREE.Face3(b + offset, c + offset, d + offset);\r\n        face.normal.copy(normal);\r\n        face.vertexNormals.push(normal.clone(), normal.clone(), normal.clone());\r\n        face.materialIndex = materialIndex;\r\n\r\n        scope.faces.push(face);\r\n        scope.faceVertexUvs[0].push([uvb.clone(), uvc, uvd.clone()]);\r\n\r\n      }\r\n\r\n    }\r\n\r\n  }\r\n\r\n  this.mergeVertices();\r\n\r\n};\r\n\r\nTHREE.BoxGeometry.prototype = Object.create(THREE.Geometry.prototype);\r\nTHREE.BoxGeometry.prototype.constructor = THREE.BoxGeometry;\r\n\r\n// File:src/extras/geometries/CircleGeometry.js\r\n\r\n/**\r\n * @author hughes\r\n */\r\n\r\nTHREE.CircleGeometry = function(radius, segments, thetaStart, thetaLength) {\r\n\r\n  THREE.Geometry.call(this);\r\n\r\n  this.type = 'CircleGeometry';\r\n\r\n  this.parameters = {\r\n    radius: radius,\r\n    segments: segments,\r\n    thetaStart: thetaStart,\r\n    thetaLength: thetaLength\r\n  };\r\n\r\n  radius = radius || 50;\r\n  segments = segments !== undefined ? Math.max(3, segments) : 8;\r\n\r\n  thetaStart = thetaStart !== undefined ? thetaStart : 0;\r\n  thetaLength = thetaLength !== undefined ? thetaLength : Math.PI * 2;\r\n\r\n  var i, uvs = [],\r\n    center = new THREE.Vector3(),\r\n    centerUV = new THREE.Vector2(0.5, 0.5);\r\n\r\n  this.vertices.push(center);\r\n  uvs.push(centerUV);\r\n\r\n  for (i = 0; i <= segments; i++) {\r\n\r\n    var vertex = new THREE.Vector3();\r\n    var segment = thetaStart + i / segments * thetaLength;\r\n\r\n    vertex.x = radius * Math.cos(segment);\r\n    vertex.y = radius * Math.sin(segment);\r\n\r\n    this.vertices.push(vertex);\r\n    uvs.push(new THREE.Vector2((vertex.x / radius + 1) / 2, (vertex.y / radius + 1) / 2));\r\n\r\n  }\r\n\r\n  var n = new THREE.Vector3(0, 0, 1);\r\n\r\n  for (i = 1; i <= segments; i++) {\r\n\r\n    this.faces.push(new THREE.Face3(i, i + 1, 0, [n.clone(), n.clone(), n.clone()]));\r\n    this.faceVertexUvs[0].push([uvs[i].clone(), uvs[i + 1].clone(), centerUV.clone()]);\r\n\r\n  }\r\n\r\n  this.computeFaceNormals();\r\n\r\n  this.boundingSphere = new THREE.Sphere(new THREE.Vector3(), radius);\r\n\r\n};\r\n\r\nTHREE.CircleGeometry.prototype = Object.create(THREE.Geometry.prototype);\r\nTHREE.CircleGeometry.prototype.constructor = THREE.CircleGeometry;\r\n\r\n// File:src/extras/geometries/CubeGeometry.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\n\r\nTHREE.CubeGeometry = function(width, height, depth, widthSegments, heightSegments, depthSegments) {\r\n\r\n  THREE.warn('THREE.CubeGeometry has been renamed to THREE.BoxGeometry.');\r\n  return new THREE.BoxGeometry(width, height, depth, widthSegments, heightSegments, depthSegments);\r\n\r\n};\r\n\r\n// File:src/extras/geometries/CylinderGeometry.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.CylinderGeometry = function(radiusTop, radiusBottom, height, radialSegments, heightSegments, openEnded, thetaStart, thetaLength) {\r\n\r\n  THREE.Geometry.call(this);\r\n\r\n  this.type = 'CylinderGeometry';\r\n\r\n  this.parameters = {\r\n    radiusTop: radiusTop,\r\n    radiusBottom: radiusBottom,\r\n    height: height,\r\n    radialSegments: radialSegments,\r\n    heightSegments: heightSegments,\r\n    openEnded: openEnded,\r\n    thetaStart: thetaStart,\r\n    thetaLength: thetaLength\r\n  };\r\n\r\n  radiusTop = radiusTop !== undefined ? radiusTop : 20;\r\n  radiusBottom = radiusBottom !== undefined ? radiusBottom : 20;\r\n  height = height !== undefined ? height : 100;\r\n\r\n  radialSegments = radialSegments || 8;\r\n  heightSegments = heightSegments || 1;\r\n\r\n  openEnded = openEnded !== undefined ? openEnded : false;\r\n  thetaStart = thetaStart !== undefined ? thetaStart : 0;\r\n  thetaLength = thetaLength !== undefined ? thetaLength : 2 * Math.PI;\r\n\r\n  var heightHalf = height / 2;\r\n\r\n  var x, y, vertices = [],\r\n    uvs = [];\r\n\r\n  for (y = 0; y <= heightSegments; y++) {\r\n\r\n    var verticesRow = [];\r\n    var uvsRow = [];\r\n\r\n    var v = y / heightSegments;\r\n    var radius = v * (radiusBottom - radiusTop) + radiusTop;\r\n\r\n    for (x = 0; x <= radialSegments; x++) {\r\n\r\n      var u = x / radialSegments;\r\n\r\n      var vertex = new THREE.Vector3();\r\n      vertex.x = radius * Math.sin(u * thetaLength + thetaStart);\r\n      vertex.y = -v * height + heightHalf;\r\n      vertex.z = radius * Math.cos(u * thetaLength + thetaStart);\r\n\r\n      this.vertices.push(vertex);\r\n\r\n      verticesRow.push(this.vertices.length - 1);\r\n      uvsRow.push(new THREE.Vector2(u, 1 - v));\r\n\r\n    }\r\n\r\n    vertices.push(verticesRow);\r\n    uvs.push(uvsRow);\r\n\r\n  }\r\n\r\n  var tanTheta = (radiusBottom - radiusTop) / height;\r\n  var na, nb;\r\n\r\n  for (x = 0; x < radialSegments; x++) {\r\n\r\n    if (radiusTop !== 0) {\r\n\r\n      na = this.vertices[vertices[0][x]].clone();\r\n      nb = this.vertices[vertices[0][x + 1]].clone();\r\n\r\n    }\r\n    else {\r\n\r\n      na = this.vertices[vertices[1][x]].clone();\r\n      nb = this.vertices[vertices[1][x + 1]].clone();\r\n\r\n    }\r\n\r\n    na.setY(Math.sqrt(na.x * na.x + na.z * na.z) * tanTheta).normalize();\r\n    nb.setY(Math.sqrt(nb.x * nb.x + nb.z * nb.z) * tanTheta).normalize();\r\n\r\n    for (y = 0; y < heightSegments; y++) {\r\n\r\n      var v1 = vertices[y][x];\r\n      var v2 = vertices[y + 1][x];\r\n      var v3 = vertices[y + 1][x + 1];\r\n      var v4 = vertices[y][x + 1];\r\n\r\n      var n1 = na.clone();\r\n      var n2 = na.clone();\r\n      var n3 = nb.clone();\r\n      var n4 = nb.clone();\r\n\r\n      var uv1 = uvs[y][x].clone();\r\n      var uv2 = uvs[y + 1][x].clone();\r\n      var uv3 = uvs[y + 1][x + 1].clone();\r\n      var uv4 = uvs[y][x + 1].clone();\r\n\r\n      this.faces.push(new THREE.Face3(v1, v2, v4, [n1, n2, n4]));\r\n      this.faceVertexUvs[0].push([uv1, uv2, uv4]);\r\n\r\n      this.faces.push(new THREE.Face3(v2, v3, v4, [n2.clone(), n3, n4.clone()]));\r\n      this.faceVertexUvs[0].push([uv2.clone(), uv3, uv4.clone()]);\r\n\r\n    }\r\n\r\n  }\r\n\r\n  // top cap\r\n\r\n  if (openEnded === false && radiusTop > 0) {\r\n\r\n    this.vertices.push(new THREE.Vector3(0, heightHalf, 0));\r\n\r\n    for (x = 0; x < radialSegments; x++) {\r\n\r\n      var v1 = vertices[0][x];\r\n      var v2 = vertices[0][x + 1];\r\n      var v3 = this.vertices.length - 1;\r\n\r\n      var n1 = new THREE.Vector3(0, 1, 0);\r\n      var n2 = new THREE.Vector3(0, 1, 0);\r\n      var n3 = new THREE.Vector3(0, 1, 0);\r\n\r\n      var uv1 = uvs[0][x].clone();\r\n      var uv2 = uvs[0][x + 1].clone();\r\n      var uv3 = new THREE.Vector2(uv2.x, 0);\r\n\r\n      this.faces.push(new THREE.Face3(v1, v2, v3, [n1, n2, n3]));\r\n      this.faceVertexUvs[0].push([uv1, uv2, uv3]);\r\n\r\n    }\r\n\r\n  }\r\n\r\n  // bottom cap\r\n\r\n  if (openEnded === false && radiusBottom > 0) {\r\n\r\n    this.vertices.push(new THREE.Vector3(0, -heightHalf, 0));\r\n\r\n    for (x = 0; x < radialSegments; x++) {\r\n\r\n      var v1 = vertices[heightSegments][x + 1];\r\n      var v2 = vertices[heightSegments][x];\r\n      var v3 = this.vertices.length - 1;\r\n\r\n      var n1 = new THREE.Vector3(0, -1, 0);\r\n      var n2 = new THREE.Vector3(0, -1, 0);\r\n      var n3 = new THREE.Vector3(0, -1, 0);\r\n\r\n      var uv1 = uvs[heightSegments][x + 1].clone();\r\n      var uv2 = uvs[heightSegments][x].clone();\r\n      var uv3 = new THREE.Vector2(uv2.x, 1);\r\n\r\n      this.faces.push(new THREE.Face3(v1, v2, v3, [n1, n2, n3]));\r\n      this.faceVertexUvs[0].push([uv1, uv2, uv3]);\r\n\r\n    }\r\n\r\n  }\r\n\r\n  this.computeFaceNormals();\r\n\r\n};\r\n\r\nTHREE.CylinderGeometry.prototype = Object.create(THREE.Geometry.prototype);\r\nTHREE.CylinderGeometry.prototype.constructor = THREE.CylinderGeometry;\r\n\r\n// File:src/extras/geometries/ExtrudeGeometry.js\r\n\r\n/**\r\n * @author zz85 / http://www.lab4games.net/zz85/blog\r\n *\r\n * Creates extruded geometry from a path shape.\r\n *\r\n * parameters = {\r\n *\r\n *  curveSegments: <int>, // number of points on the curves\r\n *  steps: <int>, // number of points for z-side extrusions / used for subdividing segements of extrude spline too\r\n *  amount: <int>, // Depth to extrude the shape\r\n *\r\n *  bevelEnabled: <bool>, // turn on bevel\r\n *  bevelThickness: <float>, // how deep into the original shape bevel goes\r\n *  bevelSize: <float>, // how far from shape outline is bevel\r\n *  bevelSegments: <int>, // number of bevel layers\r\n *\r\n *  extrudePath: <THREE.CurvePath> // 3d spline path to extrude shape along. (creates Frames if .frames aren't defined)\r\n *  frames: <THREE.TubeGeometry.FrenetFrames> // containing arrays of tangents, normals, binormals\r\n *\r\n *  material: <int> // material index for front and back faces\r\n *  extrudeMaterial: <int> // material index for extrusion and beveled faces\r\n *  uvGenerator: <Object> // object that provides UV generator functions\r\n *\r\n * }\r\n **/\r\n\r\nTHREE.ExtrudeGeometry = function(shapes, options) {\r\n\r\n  if (typeof(shapes) === \"undefined\") {\r\n    shapes = [];\r\n    return;\r\n  }\r\n\r\n  THREE.Geometry.call(this);\r\n\r\n  this.type = 'ExtrudeGeometry';\r\n\r\n  shapes = shapes instanceof Array ? shapes : [shapes];\r\n\r\n  this.addShapeList(shapes, options);\r\n\r\n  this.computeFaceNormals();\r\n\r\n  // can't really use automatic vertex normals\r\n  // as then front and back sides get smoothed too\r\n  // should do separate smoothing just for sides\r\n\r\n  //this.computeVertexNormals();\r\n\r\n  //console.log( \"took\", ( Date.now() - startTime ) );\r\n\r\n};\r\n\r\nTHREE.ExtrudeGeometry.prototype = Object.create(THREE.Geometry.prototype);\r\nTHREE.ExtrudeGeometry.prototype.constructor = THREE.ExtrudeGeometry;\r\n\r\nTHREE.ExtrudeGeometry.prototype.addShapeList = function(shapes, options) {\r\n  var sl = shapes.length;\r\n\r\n  for (var s = 0; s < sl; s++) {\r\n    var shape = shapes[s];\r\n    this.addShape(shape, options);\r\n  }\r\n};\r\n\r\nTHREE.ExtrudeGeometry.prototype.addShape = function(shape, options) {\r\n\r\n  var amount = options.amount !== undefined ? options.amount : 100;\r\n\r\n  var bevelThickness = options.bevelThickness !== undefined ? options.bevelThickness : 6; // 10\r\n  var bevelSize = options.bevelSize !== undefined ? options.bevelSize : bevelThickness - 2; // 8\r\n  var bevelSegments = options.bevelSegments !== undefined ? options.bevelSegments : 3;\r\n\r\n  var bevelEnabled = options.bevelEnabled !== undefined ? options.bevelEnabled : true; // false\r\n\r\n  var curveSegments = options.curveSegments !== undefined ? options.curveSegments : 12;\r\n\r\n  var steps = options.steps !== undefined ? options.steps : 1;\r\n\r\n  var extrudePath = options.extrudePath;\r\n  var extrudePts, extrudeByPath = false;\r\n\r\n  var material = options.material;\r\n  var extrudeMaterial = options.extrudeMaterial;\r\n\r\n  // Use default WorldUVGenerator if no UV generators are specified.\r\n  var uvgen = options.UVGenerator !== undefined ? options.UVGenerator : THREE.ExtrudeGeometry.WorldUVGenerator;\r\n\r\n  var splineTube, binormal, normal, position2;\r\n  if (extrudePath) {\r\n\r\n    extrudePts = extrudePath.getSpacedPoints(steps);\r\n\r\n    extrudeByPath = true;\r\n    bevelEnabled = false; // bevels not supported for path extrusion\r\n\r\n    // SETUP TNB variables\r\n\r\n    // Reuse TNB from TubeGeomtry for now.\r\n    // TODO1 - have a .isClosed in spline?\r\n\r\n    splineTube = options.frames !== undefined ? options.frames : new THREE.TubeGeometry.FrenetFrames(extrudePath, steps, false);\r\n\r\n    // console.log(splineTube, 'splineTube', splineTube.normals.length, 'steps', steps, 'extrudePts', extrudePts.length);\r\n\r\n    binormal = new THREE.Vector3();\r\n    normal = new THREE.Vector3();\r\n    position2 = new THREE.Vector3();\r\n\r\n  }\r\n\r\n  // Safeguards if bevels are not enabled\r\n\r\n  if (!bevelEnabled) {\r\n\r\n    bevelSegments = 0;\r\n    bevelThickness = 0;\r\n    bevelSize = 0;\r\n\r\n  }\r\n\r\n  // Variables initalization\r\n\r\n  var ahole, h, hl; // looping of holes\r\n  var scope = this;\r\n\r\n  var shapesOffset = this.vertices.length;\r\n\r\n  var shapePoints = shape.extractPoints(curveSegments);\r\n\r\n  var vertices = shapePoints.shape;\r\n  var holes = shapePoints.holes;\r\n\r\n  var reverse = !THREE.Shape.Utils.isClockWise(vertices);\r\n\r\n  if (reverse) {\r\n\r\n    vertices = vertices.reverse();\r\n\r\n    // Maybe we should also check if holes are in the opposite direction, just to be safe ...\r\n\r\n    for (h = 0, hl = holes.length; h < hl; h++) {\r\n\r\n      ahole = holes[h];\r\n\r\n      if (THREE.Shape.Utils.isClockWise(ahole)) {\r\n\r\n        holes[h] = ahole.reverse();\r\n\r\n      }\r\n\r\n    }\r\n\r\n    reverse = false; // If vertices are in order now, we shouldn't need to worry about them again (hopefully)!\r\n\r\n  }\r\n\r\n\r\n  var faces = THREE.Shape.Utils.triangulateShape(vertices, holes);\r\n\r\n  /* Vertices */\r\n\r\n  var contour = vertices; // vertices has all points but contour has only points of circumference\r\n\r\n  for (h = 0, hl = holes.length; h < hl; h++) {\r\n\r\n    ahole = holes[h];\r\n\r\n    vertices = vertices.concat(ahole);\r\n\r\n  }\r\n\r\n\r\n  function scalePt2(pt, vec, size) {\r\n\r\n    if (!vec) THREE.error(\"THREE.ExtrudeGeometry: vec does not exist\");\r\n\r\n    return vec.clone().multiplyScalar(size).add(pt);\r\n\r\n  }\r\n\r\n  var b, bs, t, z,\r\n    vert, vlen = vertices.length,\r\n    face, flen = faces.length;\r\n\r\n\r\n  // Find directions for point movement\r\n\r\n\r\n  function getBevelVec(inPt, inPrev, inNext) {\r\n\r\n    var EPSILON = 0.0000000001;\r\n\r\n    // computes for inPt the corresponding point inPt' on a new contour\r\n    //   shiftet by 1 unit (length of normalized vector) to the left\r\n    // if we walk along contour clockwise, this new contour is outside the old one\r\n    //\r\n    // inPt' is the intersection of the two lines parallel to the two\r\n    //  adjacent edges of inPt at a distance of 1 unit on the left side.\r\n\r\n    var v_trans_x, v_trans_y, shrink_by = 1; // resulting translation vector for inPt\r\n\r\n    // good reading for geometry algorithms (here: line-line intersection)\r\n    // http://geomalgorithms.com/a05-_intersect-1.html\r\n\r\n    var v_prev_x = inPt.x - inPrev.x,\r\n      v_prev_y = inPt.y - inPrev.y;\r\n    var v_next_x = inNext.x - inPt.x,\r\n      v_next_y = inNext.y - inPt.y;\r\n\r\n    var v_prev_lensq = (v_prev_x * v_prev_x + v_prev_y * v_prev_y);\r\n\r\n    // check for colinear edges\r\n    var colinear0 = (v_prev_x * v_next_y - v_prev_y * v_next_x);\r\n\r\n    if (Math.abs(colinear0) > EPSILON) { // not colinear\r\n\r\n      // length of vectors for normalizing\r\n\r\n      var v_prev_len = Math.sqrt(v_prev_lensq);\r\n      var v_next_len = Math.sqrt(v_next_x * v_next_x + v_next_y * v_next_y);\r\n\r\n      // shift adjacent points by unit vectors to the left\r\n\r\n      var ptPrevShift_x = (inPrev.x - v_prev_y / v_prev_len);\r\n      var ptPrevShift_y = (inPrev.y + v_prev_x / v_prev_len);\r\n\r\n      var ptNextShift_x = (inNext.x - v_next_y / v_next_len);\r\n      var ptNextShift_y = (inNext.y + v_next_x / v_next_len);\r\n\r\n      // scaling factor for v_prev to intersection point\r\n\r\n      var sf = ((ptNextShift_x - ptPrevShift_x) * v_next_y -\r\n          (ptNextShift_y - ptPrevShift_y) * v_next_x) /\r\n        (v_prev_x * v_next_y - v_prev_y * v_next_x);\r\n\r\n      // vector from inPt to intersection point\r\n\r\n      v_trans_x = (ptPrevShift_x + v_prev_x * sf - inPt.x);\r\n      v_trans_y = (ptPrevShift_y + v_prev_y * sf - inPt.y);\r\n\r\n      // Don't normalize!, otherwise sharp corners become ugly\r\n      //  but prevent crazy spikes\r\n      var v_trans_lensq = (v_trans_x * v_trans_x + v_trans_y * v_trans_y)\r\n      if (v_trans_lensq <= 2) {\r\n        return new THREE.Vector2(v_trans_x, v_trans_y);\r\n      }\r\n      else {\r\n        shrink_by = Math.sqrt(v_trans_lensq / 2);\r\n      }\r\n\r\n    }\r\n    else { // handle special case of colinear edges\r\n\r\n      var direction_eq = false; // assumes: opposite\r\n      if (v_prev_x > EPSILON) {\r\n        if (v_next_x > EPSILON) {\r\n          direction_eq = true;\r\n        }\r\n      }\r\n      else {\r\n        if (v_prev_x < -EPSILON) {\r\n          if (v_next_x < -EPSILON) {\r\n            direction_eq = true;\r\n          }\r\n        }\r\n        else {\r\n          if (Math.sign(v_prev_y) == Math.sign(v_next_y)) {\r\n            direction_eq = true;\r\n          }\r\n        }\r\n      }\r\n\r\n      if (direction_eq) {\r\n        // console.log(\"Warning: lines are a straight sequence\");\r\n        v_trans_x = -v_prev_y;\r\n        v_trans_y = v_prev_x;\r\n        shrink_by = Math.sqrt(v_prev_lensq);\r\n      }\r\n      else {\r\n        // console.log(\"Warning: lines are a straight spike\");\r\n        v_trans_x = v_prev_x;\r\n        v_trans_y = v_prev_y;\r\n        shrink_by = Math.sqrt(v_prev_lensq / 2);\r\n      }\r\n\r\n    }\r\n\r\n    return new THREE.Vector2(v_trans_x / shrink_by, v_trans_y / shrink_by);\r\n\r\n  }\r\n\r\n\r\n  var contourMovements = [];\r\n\r\n  for (var i = 0, il = contour.length, j = il - 1, k = i + 1; i < il; i++, j++, k++) {\r\n\r\n    if (j === il) j = 0;\r\n    if (k === il) k = 0;\r\n\r\n    //  (j)---(i)---(k)\r\n    // console.log('i,j,k', i, j , k)\r\n\r\n    contourMovements[i] = getBevelVec(contour[i], contour[j], contour[k]);\r\n\r\n  }\r\n\r\n  var holesMovements = [],\r\n    oneHoleMovements, verticesMovements = contourMovements.concat();\r\n\r\n  for (h = 0, hl = holes.length; h < hl; h++) {\r\n\r\n    ahole = holes[h];\r\n\r\n    oneHoleMovements = [];\r\n\r\n    for (i = 0, il = ahole.length, j = il - 1, k = i + 1; i < il; i++, j++, k++) {\r\n\r\n      if (j === il) j = 0;\r\n      if (k === il) k = 0;\r\n\r\n      //  (j)---(i)---(k)\r\n      oneHoleMovements[i] = getBevelVec(ahole[i], ahole[j], ahole[k]);\r\n\r\n    }\r\n\r\n    holesMovements.push(oneHoleMovements);\r\n    verticesMovements = verticesMovements.concat(oneHoleMovements);\r\n\r\n  }\r\n\r\n\r\n  // Loop bevelSegments, 1 for the front, 1 for the back\r\n\r\n  for (b = 0; b < bevelSegments; b++) {\r\n    //for ( b = bevelSegments; b > 0; b -- ) {\r\n\r\n    t = b / bevelSegments;\r\n    z = bevelThickness * (1 - t);\r\n\r\n    //z = bevelThickness * t;\r\n    bs = bevelSize * (Math.sin(t * Math.PI / 2)); // curved\r\n    //bs = bevelSize * t ; // linear\r\n\r\n    // contract shape\r\n\r\n    for (i = 0, il = contour.length; i < il; i++) {\r\n\r\n      vert = scalePt2(contour[i], contourMovements[i], bs);\r\n\r\n      v(vert.x, vert.y, -z);\r\n\r\n    }\r\n\r\n    // expand holes\r\n\r\n    for (h = 0, hl = holes.length; h < hl; h++) {\r\n\r\n      ahole = holes[h];\r\n      oneHoleMovements = holesMovements[h];\r\n\r\n      for (i = 0, il = ahole.length; i < il; i++) {\r\n\r\n        vert = scalePt2(ahole[i], oneHoleMovements[i], bs);\r\n\r\n        v(vert.x, vert.y, -z);\r\n\r\n      }\r\n\r\n    }\r\n\r\n  }\r\n\r\n  bs = bevelSize;\r\n\r\n  // Back facing vertices\r\n\r\n  for (i = 0; i < vlen; i++) {\r\n\r\n    vert = bevelEnabled ? scalePt2(vertices[i], verticesMovements[i], bs) : vertices[i];\r\n\r\n    if (!extrudeByPath) {\r\n\r\n      v(vert.x, vert.y, 0);\r\n\r\n    }\r\n    else {\r\n\r\n      // v( vert.x, vert.y + extrudePts[ 0 ].y, extrudePts[ 0 ].x );\r\n\r\n      normal.copy(splineTube.normals[0]).multiplyScalar(vert.x);\r\n      binormal.copy(splineTube.binormals[0]).multiplyScalar(vert.y);\r\n\r\n      position2.copy(extrudePts[0]).add(normal).add(binormal);\r\n\r\n      v(position2.x, position2.y, position2.z);\r\n\r\n    }\r\n\r\n  }\r\n\r\n  // Add stepped vertices...\r\n  // Including front facing vertices\r\n\r\n  var s;\r\n\r\n  for (s = 1; s <= steps; s++) {\r\n\r\n    for (i = 0; i < vlen; i++) {\r\n\r\n      vert = bevelEnabled ? scalePt2(vertices[i], verticesMovements[i], bs) : vertices[i];\r\n\r\n      if (!extrudeByPath) {\r\n\r\n        v(vert.x, vert.y, amount / steps * s);\r\n\r\n      }\r\n      else {\r\n\r\n        // v( vert.x, vert.y + extrudePts[ s - 1 ].y, extrudePts[ s - 1 ].x );\r\n\r\n        normal.copy(splineTube.normals[s]).multiplyScalar(vert.x);\r\n        binormal.copy(splineTube.binormals[s]).multiplyScalar(vert.y);\r\n\r\n        position2.copy(extrudePts[s]).add(normal).add(binormal);\r\n\r\n        v(position2.x, position2.y, position2.z);\r\n\r\n      }\r\n\r\n    }\r\n\r\n  }\r\n\r\n\r\n  // Add bevel segments planes\r\n\r\n  //for ( b = 1; b <= bevelSegments; b ++ ) {\r\n  for (b = bevelSegments - 1; b >= 0; b--) {\r\n\r\n    t = b / bevelSegments;\r\n    z = bevelThickness * (1 - t);\r\n    //bs = bevelSize * ( 1-Math.sin ( ( 1 - t ) * Math.PI/2 ) );\r\n    bs = bevelSize * Math.sin(t * Math.PI / 2);\r\n\r\n    // contract shape\r\n\r\n    for (i = 0, il = contour.length; i < il; i++) {\r\n\r\n      vert = scalePt2(contour[i], contourMovements[i], bs);\r\n      v(vert.x, vert.y, amount + z);\r\n\r\n    }\r\n\r\n    // expand holes\r\n\r\n    for (h = 0, hl = holes.length; h < hl; h++) {\r\n\r\n      ahole = holes[h];\r\n      oneHoleMovements = holesMovements[h];\r\n\r\n      for (i = 0, il = ahole.length; i < il; i++) {\r\n\r\n        vert = scalePt2(ahole[i], oneHoleMovements[i], bs);\r\n\r\n        if (!extrudeByPath) {\r\n\r\n          v(vert.x, vert.y, amount + z);\r\n\r\n        }\r\n        else {\r\n\r\n          v(vert.x, vert.y + extrudePts[steps - 1].y, extrudePts[steps - 1].x + z);\r\n\r\n        }\r\n\r\n      }\r\n\r\n    }\r\n\r\n  }\r\n\r\n  /* Faces */\r\n\r\n  // Top and bottom faces\r\n\r\n  buildLidFaces();\r\n\r\n  // Sides faces\r\n\r\n  buildSideFaces();\r\n\r\n\r\n  /////  Internal functions\r\n\r\n  function buildLidFaces() {\r\n\r\n    if (bevelEnabled) {\r\n\r\n      var layer = 0; // steps + 1\r\n      var offset = vlen * layer;\r\n\r\n      // Bottom faces\r\n\r\n      for (i = 0; i < flen; i++) {\r\n\r\n        face = faces[i];\r\n        f3(face[2] + offset, face[1] + offset, face[0] + offset);\r\n\r\n      }\r\n\r\n      layer = steps + bevelSegments * 2;\r\n      offset = vlen * layer;\r\n\r\n      // Top faces\r\n\r\n      for (i = 0; i < flen; i++) {\r\n\r\n        face = faces[i];\r\n        f3(face[0] + offset, face[1] + offset, face[2] + offset);\r\n\r\n      }\r\n\r\n    }\r\n    else {\r\n\r\n      // Bottom faces\r\n\r\n      for (i = 0; i < flen; i++) {\r\n\r\n        face = faces[i];\r\n        f3(face[2], face[1], face[0]);\r\n\r\n      }\r\n\r\n      // Top faces\r\n\r\n      for (i = 0; i < flen; i++) {\r\n\r\n        face = faces[i];\r\n        f3(face[0] + vlen * steps, face[1] + vlen * steps, face[2] + vlen * steps);\r\n\r\n      }\r\n    }\r\n\r\n  }\r\n\r\n  // Create faces for the z-sides of the shape\r\n\r\n  function buildSideFaces() {\r\n\r\n    var layeroffset = 0;\r\n    sidewalls(contour, layeroffset);\r\n    layeroffset += contour.length;\r\n\r\n    for (h = 0, hl = holes.length; h < hl; h++) {\r\n\r\n      ahole = holes[h];\r\n      sidewalls(ahole, layeroffset);\r\n\r\n      //, true\r\n      layeroffset += ahole.length;\r\n\r\n    }\r\n\r\n  }\r\n\r\n  function sidewalls(contour, layeroffset) {\r\n\r\n    var j, k;\r\n    i = contour.length;\r\n\r\n    while (--i >= 0) {\r\n\r\n      j = i;\r\n      k = i - 1;\r\n      if (k < 0) k = contour.length - 1;\r\n\r\n      //console.log('b', i,j, i-1, k,vertices.length);\r\n\r\n      var s = 0,\r\n        sl = steps + bevelSegments * 2;\r\n\r\n      for (s = 0; s < sl; s++) {\r\n\r\n        var slen1 = vlen * s;\r\n        var slen2 = vlen * (s + 1);\r\n\r\n        var a = layeroffset + j + slen1,\r\n          b = layeroffset + k + slen1,\r\n          c = layeroffset + k + slen2,\r\n          d = layeroffset + j + slen2;\r\n\r\n        f4(a, b, c, d, contour, s, sl, j, k);\r\n\r\n      }\r\n    }\r\n\r\n  }\r\n\r\n\r\n  function v(x, y, z) {\r\n\r\n    scope.vertices.push(new THREE.Vector3(x, y, z));\r\n\r\n  }\r\n\r\n  function f3(a, b, c) {\r\n\r\n    a += shapesOffset;\r\n    b += shapesOffset;\r\n    c += shapesOffset;\r\n\r\n    // normal, color, material\r\n    scope.faces.push(new THREE.Face3(a, b, c, null, null, material));\r\n\r\n    var uvs = uvgen.generateTopUV(scope, a, b, c);\r\n\r\n    scope.faceVertexUvs[0].push(uvs);\r\n\r\n  }\r\n\r\n  function f4(a, b, c, d, wallContour, stepIndex, stepsLength, contourIndex1, contourIndex2) {\r\n\r\n    a += shapesOffset;\r\n    b += shapesOffset;\r\n    c += shapesOffset;\r\n    d += shapesOffset;\r\n\r\n    scope.faces.push(new THREE.Face3(a, b, d, null, null, extrudeMaterial));\r\n    scope.faces.push(new THREE.Face3(b, c, d, null, null, extrudeMaterial));\r\n\r\n    var uvs = uvgen.generateSideWallUV(scope, a, b, c, d);\r\n\r\n    scope.faceVertexUvs[0].push([uvs[0], uvs[1], uvs[3]]);\r\n    scope.faceVertexUvs[0].push([uvs[1], uvs[2], uvs[3]]);\r\n\r\n  }\r\n\r\n};\r\n\r\nTHREE.ExtrudeGeometry.WorldUVGenerator = {\r\n\r\n  generateTopUV: function(geometry, indexA, indexB, indexC) {\r\n\r\n    var vertices = geometry.vertices;\r\n\r\n    var a = vertices[indexA];\r\n    var b = vertices[indexB];\r\n    var c = vertices[indexC];\r\n\r\n    return [\r\n      new THREE.Vector2(a.x, a.y),\r\n      new THREE.Vector2(b.x, b.y),\r\n      new THREE.Vector2(c.x, c.y)\r\n    ];\r\n\r\n  },\r\n\r\n  generateSideWallUV: function(geometry, indexA, indexB, indexC, indexD) {\r\n\r\n    var vertices = geometry.vertices;\r\n\r\n    var a = vertices[indexA];\r\n    var b = vertices[indexB];\r\n    var c = vertices[indexC];\r\n    var d = vertices[indexD];\r\n\r\n    if (Math.abs(a.y - b.y) < 0.01) {\r\n      return [\r\n        new THREE.Vector2(a.x, 1 - a.z),\r\n        new THREE.Vector2(b.x, 1 - b.z),\r\n        new THREE.Vector2(c.x, 1 - c.z),\r\n        new THREE.Vector2(d.x, 1 - d.z)\r\n      ];\r\n    }\r\n    else {\r\n      return [\r\n        new THREE.Vector2(a.y, 1 - a.z),\r\n        new THREE.Vector2(b.y, 1 - b.z),\r\n        new THREE.Vector2(c.y, 1 - c.z),\r\n        new THREE.Vector2(d.y, 1 - d.z)\r\n      ];\r\n    }\r\n  }\r\n};\r\n\r\n// File:src/extras/geometries/ShapeGeometry.js\r\n\r\n/**\r\n * @author jonobr1 / http://jonobr1.com\r\n *\r\n * Creates a one-sided polygonal geometry from a path shape. Similar to\r\n * ExtrudeGeometry.\r\n *\r\n * parameters = {\r\n *\r\n *\tcurveSegments: <int>, // number of points on the curves. NOT USED AT THE MOMENT.\r\n *\r\n *\tmaterial: <int> // material index for front and back faces\r\n *\tuvGenerator: <Object> // object that provides UV generator functions\r\n *\r\n * }\r\n **/\r\n\r\nTHREE.ShapeGeometry = function(shapes, options) {\r\n\r\n  THREE.Geometry.call(this);\r\n\r\n  this.type = 'ShapeGeometry';\r\n\r\n  if (shapes instanceof Array === false) shapes = [shapes];\r\n\r\n  this.addShapeList(shapes, options);\r\n\r\n  this.computeFaceNormals();\r\n\r\n};\r\n\r\nTHREE.ShapeGeometry.prototype = Object.create(THREE.Geometry.prototype);\r\nTHREE.ShapeGeometry.prototype.constructor = THREE.ShapeGeometry;\r\n\r\n/**\r\n * Add an array of shapes to THREE.ShapeGeometry.\r\n */\r\nTHREE.ShapeGeometry.prototype.addShapeList = function(shapes, options) {\r\n\r\n  for (var i = 0, l = shapes.length; i < l; i++) {\r\n\r\n    this.addShape(shapes[i], options);\r\n\r\n  }\r\n\r\n  return this;\r\n\r\n};\r\n\r\n/**\r\n * Adds a shape to THREE.ShapeGeometry, based on THREE.ExtrudeGeometry.\r\n */\r\nTHREE.ShapeGeometry.prototype.addShape = function(shape, options) {\r\n\r\n  if (options === undefined) options = {};\r\n  var curveSegments = options.curveSegments !== undefined ? options.curveSegments : 12;\r\n\r\n  var material = options.material;\r\n  var uvgen = options.UVGenerator === undefined ? THREE.ExtrudeGeometry.WorldUVGenerator : options.UVGenerator;\r\n\r\n  //\r\n\r\n  var i, l, hole;\r\n\r\n  var shapesOffset = this.vertices.length;\r\n  var shapePoints = shape.extractPoints(curveSegments);\r\n\r\n  var vertices = shapePoints.shape;\r\n  var holes = shapePoints.holes;\r\n\r\n  var reverse = !THREE.Shape.Utils.isClockWise(vertices);\r\n\r\n  if (reverse) {\r\n\r\n    vertices = vertices.reverse();\r\n\r\n    // Maybe we should also check if holes are in the opposite direction, just to be safe...\r\n\r\n    for (i = 0, l = holes.length; i < l; i++) {\r\n\r\n      hole = holes[i];\r\n\r\n      if (THREE.Shape.Utils.isClockWise(hole)) {\r\n\r\n        holes[i] = hole.reverse();\r\n\r\n      }\r\n\r\n    }\r\n\r\n    reverse = false;\r\n\r\n  }\r\n\r\n  var faces = THREE.Shape.Utils.triangulateShape(vertices, holes);\r\n\r\n  // Vertices\r\n\r\n  var contour = vertices;\r\n\r\n  for (i = 0, l = holes.length; i < l; i++) {\r\n\r\n    hole = holes[i];\r\n    vertices = vertices.concat(hole);\r\n\r\n  }\r\n\r\n  //\r\n\r\n  var vert, vlen = vertices.length;\r\n  var face, flen = faces.length;\r\n\r\n  for (i = 0; i < vlen; i++) {\r\n\r\n    vert = vertices[i];\r\n\r\n    this.vertices.push(new THREE.Vector3(vert.x, vert.y, 0));\r\n\r\n  }\r\n\r\n  for (i = 0; i < flen; i++) {\r\n\r\n    face = faces[i];\r\n\r\n    var a = face[0] + shapesOffset;\r\n    var b = face[1] + shapesOffset;\r\n    var c = face[2] + shapesOffset;\r\n\r\n    this.faces.push(new THREE.Face3(a, b, c, null, null, material));\r\n    this.faceVertexUvs[0].push(uvgen.generateTopUV(this, a, b, c));\r\n\r\n  }\r\n\r\n};\r\n\r\n// File:src/extras/geometries/LatheGeometry.js\r\n\r\n/**\r\n * @author astrodud / http://astrodud.isgreat.org/\r\n * @author zz85 / https://github.com/zz85\r\n * @author bhouston / http://exocortex.com\r\n */\r\n\r\n// points - to create a closed torus, one must use a set of points \r\n//    like so: [ a, b, c, d, a ], see first is the same as last.\r\n// segments - the number of circumference segments to create\r\n// phiStart - the starting radian\r\n// phiLength - the radian (0 to 2*PI) range of the lathed section\r\n//    2*pi is a closed lathe, less than 2PI is a portion.\r\n\r\nTHREE.LatheGeometry = function(points, segments, phiStart, phiLength) {\r\n\r\n  THREE.Geometry.call(this);\r\n\r\n  this.type = 'LatheGeometry';\r\n\r\n  this.parameters = {\r\n    points: points,\r\n    segments: segments,\r\n    phiStart: phiStart,\r\n    phiLength: phiLength\r\n  };\r\n\r\n  segments = segments || 12;\r\n  phiStart = phiStart || 0;\r\n  phiLength = phiLength || 2 * Math.PI;\r\n\r\n  var inversePointLength = 1.0 / (points.length - 1);\r\n  var inverseSegments = 1.0 / segments;\r\n\r\n  for (var i = 0, il = segments; i <= il; i++) {\r\n\r\n    var phi = phiStart + i * inverseSegments * phiLength;\r\n\r\n    var c = Math.cos(phi),\r\n      s = Math.sin(phi);\r\n\r\n    for (var j = 0, jl = points.length; j < jl; j++) {\r\n\r\n      var pt = points[j];\r\n\r\n      var vertex = new THREE.Vector3();\r\n\r\n      vertex.x = c * pt.x - s * pt.y;\r\n      vertex.y = s * pt.x + c * pt.y;\r\n      vertex.z = pt.z;\r\n\r\n      this.vertices.push(vertex);\r\n\r\n    }\r\n\r\n  }\r\n\r\n  var np = points.length;\r\n\r\n  for (var i = 0, il = segments; i < il; i++) {\r\n\r\n    for (var j = 0, jl = points.length - 1; j < jl; j++) {\r\n\r\n      var base = j + np * i;\r\n      var a = base;\r\n      var b = base + np;\r\n      var c = base + 1 + np;\r\n      var d = base + 1;\r\n\r\n      var u0 = i * inverseSegments;\r\n      var v0 = j * inversePointLength;\r\n      var u1 = u0 + inverseSegments;\r\n      var v1 = v0 + inversePointLength;\r\n\r\n      this.faces.push(new THREE.Face3(a, b, d));\r\n\r\n      this.faceVertexUvs[0].push([\r\n\r\n        new THREE.Vector2(u0, v0),\r\n        new THREE.Vector2(u1, v0),\r\n        new THREE.Vector2(u0, v1)\r\n\r\n      ]);\r\n\r\n      this.faces.push(new THREE.Face3(b, c, d));\r\n\r\n      this.faceVertexUvs[0].push([\r\n\r\n        new THREE.Vector2(u1, v0),\r\n        new THREE.Vector2(u1, v1),\r\n        new THREE.Vector2(u0, v1)\r\n\r\n      ]);\r\n\r\n\r\n    }\r\n\r\n  }\r\n\r\n  this.mergeVertices();\r\n  this.computeFaceNormals();\r\n  this.computeVertexNormals();\r\n\r\n};\r\n\r\nTHREE.LatheGeometry.prototype = Object.create(THREE.Geometry.prototype);\r\nTHREE.LatheGeometry.prototype.constructor = THREE.LatheGeometry;\r\n\r\n// File:src/extras/geometries/PlaneGeometry.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * based on http://papervision3d.googlecode.com/svn/trunk/as3/trunk/src/org/papervision3d/objects/primitives/Plane.as\r\n */\r\n\r\nTHREE.PlaneGeometry = function(width, height, widthSegments, heightSegments) {\r\n\r\n  console.info('THREE.PlaneGeometry: Consider using THREE.PlaneBufferGeometry for lower memory footprint.');\r\n\r\n  THREE.Geometry.call(this);\r\n\r\n  this.type = 'PlaneGeometry';\r\n\r\n  this.parameters = {\r\n    width: width,\r\n    height: height,\r\n    widthSegments: widthSegments,\r\n    heightSegments: heightSegments\r\n  };\r\n\r\n  this.fromBufferGeometry(new THREE.PlaneBufferGeometry(width, height, widthSegments, heightSegments));\r\n\r\n};\r\n\r\nTHREE.PlaneGeometry.prototype = Object.create(THREE.Geometry.prototype);\r\nTHREE.PlaneGeometry.prototype.constructor = THREE.PlaneGeometry;\r\n\r\n// File:src/extras/geometries/PlaneBufferGeometry.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * based on http://papervision3d.googlecode.com/svn/trunk/as3/trunk/src/org/papervision3d/objects/primitives/Plane.as\r\n */\r\n\r\nTHREE.PlaneBufferGeometry = function(width, height, widthSegments, heightSegments) {\r\n\r\n  THREE.BufferGeometry.call(this);\r\n\r\n  this.type = 'PlaneBufferGeometry';\r\n\r\n  this.parameters = {\r\n    width: width,\r\n    height: height,\r\n    widthSegments: widthSegments,\r\n    heightSegments: heightSegments\r\n  };\r\n\r\n  var width_half = width / 2;\r\n  var height_half = height / 2;\r\n\r\n  var gridX = widthSegments || 1;\r\n  var gridY = heightSegments || 1;\r\n\r\n  var gridX1 = gridX + 1;\r\n  var gridY1 = gridY + 1;\r\n\r\n  var segment_width = width / gridX;\r\n  var segment_height = height / gridY;\r\n\r\n  var vertices = new Float32Array(gridX1 * gridY1 * 3);\r\n  var normals = new Float32Array(gridX1 * gridY1 * 3);\r\n  var uvs = new Float32Array(gridX1 * gridY1 * 2);\r\n\r\n  var offset = 0;\r\n  var offset2 = 0;\r\n\r\n  for (var iy = 0; iy < gridY1; iy++) {\r\n\r\n    var y = iy * segment_height - height_half;\r\n\r\n    for (var ix = 0; ix < gridX1; ix++) {\r\n\r\n      var x = ix * segment_width - width_half;\r\n\r\n      vertices[offset] = x;\r\n      vertices[offset + 1] = -y;\r\n\r\n      normals[offset + 2] = 1;\r\n\r\n      uvs[offset2] = ix / gridX;\r\n      uvs[offset2 + 1] = 1 - (iy / gridY);\r\n\r\n      offset += 3;\r\n      offset2 += 2;\r\n\r\n    }\r\n\r\n  }\r\n\r\n  offset = 0;\r\n\r\n  var indices = new((vertices.length / 3) > 65535 ? Uint32Array : Uint16Array)(gridX * gridY * 6);\r\n\r\n  for (var iy = 0; iy < gridY; iy++) {\r\n\r\n    for (var ix = 0; ix < gridX; ix++) {\r\n\r\n      var a = ix + gridX1 * iy;\r\n      var b = ix + gridX1 * (iy + 1);\r\n      var c = (ix + 1) + gridX1 * (iy + 1);\r\n      var d = (ix + 1) + gridX1 * iy;\r\n\r\n      indices[offset] = a;\r\n      indices[offset + 1] = b;\r\n      indices[offset + 2] = d;\r\n\r\n      indices[offset + 3] = b;\r\n      indices[offset + 4] = c;\r\n      indices[offset + 5] = d;\r\n\r\n      offset += 6;\r\n\r\n    }\r\n\r\n  }\r\n\r\n  this.addAttribute('index', new THREE.BufferAttribute(indices, 1));\r\n  this.addAttribute('position', new THREE.BufferAttribute(vertices, 3));\r\n  this.addAttribute('normal', new THREE.BufferAttribute(normals, 3));\r\n  this.addAttribute('uv', new THREE.BufferAttribute(uvs, 2));\r\n\r\n};\r\n\r\nTHREE.PlaneBufferGeometry.prototype = Object.create(THREE.BufferGeometry.prototype);\r\nTHREE.PlaneBufferGeometry.prototype.constructor = THREE.PlaneBufferGeometry;\r\n\r\n// File:src/extras/geometries/RingGeometry.js\r\n\r\n/**\r\n * @author Kaleb Murphy\r\n */\r\n\r\nTHREE.RingGeometry = function(innerRadius, outerRadius, thetaSegments, phiSegments, thetaStart, thetaLength) {\r\n\r\n  THREE.Geometry.call(this);\r\n\r\n  this.type = 'RingGeometry';\r\n\r\n  this.parameters = {\r\n    innerRadius: innerRadius,\r\n    outerRadius: outerRadius,\r\n    thetaSegments: thetaSegments,\r\n    phiSegments: phiSegments,\r\n    thetaStart: thetaStart,\r\n    thetaLength: thetaLength\r\n  };\r\n\r\n  innerRadius = innerRadius || 0;\r\n  outerRadius = outerRadius || 50;\r\n\r\n  thetaStart = thetaStart !== undefined ? thetaStart : 0;\r\n  thetaLength = thetaLength !== undefined ? thetaLength : Math.PI * 2;\r\n\r\n  thetaSegments = thetaSegments !== undefined ? Math.max(3, thetaSegments) : 8;\r\n  phiSegments = phiSegments !== undefined ? Math.max(1, phiSegments) : 8;\r\n\r\n  var i, o, uvs = [],\r\n    radius = innerRadius,\r\n    radiusStep = ((outerRadius - innerRadius) / phiSegments);\r\n\r\n  for (i = 0; i < phiSegments + 1; i++) { // concentric circles inside ring\r\n\r\n    for (o = 0; o < thetaSegments + 1; o++) { // number of segments per circle\r\n\r\n      var vertex = new THREE.Vector3();\r\n      var segment = thetaStart + o / thetaSegments * thetaLength;\r\n      vertex.x = radius * Math.cos(segment);\r\n      vertex.y = radius * Math.sin(segment);\r\n\r\n      this.vertices.push(vertex);\r\n      uvs.push(new THREE.Vector2((vertex.x / outerRadius + 1) / 2, (vertex.y / outerRadius + 1) / 2));\r\n    }\r\n\r\n    radius += radiusStep;\r\n\r\n  }\r\n\r\n  var n = new THREE.Vector3(0, 0, 1);\r\n\r\n  for (i = 0; i < phiSegments; i++) { // concentric circles inside ring\r\n\r\n    var thetaSegment = i * (thetaSegments + 1);\r\n\r\n    for (o = 0; o < thetaSegments; o++) { // number of segments per circle\r\n\r\n      var segment = o + thetaSegment;\r\n\r\n      var v1 = segment;\r\n      var v2 = segment + thetaSegments + 1;\r\n      var v3 = segment + thetaSegments + 2;\r\n\r\n      this.faces.push(new THREE.Face3(v1, v2, v3, [n.clone(), n.clone(), n.clone()]));\r\n      this.faceVertexUvs[0].push([uvs[v1].clone(), uvs[v2].clone(), uvs[v3].clone()]);\r\n\r\n      v1 = segment;\r\n      v2 = segment + thetaSegments + 2;\r\n      v3 = segment + 1;\r\n\r\n      this.faces.push(new THREE.Face3(v1, v2, v3, [n.clone(), n.clone(), n.clone()]));\r\n      this.faceVertexUvs[0].push([uvs[v1].clone(), uvs[v2].clone(), uvs[v3].clone()]);\r\n\r\n    }\r\n  }\r\n\r\n  this.computeFaceNormals();\r\n\r\n  this.boundingSphere = new THREE.Sphere(new THREE.Vector3(), radius);\r\n\r\n};\r\n\r\nTHREE.RingGeometry.prototype = Object.create(THREE.Geometry.prototype);\r\nTHREE.RingGeometry.prototype.constructor = THREE.RingGeometry;\r\n\r\n\r\n// File:src/extras/geometries/SphereGeometry.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.SphereGeometry = function(radius, widthSegments, heightSegments, phiStart, phiLength, thetaStart, thetaLength) {\r\n\r\n  THREE.Geometry.call(this);\r\n\r\n  this.type = 'SphereGeometry';\r\n\r\n  this.parameters = {\r\n    radius: radius,\r\n    widthSegments: widthSegments,\r\n    heightSegments: heightSegments,\r\n    phiStart: phiStart,\r\n    phiLength: phiLength,\r\n    thetaStart: thetaStart,\r\n    thetaLength: thetaLength\r\n  };\r\n\r\n  radius = radius || 50;\r\n\r\n  widthSegments = Math.max(3, Math.floor(widthSegments) || 8);\r\n  heightSegments = Math.max(2, Math.floor(heightSegments) || 6);\r\n\r\n  phiStart = phiStart !== undefined ? phiStart : 0;\r\n  phiLength = phiLength !== undefined ? phiLength : Math.PI * 2;\r\n\r\n  thetaStart = thetaStart !== undefined ? thetaStart : 0;\r\n  thetaLength = thetaLength !== undefined ? thetaLength : Math.PI;\r\n\r\n  var x, y, vertices = [],\r\n    uvs = [];\r\n\r\n  for (y = 0; y <= heightSegments; y++) {\r\n\r\n    var verticesRow = [];\r\n    var uvsRow = [];\r\n\r\n    for (x = 0; x <= widthSegments; x++) {\r\n\r\n      var u = x / widthSegments;\r\n      var v = y / heightSegments;\r\n\r\n      var vertex = new THREE.Vector3();\r\n      vertex.x = -radius * Math.cos(phiStart + u * phiLength) * Math.sin(thetaStart + v * thetaLength);\r\n      vertex.y = radius * Math.cos(thetaStart + v * thetaLength);\r\n      vertex.z = radius * Math.sin(phiStart + u * phiLength) * Math.sin(thetaStart + v * thetaLength);\r\n\r\n      this.vertices.push(vertex);\r\n\r\n      verticesRow.push(this.vertices.length - 1);\r\n      uvsRow.push(new THREE.Vector2(u, 1 - v));\r\n\r\n    }\r\n\r\n    vertices.push(verticesRow);\r\n    uvs.push(uvsRow);\r\n\r\n  }\r\n\r\n  for (y = 0; y < heightSegments; y++) {\r\n\r\n    for (x = 0; x < widthSegments; x++) {\r\n\r\n      var v1 = vertices[y][x + 1];\r\n      var v2 = vertices[y][x];\r\n      var v3 = vertices[y + 1][x];\r\n      var v4 = vertices[y + 1][x + 1];\r\n\r\n      var n1 = this.vertices[v1].clone().normalize();\r\n      var n2 = this.vertices[v2].clone().normalize();\r\n      var n3 = this.vertices[v3].clone().normalize();\r\n      var n4 = this.vertices[v4].clone().normalize();\r\n\r\n      var uv1 = uvs[y][x + 1].clone();\r\n      var uv2 = uvs[y][x].clone();\r\n      var uv3 = uvs[y + 1][x].clone();\r\n      var uv4 = uvs[y + 1][x + 1].clone();\r\n\r\n      if (Math.abs(this.vertices[v1].y) === radius) {\r\n\r\n        uv1.x = (uv1.x + uv2.x) / 2;\r\n        this.faces.push(new THREE.Face3(v1, v3, v4, [n1, n3, n4]));\r\n        this.faceVertexUvs[0].push([uv1, uv3, uv4]);\r\n\r\n      }\r\n      else if (Math.abs(this.vertices[v3].y) === radius) {\r\n\r\n        uv3.x = (uv3.x + uv4.x) / 2;\r\n        this.faces.push(new THREE.Face3(v1, v2, v3, [n1, n2, n3]));\r\n        this.faceVertexUvs[0].push([uv1, uv2, uv3]);\r\n\r\n      }\r\n      else {\r\n\r\n        this.faces.push(new THREE.Face3(v1, v2, v4, [n1, n2, n4]));\r\n        this.faceVertexUvs[0].push([uv1, uv2, uv4]);\r\n\r\n        this.faces.push(new THREE.Face3(v2, v3, v4, [n2.clone(), n3, n4.clone()]));\r\n        this.faceVertexUvs[0].push([uv2.clone(), uv3, uv4.clone()]);\r\n\r\n      }\r\n\r\n    }\r\n\r\n  }\r\n\r\n  this.computeFaceNormals();\r\n\r\n  this.boundingSphere = new THREE.Sphere(new THREE.Vector3(), radius);\r\n\r\n};\r\n\r\nTHREE.SphereGeometry.prototype = Object.create(THREE.Geometry.prototype);\r\nTHREE.SphereGeometry.prototype.constructor = THREE.SphereGeometry;\r\n\r\n// File:src/extras/geometries/TextGeometry.js\r\n\r\n/**\r\n * @author zz85 / http://www.lab4games.net/zz85/blog\r\n * @author alteredq / http://alteredqualia.com/\r\n *\r\n * For creating 3D text geometry in three.js\r\n *\r\n * Text = 3D Text\r\n *\r\n * parameters = {\r\n *  size: \t\t\t<float>, \t// size of the text\r\n *  height: \t\t<float>, \t// thickness to extrude text\r\n *  curveSegments: \t<int>,\t\t// number of points on the curves\r\n *\r\n *  font: \t\t\t<string>,\t\t// font name\r\n *  weight: \t\t<string>,\t\t// font weight (normal, bold)\r\n *  style: \t\t\t<string>,\t\t// font style  (normal, italics)\r\n *\r\n *  bevelEnabled:\t<bool>,\t\t\t// turn on bevel\r\n *  bevelThickness: <float>, \t\t// how deep into text bevel goes\r\n *  bevelSize:\t\t<float>, \t\t// how far from text outline is bevel\r\n *  }\r\n *\r\n */\r\n\r\n/*\tUsage Examples\r\n\r\n\t// TextGeometry wrapper\r\n\r\n\tvar text3d = new TextGeometry( text, options );\r\n\r\n\t// Complete manner\r\n\r\n\tvar textShapes = THREE.FontUtils.generateShapes( text, options );\r\n\tvar text3d = new ExtrudeGeometry( textShapes, options );\r\n\r\n*/\r\n\r\n\r\nTHREE.TextGeometry = function(text, parameters) {\r\n\r\n  parameters = parameters || {};\r\n\r\n  var textShapes = THREE.FontUtils.generateShapes(text, parameters);\r\n\r\n  // translate parameters to ExtrudeGeometry API\r\n\r\n  parameters.amount = parameters.height !== undefined ? parameters.height : 50;\r\n\r\n  // defaults\r\n\r\n  if (parameters.bevelThickness === undefined) parameters.bevelThickness = 10;\r\n  if (parameters.bevelSize === undefined) parameters.bevelSize = 8;\r\n  if (parameters.bevelEnabled === undefined) parameters.bevelEnabled = false;\r\n\r\n  THREE.ExtrudeGeometry.call(this, textShapes, parameters);\r\n\r\n  this.type = 'TextGeometry';\r\n\r\n};\r\n\r\nTHREE.TextGeometry.prototype = Object.create(THREE.ExtrudeGeometry.prototype);\r\nTHREE.TextGeometry.prototype.constructor = THREE.TextGeometry;\r\n\r\n// File:src/extras/geometries/TorusGeometry.js\r\n\r\n/**\r\n * @author oosmoxiecode\r\n * @author mrdoob / http://mrdoob.com/\r\n * based on http://code.google.com/p/away3d/source/browse/trunk/fp10/Away3DLite/src/away3dlite/primitives/Torus.as?r=2888\r\n */\r\n\r\nTHREE.TorusGeometry = function(radius, tube, radialSegments, tubularSegments, arc) {\r\n\r\n  THREE.Geometry.call(this);\r\n\r\n  this.type = 'TorusGeometry';\r\n\r\n  this.parameters = {\r\n    radius: radius,\r\n    tube: tube,\r\n    radialSegments: radialSegments,\r\n    tubularSegments: tubularSegments,\r\n    arc: arc\r\n  };\r\n\r\n  radius = radius || 100;\r\n  tube = tube || 40;\r\n  radialSegments = radialSegments || 8;\r\n  tubularSegments = tubularSegments || 6;\r\n  arc = arc || Math.PI * 2;\r\n\r\n  var center = new THREE.Vector3(),\r\n    uvs = [],\r\n    normals = [];\r\n\r\n  for (var j = 0; j <= radialSegments; j++) {\r\n\r\n    for (var i = 0; i <= tubularSegments; i++) {\r\n\r\n      var u = i / tubularSegments * arc;\r\n      var v = j / radialSegments * Math.PI * 2;\r\n\r\n      center.x = radius * Math.cos(u);\r\n      center.y = radius * Math.sin(u);\r\n\r\n      var vertex = new THREE.Vector3();\r\n      vertex.x = (radius + tube * Math.cos(v)) * Math.cos(u);\r\n      vertex.y = (radius + tube * Math.cos(v)) * Math.sin(u);\r\n      vertex.z = tube * Math.sin(v);\r\n\r\n      this.vertices.push(vertex);\r\n\r\n      uvs.push(new THREE.Vector2(i / tubularSegments, j / radialSegments));\r\n      normals.push(vertex.clone().sub(center).normalize());\r\n\r\n    }\r\n\r\n  }\r\n\r\n  for (var j = 1; j <= radialSegments; j++) {\r\n\r\n    for (var i = 1; i <= tubularSegments; i++) {\r\n\r\n      var a = (tubularSegments + 1) * j + i - 1;\r\n      var b = (tubularSegments + 1) * (j - 1) + i - 1;\r\n      var c = (tubularSegments + 1) * (j - 1) + i;\r\n      var d = (tubularSegments + 1) * j + i;\r\n\r\n      var face = new THREE.Face3(a, b, d, [normals[a].clone(), normals[b].clone(), normals[d].clone()]);\r\n      this.faces.push(face);\r\n      this.faceVertexUvs[0].push([uvs[a].clone(), uvs[b].clone(), uvs[d].clone()]);\r\n\r\n      face = new THREE.Face3(b, c, d, [normals[b].clone(), normals[c].clone(), normals[d].clone()]);\r\n      this.faces.push(face);\r\n      this.faceVertexUvs[0].push([uvs[b].clone(), uvs[c].clone(), uvs[d].clone()]);\r\n\r\n    }\r\n\r\n  }\r\n\r\n  this.computeFaceNormals();\r\n\r\n};\r\n\r\nTHREE.TorusGeometry.prototype = Object.create(THREE.Geometry.prototype);\r\nTHREE.TorusGeometry.prototype.constructor = THREE.TorusGeometry;\r\n\r\n// File:src/extras/geometries/TorusKnotGeometry.js\r\n\r\n/**\r\n * @author oosmoxiecode\r\n * based on http://code.google.com/p/away3d/source/browse/trunk/fp10/Away3D/src/away3d/primitives/TorusKnot.as?spec=svn2473&r=2473\r\n */\r\n\r\nTHREE.TorusKnotGeometry = function(radius, tube, radialSegments, tubularSegments, p, q, heightScale) {\r\n\r\n  THREE.Geometry.call(this);\r\n\r\n  this.type = 'TorusKnotGeometry';\r\n\r\n  this.parameters = {\r\n    radius: radius,\r\n    tube: tube,\r\n    radialSegments: radialSegments,\r\n    tubularSegments: tubularSegments,\r\n    p: p,\r\n    q: q,\r\n    heightScale: heightScale\r\n  };\r\n\r\n  radius = radius || 100;\r\n  tube = tube || 40;\r\n  radialSegments = radialSegments || 64;\r\n  tubularSegments = tubularSegments || 8;\r\n  p = p || 2;\r\n  q = q || 3;\r\n  heightScale = heightScale || 1;\r\n\r\n  var grid = new Array(radialSegments);\r\n  var tang = new THREE.Vector3();\r\n  var n = new THREE.Vector3();\r\n  var bitan = new THREE.Vector3();\r\n\r\n  for (var i = 0; i < radialSegments; ++i) {\r\n\r\n    grid[i] = new Array(tubularSegments);\r\n    var u = i / radialSegments * 2 * p * Math.PI;\r\n    var p1 = getPos(u, q, p, radius, heightScale);\r\n    var p2 = getPos(u + 0.01, q, p, radius, heightScale);\r\n    tang.subVectors(p2, p1);\r\n    n.addVectors(p2, p1);\r\n\r\n    bitan.crossVectors(tang, n);\r\n    n.crossVectors(bitan, tang);\r\n    bitan.normalize();\r\n    n.normalize();\r\n\r\n    for (var j = 0; j < tubularSegments; ++j) {\r\n\r\n      var v = j / tubularSegments * 2 * Math.PI;\r\n      var cx = -tube * Math.cos(v); // TODO: Hack: Negating it so it faces outside.\r\n      var cy = tube * Math.sin(v);\r\n\r\n      var pos = new THREE.Vector3();\r\n      pos.x = p1.x + cx * n.x + cy * bitan.x;\r\n      pos.y = p1.y + cx * n.y + cy * bitan.y;\r\n      pos.z = p1.z + cx * n.z + cy * bitan.z;\r\n\r\n      grid[i][j] = this.vertices.push(pos) - 1;\r\n\r\n    }\r\n\r\n  }\r\n\r\n  for (var i = 0; i < radialSegments; ++i) {\r\n\r\n    for (var j = 0; j < tubularSegments; ++j) {\r\n\r\n      var ip = (i + 1) % radialSegments;\r\n      var jp = (j + 1) % tubularSegments;\r\n\r\n      var a = grid[i][j];\r\n      var b = grid[ip][j];\r\n      var c = grid[ip][jp];\r\n      var d = grid[i][jp];\r\n\r\n      var uva = new THREE.Vector2(i / radialSegments, j / tubularSegments);\r\n      var uvb = new THREE.Vector2((i + 1) / radialSegments, j / tubularSegments);\r\n      var uvc = new THREE.Vector2((i + 1) / radialSegments, (j + 1) / tubularSegments);\r\n      var uvd = new THREE.Vector2(i / radialSegments, (j + 1) / tubularSegments);\r\n\r\n      this.faces.push(new THREE.Face3(a, b, d));\r\n      this.faceVertexUvs[0].push([uva, uvb, uvd]);\r\n\r\n      this.faces.push(new THREE.Face3(b, c, d));\r\n      this.faceVertexUvs[0].push([uvb.clone(), uvc, uvd.clone()]);\r\n\r\n    }\r\n  }\r\n\r\n  this.computeFaceNormals();\r\n  this.computeVertexNormals();\r\n\r\n  function getPos(u, in_q, in_p, radius, heightScale) {\r\n\r\n    var cu = Math.cos(u);\r\n    var su = Math.sin(u);\r\n    var quOverP = in_q / in_p * u;\r\n    var cs = Math.cos(quOverP);\r\n\r\n    var tx = radius * (2 + cs) * 0.5 * cu;\r\n    var ty = radius * (2 + cs) * su * 0.5;\r\n    var tz = heightScale * radius * Math.sin(quOverP) * 0.5;\r\n\r\n    return new THREE.Vector3(tx, ty, tz);\r\n\r\n  }\r\n\r\n};\r\n\r\nTHREE.TorusKnotGeometry.prototype = Object.create(THREE.Geometry.prototype);\r\nTHREE.TorusKnotGeometry.prototype.constructor = THREE.TorusKnotGeometry;\r\n\r\n// File:src/extras/geometries/TubeGeometry.js\r\n\r\n/**\r\n * @author WestLangley / https://github.com/WestLangley\r\n * @author zz85 / https://github.com/zz85\r\n * @author miningold / https://github.com/miningold\r\n * @author jonobr1 / https://github.com/jonobr1\r\n *\r\n * Modified from the TorusKnotGeometry by @oosmoxiecode\r\n *\r\n * Creates a tube which extrudes along a 3d spline\r\n *\r\n * Uses parallel transport frames as described in\r\n * http://www.cs.indiana.edu/pub/techreports/TR425.pdf\r\n */\r\n\r\nTHREE.TubeGeometry = function(path, segments, radius, radialSegments, closed, taper) {\r\n\r\n  THREE.Geometry.call(this);\r\n\r\n  this.type = 'TubeGeometry';\r\n\r\n  this.parameters = {\r\n    path: path,\r\n    segments: segments,\r\n    radius: radius,\r\n    radialSegments: radialSegments,\r\n    closed: closed\r\n  };\r\n\r\n  segments = segments || 64;\r\n  radius = radius || 1;\r\n  radialSegments = radialSegments || 8;\r\n  closed = closed || false;\r\n  taper = taper || THREE.TubeGeometry.NoTaper;\r\n\r\n  var grid = [];\r\n\r\n  var scope = this,\r\n\r\n    tangent,\r\n    normal,\r\n    binormal,\r\n\r\n    numpoints = segments + 1,\r\n\r\n    u, v, r,\r\n\r\n    cx, cy,\r\n    pos, pos2 = new THREE.Vector3(),\r\n    i, j,\r\n    ip, jp,\r\n    a, b, c, d,\r\n    uva, uvb, uvc, uvd;\r\n\r\n  var frames = new THREE.TubeGeometry.FrenetFrames(path, segments, closed),\r\n    tangents = frames.tangents,\r\n    normals = frames.normals,\r\n    binormals = frames.binormals;\r\n\r\n  // proxy internals\r\n  this.tangents = tangents;\r\n  this.normals = normals;\r\n  this.binormals = binormals;\r\n\r\n  function vert(x, y, z) {\r\n\r\n    return scope.vertices.push(new THREE.Vector3(x, y, z)) - 1;\r\n\r\n  }\r\n\r\n  // consruct the grid\r\n\r\n  for (i = 0; i < numpoints; i++) {\r\n\r\n    grid[i] = [];\r\n\r\n    u = i / (numpoints - 1);\r\n\r\n    pos = path.getPointAt(u);\r\n\r\n    tangent = tangents[i];\r\n    normal = normals[i];\r\n    binormal = binormals[i];\r\n\r\n    r = radius * taper(u);\r\n\r\n    for (j = 0; j < radialSegments; j++) {\r\n\r\n      v = j / radialSegments * 2 * Math.PI;\r\n\r\n      cx = -r * Math.cos(v); // TODO: Hack: Negating it so it faces outside.\r\n      cy = r * Math.sin(v);\r\n\r\n      pos2.copy(pos);\r\n      pos2.x += cx * normal.x + cy * binormal.x;\r\n      pos2.y += cx * normal.y + cy * binormal.y;\r\n      pos2.z += cx * normal.z + cy * binormal.z;\r\n\r\n      grid[i][j] = vert(pos2.x, pos2.y, pos2.z);\r\n\r\n    }\r\n  }\r\n\r\n\r\n  // construct the mesh\r\n\r\n  for (i = 0; i < segments; i++) {\r\n\r\n    for (j = 0; j < radialSegments; j++) {\r\n\r\n      ip = (closed) ? (i + 1) % segments : i + 1;\r\n      jp = (j + 1) % radialSegments;\r\n\r\n      a = grid[i][j]; // *** NOT NECESSARILY PLANAR ! ***\r\n      b = grid[ip][j];\r\n      c = grid[ip][jp];\r\n      d = grid[i][jp];\r\n\r\n      uva = new THREE.Vector2(i / segments, j / radialSegments);\r\n      uvb = new THREE.Vector2((i + 1) / segments, j / radialSegments);\r\n      uvc = new THREE.Vector2((i + 1) / segments, (j + 1) / radialSegments);\r\n      uvd = new THREE.Vector2(i / segments, (j + 1) / radialSegments);\r\n\r\n      this.faces.push(new THREE.Face3(a, b, d));\r\n      this.faceVertexUvs[0].push([uva, uvb, uvd]);\r\n\r\n      this.faces.push(new THREE.Face3(b, c, d));\r\n      this.faceVertexUvs[0].push([uvb.clone(), uvc, uvd.clone()]);\r\n\r\n    }\r\n  }\r\n\r\n  this.computeFaceNormals();\r\n  this.computeVertexNormals();\r\n\r\n};\r\n\r\nTHREE.TubeGeometry.prototype = Object.create(THREE.Geometry.prototype);\r\nTHREE.TubeGeometry.prototype.constructor = THREE.TubeGeometry;\r\n\r\nTHREE.TubeGeometry.NoTaper = function(u) {\r\n\r\n  return 1;\r\n\r\n};\r\n\r\nTHREE.TubeGeometry.SinusoidalTaper = function(u) {\r\n\r\n  return Math.sin(Math.PI * u);\r\n\r\n};\r\n\r\n// For computing of Frenet frames, exposing the tangents, normals and binormals the spline\r\nTHREE.TubeGeometry.FrenetFrames = function(path, segments, closed) {\r\n\r\n  var normal = new THREE.Vector3(),\r\n\r\n    tangents = [],\r\n    normals = [],\r\n    binormals = [],\r\n\r\n    vec = new THREE.Vector3(),\r\n    mat = new THREE.Matrix4(),\r\n\r\n    numpoints = segments + 1,\r\n    theta,\r\n    epsilon = 0.0001,\r\n    smallest,\r\n\r\n    tx, ty, tz,\r\n    i, u;\r\n\r\n\r\n  // expose internals\r\n  this.tangents = tangents;\r\n  this.normals = normals;\r\n  this.binormals = binormals;\r\n\r\n  // compute the tangent vectors for each segment on the path\r\n\r\n  for (i = 0; i < numpoints; i++) {\r\n\r\n    u = i / (numpoints - 1);\r\n\r\n    tangents[i] = path.getTangentAt(u);\r\n    tangents[i].normalize();\r\n\r\n  }\r\n\r\n  initialNormal3();\r\n\r\n  /*\r\n  function initialNormal1(lastBinormal) {\r\n  \t// fixed start binormal. Has dangers of 0 vectors\r\n  \tnormals[ 0 ] = new THREE.Vector3();\r\n  \tbinormals[ 0 ] = new THREE.Vector3();\r\n  \tif (lastBinormal===undefined) lastBinormal = new THREE.Vector3( 0, 0, 1 );\r\n  \tnormals[ 0 ].crossVectors( lastBinormal, tangents[ 0 ] ).normalize();\r\n  \tbinormals[ 0 ].crossVectors( tangents[ 0 ], normals[ 0 ] ).normalize();\r\n  }\r\n\r\n  function initialNormal2() {\r\n\r\n  \t// This uses the Frenet-Serret formula for deriving binormal\r\n  \tvar t2 = path.getTangentAt( epsilon );\r\n\r\n  \tnormals[ 0 ] = new THREE.Vector3().subVectors( t2, tangents[ 0 ] ).normalize();\r\n  \tbinormals[ 0 ] = new THREE.Vector3().crossVectors( tangents[ 0 ], normals[ 0 ] );\r\n\r\n  \tnormals[ 0 ].crossVectors( binormals[ 0 ], tangents[ 0 ] ).normalize(); // last binormal x tangent\r\n  \tbinormals[ 0 ].crossVectors( tangents[ 0 ], normals[ 0 ] ).normalize();\r\n\r\n  }\r\n  */\r\n\r\n  function initialNormal3() {\r\n    // select an initial normal vector perpenicular to the first tangent vector,\r\n    // and in the direction of the smallest tangent xyz component\r\n\r\n    normals[0] = new THREE.Vector3();\r\n    binormals[0] = new THREE.Vector3();\r\n    smallest = Number.MAX_VALUE;\r\n    tx = Math.abs(tangents[0].x);\r\n    ty = Math.abs(tangents[0].y);\r\n    tz = Math.abs(tangents[0].z);\r\n\r\n    if (tx <= smallest) {\r\n      smallest = tx;\r\n      normal.set(1, 0, 0);\r\n    }\r\n\r\n    if (ty <= smallest) {\r\n      smallest = ty;\r\n      normal.set(0, 1, 0);\r\n    }\r\n\r\n    if (tz <= smallest) {\r\n      normal.set(0, 0, 1);\r\n    }\r\n\r\n    vec.crossVectors(tangents[0], normal).normalize();\r\n\r\n    normals[0].crossVectors(tangents[0], vec);\r\n    binormals[0].crossVectors(tangents[0], normals[0]);\r\n  }\r\n\r\n\r\n  // compute the slowly-varying normal and binormal vectors for each segment on the path\r\n\r\n  for (i = 1; i < numpoints; i++) {\r\n\r\n    normals[i] = normals[i - 1].clone();\r\n\r\n    binormals[i] = binormals[i - 1].clone();\r\n\r\n    vec.crossVectors(tangents[i - 1], tangents[i]);\r\n\r\n    if (vec.length() > epsilon) {\r\n\r\n      vec.normalize();\r\n\r\n      theta = Math.acos(THREE.Math.clamp(tangents[i - 1].dot(tangents[i]), -1, 1)); // clamp for floating pt errors\r\n\r\n      normals[i].applyMatrix4(mat.makeRotationAxis(vec, theta));\r\n\r\n    }\r\n\r\n    binormals[i].crossVectors(tangents[i], normals[i]);\r\n\r\n  }\r\n\r\n\r\n  // if the curve is closed, postprocess the vectors so the first and last normal vectors are the same\r\n\r\n  if (closed) {\r\n\r\n    theta = Math.acos(THREE.Math.clamp(normals[0].dot(normals[numpoints - 1]), -1, 1));\r\n    theta /= (numpoints - 1);\r\n\r\n    if (tangents[0].dot(vec.crossVectors(normals[0], normals[numpoints - 1])) > 0) {\r\n\r\n      theta = -theta;\r\n\r\n    }\r\n\r\n    for (i = 1; i < numpoints; i++) {\r\n\r\n      // twist a little...\r\n      normals[i].applyMatrix4(mat.makeRotationAxis(tangents[i], theta * i));\r\n      binormals[i].crossVectors(tangents[i], normals[i]);\r\n\r\n    }\r\n\r\n  }\r\n};\r\n\r\n// File:src/extras/geometries/PolyhedronGeometry.js\r\n\r\n/**\r\n * @author clockworkgeek / https://github.com/clockworkgeek\r\n * @author timothypratley / https://github.com/timothypratley\r\n * @author WestLangley / http://github.com/WestLangley\r\n */\r\n\r\nTHREE.PolyhedronGeometry = function(vertices, indices, radius, detail) {\r\n\r\n  THREE.Geometry.call(this);\r\n\r\n  this.type = 'PolyhedronGeometry';\r\n\r\n  this.parameters = {\r\n    vertices: vertices,\r\n    indices: indices,\r\n    radius: radius,\r\n    detail: detail\r\n  };\r\n\r\n  radius = radius || 1;\r\n  detail = detail || 0;\r\n\r\n  var that = this;\r\n\r\n  for (var i = 0, l = vertices.length; i < l; i += 3) {\r\n\r\n    prepare(new THREE.Vector3(vertices[i], vertices[i + 1], vertices[i + 2]));\r\n\r\n  }\r\n\r\n  var p = this.vertices;\r\n\r\n  var faces = [];\r\n\r\n  for (var i = 0, j = 0, l = indices.length; i < l; i += 3, j++) {\r\n\r\n    var v1 = p[indices[i]];\r\n    var v2 = p[indices[i + 1]];\r\n    var v3 = p[indices[i + 2]];\r\n\r\n    faces[j] = new THREE.Face3(v1.index, v2.index, v3.index, [v1.clone(), v2.clone(), v3.clone()]);\r\n\r\n  }\r\n\r\n  var centroid = new THREE.Vector3();\r\n\r\n  for (var i = 0, l = faces.length; i < l; i++) {\r\n\r\n    subdivide(faces[i], detail);\r\n\r\n  }\r\n\r\n\r\n  // Handle case when face straddles the seam\r\n\r\n  for (var i = 0, l = this.faceVertexUvs[0].length; i < l; i++) {\r\n\r\n    var uvs = this.faceVertexUvs[0][i];\r\n\r\n    var x0 = uvs[0].x;\r\n    var x1 = uvs[1].x;\r\n    var x2 = uvs[2].x;\r\n\r\n    var max = Math.max(x0, Math.max(x1, x2));\r\n    var min = Math.min(x0, Math.min(x1, x2));\r\n\r\n    if (max > 0.9 && min < 0.1) { // 0.9 is somewhat arbitrary\r\n\r\n      if (x0 < 0.2) uvs[0].x += 1;\r\n      if (x1 < 0.2) uvs[1].x += 1;\r\n      if (x2 < 0.2) uvs[2].x += 1;\r\n\r\n    }\r\n\r\n  }\r\n\r\n\r\n  // Apply radius\r\n\r\n  for (var i = 0, l = this.vertices.length; i < l; i++) {\r\n\r\n    this.vertices[i].multiplyScalar(radius);\r\n\r\n  }\r\n\r\n\r\n  // Merge vertices\r\n\r\n  this.mergeVertices();\r\n\r\n  this.computeFaceNormals();\r\n\r\n  this.boundingSphere = new THREE.Sphere(new THREE.Vector3(), radius);\r\n\r\n\r\n  // Project vector onto sphere's surface\r\n\r\n  function prepare(vector) {\r\n\r\n    var vertex = vector.normalize().clone();\r\n    vertex.index = that.vertices.push(vertex) - 1;\r\n\r\n    // Texture coords are equivalent to map coords, calculate angle and convert to fraction of a circle.\r\n\r\n    var u = azimuth(vector) / 2 / Math.PI + 0.5;\r\n    var v = inclination(vector) / Math.PI + 0.5;\r\n    vertex.uv = new THREE.Vector2(u, 1 - v);\r\n\r\n    return vertex;\r\n\r\n  }\r\n\r\n\r\n  // Approximate a curved face with recursively sub-divided triangles.\r\n\r\n  function make(v1, v2, v3) {\r\n\r\n    var face = new THREE.Face3(v1.index, v2.index, v3.index, [v1.clone(), v2.clone(), v3.clone()]);\r\n    that.faces.push(face);\r\n\r\n    centroid.copy(v1).add(v2).add(v3).divideScalar(3);\r\n\r\n    var azi = azimuth(centroid);\r\n\r\n    that.faceVertexUvs[0].push([\r\n      correctUV(v1.uv, v1, azi),\r\n      correctUV(v2.uv, v2, azi),\r\n      correctUV(v3.uv, v3, azi)\r\n    ]);\r\n\r\n  }\r\n\r\n\r\n  // Analytically subdivide a face to the required detail level.\r\n\r\n  function subdivide(face, detail) {\r\n\r\n    var cols = Math.pow(2, detail);\r\n    var a = prepare(that.vertices[face.a]);\r\n    var b = prepare(that.vertices[face.b]);\r\n    var c = prepare(that.vertices[face.c]);\r\n    var v = [];\r\n\r\n    // Construct all of the vertices for this subdivision.\r\n\r\n    for (var i = 0; i <= cols; i++) {\r\n\r\n      v[i] = [];\r\n\r\n      var aj = prepare(a.clone().lerp(c, i / cols));\r\n      var bj = prepare(b.clone().lerp(c, i / cols));\r\n      var rows = cols - i;\r\n\r\n      for (var j = 0; j <= rows; j++) {\r\n\r\n        if (j == 0 && i == cols) {\r\n\r\n          v[i][j] = aj;\r\n\r\n        }\r\n        else {\r\n\r\n          v[i][j] = prepare(aj.clone().lerp(bj, j / rows));\r\n\r\n        }\r\n\r\n      }\r\n\r\n    }\r\n\r\n    // Construct all of the faces.\r\n\r\n    for (var i = 0; i < cols; i++) {\r\n\r\n      for (var j = 0; j < 2 * (cols - i) - 1; j++) {\r\n\r\n        var k = Math.floor(j / 2);\r\n\r\n        if (j % 2 == 0) {\r\n\r\n          make(\r\n            v[i][k + 1],\r\n            v[i + 1][k],\r\n            v[i][k]\r\n          );\r\n\r\n        }\r\n        else {\r\n\r\n          make(\r\n            v[i][k + 1],\r\n            v[i + 1][k + 1],\r\n            v[i + 1][k]\r\n          );\r\n\r\n        }\r\n\r\n      }\r\n\r\n    }\r\n\r\n  }\r\n\r\n\r\n  // Angle around the Y axis, counter-clockwise when looking from above.\r\n\r\n  function azimuth(vector) {\r\n\r\n    return Math.atan2(vector.z, -vector.x);\r\n\r\n  }\r\n\r\n\r\n  // Angle above the XZ plane.\r\n\r\n  function inclination(vector) {\r\n\r\n    return Math.atan2(-vector.y, Math.sqrt((vector.x * vector.x) + (vector.z * vector.z)));\r\n\r\n  }\r\n\r\n\r\n  // Texture fixing helper. Spheres have some odd behaviours.\r\n\r\n  function correctUV(uv, vector, azimuth) {\r\n\r\n    if ((azimuth < 0) && (uv.x === 1)) uv = new THREE.Vector2(uv.x - 1, uv.y);\r\n    if ((vector.x === 0) && (vector.z === 0)) uv = new THREE.Vector2(azimuth / 2 / Math.PI + 0.5, uv.y);\r\n    return uv.clone();\r\n\r\n  }\r\n\r\n\r\n};\r\n\r\nTHREE.PolyhedronGeometry.prototype = Object.create(THREE.Geometry.prototype);\r\nTHREE.PolyhedronGeometry.prototype.constructor = THREE.PolyhedronGeometry;\r\n\r\n// File:src/extras/geometries/DodecahedronGeometry.js\r\n\r\n/**\r\n * @author Abe Pazos / https://hamoid.com\r\n */\r\n\r\nTHREE.DodecahedronGeometry = function(radius, detail) {\r\n\r\n  this.parameters = {\r\n    radius: radius,\r\n    detail: detail\r\n  };\r\n\r\n  var t = (1 + Math.sqrt(5)) / 2;\r\n  var r = 1 / t;\r\n\r\n  var vertices = [\r\n\r\n    // (1, 1, 1)\r\n    -1, -1, -1, -1, -1, 1, -1, 1, -1, -1, 1, 1,\r\n    1, -1, -1, 1, -1, 1,\r\n    1, 1, -1, 1, 1, 1,\r\n\r\n    // (0, 1/, )\r\n    0, -r, -t, 0, -r, t,\r\n    0, r, -t, 0, r, t,\r\n\r\n    // (1/, , 0)\r\n    -r, -t, 0, -r, t, 0,\r\n    r, -t, 0, r, t, 0,\r\n\r\n    // (, 0, 1/)\r\n    -t, 0, -r, t, 0, -r, -t, 0, r, t, 0, r\r\n  ];\r\n\r\n  var indices = [\r\n    3, 11, 7, 3, 7, 15, 3, 15, 13,\r\n    7, 19, 17, 7, 17, 6, 7, 6, 15,\r\n    17, 4, 8, 17, 8, 10, 17, 10, 6,\r\n    8, 0, 16, 8, 16, 2, 8, 2, 10,\r\n    0, 12, 1, 0, 1, 18, 0, 18, 16,\r\n    6, 10, 2, 6, 2, 13, 6, 13, 15,\r\n    2, 16, 18, 2, 18, 3, 2, 3, 13,\r\n    18, 1, 9, 18, 9, 11, 18, 11, 3,\r\n    4, 14, 12, 4, 12, 0, 4, 0, 8,\r\n    11, 9, 5, 11, 5, 19, 11, 19, 7,\r\n    19, 5, 14, 19, 14, 4, 19, 4, 17,\r\n    1, 12, 14, 1, 14, 5, 1, 5, 9\r\n  ];\r\n\r\n  THREE.PolyhedronGeometry.call(this, vertices, indices, radius, detail);\r\n\r\n};\r\n\r\nTHREE.DodecahedronGeometry.prototype = Object.create(THREE.Geometry.prototype);\r\nTHREE.DodecahedronGeometry.prototype.constructor = THREE.DodecahedronGeometry;\r\n\r\n// File:src/extras/geometries/IcosahedronGeometry.js\r\n\r\n/**\r\n * @author timothypratley / https://github.com/timothypratley\r\n */\r\n\r\nTHREE.IcosahedronGeometry = function(radius, detail) {\r\n\r\n  var t = (1 + Math.sqrt(5)) / 2;\r\n\r\n  var vertices = [-1, t, 0, 1, t, 0, -1, -t, 0, 1, -t, 0,\r\n    0, -1, t, 0, 1, t, 0, -1, -t, 0, 1, -t,\r\n    t, 0, -1, t, 0, 1, -t, 0, -1, -t, 0, 1\r\n  ];\r\n\r\n  var indices = [\r\n    0, 11, 5, 0, 5, 1, 0, 1, 7, 0, 7, 10, 0, 10, 11,\r\n    1, 5, 9, 5, 11, 4, 11, 10, 2, 10, 7, 6, 7, 1, 8,\r\n    3, 9, 4, 3, 4, 2, 3, 2, 6, 3, 6, 8, 3, 8, 9,\r\n    4, 9, 5, 2, 4, 11, 6, 2, 10, 8, 6, 7, 9, 8, 1\r\n  ];\r\n\r\n  THREE.PolyhedronGeometry.call(this, vertices, indices, radius, detail);\r\n\r\n  this.type = 'IcosahedronGeometry';\r\n\r\n  this.parameters = {\r\n    radius: radius,\r\n    detail: detail\r\n  };\r\n};\r\n\r\nTHREE.IcosahedronGeometry.prototype = Object.create(THREE.Geometry.prototype);\r\nTHREE.IcosahedronGeometry.prototype.constructor = THREE.IcosahedronGeometry;\r\n\r\n// File:src/extras/geometries/OctahedronGeometry.js\r\n\r\n/**\r\n * @author timothypratley / https://github.com/timothypratley\r\n */\r\n\r\nTHREE.OctahedronGeometry = function(radius, detail) {\r\n\r\n  this.parameters = {\r\n    radius: radius,\r\n    detail: detail\r\n  };\r\n\r\n  var vertices = [\r\n    1, 0, 0, -1, 0, 0, 0, 1, 0, 0, -1, 0, 0, 0, 1, 0, 0, -1\r\n  ];\r\n\r\n  var indices = [\r\n    0, 2, 4, 0, 4, 3, 0, 3, 5, 0, 5, 2, 1, 2, 5, 1, 5, 3, 1, 3, 4, 1, 4, 2\r\n  ];\r\n\r\n  THREE.PolyhedronGeometry.call(this, vertices, indices, radius, detail);\r\n\r\n  this.type = 'OctahedronGeometry';\r\n\r\n  this.parameters = {\r\n    radius: radius,\r\n    detail: detail\r\n  };\r\n};\r\n\r\nTHREE.OctahedronGeometry.prototype = Object.create(THREE.Geometry.prototype);\r\nTHREE.OctahedronGeometry.prototype.constructor = THREE.OctahedronGeometry;\r\n\r\n// File:src/extras/geometries/TetrahedronGeometry.js\r\n\r\n/**\r\n * @author timothypratley / https://github.com/timothypratley\r\n */\r\n\r\nTHREE.TetrahedronGeometry = function(radius, detail) {\r\n\r\n  var vertices = [\r\n    1, 1, 1, -1, -1, 1, -1, 1, -1, 1, -1, -1\r\n  ];\r\n\r\n  var indices = [\r\n    2, 1, 0, 0, 3, 2, 1, 3, 0, 2, 3, 1\r\n  ];\r\n\r\n  THREE.PolyhedronGeometry.call(this, vertices, indices, radius, detail);\r\n\r\n  this.type = 'TetrahedronGeometry';\r\n\r\n  this.parameters = {\r\n    radius: radius,\r\n    detail: detail\r\n  };\r\n\r\n};\r\n\r\nTHREE.TetrahedronGeometry.prototype = Object.create(THREE.Geometry.prototype);\r\nTHREE.TetrahedronGeometry.prototype.constructor = THREE.TetrahedronGeometry;\r\n\r\n// File:src/extras/geometries/ParametricGeometry.js\r\n\r\n/**\r\n * @author zz85 / https://github.com/zz85\r\n * Parametric Surfaces Geometry\r\n * based on the brilliant article by @prideout http://prideout.net/blog/?p=44\r\n *\r\n * new THREE.ParametricGeometry( parametricFunction, uSegments, ySegements );\r\n *\r\n */\r\n\r\nTHREE.ParametricGeometry = function(func, slices, stacks) {\r\n\r\n  THREE.Geometry.call(this);\r\n\r\n  this.type = 'ParametricGeometry';\r\n\r\n  this.parameters = {\r\n    func: func,\r\n    slices: slices,\r\n    stacks: stacks\r\n  };\r\n\r\n  var verts = this.vertices;\r\n  var faces = this.faces;\r\n  var uvs = this.faceVertexUvs[0];\r\n\r\n  var i, j, p;\r\n  var u, v;\r\n\r\n  var sliceCount = slices + 1;\r\n\r\n  for (i = 0; i <= stacks; i++) {\r\n\r\n    v = i / stacks;\r\n\r\n    for (j = 0; j <= slices; j++) {\r\n\r\n      u = j / slices;\r\n\r\n      p = func(u, v);\r\n      verts.push(p);\r\n\r\n    }\r\n  }\r\n\r\n  var a, b, c, d;\r\n  var uva, uvb, uvc, uvd;\r\n\r\n  for (i = 0; i < stacks; i++) {\r\n\r\n    for (j = 0; j < slices; j++) {\r\n\r\n      a = i * sliceCount + j;\r\n      b = i * sliceCount + j + 1;\r\n      c = (i + 1) * sliceCount + j + 1;\r\n      d = (i + 1) * sliceCount + j;\r\n\r\n      uva = new THREE.Vector2(j / slices, i / stacks);\r\n      uvb = new THREE.Vector2((j + 1) / slices, i / stacks);\r\n      uvc = new THREE.Vector2((j + 1) / slices, (i + 1) / stacks);\r\n      uvd = new THREE.Vector2(j / slices, (i + 1) / stacks);\r\n\r\n      faces.push(new THREE.Face3(a, b, d));\r\n      uvs.push([uva, uvb, uvd]);\r\n\r\n      faces.push(new THREE.Face3(b, c, d));\r\n      uvs.push([uvb.clone(), uvc, uvd.clone()]);\r\n\r\n    }\r\n\r\n  }\r\n\r\n  // console.log(this);\r\n\r\n  // magic bullet\r\n  // var diff = this.mergeVertices();\r\n  // console.log('removed ', diff, ' vertices by merging');\r\n\r\n  this.computeFaceNormals();\r\n  this.computeVertexNormals();\r\n\r\n};\r\n\r\nTHREE.ParametricGeometry.prototype = Object.create(THREE.Geometry.prototype);\r\nTHREE.ParametricGeometry.prototype.constructor = THREE.ParametricGeometry;\r\n\r\n// File:src/extras/helpers/AxisHelper.js\r\n\r\n/**\r\n * @author sroucheray / http://sroucheray.org/\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.AxisHelper = function(size) {\r\n\r\n  size = size || 1;\r\n\r\n  var vertices = new Float32Array([\r\n    0, 0, 0, size, 0, 0,\r\n    0, 0, 0, 0, size, 0,\r\n    0, 0, 0, 0, 0, size\r\n  ]);\r\n\r\n  var colors = new Float32Array([\r\n    1, 0, 0, 1, 0.6, 0,\r\n    0, 1, 0, 0.6, 1, 0,\r\n    0, 0, 1, 0, 0.6, 1\r\n  ]);\r\n\r\n  var geometry = new THREE.BufferGeometry();\r\n  geometry.addAttribute('position', new THREE.BufferAttribute(vertices, 3));\r\n  geometry.addAttribute('color', new THREE.BufferAttribute(colors, 3));\r\n\r\n  var material = new THREE.LineBasicMaterial({\r\n    vertexColors: THREE.VertexColors\r\n  });\r\n\r\n  THREE.Line.call(this, geometry, material, THREE.LinePieces);\r\n\r\n};\r\n\r\nTHREE.AxisHelper.prototype = Object.create(THREE.Line.prototype);\r\nTHREE.AxisHelper.prototype.constructor = THREE.AxisHelper;\r\n\r\n// File:src/extras/helpers/ArrowHelper.js\r\n\r\n/**\r\n * @author WestLangley / http://github.com/WestLangley\r\n * @author zz85 / http://github.com/zz85\r\n * @author bhouston / http://exocortex.com\r\n *\r\n * Creates an arrow for visualizing directions\r\n *\r\n * Parameters:\r\n *  dir - Vector3\r\n *  origin - Vector3\r\n *  length - Number\r\n *  color - color in hex value\r\n *  headLength - Number\r\n *  headWidth - Number\r\n */\r\n\r\nTHREE.ArrowHelper = (function() {\r\n\r\n  var lineGeometry = new THREE.Geometry();\r\n  lineGeometry.vertices.push(new THREE.Vector3(0, 0, 0), new THREE.Vector3(0, 1, 0));\r\n\r\n  var coneGeometry = new THREE.CylinderGeometry(0, 0.5, 1, 5, 1);\r\n  coneGeometry.applyMatrix(new THREE.Matrix4().makeTranslation(0, -0.5, 0));\r\n\r\n  return function(dir, origin, length, color, headLength, headWidth) {\r\n\r\n    // dir is assumed to be normalized\r\n\r\n    THREE.Object3D.call(this);\r\n\r\n    if (color === undefined) color = 0xffff00;\r\n    if (length === undefined) length = 1;\r\n    if (headLength === undefined) headLength = 0.2 * length;\r\n    if (headWidth === undefined) headWidth = 0.2 * headLength;\r\n\r\n    this.position.copy(origin);\r\n\r\n    this.line = new THREE.Line(lineGeometry, new THREE.LineBasicMaterial({\r\n      color: color\r\n    }));\r\n    this.line.matrixAutoUpdate = false;\r\n    this.add(this.line);\r\n\r\n    this.cone = new THREE.Mesh(coneGeometry, new THREE.MeshBasicMaterial({\r\n      color: color\r\n    }));\r\n    this.cone.matrixAutoUpdate = false;\r\n    this.add(this.cone);\r\n\r\n    this.setDirection(dir);\r\n    this.setLength(length, headLength, headWidth);\r\n\r\n  }\r\n\r\n}());\r\n\r\nTHREE.ArrowHelper.prototype = Object.create(THREE.Object3D.prototype);\r\nTHREE.ArrowHelper.prototype.constructor = THREE.ArrowHelper;\r\n\r\nTHREE.ArrowHelper.prototype.setDirection = (function() {\r\n\r\n  var axis = new THREE.Vector3();\r\n  var radians;\r\n\r\n  return function(dir) {\r\n\r\n    // dir is assumed to be normalized\r\n\r\n    if (dir.y > 0.99999) {\r\n\r\n      this.quaternion.set(0, 0, 0, 1);\r\n\r\n    }\r\n    else if (dir.y < -0.99999) {\r\n\r\n      this.quaternion.set(1, 0, 0, 0);\r\n\r\n    }\r\n    else {\r\n\r\n      axis.set(dir.z, 0, -dir.x).normalize();\r\n\r\n      radians = Math.acos(dir.y);\r\n\r\n      this.quaternion.setFromAxisAngle(axis, radians);\r\n\r\n    }\r\n\r\n  };\r\n\r\n}());\r\n\r\nTHREE.ArrowHelper.prototype.setLength = function(length, headLength, headWidth) {\r\n\r\n  if (headLength === undefined) headLength = 0.2 * length;\r\n  if (headWidth === undefined) headWidth = 0.2 * headLength;\r\n\r\n  this.line.scale.set(1, length - headLength, 1);\r\n  this.line.updateMatrix();\r\n\r\n  this.cone.scale.set(headWidth, headLength, headWidth);\r\n  this.cone.position.y = length;\r\n  this.cone.updateMatrix();\r\n\r\n};\r\n\r\nTHREE.ArrowHelper.prototype.setColor = function(color) {\r\n\r\n  this.line.material.color.set(color);\r\n  this.cone.material.color.set(color);\r\n\r\n};\r\n\r\n// File:src/extras/helpers/BoxHelper.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.BoxHelper = function(object) {\r\n\r\n  var geometry = new THREE.BufferGeometry();\r\n  geometry.addAttribute('position', new THREE.BufferAttribute(new Float32Array(72), 3));\r\n\r\n  THREE.Line.call(this, geometry, new THREE.LineBasicMaterial({\r\n    color: 0xffff00\r\n  }), THREE.LinePieces);\r\n\r\n  if (object !== undefined) {\r\n\r\n    this.update(object);\r\n\r\n  }\r\n\r\n};\r\n\r\nTHREE.BoxHelper.prototype = Object.create(THREE.Line.prototype);\r\nTHREE.BoxHelper.prototype.constructor = THREE.BoxHelper;\r\n\r\nTHREE.BoxHelper.prototype.update = function(object) {\r\n\r\n  var geometry = object.geometry;\r\n\r\n  if (geometry.boundingBox === null) {\r\n\r\n    geometry.computeBoundingBox();\r\n\r\n  }\r\n\r\n  var min = geometry.boundingBox.min;\r\n  var max = geometry.boundingBox.max;\r\n\r\n  /*\r\n    5____4\r\n  1/___0/|\r\n  | 6__|_7\r\n  2/___3/\r\n\r\n  0: max.x, max.y, max.z\r\n  1: min.x, max.y, max.z\r\n  2: min.x, min.y, max.z\r\n  3: max.x, min.y, max.z\r\n  4: max.x, max.y, min.z\r\n  5: min.x, max.y, min.z\r\n  6: min.x, min.y, min.z\r\n  7: max.x, min.y, min.z\r\n  */\r\n\r\n  var vertices = this.geometry.attributes.position.array;\r\n\r\n  vertices[0] = max.x;\r\n  vertices[1] = max.y;\r\n  vertices[2] = max.z;\r\n  vertices[3] = min.x;\r\n  vertices[4] = max.y;\r\n  vertices[5] = max.z;\r\n\r\n  vertices[6] = min.x;\r\n  vertices[7] = max.y;\r\n  vertices[8] = max.z;\r\n  vertices[9] = min.x;\r\n  vertices[10] = min.y;\r\n  vertices[11] = max.z;\r\n\r\n  vertices[12] = min.x;\r\n  vertices[13] = min.y;\r\n  vertices[14] = max.z;\r\n  vertices[15] = max.x;\r\n  vertices[16] = min.y;\r\n  vertices[17] = max.z;\r\n\r\n  vertices[18] = max.x;\r\n  vertices[19] = min.y;\r\n  vertices[20] = max.z;\r\n  vertices[21] = max.x;\r\n  vertices[22] = max.y;\r\n  vertices[23] = max.z;\r\n\r\n  //\r\n\r\n  vertices[24] = max.x;\r\n  vertices[25] = max.y;\r\n  vertices[26] = min.z;\r\n  vertices[27] = min.x;\r\n  vertices[28] = max.y;\r\n  vertices[29] = min.z;\r\n\r\n  vertices[30] = min.x;\r\n  vertices[31] = max.y;\r\n  vertices[32] = min.z;\r\n  vertices[33] = min.x;\r\n  vertices[34] = min.y;\r\n  vertices[35] = min.z;\r\n\r\n  vertices[36] = min.x;\r\n  vertices[37] = min.y;\r\n  vertices[38] = min.z;\r\n  vertices[39] = max.x;\r\n  vertices[40] = min.y;\r\n  vertices[41] = min.z;\r\n\r\n  vertices[42] = max.x;\r\n  vertices[43] = min.y;\r\n  vertices[44] = min.z;\r\n  vertices[45] = max.x;\r\n  vertices[46] = max.y;\r\n  vertices[47] = min.z;\r\n\r\n  //\r\n\r\n  vertices[48] = max.x;\r\n  vertices[49] = max.y;\r\n  vertices[50] = max.z;\r\n  vertices[51] = max.x;\r\n  vertices[52] = max.y;\r\n  vertices[53] = min.z;\r\n\r\n  vertices[54] = min.x;\r\n  vertices[55] = max.y;\r\n  vertices[56] = max.z;\r\n  vertices[57] = min.x;\r\n  vertices[58] = max.y;\r\n  vertices[59] = min.z;\r\n\r\n  vertices[60] = min.x;\r\n  vertices[61] = min.y;\r\n  vertices[62] = max.z;\r\n  vertices[63] = min.x;\r\n  vertices[64] = min.y;\r\n  vertices[65] = min.z;\r\n\r\n  vertices[66] = max.x;\r\n  vertices[67] = min.y;\r\n  vertices[68] = max.z;\r\n  vertices[69] = max.x;\r\n  vertices[70] = min.y;\r\n  vertices[71] = min.z;\r\n\r\n  this.geometry.attributes.position.needsUpdate = true;\r\n\r\n  this.geometry.computeBoundingSphere();\r\n\r\n  this.matrix = object.matrixWorld;\r\n  this.matrixAutoUpdate = false;\r\n\r\n};\r\n\r\n// File:src/extras/helpers/BoundingBoxHelper.js\r\n\r\n/**\r\n * @author WestLangley / http://github.com/WestLangley\r\n */\r\n\r\n// a helper to show the world-axis-aligned bounding box for an object\r\n\r\nTHREE.BoundingBoxHelper = function(object, hex) {\r\n\r\n  var color = (hex !== undefined) ? hex : 0x888888;\r\n\r\n  this.object = object;\r\n\r\n  this.box = new THREE.Box3();\r\n\r\n  THREE.Mesh.call(this, new THREE.BoxGeometry(1, 1, 1), new THREE.MeshBasicMaterial({\r\n    color: color,\r\n    wireframe: true\r\n  }));\r\n\r\n};\r\n\r\nTHREE.BoundingBoxHelper.prototype = Object.create(THREE.Mesh.prototype);\r\nTHREE.BoundingBoxHelper.prototype.constructor = THREE.BoundingBoxHelper;\r\n\r\nTHREE.BoundingBoxHelper.prototype.update = function() {\r\n\r\n  this.box.setFromObject(this.object);\r\n\r\n  this.box.size(this.scale);\r\n\r\n  this.box.center(this.position);\r\n\r\n};\r\n\r\n// File:src/extras/helpers/CameraHelper.js\r\n\r\n/**\r\n * @author alteredq / http://alteredqualia.com/\r\n *\r\n *\t- shows frustum, line of sight and up of the camera\r\n *\t- suitable for fast updates\r\n * \t- based on frustum visualization in lightgl.js shadowmap example\r\n *\t\thttp://evanw.github.com/lightgl.js/tests/shadowmap.html\r\n */\r\n\r\nTHREE.CameraHelper = function(camera) {\r\n\r\n  var geometry = new THREE.Geometry();\r\n  var material = new THREE.LineBasicMaterial({\r\n    color: 0xffffff,\r\n    vertexColors: THREE.FaceColors\r\n  });\r\n\r\n  var pointMap = {};\r\n\r\n  // colors\r\n\r\n  var hexFrustum = 0xffaa00;\r\n  var hexCone = 0xff0000;\r\n  var hexUp = 0x00aaff;\r\n  var hexTarget = 0xffffff;\r\n  var hexCross = 0x333333;\r\n\r\n  // near\r\n\r\n  addLine(\"n1\", \"n2\", hexFrustum);\r\n  addLine(\"n2\", \"n4\", hexFrustum);\r\n  addLine(\"n4\", \"n3\", hexFrustum);\r\n  addLine(\"n3\", \"n1\", hexFrustum);\r\n\r\n  // far\r\n\r\n  addLine(\"f1\", \"f2\", hexFrustum);\r\n  addLine(\"f2\", \"f4\", hexFrustum);\r\n  addLine(\"f4\", \"f3\", hexFrustum);\r\n  addLine(\"f3\", \"f1\", hexFrustum);\r\n\r\n  // sides\r\n\r\n  addLine(\"n1\", \"f1\", hexFrustum);\r\n  addLine(\"n2\", \"f2\", hexFrustum);\r\n  addLine(\"n3\", \"f3\", hexFrustum);\r\n  addLine(\"n4\", \"f4\", hexFrustum);\r\n\r\n  // cone\r\n\r\n  addLine(\"p\", \"n1\", hexCone);\r\n  addLine(\"p\", \"n2\", hexCone);\r\n  addLine(\"p\", \"n3\", hexCone);\r\n  addLine(\"p\", \"n4\", hexCone);\r\n\r\n  // up\r\n\r\n  addLine(\"u1\", \"u2\", hexUp);\r\n  addLine(\"u2\", \"u3\", hexUp);\r\n  addLine(\"u3\", \"u1\", hexUp);\r\n\r\n  // target\r\n\r\n  addLine(\"c\", \"t\", hexTarget);\r\n  addLine(\"p\", \"c\", hexCross);\r\n\r\n  // cross\r\n\r\n  addLine(\"cn1\", \"cn2\", hexCross);\r\n  addLine(\"cn3\", \"cn4\", hexCross);\r\n\r\n  addLine(\"cf1\", \"cf2\", hexCross);\r\n  addLine(\"cf3\", \"cf4\", hexCross);\r\n\r\n  function addLine(a, b, hex) {\r\n\r\n    addPoint(a, hex);\r\n    addPoint(b, hex);\r\n\r\n  }\r\n\r\n  function addPoint(id, hex) {\r\n\r\n    geometry.vertices.push(new THREE.Vector3());\r\n    geometry.colors.push(new THREE.Color(hex));\r\n\r\n    if (pointMap[id] === undefined) {\r\n\r\n      pointMap[id] = [];\r\n\r\n    }\r\n\r\n    pointMap[id].push(geometry.vertices.length - 1);\r\n\r\n  }\r\n\r\n  THREE.Line.call(this, geometry, material, THREE.LinePieces);\r\n\r\n  this.camera = camera;\r\n  this.matrix = camera.matrixWorld;\r\n  this.matrixAutoUpdate = false;\r\n\r\n  this.pointMap = pointMap;\r\n\r\n  this.update();\r\n\r\n};\r\n\r\nTHREE.CameraHelper.prototype = Object.create(THREE.Line.prototype);\r\nTHREE.CameraHelper.prototype.constructor = THREE.CameraHelper;\r\n\r\nTHREE.CameraHelper.prototype.update = function() {\r\n\r\n  var geometry, pointMap;\r\n\r\n  var vector = new THREE.Vector3();\r\n  var camera = new THREE.Camera();\r\n\r\n  var setPoint = function(point, x, y, z) {\r\n\r\n    vector.set(x, y, z).unproject(camera);\r\n\r\n    var points = pointMap[point];\r\n\r\n    if (points !== undefined) {\r\n\r\n      for (var i = 0, il = points.length; i < il; i++) {\r\n\r\n        geometry.vertices[points[i]].copy(vector);\r\n\r\n      }\r\n\r\n    }\r\n\r\n  };\r\n\r\n  return function() {\r\n\r\n    geometry = this.geometry;\r\n    pointMap = this.pointMap;\r\n\r\n    var w = 1,\r\n      h = 1;\r\n\r\n    // we need just camera projection matrix\r\n    // world matrix must be identity\r\n\r\n    camera.projectionMatrix.copy(this.camera.projectionMatrix);\r\n\r\n    // center / target\r\n\r\n    setPoint(\"c\", 0, 0, -1);\r\n    setPoint(\"t\", 0, 0, 1);\r\n\r\n    // near\r\n\r\n    setPoint(\"n1\", -w, -h, -1);\r\n    setPoint(\"n2\", w, -h, -1);\r\n    setPoint(\"n3\", -w, h, -1);\r\n    setPoint(\"n4\", w, h, -1);\r\n\r\n    // far\r\n\r\n    setPoint(\"f1\", -w, -h, 1);\r\n    setPoint(\"f2\", w, -h, 1);\r\n    setPoint(\"f3\", -w, h, 1);\r\n    setPoint(\"f4\", w, h, 1);\r\n\r\n    // up\r\n\r\n    setPoint(\"u1\", w * 0.7, h * 1.1, -1);\r\n    setPoint(\"u2\", -w * 0.7, h * 1.1, -1);\r\n    setPoint(\"u3\", 0, h * 2, -1);\r\n\r\n    // cross\r\n\r\n    setPoint(\"cf1\", -w, 0, 1);\r\n    setPoint(\"cf2\", w, 0, 1);\r\n    setPoint(\"cf3\", 0, -h, 1);\r\n    setPoint(\"cf4\", 0, h, 1);\r\n\r\n    setPoint(\"cn1\", -w, 0, -1);\r\n    setPoint(\"cn2\", w, 0, -1);\r\n    setPoint(\"cn3\", 0, -h, -1);\r\n    setPoint(\"cn4\", 0, h, -1);\r\n\r\n    geometry.verticesNeedUpdate = true;\r\n\r\n  };\r\n\r\n}();\r\n\r\n// File:src/extras/helpers/DirectionalLightHelper.js\r\n\r\n/**\r\n * @author alteredq / http://alteredqualia.com/\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author WestLangley / http://github.com/WestLangley\r\n */\r\n\r\nTHREE.DirectionalLightHelper = function(light, size) {\r\n\r\n  THREE.Object3D.call(this);\r\n\r\n  this.light = light;\r\n  this.light.updateMatrixWorld();\r\n\r\n  this.matrix = light.matrixWorld;\r\n  this.matrixAutoUpdate = false;\r\n\r\n  size = size || 1;\r\n\r\n  var geometry = new THREE.Geometry();\r\n  geometry.vertices.push(\r\n    new THREE.Vector3(-size, size, 0),\r\n    new THREE.Vector3(size, size, 0),\r\n    new THREE.Vector3(size, -size, 0),\r\n    new THREE.Vector3(-size, -size, 0),\r\n    new THREE.Vector3(-size, size, 0)\r\n  );\r\n\r\n  var material = new THREE.LineBasicMaterial({\r\n    fog: false\r\n  });\r\n  material.color.copy(this.light.color).multiplyScalar(this.light.intensity);\r\n\r\n  this.lightPlane = new THREE.Line(geometry, material);\r\n  this.add(this.lightPlane);\r\n\r\n  geometry = new THREE.Geometry();\r\n  geometry.vertices.push(\r\n    new THREE.Vector3(),\r\n    new THREE.Vector3()\r\n  );\r\n\r\n  material = new THREE.LineBasicMaterial({\r\n    fog: false\r\n  });\r\n  material.color.copy(this.light.color).multiplyScalar(this.light.intensity);\r\n\r\n  this.targetLine = new THREE.Line(geometry, material);\r\n  this.add(this.targetLine);\r\n\r\n  this.update();\r\n\r\n};\r\n\r\nTHREE.DirectionalLightHelper.prototype = Object.create(THREE.Object3D.prototype);\r\nTHREE.DirectionalLightHelper.prototype.constructor = THREE.DirectionalLightHelper;\r\n\r\nTHREE.DirectionalLightHelper.prototype.dispose = function() {\r\n\r\n  this.lightPlane.geometry.dispose();\r\n  this.lightPlane.material.dispose();\r\n  this.targetLine.geometry.dispose();\r\n  this.targetLine.material.dispose();\r\n};\r\n\r\nTHREE.DirectionalLightHelper.prototype.update = function() {\r\n\r\n  var v1 = new THREE.Vector3();\r\n  var v2 = new THREE.Vector3();\r\n  var v3 = new THREE.Vector3();\r\n\r\n  return function() {\r\n\r\n    v1.setFromMatrixPosition(this.light.matrixWorld);\r\n    v2.setFromMatrixPosition(this.light.target.matrixWorld);\r\n    v3.subVectors(v2, v1);\r\n\r\n    this.lightPlane.lookAt(v3);\r\n    this.lightPlane.material.color.copy(this.light.color).multiplyScalar(this.light.intensity);\r\n\r\n    this.targetLine.geometry.vertices[1].copy(v3);\r\n    this.targetLine.geometry.verticesNeedUpdate = true;\r\n    this.targetLine.material.color.copy(this.lightPlane.material.color);\r\n\r\n  };\r\n\r\n}();\r\n\r\n// File:src/extras/helpers/EdgesHelper.js\r\n\r\n/**\r\n * @author WestLangley / http://github.com/WestLangley\r\n * @param object THREE.Mesh whose geometry will be used\r\n * @param hex line color\r\n * @param thresholdAngle the minimim angle (in degrees),\r\n * between the face normals of adjacent faces,\r\n * that is required to render an edge. A value of 10 means\r\n * an edge is only rendered if the angle is at least 10 degrees.\r\n */\r\n\r\nTHREE.EdgesHelper = function(object, hex, thresholdAngle) {\r\n\r\n  var color = (hex !== undefined) ? hex : 0xffffff;\r\n  thresholdAngle = (thresholdAngle !== undefined) ? thresholdAngle : 1;\r\n\r\n  var thresholdDot = Math.cos(THREE.Math.degToRad(thresholdAngle));\r\n\r\n  var edge = [0, 0],\r\n    hash = {};\r\n  var sortFunction = function(a, b) {\r\n    return a - b\r\n  };\r\n\r\n  var keys = ['a', 'b', 'c'];\r\n  var geometry = new THREE.BufferGeometry();\r\n\r\n  var geometry2;\r\n\r\n  if (object.geometry instanceof THREE.BufferGeometry) {\r\n\r\n    geometry2 = new THREE.Geometry();\r\n    geometry2.fromBufferGeometry(object.geometry);\r\n\r\n  }\r\n  else {\r\n\r\n    geometry2 = object.geometry.clone();\r\n\r\n  }\r\n\r\n  geometry2.mergeVertices();\r\n  geometry2.computeFaceNormals();\r\n\r\n  var vertices = geometry2.vertices;\r\n  var faces = geometry2.faces;\r\n  var numEdges = 0;\r\n\r\n  for (var i = 0, l = faces.length; i < l; i++) {\r\n\r\n    var face = faces[i];\r\n\r\n    for (var j = 0; j < 3; j++) {\r\n\r\n      edge[0] = face[keys[j]];\r\n      edge[1] = face[keys[(j + 1) % 3]];\r\n      edge.sort(sortFunction);\r\n\r\n      var key = edge.toString();\r\n\r\n      if (hash[key] === undefined) {\r\n\r\n        hash[key] = {\r\n          vert1: edge[0],\r\n          vert2: edge[1],\r\n          face1: i,\r\n          face2: undefined\r\n        };\r\n        numEdges++;\r\n\r\n      }\r\n      else {\r\n\r\n        hash[key].face2 = i;\r\n\r\n      }\r\n\r\n    }\r\n\r\n  }\r\n\r\n  var coords = new Float32Array(numEdges * 2 * 3);\r\n\r\n  var index = 0;\r\n\r\n  for (var key in hash) {\r\n\r\n    var h = hash[key];\r\n\r\n    if (h.face2 === undefined || faces[h.face1].normal.dot(faces[h.face2].normal) <= thresholdDot) {\r\n\r\n      var vertex = vertices[h.vert1];\r\n      coords[index++] = vertex.x;\r\n      coords[index++] = vertex.y;\r\n      coords[index++] = vertex.z;\r\n\r\n      vertex = vertices[h.vert2];\r\n      coords[index++] = vertex.x;\r\n      coords[index++] = vertex.y;\r\n      coords[index++] = vertex.z;\r\n\r\n    }\r\n\r\n  }\r\n\r\n  geometry.addAttribute('position', new THREE.BufferAttribute(coords, 3));\r\n\r\n  THREE.Line.call(this, geometry, new THREE.LineBasicMaterial({\r\n    color: color\r\n  }), THREE.LinePieces);\r\n\r\n  this.matrix = object.matrixWorld;\r\n  this.matrixAutoUpdate = false;\r\n\r\n};\r\n\r\nTHREE.EdgesHelper.prototype = Object.create(THREE.Line.prototype);\r\nTHREE.EdgesHelper.prototype.constructor = THREE.EdgesHelper;\r\n\r\n// File:src/extras/helpers/FaceNormalsHelper.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author WestLangley / http://github.com/WestLangley\r\n */\r\n\r\nTHREE.FaceNormalsHelper = function(object, size, hex, linewidth) {\r\n\r\n  this.object = object;\r\n\r\n  this.size = (size !== undefined) ? size : 1;\r\n\r\n  var color = (hex !== undefined) ? hex : 0xffff00;\r\n\r\n  var width = (linewidth !== undefined) ? linewidth : 1;\r\n\r\n  var geometry = new THREE.Geometry();\r\n\r\n  var faces = this.object.geometry.faces;\r\n\r\n  for (var i = 0, l = faces.length; i < l; i++) {\r\n\r\n    geometry.vertices.push(new THREE.Vector3(), new THREE.Vector3());\r\n\r\n  }\r\n\r\n  THREE.Line.call(this, geometry, new THREE.LineBasicMaterial({\r\n    color: color,\r\n    linewidth: width\r\n  }), THREE.LinePieces);\r\n\r\n  this.matrixAutoUpdate = false;\r\n\r\n  this.normalMatrix = new THREE.Matrix3();\r\n\r\n  this.update();\r\n\r\n};\r\n\r\nTHREE.FaceNormalsHelper.prototype = Object.create(THREE.Line.prototype);\r\nTHREE.FaceNormalsHelper.prototype.constructor = THREE.FaceNormalsHelper;\r\n\r\nTHREE.FaceNormalsHelper.prototype.update = function() {\r\n\r\n  var vertices = this.geometry.vertices;\r\n\r\n  var object = this.object;\r\n  var objectVertices = object.geometry.vertices;\r\n  var objectFaces = object.geometry.faces;\r\n  var objectWorldMatrix = object.matrixWorld;\r\n\r\n  object.updateMatrixWorld(true);\r\n\r\n  this.normalMatrix.getNormalMatrix(objectWorldMatrix);\r\n\r\n  for (var i = 0, i2 = 0, l = objectFaces.length; i < l; i++, i2 += 2) {\r\n\r\n    var face = objectFaces[i];\r\n\r\n    vertices[i2].copy(objectVertices[face.a])\r\n      .add(objectVertices[face.b])\r\n      .add(objectVertices[face.c])\r\n      .divideScalar(3)\r\n      .applyMatrix4(objectWorldMatrix);\r\n\r\n    vertices[i2 + 1].copy(face.normal)\r\n      .applyMatrix3(this.normalMatrix)\r\n      .normalize()\r\n      .multiplyScalar(this.size)\r\n      .add(vertices[i2]);\r\n\r\n  }\r\n\r\n  this.geometry.verticesNeedUpdate = true;\r\n\r\n  return this;\r\n\r\n};\r\n\r\n\r\n// File:src/extras/helpers/GridHelper.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.GridHelper = function(size, step) {\r\n\r\n  var geometry = new THREE.Geometry();\r\n  var material = new THREE.LineBasicMaterial({\r\n    vertexColors: THREE.VertexColors\r\n  });\r\n\r\n  this.color1 = new THREE.Color(0x444444);\r\n  this.color2 = new THREE.Color(0x888888);\r\n\r\n  for (var i = -size; i <= size; i += step) {\r\n\r\n    geometry.vertices.push(\r\n      new THREE.Vector3(-size, 0, i), new THREE.Vector3(size, 0, i),\r\n      new THREE.Vector3(i, 0, -size), new THREE.Vector3(i, 0, size)\r\n    );\r\n\r\n    var color = i === 0 ? this.color1 : this.color2;\r\n\r\n    geometry.colors.push(color, color, color, color);\r\n\r\n  }\r\n\r\n  THREE.Line.call(this, geometry, material, THREE.LinePieces);\r\n\r\n};\r\n\r\nTHREE.GridHelper.prototype = Object.create(THREE.Line.prototype);\r\nTHREE.GridHelper.prototype.constructor = THREE.GridHelper;\r\n\r\nTHREE.GridHelper.prototype.setColors = function(colorCenterLine, colorGrid) {\r\n\r\n  this.color1.set(colorCenterLine);\r\n  this.color2.set(colorGrid);\r\n\r\n  this.geometry.colorsNeedUpdate = true;\r\n\r\n}\r\n\r\n// File:src/extras/helpers/HemisphereLightHelper.js\r\n\r\n/**\r\n * @author alteredq / http://alteredqualia.com/\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.HemisphereLightHelper = function(light, sphereSize) {\r\n\r\n  THREE.Object3D.call(this);\r\n\r\n  this.light = light;\r\n  this.light.updateMatrixWorld();\r\n\r\n  this.matrix = light.matrixWorld;\r\n  this.matrixAutoUpdate = false;\r\n\r\n  this.colors = [new THREE.Color(), new THREE.Color()];\r\n\r\n  var geometry = new THREE.SphereGeometry(sphereSize, 4, 2);\r\n  geometry.applyMatrix(new THREE.Matrix4().makeRotationX(-Math.PI / 2));\r\n\r\n  for (var i = 0, il = 8; i < il; i++) {\r\n\r\n    geometry.faces[i].color = this.colors[i < 4 ? 0 : 1];\r\n\r\n  }\r\n\r\n  var material = new THREE.MeshBasicMaterial({\r\n    vertexColors: THREE.FaceColors,\r\n    wireframe: true\r\n  });\r\n\r\n  this.lightSphere = new THREE.Mesh(geometry, material);\r\n  this.add(this.lightSphere);\r\n\r\n  this.update();\r\n\r\n};\r\n\r\nTHREE.HemisphereLightHelper.prototype = Object.create(THREE.Object3D.prototype);\r\nTHREE.HemisphereLightHelper.prototype.constructor = THREE.HemisphereLightHelper;\r\n\r\nTHREE.HemisphereLightHelper.prototype.dispose = function() {\r\n  this.lightSphere.geometry.dispose();\r\n  this.lightSphere.material.dispose();\r\n};\r\n\r\nTHREE.HemisphereLightHelper.prototype.update = function() {\r\n\r\n  var vector = new THREE.Vector3();\r\n\r\n  return function() {\r\n\r\n    this.colors[0].copy(this.light.color).multiplyScalar(this.light.intensity);\r\n    this.colors[1].copy(this.light.groundColor).multiplyScalar(this.light.intensity);\r\n\r\n    this.lightSphere.lookAt(vector.setFromMatrixPosition(this.light.matrixWorld).negate());\r\n    this.lightSphere.geometry.colorsNeedUpdate = true;\r\n\r\n  }\r\n\r\n}();\r\n\r\n// File:src/extras/helpers/PointLightHelper.js\r\n\r\n/**\r\n * @author alteredq / http://alteredqualia.com/\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.PointLightHelper = function(light, sphereSize) {\r\n\r\n  this.light = light;\r\n  this.light.updateMatrixWorld();\r\n\r\n  var geometry = new THREE.SphereGeometry(sphereSize, 4, 2);\r\n  var material = new THREE.MeshBasicMaterial({\r\n    wireframe: true,\r\n    fog: false\r\n  });\r\n  material.color.copy(this.light.color).multiplyScalar(this.light.intensity);\r\n\r\n  THREE.Mesh.call(this, geometry, material);\r\n\r\n  this.matrix = this.light.matrixWorld;\r\n  this.matrixAutoUpdate = false;\r\n\r\n  /*\r\n  var distanceGeometry = new THREE.IcosahedronGeometry( 1, 2 );\r\n  var distanceMaterial = new THREE.MeshBasicMaterial( { color: hexColor, fog: false, wireframe: true, opacity: 0.1, transparent: true } );\r\n\r\n  this.lightSphere = new THREE.Mesh( bulbGeometry, bulbMaterial );\r\n  this.lightDistance = new THREE.Mesh( distanceGeometry, distanceMaterial );\r\n\r\n  var d = light.distance;\r\n\r\n  if ( d === 0.0 ) {\r\n\r\n  \tthis.lightDistance.visible = false;\r\n\r\n  } else {\r\n\r\n  \tthis.lightDistance.scale.set( d, d, d );\r\n\r\n  }\r\n\r\n  this.add( this.lightDistance );\r\n  */\r\n\r\n};\r\n\r\nTHREE.PointLightHelper.prototype = Object.create(THREE.Mesh.prototype);\r\nTHREE.PointLightHelper.prototype.constructor = THREE.PointLightHelper;\r\n\r\nTHREE.PointLightHelper.prototype.dispose = function() {\r\n\r\n  this.geometry.dispose();\r\n  this.material.dispose();\r\n};\r\n\r\nTHREE.PointLightHelper.prototype.update = function() {\r\n\r\n  this.material.color.copy(this.light.color).multiplyScalar(this.light.intensity);\r\n\r\n  /*\r\n  var d = this.light.distance;\r\n\r\n  if ( d === 0.0 ) {\r\n\r\n  \tthis.lightDistance.visible = false;\r\n\r\n  } else {\r\n\r\n  \tthis.lightDistance.visible = true;\r\n  \tthis.lightDistance.scale.set( d, d, d );\r\n\r\n  }\r\n  */\r\n\r\n};\r\n\r\n// File:src/extras/helpers/SkeletonHelper.js\r\n\r\n/**\r\n * @author Sean Griffin / http://twitter.com/sgrif\r\n * @author Michael Guerrero / http://realitymeltdown.com\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author ikerr / http://verold.com\r\n */\r\n\r\nTHREE.SkeletonHelper = function(object) {\r\n\r\n  this.bones = this.getBoneList(object);\r\n\r\n  var geometry = new THREE.Geometry();\r\n\r\n  for (var i = 0; i < this.bones.length; i++) {\r\n\r\n    var bone = this.bones[i];\r\n\r\n    if (bone.parent instanceof THREE.Bone) {\r\n\r\n      geometry.vertices.push(new THREE.Vector3());\r\n      geometry.vertices.push(new THREE.Vector3());\r\n      geometry.colors.push(new THREE.Color(0, 0, 1));\r\n      geometry.colors.push(new THREE.Color(0, 1, 0));\r\n\r\n    }\r\n\r\n  }\r\n\r\n  var material = new THREE.LineBasicMaterial({\r\n    vertexColors: THREE.VertexColors,\r\n    depthTest: false,\r\n    depthWrite: false,\r\n    transparent: true\r\n  });\r\n\r\n  THREE.Line.call(this, geometry, material, THREE.LinePieces);\r\n\r\n  this.root = object;\r\n\r\n  this.matrix = object.matrixWorld;\r\n  this.matrixAutoUpdate = false;\r\n\r\n  this.update();\r\n\r\n};\r\n\r\n\r\nTHREE.SkeletonHelper.prototype = Object.create(THREE.Line.prototype);\r\nTHREE.SkeletonHelper.prototype.constructor = THREE.SkeletonHelper;\r\n\r\nTHREE.SkeletonHelper.prototype.getBoneList = function(object) {\r\n\r\n  var boneList = [];\r\n\r\n  if (object instanceof THREE.Bone) {\r\n\r\n    boneList.push(object);\r\n\r\n  }\r\n\r\n  for (var i = 0; i < object.children.length; i++) {\r\n\r\n    boneList.push.apply(boneList, this.getBoneList(object.children[i]));\r\n\r\n  }\r\n\r\n  return boneList;\r\n\r\n};\r\n\r\nTHREE.SkeletonHelper.prototype.update = function() {\r\n\r\n  var geometry = this.geometry;\r\n\r\n  var matrixWorldInv = new THREE.Matrix4().getInverse(this.root.matrixWorld);\r\n\r\n  var boneMatrix = new THREE.Matrix4();\r\n\r\n  var j = 0;\r\n\r\n  for (var i = 0; i < this.bones.length; i++) {\r\n\r\n    var bone = this.bones[i];\r\n\r\n    if (bone.parent instanceof THREE.Bone) {\r\n\r\n      boneMatrix.multiplyMatrices(matrixWorldInv, bone.matrixWorld);\r\n      geometry.vertices[j].setFromMatrixPosition(boneMatrix);\r\n\r\n      boneMatrix.multiplyMatrices(matrixWorldInv, bone.parent.matrixWorld);\r\n      geometry.vertices[j + 1].setFromMatrixPosition(boneMatrix);\r\n\r\n      j += 2;\r\n\r\n    }\r\n\r\n  }\r\n\r\n  geometry.verticesNeedUpdate = true;\r\n\r\n  geometry.computeBoundingSphere();\r\n\r\n};\r\n\r\n// File:src/extras/helpers/SpotLightHelper.js\r\n\r\n/**\r\n * @author alteredq / http://alteredqualia.com/\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author WestLangley / http://github.com/WestLangley\r\n */\r\n\r\nTHREE.SpotLightHelper = function(light) {\r\n\r\n  THREE.Object3D.call(this);\r\n\r\n  this.light = light;\r\n  this.light.updateMatrixWorld();\r\n\r\n  this.matrix = light.matrixWorld;\r\n  this.matrixAutoUpdate = false;\r\n\r\n  var geometry = new THREE.CylinderGeometry(0, 1, 1, 8, 1, true);\r\n\r\n  geometry.applyMatrix(new THREE.Matrix4().makeTranslation(0, -0.5, 0));\r\n  geometry.applyMatrix(new THREE.Matrix4().makeRotationX(-Math.PI / 2));\r\n\r\n  var material = new THREE.MeshBasicMaterial({\r\n    wireframe: true,\r\n    fog: false\r\n  });\r\n\r\n  this.cone = new THREE.Mesh(geometry, material);\r\n  this.add(this.cone);\r\n\r\n  this.update();\r\n\r\n};\r\n\r\nTHREE.SpotLightHelper.prototype = Object.create(THREE.Object3D.prototype);\r\nTHREE.SpotLightHelper.prototype.constructor = THREE.SpotLightHelper;\r\n\r\nTHREE.SpotLightHelper.prototype.dispose = function() {\r\n  this.cone.geometry.dispose();\r\n  this.cone.material.dispose();\r\n};\r\n\r\nTHREE.SpotLightHelper.prototype.update = function() {\r\n\r\n  var vector = new THREE.Vector3();\r\n  var vector2 = new THREE.Vector3();\r\n\r\n  return function() {\r\n\r\n    var coneLength = this.light.distance ? this.light.distance : 10000;\r\n    var coneWidth = coneLength * Math.tan(this.light.angle);\r\n\r\n    this.cone.scale.set(coneWidth, coneWidth, coneLength);\r\n\r\n    vector.setFromMatrixPosition(this.light.matrixWorld);\r\n    vector2.setFromMatrixPosition(this.light.target.matrixWorld);\r\n\r\n    this.cone.lookAt(vector2.sub(vector));\r\n\r\n    this.cone.material.color.copy(this.light.color).multiplyScalar(this.light.intensity);\r\n\r\n  };\r\n\r\n}();\r\n\r\n// File:src/extras/helpers/VertexNormalsHelper.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author WestLangley / http://github.com/WestLangley\r\n */\r\n\r\nTHREE.VertexNormalsHelper = function(object, size, hex, linewidth) {\r\n\r\n  this.object = object;\r\n\r\n  this.size = (size !== undefined) ? size : 1;\r\n\r\n  var color = (hex !== undefined) ? hex : 0xff0000;\r\n\r\n  var width = (linewidth !== undefined) ? linewidth : 1;\r\n\r\n  var geometry = new THREE.Geometry();\r\n\r\n  var faces = object.geometry.faces;\r\n\r\n  for (var i = 0, l = faces.length; i < l; i++) {\r\n\r\n    var face = faces[i];\r\n\r\n    for (var j = 0, jl = face.vertexNormals.length; j < jl; j++) {\r\n\r\n      geometry.vertices.push(new THREE.Vector3(), new THREE.Vector3());\r\n\r\n    }\r\n\r\n  }\r\n\r\n  THREE.Line.call(this, geometry, new THREE.LineBasicMaterial({\r\n    color: color,\r\n    linewidth: width\r\n  }), THREE.LinePieces);\r\n\r\n  this.matrixAutoUpdate = false;\r\n\r\n  this.normalMatrix = new THREE.Matrix3();\r\n\r\n  this.update();\r\n\r\n};\r\n\r\nTHREE.VertexNormalsHelper.prototype = Object.create(THREE.Line.prototype);\r\nTHREE.VertexNormalsHelper.prototype.constructor = THREE.VertexNormalsHelper;\r\n\r\nTHREE.VertexNormalsHelper.prototype.update = (function(object) {\r\n\r\n  var v1 = new THREE.Vector3();\r\n\r\n  return function(object) {\r\n\r\n    var keys = ['a', 'b', 'c', 'd'];\r\n\r\n    this.object.updateMatrixWorld(true);\r\n\r\n    this.normalMatrix.getNormalMatrix(this.object.matrixWorld);\r\n\r\n    var vertices = this.geometry.vertices;\r\n\r\n    var verts = this.object.geometry.vertices;\r\n\r\n    var faces = this.object.geometry.faces;\r\n\r\n    var worldMatrix = this.object.matrixWorld;\r\n\r\n    var idx = 0;\r\n\r\n    for (var i = 0, l = faces.length; i < l; i++) {\r\n\r\n      var face = faces[i];\r\n\r\n      for (var j = 0, jl = face.vertexNormals.length; j < jl; j++) {\r\n\r\n        var vertexId = face[keys[j]];\r\n        var vertex = verts[vertexId];\r\n\r\n        var normal = face.vertexNormals[j];\r\n\r\n        vertices[idx].copy(vertex).applyMatrix4(worldMatrix);\r\n\r\n        v1.copy(normal).applyMatrix3(this.normalMatrix).normalize().multiplyScalar(this.size);\r\n\r\n        v1.add(vertices[idx]);\r\n        idx = idx + 1;\r\n\r\n        vertices[idx].copy(v1);\r\n        idx = idx + 1;\r\n\r\n      }\r\n\r\n    }\r\n\r\n    this.geometry.verticesNeedUpdate = true;\r\n\r\n    return this;\r\n\r\n  }\r\n\r\n}());\r\n\r\n// File:src/extras/helpers/VertexTangentsHelper.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author WestLangley / http://github.com/WestLangley\r\n */\r\n\r\nTHREE.VertexTangentsHelper = function(object, size, hex, linewidth) {\r\n\r\n  this.object = object;\r\n\r\n  this.size = (size !== undefined) ? size : 1;\r\n\r\n  var color = (hex !== undefined) ? hex : 0x0000ff;\r\n\r\n  var width = (linewidth !== undefined) ? linewidth : 1;\r\n\r\n  var geometry = new THREE.Geometry();\r\n\r\n  var faces = object.geometry.faces;\r\n\r\n  for (var i = 0, l = faces.length; i < l; i++) {\r\n\r\n    var face = faces[i];\r\n\r\n    for (var j = 0, jl = face.vertexTangents.length; j < jl; j++) {\r\n\r\n      geometry.vertices.push(new THREE.Vector3());\r\n      geometry.vertices.push(new THREE.Vector3());\r\n\r\n    }\r\n\r\n  }\r\n\r\n  THREE.Line.call(this, geometry, new THREE.LineBasicMaterial({\r\n    color: color,\r\n    linewidth: width\r\n  }), THREE.LinePieces);\r\n\r\n  this.matrixAutoUpdate = false;\r\n\r\n  this.update();\r\n\r\n};\r\n\r\nTHREE.VertexTangentsHelper.prototype = Object.create(THREE.Line.prototype);\r\nTHREE.VertexTangentsHelper.prototype.constructor = THREE.VertexTangentsHelper;\r\n\r\nTHREE.VertexTangentsHelper.prototype.update = (function(object) {\r\n\r\n  var v1 = new THREE.Vector3();\r\n\r\n  return function(object) {\r\n\r\n    var keys = ['a', 'b', 'c', 'd'];\r\n\r\n    this.object.updateMatrixWorld(true);\r\n\r\n    var vertices = this.geometry.vertices;\r\n\r\n    var verts = this.object.geometry.vertices;\r\n\r\n    var faces = this.object.geometry.faces;\r\n\r\n    var worldMatrix = this.object.matrixWorld;\r\n\r\n    var idx = 0;\r\n\r\n    for (var i = 0, l = faces.length; i < l; i++) {\r\n\r\n      var face = faces[i];\r\n\r\n      for (var j = 0, jl = face.vertexTangents.length; j < jl; j++) {\r\n\r\n        var vertexId = face[keys[j]];\r\n        var vertex = verts[vertexId];\r\n\r\n        var tangent = face.vertexTangents[j];\r\n\r\n        vertices[idx].copy(vertex).applyMatrix4(worldMatrix);\r\n\r\n        v1.copy(tangent).transformDirection(worldMatrix).multiplyScalar(this.size);\r\n\r\n        v1.add(vertices[idx]);\r\n        idx = idx + 1;\r\n\r\n        vertices[idx].copy(v1);\r\n        idx = idx + 1;\r\n\r\n      }\r\n\r\n    }\r\n\r\n    this.geometry.verticesNeedUpdate = true;\r\n\r\n    return this;\r\n\r\n  }\r\n\r\n}());\r\n\r\n// File:src/extras/helpers/WireframeHelper.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.WireframeHelper = function(object, hex) {\r\n\r\n  var color = (hex !== undefined) ? hex : 0xffffff;\r\n\r\n  var edge = [0, 0],\r\n    hash = {};\r\n  var sortFunction = function(a, b) {\r\n    return a - b\r\n  };\r\n\r\n  var keys = ['a', 'b', 'c'];\r\n  var geometry = new THREE.BufferGeometry();\r\n\r\n  if (object.geometry instanceof THREE.Geometry) {\r\n\r\n    var vertices = object.geometry.vertices;\r\n    var faces = object.geometry.faces;\r\n    var numEdges = 0;\r\n\r\n    // allocate maximal size\r\n    var edges = new Uint32Array(6 * faces.length);\r\n\r\n    for (var i = 0, l = faces.length; i < l; i++) {\r\n\r\n      var face = faces[i];\r\n\r\n      for (var j = 0; j < 3; j++) {\r\n\r\n        edge[0] = face[keys[j]];\r\n        edge[1] = face[keys[(j + 1) % 3]];\r\n        edge.sort(sortFunction);\r\n\r\n        var key = edge.toString();\r\n\r\n        if (hash[key] === undefined) {\r\n\r\n          edges[2 * numEdges] = edge[0];\r\n          edges[2 * numEdges + 1] = edge[1];\r\n          hash[key] = true;\r\n          numEdges++;\r\n\r\n        }\r\n\r\n      }\r\n\r\n    }\r\n\r\n    var coords = new Float32Array(numEdges * 2 * 3);\r\n\r\n    for (var i = 0, l = numEdges; i < l; i++) {\r\n\r\n      for (var j = 0; j < 2; j++) {\r\n\r\n        var vertex = vertices[edges[2 * i + j]];\r\n\r\n        var index = 6 * i + 3 * j;\r\n        coords[index + 0] = vertex.x;\r\n        coords[index + 1] = vertex.y;\r\n        coords[index + 2] = vertex.z;\r\n\r\n      }\r\n\r\n    }\r\n\r\n    geometry.addAttribute('position', new THREE.BufferAttribute(coords, 3));\r\n\r\n  }\r\n  else if (object.geometry instanceof THREE.BufferGeometry) {\r\n\r\n    if (object.geometry.attributes.index !== undefined) { // Indexed BufferGeometry\r\n\r\n      var vertices = object.geometry.attributes.position.array;\r\n      var indices = object.geometry.attributes.index.array;\r\n      var drawcalls = object.geometry.drawcalls;\r\n      var numEdges = 0;\r\n\r\n      if (drawcalls.length === 0) {\r\n\r\n        drawcalls = [{\r\n          count: indices.length,\r\n          index: 0,\r\n          start: 0\r\n        }];\r\n\r\n      }\r\n\r\n      // allocate maximal size\r\n      var edges = new Uint32Array(2 * indices.length);\r\n\r\n      for (var o = 0, ol = drawcalls.length; o < ol; ++o) {\r\n\r\n        var start = drawcalls[o].start;\r\n        var count = drawcalls[o].count;\r\n        var index = drawcalls[o].index;\r\n\r\n        for (var i = start, il = start + count; i < il; i += 3) {\r\n\r\n          for (var j = 0; j < 3; j++) {\r\n\r\n            edge[0] = index + indices[i + j];\r\n            edge[1] = index + indices[i + (j + 1) % 3];\r\n            edge.sort(sortFunction);\r\n\r\n            var key = edge.toString();\r\n\r\n            if (hash[key] === undefined) {\r\n\r\n              edges[2 * numEdges] = edge[0];\r\n              edges[2 * numEdges + 1] = edge[1];\r\n              hash[key] = true;\r\n              numEdges++;\r\n\r\n            }\r\n\r\n          }\r\n\r\n        }\r\n\r\n      }\r\n\r\n      var coords = new Float32Array(numEdges * 2 * 3);\r\n\r\n      for (var i = 0, l = numEdges; i < l; i++) {\r\n\r\n        for (var j = 0; j < 2; j++) {\r\n\r\n          var index = 6 * i + 3 * j;\r\n          var index2 = 3 * edges[2 * i + j];\r\n          coords[index + 0] = vertices[index2];\r\n          coords[index + 1] = vertices[index2 + 1];\r\n          coords[index + 2] = vertices[index2 + 2];\r\n\r\n        }\r\n\r\n      }\r\n\r\n      geometry.addAttribute('position', new THREE.BufferAttribute(coords, 3));\r\n\r\n    }\r\n    else { // non-indexed BufferGeometry\r\n\r\n      var vertices = object.geometry.attributes.position.array;\r\n      var numEdges = vertices.length / 3;\r\n      var numTris = numEdges / 3;\r\n\r\n      var coords = new Float32Array(numEdges * 2 * 3);\r\n\r\n      for (var i = 0, l = numTris; i < l; i++) {\r\n\r\n        for (var j = 0; j < 3; j++) {\r\n\r\n          var index = 18 * i + 6 * j;\r\n\r\n          var index1 = 9 * i + 3 * j;\r\n          coords[index + 0] = vertices[index1];\r\n          coords[index + 1] = vertices[index1 + 1];\r\n          coords[index + 2] = vertices[index1 + 2];\r\n\r\n          var index2 = 9 * i + 3 * ((j + 1) % 3);\r\n          coords[index + 3] = vertices[index2];\r\n          coords[index + 4] = vertices[index2 + 1];\r\n          coords[index + 5] = vertices[index2 + 2];\r\n\r\n        }\r\n\r\n      }\r\n\r\n      geometry.addAttribute('position', new THREE.BufferAttribute(coords, 3));\r\n\r\n    }\r\n\r\n  }\r\n\r\n  THREE.Line.call(this, geometry, new THREE.LineBasicMaterial({\r\n    color: color\r\n  }), THREE.LinePieces);\r\n\r\n  this.matrix = object.matrixWorld;\r\n  this.matrixAutoUpdate = false;\r\n\r\n};\r\n\r\nTHREE.WireframeHelper.prototype = Object.create(THREE.Line.prototype);\r\nTHREE.WireframeHelper.prototype.constructor = THREE.WireframeHelper;\r\n\r\n// File:src/extras/objects/ImmediateRenderObject.js\r\n\r\n/**\r\n * @author alteredq / http://alteredqualia.com/\r\n */\r\n\r\nTHREE.ImmediateRenderObject = function() {\r\n\r\n  THREE.Object3D.call(this);\r\n\r\n  this.render = function(renderCallback) {};\r\n\r\n};\r\n\r\nTHREE.ImmediateRenderObject.prototype = Object.create(THREE.Object3D.prototype);\r\nTHREE.ImmediateRenderObject.prototype.constructor = THREE.ImmediateRenderObject;\r\n\r\n// File:src/extras/objects/MorphBlendMesh.js\r\n\r\n/**\r\n * @author alteredq / http://alteredqualia.com/\r\n */\r\n\r\nTHREE.MorphBlendMesh = function(geometry, material) {\r\n\r\n  THREE.Mesh.call(this, geometry, material);\r\n\r\n  this.animationsMap = {};\r\n  this.animationsList = [];\r\n\r\n  // prepare default animation\r\n  // (all frames played together in 1 second)\r\n\r\n  var numFrames = this.geometry.morphTargets.length;\r\n\r\n  var name = \"__default\";\r\n\r\n  var startFrame = 0;\r\n  var endFrame = numFrames - 1;\r\n\r\n  var fps = numFrames / 1;\r\n\r\n  this.createAnimation(name, startFrame, endFrame, fps);\r\n  this.setAnimationWeight(name, 1);\r\n\r\n};\r\n\r\nTHREE.MorphBlendMesh.prototype = Object.create(THREE.Mesh.prototype);\r\nTHREE.MorphBlendMesh.prototype.constructor = THREE.MorphBlendMesh;\r\n\r\nTHREE.MorphBlendMesh.prototype.createAnimation = function(name, start, end, fps) {\r\n\r\n  var animation = {\r\n\r\n    startFrame: start,\r\n    endFrame: end,\r\n\r\n    length: end - start + 1,\r\n\r\n    fps: fps,\r\n    duration: (end - start) / fps,\r\n\r\n    lastFrame: 0,\r\n    currentFrame: 0,\r\n\r\n    active: false,\r\n\r\n    time: 0,\r\n    direction: 1,\r\n    weight: 1,\r\n\r\n    directionBackwards: false,\r\n    mirroredLoop: false\r\n\r\n  };\r\n\r\n  this.animationsMap[name] = animation;\r\n  this.animationsList.push(animation);\r\n\r\n};\r\n\r\nTHREE.MorphBlendMesh.prototype.autoCreateAnimations = function(fps) {\r\n\r\n  var pattern = /([a-z]+)_?(\\d+)/;\r\n\r\n  var firstAnimation, frameRanges = {};\r\n\r\n  var geometry = this.geometry;\r\n\r\n  for (var i = 0, il = geometry.morphTargets.length; i < il; i++) {\r\n\r\n    var morph = geometry.morphTargets[i];\r\n    var chunks = morph.name.match(pattern);\r\n\r\n    if (chunks && chunks.length > 1) {\r\n\r\n      var name = chunks[1];\r\n\r\n      if (!frameRanges[name]) frameRanges[name] = {\r\n        start: Infinity,\r\n        end: -Infinity\r\n      };\r\n\r\n      var range = frameRanges[name];\r\n\r\n      if (i < range.start) range.start = i;\r\n      if (i > range.end) range.end = i;\r\n\r\n      if (!firstAnimation) firstAnimation = name;\r\n\r\n    }\r\n\r\n  }\r\n\r\n  for (var name in frameRanges) {\r\n\r\n    var range = frameRanges[name];\r\n    this.createAnimation(name, range.start, range.end, fps);\r\n\r\n  }\r\n\r\n  this.firstAnimation = firstAnimation;\r\n\r\n};\r\n\r\nTHREE.MorphBlendMesh.prototype.setAnimationDirectionForward = function(name) {\r\n\r\n  var animation = this.animationsMap[name];\r\n\r\n  if (animation) {\r\n\r\n    animation.direction = 1;\r\n    animation.directionBackwards = false;\r\n\r\n  }\r\n\r\n};\r\n\r\nTHREE.MorphBlendMesh.prototype.setAnimationDirectionBackward = function(name) {\r\n\r\n  var animation = this.animationsMap[name];\r\n\r\n  if (animation) {\r\n\r\n    animation.direction = -1;\r\n    animation.directionBackwards = true;\r\n\r\n  }\r\n\r\n};\r\n\r\nTHREE.MorphBlendMesh.prototype.setAnimationFPS = function(name, fps) {\r\n\r\n  var animation = this.animationsMap[name];\r\n\r\n  if (animation) {\r\n\r\n    animation.fps = fps;\r\n    animation.duration = (animation.end - animation.start) / animation.fps;\r\n\r\n  }\r\n\r\n};\r\n\r\nTHREE.MorphBlendMesh.prototype.setAnimationDuration = function(name, duration) {\r\n\r\n  var animation = this.animationsMap[name];\r\n\r\n  if (animation) {\r\n\r\n    animation.duration = duration;\r\n    animation.fps = (animation.end - animation.start) / animation.duration;\r\n\r\n  }\r\n\r\n};\r\n\r\nTHREE.MorphBlendMesh.prototype.setAnimationWeight = function(name, weight) {\r\n\r\n  var animation = this.animationsMap[name];\r\n\r\n  if (animation) {\r\n\r\n    animation.weight = weight;\r\n\r\n  }\r\n\r\n};\r\n\r\nTHREE.MorphBlendMesh.prototype.setAnimationTime = function(name, time) {\r\n\r\n  var animation = this.animationsMap[name];\r\n\r\n  if (animation) {\r\n\r\n    animation.time = time;\r\n\r\n  }\r\n\r\n};\r\n\r\nTHREE.MorphBlendMesh.prototype.getAnimationTime = function(name) {\r\n\r\n  var time = 0;\r\n\r\n  var animation = this.animationsMap[name];\r\n\r\n  if (animation) {\r\n\r\n    time = animation.time;\r\n\r\n  }\r\n\r\n  return time;\r\n\r\n};\r\n\r\nTHREE.MorphBlendMesh.prototype.getAnimationDuration = function(name) {\r\n\r\n  var duration = -1;\r\n\r\n  var animation = this.animationsMap[name];\r\n\r\n  if (animation) {\r\n\r\n    duration = animation.duration;\r\n\r\n  }\r\n\r\n  return duration;\r\n\r\n};\r\n\r\nTHREE.MorphBlendMesh.prototype.playAnimation = function(name) {\r\n\r\n  var animation = this.animationsMap[name];\r\n\r\n  if (animation) {\r\n\r\n    animation.time = 0;\r\n    animation.active = true;\r\n\r\n  }\r\n  else {\r\n\r\n    THREE.warn(\"THREE.MorphBlendMesh: animation[\" + name + \"] undefined in .playAnimation()\");\r\n\r\n  }\r\n\r\n};\r\n\r\nTHREE.MorphBlendMesh.prototype.stopAnimation = function(name) {\r\n\r\n  var animation = this.animationsMap[name];\r\n\r\n  if (animation) {\r\n\r\n    animation.active = false;\r\n\r\n  }\r\n\r\n};\r\n\r\nTHREE.MorphBlendMesh.prototype.update = function(delta) {\r\n\r\n  for (var i = 0, il = this.animationsList.length; i < il; i++) {\r\n\r\n    var animation = this.animationsList[i];\r\n\r\n    if (!animation.active) continue;\r\n\r\n    var frameTime = animation.duration / animation.length;\r\n\r\n    animation.time += animation.direction * delta;\r\n\r\n    if (animation.mirroredLoop) {\r\n\r\n      if (animation.time > animation.duration || animation.time < 0) {\r\n\r\n        animation.direction *= -1;\r\n\r\n        if (animation.time > animation.duration) {\r\n\r\n          animation.time = animation.duration;\r\n          animation.directionBackwards = true;\r\n\r\n        }\r\n\r\n        if (animation.time < 0) {\r\n\r\n          animation.time = 0;\r\n          animation.directionBackwards = false;\r\n\r\n        }\r\n\r\n      }\r\n\r\n    }\r\n    else {\r\n\r\n      animation.time = animation.time % animation.duration;\r\n\r\n      if (animation.time < 0) animation.time += animation.duration;\r\n\r\n    }\r\n\r\n    var keyframe = animation.startFrame + THREE.Math.clamp(Math.floor(animation.time / frameTime), 0, animation.length - 1);\r\n    var weight = animation.weight;\r\n\r\n    if (keyframe !== animation.currentFrame) {\r\n\r\n      this.morphTargetInfluences[animation.lastFrame] = 0;\r\n      this.morphTargetInfluences[animation.currentFrame] = 1 * weight;\r\n\r\n      this.morphTargetInfluences[keyframe] = 0;\r\n\r\n      animation.lastFrame = animation.currentFrame;\r\n      animation.currentFrame = keyframe;\r\n\r\n    }\r\n\r\n    var mix = (animation.time % frameTime) / frameTime;\r\n\r\n    if (animation.directionBackwards) mix = 1 - mix;\r\n\r\n    this.morphTargetInfluences[animation.currentFrame] = mix * weight;\r\n    this.morphTargetInfluences[animation.lastFrame] = (1 - mix) * weight;\r\n\r\n  }\r\n\r\n};\r\n\r\n\r\n// Export the THREE object for **Node.js**, with\r\n// backwards-compatibility for the old `require()` API. If we're in\r\n// the browser, add `_` as a global object via a string identifier,\r\n// for Closure Compiler \"advanced\" mode.\r\nif (typeof exports !== 'undefined') {\r\n  if (typeof module !== 'undefined' && module.exports) {\r\n    exports = module.exports = THREE;\r\n  }\r\n  exports.THREE = THREE;\r\n}\r\nelse {\r\n  this['THREE'] = THREE;\r\n}\r\n\r\n","module.exports = {\r\n  Identifier: require('./components/Identifier.js'),\r\n  Position: require('./components/Position.js'),\r\n  Velocity: require('./components/Velocity.js'),\r\n  Jump: require('./components/Jump.js'),\r\n  Drawable: require('./components/Drawable.js'),\r\n  Expirable: require('./components/Expirable.js'),\r\n  CameraFollow: require('./components/CameraFollow.js'),\r\n  ShootDelay: require('./components/ShootDelay.js'),\r\n  OneTimeHit: require('./components/OneTimeHit.js'),\r\n  Hurt: require('./components/Hurt.js'),\r\n  Health: require('./components/Health.js'),\r\n  Bullet: require('./components/Bullet.js'),\r\n  AI: require('./components/Ai.js'),\r\n  Steaming: require('./components/Steaming.js'),\r\n  CameraPitch: require('./components/CameraPitch.js'),\r\n  Gun: require('./components/Gun.js')\r\n};\r\n\r\n","/**\r\n * b3\r\n * \r\n * Copyright (c) 2014 Renato de Pontes Pereira.\r\n *\r\n * Permission is hereby granted, free of charge, to any person obtaining a copy\r\n * of this software and associated documentation files (the \"Software\"), to \r\n * deal in the Software without restriction, including without limitation the \r\n * rights to use, copy, modify, merge, publish, distribute, sublicense, and/or\r\n * sell copies of the Software, and to permit persons to whom the Software is \r\n * furnished to do so, subject to the following conditions:\r\n *\r\n * The above copyright notice and this permission notice shall be included in\r\n * all copies or substantial portions of the Software.\r\n *\r\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, \r\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER \r\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING \r\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS\r\n * IN THE SOFTWARE.\r\n **/\r\n\r\nvar b3 = b3 || {};\r\n\r\nmodule.exports = b3;\r\n\r\n/**\r\n * Behavior3JS\r\n * ===========\r\n *\r\n * * * *\r\n * \r\n * **Behavior3JS** is a Behavior Tree library written in JavaScript. It \r\n * provides structures and algorithms that assist you in the task of creating \r\n * intelligent agents for your game or application. Check it out some features \r\n * of Behavior3JS:\r\n * \r\n * - Based on the work of (Marzinotto et al., 2014), in which they propose a \r\n *   **formal**, **consistent** and **general** definition of Behavior Trees;\r\n * - **Optimized to control multiple agents**: you can use a single behavior \r\n *   tree instance to handle hundreds of agents;\r\n * - It was **designed to load and save trees in a JSON format**, in order to \r\n *   use, edit and test it in multiple environments, tools and languages;\r\n * - A **cool visual editor** which you can access online;\r\n * - Several **composite, decorator and action nodes** available within the \r\n *   library. You still can define your own nodes, including composites and \r\n *   decorators;\r\n * - **Completely free**, the core module and the visual editor are all published\r\n *   under the MIT License, which means that you can use them for your open source\r\n *   and commercial projects;\r\n * - **Lightweight**, only 11.5KB!\r\n * \r\n * Visit http://behavior3js.guineashots.com to know more!\r\n *\r\n * \r\n * Core Classes and Functions\r\n * --------------------------\r\n * \r\n * This library include the following core structures...\r\n *\r\n * **Public:**\r\n * \r\n * - **BehaviorTree**: the structure that represents a Behavior Tree;\r\n * - **Blackboard**: represents a \"memory\" in an agent and is required to to \r\n *   run a `BehaviorTree`;\r\n * - **Composite**: base class for all composite nodes;\r\n * - **Decorator**: base class for all decorator nodes;\r\n * - **Action**: base class for all action nodes;\r\n * - **Condition**: base class for all condition nodes;\r\n *\r\n * **Internal:**\r\n * \r\n * \r\n * - **Tick**: used as container and tracking object through the tree during \r\n *   the tick signal;\r\n * - **BaseNode**: the base class that provide all common node features;\r\n * \r\n * *Some classes are used internally on Behavior3JS, but you may need to access\r\n * its functionalities eventually, specially the `Tick` object.*\r\n *\r\n * \r\n * Nodes Included \r\n * --------------\r\n *\r\n * **Composite Nodes**: \r\n * \r\n * - Sequence;\r\n * - Priority;\r\n * - MemSequence;\r\n * - MemPriority;\r\n * \r\n * \r\n * **Decorators**: \r\n * \r\n * - Inverter;\r\n * - Limiter\r\n * - MaxTime;\r\n * - Repeater;\r\n * - RepeaterUntilFailure;\r\n * - RepeaterUntilSuccess;\r\n *\r\n * \r\n * **Actions**:\r\n * \r\n * - Succeeder;\r\n * - Failer;\r\n * - Error;\r\n * - Runner;\r\n * - Wait.\r\n * \r\n * @module Behavior3JS\r\n * @main Behavior3JS\r\n **/\r\n\r\n(function() {\r\n  \"use strict\";\r\n\r\n  /**\r\n   * List of all constants in Behavior3JS.\r\n   *\r\n   * @class Constants\r\n   **/\r\n\r\n  /**\r\n   * Version of the library.\r\n   * \r\n   * @property VERSION\r\n   * @type {String}\r\n   */\r\n  b3.VERSION = '0.1.0';\r\n\r\n  /**\r\n   * Returned when a criterion has been met by a condition node or an action node\r\n   * has been completed successfully.\r\n   * \r\n   * @property SUCCESS\r\n   * @type {Integer}\r\n   */\r\n  b3.SUCCESS = 1;\r\n\r\n  /**\r\n   * Returned when a criterion has not been met by a condition node or an action \r\n   * node could not finish its execution for any reason.\r\n   * \r\n   * @property FAILURE\r\n   * @type {Integer}\r\n   */\r\n  b3.FAILURE = 2;\r\n\r\n  /**\r\n   * Returned when an action node has been initialized but is still waiting the \r\n   * its resolution.\r\n   * \r\n   * @property FAILURE\r\n   * @type {Integer}\r\n   */\r\n  b3.RUNNING = 3;\r\n\r\n  /**\r\n   * Returned when some unexpected error happened in the tree, probably by a \r\n   * programming error (trying to verify an undefined variable). Its use depends \r\n   * on the final implementation of the leaf nodes.\r\n   * \r\n   * @property ERROR\r\n   * @type {Integer}\r\n   */\r\n  b3.ERROR = 4;\r\n\r\n\r\n  /**\r\n   * Describes the node category as Composite.\r\n   * \r\n   * @property COMPOSITE\r\n   * @type {String}\r\n   */\r\n  b3.COMPOSITE = 'composite';\r\n\r\n  /**\r\n   * Describes the node category as Decorator.\r\n   * \r\n   * @property DECORATOR\r\n   * @type {String}\r\n   */\r\n  b3.DECORATOR = 'decorator';\r\n\r\n  /**\r\n   * Describes the node category as Action.\r\n   * \r\n   * @property ACTION\r\n   * @type {String}\r\n   */\r\n  b3.ACTION = 'action';\r\n\r\n  /**\r\n   * Describes the node category as Condition.\r\n   * \r\n   * @property CONDITION\r\n   * @type {String}\r\n   */\r\n  b3.CONDITION = 'condition';\r\n\r\n\r\n  /**\r\n   * List of internal and helper functions in Behavior3JS.\r\n   * \r\n   * @class Utils\r\n   **/\r\n\r\n\r\n  /**\r\n   * This function is used to create unique IDs for trees and nodes.\r\n   * \r\n   * (consult http://www.ietf.org/rfc/rfc4122.txt).\r\n   *\r\n   * @method createUUID\r\n   * @return {String} A unique ID.\r\n   **/\r\n  b3.createUUID = function() {\r\n    var s = [];\r\n    var hexDigits = \"0123456789abcdef\";\r\n    for (var i = 0; i < 36; i++) {\r\n      s[i] = hexDigits.substr(Math.floor(Math.random() * 0x10), 1);\r\n    }\r\n    // bits 12-15 of the time_hi_and_version field to 0010\r\n    s[14] = \"4\";\r\n\r\n    // bits 6-7 of the clock_seq_hi_and_reserved to 01\r\n    s[19] = hexDigits.substr((s[19] & 0x3) | 0x8, 1);\r\n\r\n    s[8] = s[13] = s[18] = s[23] = \"-\";\r\n\r\n    var uuid = s.join(\"\");\r\n    return uuid;\r\n  }\r\n\r\n  /**\r\n   * Class is a meta-factory function to create classes in JavaScript. It is a\r\n   * shortcut for the CreateJS syntax style. By default, the class created by \r\n   * this function have an initialize function (the constructor). Optionally, you\r\n   * can specify the inheritance by passing another class as parameter.\r\n   *\r\n   * By default, all classes created using this function, may receives only a\r\n   * settings parameter as argument. This pattern is commonly used by jQuery and \r\n   * its plugins.\r\n   *\r\n   * Usage\r\n   * -----\r\n   *\r\n   *     // Creating a simple class\r\n   *     var BaseClass = b3.Class();\r\n   *\r\n   *     // Using inheritance\r\n   *     var ChildClass = b3.Class(BaseClass);\r\n   *\r\n   *     // Defining the constructor\r\n   *     ChildClass.prototype.initialize = function(settings) { ... }\r\n   *\r\n   * @method Class\r\n   * @param {Object} [baseClass] The super class.\r\n   * @return {Object} A new class.\r\n   **/\r\n  b3.Class = function(baseClass) {\r\n    // create a new class\r\n    var cls = function(params) {\r\n      this.initialize(params);\r\n    }\r\n\r\n    // if base class is provided, inherit\r\n    if (baseClass) {\r\n      cls.prototype = new baseClass();\r\n      cls.prototype.constructor = cls;\r\n    }\r\n\r\n    // create initialize if does not exist on baseClass\r\n    cls.prototype.initialize = cls.prototype.initialize || function() {};\r\n\r\n    return cls;\r\n  }\r\n\r\n})();\r\n/**\r\n * Blackboard\r\n *\r\n * Copyright (c) 2014 Renato de Pontes Pereira.\r\n *\r\n * Permission is hereby granted, free of charge, to any person obtaining a copy\r\n * of this software and associated documentation files (the \"Software\"), to \r\n * deal in the Software without restriction, including without limitation the \r\n * rights to use, copy, modify, merge, publish, distribute, sublicense, and/or\r\n * sell copies of the Software, and to permit persons to whom the Software is \r\n * furnished to do so, subject to the following conditions:\r\n *\r\n * The above copyright notice and this permission notice shall be included in\r\n * all copies or substantial portions of the Software.\r\n *\r\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, \r\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER \r\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING \r\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS\r\n * IN THE SOFTWARE.\r\n **/\r\n\r\n/**\r\n * @module Behavior3JS\r\n **/\r\n\r\n// namespace:\r\nthis.b3 = this.b3 || {};\r\n\r\n(function() {\r\n  \"use strict\";\r\n\r\n  /**\r\n   * The Blackboard is the memory structure required by `BehaviorTree` and its \r\n   * nodes. It only have 2 public methods: `set` and `get`. These methods works \r\n   * in 3 different contexts: global, per tree, and per node per tree.\r\n   * \r\n   * Suppose you have two different trees controlling a single object with a \r\n   * single blackboard, then:\r\n   *\r\n   * - In the global context, all nodes will access the stored information. \r\n   * - In per tree context, only nodes sharing the same tree share the stored \r\n   *   information.\r\n   * - In per node per tree context, the information stored in the blackboard can\r\n   *   only be accessed by the same node that wrote the data.\r\n   *   \r\n   * The context is selected indirectly by the parameters provided to these \r\n   * methods, for example:\r\n   * \r\n   *     // getting/setting variable in global context\r\n   *     blackboard.set('testKey', 'value');\r\n   *     var value = blackboard.get('testKey');\r\n   *     \r\n   *     // getting/setting variable in per tree context\r\n   *     blackboard.set('testKey', 'value', tree.id);\r\n   *     var value = blackboard.get('testKey', tree.id);\r\n   *     \r\n   *     // getting/setting variable in per node per tree context\r\n   *     blackboard.set('testKey', 'value', tree.id, node.id);\r\n   *     var value = blackboard.get('testKey', tree.id, node.id);\r\n   * \r\n   * Note: Internally, the blackboard store these memories in different objects,\r\n   *  being the global on `_baseMemory`, the per tree on `_treeMemory` and the \r\n   *  per node per tree dynamically create inside the per tree memory (it is \r\n   *  accessed via `_treeMemory[id].nodeMemory`). Avoid to use these variables \r\n   *  manually, use `get` and `set` instead.\r\n   *  \r\n   * @class Blackboard\r\n   **/\r\n  var Blackboard = b3.Class();\r\n\r\n  var p = Blackboard.prototype;\r\n\r\n  /**\r\n   * Initialization method.\r\n   *\r\n   * @method initialize\r\n   * @constructor\r\n   **/\r\n  p.initialize = function() {\r\n    this._baseMemory = {};\r\n    this._treeMemory = {};\r\n  }\r\n\r\n  /**\r\n   * Internal method to retrieve the tree context memory. If the memory does\r\n   * not exist, this method creates it.\r\n   *\r\n   * @method _getTreeMemory\r\n   * @param {string} treeScope The id of the tree in scope.\r\n   * @returns {Object} The tree memory.\r\n   * @protected\r\n   **/\r\n  p._getTreeMemory = function(treeScope) {\r\n    if (!this._treeMemory[treeScope]) {\r\n      this._treeMemory[treeScope] = {\r\n        'nodeMemory': {},\r\n        'openNodes': [],\r\n        'traversalDepth': 0,\r\n        'traversalCycle': 0,\r\n      };\r\n    }\r\n    return this._treeMemory[treeScope];\r\n  };\r\n\r\n  /**\r\n   * Internal method to retrieve the node context memory, given the tree \r\n   * memory. If the memory does not exist, this method creates is.\r\n   *\r\n   * @method _getNodeMemory\r\n   * @param {String} treeMemory the tree memory.\r\n   * @param {String} nodeScope The id of the node in scope.\r\n   * @returns {Object} The node memory.\r\n   * @protected\r\n   **/\r\n  p._getNodeMemory = function(treeMemory, nodeScope) {\r\n    var memory = treeMemory['nodeMemory'];\r\n    if (!memory[nodeScope]) {\r\n      memory[nodeScope] = {};\r\n    }\r\n\r\n    return memory[nodeScope];\r\n  };\r\n\r\n  /**\r\n   * Internal method to retrieve the context memory. If treeScope and \r\n   * nodeScope are provided, this method returns the per node per tree \r\n   * memory. If only the treeScope is provided, it returns the per tree \r\n   * memory. If no parameter is provided, it returns the global memory. \r\n   * Notice that, if only nodeScope is provided, this method will still \r\n   * return the global memory.\r\n   *\r\n   * @method _getMemory\r\n   * @param {String} treeScope The id of the tree scope.\r\n   * @param {String} nodeScope The id of the node scope.\r\n   * @returns {Object} A memory object.\r\n   * @protected\r\n   **/\r\n  p._getMemory = function(treeScope, nodeScope) {\r\n    var memory = this._baseMemory;\r\n\r\n    if (treeScope) {\r\n      memory = this._getTreeMemory(treeScope);\r\n\r\n      if (nodeScope) {\r\n        memory = this._getNodeMemory(memory, nodeScope);\r\n      }\r\n    }\r\n\r\n    return memory;\r\n  };\r\n\r\n  /**\r\n   * Stores a value in the blackboard. If treeScope and nodeScope are \r\n   * provided, this method will save the value into the per node per tree \r\n   * memory. If only the treeScope is provided, it will save the value into \r\n   * the per tree memory. If no parameter is provided, this method will save \r\n   * the value into the global memory. Notice that, if only nodeScope is \r\n   * provided (but treeScope not), this method will still save the value into\r\n   * the global memory.\r\n   *\r\n   * @method set\r\n   * @param {String} key The key to be stored.\r\n   * @param {String} value The value to be stored.\r\n   * @param {String} treeScope The tree id if accessing the tree or node \r\n   *                           memory.\r\n   * @param {String} nodeScope The node id if accessing the node memory.\r\n   **/\r\n  p.set = function(key, value, treeScope, nodeScope) {\r\n    var memory = this._getMemory(treeScope, nodeScope);\r\n    memory[key] = value;\r\n  };\r\n\r\n  /**\r\n   * Retrieves a value in the blackboard. If treeScope and nodeScope are\r\n   * provided, this method will retrieve the value from the per node per tree\r\n   * memory. If only the treeScope is provided, it will retrieve the value\r\n   * from the per tree memory. If no parameter is provided, this method will\r\n   * retrieve from the global memory. If only nodeScope is provided (but\r\n   * treeScope not), this method will still try to retrieve from the global\r\n   * memory.\r\n   *\r\n   * @method get\r\n   * @param {String} key The key to be retrieved.\r\n   * @param {String} treeScope The tree id if accessing the tree or node \r\n   *                           memory.\r\n   * @param {String} nodeScope The node id if accessing the node memory.\r\n   * @returns {Object} The value stored or undefined.\r\n   **/\r\n  p.get = function(key, treeScope, nodeScope) {\r\n    var memory = this._getMemory(treeScope, nodeScope);\r\n    return memory[key];\r\n  };\r\n\r\n  b3.Blackboard = Blackboard;\r\n\r\n})();\r\n/**\r\n * Tick\r\n *\r\n * Copyright (c) 2014 Renato de Pontes Pereira.\r\n *\r\n * Permission is hereby granted, free of charge, to any person obtaining a copy\r\n * of this software and associated documentation files (the \"Software\"), to \r\n * deal in the Software without restriction, including without limitation the \r\n * rights to use, copy, modify, merge, publish, distribute, sublicense, and/or\r\n * sell copies of the Software, and to permit persons to whom the Software is \r\n * furnished to do so, subject to the following conditions:\r\n *\r\n * The above copyright notice and this permission notice shall be included in\r\n * all copies or substantial portions of the Software.\r\n *\r\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, \r\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER \r\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING \r\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS\r\n * IN THE SOFTWARE.\r\n **/\r\n\r\n/**\r\n * @module Behavior3JS\r\n **/\r\n\r\n// namespace:\r\nthis.b3 = this.b3 || {};\r\n\r\n(function() {\r\n  \"use strict\";\r\n\r\n  /**\r\n   * A new Tick object is instantiated every tick by BehaviorTree. It is passed \r\n   * as parameter to the nodes through the tree during the traversal.\r\n   * \r\n   * The role of the Tick class is to store the instances of tree, debug, target\r\n   * and blackboard. So, all nodes can access these informations.\r\n   * \r\n   * For internal uses, the Tick also is useful to store the open node after the \r\n   * tick signal, in order to let `BehaviorTree` to keep track and close them \r\n   * when necessary.\r\n   *\r\n   * This class also makes a bridge between nodes and the debug, passing the node\r\n   * state to the debug if the last is provided.\r\n   *\r\n   * @class Tick\r\n   **/\r\n  var Tick = b3.Class();\r\n\r\n  var p = Tick.prototype;\r\n\r\n  /**\r\n   * The tree reference.\r\n   * \r\n   * @property tree\r\n   * @type {b3.BehaviorTree}\r\n   * @readOnly\r\n   */\r\n\r\n  /**\r\n   * The debug reference.\r\n   * \r\n   * @property debug\r\n   * @type {Object}\r\n   * @readOnly\r\n   */\r\n\r\n  /**\r\n   * The target object reference.\r\n   * \r\n   * @property target\r\n   * @type {Object}\r\n   * @readOnly\r\n   */\r\n\r\n  /**\r\n   * The blackboard reference.\r\n   * \r\n   * @property blackboard\r\n   * @type {Blackboard}\r\n   * @readOnly\r\n   */\r\n\r\n  /**\r\n   * The list of open nodes. Update during the tree traversal.\r\n   * \r\n   * @property _openNodes\r\n   * @type {Array}\r\n   * @protected\r\n   * @readOnly\r\n   */\r\n\r\n  /**\r\n   * The number of nodes entered during the tick. Update during the tree \r\n   * traversal.\r\n   * \r\n   * @property _nodeCount\r\n   * @type {Integer}\r\n   * @protected\r\n   * @readOnly\r\n   */\r\n\r\n  /**\r\n   * Initialization method.\r\n   *\r\n   * @method initialize\r\n   * @constructor\r\n   **/\r\n  p.initialize = function() {\r\n    // set by BehaviorTree\r\n    this.tree = null;\r\n    this.debug = null;\r\n    this.target = null;\r\n    this.blackboard = null;\r\n\r\n    // updated during the tick signal\r\n    this._openNodes = [];\r\n    this._nodeCount = 0;\r\n  }\r\n\r\n  /**\r\n   * Called when entering a node (called by BaseNode).\r\n   *\r\n   * @method _enterNode\r\n   * @param {Object} node The node that called this method.\r\n   * @protected\r\n   **/\r\n  p._enterNode = function(node) {\r\n    this._nodeCount++;\r\n    this._openNodes.push(node);\r\n\r\n    // TODO: call debug here\r\n  }\r\n\r\n  /**\r\n   * Callback when opening a node (called by BaseNode). \r\n   *\r\n   * @method _openNode\r\n   * @param {Object} node The node that called this method.\r\n   * @protected\r\n   **/\r\n  p._openNode = function(node) {\r\n    // TODO: call debug here\r\n  }\r\n\r\n  /**\r\n   * Callback when ticking a node (called by BaseNode).\r\n   *\r\n   * @method _tickNode\r\n   * @param {Object} node The node that called this method.\r\n   * @protected\r\n   **/\r\n  p._tickNode = function(node) {\r\n    // TODO: call debug here\r\n  }\r\n\r\n  /**\r\n   * Callback when closing a node (called by BaseNode).\r\n   *\r\n   * @method _closeNode\r\n   * @param {Object} node The node that called this method.\r\n   * @protected\r\n   **/\r\n  p._closeNode = function(node) {\r\n    // TODO: call debug here\r\n    this._openNodes.pop();\r\n  }\r\n\r\n  /**\r\n   * Callback when exiting a node (called by BaseNode).\r\n   *\r\n   * @method _exitNode\r\n   * @param {Object} node The node that called this method.\r\n   * @protected\r\n   **/\r\n  p._exitNode = function(node) {\r\n    // TODO: call debug here\r\n  }\r\n\r\n  b3.Tick = Tick;\r\n\r\n})();\r\n/**\r\n * BehaviorTree\r\n *\r\n * Copyright (c) 2014 Renato de Pontes Pereira.\r\n *\r\n * Permission is hereby granted, free of charge, to any person obtaining a copy\r\n * of this software and associated documentation files (the \"Software\"), to \r\n * deal in the Software without restriction, including without limitation the \r\n * rights to use, copy, modify, merge, publish, distribute, sublicense, and/or\r\n * sell copies of the Software, and to permit persons to whom the Software is \r\n * furnished to do so, subject to the following conditions:\r\n *\r\n * The above copyright notice and this permission notice shall be included in\r\n * all copies or substantial portions of the Software.\r\n *\r\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, \r\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER \r\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING \r\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS\r\n * IN THE SOFTWARE.\r\n **/\r\n\r\n/**\r\n * @module Behavior3JS\r\n **/\r\n\r\n// namespace:\r\nthis.b3 = this.b3 || {};\r\n\r\n(function() {\r\n  \"use strict\";\r\n\r\n  /**\r\n   * The BehaviorTree class, as the name implies, represents the Behavior Tree \r\n   * structure.\r\n   * \r\n   * There are two ways to construct a Behavior Tree: by manually setting the \r\n   * root node, or by loading it from a data structure (which can be loaded from \r\n   * a JSON). Both methods are shown in the examples below and better explained \r\n   * in the user guide.\r\n   *\r\n   * The tick method must be called periodically, in order to send the tick \r\n   * signal to all nodes in the tree, starting from the root. The method \r\n   * `BehaviorTree.tick` receives a target object and a blackboard as parameters.\r\n   * The target object can be anything: a game agent, a system, a DOM object, \r\n   * etc. This target is not used by any piece of Behavior3JS, i.e., the target\r\n   * object will only be used by custom nodes.\r\n   * \r\n   * The blackboard is obligatory and must be an instance of `Blackboard`. This \r\n   * requirement is necessary due to the fact that neither `BehaviorTree` or any \r\n   * node will store the execution variables in its own object (e.g., the BT does\r\n   * not store the target, information about opened nodes or number of times the \r\n   * tree was called). But because of this, you only need a single tree instance \r\n   * to control multiple (maybe hundreds) objects.\r\n   * \r\n   * Manual construction of a Behavior Tree\r\n   * --------------------------------------\r\n   * \r\n   *     var tree = new b3.BehaviorTree();\r\n   *  \r\n   *     tree.root = new b3.Sequence({children:[\r\n   *         new b3.Priority({children:[\r\n   *             new MyCustomNode(),\r\n   *             new MyCustomNode()\r\n   *         ]}),\r\n   *         ...\r\n   *     ]});\r\n   *     \r\n   * \r\n   * Loading a Behavior Tree from data structure\r\n   * -------------------------------------------\r\n   * \r\n   *     var tree = new b3.BehaviorTree();\r\n   *\r\n   *     tree.load({\r\n   *         'title'       : 'Behavior Tree title'\r\n   *         'description' : 'My description'\r\n   *         'root'        : 'node-id-1'\r\n   *         'nodes'       : {\r\n   *             'node-id-1' : {\r\n   *                 'name'        : 'Priority', // this is the node type\r\n   *                 'title'       : 'Root Node', \r\n   *                 'description' : 'Description', \r\n   *                 'children'    : ['node-id-2', 'node-id-3'], \r\n   *             },\r\n   *             ...\r\n   *         }\r\n   *     })\r\n   *     \r\n   *\r\n   * @class BehaviorTree\r\n   **/\r\n  var BehaviorTree = b3.Class();\r\n\r\n  var p = BehaviorTree.prototype;\r\n\r\n  /**\r\n   * The tree id, must be unique. By default, created with `b3.createUUID`.\r\n   * \r\n   * @property id\r\n   * @type {String}\r\n   * @readOnly\r\n   */\r\n\r\n  /**\r\n   * The tree title.\r\n   *\r\n   * @property title\r\n   * @type {String}\r\n   */\r\n\r\n  /**\r\n   * Description of the tree.\r\n   *\r\n   * @property description\r\n   * @type {String}\r\n   */\r\n\r\n  /**\r\n   * A dictionary with (key-value) properties. Useful to define custom \r\n   * variables in the visual editor.\r\n   *\r\n   * @property properties\r\n   * @type {Object}\r\n   */\r\n\r\n  /**\r\n   * The reference to the root node. Must be an instance of `b3.BaseNode`.\r\n   *\r\n   * @property root\r\n   * @type {BaseNode}\r\n   */\r\n\r\n  /**\r\n   * The reference to the debug instance.\r\n   *\r\n   * @property debug\r\n   * @type {Object}\r\n   */\r\n\r\n  /**\r\n   * Initialization method.\r\n   *\r\n   * @method initialize\r\n   * @constructor\r\n   **/\r\n  p.initialize = function() {\r\n    this.id = b3.createUUID();\r\n    this.title = 'The behavior tree';\r\n    this.description = 'Default description';\r\n    this.properties = {};\r\n    this.root = null;\r\n    this.debug = null;\r\n  }\r\n\r\n  /**\r\n   * This method loads a Behavior Tree from a data structure, populating this\r\n   * object with the provided data. Notice that, the data structure must \r\n   * follow the format specified by Behavior3JS. Consult the guide to know \r\n   * more about this format.\r\n   *\r\n   * You probably want to use custom nodes in your BTs, thus, you need to \r\n   * provide the `names` object, in which this method can find the nodes by \r\n   * `names[NODE_NAME]`. This variable can be a namespace or a dictionary, \r\n   * as long as this method can find the node by its name, for example:\r\n   *\r\n   *     //json\r\n   *     ...\r\n   *     'node1': {\r\n   *       'name': MyCustomNode,\r\n   *       'title': ...\r\n   *     }\r\n   *     ...\r\n   *     \r\n   *     //code\r\n   *     var bt = new b3.BehaviorTree();\r\n   *     bt.load(data, {'MyCustomNode':MyCustomNode})\r\n   *     \r\n   * \r\n   * @method load\r\n   * @param {Object} data The data structure representing a Behavior Tree.\r\n   * @param {Object} [names] A namespace or dict containing custom nodes.\r\n   **/\r\n  p.load = function(data, names) {\r\n    names = names || {};\r\n\r\n    this.title = data.title || this.title;\r\n    this.description = data.description || this.description;\r\n    this.properties = data.properties || this.properties;\r\n\r\n    var nodes = {};\r\n    // Create the node list (without connection between them)\r\n    for (var id in data.nodes) {\r\n      var spec = data.nodes[id];\r\n\r\n      if (spec.name in names) {\r\n        // Look for the name in custom nodes\r\n        var cls = names[spec.name];\r\n      }\r\n      else if (spec.name in b3) {\r\n        // Look for the name in default nodes\r\n        var cls = b3[spec.name];\r\n      }\r\n      else {\r\n        // Invalid node name\r\n        throw EvalError('BehaviorTree.load: Invalid node name + \"' +\r\n          spec.name + '\".');\r\n      }\r\n\r\n      var node = new cls(spec.parameters);\r\n      node.id = spec.id || node.id;\r\n      node.title = spec.title || node.title;\r\n      node.description = spec.description || node.description;\r\n      node.properties = spec.properties || node.properties;\r\n      node.parameters = spec.parameters || node.parameters;\r\n\r\n      nodes[id] = node;\r\n    }\r\n\r\n    // Connect the nodes\r\n    for (var id in data.nodes) {\r\n      var spec = data.nodes[id];\r\n      var node = nodes[id];\r\n\r\n      if (node.category === b3.COMPOSITE && spec.children) {\r\n        for (var i = 0; i < spec.children.length; i++) {\r\n          var cid = spec.children[i];\r\n          node.children.push(nodes[cid]);\r\n        }\r\n      }\r\n      else if (node.category === b3.DECORATOR && spec.child) {\r\n        node.child = nodes[spec.child];\r\n      }\r\n    }\r\n\r\n    this.root = nodes[data.root];\r\n  };\r\n\r\n  /**\r\n   * This method dump the current BT into a data structure.\r\n   *\r\n   * Note: This method does not record the current node parameters. Thus, \r\n   * it may not be compatible with load for now.\r\n   * \r\n   * @method dump\r\n   * @returns {Object} A data object representing this tree.\r\n   **/\r\n  p.dump = function() {\r\n    var data = {};\r\n\r\n    data.title = this.title;\r\n    data.description = this.description;\r\n    data.root = (this.root) ? this.root.id : null;\r\n    data.properties = this.properties;\r\n    data.nodes = {};\r\n\r\n    if (!this.root) return data;\r\n\r\n    var stack = [this.root];\r\n    while (stack.length > 0) {\r\n      var node = stack.pop();\r\n\r\n      var spec = {};\r\n      spec.id = node.id;\r\n      spec.name = node.name;\r\n      spec.title = node.title;\r\n      spec.description = node.description;\r\n      spec.properties = node.properties;\r\n      spec.parameters = node.parameters;\r\n\r\n      if (node.category === b3.COMPOSITE && node.children) {\r\n        var children = []\r\n        for (var i = node.children.length - 1; i >= 0; i--) {\r\n          children.push(node.children[i].id);\r\n          stack.push(node.children[i]);\r\n        }\r\n        spec.children = children;\r\n      }\r\n      else if (node.category === b3.DECORATOR && node.child) {\r\n        stack.push(node.child);\r\n        spec.child = node.child.id;\r\n      }\r\n\r\n      data.nodes[node.id] = spec;\r\n    }\r\n\r\n    return data;\r\n  };\r\n\r\n  /**\r\n   * Propagates the tick signal through the tree, starting from the root.\r\n   * \r\n   * This method receives a target object of any type (Object, Array, \r\n   * DOMElement, whatever) and a `Blackboard` instance. The target object has\r\n   * no use at all for all Behavior3JS components, but surely is important \r\n   * for custom nodes. The blackboard instance is used by the tree and nodes \r\n   * to store execution variables (e.g., last node running) and is obligatory\r\n   * to be a `Blackboard` instance (or an object with the same interface).\r\n   * \r\n   * Internally, this method creates a Tick object, which will store the \r\n   * target and the blackboard objects.\r\n   * \r\n   * Note: BehaviorTree stores a list of open nodes from last tick, if these \r\n   * nodes weren't called after the current tick, this method will close them \r\n   * automatically.\r\n   * \r\n   * @method tick\r\n   * @param {Object} target A target object.\r\n   * @param {Blackboard} blackboard An instance of blackboard object.\r\n   * @returns {Constant} The tick signal state.\r\n   **/\r\n  p.tick = function(target, blackboard) {\r\n    if (!blackboard) {\r\n      throw 'The blackboard parameter is obligatory and must be an ' +\r\n      'instance of b3.Blackboard';\r\n    }\r\n\r\n    /* CREATE A TICK OBJECT */\r\n    var tick = new b3.Tick();\r\n    tick.debug = this.debug;\r\n    tick.target = target;\r\n    tick.blackboard = blackboard;\r\n    tick.tree = this;\r\n\r\n    /* TICK NODE */\r\n    var state = this.root._execute(tick);\r\n\r\n    /* CLOSE NODES FROM LAST TICK, IF NEEDED */\r\n    var lastOpenNodes = blackboard.get('openNodes', this.id);\r\n    var currOpenNodes = tick._openNodes.slice(0);\r\n\r\n    // does not close if it is still open in this tick\r\n    var start = 0;\r\n    for (var i = 0; i < Math.min(lastOpenNodes.length, currOpenNodes.length); i++) {\r\n      start = i + 1;\r\n      if (lastOpenNodes[i] !== currOpenNodes[i]) {\r\n        break;\r\n      }\r\n    }\r\n\r\n    // close the nodes\r\n    for (var i = lastOpenNodes.length - 1; i >= start; i--) {\r\n      lastOpenNodes[i]._close(tick);\r\n    }\r\n\r\n    /* POPULATE BLACKBOARD */\r\n    blackboard.set('openNodes', currOpenNodes, this.id);\r\n    blackboard.set('nodeCount', tick._nodeCount, this.id);\r\n\r\n    return state;\r\n  };\r\n\r\n\r\n  b3.BehaviorTree = BehaviorTree;\r\n\r\n})();\r\n/**\r\n * BaseNode\r\n *\r\n * Copyright (c) 2014 Renato de Pontes Pereira.\r\n *\r\n * Permission is hereby granted, free of charge, to any person obtaining a copy\r\n * of this software and associated documentation files (the \"Software\"), to \r\n * deal in the Software without restriction, including without limitation the \r\n * rights to use, copy, modify, merge, publish, distribute, sublicense, and/or\r\n * sell copies of the Software, and to permit persons to whom the Software is \r\n * furnished to do so, subject to the following conditions:\r\n *\r\n * The above copyright notice and this permission notice shall be included in\r\n * all copies or substantial portions of the Software.\r\n *\r\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, \r\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER \r\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING \r\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS\r\n * IN THE SOFTWARE.\r\n **/\r\n\r\n/**\r\n * @module Behavior3JS\r\n **/\r\n\r\n// namespace:\r\nthis.b3 = this.b3 || {};\r\n\r\n(function() {\r\n  \"use strict\";\r\n\r\n  /**\r\n   * The BaseNode class is used as super class to all nodes in BehaviorJS. It \r\n   * comprises all common variables and methods that a node must have to execute.\r\n   *\r\n   * **IMPORTANT:** Do not inherit from this class, use `b3.Composite`, \r\n   * `b3.Decorator`, `b3.Action` or `b3.Condition`, instead.\r\n   *\r\n   * The attributes are specially designed to serialization of the node in a JSON\r\n   * format. In special, the `parameters` attribute can be set into the visual \r\n   * editor (thus, in the JSON file), and it will be used as parameter on the \r\n   * node initialization at `BehaviorTree.load`.\r\n   * \r\n   * BaseNode also provide 5 callback methods, which the node implementations can\r\n   * override. They are `enter`, `open`, `tick`, `close` and `exit`. See their \r\n   * documentation to know more. These callbacks are called inside the `_execute`\r\n   * method, which is called in the tree traversal.\r\n   * \r\n   * @class BaseNode\r\n   **/\r\n  var BaseNode = b3.Class();\r\n\r\n  var p = BaseNode.prototype;\r\n\r\n  /**\r\n   * Node ID.\r\n   *\r\n   * @property id\r\n   * @type {String}\r\n   * @readonly\r\n   **/\r\n\r\n  /**\r\n   * Node name. Must be a unique identifier, preferable the same name of the \r\n   * class. You have to set the node name in the prototype.\r\n   *\r\n   * @property name\r\n   * @type {String}\r\n   * @readonly\r\n   **/\r\n  p.name = null;\r\n\r\n  /**\r\n   * Node category. Must be `b3.COMPOSITE`, `b3.DECORATOR`, `b3.ACTION` or \r\n   * `b3.CONDITION`. This is defined automatically be inheriting the \r\n   * correspondent class.\r\n   *\r\n   * @property category\r\n   * @type constant\r\n   * @readonly\r\n   **/\r\n  p.category = null;\r\n\r\n  /**\r\n   * Node title.\r\n   *\r\n   * @property title\r\n   * @type {String}\r\n   * @optional\r\n   * @readonly\r\n   **/\r\n  p.title = null;\r\n\r\n  /**\r\n   * Node description.\r\n   *\r\n   * @property description\r\n   * @type {String}\r\n   * @optional\r\n   * @readonly\r\n   **/\r\n  p.description = null;\r\n\r\n  /**\r\n   * A dictionary (key, value) describing the node parameters. Useful for \r\n   * defining parameter values in the visual editor. Note: this is only \r\n   * useful for nodes when loading trees from JSON files.\r\n   *\r\n   * @property parameters\r\n   * @type {Object}\r\n   * @readonly\r\n   **/\r\n  p.parameters = null;\r\n\r\n  /**\r\n   * A dictionary (key, value) describing the node properties. Useful for \r\n   * defining custom variables inside the visual editor.\r\n   *\r\n   * @property properties\r\n   * @type {Object}\r\n   * @readonly\r\n   **/\r\n  p.properties = null;\r\n\r\n  /**\r\n   * Initialization method.\r\n   *\r\n   * @method initialize\r\n   * @constructor\r\n   **/\r\n  p.initialize = function() {\r\n    this.id = b3.createUUID();\r\n    this.title = this.title || this.name;\r\n    this.description = '';\r\n    this.parameters = {};\r\n    this.properties = {};\r\n  }\r\n\r\n  /**\r\n   * This is the main method to propagate the tick signal to this node. This \r\n   * method calls all callbacks: `enter`, `open`, `tick`, `close`, and \r\n   * `exit`. It only opens a node if it is not already open. In the same \r\n   * way, this method only close a node if the node  returned a status \r\n   * different of `b3.RUNNING`.\r\n   *\r\n   * @method _execute\r\n   * @param {Tick} tick A tick instance.\r\n   * @returns {Constant} The tick state.\r\n   * @protected\r\n   **/\r\n  p._execute = function(tick) {\r\n    /* ENTER */\r\n    this._enter(tick);\r\n\r\n    /* OPEN */\r\n    if (!tick.blackboard.get('isOpen', tick.tree.id, this.id)) {\r\n      this._open(tick);\r\n    }\r\n\r\n    /* TICK */\r\n    var status = this._tick(tick);\r\n\r\n    /* CLOSE */\r\n    if (status !== b3.RUNNING) {\r\n      this._close(tick);\r\n    }\r\n\r\n    /* EXIT */\r\n    this._exit(tick);\r\n\r\n    return status;\r\n  }\r\n\r\n  /**\r\n   * Wrapper for enter method.\r\n   *\r\n   * @method _enter\r\n   * @param {Tick} tick A tick instance.\r\n   * @protected\r\n   **/\r\n  p._enter = function(tick) {\r\n    tick._enterNode(this);\r\n    this.enter(tick);\r\n  }\r\n\r\n  /**\r\n   * Wrapper for open method.\r\n   *\r\n   * @method _open\r\n   * @param {Tick} tick A tick instance.\r\n   * @protected\r\n   **/\r\n  p._open = function(tick) {\r\n    tick._openNode(this);\r\n    tick.blackboard.set('isOpen', true, tick.tree.id, this.id);\r\n    this.open(tick);\r\n  }\r\n\r\n  /**\r\n   * Wrapper for tick method.\r\n   *\r\n   * @method _tick\r\n   * @param {Tick} tick A tick instance.\r\n   * @returns {Constant} A state constant.\r\n   * @protected\r\n   **/\r\n  p._tick = function(tick) {\r\n    tick._tickNode(this);\r\n    return this.tick(tick);\r\n  }\r\n\r\n  /**\r\n   * Wrapper for close method.\r\n   *\r\n   * @method _close\r\n   * @param {Tick} tick A tick instance.\r\n   * @protected\r\n   **/\r\n  p._close = function(tick) {\r\n    tick._closeNode(this);\r\n    tick.blackboard.set('isOpen', false, tick.tree.id, this.id);\r\n    this.close(tick);\r\n  }\r\n\r\n  /**\r\n   * Wrapper for exit method.\r\n   *\r\n   * @method _exit\r\n   * @param {Tick} tick A tick instance.\r\n   * @protected\r\n   **/\r\n  p._exit = function(tick) {\r\n    tick._exitNode(this);\r\n    this.exit(tick);\r\n  }\r\n\r\n  /**\r\n   * Enter method, override this to use. It is called every time a node is \r\n   * asked to execute, before the tick itself.\r\n   *\r\n   * @method enter\r\n   * @param {Tick} tick A tick instance.\r\n   **/\r\n  p.enter = function(tick) {}\r\n\r\n  /**\r\n   * Open method, override this to use. It is called only before the tick \r\n   * callback and only if the not isn't closed.\r\n   *\r\n   * Note: a node will be closed if it returned `b3.RUNNING` in the tick.\r\n   *\r\n   * @method open\r\n   * @param {Tick} tick A tick instance.\r\n   **/\r\n  p.open = function(tick) {}\r\n\r\n  /**\r\n   * Tick method, override this to use. This method must contain the real \r\n   * execution of node (perform a task, call children, etc.). It is called\r\n   * every time a node is asked to execute.\r\n   *\r\n   * @method tick\r\n   * @param {Tick} tick A tick instance.\r\n   **/\r\n  p.tick = function(tick) {}\r\n\r\n  /**\r\n   * Close method, override this to use. This method is called after the tick\r\n   * callback, and only if the tick return a state different from \r\n   * `b3.RUNNING`.\r\n   *\r\n   * @method close\r\n   * @param {Tick} tick A tick instance.\r\n   **/\r\n  p.close = function(tick) {}\r\n\r\n  /**\r\n   * Exit method, override this to use. Called every time in the end of the \r\n   * execution.\r\n   *\r\n   * @method exit\r\n   * @param {Tick} tick A tick instance.\r\n   **/\r\n  p.exit = function(tick) {}\r\n\r\n  b3.BaseNode = BaseNode;\r\n\r\n})();\r\n/**\r\n * Action\r\n *\r\n * Copyright (c) 2014 Renato de Pontes Pereira.\r\n *\r\n * Permission is hereby granted, free of charge, to any person obtaining a copy\r\n * of this software and associated documentation files (the \"Software\"), to \r\n * deal in the Software without restriction, including without limitation the \r\n * rights to use, copy, modify, merge, publish, distribute, sublicense, and/or\r\n * sell copies of the Software, and to permit persons to whom the Software is \r\n * furnished to do so, subject to the following conditions:\r\n *\r\n * The above copyright notice and this permission notice shall be included in\r\n * all copies or substantial portions of the Software.\r\n *\r\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, \r\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER \r\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING \r\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS\r\n * IN THE SOFTWARE.\r\n **/\r\n\r\n/**\r\n * @module Behavior3JS\r\n **/\r\n\r\n// namespace:\r\nthis.b3 = this.b3 || {};\r\n\r\n(function() {\r\n  \"use strict\";\r\n\r\n  /**\r\n   * Action is the base class for all action nodes. Thus, if you want to \r\n   * create new custom action nodes, you need to inherit from this class. \r\n   *\r\n   * For example, take a look at the Runner action:\r\n   * \r\n   *     var Runner = b3.Class(b3.Action);\r\n   *     var p = Runner.prototype;\r\n   *     \r\n   *         p.name = 'Runner';\r\n   *     \r\n   *         p.tick = function(tick) {\r\n   *             return b3.RUNNING;\r\n   *         }\r\n   *\r\n   * @class Action\r\n   * @extends BaseNode\r\n   **/\r\n  var Action = b3.Class(b3.BaseNode);\r\n\r\n  var p = Action.prototype;\r\n\r\n  /**\r\n   * Node category. Default to `b3.ACTION`.\r\n   *\r\n   * @property category\r\n   * @type {String}\r\n   * @readonly\r\n   **/\r\n  p.category = b3.ACTION;\r\n\r\n  p.__BaseNode_initialize = p.initialize;\r\n  /**\r\n   * Initialization method.\r\n   *\r\n   * @method initialize\r\n   * @constructor\r\n   **/\r\n  p.initialize = function() {\r\n    this.__BaseNode_initialize();\r\n  }\r\n\r\n  b3.Action = Action;\r\n\r\n})();\r\n/**\r\n * Composite\r\n *\r\n * Copyright (c) 2014 Renato de Pontes Pereira.\r\n *\r\n * Permission is hereby granted, free of charge, to any person obtaining a copy\r\n * of this software and associated documentation files (the \"Software\"), to \r\n * deal in the Software without restriction, including without limitation the \r\n * rights to use, copy, modify, merge, publish, distribute, sublicense, and/or\r\n * sell copies of the Software, and to permit persons to whom the Software is \r\n * furnished to do so, subject to the following conditions:\r\n *\r\n * The above copyright notice and this permission notice shall be included in\r\n * all copies or substantial portions of the Software.\r\n *\r\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, \r\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER \r\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING \r\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS\r\n * IN THE SOFTWARE.\r\n **/\r\n\r\n/**\r\n * @module Behavior3JS\r\n **/\r\n\r\n// namespace:\r\nthis.b3 = this.b3 || {};\r\n\r\n(function() {\r\n  \"use strict\";\r\n\r\n  /**\r\n   * Composite is the base class for all composite nodes. Thus, if you want to \r\n   * create new custom composite nodes, you need to inherit from this class. \r\n   * \r\n   * When creating composite nodes, you will need to propagate the tick signal to\r\n   * the children nodes manually. To do that, override the `tick` method and call \r\n   * the `_execute` method on all nodes. For instance, take a look at how the \r\n   * Sequence node inherit this class and how it call its children:\r\n   *\r\n   *\r\n   *     // Inherit from Composite, using the util function Class.\r\n   *     var Sequence = b3.Class(b3.Composite);\r\n   *     var p = Sequence.prototype;\r\n   *\r\n   *         // Remember to set the name of the node. \r\n   *         p.name = 'Sequence';\r\n   *         \r\n   *         // Override the tick function\r\n   *         p.tick = function(tick) {\r\n   *\r\n   *             // Iterates over the children\r\n   *             for (var i=0; i<this.children.length; i++) {\r\n   *\r\n   *                 // Propagate the tick\r\n   *                 var status = this.children[i]._execute(tick);\r\n   * \r\n   *                 if (status !== b3.SUCCESS) {\r\n   *                     return status;\r\n   *                 }\r\n   *             }\r\n   *\r\n   *             return b3.SUCCESS;\r\n   *         }\r\n   *\r\n   * @class Composite\r\n   * @extends BaseNode\r\n   **/\r\n  var Composite = b3.Class(b3.BaseNode);\r\n\r\n  var p = Composite.prototype;\r\n\r\n  /**\r\n   * Node category. Default to `b3.COMPOSITE`.\r\n   *\r\n   * @property category\r\n   * @type {String}\r\n   * @readonly\r\n   **/\r\n  p.category = b3.COMPOSITE;\r\n\r\n  p.__BaseNode_initialize = p.initialize;\r\n  /**\r\n   * Initialization method.\r\n   *\r\n   * @method initialize\r\n   * @constructor\r\n   **/\r\n  p.initialize = function(settings) {\r\n    settings = settings || {};\r\n\r\n    this.__BaseNode_initialize();\r\n\r\n    this.children = (settings.children || []).slice(0);\r\n  };\r\n\r\n  b3.Composite = Composite;\r\n\r\n})();\r\n/**\r\n * Decorator\r\n *\r\n * Copyright (c) 2014 Renato de Pontes Pereira.\r\n *\r\n * Permission is hereby granted, free of charge, to any person obtaining a copy\r\n * of this software and associated documentation files (the \"Software\"), to \r\n * deal in the Software without restriction, including without limitation the \r\n * rights to use, copy, modify, merge, publish, distribute, sublicense, and/or\r\n * sell copies of the Software, and to permit persons to whom the Software is \r\n * furnished to do so, subject to the following conditions:\r\n *\r\n * The above copyright notice and this permission notice shall be included in\r\n * all copies or substantial portions of the Software.\r\n *\r\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, \r\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER \r\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING \r\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS\r\n * IN THE SOFTWARE.\r\n **/\r\n\r\n/**\r\n * @module Behavior3JS\r\n **/\r\n\r\n// namespace:\r\nthis.b3 = this.b3 || {};\r\n\r\n(function() {\r\n  \"use strict\";\r\n\r\n  /**\r\n   * Decorator is the base class for all decorator nodes. Thus, if you want to \r\n   * create new custom decorator nodes, you need to inherit from this class. \r\n   * \r\n   * When creating decorator nodes, you will need to propagate the tick signal to\r\n   * the child node manually, just like the composite nodes. To do that, override\r\n   * the `tick` method and call the `_execute` method on the child node. For \r\n   * instance, take a look at how the Inverter node inherit this class and how it\r\n   * call its children:\r\n   *\r\n   *\r\n   *     // Inherit from Decorator, using the util function Class.\r\n   *     var Inverter = b3.Class(b3.Decorator);\r\n   *     var p = Inverter.prototype;\r\n   *     \r\n   *         // Remember to set the name of the node. \r\n   *         p.name = 'Inverter';\r\n   *     \r\n   *         // Override the tick function\r\n   *         p.tick = function(tick) {\r\n   *             if (!this.child) {\r\n   *                 return b3.ERROR;\r\n   *             }\r\n   *     \r\n   *             // Propagate the tick\r\n   *             var status = this.child._execute(tick);\r\n   *     \r\n   *             if (status == b3.SUCCESS)\r\n   *                 status = b3.FAILURE;\r\n   *             else if (status == b3.FAILURE)\r\n   *                 status = b3.SUCCESS;\r\n   *     \r\n   *             return status;\r\n   *         };\r\n   *\r\n   * @class Decorator\r\n   * @extends BaseNode\r\n   **/\r\n  var Decorator = b3.Class(b3.BaseNode);\r\n\r\n  var p = Decorator.prototype;\r\n\r\n  /**\r\n   * Node category. Default to b3.DECORATOR.\r\n   *\r\n   * @property category\r\n   * @type {String}\r\n   * @readonly\r\n   **/\r\n  p.category = b3.DECORATOR;\r\n\r\n  p.__BaseNode_initialize = p.initialize;\r\n  /**\r\n   * Initialization method.\r\n   *\r\n   * @method initialize\r\n   * @constructor\r\n   **/\r\n  p.initialize = function(settings) {\r\n    settings = settings || {};\r\n\r\n    this.__BaseNode_initialize();\r\n\r\n    this.child = settings.child || null;\r\n  };\r\n\r\n  b3.Decorator = Decorator;\r\n\r\n})();\r\n/**\r\n * Condition\r\n *\r\n * Copyright (c) 2014 Renato de Pontes Pereira.\r\n *\r\n * Permission is hereby granted, free of charge, to any person obtaining a copy\r\n * of this software and associated documentation files (the \"Software\"), to \r\n * deal in the Software without restriction, including without limitation the \r\n * rights to use, copy, modify, merge, publish, distribute, sublicense, and/or\r\n * sell copies of the Software, and to permit persons to whom the Software is \r\n * furnished to do so, subject to the following conditions:\r\n *\r\n * The above copyright notice and this permission notice shall be included in\r\n * all copies or substantial portions of the Software.\r\n *\r\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, \r\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER \r\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING \r\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS\r\n * IN THE SOFTWARE.\r\n **/\r\n\r\n/**\r\n * @module Behavior3JS\r\n **/\r\n\r\n// namespace:\r\nthis.b3 = this.b3 || {};\r\n\r\n(function() {\r\n  \"use strict\";\r\n\r\n  /**\r\n   * Condition is the base class for all condition nodes. Thus, if you want to \r\n   * create new custom condition nodes, you need to inherit from this class. \r\n   *\r\n   * @class Condition\r\n   * @extends BaseNode\r\n   **/\r\n  var Condition = b3.Class(b3.BaseNode);\r\n\r\n  var p = Condition.prototype;\r\n\r\n  /**\r\n   * Node category. Default to `b3.CONDITION`.\r\n   *\r\n   * @property category\r\n   * @type {String}\r\n   * @readonly\r\n   **/\r\n  p.category = b3.CONDITION;\r\n\r\n  p.__BaseNode_initialize = p.initialize;\r\n  /**\r\n   * Initialization method.\r\n   *\r\n   * @method initialize\r\n   * @constructor\r\n   **/\r\n  p.initialize = function() {\r\n    this.__BaseNode_initialize();\r\n  }\r\n\r\n  b3.Condition = Condition;\r\n\r\n})();\r\n/**\r\n * Sequence\r\n *\r\n * Copyright (c) 2014 Renato de Pontes Pereira.\r\n *\r\n * Permission is hereby granted, free of charge, to any person obtaining a copy\r\n * of this software and associated documentation files (the \"Software\"), to \r\n * deal in the Software without restriction, including without limitation the \r\n * rights to use, copy, modify, merge, publish, distribute, sublicense, and/or\r\n * sell copies of the Software, and to permit persons to whom the Software is \r\n * furnished to do so, subject to the following conditions:\r\n *\r\n * The above copyright notice and this permission notice shall be included in\r\n * all copies or substantial portions of the Software.\r\n *\r\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, \r\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER \r\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING \r\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS\r\n * IN THE SOFTWARE.\r\n **/\r\n\r\n/**\r\n * @module Behavior3JS\r\n **/\r\n\r\n// namespace:\r\nthis.b3 = this.b3 || {};\r\n\r\n(function() {\r\n  \"use strict\";\r\n\r\n  /**\r\n   * The Sequence node ticks its children sequentially until one of them returns \r\n   * `FAILURE`, `RUNNING` or `ERROR`. If all children return the success state, \r\n   * the sequence also returns `SUCCESS`.\r\n   *\r\n   * @class Sequence\r\n   * @extends Composite\r\n   **/\r\n  var Sequence = b3.Class(b3.Composite);\r\n\r\n  var p = Sequence.prototype;\r\n\r\n  /**\r\n   * Node name. Default to `Sequence`.\r\n   *\r\n   * @property name\r\n   * @type {String}\r\n   * @readonly\r\n   **/\r\n  p.name = 'Sequence';\r\n\r\n  /**\r\n   * Tick method.\r\n   *\r\n   * @method tick\r\n   * @param {b3.Tick} tick A tick instance.\r\n   * @returns {Constant} A state constant.\r\n   **/\r\n  p.tick = function(tick) {\r\n    for (var i = 0; i < this.children.length; i++) {\r\n      var status = this.children[i]._execute(tick);\r\n\r\n      if (status !== b3.SUCCESS) {\r\n        return status;\r\n      }\r\n    }\r\n\r\n    return b3.SUCCESS;\r\n  }\r\n\r\n  b3.Sequence = Sequence;\r\n\r\n})();\r\n/**\r\n * Priority\r\n *\r\n * Copyright (c) 2014 Renato de Pontes Pereira.\r\n *\r\n * Permission is hereby granted, free of charge, to any person obtaining a copy\r\n * of this software and associated documentation files (the \"Software\"), to \r\n * deal in the Software without restriction, including without limitation the \r\n * rights to use, copy, modify, merge, publish, distribute, sublicense, and/or\r\n * sell copies of the Software, and to permit persons to whom the Software is \r\n * furnished to do so, subject to the following conditions:\r\n *\r\n * The above copyright notice and this permission notice shall be included in\r\n * all copies or substantial portions of the Software.\r\n *\r\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, \r\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER \r\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING \r\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS\r\n * IN THE SOFTWARE.\r\n **/\r\n\r\n/**\r\n * @module Behavior3JS\r\n **/\r\n\r\n// namespace:\r\nthis.b3 = this.b3 || {};\r\n\r\n(function() {\r\n  \"use strict\";\r\n\r\n  /**\r\n   * Priority ticks its children sequentially until one of them returns \r\n   * `SUCCESS`, `RUNNING` or `ERROR`. If all children return the failure state, \r\n   * the priority also returns `FAILURE`.\r\n   *\r\n   * @class Priority\r\n   * @extends Composite\r\n   **/\r\n  var Priority = b3.Class(b3.Composite);\r\n\r\n  var p = Priority.prototype\r\n\r\n  /**\r\n   * Node name. Default to `Priority`.\r\n   *\r\n   * @property name\r\n   * @type String\r\n   * @readonly\r\n   **/\r\n  p.name = 'Priority';\r\n\r\n  /**\r\n   * Tick method.\r\n   *\r\n   * @method tick\r\n   * @param {Tick} tick A tick instance.\r\n   * @returns {Constant} A state constant.\r\n   **/\r\n  p.tick = function(tick) {\r\n    for (var i = 0; i < this.children.length; i++) {\r\n      var status = this.children[i]._execute(tick);\r\n\r\n      if (status !== b3.FAILURE) {\r\n        return status;\r\n      }\r\n    }\r\n\r\n    return b3.FAILURE;\r\n  }\r\n\r\n  b3.Priority = Priority;\r\n\r\n})();\r\n/**\r\n * MemSequence\r\n *\r\n * Copyright (c) 2014 Renato de Pontes Pereira.\r\n *\r\n * Permission is hereby granted, free of charge, to any person obtaining a copy\r\n * of this software and associated documentation files (the \"Software\"), to \r\n * deal in the Software without restriction, including without limitation the \r\n * rights to use, copy, modify, merge, publish, distribute, sublicense, and/or\r\n * sell copies of the Software, and to permit persons to whom the Software is \r\n * furnished to do so, subject to the following conditions:\r\n *\r\n * The above copyright notice and this permission notice shall be included in\r\n * all copies or substantial portions of the Software.\r\n *\r\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, \r\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER \r\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING \r\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS\r\n * IN THE SOFTWARE.\r\n **/\r\n\r\n/**\r\n * @module Behavior3JS\r\n **/\r\n\r\n// namespace:\r\nthis.b3 = this.b3 || {};\r\n\r\n(function() {\r\n  \"use strict\";\r\n\r\n  /**\r\n   * MemSequence is similar to Sequence node, but when a child returns a \r\n   * `RUNNING` state, its index is recorded and in the next tick the MemPriority \r\n   * call the child recorded directly, without calling previous children again.\r\n   *\r\n   * @class MemPriority\r\n   * @extends Composite\r\n   **/\r\n  var MemSequence = b3.Class(b3.Composite);\r\n\r\n  var p = MemSequence.prototype\r\n\r\n  /**\r\n   * Node name. Default to `MemSequence`.\r\n   *\r\n   * @property name\r\n   * @type {String}\r\n   * @readonly\r\n   **/\r\n  p.name = 'MemSequence';\r\n\r\n  /**\r\n   * Open method.\r\n   *\r\n   * @method open\r\n   * @param {b3.Tick} tick A tick instance.\r\n   **/\r\n  p.open = function(tick) {\r\n    tick.blackboard.set('runningChild', 0, tick.tree.id, this.id);\r\n  }\r\n\r\n  /**\r\n   * Tick method.\r\n   *\r\n   * @method tick\r\n   * @param {b3.Tick} tick A tick instance.\r\n   * @returns {Constant} A state constant.\r\n   **/\r\n  p.tick = function(tick) {\r\n    var child = tick.blackboard.get('runningChild', tick.tree.id, this.id);\r\n    for (var i = child; i < this.children.length; i++) {\r\n      var status = this.children[i]._execute(tick);\r\n\r\n      if (status !== b3.SUCCESS) {\r\n        if (status === b3.RUNNING) {\r\n          tick.blackboard.set('runningChild', i, tick.tree.id, this.id);\r\n        }\r\n        return status;\r\n      }\r\n    }\r\n\r\n    return b3.SUCCESS;\r\n  }\r\n\r\n  b3.MemSequence = MemSequence;\r\n\r\n})();\r\n/**\r\n * MemPriority\r\n *\r\n * Copyright (c) 2014 Renato de Pontes Pereira.\r\n *\r\n * Permission is hereby granted, free of charge, to any person obtaining a copy\r\n * of this software and associated documentation files (the \"Software\"), to \r\n * deal in the Software without restriction, including without limitation the \r\n * rights to use, copy, modify, merge, publish, distribute, sublicense, and/or\r\n * sell copies of the Software, and to permit persons to whom the Software is \r\n * furnished to do so, subject to the following conditions:\r\n *\r\n * The above copyright notice and this permission notice shall be included in\r\n * all copies or substantial portions of the Software.\r\n *\r\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, \r\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER \r\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING \r\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS\r\n * IN THE SOFTWARE.\r\n **/\r\n\r\n/**\r\n * @module Behavior3JS\r\n **/\r\n\r\n// namespace:\r\nthis.b3 = this.b3 || {};\r\n\r\n(function() {\r\n  \"use strict\";\r\n\r\n  /**\r\n   * MemPriority is similar to Priority node, but when a child returns a \r\n   * `RUNNING` state, its index is recorded and in the next tick the, MemPriority \r\n   * calls the child recorded directly, without calling previous children again.\r\n   *\r\n   * @class MemPriority\r\n   * @extends Composite\r\n   **/\r\n  var MemPriority = b3.Class(b3.Composite);\r\n\r\n  var p = MemPriority.prototype;\r\n\r\n  /**\r\n   * Node name. Default to `MemPriority`.\r\n   *\r\n   * @property name\r\n   * @type {String}\r\n   * @readonly\r\n   **/\r\n  p.name = 'MemPriority';\r\n\r\n  /**\r\n   * Open method.\r\n   *\r\n   * @method open\r\n   * @param {b3.Tick} tick A tick instance.\r\n   **/\r\n  p.open = function(tick) {\r\n    tick.blackboard.set('runningChild', 0, tick.tree.id, this.id);\r\n  }\r\n\r\n  /**\r\n   * Tick method.\r\n   *\r\n   * @method tick\r\n   * @param {b3.Tick} tick A tick instance.\r\n   * @returns {Constant} A state constant.\r\n   **/\r\n  p.tick = function(tick) {\r\n    var child = tick.blackboard.get('runningChild', tick.tree.id, this.id);\r\n    for (var i = child; i < this.children.length; i++) {\r\n      var status = this.children[i]._execute(tick);\r\n\r\n      if (status !== b3.FAILURE) {\r\n        if (status === b3.RUNNING) {\r\n          tick.blackboard.set('runningChild', i, tick.tree.id, this.id);\r\n        }\r\n        return status;\r\n      }\r\n    }\r\n\r\n    return b3.FAILURE;\r\n  }\r\n\r\n  b3.MemPriority = MemPriority;\r\n\r\n})();\r\n/**\r\n * Inverter\r\n *\r\n * Copyright (c) 2014 Renato de Pontes Pereira.\r\n *\r\n * Permission is hereby granted, free of charge, to any person obtaining a copy\r\n * of this software and associated documentation files (the \"Software\"), to \r\n * deal in the Software without restriction, including without limitation the \r\n * rights to use, copy, modify, merge, publish, distribute, sublicense, and/or\r\n * sell copies of the Software, and to permit persons to whom the Software is \r\n * furnished to do so, subject to the following conditions:\r\n *\r\n * The above copyright notice and this permission notice shall be included in\r\n * all copies or substantial portions of the Software.\r\n *\r\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, \r\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER \r\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING \r\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS\r\n * IN THE SOFTWARE.\r\n **/\r\n\r\n/**\r\n * @module Behavior3JS\r\n **/\r\n\r\n// namespace:\r\nthis.b3 = this.b3 || {};\r\n\r\n(function() {\r\n  \"use strict\";\r\n\r\n  /**\r\n   * The Inverter decorator inverts the result of the child, returning `SUCCESS`\r\n   * for `FAILURE` and `FAILURE` for `SUCCESS`.\r\n   *\r\n   * @class Inverter\r\n   * @extends Decorator\r\n   **/\r\n  var Inverter = b3.Class(b3.Decorator);\r\n\r\n  var p = Inverter.prototype;\r\n\r\n  /**\r\n   * Node name. Default to `Inverter`.\r\n   *\r\n   * @property name\r\n   * @type {String}\r\n   * @readonly\r\n   **/\r\n  p.name = 'Inverter';\r\n\r\n  /**\r\n   * Tick method.\r\n   *\r\n   * @method tick\r\n   * @param {Tick} tick A tick instance.\r\n   * @returns {Constant} A state constant.\r\n   **/\r\n  p.tick = function(tick) {\r\n    if (!this.child) {\r\n      return b3.ERROR;\r\n    }\r\n\r\n    var status = this.child._execute(tick);\r\n\r\n    if (status == b3.SUCCESS)\r\n      status = b3.FAILURE;\r\n    else if (status == b3.FAILURE)\r\n      status = b3.SUCCESS;\r\n\r\n    return status;\r\n  };\r\n\r\n  b3.Inverter = Inverter;\r\n\r\n})();\r\n/**\r\n * Limiter\r\n *\r\n * Copyright (c) 2014 Renato de Pontes Pereira.\r\n *\r\n * Permission is hereby granted, free of charge, to any person obtaining a copy\r\n * of this software and associated documentation files (the \"Software\"), to \r\n * deal in the Software without restriction, including without limitation the \r\n * rights to use, copy, modify, merge, publish, distribute, sublicense, and/or\r\n * sell copies of the Software, and to permit persons to whom the Software is \r\n * furnished to do so, subject to the following conditions:\r\n *\r\n * The above copyright notice and this permission notice shall be included in\r\n * all copies or substantial portions of the Software.\r\n *\r\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, \r\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER \r\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING \r\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS\r\n * IN THE SOFTWARE.\r\n **/\r\n\r\n/**\r\n * @module Behavior3JS\r\n **/\r\n\r\n// namespace:\r\nthis.b3 = this.b3 || {};\r\n\r\n(function() {\r\n  \"use strict\";\r\n\r\n  /**\r\n   * This decorator limit the number of times its child can be called. After a\r\n   * certain number of times, the Limiter decorator returns `FAILURE` without \r\n   * executing the child.\r\n   *\r\n   * @class Limiter\r\n   * @extends Decorator\r\n   **/\r\n  var Limiter = b3.Class(b3.Decorator);\r\n\r\n  var p = Limiter.prototype;\r\n\r\n  /**\r\n   * Node name. Default to `Limiter`.\r\n   *\r\n   * @property name\r\n   * @type {String}\r\n   * @readonly\r\n   **/\r\n  p.name = 'Limiter';\r\n\r\n  /**\r\n   * Node parameters.\r\n   *\r\n   * @property parameters\r\n   * @type {String}\r\n   * @readonly\r\n   **/\r\n  p.parameters = {\r\n    'maxLoop': null\r\n  };\r\n\r\n  p.__Decorator_initialize = p.initialize;\r\n  /**\r\n   * Initialization method. \r\n   *\r\n   * Settings parameters:\r\n   *\r\n   * - **maxLoop** (*Integer*) Maximum number of repetitions.\r\n   * - **child** (*BaseNode*) The child node.\r\n   *\r\n   * @method initialize\r\n   * @param {Object} settings Object with parameters.\r\n   * @constructor\r\n   **/\r\n  p.initialize = function(settings) {\r\n    settings = settings || {};\r\n\r\n    this.__Decorator_initialize(settings);\r\n\r\n    if (!settings.maxLoop) {\r\n      throw \"maxLoop parameter in Limiter decorator is an obligatory \" +\r\n      \"parameter\";\r\n    }\r\n\r\n    this.maxLoop = settings.maxLoop;\r\n  }\r\n\r\n  /**\r\n   * Open method.\r\n   *\r\n   * @method open\r\n   * @param {Tick} tick A tick instance.\r\n   **/\r\n  p.open = function(tick) {\r\n    tick.blackboard.set('i', 0, tick.tree.id, this.id);\r\n  }\r\n\r\n  /**\r\n   * Tick method.\r\n   *\r\n   * @method tick\r\n   * @param {Tick} tick A tick instance.\r\n   * @returns {Constant} A state constant.\r\n   **/\r\n  p.tick = function(tick) {\r\n    if (!this.child) {\r\n      return b3.ERROR;\r\n    }\r\n\r\n    var i = tick.blackboard.get('i', tick.tree.id, this.id);\r\n\r\n    if (i < this.maxLoop) {\r\n      var status = this.child._execute(tick);\r\n\r\n      if (status == b3.SUCCESS || status == b3.FAILURE)\r\n        tick.blackboard.set('i', i + 1, tick.tree.id, this.id);\r\n\r\n      return status;\r\n    }\r\n\r\n    return b3.FAILURE;\r\n  }\r\n\r\n  b3.Limiter = Limiter;\r\n\r\n})();\r\n/**\r\n * MaxTime\r\n *\r\n * Copyright (c) 2014 Renato de Pontes Pereira.\r\n *\r\n * Permission is hereby granted, free of charge, to any person obtaining a copy\r\n * of this software and associated documentation files (the \"Software\"), to \r\n * deal in the Software without restriction, including without limitation the \r\n * rights to use, copy, modify, merge, publish, distribute, sublicense, and/or\r\n * sell copies of the Software, and to permit persons to whom the Software is \r\n * furnished to do so, subject to the following conditions:\r\n *\r\n * The above copyright notice and this permission notice shall be included in\r\n * all copies or substantial portions of the Software.\r\n *\r\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, \r\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER \r\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING \r\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS\r\n * IN THE SOFTWARE.\r\n **/\r\n\r\n/**\r\n * @module Behavior3JS\r\n **/\r\n\r\n// namespace:\r\nthis.b3 = this.b3 || {};\r\n\r\n(function() {\r\n  \"use strict\";\r\n\r\n  /**\r\n   * The MaxTime decorator limits the maximum time the node child can execute. \r\n   * Notice that it does not interrupt the execution itself (i.e., the child must\r\n   * be non-preemptive), it only interrupts the node after a `RUNNING` status.\r\n   *\r\n   * @class MaxTime\r\n   * @extends Decorator\r\n   **/\r\n  var MaxTime = b3.Class(b3.Decorator);\r\n\r\n  var p = MaxTime.prototype;\r\n\r\n  /**\r\n   * Node name. Default to `MaxTime`.\r\n   *\r\n   * @property name\r\n   * @type {String}\r\n   * @readonly\r\n   **/\r\n  p.name = 'MaxTime';\r\n\r\n  /**\r\n   * Node title. Default to `Max Time`.\r\n   *\r\n   * @property title\r\n   * @type {String}\r\n   * @readonly\r\n   **/\r\n  p.title = 'Max Time';\r\n\r\n  /**\r\n   * Node parameters.\r\n   *\r\n   * @property parameters\r\n   * @type {String}\r\n   * @readonly\r\n   **/\r\n  p.parameters = {\r\n    'maxTime': null\r\n  };\r\n\r\n  p.__Decorator_initialize = p.initialize;\r\n  /**\r\n   * Initialization method.\r\n   *\r\n   * Settings parameters:\r\n   *\r\n   * - **maxTime** (*Integer*) Maximum time a child can execute.\r\n   * - **child** (*BaseNode*) The child node.\r\n   *\r\n   * @method initialize\r\n   * @param {Object} settings Object with parameters.\r\n   * @constructor\r\n   **/\r\n  p.initialize = function(settings) {\r\n    settings = settings || {};\r\n\r\n    this.__Decorator_initialize(settings);\r\n\r\n    if (!settings.maxTime) {\r\n      throw \"maxTime parameter in MaxTime decorator is an obligatory \" +\r\n      \"parameter\";\r\n    }\r\n\r\n    this.maxTime = settings.maxTime;\r\n  };\r\n\r\n  /**\r\n   * Open method.\r\n   *\r\n   * @method open\r\n   * @param {Tick} tick A tick instance.\r\n   **/\r\n  p.open = function(tick) {\r\n    var startTime = (new Date()).getTime();\r\n    tick.blackboard.set('startTime', startTime, tick.tree.id, this.id);\r\n  };\r\n\r\n  /**\r\n   * Tick method.\r\n   *\r\n   * @method tick\r\n   * @param {Tick} tick A tick instance.\r\n   * @returns {Constant} A state constant.\r\n   **/\r\n  p.tick = function(tick) {\r\n    if (!this.child) {\r\n      return b3.ERROR;\r\n    }\r\n\r\n    var currTime = (new Date()).getTime();\r\n    var startTime = tick.blackboard.get('startTime', tick.tree.id, this.id);\r\n\r\n    var status = this.child._execute(tick);\r\n    if (currTime - startTime > this.maxTime) {\r\n      return b3.FAILURE;\r\n    }\r\n\r\n    return status;\r\n  };\r\n\r\n  b3.MaxTime = MaxTime;\r\n\r\n})();\r\n/**\r\n * Repeater\r\n *\r\n * Copyright (c) 2014 Renato de Pontes Pereira.\r\n *\r\n * Permission is hereby granted, free of charge, to any person obtaining a copy\r\n * of this software and associated documentation files (the \"Software\"), to \r\n * deal in the Software without restriction, including without limitation the \r\n * rights to use, copy, modify, merge, publish, distribute, sublicense, and/or\r\n * sell copies of the Software, and to permit persons to whom the Software is \r\n * furnished to do so, subject to the following conditions:\r\n *\r\n * The above copyright notice and this permission notice shall be included in\r\n * all copies or substantial portions of the Software.\r\n *\r\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, \r\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER \r\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING \r\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS\r\n * IN THE SOFTWARE.\r\n **/\r\n\r\n/**\r\n * @module Behavior3JS\r\n **/\r\n\r\n// namespace:\r\nthis.b3 = this.b3 || {};\r\n\r\n(function() {\r\n  \"use strict\";\r\n\r\n  /**\r\n   * Repeater is a decorator that repeats the tick signal until the child node \r\n   * return `RUNNING` or `ERROR`. Optionally, a maximum number of repetitions \r\n   * can be defined.\r\n   *\r\n   * @class Repeater\r\n   * @extends Decorator\r\n   **/\r\n  var Repeater = b3.Class(b3.Decorator);\r\n\r\n  var p = Repeater.prototype;\r\n\r\n  /**\r\n   * Node name. Default to `Repeater`.\r\n   *\r\n   * @property name\r\n   * @type {String}\r\n   * @readonly\r\n   **/\r\n  p.name = 'Repeater';\r\n\r\n  /**\r\n   * Node parameters.\r\n   *\r\n   * @property parameters\r\n   * @type {String}\r\n   * @readonly\r\n   **/\r\n  p.parameters = {\r\n    'maxLoop': -1\r\n  };\r\n\r\n  p.__Decorator_initialize = p.initialize;\r\n  /**\r\n   * Initialization method.\r\n   *\r\n   * Settings parameters:\r\n   *\r\n   * - **maxLoop** (*Integer*) Maximum number of repetitions. Default to -1 \r\n   *                           (infinite).\r\n   * - **child** (*BaseNode*) The child node.\r\n   * \r\n   * @method initialize\r\n   * @param {Object} settings Object with parameters.\r\n   * @constructor\r\n   **/\r\n  p.initialize = function(settings) {\r\n    settings = settings || {};\r\n\r\n    this.__Decorator_initialize(settings);\r\n\r\n    this.maxLoop = settings.maxLoop || -1;\r\n  };\r\n\r\n  /**\r\n   * Open method.\r\n   *\r\n   * @method open\r\n   * @param {Tick} tick A tick instance.\r\n   **/\r\n  p.open = function(tick) {\r\n    tick.blackboard.set('i', 0, tick.tree.id, this.id);\r\n  };\r\n\r\n  /**\r\n   * Tick method.\r\n   *\r\n   * @method tick\r\n   * @param {Tick} tick A tick instance.\r\n   **/\r\n  p.tick = function(tick) {\r\n    if (!this.child) {\r\n      return b3.ERROR;\r\n    }\r\n\r\n    var i = tick.blackboard.get('i', tick.tree.id, this.id);\r\n    var status = b3.SUCCESS;\r\n\r\n    while (this.maxLoop < 0 || i < this.maxLoop) {\r\n      status = this.child._execute(tick);\r\n\r\n      if (status == b3.SUCCESS || status == b3.FAILURE)\r\n        i++;\r\n      else\r\n        break;\r\n    }\r\n\r\n    i = tick.blackboard.set('i', i, tick.tree.id, this.id);\r\n    return status;\r\n  };\r\n\r\n  b3.Repeater = Repeater;\r\n\r\n})();\r\n/**\r\n * RepeatUntilFailure\r\n *\r\n * Copyright (c) 2014 Renato de Pontes Pereira.\r\n *\r\n * Permission is hereby granted, free of charge, to any person obtaining a copy\r\n * of this software and associated documentation files (the \"Software\"), to \r\n * deal in the Software without restriction, including without limitation the \r\n * rights to use, copy, modify, merge, publish, distribute, sublicense, and/or\r\n * sell copies of the Software, and to permit persons to whom the Software is \r\n * furnished to do so, subject to the following conditions:\r\n *\r\n * The above copyright notice and this permission notice shall be included in\r\n * all copies or substantial portions of the Software.\r\n *\r\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, \r\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER \r\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING \r\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS\r\n * IN THE SOFTWARE.\r\n **/\r\n\r\n/**\r\n * @module Behavior3JS\r\n **/\r\n\r\n// namespace:\r\nthis.b3 = this.b3 || {};\r\n\r\n(function() {\r\n  \"use strict\";\r\n\r\n  /**\r\n   * RepeatUntilFailure is a decorator that repeats the tick signal until the \r\n   * node child returns `FAILURE`, `RUNNING` or `ERROR`. Optionally, a maximum \r\n   * number of repetitions can be defined.\r\n   *\r\n   * @class RepeatUntilFailure\r\n   * @extends Decorator\r\n   **/\r\n  var RepeatUntilFailure = b3.Class(b3.Decorator);\r\n\r\n  var p = RepeatUntilFailure.prototype;\r\n\r\n  /**\r\n   * Node name. Default to `RepeatUntilFailure`.\r\n   *\r\n   * @property name\r\n   * @type {String}\r\n   * @readonly\r\n   **/\r\n  p.name = 'RepeatUntilFailure';\r\n\r\n  /**\r\n   * Node title. Default to `Repeat Until Failure`.\r\n   *\r\n   * @property title\r\n   * @type {String}\r\n   * @readonly\r\n   **/\r\n  p.title = 'Repeat Until Failure';\r\n\r\n  /**\r\n   * Node parameters.\r\n   *\r\n   * @property parameters\r\n   * @type {String}\r\n   * @readonly\r\n   **/\r\n  p.parameters = {\r\n    'maxLoop': -1\r\n  };\r\n\r\n  p.__Decorator_initialize = p.initialize;\r\n  /**\r\n   * Initialization method.\r\n   *\r\n   * Settings parameters:\r\n   *\r\n   * - **maxLoop** (*Integer*) Maximum number of repetitions. Default to -1 \r\n   *                           (infinite).\r\n   * - **child** (*BaseNode*) The child node.\r\n   *\r\n   * @method initialize\r\n   * @param {Object} settings Object with parameters.\r\n   * @constructor\r\n   **/\r\n  p.initialize = function(settings) {\r\n    settings = settings || {};\r\n\r\n    this.__Decorator_initialize(settings);\r\n\r\n    this.maxLoop = settings.maxLoop || -1;\r\n  }\r\n\r\n  /**\r\n   * Open method.\r\n   *\r\n   * @method open\r\n   * @param {Tick} tick A tick instance.\r\n   **/\r\n  p.open = function(tick) {\r\n    tick.blackboard.set('i', 0, tick.tree.id, this.id);\r\n  }\r\n\r\n  /**\r\n   * Tick method.\r\n   *\r\n   * @method tick\r\n   * @param {Tick} tick A tick instance.\r\n   * @returns {Constant} A state constant.\r\n   **/\r\n  p.tick = function(tick) {\r\n    if (!this.child) {\r\n      return b3.ERROR;\r\n    }\r\n\r\n    var i = tick.blackboard.get('i', tick.tree.id, this.id);\r\n\r\n    while (this.maxLoop < 0 || i < this.maxLoop) {\r\n      var status = this.child._execute(tick);\r\n\r\n      if (status == b3.SUCCESS)\r\n        i++;\r\n      else\r\n        break;\r\n    }\r\n\r\n    var i = tick.blackboard.set('i', i, tick.tree.id, this.id);\r\n    return status;\r\n  }\r\n\r\n  b3.RepeatUntilFailure = RepeatUntilFailure;\r\n\r\n})();\r\n/**\r\n * RepeatUntilSuccess\r\n *\r\n * Copyright (c) 2014 Renato de Pontes Pereira.\r\n *\r\n * Permission is hereby granted, free of charge, to any person obtaining a copy\r\n * of this software and associated documentation files (the \"Software\"), to \r\n * deal in the Software without restriction, including without limitation the \r\n * rights to use, copy, modify, merge, publish, distribute, sublicense, and/or\r\n * sell copies of the Software, and to permit persons to whom the Software is \r\n * furnished to do so, subject to the following conditions:\r\n *\r\n * The above copyright notice and this permission notice shall be included in\r\n * all copies or substantial portions of the Software.\r\n *\r\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, \r\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER \r\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING \r\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS\r\n * IN THE SOFTWARE.\r\n **/\r\n\r\n/**\r\n * @module Behavior3JS\r\n **/\r\n\r\n// namespace:\r\nthis.b3 = this.b3 || {};\r\n\r\n(function() {\r\n  \"use strict\";\r\n\r\n  /**\r\n   * RepeatUntilSuccess is a decorator that repeats the tick signal until the \r\n   * node child returns `SUCCESS`, `RUNNING` or `ERROR`. Optionally, a maximum \r\n   * number of repetitions can be defined.\r\n   *\r\n   * @class RepeatUntilSuccess\r\n   * @extends Decorator\r\n   **/\r\n  var RepeatUntilSuccess = b3.Class(b3.Decorator);\r\n\r\n  var p = RepeatUntilSuccess.prototype;\r\n\r\n  /**\r\n   * Node name. Default to `RepeatUntilSuccess`.\r\n   *\r\n   * @property name\r\n   * @type {String}\r\n   * @readonly\r\n   **/\r\n  p.name = 'RepeatUntilSuccess';\r\n\r\n  /**\r\n   * Node title. Default to `Repeat Until Success`.\r\n   *\r\n   * @property title\r\n   * @type {String}\r\n   * @readonly\r\n   **/\r\n  p.title = 'Repeat Until Success';\r\n\r\n  /**\r\n   * Node parameters.\r\n   *\r\n   * @property parameters\r\n   * @type {String}\r\n   * @readonly\r\n   **/\r\n  p.parameters = {\r\n    'maxLoop': -1\r\n  };\r\n\r\n  p.__Decorator_initialize = p.initialize;\r\n  /**\r\n   * Initialization method.\r\n   *\r\n   * Settings parameters:\r\n   *\r\n   * - **maxLoop** (*Integer*) Maximum number of repetitions. Default to -1 \r\n   *                           (infinite).\r\n   * - **child** (*BaseNode*) The child node.\r\n   *\r\n   * @method initialize\r\n   * @param {Object} settings Object with parameters.\r\n   * @constructor\r\n   **/\r\n  p.initialize = function(settings) {\r\n    settings = settings || {};\r\n\r\n    this.__Decorator_initialize(settings);\r\n\r\n    this.maxLoop = settings.maxLoop || -1;\r\n  }\r\n\r\n  /**\r\n   * Open method.\r\n   *\r\n   * @method open\r\n   * @param {Tick} tick A tick instance.\r\n   **/\r\n  p.open = function(tick) {\r\n    tick.blackboard.set('i', 0, tick.tree.id, this.id);\r\n  }\r\n\r\n  /**\r\n   * Tick method.\r\n   *\r\n   * @method tick\r\n   * @param {Tick} tick A tick instance.\r\n   * @returns {Constant} A state constant.\r\n   **/\r\n  p.tick = function(tick) {\r\n    if (!this.child) {\r\n      return b3.ERROR;\r\n    }\r\n\r\n    var i = tick.blackboard.get('i', tick.tree.id, this.id);\r\n\r\n    while (this.maxLoop < 0 || i < this.maxLoop) {\r\n      var status = this.child._execute(tick);\r\n\r\n      if (status == b3.FAILURE)\r\n        i++;\r\n      else\r\n        break;\r\n    }\r\n\r\n    var i = tick.blackboard.set('i', i, tick.tree.id, this.id);\r\n    return status;\r\n  }\r\n\r\n  b3.RepeatUntilSuccess = RepeatUntilSuccess;\r\n\r\n})();\r\n/**\r\n * Error\r\n *\r\n * Copyright (c) 2014 Renato de Pontes Pereira.\r\n *\r\n * Permission is hereby granted, free of charge, to any person obtaining a copy\r\n * of this software and associated documentation files (the \"Software\"), to \r\n * deal in the Software without restriction, including without limitation the \r\n * rights to use, copy, modify, merge, publish, distribute, sublicense, and/or\r\n * sell copies of the Software, and to permit persons to whom the Software is \r\n * furnished to do so, subject to the following conditions:\r\n *\r\n * The above copyright notice and this permission notice shall be included in\r\n * all copies or substantial portions of the Software.\r\n *\r\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, \r\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER \r\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING \r\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS\r\n * IN THE SOFTWARE.\r\n **/\r\n\r\n/**\r\n * @module Behavior3JS\r\n **/\r\n\r\n// namespace:\r\nthis.b3 = this.b3 || {};\r\n\r\n(function() {\r\n  \"use strict\";\r\n\r\n  /**\r\n   * This action node returns `ERROR` always.\r\n   *\r\n   * @class Error\r\n   * @extends Action\r\n   **/\r\n  var Error = b3.Class(b3.Action);\r\n\r\n  var p = Error.prototype;\r\n\r\n  /**\r\n   * Node name. Default to `Error`.\r\n   *\r\n   * @property name\r\n   * @type {String}\r\n   * @readonly\r\n   **/\r\n  p.name = 'Error';\r\n\r\n  /**\r\n   * Tick method.\r\n   *\r\n   * @method tick\r\n   * @param {b3.Tick} tick A tick instance.\r\n   * @returns {Constant} Always return `b3.ERROR`.\r\n   **/\r\n  p.tick = function(tick) {\r\n    return b3.ERROR;\r\n  }\r\n\r\n  b3.Error = Error;\r\n\r\n})();\r\n/**\r\n * Failer\r\n *\r\n * Copyright (c) 2014 Renato de Pontes Pereira.\r\n *\r\n * Permission is hereby granted, free of charge, to any person obtaining a copy\r\n * of this software and associated documentation files (the \"Software\"), to \r\n * deal in the Software without restriction, including without limitation the \r\n * rights to use, copy, modify, merge, publish, distribute, sublicense, and/or\r\n * sell copies of the Software, and to permit persons to whom the Software is \r\n * furnished to do so, subject to the following conditions:\r\n *\r\n * The above copyright notice and this permission notice shall be included in\r\n * all copies or substantial portions of the Software.\r\n *\r\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, \r\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER \r\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING \r\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS\r\n * IN THE SOFTWARE.\r\n **/\r\n\r\n/**\r\n * @module Behavior3JS\r\n **/\r\n\r\n// namespace:\r\nthis.b3 = this.b3 || {};\r\n\r\n(function() {\r\n  \"use strict\";\r\n\r\n  /**\r\n   * This action node returns `FAILURE` always.\r\n   *\r\n   * @class Failer\r\n   * @extends Action\r\n   **/\r\n  var Failer = b3.Class(b3.Action);\r\n\r\n  var p = Failer.prototype;\r\n\r\n  /**\r\n   * Node name. Default to `Failer`.\r\n   *\r\n   * @property name\r\n   * @type {String}\r\n   * @readonly\r\n   **/\r\n  p.name = 'Failer';\r\n\r\n  /**\r\n   * Tick method.\r\n   *\r\n   * @method tick\r\n   * @param {b3.Tick} tick A tick instance.\r\n   * @returns {Constant} Always return `b3.FAILURE`.\r\n   **/\r\n  p.tick = function(tick) {\r\n    return b3.FAILURE;\r\n  }\r\n\r\n  b3.Failer = Failer;\r\n\r\n})();\r\n/**\r\n * Runner\r\n *\r\n * Copyright (c) 2014 Renato de Pontes Pereira.\r\n *\r\n * Permission is hereby granted, free of charge, to any person obtaining a copy\r\n * of this software and associated documentation files (the \"Software\"), to \r\n * deal in the Software without restriction, including without limitation the \r\n * rights to use, copy, modify, merge, publish, distribute, sublicense, and/or\r\n * sell copies of the Software, and to permit persons to whom the Software is \r\n * furnished to do so, subject to the following conditions:\r\n *\r\n * The above copyright notice and this permission notice shall be included in\r\n * all copies or substantial portions of the Software.\r\n *\r\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, \r\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER \r\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING \r\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS\r\n * IN THE SOFTWARE.\r\n **/\r\n\r\n/**\r\n * @module Behavior3JS\r\n **/\r\n\r\n// namespace:\r\nthis.b3 = this.b3 || {};\r\n\r\n(function() {\r\n  \"use strict\";\r\n\r\n  /**\r\n   * This action node returns RUNNING always.\r\n   *\r\n   * @class Runner\r\n   * @extends Action\r\n   **/\r\n  var Runner = b3.Class(b3.Action);\r\n\r\n  var p = Runner.prototype;\r\n\r\n  /**\r\n   * Node name. Default to `Runner`.\r\n   *\r\n   * @property name\r\n   * @type {String}\r\n   * @readonly\r\n   **/\r\n  p.name = 'Runner';\r\n\r\n  /**\r\n   * Tick method.\r\n   *\r\n   * @method tick\r\n   * @param {b3.Tick} tick A tick instance.\r\n   * @returns {Constant} Always return `b3.RUNNING`.\r\n   **/\r\n  p.tick = function(tick) {\r\n    return b3.RUNNING;\r\n  }\r\n\r\n  b3.Runner = Runner;\r\n\r\n})();\r\n/**\r\n * Succeeder\r\n *\r\n * Copyright (c) 2014 Renato de Pontes Pereira.\r\n *\r\n * Permission is hereby granted, free of charge, to any person obtaining a copy\r\n * of this software and associated documentation files (the \"Software\"), to \r\n * deal in the Software without restriction, including without limitation the \r\n * rights to use, copy, modify, merge, publish, distribute, sublicense, and/or\r\n * sell copies of the Software, and to permit persons to whom the Software is \r\n * furnished to do so, subject to the following conditions:\r\n *\r\n * The above copyright notice and this permission notice shall be included in\r\n * all copies or substantial portions of the Software.\r\n *\r\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, \r\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER \r\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING \r\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS\r\n * IN THE SOFTWARE.\r\n **/\r\n\r\n/**\r\n * @module Behavior3JS\r\n **/\r\n\r\n// namespace:\r\nthis.b3 = this.b3 || {};\r\n\r\n(function() {\r\n  \"use strict\";\r\n\r\n  /**\r\n   * This action node returns `SUCCESS` always.\r\n   *\r\n   * @class Succeeder\r\n   * @extends Action\r\n   **/\r\n  var Succeeder = b3.Class(b3.Action);\r\n\r\n  var p = Succeeder.prototype;\r\n\r\n  /**\r\n   * Node name. Default to `Succeeder`.\r\n   *\r\n   * @property name\r\n   * @type String\r\n   * @readonly\r\n   **/\r\n  p.name = 'Succeeder';\r\n\r\n  /**\r\n   * Tick method.\r\n   *\r\n   * @method tick\r\n   * @param {b3.Tick} tick A tick instance.\r\n   * @returns {Constant} Always return `b3.SUCCESS`.\r\n   **/\r\n  p.tick = function(tick) {\r\n    return b3.SUCCESS;\r\n  }\r\n\r\n  b3.Succeeder = Succeeder;\r\n\r\n})();\r\n/**\r\n * Wait\r\n *\r\n * Copyright (c) 2014 Renato de Pontes Pereira.\r\n *\r\n * Permission is hereby granted, free of charge, to any person obtaining a copy\r\n * of this software and associated documentation files (the \"Software\"), to \r\n * deal in the Software without restriction, including without limitation the \r\n * rights to use, copy, modify, merge, publish, distribute, sublicense, and/or\r\n * sell copies of the Software, and to permit persons to whom the Software is \r\n * furnished to do so, subject to the following conditions:\r\n *\r\n * The above copyright notice and this permission notice shall be included in\r\n * all copies or substantial portions of the Software.\r\n *\r\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, \r\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER \r\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING \r\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS\r\n * IN THE SOFTWARE.\r\n **/\r\n\r\n/**\r\n * @module Behavior3JS\r\n **/\r\n\r\n// namespace:\r\nthis.b3 = this.b3 || {};\r\n\r\n(function() {\r\n  \"use strict\";\r\n\r\n  /**\r\n   * Wait a few seconds.\r\n   *\r\n   * @class Wait\r\n   * @extends Action\r\n   **/\r\n  var Wait = b3.Class(b3.Action);\r\n\r\n  var p = Wait.prototype;\r\n\r\n  /**\r\n   * Node name. Default to `Wait`.\r\n   *\r\n   * @property name\r\n   * @type {String}\r\n   * @readonly\r\n   **/\r\n  p.name = 'Wait';\r\n\r\n  /**\r\n   * Node parameters.\r\n   *\r\n   * @property parameters\r\n   * @type {String}\r\n   * @readonly\r\n   **/\r\n  p.parameters = {\r\n    'milliseconds': 0\r\n  };\r\n\r\n  p.__Action_initialize = p.initialize;\r\n  /**\r\n   * Initialization method.\r\n   *\r\n   * Settings parameters:\r\n   *\r\n   * - **milliseconds** (*Integer*) Maximum time, in milliseconds, a child\r\n   *                                can execute.\r\n   *\r\n   * @method initialize\r\n   * @param {Object} settings Object with parameters.\r\n   * @constructor\r\n   **/\r\n  p.initialize = function(settings) {\r\n    settings = settings || {};\r\n\r\n    this.__Action_initialize();\r\n\r\n    this.endTime = settings.milliseconds || 0;\r\n  }\r\n\r\n  /**\r\n   * Open method.\r\n   *\r\n   * @method open\r\n   * @param {Tick} tick A tick instance.\r\n   **/\r\n  p.open = function(tick) {\r\n    var startTime = (new Date()).getTime();\r\n    tick.blackboard.set('startTime', startTime, tick.tree.id, this.id);\r\n  }\r\n\r\n  /**\r\n   * Tick method.\r\n   *\r\n   * @method tick\r\n   * @param {Tick} tick A tick instance.\r\n   * @returns {Constant} A state constant.\r\n   **/\r\n  p.tick = function(tick) {\r\n    var currTime = (new Date()).getTime();\r\n    var startTime = tick.blackboard.get('startTime', tick.tree.id, this.id);\r\n\r\n    if (currTime - startTime > this.endTime) {\r\n      return b3.SUCCESS;\r\n    }\r\n\r\n    return b3.RUNNING;\r\n  }\r\n\r\n  b3.Wait = Wait;\r\n\r\n})();\r\n\r\n","module.exports = {\n\n  Entity         : require('./lib/Entity.js'),\n  EntityManager  : require('./lib/EntityManager.js'),\n  Messanger      : require('./lib/Messanger.js'),\n  ObjectPool     : require('./lib/ObjectPool.js'),\n  QuadTree       : require('./lib/QuadTree.js'),\n  Spatial        : require('./lib/Spatial.js'),\n  Vec2           : require('./lib/Vec2.js')\n\n};\n","module.exports = Position;\r\n\r\nfunction Position() {\r\n  this.x = 0;\r\n  this.y = 0;\r\n  this.z = 0;\r\n}\r\n\r\n","module.exports = Velocity;\r\n\r\nfunction Velocity() {\r\n  this.x = 0;\r\n  this.y = 0;\r\n  this.z = 0;\r\n\r\n  this.rotationMatrix = null;\r\n}\r\n\r\n","module.exports = Identifier;\r\n\r\nfunction Identifier() {\r\n  this.type = null;\r\n}\r\n\r\n","module.exports = Drawable;\r\n\r\nfunction Drawable() {\r\n  this.mesh = null;\r\n  this.scene = null;\r\n}\r\n\r\n","module.exports = Jump;\r\n\r\nfunction Jump() {\r\n  this.canJump = true;\r\n}\r\n\r\n","module.exports = CameraFollow;\r\n\r\nfunction CameraFollow() {\r\n  this.controls = null;\r\n  this.object = null;\r\n  this.offset = new THREE.Vector3();\r\n}\r\n\r\n","module.exports = ShootDelay;\r\n\r\nfunction ShootDelay() {\r\n  this.canShoot = true;\r\n\r\n  this.timer = 0;\r\n  this.delayTheshold = 0.2;\r\n}\r\n\r\n","module.exports = Expirable;\r\n\r\nfunction Expirable() {\r\n  this.age = 0;\r\n  this.maxAge = 5;\r\n}\r\n\r\n","module.exports = Hurt;\r\n\r\nfunction Hurt() {\r\n  this.timer = 0;\r\n  this.invulnerabilityFrames = 1;\r\n\r\n  this.hurtColor = new THREE.Color(0xdd0000);\r\n  this.originalColor = 0xffffff;\r\n}\r\n\r\n","module.exports = OneTimeHit;\r\n\r\nfunction OneTimeHit() {\r\n  this.alreadyHit = [];\r\n}\r\n\r\n","module.exports = Ai;\r\n\r\nfunction Ai() {\r\n  this.tree = null;\r\n  this.target = null;\r\n  this.blackboard = null;\r\n}\r\n\r\n","module.exports = Steaming;\r\n\r\nfunction Steaming() {\r\n  this.particles = null;\r\n  this.system = null;\r\n  this.parent = null;\r\n  this.container = null;\r\n}\r\n\r\n","module.exports = CameraPitch;\r\n\r\nfunction CameraPitch() {\r\n  this.controls = null;\r\n  this.offset = 0;\r\n}\r\n\r\n","module.exports = Health;\r\n\r\nfunction Health() {\r\n  this.hp = 3;\r\n  this.maxHP = 3;\r\n\r\n  this.healthBar = null;\r\n\r\n  this.changed = false;\r\n}\r\n\r\n","module.exports = Gun;\r\n\r\nfunction Gun() {\r\n  this.entity = null;\r\n  this.mesh = null;\r\n}\r\n\r\n","module.exports = Bullet;\r\n\r\nfunction Bullet() {\r\n  this.isHot = true;\r\n  this.owner = null;\r\n}\r\n\r\n","module.exports = EntityManager;\n\nvar Entity     = require('./Entity.js');\nvar ObjectPool = require('./ObjectPool.js');\nvar Messanger  = require('./Messanger.js');\nvar getName    = require('typedef').getName;\n\n/**\n * Manage, create, and destroy entities. Can use methods to mutate entities\n * (tags, components) directly or via the facade on the Entity.\n * @param {Messanger} messanger\n * @constructor\n */\nfunction EntityManager(messanger)\n{\n  this.messanger = messanger;\n  this._tags = {};\n\n  /**\n   * @type {Array.<Entity>}\n   */\n  this._entities = [];\n\n  /**\n   * @type {Array.<Group>}\n   */\n  this._groups = {};\n\n  this._entityPool = new ObjectPool(Entity);\n\n  this._componentPools = {};\n}\n\n/**\n * Fired AFTER an entity has be created.\n * @event\n */\nEntityManager.ENTITY_CREATED = 'EntityManager#ENTITY_CREATED';\n\n/**\n * Fired BEFORE an entity has been removed.\n * @event\n */\nEntityManager.ENTITY_REMOVE = 'EntityManager#ENTITY_REMOVE';\n\n/**\n * Fired AFTER a component has been removed.\n * @event\n */\nEntityManager.COMPONENT_ADDED = 'EntityManager#COMPONENT_ADDED';\n\n/**\n * Fired BEFORE a component has been removedt\n * @event\n */\nEntityManager.COMPONENT_REMOVE = 'EntityManager#COMPONENT_REMOVE';\n\n/**\n * @constructor\n * @param {Array.<Function>} Components\n * @param {Array<Entity>} entities\n */\nfunction Group(Components, entities)\n{\n  this.Components = Components || [];\n  this.entities = entities || [];\n}\n\n/**\n * Get a new entity.\n * @return {Entity}\n */\nEntityManager.prototype.createEntity = function()\n{\n  var entity = this._entityPool.aquire();\n\n  this._entities.push(entity);\n  entity._manager = this;\n  this._trigger(EntityManager.ENTITY_CREATED, entity);\n  return entity;\n};\n\n/**\n * Cleanly remove entities based on tag. Avoids loop issues.\n * @param {String} tag\n */\nEntityManager.prototype.removeEntitiesByTag = function(tag)\n{\n  var entities = this._tags[tag];\n\n  if (!entities) return;\n\n  for (var x = entities.length - 1; x >= 0; x--) {\n    var entity = entities[x];\n    entity.remove();\n  }\n};\n\n/**\n * Dump all entities out of the manager. Avoids loop issues.\n */\nEntityManager.prototype.removeAllEntities = function()\n{\n  for (var x = this._entities.length - 1; x >= 0; x--) {\n    this._entities[x].remove();\n  }\n};\n\n/**\n * Drop an entity. Returns it to the pool and fires all events for removing\n * components as well.\n * @param {Entity} entity\n */\nEntityManager.prototype.removeEntity = function(entity)\n{\n  var index = this._entities.indexOf(entity);\n\n  if (!~index)\n    throw new Error('Tried to remove entity not in list');\n\n  this.entityRemoveAllComponents(entity);\n\n  // Remove from entity list\n  this._trigger(EntityManager.ENTITY_REMOVE, entity);\n  this._entities.splice(index, 1);\n\n  // Remove entity from any tag groups\n  entity._tags = null;\n  for (var tag in this._tags) {\n    var entities = this._tags[tag];\n    var n = entities.indexOf(entity);\n    if (~n) entities.splice(n, 1);\n  }\n\n  // Prevent any acecss and free\n  entity._manager = null;\n  this._entityPool.release(entity);\n};\n\n/**\n * @param {Entity} entity\n * @param {String} tag\n */\nEntityManager.prototype.entityAddTag = function(entity, tag)\n{\n  var entities = this._tags[tag];\n\n  if (!entities)\n    entities = this._tags[tag] = [];\n\n  // Don't add if already there\n  if (~entities.indexOf(entity)) return;\n\n  entities.push(entity);\n  entity._tags.push(tag);\n};\n\n/**\n * @param {Entity} entity\n * @param {String} tag\n */\nEntityManager.prototype.entityRemoveTag = function(entity, tag)\n{\n  var entities = this._tags[tag];\n  if (!entities) return;\n\n  var index = entities.indexOf(entity);\n  if (!~index) return;\n\n  entities.splice(index, 1);\n  entity._tags.splice(entity._tags.indexOf(tag), 1);\n};\n\n/**\n * @param {Entity} entity\n * @param {Function} Component\n */\nEntityManager.prototype.entityAddComponent = function(entity, Component)\n{\n  if (~entity._Components.indexOf(Component)) return;\n\n  entity._Components.push(Component);\n\n  // Create the reference on the entity to this (aquired) component\n  var cName = componentPropertyName(Component);\n  var cPool = this._componentPools[cName];\n  if (!cPool)\n    cPool = this._componentPools[cName] = new ObjectPool(Component);\n  var component = cPool.aquire();\n  entity[cName] = component;\n\n  // Check each indexed group to see if we need to add this entity to the list\n  for (var groupName in this._groups) {\n    var group = this._groups[groupName];\n\n    if (!~group.Components.indexOf(Component))\n      continue;\n    if (!entity.hasAllComponents(group.Components))\n      continue;\n    if (~group.entities.indexOf(entity))\n      continue;\n\n    group.entities.push(entity);\n  }\n\n  this._trigger(EntityManager.COMPONENT_ADDED, entity, Component);\n};\n\n/**\n * Drop all components on an entity.\n * @param {Entity} entity\n */\nEntityManager.prototype.entityRemoveAllComponents = function(entity)\n{\n  var Cs = entity._Components;\n\n  for (var j = Cs.length - 1; j >= 0; j--) {\n    var C = Cs[j];\n    entity.removeComponent(C);\n  }\n};\n\n/**\n * @param {Entity} entity\n * @param {Function} Component\n */\nEntityManager.prototype.entityRemoveComponent = function(entity, Component)\n{\n  var index = entity._Components.indexOf(Component);\n  if (!~index) return;\n\n  this._trigger(EntityManager.COMPONENT_REMOVE, entity, Component);\n\n  // Check each indexed group to see if we need to remove it\n  for (var groupName in this._groups) {\n    var group = this._groups[groupName];\n\n    if (!~group.Components.indexOf(Component))\n      continue;\n    if (!entity.hasAllComponents(group.Components))\n      continue;\n\n    var loc = group.entities.indexOf(entity);\n    if (~loc) {\n      group.entities.splice(loc, 1);\n    }\n  }\n\n  // Remove T listing on entity and property ref, then free the component.\n  var propName = componentPropertyName(Component);\n  entity._Components.splice(index, 1);\n  var component = entity[propName];\n  delete entity[propName];\n  this._componentPools[propName].release(component);\n};\n\n/**\n * @param {Array.<Function>} Components\n * @return {Array.<Entity>}\n */\nEntityManager.prototype.queryComponents = function(Components)\n{\n  var group = this._groups[groupKey(Components)];\n\n  if (!group) {\n    group = this._indexGroup(Components);\n  }\n\n  return group.entities;\n};\n\n/**\n * @param {String} tag\n * @return {Array.<Entity>}\n */\nEntityManager.prototype.queryTag = function(tag)\n{\n  var entities = this._tags[tag];\n\n  if (entities === undefined)\n    entities = this._tags[tag] = [];\n\n  return entities;\n};\n\n/**\n * @return {Number} Total number of entities.\n */\nEntityManager.prototype.count = function()\n{\n  return this._entities.length;\n};\n\n/**\n * Get information about the object pools of the entities and the various\n * components.\n * @return {Object}\n */\nEntityManager.prototype.poolStats = function()\n{\n  var stats = {};\n  var e = this._entityPool;\n  stats.entity = {\n    used: this._entityPool.totalUsed(),\n    size: this._entityPool.count\n  };\n\n  for (var cName in this._componentPools) {\n    var pool = this._componentPools[cName];\n    stats[cName] = {\n      used: pool.totalUsed(),\n      size: pool.count\n    };\n  }\n\n  return stats;\n};\n\n/**\n * Create an index of entities with a set of components.\n * @param {Array.<Function>} Components\n * @private\n */\nEntityManager.prototype._indexGroup = function(Components)\n{\n  var key = groupKey(Components);\n\n  if (this._groups[key]) return;\n\n  var group = this._groups[key] = new Group(Components);\n\n  for (var n = 0; n < this._entities.length; n++) {\n    var entity = this._entities[n];\n    if (entity.hasAllComponents(Components)) {\n      group.entities.push(entity);\n    }\n  }\n\n  return group;\n};\n\n/**\n * Trigger the messanger if we have one.\n * @param {String} event\n * @param {Object=} a\n * @param {Object=} b\n */\nEntityManager.prototype._trigger = function(event, a, b)\n{\n  if (this.messanger)\n    this.messanger.trigger(event, a, b);\n};\n\n/**\n * @param {Function} Component\n * @return {String}\n * @private\n */\nfunction componentPropertyName(Component)\n{\n  var name = getName(Component);\n  return name.charAt(0).toLowerCase() + name.slice(1);\n}\n\n/**\n * @param {Array.<Function>} Components\n * @return {String}\n * @private\n */\nfunction groupKey(Components)\n{\n  var names = [];\n  for (var n = 0; n < Components.length; n++) {\n    var T = Components[n];\n    names.push(getName(T));\n  }\n\n  return names\n    .map(function(x) { return x.toLowerCase(); })\n    .sort()\n    .join('-');\n}\n\n","module.exports = Entity;\n\n/**\n * Basic component-driven object with facade functions for interacting with the\n * injected EntityManager object.\n * @constructor\n */\nfunction Entity()\n{\n  // Injected by EntityManager\n  this._manager    = null;\n\n  /**\n   * @type {Array.<Function>}\n   * @private\n   */\n  this._Components = [];\n\n  /**\n   * @type {Array.<String>}\n   * @private\n   */\n  this._tags       = [];\n}\n\n/**\n * @param {Function} TComponent\n * @return {Entity} This entity.\n */\nEntity.prototype.addComponent = function(TComponent)\n{\n  this._manager.entityAddComponent(this, TComponent);\n  return this;\n};\n\n/**\n * @param {Function} TComponent\n * @return {Entity} This entity.\n */\nEntity.prototype.removeComponent = function(TComponent)\n{\n  this._manager.entityRemoveComponent(this, TComponent);\n  return this;\n};\n\n/**\n * @param {Function} TComponent\n * @return {boolean} True if this entity has TComponent.\n */\nEntity.prototype.hasComponent = function(TComponent)\n{\n  return !!~this._Components.indexOf(TComponent);\n};\n\n/**\n * @param {Array.<Function>} Components\n * @return {boolean} True if entity has all Components.\n */\nEntity.prototype.hasAllComponents = function(Components)\n{\n  var b = true;\n\n  for (var i = 0; i < Components.length; i++) {\n    var C = Components[i];\n    b &= !!~this._Components.indexOf(C);\n  }\n\n  return b;\n};\n\n/**\n * @param {String} tag\n * @return {boolean} True if entity has tag.\n */\nEntity.prototype.hasTag = function(tag)\n{\n  return !!~this._tags.indexOf(tag);\n};\n\n/**\n * @param {String} tag\n * @return {Entity} This entity.\n */\nEntity.prototype.addTag = function(tag)\n{\n  this._manager.entityAddTag(this, tag);\n  return this;\n};\n\n/**\n * @param {String} tag\n * @return {Entity} This entity.\n */\nEntity.prototype.removeTag = function(tag)\n{\n  this._manager.entityRemoveTag(this, tag);\n  return this;\n};\n\n/**\n * @return {void}\n */\nEntity.prototype.remove = function()\n{\n  return this._manager.removeEntity(this);\n};\n\n","module.exports = QuadTree;\n\nvar ObjectPool = require('./ObjectPool.js');\nvar Spatial    = require('./Spatial.js');\nvar Vec2       = require('./Vec2.js');\n\n/**\n * Effectively store positional and sized objects. Each tree has a position and\n * size, as well as up to 4 child nodes (other trees) and an array of entries.\n * @constructor\n */\nfunction QuadTree()\n{\n  this.level       = 0;\n  this.position    = new Vec2();\n  this.size        = new Vec2();\n  this.maxEntities = 15;\n  this.maxLevels   = 10;\n\n  /**\n   * Pool that is used for all internal quad trees. Only root node has one, all\n   * others have a refence.\n   */\n  this.pool = new ObjectPool(QuadTree);\n\n  /**\n   * @type {Array.<QuadTree>}\n   */\n  this.nodes = [];\n\n  /**\n   * @type {Array.<{spatial: Spatial}>}\n   */\n  this.entities = [];\n}\n\n/**\n * Reset for pool.\n * @private\n */\nQuadTree.prototype.__init = function()\n{\n  this.level = 0;\n  this.position.clear();\n  this.size.clear();\n  this.nodes.length = 0;\n  this.entities.length = 0;\n\n  // Only root node has actual ref to pool\n  this.pool = null;\n};\n\n/**\n * Add an entity to the tree\n * @param {{spatial: Spatial}} entity\n */\nQuadTree.prototype.insert = function(entity)\n{\n  // Recurse if we can\n  if (this.nodes.length) {\n    var index = this._getIndex(entity.spatial.absPosition(),\n      entity.spatial.absHwidth());\n    if (~index) return this.nodes[index].insert(entity);\n  }\n\n  // Actually add the entity\n  this.entities.push(entity);\n  this._splitAndRedistributeIfNeeded();\n  entity.spatial._node = this;\n  return entity;\n};\n\n/**\n * Remove an entity from this tree.\n * @param {{spatial: Spatial}} param\n */\nQuadTree.prototype.remove = function(entity)\n{\n  // Remove if we can\n  var n = this.entities.indexOf(entity);\n  if (~n) {\n    this.entities.splice(n, 1);\n    entity.spatial._node = null;\n    if (!this.totalSize())\n      this.clear();\n    return;\n  }\n\n  // Recuse if we can\n  if (this.nodes.length) {\n    var index = this._getIndex(entity.spatial.absPosition(),\n      entity.spatial.absHwidth());\n    if (~index) return this.nodes[index].remove(entity);\n  }\n};\n\n/**\n * Total recursive size of this tree.\n * @return {Number}\n */\nQuadTree.prototype.totalSize = function()\n{\n  var size = this.entities.length;\n\n  for (var n = 0; n < this.nodes.length; n++) {\n    var node = this.nodes[n];\n    size += node.totalSize();\n  }\n\n  return size;\n};\n\n/**\n * Empty the tree recursively.\n */\nQuadTree.prototype.clear = function()\n{\n  // Clear entity area\n  for (var m = 0; m < this.entities.length; m++) {\n    var entity = this.entities[m];\n    entity.spatial._node = null;\n  }\n  this.entities.length = 0;\n\n  // Recurse, free the node, and wipe out our node length\n  for (var n = 0; n < this.nodes.length; n++) {\n    var node = this.nodes[n];\n    node.clear();\n    this.pool.release(node);\n  }\n  this.nodes.length = 0;\n};\n\n/**\n * Get all tree entries that are interesected by a rectangle defined with\n * position and hwidth.\n * @param {Vec2} position\n * @param {Vec2} hwidth\n * @param {Array.<{spatial: Spatial}>=} out__objects Return objects.\n * @return {Array.<{spatial: Spatial}>} The out__objects parameter (filled up now)\n */\nQuadTree.prototype.queryArea = function(position, hwidth, out__entities)\n{\n  var entities = out__entities || [];\n\n  // If query belongs in ONLY a single node, then recurse\n  var index = this._getIndex(position, hwidth);\n  if (~index && this.nodes.length) {\n    this.nodes[index].queryArea(position, hwidth, entities);\n\n  // Otherwise, we have to add ALL of the nodes as it may be overlapping one\n  } else {\n    for (var j = 0; j < this.nodes.length; j++) {\n      var node = this.nodes[j];\n      node.queryArea(position, hwidth, entities);\n    }\n  }\n\n  // Also add everything from this node itself\n  for (var m = 0; m < this.entities.length; m++) {\n    var entity = this.entities[m];\n\n    var overlapping = Vec2.rectIntersect(\n      entity.spatial.absPosition(),\n      entity.spatial.absHwidth(),\n      position,\n      hwidth);\n\n    if (overlapping) {\n      entities.push(entity);\n    }\n  }\n\n  return entities;\n};\n\n/**\n * Do a complete reset of the tree.\n */\nQuadTree.prototype.reIndex = function()\n{\n  this._combine();\n  this._splitAndRedistributeIfNeeded();\n};\n\nvar tSize = new Vec2();\nvar tPos  = new Vec2();\n\n/**\n * Check to see if an entity is still valid.\n * @param {{spatial: Spatial}} entity\n * @return {Boolean} True if the entity is in this tree (non-recursive) in its\n * correct place. False implies we need to re-add it.\n */\nQuadTree.prototype.validateEntity = function(entity)\n{\n  var pos = entity.spatial.position;\n  var hw  = entity.spatial.hwidth;\n\n  // Check to see if we're still inside this node\n  tSize.assign(this.size).smult(0.5);\n  tPos.assign(tSize).add(this.position);\n  var inside = Vec2.rectContains(pos, hw, tPos, tSize);\n\n  if (!inside) return false;\n\n  // No children nodes, then we're good\n  if (!this.nodes.length)\n    return true;\n\n  // Or if children nodes and we overlap, still good\n  var index = this._getIndex(entity.spatial.absPosition(),\n    entity.spatial.absHwidth());\n  if (this.nodes.length && !~index)\n    return true;\n\n  // Didnt make it\n  return false;\n};\n\n/**\n * Return which of the 4 quandrants of this tree an object would go into.\n * @param {Vec2} position\n * @param {Vec2} hwidth\n * @return {Number} Which quandrant, or -1 if won't fit.\n * @private\n */\nQuadTree.prototype._getIndex = function(position, hwidth)\n{\n  var midX = this.position.x + this.size.x / 2;\n  var midY = this.position.y + this.size.y / 2;\n\n  var left   = position.x - hwidth.x < midX && position.x + hwidth.x < midX;\n  var right  = position.x - hwidth.x > midX && position.x + hwidth.x > midX;\n  var top    = position.y - hwidth.y < midY && position.y + hwidth.y < midY;\n  var bottom = position.y - hwidth.y > midY && position.y + hwidth.y > midY;\n\n  if (top && right) return 0;\n  if (top && left) return 1;\n  if (bottom && left) return 2;\n  if (bottom && right) return 3;\n\n  return -1;\n};\n\n/**\n * If we've overpacked this tree, then split into 4 smaller trees (if we\n * haven't already) and redistribute.\n * @private\n */\nQuadTree.prototype._splitAndRedistributeIfNeeded = function()\n{\n  if (this.entities.length > this.maxEntities &&\n    this.level < this.maxLevels)\n  {\n    this._split();\n    this._redistribute();\n  }\n};\n\n/**\n * Create a sub quad tree\n * @return {QuadTree}\n * @private\n */\nQuadTree.prototype._factory = function()\n{\n  var node = this.pool.aquire();\n\n  node.pool        = this.pool;\n  node.level       = this.level + 1;\n  node.maxEntities = this.maxEntities;\n  node.maxLevels   = this.maxLevels;\n\n  return node;\n};\n\n/**\n * Create 4 sub nodes for the tree (does not populate tho)\n * @private\n */\nQuadTree.prototype._split = function()\n{\n  if (this.nodes.length) return;\n\n  var x = this.position.x;\n  var y = this.position.y;\n\n  var w = this.size.x / 2;\n  var h = this.size.y / 2;\n\n  // Create the seperate nodes\n  for (var n = 0; n < 4; n++) {\n    var node = this._factory();\n    node.size.set(w, h);\n\n    switch(n) {\n      case 0:\n        node.position.set(x + w, y);\n        break;\n      case 1:\n        node.position.set(x, y);\n        break;\n      case 2:\n        node.position.set(x, y + h);\n        break;\n      case 3:\n        node.position.set(x + w, y + h);\n        break;\n    }\n\n    this.nodes.push(node);\n  }\n};\n\n/**\n * Distrubute all entities into child nodes if we can.\n * @private\n */\nQuadTree.prototype._redistribute = function()\n{\n  // Loop through all of our entries and if they can fit into a child node,\n  // move them there\n  var i = 0;\n  while (i < this.entities.length) {\n    var entity = this.entities[i];\n    var index = this._getIndex(entity.spatial.absPosition(),\n      entity.spatial.absHwidth());\n\n    // Insert into child, remove from our array if they belong in another node\n    if (~index) {\n      this.nodes[index].insert(entity);\n      this.entities.splice(i, 1);\n    } else {\n      i++;\n    }\n  }\n};\n\n/**\n * Unwinds this node. Move all child nodes into this node and remove child\n * nodes.\n * @private\n */\nQuadTree.prototype._combine = function()\n{\n  for (var n = 0; n < this.nodes.length; n++) {\n    var node = this.nodes[n];\n\n    // Combine all children first\n    node._combine();\n\n    // All entries combined on node, now add it to US\n    for (var m = 0; m < node.entities.length; m++) {\n      var entity = node.entities[m];\n      this.entities.push(entity);\n    }\n\n    // Clear out and ensure we release it\n    node.entities.length = 0;\n    node.clear();\n    this.pool.release(node);\n  }\n\n  // Clear nodes array\n  this.nodes.length = 0;\n};\n\n","module.exports = ObjectPool;\n\n/**\n * Minimize garbage collector thrashing by re-using existing objects instead of\n * creating new ones. Requires manually lifecycle management.\n * @constructor\n * @param {Function} T\n */\nfunction ObjectPool(T)\n{\n  this.freeList = [];\n  this.count    = 0;\n  this.T        = T;\n}\n\n/**\n * Get a pooled object\n */\nObjectPool.prototype.aquire = function()\n{\n  // Grow the list by 20%ish if we're out\n  if (this.freeList.length <= 0) {\n    this.expand(Math.round(this.count*0.2) + 1);\n  }\n\n  var item = this.freeList.pop();\n\n  // We can provide explicit initing, otherwise re-call constructor (hackish)\n  if (item.__init)\n    item.__init();\n  else\n    this.T.call(item);\n\n  return item;\n};\n\n/**\n * Return an object back to the pool.\n */\nObjectPool.prototype.release = function(item)\n{\n  this.freeList.push(item);\n};\n\n/**\n * @param {Number} Amount of new objects to allocate for this pool.\n */\nObjectPool.prototype.expand = function(count)\n{\n  for (var n = 0; n < count; n++)\n    this.freeList.push(new this.T());\n  this.count += count;\n};\n\n/**\n * @return {Number} Total amount of allocated objects (available and in-use).\n */\nObjectPool.prototype.totalSize = function()\n{\n  return this.count;\n};\n\n/**\n * @return {Number} Total number of objects currently available.\n */\nObjectPool.prototype.totalFree = function()\n{\n  return this.freeList.length;\n};\n\n/**\n * @return {Number} Total number of objects currently in-use.\n */\nObjectPool.prototype.totalUsed = function()\n{\n  return this.count - this.freeList.length;\n};\n\n","module.exports = Spatial;\n\nvar Vec2 = require('./Vec2.js');\n\n/**\n * Basic component giving an entity the concept of being located somewhere.\n * Creates basic spatial heirachy, positions, rotation, etc.\n * @constructor\n */\nfunction Spatial()\n{\n  // Alloc our types\n  this.position     = new Vec2();\n  this.scale        = new Vec2();\n  this.hwidth       = new Vec2();\n\n  this._absScale    = new Vec2();\n  this._absPosition = new Vec2();\n  this._absHwidth   = new Vec2();\n\n  // Setup\n  this.__init();\n}\n\n/**\n * Setup called by pool.\n * @private\n */\nSpatial.prototype.__init = function()\n{\n  this.rotation = 0;\n\n  // Ref to quad tree node this component is in\n  this._node = null;\n\n  // Parent component\n  this.parent = null;\n\n  this.position.clear();\n  this.scale.set(1, 1);\n  this.hwidth.clear();\n  this._absPosition.clear();\n  this._absScale.set(1, 1);\n  this._absHwidth.clear();\n};\n\n/**\n * Fired when spatials overlap.\n * @event\n */\nSpatial.COINCIDENT = 'Spatial#COINCIDENT';\n\n/**\n * Attach this component to another entity's Spatial.\n * @param {{spatial: Spatial}} entity An entity with a Spatial component\n */\nSpatial.prototype.attachTo = function(entity)\n{\n  if (this.parent)\n    throw new Error ('Entity already attached');\n\n  if (!entity || !entity.spatial)\n    throw new Error('Invalid / missing entity');\n\n  this.parent = entity.spatial;\n};\n\n/**\n * The absolute world position of this component.\n * @return {Vec2}\n */\nSpatial.prototype.absPosition = function()\n{\n  var v = this._absPosition.assign(this.position);\n\n  // Trivial case, no parent\n  if (!this.parent) {\n    return v;\n  }\n\n  var parent = this.parent;\n\n  // Rotate our angle by parent's angle\n  var r = this.absRotation();\n  v.rotate(parent.absRotation());\n\n  // Scale by parents scale\n  var pScale = parent.absScale();\n  v.set(v.x * pScale.x, v.y * pScale.y);\n\n  // Add parent's position\n  return v.add(parent.absPosition());\n};\n\n/**\n * The absolute world rotation of this component.\n * @return {Number}\n */\nSpatial.prototype.absRotation = function()\n{\n  // Trivial case\n  if (!this.parent)\n    return this.rotation;\n\n  // This + parent\n  var r = this.rotation + this.parent.absRotation();\n\n  return r % (Math.PI*2);\n};\n\n/**\n * The absolute world hwidth for this component.\n * @return {Vec2}\n */\nSpatial.prototype.absHwidth = function()\n{\n  var h = this._absHwidth.assign(this.hwidth);\n\n  if (!this.parent)\n    return h;\n\n  var scale = this.absScale();\n\n  return h.set(h.x * scale.x, h.y * scale.y);\n};\n\n/**\n * The absolute world scale of this component.\n * @return {Vec2}\n */\nSpatial.prototype.absScale = function()\n{\n  var v = this._absScale.assign(this.scale);\n\n  // Trivial case\n  if (!this.parent) {\n    return v;\n  }\n\n  var pScale = this.parent.absScale();\n\n  return v.set(v.x * pScale.x, v.y * pScale.y);\n};\n\n","module.exports = Vec2;\n\nvar ObjectPool = require('./ObjectPool.js');\n\n/**\n * 2-dimension Cartesian vector with built-in (optional) object pool.\n * @constructor\n * @param {Number} x\n * @param {Number} y\n */\nfunction Vec2(x, y)\n{\n  this.x = +x || 0.0;\n  this.y = +y || 0.0;\n}\n\n/**\n * Reset for pool.\n * @private\n */\nVec2.prototype.__init = function()\n{\n  this.clear();\n};\n\n// Interal static object pool\nvar pool = new ObjectPool(Vec2);\n\n/**\n * Get a vector from the pool.\n * @return {Vec2}\n */\nVec2.aquire = function()\n{\n  return pool.aquire();\n};\n\n/**\n * Return a vector to the pool.\n * @param {Vec2} v\n * @return {Number}\n */\nVec2.release = function(v)\n{\n  if (v) pool.release(v);\n  return pool.count - pool.freeList.length;\n};\n\n/**\n * Reset this vector to (0,0).\n * @return {Vec2} This vector.\n */\nVec2.prototype.clear = function()\n{\n  this.x = this.y = 0.0;\n  return this;\n};\n\n/**\n * Assign this vector the value of another.\n * @param {Vec2} v\n * @return {Vec2} This vector.\n */\nVec2.prototype.assign = function(v)\n{\n  this.x = v.x;\n  this.y = v.y;\n  return this;\n};\n\n/**\n * Determine if this vector is equal to another.\n * @param {Vec2} v\n * @return {Boolean} True if vectors are equal.\n */\nVec2.prototype.equals = function(v)\n{\n  return this.x === v.x && this.y === v.y;\n};\n\n/**\n * Set this vector to a set of coordinates.\n * @param {Number} x\n * @param {Number} y\n * @return {Vec2} This vector.\n */\nVec2.prototype.set = function(x, y)\n{\n  this.x = +x;\n  this.y = +y;\n  return this;\n};\n\n/**\n * Limit this vector to a specific magnitude.\n * @param {Number} size\n * @return {Vec2} This vector.\n */\nVec2.prototype.limit = function(size)\n{\n  size = +size;\n  if (!size)\n    return this;\n  else if (this.magnitude() > size)\n    return this.normalize(size);\n  else\n    return this;\n};\n\n/**\n * Normalize this vector.\n * @param {Number=} m Length.\n * @return {Vec2} This vector.\n */\nVec2.prototype.normalize = function(m)\n{\n  m = m || +1.0;\n  var length = Math.sqrt(this.x * this.x + this.y * this.y);\n  this.x = m * this.x / length;\n  this.y = m * this.y / length;\n  return this;\n};\n\n/**\n * Subtract some vector from this one.\n * @param {Vec2} v\n * @return {Vec2} This vector.\n */\nVec2.prototype.sub = function(v)\n{\n  this.x -= v.x;\n  this.y -= v.y;\n  return this;\n};\n\n/**\n * Add some vector to this one.\n * @param {Vec2} v\n * @return {Vec2} This vector.\n */\nVec2.prototype.add = function(v)\n{\n  this.x += v.x;\n  this.y += v.y;\n  return this;\n};\n\n/**\n * Scalar multiply this vector by a value.\n * @param {Number} n\n * @return {Vec2} This vector.\n */\nVec2.prototype.smult = function(n)\n{\n  n = +n;\n  this.x *= n;\n  this.y *= n;\n  return this;\n};\n\n/**\n * Rotate this vector clockwise about the origin by a certain angle.\n * @param {Number} theta\n * @return {Vec2} This vector.\n */\nVec2.prototype.rotate = function(theta)\n{\n  return this.set(\n    this.x * Math.cos(theta) - this.y * Math.sin(theta),\n    this.x * Math.sin(theta) + this.y * Math.cos(theta)\n  );\n};\n\n/**\n * Get the dot product of this vector and another.\n * @param {Vec2} v\n * @return {Number}\n */\nVec2.prototype.dot = function(v)\n{\n  return +(this.x * v.x + this.y * v.y);\n};\n\n/**\n * Get the determinate of this vector and another.\n * @param {Vec2} v\n * @return {Number}\n */\nVec2.prototype.det = function(v)\n{\n  return +(this.x * v.y - this.y * v.x);\n};\n\n/**\n * Get the magnitude of this vector.\n * @return {Number}\n */\nVec2.prototype.magnitude = function()\n{\n  return Math.sqrt(this.x * this.x + this.y * this.y);\n};\n\n/**\n * Get the squared magnitude of this vector.\n * @return {Number}\n */\nVec2.prototype.magnitude2 = function()\n{\n  return this.x * this.x + this.y * this.y;\n};\n\n/**\n * Get the angle of this vector.\n * @return {Number}\n */\nVec2.prototype.angle = function()\n{\n  return Math.atan2(this.y, this.x);\n};\n\n/**\n * Get the angle between this vector and another.\n * @param {Vec2} v\n * @return {Number}\n */\nVec2.prototype.angleBetween = function(v)\n{\n  return Math.atan2(this.det(v), this.dot(v));\n};\n\n/**\n * Make a pooled copy of this vector\n * @return {Vec2} A new vector.\n */\nVec2.prototype.pcopy = function()\n{\n  return Vec2.aquire().assign(this);\n};\n\n/**\n * Make a copy of this vector.\n * @return {Vec2} A new vector.\n */\nVec2.prototype.copy = function()\n{\n  return new Vec2().assign(this);\n};\n\n/**\n * Create a vector with a specific angle and magnitude.\n * @param {Number} theta\n * @param {Number=} m\n * @return {Vec2} A new vector.\n */\nVec2.fromAngle = function(theta, m)\n{\n  m = +m || 1.0;\n  return new Vec2(Math.cos(theta) * m, Math.sin(theta) * m);\n};\n\n/**\n * Create a pooled vector with a specific angle and magnitude.\n * @param {Number} theta\n * @param {Number} m\n * @return {Vec2} A new vector.\n */\nVec2.pfromAngle = function(theta, m)\n{\n  m = +m || 1.0;\n  return Vec2.aquire().set(\n    Math.cos(theta) * m,\n    Math.sin(theta) * m\n  );\n};\n\n/**\n * Determine if two rectangles, defined by a position and a halfwidth vector,\n * overlap.\n * @param {Vec2} p1 Position of rectangle 1\n * @param {Vec2} r1 Halfwidths of rectangle 1\n * @param {Vec2} p2 Position of rectangle 2\n * @param {Vec2} r2 Halfwidths of rectangle 2\n * @return {Boolean} True if they intersect\n */\nVec2.rectIntersect = function(p1, r1, p2, r2)\n{\n  // Basically, rectangles dont intersect if one's bottom is higher than ones\n  // top, ones left is more left than ones right, etc\n  var a = p1.x + r1.x < p2.x - r2.x;\n  var b = p1.x - r1.x > p2.x + r2.x;\n  var c = p1.y + r1.y < p2.y - r2.y;\n  var d = p1.y - r1.y > p2.y + r2.y;\n\n  // We want if they do\n  return !(a || b || c || d);\n};\n\n/**\n * Determines if rectangle 1 is entirely inside of rectangle 2.\n * @param {Vec2} p1 Position of rectangle 1\n * @param {Vec2} r1 Halfwidths of rectangle 1\n * @param {Vec2} p2 Position of rectangle 2\n * @param {Vec2} r2 Halfwidths of rectangle 2\n * @return {Boolean} True if they rectangle 1 is inside of rectangle 2\n */\nVec2.rectContains = function(p1, r1, p2, r2)\n{\n  if (p1.x - r1.x < p2.x - r2.x) return false;\n  if (p1.x + r1.x > p2.x + r2.x) return false;\n  if (p1.y - r1.y < p2.y - r2.y) return false;\n  if (p1.y + r1.y > p2.y + r2.y) return false;\n\n  return true;\n};\n\n/**\n * Convert a rectangle specified by top-left point + size into center location\n * + halfwidths.\n * @param {Vec2} position\n * @param {Vec2} size\n * @param {Vec2} out__position Output position\n * @param {Vec2} out__hwidth Output hwidths\n */\nVec2.sizeToHwidth = function(position, size, out__position, out__hwidth)\n{\n  out__hwidth.assign(size).smult(0.5);\n  out__position.assign(position).add(out__hwidth);\n};\n\n/**\n * Output this vector.\n */\nVec2.prototype.toString = function()\n{\n  return '' + (this.x.toFixed(2)) + ',' + (this.y.toFixed(2));\n};\n\n","module.exports = Messanger;\n\nvar Event = require('./Event.js');\n\n/**\n * General event aggregation with filtering on components or tags.\n * @constructor\n */\nfunction Messanger()\n{\n  this._events = {};\n  this.fired   = 0;\n  this.handled = 0;\n}\n\n/**\n * @param {String} eventName\n * @param {Function} callback\n * @return {Event}\n */\nMessanger.prototype.listenTo = function(eventName, callback)\n{\n  if (!this._events[eventName])\n    this._events[eventName] = [];\n\n  var event = new Event(eventName, callback);\n\n  // Dump and chump\n  this._events[eventName].push(event);\n  return event;\n};\n\n/**\n * @param {String} eventName\n * @param {Object=} entity\n * @param {Option=} option\n */\nMessanger.prototype.trigger = function(eventName, entity, option)\n{\n  this.fired++;\n\n  var events = this._events[eventName];\n  if (!events) return;\n\n  // Try all events\n  for (var n = 0; n < events.length; n++) {\n    var event = events[n];\n    if (event.fire(eventName, entity, option))\n      this.handled++;\n  }\n};\n\n","module.exports = Event;\n\n/**\n * @constructor\n */\nfunction Event(name, callback)\n{\n  this._name     = name || 'name';\n  this._callback = callback || null;\n\n  // Additional filters\n  this._Components = [];\n}\n\n/**\n * @param {String} eventName\n * @param {{hasAllComponents:Function}} entity\n * @param {Object=} option\n * @return {Boolean} True if fired.\n */\nEvent.prototype.fire = function(eventName, entity, option)\n{\n  // Name check\n  if (eventName !== this._name)\n    return false;\n\n  // Component filters\n  var Comps = this._Components;\n  if (entity && entity.hasAllComponents && Comps.length) {\n    if (!entity || !entity.hasAllComponents(Comps))\n      return false;\n  }\n\n  // Made it\n  this._callback(entity, option);\n  return true;\n};\n\n/**\n * @param {Function} T\n * @return {Event} This object.\n */\nEvent.prototype.whereComponent = function(T)\n{\n  this._Components.push(T);\n};\n\n/**\n * @param {Array.<Function>} Components\n * @return {Event} This object.\n */\nEvent.prototype.whereComponents = function(Components)\n{\n  this._Components = this._Components.concat(Components);\n  return this;\n};\n\n","module.exports = {\n\n  'extends'      : require('./lib/extends.js'),\n  'mixin'        : require('./lib/mixin.js'),\n  'getArguments' : require('./lib/getArguments.js'),\n  'getName'      : require('./lib/getName.js')\n\n};\n\n\n","module.exports = extends_;\n\n/**\n * The well documented, oft-used (Coffeescript, Typescript, ES6... etc) extends\n * pattern to get some sort of single-inheritance in Javascript.  Modify a\n * Child class to have inherited the static members via copying and link the\n * prototypes.\n * @param {Function} Child Child constructor function.\n * @param {Function} Parent Parent contrusctor function.\n * @return {Function} The Child constructor.\n */\nfunction extends_(Child, Parent)\n{\n  // Drop in statics\n  for (var key in Parent) {\n    if (!Child.hasOwnProperty(key) && Parent.hasOwnProperty(key)) {\n      Child[key] = Parent[key];\n    }\n  }\n\n  // Give static to access parent\n  Child.Super = Parent;\n\n  // Child's prototype property is an object with the parent's prototype\n  // property its [[prototype]] + constructor\n  if (Object.create instanceof Function) {\n    Child.prototype = Object.create(Parent.prototype, {\n      constructor: { value: Child }\n    });\n  } else {\n    // IE8 and below shim\n    var T = makeT(Child);\n    T.prototype = Parent.prototype;\n    Child.prototype = new T();\n  }\n\n  return Child;\n}\n\n/**\n * @param {Function} Child\n * @return {Function}\n */\nfunction makeT(Child)\n{\n  return function T() { this.constructor = Child; };\n}\n\n","module.exports = mixin_;\n\n/**\n * Add all own properties of mixin to the prototype property of class T\n * @param {Function} T Class we want to mix into.\n * @param {Function|Object} mixin Mixin we want to mixt\n */\nfunction mixin_(T, mixin)\n{\n  // If we're mixing in a class (constructor function), then first mix in all\n  // things hanging directly off the mixin as \"statics\", then switch the mixin\n  // ref to point to the prototype\n  if (mixin instanceof Function) {\n    for (var k in mixin) {\n      T[k] = mixin[k];\n    }\n    mixin = mixin.prototype;\n  }\n\n  // Dump everything on the mixin into the prototype of our class\n  for (var key in mixin) {\n    if (mixin.hasOwnProperty(key)) {\n      T.prototype[key] = mixin[key];\n    }\n  }\n}\n\n","module.exports = getName;\n\nvar FUNCTION_NAME = /function\\s+([^\\s(]+)/;\n\n/**\n * Get the name of a function (e.g. constructor)\n * @param {Function} f\n * @return {String} The function name.\n */\nfunction getName(f)\n{\n  var name = '';\n\n  if (f instanceof Function) {\n    if (f.name) {\n      return f.name;\n    }\n\n    var match = f.toString().match(FUNCTION_NAME);\n\n    if (match) {\n      name = match[1];\n    }\n  } else if (f && f.constructor instanceof Function) {\n    name = getName(f.constructor);\n  }\n\n  return name;\n}\n","module.exports = getArguments;\n\nvar FUNCTION_ARGS = /^\\w*function[^\\(]*\\(([^\\)]+)/;\n\n/**\n * Get the parameter names of a function.\n * @param {Function} f A function.\n * @return {Array.<String>} An array of the argument names of a function.\n */\nfunction getArguments(f)\n{\n  var ret = [];\n  var args = f.toString().match(FUNCTION_ARGS);\n\n  if (args) {\n    args = args[1]\n      .replace(/[ ]*,[ ]*/, ',')\n      .split(',');\n    for (var n = 0; n < args.length; n++) {\n      var a = args[n].replace(/^\\s+|\\s+$/g, '');\n      if (a) ret.push(a);\n    }\n  }\n\n  return ret;\n}\n\n"]}