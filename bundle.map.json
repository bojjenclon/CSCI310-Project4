{"version":3,"sources":["../../../../AppData/Roaming/npm/node_modules/browserify/node_modules/browser-pack/_prelude.js","main.js","RequestAnimationFrame.js","js/THREEx.KeyboardState.js","libgif.js","rubbable.js","js/ResourceManager.js","js/Globals.js","js/Game.js","js/PointerLockControls.js","js/EntityFactory.js","js/Systems.js","js/MouseController.js","node_modules/physijs-browserify/physi.js","node_modules/js-class/class.js","node_modules/stats.js/src/Stats.js","node_modules/three/three.js","js/Components.js","node_modules/tiny-ecs/index.js","js/components/Position.js","js/components/Velocity.js","js/components/Expirable.js","js/components/Drawable.js","js/components/CameraFollow.js","js/components/Jump.js","js/components/ShootDelay.js","js/components/Hurt.js","js/components/OneTimeHit.js","node_modules/tiny-ecs/lib/ObjectPool.js","node_modules/tiny-ecs/lib/Spatial.js","node_modules/tiny-ecs/lib/Messanger.js","node_modules/tiny-ecs/lib/EntityManager.js","node_modules/tiny-ecs/lib/QuadTree.js","node_modules/tiny-ecs/lib/Vec2.js","node_modules/tiny-ecs/lib/Entity.js","node_modules/tiny-ecs/lib/Event.js","node_modules/tiny-ecs/node_modules/typedef/index.js","node_modules/tiny-ecs/node_modules/typedef/lib/getName.js","node_modules/tiny-ecs/node_modules/typedef/lib/getArguments.js","node_modules/tiny-ecs/node_modules/typedef/lib/extends.js","node_modules/tiny-ecs/node_modules/typedef/lib/mixin.js"],"names":["init","Globals","instance","hudElement","document","getElementById","scoreElement","reloadingElement","reloadImg","SuperGif","gif","load","gameOptions","container","loadingContainer","blocker","instructions","crosshair","modelsToPreload","game","Game","start","global","Class","require","THREE","THREEx","Physijs","Stats","scripts","worker","ammo","window","requestAnimationFrame","webkitRequestAnimationFrame","mozRequestAnimationFrame","oRequestAnimationFrame","msRequestAnimationFrame","callback","element","setTimeout","module","exports","KeyboardState","domElement","this","keyCodes","modifiers","_this","_onKeyDown","event","_onKeyChange","_onKeyUp","addEventListener","_onBlur","prop","prototype","destroy","removeEventListener","MODIFIERS","ALIAS","left","up","right","down","space","pageup","pagedown","tab","escape","keyCode","pressed","type","shiftKey","ctrlKey","altKey","metaKey","keyDesc","keys","split","i","length","key","indexOf","Object","toUpperCase","charCodeAt","eventMatches","aliases","aliasKeys","bitsToNum","ba","reduce","s","n","byteToBitArr","bite","a","push","Stream","data","len","pos","readByte","Error","Uint8Array","readBytes","bytes","read","String","fromCharCode","readUnsigned","lzwDecode","minCodeSize","code","last","readCode","size","output","clearCode","eoiCode","codeSize","dict","clear","concat","apply","parseGIF","st","handler","parseCT","entries","ct","readSubBlocks","parseHeader","hdr","sig","ver","width","height","bits","gctFlag","shift","colorRes","splice","sorted","gctSize","bgColor","pixelAspectRatio","gct","parseExt","block","parseGCExt","reserved","disposalMethod","userInput","transparencyGiven","delayTime","transparencyIndex","terminator","gce","parseComExt","comment","com","parsePTExt","ptHeader","ptData","pte","parseAppExt","parseNetscapeExt","unknown","iterations","app","NETSCAPE","parseUnknownAppExt","appData","identifier","authCode","parseUnknownExt","label","extType","parseImg","img","deinterlace","pixels","newPixels","Array","rows","cpRow","toRow","fromRow","fromPixels","slice","offsets","steps","pass","leftPos","topPos","lctFlag","interlaced","lctSize","lct","lzwMinCodeSize","lzwData","parseBlock","sentinel","eof","toString","parse","opts","options","vp_l","vp_t","vp_w","vp_h","c_w","c_h","is_vp","stream","loadError","loading","transparency","delay","disposalRestoreFromIdx","lastDisposalMethod","frame","lastImg","playing","forward","ctx_scaled","frames","frameOffsets","auto_play","getAttribute","canvas","ctx","toolbar","tmpCanvas","onEndListener","hasOwnProperty","on_end","loopDelay","loop_delay","overrideLoopMode","loop_mode","drawWhileLoading","draw_while_loading","showProgressBar","show_progress_bar","doParse","err","doLoadError","setSizes","w","h","get_canvas_scale","style","minWidth","getContext","setTransform","setFrameOffset","offset","x","y","doShowProgress","draw","mid","top","fillStyle","fillRect","originOfError","drawError","strokeStyle","lineWidth","moveTo","lineTo","stroke","doHdr","_hdr","doGCE","pushFrame","getImageData","doImg","currIdx","putImageData","clearRect","imgData","cdd","forEach","pixel","set","scale","drawImage","player","iterationCount","getNextFrameNo","delta","stepFrame","amount","putFrame","completeLoop","step","stepping","doStep","nextFrameNo","parseInt","globalCompositeOperation","play","pause","move_relative","current_frame","move_to","frame_idx","doDecodeProgress","doNothing","withProgress","fn","load_callback","parent","parentNode","span","createElement","className","appendChild","insertBefore","removeChild","initialized","max_width","load_setup","get_playing","get_canvas","get_loading","get_auto_play","get_length","get_current_frame","load_url","src","XMLHttpRequest","overrideMimeType","onloadstart","onload","e","responseText","onprogress","lengthComputable","loaded","total","onerror","open","send","load_raw","arr","set_frame_offset","root","factory","define","amd","RubbableGif","sup","register_canvas_handers","isvp","maxDistance","Math","floor","startX","startTime","cantouch","aj","last_played","preventDefault","touches","layerX","progress","timeStamp","pageX","currentX","currentDistance","abs","currentTime","orig_load","Model","constructor","geometry","material","ResourceManager","loadingManager","LoadingManager","jsonLoader","JSONLoader","textures","models","getTexture","path","undefined","ImageUtils","loadTexture","loadModel","materials","MeshFaceMaterial","model","bind","statics",{"end":{"file":"?","comments_before":[],"nlb":false,"endpos":1264,"endcol":16,"endline":55,"pos":1256,"col":8,"line":55,"value":"instance","type":"name"},"start":{"file":"?","comments_before":[],"nlb":false,"endpos":1264,"endcol":16,"endline":55,"pos":1256,"col":8,"line":55,"value":"instance","type":"name"},"name":"instance"},"_instance","score","stats","prevTime","performance","now","renderer","scene","camera","paused","controlsEnabled","controls","systems","postPhysicsSystems","percentModelsLoaded","runImmediately","onResize","onkeydown","onKeyDown","onMouseDown","onMouseUp","WebGLRenderer","antialias","setSize","innerWidth","innerHeight","setClearColor","setMode","position","bottom","body","Scene","setGravity","Vector3","aspectRatio","PerspectiveCamera","add","PointerLockControls","getObject","clock","Clock","ambientLight","AmbientLight","dirLight","DirectionalLight","ground","BoxMesh","BoxGeometry","MeshBasicMaterial","color","_physijs","collision_type","EntityFactory","COLLISION_TYPES","obstacle","collision_masks","playerBullet","enemyBullet","makePlayer","controlsObject","cameraOffset","makeEnemy","CameraRotationSystem","entities","PlayerInputSystem","MovementSystem","ExpirableSystem","CameraFollowSystem","ShootDelaySystem","HurtSystem","PhysicsUpdateSystem","loadModels","modelLoaded","percentPerModel","visibility","display","scrollTop","documentElement","initPointerLock","run","update","time","dt","system","simulate","MouseController","render","aspect","updateProjectionMatrix","which","KEY_CODES","button","isDown","wasPressed","havePointerLock","pointerlockchange","pointerLockElement","mozPointerLockElement","webkitPointerLockElement","enabled","pointerlockerror","requestPointerLock","mozRequestPointerLock","webkitRequestPointerLock","test","navigator","userAgent","fullscreenchange","fullscreenElement","mozFullscreenElement","mozFullScreenElement","requestFullscreen","mozRequestFullscreen","mozRequestFullScreen","webkitRequestFullscreen","innerHTML","rotation","pitchObject","Object3D","yawObject","moveForward","moveBackward","moveLeft","moveRight","isOnObject","canJump","velocity","mass","moveSpeed","minimumY","onMouseMove","onKeyUp","movementX","mozMovementX","webkitMovementX","movementY","mozMovementY","webkitMovementY","max","PI_2","min","bool","getDirection","direction","Euler","v","copy","applyEuler","z","translateX","translateY","translateZ","PI","EntityManager","C","createEntity","addTag","addComponent","Position","Velocity","Jump","Drawable","CameraFollow","ShootDelay","drawable","mesh","createMaterial","entity","enemy","setDamping","setAngularFactor","other_object","relative_velocity","relative_rotation","contact_normal","jump","cameraFollow","object","shootDelay","delayTheshold","MeshPhongMaterial","makeBullet","bullet","Expirable","OneTimeHit","ConvexMesh","oneTimeHit","alreadyHit","uuid","Hurt","hurt","originalColor","vel","multiply","applyCentralImpulse","expirable","maxAge","nothing","keyboard","jumped","players","queryTag","dv","MOVE_SPEED","canShoot","clone","rotationMatrix","applyMatrix4","moveables","queryComponents","hasComponent","expirables","age","remove","follows","Matrix4","extractRotation","matrix","shooters","timer","hurtables","invulnerabilityFrames","hurtColor","removeComponent","getLinearVelocity","SUPPORT_TRANSFERABLE","Eventable","getObjectId","getEulerXYZFromQuaternion","getQuatertionFromEuler","convertWorldPositionToObject","addObjectChildren","_temp1","_temp2","_is_simulating","_Physijs","_temp_vector3_1","_temp_vector3_2","_temp_matrix4_1","_quaternion_1","Quaternion","MESSAGE_TYPES","WORLDREPORT","COLLISIONREPORT","VEHICLEREPORT","CONSTRAINTREPORT","REPORT_ITEMSIZE","COLLISIONREPORT_ITEMSIZE","VEHICLEREPORT_ITEMSIZE","CONSTRAINTREPORT_ITEMSIZE","_eventListeners","event_name","index","dispatchEvent","parameters","call","arguments","make","obj","_id","atan2","asin","c1","s1","c2","s2","c3","s3","c1c2","s1s2","cos","sin","identity","makeRotationFromQuaternion","quaternion","getInverse","sub","noConflict","friction","restitution","physijs_material","id","PointConstraint","objecta","objectb","appliedImpulse","positiona","positionb","getDefinition","HingeConstraint","axis","setLimits","low","high","bias_factor","relaxation_factor","execute","constraint","enableAngularMotor","acceleration","disableMotor","SliderConstraint","lin_lower","lin_upper","ang_lower","ang_upper","setRestitution","linear","angular","enableLinearMotor","disableLinearMotor","disableAngularMotor","ConeTwistConstraint","axisa","axisb","setLimit","enableMotor","setMaxMotorImpulse","max_impulse","setMotorTarget","target","setFromEuler","setFromRotationMatrix","DOFConstraint","setLinearLowerLimit","limit","setLinearUpperLimit","setAngularLowerLimit","setAngularUpperLimit","configureAngularMotor","low_angle","high_angle","max_force","params","self","_worker","Worker","transferableMessage","webkitPostMessage","postMessage","_materials_ref_counts","_objects","_vehicles","_constraints","ab","ArrayBuffer","byteLength","console","log","message","filename","lineno","onmessage","_temp","Float32Array","_updateScene","_updateCollisions","_updateVehicles","_updateConstraints","cmd","debug","dir","fixedTimeStep","rateLimit","num_objects","__dirtyPosition","__dirtyRotation","linearVelocity","angularVelocity","buffer","vehicle","wheel","wheels","addVectors","j","object2","id1","id2","collisions","normal_offsets","subVectors","getAngularVelocity","normal_offset","addConstraint","show_marker","marker","Mesh","SphereGeometry","MeshNormalMaterial","onSimulationResume","removeConstraint","children","updateMatrix","updateMatrixWorld","setFromMatrixPosition","matrixWorld","position_offset","world","Vehicle","materialId","depth","pop","setFixedTimeStep","gravity","timeStep","maxSubSteps","object_id","quat","boundingBox","computeBoundingBox","__defineGetter__","__defineSetter__","force","applyImpulse","impulse_x","impulse_y","impulse_z","applyTorque","torque_x","torque_y","torque_z","applyCentralForce","applyForce","force_x","force_y","force_z","setAngularVelocity","setLinearVelocity","factor","setLinearFactor","setCcdMotionThreshold","threshold","setCcdSweptSphereRadius","radius","PlaneMesh","normal","faces","HeightfieldMesh","xdiv","ydiv","xsize","ysize","xpts","sqrt","vertices","ypts","absMaxHeight","b","points","round","SphereMesh","boundingSphere","computeBoundingSphere","pow","CylinderMesh","CapsuleMesh","ConeMesh","ConcaveMesh","face","triangles","Face3","c","Face4","d","tuning","VehicleTuning","rigidBody","suspension_stiffness","suspension_compression","suspension_damping","max_suspension_travel","friction_slip","max_suspension_force","addWheel","wheel_geometry","wheel_material","connection_point","wheel_direction","wheel_axle","suspension_rest_length","wheel_radius","is_front_wheel","castShadow","receiveShadow","multiplyScalar","setSteering","steering","setBrake","brake","applyEngineForce","inherit","dest","noParent","getOwnPropertyNames","name","desc","getOwnPropertyDescriptor","defineProperty","__proto__","findType","meta","implType","implMeta","proto","base","implements","classProto","isArray","implementedType","extend","theClass","value","enumerable","configurable","writable","Checker","typeOf","typeInfo","an","is","VERSION","Date","ms","msMin","Infinity","msMax","fps","fpsMin","fpsMax","mode","cssText","fpsDiv","fpsText","fpsGraph","bar","msDiv","msText","msGraph","updateGraph","dom","child","firstChild","REVISION","begin","end","textContent","sign","warn","error","MOUSE","LEFT","MIDDLE","RIGHT","CullFaceNone","CullFaceBack","CullFaceFront","CullFaceFrontBack","FrontFaceDirectionCW","FrontFaceDirectionCCW","BasicShadowMap","PCFShadowMap","PCFSoftShadowMap","FrontSide","BackSide","DoubleSide","NoShading","FlatShading","SmoothShading","NoColors","FaceColors","VertexColors","NoBlending","NormalBlending","AdditiveBlending","SubtractiveBlending","MultiplyBlending","CustomBlending","AddEquation","SubtractEquation","ReverseSubtractEquation","MinEquation","MaxEquation","ZeroFactor","OneFactor","SrcColorFactor","OneMinusSrcColorFactor","SrcAlphaFactor","OneMinusSrcAlphaFactor","DstAlphaFactor","OneMinusDstAlphaFactor","DstColorFactor","OneMinusDstColorFactor","SrcAlphaSaturateFactor","MultiplyOperation","MixOperation","AddOperation","UVMapping","CubeReflectionMapping","CubeRefractionMapping","EquirectangularReflectionMapping","EquirectangularRefractionMapping","SphericalReflectionMapping","RepeatWrapping","ClampToEdgeWrapping","MirroredRepeatWrapping","NearestFilter","NearestMipMapNearestFilter","NearestMipMapLinearFilter","LinearFilter","LinearMipMapNearestFilter","LinearMipMapLinearFilter","UnsignedByteType","ByteType","ShortType","UnsignedShortType","IntType","UnsignedIntType","FloatType","HalfFloatType","UnsignedShort4444Type","UnsignedShort5551Type","UnsignedShort565Type","AlphaFormat","RGBFormat","RGBAFormat","LuminanceFormat","LuminanceAlphaFormat","RGBEFormat","RGB_S3TC_DXT1_Format","RGBA_S3TC_DXT1_Format","RGBA_S3TC_DXT3_Format","RGBA_S3TC_DXT5_Format","RGB_PVRTC_4BPPV1_Format","RGB_PVRTC_2BPPV1_Format","RGBA_PVRTC_4BPPV1_Format","RGBA_PVRTC_2BPPV1_Format","Projector","projectVector","vector","project","unprojectVector","unproject","pickingRay","CanvasRenderer","Color","setRGB","r","g","setHex","setStyle","hex","setHSL","l","hue2rgb","p","q","t","exec","ColorKeywords","copyGammaToLinear","gammaFactor","copyLinearToGamma","safeInverse","convertGammaToLinear","convertLinearToGamma","getHex","getHexString","getHSL","optionalTarget","hue","saturation","hsl","lightness","getStyle","offsetHSL","addColors","color1","color2","addScalar","lerp","alpha","equals","fromArray","array","toArray","aliceblue","antiquewhite","aqua","aquamarine","azure","beige","bisque","black","blanchedalmond","blue","blueviolet","brown","burlywood","cadetblue","chartreuse","chocolate","coral","cornflowerblue","cornsilk","crimson","cyan","darkblue","darkcyan","darkgoldenrod","darkgray","darkgreen","darkgrey","darkkhaki","darkmagenta","darkolivegreen","darkorange","darkorchid","darkred","darksalmon","darkseagreen","darkslateblue","darkslategray","darkslategrey","darkturquoise","darkviolet","deeppink","deepskyblue","dimgray","dimgrey","dodgerblue","firebrick","floralwhite","forestgreen","fuchsia","gainsboro","ghostwhite","gold","goldenrod","gray","green","greenyellow","grey","honeydew","hotpink","indianred","indigo","ivory","khaki","lavender","lavenderblush","lawngreen","lemonchiffon","lightblue","lightcoral","lightcyan","lightgoldenrodyellow","lightgray","lightgreen","lightgrey","lightpink","lightsalmon","lightseagreen","lightskyblue","lightslategray","lightslategrey","lightsteelblue","lightyellow","lime","limegreen","linen","magenta","maroon","mediumaquamarine","mediumblue","mediumorchid","mediumpurple","mediumseagreen","mediumslateblue","mediumspringgreen","mediumturquoise","mediumvioletred","midnightblue","mintcream","mistyrose","moccasin","navajowhite","navy","oldlace","olive","olivedrab","orange","orangered","orchid","palegoldenrod","palegreen","paleturquoise","palevioletred","papayawhip","peachpuff","peru","pink","plum","powderblue","purple","red","rosybrown","royalblue","saddlebrown","salmon","sandybrown","seagreen","seashell","sienna","silver","skyblue","slateblue","slategray","slategrey","snow","springgreen","steelblue","tan","teal","thistle","tomato","turquoise","violet","wheat","white","whitesmoke","yellow","yellowgreen","_x","_y","_z","_w","onChangeCallback","euler","order","setFromAxisAngle","angle","halfAngle","m","te","elements","m11","m12","m13","m21","m22","m23","m31","m32","m33","trace","setFromUnitVectors","v1","EPS","vFrom","vTo","dot","crossVectors","normalize","inverse","conjugate","lengthSq","multiplyQuaternions","qax","qay","qaz","qaw","qbx","qby","qbz","qbw","multiplyVector3","applyQuaternion","slerp","qb","cosHalfTheta","halfTheta","acos","sinHalfTheta","ratioA","ratioB","onChange","qa","qm","Vector2","setX","setY","setComponent","getComponent","subScalar","divide","divideScalar","scalar","invScalar","clamp","clampScalar","minVal","maxVal","ceil","roundToZero","negate","distanceTo","distanceToSquared","dx","dy","setLength","oldLength","lerpVectors","v2","fromAttribute","attribute","itemSize","setZ","multiplyVectors","applyAxisAngle","applyMatrix3","applyProjection","qx","qy","qz","qw","ix","iy","iz","iw","multiplyMatrices","projectionMatrix","transformDirection","lengthManhattan","cross","ax","ay","az","bx","by","bz","projectOnVector","projectOnPlane","planeNormal","reflect","angleTo","theta","dz","setEulerFromRotationMatrix","setEulerFromQuaternion","getPositionFromMatrix","getScaleFromMatrix","setFromMatrixScale","getColumnFromMatrix","setFromMatrixColumn","sx","sy","sz","me","Vector4","setW","setAxisAngleFromQuaternion","setAxisAngleFromRotationMatrix","epsilon","epsilon2","xx","yy","zz","xy","xz","yz","_order","DefaultOrder","RotationOrders","setFromQuaternion","setFromVector3","reorder","newOrder","toVector3","optionalResult","Line3","line","center","result","distanceSq","distance","at","closestPointToPointParameter","startP","startEnd","point","clampToLine","startEnd2","startEnd_startP","closestPointToPoint","Box2","setFromPoints","makeEmpty","il","expandByPoint","setFromCenterAndSize","halfSize","box","empty","expandByVector","expandByScalar","containsPoint","containsBox","getParameter","isIntersectionBox","clampPoint","distanceToPoint","clampedPoint","intersect","union","translate","Box3","setFromObject","scope","traverse","node","Geometry","BufferGeometry","attributes","positions","getBoundingSphere","Sphere","Matrix3","n11","n12","n13","n21","n22","n23","n31","n32","n33","multiplyVector3Array","applyToVector3Array","determinant","f","throwOnInvertible","det","msg","transpose","tmp","flattenToArrayOffset","getNormalMatrix","transposeIntoArray","n14","n24","n34","n41","n42","n43","n44","extractPosition","copyPosition","extractBasis","xAxis","yAxis","zAxis","makeBasis","scaleX","scaleY","scaleZ","makeRotationFromEuler","ae","af","be","bf","ce","cf","de","df","ac","ad","bc","bd","setRotationFromQuaternion","x2","y2","z2","wx","wy","wz","lookAt","eye","a11","a12","a13","a14","a21","a22","a23","a24","a31","a32","a33","a34","a41","a42","a43","a44","b11","b12","b13","b14","b21","b22","b23","b24","b31","b32","b33","b34","b41","b42","b43","b44","multiplyToArray","multiplyVector4","rotateAxis","crossVector","getPosition","setPosition","rotateX","rotateY","rotateZ","rotateByAxis","getMaxScaleOnAxis","scaleXSq","scaleYSq","scaleZSq","makeTranslation","makeRotationX","makeRotationY","makeRotationZ","makeRotationAxis","tx","ty","makeScale","compose","decompose","invSX","invSY","invSZ","makeFrustum","near","far","makePerspective","fov","ymax","degToRad","ymin","xmin","xmax","makeOrthographic","Ray","origin","ray","recast","directionDistance","distanceSqToSegment","segCenter","segDir","diff","v0","optionalPointOnRay","optionalPointOnSegment","s0","sqrDist","extDet","segExtent","a01","b0","b1","invDet","isIntersectionSphere","sphere","intersectSphere","tca","d2","radius2","thc","t0","t1","isIntersectionPlane","plane","distToPoint","denominator","distanceToPlane","constant","intersectPlane","intersectBox","tmin","tmax","tymin","tymax","tzmin","tzmax","invdirx","invdiry","invdirz","intersectTriangle","edge1","edge2","backfaceCulling","DdN","DdQxE2","DdE1xQ","QdN","matrix4","optionalCenter","maxRadiusSq","intersectsSphere","radiusSum","deltaLengthSq","getBoundingBox","Frustum","p0","p1","p2","p3","p4","p5","planes","Plane","frustum","setFromMatrix","me0","me1","me2","me3","me4","me5","me6","me7","me8","me9","me10","me11","me12","me13","me14","me15","setComponents","intersectsObject","negRadius","intersectsBox","d1","setFromNormalAndCoplanarPoint","setFromCoplanarPoints","inverseNormalLength","distanceToSphere","projectPoint","orthoPoint","perpendicularMagnitude","isIntersectionLine","startSign","endSign","intersectLine","coplanarPoint","m1","optionalNormalMatrix","normalMatrix","newNormal","newCoplanarPoint","generateUUID","chars","rnd","random","join","clampBottom","mapLinear","a1","a2","b2","smoothstep","smootherstep","random16","randInt","randFloat","randFloatSpread","range","degreeToRadiansFactor","degrees","radToDeg","radianToDegreesFactor","radians","isPowerOfTwo","nextPowerOfTwo","Spline","interpolate","t2","t3","intPoint","weight","w2","w3","pa","pb","pc","pd","v3","initFromArray","getPoint","k","getControlPointsArray","coords","getLength","nSubDivisions","nSamples","oldIntPoint","oldPosition","tmpVec","chunkLengths","totalLength","chunks","reparametrizeByArcLength","samplingCoef","indexCurrent","indexNext","realDistance","sampling","newpoints","sl","Triangle","resultLengthSq","barycoordFromPoint","dot00","dot01","dot02","dot11","dot12","denom","invDenom","u","setFromPointsAndIndices","i0","i1","i2","triangle","area","midpoint","autoStart","oldTime","elapsedTime","running","stop","getElapsedTime","getDelta","newTime","EventDispatcher","hasEventListener","listener","_listeners","listeners","listenerArray","Raycaster","Sprite","PointCloud","LOD","Line","descSort","intersectObject","raycaster","intersects","recursive","raycast","precision","linePrecision","setFromCamera","OrthographicCamera","sort","intersectObjects","objects","Object3DIdCount","DefaultUp","onRotationChange","onQuaternionChange","defineProperties","rotationAutoUpdate","matrixAutoUpdate","matrixWorldNeedsUpdate","visible","frustumCulled","renderOrder","userData","eulerOrder","useQuaternion","applyMatrix","setRotationFromAxisAngle","setRotationFromEuler","setRotationFromMatrix","rotateOnAxis","q1","translateOnAxis","localToWorld","worldToLocal","getChildByName","getObjectByName","getObjectById","getObjectByProperty","getWorldPosition","getWorldQuaternion","getWorldRotation","getWorldScale","getWorldDirection","traverseVisible","traverseAncestors","toJSON","metadata","version","generator","geometries","parseGeometry","json","parseMaterial","parseObject","JSON","stringify","intensity","PointLight","decay","SpotLight","exponent","HemisphereLight","groundColor","materialIndex","vertexNormals","vertexColors","vertexTangents","BufferAttribute","needsUpdate","copyAt","index1","index2","setXY","setXYZ","setXYZW","Int8Attribute","Uint8Attribute","Uint8ClampedAttribute","Int16Attribute","Uint16Attribute","Int32Attribute","Uint32Attribute","Float32Attribute","Float64Attribute","DynamicBufferAttribute","updateRange","count","create","GeometryIdCount","attributesKeys","drawcalls","addAttribute","addDrawCall","indexOffset","fromGeometry","settings","faceVertexUvs","hasFaceVertexUv","hasFaceVertexNormals","normals","colors","uvs","i3","na","nb","nc","fc","vca","vcb","vcc","uva","uvb","uvc","bb","isNaN","computeFaceNormals","computeVertexNormals","vA","vB","vC","pA","pB","pC","cb","indices","jl","normalizeNormals","computeTangents","handleTriangle","uvA","uvB","uvC","x1","y1","z1","sdir","tdir","tan1","tan2","handleVertex","n2","tmp2","tangents","uv","nVertices","tangent","iA","iB","iC","computeOffsets","facesCount","sortedIndices","Uint16Array","indexPtr","vertexPtr","duplicatedVertices","newVerticeMaps","faceVertices","Int32Array","vertexMap","revVertexMap","findex","vo","vid","faceMax","new_offset","new_vid","reorderBuffers","merge","attribute1","attributeArray1","attribute2","attributeArray2","attributeSize","indexBuffer","indexMap","vertexCount","sortedAttributes","attr","sourceArray","attrArray","attrSize","sortedAttr","numItems","sourceAttr","dispose","morphTargets","morphColors","morphNormals","skinWeights","skinIndices","lineDistances","hasTangents","dynamic","verticesNeedUpdate","elementsNeedUpdate","uvsNeedUpdate","normalsNeedUpdate","tangentsNeedUpdate","colorsNeedUpdate","lineDistancesNeedUpdate","groupsNeedUpdate","vertex","fromBufferGeometry","tempNormals","tempUVs","addFace","drawcall","fl","areaWeighted","vl","computeMorphNormals","__originalFaceNormal","__originalVertexNormals","tmpGeo","faceNormals","faceNormal","dstNormalsFace","dstNormalsVertex","context","ua","ub","uc","vertexIndex","faceIndex","computeLineDistances","materialIndexOffset","vertexOffset","vertices1","vertices2","faces1","faces2","uvs1","uvs2","vertexCopy","faceCopy","faceVertexNormals","faceVertexColors","uvCopy","mergeMesh","mergeVertices","verticesMap","unique","changes","precisionPoints","faceIndicesToRemove","dupIndex","idx","setBit","getNormalIndex","hash","normalsHash","getColorIndex","colorsHash","getUvIndex","uvsHash","hasMaterial","hasFaceUv","hasFaceNormal","hasFaceVertexNormal","hasFaceColor","hasFaceVertexColor","faceType","uvsCopy","kl","Camera","matrixWorldInverse","CubeCamera","cubeResolution","cameraPX","cameraNX","cameraPY","cameraNY","cameraPZ","cameraNZ","renderTarget","WebGLRenderTargetCube","format","magFilter","minFilter","updateCubeMap","generateMipmaps","activeCubeFace","zoom","cx","cy","setLens","focalLength","frameHeight","atan","setViewOffset","fullWidth","fullHeight","Light","light","AreaLight","constantAttenuation","linearAttenuation","quadraticAttenuation","onlyShadow","shadowCameraNear","shadowCameraFar","shadowCameraLeft","shadowCameraRight","shadowCameraTop","shadowCameraBottom","shadowCameraVisible","shadowBias","shadowDarkness","shadowMapWidth","shadowMapHeight","shadowCascade","shadowCascadeOffset","shadowCascadeCount","shadowCascadeBias","shadowCascadeWidth","shadowCascadeHeight","shadowCascadeNearZ","shadowCascadeFarZ","shadowCascadeArray","shadowMap","shadowMapSize","shadowCamera","shadowMatrix","skyColor","shadowCameraFov","Cache","files","file","get","Loader","showStatus","statusDomElement","addStatusElement","imageLoader","ImageLoader","onLoadStart","onLoadProgress","onLoadComplete","crossOrigin","fontSize","textAlign","background","padding","zIndex","updateProgress","toFixed","extractUrlBase","url","parts","initMaterials","texturePath","needsTangents","ShaderMaterial","nearest_pow2","LN2","create_texture","where","sourceFile","repeat","wrap","anisotropy","texture","fullPath","loader","Handlers","Texture","image","wrapS","wrapT","wrapMap","mirror","rgb2hex","rgb","mtype","mpars","opacity","map","lightMap","normalMap","bumpMap","wireframe","shading","toLowerCase","blending","transparent","depthTest","depthWrite","flipSided","side","doubleSided","colorDiffuse","DbgColor","colorSpecular","specular","colorEmissive","emissive","specularCoef","shininess","mapDiffuse","mapDiffuseRepeat","mapDiffuseOffset","mapDiffuseWrap","mapDiffuseAnisotropy","mapLight","mapLightRepeat","mapLightOffset","mapLightWrap","mapLightAnisotropy","mapBump","mapBumpRepeat","mapBumpOffset","mapBumpWrap","mapBumpAnisotropy","mapNormal","mapNormalRepeat","mapNormalOffset","mapNormalWrap","mapNormalAnisotropy","mapSpecular","mapSpecularRepeat","mapSpecularOffset","mapSpecularWrap","mapSpecularAnisotropy","mapAlpha","mapAlphaRepeat","mapAlphaOffset","mapAlphaWrap","mapAlphaAnisotropy","mapBumpScale","bumpScale","mapNormalFactor","normalScale","DbgName","handlers","regex","XHRLoader","manager","DefaultLoadingManager","onLoad","onProgress","onError","cached","request","response","itemEnd","responseType","itemStart","setResponseType","setCrossOrigin","withCredentials","loadAjaxJSON","callbackProgress","xhr","onreadystatechange","readyState","DONE","status","LOADING","getResponseHeader","HEADERS_RECEIVED","parseModel","isBitSet","fi","zLength","colorIndex","normalIndex","uvIndex","isQuad","faceA","faceB","uvLayer","nUvLayers","parseSkin","influencesPerVertex","bones","animation","animations","parseMorphing","dstVertices","srcVertices","cl","dstColors","srcColors","BufferGeometryLoader","text","typedArray","MaterialLoader","uniforms","vertexShader","fragmentShader","sizeAttenuation","ObjectLoader","substring","lastIndexOf","setTexturePath","parseGeometries","images","parseImages","parseTextures","parseMaterials","geometryLoader","bufferGeometryLoader","widthSegments","heightSegments","depthSegments","CircleGeometry","segments","CylinderGeometry","radiusTop","radiusBottom","radialSegments","openEnded","phiStart","phiLength","thetaStart","thetaLength","IcosahedronGeometry","detail","TorusGeometry","tube","tubularSegments","arc","TorusKnotGeometry","heightScale","alphaMap","envMap","specularMap","loadImage","getGeometry","getMaterial","Group","TextureLoader","DataTextureLoader","BinaryTextureLoader","_parser","DataTexture","texData","mipmaps","mipmapCount","CompressedTextureLoader","CompressedTexture","texDatas","isCubemap","Material","MaterialIdCount","blendSrc","blendDst","blendEquation","blendSrcAlpha","blendDstAlpha","blendEquationAlpha","colorWrite","polygonOffset","polygonOffsetFactor","polygonOffsetUnits","alphaTest","overdraw","_needsUpdate","setValues","values","newValue","currentValue","Number","MeshLambertMaterial","MeshDepthMaterial","PointCloudMaterial","SpriteMaterial","LineBasicMaterial","linewidth","linecap","linejoin","fog","LineDashedMaterial","dashSize","gapSize","combine","reflectivity","refractionRatio","wireframeLinewidth","wireframeLinecap","wireframeLinejoin","skinning","wrapAround","wrapRGB","metal","ParticleBasicMaterial","ParticleSystemMaterial","defines","lights","defaultAttributeValues","uv2","index0AttributeName","UniformsUtils","RawShaderMaterial","mapping","TextureIdCount","DEFAULT_IMAGE","DEFAULT_MAPPING","premultiplyAlpha","flipY","unpackAlignment","onUpdate","CubeTexture","VideoTexture","video","HAVE_ENOUGH_DATA","inverseMatrix","localThreshold","testPoint","rayPointDistance","intersectPoint","distanceToRay","oi","ol","pointCount","ParticleSystem","LineStrip","LinePieces","precisionSq","vStart","vEnd","interSegment","interRay","distSq","offsetIndex","nbVertices","updateMorphTargets","morphTargetBase","morphTargetForcedOrder","morphTargetInfluences","morphTargetDictionary","ml","getMorphTargetIndexByName","intersectionPoint","isFaceMaterial","objectMaterials","morphInfluences","tl","influence","targets","Bone","skin","Skeleton","boneInverses","useVertexTexture","identityMatrix","boneTextureWidth","boneTextureHeight","boneMatrices","boneTexture","calculateInverses","bl","pose","bone","offsetMatrix","SkinnedMesh","bindMode","bindMatrix","bindMatrixInverse","gbone","rotq","scl","normalizeSkinWeights","skeleton","sw","MorphAnimMesh","duration","mirroredLoop","lastKeyframe","currentKeyframe","directionBackwards","setFrameRange","startKeyframe","endKeyframe","setDirectionForward","setDirectionBackward","parseAnimations","firstAnimation","pattern","morph","match","setAnimationLabel","playAnimation","updateAnimation","frameTime","keyframe","mix","interpolateTargets","influences","addLevel","getObjectForDistance","matrixPosition","Particle","LensFlare","lensFlares","positionScreen","customUpdateCallback","updateLensFlares","flare","vecX","vecY","wantedRotation","overrideMaterial","autoUpdate","Fog","FogExp2","density","ShaderChunk","merged","uniforms_src","uniforms_dst","parameter_src","UniformsLib","common","diffuse","offsetRepeat","flipEnvMap","bump","normalmap","fogDensity","fogNear","fogFar","fogColor","ambientLightColor","directionalLightDirection","directionalLightColor","hemisphereLightDirection","hemisphereLightSkyColor","hemisphereLightGroundColor","pointLightColor","pointLightPosition","pointLightDistance","pointLightDecay","spotLightColor","spotLightPosition","spotLightDirection","spotLightDistance","spotLightAngleCos","spotLightExponent","spotLightDecay","particle","psColor","shadowmap","ShaderLib","basic","lambert","phong","particle_basic","dashed","totalSize","mNear","mFar","cube","tCube","tFlip","equirect","tEquirect","depthRGBA","createParticleBuffers","__webglVertexBuffer","_gl","createBuffer","__webglColorBuffer","info","memory","createLineBuffers","__webglLineDistanceBuffer","createMeshBuffers","geometryGroup","__webglNormalBuffer","__webglTangentBuffer","__webglUVBuffer","__webglUV2Buffer","__webglSkinIndicesBuffer","__webglSkinWeightsBuffer","__webglFaceBuffer","__webglLineBuffer","numMorphTargets","__webglMorphTargetsBuffers","numMorphNormals","__webglMorphNormalsBuffers","initCustomAttributes","nvertices","__webglCustomAttributesList","__webglInitialized","createUniqueBuffers","belongsToAttribute","initParticleBuffers","__vertexArray","__colorArray","__webglParticleCount","initLineBuffers","__lineDistanceArray","__webglLineCount","initMeshBuffers","faces3","ntris","nlines","getBufferMaterial","__normalArray","__uvArray","__uv2Array","__tangentArray","__skinIndexArray","__skinWeightArray","UintArray","extensions","Uint32Array","__typeArray","__faceArray","__lineArray","__morphTargetsArrays","__morphNormalsArrays","__webglFaceCount","originalAttribute","property","__original","__inittedArrays","materialNeedsFaceNormals","setParticleBuffers","hint","ca","cal","customAttribute","vertexArray","colorArray","dirtyVertices","dirtyColors","customAttributes","bindBuffer","ARRAY_BUFFER","bufferData","boundTo","setLineBuffers","dl","lineDistanceArray","dirtyLineDistances","setMeshBuffers","faceColor","n1","n3","sw1","sw2","sw3","si1","si2","si3","vn","uvi","uv2i","vk","vkl","vka","nka","chf","needsFaceNormals","offset_uv","offset_uv2","offset_face","offset_normal","offset_tangent","offset_line","offset_color","offset_skin","offset_morphTarget","offset_custom","uvArray","uv2Array","normalArray","tangentArray","skinIndexArray","skinWeightArray","morphTargetsArrays","morphNormalsArrays","faceArray","lineArray","dirtyElements","dirtyUvs","dirtyNormals","dirtyTangents","dirtyMorphTargets","morphTargetsNeedUpdate","chunk_faces3","obj_faces","obj_uvs","obj_uvs2","obj_skinIndices","obj_skinWeights","ELEMENT_ARRAY_BUFFER","pp","setupVertexAttributes","program","startIndex","geometryAttributes","programAttributes","programAttributesKeys","programAttribute","geometryAttribute","state","enableAttribute","vertexAttribPointer","FLOAT","vertexAttrib2fv","vertexAttrib3fv","disableUnusedAttributes","setupMorphTargets","numSupportedMorphTargets","__webglMorphTargetInfluences","activeInfluenceIndices","numericalSort","numSupportedMorphNormals","influenceIndex","uniform1fv","painterSortStable","reversePainterSortStable","projectObject","initObject","sprites","webglObjects","_webglObjects","_frustum","webglObject","unrollBufferMaterial","sortObjects","_vector3","_projScreenMatrix","renderObjects","renderList","setupMatrices","setMaterial","setMaterialFaces","renderBufferDirect","renderBuffer","renderObjectsImmediate","materialType","renderImmediateObject","unrollImmediateBufferMaterial","globject","opaque","transparentObjects","opaqueObjects","__webglInit","_modelViewMatrix","_normalMatrix","onObjectRemoved","onGeometryDispose","initGeometryGroups","__webglActive","addBuffer","geometryGroupsList","geometryGroups","ImmediateRenderObject","immediateRenderCallback","addBufferImmediate","_webglObjectsImmediate","makeGroups","usesFaceMaterial","groupHash","group","maxVerticesInGroup","hash_map","groups","groupsList","counter","geometryGroupCounter","addBuffers","objlist","updateObject","bufferType","DYNAMIC_DRAW","STATIC_DRAW","bufferSubData","BYTES_PER_ELEMENT","subarray","customAttributesDirty","areCustomAttributesDirty","clearCustomAttributes","removeObject","removeInstances","o","initMaterial","onMaterialDispose","shaderID","shaderIDs","shader","__webglShader","maxLightCount","allocateLights","maxShadows","allocateShadows","maxBones","allocateBones","_precision","supportsVertexTextures","_supportsVertexTextures","envMapMode","useFog","fogExp","flatShading","logarithmicDepthBuffer","_logarithmicDepthBuffer","_supportsBoneTextures","maxMorphTargets","maxMorphNormals","maxDirLights","directional","maxPointLights","maxSpotLights","spot","maxHemiLights","hemi","shadowMapEnabled","shadowMapType","shadowMapDebug","shadowMapCascade","pl","_programs","programInfo","usedTimes","WebGLProgram","programs","uniformsList","location","setBlending","setDepthTest","setDepthWrite","setColorWrite","setPolygonOffset","setProgram","_usedTextureUnits","deallocateMaterial","refreshProgram","refreshMaterial","refreshLights","p_uniforms","m_uniforms","_currentProgram","useProgram","_currentMaterialId","_currentCamera","uniformMatrix4fv","uniform1f","logDepthBufFC","cameraPosition","uniform3f","viewMatrix","textureUnit","getTextureUnit","uniform1i","setTexture","boneGlobalMatrices","refreshUniformsFog","_lightsNeedUpdate","setupLights","refreshUniformsLights","_lights","markUniformsLightsNeedsUpdate","refreshUniformsCommon","refreshUniformsLine","refreshUniformsDash","refreshUniformsParticle","refreshUniformsPhong","refreshUniformsLambert","_shadowPass","refreshUniformsShadow","loadUniformsGeneric","loadUniformsMatrices","modelMatrix","uvScaleMap","_canvas","ambient","distances","decays","directions","anglesCos","exponents","skyColors","groundColors","modelViewMatrix","uniformMatrix3fv","_maxTextures","uniform","uniform2f","uniform4f","uniform1iv","uniform3iv","uniform2fv","uniform3fv","uniform4fv","_array","setCubeTexture","setCubeTextureDynamic","setColorLinear","ll","zlights","dirColors","dirPositions","pointColors","pointPositions","pointDistances","pointDecays","spotColors","spotPositions","spotDistances","spotDirections","spotAnglesCos","spotExponents","spotDecays","hemiSkyColors","hemiGroundColors","hemiPositions","dirLength","pointLength","spotLength","hemiLength","dirCount","spotCount","hemiCount","dirOffset","pointOffset","spotOffset","hemiOffset","_direction","setTextureParameters","textureType","isImagePowerOfTwo","extension","texParameteri","TEXTURE_WRAP_S","paramThreeToGL","TEXTURE_WRAP_T","TEXTURE_MAG_FILTER","TEXTURE_MIN_FILTER","CLAMP_TO_EDGE","filterFallback","__currentAnisotropy","texParameterf","TEXTURE_MAX_ANISOTROPY_EXT","getMaxAnisotropy","clampToMaxSize","maxSize","slot","__webglTextureCube","onTextureDispose","createTexture","activeTexture","TEXTURE0","bindTexture","TEXTURE_CUBE_MAP","pixelStorei","UNPACK_FLIP_Y_WEBGL","isCompressed","isDataTexture","cubeImage","autoScaleCubemaps","_maxCubemapSize","glFormat","glType","mipmap","getCompressedTextureFormats","compressedTexImage2D","TEXTURE_CUBE_MAP_POSITIVE_X","texImage2D","generateMipmap","__webglTexture","setupFrameBuffer","framebuffer","textureTarget","bindFramebuffer","FRAMEBUFFER","framebufferTexture2D","COLOR_ATTACHMENT0","setupRenderBuffer","renderbuffer","bindRenderbuffer","RENDERBUFFER","depthBuffer","stencilBuffer","renderbufferStorage","DEPTH_COMPONENT16","framebufferRenderbuffer","DEPTH_ATTACHMENT","DEPTH_STENCIL","DEPTH_STENCIL_ATTACHMENT","RGBA4","updateRenderTargetMipmap","TEXTURE_2D","NEAREST","LINEAR","REPEAT","MIRRORED_REPEAT","NEAREST_MIPMAP_NEAREST","NEAREST_MIPMAP_LINEAR","LINEAR_MIPMAP_NEAREST","LINEAR_MIPMAP_LINEAR","UNSIGNED_BYTE","UNSIGNED_SHORT_4_4_4_4","UNSIGNED_SHORT_5_5_5_1","UNSIGNED_SHORT_5_6_5","BYTE","SHORT","UNSIGNED_SHORT","INT","UNSIGNED_INT","HALF_FLOAT_OES","ALPHA","RGB","RGBA","LUMINANCE","LUMINANCE_ALPHA","FUNC_ADD","FUNC_SUBTRACT","FUNC_REVERSE_SUBTRACT","ZERO","ONE","SRC_COLOR","ONE_MINUS_SRC_COLOR","SRC_ALPHA","ONE_MINUS_SRC_ALPHA","DST_ALPHA","ONE_MINUS_DST_ALPHA","DST_COLOR","ONE_MINUS_DST_COLOR","SRC_ALPHA_SATURATE","COMPRESSED_RGB_S3TC_DXT1_EXT","COMPRESSED_RGBA_S3TC_DXT1_EXT","COMPRESSED_RGBA_S3TC_DXT3_EXT","COMPRESSED_RGBA_S3TC_DXT5_EXT","COMPRESSED_RGB_PVRTC_4BPPV1_IMG","COMPRESSED_RGB_PVRTC_2BPPV1_IMG","COMPRESSED_RGBA_PVRTC_4BPPV1_IMG","COMPRESSED_RGBA_PVRTC_2BPPV1_IMG","MIN_EXT","MAX_EXT","nVertexUniforms","MAX_VERTEX_UNIFORM_VECTORS","nVertexMatrices","dirLights","pointLights","spotLights","hemiLights","_context","pixelRatio","_alpha","_depth","_stencil","stencil","_antialias","_premultipliedAlpha","premultipliedAlpha","_preserveDrawingBuffer","preserveDrawingBuffer","_clearColor","_clearAlpha","autoClear","autoClearColor","autoClearDepth","autoClearStencil","gammaInput","gammaOutput","shadowMapCullFace","calls","_currentFramebuffer","_currentGeometryProgram","_viewportX","_viewportY","_viewportWidth","_viewportHeight","_currentWidth","_currentHeight","resetGLState","setDefaultGLState","WebGLState","getShaderPrecisionFormat","rangeMin","rangeMax","WebGLExtensions","glClearColor","clearColor","clearDepth","clearStencil","enable","DEPTH_TEST","depthFunc","LEQUAL","frontFace","CCW","cullFace","BACK","CULL_FACE","BLEND","blendFunc","viewport","reset","MAX_TEXTURE_IMAGE_UNITS","_maxVertexTextures","MAX_VERTEX_TEXTURE_IMAGE_UNITS","_maxTextureSize","MAX_TEXTURE_SIZE","MAX_CUBE_MAP_TEXTURE_SIZE","_vertexShaderPrecisionHighpFloat","VERTEX_SHADER","HIGH_FLOAT","_vertexShaderPrecisionMediumpFloat","MEDIUM_FLOAT","_fragmentShaderPrecisionHighpFloat","FRAGMENT_SHADER","_fragmentShaderPrecisionMediumpFloat","formats","COMPRESSED_TEXTURE_FORMATS","highpAvailable","mediumpAvailable","shadowMapPlugin","ShadowMapPlugin","spritePlugin","SpritePlugin","lensFlarePlugin","LensFlarePlugin","forceContextLoss","loseContext","supportsFloatTextures","supportsHalfFloatTextures","supportsStandardDerivatives","supportsCompressedTextureS3TC","supportsCompressedTexturePVRTC","supportsBlendMinMax","MAX_TEXTURE_MAX_ANISOTROPY_EXT","getPrecision","getPixelRatio","setPixelRatio","updateStyle","setViewport","setScissor","scissor","enableScissorTest","SCISSOR_TEST","disable","getClearColor","getClearAlpha","setClearAlpha","COLOR_BUFFER_BIT","DEPTH_BUFFER_BIT","STENCIL_BUFFER_BIT","clearTarget","setRenderTarget","deallocateGeometry","deallocateTexture","onRenderTargetDispose","deallocateRenderTarget","deleteBuffers","buffers","deleteBuffer","deleteTexture","deleteFramebuffer","__webglFramebuffer","deleteRenderbuffer","__webglRenderbuffer","deleteProgram","newPrograms","renderBufferImmediate","initAttributes","hasPositions","hasNormals","hasUvs","__webglUvBuffer","hasColors","positionArray","nx","ny","nz","nax","nbx","ncx","nay","nby","ncy","naz","nbz","ncz","drawArrays","TRIANGLES","updateBuffers","wireframeBit","geometryProgram","LINES","drawElements","POINTS","LINE_STRIP","setLineWidth","skinIndex","skinWeight","lineDistance","forceClear","setFaceCulling","frontFaceDirection","CW","FRONT","FRONT_AND_BACK","setDoubleSided","setFlipSided","uploadTexture","UNPACK_PREMULTIPLY_ALPHA_WEBGL","UNPACK_ALIGNMENT","isCube","isTargetPowerOfTwo","createFramebuffer","createRenderbuffer","shareDepthFrom","vx","vy","readRenderTargetPixels","WebGLRenderTarget","restore","checkFramebufferStatus","FRAMEBUFFER_COMPLETE","readPixels","addPrePlugin","addPostPlugin","updateShadowMap","gl","getExtension","programIdCount","generateDefines","chunk","cacheUniformLocations","identifiers","getUniformLocation","cacheAttributeLocations","getAttribLocation","shadowMapTypeDefine","envMapTypeDefine","envMapModeDefine","envMapBlendingDefine","prefix_vertex","prefix_fragment","gammaFactorDefine","customDefines","createProgram","glVertexShader","WebGLShader","glFragmentShader","attachShader","bindAttribLocation","linkProgram","programLogInfo","getProgramInfoLog","getProgramParameter","LINK_STATUS","getError","VALIDATE_STATUS","deleteShader","addLineNumbers","string","lines","createShader","shaderSource","compileShader","getShaderParameter","COMPILE_STATUS","getShaderInfoLog","newAttributes","enabledAttributes","currentBlending","currentBlendEquation","currentBlendSrc","currentBlendDst","currentBlendEquationAlpha","currentBlendSrcAlpha","currentBlendDstAlpha","currentDepthTest","currentDepthWrite","currentColorWrite","currentDoubleSided","currentFlipSided","currentLineWidth","currentPolygonOffset","currentPolygonOffsetFactor","currentPolygonOffsetUnits","enableVertexAttribArray","disableVertexAttribArray","blendEquationSeparate","blendFuncSeparate","depthMask","colorMask","polygonoffset","units","POLYGON_OFFSET_FILL","flares","prefix","vertexBuffer","elementBuffer","hasVertexTexture","tempTexture","occlusionTexture","renderType","occlusionMap","screenPosition","viewportWidth","viewportHeight","tempPosition","invAspect","halfViewportWidth","halfViewportHeight","screenPositionPixels","TEXTURE1","copyTexImage2D","sprite","_renderer","_renderList","createVirtualLight","cascade","virtualLight","isVirtual","pointsWorld","pointsFrustum","nearZ","farZ","updateVirtualLight","updateShadowCamera","_min","_max","getObjectMaterial","_depthMaterial","_depthMaterialMorph","_depthMaterialSkin","_depthMaterialMorphSkin","_matrixPosition","depthShader","depthUniforms","originalCamera","gyro","Gyroscope","shadowFilter","pars","cameraHelper","CameraHelper","objectMaterial","useMorphing","useSkinning","customDepthMaterial","clearAlpha","spritePosition","spriteRotation","spriteScale","uvOffset","uvScale","fogType","oldFogType","sceneFogType","GeometryUtils","geometry1","geometry2","loadTextureCube","loadCompressedTexture","loadCompressedTextureCube","getNormalMap","subtract","imageData","createImageData","ly","uy","lx","ux","num_points","generateDataTexture","SceneUtils","createMultiMaterialObject","detach","attach","FontUtils","divisions","getFace","loadFace","family","familyName","ThreeFont","cssFontWeight","cssFontStyle","drawText","resolution","fontPaths","Path","ret","extractGlyphPoints","paths","outline","action","cpx","cpy","cpx0","cpy0","cpx1","cpy1","cpx2","cpy2","laste","pts","glyph","glyphs","_cachedOutline","quadraticCurveTo","Shape","Utils","bezierCurveTo","b3","ha","generateShapes","curveSegments","font","shapes","toShapes","namespace","EPSILON","process","contour","verts","vertIndices","nv","snip","px","py","aX","aY","bX","bY","cX","cY","apx","apy","bpx","bpy","cCROSSap","bCROSScp","aCROSSbp","Triangulate","_typeface_js","typeface_js","Audio","source","createBufferSource","onended","onEnded","gain","createGain","connect","destination","panner","createPanner","autoplay","isPlaying","decodeAudioData","loop","setLoop","setRefDistance","refDistance","setRolloffFactor","rolloffFactor","setVolume","AudioListener","AudioContext","webkitAudioContext","orientation","positionPrev","setOrientation","setVelocity","Curve","getPointAt","getUtoTmapping","getPoints","getSpacedPoints","lengths","getLengths","cacheArcLengths","current","cache","sum","updateArcLengths","targetArcLength","arcLengths","comparison","lengthBefore","lengthAfter","segmentLength","segmentFraction","getTangent","pt1","pt2","vec","getTangentAt","tangentQuadraticBezier","tangentCubicBezier","tangentSpline","h00","h10","h01","h11","getPointFunc","CurvePath","curves","bends","autoClose","curve","checkConnection","closePath","startPoint","endPoint","LineCurve","curveLengths","getCurveLengths","lens","cacheLengths","sums","maxX","maxY","maxZ","minX","minY","minZ","NEGATIVE_INFINITY","POSITIVE_INFINITY","createPointsGeometry","createGeometry","createSpacedPointsGeometry","addWrapPath","bendpath","getTransformedPoints","oldPts","getWrapPoints","getTransformedSpacedPoints","oldX","oldY","xNorm","bounds","pathPt","translationObject","quaternionObject","scaleObject","translationWorld","quaternionWorld","scaleWorld","actions","fromPoints","PathActions","MOVE_TO","LINE_TO","QUADRATIC_CURVE_TO","BEZIER_CURVE_TO","CSPLINE_THRU","ARC","ELLIPSE","vectors","vlen","args","lastargs","x0","y0","aCPx","aCPy","QuadraticBezierCurve","aCP1x","aCP1y","aCP2x","aCP2y","CubicBezierCurve","splineThru","npts","SplineCurve","aRadius","aStartAngle","aEndAngle","aClockwise","absarc","absellipse","ellipse","xRadius","yRadius","EllipseCurve","lastPoint","closedPath","useSpacedPoints","item","spts","spline","deltaAngle","tdivisions","isCCW","noHoles","extractSubpaths","inActions","subPaths","lastPath","toShapesNoHoles","inSubpaths","tmpPath","tmpShape","isPointInsidePolygon","inPt","inPolygon","polyLen","inside","edgeLowPt","edgeHighPt","edgeDx","edgeDy","perpEdge","solid","holesFirst","isClockWise","tmpPoints","betterShapeHoles","newShapes","newShapeHoles","mainIdx","ambigious","toChange","sIdx","sLen","sho","hIdx","ho","hole_unassigned","s2Idx","froms","tos","hole","tmpHoles","holes","extrude","extruded","ExtrudeGeometry","makeGeometry","ShapeGeometry","getPointsHoles","holesPts","getSpacedPointsHoles","extractAllPoints","shape","extractPoints","extractAllSpacedPoints","triangulateShape","point_in_segment_2D_colin","inSegPt1","inSegPt2","inOtherPt","intersect_segments_2D","inSeg1Pt1","inSeg1Pt2","inSeg2Pt1","inSeg2Pt2","inExcludeAdjacentSegs","seg1dx","seg1dy","seg2dx","seg2dy","seg1seg2dx","seg1seg2dy","perpSeg1","perpSeg2","factorSeg1","seg1Pt","seg2Pt","seg1min","seg1max","seg1minVal","seg1maxVal","seg2min","seg2max","seg2minVal","seg2maxVal","isPointInsideAngle","inVertex","inLegFromPt","inLegToPt","legFromPtX","legFromPtY","legToPtX","legToPtY","otherPtX","otherPtY","from2toAngle","from2otherAngle","other2toAngle","removeHoles","isCutLineInsideAngles","inShapeIdx","inHoleIdx","lastShapeIdx","prevShapeIdx","nextShapeIdx","insideAngle","lastHoleIdx","prevHoleIdx","nextHoleIdx","intersectsShapeEdge","inShapePt","inHolePt","nextIdx","intersection","intersectsHoleEdge","ihIdx","chkHole","indepHoles","holeIndex","shapeIndex","shapePt","holePt","holeIdx","cutKey","tmpShape1","tmpShape2","tmpHole1","tmpHole2","failedCuts","hl","minShapeIndex","h2","allPointsMap","allpoints","shapeWithoutHoles","b2p0","b2p1","b2p2","b3p0","b3p1","b3p2","b3p3","point0","point1","point2","point3","ArcCurve","LineCurve3","QuadraticBezierCurve3","CubicBezierCurve3","SplineCurve3","ClosedSplineCurve3","AnimationHandler","CATMULLROM","CATMULLROM_FORWARD","hierarchy","rot","usedMorphTargets","morphTargetName","morphTargetsInfluences","parseRecurseHierarchy","deltaTimeMS","resetBlendWeights","Animation","timeScale","interpolationType","keyTypes","animationCache","positionWeight","quaternionWeight","scaleWeight","prevKey","nextKey","originalMatrix","getNextKeyWith","newVector","newQuat","interpolateCatmullRom","prevXYZ","nextXYZ","proportionalWeight","getPrevKeyWith","currentPoint","forwardPoint","KeyFrameAnimation","isPaused","sids","sid","next","endTime","original","hasTarget","MorphAnimation","lastFrame","currentFrame","interpolation","buildPlane","udir","vdir","gridX","gridY","width_half","height_half","gridX1","gridY1","segment_width","segment_height","uvd","depth_half","centerUV","segment","CubeGeometry","heightHalf","verticesRow","uvsRow","tanTheta","v4","n4","uv1","uv3","uv4","addShapeList","addShape","scalePt2","pt","getBevelVec","inPrev","inNext","v_trans_x","v_trans_y","shrink_by","v_prev_x","v_prev_y","v_next_x","v_next_y","v_prev_lensq","colinear0","v_prev_len","v_next_len","ptPrevShift_x","ptPrevShift_y","ptNextShift_x","ptNextShift_y","sf","v_trans_lensq","direction_eq","buildLidFaces","bevelEnabled","layer","flen","f3","bevelSegments","buildSideFaces","layeroffset","sidewalls","ahole","slen1","slen2","f4","shapesOffset","uvgen","generateTopUV","wallContour","stepIndex","stepsLength","contourIndex1","contourIndex2","extrudeMaterial","generateSideWallUV","extrudePts","splineTube","binormal","position2","bevelThickness","bevelSize","extrudePath","extrudeByPath","UVGenerator","WorldUVGenerator","TubeGeometry","FrenetFrames","shapePoints","reverse","bs","vert","contourMovements","oneHoleMovements","holesMovements","verticesMovements","binormals","indexA","indexB","indexC","indexD","LatheGeometry","inversePointLength","inverseSegments","phi","np","u0","u1","PlaneGeometry","PlaneBufferGeometry","offset2","RingGeometry","innerRadius","outerRadius","thetaSegments","phiSegments","radiusStep","thetaSegment","TextGeometry","textShapes","getPos","in_q","in_p","cu","su","quOverP","cs","tz","grid","tang","bitan","ip","jp","closed","taper","NoTaper","numpoints","pos2","SinusoidalTaper","initialNormal3","smallest","MAX_VALUE","mat","PolyhedronGeometry","prepare","that","azimuth","inclination","centroid","azi","correctUV","subdivide","cols","bj","DodecahedronGeometry","OctahedronGeometry","TetrahedronGeometry","ParametricGeometry","func","slices","stacks","sliceCount","AxisHelper","ArrowHelper","lineGeometry","coneGeometry","headLength","headWidth","cone","setDirection","setColor","BoxHelper","BoundingBoxHelper","addLine","addPoint","pointMap","hexFrustum","hexCone","hexUp","hexTarget","hexCross","setPoint","DirectionalLightHelper","lightPlane","targetLine","EdgesHelper","thresholdAngle","thresholdDot","edge","sortFunction","numEdges","vert1","vert2","face1","face2","FaceNormalsHelper","objectVertices","objectFaces","objectWorldMatrix","GridHelper","setColors","colorCenterLine","colorGrid","HemisphereLightHelper","sphereSize","lightSphere","PointLightHelper","SkeletonHelper","getBoneList","boneList","matrixWorldInv","boneMatrix","SpotLightHelper","vector2","coneLength","coneWidth","VertexNormalsHelper","worldMatrix","vertexId","VertexTangentsHelper","WireframeHelper","edges","numTris","renderCallback","MorphBlendMesh","animationsMap","animationsList","numFrames","startFrame","endFrame","createAnimation","setAnimationWeight","active","autoCreateAnimations","frameRanges","setAnimationDirectionForward","setAnimationDirectionBackward","setAnimationFPS","setAnimationDuration","setAnimationTime","getAnimationTime","getAnimationDuration","stopAnimation","Entity","Messanger","ObjectPool","QuadTree","Spatial","Vec2","T","freeList","aquire","expand","__init","release","totalFree","totalUsed","hwidth","_absScale","_absPosition","_absHwidth","_node","COINCIDENT","attachTo","spatial","absPosition","assign","absRotation","rotate","pScale","absScale","absHwidth","_events","fired","handled","Event","listenTo","eventName","trigger","option","events","fire","messanger","_tags","_entities","_groups","_entityPool","_componentPools","Components","componentPropertyName","Component","getName","charAt","groupKey","names","ENTITY_CREATED","ENTITY_REMOVE","COMPONENT_ADDED","COMPONENT_REMOVE","_manager","_trigger","removeEntitiesByTag","tag","removeAllEntities","removeEntity","entityRemoveAllComponents","entityAddTag","entityRemoveTag","entityAddComponent","_Components","cName","cPool","component","groupName","hasAllComponents","Cs","entityRemoveComponent","loc","propName","_indexGroup","poolStats","used","pool","level","maxEntities","maxLevels","nodes","insert","_getIndex","_splitAndRedistributeIfNeeded","queryArea","out__entities","overlapping","rectIntersect","reIndex","_combine","tSize","tPos","validateEntity","hw","smult","rectContains","midX","midY","_split","_redistribute","_factory","magnitude","magnitude2","angleBetween","pcopy","fromAngle","pfromAngle","r1","r2","sizeToHwidth","out__position","out__hwidth","TComponent","hasTag","removeTag","_name","_callback","Comps","whereComponent","whereComponents","extends","mixin","getArguments","Function","FUNCTION_NAME","FUNCTION_ARGS","replace","extends_","Child","Parent","Super","makeT","mixin_"],"mappings":"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","file":"bundle.js","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})","global.Class = require('js-class');\r\nglobal.THREE = require('three');\r\nglobal.THREEx = require('./js/THREEx.KeyboardState.js');\r\nglobal.Physijs = require('physijs-browserify')(THREE);\r\nglobal.Stats = require('stats.js');\r\n\r\nrequire('./RequestAnimationFrame.js');\r\nrequire('./rubbable.js');\r\nglobal.SuperGif = require('./libgif.js');\r\n\r\nrequire('./js/Game.js');\r\nrequire('./js/Globals.js');\r\nrequire('./js/ResourceManager.js');\r\nrequire('./js/PointerLockControls.js');\r\nrequire('./js/EntityFactory.js');\r\nrequire('./js/Systems.js');\r\nrequire('./js/MouseController.js');\r\n\r\nPhysijs.scripts.worker = './libs/physijsWorker.js';\r\nPhysijs.scripts.ammo = './ammo.js';\r\n\r\n// purpose: function as a basic FPS game using an ECS (entity-component system) pattern\r\n//\r\n// requires: RequestAnimationFrame.js, three.js, three-pointerlockcontrols.js, stats.js, js-class.js, physijs, tiny-ecs\r\n//           Game.js, ResourceManager.js\r\n//\r\n// author: Cornell Daly\r\n//\r\n// date: November 3, 2015\r\n//\r\n// additional notes: code is separated into multiple files\r\n\r\nvar game = null;\r\n\r\nfunction init() {\r\n  Globals.instance.hudElement = document.getElementById(\"hud\");\r\n  Globals.instance.scoreElement = document.getElementById(\"score\");\r\n  Globals.instance.reloadingElement = document.getElementById(\"reloading\");\r\n  Globals.instance.reloadImg = new SuperGif({\r\n    gif: document.getElementById(\"reloadImg\")\r\n  });\r\n  Globals.instance.reloadImg.load();\r\n\r\n  var gameOptions = {\r\n    container: document.getElementById(\"container\"),\r\n    loadingContainer: document.getElementById(\"loadingContainer\"),\r\n    blocker: document.getElementById(\"blocker\"),\r\n    instructions: document.getElementById(\"instructions\"),\r\n    crosshair: document.getElementById(\"crosshair\"),\r\n    modelsToPreload: [\r\n      \"models/potato.json\"\r\n    ]\r\n  };\r\n  game = new Game(gameOptions);\r\n\r\n  game.start();\r\n}\r\n\r\ninit();\r\n\r\n","/**\n * Provides requestAnimationFrame in a cross browser way.\n * http://paulirish.com/2011/requestanimationframe-for-smart-animating/\n */\n\nif ( !window.requestAnimationFrame ) {\n\n\twindow.requestAnimationFrame = ( function() {\n\n\t\treturn window.webkitRequestAnimationFrame ||\n\t\twindow.mozRequestAnimationFrame ||\n\t\twindow.oRequestAnimationFrame ||\n\t\twindow.msRequestAnimationFrame ||\n\t\tfunction( /* function FrameRequestCallback */ callback, /* DOMElement Element */ element ) {\n\n\t\t\twindow.setTimeout( callback, 1000 / 60 );\n\n\t\t};\n\n\t} )();\n\n}\n","// THREEx.KeyboardState.js keep the current state of the keyboard.\r\n// It is possible to query it at any time. No need of an event.\r\n// This is particularly convenient in loop driven case, like in\r\n// 3D demos or games.\r\n//\r\n// # Usage\r\n//\r\n// **Step 1**: Create the object\r\n//\r\n// ```var keyboard  = new THREEx.KeyboardState();```\r\n//\r\n// **Step 2**: Query the keyboard state\r\n//\r\n// This will return true if shift and A are pressed, false otherwise\r\n//\r\n// ```keyboard.pressed(\"shift+A\")```\r\n//\r\n// **Step 3**: Stop listening to the keyboard\r\n//\r\n// ```keyboard.destroy()```\r\n//\r\n// NOTE: this library may be nice as standaline. independant from three.js\r\n// - rename it keyboardForGame\r\n//\r\n// # Code\r\n//\r\n\r\n/** @namespace */\r\nvar THREEx = THREEx || {};\r\n\r\nif (typeof module === 'object') {\r\n\r\n  module.exports = THREEx;\r\n\r\n}\r\n\r\n/**\r\n * - NOTE: it would be quite easy to push event-driven too\r\n *   - microevent.js for events handling\r\n *   - in this._onkeyChange, generate a string from the DOM event\r\n *   - use this as event name\r\n */\r\nTHREEx.KeyboardState = function(domElement) {\r\n  this.domElement = domElement || document;\r\n  // to store the current state\r\n  this.keyCodes = {};\r\n  this.modifiers = {};\r\n\r\n  // create callback to bind/unbind keyboard events\r\n  var _this = this;\r\n  this._onKeyDown = function(event) {\r\n    _this._onKeyChange(event)\r\n  };\r\n  this._onKeyUp = function(event) {\r\n    _this._onKeyChange(event)\r\n  };\r\n\r\n  // bind keyEvents\r\n  this.domElement.addEventListener(\"keydown\", this._onKeyDown, false);\r\n  this.domElement.addEventListener(\"keyup\", this._onKeyUp, false);\r\n\r\n  // create callback to bind/unbind window blur event\r\n  this._onBlur = function() {\r\n    for (var prop in _this.keyCodes) _this.keyCodes[prop] = false;\r\n    for (var prop in _this.modifiers) _this.modifiers[prop] = false;\r\n  };\r\n\r\n  // bind window blur\r\n  window.addEventListener(\"blur\", this._onBlur, false);\r\n};\r\n\r\n/**\r\n * To stop listening of the keyboard events\r\n */\r\nTHREEx.KeyboardState.prototype.destroy = function() {\r\n  // unbind keyEvents\r\n  this.domElement.removeEventListener(\"keydown\", this._onKeyDown, false);\r\n  this.domElement.removeEventListener(\"keyup\", this._onKeyUp, false);\r\n\r\n  // unbind window blur event\r\n  window.removeEventListener(\"blur\", this._onBlur, false);\r\n};\r\n\r\nTHREEx.KeyboardState.MODIFIERS = ['shift', 'ctrl', 'alt', 'meta'];\r\nTHREEx.KeyboardState.ALIAS = {\r\n  'left': 37,\r\n  'up': 38,\r\n  'right': 39,\r\n  'down': 40,\r\n  'space': 32,\r\n  'pageup': 33,\r\n  'pagedown': 34,\r\n  'tab': 9,\r\n  'escape': 27\r\n};\r\n\r\n/**\r\n * to process the keyboard dom event\r\n */\r\nTHREEx.KeyboardState.prototype._onKeyChange = function(event) {\r\n  // log to debug\r\n  //console.log(\"onKeyChange\", event, event.keyCode, event.shiftKey, event.ctrlKey, event.altKey, event.metaKey)\r\n\r\n  // update this.keyCodes\r\n  var keyCode = event.keyCode\r\n  var pressed = event.type === 'keydown' ? true : false\r\n  this.keyCodes[keyCode] = pressed\r\n    // update this.modifiers\r\n  this.modifiers['shift'] = event.shiftKey\r\n  this.modifiers['ctrl'] = event.ctrlKey\r\n  this.modifiers['alt'] = event.altKey\r\n  this.modifiers['meta'] = event.metaKey\r\n};\r\n\r\n/**\r\n * query keyboard state to know if a key is pressed of not\r\n *\r\n * @param {String} keyDesc the description of the key. format : modifiers+key e.g shift+A\r\n * @returns {Boolean} true if the key is pressed, false otherwise\r\n */\r\nTHREEx.KeyboardState.prototype.pressed = function(keyDesc) {\r\n  var keys = keyDesc.split(\"+\");\r\n  for (var i = 0; i < keys.length; i++) {\r\n    var key = keys[i]\r\n    var pressed = false\r\n    if (THREEx.KeyboardState.MODIFIERS.indexOf(key) !== -1) {\r\n      pressed = this.modifiers[key];\r\n    }\r\n    else if (Object.keys(THREEx.KeyboardState.ALIAS).indexOf(key) != -1) {\r\n      pressed = this.keyCodes[THREEx.KeyboardState.ALIAS[key]];\r\n    }\r\n    else {\r\n      pressed = this.keyCodes[key.toUpperCase().charCodeAt(0)]\r\n    }\r\n    if (!pressed) return false;\r\n  };\r\n  return true;\r\n};\r\n\r\n/**\r\n * return true if an event match a keyDesc\r\n * @param  {KeyboardEvent} event   keyboard event\r\n * @param  {String} keyDesc string description of the key\r\n * @return {Boolean}         true if the event match keyDesc, false otherwise\r\n */\r\nTHREEx.KeyboardState.prototype.eventMatches = function(event, keyDesc) {\r\n  var aliases = THREEx.KeyboardState.ALIAS\r\n  var aliasKeys = Object.keys(aliases)\r\n  var keys = keyDesc.split(\"+\")\r\n    // log to debug\r\n    // console.log(\"eventMatches\", event, event.keyCode, event.shiftKey, event.ctrlKey, event.altKey, event.metaKey)\r\n  for (var i = 0; i < keys.length; i++) {\r\n    var key = keys[i];\r\n    var pressed = false;\r\n    if (key === 'shift') {\r\n      pressed = (event.shiftKey ? true : false)\r\n    }\r\n    else if (key === 'ctrl') {\r\n      pressed = (event.ctrlKey ? true : false)\r\n    }\r\n    else if (key === 'alt') {\r\n      pressed = (event.altKey ? true : false)\r\n    }\r\n    else if (key === 'meta') {\r\n      pressed = (event.metaKey ? true : false)\r\n    }\r\n    else if (aliasKeys.indexOf(key) !== -1) {\r\n      pressed = (event.keyCode === aliases[key] ? true : false);\r\n    }\r\n    else if (event.keyCode === key.toUpperCase().charCodeAt(0)) {\r\n      pressed = true;\r\n    }\r\n    if (!pressed) return false;\r\n  }\r\n  return true;\r\n};\r\n\r\nif (typeof exports !== 'undefined') {\r\n  if (typeof module !== 'undefined' && module.exports) {\r\n    exports = module.exports = THREEx;\r\n  }\r\n  else {\r\n    exports.THREEx = THREEx;\r\n  }\r\n}\r\nelse {\r\n  this['THREEx'] = THREEx;\r\n}\r\n\r\n","/*\n    SuperGif\n\n    Example usage:\n\n        <img src=\"./example1_preview.gif\" rel:animated_src=\"./example1.gif\" width=\"360\" height=\"360\" rel:auto_play=\"1\" />\n\n        <script type=\"text/javascript\">\n            $$('img').each(function (img_tag) {\n                if (/.*\\.gif/.test(img_tag.src)) {\n                    var rub = new SuperGif({ gif: img_tag } );\n                    rub.load();\n                }\n            });\n        </script>\n\n    Image tag attributes:\n\n        rel:animated_src -  If this url is specified, it's loaded into the player instead of src.\n                            This allows a preview frame to be shown until animated gif data is streamed into the canvas\n\n        rel:auto_play -     Defaults to 1 if not specified. If set to zero, a call to the play() method is needed\n\n    Constructor options args\n\n        gif                 Required. The DOM element of an img tag.\n        loop_mode           Optional. Setting this to false will force disable looping of the gif.\n        auto_play           Optional. Same as the rel:auto_play attribute above, this arg overrides the img tag info.\n        max_width           Optional. Scale images over max_width down to max_width. Helpful with mobile.\n        on_end              Optional. Add a callback for when the gif reaches the end of a single loop (one iteration). The first argument passed will be the gif HTMLElement.\n        loop_delay          Optional. The amount of time to pause (in ms) after each single loop (iteration).\n        draw_while_loading  Optional. Determines whether the gif will be drawn to the canvas whilst it is loaded.\n        show_progress_bar   Optional. Only applies when draw_while_loading is set to true.\n\n    Instance methods\n\n        // loading\n        load( callback )        Loads the gif specified by the src or rel:animated_src sttributie of the img tag into a canvas element and then calls callback if one is passed\n        load_url( src, callback )   Loads the gif file specified in the src argument into a canvas element and then calls callback if one is passed\n\n        // play controls\n        play -              Start playing the gif\n        pause -             Stop playing the gif\n        move_to(i) -        Move to frame i of the gif\n        move_relative(i) -  Move i frames ahead (or behind if i < 0)\n\n        // getters\n        get_canvas          The canvas element that the gif is playing in. Handy for assigning event handlers to.\n        get_playing         Whether or not the gif is currently playing\n        get_loading         Whether or not the gif has finished loading/parsing\n        get_auto_play       Whether or not the gif is set to play automatically\n        get_length          The number of frames in the gif\n        get_current_frame   The index of the currently displayed frame of the gif\n\n        For additional customization (viewport inside iframe) these params may be passed:\n        c_w, c_h - width and height of canvas\n        vp_t, vp_l, vp_ w, vp_h - top, left, width and height of the viewport\n\n        A bonus: few articles to understand what is going on\n            http://enthusiasms.org/post/16976438906\n            http://www.matthewflickinger.com/lab/whatsinagif/bits_and_bytes.asp\n            http://humpy77.deviantart.com/journal/Frame-Delay-Times-for-Animated-GIFs-214150546\n\n*/\n\n// Generic functions\nvar bitsToNum = function(ba) {\n  return ba.reduce(function(s, n) {\n    return s * 2 + n;\n  }, 0);\n};\n\nvar byteToBitArr = function(bite) {\n  var a = [];\n  for (var i = 7; i >= 0; i--) {\n    a.push(!!(bite & (1 << i)));\n  }\n  return a;\n};\n\n// Stream\n/**\n * @constructor\n */\n// Make compiler happy.\nvar Stream = function(data) {\n  this.data = data;\n  this.len = this.data.length;\n  this.pos = 0;\n\n  this.readByte = function() {\n    if (this.pos >= this.data.length) {\n      throw new Error('Attempted to read past end of stream.');\n    }\n    if (data instanceof Uint8Array)\n      return data[this.pos++];\n    else\n      return data.charCodeAt(this.pos++) & 0xFF;\n  };\n\n  this.readBytes = function(n) {\n    var bytes = [];\n    for (var i = 0; i < n; i++) {\n      bytes.push(this.readByte());\n    }\n    return bytes;\n  };\n\n  this.read = function(n) {\n    var s = '';\n    for (var i = 0; i < n; i++) {\n      s += String.fromCharCode(this.readByte());\n    }\n    return s;\n  };\n\n  this.readUnsigned = function() { // Little-endian.\n    var a = this.readBytes(2);\n    return (a[1] << 8) + a[0];\n  };\n};\n\nvar lzwDecode = function(minCodeSize, data) {\n  // TODO: Now that the GIF parser is a bit different, maybe this should get an array of bytes instead of a String?\n  var pos = 0; // Maybe this streaming thing should be merged with the Stream?\n  var readCode = function(size) {\n    var code = 0;\n    for (var i = 0; i < size; i++) {\n      if (data.charCodeAt(pos >> 3) & (1 << (pos & 7))) {\n        code |= 1 << i;\n      }\n      pos++;\n    }\n    return code;\n  };\n\n  var output = [];\n\n  var clearCode = 1 << minCodeSize;\n  var eoiCode = clearCode + 1;\n\n  var codeSize = minCodeSize + 1;\n\n  var dict = [];\n\n  var clear = function() {\n    dict = [];\n    codeSize = minCodeSize + 1;\n    for (var i = 0; i < clearCode; i++) {\n      dict[i] = [i];\n    }\n    dict[clearCode] = [];\n    dict[eoiCode] = null;\n\n  };\n\n  var code;\n  var last;\n\n  while (true) {\n    last = code;\n    code = readCode(codeSize);\n\n    if (code === clearCode) {\n      clear();\n      continue;\n    }\n    if (code === eoiCode) break;\n\n    if (code < dict.length) {\n      if (last !== clearCode) {\n        dict.push(dict[last].concat(dict[code][0]));\n      }\n    }\n    else {\n      if (code !== dict.length) throw new Error('Invalid LZW code.');\n      dict.push(dict[last].concat(dict[last][0]));\n    }\n    output.push.apply(output, dict[code]);\n\n    if (dict.length === (1 << codeSize) && codeSize < 12) {\n      // If we're at the last code and codeSize is 12, the next code will be a clearCode, and it'll be 12 bits long.\n      codeSize++;\n    }\n  }\n\n  // I don't know if this is technically an error, but some GIFs do it.\n  //if (Math.ceil(pos / 8) !== data.length) throw new Error('Extraneous LZW bytes.');\n  return output;\n};\n\n\n// The actual parsing; returns an object with properties.\nvar parseGIF = function(st, handler) {\n  handler || (handler = {});\n\n  // LZW (GIF-specific)\n  var parseCT = function(entries) { // Each entry is 3 bytes, for RGB.\n    var ct = [];\n    for (var i = 0; i < entries; i++) {\n      ct.push(st.readBytes(3));\n    }\n    return ct;\n  };\n\n  var readSubBlocks = function() {\n    var size, data;\n    data = '';\n    do {\n      size = st.readByte();\n      data += st.read(size);\n    } while (size !== 0);\n    return data;\n  };\n\n  var parseHeader = function() {\n    var hdr = {};\n    hdr.sig = st.read(3);\n    hdr.ver = st.read(3);\n    if (hdr.sig !== 'GIF') throw new Error('Not a GIF file.'); // XXX: This should probably be handled more nicely.\n    hdr.width = st.readUnsigned();\n    hdr.height = st.readUnsigned();\n\n    var bits = byteToBitArr(st.readByte());\n    hdr.gctFlag = bits.shift();\n    hdr.colorRes = bitsToNum(bits.splice(0, 3));\n    hdr.sorted = bits.shift();\n    hdr.gctSize = bitsToNum(bits.splice(0, 3));\n\n    hdr.bgColor = st.readByte();\n    hdr.pixelAspectRatio = st.readByte(); // if not 0, aspectRatio = (pixelAspectRatio + 15) / 64\n    if (hdr.gctFlag) {\n      hdr.gct = parseCT(1 << (hdr.gctSize + 1));\n    }\n    handler.hdr && handler.hdr(hdr);\n  };\n\n  var parseExt = function(block) {\n    var parseGCExt = function(block) {\n      var blockSize = st.readByte(); // Always 4\n      var bits = byteToBitArr(st.readByte());\n      block.reserved = bits.splice(0, 3); // Reserved; should be 000.\n      block.disposalMethod = bitsToNum(bits.splice(0, 3));\n      block.userInput = bits.shift();\n      block.transparencyGiven = bits.shift();\n\n      block.delayTime = st.readUnsigned();\n\n      block.transparencyIndex = st.readByte();\n\n      block.terminator = st.readByte();\n\n      handler.gce && handler.gce(block);\n    };\n\n    var parseComExt = function(block) {\n      block.comment = readSubBlocks();\n      handler.com && handler.com(block);\n    };\n\n    var parsePTExt = function(block) {\n      // No one *ever* uses this. If you use it, deal with parsing it yourself.\n      var blockSize = st.readByte(); // Always 12\n      block.ptHeader = st.readBytes(12);\n      block.ptData = readSubBlocks();\n      handler.pte && handler.pte(block);\n    };\n\n    var parseAppExt = function(block) {\n      var parseNetscapeExt = function(block) {\n        var blockSize = st.readByte(); // Always 3\n        block.unknown = st.readByte(); // ??? Always 1? What is this?\n        block.iterations = st.readUnsigned();\n        block.terminator = st.readByte();\n        handler.app && handler.app.NETSCAPE && handler.app.NETSCAPE(block);\n      };\n\n      var parseUnknownAppExt = function(block) {\n        block.appData = readSubBlocks();\n        // FIXME: This won't work if a handler wants to match on any identifier.\n        handler.app && handler.app[block.identifier] && handler.app[block.identifier](block);\n      };\n\n      var blockSize = st.readByte(); // Always 11\n      block.identifier = st.read(8);\n      block.authCode = st.read(3);\n      switch (block.identifier) {\n        case 'NETSCAPE':\n          parseNetscapeExt(block);\n          break;\n        default:\n          parseUnknownAppExt(block);\n          break;\n      }\n    };\n\n    var parseUnknownExt = function(block) {\n      block.data = readSubBlocks();\n      handler.unknown && handler.unknown(block);\n    };\n\n    block.label = st.readByte();\n    switch (block.label) {\n      case 0xF9:\n        block.extType = 'gce';\n        parseGCExt(block);\n        break;\n      case 0xFE:\n        block.extType = 'com';\n        parseComExt(block);\n        break;\n      case 0x01:\n        block.extType = 'pte';\n        parsePTExt(block);\n        break;\n      case 0xFF:\n        block.extType = 'app';\n        parseAppExt(block);\n        break;\n      default:\n        block.extType = 'unknown';\n        parseUnknownExt(block);\n        break;\n    }\n  };\n\n  var parseImg = function(img) {\n    var deinterlace = function(pixels, width) {\n      // Of course this defeats the purpose of interlacing. And it's *probably*\n      // the least efficient way it's ever been implemented. But nevertheless...\n      var newPixels = new Array(pixels.length);\n      var rows = pixels.length / width;\n      var cpRow = function(toRow, fromRow) {\n        var fromPixels = pixels.slice(fromRow * width, (fromRow + 1) * width);\n        newPixels.splice.apply(newPixels, [toRow * width, width].concat(fromPixels));\n      };\n\n      // See appendix E.\n      var offsets = [0, 4, 2, 1];\n      var steps = [8, 8, 4, 2];\n\n      var fromRow = 0;\n      for (var pass = 0; pass < 4; pass++) {\n        for (var toRow = offsets[pass]; toRow < rows; toRow += steps[pass]) {\n          cpRow(toRow, fromRow)\n          fromRow++;\n        }\n      }\n\n      return newPixels;\n    };\n\n    img.leftPos = st.readUnsigned();\n    img.topPos = st.readUnsigned();\n    img.width = st.readUnsigned();\n    img.height = st.readUnsigned();\n\n    var bits = byteToBitArr(st.readByte());\n    img.lctFlag = bits.shift();\n    img.interlaced = bits.shift();\n    img.sorted = bits.shift();\n    img.reserved = bits.splice(0, 2);\n    img.lctSize = bitsToNum(bits.splice(0, 3));\n\n    if (img.lctFlag) {\n      img.lct = parseCT(1 << (img.lctSize + 1));\n    }\n\n    img.lzwMinCodeSize = st.readByte();\n\n    var lzwData = readSubBlocks();\n\n    img.pixels = lzwDecode(img.lzwMinCodeSize, lzwData);\n\n    if (img.interlaced) { // Move\n      img.pixels = deinterlace(img.pixels, img.width);\n    }\n\n    handler.img && handler.img(img);\n  };\n\n  var parseBlock = function() {\n    var block = {};\n    block.sentinel = st.readByte();\n\n    switch (String.fromCharCode(block.sentinel)) { // For ease of matching\n      case '!':\n        block.type = 'ext';\n        parseExt(block);\n        break;\n      case ',':\n        block.type = 'img';\n        parseImg(block);\n        break;\n      case ';':\n        block.type = 'eof';\n        handler.eof && handler.eof(block);\n        break;\n      default:\n        throw new Error('Unknown block: 0x' + block.sentinel.toString(16)); // TODO: Pad this with a 0.\n    }\n\n    if (block.type !== 'eof') setTimeout(parseBlock, 0);\n  };\n\n  var parse = function() {\n    parseHeader();\n    setTimeout(parseBlock, 0);\n  };\n\n  parse();\n};\n\nvar SuperGif = function(opts) {\n  var options = {\n    //viewport position\n    vp_l: 0,\n    vp_t: 0,\n    vp_w: null,\n    vp_h: null,\n    //canvas sizes\n    c_w: null,\n    c_h: null\n  };\n  for (var i in opts) {\n    options[i] = opts[i]\n  }\n  if (options.vp_w && options.vp_h) options.is_vp = true;\n\n  var stream;\n  var hdr;\n\n  var loadError = null;\n  var loading = false;\n\n  var transparency = null;\n  var delay = null;\n  var disposalMethod = null;\n  var disposalRestoreFromIdx = 0;\n  var lastDisposalMethod = null;\n  var frame = null;\n  var lastImg = null;\n\n  var playing = true;\n  var forward = true;\n\n  var ctx_scaled = false;\n\n  var frames = [];\n  var frameOffsets = []; // elements have .x and .y properties\n\n  var gif = options.gif;\n  if (typeof options.auto_play == 'undefined')\n    options.auto_play = (!gif.getAttribute('rel:auto_play') || gif.getAttribute('rel:auto_play') == '1');\n\n  var onEndListener = (options.hasOwnProperty('on_end') ? options.on_end : null);\n  var loopDelay = (options.hasOwnProperty('loop_delay') ? options.loop_delay : 0);\n  var overrideLoopMode = (options.hasOwnProperty('loop_mode') ? options.loop_mode : 'auto');\n  var drawWhileLoading = (options.hasOwnProperty('draw_while_loading') ? options.draw_while_loading : true);\n  var showProgressBar = drawWhileLoading ? (options.hasOwnProperty('show_progress_bar') ? options.show_progress_bar : true) : false;\n\n  var clear = function() {\n    transparency = null;\n    delay = null;\n    lastDisposalMethod = disposalMethod;\n    disposalMethod = null;\n    frame = null;\n  };\n\n  // XXX: There's probably a better way to handle catching exceptions when\n  // callbacks are involved.\n  var doParse = function() {\n    try {\n      parseGIF(stream, handler);\n    }\n    catch (err) {\n      doLoadError('parse');\n    }\n  };\n\n  var doText = function(text) {\n    toolbar.innerHTML = text; // innerText? Escaping? Whatever.\n    toolbar.style.visibility = 'visible';\n  };\n\n  var setSizes = function(w, h) {\n    canvas.width = w * get_canvas_scale();\n    canvas.height = h * get_canvas_scale();\n    toolbar.style.minWidth = (w * get_canvas_scale()) + 'px';\n\n    tmpCanvas.width = w;\n    tmpCanvas.height = h;\n    tmpCanvas.style.width = w + 'px';\n    tmpCanvas.style.height = h + 'px';\n    tmpCanvas.getContext('2d').setTransform(1, 0, 0, 1, 0, 0);\n  };\n\n  var setFrameOffset = function(frame, offset) {\n    if (!frameOffsets[frame]) {\n      frameOffsets[frame] = offset;\n      return;\n    }\n    if (typeof offset.x !== 'undefined') {\n      frameOffsets[frame].x = offset.x;\n    }\n    if (typeof offset.y !== 'undefined') {\n      frameOffsets[frame].y = offset.y;\n    }\n  };\n\n  var doShowProgress = function(pos, length, draw) {\n    if (draw && showProgressBar) {\n      var height = 25;\n      var left, mid, top, width;\n      if (options.is_vp) {\n        if (!ctx_scaled) {\n          top = (options.vp_t + options.vp_h - height);\n          height = height;\n          left = options.vp_l;\n          mid = left + (pos / length) * options.vp_w;\n          width = canvas.width;\n        }\n        else {\n          top = (options.vp_t + options.vp_h - height) / get_canvas_scale();\n          height = height / get_canvas_scale();\n          left = (options.vp_l / get_canvas_scale());\n          mid = left + (pos / length) * (options.vp_w / get_canvas_scale());\n          width = canvas.width / get_canvas_scale();\n        }\n        //some debugging, draw rect around viewport\n        if (false) {\n          if (!ctx_scaled) {\n            var l = options.vp_l,\n              t = options.vp_t;\n            var w = options.vp_w,\n              h = options.vp_h;\n          }\n          else {\n            var l = options.vp_l / get_canvas_scale(),\n              t = options.vp_t / get_canvas_scale();\n            var w = options.vp_w / get_canvas_scale(),\n              h = options.vp_h / get_canvas_scale();\n          }\n          ctx.rect(l, t, w, h);\n          ctx.stroke();\n        }\n      }\n      else {\n        top = (canvas.height - height) / (ctx_scaled ? get_canvas_scale() : 1);\n        mid = ((pos / length) * canvas.width) / (ctx_scaled ? get_canvas_scale() : 1);\n        width = canvas.width / (ctx_scaled ? get_canvas_scale() : 1);\n        height /= ctx_scaled ? get_canvas_scale() : 1;\n      }\n      // XXX Figure out alpha fillRect.\n      //ctx.fillStyle = 'salmon';\n      ctx.fillStyle = 'rgba(255,255,255,0.4)';\n      ctx.fillRect(mid, top, width - mid, height);\n\n      //ctx.fillStyle = 'teal';\n      ctx.fillStyle = 'rgba(255,0,22,.8)';\n      ctx.fillRect(0, top, mid, height);\n    }\n  };\n\n  var doLoadError = function(originOfError) {\n    var drawError = function() {\n      ctx.fillStyle = 'black';\n      ctx.fillRect(0, 0, options.c_w ? options.c_w : hdr.width, options.c_h ? options.c_h : hdr.height);\n      ctx.strokeStyle = 'red';\n      ctx.lineWidth = 3;\n      ctx.moveTo(0, 0);\n      ctx.lineTo(options.c_w ? options.c_w : hdr.width, options.c_h ? options.c_h : hdr.height);\n      ctx.moveTo(0, options.c_h ? options.c_h : hdr.height);\n      ctx.lineTo(options.c_w ? options.c_w : hdr.width, 0);\n      ctx.stroke();\n    };\n\n    loadError = originOfError;\n    hdr = {\n      width: gif.width,\n      height: gif.height\n    }; // Fake header.\n    frames = [];\n    drawError();\n  };\n\n  var doHdr = function(_hdr) {\n    hdr = _hdr;\n    setSizes(hdr.width, hdr.height)\n  };\n\n  var doGCE = function(gce) {\n    pushFrame();\n    clear();\n    transparency = gce.transparencyGiven ? gce.transparencyIndex : null;\n    delay = gce.delayTime;\n    disposalMethod = gce.disposalMethod;\n    // We don't have much to do with the rest of GCE.\n  };\n\n  var pushFrame = function() {\n    if (!frame) return;\n    frames.push({\n      data: frame.getImageData(0, 0, hdr.width, hdr.height),\n      delay: delay\n    });\n    frameOffsets.push({\n      x: 0,\n      y: 0\n    });\n  };\n\n  var doImg = function(img) {\n    if (!frame) frame = tmpCanvas.getContext('2d');\n\n    var currIdx = frames.length;\n\n    //ct = color table, gct = global color table\n    var ct = img.lctFlag ? img.lct : hdr.gct; // TODO: What if neither exists?\n\n    /*\n    Disposal method indicates the way in which the graphic is to\n    be treated after being displayed.\n\n    Values :    0 - No disposal specified. The decoder is\n                    not required to take any action.\n                1 - Do not dispose. The graphic is to be left\n                    in place.\n                2 - Restore to background color. The area used by the\n                    graphic must be restored to the background color.\n                3 - Restore to previous. The decoder is required to\n                    restore the area overwritten by the graphic with\n                    what was there prior to rendering the graphic.\n\n                    Importantly, \"previous\" means the frame state\n                    after the last disposal of method 0, 1, or 2.\n    */\n    if (currIdx > 0) {\n      if (lastDisposalMethod === 3) {\n        // Restore to previous\n        frame.putImageData(frames[disposalRestoreFromIdx].data, 0, 0);\n      }\n      else {\n        disposalRestoreFromIdx = currIdx - 1;\n      }\n\n      if (lastDisposalMethod === 2) {\n        // Restore to background color\n        // Browser implementations historically restore to transparent; we do the same.\n        // http://www.wizards-toolkit.org/discourse-server/viewtopic.php?f=1&t=21172#p86079\n        frame.clearRect(lastImg.leftPos, lastImg.topPos, lastImg.width, lastImg.height);\n      }\n    }\n    // else, Undefined/Do not dispose.\n    // frame contains final pixel data from the last frame; do nothing\n\n    //Get existing pixels for img region after applying disposal method\n    var imgData = frame.getImageData(img.leftPos, img.topPos, img.width, img.height);\n\n    //apply color table colors\n    var cdd = imgData.data;\n    img.pixels.forEach(function(pixel, i) {\n      // imgData.data === [R,G,B,A,R,G,B,A,...]\n      if (pixel !== transparency) {\n        cdd[i * 4 + 0] = ct[pixel][0];\n        cdd[i * 4 + 1] = ct[pixel][1];\n        cdd[i * 4 + 2] = ct[pixel][2];\n        cdd[i * 4 + 3] = 255; // Opaque.\n      }\n    });\n    imgData.data.set(cdd);\n\n    frame.putImageData(imgData, img.leftPos, img.topPos);\n\n    if (!ctx_scaled) {\n      ctx.scale(get_canvas_scale(), get_canvas_scale());\n      ctx_scaled = true;\n    }\n\n    // We could use the on-page canvas directly, except that we draw a progress\n    // bar for each image chunk (not just the final image).\n    if (drawWhileLoading)\n      ctx.drawImage(tmpCanvas, 0, 0);\n\n    lastImg = img;\n  };\n\n  var player = (function() {\n    var i = -1;\n    var iterationCount = 0;\n\n    var showingInfo = false;\n    var pinned = false;\n\n    /**\n     * Gets the index of the frame \"up next\".\n     * @returns {number}\n     */\n    var getNextFrameNo = function() {\n      var delta = (forward ? 1 : -1);\n      return (i + delta + frames.length) % frames.length;\n    };\n\n    var stepFrame = function(amount) { // XXX: Name is confusing.\n      i = i + amount;\n\n      putFrame();\n    };\n\n    var completeLoop = function() {\n      if (onEndListener !== null)\n        onEndListener(gif);\n      iterationCount++;\n    };\n\n    var step = (function() {\n      var stepping = false;\n\n      var doStep = function() {\n        stepping = playing;\n        if (!stepping) return;\n\n        stepFrame(1);\n        var delay = frames[i].delay * 10;\n        if (!delay) delay = 100; // FIXME: Should this even default at all? What should it be?\n\n        var nextFrameNo = getNextFrameNo();\n        if (nextFrameNo === 0) {\n          delay += loopDelay;\n          setTimeout(completeLoop, delay - 1);\n        }\n\n        if ((overrideLoopMode !== false || nextFrameNo !== 0 || iterationCount < 0))\n          setTimeout(doStep, delay);\n\n      };\n\n      return function() {\n        if (!stepping) setTimeout(doStep, 0);\n      };\n    }());\n\n    var putFrame = function() {\n      var offset;\n      i = parseInt(i, 10);\n\n      if (i > frames.length - 1) {\n        i = 0;\n      }\n\n      if (i < 0) {\n        i = 0;\n      }\n\n      offset = frameOffsets[i];\n\n      tmpCanvas.getContext(\"2d\").putImageData(frames[i].data, offset.x, offset.y);\n      ctx.globalCompositeOperation = \"copy\";\n      ctx.drawImage(tmpCanvas, 0, 0);\n    };\n\n    var play = function() {\n      playing = true;\n      step();\n    };\n\n    var pause = function() {\n      playing = false;\n    };\n\n\n    return {\n      init: function() {\n        if (loadError) return;\n\n        if (!(options.c_w && options.c_h)) {\n          ctx.scale(get_canvas_scale(), get_canvas_scale());\n        }\n\n        if (options.auto_play) {\n          step();\n        }\n        else {\n          i = 0;\n          putFrame();\n        }\n      },\n      step: step,\n      play: play,\n      pause: pause,\n      playing: playing,\n      move_relative: stepFrame,\n      current_frame: function() {\n        return i;\n      },\n      length: function() {\n        return frames.length\n      },\n      move_to: function(frame_idx) {\n        i = frame_idx;\n        putFrame();\n      }\n    }\n  }());\n\n  var doDecodeProgress = function(draw) {\n    doShowProgress(stream.pos, stream.data.length, draw);\n  };\n\n  var doNothing = function() {};\n  /**\n   * @param{boolean=} draw Whether to draw progress bar or not; this is not idempotent because of translucency.\n   *                       Note that this means that the text will be unsynchronized with the progress bar on non-frames;\n   *                       but those are typically so small (GCE etc.) that it doesn't really matter. TODO: Do this properly.\n   */\n  var withProgress = function(fn, draw) {\n    return function(block) {\n      fn(block);\n      doDecodeProgress(draw);\n    };\n  };\n\n\n  var handler = {\n    hdr: withProgress(doHdr),\n    gce: withProgress(doGCE),\n    com: withProgress(doNothing),\n    // I guess that's all for now.\n    app: {\n      // TODO: Is there much point in actually supporting iterations?\n      NETSCAPE: withProgress(doNothing)\n    },\n    img: withProgress(doImg, true),\n    eof: function(block) {\n      //toolbar.style.display = '';\n      pushFrame();\n      doDecodeProgress(false);\n      if (!(options.c_w && options.c_h)) {\n        canvas.width = hdr.width * get_canvas_scale();\n        canvas.height = hdr.height * get_canvas_scale();\n      }\n      player.init();\n      loading = false;\n      if (load_callback) {\n        load_callback(gif);\n      }\n\n    }\n  };\n\n  var init = function() {\n    var parent = gif.parentNode;\n\n    var span = document.createElement('span');\n    canvas = document.createElement('canvas');\n    ctx = canvas.getContext('2d');\n    toolbar = document.createElement('div');\n\n    tmpCanvas = document.createElement('canvas');\n\n    span.width = canvas.width = gif.width;\n    span.height = canvas.height = gif.height;\n    toolbar.style.minWidth = gif.width + 'px';\n\n    span.className = 'jsgif';\n    toolbar.className = 'jsgif_toolbar';\n    span.appendChild(canvas);\n    span.appendChild(toolbar);\n\n    parent.insertBefore(span, gif);\n    parent.removeChild(gif);\n\n    if (options.c_w && options.c_h) setSizes(options.c_w, options.c_h);\n    initialized = true;\n  };\n\n  var get_canvas_scale = function() {\n    var scale;\n    if (options.max_width && hdr && hdr.width > options.max_width) {\n      scale = options.max_width / hdr.width;\n    }\n    else {\n      scale = 1;\n    }\n    return scale;\n  }\n\n  var canvas, ctx, toolbar, tmpCanvas;\n  var initialized = false;\n  var load_callback = false;\n\n  var load_setup = function(callback) {\n    if (loading) return false;\n    if (callback) load_callback = callback;\n    else load_callback = false;\n\n    loading = true;\n    frames = [];\n    clear();\n    disposalRestoreFromIdx = 0;\n    lastDisposalMethod = null;\n    frame = null;\n    lastImg = null;\n\n    return true;\n  }\n\n  return {\n    // play controls\n    play: player.play,\n    pause: player.pause,\n    move_relative: player.move_relative,\n    move_to: player.move_to,\n\n    // getters for instance vars\n    get_playing: function() {\n      return player.playing\n    },\n    get_canvas: function() {\n      return canvas\n    },\n    get_canvas_scale: function() {\n      return get_canvas_scale()\n    },\n    get_loading: function() {\n      return loading\n    },\n    get_auto_play: function() {\n      return options.auto_play\n    },\n    get_length: function() {\n      return player.length()\n    },\n    get_current_frame: function() {\n      return player.current_frame()\n    },\n    load_url: function(src, callback) {\n      if (!load_setup(callback)) return;\n\n      var h = new XMLHttpRequest();\n      h.overrideMimeType('text/plain; charset=x-user-defined');\n      h.onloadstart = function() {\n        // Wait until connection is opened to replace the gif element with a canvas to avoid a blank img\n        if (!initialized) init();\n      };\n      h.onload = function(e) {\n        stream = new Stream(h.responseText);\n        setTimeout(doParse, 0);\n      };\n      h.onprogress = function(e) {\n        if (e.lengthComputable) doShowProgress(e.loaded, e.total, true);\n      };\n      h.onerror = function() {\n        doLoadError('xhr');\n      };\n      h.open('GET', src, true);\n      h.send();\n    },\n    load: function(callback) {\n      this.load_url(gif.getAttribute('rel:animated_src') || gif.src, callback);\n    },\n    load_raw: function(arr, callback) {\n      if (!load_setup(callback)) return;\n      if (!initialized) init();\n      stream = new Stream(arr);\n      setTimeout(doParse, 0);\n    },\n    set_frame_offset: setFrameOffset\n  };\n};\n\nmodule.exports = SuperGif;\n\n","/*\n\tRubbableGif\n\n\tExample usage:\n\n\t\t<img src=\"./example1_preview.gif\" rel:animated_src=\"./example1.gif\" width=\"360\" height=\"360\" rel:auto_play=\"1\" />\n\n\t\t<script type=\"text/javascript\">\n\t\t\t$$('img').each(function (img_tag) {\n\t\t\t\tif (/.*\\.gif/.test(img_tag.src)) {\n\t\t\t\t\tvar rub = new RubbableGif({ gif: img_tag } );\n\t\t\t\t\trub.load();\n\t\t\t\t}\n\t\t\t});\n\t\t</script>\n\n\tImage tag attributes:\n\n\t\trel:animated_src -\tIf this url is specified, it's loaded into the player instead of src.\n\t\t\t\t\t\t\tThis allows a preview frame to be shown until animated gif data is streamed into the canvas\n\n\t\trel:auto_play -\t\tDefaults to 1 if not specified. If set to zero, the gif will be rubbable but will not \n\t\t\t\t\t\t\tanimate unless the user is rubbing it.\n\n\tConstructor options args\n\n\t\tgif \t\t\t\tRequired. The DOM element of an img tag.\n\t\tauto_play \t\t\tOptional. Same as the rel:auto_play attribute above, this arg overrides the img tag info.\n\t\tmax_width\t\t\tOptional. Scale images over max_width down to max_width. Helpful with mobile.\n\n\tInstance methods\n\n\t\t// loading\n\t\tload( callback )\tLoads the gif into a canvas element and then calls callback if one is passed\n\n\t\t// play controls\n\t\tplay -\t\t\t\tStart playing the gif\n\t\tpause -\t\t\t\tStop playing the gif\n\t\tmove_to(i) -\t\tMove to frame i of the gif\n\t\tmove_relative(i) -\tMove i frames ahead (or behind if i < 0)\n\n\t\t// getters\n\t\tget_canvas\t\t\tThe canvas element that the gif is playing in.\n\t\tget_playing\t\t\tWhether or not the gif is currently playing\n\t\tget_loading\t\t\tWhether or not the gif has finished loading/parsing\n\t\tget_auto_play\t\tWhether or not the gif is set to play automatically\n\t\tget_length\t\t\tThe number of frames in the gif\n\t\tget_current_frame\tThe index of the currently displayed frame of the gif\n\n\t\tFor additional customization (viewport inside iframe) these params may be passed:\n\t\tc_w, c_h - width and height of canvas\n\t\tvp_t, vp_l, vp_ w, vp_h - top, left, width and height of the viewport\n\n*/\n(function (root, factory) {\n    if (typeof define === 'function' && define.amd) {\n        define(['./libgif'], factory);\n    } else if (typeof exports === 'object') {\n        module.exports = factory(require('./libgif'));\n    } else {\n        root.RubbableGif = factory(root.SuperGif);\n    }\n}(this, function (SuperGif) {\n    var RubbableGif = function( options ) {\n        var sup = new SuperGif( options );\n\n        var register_canvas_handers = function () {\n\n            var isvp = function(x) {\n                return (options.vp_l ? ( x - options.vp_l ) : x );\n            }\n\n            var canvas = sup.get_canvas();\n            var maxTime = 1000,\n            // allow movement if < 1000 ms (1 sec)\n                w = ( options.vp_w ? options.vp_w : canvas.width ),\n                maxDistance = Math.floor(w / (sup.get_length() * 2)),\n            // swipe movement of 50 pixels triggers the swipe\n                startX = 0,\n                startTime = 0;\n\n            var cantouch = \"ontouchend\" in document;\n\n            var aj = 0;\n            var last_played = 0;\n\n            canvas.addEventListener((cantouch) ? 'touchstart' : 'mousedown', function (e) {\n                // prevent image drag (Firefox)\n                e.preventDefault();\n                if (sup.get_auto_play()) sup.pause();\n\n                var pos = (e.touches && e.touches.length > 0) ? e.touches[0] : e;\n\n                var x = (pos.layerX > 0) ? isvp(pos.layerX) : w / 2;\n                var progress = x / w;\n\n                sup.move_to( Math.floor(progress * (sup.get_length() - 1)) );\n\n                startTime = e.timeStamp;\n                startX = isvp(pos.pageX);\n            });\n\n            canvas.addEventListener((cantouch) ? 'touchend' : 'mouseup', function (e) {\n                startTime = 0;\n                startX = 0;\n                if (sup.get_auto_play()) sup.play();\n            });\n\n            canvas.addEventListener((cantouch) ? 'touchmove' : 'mousemove', function (e) {\n                e.preventDefault();\n                var pos = (e.touches && e.touches.length > 0) ? e.touches[0] : e;\n\n                var currentX = isvp(pos.pageX);\n                currentDistance = (startX === 0) ? 0 : Math.abs(currentX - startX);\n                // allow if movement < 1 sec\n                currentTime = e.timeStamp;\n                if (startTime !== 0 && currentDistance > maxDistance) {\n                    if (currentX < startX && sup.get_current_frame() > 0) {\n                        sup.move_relative(-1);\n                    }\n                    if (currentX > startX && sup.get_current_frame() < sup.get_length() - 1) {\n                        sup.move_relative(1);\n                    }\n                    startTime = e.timeStamp;\n                    startX = isvp(pos.pageX);\n                }\n\n                var time_since_last_play = e.timeStamp - last_played;\n                {\n                    aj++;\n                    if (document.getElementById('tickles' + ((aj % 5) + 1))) document.getElementById('tickles' + ((aj % 5) + 1)).play();\n                    last_played = e.timeStamp;\n                }\n\n\n            });\n        };\n\n        sup.orig_load = sup.load;\n        sup.load = function(callback) {\n            sup.orig_load( function() {\n                if (callback) callback();\n                register_canvas_handers( sup );\n            } );\n        }\n\n        return sup;\n    }\n\n    return RubbableGif;\n}));","Model = Class({\r\n  constructor: function(options) {\r\n    this.geometry = options.geometry;\r\n    this.material = options.material;\r\n  }\r\n});\r\n\r\nResourceManager = Class({\r\n  constructor: function() {\r\n    this.loadingManager = new THREE.LoadingManager();\r\n\r\n    this.jsonLoader = new THREE.JSONLoader(this.loadingManager);\r\n\r\n    this.textures = {};\r\n    this.models = {};\r\n  },\r\n\r\n  getTexture: function(path, callback) {\r\n    if (path === null || path === undefined) {\r\n      return null;\r\n    }\r\n    else if (path in this.textures) {\r\n      return this.textures[path];\r\n    }\r\n\r\n    this.textures[path] = THREE.ImageUtils.loadTexture(path, undefined, callback);\r\n\r\n    return this.textures[path];\r\n  },\r\n\r\n  loadModel: function(path, callback) {\r\n    if (path === null || path === undefined) {\r\n      return;\r\n    }\r\n    else if (path in this.models) {\r\n      callback(this.models[path]);\r\n\r\n      return;\r\n    }\r\n\r\n    this.jsonLoader.load(path, function(geometry, materials) {\r\n      var material = new THREE.MeshFaceMaterial(materials);\r\n\r\n      var model = new Model({\r\n        geometry: geometry,\r\n        material: material\r\n      });\r\n      this.models[path] = model;\r\n\r\n      callback(model);\r\n    }.bind(this));\r\n  }\r\n}, {\r\n  statics: {\r\n    get instance() {\r\n      if (!ResourceManager._instance) {\r\n        ResourceManager._instance = new ResourceManager();\r\n      }\r\n      return ResourceManager._instance;\r\n    }\r\n  }\r\n});\r\n\r\n","Globals = Class({\r\n  constructor: function() {\r\n    this.hudElement = null;\r\n    this.scoreElement = null;\r\n    this.score = 0;\r\n    this.reloadingElement = null;\r\n    this.reloadImg = null;\r\n  }\r\n}, {\r\n  statics: {\r\n    get instance() {\r\n      if (!Globals._instance) {\r\n        Globals._instance = new Globals();\r\n      }\r\n      return Globals._instance;\r\n    }\r\n  }\r\n});\r\n\r\n","Game = Class({\r\n  constructor: function(options) {\r\n    this.container = options.container;\r\n    this.loadingContainer = options.loadingContainer;\r\n    this.blocker = options.blocker;\r\n    this.instructions = options.instructions;\r\n    this.crosshair = options.crosshair;\r\n\r\n    this.stats = null;\r\n\r\n    this.prevTime = performance.now();\r\n\r\n    this.renderer = null;\r\n    this.scene = null;\r\n    this.camera = null;\r\n\r\n    this.paused = true;\r\n\r\n    this.controlsEnabled = false;\r\n    this.controls = null;\r\n\r\n    this.systems = [];\r\n    this.postPhysicsSystems = [];\r\n\r\n    this.modelsToPreload = options.modelsToPreload;\r\n    this.percentModelsLoaded = 0;\r\n  },\r\n\r\n  start: function(runImmediately) {\r\n    if (runImmediately === undefined || runImmediately === null) {\r\n      runImmediately = true;\r\n    }\r\n\r\n    window.addEventListener('resize', this.onResize.bind(this));\r\n    window.onkeydown = this.onKeyDown.bind(this); // prevent spacebar from scrolling the page\r\n    window.addEventListener('mousedown', this.onMouseDown.bind(this));\r\n    window.addEventListener('mouseup', this.onMouseUp.bind(this));\r\n\r\n    this.renderer = new THREE.WebGLRenderer({\r\n      antialias: true\r\n    });\r\n    this.renderer.setSize(window.innerWidth, window.innerHeight);\r\n    this.renderer.setClearColor(0xffffff, 1);\r\n    this.container.appendChild(this.renderer.domElement);\r\n\r\n    /* Stats.js Setup */\r\n    this.stats = new Stats();\r\n    this.stats.setMode(0);\r\n\r\n    this.stats.domElement.style.position = 'absolute';\r\n    this.stats.domElement.style.left = '10px';\r\n    this.stats.domElement.style.bottom = '10px';\r\n\r\n    document.body.appendChild(this.stats.domElement);\r\n\r\n    // Create a new Three.js scene\r\n    this.scene = new Physijs.Scene();\r\n    this.scene.setGravity(new THREE.Vector3(0, -9.8 * 3, 0));\r\n\r\n    // Put in a camera\r\n    var aspectRatio = window.innerWidth / window.innerHeight;\r\n    this.camera = new THREE.PerspectiveCamera(45, aspectRatio, 0.1, 1000);\r\n    this.scene.add(this.camera);\r\n\r\n    /* Camera Controller */\r\n    this.controls = new PointerLockControls({\r\n      camera: this.camera\r\n    });\r\n    this.scene.add(this.controls.getObject());\r\n\r\n    this.clock = new THREE.Clock();\r\n\r\n    /* Setup Crosshair */\r\n\r\n    this.crosshair.style.left = ((window.innerWidth / 2) - 32) + 'px';\r\n    this.crosshair.style.top = ((window.innerHeight / 2) - 32) + 'px';\r\n\r\n    var ambientLight = new THREE.AmbientLight(0xcbcbcb);\r\n    this.scene.add(ambientLight);\r\n\r\n    var dirLight = new THREE.DirectionalLight(0xdcdcdc, 0.5);\r\n    this.scene.add(dirLight);\r\n\r\n    var ground = new Physijs.BoxMesh(\r\n      new THREE.BoxGeometry(500, 1, 500),\r\n      new THREE.MeshBasicMaterial({\r\n        color: 0x00dd00\r\n      }), 0);\r\n    ground._physijs.collision_type = EntityFactory.COLLISION_TYPES.obstacle;\r\n    ground._physijs.collision_masks = EntityFactory.COLLISION_TYPES.player | EntityFactory.COLLISION_TYPES.playerBullet | EntityFactory.COLLISION_TYPES.enemyBullet;\r\n    this.scene.add(ground);\r\n\r\n    /* Create Entities */\r\n\r\n    this.player = EntityFactory.instance.makePlayer({\r\n      scene: this.scene,\r\n      position: new THREE.Vector3(0, 20, 0),\r\n      controls: this.controls,\r\n      controlsObject: this.controls.getObject(),\r\n      cameraOffset: new THREE.Vector3(0, 3, 0)\r\n    });\r\n\r\n    EntityFactory.instance.makeEnemy({\r\n      scene: this.scene,\r\n      position: new THREE.Vector3(0, 5, -200)\r\n    });\r\n\r\n    /* Setup Systems */\r\n\r\n    this.systems.push(new CameraRotationSystem(EntityFactory.instance.entities));\r\n    this.systems.push(new PlayerInputSystem(EntityFactory.instance.entities));\r\n    this.systems.push(new MovementSystem(EntityFactory.instance.entities));\r\n    this.systems.push(new ExpirableSystem(EntityFactory.instance.entities));\r\n    this.systems.push(new CameraFollowSystem(EntityFactory.instance.entities));\r\n    this.systems.push(new ShootDelaySystem(EntityFactory.instance.entities));\r\n    this.systems.push(new HurtSystem(EntityFactory.instance.entities));\r\n\r\n    this.postPhysicsSystems.push(new PhysicsUpdateSystem(EntityFactory.instance.entities));\r\n\r\n    this.loadModels();\r\n  },\r\n\r\n  loadModels: function() {\r\n    this.modelsToPreload.forEach(function(model) {\r\n      ResourceManager.instance.loadModel(model, this.modelLoaded.bind(this));\r\n    }.bind(this));\r\n  },\r\n\r\n  modelLoaded: function(model) {\r\n    var percentPerModel = 100.0 / this.modelsToPreload.length;\r\n    this.percentModelsLoaded += percentPerModel;\r\n\r\n    if (this.percentModelsLoaded > 99.0) {\r\n      // hide loading indicator and show instructions\r\n      this.loadingContainer.style.visibility = \"hidden\";\r\n      this.blocker.style.visibility = \"visible\";\r\n      this.instructions.style.visibility = \"visible\";\r\n      Globals.instance.hudElement.style.display = 'block';\r\n      this.crosshair.style.display = 'block';\r\n\r\n      // ensure the user is at the top of the page\r\n      document.body.scrollTop = document.documentElement.scrollTop = 0;\r\n\r\n      this.initPointerLock();\r\n\r\n      this.run();\r\n    }\r\n  },\r\n\r\n  run: function() {\r\n    requestAnimationFrame(this.update.bind(this));\r\n  },\r\n\r\n  update: function() {\r\n    requestAnimationFrame(this.update.bind(this));\r\n\r\n    var time = performance.now();\r\n    var dt = (time - this.prevTime) / 1000;\r\n\r\n    if (!this.paused) {\r\n      if (dt > 0.5) {\r\n        dt = 0.5;\r\n      }\r\n\r\n      this.systems.forEach(function(system) {\r\n        system.update(dt);\r\n      });\r\n\r\n      this.scene.simulate();\r\n\r\n      this.postPhysicsSystems.forEach(function(system) {\r\n        system.update(dt);\r\n      });\r\n\r\n      MouseController.instance.update(dt);\r\n    }\r\n\r\n    this.renderer.render(this.scene, this.camera);\r\n    this.stats.update();\r\n\r\n    this.prevTime = time;\r\n  },\r\n\r\n  onResize: function(e) {\r\n    this.renderer.setSize(window.innerWidth, window.innerHeight);\r\n\r\n    this.camera.aspect = (window.innerWidth / window.innerHeight);\r\n    this.camera.updateProjectionMatrix();\r\n\r\n    this.crosshair.style.left = ((window.innerWidth / 2) - 32) + 'px';\r\n    this.crosshair.style.top = ((window.innerHeight / 2) - 32) + 'px';\r\n  },\r\n\r\n  onKeyDown: function(e) {\r\n    var keyCode = ('which' in event) ? event.which : event.keyCode;\r\n\r\n    return (keyCode !== Game.KEY_CODES.space);\r\n  },\r\n\r\n  onMouseDown: function(e) {\r\n    if (this.paused) {\r\n      return;\r\n    }\r\n\r\n    if (e.button === 0) {\r\n      MouseController.instance.isDown.left = true;\r\n    }\r\n    else if (e.button === 2) {\r\n      MouseController.instance.isDown.right = true;\r\n    }\r\n  },\r\n\r\n  onMouseUp: function(e) {\r\n    if (this.paused) {\r\n      return;\r\n    }\r\n\r\n    if (e.button === 0) {\r\n      MouseController.instance.isDown.left = false;\r\n      MouseController.instance.wasPressed.left = true;\r\n    }\r\n    else if (e.button === 2) {\r\n      MouseController.instance.isDown.right = false;\r\n      MouseController.instance.wasPressed.right = true;\r\n    }\r\n  },\r\n\r\n  initPointerLock: function() {\r\n    var havePointerLock = 'pointerLockElement' in document || 'mozPointerLockElement' in document || 'webkitPointerLockElement' in document;\r\n\r\n    if (havePointerLock) {\r\n\r\n      var element = document.body;\r\n\r\n      var pointerlockchange = function(event) {\r\n\r\n        if (document.pointerLockElement === element || document.mozPointerLockElement === element || document.webkitPointerLockElement === element) {\r\n\r\n          this.controlsEnabled = true;\r\n          this.controls.enabled = true;\r\n\r\n          this.blocker.style.display = 'none';\r\n\r\n          this.paused = false;\r\n\r\n        }\r\n        else {\r\n\r\n          this.controls.enabled = false;\r\n\r\n          this.blocker.style.display = '-webkit-box';\r\n          this.blocker.style.display = '-moz-box';\r\n          this.blocker.style.display = 'box';\r\n\r\n          this.instructions.style.display = '';\r\n\r\n          this.paused = true;\r\n\r\n        }\r\n\r\n      }.bind(this);\r\n\r\n      var pointerlockerror = function(event) {\r\n\r\n        this.instructions.style.display = '';\r\n\r\n      }.bind(this);\r\n\r\n      // Hook pointer lock state change events\r\n      document.addEventListener('pointerlockchange', pointerlockchange, false);\r\n      document.addEventListener('mozpointerlockchange', pointerlockchange, false);\r\n      document.addEventListener('webkitpointerlockchange', pointerlockchange, false);\r\n\r\n      document.addEventListener('pointerlockerror', pointerlockerror, false);\r\n      document.addEventListener('mozpointerlockerror', pointerlockerror, false);\r\n      document.addEventListener('webkitpointerlockerror', pointerlockerror, false);\r\n\r\n      this.instructions.addEventListener('click', function(event) {\r\n\r\n        this.instructions.style.display = 'none';\r\n\r\n        // Ask the browser to lock the pointer\r\n        element.requestPointerLock = element.requestPointerLock || element.mozRequestPointerLock || element.webkitRequestPointerLock;\r\n\r\n        if (/Firefox/i.test(navigator.userAgent)) {\r\n\r\n          var fullscreenchange = function(event) {\r\n\r\n            if (document.fullscreenElement === element || document.mozFullscreenElement === element || document.mozFullScreenElement === element) {\r\n\r\n              document.removeEventListener('fullscreenchange', fullscreenchange);\r\n              document.removeEventListener('mozfullscreenchange', fullscreenchange);\r\n\r\n              element.requestPointerLock();\r\n            }\r\n\r\n          };\r\n\r\n          document.addEventListener('fullscreenchange', fullscreenchange, false);\r\n          document.addEventListener('mozfullscreenchange', fullscreenchange, false);\r\n\r\n          element.requestFullscreen = element.requestFullscreen || element.mozRequestFullscreen || element.mozRequestFullScreen || element.webkitRequestFullscreen;\r\n\r\n          element.requestFullscreen();\r\n\r\n        }\r\n        else {\r\n\r\n          element.requestPointerLock();\r\n\r\n        }\r\n\r\n      }.bind(this), false);\r\n\r\n    }\r\n    else {\r\n\r\n      this.instructions.innerHTML = 'Your browser doesn\\'t seem to support Pointer Lock API';\r\n\r\n    }\r\n  }\r\n}, {\r\n  statics: {\r\n    KEY_CODES: {\r\n      space: 32\r\n    }\r\n  }\r\n});\r\n\r\n","PointerLockControls = Class({\r\n  constructor: function(options) {\r\n    this.camera = options.camera;\r\n    this.camera.rotation.set(0, 0, 0);\r\n\r\n    this.pitchObject = new THREE.Object3D();\r\n    this.pitchObject.add(this.camera);\r\n\r\n    this.yawObject = new THREE.Object3D();\r\n    this.yawObject.position.y = 10;\r\n    this.yawObject.add(this.pitchObject);\r\n\r\n    this.moveForward = false;\r\n    this.moveBackward = false;\r\n    this.moveLeft = false;\r\n    this.moveRight = false;\r\n\r\n    this.isOnObject = false;\r\n    this.canJump = false;\r\n\r\n    this.prevTime = performance.now();\r\n\r\n    this.velocity = new THREE.Vector3();\r\n\r\n    this.enabled = false;\r\n\r\n    this.mass = options.mass || 100.0;\r\n    this.moveSpeed = options.moveSpeed || new THREE.Vector3(400.0, 350.0, 400.0);\r\n    this.minimumY = options.minimumY || 10;\r\n\r\n    document.addEventListener('mousemove', this.onMouseMove.bind(this), false);\r\n    document.addEventListener('keydown', this.onKeyDown.bind(this), false);\r\n    document.addEventListener('keyup', this.onKeyUp.bind(this), false);\r\n  },\r\n\r\n  onMouseMove: function(event) {\r\n    if (this.enabled === false) {\r\n      return;\r\n    }\r\n\r\n    var movementX = event.movementX || event.mozMovementX || event.webkitMovementX || 0;\r\n    var movementY = event.movementY || event.mozMovementY || event.webkitMovementY || 0;\r\n\r\n    this.yawObject.rotation.y -= movementX * 0.002;\r\n    this.pitchObject.rotation.x -= movementY * 0.002;\r\n\r\n    this.pitchObject.rotation.x = Math.max(-PointerLockControls.PI_2, Math.min(PointerLockControls.PI_2, this.pitchObject.rotation.x));\r\n  },\r\n\r\n  onKeyDown: function(event) {\r\n    switch (event.keyCode) {\r\n      case 38: // up\r\n      case 87: // w\r\n        this.moveForward = true;\r\n        break;\r\n\r\n      case 37: // left\r\n      case 65: // a\r\n        this.moveLeft = true;\r\n        break;\r\n\r\n      case 40: // down\r\n      case 83: // s\r\n        this.moveBackward = true;\r\n        break;\r\n\r\n      case 39: // right\r\n      case 68: // d\r\n        this.moveRight = true;\r\n        break;\r\n\r\n      case 32: // space\r\n        if (this.canJump === true) {\r\n          this.velocity.y += this.moveSpeed.y;\r\n        }\r\n\r\n        this.canJump = false;\r\n\r\n        break;\r\n\r\n      default:\r\n        break;\r\n    }\r\n  },\r\n\r\n  onKeyUp: function(event) {\r\n    switch (event.keyCode) {\r\n      case 38: // up\r\n      case 87: // w\r\n        this.moveForward = false;\r\n        break;\r\n\r\n      case 37: // left\r\n      case 65: // a\r\n        this.moveLeft = false;\r\n        break;\r\n\r\n      case 40: // down\r\n      case 83: // s\r\n        this.moveBackward = false;\r\n        break;\r\n\r\n      case 39: // right\r\n      case 68: // d\r\n        this.moveRight = false;\r\n        break;\r\n\r\n      default:\r\n        break;\r\n    }\r\n  },\r\n\r\n  getObject: function() {\r\n    return this.yawObject;\r\n  },\r\n\r\n  isOnObject: function(bool) {\r\n    this.isOnObject = bool;\r\n    this.canJump = bool;\r\n  },\r\n\r\n  getDirection: function() {\r\n    // assumes the camera itself is not rotated\r\n    var direction = new THREE.Vector3(0, 0, -1);\r\n    var rotation = new THREE.Euler(0, 0, 0, \"YXZ\");\r\n\r\n    return function(v) {\r\n      rotation.set(this.pitchObject.rotation.x, this.yawObject.rotation.y, 0);\r\n\r\n      v.copy(direction).applyEuler(rotation);\r\n\r\n      return v;\r\n    };\r\n  }(),\r\n\r\n  update: function(dt) {\r\n    if (this.enabled === false) {\r\n      return;\r\n    }\r\n\r\n    this.velocity.x -= this.velocity.x * 10.0 * dt;\r\n    this.velocity.z -= this.velocity.z * 10.0 * dt;\r\n\r\n    this.velocity.y -= 9.8 * this.mass * dt;\r\n\r\n    if (this.moveForward) {\r\n      this.velocity.z -= this.moveSpeed.z * dt;\r\n    }\r\n    if (this.moveBackward) {\r\n      this.velocity.z += this.moveSpeed.z * dt;\r\n    }\r\n\r\n    if (this.moveLeft) {\r\n      this.velocity.x -= this.moveSpeed.x * dt;\r\n    }\r\n    if (this.moveRight) {\r\n      this.velocity.x += this.moveSpeed.x * dt;\r\n    }\r\n\r\n    if (this.isOnObject === true) {\r\n      this.velocity.y = Math.max(0, this.velocity.y);\r\n    }\r\n\r\n    this.yawObject.translateX(this.velocity.x * dt);\r\n    this.yawObject.translateY(this.velocity.y * dt);\r\n    this.yawObject.translateZ(this.velocity.z * dt);\r\n\r\n    if (this.yawObject.position.y < this.minimumY) {\r\n      this.velocity.y = 0;\r\n      this.yawObject.position.y = this.minimumY;\r\n\r\n      this.canJump = true;\r\n    }\r\n  }\r\n}, {\r\n  statics: {\r\n    PI_2: Math.PI / 2\r\n  }\r\n});\r\n\r\n","var EntityManager = require('tiny-ecs').EntityManager;\r\nvar C = require('./Components.js');\r\n\r\nEntityFactory = Class({\r\n  constructor: function() {\r\n    this.entities = new EntityManager();\r\n  },\r\n\r\n  makePlayer: function(options) {\r\n    var player = this.entities.createEntity();\r\n\r\n    player.addTag(\"player\");\r\n\r\n    player.addComponent(C.Position);\r\n    player.addComponent(C.Velocity);\r\n    player.addComponent(C.Jump);\r\n    player.addComponent(C.Drawable);\r\n    player.addComponent(C.CameraFollow);\r\n    player.addComponent(C.ShootDelay);\r\n\r\n    player.drawable.scene = options.scene;\r\n\r\n    player.drawable.mesh = new Physijs.BoxMesh(\r\n      new THREE.BoxGeometry(2, 8, 2),\r\n      Physijs.createMaterial(new THREE.MeshBasicMaterial({\r\n        color: 0xffff00\r\n      }), 0.9, 0.1));\r\n    player.drawable.mesh.entity = player;\r\n\r\n    player.drawable.mesh.position.copy(options.position);\r\n    //player.drawable.mesh.rotation.copy(options.rotation);\r\n\r\n    player.drawable.mesh._physijs.collision_type = EntityFactory.COLLISION_TYPES.player;\r\n    player.drawable.mesh._physijs.collision_masks = EntityFactory.COLLISION_TYPES.obstacle | EntityFactory.COLLISION_TYPES.enemy | EntityFactory.COLLISION_TYPES.enemyBullet;\r\n\r\n    player.drawable.scene.add(player.drawable.mesh);\r\n\r\n    player.drawable.mesh.setDamping(0.99, 0);\r\n    player.drawable.mesh.setAngularFactor(new THREE.Vector3(0, 0, 0));\r\n\r\n    player.drawable.mesh.addEventListener('collision', function(other_object, relative_velocity, relative_rotation, contact_normal) {\r\n      if (contact_normal.y < 0 && other_object._physijs.collision_type === EntityFactory.COLLISION_TYPES.obstacle) {\r\n        player.jump.canJump = true;\r\n      }\r\n    });\r\n\r\n    player.position.x = options.position.x;\r\n    player.position.y = options.position.y;\r\n    player.position.z = options.position.z;\r\n\r\n    player.cameraFollow.controls = options.controls;\r\n    player.cameraFollow.object = options.controlsObject;\r\n    player.cameraFollow.offset = options.cameraOffset;\r\n\r\n    player.shootDelay.delayTheshold = 0.5;\r\n\r\n    return player;\r\n  },\r\n\r\n  makeEnemy: function(options) {\r\n    var enemy = this.entities.createEntity();\r\n\r\n    enemy.addTag(\"enemy\");\r\n\r\n    enemy.addComponent(C.Position);\r\n    enemy.addComponent(C.Velocity);\r\n    enemy.addComponent(C.Drawable);\r\n\r\n    enemy.drawable.scene = options.scene;\r\n\r\n    enemy.drawable.mesh = new Physijs.BoxMesh(\r\n      new THREE.BoxGeometry(10, 10, 10),\r\n      Physijs.createMaterial(new THREE.MeshPhongMaterial({\r\n        color: 0x0000ff\r\n      }), 0.5, 0.6), 0);\r\n    enemy.drawable.mesh.entity = enemy;\r\n\r\n    enemy.drawable.mesh._physijs.collision_type = EntityFactory.COLLISION_TYPES.enemy;\r\n    enemy.drawable.mesh._physijs.collision_masks = EntityFactory.COLLISION_TYPES.obstacle | EntityFactory.COLLISION_TYPES.player | EntityFactory.COLLISION_TYPES.playerBullet;\r\n\r\n    enemy.drawable.mesh.position.copy(options.position);\r\n    //enemy.drawable.mesh.rotation.copy(options.rotation);\r\n\r\n    enemy.drawable.scene.add(enemy.drawable.mesh);\r\n\r\n    enemy.position.x = options.position.x;\r\n    enemy.position.y = options.position.y;\r\n    enemy.position.z = options.position.z;\r\n  },\r\n\r\n  makeBullet: function(options) {\r\n    ResourceManager.instance.loadModel('models/potato.json', function(model) {\r\n      var bullet = this.entities.createEntity();\r\n\r\n      bullet.addTag(\"bullet\");\r\n\r\n      bullet.addComponent(C.Position);\r\n      bullet.addComponent(C.Drawable);\r\n      bullet.addComponent(C.Expirable);\r\n      bullet.addComponent(C.OneTimeHit);\r\n\r\n      bullet.drawable.scene = options.scene;\r\n\r\n      bullet.drawable.mesh = new Physijs.ConvexMesh(\r\n        model.geometry,\r\n        Physijs.createMaterial(model.material, 0.7, 0.01)\r\n      );\r\n      bullet.drawable.mesh.entity = bullet;\r\n\r\n      bullet.drawable.mesh._physijs.collision_type = EntityFactory.COLLISION_TYPES.playerBullet;\r\n      bullet.drawable.mesh._physijs.collision_masks = EntityFactory.COLLISION_TYPES.obstacle | EntityFactory.COLLISION_TYPES.enemy | EntityFactory.COLLISION_TYPES.playerBullet | EntityFactory.COLLISION_TYPES.enemyBullet;\r\n\r\n      bullet.drawable.mesh.position.copy(options.position);\r\n      bullet.drawable.mesh.rotation.copy(options.rotation);\r\n      bullet.drawable.mesh.scale.copy(options.scale);\r\n\r\n      bullet.drawable.scene.add(bullet.drawable.mesh);\r\n\r\n      bullet.drawable.mesh.setDamping(0.1, 0);\r\n\r\n      bullet.drawable.mesh.addEventListener('collision', function(other_object, relative_velocity, relative_rotation, contact_normal) {\r\n        if (other_object._physijs.collision_type === EntityFactory.COLLISION_TYPES.enemy && bullet.oneTimeHit.alreadyHit.indexOf(other_object.uuid) < 0) {\r\n          other_object.entity.addComponent(C.Hurt);\r\n          other_object.entity.hurt.originalColor = other_object.material.color;\r\n\r\n          Globals.instance.score++;\r\n\r\n          Globals.instance.scoreElement.innerHTML = Globals.instance.score;\r\n\r\n          bullet.oneTimeHit.alreadyHit.push(other_object.uuid);\r\n        }\r\n      }.bind(this));\r\n\r\n      if (options.position) {\r\n        bullet.position.x = options.position.x;\r\n        bullet.position.y = options.position.y;\r\n        bullet.position.z = options.position.z;\r\n      }\r\n\r\n      var vel = new THREE.Vector3(options.velocity, options.velocity, options.velocity);\r\n      vel.multiply(options.direction);\r\n      //var vel = new THREE.Vector3(0, 0, -options.velocity).applyMatrix4(options.rotationMatrix);\r\n      bullet.drawable.mesh.applyCentralImpulse(vel);\r\n      //console.log(vel, options.direction, options.position);\r\n\r\n      bullet.expirable.maxAge = 5;\r\n    }.bind(this));\r\n  }\r\n}, {\r\n  statics: {\r\n    get instance() {\r\n      if (!EntityFactory._instance) {\r\n        EntityFactory._instance = new EntityFactory();\r\n      }\r\n      return EntityFactory._instance;\r\n    },\r\n\r\n    COLLISION_TYPES: {\r\n      nothing: 0, // collide with nothing\r\n\r\n      obstacle: 1 << 0,\r\n      player: 1 << 2,\r\n      enemy: 1 << 3,\r\n\r\n      playerBullet: 1 << 4,\r\n      enemyBullet: 1 << 5\r\n    }\r\n  }\r\n});\r\n\r\n","var C = require('./Components.js');\r\n\r\nPlayerInputSystem = Class({\r\n  constructor: function(entities) {\r\n    this.entities = entities;\r\n\r\n    this.keyboard = new THREEx.KeyboardState();\r\n    this.jumped = false;\r\n  },\r\n\r\n  update: function(dt) {\r\n    var players = this.entities.queryTag(\"player\");\r\n\r\n    players.forEach(function(entity) {\r\n      var velocity = new THREE.Vector3(entity.velocity.x, entity.velocity.y, entity.velocity.z);\r\n      var dv = new THREE.Vector3(); // delta velocity\r\n\r\n      if (this.keyboard.pressed(\"w\")) {\r\n        dv.z = -PlayerInputSystem.MOVE_SPEED;\r\n      }\r\n      else if (this.keyboard.pressed(\"s\")) {\r\n        dv.z = PlayerInputSystem.MOVE_SPEED;\r\n      }\r\n\r\n      if (this.keyboard.pressed(\"a\")) {\r\n        dv.x = -PlayerInputSystem.MOVE_SPEED;\r\n      }\r\n      else if (this.keyboard.pressed(\"d\")) {\r\n        dv.x = PlayerInputSystem.MOVE_SPEED;\r\n      }\r\n\r\n      if (this.keyboard.pressed(\"space\") && entity.jump.canJump) {\r\n        dv.y = 1500;\r\n        entity.jump.canJump = false;\r\n      }\r\n\r\n      if (entity.shootDelay.canShoot) {\r\n        if (MouseController.instance.wasPressed.left) {\r\n          var direction = new THREE.Vector3();\r\n          entity.cameraFollow.controls.getDirection(direction);\r\n\r\n          EntityFactory.instance.makeBullet({\r\n            scene: entity.drawable.scene,\r\n            position: entity.cameraFollow.object.position.clone(),\r\n            rotation: entity.cameraFollow.object.rotation.clone(),\r\n            scale: new THREE.Vector3(0.5, 0.5, 0.5),\r\n            direction: direction,\r\n            rotationMatrix: entity.velocity.rotationMatrix,\r\n            velocity: 2000\r\n          });\r\n\r\n          entity.shootDelay.canShoot = false;\r\n\r\n          Globals.instance.reloadImg.move_to(0);\r\n          Globals.instance.reloadImg.play();\r\n          Globals.instance.reloadingElement.style.visibility = \"visible\";\r\n        }\r\n        else if (MouseController.instance.wasPressed.right) {\r\n          var direction = new THREE.Vector3();\r\n          entity.cameraFollow.controls.getDirection(direction);\r\n\r\n          EntityFactory.instance.makeBullet({\r\n            scene: entity.drawable.scene,\r\n            position: entity.cameraFollow.object.position.clone(),\r\n            rotation: entity.cameraFollow.object.rotation.clone(),\r\n            scale: new THREE.Vector3(0.5, 0.5, 0.5),\r\n            direction: direction,\r\n            rotationMatrix: entity.velocity.rotationMatrix,\r\n            velocity: 200\r\n          });\r\n\r\n          entity.shootDelay.canShoot = false;\r\n\r\n          Globals.instance.reloadImg.move_to(0);\r\n          Globals.instance.reloadImg.play();\r\n          Globals.instance.reloadingElement.style.visibility = \"visible\";\r\n        }\r\n      }\r\n\r\n      dv = dv.applyMatrix4(entity.velocity.rotationMatrix);\r\n\r\n      velocity.add(dv);\r\n\r\n      entity.velocity.x = velocity.x;\r\n      entity.velocity.y = velocity.y;\r\n      entity.velocity.z = velocity.z;\r\n    }.bind(this));\r\n  }\r\n}, {\r\n  statics: {\r\n    MOVE_SPEED: 25\r\n  }\r\n});\r\n\r\nMovementSystem = Class({\r\n  constructor: function(entities) {\r\n    this.entities = entities;\r\n  },\r\n\r\n  update: function(dt) {\r\n    var moveables = this.entities.queryComponents([C.Position, C.Velocity]);\r\n\r\n    moveables.forEach(function(entity) {\r\n      var velocity = new THREE.Vector3(entity.velocity.x, entity.velocity.y, entity.velocity.z);\r\n\r\n      if (entity.hasComponent(C.Drawable)) {\r\n        entity.drawable.mesh.applyCentralImpulse(velocity, new THREE.Vector3());\r\n        //entity.drawable.mesh.setLinearVelocity(entity.velocity);\r\n      }\r\n      else {\r\n        entity.position.x += velocity.x * dt;\r\n        entity.position.y += velocity.y * dt;\r\n        entity.position.z += velocity.z * dt;\r\n      }\r\n    });\r\n  }\r\n});\r\n\r\nExpirableSystem = Class({\r\n  constructor: function(entities) {\r\n    this.entities = entities;\r\n  },\r\n\r\n  update: function(dt) {\r\n    var expirables = this.entities.queryComponents([C.Expirable]);\r\n\r\n    expirables.forEach(function(entity) {\r\n      entity.expirable.age += dt;\r\n\r\n      if (entity.expirable.age >= entity.expirable.maxAge) {\r\n        if (entity.hasComponent(C.Drawable)) {\r\n          entity.drawable.scene.remove(entity.drawable.mesh);\r\n        }\r\n\r\n        entity.remove();\r\n      }\r\n    });\r\n  }\r\n});\r\n\r\nCameraRotationSystem = Class({\r\n  constructor: function(entities) {\r\n    this.entities = entities;\r\n  },\r\n\r\n  update: function(dt) {\r\n    var follows = this.entities.queryComponents([C.CameraFollow, C.Velocity]);\r\n\r\n    follows.forEach(function(entity) {\r\n      entity.velocity.rotationMatrix = new THREE.Matrix4().extractRotation(entity.cameraFollow.object.matrix);\r\n    });\r\n  }\r\n});\r\n\r\nCameraFollowSystem = Class({\r\n  constructor: function(entities) {\r\n    this.entities = entities;\r\n  },\r\n\r\n  update: function(dt) {\r\n    var follows = this.entities.queryComponents([C.CameraFollow, C.Position, C.Velocity]);\r\n\r\n    /*if (follows.length > 1) {\r\n      throw new Error(\"The camera can only follow one object at a time!\");\r\n    }*/\r\n\r\n    follows.forEach(function(entity) {\r\n      if (entity.velocity.rotationMatrix === null) {\r\n        return;\r\n      }\r\n\r\n      var offset = entity.cameraFollow.offset.clone();\r\n      offset = offset.applyMatrix4(entity.velocity.rotationMatrix);\r\n\r\n      entity.cameraFollow.object.position.x = entity.position.x + offset.x;\r\n      entity.cameraFollow.object.position.y = entity.position.y + offset.y;\r\n      entity.cameraFollow.object.position.z = entity.position.z + offset.z;\r\n\r\n      entity.drawable.mesh.rotation.x = entity.cameraFollow.object.rotation.x;\r\n      entity.drawable.mesh.rotation.y = entity.cameraFollow.object.rotation.y;\r\n      entity.drawable.mesh.rotation.z = entity.cameraFollow.object.rotation.z;\r\n    });\r\n  }\r\n});\r\n\r\nShootDelaySystem = Class({\r\n  constructor: function(entities) {\r\n    this.entities = entities;\r\n  },\r\n\r\n  update: function(dt) {\r\n    var shooters = this.entities.queryComponents([C.ShootDelay]);\r\n\r\n    shooters.forEach(function(entity) {\r\n      if (entity.shootDelay.canShoot === false) {\r\n        entity.shootDelay.timer += dt;\r\n\r\n        if (entity.shootDelay.timer > entity.shootDelay.delayTheshold) {\r\n          entity.shootDelay.canShoot = true;\r\n          entity.shootDelay.timer = 0;\r\n\r\n          Globals.instance.reloadImg.pause();\r\n          Globals.instance.reloadingElement.style.visibility = \"hidden\";\r\n        }\r\n      }\r\n    });\r\n  }\r\n});\r\n\r\nHurtSystem = Class({\r\n  constructor: function(entities) {\r\n    this.entities = entities;\r\n  },\r\n\r\n  update: function(dt) {\r\n    var hurtables = this.entities.queryComponents([C.Hurt, C.Drawable]);\r\n\r\n    hurtables.forEach(function(entity) {\r\n      entity.hurt.timer += dt;\r\n\r\n      if (entity.hurt.timer < entity.hurt.invulnerabilityFrames) {\r\n        entity.drawable.mesh.material.color = entity.hurt.hurtColor;\r\n      }\r\n      else {\r\n        entity.drawable.mesh.material.color = entity.hurt.originalColor;\r\n\r\n        entity.removeComponent(C.Hurt);\r\n      }\r\n    });\r\n  }\r\n});\r\n\r\nPhysicsUpdateSystem = Class({\r\n  constructor: function(entities) {\r\n    this.entities = entities;\r\n  },\r\n\r\n  update: function(dt) {\r\n    var moveables = this.entities.queryComponents([C.Position, C.Velocity, C.Drawable]);\r\n\r\n    moveables.forEach(function(entity) {\r\n      entity.position.x = entity.drawable.mesh.position.x;\r\n      entity.position.y = entity.drawable.mesh.position.y;\r\n      entity.position.z = entity.drawable.mesh.position.z;\r\n\r\n      entity.velocity.x = entity.drawable.mesh.getLinearVelocity().x;\r\n      entity.velocity.y = entity.drawable.mesh.getLinearVelocity().y;\r\n      entity.velocity.z = entity.drawable.mesh.getLinearVelocity().z;\r\n    });\r\n  }\r\n});\r\n\r\n","MouseController = Class({\r\n  constructor: function() {\r\n    this.isDown = {\r\n      left: false,\r\n      right: false\r\n    };\r\n\r\n    this.wasPressed = {\r\n      left: false,\r\n      right: false\r\n    };\r\n  },\r\n\r\n  update: function(dt) {\r\n    this.wasPressed.left = false;\r\n    this.wasPressed.right = false;\r\n  }\r\n}, {\r\n  statics: {\r\n    get instance() {\r\n      if (!MouseController._instance) {\r\n        MouseController._instance = new MouseController();\r\n      }\r\n      return MouseController._instance;\r\n    }\r\n  }\r\n});\r\n\r\n","module.exports = function(THREE) {\n  'use strict';\n\n  var SUPPORT_TRANSFERABLE,\n    _is_simulating = false,\n    _Physijs = Physijs, // used for noConflict method\n    Physijs = {}, // object assigned to window.Physijs\n    Eventable, // class to provide simple event methods\n    getObjectId, // returns a unique ID for a Physijs mesh object\n    getEulerXYZFromQuaternion, getQuatertionFromEuler,\n    convertWorldPositionToObject, // Converts a world-space position to object-space\n    addObjectChildren,\n\n    _temp1, _temp2,\n    _temp_vector3_1 = new THREE.Vector3,\n    _temp_vector3_2 = new THREE.Vector3,\n    _temp_matrix4_1 = new THREE.Matrix4,\n    _quaternion_1 = new THREE.Quaternion,\n\n    // constants\n    MESSAGE_TYPES = {\n      WORLDREPORT: 0,\n      COLLISIONREPORT: 1,\n      VEHICLEREPORT: 2,\n      CONSTRAINTREPORT: 3\n    },\n    REPORT_ITEMSIZE = 14,\n    COLLISIONREPORT_ITEMSIZE = 5,\n    VEHICLEREPORT_ITEMSIZE = 9,\n    CONSTRAINTREPORT_ITEMSIZE = 6;\n\n  Physijs.scripts = {};\n\n  Eventable = function() {\n    this._eventListeners = {};\n  };\n  Eventable.prototype.addEventListener = function(event_name, callback) {\n    if (!this._eventListeners.hasOwnProperty(event_name)) {\n      this._eventListeners[event_name] = [];\n    }\n    this._eventListeners[event_name].push(callback);\n  };\n  Eventable.prototype.removeEventListener = function(event_name, callback) {\n    var index;\n\n    if (!this._eventListeners.hasOwnProperty(event_name)) return false;\n\n    if ((index = this._eventListeners[event_name].indexOf(callback)) >= 0) {\n      this._eventListeners[event_name].splice(index, 1);\n      return true;\n    }\n\n    return false;\n  };\n  Eventable.prototype.dispatchEvent = function(event_name) {\n    var i,\n      parameters = Array.prototype.splice.call(arguments, 1);\n\n    if (this._eventListeners.hasOwnProperty(event_name)) {\n      for (i = 0; i < this._eventListeners[event_name].length; i++) {\n        this._eventListeners[event_name][i].apply(this, parameters);\n      }\n    }\n  };\n  Eventable.make = function(obj) {\n    obj.prototype.addEventListener = Eventable.prototype.addEventListener;\n    obj.prototype.removeEventListener = Eventable.prototype.removeEventListener;\n    obj.prototype.dispatchEvent = Eventable.prototype.dispatchEvent;\n  };\n\n  getObjectId = (function() {\n    var _id = 1;\n    return function() {\n      return _id++;\n    };\n  })();\n\n  getEulerXYZFromQuaternion = function(x, y, z, w) {\n    return new THREE.Vector3(\n      Math.atan2(2 * (x * w - y * z), (w * w - x * x - y * y + z * z)),\n      Math.asin(2 * (x * z + y * w)),\n      Math.atan2(2 * (z * w - x * y), (w * w + x * x - y * y - z * z))\n    );\n  };\n\n  getQuatertionFromEuler = function(x, y, z) {\n    var c1, s1, c2, s2, c3, s3, c1c2, s1s2;\n    c1 = Math.cos(y);\n    s1 = Math.sin(y);\n    c2 = Math.cos(-z);\n    s2 = Math.sin(-z);\n    c3 = Math.cos(x);\n    s3 = Math.sin(x);\n\n    c1c2 = c1 * c2;\n    s1s2 = s1 * s2;\n\n    return {\n      w: c1c2 * c3 - s1s2 * s3,\n      x: c1c2 * s3 + s1s2 * c3,\n      y: s1 * c2 * c3 + c1 * s2 * s3,\n      z: c1 * s2 * c3 - s1 * c2 * s3\n    };\n  };\n\n  convertWorldPositionToObject = function(position, object) {\n    _temp_matrix4_1.identity(); // reset temp matrix\n\n    // Set the temp matrix's rotation to the object's rotation\n    _temp_matrix4_1.identity().makeRotationFromQuaternion(object.quaternion);\n\n    // Invert rotation matrix in order to \"unrotate\" a point back to object space\n    _temp_matrix4_1.getInverse(_temp_matrix4_1);\n\n    // Yay! Temp vars!\n    _temp_vector3_1.copy(position);\n    _temp_vector3_2.copy(object.position);\n\n    // Apply the rotation\n\n    return _temp_vector3_1.sub(_temp_vector3_2).applyMatrix4(_temp_matrix4_1);\n  };\n\n\n\n  // Physijs.noConflict\n  Physijs.noConflict = function() {\n    window.Physijs = _Physijs;\n    return Physijs;\n  };\n\n\n  // Physijs.createMaterial\n  Physijs.createMaterial = function(material, friction, restitution) {\n    var physijs_material = function() {};\n    physijs_material.prototype = material;\n    physijs_material = new physijs_material;\n\n    physijs_material._physijs = {\n      id: material.id,\n      friction: friction === undefined ? .8 : friction,\n      restitution: restitution === undefined ? .2 : restitution\n    };\n\n    return physijs_material;\n  };\n\n\n  // Constraints\n  Physijs.PointConstraint = function(objecta, objectb, position) {\n    if (position === undefined) {\n      position = objectb;\n      objectb = undefined;\n    }\n\n    this.type = 'point';\n    this.appliedImpulse = 0;\n    this.id = getObjectId();\n    this.objecta = objecta._physijs.id;\n    this.positiona = convertWorldPositionToObject(position, objecta).clone();\n\n    if (objectb) {\n      this.objectb = objectb._physijs.id;\n      this.positionb = convertWorldPositionToObject(position, objectb).clone();\n    }\n  };\n  Physijs.PointConstraint.prototype.getDefinition = function() {\n    return {\n      type: this.type,\n      id: this.id,\n      objecta: this.objecta,\n      objectb: this.objectb,\n      positiona: this.positiona,\n      positionb: this.positionb\n    };\n  };\n\n  Physijs.HingeConstraint = function(objecta, objectb, position, axis) {\n    if (axis === undefined) {\n      axis = position;\n      position = objectb;\n      objectb = undefined;\n    }\n\n    this.type = 'hinge';\n    this.appliedImpulse = 0;\n    this.id = getObjectId();\n    this.scene = objecta.parent;\n    this.objecta = objecta._physijs.id;\n    this.positiona = convertWorldPositionToObject(position, objecta).clone();\n    this.position = position.clone();\n    this.axis = axis;\n\n    if (objectb) {\n      this.objectb = objectb._physijs.id;\n      this.positionb = convertWorldPositionToObject(position, objectb).clone();\n    }\n  };\n  Physijs.HingeConstraint.prototype.getDefinition = function() {\n    return {\n      type: this.type,\n      id: this.id,\n      objecta: this.objecta,\n      objectb: this.objectb,\n      positiona: this.positiona,\n      positionb: this.positionb,\n      axis: this.axis\n    };\n  };\n  /*\n   * low = minimum angle in radians\n   * high = maximum angle in radians\n   * bias_factor = applied as a factor to constraint error\n   * relaxation_factor = controls bounce (0.0 == no bounce)\n   */\n  Physijs.HingeConstraint.prototype.setLimits = function(low, high, bias_factor, relaxation_factor) {\n    this.scene.execute('hinge_setLimits', {\n      constraint: this.id,\n      low: low,\n      high: high,\n      bias_factor: bias_factor,\n      relaxation_factor: relaxation_factor\n    });\n  };\n  Physijs.HingeConstraint.prototype.enableAngularMotor = function(velocity, acceleration) {\n    this.scene.execute('hinge_enableAngularMotor', {\n      constraint: this.id,\n      velocity: velocity,\n      acceleration: acceleration\n    });\n  };\n  Physijs.HingeConstraint.prototype.disableMotor = function(velocity, acceleration) {\n    this.scene.execute('hinge_disableMotor', {\n      constraint: this.id\n    });\n  };\n\n  Physijs.SliderConstraint = function(objecta, objectb, position, axis) {\n    if (axis === undefined) {\n      axis = position;\n      position = objectb;\n      objectb = undefined;\n    }\n\n    this.type = 'slider';\n    this.appliedImpulse = 0;\n    this.id = getObjectId();\n    this.scene = objecta.parent;\n    this.objecta = objecta._physijs.id;\n    this.positiona = convertWorldPositionToObject(position, objecta).clone();\n    this.axis = axis;\n\n    if (objectb) {\n      this.objectb = objectb._physijs.id;\n      this.positionb = convertWorldPositionToObject(position, objectb).clone();\n    }\n  };\n  Physijs.SliderConstraint.prototype.getDefinition = function() {\n    return {\n      type: this.type,\n      id: this.id,\n      objecta: this.objecta,\n      objectb: this.objectb,\n      positiona: this.positiona,\n      positionb: this.positionb,\n      axis: this.axis\n    };\n  };\n  Physijs.SliderConstraint.prototype.setLimits = function(lin_lower, lin_upper, ang_lower, ang_upper) {\n    this.scene.execute('slider_setLimits', {\n      constraint: this.id,\n      lin_lower: lin_lower,\n      lin_upper: lin_upper,\n      ang_lower: ang_lower,\n      ang_upper: ang_upper\n    });\n  };\n  Physijs.SliderConstraint.prototype.setRestitution = function(linear, angular) {\n    this.scene.execute(\n      'slider_setRestitution', {\n        constraint: this.id,\n        linear: linear,\n        angular: angular\n      }\n    );\n  };\n  Physijs.SliderConstraint.prototype.enableLinearMotor = function(velocity, acceleration) {\n    this.scene.execute('slider_enableLinearMotor', {\n      constraint: this.id,\n      velocity: velocity,\n      acceleration: acceleration\n    });\n  };\n  Physijs.SliderConstraint.prototype.disableLinearMotor = function() {\n    this.scene.execute('slider_disableLinearMotor', {\n      constraint: this.id\n    });\n  };\n  Physijs.SliderConstraint.prototype.enableAngularMotor = function(velocity, acceleration) {\n    this.scene.execute('slider_enableAngularMotor', {\n      constraint: this.id,\n      velocity: velocity,\n      acceleration: acceleration\n    });\n  };\n  Physijs.SliderConstraint.prototype.disableAngularMotor = function() {\n    this.scene.execute('slider_disableAngularMotor', {\n      constraint: this.id\n    });\n  };\n\n  Physijs.ConeTwistConstraint = function(objecta, objectb, position) {\n    if (position === undefined) {\n      throw 'Both objects must be defined in a ConeTwistConstraint.';\n    }\n    this.type = 'conetwist';\n    this.appliedImpulse = 0;\n    this.id = getObjectId();\n    this.scene = objecta.parent;\n    this.objecta = objecta._physijs.id;\n    this.positiona = convertWorldPositionToObject(position, objecta).clone();\n    this.objectb = objectb._physijs.id;\n    this.positionb = convertWorldPositionToObject(position, objectb).clone();\n    this.axisa = {\n      x: objecta.rotation.x,\n      y: objecta.rotation.y,\n      z: objecta.rotation.z\n    };\n    this.axisb = {\n      x: objectb.rotation.x,\n      y: objectb.rotation.y,\n      z: objectb.rotation.z\n    };\n  };\n  Physijs.ConeTwistConstraint.prototype.getDefinition = function() {\n    return {\n      type: this.type,\n      id: this.id,\n      objecta: this.objecta,\n      objectb: this.objectb,\n      positiona: this.positiona,\n      positionb: this.positionb,\n      axisa: this.axisa,\n      axisb: this.axisb\n    };\n  };\n  Physijs.ConeTwistConstraint.prototype.setLimit = function(x, y, z) {\n    this.scene.execute('conetwist_setLimit', {\n      constraint: this.id,\n      x: x,\n      y: y,\n      z: z\n    });\n  };\n  Physijs.ConeTwistConstraint.prototype.enableMotor = function() {\n    this.scene.execute('conetwist_enableMotor', {\n      constraint: this.id\n    });\n  };\n  Physijs.ConeTwistConstraint.prototype.setMaxMotorImpulse = function(max_impulse) {\n    this.scene.execute('conetwist_setMaxMotorImpulse', {\n      constraint: this.id,\n      max_impulse: max_impulse\n    });\n  };\n  Physijs.ConeTwistConstraint.prototype.setMotorTarget = function(target) {\n    if (target instanceof THREE.Vector3) {\n      target = new THREE.Quaternion().setFromEuler(new THREE.Euler(target.x, target.y, target.z));\n    }\n    else if (target instanceof THREE.Euler) {\n      target = new THREE.Quaternion().setFromEuler(target);\n    }\n    else if (target instanceof THREE.Matrix4) {\n      target = new THREE.Quaternion().setFromRotationMatrix(target);\n    }\n    this.scene.execute('conetwist_setMotorTarget', {\n      constraint: this.id,\n      x: target.x,\n      y: target.y,\n      z: target.z,\n      w: target.w\n    });\n  };\n  Physijs.ConeTwistConstraint.prototype.disableMotor = function() {\n    this.scene.execute('conetwist_disableMotor', {\n      constraint: this.id\n    });\n  };\n\n  Physijs.DOFConstraint = function(objecta, objectb, position) {\n    if (position === undefined) {\n      position = objectb;\n      objectb = undefined;\n    }\n    this.type = 'dof';\n    this.appliedImpulse = 0;\n    this.id = getObjectId();\n    this.scene = objecta.parent;\n    this.objecta = objecta._physijs.id;\n    this.positiona = convertWorldPositionToObject(position, objecta).clone();\n    this.axisa = {\n      x: objecta.rotation.x,\n      y: objecta.rotation.y,\n      z: objecta.rotation.z\n    };\n\n    if (objectb) {\n      this.objectb = objectb._physijs.id;\n      this.positionb = convertWorldPositionToObject(position, objectb).clone();\n      this.axisb = {\n        x: objectb.rotation.x,\n        y: objectb.rotation.y,\n        z: objectb.rotation.z\n      };\n    }\n  };\n  Physijs.DOFConstraint.prototype.getDefinition = function() {\n    return {\n      type: this.type,\n      id: this.id,\n      objecta: this.objecta,\n      objectb: this.objectb,\n      positiona: this.positiona,\n      positionb: this.positionb,\n      axisa: this.axisa,\n      axisb: this.axisb\n    };\n  };\n  Physijs.DOFConstraint.prototype.setLinearLowerLimit = function(limit) {\n    this.scene.execute('dof_setLinearLowerLimit', {\n      constraint: this.id,\n      x: limit.x,\n      y: limit.y,\n      z: limit.z\n    });\n  };\n  Physijs.DOFConstraint.prototype.setLinearUpperLimit = function(limit) {\n    this.scene.execute('dof_setLinearUpperLimit', {\n      constraint: this.id,\n      x: limit.x,\n      y: limit.y,\n      z: limit.z\n    });\n  };\n  Physijs.DOFConstraint.prototype.setAngularLowerLimit = function(limit) {\n    this.scene.execute('dof_setAngularLowerLimit', {\n      constraint: this.id,\n      x: limit.x,\n      y: limit.y,\n      z: limit.z\n    });\n  };\n  Physijs.DOFConstraint.prototype.setAngularUpperLimit = function(limit) {\n    this.scene.execute('dof_setAngularUpperLimit', {\n      constraint: this.id,\n      x: limit.x,\n      y: limit.y,\n      z: limit.z\n    });\n  };\n  Physijs.DOFConstraint.prototype.enableAngularMotor = function(which) {\n    this.scene.execute('dof_enableAngularMotor', {\n      constraint: this.id,\n      which: which\n    });\n  };\n  Physijs.DOFConstraint.prototype.configureAngularMotor = function(which, low_angle, high_angle, velocity, max_force) {\n    this.scene.execute('dof_configureAngularMotor', {\n      constraint: this.id,\n      which: which,\n      low_angle: low_angle,\n      high_angle: high_angle,\n      velocity: velocity,\n      max_force: max_force\n    });\n  };\n  Physijs.DOFConstraint.prototype.disableAngularMotor = function(which) {\n    this.scene.execute('dof_disableAngularMotor', {\n      constraint: this.id,\n      which: which\n    });\n  };\n\n  // Physijs.Scene\n  Physijs.Scene = function(params) {\n    var self = this;\n\n    Eventable.call(this);\n    THREE.Scene.call(this);\n\n    this._worker = new Worker(Physijs.scripts.worker || 'physijsWorker.js');\n    this._worker.transferableMessage = this._worker.webkitPostMessage || this._worker.postMessage;\n    this._materials_ref_counts = {};\n    this._objects = {};\n    this._vehicles = {};\n    this._constraints = {};\n\n    var ab = new ArrayBuffer(1);\n    this._worker.transferableMessage(ab, [ab]);\n    SUPPORT_TRANSFERABLE = (ab.byteLength === 0);\n\n    this._worker.onerror = function(event) {\n      console.log(event.message);\n      console.log(event.filename);\n      console.log(event.lineno);\n    };\n\n    this._worker.onmessage = function(event) {\n      var _temp,\n        data = event.data;\n\n      if (data instanceof ArrayBuffer && data.byteLength !== 1) { // byteLength === 1 is the worker making a SUPPORT_TRANSFERABLE test\n        data = new Float32Array(data);\n      }\n\n      if (data instanceof Float32Array) {\n\n        // transferable object\n        switch (data[0]) {\n          case MESSAGE_TYPES.WORLDREPORT:\n            self._updateScene(data);\n            break;\n\n          case MESSAGE_TYPES.COLLISIONREPORT:\n            self._updateCollisions(data);\n            break;\n\n          case MESSAGE_TYPES.VEHICLEREPORT:\n            self._updateVehicles(data);\n            break;\n\n          case MESSAGE_TYPES.CONSTRAINTREPORT:\n            self._updateConstraints(data);\n            break;\n        }\n\n      }\n      else {\n\n        if (data.cmd) {\n\n          // non-transferable object\n          switch (data.cmd) {\n            case 'objectReady':\n              _temp = data.params;\n              if (self._objects[_temp]) {\n                self._objects[_temp].dispatchEvent('ready');\n              }\n              break;\n\n            case 'worldReady':\n              self.dispatchEvent('ready');\n              break;\n\n            case 'vehicle':\n              window.test = data;\n              break;\n\n            default:\n              // Do nothing, just show the message\n              console.debug('Received: ' + data.cmd);\n              console.dir(data.params);\n              break;\n          }\n\n        }\n        else {\n\n          switch (data[0]) {\n            case MESSAGE_TYPES.WORLDREPORT:\n              self._updateScene(data);\n              break;\n\n            case MESSAGE_TYPES.COLLISIONREPORT:\n              self._updateCollisions(data);\n              break;\n\n            case MESSAGE_TYPES.VEHICLEREPORT:\n              self._updateVehicles(data);\n              break;\n\n            case MESSAGE_TYPES.CONSTRAINTREPORT:\n              self._updateConstraints(data);\n              break;\n          }\n\n        }\n\n      }\n    };\n\n\n    params = params || {};\n    params.ammo = Physijs.scripts.ammo || 'ammo.js';\n    params.fixedTimeStep = params.fixedTimeStep || 1 / 60;\n    params.rateLimit = params.rateLimit || true;\n    this.execute('init', params);\n  };\n  Physijs.Scene.prototype = new THREE.Scene;\n  Physijs.Scene.prototype.constructor = Physijs.Scene;\n  Eventable.make(Physijs.Scene);\n\n  Physijs.Scene.prototype._updateScene = function(data) {\n    var num_objects = data[1],\n      object,\n      i, offset;\n\n    for (i = 0; i < num_objects; i++) {\n      offset = 2 + i * REPORT_ITEMSIZE;\n      object = this._objects[data[offset]];\n\n      if (object === undefined) {\n        continue;\n      }\n\n      if (object.__dirtyPosition === false) {\n        object.position.set(\n          data[offset + 1],\n          data[offset + 2],\n          data[offset + 3]\n        );\n      }\n\n      if (object.__dirtyRotation === false) {\n        object.quaternion.set(\n          data[offset + 4],\n          data[offset + 5],\n          data[offset + 6],\n          data[offset + 7]\n        );\n      }\n\n      object._physijs.linearVelocity.set(\n        data[offset + 8],\n        data[offset + 9],\n        data[offset + 10]\n      );\n\n      object._physijs.angularVelocity.set(\n        data[offset + 11],\n        data[offset + 12],\n        data[offset + 13]\n      );\n\n    }\n\n    if (SUPPORT_TRANSFERABLE) {\n      // Give the typed array back to the worker\n      this._worker.transferableMessage(data.buffer, [data.buffer]);\n    }\n\n    _is_simulating = false;\n    this.dispatchEvent('update');\n  };\n\n  Physijs.Scene.prototype._updateVehicles = function(data) {\n    var vehicle, wheel,\n      i, offset;\n\n    for (i = 0; i < (data.length - 1) / VEHICLEREPORT_ITEMSIZE; i++) {\n      offset = 1 + i * VEHICLEREPORT_ITEMSIZE;\n      vehicle = this._vehicles[data[offset]];\n\n      if (vehicle === undefined) {\n        continue;\n      }\n\n      wheel = vehicle.wheels[data[offset + 1]];\n\n      wheel.position.set(\n        data[offset + 2],\n        data[offset + 3],\n        data[offset + 4]\n      );\n\n      wheel.quaternion.set(\n        data[offset + 5],\n        data[offset + 6],\n        data[offset + 7],\n        data[offset + 8]\n      );\n    }\n\n    if (SUPPORT_TRANSFERABLE) {\n      // Give the typed array back to the worker\n      this._worker.transferableMessage(data.buffer, [data.buffer]);\n    }\n  };\n\n  Physijs.Scene.prototype._updateConstraints = function(data) {\n    var constraint, object,\n      i, offset;\n\n    for (i = 0; i < (data.length - 1) / CONSTRAINTREPORT_ITEMSIZE; i++) {\n      offset = 1 + i * CONSTRAINTREPORT_ITEMSIZE;\n      constraint = this._constraints[data[offset]];\n      object = this._objects[data[offset + 1]];\n\n      if (constraint === undefined || object === undefined) {\n        continue;\n      }\n\n      _temp_vector3_1.set(\n        data[offset + 2],\n        data[offset + 3],\n        data[offset + 4]\n      );\n      _temp_matrix4_1.extractRotation(object.matrix);\n      _temp_vector3_1.applyMatrix4(_temp_matrix4_1);\n\n      constraint.positiona.addVectors(object.position, _temp_vector3_1);\n      constraint.appliedImpulse = data[offset + 5];\n    }\n\n    if (SUPPORT_TRANSFERABLE) {\n      // Give the typed array back to the worker\n      this._worker.transferableMessage(data.buffer, [data.buffer]);\n    }\n  };\n\n  Physijs.Scene.prototype._updateCollisions = function(data) {\n    /**\n     * #TODO\n     * This is probably the worst way ever to handle collisions. The inherent evilness is a residual\n     * effect from the previous version's evilness which mutated when switching to transferable objects.\n     *\n     * If you feel inclined to make this better, please do so.\n     */\n\n    var i, j, offset, object, object2, id1, id2,\n      collisions = {},\n      normal_offsets = {};\n\n    // Build collision manifest\n    for (i = 0; i < data[1]; i++) {\n      offset = 2 + i * COLLISIONREPORT_ITEMSIZE;\n      object = data[offset];\n      object2 = data[offset + 1];\n\n      normal_offsets[object + '-' + object2] = offset + 2;\n      normal_offsets[object2 + '-' + object] = -1 * (offset + 2);\n\n      // Register collisions for both the object colliding and the object being collided with\n      if (!collisions[object]) collisions[object] = [];\n      collisions[object].push(object2);\n\n      if (!collisions[object2]) collisions[object2] = [];\n      collisions[object2].push(object);\n    }\n\n    // Deal with collisions\n    for (id1 in this._objects) {\n      if (!this._objects.hasOwnProperty(id1)) continue;\n      object = this._objects[id1];\n\n      // If object touches anything, ...\n      if (collisions[id1]) {\n\n        // Clean up touches array\n        for (j = 0; j < object._physijs.touches.length; j++) {\n          if (collisions[id1].indexOf(object._physijs.touches[j]) === -1) {\n            object._physijs.touches.splice(j--, 1);\n          }\n        }\n\n        // Handle each colliding object\n        for (j = 0; j < collisions[id1].length; j++) {\n          id2 = collisions[id1][j];\n          object2 = this._objects[id2];\n\n          if (object2) {\n            // If object was not already touching object2, notify object\n            if (object._physijs.touches.indexOf(id2) === -1) {\n              object._physijs.touches.push(id2);\n\n              _temp_vector3_1.subVectors(object.getLinearVelocity(), object2.getLinearVelocity());\n              _temp1 = _temp_vector3_1.clone();\n\n              _temp_vector3_1.subVectors(object.getAngularVelocity(), object2.getAngularVelocity());\n              _temp2 = _temp_vector3_1.clone();\n\n              var normal_offset = normal_offsets[object._physijs.id + '-' + object2._physijs.id];\n              if (normal_offset > 0) {\n                _temp_vector3_1.set(-data[normal_offset], -data[normal_offset + 1], -data[normal_offset + 2]);\n              }\n              else {\n                normal_offset *= -1;\n                _temp_vector3_1.set(\n                  data[normal_offset],\n                  data[normal_offset + 1],\n                  data[normal_offset + 2]\n                );\n              }\n\n              object.dispatchEvent('collision', object2, _temp1, _temp2, _temp_vector3_1);\n            }\n          }\n        }\n\n      }\n      else {\n\n        // not touching other objects\n        object._physijs.touches.length = 0;\n\n      }\n\n    }\n\n    this.collisions = collisions;\n\n    if (SUPPORT_TRANSFERABLE) {\n      // Give the typed array back to the worker\n      this._worker.transferableMessage(data.buffer, [data.buffer]);\n    }\n  };\n\n  Physijs.Scene.prototype.addConstraint = function(constraint, show_marker) {\n    this._constraints[constraint.id] = constraint;\n    this.execute('addConstraint', constraint.getDefinition());\n\n    if (show_marker) {\n      var marker;\n\n      switch (constraint.type) {\n        case 'point':\n          marker = new THREE.Mesh(\n            new THREE.SphereGeometry(1.5),\n            new THREE.MeshNormalMaterial\n          );\n          marker.position.copy(constraint.positiona);\n          this._objects[constraint.objecta].add(marker);\n          break;\n\n        case 'hinge':\n          marker = new THREE.Mesh(\n            new THREE.SphereGeometry(1.5),\n            new THREE.MeshNormalMaterial\n          );\n          marker.position.copy(constraint.positiona);\n          this._objects[constraint.objecta].add(marker);\n          break;\n\n        case 'slider':\n          marker = new THREE.Mesh(\n            new THREE.BoxGeometry(10, 1, 1),\n            new THREE.MeshNormalMaterial\n          );\n          marker.position.copy(constraint.positiona);\n          // This rotation isn't right if all three axis are non-0 values\n          // TODO: change marker's rotation order to ZYX\n          marker.rotation.set(\n            constraint.axis.y, // yes, y and\n            constraint.axis.x, // x axis are swapped\n            constraint.axis.z\n          );\n          this._objects[constraint.objecta].add(marker);\n          break;\n\n        case 'conetwist':\n          marker = new THREE.Mesh(\n            new THREE.SphereGeometry(1.5),\n            new THREE.MeshNormalMaterial\n          );\n          marker.position.copy(constraint.positiona);\n          this._objects[constraint.objecta].add(marker);\n          break;\n\n        case 'dof':\n          marker = new THREE.Mesh(\n            new THREE.SphereGeometry(1.5),\n            new THREE.MeshNormalMaterial\n          );\n          marker.position.copy(constraint.positiona);\n          this._objects[constraint.objecta].add(marker);\n          break;\n      }\n    }\n\n    return constraint;\n  };\n\n  Physijs.Scene.prototype.onSimulationResume = function() {\n    this.execute('onSimulationResume', {});\n  };\n\n  Physijs.Scene.prototype.removeConstraint = function(constraint) {\n    if (this._constraints[constraint.id] !== undefined) {\n      this.execute('removeConstraint', {\n        id: constraint.id\n      });\n      delete this._constraints[constraint.id];\n    }\n  };\n\n  Physijs.Scene.prototype.execute = function(cmd, params) {\n    this._worker.postMessage({\n      cmd: cmd,\n      params: params\n    });\n  };\n\n  addObjectChildren = function(parent, object) {\n    var i;\n\n    for (i = 0; i < object.children.length; i++) {\n      if (object.children[i]._physijs) {\n        object.children[i].updateMatrix();\n        object.children[i].updateMatrixWorld();\n\n        _temp_vector3_1.setFromMatrixPosition(object.children[i].matrixWorld);\n        _quaternion_1.setFromRotationMatrix(object.children[i].matrixWorld);\n\n        object.children[i]._physijs.position_offset = {\n          x: _temp_vector3_1.x,\n          y: _temp_vector3_1.y,\n          z: _temp_vector3_1.z\n        };\n\n        object.children[i]._physijs.rotation = {\n          x: _quaternion_1.x,\n          y: _quaternion_1.y,\n          z: _quaternion_1.z,\n          w: _quaternion_1.w\n        };\n\n        parent._physijs.children.push(object.children[i]._physijs);\n      }\n\n      addObjectChildren(parent, object.children[i]);\n    }\n  };\n\n  Physijs.Scene.prototype.add = function(object) {\n    THREE.Mesh.prototype.add.call(this, object);\n\n    if (object._physijs) {\n\n      object.world = this;\n\n      if (object instanceof Physijs.Vehicle) {\n\n        this.add(object.mesh);\n        this._vehicles[object._physijs.id] = object;\n        this.execute('addVehicle', object._physijs);\n\n      }\n      else {\n\n        object.__dirtyPosition = false;\n        object.__dirtyRotation = false;\n        this._objects[object._physijs.id] = object;\n\n        if (object.children.length) {\n          object._physijs.children = [];\n          addObjectChildren(object, object);\n        }\n\n        if (object.material._physijs) {\n          if (!this._materials_ref_counts.hasOwnProperty(object.material._physijs.id)) {\n            this.execute('registerMaterial', object.material._physijs);\n            object._physijs.materialId = object.material._physijs.id;\n            this._materials_ref_counts[object.material._physijs.id] = 1;\n          }\n          else {\n            this._materials_ref_counts[object.material._physijs.id]++;\n          }\n        }\n\n        // Object starting position + rotation\n        object._physijs.position = {\n          x: object.position.x,\n          y: object.position.y,\n          z: object.position.z\n        };\n        object._physijs.rotation = {\n          x: object.quaternion.x,\n          y: object.quaternion.y,\n          z: object.quaternion.z,\n          w: object.quaternion.w\n        };\n\n        // Check for scaling\n        var mass_scaling = new THREE.Vector3(1, 1, 1);\n        if (object._physijs.width) {\n          object._physijs.width *= object.scale.x;\n        }\n        if (object._physijs.height) {\n          object._physijs.height *= object.scale.y;\n        }\n        if (object._physijs.depth) {\n          object._physijs.depth *= object.scale.z;\n        }\n\n        this.execute('addObject', object._physijs);\n\n      }\n    }\n  };\n\n  Physijs.Scene.prototype.remove = function(object) {\n    if (object instanceof Physijs.Vehicle) {\n      this.execute('removeVehicle', {\n        id: object._physijs.id\n      });\n      while (object.wheels.length) {\n        this.remove(object.wheels.pop());\n      }\n      this.remove(object.mesh);\n      delete this._vehicles[object._physijs.id];\n    }\n    else {\n      THREE.Mesh.prototype.remove.call(this, object);\n      if (object._physijs) {\n        delete this._objects[object._physijs.id];\n        this.execute('removeObject', {\n          id: object._physijs.id\n        });\n      }\n    }\n    if (object.material && object.material._physijs && this._materials_ref_counts.hasOwnProperty(object.material._physijs.id)) {\n      this._materials_ref_counts[object.material._physijs.id]--;\n      if (this._materials_ref_counts[object.material._physijs.id] == 0) {\n        this.execute('unRegisterMaterial', object.material._physijs);\n        delete this._materials_ref_counts[object.material._physijs.id];\n      }\n    }\n  };\n\n  Physijs.Scene.prototype.setFixedTimeStep = function(fixedTimeStep) {\n    if (fixedTimeStep) {\n      this.execute('setFixedTimeStep', fixedTimeStep);\n    }\n  };\n\n  Physijs.Scene.prototype.setGravity = function(gravity) {\n    if (gravity) {\n      this.execute('setGravity', gravity);\n    }\n  };\n\n  Physijs.Scene.prototype.simulate = function(timeStep, maxSubSteps) {\n    var object_id, object, update;\n\n    if (_is_simulating) {\n      return false;\n    }\n\n    _is_simulating = true;\n\n    for (object_id in this._objects) {\n      if (!this._objects.hasOwnProperty(object_id)) continue;\n\n      object = this._objects[object_id];\n\n      if (object.__dirtyPosition || object.__dirtyRotation) {\n        update = {\n          id: object._physijs.id\n        };\n\n        if (object.__dirtyPosition) {\n          update.pos = {\n            x: object.position.x,\n            y: object.position.y,\n            z: object.position.z\n          };\n          object.__dirtyPosition = false;\n        }\n\n        if (object.__dirtyRotation) {\n          update.quat = {\n            x: object.quaternion.x,\n            y: object.quaternion.y,\n            z: object.quaternion.z,\n            w: object.quaternion.w\n          };\n          object.__dirtyRotation = false;\n        }\n\n        this.execute('updateTransform', update);\n      }\n    }\n\n    this.execute('simulate', {\n      timeStep: timeStep,\n      maxSubSteps: maxSubSteps\n    });\n\n    return true;\n  };\n\n\n  // Phsijs.Mesh\n  Physijs.Mesh = function(geometry, material, mass) {\n    var index;\n\n    if (!geometry) {\n      return;\n    }\n\n    Eventable.call(this);\n    THREE.Mesh.call(this, geometry, material);\n\n    if (!geometry.boundingBox) {\n      geometry.computeBoundingBox();\n    }\n\n    this._physijs = {\n      type: null,\n      id: getObjectId(),\n      mass: mass || 0,\n      touches: [],\n      linearVelocity: new THREE.Vector3,\n      angularVelocity: new THREE.Vector3\n    };\n  };\n  Physijs.Mesh.prototype = new THREE.Mesh;\n  Physijs.Mesh.prototype.constructor = Physijs.Mesh;\n  Eventable.make(Physijs.Mesh);\n\n  // Physijs.Mesh.mass\n  Physijs.Mesh.prototype.__defineGetter__('mass', function() {\n    return this._physijs.mass;\n  });\n  Physijs.Mesh.prototype.__defineSetter__('mass', function(mass) {\n    this._physijs.mass = mass;\n    if (this.world) {\n      this.world.execute('updateMass', {\n        id: this._physijs.id,\n        mass: mass\n      });\n    }\n  });\n\n  // Physijs.Mesh.applyCentralImpulse\n  Physijs.Mesh.prototype.applyCentralImpulse = function(force) {\n    if (this.world) {\n      this.world.execute('applyCentralImpulse', {\n        id: this._physijs.id,\n        x: force.x,\n        y: force.y,\n        z: force.z\n      });\n    }\n  };\n\n  // Physijs.Mesh.applyImpulse\n  Physijs.Mesh.prototype.applyImpulse = function(force, offset) {\n    if (this.world) {\n      this.world.execute('applyImpulse', {\n        id: this._physijs.id,\n        impulse_x: force.x,\n        impulse_y: force.y,\n        impulse_z: force.z,\n        x: offset.x,\n        y: offset.y,\n        z: offset.z\n      });\n    }\n  };\n\n  // Physijs.Mesh.applyTorque\n  Physijs.Mesh.prototype.applyTorque = function(force) {\n    if (this.world) {\n      this.world.execute('applyTorque', {\n        id: this._physijs.id,\n        torque_x: force.x,\n        torque_y: force.y,\n        torque_z: force.z\n      });\n    }\n  };\n\n  // Physijs.Mesh.applyCentralForce\n  Physijs.Mesh.prototype.applyCentralForce = function(force) {\n    if (this.world) {\n      this.world.execute('applyCentralForce', {\n        id: this._physijs.id,\n        x: force.x,\n        y: force.y,\n        z: force.z\n      });\n    }\n  };\n\n  // Physijs.Mesh.applyForce\n  Physijs.Mesh.prototype.applyForce = function(force, offset) {\n    if (this.world) {\n      this.world.execute('applyForce', {\n        id: this._physijs.id,\n        force_x: force.x,\n        force_y: force.y,\n        force_z: force.z,\n        x: offset.x,\n        y: offset.y,\n        z: offset.z\n      });\n    }\n  };\n\n  // Physijs.Mesh.getAngularVelocity\n  Physijs.Mesh.prototype.getAngularVelocity = function() {\n    return this._physijs.angularVelocity;\n  };\n\n  // Physijs.Mesh.setAngularVelocity\n  Physijs.Mesh.prototype.setAngularVelocity = function(velocity) {\n    if (this.world) {\n      this.world.execute('setAngularVelocity', {\n        id: this._physijs.id,\n        x: velocity.x,\n        y: velocity.y,\n        z: velocity.z\n      });\n    }\n  };\n\n  // Physijs.Mesh.getLinearVelocity\n  Physijs.Mesh.prototype.getLinearVelocity = function() {\n    return this._physijs.linearVelocity;\n  };\n\n  // Physijs.Mesh.setLinearVelocity\n  Physijs.Mesh.prototype.setLinearVelocity = function(velocity) {\n    if (this.world) {\n      this.world.execute('setLinearVelocity', {\n        id: this._physijs.id,\n        x: velocity.x,\n        y: velocity.y,\n        z: velocity.z\n      });\n    }\n  };\n\n  // Physijs.Mesh.setAngularFactor\n  Physijs.Mesh.prototype.setAngularFactor = function(factor) {\n    if (this.world) {\n      this.world.execute('setAngularFactor', {\n        id: this._physijs.id,\n        x: factor.x,\n        y: factor.y,\n        z: factor.z\n      });\n    }\n  };\n\n  // Physijs.Mesh.setLinearFactor\n  Physijs.Mesh.prototype.setLinearFactor = function(factor) {\n    if (this.world) {\n      this.world.execute('setLinearFactor', {\n        id: this._physijs.id,\n        x: factor.x,\n        y: factor.y,\n        z: factor.z\n      });\n    }\n  };\n\n  // Physijs.Mesh.setDamping\n  Physijs.Mesh.prototype.setDamping = function(linear, angular) {\n    if (this.world) {\n      this.world.execute('setDamping', {\n        id: this._physijs.id,\n        linear: linear,\n        angular: angular\n      });\n    }\n  };\n\n  // Physijs.Mesh.setCcdMotionThreshold\n  Physijs.Mesh.prototype.setCcdMotionThreshold = function(threshold) {\n    if (this.world) {\n      this.world.execute('setCcdMotionThreshold', {\n        id: this._physijs.id,\n        threshold: threshold\n      });\n    }\n  };\n\n  // Physijs.Mesh.setCcdSweptSphereRadius\n  Physijs.Mesh.prototype.setCcdSweptSphereRadius = function(radius) {\n    if (this.world) {\n      this.world.execute('setCcdSweptSphereRadius', {\n        id: this._physijs.id,\n        radius: radius\n      });\n    }\n  };\n\n\n  // Physijs.PlaneMesh\n  Physijs.PlaneMesh = function(geometry, material, mass) {\n    var width, height;\n\n    Physijs.Mesh.call(this, geometry, material, mass);\n\n    if (!geometry.boundingBox) {\n      geometry.computeBoundingBox();\n    }\n\n    width = geometry.boundingBox.max.x - geometry.boundingBox.min.x;\n    height = geometry.boundingBox.max.y - geometry.boundingBox.min.y;\n\n    this._physijs.type = 'plane';\n    this._physijs.normal = geometry.faces[0].normal.clone();\n    this._physijs.mass = (typeof mass === 'undefined') ? width * height : mass;\n  };\n  Physijs.PlaneMesh.prototype = new Physijs.Mesh;\n  Physijs.PlaneMesh.prototype.constructor = Physijs.PlaneMesh;\n\n  // Physijs.HeightfieldMesh\n  Physijs.HeightfieldMesh = function(geometry, material, mass, xdiv, ydiv) {\n    Physijs.Mesh.call(this, geometry, material, mass);\n\n    this._physijs.type = 'heightfield';\n    this._physijs.xsize = geometry.boundingBox.max.x - geometry.boundingBox.min.x;\n    this._physijs.ysize = geometry.boundingBox.max.y - geometry.boundingBox.min.y;\n    this._physijs.xpts = (typeof xdiv === 'undefined') ? Math.sqrt(geometry.vertices.length) : xdiv + 1;\n    this._physijs.ypts = (typeof ydiv === 'undefined') ? Math.sqrt(geometry.vertices.length) : ydiv + 1;\n    // note - this assumes our plane geometry is square, unless we pass in specific xdiv and ydiv\n    this._physijs.absMaxHeight = Math.max(geometry.boundingBox.max.z, Math.abs(geometry.boundingBox.min.z));\n\n    var points = [];\n\n    var a, b;\n    for (var i = 0; i < geometry.vertices.length; i++) {\n\n      a = i % this._physijs.xpts;\n      b = Math.round((i / this._physijs.xpts) - ((i % this._physijs.xpts) / this._physijs.xpts));\n      points[i] = geometry.vertices[a + ((this._physijs.ypts - b - 1) * this._physijs.ypts)].z;\n\n      //points[i] = geometry.vertices[i];\n    }\n\n    this._physijs.points = points;\n  };\n  Physijs.HeightfieldMesh.prototype = new Physijs.Mesh;\n  Physijs.HeightfieldMesh.prototype.constructor = Physijs.HeightfieldMesh;\n\n  // Physijs.BoxMesh\n  Physijs.BoxMesh = function(geometry, material, mass) {\n    var width, height, depth;\n\n    Physijs.Mesh.call(this, geometry, material, mass);\n\n    if (!geometry.boundingBox) {\n      geometry.computeBoundingBox();\n    }\n\n    width = geometry.boundingBox.max.x - geometry.boundingBox.min.x;\n    height = geometry.boundingBox.max.y - geometry.boundingBox.min.y;\n    depth = geometry.boundingBox.max.z - geometry.boundingBox.min.z;\n\n    this._physijs.type = 'box';\n    this._physijs.width = width;\n    this._physijs.height = height;\n    this._physijs.depth = depth;\n    this._physijs.mass = (typeof mass === 'undefined') ? width * height * depth : mass;\n  };\n  Physijs.BoxMesh.prototype = new Physijs.Mesh;\n  Physijs.BoxMesh.prototype.constructor = Physijs.BoxMesh;\n\n\n  // Physijs.SphereMesh\n  Physijs.SphereMesh = function(geometry, material, mass) {\n    Physijs.Mesh.call(this, geometry, material, mass);\n\n    if (!geometry.boundingSphere) {\n      geometry.computeBoundingSphere();\n    }\n\n    this._physijs.type = 'sphere';\n    this._physijs.radius = geometry.boundingSphere.radius;\n    this._physijs.mass = (typeof mass === 'undefined') ? (4 / 3) * Math.PI * Math.pow(this._physijs.radius, 3) : mass;\n  };\n  Physijs.SphereMesh.prototype = new Physijs.Mesh;\n  Physijs.SphereMesh.prototype.constructor = Physijs.SphereMesh;\n\n\n  // Physijs.CylinderMesh\n  Physijs.CylinderMesh = function(geometry, material, mass) {\n    var width, height, depth;\n\n    Physijs.Mesh.call(this, geometry, material, mass);\n\n    if (!geometry.boundingBox) {\n      geometry.computeBoundingBox();\n    }\n\n    width = geometry.boundingBox.max.x - geometry.boundingBox.min.x;\n    height = geometry.boundingBox.max.y - geometry.boundingBox.min.y;\n    depth = geometry.boundingBox.max.z - geometry.boundingBox.min.z;\n\n    this._physijs.type = 'cylinder';\n    this._physijs.width = width;\n    this._physijs.height = height;\n    this._physijs.depth = depth;\n    this._physijs.mass = (typeof mass === 'undefined') ? width * height * depth : mass;\n  };\n  Physijs.CylinderMesh.prototype = new Physijs.Mesh;\n  Physijs.CylinderMesh.prototype.constructor = Physijs.CylinderMesh;\n\n\n  // Physijs.CapsuleMesh\n  Physijs.CapsuleMesh = function(geometry, material, mass) {\n    var width, height, depth;\n\n    Physijs.Mesh.call(this, geometry, material, mass);\n\n    if (!geometry.boundingBox) {\n      geometry.computeBoundingBox();\n    }\n\n    width = geometry.boundingBox.max.x - geometry.boundingBox.min.x;\n    height = geometry.boundingBox.max.y - geometry.boundingBox.min.y;\n    depth = geometry.boundingBox.max.z - geometry.boundingBox.min.z;\n\n    this._physijs.type = 'capsule';\n    this._physijs.radius = Math.max(width / 2, depth / 2);\n    this._physijs.height = height;\n    this._physijs.mass = (typeof mass === 'undefined') ? width * height * depth : mass;\n  };\n  Physijs.CapsuleMesh.prototype = new Physijs.Mesh;\n  Physijs.CapsuleMesh.prototype.constructor = Physijs.CapsuleMesh;\n\n\n  // Physijs.ConeMesh\n  Physijs.ConeMesh = function(geometry, material, mass) {\n    var width, height, depth;\n\n    Physijs.Mesh.call(this, geometry, material, mass);\n\n    if (!geometry.boundingBox) {\n      geometry.computeBoundingBox();\n    }\n\n    width = geometry.boundingBox.max.x - geometry.boundingBox.min.x;\n    height = geometry.boundingBox.max.y - geometry.boundingBox.min.y;\n\n    this._physijs.type = 'cone';\n    this._physijs.radius = width / 2;\n    this._physijs.height = height;\n    this._physijs.mass = (typeof mass === 'undefined') ? width * height : mass;\n  };\n  Physijs.ConeMesh.prototype = new Physijs.Mesh;\n  Physijs.ConeMesh.prototype.constructor = Physijs.ConeMesh;\n\n\n  // Physijs.ConcaveMesh\n  Physijs.ConcaveMesh = function(geometry, material, mass) {\n    var i,\n      width, height, depth,\n      vertices, face, triangles = [];\n\n    Physijs.Mesh.call(this, geometry, material, mass);\n\n    if (!geometry.boundingBox) {\n      geometry.computeBoundingBox();\n    }\n\n    vertices = geometry.vertices;\n\n    for (i = 0; i < geometry.faces.length; i++) {\n      face = geometry.faces[i];\n      if (face instanceof THREE.Face3) {\n\n        triangles.push([{\n          x: vertices[face.a].x,\n          y: vertices[face.a].y,\n          z: vertices[face.a].z\n        }, {\n          x: vertices[face.b].x,\n          y: vertices[face.b].y,\n          z: vertices[face.b].z\n        }, {\n          x: vertices[face.c].x,\n          y: vertices[face.c].y,\n          z: vertices[face.c].z\n        }]);\n\n      }\n      else if (face instanceof THREE.Face4) {\n\n        triangles.push([{\n          x: vertices[face.a].x,\n          y: vertices[face.a].y,\n          z: vertices[face.a].z\n        }, {\n          x: vertices[face.b].x,\n          y: vertices[face.b].y,\n          z: vertices[face.b].z\n        }, {\n          x: vertices[face.d].x,\n          y: vertices[face.d].y,\n          z: vertices[face.d].z\n        }]);\n        triangles.push([{\n          x: vertices[face.b].x,\n          y: vertices[face.b].y,\n          z: vertices[face.b].z\n        }, {\n          x: vertices[face.c].x,\n          y: vertices[face.c].y,\n          z: vertices[face.c].z\n        }, {\n          x: vertices[face.d].x,\n          y: vertices[face.d].y,\n          z: vertices[face.d].z\n        }]);\n\n      }\n    }\n\n    width = geometry.boundingBox.max.x - geometry.boundingBox.min.x;\n    height = geometry.boundingBox.max.y - geometry.boundingBox.min.y;\n    depth = geometry.boundingBox.max.z - geometry.boundingBox.min.z;\n\n    this._physijs.type = 'concave';\n    this._physijs.triangles = triangles;\n    this._physijs.mass = (typeof mass === 'undefined') ? width * height * depth : mass;\n  };\n  Physijs.ConcaveMesh.prototype = new Physijs.Mesh;\n  Physijs.ConcaveMesh.prototype.constructor = Physijs.ConcaveMesh;\n\n\n  // Physijs.ConvexMesh\n  Physijs.ConvexMesh = function(geometry, material, mass) {\n    var i,\n      width, height, depth,\n      points = [];\n\n    Physijs.Mesh.call(this, geometry, material, mass);\n\n    if (!geometry.boundingBox) {\n      geometry.computeBoundingBox();\n    }\n\n    for (i = 0; i < geometry.vertices.length; i++) {\n      points.push({\n        x: geometry.vertices[i].x,\n        y: geometry.vertices[i].y,\n        z: geometry.vertices[i].z\n      });\n    }\n\n\n    width = geometry.boundingBox.max.x - geometry.boundingBox.min.x;\n    height = geometry.boundingBox.max.y - geometry.boundingBox.min.y;\n    depth = geometry.boundingBox.max.z - geometry.boundingBox.min.z;\n\n    this._physijs.type = 'convex';\n    this._physijs.points = points;\n    this._physijs.mass = (typeof mass === 'undefined') ? width * height * depth : mass;\n  };\n  Physijs.ConvexMesh.prototype = new Physijs.Mesh;\n  Physijs.ConvexMesh.prototype.constructor = Physijs.ConvexMesh;\n\n\n  // Physijs.Vehicle\n  Physijs.Vehicle = function(mesh, tuning) {\n    tuning = tuning || new Physijs.VehicleTuning;\n    this.mesh = mesh;\n    this.wheels = [];\n    this._physijs = {\n      id: getObjectId(),\n      rigidBody: mesh._physijs.id,\n      suspension_stiffness: tuning.suspension_stiffness,\n      suspension_compression: tuning.suspension_compression,\n      suspension_damping: tuning.suspension_damping,\n      max_suspension_travel: tuning.max_suspension_travel,\n      friction_slip: tuning.friction_slip,\n      max_suspension_force: tuning.max_suspension_force\n    };\n  };\n  Physijs.Vehicle.prototype.addWheel = function(wheel_geometry, wheel_material, connection_point, wheel_direction, wheel_axle, suspension_rest_length, wheel_radius, is_front_wheel, tuning) {\n    var wheel = new THREE.Mesh(wheel_geometry, wheel_material);\n    wheel.castShadow = wheel.receiveShadow = true;\n    wheel.position.copy(wheel_direction).multiplyScalar(suspension_rest_length / 100).add(connection_point);\n    this.world.add(wheel);\n    this.wheels.push(wheel);\n\n    this.world.execute('addWheel', {\n      id: this._physijs.id,\n      connection_point: {\n        x: connection_point.x,\n        y: connection_point.y,\n        z: connection_point.z\n      },\n      wheel_direction: {\n        x: wheel_direction.x,\n        y: wheel_direction.y,\n        z: wheel_direction.z\n      },\n      wheel_axle: {\n        x: wheel_axle.x,\n        y: wheel_axle.y,\n        z: wheel_axle.z\n      },\n      suspension_rest_length: suspension_rest_length,\n      wheel_radius: wheel_radius,\n      is_front_wheel: is_front_wheel,\n      tuning: tuning\n    });\n  };\n  Physijs.Vehicle.prototype.setSteering = function(amount, wheel) {\n    if (wheel !== undefined && this.wheels[wheel] !== undefined) {\n      this.world.execute('setSteering', {\n        id: this._physijs.id,\n        wheel: wheel,\n        steering: amount\n      });\n    }\n    else if (this.wheels.length > 0) {\n      for (var i = 0; i < this.wheels.length; i++) {\n        this.world.execute('setSteering', {\n          id: this._physijs.id,\n          wheel: i,\n          steering: amount\n        });\n      }\n    }\n  };\n  Physijs.Vehicle.prototype.setBrake = function(amount, wheel) {\n    if (wheel !== undefined && this.wheels[wheel] !== undefined) {\n      this.world.execute('setBrake', {\n        id: this._physijs.id,\n        wheel: wheel,\n        brake: amount\n      });\n    }\n    else if (this.wheels.length > 0) {\n      for (var i = 0; i < this.wheels.length; i++) {\n        this.world.execute('setBrake', {\n          id: this._physijs.id,\n          wheel: i,\n          brake: amount\n        });\n      }\n    }\n  };\n  Physijs.Vehicle.prototype.applyEngineForce = function(amount, wheel) {\n    if (wheel !== undefined && this.wheels[wheel] !== undefined) {\n      this.world.execute('applyEngineForce', {\n        id: this._physijs.id,\n        wheel: wheel,\n        force: amount\n      });\n    }\n    else if (this.wheels.length > 0) {\n      for (var i = 0; i < this.wheels.length; i++) {\n        this.world.execute('applyEngineForce', {\n          id: this._physijs.id,\n          wheel: i,\n          force: amount\n        });\n      }\n    }\n  };\n\n  // Physijs.VehicleTuning\n  Physijs.VehicleTuning = function(suspension_stiffness, suspension_compression, suspension_damping, max_suspension_travel, friction_slip, max_suspension_force) {\n    this.suspension_stiffness = suspension_stiffness !== undefined ? suspension_stiffness : 5.88;\n    this.suspension_compression = suspension_compression !== undefined ? suspension_compression : 0.83;\n    this.suspension_damping = suspension_damping !== undefined ? suspension_damping : 0.88;\n    this.max_suspension_travel = max_suspension_travel !== undefined ? max_suspension_travel : 500;\n    this.friction_slip = friction_slip !== undefined ? friction_slip : 10.5;\n    this.max_suspension_force = max_suspension_force !== undefined ? max_suspension_force : 6000;\n  };\n\n  return Physijs;\n}\n\n","/** @preserve http://github.com/easeway/js-class */\n\n// Class Definition using ECMA5 prototype chain\n\nfunction inherit(dest, src, noParent) {\n    while (src && src !== Object.prototype) {\n        Object.getOwnPropertyNames(src).forEach(function (name) {\n            if (name != '.class' && !dest.hasOwnProperty(name)) {\n                var desc = Object.getOwnPropertyDescriptor(src, name);\n                Object.defineProperty(dest, name, desc);\n            }\n        });\n        if (noParent) {\n            break;\n        }\n        src = src.__proto__;\n    }\n    return dest;\n}\n\nvar Class = function (base, proto, options) {\n    if (typeof(base) != 'function') {\n        options = proto;\n        proto = base;\n        base = Object;\n    }\n    if (!proto) {\n        proto = {};\n    }\n    if (!options) {\n        options = {};\n    }\n    \n    var meta = {\n        name: options.name,\n        base: base,\n        implements: []\n    }\n    var classProto = Class.clone(proto);\n    if (options.implements) {\n        (Array.isArray(options.implements) ? options.implements : [options.implements])\n            .forEach(function (implementedType) {\n                if (typeof(implementedType) == 'function' && implementedType.prototype) {\n                    meta.implements.push(implementedType);\n                    Class.extend(classProto, implementedType.prototype);\n                }\n            });\n    }\n    classProto.__proto__ = base.prototype;\n    var theClass = function () {\n        if (typeof(this.constructor) == 'function') {\n            this.constructor.apply(this, arguments);\n        }\n    };\n    meta.type = theClass;\n    theClass.prototype = classProto;\n    Object.defineProperty(theClass, '.class.meta', { value: meta, enumerable: false, configurable: false, writable: false });\n    Object.defineProperty(classProto, '.class', { value: theClass, enumerable: false, configurable: false, writable: false });\n    if (options.statics) {\n        Class.extend(theClass, options.statics);\n    }\n    return theClass;\n};\n\nClass.extend = inherit;\n\nClass.clone = function (object) {\n    return inherit({}, object);\n};\n\nfunction findType(meta, type) {\n    while (meta) {\n        if (meta.type.prototype === type.prototype) {\n            return true;\n        }\n        for (var i in meta.implements) {\n            var implType = meta.implements[i];\n            var implMeta = implType['.class.meta'];\n            if (implMeta) {\n                if (findType(implMeta, type)) {\n                    return true;\n                }\n            } else {\n                for (var proto = implType.prototype; proto; proto = proto.__proto__) {\n                    if (proto === type.prototype) {\n                        return true;\n                    }\n                }\n            }\n        }\n        meta = meta.base ? meta.base['.class.meta'] : undefined;\n    }\n    return false;\n}\n\nvar Checker = Class({\n    constructor: function (object) {\n        this.object = object;\n    },\n    \n    typeOf: function (type) {\n        if (this.object instanceof type) {\n            return true;\n        }\n        var meta = Class.typeInfo(this.object);\n        return meta && findType(meta, type);\n    }\n});\n\n// aliases\nChecker.prototype.a = Checker.prototype.typeOf;\nChecker.prototype.an = Checker.prototype.typeOf;\n\nClass.is = function (object) {\n    return new Checker(object);\n};\n\nClass.typeInfo = function (object) {\n    var theClass = object.__proto__['.class'];\n    return theClass ? theClass['.class.meta'] : undefined;\n};\n\nClass.VERSION = [0, 0, 2];\n\nif (module) {\n    module.exports = Class;\n} else {\n    global.Class = Class;   // for browser\n}","/**\n * @author mrdoob / http://mrdoob.com/\n */\n\nvar Stats = function () {\n\n\tvar startTime = Date.now(), prevTime = startTime;\n\tvar ms = 0, msMin = Infinity, msMax = 0;\n\tvar fps = 0, fpsMin = Infinity, fpsMax = 0;\n\tvar frames = 0, mode = 0;\n\n\tvar container = document.createElement( 'div' );\n\tcontainer.id = 'stats';\n\tcontainer.addEventListener( 'mousedown', function ( event ) { event.preventDefault(); setMode( ++ mode % 2 ) }, false );\n\tcontainer.style.cssText = 'width:80px;opacity:0.9;cursor:pointer';\n\n\tvar fpsDiv = document.createElement( 'div' );\n\tfpsDiv.id = 'fps';\n\tfpsDiv.style.cssText = 'padding:0 0 3px 3px;text-align:left;background-color:#002';\n\tcontainer.appendChild( fpsDiv );\n\n\tvar fpsText = document.createElement( 'div' );\n\tfpsText.id = 'fpsText';\n\tfpsText.style.cssText = 'color:#0ff;font-family:Helvetica,Arial,sans-serif;font-size:9px;font-weight:bold;line-height:15px';\n\tfpsText.innerHTML = 'FPS';\n\tfpsDiv.appendChild( fpsText );\n\n\tvar fpsGraph = document.createElement( 'div' );\n\tfpsGraph.id = 'fpsGraph';\n\tfpsGraph.style.cssText = 'position:relative;width:74px;height:30px;background-color:#0ff';\n\tfpsDiv.appendChild( fpsGraph );\n\n\twhile ( fpsGraph.children.length < 74 ) {\n\n\t\tvar bar = document.createElement( 'span' );\n\t\tbar.style.cssText = 'width:1px;height:30px;float:left;background-color:#113';\n\t\tfpsGraph.appendChild( bar );\n\n\t}\n\n\tvar msDiv = document.createElement( 'div' );\n\tmsDiv.id = 'ms';\n\tmsDiv.style.cssText = 'padding:0 0 3px 3px;text-align:left;background-color:#020;display:none';\n\tcontainer.appendChild( msDiv );\n\n\tvar msText = document.createElement( 'div' );\n\tmsText.id = 'msText';\n\tmsText.style.cssText = 'color:#0f0;font-family:Helvetica,Arial,sans-serif;font-size:9px;font-weight:bold;line-height:15px';\n\tmsText.innerHTML = 'MS';\n\tmsDiv.appendChild( msText );\n\n\tvar msGraph = document.createElement( 'div' );\n\tmsGraph.id = 'msGraph';\n\tmsGraph.style.cssText = 'position:relative;width:74px;height:30px;background-color:#0f0';\n\tmsDiv.appendChild( msGraph );\n\n\twhile ( msGraph.children.length < 74 ) {\n\n\t\tvar bar = document.createElement( 'span' );\n\t\tbar.style.cssText = 'width:1px;height:30px;float:left;background-color:#131';\n\t\tmsGraph.appendChild( bar );\n\n\t}\n\n\tvar setMode = function ( value ) {\n\n\t\tmode = value;\n\n\t\tswitch ( mode ) {\n\n\t\t\tcase 0:\n\t\t\t\tfpsDiv.style.display = 'block';\n\t\t\t\tmsDiv.style.display = 'none';\n\t\t\t\tbreak;\n\t\t\tcase 1:\n\t\t\t\tfpsDiv.style.display = 'none';\n\t\t\t\tmsDiv.style.display = 'block';\n\t\t\t\tbreak;\n\t\t}\n\n\t};\n\n\tvar updateGraph = function ( dom, value ) {\n\n\t\tvar child = dom.appendChild( dom.firstChild );\n\t\tchild.style.height = value + 'px';\n\n\t};\n\n\treturn {\n\n\t\tREVISION: 12,\n\n\t\tdomElement: container,\n\n\t\tsetMode: setMode,\n\n\t\tbegin: function () {\n\n\t\t\tstartTime = Date.now();\n\n\t\t},\n\n\t\tend: function () {\n\n\t\t\tvar time = Date.now();\n\n\t\t\tms = time - startTime;\n\t\t\tmsMin = Math.min( msMin, ms );\n\t\t\tmsMax = Math.max( msMax, ms );\n\n\t\t\tmsText.textContent = ms + ' MS (' + msMin + '-' + msMax + ')';\n\t\t\tupdateGraph( msGraph, Math.min( 30, 30 - ( ms / 200 ) * 30 ) );\n\n\t\t\tframes ++;\n\n\t\t\tif ( time > prevTime + 1000 ) {\n\n\t\t\t\tfps = Math.round( ( frames * 1000 ) / ( time - prevTime ) );\n\t\t\t\tfpsMin = Math.min( fpsMin, fps );\n\t\t\t\tfpsMax = Math.max( fpsMax, fps );\n\n\t\t\t\tfpsText.textContent = fps + ' FPS (' + fpsMin + '-' + fpsMax + ')';\n\t\t\t\tupdateGraph( fpsGraph, Math.min( 30, 30 - ( fps / 100 ) * 30 ) );\n\n\t\t\t\tprevTime = time;\n\t\t\t\tframes = 0;\n\n\t\t\t}\n\n\t\t\treturn time;\n\n\t\t},\n\n\t\tupdate: function () {\n\n\t\t\tstartTime = this.end();\n\n\t\t}\n\n\t}\n\n};\n\nif ( typeof module === 'object' ) {\n\n\tmodule.exports = Stats;\n\n}","var self = self || {}; // File:src/Three.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nvar THREE = {\r\n  REVISION: '71'\r\n};\r\n\r\n// browserify support\r\n\r\nif (typeof module === 'object') {\r\n\r\n  module.exports = THREE;\r\n\r\n}\r\n\r\n// polyfills\r\n\r\nif (Math.sign === undefined) {\r\n\r\n  // https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Math/sign\r\n\r\n  Math.sign = function(x) {\r\n\r\n    return (x < 0) ? -1 : (x > 0) ? 1 : +x;\r\n\r\n  };\r\n\r\n}\r\n\r\n\r\n// set the default log handlers\r\nTHREE.log = function() {\r\n  console.log.apply(console, arguments);\r\n}\r\nTHREE.warn = function() {\r\n  console.warn.apply(console, arguments);\r\n}\r\nTHREE.error = function() {\r\n  console.error.apply(console, arguments);\r\n}\r\n\r\n\r\n// https://developer.mozilla.org/en-US/docs/Web/API/MouseEvent.button\r\n\r\nTHREE.MOUSE = {\r\n  LEFT: 0,\r\n  MIDDLE: 1,\r\n  RIGHT: 2\r\n};\r\n\r\n// GL STATE CONSTANTS\r\n\r\nTHREE.CullFaceNone = 0;\r\nTHREE.CullFaceBack = 1;\r\nTHREE.CullFaceFront = 2;\r\nTHREE.CullFaceFrontBack = 3;\r\n\r\nTHREE.FrontFaceDirectionCW = 0;\r\nTHREE.FrontFaceDirectionCCW = 1;\r\n\r\n// SHADOWING TYPES\r\n\r\nTHREE.BasicShadowMap = 0;\r\nTHREE.PCFShadowMap = 1;\r\nTHREE.PCFSoftShadowMap = 2;\r\n\r\n// MATERIAL CONSTANTS\r\n\r\n// side\r\n\r\nTHREE.FrontSide = 0;\r\nTHREE.BackSide = 1;\r\nTHREE.DoubleSide = 2;\r\n\r\n// shading\r\n\r\nTHREE.NoShading = 0;\r\nTHREE.FlatShading = 1;\r\nTHREE.SmoothShading = 2;\r\n\r\n// colors\r\n\r\nTHREE.NoColors = 0;\r\nTHREE.FaceColors = 1;\r\nTHREE.VertexColors = 2;\r\n\r\n// blending modes\r\n\r\nTHREE.NoBlending = 0;\r\nTHREE.NormalBlending = 1;\r\nTHREE.AdditiveBlending = 2;\r\nTHREE.SubtractiveBlending = 3;\r\nTHREE.MultiplyBlending = 4;\r\nTHREE.CustomBlending = 5;\r\n\r\n// custom blending equations\r\n// (numbers start from 100 not to clash with other\r\n//  mappings to OpenGL constants defined in Texture.js)\r\n\r\nTHREE.AddEquation = 100;\r\nTHREE.SubtractEquation = 101;\r\nTHREE.ReverseSubtractEquation = 102;\r\nTHREE.MinEquation = 103;\r\nTHREE.MaxEquation = 104;\r\n\r\n// custom blending destination factors\r\n\r\nTHREE.ZeroFactor = 200;\r\nTHREE.OneFactor = 201;\r\nTHREE.SrcColorFactor = 202;\r\nTHREE.OneMinusSrcColorFactor = 203;\r\nTHREE.SrcAlphaFactor = 204;\r\nTHREE.OneMinusSrcAlphaFactor = 205;\r\nTHREE.DstAlphaFactor = 206;\r\nTHREE.OneMinusDstAlphaFactor = 207;\r\n\r\n// custom blending source factors\r\n\r\n//THREE.ZeroFactor = 200;\r\n//THREE.OneFactor = 201;\r\n//THREE.SrcAlphaFactor = 204;\r\n//THREE.OneMinusSrcAlphaFactor = 205;\r\n//THREE.DstAlphaFactor = 206;\r\n//THREE.OneMinusDstAlphaFactor = 207;\r\nTHREE.DstColorFactor = 208;\r\nTHREE.OneMinusDstColorFactor = 209;\r\nTHREE.SrcAlphaSaturateFactor = 210;\r\n\r\n\r\n// TEXTURE CONSTANTS\r\n\r\nTHREE.MultiplyOperation = 0;\r\nTHREE.MixOperation = 1;\r\nTHREE.AddOperation = 2;\r\n\r\n// Mapping modes\r\n\r\nTHREE.UVMapping = 300;\r\n\r\nTHREE.CubeReflectionMapping = 301;\r\nTHREE.CubeRefractionMapping = 302;\r\n\r\nTHREE.EquirectangularReflectionMapping = 303;\r\nTHREE.EquirectangularRefractionMapping = 304;\r\n\r\nTHREE.SphericalReflectionMapping = 305;\r\n\r\n// Wrapping modes\r\n\r\nTHREE.RepeatWrapping = 1000;\r\nTHREE.ClampToEdgeWrapping = 1001;\r\nTHREE.MirroredRepeatWrapping = 1002;\r\n\r\n// Filters\r\n\r\nTHREE.NearestFilter = 1003;\r\nTHREE.NearestMipMapNearestFilter = 1004;\r\nTHREE.NearestMipMapLinearFilter = 1005;\r\nTHREE.LinearFilter = 1006;\r\nTHREE.LinearMipMapNearestFilter = 1007;\r\nTHREE.LinearMipMapLinearFilter = 1008;\r\n\r\n// Data types\r\n\r\nTHREE.UnsignedByteType = 1009;\r\nTHREE.ByteType = 1010;\r\nTHREE.ShortType = 1011;\r\nTHREE.UnsignedShortType = 1012;\r\nTHREE.IntType = 1013;\r\nTHREE.UnsignedIntType = 1014;\r\nTHREE.FloatType = 1015;\r\nTHREE.HalfFloatType = 1025;\r\n\r\n// Pixel types\r\n\r\n//THREE.UnsignedByteType = 1009;\r\nTHREE.UnsignedShort4444Type = 1016;\r\nTHREE.UnsignedShort5551Type = 1017;\r\nTHREE.UnsignedShort565Type = 1018;\r\n\r\n// Pixel formats\r\n\r\nTHREE.AlphaFormat = 1019;\r\nTHREE.RGBFormat = 1020;\r\nTHREE.RGBAFormat = 1021;\r\nTHREE.LuminanceFormat = 1022;\r\nTHREE.LuminanceAlphaFormat = 1023;\r\n// THREE.RGBEFormat handled as THREE.RGBAFormat in shaders\r\nTHREE.RGBEFormat = THREE.RGBAFormat; //1024;\r\n\r\n// DDS / ST3C Compressed texture formats\r\n\r\nTHREE.RGB_S3TC_DXT1_Format = 2001;\r\nTHREE.RGBA_S3TC_DXT1_Format = 2002;\r\nTHREE.RGBA_S3TC_DXT3_Format = 2003;\r\nTHREE.RGBA_S3TC_DXT5_Format = 2004;\r\n\r\n\r\n// PVRTC compressed texture formats\r\n\r\nTHREE.RGB_PVRTC_4BPPV1_Format = 2100;\r\nTHREE.RGB_PVRTC_2BPPV1_Format = 2101;\r\nTHREE.RGBA_PVRTC_4BPPV1_Format = 2102;\r\nTHREE.RGBA_PVRTC_2BPPV1_Format = 2103;\r\n\r\n\r\n// DEPRECATED\r\n\r\nTHREE.Projector = function() {\r\n\r\n  THREE.error('THREE.Projector has been moved to /examples/js/renderers/Projector.js.');\r\n\r\n  this.projectVector = function(vector, camera) {\r\n\r\n    THREE.warn('THREE.Projector: .projectVector() is now vector.project().');\r\n    vector.project(camera);\r\n\r\n  };\r\n\r\n  this.unprojectVector = function(vector, camera) {\r\n\r\n    THREE.warn('THREE.Projector: .unprojectVector() is now vector.unproject().');\r\n    vector.unproject(camera);\r\n\r\n  };\r\n\r\n  this.pickingRay = function(vector, camera) {\r\n\r\n    THREE.error('THREE.Projector: .pickingRay() is now raycaster.setFromCamera().');\r\n\r\n  };\r\n\r\n};\r\n\r\nTHREE.CanvasRenderer = function() {\r\n\r\n  THREE.error('THREE.CanvasRenderer has been moved to /examples/js/renderers/CanvasRenderer.js');\r\n\r\n  this.domElement = document.createElement('canvas');\r\n  this.clear = function() {};\r\n  this.render = function() {};\r\n  this.setClearColor = function() {};\r\n  this.setSize = function() {};\r\n\r\n};\r\n\r\n// File:src/math/Color.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.Color = function(color) {\r\n\r\n  if (arguments.length === 3) {\r\n\r\n    return this.setRGB(arguments[0], arguments[1], arguments[2]);\r\n\r\n  }\r\n\r\n  return this.set(color)\r\n\r\n};\r\n\r\nTHREE.Color.prototype = {\r\n\r\n  constructor: THREE.Color,\r\n\r\n  r: 1,\r\n  g: 1,\r\n  b: 1,\r\n\r\n  set: function(value) {\r\n\r\n    if (value instanceof THREE.Color) {\r\n\r\n      this.copy(value);\r\n\r\n    }\r\n    else if (typeof value === 'number') {\r\n\r\n      this.setHex(value);\r\n\r\n    }\r\n    else if (typeof value === 'string') {\r\n\r\n      this.setStyle(value);\r\n\r\n    }\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  setHex: function(hex) {\r\n\r\n    hex = Math.floor(hex);\r\n\r\n    this.r = (hex >> 16 & 255) / 255;\r\n    this.g = (hex >> 8 & 255) / 255;\r\n    this.b = (hex & 255) / 255;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  setRGB: function(r, g, b) {\r\n\r\n    this.r = r;\r\n    this.g = g;\r\n    this.b = b;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  setHSL: function(h, s, l) {\r\n\r\n    // h,s,l ranges are in 0.0 - 1.0\r\n\r\n    if (s === 0) {\r\n\r\n      this.r = this.g = this.b = l;\r\n\r\n    }\r\n    else {\r\n\r\n      var hue2rgb = function(p, q, t) {\r\n\r\n        if (t < 0) t += 1;\r\n        if (t > 1) t -= 1;\r\n        if (t < 1 / 6) return p + (q - p) * 6 * t;\r\n        if (t < 1 / 2) return q;\r\n        if (t < 2 / 3) return p + (q - p) * 6 * (2 / 3 - t);\r\n        return p;\r\n\r\n      };\r\n\r\n      var p = l <= 0.5 ? l * (1 + s) : l + s - (l * s);\r\n      var q = (2 * l) - p;\r\n\r\n      this.r = hue2rgb(q, p, h + 1 / 3);\r\n      this.g = hue2rgb(q, p, h);\r\n      this.b = hue2rgb(q, p, h - 1 / 3);\r\n\r\n    }\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  setStyle: function(style) {\r\n\r\n    // rgb(255,0,0)\r\n\r\n    if (/^rgb\\((\\d+), ?(\\d+), ?(\\d+)\\)$/i.test(style)) {\r\n\r\n      var color = /^rgb\\((\\d+), ?(\\d+), ?(\\d+)\\)$/i.exec(style);\r\n\r\n      this.r = Math.min(255, parseInt(color[1], 10)) / 255;\r\n      this.g = Math.min(255, parseInt(color[2], 10)) / 255;\r\n      this.b = Math.min(255, parseInt(color[3], 10)) / 255;\r\n\r\n      return this;\r\n\r\n    }\r\n\r\n    // rgb(100%,0%,0%)\r\n\r\n    if (/^rgb\\((\\d+)\\%, ?(\\d+)\\%, ?(\\d+)\\%\\)$/i.test(style)) {\r\n\r\n      var color = /^rgb\\((\\d+)\\%, ?(\\d+)\\%, ?(\\d+)\\%\\)$/i.exec(style);\r\n\r\n      this.r = Math.min(100, parseInt(color[1], 10)) / 100;\r\n      this.g = Math.min(100, parseInt(color[2], 10)) / 100;\r\n      this.b = Math.min(100, parseInt(color[3], 10)) / 100;\r\n\r\n      return this;\r\n\r\n    }\r\n\r\n    // #ff0000\r\n\r\n    if (/^\\#([0-9a-f]{6})$/i.test(style)) {\r\n\r\n      var color = /^\\#([0-9a-f]{6})$/i.exec(style);\r\n\r\n      this.setHex(parseInt(color[1], 16));\r\n\r\n      return this;\r\n\r\n    }\r\n\r\n    // #f00\r\n\r\n    if (/^\\#([0-9a-f])([0-9a-f])([0-9a-f])$/i.test(style)) {\r\n\r\n      var color = /^\\#([0-9a-f])([0-9a-f])([0-9a-f])$/i.exec(style);\r\n\r\n      this.setHex(parseInt(color[1] + color[1] + color[2] + color[2] + color[3] + color[3], 16));\r\n\r\n      return this;\r\n\r\n    }\r\n\r\n    // red\r\n\r\n    if (/^(\\w+)$/i.test(style)) {\r\n\r\n      this.setHex(THREE.ColorKeywords[style]);\r\n\r\n      return this;\r\n\r\n    }\r\n\r\n\r\n  },\r\n\r\n  copy: function(color) {\r\n\r\n    this.r = color.r;\r\n    this.g = color.g;\r\n    this.b = color.b;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  copyGammaToLinear: function(color, gammaFactor) {\r\n\r\n    if (gammaFactor === undefined) gammaFactor = 2.0;\r\n\r\n    this.r = Math.pow(color.r, gammaFactor);\r\n    this.g = Math.pow(color.g, gammaFactor);\r\n    this.b = Math.pow(color.b, gammaFactor);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  copyLinearToGamma: function(color, gammaFactor) {\r\n\r\n    if (gammaFactor === undefined) gammaFactor = 2.0;\r\n\r\n    var safeInverse = (gammaFactor > 0) ? (1.0 / gammaFactor) : 1.0;\r\n\r\n    this.r = Math.pow(color.r, safeInverse);\r\n    this.g = Math.pow(color.g, safeInverse);\r\n    this.b = Math.pow(color.b, safeInverse);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  convertGammaToLinear: function() {\r\n\r\n    var r = this.r,\r\n      g = this.g,\r\n      b = this.b;\r\n\r\n    this.r = r * r;\r\n    this.g = g * g;\r\n    this.b = b * b;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  convertLinearToGamma: function() {\r\n\r\n    this.r = Math.sqrt(this.r);\r\n    this.g = Math.sqrt(this.g);\r\n    this.b = Math.sqrt(this.b);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  getHex: function() {\r\n\r\n    return (this.r * 255) << 16 ^ (this.g * 255) << 8 ^ (this.b * 255) << 0;\r\n\r\n  },\r\n\r\n  getHexString: function() {\r\n\r\n    return ('000000' + this.getHex().toString(16)).slice(-6);\r\n\r\n  },\r\n\r\n  getHSL: function(optionalTarget) {\r\n\r\n    // h,s,l ranges are in 0.0 - 1.0\r\n\r\n    var hsl = optionalTarget || {\r\n      h: 0,\r\n      s: 0,\r\n      l: 0\r\n    };\r\n\r\n    var r = this.r,\r\n      g = this.g,\r\n      b = this.b;\r\n\r\n    var max = Math.max(r, g, b);\r\n    var min = Math.min(r, g, b);\r\n\r\n    var hue, saturation;\r\n    var lightness = (min + max) / 2.0;\r\n\r\n    if (min === max) {\r\n\r\n      hue = 0;\r\n      saturation = 0;\r\n\r\n    }\r\n    else {\r\n\r\n      var delta = max - min;\r\n\r\n      saturation = lightness <= 0.5 ? delta / (max + min) : delta / (2 - max - min);\r\n\r\n      switch (max) {\r\n\r\n        case r:\r\n          hue = (g - b) / delta + (g < b ? 6 : 0);\r\n          break;\r\n        case g:\r\n          hue = (b - r) / delta + 2;\r\n          break;\r\n        case b:\r\n          hue = (r - g) / delta + 4;\r\n          break;\r\n\r\n      }\r\n\r\n      hue /= 6;\r\n\r\n    }\r\n\r\n    hsl.h = hue;\r\n    hsl.s = saturation;\r\n    hsl.l = lightness;\r\n\r\n    return hsl;\r\n\r\n  },\r\n\r\n  getStyle: function() {\r\n\r\n    return 'rgb(' + ((this.r * 255) | 0) + ',' + ((this.g * 255) | 0) + ',' + ((this.b * 255) | 0) + ')';\r\n\r\n  },\r\n\r\n  offsetHSL: function(h, s, l) {\r\n\r\n    var hsl = this.getHSL();\r\n\r\n    hsl.h += h;\r\n    hsl.s += s;\r\n    hsl.l += l;\r\n\r\n    this.setHSL(hsl.h, hsl.s, hsl.l);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  add: function(color) {\r\n\r\n    this.r += color.r;\r\n    this.g += color.g;\r\n    this.b += color.b;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  addColors: function(color1, color2) {\r\n\r\n    this.r = color1.r + color2.r;\r\n    this.g = color1.g + color2.g;\r\n    this.b = color1.b + color2.b;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  addScalar: function(s) {\r\n\r\n    this.r += s;\r\n    this.g += s;\r\n    this.b += s;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  multiply: function(color) {\r\n\r\n    this.r *= color.r;\r\n    this.g *= color.g;\r\n    this.b *= color.b;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  multiplyScalar: function(s) {\r\n\r\n    this.r *= s;\r\n    this.g *= s;\r\n    this.b *= s;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  lerp: function(color, alpha) {\r\n\r\n    this.r += (color.r - this.r) * alpha;\r\n    this.g += (color.g - this.g) * alpha;\r\n    this.b += (color.b - this.b) * alpha;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  equals: function(c) {\r\n\r\n    return (c.r === this.r) && (c.g === this.g) && (c.b === this.b);\r\n\r\n  },\r\n\r\n  fromArray: function(array) {\r\n\r\n    this.r = array[0];\r\n    this.g = array[1];\r\n    this.b = array[2];\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  toArray: function(array, offset) {\r\n\r\n    if (array === undefined) array = [];\r\n    if (offset === undefined) offset = 0;\r\n\r\n    array[offset] = this.r;\r\n    array[offset + 1] = this.g;\r\n    array[offset + 2] = this.b;\r\n\r\n    return array;\r\n  },\r\n\r\n  clone: function() {\r\n\r\n    return new THREE.Color().setRGB(this.r, this.g, this.b);\r\n\r\n  }\r\n\r\n};\r\n\r\nTHREE.ColorKeywords = {\r\n  'aliceblue': 0xF0F8FF,\r\n  'antiquewhite': 0xFAEBD7,\r\n  'aqua': 0x00FFFF,\r\n  'aquamarine': 0x7FFFD4,\r\n  'azure': 0xF0FFFF,\r\n  'beige': 0xF5F5DC,\r\n  'bisque': 0xFFE4C4,\r\n  'black': 0x000000,\r\n  'blanchedalmond': 0xFFEBCD,\r\n  'blue': 0x0000FF,\r\n  'blueviolet': 0x8A2BE2,\r\n  'brown': 0xA52A2A,\r\n  'burlywood': 0xDEB887,\r\n  'cadetblue': 0x5F9EA0,\r\n  'chartreuse': 0x7FFF00,\r\n  'chocolate': 0xD2691E,\r\n  'coral': 0xFF7F50,\r\n  'cornflowerblue': 0x6495ED,\r\n  'cornsilk': 0xFFF8DC,\r\n  'crimson': 0xDC143C,\r\n  'cyan': 0x00FFFF,\r\n  'darkblue': 0x00008B,\r\n  'darkcyan': 0x008B8B,\r\n  'darkgoldenrod': 0xB8860B,\r\n  'darkgray': 0xA9A9A9,\r\n  'darkgreen': 0x006400,\r\n  'darkgrey': 0xA9A9A9,\r\n  'darkkhaki': 0xBDB76B,\r\n  'darkmagenta': 0x8B008B,\r\n  'darkolivegreen': 0x556B2F,\r\n  'darkorange': 0xFF8C00,\r\n  'darkorchid': 0x9932CC,\r\n  'darkred': 0x8B0000,\r\n  'darksalmon': 0xE9967A,\r\n  'darkseagreen': 0x8FBC8F,\r\n  'darkslateblue': 0x483D8B,\r\n  'darkslategray': 0x2F4F4F,\r\n  'darkslategrey': 0x2F4F4F,\r\n  'darkturquoise': 0x00CED1,\r\n  'darkviolet': 0x9400D3,\r\n  'deeppink': 0xFF1493,\r\n  'deepskyblue': 0x00BFFF,\r\n  'dimgray': 0x696969,\r\n  'dimgrey': 0x696969,\r\n  'dodgerblue': 0x1E90FF,\r\n  'firebrick': 0xB22222,\r\n  'floralwhite': 0xFFFAF0,\r\n  'forestgreen': 0x228B22,\r\n  'fuchsia': 0xFF00FF,\r\n  'gainsboro': 0xDCDCDC,\r\n  'ghostwhite': 0xF8F8FF,\r\n  'gold': 0xFFD700,\r\n  'goldenrod': 0xDAA520,\r\n  'gray': 0x808080,\r\n  'green': 0x008000,\r\n  'greenyellow': 0xADFF2F,\r\n  'grey': 0x808080,\r\n  'honeydew': 0xF0FFF0,\r\n  'hotpink': 0xFF69B4,\r\n  'indianred': 0xCD5C5C,\r\n  'indigo': 0x4B0082,\r\n  'ivory': 0xFFFFF0,\r\n  'khaki': 0xF0E68C,\r\n  'lavender': 0xE6E6FA,\r\n  'lavenderblush': 0xFFF0F5,\r\n  'lawngreen': 0x7CFC00,\r\n  'lemonchiffon': 0xFFFACD,\r\n  'lightblue': 0xADD8E6,\r\n  'lightcoral': 0xF08080,\r\n  'lightcyan': 0xE0FFFF,\r\n  'lightgoldenrodyellow': 0xFAFAD2,\r\n  'lightgray': 0xD3D3D3,\r\n  'lightgreen': 0x90EE90,\r\n  'lightgrey': 0xD3D3D3,\r\n  'lightpink': 0xFFB6C1,\r\n  'lightsalmon': 0xFFA07A,\r\n  'lightseagreen': 0x20B2AA,\r\n  'lightskyblue': 0x87CEFA,\r\n  'lightslategray': 0x778899,\r\n  'lightslategrey': 0x778899,\r\n  'lightsteelblue': 0xB0C4DE,\r\n  'lightyellow': 0xFFFFE0,\r\n  'lime': 0x00FF00,\r\n  'limegreen': 0x32CD32,\r\n  'linen': 0xFAF0E6,\r\n  'magenta': 0xFF00FF,\r\n  'maroon': 0x800000,\r\n  'mediumaquamarine': 0x66CDAA,\r\n  'mediumblue': 0x0000CD,\r\n  'mediumorchid': 0xBA55D3,\r\n  'mediumpurple': 0x9370DB,\r\n  'mediumseagreen': 0x3CB371,\r\n  'mediumslateblue': 0x7B68EE,\r\n  'mediumspringgreen': 0x00FA9A,\r\n  'mediumturquoise': 0x48D1CC,\r\n  'mediumvioletred': 0xC71585,\r\n  'midnightblue': 0x191970,\r\n  'mintcream': 0xF5FFFA,\r\n  'mistyrose': 0xFFE4E1,\r\n  'moccasin': 0xFFE4B5,\r\n  'navajowhite': 0xFFDEAD,\r\n  'navy': 0x000080,\r\n  'oldlace': 0xFDF5E6,\r\n  'olive': 0x808000,\r\n  'olivedrab': 0x6B8E23,\r\n  'orange': 0xFFA500,\r\n  'orangered': 0xFF4500,\r\n  'orchid': 0xDA70D6,\r\n  'palegoldenrod': 0xEEE8AA,\r\n  'palegreen': 0x98FB98,\r\n  'paleturquoise': 0xAFEEEE,\r\n  'palevioletred': 0xDB7093,\r\n  'papayawhip': 0xFFEFD5,\r\n  'peachpuff': 0xFFDAB9,\r\n  'peru': 0xCD853F,\r\n  'pink': 0xFFC0CB,\r\n  'plum': 0xDDA0DD,\r\n  'powderblue': 0xB0E0E6,\r\n  'purple': 0x800080,\r\n  'red': 0xFF0000,\r\n  'rosybrown': 0xBC8F8F,\r\n  'royalblue': 0x4169E1,\r\n  'saddlebrown': 0x8B4513,\r\n  'salmon': 0xFA8072,\r\n  'sandybrown': 0xF4A460,\r\n  'seagreen': 0x2E8B57,\r\n  'seashell': 0xFFF5EE,\r\n  'sienna': 0xA0522D,\r\n  'silver': 0xC0C0C0,\r\n  'skyblue': 0x87CEEB,\r\n  'slateblue': 0x6A5ACD,\r\n  'slategray': 0x708090,\r\n  'slategrey': 0x708090,\r\n  'snow': 0xFFFAFA,\r\n  'springgreen': 0x00FF7F,\r\n  'steelblue': 0x4682B4,\r\n  'tan': 0xD2B48C,\r\n  'teal': 0x008080,\r\n  'thistle': 0xD8BFD8,\r\n  'tomato': 0xFF6347,\r\n  'turquoise': 0x40E0D0,\r\n  'violet': 0xEE82EE,\r\n  'wheat': 0xF5DEB3,\r\n  'white': 0xFFFFFF,\r\n  'whitesmoke': 0xF5F5F5,\r\n  'yellow': 0xFFFF00,\r\n  'yellowgreen': 0x9ACD32\r\n};\r\n\r\n// File:src/math/Quaternion.js\r\n\r\n/**\r\n * @author mikael emtinger / http://gomo.se/\r\n * @author alteredq / http://alteredqualia.com/\r\n * @author WestLangley / http://github.com/WestLangley\r\n * @author bhouston / http://exocortex.com\r\n */\r\n\r\nTHREE.Quaternion = function(x, y, z, w) {\r\n\r\n  this._x = x || 0;\r\n  this._y = y || 0;\r\n  this._z = z || 0;\r\n  this._w = (w !== undefined) ? w : 1;\r\n\r\n};\r\n\r\nTHREE.Quaternion.prototype = {\r\n\r\n  constructor: THREE.Quaternion,\r\n\r\n  _x: 0,\r\n  _y: 0,\r\n  _z: 0,\r\n  _w: 0,\r\n\r\n  get x() {\r\n\r\n    return this._x;\r\n\r\n  },\r\n\r\n  set x(value) {\r\n\r\n    this._x = value;\r\n    this.onChangeCallback();\r\n\r\n  },\r\n\r\n  get y() {\r\n\r\n    return this._y;\r\n\r\n  },\r\n\r\n  set y(value) {\r\n\r\n    this._y = value;\r\n    this.onChangeCallback();\r\n\r\n  },\r\n\r\n  get z() {\r\n\r\n    return this._z;\r\n\r\n  },\r\n\r\n  set z(value) {\r\n\r\n    this._z = value;\r\n    this.onChangeCallback();\r\n\r\n  },\r\n\r\n  get w() {\r\n\r\n    return this._w;\r\n\r\n  },\r\n\r\n  set w(value) {\r\n\r\n    this._w = value;\r\n    this.onChangeCallback();\r\n\r\n  },\r\n\r\n  set: function(x, y, z, w) {\r\n\r\n    this._x = x;\r\n    this._y = y;\r\n    this._z = z;\r\n    this._w = w;\r\n\r\n    this.onChangeCallback();\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  copy: function(quaternion) {\r\n\r\n    this._x = quaternion.x;\r\n    this._y = quaternion.y;\r\n    this._z = quaternion.z;\r\n    this._w = quaternion.w;\r\n\r\n    this.onChangeCallback();\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  setFromEuler: function(euler, update) {\r\n\r\n    if (euler instanceof THREE.Euler === false) {\r\n\r\n      throw new Error('THREE.Quaternion: .setFromEuler() now expects a Euler rotation rather than a Vector3 and order.');\r\n    }\r\n\r\n    // http://www.mathworks.com/matlabcentral/fileexchange/\r\n    // \t20696-function-to-convert-between-dcm-euler-angles-quaternions-and-euler-vectors/\r\n    //\tcontent/SpinCalc.m\r\n\r\n    var c1 = Math.cos(euler._x / 2);\r\n    var c2 = Math.cos(euler._y / 2);\r\n    var c3 = Math.cos(euler._z / 2);\r\n    var s1 = Math.sin(euler._x / 2);\r\n    var s2 = Math.sin(euler._y / 2);\r\n    var s3 = Math.sin(euler._z / 2);\r\n\r\n    if (euler.order === 'XYZ') {\r\n\r\n      this._x = s1 * c2 * c3 + c1 * s2 * s3;\r\n      this._y = c1 * s2 * c3 - s1 * c2 * s3;\r\n      this._z = c1 * c2 * s3 + s1 * s2 * c3;\r\n      this._w = c1 * c2 * c3 - s1 * s2 * s3;\r\n\r\n    }\r\n    else if (euler.order === 'YXZ') {\r\n\r\n      this._x = s1 * c2 * c3 + c1 * s2 * s3;\r\n      this._y = c1 * s2 * c3 - s1 * c2 * s3;\r\n      this._z = c1 * c2 * s3 - s1 * s2 * c3;\r\n      this._w = c1 * c2 * c3 + s1 * s2 * s3;\r\n\r\n    }\r\n    else if (euler.order === 'ZXY') {\r\n\r\n      this._x = s1 * c2 * c3 - c1 * s2 * s3;\r\n      this._y = c1 * s2 * c3 + s1 * c2 * s3;\r\n      this._z = c1 * c2 * s3 + s1 * s2 * c3;\r\n      this._w = c1 * c2 * c3 - s1 * s2 * s3;\r\n\r\n    }\r\n    else if (euler.order === 'ZYX') {\r\n\r\n      this._x = s1 * c2 * c3 - c1 * s2 * s3;\r\n      this._y = c1 * s2 * c3 + s1 * c2 * s3;\r\n      this._z = c1 * c2 * s3 - s1 * s2 * c3;\r\n      this._w = c1 * c2 * c3 + s1 * s2 * s3;\r\n\r\n    }\r\n    else if (euler.order === 'YZX') {\r\n\r\n      this._x = s1 * c2 * c3 + c1 * s2 * s3;\r\n      this._y = c1 * s2 * c3 + s1 * c2 * s3;\r\n      this._z = c1 * c2 * s3 - s1 * s2 * c3;\r\n      this._w = c1 * c2 * c3 - s1 * s2 * s3;\r\n\r\n    }\r\n    else if (euler.order === 'XZY') {\r\n\r\n      this._x = s1 * c2 * c3 - c1 * s2 * s3;\r\n      this._y = c1 * s2 * c3 - s1 * c2 * s3;\r\n      this._z = c1 * c2 * s3 + s1 * s2 * c3;\r\n      this._w = c1 * c2 * c3 + s1 * s2 * s3;\r\n\r\n    }\r\n\r\n    if (update !== false) this.onChangeCallback();\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  setFromAxisAngle: function(axis, angle) {\r\n\r\n    // http://www.euclideanspace.com/maths/geometry/rotations/conversions/angleToQuaternion/index.htm\r\n\r\n    // assumes axis is normalized\r\n\r\n    var halfAngle = angle / 2,\r\n      s = Math.sin(halfAngle);\r\n\r\n    this._x = axis.x * s;\r\n    this._y = axis.y * s;\r\n    this._z = axis.z * s;\r\n    this._w = Math.cos(halfAngle);\r\n\r\n    this.onChangeCallback();\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  setFromRotationMatrix: function(m) {\r\n\r\n    // http://www.euclideanspace.com/maths/geometry/rotations/conversions/matrixToQuaternion/index.htm\r\n\r\n    // assumes the upper 3x3 of m is a pure rotation matrix (i.e, unscaled)\r\n\r\n    var te = m.elements,\r\n\r\n      m11 = te[0],\r\n      m12 = te[4],\r\n      m13 = te[8],\r\n      m21 = te[1],\r\n      m22 = te[5],\r\n      m23 = te[9],\r\n      m31 = te[2],\r\n      m32 = te[6],\r\n      m33 = te[10],\r\n\r\n      trace = m11 + m22 + m33,\r\n      s;\r\n\r\n    if (trace > 0) {\r\n\r\n      s = 0.5 / Math.sqrt(trace + 1.0);\r\n\r\n      this._w = 0.25 / s;\r\n      this._x = (m32 - m23) * s;\r\n      this._y = (m13 - m31) * s;\r\n      this._z = (m21 - m12) * s;\r\n\r\n    }\r\n    else if (m11 > m22 && m11 > m33) {\r\n\r\n      s = 2.0 * Math.sqrt(1.0 + m11 - m22 - m33);\r\n\r\n      this._w = (m32 - m23) / s;\r\n      this._x = 0.25 * s;\r\n      this._y = (m12 + m21) / s;\r\n      this._z = (m13 + m31) / s;\r\n\r\n    }\r\n    else if (m22 > m33) {\r\n\r\n      s = 2.0 * Math.sqrt(1.0 + m22 - m11 - m33);\r\n\r\n      this._w = (m13 - m31) / s;\r\n      this._x = (m12 + m21) / s;\r\n      this._y = 0.25 * s;\r\n      this._z = (m23 + m32) / s;\r\n\r\n    }\r\n    else {\r\n\r\n      s = 2.0 * Math.sqrt(1.0 + m33 - m11 - m22);\r\n\r\n      this._w = (m21 - m12) / s;\r\n      this._x = (m13 + m31) / s;\r\n      this._y = (m23 + m32) / s;\r\n      this._z = 0.25 * s;\r\n\r\n    }\r\n\r\n    this.onChangeCallback();\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  setFromUnitVectors: function() {\r\n\r\n    // http://lolengine.net/blog/2014/02/24/quaternion-from-two-vectors-final\r\n\r\n    // assumes direction vectors vFrom and vTo are normalized\r\n\r\n    var v1, r;\r\n\r\n    var EPS = 0.000001;\r\n\r\n    return function(vFrom, vTo) {\r\n\r\n      if (v1 === undefined) v1 = new THREE.Vector3();\r\n\r\n      r = vFrom.dot(vTo) + 1;\r\n\r\n      if (r < EPS) {\r\n\r\n        r = 0;\r\n\r\n        if (Math.abs(vFrom.x) > Math.abs(vFrom.z)) {\r\n\r\n          v1.set(-vFrom.y, vFrom.x, 0);\r\n\r\n        }\r\n        else {\r\n\r\n          v1.set(0, -vFrom.z, vFrom.y);\r\n\r\n        }\r\n\r\n      }\r\n      else {\r\n\r\n        v1.crossVectors(vFrom, vTo);\r\n\r\n      }\r\n\r\n      this._x = v1.x;\r\n      this._y = v1.y;\r\n      this._z = v1.z;\r\n      this._w = r;\r\n\r\n      this.normalize();\r\n\r\n      return this;\r\n\r\n    }\r\n\r\n  }(),\r\n\r\n  inverse: function() {\r\n\r\n    this.conjugate().normalize();\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  conjugate: function() {\r\n\r\n    this._x *= -1;\r\n    this._y *= -1;\r\n    this._z *= -1;\r\n\r\n    this.onChangeCallback();\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  dot: function(v) {\r\n\r\n    return this._x * v._x + this._y * v._y + this._z * v._z + this._w * v._w;\r\n\r\n  },\r\n\r\n  lengthSq: function() {\r\n\r\n    return this._x * this._x + this._y * this._y + this._z * this._z + this._w * this._w;\r\n\r\n  },\r\n\r\n  length: function() {\r\n\r\n    return Math.sqrt(this._x * this._x + this._y * this._y + this._z * this._z + this._w * this._w);\r\n\r\n  },\r\n\r\n  normalize: function() {\r\n\r\n    var l = this.length();\r\n\r\n    if (l === 0) {\r\n\r\n      this._x = 0;\r\n      this._y = 0;\r\n      this._z = 0;\r\n      this._w = 1;\r\n\r\n    }\r\n    else {\r\n\r\n      l = 1 / l;\r\n\r\n      this._x = this._x * l;\r\n      this._y = this._y * l;\r\n      this._z = this._z * l;\r\n      this._w = this._w * l;\r\n\r\n    }\r\n\r\n    this.onChangeCallback();\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  multiply: function(q, p) {\r\n\r\n    if (p !== undefined) {\r\n\r\n      THREE.warn('THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead.');\r\n      return this.multiplyQuaternions(q, p);\r\n\r\n    }\r\n\r\n    return this.multiplyQuaternions(this, q);\r\n\r\n  },\r\n\r\n  multiplyQuaternions: function(a, b) {\r\n\r\n    // from http://www.euclideanspace.com/maths/algebra/realNormedAlgebra/quaternions/code/index.htm\r\n\r\n    var qax = a._x,\r\n      qay = a._y,\r\n      qaz = a._z,\r\n      qaw = a._w;\r\n    var qbx = b._x,\r\n      qby = b._y,\r\n      qbz = b._z,\r\n      qbw = b._w;\r\n\r\n    this._x = qax * qbw + qaw * qbx + qay * qbz - qaz * qby;\r\n    this._y = qay * qbw + qaw * qby + qaz * qbx - qax * qbz;\r\n    this._z = qaz * qbw + qaw * qbz + qax * qby - qay * qbx;\r\n    this._w = qaw * qbw - qax * qbx - qay * qby - qaz * qbz;\r\n\r\n    this.onChangeCallback();\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  multiplyVector3: function(vector) {\r\n\r\n    THREE.warn('THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead.');\r\n    return vector.applyQuaternion(this);\r\n\r\n  },\r\n\r\n  slerp: function(qb, t) {\r\n\r\n    if (t === 0) return this;\r\n    if (t === 1) return this.copy(qb);\r\n\r\n    var x = this._x,\r\n      y = this._y,\r\n      z = this._z,\r\n      w = this._w;\r\n\r\n    // http://www.euclideanspace.com/maths/algebra/realNormedAlgebra/quaternions/slerp/\r\n\r\n    var cosHalfTheta = w * qb._w + x * qb._x + y * qb._y + z * qb._z;\r\n\r\n    if (cosHalfTheta < 0) {\r\n\r\n      this._w = -qb._w;\r\n      this._x = -qb._x;\r\n      this._y = -qb._y;\r\n      this._z = -qb._z;\r\n\r\n      cosHalfTheta = -cosHalfTheta;\r\n\r\n    }\r\n    else {\r\n\r\n      this.copy(qb);\r\n\r\n    }\r\n\r\n    if (cosHalfTheta >= 1.0) {\r\n\r\n      this._w = w;\r\n      this._x = x;\r\n      this._y = y;\r\n      this._z = z;\r\n\r\n      return this;\r\n\r\n    }\r\n\r\n    var halfTheta = Math.acos(cosHalfTheta);\r\n    var sinHalfTheta = Math.sqrt(1.0 - cosHalfTheta * cosHalfTheta);\r\n\r\n    if (Math.abs(sinHalfTheta) < 0.001) {\r\n\r\n      this._w = 0.5 * (w + this._w);\r\n      this._x = 0.5 * (x + this._x);\r\n      this._y = 0.5 * (y + this._y);\r\n      this._z = 0.5 * (z + this._z);\r\n\r\n      return this;\r\n\r\n    }\r\n\r\n    var ratioA = Math.sin((1 - t) * halfTheta) / sinHalfTheta,\r\n      ratioB = Math.sin(t * halfTheta) / sinHalfTheta;\r\n\r\n    this._w = (w * ratioA + this._w * ratioB);\r\n    this._x = (x * ratioA + this._x * ratioB);\r\n    this._y = (y * ratioA + this._y * ratioB);\r\n    this._z = (z * ratioA + this._z * ratioB);\r\n\r\n    this.onChangeCallback();\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  equals: function(quaternion) {\r\n\r\n    return (quaternion._x === this._x) && (quaternion._y === this._y) && (quaternion._z === this._z) && (quaternion._w === this._w);\r\n\r\n  },\r\n\r\n  fromArray: function(array, offset) {\r\n\r\n    if (offset === undefined) offset = 0;\r\n\r\n    this._x = array[offset];\r\n    this._y = array[offset + 1];\r\n    this._z = array[offset + 2];\r\n    this._w = array[offset + 3];\r\n\r\n    this.onChangeCallback();\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  toArray: function(array, offset) {\r\n\r\n    if (array === undefined) array = [];\r\n    if (offset === undefined) offset = 0;\r\n\r\n    array[offset] = this._x;\r\n    array[offset + 1] = this._y;\r\n    array[offset + 2] = this._z;\r\n    array[offset + 3] = this._w;\r\n\r\n    return array;\r\n\r\n  },\r\n\r\n  onChange: function(callback) {\r\n\r\n    this.onChangeCallback = callback;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  onChangeCallback: function() {},\r\n\r\n  clone: function() {\r\n\r\n    return new THREE.Quaternion(this._x, this._y, this._z, this._w);\r\n\r\n  }\r\n\r\n};\r\n\r\nTHREE.Quaternion.slerp = function(qa, qb, qm, t) {\r\n\r\n  return qm.copy(qa).slerp(qb, t);\r\n\r\n}\r\n\r\n// File:src/math/Vector2.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author philogb / http://blog.thejit.org/\r\n * @author egraether / http://egraether.com/\r\n * @author zz85 / http://www.lab4games.net/zz85/blog\r\n */\r\n\r\nTHREE.Vector2 = function(x, y) {\r\n\r\n  this.x = x || 0;\r\n  this.y = y || 0;\r\n\r\n};\r\n\r\nTHREE.Vector2.prototype = {\r\n\r\n  constructor: THREE.Vector2,\r\n\r\n  set: function(x, y) {\r\n\r\n    this.x = x;\r\n    this.y = y;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  setX: function(x) {\r\n\r\n    this.x = x;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  setY: function(y) {\r\n\r\n    this.y = y;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  setComponent: function(index, value) {\r\n\r\n    switch (index) {\r\n\r\n      case 0:\r\n        this.x = value;\r\n        break;\r\n      case 1:\r\n        this.y = value;\r\n        break;\r\n      default:\r\n        throw new Error('index is out of range: ' + index);\r\n\r\n    }\r\n\r\n  },\r\n\r\n  getComponent: function(index) {\r\n\r\n    switch (index) {\r\n\r\n      case 0:\r\n        return this.x;\r\n      case 1:\r\n        return this.y;\r\n      default:\r\n        throw new Error('index is out of range: ' + index);\r\n\r\n    }\r\n\r\n  },\r\n\r\n  copy: function(v) {\r\n\r\n    this.x = v.x;\r\n    this.y = v.y;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  add: function(v, w) {\r\n\r\n    if (w !== undefined) {\r\n\r\n      THREE.warn('THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead.');\r\n      return this.addVectors(v, w);\r\n\r\n    }\r\n\r\n    this.x += v.x;\r\n    this.y += v.y;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  addScalar: function(s) {\r\n\r\n    this.x += s;\r\n    this.y += s;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  addVectors: function(a, b) {\r\n\r\n    this.x = a.x + b.x;\r\n    this.y = a.y + b.y;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  sub: function(v, w) {\r\n\r\n    if (w !== undefined) {\r\n\r\n      THREE.warn('THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead.');\r\n      return this.subVectors(v, w);\r\n\r\n    }\r\n\r\n    this.x -= v.x;\r\n    this.y -= v.y;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  subScalar: function(s) {\r\n\r\n    this.x -= s;\r\n    this.y -= s;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  subVectors: function(a, b) {\r\n\r\n    this.x = a.x - b.x;\r\n    this.y = a.y - b.y;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  multiply: function(v) {\r\n\r\n    this.x *= v.x;\r\n    this.y *= v.y;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  multiplyScalar: function(s) {\r\n\r\n    this.x *= s;\r\n    this.y *= s;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  divide: function(v) {\r\n\r\n    this.x /= v.x;\r\n    this.y /= v.y;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  divideScalar: function(scalar) {\r\n\r\n    if (scalar !== 0) {\r\n\r\n      var invScalar = 1 / scalar;\r\n\r\n      this.x *= invScalar;\r\n      this.y *= invScalar;\r\n\r\n    }\r\n    else {\r\n\r\n      this.x = 0;\r\n      this.y = 0;\r\n\r\n    }\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  min: function(v) {\r\n\r\n    if (this.x > v.x) {\r\n\r\n      this.x = v.x;\r\n\r\n    }\r\n\r\n    if (this.y > v.y) {\r\n\r\n      this.y = v.y;\r\n\r\n    }\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  max: function(v) {\r\n\r\n    if (this.x < v.x) {\r\n\r\n      this.x = v.x;\r\n\r\n    }\r\n\r\n    if (this.y < v.y) {\r\n\r\n      this.y = v.y;\r\n\r\n    }\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  clamp: function(min, max) {\r\n\r\n    // This function assumes min < max, if this assumption isn't true it will not operate correctly\r\n\r\n    if (this.x < min.x) {\r\n\r\n      this.x = min.x;\r\n\r\n    }\r\n    else if (this.x > max.x) {\r\n\r\n      this.x = max.x;\r\n\r\n    }\r\n\r\n    if (this.y < min.y) {\r\n\r\n      this.y = min.y;\r\n\r\n    }\r\n    else if (this.y > max.y) {\r\n\r\n      this.y = max.y;\r\n\r\n    }\r\n\r\n    return this;\r\n  },\r\n\r\n  clampScalar: (function() {\r\n\r\n    var min, max;\r\n\r\n    return function(minVal, maxVal) {\r\n\r\n      if (min === undefined) {\r\n\r\n        min = new THREE.Vector2();\r\n        max = new THREE.Vector2();\r\n\r\n      }\r\n\r\n      min.set(minVal, minVal);\r\n      max.set(maxVal, maxVal);\r\n\r\n      return this.clamp(min, max);\r\n\r\n    };\r\n\r\n  })(),\r\n\r\n  floor: function() {\r\n\r\n    this.x = Math.floor(this.x);\r\n    this.y = Math.floor(this.y);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  ceil: function() {\r\n\r\n    this.x = Math.ceil(this.x);\r\n    this.y = Math.ceil(this.y);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  round: function() {\r\n\r\n    this.x = Math.round(this.x);\r\n    this.y = Math.round(this.y);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  roundToZero: function() {\r\n\r\n    this.x = (this.x < 0) ? Math.ceil(this.x) : Math.floor(this.x);\r\n    this.y = (this.y < 0) ? Math.ceil(this.y) : Math.floor(this.y);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  negate: function() {\r\n\r\n    this.x = -this.x;\r\n    this.y = -this.y;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  dot: function(v) {\r\n\r\n    return this.x * v.x + this.y * v.y;\r\n\r\n  },\r\n\r\n  lengthSq: function() {\r\n\r\n    return this.x * this.x + this.y * this.y;\r\n\r\n  },\r\n\r\n  length: function() {\r\n\r\n    return Math.sqrt(this.x * this.x + this.y * this.y);\r\n\r\n  },\r\n\r\n  normalize: function() {\r\n\r\n    return this.divideScalar(this.length());\r\n\r\n  },\r\n\r\n  distanceTo: function(v) {\r\n\r\n    return Math.sqrt(this.distanceToSquared(v));\r\n\r\n  },\r\n\r\n  distanceToSquared: function(v) {\r\n\r\n    var dx = this.x - v.x,\r\n      dy = this.y - v.y;\r\n    return dx * dx + dy * dy;\r\n\r\n  },\r\n\r\n  setLength: function(l) {\r\n\r\n    var oldLength = this.length();\r\n\r\n    if (oldLength !== 0 && l !== oldLength) {\r\n\r\n      this.multiplyScalar(l / oldLength);\r\n    }\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  lerp: function(v, alpha) {\r\n\r\n    this.x += (v.x - this.x) * alpha;\r\n    this.y += (v.y - this.y) * alpha;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  lerpVectors: function(v1, v2, alpha) {\r\n\r\n    this.subVectors(v2, v1).multiplyScalar(alpha).add(v1);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  equals: function(v) {\r\n\r\n    return ((v.x === this.x) && (v.y === this.y));\r\n\r\n  },\r\n\r\n  fromArray: function(array, offset) {\r\n\r\n    if (offset === undefined) offset = 0;\r\n\r\n    this.x = array[offset];\r\n    this.y = array[offset + 1];\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  toArray: function(array, offset) {\r\n\r\n    if (array === undefined) array = [];\r\n    if (offset === undefined) offset = 0;\r\n\r\n    array[offset] = this.x;\r\n    array[offset + 1] = this.y;\r\n\r\n    return array;\r\n\r\n  },\r\n\r\n  fromAttribute: function(attribute, index, offset) {\r\n\r\n    if (offset === undefined) offset = 0;\r\n\r\n    index = index * attribute.itemSize + offset;\r\n\r\n    this.x = attribute.array[index];\r\n    this.y = attribute.array[index + 1];\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  clone: function() {\r\n\r\n    return new THREE.Vector2(this.x, this.y);\r\n\r\n  }\r\n\r\n};\r\n\r\n// File:src/math/Vector3.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author *kile / http://kile.stravaganza.org/\r\n * @author philogb / http://blog.thejit.org/\r\n * @author mikael emtinger / http://gomo.se/\r\n * @author egraether / http://egraether.com/\r\n * @author WestLangley / http://github.com/WestLangley\r\n */\r\n\r\nTHREE.Vector3 = function(x, y, z) {\r\n\r\n  this.x = x || 0;\r\n  this.y = y || 0;\r\n  this.z = z || 0;\r\n\r\n};\r\n\r\nTHREE.Vector3.prototype = {\r\n\r\n  constructor: THREE.Vector3,\r\n\r\n  set: function(x, y, z) {\r\n\r\n    this.x = x;\r\n    this.y = y;\r\n    this.z = z;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  setX: function(x) {\r\n\r\n    this.x = x;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  setY: function(y) {\r\n\r\n    this.y = y;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  setZ: function(z) {\r\n\r\n    this.z = z;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  setComponent: function(index, value) {\r\n\r\n    switch (index) {\r\n\r\n      case 0:\r\n        this.x = value;\r\n        break;\r\n      case 1:\r\n        this.y = value;\r\n        break;\r\n      case 2:\r\n        this.z = value;\r\n        break;\r\n      default:\r\n        throw new Error('index is out of range: ' + index);\r\n\r\n    }\r\n\r\n  },\r\n\r\n  getComponent: function(index) {\r\n\r\n    switch (index) {\r\n\r\n      case 0:\r\n        return this.x;\r\n      case 1:\r\n        return this.y;\r\n      case 2:\r\n        return this.z;\r\n      default:\r\n        throw new Error('index is out of range: ' + index);\r\n\r\n    }\r\n\r\n  },\r\n\r\n  copy: function(v) {\r\n\r\n    this.x = v.x;\r\n    this.y = v.y;\r\n    this.z = v.z;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  add: function(v, w) {\r\n\r\n    if (w !== undefined) {\r\n\r\n      THREE.warn('THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead.');\r\n      return this.addVectors(v, w);\r\n\r\n    }\r\n\r\n    this.x += v.x;\r\n    this.y += v.y;\r\n    this.z += v.z;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  addScalar: function(s) {\r\n\r\n    this.x += s;\r\n    this.y += s;\r\n    this.z += s;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  addVectors: function(a, b) {\r\n\r\n    this.x = a.x + b.x;\r\n    this.y = a.y + b.y;\r\n    this.z = a.z + b.z;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  sub: function(v, w) {\r\n\r\n    if (w !== undefined) {\r\n\r\n      THREE.warn('THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead.');\r\n      return this.subVectors(v, w);\r\n\r\n    }\r\n\r\n    this.x -= v.x;\r\n    this.y -= v.y;\r\n    this.z -= v.z;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  subScalar: function(s) {\r\n\r\n    this.x -= s;\r\n    this.y -= s;\r\n    this.z -= s;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  subVectors: function(a, b) {\r\n\r\n    this.x = a.x - b.x;\r\n    this.y = a.y - b.y;\r\n    this.z = a.z - b.z;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  multiply: function(v, w) {\r\n\r\n    if (w !== undefined) {\r\n\r\n      THREE.warn('THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead.');\r\n      return this.multiplyVectors(v, w);\r\n\r\n    }\r\n\r\n    this.x *= v.x;\r\n    this.y *= v.y;\r\n    this.z *= v.z;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  multiplyScalar: function(scalar) {\r\n\r\n    this.x *= scalar;\r\n    this.y *= scalar;\r\n    this.z *= scalar;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  multiplyVectors: function(a, b) {\r\n\r\n    this.x = a.x * b.x;\r\n    this.y = a.y * b.y;\r\n    this.z = a.z * b.z;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  applyEuler: function() {\r\n\r\n    var quaternion;\r\n\r\n    return function(euler) {\r\n\r\n      if (euler instanceof THREE.Euler === false) {\r\n\r\n        THREE.error('THREE.Vector3: .applyEuler() now expects a Euler rotation rather than a Vector3 and order.');\r\n\r\n      }\r\n\r\n      if (quaternion === undefined) quaternion = new THREE.Quaternion();\r\n\r\n      this.applyQuaternion(quaternion.setFromEuler(euler));\r\n\r\n      return this;\r\n\r\n    };\r\n\r\n  }(),\r\n\r\n  applyAxisAngle: function() {\r\n\r\n    var quaternion;\r\n\r\n    return function(axis, angle) {\r\n\r\n      if (quaternion === undefined) quaternion = new THREE.Quaternion();\r\n\r\n      this.applyQuaternion(quaternion.setFromAxisAngle(axis, angle));\r\n\r\n      return this;\r\n\r\n    };\r\n\r\n  }(),\r\n\r\n  applyMatrix3: function(m) {\r\n\r\n    var x = this.x;\r\n    var y = this.y;\r\n    var z = this.z;\r\n\r\n    var e = m.elements;\r\n\r\n    this.x = e[0] * x + e[3] * y + e[6] * z;\r\n    this.y = e[1] * x + e[4] * y + e[7] * z;\r\n    this.z = e[2] * x + e[5] * y + e[8] * z;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  applyMatrix4: function(m) {\r\n\r\n    // input: THREE.Matrix4 affine matrix\r\n\r\n    var x = this.x,\r\n      y = this.y,\r\n      z = this.z;\r\n\r\n    var e = m.elements;\r\n\r\n    this.x = e[0] * x + e[4] * y + e[8] * z + e[12];\r\n    this.y = e[1] * x + e[5] * y + e[9] * z + e[13];\r\n    this.z = e[2] * x + e[6] * y + e[10] * z + e[14];\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  applyProjection: function(m) {\r\n\r\n    // input: THREE.Matrix4 projection matrix\r\n\r\n    var x = this.x,\r\n      y = this.y,\r\n      z = this.z;\r\n\r\n    var e = m.elements;\r\n    var d = 1 / (e[3] * x + e[7] * y + e[11] * z + e[15]); // perspective divide\r\n\r\n    this.x = (e[0] * x + e[4] * y + e[8] * z + e[12]) * d;\r\n    this.y = (e[1] * x + e[5] * y + e[9] * z + e[13]) * d;\r\n    this.z = (e[2] * x + e[6] * y + e[10] * z + e[14]) * d;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  applyQuaternion: function(q) {\r\n\r\n    var x = this.x;\r\n    var y = this.y;\r\n    var z = this.z;\r\n\r\n    var qx = q.x;\r\n    var qy = q.y;\r\n    var qz = q.z;\r\n    var qw = q.w;\r\n\r\n    // calculate quat * vector\r\n\r\n    var ix = qw * x + qy * z - qz * y;\r\n    var iy = qw * y + qz * x - qx * z;\r\n    var iz = qw * z + qx * y - qy * x;\r\n    var iw = -qx * x - qy * y - qz * z;\r\n\r\n    // calculate result * inverse quat\r\n\r\n    this.x = ix * qw + iw * -qx + iy * -qz - iz * -qy;\r\n    this.y = iy * qw + iw * -qy + iz * -qx - ix * -qz;\r\n    this.z = iz * qw + iw * -qz + ix * -qy - iy * -qx;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  project: function() {\r\n\r\n    var matrix;\r\n\r\n    return function(camera) {\r\n\r\n      if (matrix === undefined) matrix = new THREE.Matrix4();\r\n\r\n      matrix.multiplyMatrices(camera.projectionMatrix, matrix.getInverse(camera.matrixWorld));\r\n      return this.applyProjection(matrix);\r\n\r\n    };\r\n\r\n  }(),\r\n\r\n  unproject: function() {\r\n\r\n    var matrix;\r\n\r\n    return function(camera) {\r\n\r\n      if (matrix === undefined) matrix = new THREE.Matrix4();\r\n\r\n      matrix.multiplyMatrices(camera.matrixWorld, matrix.getInverse(camera.projectionMatrix));\r\n      return this.applyProjection(matrix);\r\n\r\n    };\r\n\r\n  }(),\r\n\r\n  transformDirection: function(m) {\r\n\r\n    // input: THREE.Matrix4 affine matrix\r\n    // vector interpreted as a direction\r\n\r\n    var x = this.x,\r\n      y = this.y,\r\n      z = this.z;\r\n\r\n    var e = m.elements;\r\n\r\n    this.x = e[0] * x + e[4] * y + e[8] * z;\r\n    this.y = e[1] * x + e[5] * y + e[9] * z;\r\n    this.z = e[2] * x + e[6] * y + e[10] * z;\r\n\r\n    this.normalize();\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  divide: function(v) {\r\n\r\n    this.x /= v.x;\r\n    this.y /= v.y;\r\n    this.z /= v.z;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  divideScalar: function(scalar) {\r\n\r\n    if (scalar !== 0) {\r\n\r\n      var invScalar = 1 / scalar;\r\n\r\n      this.x *= invScalar;\r\n      this.y *= invScalar;\r\n      this.z *= invScalar;\r\n\r\n    }\r\n    else {\r\n\r\n      this.x = 0;\r\n      this.y = 0;\r\n      this.z = 0;\r\n\r\n    }\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  min: function(v) {\r\n\r\n    if (this.x > v.x) {\r\n\r\n      this.x = v.x;\r\n\r\n    }\r\n\r\n    if (this.y > v.y) {\r\n\r\n      this.y = v.y;\r\n\r\n    }\r\n\r\n    if (this.z > v.z) {\r\n\r\n      this.z = v.z;\r\n\r\n    }\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  max: function(v) {\r\n\r\n    if (this.x < v.x) {\r\n\r\n      this.x = v.x;\r\n\r\n    }\r\n\r\n    if (this.y < v.y) {\r\n\r\n      this.y = v.y;\r\n\r\n    }\r\n\r\n    if (this.z < v.z) {\r\n\r\n      this.z = v.z;\r\n\r\n    }\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  clamp: function(min, max) {\r\n\r\n    // This function assumes min < max, if this assumption isn't true it will not operate correctly\r\n\r\n    if (this.x < min.x) {\r\n\r\n      this.x = min.x;\r\n\r\n    }\r\n    else if (this.x > max.x) {\r\n\r\n      this.x = max.x;\r\n\r\n    }\r\n\r\n    if (this.y < min.y) {\r\n\r\n      this.y = min.y;\r\n\r\n    }\r\n    else if (this.y > max.y) {\r\n\r\n      this.y = max.y;\r\n\r\n    }\r\n\r\n    if (this.z < min.z) {\r\n\r\n      this.z = min.z;\r\n\r\n    }\r\n    else if (this.z > max.z) {\r\n\r\n      this.z = max.z;\r\n\r\n    }\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  clampScalar: (function() {\r\n\r\n    var min, max;\r\n\r\n    return function(minVal, maxVal) {\r\n\r\n      if (min === undefined) {\r\n\r\n        min = new THREE.Vector3();\r\n        max = new THREE.Vector3();\r\n\r\n      }\r\n\r\n      min.set(minVal, minVal, minVal);\r\n      max.set(maxVal, maxVal, maxVal);\r\n\r\n      return this.clamp(min, max);\r\n\r\n    };\r\n\r\n  })(),\r\n\r\n  floor: function() {\r\n\r\n    this.x = Math.floor(this.x);\r\n    this.y = Math.floor(this.y);\r\n    this.z = Math.floor(this.z);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  ceil: function() {\r\n\r\n    this.x = Math.ceil(this.x);\r\n    this.y = Math.ceil(this.y);\r\n    this.z = Math.ceil(this.z);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  round: function() {\r\n\r\n    this.x = Math.round(this.x);\r\n    this.y = Math.round(this.y);\r\n    this.z = Math.round(this.z);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  roundToZero: function() {\r\n\r\n    this.x = (this.x < 0) ? Math.ceil(this.x) : Math.floor(this.x);\r\n    this.y = (this.y < 0) ? Math.ceil(this.y) : Math.floor(this.y);\r\n    this.z = (this.z < 0) ? Math.ceil(this.z) : Math.floor(this.z);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  negate: function() {\r\n\r\n    this.x = -this.x;\r\n    this.y = -this.y;\r\n    this.z = -this.z;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  dot: function(v) {\r\n\r\n    return this.x * v.x + this.y * v.y + this.z * v.z;\r\n\r\n  },\r\n\r\n  lengthSq: function() {\r\n\r\n    return this.x * this.x + this.y * this.y + this.z * this.z;\r\n\r\n  },\r\n\r\n  length: function() {\r\n\r\n    return Math.sqrt(this.x * this.x + this.y * this.y + this.z * this.z);\r\n\r\n  },\r\n\r\n  lengthManhattan: function() {\r\n\r\n    return Math.abs(this.x) + Math.abs(this.y) + Math.abs(this.z);\r\n\r\n  },\r\n\r\n  normalize: function() {\r\n\r\n    return this.divideScalar(this.length());\r\n\r\n  },\r\n\r\n  setLength: function(l) {\r\n\r\n    var oldLength = this.length();\r\n\r\n    if (oldLength !== 0 && l !== oldLength) {\r\n\r\n      this.multiplyScalar(l / oldLength);\r\n    }\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  lerp: function(v, alpha) {\r\n\r\n    this.x += (v.x - this.x) * alpha;\r\n    this.y += (v.y - this.y) * alpha;\r\n    this.z += (v.z - this.z) * alpha;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  lerpVectors: function(v1, v2, alpha) {\r\n\r\n    this.subVectors(v2, v1).multiplyScalar(alpha).add(v1);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  cross: function(v, w) {\r\n\r\n    if (w !== undefined) {\r\n\r\n      THREE.warn('THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead.');\r\n      return this.crossVectors(v, w);\r\n\r\n    }\r\n\r\n    var x = this.x,\r\n      y = this.y,\r\n      z = this.z;\r\n\r\n    this.x = y * v.z - z * v.y;\r\n    this.y = z * v.x - x * v.z;\r\n    this.z = x * v.y - y * v.x;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  crossVectors: function(a, b) {\r\n\r\n    var ax = a.x,\r\n      ay = a.y,\r\n      az = a.z;\r\n    var bx = b.x,\r\n      by = b.y,\r\n      bz = b.z;\r\n\r\n    this.x = ay * bz - az * by;\r\n    this.y = az * bx - ax * bz;\r\n    this.z = ax * by - ay * bx;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  projectOnVector: function() {\r\n\r\n    var v1, dot;\r\n\r\n    return function(vector) {\r\n\r\n      if (v1 === undefined) v1 = new THREE.Vector3();\r\n\r\n      v1.copy(vector).normalize();\r\n\r\n      dot = this.dot(v1);\r\n\r\n      return this.copy(v1).multiplyScalar(dot);\r\n\r\n    };\r\n\r\n  }(),\r\n\r\n  projectOnPlane: function() {\r\n\r\n    var v1;\r\n\r\n    return function(planeNormal) {\r\n\r\n      if (v1 === undefined) v1 = new THREE.Vector3();\r\n\r\n      v1.copy(this).projectOnVector(planeNormal);\r\n\r\n      return this.sub(v1);\r\n\r\n    }\r\n\r\n  }(),\r\n\r\n  reflect: function() {\r\n\r\n    // reflect incident vector off plane orthogonal to normal\r\n    // normal is assumed to have unit length\r\n\r\n    var v1;\r\n\r\n    return function(normal) {\r\n\r\n      if (v1 === undefined) v1 = new THREE.Vector3();\r\n\r\n      return this.sub(v1.copy(normal).multiplyScalar(2 * this.dot(normal)));\r\n\r\n    }\r\n\r\n  }(),\r\n\r\n  angleTo: function(v) {\r\n\r\n    var theta = this.dot(v) / (this.length() * v.length());\r\n\r\n    // clamp, to handle numerical problems\r\n\r\n    return Math.acos(THREE.Math.clamp(theta, -1, 1));\r\n\r\n  },\r\n\r\n  distanceTo: function(v) {\r\n\r\n    return Math.sqrt(this.distanceToSquared(v));\r\n\r\n  },\r\n\r\n  distanceToSquared: function(v) {\r\n\r\n    var dx = this.x - v.x;\r\n    var dy = this.y - v.y;\r\n    var dz = this.z - v.z;\r\n\r\n    return dx * dx + dy * dy + dz * dz;\r\n\r\n  },\r\n\r\n  setEulerFromRotationMatrix: function(m, order) {\r\n\r\n    THREE.error('THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.');\r\n\r\n  },\r\n\r\n  setEulerFromQuaternion: function(q, order) {\r\n\r\n    THREE.error('THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.');\r\n\r\n  },\r\n\r\n  getPositionFromMatrix: function(m) {\r\n\r\n    THREE.warn('THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition().');\r\n\r\n    return this.setFromMatrixPosition(m);\r\n\r\n  },\r\n\r\n  getScaleFromMatrix: function(m) {\r\n\r\n    THREE.warn('THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale().');\r\n\r\n    return this.setFromMatrixScale(m);\r\n  },\r\n\r\n  getColumnFromMatrix: function(index, matrix) {\r\n\r\n    THREE.warn('THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn().');\r\n\r\n    return this.setFromMatrixColumn(index, matrix);\r\n\r\n  },\r\n\r\n  setFromMatrixPosition: function(m) {\r\n\r\n    this.x = m.elements[12];\r\n    this.y = m.elements[13];\r\n    this.z = m.elements[14];\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  setFromMatrixScale: function(m) {\r\n\r\n    var sx = this.set(m.elements[0], m.elements[1], m.elements[2]).length();\r\n    var sy = this.set(m.elements[4], m.elements[5], m.elements[6]).length();\r\n    var sz = this.set(m.elements[8], m.elements[9], m.elements[10]).length();\r\n\r\n    this.x = sx;\r\n    this.y = sy;\r\n    this.z = sz;\r\n\r\n    return this;\r\n  },\r\n\r\n  setFromMatrixColumn: function(index, matrix) {\r\n\r\n    var offset = index * 4;\r\n\r\n    var me = matrix.elements;\r\n\r\n    this.x = me[offset];\r\n    this.y = me[offset + 1];\r\n    this.z = me[offset + 2];\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  equals: function(v) {\r\n\r\n    return ((v.x === this.x) && (v.y === this.y) && (v.z === this.z));\r\n\r\n  },\r\n\r\n  fromArray: function(array, offset) {\r\n\r\n    if (offset === undefined) offset = 0;\r\n\r\n    this.x = array[offset];\r\n    this.y = array[offset + 1];\r\n    this.z = array[offset + 2];\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  toArray: function(array, offset) {\r\n\r\n    if (array === undefined) array = [];\r\n    if (offset === undefined) offset = 0;\r\n\r\n    array[offset] = this.x;\r\n    array[offset + 1] = this.y;\r\n    array[offset + 2] = this.z;\r\n\r\n    return array;\r\n\r\n  },\r\n\r\n  fromAttribute: function(attribute, index, offset) {\r\n\r\n    if (offset === undefined) offset = 0;\r\n\r\n    index = index * attribute.itemSize + offset;\r\n\r\n    this.x = attribute.array[index];\r\n    this.y = attribute.array[index + 1];\r\n    this.z = attribute.array[index + 2];\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  clone: function() {\r\n\r\n    return new THREE.Vector3(this.x, this.y, this.z);\r\n\r\n  }\r\n\r\n};\r\n\r\n// File:src/math/Vector4.js\r\n\r\n/**\r\n * @author supereggbert / http://www.paulbrunt.co.uk/\r\n * @author philogb / http://blog.thejit.org/\r\n * @author mikael emtinger / http://gomo.se/\r\n * @author egraether / http://egraether.com/\r\n * @author WestLangley / http://github.com/WestLangley\r\n */\r\n\r\nTHREE.Vector4 = function(x, y, z, w) {\r\n\r\n  this.x = x || 0;\r\n  this.y = y || 0;\r\n  this.z = z || 0;\r\n  this.w = (w !== undefined) ? w : 1;\r\n\r\n};\r\n\r\nTHREE.Vector4.prototype = {\r\n\r\n  constructor: THREE.Vector4,\r\n\r\n  set: function(x, y, z, w) {\r\n\r\n    this.x = x;\r\n    this.y = y;\r\n    this.z = z;\r\n    this.w = w;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  setX: function(x) {\r\n\r\n    this.x = x;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  setY: function(y) {\r\n\r\n    this.y = y;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  setZ: function(z) {\r\n\r\n    this.z = z;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  setW: function(w) {\r\n\r\n    this.w = w;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  setComponent: function(index, value) {\r\n\r\n    switch (index) {\r\n\r\n      case 0:\r\n        this.x = value;\r\n        break;\r\n      case 1:\r\n        this.y = value;\r\n        break;\r\n      case 2:\r\n        this.z = value;\r\n        break;\r\n      case 3:\r\n        this.w = value;\r\n        break;\r\n      default:\r\n        throw new Error('index is out of range: ' + index);\r\n\r\n    }\r\n\r\n  },\r\n\r\n  getComponent: function(index) {\r\n\r\n    switch (index) {\r\n\r\n      case 0:\r\n        return this.x;\r\n      case 1:\r\n        return this.y;\r\n      case 2:\r\n        return this.z;\r\n      case 3:\r\n        return this.w;\r\n      default:\r\n        throw new Error('index is out of range: ' + index);\r\n\r\n    }\r\n\r\n  },\r\n\r\n  copy: function(v) {\r\n\r\n    this.x = v.x;\r\n    this.y = v.y;\r\n    this.z = v.z;\r\n    this.w = (v.w !== undefined) ? v.w : 1;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  add: function(v, w) {\r\n\r\n    if (w !== undefined) {\r\n\r\n      THREE.warn('THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead.');\r\n      return this.addVectors(v, w);\r\n\r\n    }\r\n\r\n    this.x += v.x;\r\n    this.y += v.y;\r\n    this.z += v.z;\r\n    this.w += v.w;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  addScalar: function(s) {\r\n\r\n    this.x += s;\r\n    this.y += s;\r\n    this.z += s;\r\n    this.w += s;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  addVectors: function(a, b) {\r\n\r\n    this.x = a.x + b.x;\r\n    this.y = a.y + b.y;\r\n    this.z = a.z + b.z;\r\n    this.w = a.w + b.w;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  sub: function(v, w) {\r\n\r\n    if (w !== undefined) {\r\n\r\n      THREE.warn('THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead.');\r\n      return this.subVectors(v, w);\r\n\r\n    }\r\n\r\n    this.x -= v.x;\r\n    this.y -= v.y;\r\n    this.z -= v.z;\r\n    this.w -= v.w;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  subScalar: function(s) {\r\n\r\n    this.x -= s;\r\n    this.y -= s;\r\n    this.z -= s;\r\n    this.w -= s;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  subVectors: function(a, b) {\r\n\r\n    this.x = a.x - b.x;\r\n    this.y = a.y - b.y;\r\n    this.z = a.z - b.z;\r\n    this.w = a.w - b.w;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  multiplyScalar: function(scalar) {\r\n\r\n    this.x *= scalar;\r\n    this.y *= scalar;\r\n    this.z *= scalar;\r\n    this.w *= scalar;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  applyMatrix4: function(m) {\r\n\r\n    var x = this.x;\r\n    var y = this.y;\r\n    var z = this.z;\r\n    var w = this.w;\r\n\r\n    var e = m.elements;\r\n\r\n    this.x = e[0] * x + e[4] * y + e[8] * z + e[12] * w;\r\n    this.y = e[1] * x + e[5] * y + e[9] * z + e[13] * w;\r\n    this.z = e[2] * x + e[6] * y + e[10] * z + e[14] * w;\r\n    this.w = e[3] * x + e[7] * y + e[11] * z + e[15] * w;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  divideScalar: function(scalar) {\r\n\r\n    if (scalar !== 0) {\r\n\r\n      var invScalar = 1 / scalar;\r\n\r\n      this.x *= invScalar;\r\n      this.y *= invScalar;\r\n      this.z *= invScalar;\r\n      this.w *= invScalar;\r\n\r\n    }\r\n    else {\r\n\r\n      this.x = 0;\r\n      this.y = 0;\r\n      this.z = 0;\r\n      this.w = 1;\r\n\r\n    }\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  setAxisAngleFromQuaternion: function(q) {\r\n\r\n    // http://www.euclideanspace.com/maths/geometry/rotations/conversions/quaternionToAngle/index.htm\r\n\r\n    // q is assumed to be normalized\r\n\r\n    this.w = 2 * Math.acos(q.w);\r\n\r\n    var s = Math.sqrt(1 - q.w * q.w);\r\n\r\n    if (s < 0.0001) {\r\n\r\n      this.x = 1;\r\n      this.y = 0;\r\n      this.z = 0;\r\n\r\n    }\r\n    else {\r\n\r\n      this.x = q.x / s;\r\n      this.y = q.y / s;\r\n      this.z = q.z / s;\r\n\r\n    }\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  setAxisAngleFromRotationMatrix: function(m) {\r\n\r\n    // http://www.euclideanspace.com/maths/geometry/rotations/conversions/matrixToAngle/index.htm\r\n\r\n    // assumes the upper 3x3 of m is a pure rotation matrix (i.e, unscaled)\r\n\r\n    var angle, x, y, z, // variables for result\r\n      epsilon = 0.01, // margin to allow for rounding errors\r\n      epsilon2 = 0.1, // margin to distinguish between 0 and 180 degrees\r\n\r\n      te = m.elements,\r\n\r\n      m11 = te[0],\r\n      m12 = te[4],\r\n      m13 = te[8],\r\n      m21 = te[1],\r\n      m22 = te[5],\r\n      m23 = te[9],\r\n      m31 = te[2],\r\n      m32 = te[6],\r\n      m33 = te[10];\r\n\r\n    if ((Math.abs(m12 - m21) < epsilon) && (Math.abs(m13 - m31) < epsilon) && (Math.abs(m23 - m32) < epsilon)) {\r\n\r\n      // singularity found\r\n      // first check for identity matrix which must have +1 for all terms\r\n      // in leading diagonal and zero in other terms\r\n\r\n      if ((Math.abs(m12 + m21) < epsilon2) && (Math.abs(m13 + m31) < epsilon2) && (Math.abs(m23 + m32) < epsilon2) && (Math.abs(m11 + m22 + m33 - 3) < epsilon2)) {\r\n\r\n        // this singularity is identity matrix so angle = 0\r\n\r\n        this.set(1, 0, 0, 0);\r\n\r\n        return this; // zero angle, arbitrary axis\r\n\r\n      }\r\n\r\n      // otherwise this singularity is angle = 180\r\n\r\n      angle = Math.PI;\r\n\r\n      var xx = (m11 + 1) / 2;\r\n      var yy = (m22 + 1) / 2;\r\n      var zz = (m33 + 1) / 2;\r\n      var xy = (m12 + m21) / 4;\r\n      var xz = (m13 + m31) / 4;\r\n      var yz = (m23 + m32) / 4;\r\n\r\n      if ((xx > yy) && (xx > zz)) { // m11 is the largest diagonal term\r\n\r\n        if (xx < epsilon) {\r\n\r\n          x = 0;\r\n          y = 0.707106781;\r\n          z = 0.707106781;\r\n\r\n        }\r\n        else {\r\n\r\n          x = Math.sqrt(xx);\r\n          y = xy / x;\r\n          z = xz / x;\r\n\r\n        }\r\n\r\n      }\r\n      else if (yy > zz) { // m22 is the largest diagonal term\r\n\r\n        if (yy < epsilon) {\r\n\r\n          x = 0.707106781;\r\n          y = 0;\r\n          z = 0.707106781;\r\n\r\n        }\r\n        else {\r\n\r\n          y = Math.sqrt(yy);\r\n          x = xy / y;\r\n          z = yz / y;\r\n\r\n        }\r\n\r\n      }\r\n      else { // m33 is the largest diagonal term so base result on this\r\n\r\n        if (zz < epsilon) {\r\n\r\n          x = 0.707106781;\r\n          y = 0.707106781;\r\n          z = 0;\r\n\r\n        }\r\n        else {\r\n\r\n          z = Math.sqrt(zz);\r\n          x = xz / z;\r\n          y = yz / z;\r\n\r\n        }\r\n\r\n      }\r\n\r\n      this.set(x, y, z, angle);\r\n\r\n      return this; // return 180 deg rotation\r\n\r\n    }\r\n\r\n    // as we have reached here there are no singularities so we can handle normally\r\n\r\n    var s = Math.sqrt((m32 - m23) * (m32 - m23) + (m13 - m31) * (m13 - m31) + (m21 - m12) * (m21 - m12)); // used to normalize\r\n\r\n    if (Math.abs(s) < 0.001) s = 1;\r\n\r\n    // prevent divide by zero, should not happen if matrix is orthogonal and should be\r\n    // caught by singularity test above, but I've left it in just in case\r\n\r\n    this.x = (m32 - m23) / s;\r\n    this.y = (m13 - m31) / s;\r\n    this.z = (m21 - m12) / s;\r\n    this.w = Math.acos((m11 + m22 + m33 - 1) / 2);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  min: function(v) {\r\n\r\n    if (this.x > v.x) {\r\n\r\n      this.x = v.x;\r\n\r\n    }\r\n\r\n    if (this.y > v.y) {\r\n\r\n      this.y = v.y;\r\n\r\n    }\r\n\r\n    if (this.z > v.z) {\r\n\r\n      this.z = v.z;\r\n\r\n    }\r\n\r\n    if (this.w > v.w) {\r\n\r\n      this.w = v.w;\r\n\r\n    }\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  max: function(v) {\r\n\r\n    if (this.x < v.x) {\r\n\r\n      this.x = v.x;\r\n\r\n    }\r\n\r\n    if (this.y < v.y) {\r\n\r\n      this.y = v.y;\r\n\r\n    }\r\n\r\n    if (this.z < v.z) {\r\n\r\n      this.z = v.z;\r\n\r\n    }\r\n\r\n    if (this.w < v.w) {\r\n\r\n      this.w = v.w;\r\n\r\n    }\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  clamp: function(min, max) {\r\n\r\n    // This function assumes min < max, if this assumption isn't true it will not operate correctly\r\n\r\n    if (this.x < min.x) {\r\n\r\n      this.x = min.x;\r\n\r\n    }\r\n    else if (this.x > max.x) {\r\n\r\n      this.x = max.x;\r\n\r\n    }\r\n\r\n    if (this.y < min.y) {\r\n\r\n      this.y = min.y;\r\n\r\n    }\r\n    else if (this.y > max.y) {\r\n\r\n      this.y = max.y;\r\n\r\n    }\r\n\r\n    if (this.z < min.z) {\r\n\r\n      this.z = min.z;\r\n\r\n    }\r\n    else if (this.z > max.z) {\r\n\r\n      this.z = max.z;\r\n\r\n    }\r\n\r\n    if (this.w < min.w) {\r\n\r\n      this.w = min.w;\r\n\r\n    }\r\n    else if (this.w > max.w) {\r\n\r\n      this.w = max.w;\r\n\r\n    }\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  clampScalar: (function() {\r\n\r\n    var min, max;\r\n\r\n    return function(minVal, maxVal) {\r\n\r\n      if (min === undefined) {\r\n\r\n        min = new THREE.Vector4();\r\n        max = new THREE.Vector4();\r\n\r\n      }\r\n\r\n      min.set(minVal, minVal, minVal, minVal);\r\n      max.set(maxVal, maxVal, maxVal, maxVal);\r\n\r\n      return this.clamp(min, max);\r\n\r\n    };\r\n\r\n  })(),\r\n\r\n  floor: function() {\r\n\r\n    this.x = Math.floor(this.x);\r\n    this.y = Math.floor(this.y);\r\n    this.z = Math.floor(this.z);\r\n    this.w = Math.floor(this.w);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  ceil: function() {\r\n\r\n    this.x = Math.ceil(this.x);\r\n    this.y = Math.ceil(this.y);\r\n    this.z = Math.ceil(this.z);\r\n    this.w = Math.ceil(this.w);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  round: function() {\r\n\r\n    this.x = Math.round(this.x);\r\n    this.y = Math.round(this.y);\r\n    this.z = Math.round(this.z);\r\n    this.w = Math.round(this.w);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  roundToZero: function() {\r\n\r\n    this.x = (this.x < 0) ? Math.ceil(this.x) : Math.floor(this.x);\r\n    this.y = (this.y < 0) ? Math.ceil(this.y) : Math.floor(this.y);\r\n    this.z = (this.z < 0) ? Math.ceil(this.z) : Math.floor(this.z);\r\n    this.w = (this.w < 0) ? Math.ceil(this.w) : Math.floor(this.w);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  negate: function() {\r\n\r\n    this.x = -this.x;\r\n    this.y = -this.y;\r\n    this.z = -this.z;\r\n    this.w = -this.w;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  dot: function(v) {\r\n\r\n    return this.x * v.x + this.y * v.y + this.z * v.z + this.w * v.w;\r\n\r\n  },\r\n\r\n  lengthSq: function() {\r\n\r\n    return this.x * this.x + this.y * this.y + this.z * this.z + this.w * this.w;\r\n\r\n  },\r\n\r\n  length: function() {\r\n\r\n    return Math.sqrt(this.x * this.x + this.y * this.y + this.z * this.z + this.w * this.w);\r\n\r\n  },\r\n\r\n  lengthManhattan: function() {\r\n\r\n    return Math.abs(this.x) + Math.abs(this.y) + Math.abs(this.z) + Math.abs(this.w);\r\n\r\n  },\r\n\r\n  normalize: function() {\r\n\r\n    return this.divideScalar(this.length());\r\n\r\n  },\r\n\r\n  setLength: function(l) {\r\n\r\n    var oldLength = this.length();\r\n\r\n    if (oldLength !== 0 && l !== oldLength) {\r\n\r\n      this.multiplyScalar(l / oldLength);\r\n\r\n    }\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  lerp: function(v, alpha) {\r\n\r\n    this.x += (v.x - this.x) * alpha;\r\n    this.y += (v.y - this.y) * alpha;\r\n    this.z += (v.z - this.z) * alpha;\r\n    this.w += (v.w - this.w) * alpha;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  lerpVectors: function(v1, v2, alpha) {\r\n\r\n    this.subVectors(v2, v1).multiplyScalar(alpha).add(v1);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  equals: function(v) {\r\n\r\n    return ((v.x === this.x) && (v.y === this.y) && (v.z === this.z) && (v.w === this.w));\r\n\r\n  },\r\n\r\n  fromArray: function(array, offset) {\r\n\r\n    if (offset === undefined) offset = 0;\r\n\r\n    this.x = array[offset];\r\n    this.y = array[offset + 1];\r\n    this.z = array[offset + 2];\r\n    this.w = array[offset + 3];\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  toArray: function(array, offset) {\r\n\r\n    if (array === undefined) array = [];\r\n    if (offset === undefined) offset = 0;\r\n\r\n    array[offset] = this.x;\r\n    array[offset + 1] = this.y;\r\n    array[offset + 2] = this.z;\r\n    array[offset + 3] = this.w;\r\n\r\n    return array;\r\n\r\n  },\r\n\r\n  fromAttribute: function(attribute, index, offset) {\r\n\r\n    if (offset === undefined) offset = 0;\r\n\r\n    index = index * attribute.itemSize + offset;\r\n\r\n    this.x = attribute.array[index];\r\n    this.y = attribute.array[index + 1];\r\n    this.z = attribute.array[index + 2];\r\n    this.w = attribute.array[index + 3];\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  clone: function() {\r\n\r\n    return new THREE.Vector4(this.x, this.y, this.z, this.w);\r\n\r\n  }\r\n\r\n};\r\n\r\n// File:src/math/Euler.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author WestLangley / http://github.com/WestLangley\r\n * @author bhouston / http://exocortex.com\r\n */\r\n\r\nTHREE.Euler = function(x, y, z, order) {\r\n\r\n  this._x = x || 0;\r\n  this._y = y || 0;\r\n  this._z = z || 0;\r\n  this._order = order || THREE.Euler.DefaultOrder;\r\n\r\n};\r\n\r\nTHREE.Euler.RotationOrders = ['XYZ', 'YZX', 'ZXY', 'XZY', 'YXZ', 'ZYX'];\r\n\r\nTHREE.Euler.DefaultOrder = 'XYZ';\r\n\r\nTHREE.Euler.prototype = {\r\n\r\n  constructor: THREE.Euler,\r\n\r\n  _x: 0,\r\n  _y: 0,\r\n  _z: 0,\r\n  _order: THREE.Euler.DefaultOrder,\r\n\r\n  get x() {\r\n\r\n    return this._x;\r\n\r\n  },\r\n\r\n  set x(value) {\r\n\r\n    this._x = value;\r\n    this.onChangeCallback();\r\n\r\n  },\r\n\r\n  get y() {\r\n\r\n    return this._y;\r\n\r\n  },\r\n\r\n  set y(value) {\r\n\r\n    this._y = value;\r\n    this.onChangeCallback();\r\n\r\n  },\r\n\r\n  get z() {\r\n\r\n    return this._z;\r\n\r\n  },\r\n\r\n  set z(value) {\r\n\r\n    this._z = value;\r\n    this.onChangeCallback();\r\n\r\n  },\r\n\r\n  get order() {\r\n\r\n    return this._order;\r\n\r\n  },\r\n\r\n  set order(value) {\r\n\r\n    this._order = value;\r\n    this.onChangeCallback();\r\n\r\n  },\r\n\r\n  set: function(x, y, z, order) {\r\n\r\n    this._x = x;\r\n    this._y = y;\r\n    this._z = z;\r\n    this._order = order || this._order;\r\n\r\n    this.onChangeCallback();\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  copy: function(euler) {\r\n\r\n    this._x = euler._x;\r\n    this._y = euler._y;\r\n    this._z = euler._z;\r\n    this._order = euler._order;\r\n\r\n    this.onChangeCallback();\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  setFromRotationMatrix: function(m, order, update) {\r\n\r\n    var clamp = THREE.Math.clamp;\r\n\r\n    // assumes the upper 3x3 of m is a pure rotation matrix (i.e, unscaled)\r\n\r\n    var te = m.elements;\r\n    var m11 = te[0],\r\n      m12 = te[4],\r\n      m13 = te[8];\r\n    var m21 = te[1],\r\n      m22 = te[5],\r\n      m23 = te[9];\r\n    var m31 = te[2],\r\n      m32 = te[6],\r\n      m33 = te[10];\r\n\r\n    order = order || this._order;\r\n\r\n    if (order === 'XYZ') {\r\n\r\n      this._y = Math.asin(clamp(m13, -1, 1));\r\n\r\n      if (Math.abs(m13) < 0.99999) {\r\n\r\n        this._x = Math.atan2(-m23, m33);\r\n        this._z = Math.atan2(-m12, m11);\r\n\r\n      }\r\n      else {\r\n\r\n        this._x = Math.atan2(m32, m22);\r\n        this._z = 0;\r\n\r\n      }\r\n\r\n    }\r\n    else if (order === 'YXZ') {\r\n\r\n      this._x = Math.asin(-clamp(m23, -1, 1));\r\n\r\n      if (Math.abs(m23) < 0.99999) {\r\n\r\n        this._y = Math.atan2(m13, m33);\r\n        this._z = Math.atan2(m21, m22);\r\n\r\n      }\r\n      else {\r\n\r\n        this._y = Math.atan2(-m31, m11);\r\n        this._z = 0;\r\n\r\n      }\r\n\r\n    }\r\n    else if (order === 'ZXY') {\r\n\r\n      this._x = Math.asin(clamp(m32, -1, 1));\r\n\r\n      if (Math.abs(m32) < 0.99999) {\r\n\r\n        this._y = Math.atan2(-m31, m33);\r\n        this._z = Math.atan2(-m12, m22);\r\n\r\n      }\r\n      else {\r\n\r\n        this._y = 0;\r\n        this._z = Math.atan2(m21, m11);\r\n\r\n      }\r\n\r\n    }\r\n    else if (order === 'ZYX') {\r\n\r\n      this._y = Math.asin(-clamp(m31, -1, 1));\r\n\r\n      if (Math.abs(m31) < 0.99999) {\r\n\r\n        this._x = Math.atan2(m32, m33);\r\n        this._z = Math.atan2(m21, m11);\r\n\r\n      }\r\n      else {\r\n\r\n        this._x = 0;\r\n        this._z = Math.atan2(-m12, m22);\r\n\r\n      }\r\n\r\n    }\r\n    else if (order === 'YZX') {\r\n\r\n      this._z = Math.asin(clamp(m21, -1, 1));\r\n\r\n      if (Math.abs(m21) < 0.99999) {\r\n\r\n        this._x = Math.atan2(-m23, m22);\r\n        this._y = Math.atan2(-m31, m11);\r\n\r\n      }\r\n      else {\r\n\r\n        this._x = 0;\r\n        this._y = Math.atan2(m13, m33);\r\n\r\n      }\r\n\r\n    }\r\n    else if (order === 'XZY') {\r\n\r\n      this._z = Math.asin(-clamp(m12, -1, 1));\r\n\r\n      if (Math.abs(m12) < 0.99999) {\r\n\r\n        this._x = Math.atan2(m32, m22);\r\n        this._y = Math.atan2(m13, m11);\r\n\r\n      }\r\n      else {\r\n\r\n        this._x = Math.atan2(-m23, m33);\r\n        this._y = 0;\r\n\r\n      }\r\n\r\n    }\r\n    else {\r\n\r\n      THREE.warn('THREE.Euler: .setFromRotationMatrix() given unsupported order: ' + order)\r\n\r\n    }\r\n\r\n    this._order = order;\r\n\r\n    if (update !== false) this.onChangeCallback();\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  setFromQuaternion: function() {\r\n\r\n    var matrix;\r\n\r\n    return function(q, order, update) {\r\n\r\n      if (matrix === undefined) matrix = new THREE.Matrix4();\r\n      matrix.makeRotationFromQuaternion(q);\r\n      this.setFromRotationMatrix(matrix, order, update);\r\n\r\n      return this;\r\n\r\n    };\r\n\r\n  }(),\r\n\r\n  setFromVector3: function(v, order) {\r\n\r\n    return this.set(v.x, v.y, v.z, order || this._order);\r\n\r\n  },\r\n\r\n  reorder: function() {\r\n\r\n    // WARNING: this discards revolution information -bhouston\r\n\r\n    var q = new THREE.Quaternion();\r\n\r\n    return function(newOrder) {\r\n\r\n      q.setFromEuler(this);\r\n      this.setFromQuaternion(q, newOrder);\r\n\r\n    };\r\n\r\n  }(),\r\n\r\n  equals: function(euler) {\r\n\r\n    return (euler._x === this._x) && (euler._y === this._y) && (euler._z === this._z) && (euler._order === this._order);\r\n\r\n  },\r\n\r\n  fromArray: function(array) {\r\n\r\n    this._x = array[0];\r\n    this._y = array[1];\r\n    this._z = array[2];\r\n    if (array[3] !== undefined) this._order = array[3];\r\n\r\n    this.onChangeCallback();\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  toArray: function(array, offset) {\r\n\r\n    if (array === undefined) array = [];\r\n    if (offset === undefined) offset = 0;\r\n\r\n    array[offset] = this._x;\r\n    array[offset + 1] = this._y;\r\n    array[offset + 2] = this._z;\r\n    array[offset + 3] = this._order;\r\n\r\n    return array;\r\n  },\r\n\r\n  toVector3: function(optionalResult) {\r\n\r\n    if (optionalResult) {\r\n\r\n      return optionalResult.set(this._x, this._y, this._z);\r\n\r\n    }\r\n    else {\r\n\r\n      return new THREE.Vector3(this._x, this._y, this._z);\r\n\r\n    }\r\n\r\n  },\r\n\r\n  onChange: function(callback) {\r\n\r\n    this.onChangeCallback = callback;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  onChangeCallback: function() {},\r\n\r\n  clone: function() {\r\n\r\n    return new THREE.Euler(this._x, this._y, this._z, this._order);\r\n\r\n  }\r\n\r\n};\r\n\r\n// File:src/math/Line3.js\r\n\r\n/**\r\n * @author bhouston / http://exocortex.com\r\n */\r\n\r\nTHREE.Line3 = function(start, end) {\r\n\r\n  this.start = (start !== undefined) ? start : new THREE.Vector3();\r\n  this.end = (end !== undefined) ? end : new THREE.Vector3();\r\n\r\n};\r\n\r\nTHREE.Line3.prototype = {\r\n\r\n  constructor: THREE.Line3,\r\n\r\n  set: function(start, end) {\r\n\r\n    this.start.copy(start);\r\n    this.end.copy(end);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  copy: function(line) {\r\n\r\n    this.start.copy(line.start);\r\n    this.end.copy(line.end);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  center: function(optionalTarget) {\r\n\r\n    var result = optionalTarget || new THREE.Vector3();\r\n    return result.addVectors(this.start, this.end).multiplyScalar(0.5);\r\n\r\n  },\r\n\r\n  delta: function(optionalTarget) {\r\n\r\n    var result = optionalTarget || new THREE.Vector3();\r\n    return result.subVectors(this.end, this.start);\r\n\r\n  },\r\n\r\n  distanceSq: function() {\r\n\r\n    return this.start.distanceToSquared(this.end);\r\n\r\n  },\r\n\r\n  distance: function() {\r\n\r\n    return this.start.distanceTo(this.end);\r\n\r\n  },\r\n\r\n  at: function(t, optionalTarget) {\r\n\r\n    var result = optionalTarget || new THREE.Vector3();\r\n\r\n    return this.delta(result).multiplyScalar(t).add(this.start);\r\n\r\n  },\r\n\r\n  closestPointToPointParameter: function() {\r\n\r\n    var startP = new THREE.Vector3();\r\n    var startEnd = new THREE.Vector3();\r\n\r\n    return function(point, clampToLine) {\r\n\r\n      startP.subVectors(point, this.start);\r\n      startEnd.subVectors(this.end, this.start);\r\n\r\n      var startEnd2 = startEnd.dot(startEnd);\r\n      var startEnd_startP = startEnd.dot(startP);\r\n\r\n      var t = startEnd_startP / startEnd2;\r\n\r\n      if (clampToLine) {\r\n\r\n        t = THREE.Math.clamp(t, 0, 1);\r\n\r\n      }\r\n\r\n      return t;\r\n\r\n    };\r\n\r\n  }(),\r\n\r\n  closestPointToPoint: function(point, clampToLine, optionalTarget) {\r\n\r\n    var t = this.closestPointToPointParameter(point, clampToLine);\r\n\r\n    var result = optionalTarget || new THREE.Vector3();\r\n\r\n    return this.delta(result).multiplyScalar(t).add(this.start);\r\n\r\n  },\r\n\r\n  applyMatrix4: function(matrix) {\r\n\r\n    this.start.applyMatrix4(matrix);\r\n    this.end.applyMatrix4(matrix);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  equals: function(line) {\r\n\r\n    return line.start.equals(this.start) && line.end.equals(this.end);\r\n\r\n  },\r\n\r\n  clone: function() {\r\n\r\n    return new THREE.Line3().copy(this);\r\n\r\n  }\r\n\r\n};\r\n\r\n// File:src/math/Box2.js\r\n\r\n/**\r\n * @author bhouston / http://exocortex.com\r\n */\r\n\r\nTHREE.Box2 = function(min, max) {\r\n\r\n  this.min = (min !== undefined) ? min : new THREE.Vector2(Infinity, Infinity);\r\n  this.max = (max !== undefined) ? max : new THREE.Vector2(-Infinity, -Infinity);\r\n\r\n};\r\n\r\nTHREE.Box2.prototype = {\r\n\r\n  constructor: THREE.Box2,\r\n\r\n  set: function(min, max) {\r\n\r\n    this.min.copy(min);\r\n    this.max.copy(max);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  setFromPoints: function(points) {\r\n\r\n    this.makeEmpty();\r\n\r\n    for (var i = 0, il = points.length; i < il; i++) {\r\n\r\n      this.expandByPoint(points[i])\r\n\r\n    }\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  setFromCenterAndSize: function() {\r\n\r\n    var v1 = new THREE.Vector2();\r\n\r\n    return function(center, size) {\r\n\r\n      var halfSize = v1.copy(size).multiplyScalar(0.5);\r\n      this.min.copy(center).sub(halfSize);\r\n      this.max.copy(center).add(halfSize);\r\n\r\n      return this;\r\n\r\n    };\r\n\r\n  }(),\r\n\r\n  copy: function(box) {\r\n\r\n    this.min.copy(box.min);\r\n    this.max.copy(box.max);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  makeEmpty: function() {\r\n\r\n    this.min.x = this.min.y = Infinity;\r\n    this.max.x = this.max.y = -Infinity;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  empty: function() {\r\n\r\n    // this is a more robust check for empty than ( volume <= 0 ) because volume can get positive with two negative axes\r\n\r\n    return (this.max.x < this.min.x) || (this.max.y < this.min.y);\r\n\r\n  },\r\n\r\n  center: function(optionalTarget) {\r\n\r\n    var result = optionalTarget || new THREE.Vector2();\r\n    return result.addVectors(this.min, this.max).multiplyScalar(0.5);\r\n\r\n  },\r\n\r\n  size: function(optionalTarget) {\r\n\r\n    var result = optionalTarget || new THREE.Vector2();\r\n    return result.subVectors(this.max, this.min);\r\n\r\n  },\r\n\r\n  expandByPoint: function(point) {\r\n\r\n    this.min.min(point);\r\n    this.max.max(point);\r\n\r\n    return this;\r\n  },\r\n\r\n  expandByVector: function(vector) {\r\n\r\n    this.min.sub(vector);\r\n    this.max.add(vector);\r\n\r\n    return this;\r\n  },\r\n\r\n  expandByScalar: function(scalar) {\r\n\r\n    this.min.addScalar(-scalar);\r\n    this.max.addScalar(scalar);\r\n\r\n    return this;\r\n  },\r\n\r\n  containsPoint: function(point) {\r\n\r\n    if (point.x < this.min.x || point.x > this.max.x ||\r\n      point.y < this.min.y || point.y > this.max.y) {\r\n\r\n      return false;\r\n\r\n    }\r\n\r\n    return true;\r\n\r\n  },\r\n\r\n  containsBox: function(box) {\r\n\r\n    if ((this.min.x <= box.min.x) && (box.max.x <= this.max.x) &&\r\n      (this.min.y <= box.min.y) && (box.max.y <= this.max.y)) {\r\n\r\n      return true;\r\n\r\n    }\r\n\r\n    return false;\r\n\r\n  },\r\n\r\n  getParameter: function(point, optionalTarget) {\r\n\r\n    // This can potentially have a divide by zero if the box\r\n    // has a size dimension of 0.\r\n\r\n    var result = optionalTarget || new THREE.Vector2();\r\n\r\n    return result.set(\r\n      (point.x - this.min.x) / (this.max.x - this.min.x), (point.y - this.min.y) / (this.max.y - this.min.y)\r\n    );\r\n\r\n  },\r\n\r\n  isIntersectionBox: function(box) {\r\n\r\n    // using 6 splitting planes to rule out intersections.\r\n\r\n    if (box.max.x < this.min.x || box.min.x > this.max.x ||\r\n      box.max.y < this.min.y || box.min.y > this.max.y) {\r\n\r\n      return false;\r\n\r\n    }\r\n\r\n    return true;\r\n\r\n  },\r\n\r\n  clampPoint: function(point, optionalTarget) {\r\n\r\n    var result = optionalTarget || new THREE.Vector2();\r\n    return result.copy(point).clamp(this.min, this.max);\r\n\r\n  },\r\n\r\n  distanceToPoint: function() {\r\n\r\n    var v1 = new THREE.Vector2();\r\n\r\n    return function(point) {\r\n\r\n      var clampedPoint = v1.copy(point).clamp(this.min, this.max);\r\n      return clampedPoint.sub(point).length();\r\n\r\n    };\r\n\r\n  }(),\r\n\r\n  intersect: function(box) {\r\n\r\n    this.min.max(box.min);\r\n    this.max.min(box.max);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  union: function(box) {\r\n\r\n    this.min.min(box.min);\r\n    this.max.max(box.max);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  translate: function(offset) {\r\n\r\n    this.min.add(offset);\r\n    this.max.add(offset);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  equals: function(box) {\r\n\r\n    return box.min.equals(this.min) && box.max.equals(this.max);\r\n\r\n  },\r\n\r\n  clone: function() {\r\n\r\n    return new THREE.Box2().copy(this);\r\n\r\n  }\r\n\r\n};\r\n\r\n// File:src/math/Box3.js\r\n\r\n/**\r\n * @author bhouston / http://exocortex.com\r\n * @author WestLangley / http://github.com/WestLangley\r\n */\r\n\r\nTHREE.Box3 = function(min, max) {\r\n\r\n  this.min = (min !== undefined) ? min : new THREE.Vector3(Infinity, Infinity, Infinity);\r\n  this.max = (max !== undefined) ? max : new THREE.Vector3(-Infinity, -Infinity, -Infinity);\r\n\r\n};\r\n\r\nTHREE.Box3.prototype = {\r\n\r\n  constructor: THREE.Box3,\r\n\r\n  set: function(min, max) {\r\n\r\n    this.min.copy(min);\r\n    this.max.copy(max);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  setFromPoints: function(points) {\r\n\r\n    this.makeEmpty();\r\n\r\n    for (var i = 0, il = points.length; i < il; i++) {\r\n\r\n      this.expandByPoint(points[i])\r\n\r\n    }\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  setFromCenterAndSize: function() {\r\n\r\n    var v1 = new THREE.Vector3();\r\n\r\n    return function(center, size) {\r\n\r\n      var halfSize = v1.copy(size).multiplyScalar(0.5);\r\n\r\n      this.min.copy(center).sub(halfSize);\r\n      this.max.copy(center).add(halfSize);\r\n\r\n      return this;\r\n\r\n    };\r\n\r\n  }(),\r\n\r\n  setFromObject: function() {\r\n\r\n    // Computes the world-axis-aligned bounding box of an object (including its children),\r\n    // accounting for both the object's, and childrens', world transforms\r\n\r\n    var v1 = new THREE.Vector3();\r\n\r\n    return function(object) {\r\n\r\n      var scope = this;\r\n\r\n      object.updateMatrixWorld(true);\r\n\r\n      this.makeEmpty();\r\n\r\n      object.traverse(function(node) {\r\n\r\n        var geometry = node.geometry;\r\n\r\n        if (geometry !== undefined) {\r\n\r\n          if (geometry instanceof THREE.Geometry) {\r\n\r\n            var vertices = geometry.vertices;\r\n\r\n            for (var i = 0, il = vertices.length; i < il; i++) {\r\n\r\n              v1.copy(vertices[i]);\r\n\r\n              v1.applyMatrix4(node.matrixWorld);\r\n\r\n              scope.expandByPoint(v1);\r\n\r\n            }\r\n\r\n          }\r\n          else if (geometry instanceof THREE.BufferGeometry && geometry.attributes['position'] !== undefined) {\r\n\r\n            var positions = geometry.attributes['position'].array;\r\n\r\n            for (var i = 0, il = positions.length; i < il; i += 3) {\r\n\r\n              v1.set(positions[i], positions[i + 1], positions[i + 2]);\r\n\r\n              v1.applyMatrix4(node.matrixWorld);\r\n\r\n              scope.expandByPoint(v1);\r\n\r\n            }\r\n\r\n          }\r\n\r\n        }\r\n\r\n      });\r\n\r\n      return this;\r\n\r\n    };\r\n\r\n  }(),\r\n\r\n  copy: function(box) {\r\n\r\n    this.min.copy(box.min);\r\n    this.max.copy(box.max);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  makeEmpty: function() {\r\n\r\n    this.min.x = this.min.y = this.min.z = Infinity;\r\n    this.max.x = this.max.y = this.max.z = -Infinity;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  empty: function() {\r\n\r\n    // this is a more robust check for empty than ( volume <= 0 ) because volume can get positive with two negative axes\r\n\r\n    return (this.max.x < this.min.x) || (this.max.y < this.min.y) || (this.max.z < this.min.z);\r\n\r\n  },\r\n\r\n  center: function(optionalTarget) {\r\n\r\n    var result = optionalTarget || new THREE.Vector3();\r\n    return result.addVectors(this.min, this.max).multiplyScalar(0.5);\r\n\r\n  },\r\n\r\n  size: function(optionalTarget) {\r\n\r\n    var result = optionalTarget || new THREE.Vector3();\r\n    return result.subVectors(this.max, this.min);\r\n\r\n  },\r\n\r\n  expandByPoint: function(point) {\r\n\r\n    this.min.min(point);\r\n    this.max.max(point);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  expandByVector: function(vector) {\r\n\r\n    this.min.sub(vector);\r\n    this.max.add(vector);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  expandByScalar: function(scalar) {\r\n\r\n    this.min.addScalar(-scalar);\r\n    this.max.addScalar(scalar);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  containsPoint: function(point) {\r\n\r\n    if (point.x < this.min.x || point.x > this.max.x ||\r\n      point.y < this.min.y || point.y > this.max.y ||\r\n      point.z < this.min.z || point.z > this.max.z) {\r\n\r\n      return false;\r\n\r\n    }\r\n\r\n    return true;\r\n\r\n  },\r\n\r\n  containsBox: function(box) {\r\n\r\n    if ((this.min.x <= box.min.x) && (box.max.x <= this.max.x) &&\r\n      (this.min.y <= box.min.y) && (box.max.y <= this.max.y) &&\r\n      (this.min.z <= box.min.z) && (box.max.z <= this.max.z)) {\r\n\r\n      return true;\r\n\r\n    }\r\n\r\n    return false;\r\n\r\n  },\r\n\r\n  getParameter: function(point, optionalTarget) {\r\n\r\n    // This can potentially have a divide by zero if the box\r\n    // has a size dimension of 0.\r\n\r\n    var result = optionalTarget || new THREE.Vector3();\r\n\r\n    return result.set(\r\n      (point.x - this.min.x) / (this.max.x - this.min.x), (point.y - this.min.y) / (this.max.y - this.min.y), (point.z - this.min.z) / (this.max.z - this.min.z)\r\n    );\r\n\r\n  },\r\n\r\n  isIntersectionBox: function(box) {\r\n\r\n    // using 6 splitting planes to rule out intersections.\r\n\r\n    if (box.max.x < this.min.x || box.min.x > this.max.x ||\r\n      box.max.y < this.min.y || box.min.y > this.max.y ||\r\n      box.max.z < this.min.z || box.min.z > this.max.z) {\r\n\r\n      return false;\r\n\r\n    }\r\n\r\n    return true;\r\n\r\n  },\r\n\r\n  clampPoint: function(point, optionalTarget) {\r\n\r\n    var result = optionalTarget || new THREE.Vector3();\r\n    return result.copy(point).clamp(this.min, this.max);\r\n\r\n  },\r\n\r\n  distanceToPoint: function() {\r\n\r\n    var v1 = new THREE.Vector3();\r\n\r\n    return function(point) {\r\n\r\n      var clampedPoint = v1.copy(point).clamp(this.min, this.max);\r\n      return clampedPoint.sub(point).length();\r\n\r\n    };\r\n\r\n  }(),\r\n\r\n  getBoundingSphere: function() {\r\n\r\n    var v1 = new THREE.Vector3();\r\n\r\n    return function(optionalTarget) {\r\n\r\n      var result = optionalTarget || new THREE.Sphere();\r\n\r\n      result.center = this.center();\r\n      result.radius = this.size(v1).length() * 0.5;\r\n\r\n      return result;\r\n\r\n    };\r\n\r\n  }(),\r\n\r\n  intersect: function(box) {\r\n\r\n    this.min.max(box.min);\r\n    this.max.min(box.max);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  union: function(box) {\r\n\r\n    this.min.min(box.min);\r\n    this.max.max(box.max);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  applyMatrix4: function() {\r\n\r\n    var points = [\r\n      new THREE.Vector3(),\r\n      new THREE.Vector3(),\r\n      new THREE.Vector3(),\r\n      new THREE.Vector3(),\r\n      new THREE.Vector3(),\r\n      new THREE.Vector3(),\r\n      new THREE.Vector3(),\r\n      new THREE.Vector3()\r\n    ];\r\n\r\n    return function(matrix) {\r\n\r\n      // NOTE: I am using a binary pattern to specify all 2^3 combinations below\r\n      points[0].set(this.min.x, this.min.y, this.min.z).applyMatrix4(matrix); // 000\r\n      points[1].set(this.min.x, this.min.y, this.max.z).applyMatrix4(matrix); // 001\r\n      points[2].set(this.min.x, this.max.y, this.min.z).applyMatrix4(matrix); // 010\r\n      points[3].set(this.min.x, this.max.y, this.max.z).applyMatrix4(matrix); // 011\r\n      points[4].set(this.max.x, this.min.y, this.min.z).applyMatrix4(matrix); // 100\r\n      points[5].set(this.max.x, this.min.y, this.max.z).applyMatrix4(matrix); // 101\r\n      points[6].set(this.max.x, this.max.y, this.min.z).applyMatrix4(matrix); // 110\r\n      points[7].set(this.max.x, this.max.y, this.max.z).applyMatrix4(matrix); // 111\r\n\r\n      this.makeEmpty();\r\n      this.setFromPoints(points);\r\n\r\n      return this;\r\n\r\n    };\r\n\r\n  }(),\r\n\r\n  translate: function(offset) {\r\n\r\n    this.min.add(offset);\r\n    this.max.add(offset);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  equals: function(box) {\r\n\r\n    return box.min.equals(this.min) && box.max.equals(this.max);\r\n\r\n  },\r\n\r\n  clone: function() {\r\n\r\n    return new THREE.Box3().copy(this);\r\n\r\n  }\r\n\r\n};\r\n\r\n// File:src/math/Matrix3.js\r\n\r\n/**\r\n * @author alteredq / http://alteredqualia.com/\r\n * @author WestLangley / http://github.com/WestLangley\r\n * @author bhouston / http://exocortex.com\r\n */\r\n\r\nTHREE.Matrix3 = function() {\r\n\r\n  this.elements = new Float32Array([\r\n\r\n    1, 0, 0,\r\n    0, 1, 0,\r\n    0, 0, 1\r\n\r\n  ]);\r\n\r\n  if (arguments.length > 0) {\r\n\r\n    THREE.error('THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.');\r\n\r\n  }\r\n\r\n};\r\n\r\nTHREE.Matrix3.prototype = {\r\n\r\n  constructor: THREE.Matrix3,\r\n\r\n  set: function(n11, n12, n13, n21, n22, n23, n31, n32, n33) {\r\n\r\n    var te = this.elements;\r\n\r\n    te[0] = n11;\r\n    te[3] = n12;\r\n    te[6] = n13;\r\n    te[1] = n21;\r\n    te[4] = n22;\r\n    te[7] = n23;\r\n    te[2] = n31;\r\n    te[5] = n32;\r\n    te[8] = n33;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  identity: function() {\r\n\r\n    this.set(\r\n\r\n      1, 0, 0,\r\n      0, 1, 0,\r\n      0, 0, 1\r\n\r\n    );\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  copy: function(m) {\r\n\r\n    var me = m.elements;\r\n\r\n    this.set(\r\n\r\n      me[0], me[3], me[6],\r\n      me[1], me[4], me[7],\r\n      me[2], me[5], me[8]\r\n\r\n    );\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  multiplyVector3: function(vector) {\r\n\r\n    THREE.warn('THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead.');\r\n    return vector.applyMatrix3(this);\r\n\r\n  },\r\n\r\n  multiplyVector3Array: function(a) {\r\n\r\n    THREE.warn('THREE.Matrix3: .multiplyVector3Array() has been renamed. Use matrix.applyToVector3Array( array ) instead.');\r\n    return this.applyToVector3Array(a);\r\n\r\n  },\r\n\r\n  applyToVector3Array: function() {\r\n\r\n    var v1 = new THREE.Vector3();\r\n\r\n    return function(array, offset, length) {\r\n\r\n      if (offset === undefined) offset = 0;\r\n      if (length === undefined) length = array.length;\r\n\r\n      for (var i = 0, j = offset; i < length; i += 3, j += 3) {\r\n\r\n        v1.x = array[j];\r\n        v1.y = array[j + 1];\r\n        v1.z = array[j + 2];\r\n\r\n        v1.applyMatrix3(this);\r\n\r\n        array[j] = v1.x;\r\n        array[j + 1] = v1.y;\r\n        array[j + 2] = v1.z;\r\n\r\n      }\r\n\r\n      return array;\r\n\r\n    };\r\n\r\n  }(),\r\n\r\n  multiplyScalar: function(s) {\r\n\r\n    var te = this.elements;\r\n\r\n    te[0] *= s;\r\n    te[3] *= s;\r\n    te[6] *= s;\r\n    te[1] *= s;\r\n    te[4] *= s;\r\n    te[7] *= s;\r\n    te[2] *= s;\r\n    te[5] *= s;\r\n    te[8] *= s;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  determinant: function() {\r\n\r\n    var te = this.elements;\r\n\r\n    var a = te[0],\r\n      b = te[1],\r\n      c = te[2],\r\n      d = te[3],\r\n      e = te[4],\r\n      f = te[5],\r\n      g = te[6],\r\n      h = te[7],\r\n      i = te[8];\r\n\r\n    return a * e * i - a * f * h - b * d * i + b * f * g + c * d * h - c * e * g;\r\n\r\n  },\r\n\r\n  getInverse: function(matrix, throwOnInvertible) {\r\n\r\n    // input: THREE.Matrix4\r\n    // ( based on http://code.google.com/p/webgl-mjs/ )\r\n\r\n    var me = matrix.elements;\r\n    var te = this.elements;\r\n\r\n    te[0] = me[10] * me[5] - me[6] * me[9];\r\n    te[1] = -me[10] * me[1] + me[2] * me[9];\r\n    te[2] = me[6] * me[1] - me[2] * me[5];\r\n    te[3] = -me[10] * me[4] + me[6] * me[8];\r\n    te[4] = me[10] * me[0] - me[2] * me[8];\r\n    te[5] = -me[6] * me[0] + me[2] * me[4];\r\n    te[6] = me[9] * me[4] - me[5] * me[8];\r\n    te[7] = -me[9] * me[0] + me[1] * me[8];\r\n    te[8] = me[5] * me[0] - me[1] * me[4];\r\n\r\n    var det = me[0] * te[0] + me[1] * te[3] + me[2] * te[6];\r\n\r\n    // no inverse\r\n\r\n    if (det === 0) {\r\n\r\n      var msg = \"Matrix3.getInverse(): can't invert matrix, determinant is 0\";\r\n\r\n      if (throwOnInvertible || false) {\r\n\r\n        throw new Error(msg);\r\n\r\n      }\r\n      else {\r\n\r\n        THREE.warn(msg);\r\n\r\n      }\r\n\r\n      this.identity();\r\n\r\n      return this;\r\n\r\n    }\r\n\r\n    this.multiplyScalar(1.0 / det);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  transpose: function() {\r\n\r\n    var tmp, m = this.elements;\r\n\r\n    tmp = m[1];\r\n    m[1] = m[3];\r\n    m[3] = tmp;\r\n    tmp = m[2];\r\n    m[2] = m[6];\r\n    m[6] = tmp;\r\n    tmp = m[5];\r\n    m[5] = m[7];\r\n    m[7] = tmp;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  flattenToArrayOffset: function(array, offset) {\r\n\r\n    var te = this.elements;\r\n\r\n    array[offset] = te[0];\r\n    array[offset + 1] = te[1];\r\n    array[offset + 2] = te[2];\r\n\r\n    array[offset + 3] = te[3];\r\n    array[offset + 4] = te[4];\r\n    array[offset + 5] = te[5];\r\n\r\n    array[offset + 6] = te[6];\r\n    array[offset + 7] = te[7];\r\n    array[offset + 8] = te[8];\r\n\r\n    return array;\r\n\r\n  },\r\n\r\n  getNormalMatrix: function(m) {\r\n\r\n    // input: THREE.Matrix4\r\n\r\n    this.getInverse(m).transpose();\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  transposeIntoArray: function(r) {\r\n\r\n    var m = this.elements;\r\n\r\n    r[0] = m[0];\r\n    r[1] = m[3];\r\n    r[2] = m[6];\r\n    r[3] = m[1];\r\n    r[4] = m[4];\r\n    r[5] = m[7];\r\n    r[6] = m[2];\r\n    r[7] = m[5];\r\n    r[8] = m[8];\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  fromArray: function(array) {\r\n\r\n    this.elements.set(array);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  toArray: function() {\r\n\r\n    var te = this.elements;\r\n\r\n    return [\r\n      te[0], te[1], te[2],\r\n      te[3], te[4], te[5],\r\n      te[6], te[7], te[8]\r\n    ];\r\n\r\n  },\r\n\r\n  clone: function() {\r\n\r\n    return new THREE.Matrix3().fromArray(this.elements);\r\n\r\n  }\r\n\r\n};\r\n\r\n// File:src/math/Matrix4.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author supereggbert / http://www.paulbrunt.co.uk/\r\n * @author philogb / http://blog.thejit.org/\r\n * @author jordi_ros / http://plattsoft.com\r\n * @author D1plo1d / http://github.com/D1plo1d\r\n * @author alteredq / http://alteredqualia.com/\r\n * @author mikael emtinger / http://gomo.se/\r\n * @author timknip / http://www.floorplanner.com/\r\n * @author bhouston / http://exocortex.com\r\n * @author WestLangley / http://github.com/WestLangley\r\n */\r\n\r\nTHREE.Matrix4 = function() {\r\n\r\n  this.elements = new Float32Array([\r\n\r\n    1, 0, 0, 0,\r\n    0, 1, 0, 0,\r\n    0, 0, 1, 0,\r\n    0, 0, 0, 1\r\n\r\n  ]);\r\n\r\n  if (arguments.length > 0) {\r\n\r\n    THREE.error('THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.');\r\n\r\n  }\r\n\r\n};\r\n\r\nTHREE.Matrix4.prototype = {\r\n\r\n  constructor: THREE.Matrix4,\r\n\r\n  set: function(n11, n12, n13, n14, n21, n22, n23, n24, n31, n32, n33, n34, n41, n42, n43, n44) {\r\n\r\n    var te = this.elements;\r\n\r\n    te[0] = n11;\r\n    te[4] = n12;\r\n    te[8] = n13;\r\n    te[12] = n14;\r\n    te[1] = n21;\r\n    te[5] = n22;\r\n    te[9] = n23;\r\n    te[13] = n24;\r\n    te[2] = n31;\r\n    te[6] = n32;\r\n    te[10] = n33;\r\n    te[14] = n34;\r\n    te[3] = n41;\r\n    te[7] = n42;\r\n    te[11] = n43;\r\n    te[15] = n44;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  identity: function() {\r\n\r\n    this.set(\r\n\r\n      1, 0, 0, 0,\r\n      0, 1, 0, 0,\r\n      0, 0, 1, 0,\r\n      0, 0, 0, 1\r\n\r\n    );\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  copy: function(m) {\r\n\r\n    this.elements.set(m.elements);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  extractPosition: function(m) {\r\n\r\n    THREE.warn('THREE.Matrix4: .extractPosition() has been renamed to .copyPosition().');\r\n    return this.copyPosition(m);\r\n\r\n  },\r\n\r\n  copyPosition: function(m) {\r\n\r\n    var te = this.elements;\r\n    var me = m.elements;\r\n\r\n    te[12] = me[12];\r\n    te[13] = me[13];\r\n    te[14] = me[14];\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  extractBasis: function(xAxis, yAxis, zAxis) {\r\n\r\n    var te = this.elements;\r\n\r\n    xAxis.set(te[0], te[1], te[2]);\r\n    yAxis.set(te[4], te[5], te[6]);\r\n    zAxis.set(te[8], te[9], te[10]);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  makeBasis: function(xAxis, yAxis, zAxis) {\r\n\r\n    this.set(\r\n      xAxis.x, yAxis.x, zAxis.x, 0,\r\n      xAxis.y, yAxis.y, zAxis.y, 0,\r\n      xAxis.z, yAxis.z, zAxis.z, 0,\r\n      0, 0, 0, 1\r\n    );\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  extractRotation: function() {\r\n\r\n    var v1 = new THREE.Vector3();\r\n\r\n    return function(m) {\r\n\r\n      var te = this.elements;\r\n      var me = m.elements;\r\n\r\n      var scaleX = 1 / v1.set(me[0], me[1], me[2]).length();\r\n      var scaleY = 1 / v1.set(me[4], me[5], me[6]).length();\r\n      var scaleZ = 1 / v1.set(me[8], me[9], me[10]).length();\r\n\r\n      te[0] = me[0] * scaleX;\r\n      te[1] = me[1] * scaleX;\r\n      te[2] = me[2] * scaleX;\r\n\r\n      te[4] = me[4] * scaleY;\r\n      te[5] = me[5] * scaleY;\r\n      te[6] = me[6] * scaleY;\r\n\r\n      te[8] = me[8] * scaleZ;\r\n      te[9] = me[9] * scaleZ;\r\n      te[10] = me[10] * scaleZ;\r\n\r\n      return this;\r\n\r\n    };\r\n\r\n  }(),\r\n\r\n  makeRotationFromEuler: function(euler) {\r\n\r\n    if (euler instanceof THREE.Euler === false) {\r\n\r\n      THREE.error('THREE.Matrix: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.');\r\n\r\n    }\r\n\r\n    var te = this.elements;\r\n\r\n    var x = euler.x,\r\n      y = euler.y,\r\n      z = euler.z;\r\n    var a = Math.cos(x),\r\n      b = Math.sin(x);\r\n    var c = Math.cos(y),\r\n      d = Math.sin(y);\r\n    var e = Math.cos(z),\r\n      f = Math.sin(z);\r\n\r\n    if (euler.order === 'XYZ') {\r\n\r\n      var ae = a * e,\r\n        af = a * f,\r\n        be = b * e,\r\n        bf = b * f;\r\n\r\n      te[0] = c * e;\r\n      te[4] = -c * f;\r\n      te[8] = d;\r\n\r\n      te[1] = af + be * d;\r\n      te[5] = ae - bf * d;\r\n      te[9] = -b * c;\r\n\r\n      te[2] = bf - ae * d;\r\n      te[6] = be + af * d;\r\n      te[10] = a * c;\r\n\r\n    }\r\n    else if (euler.order === 'YXZ') {\r\n\r\n      var ce = c * e,\r\n        cf = c * f,\r\n        de = d * e,\r\n        df = d * f;\r\n\r\n      te[0] = ce + df * b;\r\n      te[4] = de * b - cf;\r\n      te[8] = a * d;\r\n\r\n      te[1] = a * f;\r\n      te[5] = a * e;\r\n      te[9] = -b;\r\n\r\n      te[2] = cf * b - de;\r\n      te[6] = df + ce * b;\r\n      te[10] = a * c;\r\n\r\n    }\r\n    else if (euler.order === 'ZXY') {\r\n\r\n      var ce = c * e,\r\n        cf = c * f,\r\n        de = d * e,\r\n        df = d * f;\r\n\r\n      te[0] = ce - df * b;\r\n      te[4] = -a * f;\r\n      te[8] = de + cf * b;\r\n\r\n      te[1] = cf + de * b;\r\n      te[5] = a * e;\r\n      te[9] = df - ce * b;\r\n\r\n      te[2] = -a * d;\r\n      te[6] = b;\r\n      te[10] = a * c;\r\n\r\n    }\r\n    else if (euler.order === 'ZYX') {\r\n\r\n      var ae = a * e,\r\n        af = a * f,\r\n        be = b * e,\r\n        bf = b * f;\r\n\r\n      te[0] = c * e;\r\n      te[4] = be * d - af;\r\n      te[8] = ae * d + bf;\r\n\r\n      te[1] = c * f;\r\n      te[5] = bf * d + ae;\r\n      te[9] = af * d - be;\r\n\r\n      te[2] = -d;\r\n      te[6] = b * c;\r\n      te[10] = a * c;\r\n\r\n    }\r\n    else if (euler.order === 'YZX') {\r\n\r\n      var ac = a * c,\r\n        ad = a * d,\r\n        bc = b * c,\r\n        bd = b * d;\r\n\r\n      te[0] = c * e;\r\n      te[4] = bd - ac * f;\r\n      te[8] = bc * f + ad;\r\n\r\n      te[1] = f;\r\n      te[5] = a * e;\r\n      te[9] = -b * e;\r\n\r\n      te[2] = -d * e;\r\n      te[6] = ad * f + bc;\r\n      te[10] = ac - bd * f;\r\n\r\n    }\r\n    else if (euler.order === 'XZY') {\r\n\r\n      var ac = a * c,\r\n        ad = a * d,\r\n        bc = b * c,\r\n        bd = b * d;\r\n\r\n      te[0] = c * e;\r\n      te[4] = -f;\r\n      te[8] = d * e;\r\n\r\n      te[1] = ac * f + bd;\r\n      te[5] = a * e;\r\n      te[9] = ad * f - bc;\r\n\r\n      te[2] = bc * f - ad;\r\n      te[6] = b * e;\r\n      te[10] = bd * f + ac;\r\n\r\n    }\r\n\r\n    // last column\r\n    te[3] = 0;\r\n    te[7] = 0;\r\n    te[11] = 0;\r\n\r\n    // bottom row\r\n    te[12] = 0;\r\n    te[13] = 0;\r\n    te[14] = 0;\r\n    te[15] = 1;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  setRotationFromQuaternion: function(q) {\r\n\r\n    THREE.warn('THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion().');\r\n\r\n    return this.makeRotationFromQuaternion(q);\r\n\r\n  },\r\n\r\n  makeRotationFromQuaternion: function(q) {\r\n\r\n    var te = this.elements;\r\n\r\n    var x = q.x,\r\n      y = q.y,\r\n      z = q.z,\r\n      w = q.w;\r\n    var x2 = x + x,\r\n      y2 = y + y,\r\n      z2 = z + z;\r\n    var xx = x * x2,\r\n      xy = x * y2,\r\n      xz = x * z2;\r\n    var yy = y * y2,\r\n      yz = y * z2,\r\n      zz = z * z2;\r\n    var wx = w * x2,\r\n      wy = w * y2,\r\n      wz = w * z2;\r\n\r\n    te[0] = 1 - (yy + zz);\r\n    te[4] = xy - wz;\r\n    te[8] = xz + wy;\r\n\r\n    te[1] = xy + wz;\r\n    te[5] = 1 - (xx + zz);\r\n    te[9] = yz - wx;\r\n\r\n    te[2] = xz - wy;\r\n    te[6] = yz + wx;\r\n    te[10] = 1 - (xx + yy);\r\n\r\n    // last column\r\n    te[3] = 0;\r\n    te[7] = 0;\r\n    te[11] = 0;\r\n\r\n    // bottom row\r\n    te[12] = 0;\r\n    te[13] = 0;\r\n    te[14] = 0;\r\n    te[15] = 1;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  lookAt: function() {\r\n\r\n    var x = new THREE.Vector3();\r\n    var y = new THREE.Vector3();\r\n    var z = new THREE.Vector3();\r\n\r\n    return function(eye, target, up) {\r\n\r\n      var te = this.elements;\r\n\r\n      z.subVectors(eye, target).normalize();\r\n\r\n      if (z.length() === 0) {\r\n\r\n        z.z = 1;\r\n\r\n      }\r\n\r\n      x.crossVectors(up, z).normalize();\r\n\r\n      if (x.length() === 0) {\r\n\r\n        z.x += 0.0001;\r\n        x.crossVectors(up, z).normalize();\r\n\r\n      }\r\n\r\n      y.crossVectors(z, x);\r\n\r\n\r\n      te[0] = x.x;\r\n      te[4] = y.x;\r\n      te[8] = z.x;\r\n      te[1] = x.y;\r\n      te[5] = y.y;\r\n      te[9] = z.y;\r\n      te[2] = x.z;\r\n      te[6] = y.z;\r\n      te[10] = z.z;\r\n\r\n      return this;\r\n\r\n    };\r\n\r\n  }(),\r\n\r\n  multiply: function(m, n) {\r\n\r\n    if (n !== undefined) {\r\n\r\n      THREE.warn('THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead.');\r\n      return this.multiplyMatrices(m, n);\r\n\r\n    }\r\n\r\n    return this.multiplyMatrices(this, m);\r\n\r\n  },\r\n\r\n  multiplyMatrices: function(a, b) {\r\n\r\n    var ae = a.elements;\r\n    var be = b.elements;\r\n    var te = this.elements;\r\n\r\n    var a11 = ae[0],\r\n      a12 = ae[4],\r\n      a13 = ae[8],\r\n      a14 = ae[12];\r\n    var a21 = ae[1],\r\n      a22 = ae[5],\r\n      a23 = ae[9],\r\n      a24 = ae[13];\r\n    var a31 = ae[2],\r\n      a32 = ae[6],\r\n      a33 = ae[10],\r\n      a34 = ae[14];\r\n    var a41 = ae[3],\r\n      a42 = ae[7],\r\n      a43 = ae[11],\r\n      a44 = ae[15];\r\n\r\n    var b11 = be[0],\r\n      b12 = be[4],\r\n      b13 = be[8],\r\n      b14 = be[12];\r\n    var b21 = be[1],\r\n      b22 = be[5],\r\n      b23 = be[9],\r\n      b24 = be[13];\r\n    var b31 = be[2],\r\n      b32 = be[6],\r\n      b33 = be[10],\r\n      b34 = be[14];\r\n    var b41 = be[3],\r\n      b42 = be[7],\r\n      b43 = be[11],\r\n      b44 = be[15];\r\n\r\n    te[0] = a11 * b11 + a12 * b21 + a13 * b31 + a14 * b41;\r\n    te[4] = a11 * b12 + a12 * b22 + a13 * b32 + a14 * b42;\r\n    te[8] = a11 * b13 + a12 * b23 + a13 * b33 + a14 * b43;\r\n    te[12] = a11 * b14 + a12 * b24 + a13 * b34 + a14 * b44;\r\n\r\n    te[1] = a21 * b11 + a22 * b21 + a23 * b31 + a24 * b41;\r\n    te[5] = a21 * b12 + a22 * b22 + a23 * b32 + a24 * b42;\r\n    te[9] = a21 * b13 + a22 * b23 + a23 * b33 + a24 * b43;\r\n    te[13] = a21 * b14 + a22 * b24 + a23 * b34 + a24 * b44;\r\n\r\n    te[2] = a31 * b11 + a32 * b21 + a33 * b31 + a34 * b41;\r\n    te[6] = a31 * b12 + a32 * b22 + a33 * b32 + a34 * b42;\r\n    te[10] = a31 * b13 + a32 * b23 + a33 * b33 + a34 * b43;\r\n    te[14] = a31 * b14 + a32 * b24 + a33 * b34 + a34 * b44;\r\n\r\n    te[3] = a41 * b11 + a42 * b21 + a43 * b31 + a44 * b41;\r\n    te[7] = a41 * b12 + a42 * b22 + a43 * b32 + a44 * b42;\r\n    te[11] = a41 * b13 + a42 * b23 + a43 * b33 + a44 * b43;\r\n    te[15] = a41 * b14 + a42 * b24 + a43 * b34 + a44 * b44;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  multiplyToArray: function(a, b, r) {\r\n\r\n    var te = this.elements;\r\n\r\n    this.multiplyMatrices(a, b);\r\n\r\n    r[0] = te[0];\r\n    r[1] = te[1];\r\n    r[2] = te[2];\r\n    r[3] = te[3];\r\n    r[4] = te[4];\r\n    r[5] = te[5];\r\n    r[6] = te[6];\r\n    r[7] = te[7];\r\n    r[8] = te[8];\r\n    r[9] = te[9];\r\n    r[10] = te[10];\r\n    r[11] = te[11];\r\n    r[12] = te[12];\r\n    r[13] = te[13];\r\n    r[14] = te[14];\r\n    r[15] = te[15];\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  multiplyScalar: function(s) {\r\n\r\n    var te = this.elements;\r\n\r\n    te[0] *= s;\r\n    te[4] *= s;\r\n    te[8] *= s;\r\n    te[12] *= s;\r\n    te[1] *= s;\r\n    te[5] *= s;\r\n    te[9] *= s;\r\n    te[13] *= s;\r\n    te[2] *= s;\r\n    te[6] *= s;\r\n    te[10] *= s;\r\n    te[14] *= s;\r\n    te[3] *= s;\r\n    te[7] *= s;\r\n    te[11] *= s;\r\n    te[15] *= s;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  multiplyVector3: function(vector) {\r\n\r\n    THREE.warn('THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) or vector.applyProjection( matrix ) instead.');\r\n    return vector.applyProjection(this);\r\n\r\n  },\r\n\r\n  multiplyVector4: function(vector) {\r\n\r\n    THREE.warn('THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead.');\r\n    return vector.applyMatrix4(this);\r\n\r\n  },\r\n\r\n  multiplyVector3Array: function(a) {\r\n\r\n    THREE.warn('THREE.Matrix4: .multiplyVector3Array() has been renamed. Use matrix.applyToVector3Array( array ) instead.');\r\n    return this.applyToVector3Array(a);\r\n\r\n  },\r\n\r\n  applyToVector3Array: function() {\r\n\r\n    var v1 = new THREE.Vector3();\r\n\r\n    return function(array, offset, length) {\r\n\r\n      if (offset === undefined) offset = 0;\r\n      if (length === undefined) length = array.length;\r\n\r\n      for (var i = 0, j = offset; i < length; i += 3, j += 3) {\r\n\r\n        v1.x = array[j];\r\n        v1.y = array[j + 1];\r\n        v1.z = array[j + 2];\r\n\r\n        v1.applyMatrix4(this);\r\n\r\n        array[j] = v1.x;\r\n        array[j + 1] = v1.y;\r\n        array[j + 2] = v1.z;\r\n\r\n      }\r\n\r\n      return array;\r\n\r\n    };\r\n\r\n  }(),\r\n\r\n  rotateAxis: function(v) {\r\n\r\n    THREE.warn('THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead.');\r\n\r\n    v.transformDirection(this);\r\n\r\n  },\r\n\r\n  crossVector: function(vector) {\r\n\r\n    THREE.warn('THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead.');\r\n    return vector.applyMatrix4(this);\r\n\r\n  },\r\n\r\n  determinant: function() {\r\n\r\n    var te = this.elements;\r\n\r\n    var n11 = te[0],\r\n      n12 = te[4],\r\n      n13 = te[8],\r\n      n14 = te[12];\r\n    var n21 = te[1],\r\n      n22 = te[5],\r\n      n23 = te[9],\r\n      n24 = te[13];\r\n    var n31 = te[2],\r\n      n32 = te[6],\r\n      n33 = te[10],\r\n      n34 = te[14];\r\n    var n41 = te[3],\r\n      n42 = te[7],\r\n      n43 = te[11],\r\n      n44 = te[15];\r\n\r\n    //TODO: make this more efficient\r\n    //( based on http://www.euclideanspace.com/maths/algebra/matrix/functions/inverse/fourD/index.htm )\r\n\r\n    return (\r\n      n41 * (+n14 * n23 * n32 - n13 * n24 * n32 - n14 * n22 * n33 + n12 * n24 * n33 + n13 * n22 * n34 - n12 * n23 * n34) +\r\n      n42 * (+n11 * n23 * n34 - n11 * n24 * n33 + n14 * n21 * n33 - n13 * n21 * n34 + n13 * n24 * n31 - n14 * n23 * n31) +\r\n      n43 * (+n11 * n24 * n32 - n11 * n22 * n34 - n14 * n21 * n32 + n12 * n21 * n34 + n14 * n22 * n31 - n12 * n24 * n31) +\r\n      n44 * (-n13 * n22 * n31 - n11 * n23 * n32 + n11 * n22 * n33 + n13 * n21 * n32 - n12 * n21 * n33 + n12 * n23 * n31)\r\n\r\n    );\r\n\r\n  },\r\n\r\n  transpose: function() {\r\n\r\n    var te = this.elements;\r\n    var tmp;\r\n\r\n    tmp = te[1];\r\n    te[1] = te[4];\r\n    te[4] = tmp;\r\n    tmp = te[2];\r\n    te[2] = te[8];\r\n    te[8] = tmp;\r\n    tmp = te[6];\r\n    te[6] = te[9];\r\n    te[9] = tmp;\r\n\r\n    tmp = te[3];\r\n    te[3] = te[12];\r\n    te[12] = tmp;\r\n    tmp = te[7];\r\n    te[7] = te[13];\r\n    te[13] = tmp;\r\n    tmp = te[11];\r\n    te[11] = te[14];\r\n    te[14] = tmp;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  flattenToArrayOffset: function(array, offset) {\r\n\r\n    var te = this.elements;\r\n\r\n    array[offset] = te[0];\r\n    array[offset + 1] = te[1];\r\n    array[offset + 2] = te[2];\r\n    array[offset + 3] = te[3];\r\n\r\n    array[offset + 4] = te[4];\r\n    array[offset + 5] = te[5];\r\n    array[offset + 6] = te[6];\r\n    array[offset + 7] = te[7];\r\n\r\n    array[offset + 8] = te[8];\r\n    array[offset + 9] = te[9];\r\n    array[offset + 10] = te[10];\r\n    array[offset + 11] = te[11];\r\n\r\n    array[offset + 12] = te[12];\r\n    array[offset + 13] = te[13];\r\n    array[offset + 14] = te[14];\r\n    array[offset + 15] = te[15];\r\n\r\n    return array;\r\n\r\n  },\r\n\r\n  getPosition: function() {\r\n\r\n    var v1 = new THREE.Vector3();\r\n\r\n    return function() {\r\n\r\n      THREE.warn('THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead.');\r\n\r\n      var te = this.elements;\r\n      return v1.set(te[12], te[13], te[14]);\r\n\r\n    };\r\n\r\n  }(),\r\n\r\n  setPosition: function(v) {\r\n\r\n    var te = this.elements;\r\n\r\n    te[12] = v.x;\r\n    te[13] = v.y;\r\n    te[14] = v.z;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  getInverse: function(m, throwOnInvertible) {\r\n\r\n    // based on http://www.euclideanspace.com/maths/algebra/matrix/functions/inverse/fourD/index.htm\r\n    var te = this.elements;\r\n    var me = m.elements;\r\n\r\n    var n11 = me[0],\r\n      n12 = me[4],\r\n      n13 = me[8],\r\n      n14 = me[12];\r\n    var n21 = me[1],\r\n      n22 = me[5],\r\n      n23 = me[9],\r\n      n24 = me[13];\r\n    var n31 = me[2],\r\n      n32 = me[6],\r\n      n33 = me[10],\r\n      n34 = me[14];\r\n    var n41 = me[3],\r\n      n42 = me[7],\r\n      n43 = me[11],\r\n      n44 = me[15];\r\n\r\n    te[0] = n23 * n34 * n42 - n24 * n33 * n42 + n24 * n32 * n43 - n22 * n34 * n43 - n23 * n32 * n44 + n22 * n33 * n44;\r\n    te[4] = n14 * n33 * n42 - n13 * n34 * n42 - n14 * n32 * n43 + n12 * n34 * n43 + n13 * n32 * n44 - n12 * n33 * n44;\r\n    te[8] = n13 * n24 * n42 - n14 * n23 * n42 + n14 * n22 * n43 - n12 * n24 * n43 - n13 * n22 * n44 + n12 * n23 * n44;\r\n    te[12] = n14 * n23 * n32 - n13 * n24 * n32 - n14 * n22 * n33 + n12 * n24 * n33 + n13 * n22 * n34 - n12 * n23 * n34;\r\n    te[1] = n24 * n33 * n41 - n23 * n34 * n41 - n24 * n31 * n43 + n21 * n34 * n43 + n23 * n31 * n44 - n21 * n33 * n44;\r\n    te[5] = n13 * n34 * n41 - n14 * n33 * n41 + n14 * n31 * n43 - n11 * n34 * n43 - n13 * n31 * n44 + n11 * n33 * n44;\r\n    te[9] = n14 * n23 * n41 - n13 * n24 * n41 - n14 * n21 * n43 + n11 * n24 * n43 + n13 * n21 * n44 - n11 * n23 * n44;\r\n    te[13] = n13 * n24 * n31 - n14 * n23 * n31 + n14 * n21 * n33 - n11 * n24 * n33 - n13 * n21 * n34 + n11 * n23 * n34;\r\n    te[2] = n22 * n34 * n41 - n24 * n32 * n41 + n24 * n31 * n42 - n21 * n34 * n42 - n22 * n31 * n44 + n21 * n32 * n44;\r\n    te[6] = n14 * n32 * n41 - n12 * n34 * n41 - n14 * n31 * n42 + n11 * n34 * n42 + n12 * n31 * n44 - n11 * n32 * n44;\r\n    te[10] = n12 * n24 * n41 - n14 * n22 * n41 + n14 * n21 * n42 - n11 * n24 * n42 - n12 * n21 * n44 + n11 * n22 * n44;\r\n    te[14] = n14 * n22 * n31 - n12 * n24 * n31 - n14 * n21 * n32 + n11 * n24 * n32 + n12 * n21 * n34 - n11 * n22 * n34;\r\n    te[3] = n23 * n32 * n41 - n22 * n33 * n41 - n23 * n31 * n42 + n21 * n33 * n42 + n22 * n31 * n43 - n21 * n32 * n43;\r\n    te[7] = n12 * n33 * n41 - n13 * n32 * n41 + n13 * n31 * n42 - n11 * n33 * n42 - n12 * n31 * n43 + n11 * n32 * n43;\r\n    te[11] = n13 * n22 * n41 - n12 * n23 * n41 - n13 * n21 * n42 + n11 * n23 * n42 + n12 * n21 * n43 - n11 * n22 * n43;\r\n    te[15] = n12 * n23 * n31 - n13 * n22 * n31 + n13 * n21 * n32 - n11 * n23 * n32 - n12 * n21 * n33 + n11 * n22 * n33;\r\n\r\n    var det = n11 * te[0] + n21 * te[4] + n31 * te[8] + n41 * te[12];\r\n\r\n    if (det == 0) {\r\n\r\n      var msg = \"THREE.Matrix4.getInverse(): can't invert matrix, determinant is 0\";\r\n\r\n      if (throwOnInvertible || false) {\r\n\r\n        throw new Error(msg);\r\n\r\n      }\r\n      else {\r\n\r\n        THREE.warn(msg);\r\n\r\n      }\r\n\r\n      this.identity();\r\n\r\n      return this;\r\n    }\r\n\r\n    this.multiplyScalar(1 / det);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  translate: function(v) {\r\n\r\n    THREE.error('THREE.Matrix4: .translate() has been removed.');\r\n\r\n  },\r\n\r\n  rotateX: function(angle) {\r\n\r\n    THREE.error('THREE.Matrix4: .rotateX() has been removed.');\r\n\r\n  },\r\n\r\n  rotateY: function(angle) {\r\n\r\n    THREE.error('THREE.Matrix4: .rotateY() has been removed.');\r\n\r\n  },\r\n\r\n  rotateZ: function(angle) {\r\n\r\n    THREE.error('THREE.Matrix4: .rotateZ() has been removed.');\r\n\r\n  },\r\n\r\n  rotateByAxis: function(axis, angle) {\r\n\r\n    THREE.error('THREE.Matrix4: .rotateByAxis() has been removed.');\r\n\r\n  },\r\n\r\n  scale: function(v) {\r\n\r\n    var te = this.elements;\r\n    var x = v.x,\r\n      y = v.y,\r\n      z = v.z;\r\n\r\n    te[0] *= x;\r\n    te[4] *= y;\r\n    te[8] *= z;\r\n    te[1] *= x;\r\n    te[5] *= y;\r\n    te[9] *= z;\r\n    te[2] *= x;\r\n    te[6] *= y;\r\n    te[10] *= z;\r\n    te[3] *= x;\r\n    te[7] *= y;\r\n    te[11] *= z;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  getMaxScaleOnAxis: function() {\r\n\r\n    var te = this.elements;\r\n\r\n    var scaleXSq = te[0] * te[0] + te[1] * te[1] + te[2] * te[2];\r\n    var scaleYSq = te[4] * te[4] + te[5] * te[5] + te[6] * te[6];\r\n    var scaleZSq = te[8] * te[8] + te[9] * te[9] + te[10] * te[10];\r\n\r\n    return Math.sqrt(Math.max(scaleXSq, Math.max(scaleYSq, scaleZSq)));\r\n\r\n  },\r\n\r\n  makeTranslation: function(x, y, z) {\r\n\r\n    this.set(\r\n\r\n      1, 0, 0, x,\r\n      0, 1, 0, y,\r\n      0, 0, 1, z,\r\n      0, 0, 0, 1\r\n\r\n    );\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  makeRotationX: function(theta) {\r\n\r\n    var c = Math.cos(theta),\r\n      s = Math.sin(theta);\r\n\r\n    this.set(\r\n\r\n      1, 0, 0, 0,\r\n      0, c, -s, 0,\r\n      0, s, c, 0,\r\n      0, 0, 0, 1\r\n\r\n    );\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  makeRotationY: function(theta) {\r\n\r\n    var c = Math.cos(theta),\r\n      s = Math.sin(theta);\r\n\r\n    this.set(\r\n\r\n      c, 0, s, 0,\r\n      0, 1, 0, 0, -s, 0, c, 0,\r\n      0, 0, 0, 1\r\n\r\n    );\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  makeRotationZ: function(theta) {\r\n\r\n    var c = Math.cos(theta),\r\n      s = Math.sin(theta);\r\n\r\n    this.set(\r\n\r\n      c, -s, 0, 0,\r\n      s, c, 0, 0,\r\n      0, 0, 1, 0,\r\n      0, 0, 0, 1\r\n\r\n    );\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  makeRotationAxis: function(axis, angle) {\r\n\r\n    // Based on http://www.gamedev.net/reference/articles/article1199.asp\r\n\r\n    var c = Math.cos(angle);\r\n    var s = Math.sin(angle);\r\n    var t = 1 - c;\r\n    var x = axis.x,\r\n      y = axis.y,\r\n      z = axis.z;\r\n    var tx = t * x,\r\n      ty = t * y;\r\n\r\n    this.set(\r\n\r\n      tx * x + c, tx * y - s * z, tx * z + s * y, 0,\r\n      tx * y + s * z, ty * y + c, ty * z - s * x, 0,\r\n      tx * z - s * y, ty * z + s * x, t * z * z + c, 0,\r\n      0, 0, 0, 1\r\n\r\n    );\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  makeScale: function(x, y, z) {\r\n\r\n    this.set(\r\n\r\n      x, 0, 0, 0,\r\n      0, y, 0, 0,\r\n      0, 0, z, 0,\r\n      0, 0, 0, 1\r\n\r\n    );\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  compose: function(position, quaternion, scale) {\r\n\r\n    this.makeRotationFromQuaternion(quaternion);\r\n    this.scale(scale);\r\n    this.setPosition(position);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  decompose: function() {\r\n\r\n    var vector = new THREE.Vector3();\r\n    var matrix = new THREE.Matrix4();\r\n\r\n    return function(position, quaternion, scale) {\r\n\r\n      var te = this.elements;\r\n\r\n      var sx = vector.set(te[0], te[1], te[2]).length();\r\n      var sy = vector.set(te[4], te[5], te[6]).length();\r\n      var sz = vector.set(te[8], te[9], te[10]).length();\r\n\r\n      // if determine is negative, we need to invert one scale\r\n      var det = this.determinant();\r\n      if (det < 0) {\r\n        sx = -sx;\r\n      }\r\n\r\n      position.x = te[12];\r\n      position.y = te[13];\r\n      position.z = te[14];\r\n\r\n      // scale the rotation part\r\n\r\n      matrix.elements.set(this.elements); // at this point matrix is incomplete so we can't use .copy()\r\n\r\n      var invSX = 1 / sx;\r\n      var invSY = 1 / sy;\r\n      var invSZ = 1 / sz;\r\n\r\n      matrix.elements[0] *= invSX;\r\n      matrix.elements[1] *= invSX;\r\n      matrix.elements[2] *= invSX;\r\n\r\n      matrix.elements[4] *= invSY;\r\n      matrix.elements[5] *= invSY;\r\n      matrix.elements[6] *= invSY;\r\n\r\n      matrix.elements[8] *= invSZ;\r\n      matrix.elements[9] *= invSZ;\r\n      matrix.elements[10] *= invSZ;\r\n\r\n      quaternion.setFromRotationMatrix(matrix);\r\n\r\n      scale.x = sx;\r\n      scale.y = sy;\r\n      scale.z = sz;\r\n\r\n      return this;\r\n\r\n    };\r\n\r\n  }(),\r\n\r\n  makeFrustum: function(left, right, bottom, top, near, far) {\r\n\r\n    var te = this.elements;\r\n    var x = 2 * near / (right - left);\r\n    var y = 2 * near / (top - bottom);\r\n\r\n    var a = (right + left) / (right - left);\r\n    var b = (top + bottom) / (top - bottom);\r\n    var c = -(far + near) / (far - near);\r\n    var d = -2 * far * near / (far - near);\r\n\r\n    te[0] = x;\r\n    te[4] = 0;\r\n    te[8] = a;\r\n    te[12] = 0;\r\n    te[1] = 0;\r\n    te[5] = y;\r\n    te[9] = b;\r\n    te[13] = 0;\r\n    te[2] = 0;\r\n    te[6] = 0;\r\n    te[10] = c;\r\n    te[14] = d;\r\n    te[3] = 0;\r\n    te[7] = 0;\r\n    te[11] = -1;\r\n    te[15] = 0;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  makePerspective: function(fov, aspect, near, far) {\r\n\r\n    var ymax = near * Math.tan(THREE.Math.degToRad(fov * 0.5));\r\n    var ymin = -ymax;\r\n    var xmin = ymin * aspect;\r\n    var xmax = ymax * aspect;\r\n\r\n    return this.makeFrustum(xmin, xmax, ymin, ymax, near, far);\r\n\r\n  },\r\n\r\n  makeOrthographic: function(left, right, top, bottom, near, far) {\r\n\r\n    var te = this.elements;\r\n    var w = right - left;\r\n    var h = top - bottom;\r\n    var p = far - near;\r\n\r\n    var x = (right + left) / w;\r\n    var y = (top + bottom) / h;\r\n    var z = (far + near) / p;\r\n\r\n    te[0] = 2 / w;\r\n    te[4] = 0;\r\n    te[8] = 0;\r\n    te[12] = -x;\r\n    te[1] = 0;\r\n    te[5] = 2 / h;\r\n    te[9] = 0;\r\n    te[13] = -y;\r\n    te[2] = 0;\r\n    te[6] = 0;\r\n    te[10] = -2 / p;\r\n    te[14] = -z;\r\n    te[3] = 0;\r\n    te[7] = 0;\r\n    te[11] = 0;\r\n    te[15] = 1;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  fromArray: function(array) {\r\n\r\n    this.elements.set(array);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  toArray: function() {\r\n\r\n    var te = this.elements;\r\n\r\n    return [\r\n      te[0], te[1], te[2], te[3],\r\n      te[4], te[5], te[6], te[7],\r\n      te[8], te[9], te[10], te[11],\r\n      te[12], te[13], te[14], te[15]\r\n    ];\r\n\r\n  },\r\n\r\n  clone: function() {\r\n\r\n    return new THREE.Matrix4().fromArray(this.elements);\r\n\r\n  }\r\n\r\n};\r\n\r\n// File:src/math/Ray.js\r\n\r\n/**\r\n * @author bhouston / http://exocortex.com\r\n */\r\n\r\nTHREE.Ray = function(origin, direction) {\r\n\r\n  this.origin = (origin !== undefined) ? origin : new THREE.Vector3();\r\n  this.direction = (direction !== undefined) ? direction : new THREE.Vector3();\r\n\r\n};\r\n\r\nTHREE.Ray.prototype = {\r\n\r\n  constructor: THREE.Ray,\r\n\r\n  set: function(origin, direction) {\r\n\r\n    this.origin.copy(origin);\r\n    this.direction.copy(direction);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  copy: function(ray) {\r\n\r\n    this.origin.copy(ray.origin);\r\n    this.direction.copy(ray.direction);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  at: function(t, optionalTarget) {\r\n\r\n    var result = optionalTarget || new THREE.Vector3();\r\n\r\n    return result.copy(this.direction).multiplyScalar(t).add(this.origin);\r\n\r\n  },\r\n\r\n  recast: function() {\r\n\r\n    var v1 = new THREE.Vector3();\r\n\r\n    return function(t) {\r\n\r\n      this.origin.copy(this.at(t, v1));\r\n\r\n      return this;\r\n\r\n    };\r\n\r\n  }(),\r\n\r\n  closestPointToPoint: function(point, optionalTarget) {\r\n\r\n    var result = optionalTarget || new THREE.Vector3();\r\n    result.subVectors(point, this.origin);\r\n    var directionDistance = result.dot(this.direction);\r\n\r\n    if (directionDistance < 0) {\r\n\r\n      return result.copy(this.origin);\r\n\r\n    }\r\n\r\n    return result.copy(this.direction).multiplyScalar(directionDistance).add(this.origin);\r\n\r\n  },\r\n\r\n  distanceToPoint: function() {\r\n\r\n    var v1 = new THREE.Vector3();\r\n\r\n    return function(point) {\r\n\r\n      var directionDistance = v1.subVectors(point, this.origin).dot(this.direction);\r\n\r\n      // point behind the ray\r\n\r\n      if (directionDistance < 0) {\r\n\r\n        return this.origin.distanceTo(point);\r\n\r\n      }\r\n\r\n      v1.copy(this.direction).multiplyScalar(directionDistance).add(this.origin);\r\n\r\n      return v1.distanceTo(point);\r\n\r\n    };\r\n\r\n  }(),\r\n\r\n  distanceSqToSegment: function() {\r\n\r\n    var segCenter = new THREE.Vector3();\r\n    var segDir = new THREE.Vector3();\r\n    var diff = new THREE.Vector3();\r\n\r\n    return function(v0, v1, optionalPointOnRay, optionalPointOnSegment) {\r\n\r\n      // from http://www.geometrictools.com/LibMathematics/Distance/Wm5DistRay3Segment3.cpp\r\n      // It returns the min distance between the ray and the segment\r\n      // defined by v0 and v1\r\n      // It can also set two optional targets :\r\n      // - The closest point on the ray\r\n      // - The closest point on the segment\r\n\r\n      segCenter.copy(v0).add(v1).multiplyScalar(0.5);\r\n      segDir.copy(v1).sub(v0).normalize();\r\n      diff.copy(this.origin).sub(segCenter);\r\n\r\n      var segExtent = v0.distanceTo(v1) * 0.5;\r\n      var a01 = -this.direction.dot(segDir);\r\n      var b0 = diff.dot(this.direction);\r\n      var b1 = -diff.dot(segDir);\r\n      var c = diff.lengthSq();\r\n      var det = Math.abs(1 - a01 * a01);\r\n      var s0, s1, sqrDist, extDet;\r\n\r\n      if (det > 0) {\r\n\r\n        // The ray and segment are not parallel.\r\n\r\n        s0 = a01 * b1 - b0;\r\n        s1 = a01 * b0 - b1;\r\n        extDet = segExtent * det;\r\n\r\n        if (s0 >= 0) {\r\n\r\n          if (s1 >= -extDet) {\r\n\r\n            if (s1 <= extDet) {\r\n\r\n              // region 0\r\n              // Minimum at interior points of ray and segment.\r\n\r\n              var invDet = 1 / det;\r\n              s0 *= invDet;\r\n              s1 *= invDet;\r\n              sqrDist = s0 * (s0 + a01 * s1 + 2 * b0) + s1 * (a01 * s0 + s1 + 2 * b1) + c;\r\n\r\n            }\r\n            else {\r\n\r\n              // region 1\r\n\r\n              s1 = segExtent;\r\n              s0 = Math.max(0, -(a01 * s1 + b0));\r\n              sqrDist = -s0 * s0 + s1 * (s1 + 2 * b1) + c;\r\n\r\n            }\r\n\r\n          }\r\n          else {\r\n\r\n            // region 5\r\n\r\n            s1 = -segExtent;\r\n            s0 = Math.max(0, -(a01 * s1 + b0));\r\n            sqrDist = -s0 * s0 + s1 * (s1 + 2 * b1) + c;\r\n\r\n          }\r\n\r\n        }\r\n        else {\r\n\r\n          if (s1 <= -extDet) {\r\n\r\n            // region 4\r\n\r\n            s0 = Math.max(0, -(-a01 * segExtent + b0));\r\n            s1 = (s0 > 0) ? -segExtent : Math.min(Math.max(-segExtent, -b1), segExtent);\r\n            sqrDist = -s0 * s0 + s1 * (s1 + 2 * b1) + c;\r\n\r\n          }\r\n          else if (s1 <= extDet) {\r\n\r\n            // region 3\r\n\r\n            s0 = 0;\r\n            s1 = Math.min(Math.max(-segExtent, -b1), segExtent);\r\n            sqrDist = s1 * (s1 + 2 * b1) + c;\r\n\r\n          }\r\n          else {\r\n\r\n            // region 2\r\n\r\n            s0 = Math.max(0, -(a01 * segExtent + b0));\r\n            s1 = (s0 > 0) ? segExtent : Math.min(Math.max(-segExtent, -b1), segExtent);\r\n            sqrDist = -s0 * s0 + s1 * (s1 + 2 * b1) + c;\r\n\r\n          }\r\n\r\n        }\r\n\r\n      }\r\n      else {\r\n\r\n        // Ray and segment are parallel.\r\n\r\n        s1 = (a01 > 0) ? -segExtent : segExtent;\r\n        s0 = Math.max(0, -(a01 * s1 + b0));\r\n        sqrDist = -s0 * s0 + s1 * (s1 + 2 * b1) + c;\r\n\r\n      }\r\n\r\n      if (optionalPointOnRay) {\r\n\r\n        optionalPointOnRay.copy(this.direction).multiplyScalar(s0).add(this.origin);\r\n\r\n      }\r\n\r\n      if (optionalPointOnSegment) {\r\n\r\n        optionalPointOnSegment.copy(segDir).multiplyScalar(s1).add(segCenter);\r\n\r\n      }\r\n\r\n      return sqrDist;\r\n\r\n    };\r\n\r\n  }(),\r\n\r\n\r\n  isIntersectionSphere: function(sphere) {\r\n\r\n    return this.distanceToPoint(sphere.center) <= sphere.radius;\r\n\r\n  },\r\n\r\n  intersectSphere: function() {\r\n\r\n    // from http://www.scratchapixel.com/lessons/3d-basic-lessons/lesson-7-intersecting-simple-shapes/ray-sphere-intersection/\r\n\r\n    var v1 = new THREE.Vector3();\r\n\r\n    return function(sphere, optionalTarget) {\r\n\r\n      v1.subVectors(sphere.center, this.origin);\r\n\r\n      var tca = v1.dot(this.direction);\r\n\r\n      var d2 = v1.dot(v1) - tca * tca;\r\n\r\n      var radius2 = sphere.radius * sphere.radius;\r\n\r\n      if (d2 > radius2) return null;\r\n\r\n      var thc = Math.sqrt(radius2 - d2);\r\n\r\n      // t0 = first intersect point - entrance on front of sphere\r\n      var t0 = tca - thc;\r\n\r\n      // t1 = second intersect point - exit point on back of sphere\r\n      var t1 = tca + thc;\r\n\r\n      // test to see if both t0 and t1 are behind the ray - if so, return null\r\n      if (t0 < 0 && t1 < 0) return null;\r\n\r\n      // test to see if t0 is behind the ray:\r\n      // if it is, the ray is inside the sphere, so return the second exit point scaled by t1,\r\n      // in order to always return an intersect point that is in front of the ray.\r\n      if (t0 < 0) return this.at(t1, optionalTarget);\r\n\r\n      // else t0 is in front of the ray, so return the first collision point scaled by t0 \r\n      return this.at(t0, optionalTarget);\r\n\r\n    }\r\n\r\n  }(),\r\n\r\n  isIntersectionPlane: function(plane) {\r\n\r\n    // check if the ray lies on the plane first\r\n\r\n    var distToPoint = plane.distanceToPoint(this.origin);\r\n\r\n    if (distToPoint === 0) {\r\n\r\n      return true;\r\n\r\n    }\r\n\r\n    var denominator = plane.normal.dot(this.direction);\r\n\r\n    if (denominator * distToPoint < 0) {\r\n\r\n      return true;\r\n\r\n    }\r\n\r\n    // ray origin is behind the plane (and is pointing behind it)\r\n\r\n    return false;\r\n\r\n  },\r\n\r\n  distanceToPlane: function(plane) {\r\n\r\n    var denominator = plane.normal.dot(this.direction);\r\n    if (denominator == 0) {\r\n\r\n      // line is coplanar, return origin\r\n      if (plane.distanceToPoint(this.origin) == 0) {\r\n\r\n        return 0;\r\n\r\n      }\r\n\r\n      // Null is preferable to undefined since undefined means.... it is undefined\r\n\r\n      return null;\r\n\r\n    }\r\n\r\n    var t = -(this.origin.dot(plane.normal) + plane.constant) / denominator;\r\n\r\n    // Return if the ray never intersects the plane\r\n\r\n    return t >= 0 ? t : null;\r\n\r\n  },\r\n\r\n  intersectPlane: function(plane, optionalTarget) {\r\n\r\n    var t = this.distanceToPlane(plane);\r\n\r\n    if (t === null) {\r\n\r\n      return null;\r\n    }\r\n\r\n    return this.at(t, optionalTarget);\r\n\r\n  },\r\n\r\n  isIntersectionBox: function() {\r\n\r\n    var v = new THREE.Vector3();\r\n\r\n    return function(box) {\r\n\r\n      return this.intersectBox(box, v) !== null;\r\n\r\n    };\r\n\r\n  }(),\r\n\r\n  intersectBox: function(box, optionalTarget) {\r\n\r\n    // http://www.scratchapixel.com/lessons/3d-basic-lessons/lesson-7-intersecting-simple-shapes/ray-box-intersection/\r\n\r\n    var tmin, tmax, tymin, tymax, tzmin, tzmax;\r\n\r\n    var invdirx = 1 / this.direction.x,\r\n      invdiry = 1 / this.direction.y,\r\n      invdirz = 1 / this.direction.z;\r\n\r\n    var origin = this.origin;\r\n\r\n    if (invdirx >= 0) {\r\n\r\n      tmin = (box.min.x - origin.x) * invdirx;\r\n      tmax = (box.max.x - origin.x) * invdirx;\r\n\r\n    }\r\n    else {\r\n\r\n      tmin = (box.max.x - origin.x) * invdirx;\r\n      tmax = (box.min.x - origin.x) * invdirx;\r\n    }\r\n\r\n    if (invdiry >= 0) {\r\n\r\n      tymin = (box.min.y - origin.y) * invdiry;\r\n      tymax = (box.max.y - origin.y) * invdiry;\r\n\r\n    }\r\n    else {\r\n\r\n      tymin = (box.max.y - origin.y) * invdiry;\r\n      tymax = (box.min.y - origin.y) * invdiry;\r\n    }\r\n\r\n    if ((tmin > tymax) || (tymin > tmax)) return null;\r\n\r\n    // These lines also handle the case where tmin or tmax is NaN\r\n    // (result of 0 * Infinity). x !== x returns true if x is NaN\r\n\r\n    if (tymin > tmin || tmin !== tmin) tmin = tymin;\r\n\r\n    if (tymax < tmax || tmax !== tmax) tmax = tymax;\r\n\r\n    if (invdirz >= 0) {\r\n\r\n      tzmin = (box.min.z - origin.z) * invdirz;\r\n      tzmax = (box.max.z - origin.z) * invdirz;\r\n\r\n    }\r\n    else {\r\n\r\n      tzmin = (box.max.z - origin.z) * invdirz;\r\n      tzmax = (box.min.z - origin.z) * invdirz;\r\n    }\r\n\r\n    if ((tmin > tzmax) || (tzmin > tmax)) return null;\r\n\r\n    if (tzmin > tmin || tmin !== tmin) tmin = tzmin;\r\n\r\n    if (tzmax < tmax || tmax !== tmax) tmax = tzmax;\r\n\r\n    //return point closest to the ray (positive side)\r\n\r\n    if (tmax < 0) return null;\r\n\r\n    return this.at(tmin >= 0 ? tmin : tmax, optionalTarget);\r\n\r\n  },\r\n\r\n  intersectTriangle: function() {\r\n\r\n    // Compute the offset origin, edges, and normal.\r\n    var diff = new THREE.Vector3();\r\n    var edge1 = new THREE.Vector3();\r\n    var edge2 = new THREE.Vector3();\r\n    var normal = new THREE.Vector3();\r\n\r\n    return function(a, b, c, backfaceCulling, optionalTarget) {\r\n\r\n      // from http://www.geometrictools.com/LibMathematics/Intersection/Wm5IntrRay3Triangle3.cpp\r\n\r\n      edge1.subVectors(b, a);\r\n      edge2.subVectors(c, a);\r\n      normal.crossVectors(edge1, edge2);\r\n\r\n      // Solve Q + t*D = b1*E1 + b2*E2 (Q = kDiff, D = ray direction,\r\n      // E1 = kEdge1, E2 = kEdge2, N = Cross(E1,E2)) by\r\n      //   |Dot(D,N)|*b1 = sign(Dot(D,N))*Dot(D,Cross(Q,E2))\r\n      //   |Dot(D,N)|*b2 = sign(Dot(D,N))*Dot(D,Cross(E1,Q))\r\n      //   |Dot(D,N)|*t = -sign(Dot(D,N))*Dot(Q,N)\r\n      var DdN = this.direction.dot(normal);\r\n      var sign;\r\n\r\n      if (DdN > 0) {\r\n\r\n        if (backfaceCulling) return null;\r\n        sign = 1;\r\n\r\n      }\r\n      else if (DdN < 0) {\r\n\r\n        sign = -1;\r\n        DdN = -DdN;\r\n\r\n      }\r\n      else {\r\n\r\n        return null;\r\n\r\n      }\r\n\r\n      diff.subVectors(this.origin, a);\r\n      var DdQxE2 = sign * this.direction.dot(edge2.crossVectors(diff, edge2));\r\n\r\n      // b1 < 0, no intersection\r\n      if (DdQxE2 < 0) {\r\n\r\n        return null;\r\n\r\n      }\r\n\r\n      var DdE1xQ = sign * this.direction.dot(edge1.cross(diff));\r\n\r\n      // b2 < 0, no intersection\r\n      if (DdE1xQ < 0) {\r\n\r\n        return null;\r\n\r\n      }\r\n\r\n      // b1+b2 > 1, no intersection\r\n      if (DdQxE2 + DdE1xQ > DdN) {\r\n\r\n        return null;\r\n\r\n      }\r\n\r\n      // Line intersects triangle, check if ray does.\r\n      var QdN = -sign * diff.dot(normal);\r\n\r\n      // t < 0, no intersection\r\n      if (QdN < 0) {\r\n\r\n        return null;\r\n\r\n      }\r\n\r\n      // Ray intersects triangle.\r\n      return this.at(QdN / DdN, optionalTarget);\r\n\r\n    };\r\n\r\n  }(),\r\n\r\n  applyMatrix4: function(matrix4) {\r\n\r\n    this.direction.add(this.origin).applyMatrix4(matrix4);\r\n    this.origin.applyMatrix4(matrix4);\r\n    this.direction.sub(this.origin);\r\n    this.direction.normalize();\r\n\r\n    return this;\r\n  },\r\n\r\n  equals: function(ray) {\r\n\r\n    return ray.origin.equals(this.origin) && ray.direction.equals(this.direction);\r\n\r\n  },\r\n\r\n  clone: function() {\r\n\r\n    return new THREE.Ray().copy(this);\r\n\r\n  }\r\n\r\n};\r\n\r\n// File:src/math/Sphere.js\r\n\r\n/**\r\n * @author bhouston / http://exocortex.com\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.Sphere = function(center, radius) {\r\n\r\n  this.center = (center !== undefined) ? center : new THREE.Vector3();\r\n  this.radius = (radius !== undefined) ? radius : 0;\r\n\r\n};\r\n\r\nTHREE.Sphere.prototype = {\r\n\r\n  constructor: THREE.Sphere,\r\n\r\n  set: function(center, radius) {\r\n\r\n    this.center.copy(center);\r\n    this.radius = radius;\r\n\r\n    return this;\r\n  },\r\n\r\n  setFromPoints: function() {\r\n\r\n    var box = new THREE.Box3();\r\n\r\n    return function(points, optionalCenter) {\r\n\r\n      var center = this.center;\r\n\r\n      if (optionalCenter !== undefined) {\r\n\r\n        center.copy(optionalCenter);\r\n\r\n      }\r\n      else {\r\n\r\n        box.setFromPoints(points).center(center);\r\n\r\n      }\r\n\r\n      var maxRadiusSq = 0;\r\n\r\n      for (var i = 0, il = points.length; i < il; i++) {\r\n\r\n        maxRadiusSq = Math.max(maxRadiusSq, center.distanceToSquared(points[i]));\r\n\r\n      }\r\n\r\n      this.radius = Math.sqrt(maxRadiusSq);\r\n\r\n      return this;\r\n\r\n    };\r\n\r\n  }(),\r\n\r\n  copy: function(sphere) {\r\n\r\n    this.center.copy(sphere.center);\r\n    this.radius = sphere.radius;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  empty: function() {\r\n\r\n    return (this.radius <= 0);\r\n\r\n  },\r\n\r\n  containsPoint: function(point) {\r\n\r\n    return (point.distanceToSquared(this.center) <= (this.radius * this.radius));\r\n\r\n  },\r\n\r\n  distanceToPoint: function(point) {\r\n\r\n    return (point.distanceTo(this.center) - this.radius);\r\n\r\n  },\r\n\r\n  intersectsSphere: function(sphere) {\r\n\r\n    var radiusSum = this.radius + sphere.radius;\r\n\r\n    return sphere.center.distanceToSquared(this.center) <= (radiusSum * radiusSum);\r\n\r\n  },\r\n\r\n  clampPoint: function(point, optionalTarget) {\r\n\r\n    var deltaLengthSq = this.center.distanceToSquared(point);\r\n\r\n    var result = optionalTarget || new THREE.Vector3();\r\n    result.copy(point);\r\n\r\n    if (deltaLengthSq > (this.radius * this.radius)) {\r\n\r\n      result.sub(this.center).normalize();\r\n      result.multiplyScalar(this.radius).add(this.center);\r\n\r\n    }\r\n\r\n    return result;\r\n\r\n  },\r\n\r\n  getBoundingBox: function(optionalTarget) {\r\n\r\n    var box = optionalTarget || new THREE.Box3();\r\n\r\n    box.set(this.center, this.center);\r\n    box.expandByScalar(this.radius);\r\n\r\n    return box;\r\n\r\n  },\r\n\r\n  applyMatrix4: function(matrix) {\r\n\r\n    this.center.applyMatrix4(matrix);\r\n    this.radius = this.radius * matrix.getMaxScaleOnAxis();\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  translate: function(offset) {\r\n\r\n    this.center.add(offset);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  equals: function(sphere) {\r\n\r\n    return sphere.center.equals(this.center) && (sphere.radius === this.radius);\r\n\r\n  },\r\n\r\n  clone: function() {\r\n\r\n    return new THREE.Sphere().copy(this);\r\n\r\n  }\r\n\r\n};\r\n\r\n// File:src/math/Frustum.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author alteredq / http://alteredqualia.com/\r\n * @author bhouston / http://exocortex.com\r\n */\r\n\r\nTHREE.Frustum = function(p0, p1, p2, p3, p4, p5) {\r\n\r\n  this.planes = [\r\n\r\n    (p0 !== undefined) ? p0 : new THREE.Plane(), (p1 !== undefined) ? p1 : new THREE.Plane(), (p2 !== undefined) ? p2 : new THREE.Plane(), (p3 !== undefined) ? p3 : new THREE.Plane(), (p4 !== undefined) ? p4 : new THREE.Plane(), (p5 !== undefined) ? p5 : new THREE.Plane()\r\n\r\n  ];\r\n\r\n};\r\n\r\nTHREE.Frustum.prototype = {\r\n\r\n  constructor: THREE.Frustum,\r\n\r\n  set: function(p0, p1, p2, p3, p4, p5) {\r\n\r\n    var planes = this.planes;\r\n\r\n    planes[0].copy(p0);\r\n    planes[1].copy(p1);\r\n    planes[2].copy(p2);\r\n    planes[3].copy(p3);\r\n    planes[4].copy(p4);\r\n    planes[5].copy(p5);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  copy: function(frustum) {\r\n\r\n    var planes = this.planes;\r\n\r\n    for (var i = 0; i < 6; i++) {\r\n\r\n      planes[i].copy(frustum.planes[i]);\r\n\r\n    }\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  setFromMatrix: function(m) {\r\n\r\n    var planes = this.planes;\r\n    var me = m.elements;\r\n    var me0 = me[0],\r\n      me1 = me[1],\r\n      me2 = me[2],\r\n      me3 = me[3];\r\n    var me4 = me[4],\r\n      me5 = me[5],\r\n      me6 = me[6],\r\n      me7 = me[7];\r\n    var me8 = me[8],\r\n      me9 = me[9],\r\n      me10 = me[10],\r\n      me11 = me[11];\r\n    var me12 = me[12],\r\n      me13 = me[13],\r\n      me14 = me[14],\r\n      me15 = me[15];\r\n\r\n    planes[0].setComponents(me3 - me0, me7 - me4, me11 - me8, me15 - me12).normalize();\r\n    planes[1].setComponents(me3 + me0, me7 + me4, me11 + me8, me15 + me12).normalize();\r\n    planes[2].setComponents(me3 + me1, me7 + me5, me11 + me9, me15 + me13).normalize();\r\n    planes[3].setComponents(me3 - me1, me7 - me5, me11 - me9, me15 - me13).normalize();\r\n    planes[4].setComponents(me3 - me2, me7 - me6, me11 - me10, me15 - me14).normalize();\r\n    planes[5].setComponents(me3 + me2, me7 + me6, me11 + me10, me15 + me14).normalize();\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  intersectsObject: function() {\r\n\r\n    var sphere = new THREE.Sphere();\r\n\r\n    return function(object) {\r\n\r\n      var geometry = object.geometry;\r\n\r\n      if (geometry.boundingSphere === null) geometry.computeBoundingSphere();\r\n\r\n      sphere.copy(geometry.boundingSphere);\r\n      sphere.applyMatrix4(object.matrixWorld);\r\n\r\n      return this.intersectsSphere(sphere);\r\n\r\n    };\r\n\r\n  }(),\r\n\r\n  intersectsSphere: function(sphere) {\r\n\r\n    var planes = this.planes;\r\n    var center = sphere.center;\r\n    var negRadius = -sphere.radius;\r\n\r\n    for (var i = 0; i < 6; i++) {\r\n\r\n      var distance = planes[i].distanceToPoint(center);\r\n\r\n      if (distance < negRadius) {\r\n\r\n        return false;\r\n\r\n      }\r\n\r\n    }\r\n\r\n    return true;\r\n\r\n  },\r\n\r\n  intersectsBox: function() {\r\n\r\n    var p1 = new THREE.Vector3(),\r\n      p2 = new THREE.Vector3();\r\n\r\n    return function(box) {\r\n\r\n      var planes = this.planes;\r\n\r\n      for (var i = 0; i < 6; i++) {\r\n\r\n        var plane = planes[i];\r\n\r\n        p1.x = plane.normal.x > 0 ? box.min.x : box.max.x;\r\n        p2.x = plane.normal.x > 0 ? box.max.x : box.min.x;\r\n        p1.y = plane.normal.y > 0 ? box.min.y : box.max.y;\r\n        p2.y = plane.normal.y > 0 ? box.max.y : box.min.y;\r\n        p1.z = plane.normal.z > 0 ? box.min.z : box.max.z;\r\n        p2.z = plane.normal.z > 0 ? box.max.z : box.min.z;\r\n\r\n        var d1 = plane.distanceToPoint(p1);\r\n        var d2 = plane.distanceToPoint(p2);\r\n\r\n        // if both outside plane, no intersection\r\n\r\n        if (d1 < 0 && d2 < 0) {\r\n\r\n          return false;\r\n\r\n        }\r\n      }\r\n\r\n      return true;\r\n    };\r\n\r\n  }(),\r\n\r\n\r\n  containsPoint: function(point) {\r\n\r\n    var planes = this.planes;\r\n\r\n    for (var i = 0; i < 6; i++) {\r\n\r\n      if (planes[i].distanceToPoint(point) < 0) {\r\n\r\n        return false;\r\n\r\n      }\r\n\r\n    }\r\n\r\n    return true;\r\n\r\n  },\r\n\r\n  clone: function() {\r\n\r\n    return new THREE.Frustum().copy(this);\r\n\r\n  }\r\n\r\n};\r\n\r\n// File:src/math/Plane.js\r\n\r\n/**\r\n * @author bhouston / http://exocortex.com\r\n */\r\n\r\nTHREE.Plane = function(normal, constant) {\r\n\r\n  this.normal = (normal !== undefined) ? normal : new THREE.Vector3(1, 0, 0);\r\n  this.constant = (constant !== undefined) ? constant : 0;\r\n\r\n};\r\n\r\nTHREE.Plane.prototype = {\r\n\r\n  constructor: THREE.Plane,\r\n\r\n  set: function(normal, constant) {\r\n\r\n    this.normal.copy(normal);\r\n    this.constant = constant;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  setComponents: function(x, y, z, w) {\r\n\r\n    this.normal.set(x, y, z);\r\n    this.constant = w;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  setFromNormalAndCoplanarPoint: function(normal, point) {\r\n\r\n    this.normal.copy(normal);\r\n    this.constant = -point.dot(this.normal); // must be this.normal, not normal, as this.normal is normalized\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  setFromCoplanarPoints: function() {\r\n\r\n    var v1 = new THREE.Vector3();\r\n    var v2 = new THREE.Vector3();\r\n\r\n    return function(a, b, c) {\r\n\r\n      var normal = v1.subVectors(c, b).cross(v2.subVectors(a, b)).normalize();\r\n\r\n      // Q: should an error be thrown if normal is zero (e.g. degenerate plane)?\r\n\r\n      this.setFromNormalAndCoplanarPoint(normal, a);\r\n\r\n      return this;\r\n\r\n    };\r\n\r\n  }(),\r\n\r\n\r\n  copy: function(plane) {\r\n\r\n    this.normal.copy(plane.normal);\r\n    this.constant = plane.constant;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  normalize: function() {\r\n\r\n    // Note: will lead to a divide by zero if the plane is invalid.\r\n\r\n    var inverseNormalLength = 1.0 / this.normal.length();\r\n    this.normal.multiplyScalar(inverseNormalLength);\r\n    this.constant *= inverseNormalLength;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  negate: function() {\r\n\r\n    this.constant *= -1;\r\n    this.normal.negate();\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  distanceToPoint: function(point) {\r\n\r\n    return this.normal.dot(point) + this.constant;\r\n\r\n  },\r\n\r\n  distanceToSphere: function(sphere) {\r\n\r\n    return this.distanceToPoint(sphere.center) - sphere.radius;\r\n\r\n  },\r\n\r\n  projectPoint: function(point, optionalTarget) {\r\n\r\n    return this.orthoPoint(point, optionalTarget).sub(point).negate();\r\n\r\n  },\r\n\r\n  orthoPoint: function(point, optionalTarget) {\r\n\r\n    var perpendicularMagnitude = this.distanceToPoint(point);\r\n\r\n    var result = optionalTarget || new THREE.Vector3();\r\n    return result.copy(this.normal).multiplyScalar(perpendicularMagnitude);\r\n\r\n  },\r\n\r\n  isIntersectionLine: function(line) {\r\n\r\n    // Note: this tests if a line intersects the plane, not whether it (or its end-points) are coplanar with it.\r\n\r\n    var startSign = this.distanceToPoint(line.start);\r\n    var endSign = this.distanceToPoint(line.end);\r\n\r\n    return (startSign < 0 && endSign > 0) || (endSign < 0 && startSign > 0);\r\n\r\n  },\r\n\r\n  intersectLine: function() {\r\n\r\n    var v1 = new THREE.Vector3();\r\n\r\n    return function(line, optionalTarget) {\r\n\r\n      var result = optionalTarget || new THREE.Vector3();\r\n\r\n      var direction = line.delta(v1);\r\n\r\n      var denominator = this.normal.dot(direction);\r\n\r\n      if (denominator == 0) {\r\n\r\n        // line is coplanar, return origin\r\n        if (this.distanceToPoint(line.start) == 0) {\r\n\r\n          return result.copy(line.start);\r\n\r\n        }\r\n\r\n        // Unsure if this is the correct method to handle this case.\r\n        return undefined;\r\n\r\n      }\r\n\r\n      var t = -(line.start.dot(this.normal) + this.constant) / denominator;\r\n\r\n      if (t < 0 || t > 1) {\r\n\r\n        return undefined;\r\n\r\n      }\r\n\r\n      return result.copy(direction).multiplyScalar(t).add(line.start);\r\n\r\n    };\r\n\r\n  }(),\r\n\r\n\r\n  coplanarPoint: function(optionalTarget) {\r\n\r\n    var result = optionalTarget || new THREE.Vector3();\r\n    return result.copy(this.normal).multiplyScalar(-this.constant);\r\n\r\n  },\r\n\r\n  applyMatrix4: function() {\r\n\r\n    var v1 = new THREE.Vector3();\r\n    var v2 = new THREE.Vector3();\r\n    var m1 = new THREE.Matrix3();\r\n\r\n    return function(matrix, optionalNormalMatrix) {\r\n\r\n      // compute new normal based on theory here:\r\n      // http://www.songho.ca/opengl/gl_normaltransform.html\r\n      var normalMatrix = optionalNormalMatrix || m1.getNormalMatrix(matrix);\r\n      var newNormal = v1.copy(this.normal).applyMatrix3(normalMatrix);\r\n\r\n      var newCoplanarPoint = this.coplanarPoint(v2);\r\n      newCoplanarPoint.applyMatrix4(matrix);\r\n\r\n      this.setFromNormalAndCoplanarPoint(newNormal, newCoplanarPoint);\r\n\r\n      return this;\r\n\r\n    };\r\n\r\n  }(),\r\n\r\n  translate: function(offset) {\r\n\r\n    this.constant = this.constant - offset.dot(this.normal);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  equals: function(plane) {\r\n\r\n    return plane.normal.equals(this.normal) && (plane.constant == this.constant);\r\n\r\n  },\r\n\r\n  clone: function() {\r\n\r\n    return new THREE.Plane().copy(this);\r\n\r\n  }\r\n\r\n};\r\n\r\n// File:src/math/Math.js\r\n\r\n/**\r\n * @author alteredq / http://alteredqualia.com/\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.Math = {\r\n\r\n  generateUUID: function() {\r\n\r\n    // http://www.broofa.com/Tools/Math.uuid.htm\r\n\r\n    var chars = '0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz'.split('');\r\n    var uuid = new Array(36);\r\n    var rnd = 0,\r\n      r;\r\n\r\n    return function() {\r\n\r\n      for (var i = 0; i < 36; i++) {\r\n\r\n        if (i == 8 || i == 13 || i == 18 || i == 23) {\r\n\r\n          uuid[i] = '-';\r\n\r\n        }\r\n        else if (i == 14) {\r\n\r\n          uuid[i] = '4';\r\n\r\n        }\r\n        else {\r\n\r\n          if (rnd <= 0x02) rnd = 0x2000000 + (Math.random() * 0x1000000) | 0;\r\n          r = rnd & 0xf;\r\n          rnd = rnd >> 4;\r\n          uuid[i] = chars[(i == 19) ? (r & 0x3) | 0x8 : r];\r\n\r\n        }\r\n      }\r\n\r\n      return uuid.join('');\r\n\r\n    };\r\n\r\n  }(),\r\n\r\n  // Clamp value to range <a, b>\r\n\r\n  clamp: function(x, a, b) {\r\n\r\n    return (x < a) ? a : ((x > b) ? b : x);\r\n\r\n  },\r\n\r\n  // Clamp value to range <a, inf)\r\n\r\n  clampBottom: function(x, a) {\r\n\r\n    return x < a ? a : x;\r\n\r\n  },\r\n\r\n  // Linear mapping from range <a1, a2> to range <b1, b2>\r\n\r\n  mapLinear: function(x, a1, a2, b1, b2) {\r\n\r\n    return b1 + (x - a1) * (b2 - b1) / (a2 - a1);\r\n\r\n  },\r\n\r\n  // http://en.wikipedia.org/wiki/Smoothstep\r\n\r\n  smoothstep: function(x, min, max) {\r\n\r\n    if (x <= min) return 0;\r\n    if (x >= max) return 1;\r\n\r\n    x = (x - min) / (max - min);\r\n\r\n    return x * x * (3 - 2 * x);\r\n\r\n  },\r\n\r\n  smootherstep: function(x, min, max) {\r\n\r\n    if (x <= min) return 0;\r\n    if (x >= max) return 1;\r\n\r\n    x = (x - min) / (max - min);\r\n\r\n    return x * x * x * (x * (x * 6 - 15) + 10);\r\n\r\n  },\r\n\r\n  // Random float from <0, 1> with 16 bits of randomness\r\n  // (standard Math.random() creates repetitive patterns when applied over larger space)\r\n\r\n  random16: function() {\r\n\r\n    return (65280 * Math.random() + 255 * Math.random()) / 65535;\r\n\r\n  },\r\n\r\n  // Random integer from <low, high> interval\r\n\r\n  randInt: function(low, high) {\r\n\r\n    return Math.floor(this.randFloat(low, high));\r\n\r\n  },\r\n\r\n  // Random float from <low, high> interval\r\n\r\n  randFloat: function(low, high) {\r\n\r\n    return low + Math.random() * (high - low);\r\n\r\n  },\r\n\r\n  // Random float from <-range/2, range/2> interval\r\n\r\n  randFloatSpread: function(range) {\r\n\r\n    return range * (0.5 - Math.random());\r\n\r\n  },\r\n\r\n  degToRad: function() {\r\n\r\n    var degreeToRadiansFactor = Math.PI / 180;\r\n\r\n    return function(degrees) {\r\n\r\n      return degrees * degreeToRadiansFactor;\r\n\r\n    };\r\n\r\n  }(),\r\n\r\n  radToDeg: function() {\r\n\r\n    var radianToDegreesFactor = 180 / Math.PI;\r\n\r\n    return function(radians) {\r\n\r\n      return radians * radianToDegreesFactor;\r\n\r\n    };\r\n\r\n  }(),\r\n\r\n  isPowerOfTwo: function(value) {\r\n\r\n    return (value & (value - 1)) === 0 && value !== 0;\r\n\r\n  },\r\n\r\n  nextPowerOfTwo: function(value) {\r\n\r\n    value--;\r\n    value |= value >> 1;\r\n    value |= value >> 2;\r\n    value |= value >> 4;\r\n    value |= value >> 8;\r\n    value |= value >> 16;\r\n    value++;\r\n\r\n    return value;\r\n\r\n  }\r\n\r\n};\r\n\r\n// File:src/math/Spline.js\r\n\r\n/**\r\n * Spline from Tween.js, slightly optimized (and trashed)\r\n * http://sole.github.com/tween.js/examples/05_spline.html\r\n *\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author alteredq / http://alteredqualia.com/\r\n */\r\n\r\nTHREE.Spline = function(points) {\r\n\r\n  this.points = points;\r\n\r\n  var c = [],\r\n    v3 = {\r\n      x: 0,\r\n      y: 0,\r\n      z: 0\r\n    },\r\n    point, intPoint, weight, w2, w3,\r\n    pa, pb, pc, pd;\r\n\r\n  this.initFromArray = function(a) {\r\n\r\n    this.points = [];\r\n\r\n    for (var i = 0; i < a.length; i++) {\r\n\r\n      this.points[i] = {\r\n        x: a[i][0],\r\n        y: a[i][1],\r\n        z: a[i][2]\r\n      };\r\n\r\n    }\r\n\r\n  };\r\n\r\n  this.getPoint = function(k) {\r\n\r\n    point = (this.points.length - 1) * k;\r\n    intPoint = Math.floor(point);\r\n    weight = point - intPoint;\r\n\r\n    c[0] = intPoint === 0 ? intPoint : intPoint - 1;\r\n    c[1] = intPoint;\r\n    c[2] = intPoint > this.points.length - 2 ? this.points.length - 1 : intPoint + 1;\r\n    c[3] = intPoint > this.points.length - 3 ? this.points.length - 1 : intPoint + 2;\r\n\r\n    pa = this.points[c[0]];\r\n    pb = this.points[c[1]];\r\n    pc = this.points[c[2]];\r\n    pd = this.points[c[3]];\r\n\r\n    w2 = weight * weight;\r\n    w3 = weight * w2;\r\n\r\n    v3.x = interpolate(pa.x, pb.x, pc.x, pd.x, weight, w2, w3);\r\n    v3.y = interpolate(pa.y, pb.y, pc.y, pd.y, weight, w2, w3);\r\n    v3.z = interpolate(pa.z, pb.z, pc.z, pd.z, weight, w2, w3);\r\n\r\n    return v3;\r\n\r\n  };\r\n\r\n  this.getControlPointsArray = function() {\r\n\r\n    var i, p, l = this.points.length,\r\n      coords = [];\r\n\r\n    for (i = 0; i < l; i++) {\r\n\r\n      p = this.points[i];\r\n      coords[i] = [p.x, p.y, p.z];\r\n\r\n    }\r\n\r\n    return coords;\r\n\r\n  };\r\n\r\n  // approximate length by summing linear segments\r\n\r\n  this.getLength = function(nSubDivisions) {\r\n\r\n    var i, index, nSamples, position,\r\n      point = 0,\r\n      intPoint = 0,\r\n      oldIntPoint = 0,\r\n      oldPosition = new THREE.Vector3(),\r\n      tmpVec = new THREE.Vector3(),\r\n      chunkLengths = [],\r\n      totalLength = 0;\r\n\r\n    // first point has 0 length\r\n\r\n    chunkLengths[0] = 0;\r\n\r\n    if (!nSubDivisions) nSubDivisions = 100;\r\n\r\n    nSamples = this.points.length * nSubDivisions;\r\n\r\n    oldPosition.copy(this.points[0]);\r\n\r\n    for (i = 1; i < nSamples; i++) {\r\n\r\n      index = i / nSamples;\r\n\r\n      position = this.getPoint(index);\r\n      tmpVec.copy(position);\r\n\r\n      totalLength += tmpVec.distanceTo(oldPosition);\r\n\r\n      oldPosition.copy(position);\r\n\r\n      point = (this.points.length - 1) * index;\r\n      intPoint = Math.floor(point);\r\n\r\n      if (intPoint != oldIntPoint) {\r\n\r\n        chunkLengths[intPoint] = totalLength;\r\n        oldIntPoint = intPoint;\r\n\r\n      }\r\n\r\n    }\r\n\r\n    // last point ends with total length\r\n\r\n    chunkLengths[chunkLengths.length] = totalLength;\r\n\r\n    return {\r\n      chunks: chunkLengths,\r\n      total: totalLength\r\n    };\r\n\r\n  };\r\n\r\n  this.reparametrizeByArcLength = function(samplingCoef) {\r\n\r\n    var i, j,\r\n      index, indexCurrent, indexNext,\r\n      realDistance,\r\n      sampling, position,\r\n      newpoints = [],\r\n      tmpVec = new THREE.Vector3(),\r\n      sl = this.getLength();\r\n\r\n    newpoints.push(tmpVec.copy(this.points[0]).clone());\r\n\r\n    for (i = 1; i < this.points.length; i++) {\r\n\r\n      //tmpVec.copy( this.points[ i - 1 ] );\r\n      //linearDistance = tmpVec.distanceTo( this.points[ i ] );\r\n\r\n      realDistance = sl.chunks[i] - sl.chunks[i - 1];\r\n\r\n      sampling = Math.ceil(samplingCoef * realDistance / sl.total);\r\n\r\n      indexCurrent = (i - 1) / (this.points.length - 1);\r\n      indexNext = i / (this.points.length - 1);\r\n\r\n      for (j = 1; j < sampling - 1; j++) {\r\n\r\n        index = indexCurrent + j * (1 / sampling) * (indexNext - indexCurrent);\r\n\r\n        position = this.getPoint(index);\r\n        newpoints.push(tmpVec.copy(position).clone());\r\n\r\n      }\r\n\r\n      newpoints.push(tmpVec.copy(this.points[i]).clone());\r\n\r\n    }\r\n\r\n    this.points = newpoints;\r\n\r\n  };\r\n\r\n  // Catmull-Rom\r\n\r\n  function interpolate(p0, p1, p2, p3, t, t2, t3) {\r\n\r\n    var v0 = (p2 - p0) * 0.5,\r\n      v1 = (p3 - p1) * 0.5;\r\n\r\n    return (2 * (p1 - p2) + v0 + v1) * t3 + (-3 * (p1 - p2) - 2 * v0 - v1) * t2 + v0 * t + p1;\r\n\r\n  };\r\n\r\n};\r\n\r\n// File:src/math/Triangle.js\r\n\r\n/**\r\n * @author bhouston / http://exocortex.com\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.Triangle = function(a, b, c) {\r\n\r\n  this.a = (a !== undefined) ? a : new THREE.Vector3();\r\n  this.b = (b !== undefined) ? b : new THREE.Vector3();\r\n  this.c = (c !== undefined) ? c : new THREE.Vector3();\r\n\r\n};\r\n\r\nTHREE.Triangle.normal = function() {\r\n\r\n  var v0 = new THREE.Vector3();\r\n\r\n  return function(a, b, c, optionalTarget) {\r\n\r\n    var result = optionalTarget || new THREE.Vector3();\r\n\r\n    result.subVectors(c, b);\r\n    v0.subVectors(a, b);\r\n    result.cross(v0);\r\n\r\n    var resultLengthSq = result.lengthSq();\r\n    if (resultLengthSq > 0) {\r\n\r\n      return result.multiplyScalar(1 / Math.sqrt(resultLengthSq));\r\n\r\n    }\r\n\r\n    return result.set(0, 0, 0);\r\n\r\n  };\r\n\r\n}();\r\n\r\n// static/instance method to calculate barycoordinates\r\n// based on: http://www.blackpawn.com/texts/pointinpoly/default.html\r\nTHREE.Triangle.barycoordFromPoint = function() {\r\n\r\n  var v0 = new THREE.Vector3();\r\n  var v1 = new THREE.Vector3();\r\n  var v2 = new THREE.Vector3();\r\n\r\n  return function(point, a, b, c, optionalTarget) {\r\n\r\n    v0.subVectors(c, a);\r\n    v1.subVectors(b, a);\r\n    v2.subVectors(point, a);\r\n\r\n    var dot00 = v0.dot(v0);\r\n    var dot01 = v0.dot(v1);\r\n    var dot02 = v0.dot(v2);\r\n    var dot11 = v1.dot(v1);\r\n    var dot12 = v1.dot(v2);\r\n\r\n    var denom = (dot00 * dot11 - dot01 * dot01);\r\n\r\n    var result = optionalTarget || new THREE.Vector3();\r\n\r\n    // colinear or singular triangle\r\n    if (denom == 0) {\r\n      // arbitrary location outside of triangle?\r\n      // not sure if this is the best idea, maybe should be returning undefined\r\n      return result.set(-2, -1, -1);\r\n    }\r\n\r\n    var invDenom = 1 / denom;\r\n    var u = (dot11 * dot02 - dot01 * dot12) * invDenom;\r\n    var v = (dot00 * dot12 - dot01 * dot02) * invDenom;\r\n\r\n    // barycoordinates must always sum to 1\r\n    return result.set(1 - u - v, v, u);\r\n\r\n  };\r\n\r\n}();\r\n\r\nTHREE.Triangle.containsPoint = function() {\r\n\r\n  var v1 = new THREE.Vector3();\r\n\r\n  return function(point, a, b, c) {\r\n\r\n    var result = THREE.Triangle.barycoordFromPoint(point, a, b, c, v1);\r\n\r\n    return (result.x >= 0) && (result.y >= 0) && ((result.x + result.y) <= 1);\r\n\r\n  };\r\n\r\n}();\r\n\r\nTHREE.Triangle.prototype = {\r\n\r\n  constructor: THREE.Triangle,\r\n\r\n  set: function(a, b, c) {\r\n\r\n    this.a.copy(a);\r\n    this.b.copy(b);\r\n    this.c.copy(c);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  setFromPointsAndIndices: function(points, i0, i1, i2) {\r\n\r\n    this.a.copy(points[i0]);\r\n    this.b.copy(points[i1]);\r\n    this.c.copy(points[i2]);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  copy: function(triangle) {\r\n\r\n    this.a.copy(triangle.a);\r\n    this.b.copy(triangle.b);\r\n    this.c.copy(triangle.c);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  area: function() {\r\n\r\n    var v0 = new THREE.Vector3();\r\n    var v1 = new THREE.Vector3();\r\n\r\n    return function() {\r\n\r\n      v0.subVectors(this.c, this.b);\r\n      v1.subVectors(this.a, this.b);\r\n\r\n      return v0.cross(v1).length() * 0.5;\r\n\r\n    };\r\n\r\n  }(),\r\n\r\n  midpoint: function(optionalTarget) {\r\n\r\n    var result = optionalTarget || new THREE.Vector3();\r\n    return result.addVectors(this.a, this.b).add(this.c).multiplyScalar(1 / 3);\r\n\r\n  },\r\n\r\n  normal: function(optionalTarget) {\r\n\r\n    return THREE.Triangle.normal(this.a, this.b, this.c, optionalTarget);\r\n\r\n  },\r\n\r\n  plane: function(optionalTarget) {\r\n\r\n    var result = optionalTarget || new THREE.Plane();\r\n\r\n    return result.setFromCoplanarPoints(this.a, this.b, this.c);\r\n\r\n  },\r\n\r\n  barycoordFromPoint: function(point, optionalTarget) {\r\n\r\n    return THREE.Triangle.barycoordFromPoint(point, this.a, this.b, this.c, optionalTarget);\r\n\r\n  },\r\n\r\n  containsPoint: function(point) {\r\n\r\n    return THREE.Triangle.containsPoint(point, this.a, this.b, this.c);\r\n\r\n  },\r\n\r\n  equals: function(triangle) {\r\n\r\n    return triangle.a.equals(this.a) && triangle.b.equals(this.b) && triangle.c.equals(this.c);\r\n\r\n  },\r\n\r\n  clone: function() {\r\n\r\n    return new THREE.Triangle().copy(this);\r\n\r\n  }\r\n\r\n};\r\n\r\n// File:src/core/Clock.js\r\n\r\n/**\r\n * @author alteredq / http://alteredqualia.com/\r\n */\r\n\r\nTHREE.Clock = function(autoStart) {\r\n\r\n  this.autoStart = (autoStart !== undefined) ? autoStart : true;\r\n\r\n  this.startTime = 0;\r\n  this.oldTime = 0;\r\n  this.elapsedTime = 0;\r\n\r\n  this.running = false;\r\n\r\n};\r\n\r\nTHREE.Clock.prototype = {\r\n\r\n  constructor: THREE.Clock,\r\n\r\n  start: function() {\r\n\r\n    this.startTime = self.performance !== undefined && self.performance.now !== undefined ? self.performance.now() : Date.now();\r\n\r\n    this.oldTime = this.startTime;\r\n    this.running = true;\r\n  },\r\n\r\n  stop: function() {\r\n\r\n    this.getElapsedTime();\r\n    this.running = false;\r\n\r\n  },\r\n\r\n  getElapsedTime: function() {\r\n\r\n    this.getDelta();\r\n    return this.elapsedTime;\r\n\r\n  },\r\n\r\n  getDelta: function() {\r\n\r\n    var diff = 0;\r\n\r\n    if (this.autoStart && !this.running) {\r\n\r\n      this.start();\r\n\r\n    }\r\n\r\n    if (this.running) {\r\n\r\n      var newTime = self.performance !== undefined && self.performance.now !== undefined ? self.performance.now() : Date.now();\r\n\r\n      diff = 0.001 * (newTime - this.oldTime);\r\n      this.oldTime = newTime;\r\n\r\n      this.elapsedTime += diff;\r\n\r\n    }\r\n\r\n    return diff;\r\n\r\n  }\r\n\r\n};\r\n\r\n// File:src/core/EventDispatcher.js\r\n\r\n/**\r\n * https://github.com/mrdoob/eventdispatcher.js/\r\n */\r\n\r\nTHREE.EventDispatcher = function() {}\r\n\r\nTHREE.EventDispatcher.prototype = {\r\n\r\n  constructor: THREE.EventDispatcher,\r\n\r\n  apply: function(object) {\r\n\r\n    object.addEventListener = THREE.EventDispatcher.prototype.addEventListener;\r\n    object.hasEventListener = THREE.EventDispatcher.prototype.hasEventListener;\r\n    object.removeEventListener = THREE.EventDispatcher.prototype.removeEventListener;\r\n    object.dispatchEvent = THREE.EventDispatcher.prototype.dispatchEvent;\r\n\r\n  },\r\n\r\n  addEventListener: function(type, listener) {\r\n\r\n    if (this._listeners === undefined) this._listeners = {};\r\n\r\n    var listeners = this._listeners;\r\n\r\n    if (listeners[type] === undefined) {\r\n\r\n      listeners[type] = [];\r\n\r\n    }\r\n\r\n    if (listeners[type].indexOf(listener) === -1) {\r\n\r\n      listeners[type].push(listener);\r\n\r\n    }\r\n\r\n  },\r\n\r\n  hasEventListener: function(type, listener) {\r\n\r\n    if (this._listeners === undefined) return false;\r\n\r\n    var listeners = this._listeners;\r\n\r\n    if (listeners[type] !== undefined && listeners[type].indexOf(listener) !== -1) {\r\n\r\n      return true;\r\n\r\n    }\r\n\r\n    return false;\r\n\r\n  },\r\n\r\n  removeEventListener: function(type, listener) {\r\n\r\n    if (this._listeners === undefined) return;\r\n\r\n    var listeners = this._listeners;\r\n    var listenerArray = listeners[type];\r\n\r\n    if (listenerArray !== undefined) {\r\n\r\n      var index = listenerArray.indexOf(listener);\r\n\r\n      if (index !== -1) {\r\n\r\n        listenerArray.splice(index, 1);\r\n\r\n      }\r\n\r\n    }\r\n\r\n  },\r\n\r\n  dispatchEvent: function(event) {\r\n\r\n    if (this._listeners === undefined) return;\r\n\r\n    var listeners = this._listeners;\r\n    var listenerArray = listeners[event.type];\r\n\r\n    if (listenerArray !== undefined) {\r\n\r\n      event.target = this;\r\n\r\n      var array = [];\r\n      var length = listenerArray.length;\r\n\r\n      for (var i = 0; i < length; i++) {\r\n\r\n        array[i] = listenerArray[i];\r\n\r\n      }\r\n\r\n      for (var i = 0; i < length; i++) {\r\n\r\n        array[i].call(this, event);\r\n\r\n      }\r\n\r\n    }\r\n\r\n  }\r\n\r\n};\r\n\r\n// File:src/core/Raycaster.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author bhouston / http://exocortex.com/\r\n * @author stephomi / http://stephaneginier.com/\r\n */\r\n\r\n(function(THREE) {\r\n\r\n  THREE.Raycaster = function(origin, direction, near, far) {\r\n\r\n    this.ray = new THREE.Ray(origin, direction);\r\n    // direction is assumed to be normalized (for accurate distance calculations)\r\n\r\n    this.near = near || 0;\r\n    this.far = far || Infinity;\r\n\r\n    this.params = {\r\n      Sprite: {},\r\n      Mesh: {},\r\n      PointCloud: {\r\n        threshold: 1\r\n      },\r\n      LOD: {},\r\n      Line: {}\r\n    };\r\n\r\n  };\r\n\r\n  var descSort = function(a, b) {\r\n\r\n    return a.distance - b.distance;\r\n\r\n  };\r\n\r\n  var intersectObject = function(object, raycaster, intersects, recursive) {\r\n\r\n    object.raycast(raycaster, intersects);\r\n\r\n    if (recursive === true) {\r\n\r\n      var children = object.children;\r\n\r\n      for (var i = 0, l = children.length; i < l; i++) {\r\n\r\n        intersectObject(children[i], raycaster, intersects, true);\r\n\r\n      }\r\n\r\n    }\r\n\r\n  };\r\n\r\n  //\r\n\r\n  THREE.Raycaster.prototype = {\r\n\r\n    constructor: THREE.Raycaster,\r\n\r\n    precision: 0.0001,\r\n    linePrecision: 1,\r\n\r\n    set: function(origin, direction) {\r\n\r\n      // direction is assumed to be normalized (for accurate distance calculations)\r\n\r\n      this.ray.set(origin, direction);\r\n\r\n    },\r\n\r\n    setFromCamera: function(coords, camera) {\r\n\r\n      // camera is assumed _not_ to be a child of a transformed object\r\n\r\n      if (camera instanceof THREE.PerspectiveCamera) {\r\n\r\n        this.ray.origin.copy(camera.position);\r\n        this.ray.direction.set(coords.x, coords.y, 0.5).unproject(camera).sub(camera.position).normalize();\r\n\r\n      }\r\n      else if (camera instanceof THREE.OrthographicCamera) {\r\n\r\n        this.ray.origin.set(coords.x, coords.y, -1).unproject(camera);\r\n        this.ray.direction.set(0, 0, -1).transformDirection(camera.matrixWorld);\r\n\r\n      }\r\n      else {\r\n\r\n        THREE.error('THREE.Raycaster: Unsupported camera type.');\r\n\r\n      }\r\n\r\n    },\r\n\r\n    intersectObject: function(object, recursive) {\r\n\r\n      var intersects = [];\r\n\r\n      intersectObject(object, this, intersects, recursive);\r\n\r\n      intersects.sort(descSort);\r\n\r\n      return intersects;\r\n\r\n    },\r\n\r\n    intersectObjects: function(objects, recursive) {\r\n\r\n      var intersects = [];\r\n\r\n      if (objects instanceof Array === false) {\r\n\r\n        THREE.warn('THREE.Raycaster.intersectObjects: objects is not an Array.');\r\n        return intersects;\r\n\r\n      }\r\n\r\n      for (var i = 0, l = objects.length; i < l; i++) {\r\n\r\n        intersectObject(objects[i], this, intersects, recursive);\r\n\r\n      }\r\n\r\n      intersects.sort(descSort);\r\n\r\n      return intersects;\r\n\r\n    }\r\n\r\n  };\r\n\r\n}(THREE));\r\n\r\n// File:src/core/Object3D.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author mikael emtinger / http://gomo.se/\r\n * @author alteredq / http://alteredqualia.com/\r\n * @author WestLangley / http://github.com/WestLangley\r\n */\r\n\r\nTHREE.Object3D = function() {\r\n\r\n  Object.defineProperty(this, 'id', {\r\n    value: THREE.Object3DIdCount++\r\n  });\r\n\r\n  this.uuid = THREE.Math.generateUUID();\r\n\r\n  this.name = '';\r\n  this.type = 'Object3D';\r\n\r\n  this.parent = undefined;\r\n  this.children = [];\r\n\r\n  this.up = THREE.Object3D.DefaultUp.clone();\r\n\r\n  var position = new THREE.Vector3();\r\n  var rotation = new THREE.Euler();\r\n  var quaternion = new THREE.Quaternion();\r\n  var scale = new THREE.Vector3(1, 1, 1);\r\n\r\n  var onRotationChange = function() {\r\n    quaternion.setFromEuler(rotation, false);\r\n  };\r\n\r\n  var onQuaternionChange = function() {\r\n    rotation.setFromQuaternion(quaternion, undefined, false);\r\n  };\r\n\r\n  rotation.onChange(onRotationChange);\r\n  quaternion.onChange(onQuaternionChange);\r\n\r\n  Object.defineProperties(this, {\r\n    position: {\r\n      enumerable: true,\r\n      value: position\r\n    },\r\n    rotation: {\r\n      enumerable: true,\r\n      value: rotation\r\n    },\r\n    quaternion: {\r\n      enumerable: true,\r\n      value: quaternion\r\n    },\r\n    scale: {\r\n      enumerable: true,\r\n      value: scale\r\n    }\r\n  });\r\n\r\n  this.rotationAutoUpdate = true;\r\n\r\n  this.matrix = new THREE.Matrix4();\r\n  this.matrixWorld = new THREE.Matrix4();\r\n\r\n  this.matrixAutoUpdate = true;\r\n  this.matrixWorldNeedsUpdate = false;\r\n\r\n  this.visible = true;\r\n\r\n  this.castShadow = false;\r\n  this.receiveShadow = false;\r\n\r\n  this.frustumCulled = true;\r\n  this.renderOrder = 0;\r\n\r\n  this.userData = {};\r\n\r\n};\r\n\r\nTHREE.Object3D.DefaultUp = new THREE.Vector3(0, 1, 0);\r\n\r\nTHREE.Object3D.prototype = {\r\n\r\n  constructor: THREE.Object3D,\r\n\r\n  get eulerOrder() {\r\n\r\n    THREE.warn('THREE.Object3D: .eulerOrder has been moved to .rotation.order.');\r\n\r\n    return this.rotation.order;\r\n\r\n  },\r\n\r\n  set eulerOrder(value) {\r\n\r\n    THREE.warn('THREE.Object3D: .eulerOrder has been moved to .rotation.order.');\r\n\r\n    this.rotation.order = value;\r\n\r\n  },\r\n\r\n  get useQuaternion() {\r\n\r\n    THREE.warn('THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.');\r\n\r\n  },\r\n\r\n  set useQuaternion(value) {\r\n\r\n    THREE.warn('THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.');\r\n\r\n  },\r\n\r\n  applyMatrix: function(matrix) {\r\n\r\n    this.matrix.multiplyMatrices(matrix, this.matrix);\r\n\r\n    this.matrix.decompose(this.position, this.quaternion, this.scale);\r\n\r\n  },\r\n\r\n  setRotationFromAxisAngle: function(axis, angle) {\r\n\r\n    // assumes axis is normalized\r\n\r\n    this.quaternion.setFromAxisAngle(axis, angle);\r\n\r\n  },\r\n\r\n  setRotationFromEuler: function(euler) {\r\n\r\n    this.quaternion.setFromEuler(euler, true);\r\n\r\n  },\r\n\r\n  setRotationFromMatrix: function(m) {\r\n\r\n    // assumes the upper 3x3 of m is a pure rotation matrix (i.e, unscaled)\r\n\r\n    this.quaternion.setFromRotationMatrix(m);\r\n\r\n  },\r\n\r\n  setRotationFromQuaternion: function(q) {\r\n\r\n    // assumes q is normalized\r\n\r\n    this.quaternion.copy(q);\r\n\r\n  },\r\n\r\n  rotateOnAxis: function() {\r\n\r\n    // rotate object on axis in object space\r\n    // axis is assumed to be normalized\r\n\r\n    var q1 = new THREE.Quaternion();\r\n\r\n    return function(axis, angle) {\r\n\r\n      q1.setFromAxisAngle(axis, angle);\r\n\r\n      this.quaternion.multiply(q1);\r\n\r\n      return this;\r\n\r\n    }\r\n\r\n  }(),\r\n\r\n  rotateX: function() {\r\n\r\n    var v1 = new THREE.Vector3(1, 0, 0);\r\n\r\n    return function(angle) {\r\n\r\n      return this.rotateOnAxis(v1, angle);\r\n\r\n    };\r\n\r\n  }(),\r\n\r\n  rotateY: function() {\r\n\r\n    var v1 = new THREE.Vector3(0, 1, 0);\r\n\r\n    return function(angle) {\r\n\r\n      return this.rotateOnAxis(v1, angle);\r\n\r\n    };\r\n\r\n  }(),\r\n\r\n  rotateZ: function() {\r\n\r\n    var v1 = new THREE.Vector3(0, 0, 1);\r\n\r\n    return function(angle) {\r\n\r\n      return this.rotateOnAxis(v1, angle);\r\n\r\n    };\r\n\r\n  }(),\r\n\r\n  translateOnAxis: function() {\r\n\r\n    // translate object by distance along axis in object space\r\n    // axis is assumed to be normalized\r\n\r\n    var v1 = new THREE.Vector3();\r\n\r\n    return function(axis, distance) {\r\n\r\n      v1.copy(axis).applyQuaternion(this.quaternion);\r\n\r\n      this.position.add(v1.multiplyScalar(distance));\r\n\r\n      return this;\r\n\r\n    }\r\n\r\n  }(),\r\n\r\n  translate: function(distance, axis) {\r\n\r\n    THREE.warn('THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead.');\r\n    return this.translateOnAxis(axis, distance);\r\n\r\n  },\r\n\r\n  translateX: function() {\r\n\r\n    var v1 = new THREE.Vector3(1, 0, 0);\r\n\r\n    return function(distance) {\r\n\r\n      return this.translateOnAxis(v1, distance);\r\n\r\n    };\r\n\r\n  }(),\r\n\r\n  translateY: function() {\r\n\r\n    var v1 = new THREE.Vector3(0, 1, 0);\r\n\r\n    return function(distance) {\r\n\r\n      return this.translateOnAxis(v1, distance);\r\n\r\n    };\r\n\r\n  }(),\r\n\r\n  translateZ: function() {\r\n\r\n    var v1 = new THREE.Vector3(0, 0, 1);\r\n\r\n    return function(distance) {\r\n\r\n      return this.translateOnAxis(v1, distance);\r\n\r\n    };\r\n\r\n  }(),\r\n\r\n  localToWorld: function(vector) {\r\n\r\n    return vector.applyMatrix4(this.matrixWorld);\r\n\r\n  },\r\n\r\n  worldToLocal: function() {\r\n\r\n    var m1 = new THREE.Matrix4();\r\n\r\n    return function(vector) {\r\n\r\n      return vector.applyMatrix4(m1.getInverse(this.matrixWorld));\r\n\r\n    };\r\n\r\n  }(),\r\n\r\n  lookAt: function() {\r\n\r\n    // This routine does not support objects with rotated and/or translated parent(s)\r\n\r\n    var m1 = new THREE.Matrix4();\r\n\r\n    return function(vector) {\r\n\r\n      m1.lookAt(vector, this.position, this.up);\r\n\r\n      this.quaternion.setFromRotationMatrix(m1);\r\n\r\n    };\r\n\r\n  }(),\r\n\r\n  add: function(object) {\r\n\r\n    if (arguments.length > 1) {\r\n\r\n      for (var i = 0; i < arguments.length; i++) {\r\n\r\n        this.add(arguments[i]);\r\n\r\n      }\r\n\r\n      return this;\r\n\r\n    };\r\n\r\n    if (object === this) {\r\n\r\n      THREE.error(\"THREE.Object3D.add: object can't be added as a child of itself.\", object);\r\n      return this;\r\n\r\n    }\r\n\r\n    if (object instanceof THREE.Object3D) {\r\n\r\n      if (object.parent !== undefined) {\r\n\r\n        object.parent.remove(object);\r\n\r\n      }\r\n\r\n      object.parent = this;\r\n      object.dispatchEvent({\r\n        type: 'added'\r\n      });\r\n\r\n      this.children.push(object);\r\n\r\n    }\r\n    else {\r\n\r\n      THREE.error(\"THREE.Object3D.add: object not an instance of THREE.Object3D.\", object);\r\n\r\n    }\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  remove: function(object) {\r\n\r\n    if (arguments.length > 1) {\r\n\r\n      for (var i = 0; i < arguments.length; i++) {\r\n\r\n        this.remove(arguments[i]);\r\n\r\n      }\r\n\r\n    };\r\n\r\n    var index = this.children.indexOf(object);\r\n\r\n    if (index !== -1) {\r\n\r\n      object.parent = undefined;\r\n\r\n      object.dispatchEvent({\r\n        type: 'removed'\r\n      });\r\n\r\n      this.children.splice(index, 1);\r\n\r\n    }\r\n\r\n  },\r\n\r\n  getChildByName: function(name) {\r\n\r\n    THREE.warn('THREE.Object3D: .getChildByName() has been renamed to .getObjectByName().');\r\n    return this.getObjectByName(name);\r\n\r\n  },\r\n\r\n  getObjectById: function(id) {\r\n\r\n    return this.getObjectByProperty('id', id);\r\n\r\n  },\r\n\r\n  getObjectByName: function(name) {\r\n\r\n    return this.getObjectByProperty('name', name);\r\n\r\n  },\r\n\r\n  getObjectByProperty: function(name, value) {\r\n\r\n    if (this[name] === value) return this;\r\n\r\n    for (var i = 0, l = this.children.length; i < l; i++) {\r\n\r\n      var child = this.children[i];\r\n      var object = child.getObjectByProperty(name, value);\r\n\r\n      if (object !== undefined) {\r\n\r\n        return object;\r\n\r\n      }\r\n\r\n    }\r\n\r\n    return undefined;\r\n\r\n  },\r\n\r\n  getWorldPosition: function(optionalTarget) {\r\n\r\n    var result = optionalTarget || new THREE.Vector3();\r\n\r\n    this.updateMatrixWorld(true);\r\n\r\n    return result.setFromMatrixPosition(this.matrixWorld);\r\n\r\n  },\r\n\r\n  getWorldQuaternion: function() {\r\n\r\n    var position = new THREE.Vector3();\r\n    var scale = new THREE.Vector3();\r\n\r\n    return function(optionalTarget) {\r\n\r\n      var result = optionalTarget || new THREE.Quaternion();\r\n\r\n      this.updateMatrixWorld(true);\r\n\r\n      this.matrixWorld.decompose(position, result, scale);\r\n\r\n      return result;\r\n\r\n    }\r\n\r\n  }(),\r\n\r\n  getWorldRotation: function() {\r\n\r\n    var quaternion = new THREE.Quaternion();\r\n\r\n    return function(optionalTarget) {\r\n\r\n      var result = optionalTarget || new THREE.Euler();\r\n\r\n      this.getWorldQuaternion(quaternion);\r\n\r\n      return result.setFromQuaternion(quaternion, this.rotation.order, false);\r\n\r\n    }\r\n\r\n  }(),\r\n\r\n  getWorldScale: function() {\r\n\r\n    var position = new THREE.Vector3();\r\n    var quaternion = new THREE.Quaternion();\r\n\r\n    return function(optionalTarget) {\r\n\r\n      var result = optionalTarget || new THREE.Vector3();\r\n\r\n      this.updateMatrixWorld(true);\r\n\r\n      this.matrixWorld.decompose(position, quaternion, result);\r\n\r\n      return result;\r\n\r\n    }\r\n\r\n  }(),\r\n\r\n  getWorldDirection: function() {\r\n\r\n    var quaternion = new THREE.Quaternion();\r\n\r\n    return function(optionalTarget) {\r\n\r\n      var result = optionalTarget || new THREE.Vector3();\r\n\r\n      this.getWorldQuaternion(quaternion);\r\n\r\n      return result.set(0, 0, 1).applyQuaternion(quaternion);\r\n\r\n    }\r\n\r\n  }(),\r\n\r\n  raycast: function() {},\r\n\r\n  traverse: function(callback) {\r\n\r\n    callback(this);\r\n\r\n    for (var i = 0, l = this.children.length; i < l; i++) {\r\n\r\n      this.children[i].traverse(callback);\r\n\r\n    }\r\n\r\n  },\r\n\r\n  traverseVisible: function(callback) {\r\n\r\n    if (this.visible === false) return;\r\n\r\n    callback(this);\r\n\r\n    for (var i = 0, l = this.children.length; i < l; i++) {\r\n\r\n      this.children[i].traverseVisible(callback);\r\n\r\n    }\r\n\r\n  },\r\n\r\n  traverseAncestors: function(callback) {\r\n\r\n    if (this.parent) {\r\n\r\n      callback(this.parent);\r\n\r\n      this.parent.traverseAncestors(callback);\r\n\r\n    }\r\n\r\n  },\r\n\r\n  updateMatrix: function() {\r\n\r\n    this.matrix.compose(this.position, this.quaternion, this.scale);\r\n\r\n    this.matrixWorldNeedsUpdate = true;\r\n\r\n  },\r\n\r\n  updateMatrixWorld: function(force) {\r\n\r\n    if (this.matrixAutoUpdate === true) this.updateMatrix();\r\n\r\n    if (this.matrixWorldNeedsUpdate === true || force === true) {\r\n\r\n      if (this.parent === undefined) {\r\n\r\n        this.matrixWorld.copy(this.matrix);\r\n\r\n      }\r\n      else {\r\n\r\n        this.matrixWorld.multiplyMatrices(this.parent.matrixWorld, this.matrix);\r\n\r\n      }\r\n\r\n      this.matrixWorldNeedsUpdate = false;\r\n\r\n      force = true;\r\n\r\n    }\r\n\r\n    // update children\r\n\r\n    for (var i = 0, l = this.children.length; i < l; i++) {\r\n\r\n      this.children[i].updateMatrixWorld(force);\r\n\r\n    }\r\n\r\n  },\r\n\r\n  toJSON: function() {\r\n\r\n    var output = {\r\n      metadata: {\r\n        version: 4.3,\r\n        type: 'Object',\r\n        generator: 'ObjectExporter'\r\n      }\r\n    };\r\n\r\n    //\r\n\r\n    var geometries = {};\r\n\r\n    var parseGeometry = function(geometry) {\r\n\r\n      if (output.geometries === undefined) {\r\n\r\n        output.geometries = [];\r\n\r\n      }\r\n\r\n      if (geometries[geometry.uuid] === undefined) {\r\n\r\n        var json = geometry.toJSON();\r\n\r\n        delete json.metadata;\r\n\r\n        geometries[geometry.uuid] = json;\r\n\r\n        output.geometries.push(json);\r\n\r\n      }\r\n\r\n      return geometry.uuid;\r\n\r\n    };\r\n\r\n    //\r\n\r\n    var materials = {};\r\n\r\n    var parseMaterial = function(material) {\r\n\r\n      if (output.materials === undefined) {\r\n\r\n        output.materials = [];\r\n\r\n      }\r\n\r\n      if (materials[material.uuid] === undefined) {\r\n\r\n        var json = material.toJSON();\r\n\r\n        delete json.metadata;\r\n\r\n        materials[material.uuid] = json;\r\n\r\n        output.materials.push(json);\r\n\r\n      }\r\n\r\n      return material.uuid;\r\n\r\n    };\r\n\r\n    //\r\n\r\n    var parseObject = function(object) {\r\n\r\n      var data = {};\r\n\r\n      data.uuid = object.uuid;\r\n      data.type = object.type;\r\n\r\n      if (object.name !== '') data.name = object.name;\r\n      if (JSON.stringify(object.userData) !== '{}') data.userData = object.userData;\r\n      if (object.visible !== true) data.visible = object.visible;\r\n\r\n      if (object instanceof THREE.PerspectiveCamera) {\r\n\r\n        data.fov = object.fov;\r\n        data.aspect = object.aspect;\r\n        data.near = object.near;\r\n        data.far = object.far;\r\n\r\n      }\r\n      else if (object instanceof THREE.OrthographicCamera) {\r\n\r\n        data.left = object.left;\r\n        data.right = object.right;\r\n        data.top = object.top;\r\n        data.bottom = object.bottom;\r\n        data.near = object.near;\r\n        data.far = object.far;\r\n\r\n      }\r\n      else if (object instanceof THREE.AmbientLight) {\r\n\r\n        data.color = object.color.getHex();\r\n\r\n      }\r\n      else if (object instanceof THREE.DirectionalLight) {\r\n\r\n        data.color = object.color.getHex();\r\n        data.intensity = object.intensity;\r\n\r\n      }\r\n      else if (object instanceof THREE.PointLight) {\r\n\r\n        data.color = object.color.getHex();\r\n        data.intensity = object.intensity;\r\n        data.distance = object.distance;\r\n        data.decay = object.decay;\r\n\r\n      }\r\n      else if (object instanceof THREE.SpotLight) {\r\n\r\n        data.color = object.color.getHex();\r\n        data.intensity = object.intensity;\r\n        data.distance = object.distance;\r\n        data.angle = object.angle;\r\n        data.exponent = object.exponent;\r\n        data.decay = object.decay;\r\n\r\n      }\r\n      else if (object instanceof THREE.HemisphereLight) {\r\n\r\n        data.color = object.color.getHex();\r\n        data.groundColor = object.groundColor.getHex();\r\n\r\n      }\r\n      else if (object instanceof THREE.Mesh || object instanceof THREE.Line || object instanceof THREE.PointCloud) {\r\n\r\n        data.geometry = parseGeometry(object.geometry);\r\n        data.material = parseMaterial(object.material);\r\n\r\n        if (object instanceof THREE.Line) data.mode = object.mode;\r\n\r\n      }\r\n      else if (object instanceof THREE.Sprite) {\r\n\r\n        data.material = parseMaterial(object.material);\r\n\r\n      }\r\n\r\n      data.matrix = object.matrix.toArray();\r\n\r\n      if (object.children.length > 0) {\r\n\r\n        data.children = [];\r\n\r\n        for (var i = 0; i < object.children.length; i++) {\r\n\r\n          data.children.push(parseObject(object.children[i]));\r\n\r\n        }\r\n\r\n      }\r\n\r\n      return data;\r\n\r\n    }\r\n\r\n    output.object = parseObject(this);\r\n\r\n    return output;\r\n\r\n  },\r\n\r\n  clone: function(object, recursive) {\r\n\r\n    if (object === undefined) object = new THREE.Object3D();\r\n    if (recursive === undefined) recursive = true;\r\n\r\n    object.name = this.name;\r\n\r\n    object.up.copy(this.up);\r\n\r\n    object.position.copy(this.position);\r\n    object.quaternion.copy(this.quaternion);\r\n    object.scale.copy(this.scale);\r\n\r\n    object.rotationAutoUpdate = this.rotationAutoUpdate;\r\n\r\n    object.matrix.copy(this.matrix);\r\n    object.matrixWorld.copy(this.matrixWorld);\r\n\r\n    object.matrixAutoUpdate = this.matrixAutoUpdate;\r\n    object.matrixWorldNeedsUpdate = this.matrixWorldNeedsUpdate;\r\n\r\n    object.visible = this.visible;\r\n\r\n    object.castShadow = this.castShadow;\r\n    object.receiveShadow = this.receiveShadow;\r\n\r\n    object.frustumCulled = this.frustumCulled;\r\n\r\n    object.userData = JSON.parse(JSON.stringify(this.userData));\r\n\r\n    if (recursive === true) {\r\n\r\n      for (var i = 0; i < this.children.length; i++) {\r\n\r\n        var child = this.children[i];\r\n        object.add(child.clone());\r\n\r\n      }\r\n\r\n    }\r\n\r\n    return object;\r\n\r\n  }\r\n\r\n};\r\n\r\nTHREE.EventDispatcher.prototype.apply(THREE.Object3D.prototype);\r\n\r\nTHREE.Object3DIdCount = 0;\r\n\r\n// File:src/core/Face3.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author alteredq / http://alteredqualia.com/\r\n */\r\n\r\nTHREE.Face3 = function(a, b, c, normal, color, materialIndex) {\r\n\r\n  this.a = a;\r\n  this.b = b;\r\n  this.c = c;\r\n\r\n  this.normal = normal instanceof THREE.Vector3 ? normal : new THREE.Vector3();\r\n  this.vertexNormals = normal instanceof Array ? normal : [];\r\n\r\n  this.color = color instanceof THREE.Color ? color : new THREE.Color();\r\n  this.vertexColors = color instanceof Array ? color : [];\r\n\r\n  this.vertexTangents = [];\r\n\r\n  this.materialIndex = materialIndex !== undefined ? materialIndex : 0;\r\n\r\n};\r\n\r\nTHREE.Face3.prototype = {\r\n\r\n  constructor: THREE.Face3,\r\n\r\n  clone: function() {\r\n\r\n    var face = new THREE.Face3(this.a, this.b, this.c);\r\n\r\n    face.normal.copy(this.normal);\r\n    face.color.copy(this.color);\r\n\r\n    face.materialIndex = this.materialIndex;\r\n\r\n    for (var i = 0, il = this.vertexNormals.length; i < il; i++) {\r\n\r\n      face.vertexNormals[i] = this.vertexNormals[i].clone();\r\n\r\n    }\r\n\r\n    for (var i = 0, il = this.vertexColors.length; i < il; i++) {\r\n\r\n      face.vertexColors[i] = this.vertexColors[i].clone();\r\n\r\n    }\r\n\r\n    for (var i = 0, il = this.vertexTangents.length; i < il; i++) {\r\n\r\n      face.vertexTangents[i] = this.vertexTangents[i].clone();\r\n\r\n    }\r\n\r\n    return face;\r\n\r\n  }\r\n\r\n};\r\n\r\n// File:src/core/Face4.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.Face4 = function(a, b, c, d, normal, color, materialIndex) {\r\n\r\n  THREE.warn('THREE.Face4 has been removed. A THREE.Face3 will be created instead.')\r\n  return new THREE.Face3(a, b, c, normal, color, materialIndex);\r\n\r\n};\r\n\r\n// File:src/core/BufferAttribute.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.BufferAttribute = function(array, itemSize) {\r\n\r\n  this.array = array;\r\n  this.itemSize = itemSize;\r\n\r\n  this.needsUpdate = false;\r\n\r\n};\r\n\r\nTHREE.BufferAttribute.prototype = {\r\n\r\n  constructor: THREE.BufferAttribute,\r\n\r\n  get length() {\r\n\r\n    return this.array.length;\r\n\r\n  },\r\n\r\n  copyAt: function(index1, attribute, index2) {\r\n\r\n    index1 *= this.itemSize;\r\n    index2 *= attribute.itemSize;\r\n\r\n    for (var i = 0, l = this.itemSize; i < l; i++) {\r\n\r\n      this.array[index1 + i] = attribute.array[index2 + i];\r\n\r\n    }\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  set: function(value, offset) {\r\n\r\n    if (offset === undefined) offset = 0;\r\n\r\n    this.array.set(value, offset);\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  setX: function(index, x) {\r\n\r\n    this.array[index * this.itemSize] = x;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  setY: function(index, y) {\r\n\r\n    this.array[index * this.itemSize + 1] = y;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  setZ: function(index, z) {\r\n\r\n    this.array[index * this.itemSize + 2] = z;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  setXY: function(index, x, y) {\r\n\r\n    index *= this.itemSize;\r\n\r\n    this.array[index] = x;\r\n    this.array[index + 1] = y;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  setXYZ: function(index, x, y, z) {\r\n\r\n    index *= this.itemSize;\r\n\r\n    this.array[index] = x;\r\n    this.array[index + 1] = y;\r\n    this.array[index + 2] = z;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  setXYZW: function(index, x, y, z, w) {\r\n\r\n    index *= this.itemSize;\r\n\r\n    this.array[index] = x;\r\n    this.array[index + 1] = y;\r\n    this.array[index + 2] = z;\r\n    this.array[index + 3] = w;\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  clone: function() {\r\n\r\n    return new THREE.BufferAttribute(new this.array.constructor(this.array), this.itemSize);\r\n\r\n  }\r\n\r\n};\r\n\r\n//\r\n\r\nTHREE.Int8Attribute = function(data, itemSize) {\r\n\r\n  THREE.warn('THREE.Int8Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead.');\r\n  return new THREE.BufferAttribute(data, itemSize);\r\n\r\n};\r\n\r\nTHREE.Uint8Attribute = function(data, itemSize) {\r\n\r\n  THREE.warn('THREE.Uint8Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead.');\r\n  return new THREE.BufferAttribute(data, itemSize);\r\n\r\n};\r\n\r\nTHREE.Uint8ClampedAttribute = function(data, itemSize) {\r\n\r\n  THREE.warn('THREE.Uint8ClampedAttribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead.');\r\n  return new THREE.BufferAttribute(data, itemSize);\r\n\r\n\r\n};\r\n\r\nTHREE.Int16Attribute = function(data, itemSize) {\r\n\r\n  THREE.warn('THREE.Int16Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead.');\r\n  return new THREE.BufferAttribute(data, itemSize);\r\n\r\n};\r\n\r\nTHREE.Uint16Attribute = function(data, itemSize) {\r\n\r\n  THREE.warn('THREE.Uint16Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead.');\r\n  return new THREE.BufferAttribute(data, itemSize);\r\n\r\n};\r\n\r\nTHREE.Int32Attribute = function(data, itemSize) {\r\n\r\n  THREE.warn('THREE.Int32Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead.');\r\n  return new THREE.BufferAttribute(data, itemSize);\r\n\r\n};\r\n\r\nTHREE.Uint32Attribute = function(data, itemSize) {\r\n\r\n  THREE.warn('THREE.Uint32Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead.');\r\n  return new THREE.BufferAttribute(data, itemSize);\r\n\r\n};\r\n\r\nTHREE.Float32Attribute = function(data, itemSize) {\r\n\r\n  THREE.warn('THREE.Float32Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead.');\r\n  return new THREE.BufferAttribute(data, itemSize);\r\n\r\n};\r\n\r\nTHREE.Float64Attribute = function(data, itemSize) {\r\n\r\n  THREE.warn('THREE.Float64Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead.');\r\n  return new THREE.BufferAttribute(data, itemSize);\r\n\r\n};\r\n\r\n// File:src/core/DynamicBufferAttribute.js\r\n\r\n/**\r\n * @author benaadams / https://twitter.com/ben_a_adams\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.DynamicBufferAttribute = function(array, itemSize) {\r\n\r\n  THREE.BufferAttribute.call(this, array, itemSize);\r\n\r\n  this.updateRange = {\r\n    offset: 0,\r\n    count: -1\r\n  };\r\n\r\n};\r\n\r\nTHREE.DynamicBufferAttribute.prototype = Object.create(THREE.BufferAttribute.prototype);\r\nTHREE.DynamicBufferAttribute.prototype.constructor = THREE.DynamicBufferAttribute;\r\n\r\nTHREE.DynamicBufferAttribute.prototype.clone = function() {\r\n\r\n  return new THREE.DynamicBufferAttribute(new this.array.constructor(this.array), this.itemSize);\r\n\r\n};\r\n\r\n// File:src/core/BufferGeometry.js\r\n\r\n/**\r\n * @author alteredq / http://alteredqualia.com/\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.BufferGeometry = function() {\r\n\r\n  Object.defineProperty(this, 'id', {\r\n    value: THREE.GeometryIdCount++\r\n  });\r\n\r\n  this.uuid = THREE.Math.generateUUID();\r\n\r\n  this.name = '';\r\n  this.type = 'BufferGeometry';\r\n\r\n  this.attributes = {};\r\n  this.attributesKeys = [];\r\n\r\n  this.drawcalls = [];\r\n  this.offsets = this.drawcalls; // backwards compatibility\r\n\r\n  this.boundingBox = null;\r\n  this.boundingSphere = null;\r\n\r\n};\r\n\r\nTHREE.BufferGeometry.prototype = {\r\n\r\n  constructor: THREE.BufferGeometry,\r\n\r\n  addAttribute: function(name, attribute) {\r\n\r\n    if (attribute instanceof THREE.BufferAttribute === false) {\r\n\r\n      THREE.warn('THREE.BufferGeometry: .addAttribute() now expects ( name, attribute ).');\r\n\r\n      this.attributes[name] = {\r\n        array: arguments[1],\r\n        itemSize: arguments[2]\r\n      };\r\n\r\n      return;\r\n\r\n    }\r\n\r\n    this.attributes[name] = attribute;\r\n    this.attributesKeys = Object.keys(this.attributes);\r\n\r\n  },\r\n\r\n  getAttribute: function(name) {\r\n\r\n    return this.attributes[name];\r\n\r\n  },\r\n\r\n  addDrawCall: function(start, count, indexOffset) {\r\n\r\n    this.drawcalls.push({\r\n\r\n      start: start,\r\n      count: count,\r\n      index: indexOffset !== undefined ? indexOffset : 0\r\n\r\n    });\r\n\r\n  },\r\n\r\n  applyMatrix: function(matrix) {\r\n\r\n    var position = this.attributes.position;\r\n\r\n    if (position !== undefined) {\r\n\r\n      matrix.applyToVector3Array(position.array);\r\n      position.needsUpdate = true;\r\n\r\n    }\r\n\r\n    var normal = this.attributes.normal;\r\n\r\n    if (normal !== undefined) {\r\n\r\n      var normalMatrix = new THREE.Matrix3().getNormalMatrix(matrix);\r\n\r\n      normalMatrix.applyToVector3Array(normal.array);\r\n      normal.needsUpdate = true;\r\n\r\n    }\r\n\r\n    if (this.boundingBox !== null) {\r\n\r\n      this.computeBoundingBox();\r\n\r\n    }\r\n\r\n    if (this.boundingSphere !== null) {\r\n\r\n      this.computeBoundingSphere();\r\n\r\n    }\r\n\r\n  },\r\n\r\n  center: function() {\r\n\r\n    this.computeBoundingBox();\r\n\r\n    var offset = this.boundingBox.center().negate();\r\n\r\n    this.applyMatrix(new THREE.Matrix4().setPosition(offset));\r\n\r\n    return offset;\r\n\r\n  },\r\n\r\n  fromGeometry: function(geometry, settings) {\r\n\r\n    settings = settings || {\r\n      'vertexColors': THREE.NoColors\r\n    };\r\n\r\n    var vertices = geometry.vertices;\r\n    var faces = geometry.faces;\r\n    var faceVertexUvs = geometry.faceVertexUvs;\r\n    var vertexColors = settings.vertexColors;\r\n    var hasFaceVertexUv = faceVertexUvs[0].length > 0;\r\n    var hasFaceVertexNormals = faces[0].vertexNormals.length == 3;\r\n\r\n    var positions = new Float32Array(faces.length * 3 * 3);\r\n    this.addAttribute('position', new THREE.BufferAttribute(positions, 3));\r\n\r\n    var normals = new Float32Array(faces.length * 3 * 3);\r\n    this.addAttribute('normal', new THREE.BufferAttribute(normals, 3));\r\n\r\n    if (vertexColors !== THREE.NoColors) {\r\n\r\n      var colors = new Float32Array(faces.length * 3 * 3);\r\n      this.addAttribute('color', new THREE.BufferAttribute(colors, 3));\r\n\r\n    }\r\n\r\n    if (hasFaceVertexUv === true) {\r\n\r\n      var uvs = new Float32Array(faces.length * 3 * 2);\r\n      this.addAttribute('uv', new THREE.BufferAttribute(uvs, 2));\r\n\r\n    }\r\n\r\n    for (var i = 0, i2 = 0, i3 = 0; i < faces.length; i++, i2 += 6, i3 += 9) {\r\n\r\n      var face = faces[i];\r\n\r\n      var a = vertices[face.a];\r\n      var b = vertices[face.b];\r\n      var c = vertices[face.c];\r\n\r\n      positions[i3] = a.x;\r\n      positions[i3 + 1] = a.y;\r\n      positions[i3 + 2] = a.z;\r\n\r\n      positions[i3 + 3] = b.x;\r\n      positions[i3 + 4] = b.y;\r\n      positions[i3 + 5] = b.z;\r\n\r\n      positions[i3 + 6] = c.x;\r\n      positions[i3 + 7] = c.y;\r\n      positions[i3 + 8] = c.z;\r\n\r\n      if (hasFaceVertexNormals === true) {\r\n\r\n        var na = face.vertexNormals[0];\r\n        var nb = face.vertexNormals[1];\r\n        var nc = face.vertexNormals[2];\r\n\r\n        normals[i3] = na.x;\r\n        normals[i3 + 1] = na.y;\r\n        normals[i3 + 2] = na.z;\r\n\r\n        normals[i3 + 3] = nb.x;\r\n        normals[i3 + 4] = nb.y;\r\n        normals[i3 + 5] = nb.z;\r\n\r\n        normals[i3 + 6] = nc.x;\r\n        normals[i3 + 7] = nc.y;\r\n        normals[i3 + 8] = nc.z;\r\n\r\n      }\r\n      else {\r\n\r\n        var n = face.normal;\r\n\r\n        normals[i3] = n.x;\r\n        normals[i3 + 1] = n.y;\r\n        normals[i3 + 2] = n.z;\r\n\r\n        normals[i3 + 3] = n.x;\r\n        normals[i3 + 4] = n.y;\r\n        normals[i3 + 5] = n.z;\r\n\r\n        normals[i3 + 6] = n.x;\r\n        normals[i3 + 7] = n.y;\r\n        normals[i3 + 8] = n.z;\r\n\r\n      }\r\n\r\n      if (vertexColors === THREE.FaceColors) {\r\n\r\n        var fc = face.color;\r\n\r\n        colors[i3] = fc.r;\r\n        colors[i3 + 1] = fc.g;\r\n        colors[i3 + 2] = fc.b;\r\n\r\n        colors[i3 + 3] = fc.r;\r\n        colors[i3 + 4] = fc.g;\r\n        colors[i3 + 5] = fc.b;\r\n\r\n        colors[i3 + 6] = fc.r;\r\n        colors[i3 + 7] = fc.g;\r\n        colors[i3 + 8] = fc.b;\r\n\r\n      }\r\n      else if (vertexColors === THREE.VertexColors) {\r\n\r\n        var vca = face.vertexColors[0];\r\n        var vcb = face.vertexColors[1];\r\n        var vcc = face.vertexColors[2];\r\n\r\n        colors[i3] = vca.r;\r\n        colors[i3 + 1] = vca.g;\r\n        colors[i3 + 2] = vca.b;\r\n\r\n        colors[i3 + 3] = vcb.r;\r\n        colors[i3 + 4] = vcb.g;\r\n        colors[i3 + 5] = vcb.b;\r\n\r\n        colors[i3 + 6] = vcc.r;\r\n        colors[i3 + 7] = vcc.g;\r\n        colors[i3 + 8] = vcc.b;\r\n\r\n      }\r\n\r\n      if (hasFaceVertexUv === true) {\r\n\r\n        var uva = faceVertexUvs[0][i][0];\r\n        var uvb = faceVertexUvs[0][i][1];\r\n        var uvc = faceVertexUvs[0][i][2];\r\n\r\n        uvs[i2] = uva.x;\r\n        uvs[i2 + 1] = uva.y;\r\n\r\n        uvs[i2 + 2] = uvb.x;\r\n        uvs[i2 + 3] = uvb.y;\r\n\r\n        uvs[i2 + 4] = uvc.x;\r\n        uvs[i2 + 5] = uvc.y;\r\n\r\n      }\r\n\r\n    }\r\n\r\n    this.computeBoundingSphere()\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  computeBoundingBox: function() {\r\n\r\n    var vector = new THREE.Vector3();\r\n\r\n    return function() {\r\n\r\n      if (this.boundingBox === null) {\r\n\r\n        this.boundingBox = new THREE.Box3();\r\n\r\n      }\r\n\r\n      var positions = this.attributes.position.array;\r\n\r\n      if (positions) {\r\n\r\n        var bb = this.boundingBox;\r\n        bb.makeEmpty();\r\n\r\n        for (var i = 0, il = positions.length; i < il; i += 3) {\r\n\r\n          vector.set(positions[i], positions[i + 1], positions[i + 2]);\r\n          bb.expandByPoint(vector);\r\n\r\n        }\r\n\r\n      }\r\n\r\n      if (positions === undefined || positions.length === 0) {\r\n\r\n        this.boundingBox.min.set(0, 0, 0);\r\n        this.boundingBox.max.set(0, 0, 0);\r\n\r\n      }\r\n\r\n      if (isNaN(this.boundingBox.min.x) || isNaN(this.boundingBox.min.y) || isNaN(this.boundingBox.min.z)) {\r\n\r\n        THREE.error('THREE.BufferGeometry.computeBoundingBox: Computed min/max have NaN values. The \"position\" attribute is likely to have NaN values.');\r\n\r\n      }\r\n\r\n    }\r\n\r\n  }(),\r\n\r\n  computeBoundingSphere: function() {\r\n\r\n    var box = new THREE.Box3();\r\n    var vector = new THREE.Vector3();\r\n\r\n    return function() {\r\n\r\n      if (this.boundingSphere === null) {\r\n\r\n        this.boundingSphere = new THREE.Sphere();\r\n\r\n      }\r\n\r\n      var positions = this.attributes.position.array;\r\n\r\n      if (positions) {\r\n\r\n        box.makeEmpty();\r\n\r\n        var center = this.boundingSphere.center;\r\n\r\n        for (var i = 0, il = positions.length; i < il; i += 3) {\r\n\r\n          vector.set(positions[i], positions[i + 1], positions[i + 2]);\r\n          box.expandByPoint(vector);\r\n\r\n        }\r\n\r\n        box.center(center);\r\n\r\n        // hoping to find a boundingSphere with a radius smaller than the\r\n        // boundingSphere of the boundingBox:  sqrt(3) smaller in the best case\r\n\r\n        var maxRadiusSq = 0;\r\n\r\n        for (var i = 0, il = positions.length; i < il; i += 3) {\r\n\r\n          vector.set(positions[i], positions[i + 1], positions[i + 2]);\r\n          maxRadiusSq = Math.max(maxRadiusSq, center.distanceToSquared(vector));\r\n\r\n        }\r\n\r\n        this.boundingSphere.radius = Math.sqrt(maxRadiusSq);\r\n\r\n        if (isNaN(this.boundingSphere.radius)) {\r\n\r\n          THREE.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The \"position\" attribute is likely to have NaN values.');\r\n\r\n        }\r\n\r\n      }\r\n\r\n    }\r\n\r\n  }(),\r\n\r\n  computeFaceNormals: function() {\r\n\r\n    // backwards compatibility\r\n\r\n  },\r\n\r\n  computeVertexNormals: function() {\r\n\r\n    var attributes = this.attributes;\r\n\r\n    if (attributes.position) {\r\n\r\n      var positions = attributes.position.array;\r\n\r\n      if (attributes.normal === undefined) {\r\n\r\n        this.addAttribute('normal', new THREE.BufferAttribute(new Float32Array(positions.length), 3));\r\n\r\n      }\r\n      else {\r\n\r\n        // reset existing normals to zero\r\n\r\n        var normals = attributes.normal.array;\r\n\r\n        for (var i = 0, il = normals.length; i < il; i++) {\r\n\r\n          normals[i] = 0;\r\n\r\n        }\r\n\r\n      }\r\n\r\n      var normals = attributes.normal.array;\r\n\r\n      var vA, vB, vC,\r\n\r\n        pA = new THREE.Vector3(),\r\n        pB = new THREE.Vector3(),\r\n        pC = new THREE.Vector3(),\r\n\r\n        cb = new THREE.Vector3(),\r\n        ab = new THREE.Vector3();\r\n\r\n      // indexed elements\r\n\r\n      if (attributes.index) {\r\n\r\n        var indices = attributes.index.array;\r\n\r\n        var offsets = (this.offsets.length > 0 ? this.offsets : [{\r\n          start: 0,\r\n          count: indices.length,\r\n          index: 0\r\n        }]);\r\n\r\n        for (var j = 0, jl = offsets.length; j < jl; ++j) {\r\n\r\n          var start = offsets[j].start;\r\n          var count = offsets[j].count;\r\n          var index = offsets[j].index;\r\n\r\n          for (var i = start, il = start + count; i < il; i += 3) {\r\n\r\n            vA = (index + indices[i]) * 3;\r\n            vB = (index + indices[i + 1]) * 3;\r\n            vC = (index + indices[i + 2]) * 3;\r\n\r\n            pA.fromArray(positions, vA);\r\n            pB.fromArray(positions, vB);\r\n            pC.fromArray(positions, vC);\r\n\r\n            cb.subVectors(pC, pB);\r\n            ab.subVectors(pA, pB);\r\n            cb.cross(ab);\r\n\r\n            normals[vA] += cb.x;\r\n            normals[vA + 1] += cb.y;\r\n            normals[vA + 2] += cb.z;\r\n\r\n            normals[vB] += cb.x;\r\n            normals[vB + 1] += cb.y;\r\n            normals[vB + 2] += cb.z;\r\n\r\n            normals[vC] += cb.x;\r\n            normals[vC + 1] += cb.y;\r\n            normals[vC + 2] += cb.z;\r\n\r\n          }\r\n\r\n        }\r\n\r\n      }\r\n      else {\r\n\r\n        // non-indexed elements (unconnected triangle soup)\r\n\r\n        for (var i = 0, il = positions.length; i < il; i += 9) {\r\n\r\n          pA.fromArray(positions, i);\r\n          pB.fromArray(positions, i + 3);\r\n          pC.fromArray(positions, i + 6);\r\n\r\n          cb.subVectors(pC, pB);\r\n          ab.subVectors(pA, pB);\r\n          cb.cross(ab);\r\n\r\n          normals[i] = cb.x;\r\n          normals[i + 1] = cb.y;\r\n          normals[i + 2] = cb.z;\r\n\r\n          normals[i + 3] = cb.x;\r\n          normals[i + 4] = cb.y;\r\n          normals[i + 5] = cb.z;\r\n\r\n          normals[i + 6] = cb.x;\r\n          normals[i + 7] = cb.y;\r\n          normals[i + 8] = cb.z;\r\n\r\n        }\r\n\r\n      }\r\n\r\n      this.normalizeNormals();\r\n\r\n      attributes.normal.needsUpdate = true;\r\n\r\n    }\r\n\r\n  },\r\n\r\n  computeTangents: function() {\r\n\r\n    // based on http://www.terathon.com/code/tangent.html\r\n    // (per vertex tangents)\r\n\r\n    if (this.attributes.index === undefined ||\r\n      this.attributes.position === undefined ||\r\n      this.attributes.normal === undefined ||\r\n      this.attributes.uv === undefined) {\r\n\r\n      THREE.warn('THREE.BufferGeometry: Missing required attributes (index, position, normal or uv) in BufferGeometry.computeTangents()');\r\n      return;\r\n\r\n    }\r\n\r\n    var indices = this.attributes.index.array;\r\n    var positions = this.attributes.position.array;\r\n    var normals = this.attributes.normal.array;\r\n    var uvs = this.attributes.uv.array;\r\n\r\n    var nVertices = positions.length / 3;\r\n\r\n    if (this.attributes.tangent === undefined) {\r\n\r\n      this.addAttribute('tangent', new THREE.BufferAttribute(new Float32Array(4 * nVertices), 4));\r\n\r\n    }\r\n\r\n    var tangents = this.attributes.tangent.array;\r\n\r\n    var tan1 = [],\r\n      tan2 = [];\r\n\r\n    for (var k = 0; k < nVertices; k++) {\r\n\r\n      tan1[k] = new THREE.Vector3();\r\n      tan2[k] = new THREE.Vector3();\r\n\r\n    }\r\n\r\n    var vA = new THREE.Vector3(),\r\n      vB = new THREE.Vector3(),\r\n      vC = new THREE.Vector3(),\r\n\r\n      uvA = new THREE.Vector2(),\r\n      uvB = new THREE.Vector2(),\r\n      uvC = new THREE.Vector2(),\r\n\r\n      x1, x2, y1, y2, z1, z2,\r\n      s1, s2, t1, t2, r;\r\n\r\n    var sdir = new THREE.Vector3(),\r\n      tdir = new THREE.Vector3();\r\n\r\n    function handleTriangle(a, b, c) {\r\n\r\n      vA.fromArray(positions, a * 3);\r\n      vB.fromArray(positions, b * 3);\r\n      vC.fromArray(positions, c * 3);\r\n\r\n      uvA.fromArray(uvs, a * 2);\r\n      uvB.fromArray(uvs, b * 2);\r\n      uvC.fromArray(uvs, c * 2);\r\n\r\n      x1 = vB.x - vA.x;\r\n      x2 = vC.x - vA.x;\r\n\r\n      y1 = vB.y - vA.y;\r\n      y2 = vC.y - vA.y;\r\n\r\n      z1 = vB.z - vA.z;\r\n      z2 = vC.z - vA.z;\r\n\r\n      s1 = uvB.x - uvA.x;\r\n      s2 = uvC.x - uvA.x;\r\n\r\n      t1 = uvB.y - uvA.y;\r\n      t2 = uvC.y - uvA.y;\r\n\r\n      r = 1.0 / (s1 * t2 - s2 * t1);\r\n\r\n      sdir.set(\r\n        (t2 * x1 - t1 * x2) * r, (t2 * y1 - t1 * y2) * r, (t2 * z1 - t1 * z2) * r\r\n      );\r\n\r\n      tdir.set(\r\n        (s1 * x2 - s2 * x1) * r, (s1 * y2 - s2 * y1) * r, (s1 * z2 - s2 * z1) * r\r\n      );\r\n\r\n      tan1[a].add(sdir);\r\n      tan1[b].add(sdir);\r\n      tan1[c].add(sdir);\r\n\r\n      tan2[a].add(tdir);\r\n      tan2[b].add(tdir);\r\n      tan2[c].add(tdir);\r\n\r\n    }\r\n\r\n    var i, il;\r\n    var j, jl;\r\n    var iA, iB, iC;\r\n\r\n    if (this.drawcalls.length === 0) {\r\n\r\n      this.addDrawCall(0, indices.length, 0);\r\n\r\n    }\r\n\r\n    var drawcalls = this.drawcalls;\r\n\r\n    for (j = 0, jl = drawcalls.length; j < jl; ++j) {\r\n\r\n      var start = drawcalls[j].start;\r\n      var count = drawcalls[j].count;\r\n      var index = drawcalls[j].index;\r\n\r\n      for (i = start, il = start + count; i < il; i += 3) {\r\n\r\n        iA = index + indices[i];\r\n        iB = index + indices[i + 1];\r\n        iC = index + indices[i + 2];\r\n\r\n        handleTriangle(iA, iB, iC);\r\n\r\n      }\r\n\r\n    }\r\n\r\n    var tmp = new THREE.Vector3(),\r\n      tmp2 = new THREE.Vector3();\r\n    var n = new THREE.Vector3(),\r\n      n2 = new THREE.Vector3();\r\n    var w, t, test;\r\n\r\n    function handleVertex(v) {\r\n\r\n      n.fromArray(normals, v * 3);\r\n      n2.copy(n);\r\n\r\n      t = tan1[v];\r\n\r\n      // Gram-Schmidt orthogonalize\r\n\r\n      tmp.copy(t);\r\n      tmp.sub(n.multiplyScalar(n.dot(t))).normalize();\r\n\r\n      // Calculate handedness\r\n\r\n      tmp2.crossVectors(n2, t);\r\n      test = tmp2.dot(tan2[v]);\r\n      w = (test < 0.0) ? -1.0 : 1.0;\r\n\r\n      tangents[v * 4] = tmp.x;\r\n      tangents[v * 4 + 1] = tmp.y;\r\n      tangents[v * 4 + 2] = tmp.z;\r\n      tangents[v * 4 + 3] = w;\r\n\r\n    }\r\n\r\n    for (j = 0, jl = drawcalls.length; j < jl; ++j) {\r\n\r\n      var start = drawcalls[j].start;\r\n      var count = drawcalls[j].count;\r\n      var index = drawcalls[j].index;\r\n\r\n      for (i = start, il = start + count; i < il; i += 3) {\r\n\r\n        iA = index + indices[i];\r\n        iB = index + indices[i + 1];\r\n        iC = index + indices[i + 2];\r\n\r\n        handleVertex(iA);\r\n        handleVertex(iB);\r\n        handleVertex(iC);\r\n\r\n      }\r\n\r\n    }\r\n\r\n  },\r\n\r\n  /*\r\n  Compute the draw offset for large models by chunking the index buffer into chunks of 65k addressable vertices.\r\n  This method will effectively rewrite the index buffer and remap all attributes to match the new indices.\r\n  WARNING: This method will also expand the vertex count to prevent sprawled triangles across draw offsets.\r\n  size - Defaults to 65535, but allows for larger or smaller chunks.\r\n  */\r\n  computeOffsets: function(size) {\r\n\r\n    if (size === undefined) size = 65535; // WebGL limits type of index buffer values to 16-bit.\r\n\r\n    var indices = this.attributes.index.array;\r\n    var vertices = this.attributes.position.array;\r\n\r\n    var facesCount = (indices.length / 3);\r\n\r\n    /*\r\n    console.log(\"Computing buffers in offsets of \"+size+\" -> indices:\"+indices.length+\" vertices:\"+vertices.length);\r\n    console.log(\"Faces to process: \"+(indices.length/3));\r\n    console.log(\"Reordering \"+verticesCount+\" vertices.\");\r\n    */\r\n\r\n    var sortedIndices = new Uint16Array(indices.length); //16-bit buffers\r\n    var indexPtr = 0;\r\n    var vertexPtr = 0;\r\n\r\n    var offsets = [{\r\n      start: 0,\r\n      count: 0,\r\n      index: 0\r\n    }];\r\n    var offset = offsets[0];\r\n\r\n    var duplicatedVertices = 0;\r\n    var newVerticeMaps = 0;\r\n    var faceVertices = new Int32Array(6);\r\n    var vertexMap = new Int32Array(vertices.length);\r\n    var revVertexMap = new Int32Array(vertices.length);\r\n    for (var j = 0; j < vertices.length; j++) {\r\n      vertexMap[j] = -1;\r\n      revVertexMap[j] = -1;\r\n    }\r\n\r\n    /*\r\n    \tTraverse every face and reorder vertices in the proper offsets of 65k.\r\n    \tWe can have more than 65k entries in the index buffer per offset, but only reference 65k values.\r\n    */\r\n    for (var findex = 0; findex < facesCount; findex++) {\r\n      newVerticeMaps = 0;\r\n\r\n      for (var vo = 0; vo < 3; vo++) {\r\n        var vid = indices[findex * 3 + vo];\r\n        if (vertexMap[vid] == -1) {\r\n          //Unmapped vertice\r\n          faceVertices[vo * 2] = vid;\r\n          faceVertices[vo * 2 + 1] = -1;\r\n          newVerticeMaps++;\r\n        }\r\n        else if (vertexMap[vid] < offset.index) {\r\n          //Reused vertices from previous block (duplicate)\r\n          faceVertices[vo * 2] = vid;\r\n          faceVertices[vo * 2 + 1] = -1;\r\n          duplicatedVertices++;\r\n        }\r\n        else {\r\n          //Reused vertice in the current block\r\n          faceVertices[vo * 2] = vid;\r\n          faceVertices[vo * 2 + 1] = vertexMap[vid];\r\n        }\r\n      }\r\n\r\n      var faceMax = vertexPtr + newVerticeMaps;\r\n      if (faceMax > (offset.index + size)) {\r\n        var new_offset = {\r\n          start: indexPtr,\r\n          count: 0,\r\n          index: vertexPtr\r\n        };\r\n        offsets.push(new_offset);\r\n        offset = new_offset;\r\n\r\n        //Re-evaluate reused vertices in light of new offset.\r\n        for (var v = 0; v < 6; v += 2) {\r\n          var new_vid = faceVertices[v + 1];\r\n          if (new_vid > -1 && new_vid < offset.index)\r\n            faceVertices[v + 1] = -1;\r\n        }\r\n      }\r\n\r\n      //Reindex the face.\r\n      for (var v = 0; v < 6; v += 2) {\r\n        var vid = faceVertices[v];\r\n        var new_vid = faceVertices[v + 1];\r\n\r\n        if (new_vid === -1)\r\n          new_vid = vertexPtr++;\r\n\r\n        vertexMap[vid] = new_vid;\r\n        revVertexMap[new_vid] = vid;\r\n        sortedIndices[indexPtr++] = new_vid - offset.index; //XXX overflows at 16bit\r\n        offset.count++;\r\n      }\r\n    }\r\n\r\n    /* Move all attribute values to map to the new computed indices , also expand the vertice stack to match our new vertexPtr. */\r\n    this.reorderBuffers(sortedIndices, revVertexMap, vertexPtr);\r\n    this.offsets = offsets; // TODO: Deprecate\r\n    this.drawcalls = offsets;\r\n\r\n    /*\r\n    var orderTime = Date.now();\r\n    console.log(\"Reorder time: \"+(orderTime-s)+\"ms\");\r\n    console.log(\"Duplicated \"+duplicatedVertices+\" vertices.\");\r\n    console.log(\"Compute Buffers time: \"+(Date.now()-s)+\"ms\");\r\n    console.log(\"Draw offsets: \"+offsets.length);\r\n    */\r\n\r\n    return offsets;\r\n\r\n  },\r\n\r\n  merge: function(geometry, offset) {\r\n\r\n    if (geometry instanceof THREE.BufferGeometry === false) {\r\n\r\n      THREE.error('THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.', geometry);\r\n      return;\r\n\r\n    }\r\n\r\n    if (offset === undefined) offset = 0;\r\n\r\n    var attributes = this.attributes;\r\n\r\n    for (var key in attributes) {\r\n\r\n      if (geometry.attributes[key] === undefined) continue;\r\n\r\n      var attribute1 = attributes[key];\r\n      var attributeArray1 = attribute1.array;\r\n\r\n      var attribute2 = geometry.attributes[key];\r\n      var attributeArray2 = attribute2.array;\r\n\r\n      var attributeSize = attribute2.itemSize;\r\n\r\n      for (var i = 0, j = attributeSize * offset; i < attributeArray2.length; i++, j++) {\r\n\r\n        attributeArray1[j] = attributeArray2[i];\r\n\r\n      }\r\n\r\n    }\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  normalizeNormals: function() {\r\n\r\n    var normals = this.attributes.normal.array;\r\n\r\n    var x, y, z, n;\r\n\r\n    for (var i = 0, il = normals.length; i < il; i += 3) {\r\n\r\n      x = normals[i];\r\n      y = normals[i + 1];\r\n      z = normals[i + 2];\r\n\r\n      n = 1.0 / Math.sqrt(x * x + y * y + z * z);\r\n\r\n      normals[i] *= n;\r\n      normals[i + 1] *= n;\r\n      normals[i + 2] *= n;\r\n\r\n    }\r\n\r\n  },\r\n\r\n  /*\r\n  \treoderBuffers:\r\n  \tReorder attributes based on a new indexBuffer and indexMap.\r\n  \tindexBuffer - Uint16Array of the new ordered indices.\r\n  \tindexMap - Int32Array where the position is the new vertex ID and the value the old vertex ID for each vertex.\r\n  \tvertexCount - Amount of total vertices considered in this reordering (in case you want to grow the vertice stack).\r\n  */\r\n  reorderBuffers: function(indexBuffer, indexMap, vertexCount) {\r\n\r\n    /* Create a copy of all attributes for reordering. */\r\n    var sortedAttributes = {};\r\n    for (var attr in this.attributes) {\r\n      if (attr == 'index')\r\n        continue;\r\n      var sourceArray = this.attributes[attr].array;\r\n      sortedAttributes[attr] = new sourceArray.constructor(this.attributes[attr].itemSize * vertexCount);\r\n    }\r\n\r\n    /* Move attribute positions based on the new index map */\r\n    for (var new_vid = 0; new_vid < vertexCount; new_vid++) {\r\n      var vid = indexMap[new_vid];\r\n      for (var attr in this.attributes) {\r\n        if (attr == 'index')\r\n          continue;\r\n        var attrArray = this.attributes[attr].array;\r\n        var attrSize = this.attributes[attr].itemSize;\r\n        var sortedAttr = sortedAttributes[attr];\r\n        for (var k = 0; k < attrSize; k++)\r\n          sortedAttr[new_vid * attrSize + k] = attrArray[vid * attrSize + k];\r\n      }\r\n    }\r\n\r\n    /* Carry the new sorted buffers locally */\r\n    this.attributes['index'].array = indexBuffer;\r\n    for (var attr in this.attributes) {\r\n      if (attr == 'index')\r\n        continue;\r\n      this.attributes[attr].array = sortedAttributes[attr];\r\n      this.attributes[attr].numItems = this.attributes[attr].itemSize * vertexCount;\r\n    }\r\n  },\r\n\r\n  toJSON: function() {\r\n\r\n    var output = {\r\n      metadata: {\r\n        version: 4.0,\r\n        type: 'BufferGeometry',\r\n        generator: 'BufferGeometryExporter'\r\n      },\r\n      uuid: this.uuid,\r\n      type: this.type,\r\n      data: {\r\n        attributes: {}\r\n      }\r\n    };\r\n\r\n    var attributes = this.attributes;\r\n    var offsets = this.offsets;\r\n    var boundingSphere = this.boundingSphere;\r\n\r\n    for (var key in attributes) {\r\n\r\n      var attribute = attributes[key];\r\n\r\n      var array = Array.prototype.slice.call(attribute.array);\r\n\r\n      output.data.attributes[key] = {\r\n        itemSize: attribute.itemSize,\r\n        type: attribute.array.constructor.name,\r\n        array: array\r\n      }\r\n\r\n    }\r\n\r\n    if (offsets.length > 0) {\r\n\r\n      output.data.offsets = JSON.parse(JSON.stringify(offsets));\r\n\r\n    }\r\n\r\n    if (boundingSphere !== null) {\r\n\r\n      output.data.boundingSphere = {\r\n        center: boundingSphere.center.toArray(),\r\n        radius: boundingSphere.radius\r\n      }\r\n\r\n    }\r\n\r\n    return output;\r\n\r\n  },\r\n\r\n  clone: function() {\r\n\r\n    var geometry = new THREE.BufferGeometry();\r\n\r\n    for (var attr in this.attributes) {\r\n\r\n      var sourceAttr = this.attributes[attr];\r\n      geometry.addAttribute(attr, sourceAttr.clone());\r\n\r\n    }\r\n\r\n    for (var i = 0, il = this.offsets.length; i < il; i++) {\r\n\r\n      var offset = this.offsets[i];\r\n\r\n      geometry.offsets.push({\r\n\r\n        start: offset.start,\r\n        index: offset.index,\r\n        count: offset.count\r\n\r\n      });\r\n\r\n    }\r\n\r\n    return geometry;\r\n\r\n  },\r\n\r\n  dispose: function() {\r\n\r\n    this.dispatchEvent({\r\n      type: 'dispose'\r\n    });\r\n\r\n  }\r\n\r\n};\r\n\r\nTHREE.EventDispatcher.prototype.apply(THREE.BufferGeometry.prototype);\r\n\r\n// File:src/core/Geometry.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author kile / http://kile.stravaganza.org/\r\n * @author alteredq / http://alteredqualia.com/\r\n * @author mikael emtinger / http://gomo.se/\r\n * @author zz85 / http://www.lab4games.net/zz85/blog\r\n * @author bhouston / http://exocortex.com\r\n */\r\n\r\nTHREE.Geometry = function() {\r\n\r\n  Object.defineProperty(this, 'id', {\r\n    value: THREE.GeometryIdCount++\r\n  });\r\n\r\n  this.uuid = THREE.Math.generateUUID();\r\n\r\n  this.name = '';\r\n  this.type = 'Geometry';\r\n\r\n  this.vertices = [];\r\n  this.colors = []; // one-to-one vertex colors, used in Points and Line\r\n\r\n  this.faces = [];\r\n\r\n  this.faceVertexUvs = [\r\n    []\r\n  ];\r\n\r\n  this.morphTargets = [];\r\n  this.morphColors = [];\r\n  this.morphNormals = [];\r\n\r\n  this.skinWeights = [];\r\n  this.skinIndices = [];\r\n\r\n  this.lineDistances = [];\r\n\r\n  this.boundingBox = null;\r\n  this.boundingSphere = null;\r\n\r\n  this.hasTangents = false;\r\n\r\n  this.dynamic = true; // the intermediate typed arrays will be deleted when set to false\r\n\r\n  // update flags\r\n\r\n  this.verticesNeedUpdate = false;\r\n  this.elementsNeedUpdate = false;\r\n  this.uvsNeedUpdate = false;\r\n  this.normalsNeedUpdate = false;\r\n  this.tangentsNeedUpdate = false;\r\n  this.colorsNeedUpdate = false;\r\n  this.lineDistancesNeedUpdate = false;\r\n\r\n  this.groupsNeedUpdate = false;\r\n\r\n};\r\n\r\nTHREE.Geometry.prototype = {\r\n\r\n  constructor: THREE.Geometry,\r\n\r\n  applyMatrix: function(matrix) {\r\n\r\n    var normalMatrix = new THREE.Matrix3().getNormalMatrix(matrix);\r\n\r\n    for (var i = 0, il = this.vertices.length; i < il; i++) {\r\n\r\n      var vertex = this.vertices[i];\r\n      vertex.applyMatrix4(matrix);\r\n\r\n    }\r\n\r\n    for (var i = 0, il = this.faces.length; i < il; i++) {\r\n\r\n      var face = this.faces[i];\r\n      face.normal.applyMatrix3(normalMatrix).normalize();\r\n\r\n      for (var j = 0, jl = face.vertexNormals.length; j < jl; j++) {\r\n\r\n        face.vertexNormals[j].applyMatrix3(normalMatrix).normalize();\r\n\r\n      }\r\n\r\n    }\r\n\r\n    if (this.boundingBox !== null) {\r\n\r\n      this.computeBoundingBox();\r\n\r\n    }\r\n\r\n    if (this.boundingSphere !== null) {\r\n\r\n      this.computeBoundingSphere();\r\n\r\n    }\r\n\r\n    this.verticesNeedUpdate = true;\r\n    this.normalsNeedUpdate = true;\r\n\r\n  },\r\n\r\n  fromBufferGeometry: function(geometry) {\r\n\r\n    var scope = this;\r\n\r\n    var attributes = geometry.attributes;\r\n\r\n    var vertices = attributes.position.array;\r\n    var indices = attributes.index !== undefined ? attributes.index.array : undefined;\r\n    var normals = attributes.normal !== undefined ? attributes.normal.array : undefined;\r\n    var colors = attributes.color !== undefined ? attributes.color.array : undefined;\r\n    var uvs = attributes.uv !== undefined ? attributes.uv.array : undefined;\r\n\r\n    var tempNormals = [];\r\n    var tempUVs = [];\r\n\r\n    for (var i = 0, j = 0; i < vertices.length; i += 3, j += 2) {\r\n\r\n      scope.vertices.push(new THREE.Vector3(vertices[i], vertices[i + 1], vertices[i + 2]));\r\n\r\n      if (normals !== undefined) {\r\n\r\n        tempNormals.push(new THREE.Vector3(normals[i], normals[i + 1], normals[i + 2]));\r\n\r\n      }\r\n\r\n      if (colors !== undefined) {\r\n\r\n        scope.colors.push(new THREE.Color(colors[i], colors[i + 1], colors[i + 2]));\r\n\r\n      }\r\n\r\n      if (uvs !== undefined) {\r\n\r\n        tempUVs.push(new THREE.Vector2(uvs[j], uvs[j + 1]));\r\n\r\n      }\r\n\r\n    }\r\n\r\n    var addFace = function(a, b, c) {\r\n\r\n      var vertexNormals = normals !== undefined ? [tempNormals[a].clone(), tempNormals[b].clone(), tempNormals[c].clone()] : [];\r\n      var vertexColors = colors !== undefined ? [scope.colors[a].clone(), scope.colors[b].clone(), scope.colors[c].clone()] : [];\r\n\r\n      scope.faces.push(new THREE.Face3(a, b, c, vertexNormals, vertexColors));\r\n\r\n      if (uvs !== undefined) {\r\n\r\n        scope.faceVertexUvs[0].push([tempUVs[a].clone(), tempUVs[b].clone(), tempUVs[c].clone()]);\r\n\r\n      }\r\n\r\n    };\r\n\r\n    if (indices !== undefined) {\r\n\r\n      var drawcalls = geometry.drawcalls;\r\n\r\n      if (drawcalls.length > 0) {\r\n\r\n        for (var i = 0; i < drawcalls.length; i++) {\r\n\r\n          var drawcall = drawcalls[i];\r\n\r\n          var start = drawcall.start;\r\n          var count = drawcall.count;\r\n          var index = drawcall.index;\r\n\r\n          for (var j = start, jl = start + count; j < jl; j += 3) {\r\n\r\n            addFace(index + indices[j], index + indices[j + 1], index + indices[j + 2]);\r\n\r\n          }\r\n\r\n        }\r\n\r\n      }\r\n      else {\r\n\r\n        for (var i = 0; i < indices.length; i += 3) {\r\n\r\n          addFace(indices[i], indices[i + 1], indices[i + 2]);\r\n\r\n        }\r\n\r\n      }\r\n\r\n    }\r\n    else {\r\n\r\n      for (var i = 0; i < vertices.length / 3; i += 3) {\r\n\r\n        addFace(i, i + 1, i + 2);\r\n\r\n      }\r\n\r\n    }\r\n\r\n    this.computeFaceNormals();\r\n\r\n    if (geometry.boundingBox !== null) {\r\n\r\n      this.boundingBox = geometry.boundingBox.clone();\r\n\r\n    }\r\n\r\n    if (geometry.boundingSphere !== null) {\r\n\r\n      this.boundingSphere = geometry.boundingSphere.clone();\r\n\r\n    }\r\n\r\n    return this;\r\n\r\n  },\r\n\r\n  center: function() {\r\n\r\n    this.computeBoundingBox();\r\n\r\n    var offset = this.boundingBox.center().negate();\r\n\r\n    this.applyMatrix(new THREE.Matrix4().setPosition(offset));\r\n\r\n    return offset;\r\n\r\n  },\r\n\r\n  computeFaceNormals: function() {\r\n\r\n    var cb = new THREE.Vector3(),\r\n      ab = new THREE.Vector3();\r\n\r\n    for (var f = 0, fl = this.faces.length; f < fl; f++) {\r\n\r\n      var face = this.faces[f];\r\n\r\n      var vA = this.vertices[face.a];\r\n      var vB = this.vertices[face.b];\r\n      var vC = this.vertices[face.c];\r\n\r\n      cb.subVectors(vC, vB);\r\n      ab.subVectors(vA, vB);\r\n      cb.cross(ab);\r\n\r\n      cb.normalize();\r\n\r\n      face.normal.copy(cb);\r\n\r\n    }\r\n\r\n  },\r\n\r\n  computeVertexNormals: function(areaWeighted) {\r\n\r\n    var v, vl, f, fl, face, vertices;\r\n\r\n    vertices = new Array(this.vertices.length);\r\n\r\n    for (v = 0, vl = this.vertices.length; v < vl; v++) {\r\n\r\n      vertices[v] = new THREE.Vector3();\r\n\r\n    }\r\n\r\n    if (areaWeighted) {\r\n\r\n      // vertex normals weighted by triangle areas\r\n      // http://www.iquilezles.org/www/articles/normals/normals.htm\r\n\r\n      var vA, vB, vC;\r\n      var cb = new THREE.Vector3(),\r\n        ab = new THREE.Vector3();\r\n\r\n      for (f = 0, fl = this.faces.length; f < fl; f++) {\r\n\r\n        face = this.faces[f];\r\n\r\n        vA = this.vertices[face.a];\r\n        vB = this.vertices[face.b];\r\n        vC = this.vertices[face.c];\r\n\r\n        cb.subVectors(vC, vB);\r\n        ab.subVectors(vA, vB);\r\n        cb.cross(ab);\r\n\r\n        vertices[face.a].add(cb);\r\n        vertices[face.b].add(cb);\r\n        vertices[face.c].add(cb);\r\n\r\n      }\r\n\r\n    }\r\n    else {\r\n\r\n      for (f = 0, fl = this.faces.length; f < fl; f++) {\r\n\r\n        face = this.faces[f];\r\n\r\n        vertices[face.a].add(face.normal);\r\n        vertices[face.b].add(face.normal);\r\n        vertices[face.c].add(face.normal);\r\n\r\n      }\r\n\r\n    }\r\n\r\n    for (v = 0, vl = this.vertices.length; v < vl; v++) {\r\n\r\n      vertices[v].normalize();\r\n\r\n    }\r\n\r\n    for (f = 0, fl = this.faces.length; f < fl; f++) {\r\n\r\n      face = this.faces[f];\r\n\r\n      face.vertexNormals[0] = vertices[face.a].clone();\r\n      face.vertexNormals[1] = vertices[face.b].clone();\r\n      face.vertexNormals[2] = vertices[face.c].clone();\r\n\r\n    }\r\n\r\n  },\r\n\r\n  computeMorphNormals: function() {\r\n\r\n    var i, il, f, fl, face;\r\n\r\n    // save original normals\r\n    // - create temp variables on first access\r\n    //   otherwise just copy (for faster repeated calls)\r\n\r\n    for (f = 0, fl = this.faces.length; f < fl; f++) {\r\n\r\n      face = this.faces[f];\r\n\r\n      if (!face.__originalFaceNormal) {\r\n\r\n        face.__originalFaceNormal = face.normal.clone();\r\n\r\n      }\r\n      else {\r\n\r\n        face.__originalFaceNormal.copy(face.normal);\r\n\r\n      }\r\n\r\n      if (!face.__originalVertexNormals) face.__originalVertexNormals = [];\r\n\r\n      for (i = 0, il = face.vertexNormals.length; i < il; i++) {\r\n\r\n        if (!face.__originalVertexNormals[i]) {\r\n\r\n          face.__originalVertexNormals[i] = face.vertexNormals[i].clone();\r\n\r\n        }\r\n        else {\r\n\r\n          face.__originalVertexNormals[i].copy(face.vertexNormals[i]);\r\n\r\n        }\r\n\r\n      }\r\n\r\n    }\r\n\r\n    // use temp geometry to compute face and vertex normals for each morph\r\n\r\n    var tmpGeo = new THREE.Geometry();\r\n    tmpGeo.faces = this.faces;\r\n\r\n    for (i = 0, il = this.morphTargets.length; i < il; i++) {\r\n\r\n      // create on first access\r\n\r\n      if (!this.morphNormals[i]) {\r\n\r\n        this.morphNormals[i] = {};\r\n        this.morphNormals[i].faceNormals = [];\r\n        this.morphNormals[i].vertexNormals = [];\r\n\r\n        var dstNormalsFace = this.morphNormals[i].faceNormals;\r\n        var dstNormalsVertex = this.morphNormals[i].vertexNormals;\r\n\r\n        var faceNormal, vertexNormals;\r\n\r\n        for (f = 0, fl = this.faces.length; f < fl; f++) {\r\n\r\n          faceNormal = new THREE.Vector3();\r\n          vertexNormals = {\r\n            a: new THREE.Vector3(),\r\n            b: new THREE.Vector3(),\r\n            c: new THREE.Vector3()\r\n          };\r\n\r\n          dstNormalsFace.push(faceNormal);\r\n          dstNormalsVertex.push(vertexNormals);\r\n\r\n        }\r\n\r\n      }\r\n\r\n      var morphNormals = this.morphNormals[i];\r\n\r\n      // set vertices to morph target\r\n\r\n      tmpGeo.vertices = this.morphTargets[i].vertices;\r\n\r\n      // compute morph normals\r\n\r\n      tmpGeo.computeFaceNormals();\r\n      tmpGeo.computeVertexNormals();\r\n\r\n      // store morph normals\r\n\r\n      var faceNormal, vertexNormals;\r\n\r\n      for (f = 0, fl = this.faces.length; f < fl; f++) {\r\n\r\n        face = this.faces[f];\r\n\r\n        faceNormal = morphNormals.faceNormals[f];\r\n        vertexNormals = morphNormals.vertexNormals[f];\r\n\r\n        faceNormal.copy(face.normal);\r\n\r\n        vertexNormals.a.copy(face.vertexNormals[0]);\r\n        vertexNormals.b.copy(face.vertexNormals[1]);\r\n        vertexNormals.c.copy(face.vertexNormals[2]);\r\n\r\n      }\r\n\r\n    }\r\n\r\n    // restore original normals\r\n\r\n    for (f = 0, fl = this.faces.length; f < fl; f++) {\r\n\r\n      face = this.faces[f];\r\n\r\n      face.normal = face.__originalFaceNormal;\r\n      face.vertexNormals = face.__originalVertexNormals;\r\n\r\n    }\r\n\r\n  },\r\n\r\n  computeTangents: function() {\r\n\r\n    // based on http://www.terathon.com/code/tangent.html\r\n    // tangents go to vertices\r\n\r\n    var f, fl, v, vl, i, vertexIndex,\r\n      face, uv, vA, vB, vC, uvA, uvB, uvC,\r\n      x1, x2, y1, y2, z1, z2,\r\n      s1, s2, t1, t2, r, t, test,\r\n      tan1 = [],\r\n      tan2 = [],\r\n      sdir = new THREE.Vector3(),\r\n      tdir = new THREE.Vector3(),\r\n      tmp = new THREE.Vector3(),\r\n      tmp2 = new THREE.Vector3(),\r\n      n = new THREE.Vector3(),\r\n      w;\r\n\r\n    for (v = 0, vl = this.vertices.length; v < vl; v++) {\r\n\r\n      tan1[v] = new THREE.Vector3();\r\n      tan2[v] = new THREE.Vector3();\r\n\r\n    }\r\n\r\n    function handleTriangle(context, a, b, c, ua, ub, uc) {\r\n\r\n      vA = context.vertices[a];\r\n      vB = context.vertices[b];\r\n      vC = context.vertices[c];\r\n\r\n      uvA = uv[ua];\r\n      uvB = uv[ub];\r\n      uvC = uv[uc];\r\n\r\n      x1 = vB.x - vA.x;\r\n      x2 = vC.x - vA.x;\r\n      y1 = vB.y - vA.y;\r\n      y2 = vC.y - vA.y;\r\n      z1 = vB.z - vA.z;\r\n      z2 = vC.z - vA.z;\r\n\r\n      s1 = uvB.x - uvA.x;\r\n      s2 = uvC.x - uvA.x;\r\n      t1 = uvB.y - uvA.y;\r\n      t2 = uvC.y - uvA.y;\r\n\r\n      r = 1.0 / (s1 * t2 - s2 * t1);\r\n      sdir.set((t2 * x1 - t1 * x2) * r, (t2 * y1 - t1 * y2) * r, (t2 * z1 - t1 * z2) * r);\r\n      tdir.set((s1 * x2 - s2 * x1) * r, (s1 * y2 - s2 * y1) * r, (s1 * z2 - s2 * z1) * r);\r\n\r\n      tan1[a].add(sdir);\r\n      tan1[b].add(sdir);\r\n      tan1[c].add(sdir);\r\n\r\n      tan2[a].add(tdir);\r\n      tan2[b].add(tdir);\r\n      tan2[c].add(tdir);\r\n\r\n    }\r\n\r\n    for (f = 0, fl = this.faces.length; f < fl; f++) {\r\n\r\n      face = this.faces[f];\r\n      uv = this.faceVertexUvs[0][f]; // use UV layer 0 for tangents\r\n\r\n      handleTriangle(this, face.a, face.b, face.c, 0, 1, 2);\r\n\r\n    }\r\n\r\n    var faceIndex = ['a', 'b', 'c', 'd'];\r\n\r\n    for (f = 0, fl = this.faces.length; f < fl; f++) {\r\n\r\n      face = this.faces[f];\r\n\r\n      for (i = 0; i < Math.min(face.vertexNormals.length, 3); i++) {\r\n\r\n        n.copy(face.vertexNormals[i]);\r\n\r\n        vertexIndex = face[faceIndex[i]];\r\n\r\n        t = tan1[vertexIndex];\r\n\r\n        // Gram-Schmidt orthogonalize\r\n\r\n        tmp.copy(t);\r\n        tmp.sub(n.multiplyScalar(n.dot(t))).normalize();\r\n\r\n        // Calculate handedness\r\n\r\n        tmp2.crossVectors(face.vertexNormals[i], t);\r\n        test = tmp2.dot(tan2[vertexIndex]);\r\n        w = (test < 0.0) ? -1.0 : 1.0;\r\n\r\n        face.vertexTangents[i] = new THREE.Vector4(tmp.x, tmp.y, tmp.z, w);\r\n\r\n      }\r\n\r\n    }\r\n\r\n    this.hasTangents = true;\r\n\r\n  },\r\n\r\n  computeLineDistances: function() {\r\n\r\n    var d = 0;\r\n    var vertices = this.vertices;\r\n\r\n    for (var i = 0, il = vertices.length; i < il; i++) {\r\n\r\n      if (i > 0) {\r\n\r\n        d += vertices[i].distanceTo(vertices[i - 1]);\r\n\r\n      }\r\n\r\n      this.lineDistances[i] = d;\r\n\r\n    }\r\n\r\n  },\r\n\r\n  computeBoundingBox: function() {\r\n\r\n    if (this.boundingBox === null) {\r\n\r\n      this.boundingBox = new THREE.Box3();\r\n\r\n    }\r\n\r\n    this.boundingBox.setFromPoints(this.vertices);\r\n\r\n  },\r\n\r\n  computeBoundingSphere: function() {\r\n\r\n    if (this.boundingSphere === null) {\r\n\r\n      this.boundingSphere = new THREE.Sphere();\r\n\r\n    }\r\n\r\n    this.boundingSphere.setFromPoints(this.vertices);\r\n\r\n  },\r\n\r\n  merge: function(geometry, matrix, materialIndexOffset) {\r\n\r\n    if (geometry instanceof THREE.Geometry === false) {\r\n\r\n      THREE.error('THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.', geometry);\r\n      return;\r\n\r\n    }\r\n\r\n    var normalMatrix,\r\n      vertexOffset = this.vertices.length,\r\n      vertices1 = this.vertices,\r\n      vertices2 = geometry.vertices,\r\n      faces1 = this.faces,\r\n      faces2 = geometry.faces,\r\n      uvs1 = this.faceVertexUvs[0],\r\n      uvs2 = geometry.faceVertexUvs[0];\r\n\r\n    if (materialIndexOffset === undefined) materialIndexOffset = 0;\r\n\r\n    if (matrix !== undefined) {\r\n\r\n      normalMatrix = new THREE.Matrix3().getNormalMatrix(matrix);\r\n\r\n    }\r\n\r\n    // vertices\r\n\r\n    for (var i = 0, il = vertices2.length; i < il; i++) {\r\n\r\n      var vertex = vertices2[i];\r\n\r\n      var vertexCopy = vertex.clone();\r\n\r\n      if (matrix !== undefined) vertexCopy.applyMatrix4(matrix);\r\n\r\n      vertices1.push(vertexCopy);\r\n\r\n    }\r\n\r\n    // faces\r\n\r\n    for (i = 0, il = faces2.length; i < il; i++) {\r\n\r\n      var face = faces2[i],\r\n        faceCopy, normal, color,\r\n        faceVertexNormals = face.vertexNormals,\r\n        faceVertexColors = face.vertexColors;\r\n\r\n      faceCopy = new THREE.Face3(face.a + vertexOffset, face.b + vertexOffset, face.c + vertexOffset);\r\n      faceCopy.normal.copy(face.normal);\r\n\r\n      if (normalMatrix !== undefined) {\r\n\r\n        faceCopy.normal.applyMatrix3(normalMatrix).normalize();\r\n\r\n      }\r\n\r\n      for (var j = 0, jl = faceVertexNormals.length; j < jl; j++) {\r\n\r\n        normal = faceVertexNormals[j].clone();\r\n\r\n        if (normalMatrix !== undefined) {\r\n\r\n          normal.applyMatrix3(normalMatrix).normalize();\r\n\r\n        }\r\n\r\n        faceCopy.vertexNormals.push(normal);\r\n\r\n      }\r\n\r\n      faceCopy.color.copy(face.color);\r\n\r\n      for (var j = 0, jl = faceVertexColors.length; j < jl; j++) {\r\n\r\n        color = faceVertexColors[j];\r\n        faceCopy.vertexColors.push(color.clone());\r\n\r\n      }\r\n\r\n      faceCopy.materialIndex = face.materialIndex + materialIndexOffset;\r\n\r\n      faces1.push(faceCopy);\r\n\r\n    }\r\n\r\n    // uvs\r\n\r\n    for (i = 0, il = uvs2.length; i < il; i++) {\r\n\r\n      var uv = uvs2[i],\r\n        uvCopy = [];\r\n\r\n      if (uv === undefined) {\r\n\r\n        continue;\r\n\r\n      }\r\n\r\n      for (var j = 0, jl = uv.length; j < jl; j++) {\r\n\r\n        uvCopy.push(uv[j].clone());\r\n\r\n      }\r\n\r\n      uvs1.push(uvCopy);\r\n\r\n    }\r\n\r\n  },\r\n\r\n  mergeMesh: function(mesh) {\r\n\r\n    if (mesh instanceof THREE.Mesh === false) {\r\n\r\n      THREE.error('THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.', mesh);\r\n      return;\r\n\r\n    }\r\n\r\n    mesh.matrixAutoUpdate && mesh.updateMatrix();\r\n\r\n    this.merge(mesh.geometry, mesh.matrix);\r\n\r\n  },\r\n\r\n  /*\r\n   * Checks for duplicate vertices with hashmap.\r\n   * Duplicated vertices are removed\r\n   * and faces' vertices are updated.\r\n   */\r\n\r\n  mergeVertices: function() {\r\n\r\n    var verticesMap = {}; // Hashmap for looking up vertice by position coordinates (and making sure they are unique)\r\n    var unique = [],\r\n      changes = [];\r\n\r\n    var v, key;\r\n    var precisionPoints = 4; // number of decimal points, eg. 4 for epsilon of 0.0001\r\n    var precision = Math.pow(10, precisionPoints);\r\n    var i, il, face;\r\n    var indices, j, jl;\r\n\r\n    for (i = 0, il = this.vertices.length; i < il; i++) {\r\n\r\n      v = this.vertices[i];\r\n      key = Math.round(v.x * precision) + '_' + Math.round(v.y * precision) + '_' + Math.round(v.z * precision);\r\n\r\n      if (verticesMap[key] === undefined) {\r\n\r\n        verticesMap[key] = i;\r\n        unique.push(this.vertices[i]);\r\n        changes[i] = unique.length - 1;\r\n\r\n      }\r\n      else {\r\n\r\n        //console.log('Duplicate vertex found. ', i, ' could be using ', verticesMap[key]);\r\n        changes[i] = changes[verticesMap[key]];\r\n\r\n      }\r\n\r\n    };\r\n\r\n\r\n    // if faces are completely degenerate after merging vertices, we\r\n    // have to remove them from the geometry.\r\n    var faceIndicesToRemove = [];\r\n\r\n    for (i = 0, il = this.faces.length; i < il; i++) {\r\n\r\n      face = this.faces[i];\r\n\r\n      face.a = changes[face.a];\r\n      face.b = changes[face.b];\r\n      face.c = changes[face.c];\r\n\r\n      indices = [face.a, face.b, face.c];\r\n\r\n      var dupIndex = -1;\r\n\r\n      // if any duplicate vertices are found in a Face3\r\n      // we have to remove the face as nothing can be saved\r\n      for (var n = 0; n < 3; n++) {\r\n        if (indices[n] == indices[(n + 1) % 3]) {\r\n\r\n          dupIndex = n;\r\n          faceIndicesToRemove.push(i);\r\n          break;\r\n\r\n        }\r\n      }\r\n\r\n    }\r\n\r\n    for (i = faceIndicesToRemove.length - 1; i >= 0; i--) {\r\n      var idx = faceIndicesToRemove[i];\r\n\r\n      this.faces.splice(idx, 1);\r\n\r\n      for (j = 0, jl = this.faceVertexUvs.length; j < jl; j++) {\r\n\r\n        this.faceVertexUvs[j].splice(idx, 1);\r\n\r\n      }\r\n\r\n    }\r\n\r\n    // Use unique set of vertices\r\n\r\n    var diff = this.vertices.length - unique.length;\r\n    this.vertices = unique;\r\n    return diff;\r\n\r\n  },\r\n\r\n  toJSON: function() {\r\n\r\n    var output = {\r\n      metadata: {\r\n        version: 4.0,\r\n        type: 'BufferGeometry',\r\n        generator: 'BufferGeometryExporter'\r\n      },\r\n      uuid: this.uuid,\r\n      type: this.type\r\n    };\r\n\r\n    if (this.name !== \"\") output.name = this.name;\r\n\r\n    if (this.parameters !== undefined) {\r\n\r\n      var parameters = this.parameters;\r\n\r\n      for (var key in parameters) {\r\n\r\n        if (parameters[key] !== undefined) output[key] = parameters[key];\r\n\r\n      }\r\n\r\n      return output;\r\n\r\n    }\r\n\r\n    var vertices = [];\r\n\r\n    for (var i = 0; i < this.vertices.length; i++) {\r\n\r\n      var vertex = this.vertices[i];\r\n      vertices.push(vertex.x, vertex.y, vertex.z);\r\n\r\n    }\r\n\r\n    var faces = [];\r\n    var normals = [];\r\n    var normalsHash = {};\r\n    var colors = [];\r\n    var colorsHash = {};\r\n    var uvs = [];\r\n    var uvsHash = {};\r\n\r\n    for (var i = 0; i < this.faces.length; i++) {\r\n\r\n      var face = this.faces[i];\r\n\r\n      var hasMaterial = false; // face.materialIndex !== undefined;\r\n      var hasFaceUv = false; // deprecated\r\n      var hasFaceVertexUv = this.faceVertexUvs[0][i] !== undefined;\r\n      var hasFaceNormal = face.normal.length() > 0;\r\n      var hasFaceVertexNormal = face.vertexNormals.length > 0;\r\n      var hasFaceColor = face.color.r !== 1 || face.color.g !== 1 || face.color.b !== 1;\r\n      var hasFaceVertexColor = face.vertexColors.length > 0;\r\n\r\n      var faceType = 0;\r\n\r\n      faceType = setBit(faceType, 0, 0);\r\n      faceType = setBit(faceType, 1, hasMaterial);\r\n      faceType = setBit(faceType, 2, hasFaceUv);\r\n      faceType = setBit(faceType, 3, hasFaceVertexUv);\r\n      faceType = setBit(faceType, 4, hasFaceNormal);\r\n      faceType = setBit(faceType, 5, hasFaceVertexNormal);\r\n      faceType = setBit(faceType, 6, hasFaceColor);\r\n      faceType = setBit(faceType, 7, hasFaceVertexColor);\r\n\r\n      faces.push(faceType);\r\n      faces.push(face.a, face.b, face.c);\r\n\r\n\r\n      /*\r\n      if ( hasMaterial ) {\r\n\r\n      \tfaces.push( face.materialIndex );\r\n\r\n      }\r\n      */\r\n\r\n      if (hasFaceVertexUv) {\r\n\r\n        var faceVertexUvs = this.faceVertexUvs[0][i];\r\n\r\n        faces.push(\r\n          getUvIndex(faceVertexUvs[0]),\r\n          getUvIndex(faceVertexUvs[1]),\r\n          getUvIndex(faceVertexUvs[2])\r\n        );\r\n\r\n      }\r\n\r\n      if (hasFaceNormal) {\r\n\r\n        faces.push(getNormalIndex(face.normal));\r\n\r\n      }\r\n\r\n      if (hasFaceVertexNormal) {\r\n\r\n        var vertexNormals = face.vertexNormals;\r\n\r\n        faces.push(\r\n          getNormalIndex(vertexNormals[0]),\r\n          getNormalIndex(vertexNormals[1]),\r\n          getNormalIndex(vertexNormals[2])\r\n        );\r\n\r\n      }\r\n\r\n      if (hasFaceColor) {\r\n\r\n        faces.push(getColorIndex(face.color));\r\n\r\n      }\r\n\r\n      if (hasFaceVertexColor) {\r\n\r\n        var vertexColors = face.vertexColors;\r\n\r\n        faces.push(\r\n          getColorIndex(vertexColors[0]),\r\n          getColorIndex(vertexColors[1]),\r\n          getColorIndex(vertexColors[2])\r\n        );\r\n\r\n      }\r\n\r\n    }\r\n\r\n    function setBit(value, position, enabled) {\r\n\r\n      return enabled ? value | (1 << position) : value & (~(1 << position));\r\n\r\n    }\r\n\r\n    function getNormalIndex(normal) {\r\n\r\n      var hash = normal.x.toString() + normal.y.toString() + normal.z.toString();\r\n\r\n      if (normalsHash[hash] !== undefined) {\r\n\r\n        return normalsHash[hash];\r\n\r\n      }\r\n\r\n      normalsHash[hash] = normals.length / 3;\r\n      normals.push(normal.x, normal.y, normal.z);\r\n\r\n      return normalsHash[hash];\r\n\r\n    }\r\n\r\n    function getColorIndex(color) {\r\n\r\n      var hash = color.r.toString() + color.g.toString() + color.b.toString();\r\n\r\n      if (colorsHash[hash] !== undefined) {\r\n\r\n        return colorsHash[hash];\r\n\r\n      }\r\n\r\n      colorsHash[hash] = colors.length;\r\n      colors.push(color.getHex());\r\n\r\n      return colorsHash[hash];\r\n\r\n    }\r\n\r\n    function getUvIndex(uv) {\r\n\r\n      var hash = uv.x.toString() + uv.y.toString();\r\n\r\n      if (uvsHash[hash] !== undefined) {\r\n\r\n        return uvsHash[hash];\r\n\r\n      }\r\n\r\n      uvsHash[hash] = uvs.length / 2;\r\n      uvs.push(uv.x, uv.y);\r\n\r\n      return uvsHash[hash];\r\n\r\n    }\r\n\r\n    output.data = {};\r\n\r\n    output.data.vertices = vertices;\r\n    output.data.normals = normals;\r\n    if (colors.length > 0) output.data.colors = colors;\r\n    if (uvs.length > 0) output.data.uvs = [uvs]; // temporal backward compatibility\r\n    output.data.faces = faces;\r\n\r\n    //\r\n\r\n    return output;\r\n\r\n  },\r\n\r\n  clone: function() {\r\n\r\n    var geometry = new THREE.Geometry();\r\n\r\n    var vertices = this.vertices;\r\n\r\n    for (var i = 0, il = vertices.length; i < il; i++) {\r\n\r\n      geometry.vertices.push(vertices[i].clone());\r\n\r\n    }\r\n\r\n    var faces = this.faces;\r\n\r\n    for (var i = 0, il = faces.length; i < il; i++) {\r\n\r\n      geometry.faces.push(faces[i].clone());\r\n\r\n    }\r\n\r\n    for (var i = 0, il = this.faceVertexUvs.length; i < il; i++) {\r\n\r\n      var faceVertexUvs = this.faceVertexUvs[i];\r\n\r\n      if (geometry.faceVertexUvs[i] === undefined) {\r\n\r\n        geometry.faceVertexUvs[i] = [];\r\n\r\n      }\r\n\r\n      for (var j = 0, jl = faceVertexUvs.length; j < jl; j++) {\r\n\r\n        var uvs = faceVertexUvs[j],\r\n          uvsCopy = [];\r\n\r\n        for (var k = 0, kl = uvs.length; k < kl; k++) {\r\n\r\n          var uv = uvs[k];\r\n\r\n          uvsCopy.push(uv.clone());\r\n\r\n        }\r\n\r\n        geometry.faceVertexUvs[i].push(uvsCopy);\r\n\r\n      }\r\n\r\n    }\r\n\r\n    return geometry;\r\n\r\n  },\r\n\r\n  dispose: function() {\r\n\r\n    this.dispatchEvent({\r\n      type: 'dispose'\r\n    });\r\n\r\n  }\r\n\r\n};\r\n\r\nTHREE.EventDispatcher.prototype.apply(THREE.Geometry.prototype);\r\n\r\nTHREE.GeometryIdCount = 0;\r\n\r\n// File:src/cameras/Camera.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author mikael emtinger / http://gomo.se/\r\n * @author WestLangley / http://github.com/WestLangley\r\n */\r\n\r\nTHREE.Camera = function() {\r\n\r\n  THREE.Object3D.call(this);\r\n\r\n  this.type = 'Camera';\r\n\r\n  this.matrixWorldInverse = new THREE.Matrix4();\r\n  this.projectionMatrix = new THREE.Matrix4();\r\n\r\n};\r\n\r\nTHREE.Camera.prototype = Object.create(THREE.Object3D.prototype);\r\nTHREE.Camera.prototype.constructor = THREE.Camera;\r\n\r\nTHREE.Camera.prototype.getWorldDirection = function() {\r\n\r\n  var quaternion = new THREE.Quaternion();\r\n\r\n  return function(optionalTarget) {\r\n\r\n    var result = optionalTarget || new THREE.Vector3();\r\n\r\n    this.getWorldQuaternion(quaternion);\r\n\r\n    return result.set(0, 0, -1).applyQuaternion(quaternion);\r\n\r\n  }\r\n\r\n}();\r\n\r\nTHREE.Camera.prototype.lookAt = function() {\r\n\r\n  // This routine does not support cameras with rotated and/or translated parent(s)\r\n\r\n  var m1 = new THREE.Matrix4();\r\n\r\n  return function(vector) {\r\n\r\n    m1.lookAt(this.position, vector, this.up);\r\n\r\n    this.quaternion.setFromRotationMatrix(m1);\r\n\r\n  };\r\n\r\n}();\r\n\r\nTHREE.Camera.prototype.clone = function(camera) {\r\n\r\n  if (camera === undefined) camera = new THREE.Camera();\r\n\r\n  THREE.Object3D.prototype.clone.call(this, camera);\r\n\r\n  camera.matrixWorldInverse.copy(this.matrixWorldInverse);\r\n  camera.projectionMatrix.copy(this.projectionMatrix);\r\n\r\n  return camera;\r\n};\r\n\r\n// File:src/cameras/CubeCamera.js\r\n\r\n/**\r\n * Camera for rendering cube maps\r\n *\t- renders scene into axis-aligned cube\r\n *\r\n * @author alteredq / http://alteredqualia.com/\r\n */\r\n\r\nTHREE.CubeCamera = function(near, far, cubeResolution) {\r\n\r\n  THREE.Object3D.call(this);\r\n\r\n  this.type = 'CubeCamera';\r\n\r\n  var fov = 90,\r\n    aspect = 1;\r\n\r\n  var cameraPX = new THREE.PerspectiveCamera(fov, aspect, near, far);\r\n  cameraPX.up.set(0, -1, 0);\r\n  cameraPX.lookAt(new THREE.Vector3(1, 0, 0));\r\n  this.add(cameraPX);\r\n\r\n  var cameraNX = new THREE.PerspectiveCamera(fov, aspect, near, far);\r\n  cameraNX.up.set(0, -1, 0);\r\n  cameraNX.lookAt(new THREE.Vector3(-1, 0, 0));\r\n  this.add(cameraNX);\r\n\r\n  var cameraPY = new THREE.PerspectiveCamera(fov, aspect, near, far);\r\n  cameraPY.up.set(0, 0, 1);\r\n  cameraPY.lookAt(new THREE.Vector3(0, 1, 0));\r\n  this.add(cameraPY);\r\n\r\n  var cameraNY = new THREE.PerspectiveCamera(fov, aspect, near, far);\r\n  cameraNY.up.set(0, 0, -1);\r\n  cameraNY.lookAt(new THREE.Vector3(0, -1, 0));\r\n  this.add(cameraNY);\r\n\r\n  var cameraPZ = new THREE.PerspectiveCamera(fov, aspect, near, far);\r\n  cameraPZ.up.set(0, -1, 0);\r\n  cameraPZ.lookAt(new THREE.Vector3(0, 0, 1));\r\n  this.add(cameraPZ);\r\n\r\n  var cameraNZ = new THREE.PerspectiveCamera(fov, aspect, near, far);\r\n  cameraNZ.up.set(0, -1, 0);\r\n  cameraNZ.lookAt(new THREE.Vector3(0, 0, -1));\r\n  this.add(cameraNZ);\r\n\r\n  this.renderTarget = new THREE.WebGLRenderTargetCube(cubeResolution, cubeResolution, {\r\n    format: THREE.RGBFormat,\r\n    magFilter: THREE.LinearFilter,\r\n    minFilter: THREE.LinearFilter\r\n  });\r\n\r\n  this.updateCubeMap = function(renderer, scene) {\r\n\r\n    var renderTarget = this.renderTarget;\r\n    var generateMipmaps = renderTarget.generateMipmaps;\r\n\r\n    renderTarget.generateMipmaps = false;\r\n\r\n    renderTarget.activeCubeFace = 0;\r\n    renderer.render(scene, cameraPX, renderTarget);\r\n\r\n    renderTarget.activeCubeFace = 1;\r\n    renderer.render(scene, cameraNX, renderTarget);\r\n\r\n    renderTarget.activeCubeFace = 2;\r\n    renderer.render(scene, cameraPY, renderTarget);\r\n\r\n    renderTarget.activeCubeFace = 3;\r\n    renderer.render(scene, cameraNY, renderTarget);\r\n\r\n    renderTarget.activeCubeFace = 4;\r\n    renderer.render(scene, cameraPZ, renderTarget);\r\n\r\n    renderTarget.generateMipmaps = generateMipmaps;\r\n\r\n    renderTarget.activeCubeFace = 5;\r\n    renderer.render(scene, cameraNZ, renderTarget);\r\n\r\n  };\r\n\r\n};\r\n\r\nTHREE.CubeCamera.prototype = Object.create(THREE.Object3D.prototype);\r\nTHREE.CubeCamera.prototype.constructor = THREE.CubeCamera;\r\n\r\n// File:src/cameras/OrthographicCamera.js\r\n\r\n/**\r\n * @author alteredq / http://alteredqualia.com/\r\n */\r\n\r\nTHREE.OrthographicCamera = function(left, right, top, bottom, near, far) {\r\n\r\n  THREE.Camera.call(this);\r\n\r\n  this.type = 'OrthographicCamera';\r\n\r\n  this.zoom = 1;\r\n\r\n  this.left = left;\r\n  this.right = right;\r\n  this.top = top;\r\n  this.bottom = bottom;\r\n\r\n  this.near = (near !== undefined) ? near : 0.1;\r\n  this.far = (far !== undefined) ? far : 2000;\r\n\r\n  this.updateProjectionMatrix();\r\n\r\n};\r\n\r\nTHREE.OrthographicCamera.prototype = Object.create(THREE.Camera.prototype);\r\nTHREE.OrthographicCamera.prototype.constructor = THREE.OrthographicCamera;\r\n\r\nTHREE.OrthographicCamera.prototype.updateProjectionMatrix = function() {\r\n\r\n  var dx = (this.right - this.left) / (2 * this.zoom);\r\n  var dy = (this.top - this.bottom) / (2 * this.zoom);\r\n  var cx = (this.right + this.left) / 2;\r\n  var cy = (this.top + this.bottom) / 2;\r\n\r\n  this.projectionMatrix.makeOrthographic(cx - dx, cx + dx, cy + dy, cy - dy, this.near, this.far);\r\n\r\n};\r\n\r\nTHREE.OrthographicCamera.prototype.clone = function() {\r\n\r\n  var camera = new THREE.OrthographicCamera();\r\n\r\n  THREE.Camera.prototype.clone.call(this, camera);\r\n\r\n  camera.zoom = this.zoom;\r\n\r\n  camera.left = this.left;\r\n  camera.right = this.right;\r\n  camera.top = this.top;\r\n  camera.bottom = this.bottom;\r\n\r\n  camera.near = this.near;\r\n  camera.far = this.far;\r\n\r\n  camera.projectionMatrix.copy(this.projectionMatrix);\r\n\r\n  return camera;\r\n};\r\n\r\n// File:src/cameras/PerspectiveCamera.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author greggman / http://games.greggman.com/\r\n * @author zz85 / http://www.lab4games.net/zz85/blog\r\n */\r\n\r\nTHREE.PerspectiveCamera = function(fov, aspect, near, far) {\r\n\r\n  THREE.Camera.call(this);\r\n\r\n  this.type = 'PerspectiveCamera';\r\n\r\n  this.zoom = 1;\r\n\r\n  this.fov = fov !== undefined ? fov : 50;\r\n  this.aspect = aspect !== undefined ? aspect : 1;\r\n  this.near = near !== undefined ? near : 0.1;\r\n  this.far = far !== undefined ? far : 2000;\r\n\r\n  this.updateProjectionMatrix();\r\n\r\n};\r\n\r\nTHREE.PerspectiveCamera.prototype = Object.create(THREE.Camera.prototype);\r\nTHREE.PerspectiveCamera.prototype.constructor = THREE.PerspectiveCamera;\r\n\r\n\r\n/**\r\n * Uses Focal Length (in mm) to estimate and set FOV\r\n * 35mm (fullframe) camera is used if frame size is not specified;\r\n * Formula based on http://www.bobatkins.com/photography/technical/field_of_view.html\r\n */\r\n\r\nTHREE.PerspectiveCamera.prototype.setLens = function(focalLength, frameHeight) {\r\n\r\n  if (frameHeight === undefined) frameHeight = 24;\r\n\r\n  this.fov = 2 * THREE.Math.radToDeg(Math.atan(frameHeight / (focalLength * 2)));\r\n  this.updateProjectionMatrix();\r\n\r\n}\r\n\r\n\r\n/**\r\n * Sets an offset in a larger frustum. This is useful for multi-window or\r\n * multi-monitor/multi-machine setups.\r\n *\r\n * For example, if you have 3x2 monitors and each monitor is 1920x1080 and\r\n * the monitors are in grid like this\r\n *\r\n *   +---+---+---+\r\n *   | A | B | C |\r\n *   +---+---+---+\r\n *   | D | E | F |\r\n *   +---+---+---+\r\n *\r\n * then for each monitor you would call it like this\r\n *\r\n *   var w = 1920;\r\n *   var h = 1080;\r\n *   var fullWidth = w * 3;\r\n *   var fullHeight = h * 2;\r\n *\r\n *   --A--\r\n *   camera.setOffset( fullWidth, fullHeight, w * 0, h * 0, w, h );\r\n *   --B--\r\n *   camera.setOffset( fullWidth, fullHeight, w * 1, h * 0, w, h );\r\n *   --C--\r\n *   camera.setOffset( fullWidth, fullHeight, w * 2, h * 0, w, h );\r\n *   --D--\r\n *   camera.setOffset( fullWidth, fullHeight, w * 0, h * 1, w, h );\r\n *   --E--\r\n *   camera.setOffset( fullWidth, fullHeight, w * 1, h * 1, w, h );\r\n *   --F--\r\n *   camera.setOffset( fullWidth, fullHeight, w * 2, h * 1, w, h );\r\n *\r\n *   Note there is no reason monitors have to be the same size or in a grid.\r\n */\r\n\r\nTHREE.PerspectiveCamera.prototype.setViewOffset = function(fullWidth, fullHeight, x, y, width, height) {\r\n\r\n  this.fullWidth = fullWidth;\r\n  this.fullHeight = fullHeight;\r\n  this.x = x;\r\n  this.y = y;\r\n  this.width = width;\r\n  this.height = height;\r\n\r\n  this.updateProjectionMatrix();\r\n\r\n};\r\n\r\n\r\nTHREE.PerspectiveCamera.prototype.updateProjectionMatrix = function() {\r\n\r\n  var fov = THREE.Math.radToDeg(2 * Math.atan(Math.tan(THREE.Math.degToRad(this.fov) * 0.5) / this.zoom));\r\n\r\n  if (this.fullWidth) {\r\n\r\n    var aspect = this.fullWidth / this.fullHeight;\r\n    var top = Math.tan(THREE.Math.degToRad(fov * 0.5)) * this.near;\r\n    var bottom = -top;\r\n    var left = aspect * bottom;\r\n    var right = aspect * top;\r\n    var width = Math.abs(right - left);\r\n    var height = Math.abs(top - bottom);\r\n\r\n    this.projectionMatrix.makeFrustum(\r\n      left + this.x * width / this.fullWidth,\r\n      left + (this.x + this.width) * width / this.fullWidth,\r\n      top - (this.y + this.height) * height / this.fullHeight,\r\n      top - this.y * height / this.fullHeight,\r\n      this.near,\r\n      this.far\r\n    );\r\n\r\n  }\r\n  else {\r\n\r\n    this.projectionMatrix.makePerspective(fov, this.aspect, this.near, this.far);\r\n\r\n  }\r\n\r\n};\r\n\r\nTHREE.PerspectiveCamera.prototype.clone = function() {\r\n\r\n  var camera = new THREE.PerspectiveCamera();\r\n\r\n  THREE.Camera.prototype.clone.call(this, camera);\r\n\r\n  camera.zoom = this.zoom;\r\n\r\n  camera.fov = this.fov;\r\n  camera.aspect = this.aspect;\r\n  camera.near = this.near;\r\n  camera.far = this.far;\r\n\r\n  camera.projectionMatrix.copy(this.projectionMatrix);\r\n\r\n  return camera;\r\n\r\n};\r\n\r\n// File:src/lights/Light.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author alteredq / http://alteredqualia.com/\r\n */\r\n\r\nTHREE.Light = function(color) {\r\n\r\n  THREE.Object3D.call(this);\r\n\r\n  this.type = 'Light';\r\n\r\n  this.color = new THREE.Color(color);\r\n\r\n};\r\n\r\nTHREE.Light.prototype = Object.create(THREE.Object3D.prototype);\r\nTHREE.Light.prototype.constructor = THREE.Light;\r\n\r\nTHREE.Light.prototype.clone = function(light) {\r\n\r\n  if (light === undefined) light = new THREE.Light();\r\n\r\n  THREE.Object3D.prototype.clone.call(this, light);\r\n\r\n  light.color.copy(this.color);\r\n\r\n  return light;\r\n\r\n};\r\n\r\n// File:src/lights/AmbientLight.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.AmbientLight = function(color) {\r\n\r\n  THREE.Light.call(this, color);\r\n\r\n  this.type = 'AmbientLight';\r\n\r\n};\r\n\r\nTHREE.AmbientLight.prototype = Object.create(THREE.Light.prototype);\r\nTHREE.AmbientLight.prototype.constructor = THREE.AmbientLight;\r\n\r\nTHREE.AmbientLight.prototype.clone = function() {\r\n\r\n  var light = new THREE.AmbientLight();\r\n\r\n  THREE.Light.prototype.clone.call(this, light);\r\n\r\n  return light;\r\n\r\n};\r\n\r\n// File:src/lights/AreaLight.js\r\n\r\n/**\r\n * @author MPanknin / http://www.redplant.de/\r\n * @author alteredq / http://alteredqualia.com/\r\n */\r\n\r\nTHREE.AreaLight = function(color, intensity) {\r\n\r\n  THREE.Light.call(this, color);\r\n\r\n  this.type = 'AreaLight';\r\n\r\n  this.normal = new THREE.Vector3(0, -1, 0);\r\n  this.right = new THREE.Vector3(1, 0, 0);\r\n\r\n  this.intensity = (intensity !== undefined) ? intensity : 1;\r\n\r\n  this.width = 1.0;\r\n  this.height = 1.0;\r\n\r\n  this.constantAttenuation = 1.5;\r\n  this.linearAttenuation = 0.5;\r\n  this.quadraticAttenuation = 0.1;\r\n\r\n};\r\n\r\nTHREE.AreaLight.prototype = Object.create(THREE.Light.prototype);\r\nTHREE.AreaLight.prototype.constructor = THREE.AreaLight;\r\n\r\n\r\n// File:src/lights/DirectionalLight.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author alteredq / http://alteredqualia.com/\r\n */\r\n\r\nTHREE.DirectionalLight = function(color, intensity) {\r\n\r\n  THREE.Light.call(this, color);\r\n\r\n  this.type = 'DirectionalLight';\r\n\r\n  this.position.set(0, 1, 0);\r\n  this.target = new THREE.Object3D();\r\n\r\n  this.intensity = (intensity !== undefined) ? intensity : 1;\r\n\r\n  this.castShadow = false;\r\n  this.onlyShadow = false;\r\n\r\n  //\r\n\r\n  this.shadowCameraNear = 50;\r\n  this.shadowCameraFar = 5000;\r\n\r\n  this.shadowCameraLeft = -500;\r\n  this.shadowCameraRight = 500;\r\n  this.shadowCameraTop = 500;\r\n  this.shadowCameraBottom = -500;\r\n\r\n  this.shadowCameraVisible = false;\r\n\r\n  this.shadowBias = 0;\r\n  this.shadowDarkness = 0.5;\r\n\r\n  this.shadowMapWidth = 512;\r\n  this.shadowMapHeight = 512;\r\n\r\n  //\r\n\r\n  this.shadowCascade = false;\r\n\r\n  this.shadowCascadeOffset = new THREE.Vector3(0, 0, -1000);\r\n  this.shadowCascadeCount = 2;\r\n\r\n  this.shadowCascadeBias = [0, 0, 0];\r\n  this.shadowCascadeWidth = [512, 512, 512];\r\n  this.shadowCascadeHeight = [512, 512, 512];\r\n\r\n  this.shadowCascadeNearZ = [-1.000, 0.990, 0.998];\r\n  this.shadowCascadeFarZ = [0.990, 0.998, 1.000];\r\n\r\n  this.shadowCascadeArray = [];\r\n\r\n  //\r\n\r\n  this.shadowMap = null;\r\n  this.shadowMapSize = null;\r\n  this.shadowCamera = null;\r\n  this.shadowMatrix = null;\r\n\r\n};\r\n\r\nTHREE.DirectionalLight.prototype = Object.create(THREE.Light.prototype);\r\nTHREE.DirectionalLight.prototype.constructor = THREE.DirectionalLight;\r\n\r\nTHREE.DirectionalLight.prototype.clone = function() {\r\n\r\n  var light = new THREE.DirectionalLight();\r\n\r\n  THREE.Light.prototype.clone.call(this, light);\r\n\r\n  light.target = this.target.clone();\r\n\r\n  light.intensity = this.intensity;\r\n\r\n  light.castShadow = this.castShadow;\r\n  light.onlyShadow = this.onlyShadow;\r\n\r\n  //\r\n\r\n  light.shadowCameraNear = this.shadowCameraNear;\r\n  light.shadowCameraFar = this.shadowCameraFar;\r\n\r\n  light.shadowCameraLeft = this.shadowCameraLeft;\r\n  light.shadowCameraRight = this.shadowCameraRight;\r\n  light.shadowCameraTop = this.shadowCameraTop;\r\n  light.shadowCameraBottom = this.shadowCameraBottom;\r\n\r\n  light.shadowCameraVisible = this.shadowCameraVisible;\r\n\r\n  light.shadowBias = this.shadowBias;\r\n  light.shadowDarkness = this.shadowDarkness;\r\n\r\n  light.shadowMapWidth = this.shadowMapWidth;\r\n  light.shadowMapHeight = this.shadowMapHeight;\r\n\r\n  //\r\n\r\n  light.shadowCascade = this.shadowCascade;\r\n\r\n  light.shadowCascadeOffset.copy(this.shadowCascadeOffset);\r\n  light.shadowCascadeCount = this.shadowCascadeCount;\r\n\r\n  light.shadowCascadeBias = this.shadowCascadeBias.slice(0);\r\n  light.shadowCascadeWidth = this.shadowCascadeWidth.slice(0);\r\n  light.shadowCascadeHeight = this.shadowCascadeHeight.slice(0);\r\n\r\n  light.shadowCascadeNearZ = this.shadowCascadeNearZ.slice(0);\r\n  light.shadowCascadeFarZ = this.shadowCascadeFarZ.slice(0);\r\n\r\n  return light;\r\n\r\n};\r\n\r\n// File:src/lights/HemisphereLight.js\r\n\r\n/**\r\n * @author alteredq / http://alteredqualia.com/\r\n */\r\n\r\nTHREE.HemisphereLight = function(skyColor, groundColor, intensity) {\r\n\r\n  THREE.Light.call(this, skyColor);\r\n\r\n  this.type = 'HemisphereLight';\r\n\r\n  this.position.set(0, 100, 0);\r\n\r\n  this.groundColor = new THREE.Color(groundColor);\r\n  this.intensity = (intensity !== undefined) ? intensity : 1;\r\n\r\n};\r\n\r\nTHREE.HemisphereLight.prototype = Object.create(THREE.Light.prototype);\r\nTHREE.HemisphereLight.prototype.constructor = THREE.HemisphereLight;\r\n\r\nTHREE.HemisphereLight.prototype.clone = function() {\r\n\r\n  var light = new THREE.HemisphereLight();\r\n\r\n  THREE.Light.prototype.clone.call(this, light);\r\n\r\n  light.groundColor.copy(this.groundColor);\r\n  light.intensity = this.intensity;\r\n\r\n  return light;\r\n\r\n};\r\n\r\n// File:src/lights/PointLight.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.PointLight = function(color, intensity, distance, decay) {\r\n\r\n  THREE.Light.call(this, color);\r\n\r\n  this.type = 'PointLight';\r\n\r\n  this.intensity = (intensity !== undefined) ? intensity : 1;\r\n  this.distance = (distance !== undefined) ? distance : 0;\r\n  this.decay = (decay !== undefined) ? decay : 1; // for physically correct lights, should be 2.\r\n\r\n};\r\n\r\nTHREE.PointLight.prototype = Object.create(THREE.Light.prototype);\r\nTHREE.PointLight.prototype.constructor = THREE.PointLight;\r\n\r\nTHREE.PointLight.prototype.clone = function() {\r\n\r\n  var light = new THREE.PointLight();\r\n\r\n  THREE.Light.prototype.clone.call(this, light);\r\n\r\n  light.intensity = this.intensity;\r\n  light.distance = this.distance;\r\n  light.decay = this.decay;\r\n\r\n  return light;\r\n\r\n};\r\n\r\n// File:src/lights/SpotLight.js\r\n\r\n/**\r\n * @author alteredq / http://alteredqualia.com/\r\n */\r\n\r\nTHREE.SpotLight = function(color, intensity, distance, angle, exponent, decay) {\r\n\r\n  THREE.Light.call(this, color);\r\n\r\n  this.type = 'SpotLight';\r\n\r\n  this.position.set(0, 1, 0);\r\n  this.target = new THREE.Object3D();\r\n\r\n  this.intensity = (intensity !== undefined) ? intensity : 1;\r\n  this.distance = (distance !== undefined) ? distance : 0;\r\n  this.angle = (angle !== undefined) ? angle : Math.PI / 3;\r\n  this.exponent = (exponent !== undefined) ? exponent : 10;\r\n  this.decay = (decay !== undefined) ? decay : 1; // for physically correct lights, should be 2.\r\n\r\n  this.castShadow = false;\r\n  this.onlyShadow = false;\r\n\r\n  //\r\n\r\n  this.shadowCameraNear = 50;\r\n  this.shadowCameraFar = 5000;\r\n  this.shadowCameraFov = 50;\r\n\r\n  this.shadowCameraVisible = false;\r\n\r\n  this.shadowBias = 0;\r\n  this.shadowDarkness = 0.5;\r\n\r\n  this.shadowMapWidth = 512;\r\n  this.shadowMapHeight = 512;\r\n\r\n  //\r\n\r\n  this.shadowMap = null;\r\n  this.shadowMapSize = null;\r\n  this.shadowCamera = null;\r\n  this.shadowMatrix = null;\r\n\r\n};\r\n\r\nTHREE.SpotLight.prototype = Object.create(THREE.Light.prototype);\r\nTHREE.SpotLight.prototype.constructor = THREE.SpotLight;\r\n\r\nTHREE.SpotLight.prototype.clone = function() {\r\n\r\n  var light = new THREE.SpotLight();\r\n\r\n  THREE.Light.prototype.clone.call(this, light);\r\n\r\n  light.target = this.target.clone();\r\n\r\n  light.intensity = this.intensity;\r\n  light.distance = this.distance;\r\n  light.angle = this.angle;\r\n  light.exponent = this.exponent;\r\n  light.decay = this.decay;\r\n\r\n  light.castShadow = this.castShadow;\r\n  light.onlyShadow = this.onlyShadow;\r\n\r\n  //\r\n\r\n  light.shadowCameraNear = this.shadowCameraNear;\r\n  light.shadowCameraFar = this.shadowCameraFar;\r\n  light.shadowCameraFov = this.shadowCameraFov;\r\n\r\n  light.shadowCameraVisible = this.shadowCameraVisible;\r\n\r\n  light.shadowBias = this.shadowBias;\r\n  light.shadowDarkness = this.shadowDarkness;\r\n\r\n  light.shadowMapWidth = this.shadowMapWidth;\r\n  light.shadowMapHeight = this.shadowMapHeight;\r\n\r\n  return light;\r\n\r\n};\r\n\r\n// File:src/loaders/Cache.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.Cache = {\r\n\r\n  files: {},\r\n\r\n  add: function(key, file) {\r\n\r\n    // console.log( 'THREE.Cache', 'Adding key:', key );\r\n\r\n    this.files[key] = file;\r\n\r\n  },\r\n\r\n  get: function(key) {\r\n\r\n    // console.log( 'THREE.Cache', 'Checking key:', key );\r\n\r\n    return this.files[key];\r\n\r\n  },\r\n\r\n  remove: function(key) {\r\n\r\n    delete this.files[key];\r\n\r\n  },\r\n\r\n  clear: function() {\r\n\r\n    this.files = {}\r\n\r\n  }\r\n\r\n};\r\n\r\n// File:src/loaders/Loader.js\r\n\r\n/**\r\n * @author alteredq / http://alteredqualia.com/\r\n */\r\n\r\nTHREE.Loader = function(showStatus) {\r\n\r\n  this.showStatus = showStatus;\r\n  this.statusDomElement = showStatus ? THREE.Loader.prototype.addStatusElement() : null;\r\n\r\n  this.imageLoader = new THREE.ImageLoader();\r\n\r\n  this.onLoadStart = function() {};\r\n  this.onLoadProgress = function() {};\r\n  this.onLoadComplete = function() {};\r\n\r\n};\r\n\r\nTHREE.Loader.prototype = {\r\n\r\n  constructor: THREE.Loader,\r\n\r\n  crossOrigin: undefined,\r\n\r\n  addStatusElement: function() {\r\n\r\n    var e = document.createElement('div');\r\n\r\n    e.style.position = 'absolute';\r\n    e.style.right = '0px';\r\n    e.style.top = '0px';\r\n    e.style.fontSize = '0.8em';\r\n    e.style.textAlign = 'left';\r\n    e.style.background = 'rgba(0,0,0,0.25)';\r\n    e.style.color = '#fff';\r\n    e.style.width = '120px';\r\n    e.style.padding = '0.5em 0.5em 0.5em 0.5em';\r\n    e.style.zIndex = 1000;\r\n\r\n    e.innerHTML = 'Loading ...';\r\n\r\n    return e;\r\n\r\n  },\r\n\r\n  updateProgress: function(progress) {\r\n\r\n    var message = 'Loaded ';\r\n\r\n    if (progress.total) {\r\n\r\n      message += (100 * progress.loaded / progress.total).toFixed(0) + '%';\r\n\r\n\r\n    }\r\n    else {\r\n\r\n      message += (progress.loaded / 1024).toFixed(2) + ' KB';\r\n\r\n    }\r\n\r\n    this.statusDomElement.innerHTML = message;\r\n\r\n  },\r\n\r\n  extractUrlBase: function(url) {\r\n\r\n    var parts = url.split('/');\r\n\r\n    if (parts.length === 1) return './';\r\n\r\n    parts.pop();\r\n\r\n    return parts.join('/') + '/';\r\n\r\n  },\r\n\r\n  initMaterials: function(materials, texturePath) {\r\n\r\n    var array = [];\r\n\r\n    for (var i = 0; i < materials.length; ++i) {\r\n\r\n      array[i] = this.createMaterial(materials[i], texturePath);\r\n\r\n    }\r\n\r\n    return array;\r\n\r\n  },\r\n\r\n  needsTangents: function(materials) {\r\n\r\n    for (var i = 0, il = materials.length; i < il; i++) {\r\n\r\n      var m = materials[i];\r\n\r\n      if (m instanceof THREE.ShaderMaterial) return true;\r\n\r\n    }\r\n\r\n    return false;\r\n\r\n  },\r\n\r\n  createMaterial: function(m, texturePath) {\r\n\r\n    var scope = this;\r\n\r\n    function nearest_pow2(n) {\r\n\r\n      var l = Math.log(n) / Math.LN2;\r\n      return Math.pow(2, Math.round(l));\r\n\r\n    }\r\n\r\n    function create_texture(where, name, sourceFile, repeat, offset, wrap, anisotropy) {\r\n\r\n      var fullPath = texturePath + sourceFile;\r\n\r\n      var texture;\r\n\r\n      var loader = THREE.Loader.Handlers.get(fullPath);\r\n\r\n      if (loader !== null) {\r\n\r\n        texture = loader.load(fullPath);\r\n\r\n      }\r\n      else {\r\n\r\n        texture = new THREE.Texture();\r\n\r\n        loader = scope.imageLoader;\r\n        loader.crossOrigin = scope.crossOrigin;\r\n        loader.load(fullPath, function(image) {\r\n\r\n          if (THREE.Math.isPowerOfTwo(image.width) === false ||\r\n            THREE.Math.isPowerOfTwo(image.height) === false) {\r\n\r\n            var width = nearest_pow2(image.width);\r\n            var height = nearest_pow2(image.height);\r\n\r\n            var canvas = document.createElement('canvas');\r\n            canvas.width = width;\r\n            canvas.height = height;\r\n\r\n            var context = canvas.getContext('2d');\r\n            context.drawImage(image, 0, 0, width, height);\r\n\r\n            texture.image = canvas;\r\n\r\n          }\r\n          else {\r\n\r\n            texture.image = image;\r\n\r\n          }\r\n\r\n          texture.needsUpdate = true;\r\n\r\n        });\r\n\r\n      }\r\n\r\n      texture.sourceFile = sourceFile;\r\n\r\n      if (repeat) {\r\n\r\n        texture.repeat.set(repeat[0], repeat[1]);\r\n\r\n        if (repeat[0] !== 1) texture.wrapS = THREE.RepeatWrapping;\r\n        if (repeat[1] !== 1) texture.wrapT = THREE.RepeatWrapping;\r\n\r\n      }\r\n\r\n      if (offset) {\r\n\r\n        texture.offset.set(offset[0], offset[1]);\r\n\r\n      }\r\n\r\n      if (wrap) {\r\n\r\n        var wrapMap = {\r\n          'repeat': THREE.RepeatWrapping,\r\n          'mirror': THREE.MirroredRepeatWrapping\r\n        }\r\n\r\n        if (wrapMap[wrap[0]] !== undefined) texture.wrapS = wrapMap[wrap[0]];\r\n        if (wrapMap[wrap[1]] !== undefined) texture.wrapT = wrapMap[wrap[1]];\r\n\r\n      }\r\n\r\n      if (anisotropy) {\r\n\r\n        texture.anisotropy = anisotropy;\r\n\r\n      }\r\n\r\n      where[name] = texture;\r\n\r\n    }\r\n\r\n    function rgb2hex(rgb) {\r\n\r\n      return (rgb[0] * 255 << 16) + (rgb[1] * 255 << 8) + rgb[2] * 255;\r\n\r\n    }\r\n\r\n    // defaults\r\n\r\n    var mtype = 'MeshLambertMaterial';\r\n    var mpars = {\r\n      color: 0xeeeeee,\r\n      opacity: 1.0,\r\n      map: null,\r\n      lightMap: null,\r\n      normalMap: null,\r\n      bumpMap: null,\r\n      wireframe: false\r\n    };\r\n\r\n    // parameters from model file\r\n\r\n    if (m.shading) {\r\n\r\n      var shading = m.shading.toLowerCase();\r\n\r\n      if (shading === 'phong') mtype = 'MeshPhongMaterial';\r\n      else if (shading === 'basic') mtype = 'MeshBasicMaterial';\r\n\r\n    }\r\n\r\n    if (m.blending !== undefined && THREE[m.blending] !== undefined) {\r\n\r\n      mpars.blending = THREE[m.blending];\r\n\r\n    }\r\n\r\n    if (m.transparent !== undefined) {\r\n\r\n      mpars.transparent = m.transparent;\r\n\r\n    }\r\n\r\n    if (m.opacity !== undefined && m.opacity < 1.0) {\r\n\r\n      mpars.transparent = true;\r\n\r\n    }\r\n\r\n    if (m.depthTest !== undefined) {\r\n\r\n      mpars.depthTest = m.depthTest;\r\n\r\n    }\r\n\r\n    if (m.depthWrite !== undefined) {\r\n\r\n      mpars.depthWrite = m.depthWrite;\r\n\r\n    }\r\n\r\n    if (m.visible !== undefined) {\r\n\r\n      mpars.visible = m.visible;\r\n\r\n    }\r\n\r\n    if (m.flipSided !== undefined) {\r\n\r\n      mpars.side = THREE.BackSide;\r\n\r\n    }\r\n\r\n    if (m.doubleSided !== undefined) {\r\n\r\n      mpars.side = THREE.DoubleSide;\r\n\r\n    }\r\n\r\n    if (m.wireframe !== undefined) {\r\n\r\n      mpars.wireframe = m.wireframe;\r\n\r\n    }\r\n\r\n    if (m.vertexColors !== undefined) {\r\n\r\n      if (m.vertexColors === 'face') {\r\n\r\n        mpars.vertexColors = THREE.FaceColors;\r\n\r\n      }\r\n      else if (m.vertexColors) {\r\n\r\n        mpars.vertexColors = THREE.VertexColors;\r\n\r\n      }\r\n\r\n    }\r\n\r\n    // colors\r\n\r\n    if (m.colorDiffuse) {\r\n\r\n      mpars.color = rgb2hex(m.colorDiffuse);\r\n\r\n    }\r\n    else if (m.DbgColor) {\r\n\r\n      mpars.color = m.DbgColor;\r\n\r\n    }\r\n\r\n    if (m.colorSpecular) {\r\n\r\n      mpars.specular = rgb2hex(m.colorSpecular);\r\n\r\n    }\r\n\r\n    if (m.colorEmissive) {\r\n\r\n      mpars.emissive = rgb2hex(m.colorEmissive);\r\n\r\n    }\r\n\r\n    // modifiers\r\n\r\n    if (m.transparency !== undefined) {\r\n\r\n      console.warn('THREE.Loader: transparency has been renamed to opacity');\r\n      m.opacity = m.transparency;\r\n\r\n    }\r\n\r\n    if (m.opacity !== undefined) {\r\n\r\n      mpars.opacity = m.opacity;\r\n\r\n    }\r\n\r\n    if (m.specularCoef) {\r\n\r\n      mpars.shininess = m.specularCoef;\r\n\r\n    }\r\n\r\n    // textures\r\n\r\n    if (m.mapDiffuse && texturePath) {\r\n\r\n      create_texture(mpars, 'map', m.mapDiffuse, m.mapDiffuseRepeat, m.mapDiffuseOffset, m.mapDiffuseWrap, m.mapDiffuseAnisotropy);\r\n\r\n    }\r\n\r\n    if (m.mapLight && texturePath) {\r\n\r\n      create_texture(mpars, 'lightMap', m.mapLight, m.mapLightRepeat, m.mapLightOffset, m.mapLightWrap, m.mapLightAnisotropy);\r\n\r\n    }\r\n\r\n    if (m.mapBump && texturePath) {\r\n\r\n      create_texture(mpars, 'bumpMap', m.mapBump, m.mapBumpRepeat, m.mapBumpOffset, m.mapBumpWrap, m.mapBumpAnisotropy);\r\n\r\n    }\r\n\r\n    if (m.mapNormal && texturePath) {\r\n\r\n      create_texture(mpars, 'normalMap', m.mapNormal, m.mapNormalRepeat, m.mapNormalOffset, m.mapNormalWrap, m.mapNormalAnisotropy);\r\n\r\n    }\r\n\r\n    if (m.mapSpecular && texturePath) {\r\n\r\n      create_texture(mpars, 'specularMap', m.mapSpecular, m.mapSpecularRepeat, m.mapSpecularOffset, m.mapSpecularWrap, m.mapSpecularAnisotropy);\r\n\r\n    }\r\n\r\n    if (m.mapAlpha && texturePath) {\r\n\r\n      create_texture(mpars, 'alphaMap', m.mapAlpha, m.mapAlphaRepeat, m.mapAlphaOffset, m.mapAlphaWrap, m.mapAlphaAnisotropy);\r\n\r\n    }\r\n\r\n    //\r\n\r\n    if (m.mapBumpScale) {\r\n\r\n      mpars.bumpScale = m.mapBumpScale;\r\n\r\n    }\r\n\r\n    if (m.mapNormalFactor) {\r\n\r\n      mpars.normalScale = new THREE.Vector2(m.mapNormalFactor, m.mapNormalFactor);\r\n\r\n    }\r\n\r\n    var material = new THREE[mtype](mpars);\r\n\r\n    if (m.DbgName !== undefined) material.name = m.DbgName;\r\n\r\n    return material;\r\n\r\n  }\r\n\r\n};\r\n\r\nTHREE.Loader.Handlers = {\r\n\r\n  handlers: [],\r\n\r\n  add: function(regex, loader) {\r\n\r\n    this.handlers.push(regex, loader);\r\n\r\n  },\r\n\r\n  get: function(file) {\r\n\r\n    for (var i = 0, l = this.handlers.length; i < l; i += 2) {\r\n\r\n      var regex = this.handlers[i];\r\n      var loader = this.handlers[i + 1];\r\n\r\n      if (regex.test(file)) {\r\n\r\n        return loader;\r\n\r\n      }\r\n\r\n    }\r\n\r\n    return null;\r\n\r\n  }\r\n\r\n};\r\n\r\n// File:src/loaders/XHRLoader.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.XHRLoader = function(manager) {\r\n\r\n  this.manager = (manager !== undefined) ? manager : THREE.DefaultLoadingManager;\r\n\r\n};\r\n\r\nTHREE.XHRLoader.prototype = {\r\n\r\n  constructor: THREE.XHRLoader,\r\n\r\n  load: function(url, onLoad, onProgress, onError) {\r\n\r\n    var scope = this;\r\n\r\n    var cached = THREE.Cache.get(url);\r\n\r\n    if (cached !== undefined) {\r\n\r\n      if (onLoad) onLoad(cached);\r\n      return;\r\n\r\n    }\r\n\r\n    var request = new XMLHttpRequest();\r\n    request.open('GET', url, true);\r\n\r\n    request.addEventListener('load', function(event) {\r\n\r\n      THREE.Cache.add(url, this.response);\r\n\r\n      if (onLoad) onLoad(this.response);\r\n\r\n      scope.manager.itemEnd(url);\r\n\r\n    }, false);\r\n\r\n    if (onProgress !== undefined) {\r\n\r\n      request.addEventListener('progress', function(event) {\r\n\r\n        onProgress(event);\r\n\r\n      }, false);\r\n\r\n    }\r\n\r\n    if (onError !== undefined) {\r\n\r\n      request.addEventListener('error', function(event) {\r\n\r\n        onError(event);\r\n\r\n      }, false);\r\n\r\n    }\r\n\r\n    if (this.crossOrigin !== undefined) request.crossOrigin = this.crossOrigin;\r\n    if (this.responseType !== undefined) request.responseType = this.responseType;\r\n\r\n    request.send(null);\r\n\r\n    scope.manager.itemStart(url);\r\n\r\n  },\r\n\r\n  setResponseType: function(value) {\r\n\r\n    this.responseType = value;\r\n\r\n  },\r\n\r\n  setCrossOrigin: function(value) {\r\n\r\n    this.crossOrigin = value;\r\n\r\n  }\r\n\r\n};\r\n\r\n// File:src/loaders/ImageLoader.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.ImageLoader = function(manager) {\r\n\r\n  this.manager = (manager !== undefined) ? manager : THREE.DefaultLoadingManager;\r\n\r\n};\r\n\r\nTHREE.ImageLoader.prototype = {\r\n\r\n  constructor: THREE.ImageLoader,\r\n\r\n  load: function(url, onLoad, onProgress, onError) {\r\n\r\n    var scope = this;\r\n\r\n    var cached = THREE.Cache.get(url);\r\n\r\n    if (cached !== undefined) {\r\n\r\n      onLoad(cached);\r\n      return;\r\n\r\n    }\r\n\r\n    var image = document.createElement('img');\r\n\r\n    image.addEventListener('load', function(event) {\r\n\r\n      THREE.Cache.add(url, this);\r\n\r\n      if (onLoad) onLoad(this);\r\n\r\n      scope.manager.itemEnd(url);\r\n\r\n    }, false);\r\n\r\n    if (onProgress !== undefined) {\r\n\r\n      image.addEventListener('progress', function(event) {\r\n\r\n        onProgress(event);\r\n\r\n      }, false);\r\n\r\n    }\r\n\r\n    if (onError !== undefined) {\r\n\r\n      image.addEventListener('error', function(event) {\r\n\r\n        onError(event);\r\n\r\n      }, false);\r\n\r\n    }\r\n\r\n    if (this.crossOrigin !== undefined) image.crossOrigin = this.crossOrigin;\r\n\r\n    image.src = url;\r\n\r\n    scope.manager.itemStart(url);\r\n\r\n    return image;\r\n\r\n  },\r\n\r\n  setCrossOrigin: function(value) {\r\n\r\n    this.crossOrigin = value;\r\n\r\n  }\r\n\r\n}\r\n\r\n// File:src/loaders/JSONLoader.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author alteredq / http://alteredqualia.com/\r\n */\r\n\r\nTHREE.JSONLoader = function(showStatus) {\r\n\r\n  THREE.Loader.call(this, showStatus);\r\n\r\n  this.withCredentials = false;\r\n\r\n};\r\n\r\nTHREE.JSONLoader.prototype = Object.create(THREE.Loader.prototype);\r\nTHREE.JSONLoader.prototype.constructor = THREE.JSONLoader;\r\n\r\nTHREE.JSONLoader.prototype.load = function(url, callback, texturePath) {\r\n\r\n  // todo: unify load API to for easier SceneLoader use\r\n\r\n  texturePath = texturePath && (typeof texturePath === 'string') ? texturePath : this.extractUrlBase(url);\r\n\r\n  this.onLoadStart();\r\n  this.loadAjaxJSON(this, url, callback, texturePath);\r\n\r\n};\r\n\r\nTHREE.JSONLoader.prototype.loadAjaxJSON = function(context, url, callback, texturePath, callbackProgress) {\r\n\r\n  var xhr = new XMLHttpRequest();\r\n\r\n  var length = 0;\r\n\r\n  xhr.onreadystatechange = function() {\r\n\r\n    if (xhr.readyState === xhr.DONE) {\r\n\r\n      if (xhr.status === 200 || xhr.status === 0) {\r\n\r\n        if (xhr.responseText) {\r\n\r\n          var json = JSON.parse(xhr.responseText);\r\n          var metadata = json.metadata;\r\n\r\n          if (metadata !== undefined) {\r\n\r\n            if (metadata.type === 'object') {\r\n\r\n              THREE.error('THREE.JSONLoader: ' + url + ' should be loaded with THREE.ObjectLoader instead.');\r\n              return;\r\n\r\n            }\r\n\r\n            if (metadata.type === 'scene') {\r\n\r\n              THREE.error('THREE.JSONLoader: ' + url + ' seems to be a Scene. Use THREE.SceneLoader instead.');\r\n              return;\r\n\r\n            }\r\n\r\n          }\r\n\r\n          var result = context.parse(json, texturePath);\r\n          callback(result.geometry, result.materials);\r\n\r\n        }\r\n        else {\r\n\r\n          THREE.error('THREE.JSONLoader: ' + url + ' seems to be unreachable or the file is empty.');\r\n\r\n        }\r\n\r\n        // in context of more complex asset initialization\r\n        // do not block on single failed file\r\n        // maybe should go even one more level up\r\n\r\n        context.onLoadComplete();\r\n\r\n      }\r\n      else {\r\n\r\n        THREE.error('THREE.JSONLoader: Couldn\\'t load ' + url + ' (' + xhr.status + ')');\r\n\r\n      }\r\n\r\n    }\r\n    else if (xhr.readyState === xhr.LOADING) {\r\n\r\n      if (callbackProgress) {\r\n\r\n        if (length === 0) {\r\n\r\n          length = xhr.getResponseHeader('Content-Length');\r\n\r\n        }\r\n\r\n        callbackProgress({\r\n          total: length,\r\n          loaded: xhr.responseText.length\r\n        });\r\n\r\n      }\r\n\r\n    }\r\n    else if (xhr.readyState === xhr.HEADERS_RECEIVED) {\r\n\r\n      if (callbackProgress !== undefined) {\r\n\r\n        length = xhr.getResponseHeader('Content-Length');\r\n\r\n      }\r\n\r\n    }\r\n\r\n  };\r\n\r\n  xhr.open('GET', url, true);\r\n  xhr.withCredentials = this.withCredentials;\r\n  xhr.send(null);\r\n\r\n};\r\n\r\nTHREE.JSONLoader.prototype.parse = function(json, texturePath) {\r\n\r\n  var geometry = new THREE.Geometry(),\r\n    scale = (json.scale !== undefined) ? 1.0 / json.scale : 1.0;\r\n\r\n  parseModel(scale);\r\n\r\n  parseSkin();\r\n  parseMorphing(scale);\r\n\r\n  geometry.computeFaceNormals();\r\n  geometry.computeBoundingSphere();\r\n\r\n  function parseModel(scale) {\r\n\r\n    function isBitSet(value, position) {\r\n\r\n      return value & (1 << position);\r\n\r\n    }\r\n\r\n    var i, j, fi,\r\n\r\n      offset, zLength,\r\n\r\n      colorIndex, normalIndex, uvIndex, materialIndex,\r\n\r\n      type,\r\n      isQuad,\r\n      hasMaterial,\r\n      hasFaceVertexUv,\r\n      hasFaceNormal, hasFaceVertexNormal,\r\n      hasFaceColor, hasFaceVertexColor,\r\n\r\n      vertex, face, faceA, faceB, hex, normal,\r\n\r\n      uvLayer, uv, u, v,\r\n\r\n      faces = json.faces,\r\n      vertices = json.vertices,\r\n      normals = json.normals,\r\n      colors = json.colors,\r\n\r\n      nUvLayers = 0;\r\n\r\n    if (json.uvs !== undefined) {\r\n\r\n      // disregard empty arrays\r\n\r\n      for (i = 0; i < json.uvs.length; i++) {\r\n\r\n        if (json.uvs[i].length) nUvLayers++;\r\n\r\n      }\r\n\r\n      for (i = 0; i < nUvLayers; i++) {\r\n\r\n        geometry.faceVertexUvs[i] = [];\r\n\r\n      }\r\n\r\n    }\r\n\r\n    offset = 0;\r\n    zLength = vertices.length;\r\n\r\n    while (offset < zLength) {\r\n\r\n      vertex = new THREE.Vector3();\r\n\r\n      vertex.x = vertices[offset++] * scale;\r\n      vertex.y = vertices[offset++] * scale;\r\n      vertex.z = vertices[offset++] * scale;\r\n\r\n      geometry.vertices.push(vertex);\r\n\r\n    }\r\n\r\n    offset = 0;\r\n    zLength = faces.length;\r\n\r\n    while (offset < zLength) {\r\n\r\n      type = faces[offset++];\r\n\r\n\r\n      isQuad = isBitSet(type, 0);\r\n      hasMaterial = isBitSet(type, 1);\r\n      hasFaceVertexUv = isBitSet(type, 3);\r\n      hasFaceNormal = isBitSet(type, 4);\r\n      hasFaceVertexNormal = isBitSet(type, 5);\r\n      hasFaceColor = isBitSet(type, 6);\r\n      hasFaceVertexColor = isBitSet(type, 7);\r\n\r\n      // console.log(\"type\", type, \"bits\", isQuad, hasMaterial, hasFaceVertexUv, hasFaceNormal, hasFaceVertexNormal, hasFaceColor, hasFaceVertexColor);\r\n\r\n      if (isQuad) {\r\n\r\n        faceA = new THREE.Face3();\r\n        faceA.a = faces[offset];\r\n        faceA.b = faces[offset + 1];\r\n        faceA.c = faces[offset + 3];\r\n\r\n        faceB = new THREE.Face3();\r\n        faceB.a = faces[offset + 1];\r\n        faceB.b = faces[offset + 2];\r\n        faceB.c = faces[offset + 3];\r\n\r\n        offset += 4;\r\n\r\n        if (hasMaterial) {\r\n\r\n          materialIndex = faces[offset++];\r\n          faceA.materialIndex = materialIndex;\r\n          faceB.materialIndex = materialIndex;\r\n\r\n        }\r\n\r\n        // to get face <=> uv index correspondence\r\n\r\n        fi = geometry.faces.length;\r\n\r\n        if (hasFaceVertexUv) {\r\n\r\n          for (i = 0; i < nUvLayers; i++) {\r\n\r\n            uvLayer = json.uvs[i];\r\n\r\n            geometry.faceVertexUvs[i][fi] = [];\r\n            geometry.faceVertexUvs[i][fi + 1] = []\r\n\r\n            for (j = 0; j < 4; j++) {\r\n\r\n              uvIndex = faces[offset++];\r\n\r\n              u = uvLayer[uvIndex * 2];\r\n              v = uvLayer[uvIndex * 2 + 1];\r\n\r\n              uv = new THREE.Vector2(u, v);\r\n\r\n              if (j !== 2) geometry.faceVertexUvs[i][fi].push(uv);\r\n              if (j !== 0) geometry.faceVertexUvs[i][fi + 1].push(uv);\r\n\r\n            }\r\n\r\n          }\r\n\r\n        }\r\n\r\n        if (hasFaceNormal) {\r\n\r\n          normalIndex = faces[offset++] * 3;\r\n\r\n          faceA.normal.set(\r\n            normals[normalIndex++],\r\n            normals[normalIndex++],\r\n            normals[normalIndex]\r\n          );\r\n\r\n          faceB.normal.copy(faceA.normal);\r\n\r\n        }\r\n\r\n        if (hasFaceVertexNormal) {\r\n\r\n          for (i = 0; i < 4; i++) {\r\n\r\n            normalIndex = faces[offset++] * 3;\r\n\r\n            normal = new THREE.Vector3(\r\n              normals[normalIndex++],\r\n              normals[normalIndex++],\r\n              normals[normalIndex]\r\n            );\r\n\r\n\r\n            if (i !== 2) faceA.vertexNormals.push(normal);\r\n            if (i !== 0) faceB.vertexNormals.push(normal);\r\n\r\n          }\r\n\r\n        }\r\n\r\n\r\n        if (hasFaceColor) {\r\n\r\n          colorIndex = faces[offset++];\r\n          hex = colors[colorIndex];\r\n\r\n          faceA.color.setHex(hex);\r\n          faceB.color.setHex(hex);\r\n\r\n        }\r\n\r\n\r\n        if (hasFaceVertexColor) {\r\n\r\n          for (i = 0; i < 4; i++) {\r\n\r\n            colorIndex = faces[offset++];\r\n            hex = colors[colorIndex];\r\n\r\n            if (i !== 2) faceA.vertexColors.push(new THREE.Color(hex));\r\n            if (i !== 0) faceB.vertexColors.push(new THREE.Color(hex));\r\n\r\n          }\r\n\r\n        }\r\n\r\n        geometry.faces.push(faceA);\r\n        geometry.faces.push(faceB);\r\n\r\n      }\r\n      else {\r\n\r\n        face = new THREE.Face3();\r\n        face.a = faces[offset++];\r\n        face.b = faces[offset++];\r\n        face.c = faces[offset++];\r\n\r\n        if (hasMaterial) {\r\n\r\n          materialIndex = faces[offset++];\r\n          face.materialIndex = materialIndex;\r\n\r\n        }\r\n\r\n        // to get face <=> uv index correspondence\r\n\r\n        fi = geometry.faces.length;\r\n\r\n        if (hasFaceVertexUv) {\r\n\r\n          for (i = 0; i < nUvLayers; i++) {\r\n\r\n            uvLayer = json.uvs[i];\r\n\r\n            geometry.faceVertexUvs[i][fi] = [];\r\n\r\n            for (j = 0; j < 3; j++) {\r\n\r\n              uvIndex = faces[offset++];\r\n\r\n              u = uvLayer[uvIndex * 2];\r\n              v = uvLayer[uvIndex * 2 + 1];\r\n\r\n              uv = new THREE.Vector2(u, v);\r\n\r\n              geometry.faceVertexUvs[i][fi].push(uv);\r\n\r\n            }\r\n\r\n          }\r\n\r\n        }\r\n\r\n        if (hasFaceNormal) {\r\n\r\n          normalIndex = faces[offset++] * 3;\r\n\r\n          face.normal.set(\r\n            normals[normalIndex++],\r\n            normals[normalIndex++],\r\n            normals[normalIndex]\r\n          );\r\n\r\n        }\r\n\r\n        if (hasFaceVertexNormal) {\r\n\r\n          for (i = 0; i < 3; i++) {\r\n\r\n            normalIndex = faces[offset++] * 3;\r\n\r\n            normal = new THREE.Vector3(\r\n              normals[normalIndex++],\r\n              normals[normalIndex++],\r\n              normals[normalIndex]\r\n            );\r\n\r\n            face.vertexNormals.push(normal);\r\n\r\n          }\r\n\r\n        }\r\n\r\n\r\n        if (hasFaceColor) {\r\n\r\n          colorIndex = faces[offset++];\r\n          face.color.setHex(colors[colorIndex]);\r\n\r\n        }\r\n\r\n\r\n        if (hasFaceVertexColor) {\r\n\r\n          for (i = 0; i < 3; i++) {\r\n\r\n            colorIndex = faces[offset++];\r\n            face.vertexColors.push(new THREE.Color(colors[colorIndex]));\r\n\r\n          }\r\n\r\n        }\r\n\r\n        geometry.faces.push(face);\r\n\r\n      }\r\n\r\n    }\r\n\r\n  };\r\n\r\n  function parseSkin() {\r\n    var influencesPerVertex = (json.influencesPerVertex !== undefined) ? json.influencesPerVertex : 2;\r\n\r\n    if (json.skinWeights) {\r\n\r\n      for (var i = 0, l = json.skinWeights.length; i < l; i += influencesPerVertex) {\r\n\r\n        var x = json.skinWeights[i];\r\n        var y = (influencesPerVertex > 1) ? json.skinWeights[i + 1] : 0;\r\n        var z = (influencesPerVertex > 2) ? json.skinWeights[i + 2] : 0;\r\n        var w = (influencesPerVertex > 3) ? json.skinWeights[i + 3] : 0;\r\n\r\n        geometry.skinWeights.push(new THREE.Vector4(x, y, z, w));\r\n\r\n      }\r\n\r\n    }\r\n\r\n    if (json.skinIndices) {\r\n\r\n      for (var i = 0, l = json.skinIndices.length; i < l; i += influencesPerVertex) {\r\n\r\n        var a = json.skinIndices[i];\r\n        var b = (influencesPerVertex > 1) ? json.skinIndices[i + 1] : 0;\r\n        var c = (influencesPerVertex > 2) ? json.skinIndices[i + 2] : 0;\r\n        var d = (influencesPerVertex > 3) ? json.skinIndices[i + 3] : 0;\r\n\r\n        geometry.skinIndices.push(new THREE.Vector4(a, b, c, d));\r\n\r\n      }\r\n\r\n    }\r\n\r\n    geometry.bones = json.bones;\r\n\r\n    if (geometry.bones && geometry.bones.length > 0 && (geometry.skinWeights.length !== geometry.skinIndices.length || geometry.skinIndices.length !== geometry.vertices.length)) {\r\n\r\n      THREE.warn('THREE.JSONLoader: When skinning, number of vertices (' + geometry.vertices.length + '), skinIndices (' +\r\n        geometry.skinIndices.length + '), and skinWeights (' + geometry.skinWeights.length + ') should match.');\r\n\r\n    }\r\n\r\n\r\n    // could change this to json.animations[0] or remove completely\r\n\r\n    geometry.animation = json.animation;\r\n    geometry.animations = json.animations;\r\n\r\n  };\r\n\r\n  function parseMorphing(scale) {\r\n\r\n    if (json.morphTargets !== undefined) {\r\n\r\n      var i, l, v, vl, dstVertices, srcVertices;\r\n\r\n      for (i = 0, l = json.morphTargets.length; i < l; i++) {\r\n\r\n        geometry.morphTargets[i] = {};\r\n        geometry.morphTargets[i].name = json.morphTargets[i].name;\r\n        geometry.morphTargets[i].vertices = [];\r\n\r\n        dstVertices = geometry.morphTargets[i].vertices;\r\n        srcVertices = json.morphTargets[i].vertices;\r\n\r\n        for (v = 0, vl = srcVertices.length; v < vl; v += 3) {\r\n\r\n          var vertex = new THREE.Vector3();\r\n          vertex.x = srcVertices[v] * scale;\r\n          vertex.y = srcVertices[v + 1] * scale;\r\n          vertex.z = srcVertices[v + 2] * scale;\r\n\r\n          dstVertices.push(vertex);\r\n\r\n        }\r\n\r\n      }\r\n\r\n    }\r\n\r\n    if (json.morphColors !== undefined) {\r\n\r\n      var i, l, c, cl, dstColors, srcColors, color;\r\n\r\n      for (i = 0, l = json.morphColors.length; i < l; i++) {\r\n\r\n        geometry.morphColors[i] = {};\r\n        geometry.morphColors[i].name = json.morphColors[i].name;\r\n        geometry.morphColors[i].colors = [];\r\n\r\n        dstColors = geometry.morphColors[i].colors;\r\n        srcColors = json.morphColors[i].colors;\r\n\r\n        for (c = 0, cl = srcColors.length; c < cl; c += 3) {\r\n\r\n          color = new THREE.Color(0xffaa00);\r\n          color.setRGB(srcColors[c], srcColors[c + 1], srcColors[c + 2]);\r\n          dstColors.push(color);\r\n\r\n        }\r\n\r\n      }\r\n\r\n    }\r\n\r\n  };\r\n\r\n  if (json.materials === undefined || json.materials.length === 0) {\r\n\r\n    return {\r\n      geometry: geometry\r\n    };\r\n\r\n  }\r\n  else {\r\n\r\n    var materials = this.initMaterials(json.materials, texturePath);\r\n\r\n    if (this.needsTangents(materials)) {\r\n\r\n      geometry.computeTangents();\r\n\r\n    }\r\n\r\n    return {\r\n      geometry: geometry,\r\n      materials: materials\r\n    };\r\n\r\n  }\r\n\r\n};\r\n\r\n// File:src/loaders/LoadingManager.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.LoadingManager = function(onLoad, onProgress, onError) {\r\n\r\n  var scope = this;\r\n\r\n  var loaded = 0,\r\n    total = 0;\r\n\r\n  this.onLoad = onLoad;\r\n  this.onProgress = onProgress;\r\n  this.onError = onError;\r\n\r\n  this.itemStart = function(url) {\r\n\r\n    total++;\r\n\r\n  };\r\n\r\n  this.itemEnd = function(url) {\r\n\r\n    loaded++;\r\n\r\n    if (scope.onProgress !== undefined) {\r\n\r\n      scope.onProgress(url, loaded, total);\r\n\r\n    }\r\n\r\n    if (loaded === total && scope.onLoad !== undefined) {\r\n\r\n      scope.onLoad();\r\n\r\n    }\r\n\r\n  };\r\n\r\n};\r\n\r\nTHREE.DefaultLoadingManager = new THREE.LoadingManager();\r\n\r\n// File:src/loaders/BufferGeometryLoader.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.BufferGeometryLoader = function(manager) {\r\n\r\n  this.manager = (manager !== undefined) ? manager : THREE.DefaultLoadingManager;\r\n\r\n};\r\n\r\nTHREE.BufferGeometryLoader.prototype = {\r\n\r\n  constructor: THREE.BufferGeometryLoader,\r\n\r\n  load: function(url, onLoad, onProgress, onError) {\r\n\r\n    var scope = this;\r\n\r\n    var loader = new THREE.XHRLoader(scope.manager);\r\n    loader.setCrossOrigin(this.crossOrigin);\r\n    loader.load(url, function(text) {\r\n\r\n      onLoad(scope.parse(JSON.parse(text)));\r\n\r\n    }, onProgress, onError);\r\n\r\n  },\r\n\r\n  setCrossOrigin: function(value) {\r\n\r\n    this.crossOrigin = value;\r\n\r\n  },\r\n\r\n  parse: function(json) {\r\n\r\n    var geometry = new THREE.BufferGeometry();\r\n\r\n    var attributes = json.data.attributes;\r\n\r\n    for (var key in attributes) {\r\n\r\n      var attribute = attributes[key];\r\n      var typedArray = new self[attribute.type](attribute.array);\r\n\r\n      geometry.addAttribute(key, new THREE.BufferAttribute(typedArray, attribute.itemSize));\r\n\r\n    }\r\n\r\n    var offsets = json.data.offsets;\r\n\r\n    if (offsets !== undefined) {\r\n\r\n      geometry.offsets = JSON.parse(JSON.stringify(offsets));\r\n\r\n    }\r\n\r\n    var boundingSphere = json.data.boundingSphere;\r\n\r\n    if (boundingSphere !== undefined) {\r\n\r\n      var center = new THREE.Vector3();\r\n\r\n      if (boundingSphere.center !== undefined) {\r\n\r\n        center.fromArray(boundingSphere.center);\r\n\r\n      }\r\n\r\n      geometry.boundingSphere = new THREE.Sphere(center, boundingSphere.radius);\r\n\r\n    }\r\n\r\n    return geometry;\r\n\r\n  }\r\n\r\n};\r\n\r\n// File:src/loaders/MaterialLoader.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.MaterialLoader = function(manager) {\r\n\r\n  this.manager = (manager !== undefined) ? manager : THREE.DefaultLoadingManager;\r\n\r\n};\r\n\r\nTHREE.MaterialLoader.prototype = {\r\n\r\n  constructor: THREE.MaterialLoader,\r\n\r\n  load: function(url, onLoad, onProgress, onError) {\r\n\r\n    var scope = this;\r\n\r\n    var loader = new THREE.XHRLoader(scope.manager);\r\n    loader.setCrossOrigin(this.crossOrigin);\r\n    loader.load(url, function(text) {\r\n\r\n      onLoad(scope.parse(JSON.parse(text)));\r\n\r\n    }, onProgress, onError);\r\n\r\n  },\r\n\r\n  setCrossOrigin: function(value) {\r\n\r\n    this.crossOrigin = value;\r\n\r\n  },\r\n\r\n  parse: function(json) {\r\n\r\n    var material = new THREE[json.type];\r\n\r\n    if (json.color !== undefined) material.color.setHex(json.color);\r\n    if (json.emissive !== undefined) material.emissive.setHex(json.emissive);\r\n    if (json.specular !== undefined) material.specular.setHex(json.specular);\r\n    if (json.shininess !== undefined) material.shininess = json.shininess;\r\n    if (json.uniforms !== undefined) material.uniforms = json.uniforms;\r\n    if (json.vertexShader !== undefined) material.vertexShader = json.vertexShader;\r\n    if (json.fragmentShader !== undefined) material.fragmentShader = json.fragmentShader;\r\n    if (json.vertexColors !== undefined) material.vertexColors = json.vertexColors;\r\n    if (json.shading !== undefined) material.shading = json.shading;\r\n    if (json.blending !== undefined) material.blending = json.blending;\r\n    if (json.side !== undefined) material.side = json.side;\r\n    if (json.opacity !== undefined) material.opacity = json.opacity;\r\n    if (json.transparent !== undefined) material.transparent = json.transparent;\r\n    if (json.wireframe !== undefined) material.wireframe = json.wireframe;\r\n\r\n    // for PointCloudMaterial\r\n    if (json.size !== undefined) material.size = json.size;\r\n    if (json.sizeAttenuation !== undefined) material.sizeAttenuation = json.sizeAttenuation;\r\n\r\n    if (json.materials !== undefined) {\r\n\r\n      for (var i = 0, l = json.materials.length; i < l; i++) {\r\n\r\n        material.materials.push(this.parse(json.materials[i]));\r\n\r\n      }\r\n\r\n    }\r\n\r\n    return material;\r\n\r\n  }\r\n\r\n};\r\n\r\n// File:src/loaders/ObjectLoader.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.ObjectLoader = function(manager) {\r\n\r\n  this.manager = (manager !== undefined) ? manager : THREE.DefaultLoadingManager;\r\n  this.texturePath = '';\r\n\r\n};\r\n\r\nTHREE.ObjectLoader.prototype = {\r\n\r\n  constructor: THREE.ObjectLoader,\r\n\r\n  load: function(url, onLoad, onProgress, onError) {\r\n\r\n    if (this.texturePath === '') {\r\n\r\n      this.texturePath = url.substring(0, url.lastIndexOf('/') + 1);\r\n\r\n    }\r\n\r\n    var scope = this;\r\n\r\n    var loader = new THREE.XHRLoader(scope.manager);\r\n    loader.setCrossOrigin(this.crossOrigin);\r\n    loader.load(url, function(text) {\r\n\r\n      scope.parse(JSON.parse(text), onLoad);\r\n\r\n    }, onProgress, onError);\r\n\r\n  },\r\n\r\n  setTexturePath: function(value) {\r\n\r\n    this.texturePath = value;\r\n\r\n  },\r\n\r\n  setCrossOrigin: function(value) {\r\n\r\n    this.crossOrigin = value;\r\n\r\n  },\r\n\r\n  parse: function(json, onLoad) {\r\n\r\n    var geometries = this.parseGeometries(json.geometries);\r\n\r\n    var images = this.parseImages(json.images, function() {\r\n\r\n      if (onLoad !== undefined) onLoad(object);\r\n\r\n    });\r\n    var textures = this.parseTextures(json.textures, images);\r\n    var materials = this.parseMaterials(json.materials, textures);\r\n    var object = this.parseObject(json.object, geometries, materials);\r\n\r\n    if (json.images === undefined || json.images.length === 0) {\r\n\r\n      if (onLoad !== undefined) onLoad(object);\r\n\r\n    }\r\n\r\n    return object;\r\n\r\n  },\r\n\r\n  parseGeometries: function(json) {\r\n\r\n    var geometries = {};\r\n\r\n    if (json !== undefined) {\r\n\r\n      var geometryLoader = new THREE.JSONLoader();\r\n      var bufferGeometryLoader = new THREE.BufferGeometryLoader();\r\n\r\n      for (var i = 0, l = json.length; i < l; i++) {\r\n\r\n        var geometry;\r\n        var data = json[i];\r\n\r\n        switch (data.type) {\r\n\r\n          case 'PlaneGeometry':\r\n          case 'PlaneBufferGeometry':\r\n\r\n            geometry = new THREE[data.type](\r\n              data.width,\r\n              data.height,\r\n              data.widthSegments,\r\n              data.heightSegments\r\n            );\r\n\r\n            break;\r\n\r\n          case 'BoxGeometry':\r\n          case 'CubeGeometry': // backwards compatible\r\n\r\n            geometry = new THREE.BoxGeometry(\r\n              data.width,\r\n              data.height,\r\n              data.depth,\r\n              data.widthSegments,\r\n              data.heightSegments,\r\n              data.depthSegments\r\n            );\r\n\r\n            break;\r\n\r\n          case 'CircleGeometry':\r\n\r\n            geometry = new THREE.CircleGeometry(\r\n              data.radius,\r\n              data.segments\r\n            );\r\n\r\n            break;\r\n\r\n          case 'CylinderGeometry':\r\n\r\n            geometry = new THREE.CylinderGeometry(\r\n              data.radiusTop,\r\n              data.radiusBottom,\r\n              data.height,\r\n              data.radialSegments,\r\n              data.heightSegments,\r\n              data.openEnded\r\n            );\r\n\r\n            break;\r\n\r\n          case 'SphereGeometry':\r\n\r\n            geometry = new THREE.SphereGeometry(\r\n              data.radius,\r\n              data.widthSegments,\r\n              data.heightSegments,\r\n              data.phiStart,\r\n              data.phiLength,\r\n              data.thetaStart,\r\n              data.thetaLength\r\n            );\r\n\r\n            break;\r\n\r\n          case 'IcosahedronGeometry':\r\n\r\n            geometry = new THREE.IcosahedronGeometry(\r\n              data.radius,\r\n              data.detail\r\n            );\r\n\r\n            break;\r\n\r\n          case 'TorusGeometry':\r\n\r\n            geometry = new THREE.TorusGeometry(\r\n              data.radius,\r\n              data.tube,\r\n              data.radialSegments,\r\n              data.tubularSegments,\r\n              data.arc\r\n            );\r\n\r\n            break;\r\n\r\n          case 'TorusKnotGeometry':\r\n\r\n            geometry = new THREE.TorusKnotGeometry(\r\n              data.radius,\r\n              data.tube,\r\n              data.radialSegments,\r\n              data.tubularSegments,\r\n              data.p,\r\n              data.q,\r\n              data.heightScale\r\n            );\r\n\r\n            break;\r\n\r\n          case 'BufferGeometry':\r\n\r\n            geometry = bufferGeometryLoader.parse(data);\r\n\r\n            break;\r\n\r\n          case 'Geometry':\r\n\r\n            geometry = geometryLoader.parse(data.data).geometry;\r\n\r\n            break;\r\n\r\n        }\r\n\r\n        geometry.uuid = data.uuid;\r\n\r\n        if (data.name !== undefined) geometry.name = data.name;\r\n\r\n        geometries[data.uuid] = geometry;\r\n\r\n      }\r\n\r\n    }\r\n\r\n    return geometries;\r\n\r\n  },\r\n\r\n  parseMaterials: function(json, textures) {\r\n\r\n    var materials = {};\r\n\r\n    if (json !== undefined) {\r\n\r\n      var getTexture = function(name) {\r\n\r\n        if (textures[name] === undefined) {\r\n\r\n          THREE.warn('THREE.ObjectLoader: Undefined texture', name);\r\n\r\n        }\r\n\r\n        return textures[name];\r\n\r\n      };\r\n\r\n      var loader = new THREE.MaterialLoader();\r\n\r\n      for (var i = 0, l = json.length; i < l; i++) {\r\n\r\n        var data = json[i];\r\n        var material = loader.parse(data);\r\n\r\n        material.uuid = data.uuid;\r\n\r\n        if (data.name !== undefined) material.name = data.name;\r\n\r\n        if (data.map !== undefined) {\r\n\r\n          material.map = getTexture(data.map);\r\n\r\n        }\r\n\r\n        if (data.bumpMap !== undefined) {\r\n\r\n          material.bumpMap = getTexture(data.bumpMap);\r\n          if (data.bumpScale) {\r\n            material.bumpScale = new THREE.Vector2(data.bumpScale, data.bumpScale);\r\n          }\r\n\r\n        }\r\n\r\n        if (data.alphaMap !== undefined) {\r\n\r\n          material.alphaMap = getTexture(data.alphaMap);\r\n\r\n        }\r\n\r\n        if (data.envMap !== undefined) {\r\n\r\n          material.envMap = getTexture(data.envMap);\r\n\r\n        }\r\n\r\n        if (data.normalMap !== undefined) {\r\n\r\n          material.normalMap = getTexture(data.normalMap);\r\n          if (data.normalScale) {\r\n            material.normalScale = new THREE.Vector2(data.normalScale, data.normalScale);\r\n          }\r\n\r\n        }\r\n\r\n        if (data.lightMap !== undefined) {\r\n\r\n          material.lightMap = getTexture(data.lightMap);\r\n\r\n        }\r\n\r\n        if (data.specularMap !== undefined) {\r\n\r\n          material.specularMap = getTexture(data.specularMap);\r\n\r\n        }\r\n\r\n        materials[data.uuid] = material;\r\n\r\n      }\r\n\r\n    }\r\n\r\n    return materials;\r\n\r\n  },\r\n\r\n  parseImages: function(json, onLoad) {\r\n\r\n    var scope = this;\r\n    var images = {};\r\n\r\n    if (json !== undefined && json.length > 0) {\r\n\r\n      var manager = new THREE.LoadingManager(onLoad);\r\n\r\n      var loader = new THREE.ImageLoader(manager);\r\n      loader.setCrossOrigin(this.crossOrigin);\r\n\r\n      var loadImage = function(url) {\r\n\r\n        scope.manager.itemStart(url);\r\n\r\n        return loader.load(url, function() {\r\n\r\n          scope.manager.itemEnd(url);\r\n\r\n        });\r\n\r\n      };\r\n\r\n      for (var i = 0, l = json.length; i < l; i++) {\r\n\r\n        var image = json[i];\r\n        var path = /^(\\/\\/)|([a-z]+:(\\/\\/)?)/i.test(image.url) ? image.url : scope.texturePath + image.url;\r\n\r\n        images[image.uuid] = loadImage(path);\r\n\r\n      }\r\n\r\n    }\r\n\r\n    return images;\r\n\r\n  },\r\n\r\n  parseTextures: function(json, images) {\r\n\r\n    var textures = {};\r\n\r\n    if (json !== undefined) {\r\n\r\n      for (var i = 0, l = json.length; i < l; i++) {\r\n\r\n        var data = json[i];\r\n\r\n        if (data.image === undefined) {\r\n\r\n          THREE.warn('THREE.ObjectLoader: No \"image\" speficied for', data.uuid);\r\n\r\n        }\r\n\r\n        if (images[data.image] === undefined) {\r\n\r\n          THREE.warn('THREE.ObjectLoader: Undefined image', data.image);\r\n\r\n        }\r\n\r\n        var texture = new THREE.Texture(images[data.image]);\r\n        texture.needsUpdate = true;\r\n\r\n        texture.uuid = data.uuid;\r\n\r\n        if (data.name !== undefined) texture.name = data.name;\r\n        if (data.repeat !== undefined) texture.repeat = new THREE.Vector2(data.repeat[0], data.repeat[1]);\r\n        if (data.minFilter !== undefined) texture.minFilter = THREE[data.minFilter];\r\n        if (data.magFilter !== undefined) texture.magFilter = THREE[data.magFilter];\r\n        if (data.anisotropy !== undefined) texture.anisotropy = data.anisotropy;\r\n        if (data.wrap instanceof Array) {\r\n\r\n          texture.wrapS = THREE[data.wrap[0]];\r\n          texture.wrapT = THREE[data.wrap[1]];\r\n\r\n        }\r\n\r\n        textures[data.uuid] = texture;\r\n\r\n      }\r\n\r\n    }\r\n\r\n    return textures;\r\n\r\n  },\r\n\r\n  parseObject: function() {\r\n\r\n    var matrix = new THREE.Matrix4();\r\n\r\n    return function(data, geometries, materials) {\r\n\r\n      var object;\r\n\r\n      var getGeometry = function(name) {\r\n\r\n        if (geometries[name] === undefined) {\r\n\r\n          THREE.warn('THREE.ObjectLoader: Undefined geometry', name);\r\n\r\n        }\r\n\r\n        return geometries[name];\r\n\r\n      };\r\n\r\n      var getMaterial = function(name) {\r\n\r\n        if (materials[name] === undefined) {\r\n\r\n          THREE.warn('THREE.ObjectLoader: Undefined material', name);\r\n\r\n        }\r\n\r\n        return materials[name];\r\n\r\n      };\r\n\r\n      switch (data.type) {\r\n\r\n        case 'Scene':\r\n\r\n          object = new THREE.Scene();\r\n\r\n          break;\r\n\r\n        case 'PerspectiveCamera':\r\n\r\n          object = new THREE.PerspectiveCamera(data.fov, data.aspect, data.near, data.far);\r\n\r\n          break;\r\n\r\n        case 'OrthographicCamera':\r\n\r\n          object = new THREE.OrthographicCamera(data.left, data.right, data.top, data.bottom, data.near, data.far);\r\n\r\n          break;\r\n\r\n        case 'AmbientLight':\r\n\r\n          object = new THREE.AmbientLight(data.color);\r\n\r\n          break;\r\n\r\n        case 'DirectionalLight':\r\n\r\n          object = new THREE.DirectionalLight(data.color, data.intensity);\r\n\r\n          break;\r\n\r\n        case 'PointLight':\r\n\r\n          object = new THREE.PointLight(data.color, data.intensity, data.distance, data.decay);\r\n\r\n          break;\r\n\r\n        case 'SpotLight':\r\n\r\n          object = new THREE.SpotLight(data.color, data.intensity, data.distance, data.angle, data.exponent, data.decay);\r\n\r\n          break;\r\n\r\n        case 'HemisphereLight':\r\n\r\n          object = new THREE.HemisphereLight(data.color, data.groundColor, data.intensity);\r\n\r\n          break;\r\n\r\n        case 'Mesh':\r\n\r\n          object = new THREE.Mesh(getGeometry(data.geometry), getMaterial(data.material));\r\n\r\n          break;\r\n\r\n        case 'Line':\r\n\r\n          object = new THREE.Line(getGeometry(data.geometry), getMaterial(data.material), data.mode);\r\n\r\n          break;\r\n\r\n        case 'PointCloud':\r\n\r\n          object = new THREE.PointCloud(getGeometry(data.geometry), getMaterial(data.material));\r\n\r\n          break;\r\n\r\n        case 'Sprite':\r\n\r\n          object = new THREE.Sprite(getMaterial(data.material));\r\n\r\n          break;\r\n\r\n        case 'Group':\r\n\r\n          object = new THREE.Group();\r\n\r\n          break;\r\n\r\n        default:\r\n\r\n          object = new THREE.Object3D();\r\n\r\n      }\r\n\r\n      object.uuid = data.uuid;\r\n\r\n      if (data.name !== undefined) object.name = data.name;\r\n      if (data.matrix !== undefined) {\r\n\r\n        matrix.fromArray(data.matrix);\r\n        matrix.decompose(object.position, object.quaternion, object.scale);\r\n\r\n      }\r\n      else {\r\n\r\n        if (data.position !== undefined) object.position.fromArray(data.position);\r\n        if (data.rotation !== undefined) object.rotation.fromArray(data.rotation);\r\n        if (data.scale !== undefined) object.scale.fromArray(data.scale);\r\n\r\n      }\r\n\r\n      if (data.visible !== undefined) object.visible = data.visible;\r\n      if (data.userData !== undefined) object.userData = data.userData;\r\n\r\n      if (data.children !== undefined) {\r\n\r\n        for (var child in data.children) {\r\n\r\n          object.add(this.parseObject(data.children[child], geometries, materials));\r\n\r\n        }\r\n\r\n      }\r\n\r\n      return object;\r\n\r\n    }\r\n\r\n  }()\r\n\r\n};\r\n\r\n// File:src/loaders/TextureLoader.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.TextureLoader = function(manager) {\r\n\r\n  this.manager = (manager !== undefined) ? manager : THREE.DefaultLoadingManager;\r\n\r\n};\r\n\r\nTHREE.TextureLoader.prototype = {\r\n\r\n  constructor: THREE.TextureLoader,\r\n\r\n  load: function(url, onLoad, onProgress, onError) {\r\n\r\n    var scope = this;\r\n\r\n    var loader = new THREE.ImageLoader(scope.manager);\r\n    loader.setCrossOrigin(this.crossOrigin);\r\n    loader.load(url, function(image) {\r\n\r\n      var texture = new THREE.Texture(image);\r\n      texture.needsUpdate = true;\r\n\r\n      if (onLoad !== undefined) {\r\n\r\n        onLoad(texture);\r\n\r\n      }\r\n\r\n    }, onProgress, onError);\r\n\r\n  },\r\n\r\n  setCrossOrigin: function(value) {\r\n\r\n    this.crossOrigin = value;\r\n\r\n  }\r\n\r\n};\r\n\r\n// File:src/loaders/BinaryTextureLoader.js\r\n\r\n/**\r\n * @author Nikos M. / https://github.com/foo123/\r\n *\r\n * Abstract Base class to load generic binary textures formats (rgbe, hdr, ...)\r\n */\r\n\r\nTHREE.DataTextureLoader = THREE.BinaryTextureLoader = function() {\r\n\r\n  // override in sub classes\r\n  this._parser = null;\r\n\r\n};\r\n\r\nTHREE.BinaryTextureLoader.prototype = {\r\n\r\n  constructor: THREE.BinaryTextureLoader,\r\n\r\n  load: function(url, onLoad, onProgress, onError) {\r\n\r\n    var scope = this;\r\n\r\n    var texture = new THREE.DataTexture();\r\n\r\n    var loader = new THREE.XHRLoader();\r\n    loader.setResponseType('arraybuffer');\r\n\r\n    loader.load(url, function(buffer) {\r\n\r\n      var texData = scope._parser(buffer);\r\n\r\n      if (!texData) return;\r\n\r\n      if (undefined !== texData.image) {\r\n\r\n        texture.image = texData.image;\r\n\r\n      }\r\n      else if (undefined !== texData.data) {\r\n\r\n        texture.image.width = texData.width;\r\n        texture.image.height = texData.height;\r\n        texture.image.data = texData.data;\r\n\r\n      }\r\n\r\n      texture.wrapS = undefined !== texData.wrapS ? texData.wrapS : THREE.ClampToEdgeWrapping;\r\n      texture.wrapT = undefined !== texData.wrapT ? texData.wrapT : THREE.ClampToEdgeWrapping;\r\n\r\n      texture.magFilter = undefined !== texData.magFilter ? texData.magFilter : THREE.LinearFilter;\r\n      texture.minFilter = undefined !== texData.minFilter ? texData.minFilter : THREE.LinearMipMapLinearFilter;\r\n\r\n      texture.anisotropy = undefined !== texData.anisotropy ? texData.anisotropy : 1;\r\n\r\n      if (undefined !== texData.format) {\r\n\r\n        texture.format = texData.format;\r\n\r\n      }\r\n      if (undefined !== texData.type) {\r\n\r\n        texture.type = texData.type;\r\n\r\n      }\r\n\r\n      if (undefined !== texData.mipmaps) {\r\n\r\n        texture.mipmaps = texData.mipmaps;\r\n\r\n      }\r\n\r\n      if (1 === texData.mipmapCount) {\r\n\r\n        texture.minFilter = THREE.LinearFilter;\r\n\r\n      }\r\n\r\n      texture.needsUpdate = true;\r\n\r\n      if (onLoad) onLoad(texture, texData);\r\n\r\n    }, onProgress, onError);\r\n\r\n\r\n    return texture;\r\n\r\n  }\r\n\r\n};\r\n\r\n// File:src/loaders/CompressedTextureLoader.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n *\r\n * Abstract Base class to block based textures loader (dds, pvr, ...)\r\n */\r\n\r\nTHREE.CompressedTextureLoader = function() {\r\n\r\n  // override in sub classes\r\n  this._parser = null;\r\n\r\n};\r\n\r\n\r\nTHREE.CompressedTextureLoader.prototype = {\r\n\r\n  constructor: THREE.CompressedTextureLoader,\r\n\r\n  load: function(url, onLoad, onError) {\r\n\r\n    var scope = this;\r\n\r\n    var images = [];\r\n\r\n    var texture = new THREE.CompressedTexture();\r\n    texture.image = images;\r\n\r\n    var loader = new THREE.XHRLoader();\r\n    loader.setResponseType('arraybuffer');\r\n\r\n    if (url instanceof Array) {\r\n\r\n      var loaded = 0;\r\n\r\n      var loadTexture = function(i) {\r\n\r\n        loader.load(url[i], function(buffer) {\r\n\r\n          var texDatas = scope._parser(buffer, true);\r\n\r\n          images[i] = {\r\n            width: texDatas.width,\r\n            height: texDatas.height,\r\n            format: texDatas.format,\r\n            mipmaps: texDatas.mipmaps\r\n          };\r\n\r\n          loaded += 1;\r\n\r\n          if (loaded === 6) {\r\n\r\n            if (texDatas.mipmapCount == 1)\r\n              texture.minFilter = THREE.LinearFilter;\r\n\r\n            texture.format = texDatas.format;\r\n            texture.needsUpdate = true;\r\n\r\n            if (onLoad) onLoad(texture);\r\n\r\n          }\r\n\r\n        });\r\n\r\n      };\r\n\r\n      for (var i = 0, il = url.length; i < il; ++i) {\r\n\r\n        loadTexture(i);\r\n\r\n      }\r\n\r\n    }\r\n    else {\r\n\r\n      // compressed cubemap texture stored in a single DDS file\r\n\r\n      loader.load(url, function(buffer) {\r\n\r\n        var texDatas = scope._parser(buffer, true);\r\n\r\n        if (texDatas.isCubemap) {\r\n\r\n          var faces = texDatas.mipmaps.length / texDatas.mipmapCount;\r\n\r\n          for (var f = 0; f < faces; f++) {\r\n\r\n            images[f] = {\r\n              mipmaps: []\r\n            };\r\n\r\n            for (var i = 0; i < texDatas.mipmapCount; i++) {\r\n\r\n              images[f].mipmaps.push(texDatas.mipmaps[f * texDatas.mipmapCount + i]);\r\n              images[f].format = texDatas.format;\r\n              images[f].width = texDatas.width;\r\n              images[f].height = texDatas.height;\r\n\r\n            }\r\n\r\n          }\r\n\r\n        }\r\n        else {\r\n\r\n          texture.image.width = texDatas.width;\r\n          texture.image.height = texDatas.height;\r\n          texture.mipmaps = texDatas.mipmaps;\r\n\r\n        }\r\n\r\n        if (texDatas.mipmapCount === 1) {\r\n\r\n          texture.minFilter = THREE.LinearFilter;\r\n\r\n        }\r\n\r\n        texture.format = texDatas.format;\r\n        texture.needsUpdate = true;\r\n\r\n        if (onLoad) onLoad(texture);\r\n\r\n      });\r\n\r\n    }\r\n\r\n    return texture;\r\n\r\n  }\r\n\r\n};\r\n\r\n// File:src/materials/Material.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author alteredq / http://alteredqualia.com/\r\n */\r\n\r\nTHREE.Material = function() {\r\n\r\n  Object.defineProperty(this, 'id', {\r\n    value: THREE.MaterialIdCount++\r\n  });\r\n\r\n  this.uuid = THREE.Math.generateUUID();\r\n\r\n  this.name = '';\r\n  this.type = 'Material';\r\n\r\n  this.side = THREE.FrontSide;\r\n\r\n  this.opacity = 1;\r\n  this.transparent = false;\r\n\r\n  this.blending = THREE.NormalBlending;\r\n\r\n  this.blendSrc = THREE.SrcAlphaFactor;\r\n  this.blendDst = THREE.OneMinusSrcAlphaFactor;\r\n  this.blendEquation = THREE.AddEquation;\r\n  this.blendSrcAlpha = null;\r\n  this.blendDstAlpha = null;\r\n  this.blendEquationAlpha = null;\r\n\r\n  this.depthTest = true;\r\n  this.depthWrite = true;\r\n\r\n  this.colorWrite = true;\r\n\r\n  this.polygonOffset = false;\r\n  this.polygonOffsetFactor = 0;\r\n  this.polygonOffsetUnits = 0;\r\n\r\n  this.alphaTest = 0;\r\n\r\n  this.overdraw = 0; // Overdrawn pixels (typically between 0 and 1) for fixing antialiasing gaps in CanvasRenderer\r\n\r\n  this.visible = true;\r\n\r\n  this._needsUpdate = true;\r\n\r\n};\r\n\r\nTHREE.Material.prototype = {\r\n\r\n  constructor: THREE.Material,\r\n\r\n  get needsUpdate() {\r\n\r\n    return this._needsUpdate;\r\n\r\n  },\r\n\r\n  set needsUpdate(value) {\r\n\r\n    if (value === true) this.update();\r\n\r\n    this._needsUpdate = value;\r\n\r\n  },\r\n\r\n  setValues: function(values) {\r\n\r\n    if (values === undefined) return;\r\n\r\n    for (var key in values) {\r\n\r\n      var newValue = values[key];\r\n\r\n      if (newValue === undefined) {\r\n\r\n        THREE.warn(\"THREE.Material: '\" + key + \"' parameter is undefined.\");\r\n        continue;\r\n\r\n      }\r\n\r\n      if (key in this) {\r\n\r\n        var currentValue = this[key];\r\n\r\n        if (currentValue instanceof THREE.Color) {\r\n\r\n          currentValue.set(newValue);\r\n\r\n        }\r\n        else if (currentValue instanceof THREE.Vector3 && newValue instanceof THREE.Vector3) {\r\n\r\n          currentValue.copy(newValue);\r\n\r\n        }\r\n        else if (key == 'overdraw') {\r\n\r\n          // ensure overdraw is backwards-compatable with legacy boolean type\r\n          this[key] = Number(newValue);\r\n\r\n        }\r\n        else {\r\n\r\n          this[key] = newValue;\r\n\r\n        }\r\n\r\n      }\r\n\r\n    }\r\n\r\n  },\r\n\r\n  toJSON: function() {\r\n\r\n    var output = {\r\n      metadata: {\r\n        version: 4.2,\r\n        type: 'material',\r\n        generator: 'MaterialExporter'\r\n      },\r\n      uuid: this.uuid,\r\n      type: this.type\r\n    };\r\n\r\n    if (this.name !== \"\") output.name = this.name;\r\n\r\n    if (this instanceof THREE.MeshBasicMaterial) {\r\n\r\n      output.color = this.color.getHex();\r\n      if (this.vertexColors !== THREE.NoColors) output.vertexColors = this.vertexColors;\r\n      if (this.blending !== THREE.NormalBlending) output.blending = this.blending;\r\n      if (this.side !== THREE.FrontSide) output.side = this.side;\r\n\r\n    }\r\n    else if (this instanceof THREE.MeshLambertMaterial) {\r\n\r\n      output.color = this.color.getHex();\r\n      output.emissive = this.emissive.getHex();\r\n      if (this.vertexColors !== THREE.NoColors) output.vertexColors = this.vertexColors;\r\n      if (this.shading !== THREE.SmoothShading) output.shading = this.shading;\r\n      if (this.blending !== THREE.NormalBlending) output.blending = this.blending;\r\n      if (this.side !== THREE.FrontSide) output.side = this.side;\r\n\r\n    }\r\n    else if (this instanceof THREE.MeshPhongMaterial) {\r\n\r\n      output.color = this.color.getHex();\r\n      output.emissive = this.emissive.getHex();\r\n      output.specular = this.specular.getHex();\r\n      output.shininess = this.shininess;\r\n      if (this.vertexColors !== THREE.NoColors) output.vertexColors = this.vertexColors;\r\n      if (this.shading !== THREE.SmoothShading) output.shading = this.shading;\r\n      if (this.blending !== THREE.NormalBlending) output.blending = this.blending;\r\n      if (this.side !== THREE.FrontSide) output.side = this.side;\r\n\r\n    }\r\n    else if (this instanceof THREE.MeshNormalMaterial) {\r\n\r\n      if (this.blending !== THREE.NormalBlending) output.blending = this.blending;\r\n      if (this.side !== THREE.FrontSide) output.side = this.side;\r\n\r\n    }\r\n    else if (this instanceof THREE.MeshDepthMaterial) {\r\n\r\n      if (this.blending !== THREE.NormalBlending) output.blending = this.blending;\r\n      if (this.side !== THREE.FrontSide) output.side = this.side;\r\n\r\n    }\r\n    else if (this instanceof THREE.PointCloudMaterial) {\r\n\r\n      output.size = this.size;\r\n      output.sizeAttenuation = this.sizeAttenuation;\r\n      output.color = this.color.getHex();\r\n\r\n      if (this.vertexColors !== THREE.NoColors) output.vertexColors = this.vertexColors;\r\n      if (this.blending !== THREE.NormalBlending) output.blending = this.blending;\r\n\r\n    }\r\n    else if (this instanceof THREE.ShaderMaterial) {\r\n\r\n      output.uniforms = this.uniforms;\r\n      output.vertexShader = this.vertexShader;\r\n      output.fragmentShader = this.fragmentShader;\r\n\r\n    }\r\n    else if (this instanceof THREE.SpriteMaterial) {\r\n\r\n      output.color = this.color.getHex();\r\n\r\n    }\r\n\r\n    if (this.opacity < 1) output.opacity = this.opacity;\r\n    if (this.transparent !== false) output.transparent = this.transparent;\r\n    if (this.wireframe !== false) output.wireframe = this.wireframe;\r\n\r\n    return output;\r\n\r\n  },\r\n\r\n  clone: function(material) {\r\n\r\n    if (material === undefined) material = new THREE.Material();\r\n\r\n    material.name = this.name;\r\n\r\n    material.side = this.side;\r\n\r\n    material.opacity = this.opacity;\r\n    material.transparent = this.transparent;\r\n\r\n    material.blending = this.blending;\r\n\r\n    material.blendSrc = this.blendSrc;\r\n    material.blendDst = this.blendDst;\r\n    material.blendEquation = this.blendEquation;\r\n    material.blendSrcAlpha = this.blendSrcAlpha;\r\n    material.blendDstAlpha = this.blendDstAlpha;\r\n    material.blendEquationAlpha = this.blendEquationAlpha;\r\n\r\n    material.depthTest = this.depthTest;\r\n    material.depthWrite = this.depthWrite;\r\n\r\n    material.polygonOffset = this.polygonOffset;\r\n    material.polygonOffsetFactor = this.polygonOffsetFactor;\r\n    material.polygonOffsetUnits = this.polygonOffsetUnits;\r\n\r\n    material.alphaTest = this.alphaTest;\r\n\r\n    material.overdraw = this.overdraw;\r\n\r\n    material.visible = this.visible;\r\n\r\n    return material;\r\n\r\n  },\r\n\r\n  update: function() {\r\n\r\n    this.dispatchEvent({\r\n      type: 'update'\r\n    });\r\n\r\n  },\r\n\r\n  dispose: function() {\r\n\r\n    this.dispatchEvent({\r\n      type: 'dispose'\r\n    });\r\n\r\n  }\r\n\r\n};\r\n\r\nTHREE.EventDispatcher.prototype.apply(THREE.Material.prototype);\r\n\r\nTHREE.MaterialIdCount = 0;\r\n\r\n// File:src/materials/LineBasicMaterial.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author alteredq / http://alteredqualia.com/\r\n *\r\n * parameters = {\r\n *  color: <hex>,\r\n *  opacity: <float>,\r\n *\r\n *  blending: THREE.NormalBlending,\r\n *  depthTest: <bool>,\r\n *  depthWrite: <bool>,\r\n *\r\n *  linewidth: <float>,\r\n *  linecap: \"round\",\r\n *  linejoin: \"round\",\r\n *\r\n *  vertexColors: <bool>\r\n *\r\n *  fog: <bool>\r\n * }\r\n */\r\n\r\nTHREE.LineBasicMaterial = function(parameters) {\r\n\r\n  THREE.Material.call(this);\r\n\r\n  this.type = 'LineBasicMaterial';\r\n\r\n  this.color = new THREE.Color(0xffffff);\r\n\r\n  this.linewidth = 1;\r\n  this.linecap = 'round';\r\n  this.linejoin = 'round';\r\n\r\n  this.vertexColors = THREE.NoColors;\r\n\r\n  this.fog = true;\r\n\r\n  this.setValues(parameters);\r\n\r\n};\r\n\r\nTHREE.LineBasicMaterial.prototype = Object.create(THREE.Material.prototype);\r\nTHREE.LineBasicMaterial.prototype.constructor = THREE.LineBasicMaterial;\r\n\r\nTHREE.LineBasicMaterial.prototype.clone = function() {\r\n\r\n  var material = new THREE.LineBasicMaterial();\r\n\r\n  THREE.Material.prototype.clone.call(this, material);\r\n\r\n  material.color.copy(this.color);\r\n\r\n  material.linewidth = this.linewidth;\r\n  material.linecap = this.linecap;\r\n  material.linejoin = this.linejoin;\r\n\r\n  material.vertexColors = this.vertexColors;\r\n\r\n  material.fog = this.fog;\r\n\r\n  return material;\r\n\r\n};\r\n\r\n// File:src/materials/LineDashedMaterial.js\r\n\r\n/**\r\n * @author alteredq / http://alteredqualia.com/\r\n *\r\n * parameters = {\r\n *  color: <hex>,\r\n *  opacity: <float>,\r\n *\r\n *  blending: THREE.NormalBlending,\r\n *  depthTest: <bool>,\r\n *  depthWrite: <bool>,\r\n *\r\n *  linewidth: <float>,\r\n *\r\n *  scale: <float>,\r\n *  dashSize: <float>,\r\n *  gapSize: <float>,\r\n *\r\n *  vertexColors: <bool>\r\n *\r\n *  fog: <bool>\r\n * }\r\n */\r\n\r\nTHREE.LineDashedMaterial = function(parameters) {\r\n\r\n  THREE.Material.call(this);\r\n\r\n  this.type = 'LineDashedMaterial';\r\n\r\n  this.color = new THREE.Color(0xffffff);\r\n\r\n  this.linewidth = 1;\r\n\r\n  this.scale = 1;\r\n  this.dashSize = 3;\r\n  this.gapSize = 1;\r\n\r\n  this.vertexColors = false;\r\n\r\n  this.fog = true;\r\n\r\n  this.setValues(parameters);\r\n\r\n};\r\n\r\nTHREE.LineDashedMaterial.prototype = Object.create(THREE.Material.prototype);\r\nTHREE.LineDashedMaterial.prototype.constructor = THREE.LineDashedMaterial;\r\n\r\nTHREE.LineDashedMaterial.prototype.clone = function() {\r\n\r\n  var material = new THREE.LineDashedMaterial();\r\n\r\n  THREE.Material.prototype.clone.call(this, material);\r\n\r\n  material.color.copy(this.color);\r\n\r\n  material.linewidth = this.linewidth;\r\n\r\n  material.scale = this.scale;\r\n  material.dashSize = this.dashSize;\r\n  material.gapSize = this.gapSize;\r\n\r\n  material.vertexColors = this.vertexColors;\r\n\r\n  material.fog = this.fog;\r\n\r\n  return material;\r\n\r\n};\r\n\r\n// File:src/materials/MeshBasicMaterial.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author alteredq / http://alteredqualia.com/\r\n *\r\n * parameters = {\r\n *  color: <hex>,\r\n *  opacity: <float>,\r\n *  map: new THREE.Texture( <Image> ),\r\n *\r\n *  lightMap: new THREE.Texture( <Image> ),\r\n *\r\n *  specularMap: new THREE.Texture( <Image> ),\r\n *\r\n *  alphaMap: new THREE.Texture( <Image> ),\r\n *\r\n *  envMap: new THREE.TextureCube( [posx, negx, posy, negy, posz, negz] ),\r\n *  combine: THREE.Multiply,\r\n *  reflectivity: <float>,\r\n *  refractionRatio: <float>,\r\n *\r\n *  shading: THREE.SmoothShading,\r\n *  blending: THREE.NormalBlending,\r\n *  depthTest: <bool>,\r\n *  depthWrite: <bool>,\r\n *\r\n *  wireframe: <boolean>,\r\n *  wireframeLinewidth: <float>,\r\n *\r\n *  vertexColors: THREE.NoColors / THREE.VertexColors / THREE.FaceColors,\r\n *\r\n *  skinning: <bool>,\r\n *  morphTargets: <bool>,\r\n *\r\n *  fog: <bool>\r\n * }\r\n */\r\n\r\nTHREE.MeshBasicMaterial = function(parameters) {\r\n\r\n  THREE.Material.call(this);\r\n\r\n  this.type = 'MeshBasicMaterial';\r\n\r\n  this.color = new THREE.Color(0xffffff); // emissive\r\n\r\n  this.map = null;\r\n\r\n  this.lightMap = null;\r\n\r\n  this.specularMap = null;\r\n\r\n  this.alphaMap = null;\r\n\r\n  this.envMap = null;\r\n  this.combine = THREE.MultiplyOperation;\r\n  this.reflectivity = 1;\r\n  this.refractionRatio = 0.98;\r\n\r\n  this.fog = true;\r\n\r\n  this.shading = THREE.SmoothShading;\r\n\r\n  this.wireframe = false;\r\n  this.wireframeLinewidth = 1;\r\n  this.wireframeLinecap = 'round';\r\n  this.wireframeLinejoin = 'round';\r\n\r\n  this.vertexColors = THREE.NoColors;\r\n\r\n  this.skinning = false;\r\n  this.morphTargets = false;\r\n\r\n  this.setValues(parameters);\r\n\r\n};\r\n\r\nTHREE.MeshBasicMaterial.prototype = Object.create(THREE.Material.prototype);\r\nTHREE.MeshBasicMaterial.prototype.constructor = THREE.MeshBasicMaterial;\r\n\r\nTHREE.MeshBasicMaterial.prototype.clone = function() {\r\n\r\n  var material = new THREE.MeshBasicMaterial();\r\n\r\n  THREE.Material.prototype.clone.call(this, material);\r\n\r\n  material.color.copy(this.color);\r\n\r\n  material.map = this.map;\r\n\r\n  material.lightMap = this.lightMap;\r\n\r\n  material.specularMap = this.specularMap;\r\n\r\n  material.alphaMap = this.alphaMap;\r\n\r\n  material.envMap = this.envMap;\r\n  material.combine = this.combine;\r\n  material.reflectivity = this.reflectivity;\r\n  material.refractionRatio = this.refractionRatio;\r\n\r\n  material.fog = this.fog;\r\n\r\n  material.shading = this.shading;\r\n\r\n  material.wireframe = this.wireframe;\r\n  material.wireframeLinewidth = this.wireframeLinewidth;\r\n  material.wireframeLinecap = this.wireframeLinecap;\r\n  material.wireframeLinejoin = this.wireframeLinejoin;\r\n\r\n  material.vertexColors = this.vertexColors;\r\n\r\n  material.skinning = this.skinning;\r\n  material.morphTargets = this.morphTargets;\r\n\r\n  return material;\r\n\r\n};\r\n\r\n// File:src/materials/MeshLambertMaterial.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author alteredq / http://alteredqualia.com/\r\n *\r\n * parameters = {\r\n *  color: <hex>,\r\n *  emissive: <hex>,\r\n *  opacity: <float>,\r\n *\r\n *  map: new THREE.Texture( <Image> ),\r\n *\r\n *  lightMap: new THREE.Texture( <Image> ),\r\n *\r\n *  specularMap: new THREE.Texture( <Image> ),\r\n *\r\n *  alphaMap: new THREE.Texture( <Image> ),\r\n *\r\n *  envMap: new THREE.TextureCube( [posx, negx, posy, negy, posz, negz] ),\r\n *  combine: THREE.Multiply,\r\n *  reflectivity: <float>,\r\n *  refractionRatio: <float>,\r\n *\r\n *  shading: THREE.SmoothShading,\r\n *  blending: THREE.NormalBlending,\r\n *  depthTest: <bool>,\r\n *  depthWrite: <bool>,\r\n *\r\n *  wireframe: <boolean>,\r\n *  wireframeLinewidth: <float>,\r\n *\r\n *  vertexColors: THREE.NoColors / THREE.VertexColors / THREE.FaceColors,\r\n *\r\n *  skinning: <bool>,\r\n *  morphTargets: <bool>,\r\n *  morphNormals: <bool>,\r\n *\r\n *\tfog: <bool>\r\n * }\r\n */\r\n\r\nTHREE.MeshLambertMaterial = function(parameters) {\r\n\r\n  THREE.Material.call(this);\r\n\r\n  this.type = 'MeshLambertMaterial';\r\n\r\n  this.color = new THREE.Color(0xffffff); // diffuse\r\n  this.emissive = new THREE.Color(0x000000);\r\n\r\n  this.wrapAround = false;\r\n  this.wrapRGB = new THREE.Vector3(1, 1, 1);\r\n\r\n  this.map = null;\r\n\r\n  this.lightMap = null;\r\n\r\n  this.specularMap = null;\r\n\r\n  this.alphaMap = null;\r\n\r\n  this.envMap = null;\r\n  this.combine = THREE.MultiplyOperation;\r\n  this.reflectivity = 1;\r\n  this.refractionRatio = 0.98;\r\n\r\n  this.fog = true;\r\n\r\n  this.shading = THREE.SmoothShading;\r\n\r\n  this.wireframe = false;\r\n  this.wireframeLinewidth = 1;\r\n  this.wireframeLinecap = 'round';\r\n  this.wireframeLinejoin = 'round';\r\n\r\n  this.vertexColors = THREE.NoColors;\r\n\r\n  this.skinning = false;\r\n  this.morphTargets = false;\r\n  this.morphNormals = false;\r\n\r\n  this.setValues(parameters);\r\n\r\n};\r\n\r\nTHREE.MeshLambertMaterial.prototype = Object.create(THREE.Material.prototype);\r\nTHREE.MeshLambertMaterial.prototype.constructor = THREE.MeshLambertMaterial;\r\n\r\nTHREE.MeshLambertMaterial.prototype.clone = function() {\r\n\r\n  var material = new THREE.MeshLambertMaterial();\r\n\r\n  THREE.Material.prototype.clone.call(this, material);\r\n\r\n  material.color.copy(this.color);\r\n  material.emissive.copy(this.emissive);\r\n\r\n  material.wrapAround = this.wrapAround;\r\n  material.wrapRGB.copy(this.wrapRGB);\r\n\r\n  material.map = this.map;\r\n\r\n  material.lightMap = this.lightMap;\r\n\r\n  material.specularMap = this.specularMap;\r\n\r\n  material.alphaMap = this.alphaMap;\r\n\r\n  material.envMap = this.envMap;\r\n  material.combine = this.combine;\r\n  material.reflectivity = this.reflectivity;\r\n  material.refractionRatio = this.refractionRatio;\r\n\r\n  material.fog = this.fog;\r\n\r\n  material.shading = this.shading;\r\n\r\n  material.wireframe = this.wireframe;\r\n  material.wireframeLinewidth = this.wireframeLinewidth;\r\n  material.wireframeLinecap = this.wireframeLinecap;\r\n  material.wireframeLinejoin = this.wireframeLinejoin;\r\n\r\n  material.vertexColors = this.vertexColors;\r\n\r\n  material.skinning = this.skinning;\r\n  material.morphTargets = this.morphTargets;\r\n  material.morphNormals = this.morphNormals;\r\n\r\n  return material;\r\n\r\n};\r\n\r\n// File:src/materials/MeshPhongMaterial.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author alteredq / http://alteredqualia.com/\r\n *\r\n * parameters = {\r\n *  color: <hex>,\r\n *  emissive: <hex>,\r\n *  specular: <hex>,\r\n *  shininess: <float>,\r\n *  opacity: <float>,\r\n *\r\n *  map: new THREE.Texture( <Image> ),\r\n *\r\n *  lightMap: new THREE.Texture( <Image> ),\r\n *\r\n *  bumpMap: new THREE.Texture( <Image> ),\r\n *  bumpScale: <float>,\r\n *\r\n *  normalMap: new THREE.Texture( <Image> ),\r\n *  normalScale: <Vector2>,\r\n *\r\n *  specularMap: new THREE.Texture( <Image> ),\r\n *\r\n *  alphaMap: new THREE.Texture( <Image> ),\r\n *\r\n *  envMap: new THREE.TextureCube( [posx, negx, posy, negy, posz, negz] ),\r\n *  combine: THREE.Multiply,\r\n *  reflectivity: <float>,\r\n *  refractionRatio: <float>,\r\n *\r\n *  shading: THREE.SmoothShading,\r\n *  blending: THREE.NormalBlending,\r\n *  depthTest: <bool>,\r\n *  depthWrite: <bool>,\r\n *\r\n *  wireframe: <boolean>,\r\n *  wireframeLinewidth: <float>,\r\n *\r\n *  vertexColors: THREE.NoColors / THREE.VertexColors / THREE.FaceColors,\r\n *\r\n *  skinning: <bool>,\r\n *  morphTargets: <bool>,\r\n *  morphNormals: <bool>,\r\n *\r\n *\tfog: <bool>\r\n * }\r\n */\r\n\r\nTHREE.MeshPhongMaterial = function(parameters) {\r\n\r\n  THREE.Material.call(this);\r\n\r\n  this.type = 'MeshPhongMaterial';\r\n\r\n  this.color = new THREE.Color(0xffffff); // diffuse\r\n  this.emissive = new THREE.Color(0x000000);\r\n  this.specular = new THREE.Color(0x111111);\r\n  this.shininess = 30;\r\n\r\n  this.metal = false;\r\n\r\n  this.wrapAround = false;\r\n  this.wrapRGB = new THREE.Vector3(1, 1, 1);\r\n\r\n  this.map = null;\r\n\r\n  this.lightMap = null;\r\n\r\n  this.bumpMap = null;\r\n  this.bumpScale = 1;\r\n\r\n  this.normalMap = null;\r\n  this.normalScale = new THREE.Vector2(1, 1);\r\n\r\n  this.specularMap = null;\r\n\r\n  this.alphaMap = null;\r\n\r\n  this.envMap = null;\r\n  this.combine = THREE.MultiplyOperation;\r\n  this.reflectivity = 1;\r\n  this.refractionRatio = 0.98;\r\n\r\n  this.fog = true;\r\n\r\n  this.shading = THREE.SmoothShading;\r\n\r\n  this.wireframe = false;\r\n  this.wireframeLinewidth = 1;\r\n  this.wireframeLinecap = 'round';\r\n  this.wireframeLinejoin = 'round';\r\n\r\n  this.vertexColors = THREE.NoColors;\r\n\r\n  this.skinning = false;\r\n  this.morphTargets = false;\r\n  this.morphNormals = false;\r\n\r\n  this.setValues(parameters);\r\n\r\n};\r\n\r\nTHREE.MeshPhongMaterial.prototype = Object.create(THREE.Material.prototype);\r\nTHREE.MeshPhongMaterial.prototype.constructor = THREE.MeshPhongMaterial;\r\n\r\nTHREE.MeshPhongMaterial.prototype.clone = function() {\r\n\r\n  var material = new THREE.MeshPhongMaterial();\r\n\r\n  THREE.Material.prototype.clone.call(this, material);\r\n\r\n  material.color.copy(this.color);\r\n  material.emissive.copy(this.emissive);\r\n  material.specular.copy(this.specular);\r\n  material.shininess = this.shininess;\r\n\r\n  material.metal = this.metal;\r\n\r\n  material.wrapAround = this.wrapAround;\r\n  material.wrapRGB.copy(this.wrapRGB);\r\n\r\n  material.map = this.map;\r\n\r\n  material.lightMap = this.lightMap;\r\n\r\n  material.bumpMap = this.bumpMap;\r\n  material.bumpScale = this.bumpScale;\r\n\r\n  material.normalMap = this.normalMap;\r\n  material.normalScale.copy(this.normalScale);\r\n\r\n  material.specularMap = this.specularMap;\r\n\r\n  material.alphaMap = this.alphaMap;\r\n\r\n  material.envMap = this.envMap;\r\n  material.combine = this.combine;\r\n  material.reflectivity = this.reflectivity;\r\n  material.refractionRatio = this.refractionRatio;\r\n\r\n  material.fog = this.fog;\r\n\r\n  material.shading = this.shading;\r\n\r\n  material.wireframe = this.wireframe;\r\n  material.wireframeLinewidth = this.wireframeLinewidth;\r\n  material.wireframeLinecap = this.wireframeLinecap;\r\n  material.wireframeLinejoin = this.wireframeLinejoin;\r\n\r\n  material.vertexColors = this.vertexColors;\r\n\r\n  material.skinning = this.skinning;\r\n  material.morphTargets = this.morphTargets;\r\n  material.morphNormals = this.morphNormals;\r\n\r\n  return material;\r\n\r\n};\r\n\r\n// File:src/materials/MeshDepthMaterial.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author alteredq / http://alteredqualia.com/\r\n *\r\n * parameters = {\r\n *  opacity: <float>,\r\n *\r\n *  blending: THREE.NormalBlending,\r\n *  depthTest: <bool>,\r\n *  depthWrite: <bool>,\r\n *\r\n *  wireframe: <boolean>,\r\n *  wireframeLinewidth: <float>\r\n * }\r\n */\r\n\r\nTHREE.MeshDepthMaterial = function(parameters) {\r\n\r\n  THREE.Material.call(this);\r\n\r\n  this.type = 'MeshDepthMaterial';\r\n\r\n  this.morphTargets = false;\r\n  this.wireframe = false;\r\n  this.wireframeLinewidth = 1;\r\n\r\n  this.setValues(parameters);\r\n\r\n};\r\n\r\nTHREE.MeshDepthMaterial.prototype = Object.create(THREE.Material.prototype);\r\nTHREE.MeshDepthMaterial.prototype.constructor = THREE.MeshDepthMaterial;\r\n\r\nTHREE.MeshDepthMaterial.prototype.clone = function() {\r\n\r\n  var material = new THREE.MeshDepthMaterial();\r\n\r\n  THREE.Material.prototype.clone.call(this, material);\r\n\r\n  material.wireframe = this.wireframe;\r\n  material.wireframeLinewidth = this.wireframeLinewidth;\r\n\r\n  return material;\r\n\r\n};\r\n\r\n// File:src/materials/MeshNormalMaterial.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n *\r\n * parameters = {\r\n *  opacity: <float>,\r\n *\r\n *  shading: THREE.FlatShading,\r\n *  blending: THREE.NormalBlending,\r\n *  depthTest: <bool>,\r\n *  depthWrite: <bool>,\r\n *\r\n *  wireframe: <boolean>,\r\n *  wireframeLinewidth: <float>\r\n * }\r\n */\r\n\r\nTHREE.MeshNormalMaterial = function(parameters) {\r\n\r\n  THREE.Material.call(this, parameters);\r\n\r\n  this.type = 'MeshNormalMaterial';\r\n\r\n  this.wireframe = false;\r\n  this.wireframeLinewidth = 1;\r\n\r\n  this.morphTargets = false;\r\n\r\n  this.setValues(parameters);\r\n\r\n};\r\n\r\nTHREE.MeshNormalMaterial.prototype = Object.create(THREE.Material.prototype);\r\nTHREE.MeshNormalMaterial.prototype.constructor = THREE.MeshNormalMaterial;\r\n\r\nTHREE.MeshNormalMaterial.prototype.clone = function() {\r\n\r\n  var material = new THREE.MeshNormalMaterial();\r\n\r\n  THREE.Material.prototype.clone.call(this, material);\r\n\r\n  material.wireframe = this.wireframe;\r\n  material.wireframeLinewidth = this.wireframeLinewidth;\r\n\r\n  return material;\r\n\r\n};\r\n\r\n// File:src/materials/MeshFaceMaterial.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.MeshFaceMaterial = function(materials) {\r\n\r\n  this.uuid = THREE.Math.generateUUID();\r\n\r\n  this.type = 'MeshFaceMaterial';\r\n\r\n  this.materials = materials instanceof Array ? materials : [];\r\n\r\n};\r\n\r\nTHREE.MeshFaceMaterial.prototype = {\r\n\r\n  constructor: THREE.MeshFaceMaterial,\r\n\r\n  toJSON: function() {\r\n\r\n    var output = {\r\n      metadata: {\r\n        version: 4.2,\r\n        type: 'material',\r\n        generator: 'MaterialExporter'\r\n      },\r\n      uuid: this.uuid,\r\n      type: this.type,\r\n      materials: []\r\n    };\r\n\r\n    for (var i = 0, l = this.materials.length; i < l; i++) {\r\n\r\n      output.materials.push(this.materials[i].toJSON());\r\n\r\n    }\r\n\r\n    return output;\r\n\r\n  },\r\n\r\n  clone: function() {\r\n\r\n    var material = new THREE.MeshFaceMaterial();\r\n\r\n    for (var i = 0; i < this.materials.length; i++) {\r\n\r\n      material.materials.push(this.materials[i].clone());\r\n\r\n    }\r\n\r\n    return material;\r\n\r\n  }\r\n\r\n};\r\n\r\n// File:src/materials/PointCloudMaterial.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author alteredq / http://alteredqualia.com/\r\n *\r\n * parameters = {\r\n *  color: <hex>,\r\n *  opacity: <float>,\r\n *  map: new THREE.Texture( <Image> ),\r\n *\r\n *  size: <float>,\r\n *  sizeAttenuation: <bool>,\r\n *\r\n *  blending: THREE.NormalBlending,\r\n *  depthTest: <bool>,\r\n *  depthWrite: <bool>,\r\n *\r\n *  vertexColors: <bool>,\r\n *\r\n *  fog: <bool>\r\n * }\r\n */\r\n\r\nTHREE.PointCloudMaterial = function(parameters) {\r\n\r\n  THREE.Material.call(this);\r\n\r\n  this.type = 'PointCloudMaterial';\r\n\r\n  this.color = new THREE.Color(0xffffff);\r\n\r\n  this.map = null;\r\n\r\n  this.size = 1;\r\n  this.sizeAttenuation = true;\r\n\r\n  this.vertexColors = THREE.NoColors;\r\n\r\n  this.fog = true;\r\n\r\n  this.setValues(parameters);\r\n\r\n};\r\n\r\nTHREE.PointCloudMaterial.prototype = Object.create(THREE.Material.prototype);\r\nTHREE.PointCloudMaterial.prototype.constructor = THREE.PointCloudMaterial;\r\n\r\nTHREE.PointCloudMaterial.prototype.clone = function() {\r\n\r\n  var material = new THREE.PointCloudMaterial();\r\n\r\n  THREE.Material.prototype.clone.call(this, material);\r\n\r\n  material.color.copy(this.color);\r\n\r\n  material.map = this.map;\r\n\r\n  material.size = this.size;\r\n  material.sizeAttenuation = this.sizeAttenuation;\r\n\r\n  material.vertexColors = this.vertexColors;\r\n\r\n  material.fog = this.fog;\r\n\r\n  return material;\r\n\r\n};\r\n\r\n// backwards compatibility\r\n\r\nTHREE.ParticleBasicMaterial = function(parameters) {\r\n\r\n  THREE.warn('THREE.ParticleBasicMaterial has been renamed to THREE.PointCloudMaterial.');\r\n  return new THREE.PointCloudMaterial(parameters);\r\n\r\n};\r\n\r\nTHREE.ParticleSystemMaterial = function(parameters) {\r\n\r\n  THREE.warn('THREE.ParticleSystemMaterial has been renamed to THREE.PointCloudMaterial.');\r\n  return new THREE.PointCloudMaterial(parameters);\r\n\r\n};\r\n\r\n// File:src/materials/ShaderMaterial.js\r\n\r\n/**\r\n * @author alteredq / http://alteredqualia.com/\r\n *\r\n * parameters = {\r\n *  defines: { \"label\" : \"value\" },\r\n *  uniforms: { \"parameter1\": { type: \"f\", value: 1.0 }, \"parameter2\": { type: \"i\" value2: 2 } },\r\n *\r\n *  fragmentShader: <string>,\r\n *  vertexShader: <string>,\r\n *\r\n *  shading: THREE.SmoothShading,\r\n *  blending: THREE.NormalBlending,\r\n *  depthTest: <bool>,\r\n *  depthWrite: <bool>,\r\n *\r\n *  wireframe: <boolean>,\r\n *  wireframeLinewidth: <float>,\r\n *\r\n *  lights: <bool>,\r\n *\r\n *  vertexColors: THREE.NoColors / THREE.VertexColors / THREE.FaceColors,\r\n *\r\n *  skinning: <bool>,\r\n *  morphTargets: <bool>,\r\n *  morphNormals: <bool>,\r\n *\r\n *\tfog: <bool>\r\n * }\r\n */\r\n\r\nTHREE.ShaderMaterial = function(parameters) {\r\n\r\n  THREE.Material.call(this);\r\n\r\n  this.type = 'ShaderMaterial';\r\n\r\n  this.defines = {};\r\n  this.uniforms = {};\r\n  this.attributes = null;\r\n\r\n  this.vertexShader = 'void main() {\\n\\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\\n}';\r\n  this.fragmentShader = 'void main() {\\n\\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\\n}';\r\n\r\n  this.shading = THREE.SmoothShading;\r\n\r\n  this.linewidth = 1;\r\n\r\n  this.wireframe = false;\r\n  this.wireframeLinewidth = 1;\r\n\r\n  this.fog = false; // set to use scene fog\r\n\r\n  this.lights = false; // set to use scene lights\r\n\r\n  this.vertexColors = THREE.NoColors; // set to use \"color\" attribute stream\r\n\r\n  this.skinning = false; // set to use skinning attribute streams\r\n\r\n  this.morphTargets = false; // set to use morph targets\r\n  this.morphNormals = false; // set to use morph normals\r\n\r\n  // When rendered geometry doesn't include these attributes but the material does,\r\n  // use these default values in WebGL. This avoids errors when buffer data is missing.\r\n  this.defaultAttributeValues = {\r\n    'color': [1, 1, 1],\r\n    'uv': [0, 0],\r\n    'uv2': [0, 0]\r\n  };\r\n\r\n  this.index0AttributeName = undefined;\r\n\r\n  this.setValues(parameters);\r\n\r\n};\r\n\r\nTHREE.ShaderMaterial.prototype = Object.create(THREE.Material.prototype);\r\nTHREE.ShaderMaterial.prototype.constructor = THREE.ShaderMaterial;\r\n\r\nTHREE.ShaderMaterial.prototype.clone = function() {\r\n\r\n  var material = new THREE.ShaderMaterial();\r\n\r\n  THREE.Material.prototype.clone.call(this, material);\r\n\r\n  material.fragmentShader = this.fragmentShader;\r\n  material.vertexShader = this.vertexShader;\r\n\r\n  material.uniforms = THREE.UniformsUtils.clone(this.uniforms);\r\n\r\n  material.attributes = this.attributes;\r\n  material.defines = this.defines;\r\n\r\n  material.shading = this.shading;\r\n\r\n  material.wireframe = this.wireframe;\r\n  material.wireframeLinewidth = this.wireframeLinewidth;\r\n\r\n  material.fog = this.fog;\r\n\r\n  material.lights = this.lights;\r\n\r\n  material.vertexColors = this.vertexColors;\r\n\r\n  material.skinning = this.skinning;\r\n\r\n  material.morphTargets = this.morphTargets;\r\n  material.morphNormals = this.morphNormals;\r\n\r\n  return material;\r\n\r\n};\r\n\r\n// File:src/materials/RawShaderMaterial.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.RawShaderMaterial = function(parameters) {\r\n\r\n  THREE.ShaderMaterial.call(this, parameters);\r\n\r\n  this.type = 'RawShaderMaterial';\r\n\r\n};\r\n\r\nTHREE.RawShaderMaterial.prototype = Object.create(THREE.ShaderMaterial.prototype);\r\nTHREE.RawShaderMaterial.prototype.constructor = THREE.RawShaderMaterial;\r\n\r\nTHREE.RawShaderMaterial.prototype.clone = function() {\r\n\r\n  var material = new THREE.RawShaderMaterial();\r\n\r\n  THREE.ShaderMaterial.prototype.clone.call(this, material);\r\n\r\n  return material;\r\n\r\n};\r\n\r\n// File:src/materials/SpriteMaterial.js\r\n\r\n/**\r\n * @author alteredq / http://alteredqualia.com/\r\n *\r\n * parameters = {\r\n *  color: <hex>,\r\n *  opacity: <float>,\r\n *  map: new THREE.Texture( <Image> ),\r\n *\r\n *  blending: THREE.NormalBlending,\r\n *  depthTest: <bool>,\r\n *  depthWrite: <bool>,\r\n *\r\n *\tuvOffset: new THREE.Vector2(),\r\n *\tuvScale: new THREE.Vector2(),\r\n *\r\n *  fog: <bool>\r\n * }\r\n */\r\n\r\nTHREE.SpriteMaterial = function(parameters) {\r\n\r\n  THREE.Material.call(this);\r\n\r\n  this.type = 'SpriteMaterial';\r\n\r\n  this.color = new THREE.Color(0xffffff);\r\n  this.map = null;\r\n\r\n  this.rotation = 0;\r\n\r\n  this.fog = false;\r\n\r\n  // set parameters\r\n\r\n  this.setValues(parameters);\r\n\r\n};\r\n\r\nTHREE.SpriteMaterial.prototype = Object.create(THREE.Material.prototype);\r\nTHREE.SpriteMaterial.prototype.constructor = THREE.SpriteMaterial;\r\n\r\nTHREE.SpriteMaterial.prototype.clone = function() {\r\n\r\n  var material = new THREE.SpriteMaterial();\r\n\r\n  THREE.Material.prototype.clone.call(this, material);\r\n\r\n  material.color.copy(this.color);\r\n  material.map = this.map;\r\n\r\n  material.rotation = this.rotation;\r\n\r\n  material.fog = this.fog;\r\n\r\n  return material;\r\n\r\n};\r\n\r\n// File:src/textures/Texture.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author alteredq / http://alteredqualia.com/\r\n * @author szimek / https://github.com/szimek/\r\n */\r\n\r\nTHREE.Texture = function(image, mapping, wrapS, wrapT, magFilter, minFilter, format, type, anisotropy) {\r\n\r\n  Object.defineProperty(this, 'id', {\r\n    value: THREE.TextureIdCount++\r\n  });\r\n\r\n  this.uuid = THREE.Math.generateUUID();\r\n\r\n  this.name = '';\r\n  this.sourceFile = '';\r\n\r\n  this.image = image !== undefined ? image : THREE.Texture.DEFAULT_IMAGE;\r\n  this.mipmaps = [];\r\n\r\n  this.mapping = mapping !== undefined ? mapping : THREE.Texture.DEFAULT_MAPPING;\r\n\r\n  this.wrapS = wrapS !== undefined ? wrapS : THREE.ClampToEdgeWrapping;\r\n  this.wrapT = wrapT !== undefined ? wrapT : THREE.ClampToEdgeWrapping;\r\n\r\n  this.magFilter = magFilter !== undefined ? magFilter : THREE.LinearFilter;\r\n  this.minFilter = minFilter !== undefined ? minFilter : THREE.LinearMipMapLinearFilter;\r\n\r\n  this.anisotropy = anisotropy !== undefined ? anisotropy : 1;\r\n\r\n  this.format = format !== undefined ? format : THREE.RGBAFormat;\r\n  this.type = type !== undefined ? type : THREE.UnsignedByteType;\r\n\r\n  this.offset = new THREE.Vector2(0, 0);\r\n  this.repeat = new THREE.Vector2(1, 1);\r\n\r\n  this.generateMipmaps = true;\r\n  this.premultiplyAlpha = false;\r\n  this.flipY = true;\r\n  this.unpackAlignment = 4; // valid values: 1, 2, 4, 8 (see http://www.khronos.org/opengles/sdk/docs/man/xhtml/glPixelStorei.xml)\r\n\r\n  this._needsUpdate = false;\r\n  this.onUpdate = null;\r\n\r\n};\r\n\r\nTHREE.Texture.DEFAULT_IMAGE = undefined;\r\nTHREE.Texture.DEFAULT_MAPPING = THREE.UVMapping;\r\n\r\nTHREE.Texture.prototype = {\r\n\r\n  constructor: THREE.Texture,\r\n\r\n  get needsUpdate() {\r\n\r\n    return this._needsUpdate;\r\n\r\n  },\r\n\r\n  set needsUpdate(value) {\r\n\r\n    if (value === true) this.update();\r\n\r\n    this._needsUpdate = value;\r\n\r\n  },\r\n\r\n  clone: function(texture) {\r\n\r\n    if (texture === undefined) texture = new THREE.Texture();\r\n\r\n    texture.image = this.image;\r\n    texture.mipmaps = this.mipmaps.slice(0);\r\n\r\n    texture.mapping = this.mapping;\r\n\r\n    texture.wrapS = this.wrapS;\r\n    texture.wrapT = this.wrapT;\r\n\r\n    texture.magFilter = this.magFilter;\r\n    texture.minFilter = this.minFilter;\r\n\r\n    texture.anisotropy = this.anisotropy;\r\n\r\n    texture.format = this.format;\r\n    texture.type = this.type;\r\n\r\n    texture.offset.copy(this.offset);\r\n    texture.repeat.copy(this.repeat);\r\n\r\n    texture.generateMipmaps = this.generateMipmaps;\r\n    texture.premultiplyAlpha = this.premultiplyAlpha;\r\n    texture.flipY = this.flipY;\r\n    texture.unpackAlignment = this.unpackAlignment;\r\n\r\n    return texture;\r\n\r\n  },\r\n\r\n  update: function() {\r\n\r\n    this.dispatchEvent({\r\n      type: 'update'\r\n    });\r\n\r\n  },\r\n\r\n  dispose: function() {\r\n\r\n    this.dispatchEvent({\r\n      type: 'dispose'\r\n    });\r\n\r\n  }\r\n\r\n};\r\n\r\nTHREE.EventDispatcher.prototype.apply(THREE.Texture.prototype);\r\n\r\nTHREE.TextureIdCount = 0;\r\n\r\n// File:src/textures/CubeTexture.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.CubeTexture = function(images, mapping, wrapS, wrapT, magFilter, minFilter, format, type, anisotropy) {\r\n\r\n  mapping = mapping !== undefined ? mapping : THREE.CubeReflectionMapping;\r\n\r\n  THREE.Texture.call(this, images, mapping, wrapS, wrapT, magFilter, minFilter, format, type, anisotropy);\r\n\r\n  this.images = images;\r\n\r\n};\r\n\r\nTHREE.CubeTexture.prototype = Object.create(THREE.Texture.prototype);\r\nTHREE.CubeTexture.prototype.constructor = THREE.CubeTexture;\r\n\r\nTHREE.CubeTexture.clone = function(texture) {\r\n\r\n  if (texture === undefined) texture = new THREE.CubeTexture();\r\n\r\n  THREE.Texture.prototype.clone.call(this, texture);\r\n\r\n  texture.images = this.images;\r\n\r\n  return texture;\r\n\r\n};\r\n\r\n// File:src/textures/CompressedTexture.js\r\n\r\n/**\r\n * @author alteredq / http://alteredqualia.com/\r\n */\r\n\r\nTHREE.CompressedTexture = function(mipmaps, width, height, format, type, mapping, wrapS, wrapT, magFilter, minFilter, anisotropy) {\r\n\r\n  THREE.Texture.call(this, null, mapping, wrapS, wrapT, magFilter, minFilter, format, type, anisotropy);\r\n\r\n  this.image = {\r\n    width: width,\r\n    height: height\r\n  };\r\n  this.mipmaps = mipmaps;\r\n\r\n  // no flipping for cube textures\r\n  // (also flipping doesn't work for compressed textures )\r\n\r\n  this.flipY = false;\r\n\r\n  // can't generate mipmaps for compressed textures\r\n  // mips must be embedded in DDS files\r\n\r\n  this.generateMipmaps = false;\r\n\r\n};\r\n\r\nTHREE.CompressedTexture.prototype = Object.create(THREE.Texture.prototype);\r\nTHREE.CompressedTexture.prototype.constructor = THREE.CompressedTexture;\r\n\r\nTHREE.CompressedTexture.prototype.clone = function() {\r\n\r\n  var texture = new THREE.CompressedTexture();\r\n\r\n  THREE.Texture.prototype.clone.call(this, texture);\r\n\r\n  return texture;\r\n\r\n};\r\n\r\n// File:src/textures/DataTexture.js\r\n\r\n/**\r\n * @author alteredq / http://alteredqualia.com/\r\n */\r\n\r\nTHREE.DataTexture = function(data, width, height, format, type, mapping, wrapS, wrapT, magFilter, minFilter, anisotropy) {\r\n\r\n  THREE.Texture.call(this, null, mapping, wrapS, wrapT, magFilter, minFilter, format, type, anisotropy);\r\n\r\n  this.image = {\r\n    data: data,\r\n    width: width,\r\n    height: height\r\n  };\r\n\r\n};\r\n\r\nTHREE.DataTexture.prototype = Object.create(THREE.Texture.prototype);\r\nTHREE.DataTexture.prototype.constructor = THREE.DataTexture;\r\n\r\nTHREE.DataTexture.prototype.clone = function() {\r\n\r\n  var texture = new THREE.DataTexture();\r\n\r\n  THREE.Texture.prototype.clone.call(this, texture);\r\n\r\n  return texture;\r\n\r\n};\r\n\r\n// File:src/textures/VideoTexture.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.VideoTexture = function(video, mapping, wrapS, wrapT, magFilter, minFilter, format, type, anisotropy) {\r\n\r\n  THREE.Texture.call(this, video, mapping, wrapS, wrapT, magFilter, minFilter, format, type, anisotropy);\r\n\r\n  this.generateMipmaps = false;\r\n\r\n  var scope = this;\r\n\r\n  var update = function() {\r\n\r\n    requestAnimationFrame(update);\r\n\r\n    if (video.readyState === video.HAVE_ENOUGH_DATA) {\r\n\r\n      scope.needsUpdate = true;\r\n\r\n    }\r\n\r\n  };\r\n\r\n  update();\r\n\r\n};\r\n\r\nTHREE.VideoTexture.prototype = Object.create(THREE.Texture.prototype);\r\nTHREE.VideoTexture.prototype.constructor = THREE.VideoTexture;\r\n\r\n// File:src/objects/Group.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.Group = function() {\r\n\r\n  THREE.Object3D.call(this);\r\n\r\n  this.type = 'Group';\r\n\r\n};\r\n\r\nTHREE.Group.prototype = Object.create(THREE.Object3D.prototype);\r\nTHREE.Group.prototype.constructor = THREE.Group;\r\n\r\n// File:src/objects/PointCloud.js\r\n\r\n/**\r\n * @author alteredq / http://alteredqualia.com/\r\n */\r\n\r\nTHREE.PointCloud = function(geometry, material) {\r\n\r\n  THREE.Object3D.call(this);\r\n\r\n  this.type = 'PointCloud';\r\n\r\n  this.geometry = geometry !== undefined ? geometry : new THREE.Geometry();\r\n  this.material = material !== undefined ? material : new THREE.PointCloudMaterial({\r\n    color: Math.random() * 0xffffff\r\n  });\r\n\r\n};\r\n\r\nTHREE.PointCloud.prototype = Object.create(THREE.Object3D.prototype);\r\nTHREE.PointCloud.prototype.constructor = THREE.PointCloud;\r\n\r\nTHREE.PointCloud.prototype.raycast = (function() {\r\n\r\n  var inverseMatrix = new THREE.Matrix4();\r\n  var ray = new THREE.Ray();\r\n\r\n  return function(raycaster, intersects) {\r\n\r\n    var object = this;\r\n    var geometry = object.geometry;\r\n    var threshold = raycaster.params.PointCloud.threshold;\r\n\r\n    inverseMatrix.getInverse(this.matrixWorld);\r\n    ray.copy(raycaster.ray).applyMatrix4(inverseMatrix);\r\n\r\n    if (geometry.boundingBox !== null) {\r\n\r\n      if (ray.isIntersectionBox(geometry.boundingBox) === false) {\r\n\r\n        return;\r\n\r\n      }\r\n\r\n    }\r\n\r\n    var localThreshold = threshold / ((this.scale.x + this.scale.y + this.scale.z) / 3);\r\n    var position = new THREE.Vector3();\r\n\r\n    var testPoint = function(point, index) {\r\n\r\n      var rayPointDistance = ray.distanceToPoint(point);\r\n\r\n      if (rayPointDistance < localThreshold) {\r\n\r\n        var intersectPoint = ray.closestPointToPoint(point);\r\n        intersectPoint.applyMatrix4(object.matrixWorld);\r\n\r\n        var distance = raycaster.ray.origin.distanceTo(intersectPoint);\r\n\r\n        intersects.push({\r\n\r\n          distance: distance,\r\n          distanceToRay: rayPointDistance,\r\n          point: intersectPoint.clone(),\r\n          index: index,\r\n          face: null,\r\n          object: object\r\n\r\n        });\r\n\r\n      }\r\n\r\n    };\r\n\r\n    if (geometry instanceof THREE.BufferGeometry) {\r\n\r\n      var attributes = geometry.attributes;\r\n      var positions = attributes.position.array;\r\n\r\n      if (attributes.index !== undefined) {\r\n\r\n        var indices = attributes.index.array;\r\n        var offsets = geometry.offsets;\r\n\r\n        if (offsets.length === 0) {\r\n\r\n          var offset = {\r\n            start: 0,\r\n            count: indices.length,\r\n            index: 0\r\n          };\r\n\r\n          offsets = [offset];\r\n\r\n        }\r\n\r\n        for (var oi = 0, ol = offsets.length; oi < ol; ++oi) {\r\n\r\n          var start = offsets[oi].start;\r\n          var count = offsets[oi].count;\r\n          var index = offsets[oi].index;\r\n\r\n          for (var i = start, il = start + count; i < il; i++) {\r\n\r\n            var a = index + indices[i];\r\n\r\n            position.fromArray(positions, a * 3);\r\n\r\n            testPoint(position, a);\r\n\r\n          }\r\n\r\n        }\r\n\r\n      }\r\n      else {\r\n\r\n        var pointCount = positions.length / 3;\r\n\r\n        for (var i = 0; i < pointCount; i++) {\r\n\r\n          position.set(\r\n            positions[3 * i],\r\n            positions[3 * i + 1],\r\n            positions[3 * i + 2]\r\n          );\r\n\r\n          testPoint(position, i);\r\n\r\n        }\r\n\r\n      }\r\n\r\n    }\r\n    else {\r\n\r\n      var vertices = this.geometry.vertices;\r\n\r\n      for (var i = 0; i < vertices.length; i++) {\r\n\r\n        testPoint(vertices[i], i);\r\n\r\n      }\r\n\r\n    }\r\n\r\n  };\r\n\r\n}());\r\n\r\nTHREE.PointCloud.prototype.clone = function(object) {\r\n\r\n  if (object === undefined) object = new THREE.PointCloud(this.geometry, this.material);\r\n\r\n  THREE.Object3D.prototype.clone.call(this, object);\r\n\r\n  return object;\r\n\r\n};\r\n\r\n// Backwards compatibility\r\n\r\nTHREE.ParticleSystem = function(geometry, material) {\r\n\r\n  THREE.warn('THREE.ParticleSystem has been renamed to THREE.PointCloud.');\r\n  return new THREE.PointCloud(geometry, material);\r\n\r\n};\r\n\r\n// File:src/objects/Line.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.Line = function(geometry, material, mode) {\r\n\r\n  THREE.Object3D.call(this);\r\n\r\n  this.type = 'Line';\r\n\r\n  this.geometry = geometry !== undefined ? geometry : new THREE.Geometry();\r\n  this.material = material !== undefined ? material : new THREE.LineBasicMaterial({\r\n    color: Math.random() * 0xffffff\r\n  });\r\n\r\n  this.mode = mode !== undefined ? mode : THREE.LineStrip;\r\n\r\n};\r\n\r\nTHREE.LineStrip = 0;\r\nTHREE.LinePieces = 1;\r\n\r\nTHREE.Line.prototype = Object.create(THREE.Object3D.prototype);\r\nTHREE.Line.prototype.constructor = THREE.Line;\r\n\r\nTHREE.Line.prototype.raycast = (function() {\r\n\r\n  var inverseMatrix = new THREE.Matrix4();\r\n  var ray = new THREE.Ray();\r\n  var sphere = new THREE.Sphere();\r\n\r\n  return function(raycaster, intersects) {\r\n\r\n    var precision = raycaster.linePrecision;\r\n    var precisionSq = precision * precision;\r\n\r\n    var geometry = this.geometry;\r\n\r\n    if (geometry.boundingSphere === null) geometry.computeBoundingSphere();\r\n\r\n    // Checking boundingSphere distance to ray\r\n\r\n    sphere.copy(geometry.boundingSphere);\r\n    sphere.applyMatrix4(this.matrixWorld);\r\n\r\n    if (raycaster.ray.isIntersectionSphere(sphere) === false) {\r\n\r\n      return;\r\n\r\n    }\r\n\r\n    inverseMatrix.getInverse(this.matrixWorld);\r\n    ray.copy(raycaster.ray).applyMatrix4(inverseMatrix);\r\n\r\n    var vStart = new THREE.Vector3();\r\n    var vEnd = new THREE.Vector3();\r\n    var interSegment = new THREE.Vector3();\r\n    var interRay = new THREE.Vector3();\r\n    var step = this.mode === THREE.LineStrip ? 1 : 2;\r\n\r\n    if (geometry instanceof THREE.BufferGeometry) {\r\n\r\n      var attributes = geometry.attributes;\r\n\r\n      if (attributes.index !== undefined) {\r\n\r\n        var indices = attributes.index.array;\r\n        var positions = attributes.position.array;\r\n        var offsets = geometry.offsets;\r\n\r\n        if (offsets.length === 0) {\r\n\r\n          offsets = [{\r\n            start: 0,\r\n            count: indices.length,\r\n            index: 0\r\n          }];\r\n\r\n        }\r\n\r\n        for (var oi = 0; oi < offsets.length; oi++) {\r\n\r\n          var start = offsets[oi].start;\r\n          var count = offsets[oi].count;\r\n          var index = offsets[oi].index;\r\n\r\n          for (var i = start; i < start + count - 1; i += step) {\r\n\r\n            var a = index + indices[i];\r\n            var b = index + indices[i + 1];\r\n\r\n            vStart.fromArray(positions, a * 3);\r\n            vEnd.fromArray(positions, b * 3);\r\n\r\n            var distSq = ray.distanceSqToSegment(vStart, vEnd, interRay, interSegment);\r\n\r\n            if (distSq > precisionSq) continue;\r\n\r\n            var distance = ray.origin.distanceTo(interRay);\r\n\r\n            if (distance < raycaster.near || distance > raycaster.far) continue;\r\n\r\n            intersects.push({\r\n\r\n              distance: distance,\r\n              // What do we want? intersection point on the ray or on the segment??\r\n              // point: raycaster.ray.at( distance ),\r\n              point: interSegment.clone().applyMatrix4(this.matrixWorld),\r\n              index: i,\r\n              offsetIndex: oi,\r\n              face: null,\r\n              faceIndex: null,\r\n              object: this\r\n\r\n            });\r\n\r\n          }\r\n\r\n        }\r\n\r\n      }\r\n      else {\r\n\r\n        var positions = attributes.position.array;\r\n\r\n        for (var i = 0; i < positions.length / 3 - 1; i += step) {\r\n\r\n          vStart.fromArray(positions, 3 * i);\r\n          vEnd.fromArray(positions, 3 * i + 3);\r\n\r\n          var distSq = ray.distanceSqToSegment(vStart, vEnd, interRay, interSegment);\r\n\r\n          if (distSq > precisionSq) continue;\r\n\r\n          var distance = ray.origin.distanceTo(interRay);\r\n\r\n          if (distance < raycaster.near || distance > raycaster.far) continue;\r\n\r\n          intersects.push({\r\n\r\n            distance: distance,\r\n            // What do we want? intersection point on the ray or on the segment??\r\n            // point: raycaster.ray.at( distance ),\r\n            point: interSegment.clone().applyMatrix4(this.matrixWorld),\r\n            index: i,\r\n            face: null,\r\n            faceIndex: null,\r\n            object: this\r\n\r\n          });\r\n\r\n        }\r\n\r\n      }\r\n\r\n    }\r\n    else if (geometry instanceof THREE.Geometry) {\r\n\r\n      var vertices = geometry.vertices;\r\n      var nbVertices = vertices.length;\r\n\r\n      for (var i = 0; i < nbVertices - 1; i += step) {\r\n\r\n        var distSq = ray.distanceSqToSegment(vertices[i], vertices[i + 1], interRay, interSegment);\r\n\r\n        if (distSq > precisionSq) continue;\r\n\r\n        var distance = ray.origin.distanceTo(interRay);\r\n\r\n        if (distance < raycaster.near || distance > raycaster.far) continue;\r\n\r\n        intersects.push({\r\n\r\n          distance: distance,\r\n          // What do we want? intersection point on the ray or on the segment??\r\n          // point: raycaster.ray.at( distance ),\r\n          point: interSegment.clone().applyMatrix4(this.matrixWorld),\r\n          index: i,\r\n          face: null,\r\n          faceIndex: null,\r\n          object: this\r\n\r\n        });\r\n\r\n      }\r\n\r\n    }\r\n\r\n  };\r\n\r\n}());\r\n\r\nTHREE.Line.prototype.clone = function(object) {\r\n\r\n  if (object === undefined) object = new THREE.Line(this.geometry, this.material, this.mode);\r\n\r\n  THREE.Object3D.prototype.clone.call(this, object);\r\n\r\n  return object;\r\n\r\n};\r\n\r\n// File:src/objects/Mesh.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author alteredq / http://alteredqualia.com/\r\n * @author mikael emtinger / http://gomo.se/\r\n * @author jonobr1 / http://jonobr1.com/\r\n */\r\n\r\nTHREE.Mesh = function(geometry, material) {\r\n\r\n  THREE.Object3D.call(this);\r\n\r\n  this.type = 'Mesh';\r\n\r\n  this.geometry = geometry !== undefined ? geometry : new THREE.Geometry();\r\n  this.material = material !== undefined ? material : new THREE.MeshBasicMaterial({\r\n    color: Math.random() * 0xffffff\r\n  });\r\n\r\n  this.updateMorphTargets();\r\n\r\n};\r\n\r\nTHREE.Mesh.prototype = Object.create(THREE.Object3D.prototype);\r\nTHREE.Mesh.prototype.constructor = THREE.Mesh;\r\n\r\nTHREE.Mesh.prototype.updateMorphTargets = function() {\r\n\r\n  if (this.geometry.morphTargets !== undefined && this.geometry.morphTargets.length > 0) {\r\n\r\n    this.morphTargetBase = -1;\r\n    this.morphTargetForcedOrder = [];\r\n    this.morphTargetInfluences = [];\r\n    this.morphTargetDictionary = {};\r\n\r\n    for (var m = 0, ml = this.geometry.morphTargets.length; m < ml; m++) {\r\n\r\n      this.morphTargetInfluences.push(0);\r\n      this.morphTargetDictionary[this.geometry.morphTargets[m].name] = m;\r\n\r\n    }\r\n\r\n  }\r\n\r\n};\r\n\r\nTHREE.Mesh.prototype.getMorphTargetIndexByName = function(name) {\r\n\r\n  if (this.morphTargetDictionary[name] !== undefined) {\r\n\r\n    return this.morphTargetDictionary[name];\r\n\r\n  }\r\n\r\n  THREE.warn('THREE.Mesh.getMorphTargetIndexByName: morph target ' + name + ' does not exist. Returning 0.');\r\n\r\n  return 0;\r\n\r\n};\r\n\r\n\r\nTHREE.Mesh.prototype.raycast = (function() {\r\n\r\n  var inverseMatrix = new THREE.Matrix4();\r\n  var ray = new THREE.Ray();\r\n  var sphere = new THREE.Sphere();\r\n\r\n  var vA = new THREE.Vector3();\r\n  var vB = new THREE.Vector3();\r\n  var vC = new THREE.Vector3();\r\n\r\n  return function(raycaster, intersects) {\r\n\r\n    var geometry = this.geometry;\r\n\r\n    // Checking boundingSphere distance to ray\r\n\r\n    if (geometry.boundingSphere === null) geometry.computeBoundingSphere();\r\n\r\n    sphere.copy(geometry.boundingSphere);\r\n    sphere.applyMatrix4(this.matrixWorld);\r\n\r\n    if (raycaster.ray.isIntersectionSphere(sphere) === false) {\r\n\r\n      return;\r\n\r\n    }\r\n\r\n    // Check boundingBox before continuing\r\n\r\n    inverseMatrix.getInverse(this.matrixWorld);\r\n    ray.copy(raycaster.ray).applyMatrix4(inverseMatrix);\r\n\r\n    if (geometry.boundingBox !== null) {\r\n\r\n      if (ray.isIntersectionBox(geometry.boundingBox) === false) {\r\n\r\n        return;\r\n\r\n      }\r\n\r\n    }\r\n\r\n    if (geometry instanceof THREE.BufferGeometry) {\r\n\r\n      var material = this.material;\r\n\r\n      if (material === undefined) return;\r\n\r\n      var attributes = geometry.attributes;\r\n\r\n      var a, b, c;\r\n      var precision = raycaster.precision;\r\n\r\n      if (attributes.index !== undefined) {\r\n\r\n        var indices = attributes.index.array;\r\n        var positions = attributes.position.array;\r\n        var offsets = geometry.offsets;\r\n\r\n        if (offsets.length === 0) {\r\n\r\n          offsets = [{\r\n            start: 0,\r\n            count: indices.length,\r\n            index: 0\r\n          }];\r\n\r\n        }\r\n\r\n        for (var oi = 0, ol = offsets.length; oi < ol; ++oi) {\r\n\r\n          var start = offsets[oi].start;\r\n          var count = offsets[oi].count;\r\n          var index = offsets[oi].index;\r\n\r\n          for (var i = start, il = start + count; i < il; i += 3) {\r\n\r\n            a = index + indices[i];\r\n            b = index + indices[i + 1];\r\n            c = index + indices[i + 2];\r\n\r\n            vA.fromArray(positions, a * 3);\r\n            vB.fromArray(positions, b * 3);\r\n            vC.fromArray(positions, c * 3);\r\n\r\n            if (material.side === THREE.BackSide) {\r\n\r\n              var intersectionPoint = ray.intersectTriangle(vC, vB, vA, true);\r\n\r\n            }\r\n            else {\r\n\r\n              var intersectionPoint = ray.intersectTriangle(vA, vB, vC, material.side !== THREE.DoubleSide);\r\n\r\n            }\r\n\r\n            if (intersectionPoint === null) continue;\r\n\r\n            intersectionPoint.applyMatrix4(this.matrixWorld);\r\n\r\n            var distance = raycaster.ray.origin.distanceTo(intersectionPoint);\r\n\r\n            if (distance < precision || distance < raycaster.near || distance > raycaster.far) continue;\r\n\r\n            intersects.push({\r\n\r\n              distance: distance,\r\n              point: intersectionPoint,\r\n              face: new THREE.Face3(a, b, c, THREE.Triangle.normal(vA, vB, vC)),\r\n              faceIndex: null,\r\n              object: this\r\n\r\n            });\r\n\r\n          }\r\n\r\n        }\r\n\r\n      }\r\n      else {\r\n\r\n        var positions = attributes.position.array;\r\n\r\n        for (var i = 0, j = 0, il = positions.length; i < il; i += 3, j += 9) {\r\n\r\n          a = i;\r\n          b = i + 1;\r\n          c = i + 2;\r\n\r\n          vA.fromArray(positions, j);\r\n          vB.fromArray(positions, j + 3);\r\n          vC.fromArray(positions, j + 6);\r\n\r\n          if (material.side === THREE.BackSide) {\r\n\r\n            var intersectionPoint = ray.intersectTriangle(vC, vB, vA, true);\r\n\r\n          }\r\n          else {\r\n\r\n            var intersectionPoint = ray.intersectTriangle(vA, vB, vC, material.side !== THREE.DoubleSide);\r\n\r\n          }\r\n\r\n          if (intersectionPoint === null) continue;\r\n\r\n          intersectionPoint.applyMatrix4(this.matrixWorld);\r\n\r\n          var distance = raycaster.ray.origin.distanceTo(intersectionPoint);\r\n\r\n          if (distance < precision || distance < raycaster.near || distance > raycaster.far) continue;\r\n\r\n          intersects.push({\r\n\r\n            distance: distance,\r\n            point: intersectionPoint,\r\n            face: new THREE.Face3(a, b, c, THREE.Triangle.normal(vA, vB, vC)),\r\n            faceIndex: null,\r\n            object: this\r\n\r\n          });\r\n\r\n        }\r\n\r\n      }\r\n\r\n    }\r\n    else if (geometry instanceof THREE.Geometry) {\r\n\r\n      var isFaceMaterial = this.material instanceof THREE.MeshFaceMaterial;\r\n      var objectMaterials = isFaceMaterial === true ? this.material.materials : null;\r\n\r\n      var a, b, c;\r\n      var precision = raycaster.precision;\r\n\r\n      var vertices = geometry.vertices;\r\n\r\n      for (var f = 0, fl = geometry.faces.length; f < fl; f++) {\r\n\r\n        var face = geometry.faces[f];\r\n\r\n        var material = isFaceMaterial === true ? objectMaterials[face.materialIndex] : this.material;\r\n\r\n        if (material === undefined) continue;\r\n\r\n        a = vertices[face.a];\r\n        b = vertices[face.b];\r\n        c = vertices[face.c];\r\n\r\n        if (material.morphTargets === true) {\r\n\r\n          var morphTargets = geometry.morphTargets;\r\n          var morphInfluences = this.morphTargetInfluences;\r\n\r\n          vA.set(0, 0, 0);\r\n          vB.set(0, 0, 0);\r\n          vC.set(0, 0, 0);\r\n\r\n          for (var t = 0, tl = morphTargets.length; t < tl; t++) {\r\n\r\n            var influence = morphInfluences[t];\r\n\r\n            if (influence === 0) continue;\r\n\r\n            var targets = morphTargets[t].vertices;\r\n\r\n            vA.x += (targets[face.a].x - a.x) * influence;\r\n            vA.y += (targets[face.a].y - a.y) * influence;\r\n            vA.z += (targets[face.a].z - a.z) * influence;\r\n\r\n            vB.x += (targets[face.b].x - b.x) * influence;\r\n            vB.y += (targets[face.b].y - b.y) * influence;\r\n            vB.z += (targets[face.b].z - b.z) * influence;\r\n\r\n            vC.x += (targets[face.c].x - c.x) * influence;\r\n            vC.y += (targets[face.c].y - c.y) * influence;\r\n            vC.z += (targets[face.c].z - c.z) * influence;\r\n\r\n          }\r\n\r\n          vA.add(a);\r\n          vB.add(b);\r\n          vC.add(c);\r\n\r\n          a = vA;\r\n          b = vB;\r\n          c = vC;\r\n\r\n        }\r\n\r\n        if (material.side === THREE.BackSide) {\r\n\r\n          var intersectionPoint = ray.intersectTriangle(c, b, a, true);\r\n\r\n        }\r\n        else {\r\n\r\n          var intersectionPoint = ray.intersectTriangle(a, b, c, material.side !== THREE.DoubleSide);\r\n\r\n        }\r\n\r\n        if (intersectionPoint === null) continue;\r\n\r\n        intersectionPoint.applyMatrix4(this.matrixWorld);\r\n\r\n        var distance = raycaster.ray.origin.distanceTo(intersectionPoint);\r\n\r\n        if (distance < precision || distance < raycaster.near || distance > raycaster.far) continue;\r\n\r\n        intersects.push({\r\n\r\n          distance: distance,\r\n          point: intersectionPoint,\r\n          face: face,\r\n          faceIndex: f,\r\n          object: this\r\n\r\n        });\r\n\r\n      }\r\n\r\n    }\r\n\r\n  };\r\n\r\n}());\r\n\r\nTHREE.Mesh.prototype.clone = function(object, recursive) {\r\n\r\n  if (object === undefined) object = new THREE.Mesh(this.geometry, this.material);\r\n\r\n  THREE.Object3D.prototype.clone.call(this, object, recursive);\r\n\r\n  return object;\r\n\r\n};\r\n\r\n// File:src/objects/Bone.js\r\n\r\n/**\r\n * @author mikael emtinger / http://gomo.se/\r\n * @author alteredq / http://alteredqualia.com/\r\n * @author ikerr / http://verold.com\r\n */\r\n\r\nTHREE.Bone = function(skin) {\r\n\r\n  THREE.Object3D.call(this);\r\n\r\n  this.type = 'Bone';\r\n\r\n  this.skin = skin;\r\n\r\n};\r\n\r\nTHREE.Bone.prototype = Object.create(THREE.Object3D.prototype);\r\nTHREE.Bone.prototype.constructor = THREE.Bone;\r\n\r\n// File:src/objects/Skeleton.js\r\n\r\n/**\r\n * @author mikael emtinger / http://gomo.se/\r\n * @author alteredq / http://alteredqualia.com/\r\n * @author michael guerrero / http://realitymeltdown.com\r\n * @author ikerr / http://verold.com\r\n */\r\n\r\nTHREE.Skeleton = function(bones, boneInverses, useVertexTexture) {\r\n\r\n  this.useVertexTexture = useVertexTexture !== undefined ? useVertexTexture : true;\r\n\r\n  this.identityMatrix = new THREE.Matrix4();\r\n\r\n  // copy the bone array\r\n\r\n  bones = bones || [];\r\n\r\n  this.bones = bones.slice(0);\r\n\r\n  // create a bone texture or an array of floats\r\n\r\n  if (this.useVertexTexture) {\r\n\r\n    // layout (1 matrix = 4 pixels)\r\n    //      RGBA RGBA RGBA RGBA (=> column1, column2, column3, column4)\r\n    //  with  8x8  pixel texture max   16 bones  (8 * 8  / 4)\r\n    //       16x16 pixel texture max   64 bones (16 * 16 / 4)\r\n    //       32x32 pixel texture max  256 bones (32 * 32 / 4)\r\n    //       64x64 pixel texture max 1024 bones (64 * 64 / 4)\r\n\r\n    var size;\r\n\r\n    if (this.bones.length > 256)\r\n      size = 64;\r\n    else if (this.bones.length > 64)\r\n      size = 32;\r\n    else if (this.bones.length > 16)\r\n      size = 16;\r\n    else\r\n      size = 8;\r\n\r\n    this.boneTextureWidth = size;\r\n    this.boneTextureHeight = size;\r\n\r\n    this.boneMatrices = new Float32Array(this.boneTextureWidth * this.boneTextureHeight * 4); // 4 floats per RGBA pixel\r\n    this.boneTexture = new THREE.DataTexture(this.boneMatrices, this.boneTextureWidth, this.boneTextureHeight, THREE.RGBAFormat, THREE.FloatType);\r\n    this.boneTexture.minFilter = THREE.NearestFilter;\r\n    this.boneTexture.magFilter = THREE.NearestFilter;\r\n    this.boneTexture.generateMipmaps = false;\r\n    this.boneTexture.flipY = false;\r\n\r\n  }\r\n  else {\r\n\r\n    this.boneMatrices = new Float32Array(16 * this.bones.length);\r\n\r\n  }\r\n\r\n  // use the supplied bone inverses or calculate the inverses\r\n\r\n  if (boneInverses === undefined) {\r\n\r\n    this.calculateInverses();\r\n\r\n  }\r\n  else {\r\n\r\n    if (this.bones.length === boneInverses.length) {\r\n\r\n      this.boneInverses = boneInverses.slice(0);\r\n\r\n    }\r\n    else {\r\n\r\n      THREE.warn('THREE.Skeleton bonInverses is the wrong length.');\r\n\r\n      this.boneInverses = [];\r\n\r\n      for (var b = 0, bl = this.bones.length; b < bl; b++) {\r\n\r\n        this.boneInverses.push(new THREE.Matrix4());\r\n\r\n      }\r\n\r\n    }\r\n\r\n  }\r\n\r\n};\r\n\r\nTHREE.Skeleton.prototype.calculateInverses = function() {\r\n\r\n  this.boneInverses = [];\r\n\r\n  for (var b = 0, bl = this.bones.length; b < bl; b++) {\r\n\r\n    var inverse = new THREE.Matrix4();\r\n\r\n    if (this.bones[b]) {\r\n\r\n      inverse.getInverse(this.bones[b].matrixWorld);\r\n\r\n    }\r\n\r\n    this.boneInverses.push(inverse);\r\n\r\n  }\r\n\r\n};\r\n\r\nTHREE.Skeleton.prototype.pose = function() {\r\n\r\n  var bone;\r\n\r\n  // recover the bind-time world matrices\r\n\r\n  for (var b = 0, bl = this.bones.length; b < bl; b++) {\r\n\r\n    bone = this.bones[b];\r\n\r\n    if (bone) {\r\n\r\n      bone.matrixWorld.getInverse(this.boneInverses[b]);\r\n\r\n    }\r\n\r\n  }\r\n\r\n  // compute the local matrices, positions, rotations and scales\r\n\r\n  for (var b = 0, bl = this.bones.length; b < bl; b++) {\r\n\r\n    bone = this.bones[b];\r\n\r\n    if (bone) {\r\n\r\n      if (bone.parent) {\r\n\r\n        bone.matrix.getInverse(bone.parent.matrixWorld);\r\n        bone.matrix.multiply(bone.matrixWorld);\r\n\r\n      }\r\n      else {\r\n\r\n        bone.matrix.copy(bone.matrixWorld);\r\n\r\n      }\r\n\r\n      bone.matrix.decompose(bone.position, bone.quaternion, bone.scale);\r\n\r\n    }\r\n\r\n  }\r\n\r\n};\r\n\r\nTHREE.Skeleton.prototype.update = (function() {\r\n\r\n  var offsetMatrix = new THREE.Matrix4();\r\n\r\n  return function() {\r\n\r\n    // flatten bone matrices to array\r\n\r\n    for (var b = 0, bl = this.bones.length; b < bl; b++) {\r\n\r\n      // compute the offset between the current and the original transform\r\n\r\n      var matrix = this.bones[b] ? this.bones[b].matrixWorld : this.identityMatrix;\r\n\r\n      offsetMatrix.multiplyMatrices(matrix, this.boneInverses[b]);\r\n      offsetMatrix.flattenToArrayOffset(this.boneMatrices, b * 16);\r\n\r\n    }\r\n\r\n    if (this.useVertexTexture) {\r\n\r\n      this.boneTexture.needsUpdate = true;\r\n\r\n    }\r\n\r\n  };\r\n\r\n})();\r\n\r\n\r\n// File:src/objects/SkinnedMesh.js\r\n\r\n/**\r\n * @author mikael emtinger / http://gomo.se/\r\n * @author alteredq / http://alteredqualia.com/\r\n * @author ikerr / http://verold.com\r\n */\r\n\r\nTHREE.SkinnedMesh = function(geometry, material, useVertexTexture) {\r\n\r\n  THREE.Mesh.call(this, geometry, material);\r\n\r\n  this.type = 'SkinnedMesh';\r\n\r\n  this.bindMode = \"attached\";\r\n  this.bindMatrix = new THREE.Matrix4();\r\n  this.bindMatrixInverse = new THREE.Matrix4();\r\n\r\n  // init bones\r\n\r\n  // TODO: remove bone creation as there is no reason (other than\r\n  // convenience) for THREE.SkinnedMesh to do this.\r\n\r\n  var bones = [];\r\n\r\n  if (this.geometry && this.geometry.bones !== undefined) {\r\n\r\n    var bone, gbone, p, q, s;\r\n\r\n    for (var b = 0, bl = this.geometry.bones.length; b < bl; ++b) {\r\n\r\n      gbone = this.geometry.bones[b];\r\n\r\n      p = gbone.pos;\r\n      q = gbone.rotq;\r\n      s = gbone.scl;\r\n\r\n      bone = new THREE.Bone(this);\r\n      bones.push(bone);\r\n\r\n      bone.name = gbone.name;\r\n      bone.position.set(p[0], p[1], p[2]);\r\n      bone.quaternion.set(q[0], q[1], q[2], q[3]);\r\n\r\n      if (s !== undefined) {\r\n\r\n        bone.scale.set(s[0], s[1], s[2]);\r\n\r\n      }\r\n      else {\r\n\r\n        bone.scale.set(1, 1, 1);\r\n\r\n      }\r\n\r\n    }\r\n\r\n    for (var b = 0, bl = this.geometry.bones.length; b < bl; ++b) {\r\n\r\n      gbone = this.geometry.bones[b];\r\n\r\n      if (gbone.parent !== -1) {\r\n\r\n        bones[gbone.parent].add(bones[b]);\r\n\r\n      }\r\n      else {\r\n\r\n        this.add(bones[b]);\r\n\r\n      }\r\n\r\n    }\r\n\r\n  }\r\n\r\n  this.normalizeSkinWeights();\r\n\r\n  this.updateMatrixWorld(true);\r\n  this.bind(new THREE.Skeleton(bones, undefined, useVertexTexture));\r\n\r\n};\r\n\r\n\r\nTHREE.SkinnedMesh.prototype = Object.create(THREE.Mesh.prototype);\r\nTHREE.SkinnedMesh.prototype.constructor = THREE.SkinnedMesh;\r\n\r\nTHREE.SkinnedMesh.prototype.bind = function(skeleton, bindMatrix) {\r\n\r\n  this.skeleton = skeleton;\r\n\r\n  if (bindMatrix === undefined) {\r\n\r\n    this.updateMatrixWorld(true);\r\n\r\n    bindMatrix = this.matrixWorld;\r\n\r\n  }\r\n\r\n  this.bindMatrix.copy(bindMatrix);\r\n  this.bindMatrixInverse.getInverse(bindMatrix);\r\n\r\n};\r\n\r\nTHREE.SkinnedMesh.prototype.pose = function() {\r\n\r\n  this.skeleton.pose();\r\n\r\n};\r\n\r\nTHREE.SkinnedMesh.prototype.normalizeSkinWeights = function() {\r\n\r\n  if (this.geometry instanceof THREE.Geometry) {\r\n\r\n    for (var i = 0; i < this.geometry.skinIndices.length; i++) {\r\n\r\n      var sw = this.geometry.skinWeights[i];\r\n\r\n      var scale = 1.0 / sw.lengthManhattan();\r\n\r\n      if (scale !== Infinity) {\r\n\r\n        sw.multiplyScalar(scale);\r\n\r\n      }\r\n      else {\r\n\r\n        sw.set(1); // this will be normalized by the shader anyway\r\n\r\n      }\r\n\r\n    }\r\n\r\n  }\r\n  else {\r\n\r\n    // skinning weights assumed to be normalized for THREE.BufferGeometry\r\n\r\n  }\r\n\r\n};\r\n\r\nTHREE.SkinnedMesh.prototype.updateMatrixWorld = function(force) {\r\n\r\n  THREE.Mesh.prototype.updateMatrixWorld.call(this, true);\r\n\r\n  if (this.bindMode === \"attached\") {\r\n\r\n    this.bindMatrixInverse.getInverse(this.matrixWorld);\r\n\r\n  }\r\n  else if (this.bindMode === \"detached\") {\r\n\r\n    this.bindMatrixInverse.getInverse(this.bindMatrix);\r\n\r\n  }\r\n  else {\r\n\r\n    THREE.warn('THREE.SkinnedMesh unreckognized bindMode: ' + this.bindMode);\r\n\r\n  }\r\n\r\n};\r\n\r\nTHREE.SkinnedMesh.prototype.clone = function(object) {\r\n\r\n  if (object === undefined) {\r\n\r\n    object = new THREE.SkinnedMesh(this.geometry, this.material, this.useVertexTexture);\r\n\r\n  }\r\n\r\n  THREE.Mesh.prototype.clone.call(this, object);\r\n\r\n  return object;\r\n\r\n};\r\n\r\n\r\n// File:src/objects/MorphAnimMesh.js\r\n\r\n/**\r\n * @author alteredq / http://alteredqualia.com/\r\n */\r\n\r\nTHREE.MorphAnimMesh = function(geometry, material) {\r\n\r\n  THREE.Mesh.call(this, geometry, material);\r\n\r\n  this.type = 'MorphAnimMesh';\r\n\r\n  // API\r\n\r\n  this.duration = 1000; // milliseconds\r\n  this.mirroredLoop = false;\r\n  this.time = 0;\r\n\r\n  // internals\r\n\r\n  this.lastKeyframe = 0;\r\n  this.currentKeyframe = 0;\r\n\r\n  this.direction = 1;\r\n  this.directionBackwards = false;\r\n\r\n  this.setFrameRange(0, this.geometry.morphTargets.length - 1);\r\n\r\n};\r\n\r\nTHREE.MorphAnimMesh.prototype = Object.create(THREE.Mesh.prototype);\r\nTHREE.MorphAnimMesh.prototype.constructor = THREE.MorphAnimMesh;\r\n\r\nTHREE.MorphAnimMesh.prototype.setFrameRange = function(start, end) {\r\n\r\n  this.startKeyframe = start;\r\n  this.endKeyframe = end;\r\n\r\n  this.length = this.endKeyframe - this.startKeyframe + 1;\r\n\r\n};\r\n\r\nTHREE.MorphAnimMesh.prototype.setDirectionForward = function() {\r\n\r\n  this.direction = 1;\r\n  this.directionBackwards = false;\r\n\r\n};\r\n\r\nTHREE.MorphAnimMesh.prototype.setDirectionBackward = function() {\r\n\r\n  this.direction = -1;\r\n  this.directionBackwards = true;\r\n\r\n};\r\n\r\nTHREE.MorphAnimMesh.prototype.parseAnimations = function() {\r\n\r\n  var geometry = this.geometry;\r\n\r\n  if (!geometry.animations) geometry.animations = {};\r\n\r\n  var firstAnimation, animations = geometry.animations;\r\n\r\n  var pattern = /([a-z]+)_?(\\d+)/;\r\n\r\n  for (var i = 0, il = geometry.morphTargets.length; i < il; i++) {\r\n\r\n    var morph = geometry.morphTargets[i];\r\n    var parts = morph.name.match(pattern);\r\n\r\n    if (parts && parts.length > 1) {\r\n\r\n      var label = parts[1];\r\n\r\n      if (!animations[label]) animations[label] = {\r\n        start: Infinity,\r\n        end: -Infinity\r\n      };\r\n\r\n      var animation = animations[label];\r\n\r\n      if (i < animation.start) animation.start = i;\r\n      if (i > animation.end) animation.end = i;\r\n\r\n      if (!firstAnimation) firstAnimation = label;\r\n\r\n    }\r\n\r\n  }\r\n\r\n  geometry.firstAnimation = firstAnimation;\r\n\r\n};\r\n\r\nTHREE.MorphAnimMesh.prototype.setAnimationLabel = function(label, start, end) {\r\n\r\n  if (!this.geometry.animations) this.geometry.animations = {};\r\n\r\n  this.geometry.animations[label] = {\r\n    start: start,\r\n    end: end\r\n  };\r\n\r\n};\r\n\r\nTHREE.MorphAnimMesh.prototype.playAnimation = function(label, fps) {\r\n\r\n  var animation = this.geometry.animations[label];\r\n\r\n  if (animation) {\r\n\r\n    this.setFrameRange(animation.start, animation.end);\r\n    this.duration = 1000 * ((animation.end - animation.start) / fps);\r\n    this.time = 0;\r\n\r\n  }\r\n  else {\r\n\r\n    THREE.warn('THREE.MorphAnimMesh: animation[' + label + '] undefined in .playAnimation()');\r\n\r\n  }\r\n\r\n};\r\n\r\nTHREE.MorphAnimMesh.prototype.updateAnimation = function(delta) {\r\n\r\n  var frameTime = this.duration / this.length;\r\n\r\n  this.time += this.direction * delta;\r\n\r\n  if (this.mirroredLoop) {\r\n\r\n    if (this.time > this.duration || this.time < 0) {\r\n\r\n      this.direction *= -1;\r\n\r\n      if (this.time > this.duration) {\r\n\r\n        this.time = this.duration;\r\n        this.directionBackwards = true;\r\n\r\n      }\r\n\r\n      if (this.time < 0) {\r\n\r\n        this.time = 0;\r\n        this.directionBackwards = false;\r\n\r\n      }\r\n\r\n    }\r\n\r\n  }\r\n  else {\r\n\r\n    this.time = this.time % this.duration;\r\n\r\n    if (this.time < 0) this.time += this.duration;\r\n\r\n  }\r\n\r\n  var keyframe = this.startKeyframe + THREE.Math.clamp(Math.floor(this.time / frameTime), 0, this.length - 1);\r\n\r\n  if (keyframe !== this.currentKeyframe) {\r\n\r\n    this.morphTargetInfluences[this.lastKeyframe] = 0;\r\n    this.morphTargetInfluences[this.currentKeyframe] = 1;\r\n\r\n    this.morphTargetInfluences[keyframe] = 0;\r\n\r\n    this.lastKeyframe = this.currentKeyframe;\r\n    this.currentKeyframe = keyframe;\r\n\r\n  }\r\n\r\n  var mix = (this.time % frameTime) / frameTime;\r\n\r\n  if (this.directionBackwards) {\r\n\r\n    mix = 1 - mix;\r\n\r\n  }\r\n\r\n  this.morphTargetInfluences[this.currentKeyframe] = mix;\r\n  this.morphTargetInfluences[this.lastKeyframe] = 1 - mix;\r\n\r\n};\r\n\r\nTHREE.MorphAnimMesh.prototype.interpolateTargets = function(a, b, t) {\r\n\r\n  var influences = this.morphTargetInfluences;\r\n\r\n  for (var i = 0, l = influences.length; i < l; i++) {\r\n\r\n    influences[i] = 0;\r\n\r\n  }\r\n\r\n  if (a > -1) influences[a] = 1 - t;\r\n  if (b > -1) influences[b] = t;\r\n\r\n};\r\n\r\nTHREE.MorphAnimMesh.prototype.clone = function(object) {\r\n\r\n  if (object === undefined) object = new THREE.MorphAnimMesh(this.geometry, this.material);\r\n\r\n  object.duration = this.duration;\r\n  object.mirroredLoop = this.mirroredLoop;\r\n  object.time = this.time;\r\n\r\n  object.lastKeyframe = this.lastKeyframe;\r\n  object.currentKeyframe = this.currentKeyframe;\r\n\r\n  object.direction = this.direction;\r\n  object.directionBackwards = this.directionBackwards;\r\n\r\n  THREE.Mesh.prototype.clone.call(this, object);\r\n\r\n  return object;\r\n\r\n};\r\n\r\n// File:src/objects/LOD.js\r\n\r\n/**\r\n * @author mikael emtinger / http://gomo.se/\r\n * @author alteredq / http://alteredqualia.com/\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.LOD = function() {\r\n\r\n  THREE.Object3D.call(this);\r\n\r\n  this.objects = [];\r\n\r\n};\r\n\r\n\r\nTHREE.LOD.prototype = Object.create(THREE.Object3D.prototype);\r\nTHREE.LOD.prototype.constructor = THREE.LOD;\r\n\r\nTHREE.LOD.prototype.addLevel = function(object, distance) {\r\n\r\n  if (distance === undefined) distance = 0;\r\n\r\n  distance = Math.abs(distance);\r\n\r\n  for (var l = 0; l < this.objects.length; l++) {\r\n\r\n    if (distance < this.objects[l].distance) {\r\n\r\n      break;\r\n\r\n    }\r\n\r\n  }\r\n\r\n  this.objects.splice(l, 0, {\r\n    distance: distance,\r\n    object: object\r\n  });\r\n  this.add(object);\r\n\r\n};\r\n\r\nTHREE.LOD.prototype.getObjectForDistance = function(distance) {\r\n\r\n  for (var i = 1, l = this.objects.length; i < l; i++) {\r\n\r\n    if (distance < this.objects[i].distance) {\r\n\r\n      break;\r\n\r\n    }\r\n\r\n  }\r\n\r\n  return this.objects[i - 1].object;\r\n\r\n};\r\n\r\nTHREE.LOD.prototype.raycast = (function() {\r\n\r\n  var matrixPosition = new THREE.Vector3();\r\n\r\n  return function(raycaster, intersects) {\r\n\r\n    matrixPosition.setFromMatrixPosition(this.matrixWorld);\r\n\r\n    var distance = raycaster.ray.origin.distanceTo(matrixPosition);\r\n\r\n    this.getObjectForDistance(distance).raycast(raycaster, intersects);\r\n\r\n  };\r\n\r\n}());\r\n\r\nTHREE.LOD.prototype.update = function() {\r\n\r\n  var v1 = new THREE.Vector3();\r\n  var v2 = new THREE.Vector3();\r\n\r\n  return function(camera) {\r\n\r\n    if (this.objects.length > 1) {\r\n\r\n      v1.setFromMatrixPosition(camera.matrixWorld);\r\n      v2.setFromMatrixPosition(this.matrixWorld);\r\n\r\n      var distance = v1.distanceTo(v2);\r\n\r\n      this.objects[0].object.visible = true;\r\n\r\n      for (var i = 1, l = this.objects.length; i < l; i++) {\r\n\r\n        if (distance >= this.objects[i].distance) {\r\n\r\n          this.objects[i - 1].object.visible = false;\r\n          this.objects[i].object.visible = true;\r\n\r\n        }\r\n        else {\r\n\r\n          break;\r\n\r\n        }\r\n\r\n      }\r\n\r\n      for (; i < l; i++) {\r\n\r\n        this.objects[i].object.visible = false;\r\n\r\n      }\r\n\r\n    }\r\n\r\n  };\r\n\r\n}();\r\n\r\nTHREE.LOD.prototype.clone = function(object) {\r\n\r\n  if (object === undefined) object = new THREE.LOD();\r\n\r\n  THREE.Object3D.prototype.clone.call(this, object);\r\n\r\n  for (var i = 0, l = this.objects.length; i < l; i++) {\r\n    var x = this.objects[i].object.clone();\r\n    x.visible = i === 0;\r\n    object.addLevel(x, this.objects[i].distance);\r\n  }\r\n\r\n  return object;\r\n\r\n};\r\n\r\n// File:src/objects/Sprite.js\r\n\r\n/**\r\n * @author mikael emtinger / http://gomo.se/\r\n * @author alteredq / http://alteredqualia.com/\r\n */\r\n\r\nTHREE.Sprite = (function() {\r\n\r\n  var indices = new Uint16Array([0, 1, 2, 0, 2, 3]);\r\n  var vertices = new Float32Array([-0.5, -0.5, 0, 0.5, -0.5, 0, 0.5, 0.5, 0, -0.5, 0.5, 0]);\r\n  var uvs = new Float32Array([0, 0, 1, 0, 1, 1, 0, 1]);\r\n\r\n  var geometry = new THREE.BufferGeometry();\r\n  geometry.addAttribute('index', new THREE.BufferAttribute(indices, 1));\r\n  geometry.addAttribute('position', new THREE.BufferAttribute(vertices, 3));\r\n  geometry.addAttribute('uv', new THREE.BufferAttribute(uvs, 2));\r\n\r\n  return function(material) {\r\n\r\n    THREE.Object3D.call(this);\r\n\r\n    this.type = 'Sprite';\r\n\r\n    this.geometry = geometry;\r\n    this.material = (material !== undefined) ? material : new THREE.SpriteMaterial();\r\n\r\n  };\r\n\r\n})();\r\n\r\nTHREE.Sprite.prototype = Object.create(THREE.Object3D.prototype);\r\nTHREE.Sprite.prototype.constructor = THREE.Sprite;\r\n\r\nTHREE.Sprite.prototype.raycast = (function() {\r\n\r\n  var matrixPosition = new THREE.Vector3();\r\n\r\n  return function(raycaster, intersects) {\r\n\r\n    matrixPosition.setFromMatrixPosition(this.matrixWorld);\r\n\r\n    var distance = raycaster.ray.distanceToPoint(matrixPosition);\r\n\r\n    if (distance > this.scale.x) {\r\n\r\n      return;\r\n\r\n    }\r\n\r\n    intersects.push({\r\n\r\n      distance: distance,\r\n      point: this.position,\r\n      face: null,\r\n      object: this\r\n\r\n    });\r\n\r\n  };\r\n\r\n}());\r\n\r\nTHREE.Sprite.prototype.clone = function(object) {\r\n\r\n  if (object === undefined) object = new THREE.Sprite(this.material);\r\n\r\n  THREE.Object3D.prototype.clone.call(this, object);\r\n\r\n  return object;\r\n\r\n};\r\n\r\n// Backwards compatibility\r\n\r\nTHREE.Particle = THREE.Sprite;\r\n\r\n// File:src/objects/LensFlare.js\r\n\r\n/**\r\n * @author mikael emtinger / http://gomo.se/\r\n * @author alteredq / http://alteredqualia.com/\r\n */\r\n\r\nTHREE.LensFlare = function(texture, size, distance, blending, color) {\r\n\r\n  THREE.Object3D.call(this);\r\n\r\n  this.lensFlares = [];\r\n\r\n  this.positionScreen = new THREE.Vector3();\r\n  this.customUpdateCallback = undefined;\r\n\r\n  if (texture !== undefined) {\r\n\r\n    this.add(texture, size, distance, blending, color);\r\n\r\n  }\r\n\r\n};\r\n\r\nTHREE.LensFlare.prototype = Object.create(THREE.Object3D.prototype);\r\nTHREE.LensFlare.prototype.constructor = THREE.LensFlare;\r\n\r\n\r\n/*\r\n * Add: adds another flare\r\n */\r\n\r\nTHREE.LensFlare.prototype.add = function(texture, size, distance, blending, color, opacity) {\r\n\r\n  if (size === undefined) size = -1;\r\n  if (distance === undefined) distance = 0;\r\n  if (opacity === undefined) opacity = 1;\r\n  if (color === undefined) color = new THREE.Color(0xffffff);\r\n  if (blending === undefined) blending = THREE.NormalBlending;\r\n\r\n  distance = Math.min(distance, Math.max(0, distance));\r\n\r\n  this.lensFlares.push({\r\n    texture: texture, // THREE.Texture\r\n    size: size, // size in pixels (-1 = use texture.width)\r\n    distance: distance, // distance (0-1) from light source (0=at light source)\r\n    x: 0,\r\n    y: 0,\r\n    z: 0, // screen position (-1 => 1) z = 0 is ontop z = 1 is back\r\n    scale: 1, // scale\r\n    rotation: 1, // rotation\r\n    opacity: opacity, // opacity\r\n    color: color, // color\r\n    blending: blending // blending\r\n  });\r\n\r\n};\r\n\r\n/*\r\n * Update lens flares update positions on all flares based on the screen position\r\n * Set myLensFlare.customUpdateCallback to alter the flares in your project specific way.\r\n */\r\n\r\nTHREE.LensFlare.prototype.updateLensFlares = function() {\r\n\r\n  var f, fl = this.lensFlares.length;\r\n  var flare;\r\n  var vecX = -this.positionScreen.x * 2;\r\n  var vecY = -this.positionScreen.y * 2;\r\n\r\n  for (f = 0; f < fl; f++) {\r\n\r\n    flare = this.lensFlares[f];\r\n\r\n    flare.x = this.positionScreen.x + vecX * flare.distance;\r\n    flare.y = this.positionScreen.y + vecY * flare.distance;\r\n\r\n    flare.wantedRotation = flare.x * Math.PI * 0.25;\r\n    flare.rotation += (flare.wantedRotation - flare.rotation) * 0.25;\r\n\r\n  }\r\n\r\n};\r\n\r\n\r\n// File:src/scenes/Scene.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.Scene = function() {\r\n\r\n  THREE.Object3D.call(this);\r\n\r\n  this.type = 'Scene';\r\n\r\n  this.fog = null;\r\n  this.overrideMaterial = null;\r\n\r\n  this.autoUpdate = true; // checked by the renderer\r\n\r\n};\r\n\r\nTHREE.Scene.prototype = Object.create(THREE.Object3D.prototype);\r\nTHREE.Scene.prototype.constructor = THREE.Scene;\r\n\r\nTHREE.Scene.prototype.clone = function(object) {\r\n\r\n  if (object === undefined) object = new THREE.Scene();\r\n\r\n  THREE.Object3D.prototype.clone.call(this, object);\r\n\r\n  if (this.fog !== null) object.fog = this.fog.clone();\r\n  if (this.overrideMaterial !== null) object.overrideMaterial = this.overrideMaterial.clone();\r\n\r\n  object.autoUpdate = this.autoUpdate;\r\n  object.matrixAutoUpdate = this.matrixAutoUpdate;\r\n\r\n  return object;\r\n\r\n};\r\n\r\n// File:src/scenes/Fog.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author alteredq / http://alteredqualia.com/\r\n */\r\n\r\nTHREE.Fog = function(color, near, far) {\r\n\r\n  this.name = '';\r\n\r\n  this.color = new THREE.Color(color);\r\n\r\n  this.near = (near !== undefined) ? near : 1;\r\n  this.far = (far !== undefined) ? far : 1000;\r\n\r\n};\r\n\r\nTHREE.Fog.prototype.clone = function() {\r\n\r\n  return new THREE.Fog(this.color.getHex(), this.near, this.far);\r\n\r\n};\r\n\r\n// File:src/scenes/FogExp2.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author alteredq / http://alteredqualia.com/\r\n */\r\n\r\nTHREE.FogExp2 = function(color, density) {\r\n\r\n  this.name = '';\r\n\r\n  this.color = new THREE.Color(color);\r\n  this.density = (density !== undefined) ? density : 0.00025;\r\n\r\n};\r\n\r\nTHREE.FogExp2.prototype.clone = function() {\r\n\r\n  return new THREE.FogExp2(this.color.getHex(), this.density);\r\n\r\n};\r\n\r\n// File:src/renderers/shaders/ShaderChunk.js\r\n\r\nTHREE.ShaderChunk = {};\r\n\r\n// File:src/renderers/shaders/ShaderChunk/common.glsl\r\n\r\nTHREE.ShaderChunk['common'] = \"#define PI 3.14159\\n#define PI2 6.28318\\n#define RECIPROCAL_PI2 0.15915494\\n#define LOG2 1.442695\\n#define EPSILON 1e-6\\n\\nfloat square( in float a ) { return a*a; }\\nvec2  square( in vec2 a )  { return vec2( a.x*a.x, a.y*a.y ); }\\nvec3  square( in vec3 a )  { return vec3( a.x*a.x, a.y*a.y, a.z*a.z ); }\\nvec4  square( in vec4 a )  { return vec4( a.x*a.x, a.y*a.y, a.z*a.z, a.w*a.w ); }\\nfloat saturate( in float a ) { return clamp( a, 0.0, 1.0 ); }\\nvec2  saturate( in vec2 a )  { return clamp( a, 0.0, 1.0 ); }\\nvec3  saturate( in vec3 a )  { return clamp( a, 0.0, 1.0 ); }\\nvec4  saturate( in vec4 a )  { return clamp( a, 0.0, 1.0 ); }\\nfloat average( in float a ) { return a; }\\nfloat average( in vec2 a )  { return ( a.x + a.y) * 0.5; }\\nfloat average( in vec3 a )  { return ( a.x + a.y + a.z) / 3.0; }\\nfloat average( in vec4 a )  { return ( a.x + a.y + a.z + a.w) * 0.25; }\\nfloat whiteCompliment( in float a ) { return saturate( 1.0 - a ); }\\nvec2  whiteCompliment( in vec2 a )  { return saturate( vec2(1.0) - a ); }\\nvec3  whiteCompliment( in vec3 a )  { return saturate( vec3(1.0) - a ); }\\nvec4  whiteCompliment( in vec4 a )  { return saturate( vec4(1.0) - a ); }\\nvec3 transformDirection( in vec3 normal, in mat4 matrix ) {\\n\treturn normalize( ( matrix * vec4( normal, 0.0 ) ).xyz );\\n}\\n// http://en.wikibooks.org/wiki/GLSL_Programming/Applying_Matrix_Transformations\\nvec3 inverseTransformDirection( in vec3 normal, in mat4 matrix ) {\\n\treturn normalize( ( vec4( normal, 0.0 ) * matrix ).xyz );\\n}\\nvec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal) {\\n\tfloat distance = dot( planeNormal, point-pointOnPlane );\\n\treturn point - distance * planeNormal;\\n}\\nfloat sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\\n\treturn sign( dot( point - pointOnPlane, planeNormal ) );\\n}\\nvec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {\\n\treturn pointOnLine + lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) );\\n}\\nfloat calcLightAttenuation( float lightDistance, float cutoffDistance, float decayExponent ) {\\n\tif ( decayExponent > 0.0 ) {\\n\t  return pow( saturate( 1.0 - lightDistance / cutoffDistance ), decayExponent );\\n\t}\\n\treturn 1.0;\\n}\\n\\nvec3 inputToLinear( in vec3 a ) {\\n#ifdef GAMMA_INPUT\\n\treturn pow( a, vec3( float( GAMMA_FACTOR ) ) );\\n#else\\n\treturn a;\\n#endif\\n}\\nvec3 linearToOutput( in vec3 a ) {\\n#ifdef GAMMA_OUTPUT\\n\treturn pow( a, vec3( 1.0 / float( GAMMA_FACTOR ) ) );\\n#else\\n\treturn a;\\n#endif\\n}\\n\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/alphatest_fragment.glsl\r\n\r\nTHREE.ShaderChunk['alphatest_fragment'] = \"#ifdef ALPHATEST\\n\\n\tif ( diffuseColor.a < ALPHATEST ) discard;\\n\\n#endif\\n\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/lights_lambert_vertex.glsl\r\n\r\nTHREE.ShaderChunk['lights_lambert_vertex'] = \"vLightFront = vec3( 0.0 );\\n\\n#ifdef DOUBLE_SIDED\\n\\n\tvLightBack = vec3( 0.0 );\\n\\n#endif\\n\\ntransformedNormal = normalize( transformedNormal );\\n\\n#if MAX_DIR_LIGHTS > 0\\n\\nfor( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {\\n\\n\tvec3 dirVector = transformDirection( directionalLightDirection[ i ], viewMatrix );\\n\\n\tfloat dotProduct = dot( transformedNormal, dirVector );\\n\tvec3 directionalLightWeighting = vec3( max( dotProduct, 0.0 ) );\\n\\n\t#ifdef DOUBLE_SIDED\\n\\n\t\tvec3 directionalLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );\\n\\n\t\t#ifdef WRAP_AROUND\\n\\n\t\t\tvec3 directionalLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );\\n\\n\t\t#endif\\n\\n\t#endif\\n\\n\t#ifdef WRAP_AROUND\\n\\n\t\tvec3 directionalLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );\\n\t\tdirectionalLightWeighting = mix( directionalLightWeighting, directionalLightWeightingHalf, wrapRGB );\\n\\n\t\t#ifdef DOUBLE_SIDED\\n\\n\t\t\tdirectionalLightWeightingBack = mix( directionalLightWeightingBack, directionalLightWeightingHalfBack, wrapRGB );\\n\\n\t\t#endif\\n\\n\t#endif\\n\\n\tvLightFront += directionalLightColor[ i ] * directionalLightWeighting;\\n\\n\t#ifdef DOUBLE_SIDED\\n\\n\t\tvLightBack += directionalLightColor[ i ] * directionalLightWeightingBack;\\n\\n\t#endif\\n\\n}\\n\\n#endif\\n\\n#if MAX_POINT_LIGHTS > 0\\n\\n\tfor( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\\n\\n\t\tvec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\\n\t\tvec3 lVector = lPosition.xyz - mvPosition.xyz;\\n\\n\t\tfloat attenuation = calcLightAttenuation( length( lVector ), pointLightDistance[ i ], pointLightDecay[ i ] );\\n\\n\t\tlVector = normalize( lVector );\\n\t\tfloat dotProduct = dot( transformedNormal, lVector );\\n\\n\t\tvec3 pointLightWeighting = vec3( max( dotProduct, 0.0 ) );\\n\\n\t\t#ifdef DOUBLE_SIDED\\n\\n\t\t\tvec3 pointLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );\\n\\n\t\t\t#ifdef WRAP_AROUND\\n\\n\t\t\t\tvec3 pointLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );\\n\\n\t\t\t#endif\\n\\n\t\t#endif\\n\\n\t\t#ifdef WRAP_AROUND\\n\\n\t\t\tvec3 pointLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );\\n\t\t\tpointLightWeighting = mix( pointLightWeighting, pointLightWeightingHalf, wrapRGB );\\n\\n\t\t\t#ifdef DOUBLE_SIDED\\n\\n\t\t\t\tpointLightWeightingBack = mix( pointLightWeightingBack, pointLightWeightingHalfBack, wrapRGB );\\n\\n\t\t\t#endif\\n\\n\t\t#endif\\n\\n\t\tvLightFront += pointLightColor[ i ] * pointLightWeighting * attenuation;\\n\\n\t\t#ifdef DOUBLE_SIDED\\n\\n\t\t\tvLightBack += pointLightColor[ i ] * pointLightWeightingBack * attenuation;\\n\\n\t\t#endif\\n\\n\t}\\n\\n#endif\\n\\n#if MAX_SPOT_LIGHTS > 0\\n\\n\tfor( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {\\n\\n\t\tvec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );\\n\t\tvec3 lVector = lPosition.xyz - mvPosition.xyz;\\n\\n\t\tfloat spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - worldPosition.xyz ) );\\n\\n\t\tif ( spotEffect > spotLightAngleCos[ i ] ) {\\n\\n\t\t\tspotEffect = max( pow( max( spotEffect, 0.0 ), spotLightExponent[ i ] ), 0.0 );\\n\\n\t\t\tfloat attenuation = calcLightAttenuation( length( lVector ), spotLightDistance[ i ], spotLightDecay[ i ] );\\n\\n\t\t\tlVector = normalize( lVector );\\n\\n\t\t\tfloat dotProduct = dot( transformedNormal, lVector );\\n\t\t\tvec3 spotLightWeighting = vec3( max( dotProduct, 0.0 ) );\\n\\n\t\t\t#ifdef DOUBLE_SIDED\\n\\n\t\t\t\tvec3 spotLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );\\n\\n\t\t\t\t#ifdef WRAP_AROUND\\n\\n\t\t\t\t\tvec3 spotLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );\\n\\n\t\t\t\t#endif\\n\\n\t\t\t#endif\\n\\n\t\t\t#ifdef WRAP_AROUND\\n\\n\t\t\t\tvec3 spotLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );\\n\t\t\t\tspotLightWeighting = mix( spotLightWeighting, spotLightWeightingHalf, wrapRGB );\\n\\n\t\t\t\t#ifdef DOUBLE_SIDED\\n\\n\t\t\t\t\tspotLightWeightingBack = mix( spotLightWeightingBack, spotLightWeightingHalfBack, wrapRGB );\\n\\n\t\t\t\t#endif\\n\\n\t\t\t#endif\\n\\n\t\t\tvLightFront += spotLightColor[ i ] * spotLightWeighting * attenuation * spotEffect;\\n\\n\t\t\t#ifdef DOUBLE_SIDED\\n\\n\t\t\t\tvLightBack += spotLightColor[ i ] * spotLightWeightingBack * attenuation * spotEffect;\\n\\n\t\t\t#endif\\n\\n\t\t}\\n\\n\t}\\n\\n#endif\\n\\n#if MAX_HEMI_LIGHTS > 0\\n\\n\tfor( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {\\n\\n\t\tvec3 lVector = transformDirection( hemisphereLightDirection[ i ], viewMatrix );\\n\\n\t\tfloat dotProduct = dot( transformedNormal, lVector );\\n\\n\t\tfloat hemiDiffuseWeight = 0.5 * dotProduct + 0.5;\\n\t\tfloat hemiDiffuseWeightBack = -0.5 * dotProduct + 0.5;\\n\\n\t\tvLightFront += mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );\\n\\n\t\t#ifdef DOUBLE_SIDED\\n\\n\t\t\tvLightBack += mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeightBack );\\n\\n\t\t#endif\\n\\n\t}\\n\\n#endif\\n\\nvLightFront += ambientLightColor;\\n\\n#ifdef DOUBLE_SIDED\\n\\n\tvLightBack += ambientLightColor;\\n\\n#endif\\n\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/map_particle_pars_fragment.glsl\r\n\r\nTHREE.ShaderChunk['map_particle_pars_fragment'] = \"#ifdef USE_MAP\\n\\n\tuniform vec4 offsetRepeat;\\n\tuniform sampler2D map;\\n\\n#endif\\n\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/default_vertex.glsl\r\n\r\nTHREE.ShaderChunk['default_vertex'] = \"#ifdef USE_SKINNING\\n\\n\tvec4 mvPosition = modelViewMatrix * skinned;\\n\\n#elif defined( USE_MORPHTARGETS )\\n\\n\tvec4 mvPosition = modelViewMatrix * vec4( morphed, 1.0 );\\n\\n#else\\n\\n\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\\n\\n#endif\\n\\ngl_Position = projectionMatrix * mvPosition;\\n\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/map_pars_fragment.glsl\r\n\r\nTHREE.ShaderChunk['map_pars_fragment'] = \"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP )\\n\\n\tvarying vec2 vUv;\\n\\n#endif\\n\\n#ifdef USE_MAP\\n\\n\tuniform sampler2D map;\\n\\n#endif\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/skinnormal_vertex.glsl\r\n\r\nTHREE.ShaderChunk['skinnormal_vertex'] = \"#ifdef USE_SKINNING\\n\\n\tmat4 skinMatrix = mat4( 0.0 );\\n\tskinMatrix += skinWeight.x * boneMatX;\\n\tskinMatrix += skinWeight.y * boneMatY;\\n\tskinMatrix += skinWeight.z * boneMatZ;\\n\tskinMatrix += skinWeight.w * boneMatW;\\n\tskinMatrix  = bindMatrixInverse * skinMatrix * bindMatrix;\\n\\n\t#ifdef USE_MORPHNORMALS\\n\\n\tvec4 skinnedNormal = skinMatrix * vec4( morphedNormal, 0.0 );\\n\\n\t#else\\n\\n\tvec4 skinnedNormal = skinMatrix * vec4( normal, 0.0 );\\n\\n\t#endif\\n\\n#endif\\n\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/logdepthbuf_pars_vertex.glsl\r\n\r\nTHREE.ShaderChunk['logdepthbuf_pars_vertex'] = \"#ifdef USE_LOGDEPTHBUF\\n\\n\t#ifdef USE_LOGDEPTHBUF_EXT\\n\\n\t\tvarying float vFragDepth;\\n\\n\t#endif\\n\\n\tuniform float logDepthBufFC;\\n\\n#endif\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/lightmap_pars_vertex.glsl\r\n\r\nTHREE.ShaderChunk['lightmap_pars_vertex'] = \"#ifdef USE_LIGHTMAP\\n\\n\tvarying vec2 vUv2;\\n\\n#endif\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/lights_phong_fragment.glsl\r\n\r\nTHREE.ShaderChunk['lights_phong_fragment'] = \"#ifndef FLAT_SHADED\\n\\n\tvec3 normal = normalize( vNormal );\\n\\n\t#ifdef DOUBLE_SIDED\\n\\n\t\tnormal = normal * ( -1.0 + 2.0 * float( gl_FrontFacing ) );\\n\\n\t#endif\\n\\n#else\\n\\n\tvec3 fdx = dFdx( vViewPosition );\\n\tvec3 fdy = dFdy( vViewPosition );\\n\tvec3 normal = normalize( cross( fdx, fdy ) );\\n\\n#endif\\n\\nvec3 viewPosition = normalize( vViewPosition );\\n\\n#ifdef USE_NORMALMAP\\n\\n\tnormal = perturbNormal2Arb( -vViewPosition, normal );\\n\\n#elif defined( USE_BUMPMAP )\\n\\n\tnormal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );\\n\\n#endif\\n\\nvec3 totalDiffuseLight = vec3( 0.0 );\\nvec3 totalSpecularLight = vec3( 0.0 );\\n\\n#if MAX_POINT_LIGHTS > 0\\n\\n\tfor ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\\n\\n\t\tvec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\\n\t\tvec3 lVector = lPosition.xyz + vViewPosition.xyz;\\n\\n\t\tfloat attenuation = calcLightAttenuation( length( lVector ), pointLightDistance[ i ], pointLightDecay[ i ] );\\n\\n\t\tlVector = normalize( lVector );\\n\\n\t\t// diffuse\\n\\n\t\tfloat dotProduct = dot( normal, lVector );\\n\\n\t\t#ifdef WRAP_AROUND\\n\\n\t\t\tfloat pointDiffuseWeightFull = max( dotProduct, 0.0 );\\n\t\t\tfloat pointDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );\\n\\n\t\t\tvec3 pointDiffuseWeight = mix( vec3( pointDiffuseWeightFull ), vec3( pointDiffuseWeightHalf ), wrapRGB );\\n\\n\t\t#else\\n\\n\t\t\tfloat pointDiffuseWeight = max( dotProduct, 0.0 );\\n\\n\t\t#endif\\n\\n\t\ttotalDiffuseLight += pointLightColor[ i ] * pointDiffuseWeight * attenuation;\\n\\n\t\t\t\t// specular\\n\\n\t\tvec3 pointHalfVector = normalize( lVector + viewPosition );\\n\t\tfloat pointDotNormalHalf = max( dot( normal, pointHalfVector ), 0.0 );\\n\t\tfloat pointSpecularWeight = specularStrength * max( pow( pointDotNormalHalf, shininess ), 0.0 );\\n\\n\t\tfloat specularNormalization = ( shininess + 2.0 ) / 8.0;\\n\\n\t\tvec3 schlick = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVector, pointHalfVector ), 0.0 ), 5.0 );\\n\t\ttotalSpecularLight += schlick * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * attenuation * specularNormalization;\\n\\n\t}\\n\\n#endif\\n\\n#if MAX_SPOT_LIGHTS > 0\\n\\n\tfor ( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {\\n\\n\t\tvec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );\\n\t\tvec3 lVector = lPosition.xyz + vViewPosition.xyz;\\n\\n\t\tfloat attenuation = calcLightAttenuation( length( lVector ), spotLightDistance[ i ], spotLightDecay[ i ] );\\n\\n\t\tlVector = normalize( lVector );\\n\\n\t\tfloat spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - vWorldPosition ) );\\n\\n\t\tif ( spotEffect > spotLightAngleCos[ i ] ) {\\n\\n\t\t\tspotEffect = max( pow( max( spotEffect, 0.0 ), spotLightExponent[ i ] ), 0.0 );\\n\\n\t\t\t// diffuse\\n\\n\t\t\tfloat dotProduct = dot( normal, lVector );\\n\\n\t\t\t#ifdef WRAP_AROUND\\n\\n\t\t\t\tfloat spotDiffuseWeightFull = max( dotProduct, 0.0 );\\n\t\t\t\tfloat spotDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );\\n\\n\t\t\t\tvec3 spotDiffuseWeight = mix( vec3( spotDiffuseWeightFull ), vec3( spotDiffuseWeightHalf ), wrapRGB );\\n\\n\t\t\t#else\\n\\n\t\t\t\tfloat spotDiffuseWeight = max( dotProduct, 0.0 );\\n\\n\t\t\t#endif\\n\\n\t\t\ttotalDiffuseLight += spotLightColor[ i ] * spotDiffuseWeight * attenuation * spotEffect;\\n\\n\t\t\t// specular\\n\\n\t\t\tvec3 spotHalfVector = normalize( lVector + viewPosition );\\n\t\t\tfloat spotDotNormalHalf = max( dot( normal, spotHalfVector ), 0.0 );\\n\t\t\tfloat spotSpecularWeight = specularStrength * max( pow( spotDotNormalHalf, shininess ), 0.0 );\\n\\n\t\t\tfloat specularNormalization = ( shininess + 2.0 ) / 8.0;\\n\\n\t\t\tvec3 schlick = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVector, spotHalfVector ), 0.0 ), 5.0 );\\n\t\t\ttotalSpecularLight += schlick * spotLightColor[ i ] * spotSpecularWeight * spotDiffuseWeight * attenuation * specularNormalization * spotEffect;\\n\\n\t\t}\\n\\n\t}\\n\\n#endif\\n\\n#if MAX_DIR_LIGHTS > 0\\n\\n\tfor( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {\\n\\n\t\tvec3 dirVector = transformDirection( directionalLightDirection[ i ], viewMatrix );\\n\\n\t\t// diffuse\\n\\n\t\tfloat dotProduct = dot( normal, dirVector );\\n\\n\t\t#ifdef WRAP_AROUND\\n\\n\t\t\tfloat dirDiffuseWeightFull = max( dotProduct, 0.0 );\\n\t\t\tfloat dirDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );\\n\\n\t\t\tvec3 dirDiffuseWeight = mix( vec3( dirDiffuseWeightFull ), vec3( dirDiffuseWeightHalf ), wrapRGB );\\n\\n\t\t#else\\n\\n\t\t\tfloat dirDiffuseWeight = max( dotProduct, 0.0 );\\n\\n\t\t#endif\\n\\n\t\ttotalDiffuseLight += directionalLightColor[ i ] * dirDiffuseWeight;\\n\\n\t\t// specular\\n\\n\t\tvec3 dirHalfVector = normalize( dirVector + viewPosition );\\n\t\tfloat dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );\\n\t\tfloat dirSpecularWeight = specularStrength * max( pow( dirDotNormalHalf, shininess ), 0.0 );\\n\\n\t\t/*\\n\t\t// fresnel term from skin shader\\n\t\tconst float F0 = 0.128;\\n\\n\t\tfloat base = 1.0 - dot( viewPosition, dirHalfVector );\\n\t\tfloat exponential = pow( base, 5.0 );\\n\\n\t\tfloat fresnel = exponential + F0 * ( 1.0 - exponential );\\n\t\t*/\\n\\n\t\t/*\\n\t\t// fresnel term from fresnel shader\\n\t\tconst float mFresnelBias = 0.08;\\n\t\tconst float mFresnelScale = 0.3;\\n\t\tconst float mFresnelPower = 5.0;\\n\\n\t\tfloat fresnel = mFresnelBias + mFresnelScale * pow( 1.0 + dot( normalize( -viewPosition ), normal ), mFresnelPower );\\n\t\t*/\\n\\n\t\tfloat specularNormalization = ( shininess + 2.0 ) / 8.0;\\n\\n\t\t// \t\tdirSpecular += specular * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight * specularNormalization * fresnel;\\n\\n\t\tvec3 schlick = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( dirVector, dirHalfVector ), 0.0 ), 5.0 );\\n\t\ttotalSpecularLight += schlick * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight * specularNormalization;\\n\\n\\n\t}\\n\\n#endif\\n\\n#if MAX_HEMI_LIGHTS > 0\\n\\n\tfor( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {\\n\\n\t\tvec3 lVector = transformDirection( hemisphereLightDirection[ i ], viewMatrix );\\n\\n\t\t// diffuse\\n\\n\t\tfloat dotProduct = dot( normal, lVector );\\n\t\tfloat hemiDiffuseWeight = 0.5 * dotProduct + 0.5;\\n\\n\t\tvec3 hemiColor = mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );\\n\\n\t\ttotalDiffuseLight += hemiColor;\\n\\n\t\t// specular (sky light)\\n\\n\t\tvec3 hemiHalfVectorSky = normalize( lVector + viewPosition );\\n\t\tfloat hemiDotNormalHalfSky = 0.5 * dot( normal, hemiHalfVectorSky ) + 0.5;\\n\t\tfloat hemiSpecularWeightSky = specularStrength * max( pow( max( hemiDotNormalHalfSky, 0.0 ), shininess ), 0.0 );\\n\\n\t\t// specular (ground light)\\n\\n\t\tvec3 lVectorGround = -lVector;\\n\\n\t\tvec3 hemiHalfVectorGround = normalize( lVectorGround + viewPosition );\\n\t\tfloat hemiDotNormalHalfGround = 0.5 * dot( normal, hemiHalfVectorGround ) + 0.5;\\n\t\tfloat hemiSpecularWeightGround = specularStrength * max( pow( max( hemiDotNormalHalfGround, 0.0 ), shininess ), 0.0 );\\n\\n\t\tfloat dotProductGround = dot( normal, lVectorGround );\\n\\n\t\tfloat specularNormalization = ( shininess + 2.0 ) / 8.0;\\n\\n\t\tvec3 schlickSky = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVector, hemiHalfVectorSky ), 0.0 ), 5.0 );\\n\t\tvec3 schlickGround = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVectorGround, hemiHalfVectorGround ), 0.0 ), 5.0 );\\n\t\ttotalSpecularLight += hemiColor * specularNormalization * ( schlickSky * hemiSpecularWeightSky * max( dotProduct, 0.0 ) + schlickGround * hemiSpecularWeightGround * max( dotProductGround, 0.0 ) );\\n\\n\t}\\n\\n#endif\\n\\n#ifdef METAL\\n\\n\toutgoingLight += diffuseColor.rgb * ( totalDiffuseLight + ambientLightColor ) * specular + totalSpecularLight + emissive;\\n\\n#else\\n\\n\toutgoingLight += diffuseColor.rgb * ( totalDiffuseLight + ambientLightColor ) + totalSpecularLight + emissive;\\n\\n#endif\\n\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/fog_pars_fragment.glsl\r\n\r\nTHREE.ShaderChunk['fog_pars_fragment'] = \"#ifdef USE_FOG\\n\\n\tuniform vec3 fogColor;\\n\\n\t#ifdef FOG_EXP2\\n\\n\t\tuniform float fogDensity;\\n\\n\t#else\\n\\n\t\tuniform float fogNear;\\n\t\tuniform float fogFar;\\n\t#endif\\n\\n#endif\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/morphnormal_vertex.glsl\r\n\r\nTHREE.ShaderChunk['morphnormal_vertex'] = \"#ifdef USE_MORPHNORMALS\\n\\n\tvec3 morphedNormal = vec3( 0.0 );\\n\\n\tmorphedNormal += ( morphNormal0 - normal ) * morphTargetInfluences[ 0 ];\\n\tmorphedNormal += ( morphNormal1 - normal ) * morphTargetInfluences[ 1 ];\\n\tmorphedNormal += ( morphNormal2 - normal ) * morphTargetInfluences[ 2 ];\\n\tmorphedNormal += ( morphNormal3 - normal ) * morphTargetInfluences[ 3 ];\\n\\n\tmorphedNormal += normal;\\n\\n#endif\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/envmap_pars_fragment.glsl\r\n\r\nTHREE.ShaderChunk['envmap_pars_fragment'] = \"#ifdef USE_ENVMAP\\n\\n\tuniform float reflectivity;\\n\t#ifdef ENVMAP_TYPE_CUBE\\n\t\tuniform samplerCube envMap;\\n\t#else\\n\t\tuniform sampler2D envMap;\\n\t#endif\\n\tuniform float flipEnvMap;\\n\\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\\n\\n\t\tuniform float refractionRatio;\\n\\n\t#else\\n\\n\t\tvarying vec3 vReflect;\\n\\n\t#endif\\n\\n#endif\\n\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/logdepthbuf_fragment.glsl\r\n\r\nTHREE.ShaderChunk['logdepthbuf_fragment'] = \"#if defined(USE_LOGDEPTHBUF) && defined(USE_LOGDEPTHBUF_EXT)\\n\\n\tgl_FragDepthEXT = log2(vFragDepth) * logDepthBufFC * 0.5;\\n\\n#endif\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/normalmap_pars_fragment.glsl\r\n\r\nTHREE.ShaderChunk['normalmap_pars_fragment'] = \"#ifdef USE_NORMALMAP\\n\\n\tuniform sampler2D normalMap;\\n\tuniform vec2 normalScale;\\n\\n\t// Per-Pixel Tangent Space Normal Mapping\\n\t// http://hacksoflife.blogspot.ch/2009/11/per-pixel-tangent-space-normal-mapping.html\\n\\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm ) {\\n\\n\t\tvec3 q0 = dFdx( eye_pos.xyz );\\n\t\tvec3 q1 = dFdy( eye_pos.xyz );\\n\t\tvec2 st0 = dFdx( vUv.st );\\n\t\tvec2 st1 = dFdy( vUv.st );\\n\\n\t\tvec3 S = normalize( q0 * st1.t - q1 * st0.t );\\n\t\tvec3 T = normalize( -q0 * st1.s + q1 * st0.s );\\n\t\tvec3 N = normalize( surf_norm );\\n\\n\t\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\\n\t\tmapN.xy = normalScale * mapN.xy;\\n\t\tmat3 tsn = mat3( S, T, N );\\n\t\treturn normalize( tsn * mapN );\\n\\n\t}\\n\\n#endif\\n\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/lights_phong_pars_vertex.glsl\r\n\r\nTHREE.ShaderChunk['lights_phong_pars_vertex'] = \"#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP ) || defined( USE_ENVMAP )\\n\\n\tvarying vec3 vWorldPosition;\\n\\n#endif\\n\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/lightmap_pars_fragment.glsl\r\n\r\nTHREE.ShaderChunk['lightmap_pars_fragment'] = \"#ifdef USE_LIGHTMAP\\n\\n\tvarying vec2 vUv2;\\n\tuniform sampler2D lightMap;\\n\\n#endif\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/shadowmap_vertex.glsl\r\n\r\nTHREE.ShaderChunk['shadowmap_vertex'] = \"#ifdef USE_SHADOWMAP\\n\\n\tfor( int i = 0; i < MAX_SHADOWS; i ++ ) {\\n\\n\t\tvShadowCoord[ i ] = shadowMatrix[ i ] * worldPosition;\\n\\n\t}\\n\\n#endif\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/lights_phong_vertex.glsl\r\n\r\nTHREE.ShaderChunk['lights_phong_vertex'] = \"#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP ) || defined( USE_ENVMAP )\\n\\n\tvWorldPosition = worldPosition.xyz;\\n\\n#endif\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/map_fragment.glsl\r\n\r\nTHREE.ShaderChunk['map_fragment'] = \"#ifdef USE_MAP\\n\\n\tvec4 texelColor = texture2D( map, vUv );\\n\\n\ttexelColor.xyz = inputToLinear( texelColor.xyz );\\n\\n\tdiffuseColor *= texelColor;\\n\\n#endif\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/lightmap_vertex.glsl\r\n\r\nTHREE.ShaderChunk['lightmap_vertex'] = \"#ifdef USE_LIGHTMAP\\n\\n\tvUv2 = uv2;\\n\\n#endif\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/map_particle_fragment.glsl\r\n\r\nTHREE.ShaderChunk['map_particle_fragment'] = \"#ifdef USE_MAP\\n\\n\tdiffuseColor *= texture2D( map, vec2( gl_PointCoord.x, 1.0 - gl_PointCoord.y ) * offsetRepeat.zw + offsetRepeat.xy );\\n\\n#endif\\n\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/color_pars_fragment.glsl\r\n\r\nTHREE.ShaderChunk['color_pars_fragment'] = \"#ifdef USE_COLOR\\n\\n\tvarying vec3 vColor;\\n\\n#endif\\n\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/color_vertex.glsl\r\n\r\nTHREE.ShaderChunk['color_vertex'] = \"#ifdef USE_COLOR\\n\\n\tvColor.xyz = inputToLinear( color.xyz );\\n\\n#endif\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/skinning_vertex.glsl\r\n\r\nTHREE.ShaderChunk['skinning_vertex'] = \"#ifdef USE_SKINNING\\n\\n\t#ifdef USE_MORPHTARGETS\\n\\n\tvec4 skinVertex = bindMatrix * vec4( morphed, 1.0 );\\n\\n\t#else\\n\\n\tvec4 skinVertex = bindMatrix * vec4( position, 1.0 );\\n\\n\t#endif\\n\\n\tvec4 skinned = vec4( 0.0 );\\n\tskinned += boneMatX * skinVertex * skinWeight.x;\\n\tskinned += boneMatY * skinVertex * skinWeight.y;\\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\\n\tskinned += boneMatW * skinVertex * skinWeight.w;\\n\tskinned  = bindMatrixInverse * skinned;\\n\\n#endif\\n\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/envmap_pars_vertex.glsl\r\n\r\nTHREE.ShaderChunk['envmap_pars_vertex'] = \"#if defined( USE_ENVMAP ) && ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP ) && ! defined( PHONG )\\n\\n\tvarying vec3 vReflect;\\n\\n\tuniform float refractionRatio;\\n\\n#endif\\n\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/linear_to_gamma_fragment.glsl\r\n\r\nTHREE.ShaderChunk['linear_to_gamma_fragment'] = \"\\n\toutgoingLight = linearToOutput( outgoingLight );\\n\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/color_pars_vertex.glsl\r\n\r\nTHREE.ShaderChunk['color_pars_vertex'] = \"#ifdef USE_COLOR\\n\\n\tvarying vec3 vColor;\\n\\n#endif\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/lights_lambert_pars_vertex.glsl\r\n\r\nTHREE.ShaderChunk['lights_lambert_pars_vertex'] = \"uniform vec3 ambientLightColor;\\n\\n#if MAX_DIR_LIGHTS > 0\\n\\n\tuniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\\n\tuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\\n\\n#endif\\n\\n#if MAX_HEMI_LIGHTS > 0\\n\\n\tuniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];\\n\tuniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];\\n\tuniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];\\n\\n#endif\\n\\n#if MAX_POINT_LIGHTS > 0\\n\\n\tuniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\\n\tuniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\\n\tuniform float pointLightDistance[ MAX_POINT_LIGHTS ];\\n\tuniform float pointLightDecay[ MAX_POINT_LIGHTS ];\\n\\n#endif\\n\\n#if MAX_SPOT_LIGHTS > 0\\n\\n\tuniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];\\n\tuniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];\\n\tuniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];\\n\tuniform float spotLightDistance[ MAX_SPOT_LIGHTS ];\\n\tuniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];\\n\tuniform float spotLightExponent[ MAX_SPOT_LIGHTS ];\\n\tuniform float spotLightDecay[ MAX_SPOT_LIGHTS ];\\n\\n#endif\\n\\n#ifdef WRAP_AROUND\\n\\n\tuniform vec3 wrapRGB;\\n\\n#endif\\n\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/map_pars_vertex.glsl\r\n\r\nTHREE.ShaderChunk['map_pars_vertex'] = \"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP )\\n\\n\tvarying vec2 vUv;\\n\tuniform vec4 offsetRepeat;\\n\\n#endif\\n\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/envmap_fragment.glsl\r\n\r\nTHREE.ShaderChunk['envmap_fragment'] = \"#ifdef USE_ENVMAP\\n\\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\\n\\n\t\tvec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );\\n\\n\t\t// Transforming Normal Vectors with the Inverse Transformation\\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\\n\\n\t\t#ifdef ENVMAP_MODE_REFLECTION\\n\\n\t\t\tvec3 reflectVec = reflect( cameraToVertex, worldNormal );\\n\\n\t\t#else\\n\\n\t\t\tvec3 reflectVec = refract( cameraToVertex, worldNormal, refractionRatio );\\n\\n\t\t#endif\\n\\n\t#else\\n\\n\t\tvec3 reflectVec = vReflect;\\n\\n\t#endif\\n\\n\t#ifdef DOUBLE_SIDED\\n\t\tfloat flipNormal = ( -1.0 + 2.0 * float( gl_FrontFacing ) );\\n\t#else\\n\t\tfloat flipNormal = 1.0;\\n\t#endif\\n\\n\t#ifdef ENVMAP_TYPE_CUBE\\n\t\tvec4 envColor = textureCube( envMap, flipNormal * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\\n\\n\t#elif defined( ENVMAP_TYPE_EQUIREC )\\n\t\tvec2 sampleUV;\\n\t\tsampleUV.y = saturate( flipNormal * reflectVec.y * 0.5 + 0.5 );\\n\t\tsampleUV.x = atan( flipNormal * reflectVec.z, flipNormal * reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\\n\t\tvec4 envColor = texture2D( envMap, sampleUV );\\n\\n\t#elif defined( ENVMAP_TYPE_SPHERE )\\n\t\tvec3 reflectView = flipNormal * normalize((viewMatrix * vec4( reflectVec, 0.0 )).xyz + vec3(0.0,0.0,1.0));\\n\t\tvec4 envColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5 );\\n\t#endif\\n\\n\tenvColor.xyz = inputToLinear( envColor.xyz );\\n\\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\\n\\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\\n\\n\t#elif defined( ENVMAP_BLENDING_MIX )\\n\\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\\n\\n\t#elif defined( ENVMAP_BLENDING_ADD )\\n\\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\\n\\n\t#endif\\n\\n#endif\\n\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/specularmap_pars_fragment.glsl\r\n\r\nTHREE.ShaderChunk['specularmap_pars_fragment'] = \"#ifdef USE_SPECULARMAP\\n\\n\tuniform sampler2D specularMap;\\n\\n#endif\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/logdepthbuf_vertex.glsl\r\n\r\nTHREE.ShaderChunk['logdepthbuf_vertex'] = \"#ifdef USE_LOGDEPTHBUF\\n\\n\tgl_Position.z = log2(max( EPSILON, gl_Position.w + 1.0 )) * logDepthBufFC;\\n\\n\t#ifdef USE_LOGDEPTHBUF_EXT\\n\\n\t\tvFragDepth = 1.0 + gl_Position.w;\\n\\n#else\\n\\n\t\tgl_Position.z = (gl_Position.z - 1.0) * gl_Position.w;\\n\\n\t#endif\\n\\n#endif\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/morphtarget_pars_vertex.glsl\r\n\r\nTHREE.ShaderChunk['morphtarget_pars_vertex'] = \"#ifdef USE_MORPHTARGETS\\n\\n\t#ifndef USE_MORPHNORMALS\\n\\n\tuniform float morphTargetInfluences[ 8 ];\\n\\n\t#else\\n\\n\tuniform float morphTargetInfluences[ 4 ];\\n\\n\t#endif\\n\\n#endif\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/specularmap_fragment.glsl\r\n\r\nTHREE.ShaderChunk['specularmap_fragment'] = \"float specularStrength;\\n\\n#ifdef USE_SPECULARMAP\\n\\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\\n\tspecularStrength = texelSpecular.r;\\n\\n#else\\n\\n\tspecularStrength = 1.0;\\n\\n#endif\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/fog_fragment.glsl\r\n\r\nTHREE.ShaderChunk['fog_fragment'] = \"#ifdef USE_FOG\\n\\n\t#ifdef USE_LOGDEPTHBUF_EXT\\n\\n\t\tfloat depth = gl_FragDepthEXT / gl_FragCoord.w;\\n\\n\t#else\\n\\n\t\tfloat depth = gl_FragCoord.z / gl_FragCoord.w;\\n\\n\t#endif\\n\\n\t#ifdef FOG_EXP2\\n\\n\t\tfloat fogFactor = exp2( - square( fogDensity ) * square( depth ) * LOG2 );\\n\t\tfogFactor = whiteCompliment( fogFactor );\\n\\n\t#else\\n\\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, depth );\\n\\n\t#endif\\n\t\\n\toutgoingLight = mix( outgoingLight, fogColor, fogFactor );\\n\\n#endif\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/bumpmap_pars_fragment.glsl\r\n\r\nTHREE.ShaderChunk['bumpmap_pars_fragment'] = \"#ifdef USE_BUMPMAP\\n\\n\tuniform sampler2D bumpMap;\\n\tuniform float bumpScale;\\n\\n\t// Derivative maps - bump mapping unparametrized surfaces by Morten Mikkelsen\\n\t// http://mmikkelsen3d.blogspot.sk/2011/07/derivative-maps.html\\n\\n\t// Evaluate the derivative of the height w.r.t. screen-space using forward differencing (listing 2)\\n\\n\tvec2 dHdxy_fwd() {\\n\\n\t\tvec2 dSTdx = dFdx( vUv );\\n\t\tvec2 dSTdy = dFdy( vUv );\\n\\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\\n\\n\t\treturn vec2( dBx, dBy );\\n\\n\t}\\n\\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\\n\\n\t\tvec3 vSigmaX = dFdx( surf_pos );\\n\t\tvec3 vSigmaY = dFdy( surf_pos );\\n\t\tvec3 vN = surf_norm;\t\t// normalized\\n\\n\t\tvec3 R1 = cross( vSigmaY, vN );\\n\t\tvec3 R2 = cross( vN, vSigmaX );\\n\\n\t\tfloat fDet = dot( vSigmaX, R1 );\\n\\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\\n\\n\t}\\n\\n#endif\\n\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/defaultnormal_vertex.glsl\r\n\r\nTHREE.ShaderChunk['defaultnormal_vertex'] = \"#ifdef USE_SKINNING\\n\\n\tvec3 objectNormal = skinnedNormal.xyz;\\n\\n#elif defined( USE_MORPHNORMALS )\\n\\n\tvec3 objectNormal = morphedNormal;\\n\\n#else\\n\\n\tvec3 objectNormal = normal;\\n\\n#endif\\n\\n#ifdef FLIP_SIDED\\n\\n\tobjectNormal = -objectNormal;\\n\\n#endif\\n\\nvec3 transformedNormal = normalMatrix * objectNormal;\\n\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/lights_phong_pars_fragment.glsl\r\n\r\nTHREE.ShaderChunk['lights_phong_pars_fragment'] = \"uniform vec3 ambientLightColor;\\n\\n#if MAX_DIR_LIGHTS > 0\\n\\n\tuniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\\n\tuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\\n\\n#endif\\n\\n#if MAX_HEMI_LIGHTS > 0\\n\\n\tuniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];\\n\tuniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];\\n\tuniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];\\n\\n#endif\\n\\n#if MAX_POINT_LIGHTS > 0\\n\\n\tuniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\\n\\n\tuniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\\n\tuniform float pointLightDistance[ MAX_POINT_LIGHTS ];\\n\tuniform float pointLightDecay[ MAX_POINT_LIGHTS ];\\n\\n#endif\\n\\n#if MAX_SPOT_LIGHTS > 0\\n\\n\tuniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];\\n\tuniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];\\n\tuniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];\\n\tuniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];\\n\tuniform float spotLightExponent[ MAX_SPOT_LIGHTS ];\\n\tuniform float spotLightDistance[ MAX_SPOT_LIGHTS ];\\n\tuniform float spotLightDecay[ MAX_SPOT_LIGHTS ];\\n\\n#endif\\n\\n#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP ) || defined( USE_ENVMAP )\\n\\n\tvarying vec3 vWorldPosition;\\n\\n#endif\\n\\n#ifdef WRAP_AROUND\\n\\n\tuniform vec3 wrapRGB;\\n\\n#endif\\n\\nvarying vec3 vViewPosition;\\n\\n#ifndef FLAT_SHADED\\n\\n\tvarying vec3 vNormal;\\n\\n#endif\\n\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/skinbase_vertex.glsl\r\n\r\nTHREE.ShaderChunk['skinbase_vertex'] = \"#ifdef USE_SKINNING\\n\\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\\n\\n#endif\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/map_vertex.glsl\r\n\r\nTHREE.ShaderChunk['map_vertex'] = \"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP )\\n\\n\tvUv = uv * offsetRepeat.zw + offsetRepeat.xy;\\n\\n#endif\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/lightmap_fragment.glsl\r\n\r\nTHREE.ShaderChunk['lightmap_fragment'] = \"#ifdef USE_LIGHTMAP\\n\\n\toutgoingLight *= diffuseColor.xyz * texture2D( lightMap, vUv2 ).xyz;\\n\\n#endif\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/shadowmap_pars_vertex.glsl\r\n\r\nTHREE.ShaderChunk['shadowmap_pars_vertex'] = \"#ifdef USE_SHADOWMAP\\n\\n\tvarying vec4 vShadowCoord[ MAX_SHADOWS ];\\n\tuniform mat4 shadowMatrix[ MAX_SHADOWS ];\\n\\n#endif\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/color_fragment.glsl\r\n\r\nTHREE.ShaderChunk['color_fragment'] = \"#ifdef USE_COLOR\\n\\n\tdiffuseColor.rgb *= vColor;\\n\\n#endif\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/morphtarget_vertex.glsl\r\n\r\nTHREE.ShaderChunk['morphtarget_vertex'] = \"#ifdef USE_MORPHTARGETS\\n\\n\tvec3 morphed = vec3( 0.0 );\\n\tmorphed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];\\n\tmorphed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];\\n\tmorphed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];\\n\tmorphed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];\\n\\n\t#ifndef USE_MORPHNORMALS\\n\\n\tmorphed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];\\n\tmorphed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];\\n\tmorphed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];\\n\tmorphed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];\\n\\n\t#endif\\n\\n\tmorphed += position;\\n\\n#endif\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/envmap_vertex.glsl\r\n\r\nTHREE.ShaderChunk['envmap_vertex'] = \"#if defined( USE_ENVMAP ) && ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP ) && ! defined( PHONG )\\n\\n\tvec3 worldNormal = transformDirection( objectNormal, modelMatrix );\\n\\n\tvec3 cameraToVertex = normalize( worldPosition.xyz - cameraPosition );\\n\\n\t#ifdef ENVMAP_MODE_REFLECTION\\n\\n\t\tvReflect = reflect( cameraToVertex, worldNormal );\\n\\n\t#else\\n\\n\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\\n\\n\t#endif\\n\\n#endif\\n\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/shadowmap_fragment.glsl\r\n\r\nTHREE.ShaderChunk['shadowmap_fragment'] = \"#ifdef USE_SHADOWMAP\\n\\n\t#ifdef SHADOWMAP_DEBUG\\n\\n\t\tvec3 frustumColors[3];\\n\t\tfrustumColors[0] = vec3( 1.0, 0.5, 0.0 );\\n\t\tfrustumColors[1] = vec3( 0.0, 1.0, 0.8 );\\n\t\tfrustumColors[2] = vec3( 0.0, 0.5, 1.0 );\\n\\n\t#endif\\n\\n\t#ifdef SHADOWMAP_CASCADE\\n\\n\t\tint inFrustumCount = 0;\\n\\n\t#endif\\n\\n\tfloat fDepth;\\n\tvec3 shadowColor = vec3( 1.0 );\\n\\n\tfor( int i = 0; i < MAX_SHADOWS; i ++ ) {\\n\\n\t\tvec3 shadowCoord = vShadowCoord[ i ].xyz / vShadowCoord[ i ].w;\\n\\n\t\t\t\t// if ( something && something ) breaks ATI OpenGL shader compiler\\n\t\t\t\t// if ( all( something, something ) ) using this instead\\n\\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\\n\t\tbool inFrustum = all( inFrustumVec );\\n\\n\t\t\t\t// don't shadow pixels outside of light frustum\\n\t\t\t\t// use just first frustum (for cascades)\\n\t\t\t\t// don't shadow pixels behind far plane of light frustum\\n\\n\t\t#ifdef SHADOWMAP_CASCADE\\n\\n\t\t\tinFrustumCount += int( inFrustum );\\n\t\t\tbvec3 frustumTestVec = bvec3( inFrustum, inFrustumCount == 1, shadowCoord.z <= 1.0 );\\n\\n\t\t#else\\n\\n\t\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\\n\\n\t\t#endif\\n\\n\t\tbool frustumTest = all( frustumTestVec );\\n\\n\t\tif ( frustumTest ) {\\n\\n\t\t\tshadowCoord.z += shadowBias[ i ];\\n\\n\t\t\t#if defined( SHADOWMAP_TYPE_PCF )\\n\\n\t\t\t\t\t\t// Percentage-close filtering\\n\t\t\t\t\t\t// (9 pixel kernel)\\n\t\t\t\t\t\t// http://fabiensanglard.net/shadowmappingPCF/\\n\\n\t\t\t\tfloat shadow = 0.0;\\n\\n\t\t/*\\n\t\t\t\t\t\t// nested loops breaks shader compiler / validator on some ATI cards when using OpenGL\\n\t\t\t\t\t\t// must enroll loop manually\\n\\n\t\t\t\tfor ( float y = -1.25; y <= 1.25; y += 1.25 )\\n\t\t\t\t\tfor ( float x = -1.25; x <= 1.25; x += 1.25 ) {\\n\\n\t\t\t\t\t\tvec4 rgbaDepth = texture2D( shadowMap[ i ], vec2( x * xPixelOffset, y * yPixelOffset ) + shadowCoord.xy );\\n\\n\t\t\t\t\t\t\t\t// doesn't seem to produce any noticeable visual difference compared to simple texture2D lookup\\n\t\t\t\t\t\t\t\t//vec4 rgbaDepth = texture2DProj( shadowMap[ i ], vec4( vShadowCoord[ i ].w * ( vec2( x * xPixelOffset, y * yPixelOffset ) + shadowCoord.xy ), 0.05, vShadowCoord[ i ].w ) );\\n\\n\t\t\t\t\t\tfloat fDepth = unpackDepth( rgbaDepth );\\n\\n\t\t\t\t\t\tif ( fDepth < shadowCoord.z )\\n\t\t\t\t\t\t\tshadow += 1.0;\\n\\n\t\t\t\t}\\n\\n\t\t\t\tshadow /= 9.0;\\n\\n\t\t*/\\n\\n\t\t\t\tconst float shadowDelta = 1.0 / 9.0;\\n\\n\t\t\t\tfloat xPixelOffset = 1.0 / shadowMapSize[ i ].x;\\n\t\t\t\tfloat yPixelOffset = 1.0 / shadowMapSize[ i ].y;\\n\\n\t\t\t\tfloat dx0 = -1.25 * xPixelOffset;\\n\t\t\t\tfloat dy0 = -1.25 * yPixelOffset;\\n\t\t\t\tfloat dx1 = 1.25 * xPixelOffset;\\n\t\t\t\tfloat dy1 = 1.25 * yPixelOffset;\\n\\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy0 ) ) );\\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\\n\\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy0 ) ) );\\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\\n\\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy0 ) ) );\\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\\n\\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, 0.0 ) ) );\\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\\n\\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy ) );\\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\\n\\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, 0.0 ) ) );\\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\\n\\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy1 ) ) );\\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\\n\\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy1 ) ) );\\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\\n\\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy1 ) ) );\\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\\n\\n\t\t\t\tshadowColor = shadowColor * vec3( ( 1.0 - shadowDarkness[ i ] * shadow ) );\\n\\n\t\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\\n\\n\t\t\t\t\t\t// Percentage-close filtering\\n\t\t\t\t\t\t// (9 pixel kernel)\\n\t\t\t\t\t\t// http://fabiensanglard.net/shadowmappingPCF/\\n\\n\t\t\t\tfloat shadow = 0.0;\\n\\n\t\t\t\tfloat xPixelOffset = 1.0 / shadowMapSize[ i ].x;\\n\t\t\t\tfloat yPixelOffset = 1.0 / shadowMapSize[ i ].y;\\n\\n\t\t\t\tfloat dx0 = -1.0 * xPixelOffset;\\n\t\t\t\tfloat dy0 = -1.0 * yPixelOffset;\\n\t\t\t\tfloat dx1 = 1.0 * xPixelOffset;\\n\t\t\t\tfloat dy1 = 1.0 * yPixelOffset;\\n\\n\t\t\t\tmat3 shadowKernel;\\n\t\t\t\tmat3 depthKernel;\\n\\n\t\t\t\tdepthKernel[0][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy0 ) ) );\\n\t\t\t\tdepthKernel[0][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, 0.0 ) ) );\\n\t\t\t\tdepthKernel[0][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy1 ) ) );\\n\t\t\t\tdepthKernel[1][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy0 ) ) );\\n\t\t\t\tdepthKernel[1][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy ) );\\n\t\t\t\tdepthKernel[1][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy1 ) ) );\\n\t\t\t\tdepthKernel[2][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy0 ) ) );\\n\t\t\t\tdepthKernel[2][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, 0.0 ) ) );\\n\t\t\t\tdepthKernel[2][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy1 ) ) );\\n\\n\t\t\t\tvec3 shadowZ = vec3( shadowCoord.z );\\n\t\t\t\tshadowKernel[0] = vec3(lessThan(depthKernel[0], shadowZ ));\\n\t\t\t\tshadowKernel[0] *= vec3(0.25);\\n\\n\t\t\t\tshadowKernel[1] = vec3(lessThan(depthKernel[1], shadowZ ));\\n\t\t\t\tshadowKernel[1] *= vec3(0.25);\\n\\n\t\t\t\tshadowKernel[2] = vec3(lessThan(depthKernel[2], shadowZ ));\\n\t\t\t\tshadowKernel[2] *= vec3(0.25);\\n\\n\t\t\t\tvec2 fractionalCoord = 1.0 - fract( shadowCoord.xy * shadowMapSize[i].xy );\\n\\n\t\t\t\tshadowKernel[0] = mix( shadowKernel[1], shadowKernel[0], fractionalCoord.x );\\n\t\t\t\tshadowKernel[1] = mix( shadowKernel[2], shadowKernel[1], fractionalCoord.x );\\n\\n\t\t\t\tvec4 shadowValues;\\n\t\t\t\tshadowValues.x = mix( shadowKernel[0][1], shadowKernel[0][0], fractionalCoord.y );\\n\t\t\t\tshadowValues.y = mix( shadowKernel[0][2], shadowKernel[0][1], fractionalCoord.y );\\n\t\t\t\tshadowValues.z = mix( shadowKernel[1][1], shadowKernel[1][0], fractionalCoord.y );\\n\t\t\t\tshadowValues.w = mix( shadowKernel[1][2], shadowKernel[1][1], fractionalCoord.y );\\n\\n\t\t\t\tshadow = dot( shadowValues, vec4( 1.0 ) );\\n\\n\t\t\t\tshadowColor = shadowColor * vec3( ( 1.0 - shadowDarkness[ i ] * shadow ) );\\n\\n\t\t\t#else\\n\\n\t\t\t\tvec4 rgbaDepth = texture2D( shadowMap[ i ], shadowCoord.xy );\\n\t\t\t\tfloat fDepth = unpackDepth( rgbaDepth );\\n\\n\t\t\t\tif ( fDepth < shadowCoord.z )\\n\\n\t\t// spot with multiple shadows is darker\\n\\n\t\t\t\t\tshadowColor = shadowColor * vec3( 1.0 - shadowDarkness[ i ] );\\n\\n\t\t// spot with multiple shadows has the same color as single shadow spot\\n\\n\t\t// \t\t\t\t\tshadowColor = min( shadowColor, vec3( shadowDarkness[ i ] ) );\\n\\n\t\t\t#endif\\n\\n\t\t}\\n\\n\\n\t\t#ifdef SHADOWMAP_DEBUG\\n\\n\t\t\t#ifdef SHADOWMAP_CASCADE\\n\\n\t\t\t\tif ( inFrustum && inFrustumCount == 1 ) outgoingLight *= frustumColors[ i ];\\n\\n\t\t\t#else\\n\\n\t\t\t\tif ( inFrustum ) outgoingLight *= frustumColors[ i ];\\n\\n\t\t\t#endif\\n\\n\t\t#endif\\n\\n\t}\\n\\n\t// NOTE: I am unsure if this is correct in linear space.  -bhouston, Dec 29, 2014\\n\tshadowColor = inputToLinear( shadowColor );\\n\\n\toutgoingLight = outgoingLight * shadowColor;\\n\\n#endif\\n\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/worldpos_vertex.glsl\r\n\r\nTHREE.ShaderChunk['worldpos_vertex'] = \"#if defined( USE_ENVMAP ) || defined( PHONG ) || defined( LAMBERT ) || defined ( USE_SHADOWMAP )\\n\\n\t#ifdef USE_SKINNING\\n\\n\t\tvec4 worldPosition = modelMatrix * skinned;\\n\\n\t#elif defined( USE_MORPHTARGETS )\\n\\n\t\tvec4 worldPosition = modelMatrix * vec4( morphed, 1.0 );\\n\\n\t#else\\n\\n\t\tvec4 worldPosition = modelMatrix * vec4( position, 1.0 );\\n\\n\t#endif\\n\\n#endif\\n\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/shadowmap_pars_fragment.glsl\r\n\r\nTHREE.ShaderChunk['shadowmap_pars_fragment'] = \"#ifdef USE_SHADOWMAP\\n\\n\tuniform sampler2D shadowMap[ MAX_SHADOWS ];\\n\tuniform vec2 shadowMapSize[ MAX_SHADOWS ];\\n\\n\tuniform float shadowDarkness[ MAX_SHADOWS ];\\n\tuniform float shadowBias[ MAX_SHADOWS ];\\n\\n\tvarying vec4 vShadowCoord[ MAX_SHADOWS ];\\n\\n\tfloat unpackDepth( const in vec4 rgba_depth ) {\\n\\n\t\tconst vec4 bit_shift = vec4( 1.0 / ( 256.0 * 256.0 * 256.0 ), 1.0 / ( 256.0 * 256.0 ), 1.0 / 256.0, 1.0 );\\n\t\tfloat depth = dot( rgba_depth, bit_shift );\\n\t\treturn depth;\\n\\n\t}\\n\\n#endif\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/skinning_pars_vertex.glsl\r\n\r\nTHREE.ShaderChunk['skinning_pars_vertex'] = \"#ifdef USE_SKINNING\\n\\n\tuniform mat4 bindMatrix;\\n\tuniform mat4 bindMatrixInverse;\\n\\n\t#ifdef BONE_TEXTURE\\n\\n\t\tuniform sampler2D boneTexture;\\n\t\tuniform int boneTextureWidth;\\n\t\tuniform int boneTextureHeight;\\n\\n\t\tmat4 getBoneMatrix( const in float i ) {\\n\\n\t\t\tfloat j = i * 4.0;\\n\t\t\tfloat x = mod( j, float( boneTextureWidth ) );\\n\t\t\tfloat y = floor( j / float( boneTextureWidth ) );\\n\\n\t\t\tfloat dx = 1.0 / float( boneTextureWidth );\\n\t\t\tfloat dy = 1.0 / float( boneTextureHeight );\\n\\n\t\t\ty = dy * ( y + 0.5 );\\n\\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\\n\\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\\n\\n\t\t\treturn bone;\\n\\n\t\t}\\n\\n\t#else\\n\\n\t\tuniform mat4 boneGlobalMatrices[ MAX_BONES ];\\n\\n\t\tmat4 getBoneMatrix( const in float i ) {\\n\\n\t\t\tmat4 bone = boneGlobalMatrices[ int(i) ];\\n\t\t\treturn bone;\\n\\n\t\t}\\n\\n\t#endif\\n\\n#endif\\n\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/logdepthbuf_pars_fragment.glsl\r\n\r\nTHREE.ShaderChunk['logdepthbuf_pars_fragment'] = \"#ifdef USE_LOGDEPTHBUF\\n\\n\tuniform float logDepthBufFC;\\n\\n\t#ifdef USE_LOGDEPTHBUF_EXT\\n\\n\t\t#extension GL_EXT_frag_depth : enable\\n\t\tvarying float vFragDepth;\\n\\n\t#endif\\n\\n#endif\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/alphamap_fragment.glsl\r\n\r\nTHREE.ShaderChunk['alphamap_fragment'] = \"#ifdef USE_ALPHAMAP\\n\\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\\n\\n#endif\\n\";\r\n\r\n// File:src/renderers/shaders/ShaderChunk/alphamap_pars_fragment.glsl\r\n\r\nTHREE.ShaderChunk['alphamap_pars_fragment'] = \"#ifdef USE_ALPHAMAP\\n\\n\tuniform sampler2D alphaMap;\\n\\n#endif\\n\";\r\n\r\n// File:src/renderers/shaders/UniformsUtils.js\r\n\r\n/**\r\n * Uniform Utilities\r\n */\r\n\r\nTHREE.UniformsUtils = {\r\n\r\n  merge: function(uniforms) {\r\n\r\n    var merged = {};\r\n\r\n    for (var u = 0; u < uniforms.length; u++) {\r\n\r\n      var tmp = this.clone(uniforms[u]);\r\n\r\n      for (var p in tmp) {\r\n\r\n        merged[p] = tmp[p];\r\n\r\n      }\r\n\r\n    }\r\n\r\n    return merged;\r\n\r\n  },\r\n\r\n  clone: function(uniforms_src) {\r\n\r\n    var uniforms_dst = {};\r\n\r\n    for (var u in uniforms_src) {\r\n\r\n      uniforms_dst[u] = {};\r\n\r\n      for (var p in uniforms_src[u]) {\r\n\r\n        var parameter_src = uniforms_src[u][p];\r\n\r\n        if (parameter_src instanceof THREE.Color ||\r\n          parameter_src instanceof THREE.Vector2 ||\r\n          parameter_src instanceof THREE.Vector3 ||\r\n          parameter_src instanceof THREE.Vector4 ||\r\n          parameter_src instanceof THREE.Matrix4 ||\r\n          parameter_src instanceof THREE.Texture) {\r\n\r\n          uniforms_dst[u][p] = parameter_src.clone();\r\n\r\n        }\r\n        else if (parameter_src instanceof Array) {\r\n\r\n          uniforms_dst[u][p] = parameter_src.slice();\r\n\r\n        }\r\n        else {\r\n\r\n          uniforms_dst[u][p] = parameter_src;\r\n\r\n        }\r\n\r\n      }\r\n\r\n    }\r\n\r\n    return uniforms_dst;\r\n\r\n  }\r\n\r\n};\r\n\r\n// File:src/renderers/shaders/UniformsLib.js\r\n\r\n/**\r\n * Uniforms library for shared webgl shaders\r\n */\r\n\r\nTHREE.UniformsLib = {\r\n\r\n  common: {\r\n\r\n    \"diffuse\": {\r\n      type: \"c\",\r\n      value: new THREE.Color(0xeeeeee)\r\n    },\r\n    \"opacity\": {\r\n      type: \"f\",\r\n      value: 1.0\r\n    },\r\n\r\n    \"map\": {\r\n      type: \"t\",\r\n      value: null\r\n    },\r\n    \"offsetRepeat\": {\r\n      type: \"v4\",\r\n      value: new THREE.Vector4(0, 0, 1, 1)\r\n    },\r\n\r\n    \"lightMap\": {\r\n      type: \"t\",\r\n      value: null\r\n    },\r\n    \"specularMap\": {\r\n      type: \"t\",\r\n      value: null\r\n    },\r\n    \"alphaMap\": {\r\n      type: \"t\",\r\n      value: null\r\n    },\r\n\r\n    \"envMap\": {\r\n      type: \"t\",\r\n      value: null\r\n    },\r\n    \"flipEnvMap\": {\r\n      type: \"f\",\r\n      value: -1\r\n    },\r\n    \"reflectivity\": {\r\n      type: \"f\",\r\n      value: 1.0\r\n    },\r\n    \"refractionRatio\": {\r\n      type: \"f\",\r\n      value: 0.98\r\n    },\r\n\r\n    \"morphTargetInfluences\": {\r\n      type: \"f\",\r\n      value: 0\r\n    }\r\n\r\n  },\r\n\r\n  bump: {\r\n\r\n    \"bumpMap\": {\r\n      type: \"t\",\r\n      value: null\r\n    },\r\n    \"bumpScale\": {\r\n      type: \"f\",\r\n      value: 1\r\n    }\r\n\r\n  },\r\n\r\n  normalmap: {\r\n\r\n    \"normalMap\": {\r\n      type: \"t\",\r\n      value: null\r\n    },\r\n    \"normalScale\": {\r\n      type: \"v2\",\r\n      value: new THREE.Vector2(1, 1)\r\n    }\r\n  },\r\n\r\n  fog: {\r\n\r\n    \"fogDensity\": {\r\n      type: \"f\",\r\n      value: 0.00025\r\n    },\r\n    \"fogNear\": {\r\n      type: \"f\",\r\n      value: 1\r\n    },\r\n    \"fogFar\": {\r\n      type: \"f\",\r\n      value: 2000\r\n    },\r\n    \"fogColor\": {\r\n      type: \"c\",\r\n      value: new THREE.Color(0xffffff)\r\n    }\r\n\r\n  },\r\n\r\n  lights: {\r\n\r\n    \"ambientLightColor\": {\r\n      type: \"fv\",\r\n      value: []\r\n    },\r\n\r\n    \"directionalLightDirection\": {\r\n      type: \"fv\",\r\n      value: []\r\n    },\r\n    \"directionalLightColor\": {\r\n      type: \"fv\",\r\n      value: []\r\n    },\r\n\r\n    \"hemisphereLightDirection\": {\r\n      type: \"fv\",\r\n      value: []\r\n    },\r\n    \"hemisphereLightSkyColor\": {\r\n      type: \"fv\",\r\n      value: []\r\n    },\r\n    \"hemisphereLightGroundColor\": {\r\n      type: \"fv\",\r\n      value: []\r\n    },\r\n\r\n    \"pointLightColor\": {\r\n      type: \"fv\",\r\n      value: []\r\n    },\r\n    \"pointLightPosition\": {\r\n      type: \"fv\",\r\n      value: []\r\n    },\r\n    \"pointLightDistance\": {\r\n      type: \"fv1\",\r\n      value: []\r\n    },\r\n    \"pointLightDecay\": {\r\n      type: \"fv1\",\r\n      value: []\r\n    },\r\n\r\n    \"spotLightColor\": {\r\n      type: \"fv\",\r\n      value: []\r\n    },\r\n    \"spotLightPosition\": {\r\n      type: \"fv\",\r\n      value: []\r\n    },\r\n    \"spotLightDirection\": {\r\n      type: \"fv\",\r\n      value: []\r\n    },\r\n    \"spotLightDistance\": {\r\n      type: \"fv1\",\r\n      value: []\r\n    },\r\n    \"spotLightAngleCos\": {\r\n      type: \"fv1\",\r\n      value: []\r\n    },\r\n    \"spotLightExponent\": {\r\n      type: \"fv1\",\r\n      value: []\r\n    },\r\n    \"spotLightDecay\": {\r\n      type: \"fv1\",\r\n      value: []\r\n    }\r\n\r\n  },\r\n\r\n  particle: {\r\n\r\n    \"psColor\": {\r\n      type: \"c\",\r\n      value: new THREE.Color(0xeeeeee)\r\n    },\r\n    \"opacity\": {\r\n      type: \"f\",\r\n      value: 1.0\r\n    },\r\n    \"size\": {\r\n      type: \"f\",\r\n      value: 1.0\r\n    },\r\n    \"scale\": {\r\n      type: \"f\",\r\n      value: 1.0\r\n    },\r\n    \"map\": {\r\n      type: \"t\",\r\n      value: null\r\n    },\r\n    \"offsetRepeat\": {\r\n      type: \"v4\",\r\n      value: new THREE.Vector4(0, 0, 1, 1)\r\n    },\r\n\r\n    \"fogDensity\": {\r\n      type: \"f\",\r\n      value: 0.00025\r\n    },\r\n    \"fogNear\": {\r\n      type: \"f\",\r\n      value: 1\r\n    },\r\n    \"fogFar\": {\r\n      type: \"f\",\r\n      value: 2000\r\n    },\r\n    \"fogColor\": {\r\n      type: \"c\",\r\n      value: new THREE.Color(0xffffff)\r\n    }\r\n\r\n  },\r\n\r\n  shadowmap: {\r\n\r\n    \"shadowMap\": {\r\n      type: \"tv\",\r\n      value: []\r\n    },\r\n    \"shadowMapSize\": {\r\n      type: \"v2v\",\r\n      value: []\r\n    },\r\n\r\n    \"shadowBias\": {\r\n      type: \"fv1\",\r\n      value: []\r\n    },\r\n    \"shadowDarkness\": {\r\n      type: \"fv1\",\r\n      value: []\r\n    },\r\n\r\n    \"shadowMatrix\": {\r\n      type: \"m4v\",\r\n      value: []\r\n    }\r\n\r\n  }\r\n\r\n};\r\n\r\n// File:src/renderers/shaders/ShaderLib.js\r\n\r\n/**\r\n * Webgl Shader Library for three.js\r\n *\r\n * @author alteredq / http://alteredqualia.com/\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author mikael emtinger / http://gomo.se/\r\n */\r\n\r\n\r\nTHREE.ShaderLib = {\r\n\r\n  'basic': {\r\n\r\n    uniforms: THREE.UniformsUtils.merge([\r\n\r\n      THREE.UniformsLib[\"common\"],\r\n      THREE.UniformsLib[\"fog\"],\r\n      THREE.UniformsLib[\"shadowmap\"]\r\n\r\n    ]),\r\n\r\n    vertexShader: [\r\n\r\n      THREE.ShaderChunk[\"common\"],\r\n      THREE.ShaderChunk[\"map_pars_vertex\"],\r\n      THREE.ShaderChunk[\"lightmap_pars_vertex\"],\r\n      THREE.ShaderChunk[\"envmap_pars_vertex\"],\r\n      THREE.ShaderChunk[\"color_pars_vertex\"],\r\n      THREE.ShaderChunk[\"morphtarget_pars_vertex\"],\r\n      THREE.ShaderChunk[\"skinning_pars_vertex\"],\r\n      THREE.ShaderChunk[\"shadowmap_pars_vertex\"],\r\n      THREE.ShaderChunk[\"logdepthbuf_pars_vertex\"],\r\n\r\n      \"void main() {\",\r\n\r\n      THREE.ShaderChunk[\"map_vertex\"],\r\n      THREE.ShaderChunk[\"lightmap_vertex\"],\r\n      THREE.ShaderChunk[\"color_vertex\"],\r\n      THREE.ShaderChunk[\"skinbase_vertex\"],\r\n\r\n      \"\t#ifdef USE_ENVMAP\",\r\n\r\n      THREE.ShaderChunk[\"morphnormal_vertex\"],\r\n      THREE.ShaderChunk[\"skinnormal_vertex\"],\r\n      THREE.ShaderChunk[\"defaultnormal_vertex\"],\r\n\r\n      \"\t#endif\",\r\n\r\n      THREE.ShaderChunk[\"morphtarget_vertex\"],\r\n      THREE.ShaderChunk[\"skinning_vertex\"],\r\n      THREE.ShaderChunk[\"default_vertex\"],\r\n      THREE.ShaderChunk[\"logdepthbuf_vertex\"],\r\n\r\n      THREE.ShaderChunk[\"worldpos_vertex\"],\r\n      THREE.ShaderChunk[\"envmap_vertex\"],\r\n      THREE.ShaderChunk[\"shadowmap_vertex\"],\r\n\r\n      \"}\"\r\n\r\n    ].join(\"\\n\"),\r\n\r\n    fragmentShader: [\r\n\r\n      \"uniform vec3 diffuse;\",\r\n      \"uniform float opacity;\",\r\n\r\n      THREE.ShaderChunk[\"common\"],\r\n      THREE.ShaderChunk[\"color_pars_fragment\"],\r\n      THREE.ShaderChunk[\"map_pars_fragment\"],\r\n      THREE.ShaderChunk[\"alphamap_pars_fragment\"],\r\n      THREE.ShaderChunk[\"lightmap_pars_fragment\"],\r\n      THREE.ShaderChunk[\"envmap_pars_fragment\"],\r\n      THREE.ShaderChunk[\"fog_pars_fragment\"],\r\n      THREE.ShaderChunk[\"shadowmap_pars_fragment\"],\r\n      THREE.ShaderChunk[\"specularmap_pars_fragment\"],\r\n      THREE.ShaderChunk[\"logdepthbuf_pars_fragment\"],\r\n\r\n      \"void main() {\",\r\n\r\n      \"\tvec3 outgoingLight = vec3( 0.0 );\", // outgoing light does not have an alpha, the surface does\r\n      \"\tvec4 diffuseColor = vec4( diffuse, opacity );\",\r\n\r\n      THREE.ShaderChunk[\"logdepthbuf_fragment\"],\r\n      THREE.ShaderChunk[\"map_fragment\"],\r\n      THREE.ShaderChunk[\"color_fragment\"],\r\n      THREE.ShaderChunk[\"alphamap_fragment\"],\r\n      THREE.ShaderChunk[\"alphatest_fragment\"],\r\n      THREE.ShaderChunk[\"specularmap_fragment\"],\r\n\r\n      \"\toutgoingLight = diffuseColor.rgb;\", // simple shader\r\n\r\n      THREE.ShaderChunk[\"lightmap_fragment\"], // TODO: Light map on an otherwise unlit surface doesn't make sense.\r\n      THREE.ShaderChunk[\"envmap_fragment\"],\r\n      THREE.ShaderChunk[\"shadowmap_fragment\"], // TODO: Shadows on an otherwise unlit surface doesn't make sense.\r\n\r\n      THREE.ShaderChunk[\"linear_to_gamma_fragment\"],\r\n\r\n      THREE.ShaderChunk[\"fog_fragment\"],\r\n\r\n      \"\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\", // TODO, this should be pre-multiplied to allow for bright highlights on very transparent objects\r\n\r\n      \"}\"\r\n\r\n    ].join(\"\\n\")\r\n\r\n  },\r\n\r\n  'lambert': {\r\n\r\n    uniforms: THREE.UniformsUtils.merge([\r\n\r\n      THREE.UniformsLib[\"common\"],\r\n      THREE.UniformsLib[\"fog\"],\r\n      THREE.UniformsLib[\"lights\"],\r\n      THREE.UniformsLib[\"shadowmap\"],\r\n\r\n      {\r\n        \"emissive\": {\r\n          type: \"c\",\r\n          value: new THREE.Color(0x000000)\r\n        },\r\n        \"wrapRGB\": {\r\n          type: \"v3\",\r\n          value: new THREE.Vector3(1, 1, 1)\r\n        }\r\n      }\r\n\r\n    ]),\r\n\r\n    vertexShader: [\r\n\r\n      \"#define LAMBERT\",\r\n\r\n      \"varying vec3 vLightFront;\",\r\n\r\n      \"#ifdef DOUBLE_SIDED\",\r\n\r\n      \"\tvarying vec3 vLightBack;\",\r\n\r\n      \"#endif\",\r\n\r\n      THREE.ShaderChunk[\"common\"],\r\n      THREE.ShaderChunk[\"map_pars_vertex\"],\r\n      THREE.ShaderChunk[\"lightmap_pars_vertex\"],\r\n      THREE.ShaderChunk[\"envmap_pars_vertex\"],\r\n      THREE.ShaderChunk[\"lights_lambert_pars_vertex\"],\r\n      THREE.ShaderChunk[\"color_pars_vertex\"],\r\n      THREE.ShaderChunk[\"morphtarget_pars_vertex\"],\r\n      THREE.ShaderChunk[\"skinning_pars_vertex\"],\r\n      THREE.ShaderChunk[\"shadowmap_pars_vertex\"],\r\n      THREE.ShaderChunk[\"logdepthbuf_pars_vertex\"],\r\n\r\n      \"void main() {\",\r\n\r\n      THREE.ShaderChunk[\"map_vertex\"],\r\n      THREE.ShaderChunk[\"lightmap_vertex\"],\r\n      THREE.ShaderChunk[\"color_vertex\"],\r\n\r\n      THREE.ShaderChunk[\"morphnormal_vertex\"],\r\n      THREE.ShaderChunk[\"skinbase_vertex\"],\r\n      THREE.ShaderChunk[\"skinnormal_vertex\"],\r\n      THREE.ShaderChunk[\"defaultnormal_vertex\"],\r\n\r\n      THREE.ShaderChunk[\"morphtarget_vertex\"],\r\n      THREE.ShaderChunk[\"skinning_vertex\"],\r\n      THREE.ShaderChunk[\"default_vertex\"],\r\n      THREE.ShaderChunk[\"logdepthbuf_vertex\"],\r\n\r\n      THREE.ShaderChunk[\"worldpos_vertex\"],\r\n      THREE.ShaderChunk[\"envmap_vertex\"],\r\n      THREE.ShaderChunk[\"lights_lambert_vertex\"],\r\n      THREE.ShaderChunk[\"shadowmap_vertex\"],\r\n\r\n      \"}\"\r\n\r\n    ].join(\"\\n\"),\r\n\r\n    fragmentShader: [\r\n\r\n      \"uniform vec3 diffuse;\",\r\n      \"uniform vec3 emissive;\",\r\n      \"uniform float opacity;\",\r\n\r\n      \"varying vec3 vLightFront;\",\r\n\r\n      \"#ifdef DOUBLE_SIDED\",\r\n\r\n      \"\tvarying vec3 vLightBack;\",\r\n\r\n      \"#endif\",\r\n\r\n      THREE.ShaderChunk[\"common\"],\r\n      THREE.ShaderChunk[\"color_pars_fragment\"],\r\n      THREE.ShaderChunk[\"map_pars_fragment\"],\r\n      THREE.ShaderChunk[\"alphamap_pars_fragment\"],\r\n      THREE.ShaderChunk[\"lightmap_pars_fragment\"],\r\n      THREE.ShaderChunk[\"envmap_pars_fragment\"],\r\n      THREE.ShaderChunk[\"fog_pars_fragment\"],\r\n      THREE.ShaderChunk[\"shadowmap_pars_fragment\"],\r\n      THREE.ShaderChunk[\"specularmap_pars_fragment\"],\r\n      THREE.ShaderChunk[\"logdepthbuf_pars_fragment\"],\r\n\r\n      \"void main() {\",\r\n\r\n      \"\tvec3 outgoingLight = vec3( 0.0 );\", // outgoing light does not have an alpha, the surface does\r\n      \"\tvec4 diffuseColor = vec4( diffuse, opacity );\",\r\n\r\n      THREE.ShaderChunk[\"logdepthbuf_fragment\"],\r\n      THREE.ShaderChunk[\"map_fragment\"],\r\n      THREE.ShaderChunk[\"color_fragment\"],\r\n      THREE.ShaderChunk[\"alphamap_fragment\"],\r\n      THREE.ShaderChunk[\"alphatest_fragment\"],\r\n      THREE.ShaderChunk[\"specularmap_fragment\"],\r\n\r\n      \"\t#ifdef DOUBLE_SIDED\",\r\n\r\n      //\"float isFront = float( gl_FrontFacing );\",\r\n      //\"gl_FragColor.xyz *= isFront * vLightFront + ( 1.0 - isFront ) * vLightBack;\",\r\n\r\n      \"\t\tif ( gl_FrontFacing )\",\r\n      \"\t\t\toutgoingLight += diffuseColor.rgb * vLightFront + emissive;\",\r\n      \"\t\telse\",\r\n      \"\t\t\toutgoingLight += diffuseColor.rgb * vLightBack + emissive;\",\r\n\r\n      \"\t#else\",\r\n\r\n      \"\t\toutgoingLight += diffuseColor.rgb * vLightFront + emissive;\",\r\n\r\n      \"\t#endif\",\r\n\r\n      THREE.ShaderChunk[\"lightmap_fragment\"],\r\n      THREE.ShaderChunk[\"envmap_fragment\"],\r\n      THREE.ShaderChunk[\"shadowmap_fragment\"],\r\n\r\n      THREE.ShaderChunk[\"linear_to_gamma_fragment\"],\r\n\r\n      THREE.ShaderChunk[\"fog_fragment\"],\r\n\r\n      \"\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\", // TODO, this should be pre-multiplied to allow for bright highlights on very transparent objects\r\n\r\n      \"}\"\r\n\r\n    ].join(\"\\n\")\r\n\r\n  },\r\n\r\n  'phong': {\r\n\r\n    uniforms: THREE.UniformsUtils.merge([\r\n\r\n      THREE.UniformsLib[\"common\"],\r\n      THREE.UniformsLib[\"bump\"],\r\n      THREE.UniformsLib[\"normalmap\"],\r\n      THREE.UniformsLib[\"fog\"],\r\n      THREE.UniformsLib[\"lights\"],\r\n      THREE.UniformsLib[\"shadowmap\"],\r\n\r\n      {\r\n        \"emissive\": {\r\n          type: \"c\",\r\n          value: new THREE.Color(0x000000)\r\n        },\r\n        \"specular\": {\r\n          type: \"c\",\r\n          value: new THREE.Color(0x111111)\r\n        },\r\n        \"shininess\": {\r\n          type: \"f\",\r\n          value: 30\r\n        },\r\n        \"wrapRGB\": {\r\n          type: \"v3\",\r\n          value: new THREE.Vector3(1, 1, 1)\r\n        }\r\n      }\r\n\r\n    ]),\r\n\r\n    vertexShader: [\r\n\r\n      \"#define PHONG\",\r\n\r\n      \"varying vec3 vViewPosition;\",\r\n\r\n      \"#ifndef FLAT_SHADED\",\r\n\r\n      \"\tvarying vec3 vNormal;\",\r\n\r\n      \"#endif\",\r\n\r\n      THREE.ShaderChunk[\"common\"],\r\n      THREE.ShaderChunk[\"map_pars_vertex\"],\r\n      THREE.ShaderChunk[\"lightmap_pars_vertex\"],\r\n      THREE.ShaderChunk[\"envmap_pars_vertex\"],\r\n      THREE.ShaderChunk[\"lights_phong_pars_vertex\"],\r\n      THREE.ShaderChunk[\"color_pars_vertex\"],\r\n      THREE.ShaderChunk[\"morphtarget_pars_vertex\"],\r\n      THREE.ShaderChunk[\"skinning_pars_vertex\"],\r\n      THREE.ShaderChunk[\"shadowmap_pars_vertex\"],\r\n      THREE.ShaderChunk[\"logdepthbuf_pars_vertex\"],\r\n\r\n      \"void main() {\",\r\n\r\n      THREE.ShaderChunk[\"map_vertex\"],\r\n      THREE.ShaderChunk[\"lightmap_vertex\"],\r\n      THREE.ShaderChunk[\"color_vertex\"],\r\n\r\n      THREE.ShaderChunk[\"morphnormal_vertex\"],\r\n      THREE.ShaderChunk[\"skinbase_vertex\"],\r\n      THREE.ShaderChunk[\"skinnormal_vertex\"],\r\n      THREE.ShaderChunk[\"defaultnormal_vertex\"],\r\n\r\n      \"#ifndef FLAT_SHADED\", // Normal computed with derivatives when FLAT_SHADED\r\n\r\n      \"\tvNormal = normalize( transformedNormal );\",\r\n\r\n      \"#endif\",\r\n\r\n      THREE.ShaderChunk[\"morphtarget_vertex\"],\r\n      THREE.ShaderChunk[\"skinning_vertex\"],\r\n      THREE.ShaderChunk[\"default_vertex\"],\r\n      THREE.ShaderChunk[\"logdepthbuf_vertex\"],\r\n\r\n      \"\tvViewPosition = -mvPosition.xyz;\",\r\n\r\n      THREE.ShaderChunk[\"worldpos_vertex\"],\r\n      THREE.ShaderChunk[\"envmap_vertex\"],\r\n      THREE.ShaderChunk[\"lights_phong_vertex\"],\r\n      THREE.ShaderChunk[\"shadowmap_vertex\"],\r\n\r\n      \"}\"\r\n\r\n    ].join(\"\\n\"),\r\n\r\n    fragmentShader: [\r\n\r\n      \"#define PHONG\",\r\n\r\n      \"uniform vec3 diffuse;\",\r\n      \"uniform vec3 emissive;\",\r\n      \"uniform vec3 specular;\",\r\n      \"uniform float shininess;\",\r\n      \"uniform float opacity;\",\r\n\r\n      THREE.ShaderChunk[\"common\"],\r\n      THREE.ShaderChunk[\"color_pars_fragment\"],\r\n      THREE.ShaderChunk[\"map_pars_fragment\"],\r\n      THREE.ShaderChunk[\"alphamap_pars_fragment\"],\r\n      THREE.ShaderChunk[\"lightmap_pars_fragment\"],\r\n      THREE.ShaderChunk[\"envmap_pars_fragment\"],\r\n      THREE.ShaderChunk[\"fog_pars_fragment\"],\r\n      THREE.ShaderChunk[\"lights_phong_pars_fragment\"],\r\n      THREE.ShaderChunk[\"shadowmap_pars_fragment\"],\r\n      THREE.ShaderChunk[\"bumpmap_pars_fragment\"],\r\n      THREE.ShaderChunk[\"normalmap_pars_fragment\"],\r\n      THREE.ShaderChunk[\"specularmap_pars_fragment\"],\r\n      THREE.ShaderChunk[\"logdepthbuf_pars_fragment\"],\r\n\r\n      \"void main() {\",\r\n\r\n      \"\tvec3 outgoingLight = vec3( 0.0 );\", // outgoing light does not have an alpha, the surface does\r\n      \"\tvec4 diffuseColor = vec4( diffuse, opacity );\",\r\n\r\n      THREE.ShaderChunk[\"logdepthbuf_fragment\"],\r\n      THREE.ShaderChunk[\"map_fragment\"],\r\n      THREE.ShaderChunk[\"color_fragment\"],\r\n      THREE.ShaderChunk[\"alphamap_fragment\"],\r\n      THREE.ShaderChunk[\"alphatest_fragment\"],\r\n      THREE.ShaderChunk[\"specularmap_fragment\"],\r\n\r\n      THREE.ShaderChunk[\"lights_phong_fragment\"],\r\n\r\n      THREE.ShaderChunk[\"lightmap_fragment\"],\r\n      THREE.ShaderChunk[\"envmap_fragment\"],\r\n      THREE.ShaderChunk[\"shadowmap_fragment\"],\r\n\r\n      THREE.ShaderChunk[\"linear_to_gamma_fragment\"],\r\n\r\n      THREE.ShaderChunk[\"fog_fragment\"],\r\n\r\n      \"\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\", // TODO, this should be pre-multiplied to allow for bright highlights on very transparent objects\r\n\r\n      \"}\"\r\n\r\n    ].join(\"\\n\")\r\n\r\n  },\r\n\r\n  'particle_basic': {\r\n\r\n    uniforms: THREE.UniformsUtils.merge([\r\n\r\n      THREE.UniformsLib[\"particle\"],\r\n      THREE.UniformsLib[\"shadowmap\"]\r\n\r\n    ]),\r\n\r\n    vertexShader: [\r\n\r\n      \"uniform float size;\",\r\n      \"uniform float scale;\",\r\n\r\n      THREE.ShaderChunk[\"common\"],\r\n      THREE.ShaderChunk[\"color_pars_vertex\"],\r\n      THREE.ShaderChunk[\"shadowmap_pars_vertex\"],\r\n      THREE.ShaderChunk[\"logdepthbuf_pars_vertex\"],\r\n\r\n      \"void main() {\",\r\n\r\n      THREE.ShaderChunk[\"color_vertex\"],\r\n\r\n      \"\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\",\r\n\r\n      \"\t#ifdef USE_SIZEATTENUATION\",\r\n      \"\t\tgl_PointSize = size * ( scale / length( mvPosition.xyz ) );\",\r\n      \"\t#else\",\r\n      \"\t\tgl_PointSize = size;\",\r\n      \"\t#endif\",\r\n\r\n      \"\tgl_Position = projectionMatrix * mvPosition;\",\r\n\r\n      THREE.ShaderChunk[\"logdepthbuf_vertex\"],\r\n      THREE.ShaderChunk[\"worldpos_vertex\"],\r\n      THREE.ShaderChunk[\"shadowmap_vertex\"],\r\n\r\n      \"}\"\r\n\r\n    ].join(\"\\n\"),\r\n\r\n    fragmentShader: [\r\n\r\n      \"uniform vec3 psColor;\",\r\n      \"uniform float opacity;\",\r\n\r\n      THREE.ShaderChunk[\"common\"],\r\n      THREE.ShaderChunk[\"color_pars_fragment\"],\r\n      THREE.ShaderChunk[\"map_particle_pars_fragment\"],\r\n      THREE.ShaderChunk[\"fog_pars_fragment\"],\r\n      THREE.ShaderChunk[\"shadowmap_pars_fragment\"],\r\n      THREE.ShaderChunk[\"logdepthbuf_pars_fragment\"],\r\n\r\n      \"void main() {\",\r\n\r\n      \"\tvec3 outgoingLight = vec3( 0.0 );\", // outgoing light does not have an alpha, the surface does\r\n      \"\tvec4 diffuseColor = vec4( psColor, opacity );\",\r\n\r\n      THREE.ShaderChunk[\"logdepthbuf_fragment\"],\r\n      THREE.ShaderChunk[\"map_particle_fragment\"],\r\n      THREE.ShaderChunk[\"color_fragment\"],\r\n      THREE.ShaderChunk[\"alphatest_fragment\"],\r\n\r\n      \"\toutgoingLight = diffuseColor.rgb;\", // simple shader\r\n\r\n      THREE.ShaderChunk[\"shadowmap_fragment\"],\r\n      THREE.ShaderChunk[\"fog_fragment\"],\r\n\r\n      \"\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\", // TODO, this should be pre-multiplied to allow for bright highlights on very transparent objects\r\n\r\n      \"}\"\r\n\r\n    ].join(\"\\n\")\r\n\r\n  },\r\n\r\n  'dashed': {\r\n\r\n    uniforms: THREE.UniformsUtils.merge([\r\n\r\n      THREE.UniformsLib[\"common\"],\r\n      THREE.UniformsLib[\"fog\"],\r\n\r\n      {\r\n        \"scale\": {\r\n          type: \"f\",\r\n          value: 1\r\n        },\r\n        \"dashSize\": {\r\n          type: \"f\",\r\n          value: 1\r\n        },\r\n        \"totalSize\": {\r\n          type: \"f\",\r\n          value: 2\r\n        }\r\n      }\r\n\r\n    ]),\r\n\r\n    vertexShader: [\r\n\r\n      \"uniform float scale;\",\r\n      \"attribute float lineDistance;\",\r\n\r\n      \"varying float vLineDistance;\",\r\n\r\n      THREE.ShaderChunk[\"common\"],\r\n      THREE.ShaderChunk[\"color_pars_vertex\"],\r\n      THREE.ShaderChunk[\"logdepthbuf_pars_vertex\"],\r\n\r\n      \"void main() {\",\r\n\r\n      THREE.ShaderChunk[\"color_vertex\"],\r\n\r\n      \"\tvLineDistance = scale * lineDistance;\",\r\n\r\n      \"\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\",\r\n      \"\tgl_Position = projectionMatrix * mvPosition;\",\r\n\r\n      THREE.ShaderChunk[\"logdepthbuf_vertex\"],\r\n\r\n      \"}\"\r\n\r\n    ].join(\"\\n\"),\r\n\r\n    fragmentShader: [\r\n\r\n      \"uniform vec3 diffuse;\",\r\n      \"uniform float opacity;\",\r\n\r\n      \"uniform float dashSize;\",\r\n      \"uniform float totalSize;\",\r\n\r\n      \"varying float vLineDistance;\",\r\n\r\n      THREE.ShaderChunk[\"common\"],\r\n      THREE.ShaderChunk[\"color_pars_fragment\"],\r\n      THREE.ShaderChunk[\"fog_pars_fragment\"],\r\n      THREE.ShaderChunk[\"logdepthbuf_pars_fragment\"],\r\n\r\n      \"void main() {\",\r\n\r\n      \"\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\",\r\n\r\n      \"\t\tdiscard;\",\r\n\r\n      \"\t}\",\r\n\r\n      \"\tvec3 outgoingLight = vec3( 0.0 );\", // outgoing light does not have an alpha, the surface does\r\n      \"\tvec4 diffuseColor = vec4( diffuse, opacity );\",\r\n\r\n      THREE.ShaderChunk[\"logdepthbuf_fragment\"],\r\n      THREE.ShaderChunk[\"color_fragment\"],\r\n\r\n      \"\toutgoingLight = diffuseColor.rgb;\", // simple shader\r\n\r\n      THREE.ShaderChunk[\"fog_fragment\"],\r\n\r\n      \"\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\", // TODO, this should be pre-multiplied to allow for bright highlights on very transparent objects\r\n\r\n      \"}\"\r\n\r\n    ].join(\"\\n\")\r\n\r\n  },\r\n\r\n  'depth': {\r\n\r\n    uniforms: {\r\n\r\n      \"mNear\": {\r\n        type: \"f\",\r\n        value: 1.0\r\n      },\r\n      \"mFar\": {\r\n        type: \"f\",\r\n        value: 2000.0\r\n      },\r\n      \"opacity\": {\r\n        type: \"f\",\r\n        value: 1.0\r\n      }\r\n\r\n    },\r\n\r\n    vertexShader: [\r\n\r\n      THREE.ShaderChunk[\"common\"],\r\n      THREE.ShaderChunk[\"morphtarget_pars_vertex\"],\r\n      THREE.ShaderChunk[\"logdepthbuf_pars_vertex\"],\r\n\r\n      \"void main() {\",\r\n\r\n      THREE.ShaderChunk[\"morphtarget_vertex\"],\r\n      THREE.ShaderChunk[\"default_vertex\"],\r\n      THREE.ShaderChunk[\"logdepthbuf_vertex\"],\r\n\r\n      \"}\"\r\n\r\n    ].join(\"\\n\"),\r\n\r\n    fragmentShader: [\r\n\r\n      \"uniform float mNear;\",\r\n      \"uniform float mFar;\",\r\n      \"uniform float opacity;\",\r\n\r\n      THREE.ShaderChunk[\"common\"],\r\n      THREE.ShaderChunk[\"logdepthbuf_pars_fragment\"],\r\n\r\n      \"void main() {\",\r\n\r\n      THREE.ShaderChunk[\"logdepthbuf_fragment\"],\r\n\r\n      \"\t#ifdef USE_LOGDEPTHBUF_EXT\",\r\n\r\n      \"\t\tfloat depth = gl_FragDepthEXT / gl_FragCoord.w;\",\r\n\r\n      \"\t#else\",\r\n\r\n      \"\t\tfloat depth = gl_FragCoord.z / gl_FragCoord.w;\",\r\n\r\n      \"\t#endif\",\r\n\r\n      \"\tfloat color = 1.0 - smoothstep( mNear, mFar, depth );\",\r\n      \"\tgl_FragColor = vec4( vec3( color ), opacity );\", // TODO, this should be pre-multiplied to allow for bright highlights on very transparent objects\r\n\r\n      \"}\"\r\n\r\n    ].join(\"\\n\")\r\n\r\n  },\r\n\r\n  'normal': {\r\n\r\n    uniforms: {\r\n\r\n      \"opacity\": {\r\n        type: \"f\",\r\n        value: 1.0\r\n      }\r\n\r\n    },\r\n\r\n    vertexShader: [\r\n\r\n      \"varying vec3 vNormal;\",\r\n\r\n      THREE.ShaderChunk[\"common\"],\r\n      THREE.ShaderChunk[\"morphtarget_pars_vertex\"],\r\n      THREE.ShaderChunk[\"logdepthbuf_pars_vertex\"],\r\n\r\n      \"void main() {\",\r\n\r\n      \"\tvNormal = normalize( normalMatrix * normal );\",\r\n\r\n      THREE.ShaderChunk[\"morphtarget_vertex\"],\r\n      THREE.ShaderChunk[\"default_vertex\"],\r\n      THREE.ShaderChunk[\"logdepthbuf_vertex\"],\r\n\r\n      \"}\"\r\n\r\n    ].join(\"\\n\"),\r\n\r\n    fragmentShader: [\r\n\r\n      \"uniform float opacity;\",\r\n      \"varying vec3 vNormal;\",\r\n\r\n      THREE.ShaderChunk[\"common\"],\r\n      THREE.ShaderChunk[\"logdepthbuf_pars_fragment\"],\r\n\r\n      \"void main() {\",\r\n\r\n      \"\tgl_FragColor = vec4( 0.5 * normalize( vNormal ) + 0.5, opacity );\",\r\n\r\n      THREE.ShaderChunk[\"logdepthbuf_fragment\"],\r\n\r\n      \"}\"\r\n\r\n    ].join(\"\\n\")\r\n\r\n  },\r\n\r\n  /* -------------------------------------------------------------------------\r\n  //\tCube map shader\r\n   ------------------------------------------------------------------------- */\r\n\r\n  'cube': {\r\n\r\n    uniforms: {\r\n      \"tCube\": {\r\n        type: \"t\",\r\n        value: null\r\n      },\r\n      \"tFlip\": {\r\n        type: \"f\",\r\n        value: -1\r\n      }\r\n    },\r\n\r\n    vertexShader: [\r\n\r\n      \"varying vec3 vWorldPosition;\",\r\n\r\n      THREE.ShaderChunk[\"common\"],\r\n      THREE.ShaderChunk[\"logdepthbuf_pars_vertex\"],\r\n\r\n      \"void main() {\",\r\n\r\n      \"\tvWorldPosition = transformDirection( position, modelMatrix );\",\r\n\r\n      \"\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\",\r\n\r\n      THREE.ShaderChunk[\"logdepthbuf_vertex\"],\r\n\r\n      \"}\"\r\n\r\n    ].join(\"\\n\"),\r\n\r\n    fragmentShader: [\r\n\r\n      \"uniform samplerCube tCube;\",\r\n      \"uniform float tFlip;\",\r\n\r\n      \"varying vec3 vWorldPosition;\",\r\n\r\n      THREE.ShaderChunk[\"common\"],\r\n      THREE.ShaderChunk[\"logdepthbuf_pars_fragment\"],\r\n\r\n      \"void main() {\",\r\n\r\n      \"\tgl_FragColor = textureCube( tCube, vec3( tFlip * vWorldPosition.x, vWorldPosition.yz ) );\",\r\n\r\n      THREE.ShaderChunk[\"logdepthbuf_fragment\"],\r\n\r\n      \"}\"\r\n\r\n    ].join(\"\\n\")\r\n\r\n  },\r\n\r\n  /* -------------------------------------------------------------------------\r\n  //\tCube map shader\r\n   ------------------------------------------------------------------------- */\r\n\r\n  'equirect': {\r\n\r\n    uniforms: {\r\n      \"tEquirect\": {\r\n        type: \"t\",\r\n        value: null\r\n      },\r\n      \"tFlip\": {\r\n        type: \"f\",\r\n        value: -1\r\n      }\r\n    },\r\n\r\n    vertexShader: [\r\n\r\n      \"varying vec3 vWorldPosition;\",\r\n\r\n      THREE.ShaderChunk[\"common\"],\r\n      THREE.ShaderChunk[\"logdepthbuf_pars_vertex\"],\r\n\r\n      \"void main() {\",\r\n\r\n      \"\tvWorldPosition = transformDirection( position, modelMatrix );\",\r\n\r\n      \"\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\",\r\n\r\n      THREE.ShaderChunk[\"logdepthbuf_vertex\"],\r\n\r\n      \"}\"\r\n\r\n    ].join(\"\\n\"),\r\n\r\n    fragmentShader: [\r\n\r\n      \"uniform sampler2D tEquirect;\",\r\n      \"uniform float tFlip;\",\r\n\r\n      \"varying vec3 vWorldPosition;\",\r\n\r\n      THREE.ShaderChunk[\"common\"],\r\n      THREE.ShaderChunk[\"logdepthbuf_pars_fragment\"],\r\n\r\n      \"void main() {\",\r\n\r\n      // \"\tgl_FragColor = textureCube( tCube, vec3( tFlip * vWorldPosition.x, vWorldPosition.yz ) );\",\r\n      \"vec3 direction = normalize( vWorldPosition );\",\r\n      \"vec2 sampleUV;\",\r\n      \"sampleUV.y = saturate( tFlip * direction.y * -0.5 + 0.5 );\",\r\n      \"sampleUV.x = atan( direction.z, direction.x ) * RECIPROCAL_PI2 + 0.5;\",\r\n      \"gl_FragColor = texture2D( tEquirect, sampleUV );\",\r\n\r\n      THREE.ShaderChunk[\"logdepthbuf_fragment\"],\r\n\r\n      \"}\"\r\n\r\n    ].join(\"\\n\")\r\n\r\n  },\r\n\r\n  /* Depth encoding into RGBA texture\r\n   *\r\n   * based on SpiderGL shadow map example\r\n   * http://spidergl.org/example.php?id=6\r\n   *\r\n   * originally from\r\n   * http://www.gamedev.net/topic/442138-packing-a-float-into-a-a8r8g8b8-texture-shader/page__whichpage__1%25EF%25BF%25BD\r\n   *\r\n   * see also\r\n   * http://aras-p.info/blog/2009/07/30/encoding-floats-to-rgba-the-final/\r\n   */\r\n\r\n  'depthRGBA': {\r\n\r\n    uniforms: {},\r\n\r\n    vertexShader: [\r\n\r\n      THREE.ShaderChunk[\"common\"],\r\n      THREE.ShaderChunk[\"morphtarget_pars_vertex\"],\r\n      THREE.ShaderChunk[\"skinning_pars_vertex\"],\r\n      THREE.ShaderChunk[\"logdepthbuf_pars_vertex\"],\r\n\r\n      \"void main() {\",\r\n\r\n      THREE.ShaderChunk[\"skinbase_vertex\"],\r\n      THREE.ShaderChunk[\"morphtarget_vertex\"],\r\n      THREE.ShaderChunk[\"skinning_vertex\"],\r\n      THREE.ShaderChunk[\"default_vertex\"],\r\n      THREE.ShaderChunk[\"logdepthbuf_vertex\"],\r\n\r\n      \"}\"\r\n\r\n    ].join(\"\\n\"),\r\n\r\n    fragmentShader: [\r\n\r\n      THREE.ShaderChunk[\"common\"],\r\n      THREE.ShaderChunk[\"logdepthbuf_pars_fragment\"],\r\n\r\n      \"vec4 pack_depth( const in float depth ) {\",\r\n\r\n      \"\tconst vec4 bit_shift = vec4( 256.0 * 256.0 * 256.0, 256.0 * 256.0, 256.0, 1.0 );\",\r\n      \"\tconst vec4 bit_mask = vec4( 0.0, 1.0 / 256.0, 1.0 / 256.0, 1.0 / 256.0 );\",\r\n      \"\tvec4 res = mod( depth * bit_shift * vec4( 255 ), vec4( 256 ) ) / vec4( 255 );\", // \"\tvec4 res = fract( depth * bit_shift );\",\r\n      \"\tres -= res.xxyz * bit_mask;\",\r\n      \"\treturn res;\",\r\n\r\n      \"}\",\r\n\r\n      \"void main() {\",\r\n\r\n      THREE.ShaderChunk[\"logdepthbuf_fragment\"],\r\n\r\n      \"\t#ifdef USE_LOGDEPTHBUF_EXT\",\r\n\r\n      \"\t\tgl_FragData[ 0 ] = pack_depth( gl_FragDepthEXT );\",\r\n\r\n      \"\t#else\",\r\n\r\n      \"\t\tgl_FragData[ 0 ] = pack_depth( gl_FragCoord.z );\",\r\n\r\n      \"\t#endif\",\r\n\r\n      //\"gl_FragData[ 0 ] = pack_depth( gl_FragCoord.z / gl_FragCoord.w );\",\r\n      //\"float z = ( ( gl_FragCoord.z / gl_FragCoord.w ) - 3.0 ) / ( 4000.0 - 3.0 );\",\r\n      //\"gl_FragData[ 0 ] = pack_depth( z );\",\r\n      //\"gl_FragData[ 0 ] = vec4( z, z, z, 1.0 );\",\r\n\r\n      \"}\"\r\n\r\n    ].join(\"\\n\")\r\n\r\n  }\r\n\r\n};\r\n\r\n// File:src/renderers/WebGLRenderer.js\r\n\r\n/**\r\n * @author supereggbert / http://www.paulbrunt.co.uk/\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author alteredq / http://alteredqualia.com/\r\n * @author szimek / https://github.com/szimek/\r\n */\r\n\r\nTHREE.WebGLRenderer = function(parameters) {\r\n\r\n  console.log('THREE.WebGLRenderer', THREE.REVISION);\r\n\r\n  parameters = parameters || {};\r\n\r\n  var _canvas = parameters.canvas !== undefined ? parameters.canvas : document.createElement('canvas'),\r\n    _context = parameters.context !== undefined ? parameters.context : null,\r\n\r\n    pixelRatio = 1,\r\n\r\n    _precision = parameters.precision !== undefined ? parameters.precision : 'highp',\r\n\r\n    _alpha = parameters.alpha !== undefined ? parameters.alpha : false,\r\n    _depth = parameters.depth !== undefined ? parameters.depth : true,\r\n    _stencil = parameters.stencil !== undefined ? parameters.stencil : true,\r\n    _antialias = parameters.antialias !== undefined ? parameters.antialias : false,\r\n    _premultipliedAlpha = parameters.premultipliedAlpha !== undefined ? parameters.premultipliedAlpha : true,\r\n    _preserveDrawingBuffer = parameters.preserveDrawingBuffer !== undefined ? parameters.preserveDrawingBuffer : false,\r\n    _logarithmicDepthBuffer = parameters.logarithmicDepthBuffer !== undefined ? parameters.logarithmicDepthBuffer : false,\r\n\r\n    _clearColor = new THREE.Color(0x000000),\r\n    _clearAlpha = 0;\r\n\r\n  var lights = [];\r\n\r\n  var _webglObjects = {};\r\n  var _webglObjectsImmediate = [];\r\n\r\n  var opaqueObjects = [];\r\n  var transparentObjects = [];\r\n\r\n  var sprites = [];\r\n  var lensFlares = [];\r\n\r\n  // public properties\r\n\r\n  this.domElement = _canvas;\r\n  this.context = null;\r\n\r\n  // clearing\r\n\r\n  this.autoClear = true;\r\n  this.autoClearColor = true;\r\n  this.autoClearDepth = true;\r\n  this.autoClearStencil = true;\r\n\r\n  // scene graph\r\n\r\n  this.sortObjects = true;\r\n\r\n  // physically based shading\r\n\r\n  this.gammaFactor = 2.0; // for backwards compatibility\r\n  this.gammaInput = false;\r\n  this.gammaOutput = false;\r\n\r\n  // shadow map\r\n\r\n  this.shadowMapEnabled = false;\r\n  this.shadowMapType = THREE.PCFShadowMap;\r\n  this.shadowMapCullFace = THREE.CullFaceFront;\r\n  this.shadowMapDebug = false;\r\n  this.shadowMapCascade = false;\r\n\r\n  // morphs\r\n\r\n  this.maxMorphTargets = 8;\r\n  this.maxMorphNormals = 4;\r\n\r\n  // flags\r\n\r\n  this.autoScaleCubemaps = true;\r\n\r\n  // info\r\n\r\n  this.info = {\r\n\r\n    memory: {\r\n\r\n      programs: 0,\r\n      geometries: 0,\r\n      textures: 0\r\n\r\n    },\r\n\r\n    render: {\r\n\r\n      calls: 0,\r\n      vertices: 0,\r\n      faces: 0,\r\n      points: 0\r\n\r\n    }\r\n\r\n  };\r\n\r\n  // internal properties\r\n\r\n  var _this = this,\r\n\r\n    _programs = [],\r\n\r\n    // internal state cache\r\n\r\n    _currentProgram = null,\r\n    _currentFramebuffer = null,\r\n    _currentMaterialId = -1,\r\n    _currentGeometryProgram = '',\r\n    _currentCamera = null,\r\n\r\n    _usedTextureUnits = 0,\r\n\r\n    _viewportX = 0,\r\n    _viewportY = 0,\r\n    _viewportWidth = _canvas.width,\r\n    _viewportHeight = _canvas.height,\r\n    _currentWidth = 0,\r\n    _currentHeight = 0,\r\n\r\n    // frustum\r\n\r\n    _frustum = new THREE.Frustum(),\r\n\r\n    // camera matrices cache\r\n\r\n    _projScreenMatrix = new THREE.Matrix4(),\r\n\r\n    _vector3 = new THREE.Vector3(),\r\n\r\n    // light arrays cache\r\n\r\n    _direction = new THREE.Vector3(),\r\n\r\n    _lightsNeedUpdate = true,\r\n\r\n    _lights = {\r\n\r\n      ambient: [0, 0, 0],\r\n      directional: {\r\n        length: 0,\r\n        colors: [],\r\n        positions: []\r\n      },\r\n      point: {\r\n        length: 0,\r\n        colors: [],\r\n        positions: [],\r\n        distances: [],\r\n        decays: []\r\n      },\r\n      spot: {\r\n        length: 0,\r\n        colors: [],\r\n        positions: [],\r\n        distances: [],\r\n        directions: [],\r\n        anglesCos: [],\r\n        exponents: [],\r\n        decays: []\r\n      },\r\n      hemi: {\r\n        length: 0,\r\n        skyColors: [],\r\n        groundColors: [],\r\n        positions: []\r\n      }\r\n\r\n    };\r\n\r\n  // initialize\r\n\r\n  var _gl;\r\n\r\n  try {\r\n\r\n    var attributes = {\r\n      alpha: _alpha,\r\n      depth: _depth,\r\n      stencil: _stencil,\r\n      antialias: _antialias,\r\n      premultipliedAlpha: _premultipliedAlpha,\r\n      preserveDrawingBuffer: _preserveDrawingBuffer\r\n    };\r\n\r\n    _gl = _context || _canvas.getContext('webgl', attributes) || _canvas.getContext('experimental-webgl', attributes);\r\n\r\n    if (_gl === null) {\r\n\r\n      if (_canvas.getContext('webgl') !== null) {\r\n\r\n        throw 'Error creating WebGL context with your selected attributes.';\r\n\r\n      }\r\n      else {\r\n\r\n        throw 'Error creating WebGL context.';\r\n\r\n      }\r\n\r\n    }\r\n\r\n    _canvas.addEventListener('webglcontextlost', function(event) {\r\n\r\n      event.preventDefault();\r\n\r\n      resetGLState();\r\n      setDefaultGLState();\r\n\r\n      _webglObjects = {};\r\n\r\n    }, false);\r\n\r\n  }\r\n  catch (error) {\r\n\r\n    THREE.error('THREE.WebGLRenderer: ' + error);\r\n\r\n  }\r\n\r\n  var state = new THREE.WebGLState(_gl, paramThreeToGL);\r\n\r\n  if (_gl.getShaderPrecisionFormat === undefined) {\r\n\r\n    _gl.getShaderPrecisionFormat = function() {\r\n\r\n      return {\r\n        'rangeMin': 1,\r\n        'rangeMax': 1,\r\n        'precision': 1\r\n      };\r\n\r\n    }\r\n\r\n  }\r\n\r\n  var extensions = new THREE.WebGLExtensions(_gl);\r\n\r\n  extensions.get('OES_texture_float');\r\n  extensions.get('OES_texture_float_linear');\r\n  extensions.get('OES_texture_half_float');\r\n  extensions.get('OES_texture_half_float_linear');\r\n  extensions.get('OES_standard_derivatives');\r\n\r\n  if (_logarithmicDepthBuffer) {\r\n\r\n    extensions.get('EXT_frag_depth');\r\n\r\n  }\r\n\r\n  //\r\n\r\n  var glClearColor = function(r, g, b, a) {\r\n\r\n    if (_premultipliedAlpha === true) {\r\n\r\n      r *= a;\r\n      g *= a;\r\n      b *= a;\r\n\r\n    }\r\n\r\n    _gl.clearColor(r, g, b, a);\r\n\r\n  };\r\n\r\n  var setDefaultGLState = function() {\r\n\r\n    _gl.clearColor(0, 0, 0, 1);\r\n    _gl.clearDepth(1);\r\n    _gl.clearStencil(0);\r\n\r\n    _gl.enable(_gl.DEPTH_TEST);\r\n    _gl.depthFunc(_gl.LEQUAL);\r\n\r\n    _gl.frontFace(_gl.CCW);\r\n    _gl.cullFace(_gl.BACK);\r\n    _gl.enable(_gl.CULL_FACE);\r\n\r\n    _gl.enable(_gl.BLEND);\r\n    _gl.blendEquation(_gl.FUNC_ADD);\r\n    _gl.blendFunc(_gl.SRC_ALPHA, _gl.ONE_MINUS_SRC_ALPHA);\r\n\r\n    _gl.viewport(_viewportX, _viewportY, _viewportWidth, _viewportHeight);\r\n\r\n    glClearColor(_clearColor.r, _clearColor.g, _clearColor.b, _clearAlpha);\r\n\r\n  };\r\n\r\n  var resetGLState = function() {\r\n\r\n    _currentProgram = null;\r\n    _currentCamera = null;\r\n\r\n    _currentGeometryProgram = '';\r\n    _currentMaterialId = -1;\r\n\r\n    _lightsNeedUpdate = true;\r\n\r\n    state.reset();\r\n\r\n  };\r\n\r\n  setDefaultGLState();\r\n\r\n  this.context = _gl;\r\n  this.state = state;\r\n\r\n  // GPU capabilities\r\n\r\n  var _maxTextures = _gl.getParameter(_gl.MAX_TEXTURE_IMAGE_UNITS);\r\n  var _maxVertexTextures = _gl.getParameter(_gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS);\r\n  var _maxTextureSize = _gl.getParameter(_gl.MAX_TEXTURE_SIZE);\r\n  var _maxCubemapSize = _gl.getParameter(_gl.MAX_CUBE_MAP_TEXTURE_SIZE);\r\n\r\n  var _supportsVertexTextures = _maxVertexTextures > 0;\r\n  var _supportsBoneTextures = _supportsVertexTextures && extensions.get('OES_texture_float');\r\n\r\n  //\r\n\r\n  var _vertexShaderPrecisionHighpFloat = _gl.getShaderPrecisionFormat(_gl.VERTEX_SHADER, _gl.HIGH_FLOAT);\r\n  var _vertexShaderPrecisionMediumpFloat = _gl.getShaderPrecisionFormat(_gl.VERTEX_SHADER, _gl.MEDIUM_FLOAT);\r\n\r\n  var _fragmentShaderPrecisionHighpFloat = _gl.getShaderPrecisionFormat(_gl.FRAGMENT_SHADER, _gl.HIGH_FLOAT);\r\n  var _fragmentShaderPrecisionMediumpFloat = _gl.getShaderPrecisionFormat(_gl.FRAGMENT_SHADER, _gl.MEDIUM_FLOAT);\r\n\r\n  var getCompressedTextureFormats = (function() {\r\n\r\n    var array;\r\n\r\n    return function() {\r\n\r\n      if (array !== undefined) {\r\n\r\n        return array;\r\n\r\n      }\r\n\r\n      array = [];\r\n\r\n      if (extensions.get('WEBGL_compressed_texture_pvrtc') || extensions.get('WEBGL_compressed_texture_s3tc')) {\r\n\r\n        var formats = _gl.getParameter(_gl.COMPRESSED_TEXTURE_FORMATS);\r\n\r\n        for (var i = 0; i < formats.length; i++) {\r\n\r\n          array.push(formats[i]);\r\n\r\n        }\r\n\r\n      }\r\n\r\n      return array;\r\n\r\n    };\r\n\r\n  })();\r\n\r\n  // clamp precision to maximum available\r\n\r\n  var highpAvailable = _vertexShaderPrecisionHighpFloat.precision > 0 && _fragmentShaderPrecisionHighpFloat.precision > 0;\r\n  var mediumpAvailable = _vertexShaderPrecisionMediumpFloat.precision > 0 && _fragmentShaderPrecisionMediumpFloat.precision > 0;\r\n\r\n  if (_precision === 'highp' && !highpAvailable) {\r\n\r\n    if (mediumpAvailable) {\r\n\r\n      _precision = 'mediump';\r\n      THREE.warn('THREE.WebGLRenderer: highp not supported, using mediump.');\r\n\r\n    }\r\n    else {\r\n\r\n      _precision = 'lowp';\r\n      THREE.warn('THREE.WebGLRenderer: highp and mediump not supported, using lowp.');\r\n\r\n    }\r\n\r\n  }\r\n\r\n  if (_precision === 'mediump' && !mediumpAvailable) {\r\n\r\n    _precision = 'lowp';\r\n    THREE.warn('THREE.WebGLRenderer: mediump not supported, using lowp.');\r\n\r\n  }\r\n\r\n  // Plugins\r\n\r\n  var shadowMapPlugin = new THREE.ShadowMapPlugin(this, lights, _webglObjects, _webglObjectsImmediate);\r\n\r\n  var spritePlugin = new THREE.SpritePlugin(this, sprites);\r\n  var lensFlarePlugin = new THREE.LensFlarePlugin(this, lensFlares);\r\n\r\n  // API\r\n\r\n  this.getContext = function() {\r\n\r\n    return _gl;\r\n\r\n  };\r\n\r\n  this.forceContextLoss = function() {\r\n\r\n    extensions.get('WEBGL_lose_context').loseContext();\r\n\r\n  };\r\n\r\n  this.supportsVertexTextures = function() {\r\n\r\n    return _supportsVertexTextures;\r\n\r\n  };\r\n\r\n  this.supportsFloatTextures = function() {\r\n\r\n    return extensions.get('OES_texture_float');\r\n\r\n  };\r\n\r\n  this.supportsHalfFloatTextures = function() {\r\n\r\n    return extensions.get('OES_texture_half_float');\r\n\r\n  };\r\n\r\n  this.supportsStandardDerivatives = function() {\r\n\r\n    return extensions.get('OES_standard_derivatives');\r\n\r\n  };\r\n\r\n  this.supportsCompressedTextureS3TC = function() {\r\n\r\n    return extensions.get('WEBGL_compressed_texture_s3tc');\r\n\r\n  };\r\n\r\n  this.supportsCompressedTexturePVRTC = function() {\r\n\r\n    return extensions.get('WEBGL_compressed_texture_pvrtc');\r\n\r\n  };\r\n\r\n  this.supportsBlendMinMax = function() {\r\n\r\n    return extensions.get('EXT_blend_minmax');\r\n\r\n  };\r\n\r\n  this.getMaxAnisotropy = (function() {\r\n\r\n    var value;\r\n\r\n    return function() {\r\n\r\n      if (value !== undefined) {\r\n\r\n        return value;\r\n\r\n      }\r\n\r\n      var extension = extensions.get('EXT_texture_filter_anisotropic');\r\n\r\n      value = extension !== null ? _gl.getParameter(extension.MAX_TEXTURE_MAX_ANISOTROPY_EXT) : 0;\r\n\r\n      return value;\r\n\r\n    }\r\n\r\n  })();\r\n\r\n  this.getPrecision = function() {\r\n\r\n    return _precision;\r\n\r\n  };\r\n\r\n  this.getPixelRatio = function() {\r\n\r\n    return pixelRatio;\r\n\r\n  };\r\n\r\n  this.setPixelRatio = function(value) {\r\n\r\n    pixelRatio = value;\r\n\r\n  };\r\n\r\n  this.setSize = function(width, height, updateStyle) {\r\n\r\n    _canvas.width = width * pixelRatio;\r\n    _canvas.height = height * pixelRatio;\r\n\r\n    if (updateStyle !== false) {\r\n\r\n      _canvas.style.width = width + 'px';\r\n      _canvas.style.height = height + 'px';\r\n\r\n    }\r\n\r\n    this.setViewport(0, 0, width, height);\r\n\r\n  };\r\n\r\n  this.setViewport = function(x, y, width, height) {\r\n\r\n    _viewportX = x * pixelRatio;\r\n    _viewportY = y * pixelRatio;\r\n\r\n    _viewportWidth = width * pixelRatio;\r\n    _viewportHeight = height * pixelRatio;\r\n\r\n    _gl.viewport(_viewportX, _viewportY, _viewportWidth, _viewportHeight);\r\n\r\n  };\r\n\r\n  this.setScissor = function(x, y, width, height) {\r\n\r\n    _gl.scissor(\r\n      x * pixelRatio,\r\n      y * pixelRatio,\r\n      width * pixelRatio,\r\n      height * pixelRatio\r\n    );\r\n\r\n  };\r\n\r\n  this.enableScissorTest = function(enable) {\r\n\r\n    enable ? _gl.enable(_gl.SCISSOR_TEST) : _gl.disable(_gl.SCISSOR_TEST);\r\n\r\n  };\r\n\r\n  // Clearing\r\n\r\n  this.getClearColor = function() {\r\n\r\n    return _clearColor;\r\n\r\n  };\r\n\r\n  this.setClearColor = function(color, alpha) {\r\n\r\n    _clearColor.set(color);\r\n\r\n    _clearAlpha = alpha !== undefined ? alpha : 1;\r\n\r\n    glClearColor(_clearColor.r, _clearColor.g, _clearColor.b, _clearAlpha);\r\n\r\n  };\r\n\r\n  this.getClearAlpha = function() {\r\n\r\n    return _clearAlpha;\r\n\r\n  };\r\n\r\n  this.setClearAlpha = function(alpha) {\r\n\r\n    _clearAlpha = alpha;\r\n\r\n    glClearColor(_clearColor.r, _clearColor.g, _clearColor.b, _clearAlpha);\r\n\r\n  };\r\n\r\n  this.clear = function(color, depth, stencil) {\r\n\r\n    var bits = 0;\r\n\r\n    if (color === undefined || color) bits |= _gl.COLOR_BUFFER_BIT;\r\n    if (depth === undefined || depth) bits |= _gl.DEPTH_BUFFER_BIT;\r\n    if (stencil === undefined || stencil) bits |= _gl.STENCIL_BUFFER_BIT;\r\n\r\n    _gl.clear(bits);\r\n\r\n  };\r\n\r\n  this.clearColor = function() {\r\n\r\n    _gl.clear(_gl.COLOR_BUFFER_BIT);\r\n\r\n  };\r\n\r\n  this.clearDepth = function() {\r\n\r\n    _gl.clear(_gl.DEPTH_BUFFER_BIT);\r\n\r\n  };\r\n\r\n  this.clearStencil = function() {\r\n\r\n    _gl.clear(_gl.STENCIL_BUFFER_BIT);\r\n\r\n  };\r\n\r\n  this.clearTarget = function(renderTarget, color, depth, stencil) {\r\n\r\n    this.setRenderTarget(renderTarget);\r\n    this.clear(color, depth, stencil);\r\n\r\n  };\r\n\r\n  // Reset\r\n\r\n  this.resetGLState = resetGLState;\r\n\r\n  // Buffer allocation\r\n\r\n  function createParticleBuffers(geometry) {\r\n\r\n    geometry.__webglVertexBuffer = _gl.createBuffer();\r\n    geometry.__webglColorBuffer = _gl.createBuffer();\r\n\r\n    _this.info.memory.geometries++;\r\n\r\n  };\r\n\r\n  function createLineBuffers(geometry) {\r\n\r\n    geometry.__webglVertexBuffer = _gl.createBuffer();\r\n    geometry.__webglColorBuffer = _gl.createBuffer();\r\n    geometry.__webglLineDistanceBuffer = _gl.createBuffer();\r\n\r\n    _this.info.memory.geometries++;\r\n\r\n  };\r\n\r\n  function createMeshBuffers(geometryGroup) {\r\n\r\n    geometryGroup.__webglVertexBuffer = _gl.createBuffer();\r\n    geometryGroup.__webglNormalBuffer = _gl.createBuffer();\r\n    geometryGroup.__webglTangentBuffer = _gl.createBuffer();\r\n    geometryGroup.__webglColorBuffer = _gl.createBuffer();\r\n    geometryGroup.__webglUVBuffer = _gl.createBuffer();\r\n    geometryGroup.__webglUV2Buffer = _gl.createBuffer();\r\n\r\n    geometryGroup.__webglSkinIndicesBuffer = _gl.createBuffer();\r\n    geometryGroup.__webglSkinWeightsBuffer = _gl.createBuffer();\r\n\r\n    geometryGroup.__webglFaceBuffer = _gl.createBuffer();\r\n    geometryGroup.__webglLineBuffer = _gl.createBuffer();\r\n\r\n    var numMorphTargets = geometryGroup.numMorphTargets;\r\n\r\n    if (numMorphTargets) {\r\n\r\n      geometryGroup.__webglMorphTargetsBuffers = [];\r\n\r\n      for (var m = 0, ml = numMorphTargets; m < ml; m++) {\r\n\r\n        geometryGroup.__webglMorphTargetsBuffers.push(_gl.createBuffer());\r\n\r\n      }\r\n\r\n    }\r\n\r\n    var numMorphNormals = geometryGroup.numMorphNormals;\r\n\r\n    if (numMorphNormals) {\r\n\r\n      geometryGroup.__webglMorphNormalsBuffers = [];\r\n\r\n      for (var m = 0, ml = numMorphNormals; m < ml; m++) {\r\n\r\n        geometryGroup.__webglMorphNormalsBuffers.push(_gl.createBuffer());\r\n\r\n      }\r\n\r\n    }\r\n\r\n    _this.info.memory.geometries++;\r\n\r\n  };\r\n\r\n  // Events\r\n\r\n  var onObjectRemoved = function(event) {\r\n\r\n    var object = event.target;\r\n\r\n    object.traverse(function(child) {\r\n\r\n      child.removeEventListener('remove', onObjectRemoved);\r\n\r\n      removeObject(child);\r\n\r\n    });\r\n\r\n  };\r\n\r\n  var onGeometryDispose = function(event) {\r\n\r\n    var geometry = event.target;\r\n\r\n    geometry.removeEventListener('dispose', onGeometryDispose);\r\n\r\n    deallocateGeometry(geometry);\r\n\r\n  };\r\n\r\n  var onTextureDispose = function(event) {\r\n\r\n    var texture = event.target;\r\n\r\n    texture.removeEventListener('dispose', onTextureDispose);\r\n\r\n    deallocateTexture(texture);\r\n\r\n    _this.info.memory.textures--;\r\n\r\n\r\n  };\r\n\r\n  var onRenderTargetDispose = function(event) {\r\n\r\n    var renderTarget = event.target;\r\n\r\n    renderTarget.removeEventListener('dispose', onRenderTargetDispose);\r\n\r\n    deallocateRenderTarget(renderTarget);\r\n\r\n    _this.info.memory.textures--;\r\n\r\n  };\r\n\r\n  var onMaterialDispose = function(event) {\r\n\r\n    var material = event.target;\r\n\r\n    material.removeEventListener('dispose', onMaterialDispose);\r\n\r\n    deallocateMaterial(material);\r\n\r\n  };\r\n\r\n  // Buffer deallocation\r\n\r\n  var deleteBuffers = function(geometry) {\r\n\r\n    var buffers = [\r\n      '__webglVertexBuffer',\r\n      '__webglNormalBuffer',\r\n      '__webglTangentBuffer',\r\n      '__webglColorBuffer',\r\n      '__webglUVBuffer',\r\n      '__webglUV2Buffer',\r\n\r\n      '__webglSkinIndicesBuffer',\r\n      '__webglSkinWeightsBuffer',\r\n\r\n      '__webglFaceBuffer',\r\n      '__webglLineBuffer',\r\n\r\n      '__webglLineDistanceBuffer'\r\n    ];\r\n\r\n    for (var i = 0, l = buffers.length; i < l; i++) {\r\n\r\n      var name = buffers[i];\r\n\r\n      if (geometry[name] !== undefined) {\r\n\r\n        _gl.deleteBuffer(geometry[name]);\r\n\r\n        delete geometry[name];\r\n\r\n      }\r\n\r\n    }\r\n\r\n    // custom attributes\r\n\r\n    if (geometry.__webglCustomAttributesList !== undefined) {\r\n\r\n      for (var name in geometry.__webglCustomAttributesList) {\r\n\r\n        _gl.deleteBuffer(geometry.__webglCustomAttributesList[name].buffer);\r\n\r\n      }\r\n\r\n      delete geometry.__webglCustomAttributesList;\r\n\r\n    }\r\n\r\n    _this.info.memory.geometries--;\r\n\r\n  };\r\n\r\n  var deallocateGeometry = function(geometry) {\r\n\r\n    delete geometry.__webglInit;\r\n\r\n    if (geometry instanceof THREE.BufferGeometry) {\r\n\r\n      for (var name in geometry.attributes) {\r\n\r\n        var attribute = geometry.attributes[name];\r\n\r\n        if (attribute.buffer !== undefined) {\r\n\r\n          _gl.deleteBuffer(attribute.buffer);\r\n\r\n          delete attribute.buffer;\r\n\r\n        }\r\n\r\n      }\r\n\r\n      _this.info.memory.geometries--;\r\n\r\n    }\r\n    else {\r\n\r\n      var geometryGroupsList = geometryGroups[geometry.id];\r\n\r\n      if (geometryGroupsList !== undefined) {\r\n\r\n        for (var i = 0, l = geometryGroupsList.length; i < l; i++) {\r\n\r\n          var geometryGroup = geometryGroupsList[i];\r\n\r\n          if (geometryGroup.numMorphTargets !== undefined) {\r\n\r\n            for (var m = 0, ml = geometryGroup.numMorphTargets; m < ml; m++) {\r\n\r\n              _gl.deleteBuffer(geometryGroup.__webglMorphTargetsBuffers[m]);\r\n\r\n            }\r\n\r\n            delete geometryGroup.__webglMorphTargetsBuffers;\r\n\r\n          }\r\n\r\n          if (geometryGroup.numMorphNormals !== undefined) {\r\n\r\n            for (var m = 0, ml = geometryGroup.numMorphNormals; m < ml; m++) {\r\n\r\n              _gl.deleteBuffer(geometryGroup.__webglMorphNormalsBuffers[m]);\r\n\r\n            }\r\n\r\n            delete geometryGroup.__webglMorphNormalsBuffers;\r\n\r\n          }\r\n\r\n          deleteBuffers(geometryGroup);\r\n\r\n        }\r\n\r\n        delete geometryGroups[geometry.id];\r\n\r\n      }\r\n      else {\r\n\r\n        deleteBuffers(geometry);\r\n\r\n      }\r\n\r\n    }\r\n\r\n    // TOFIX: Workaround for deleted geometry being currently bound\r\n\r\n    _currentGeometryProgram = '';\r\n\r\n  };\r\n\r\n  var deallocateTexture = function(texture) {\r\n\r\n    if (texture.image && texture.image.__webglTextureCube) {\r\n\r\n      // cube texture\r\n\r\n      _gl.deleteTexture(texture.image.__webglTextureCube);\r\n\r\n      delete texture.image.__webglTextureCube;\r\n\r\n    }\r\n    else {\r\n\r\n      // 2D texture\r\n\r\n      if (texture.__webglInit === undefined) return;\r\n\r\n      _gl.deleteTexture(texture.__webglTexture);\r\n\r\n      delete texture.__webglTexture;\r\n      delete texture.__webglInit;\r\n\r\n    }\r\n\r\n  };\r\n\r\n  var deallocateRenderTarget = function(renderTarget) {\r\n\r\n    if (!renderTarget || renderTarget.__webglTexture === undefined) return;\r\n\r\n    _gl.deleteTexture(renderTarget.__webglTexture);\r\n\r\n    delete renderTarget.__webglTexture;\r\n\r\n    if (renderTarget instanceof THREE.WebGLRenderTargetCube) {\r\n\r\n      for (var i = 0; i < 6; i++) {\r\n\r\n        _gl.deleteFramebuffer(renderTarget.__webglFramebuffer[i]);\r\n        _gl.deleteRenderbuffer(renderTarget.__webglRenderbuffer[i]);\r\n\r\n      }\r\n\r\n    }\r\n    else {\r\n\r\n      _gl.deleteFramebuffer(renderTarget.__webglFramebuffer);\r\n      _gl.deleteRenderbuffer(renderTarget.__webglRenderbuffer);\r\n\r\n    }\r\n\r\n    delete renderTarget.__webglFramebuffer;\r\n    delete renderTarget.__webglRenderbuffer;\r\n\r\n  };\r\n\r\n  var deallocateMaterial = function(material) {\r\n\r\n    var program = material.program.program;\r\n\r\n    if (program === undefined) return;\r\n\r\n    material.program = undefined;\r\n\r\n    // only deallocate GL program if this was the last use of shared program\r\n    // assumed there is only single copy of any program in the _programs list\r\n    // (that's how it's constructed)\r\n\r\n    var i, il, programInfo;\r\n    var deleteProgram = false;\r\n\r\n    for (i = 0, il = _programs.length; i < il; i++) {\r\n\r\n      programInfo = _programs[i];\r\n\r\n      if (programInfo.program === program) {\r\n\r\n        programInfo.usedTimes--;\r\n\r\n        if (programInfo.usedTimes === 0) {\r\n\r\n          deleteProgram = true;\r\n\r\n        }\r\n\r\n        break;\r\n\r\n      }\r\n\r\n    }\r\n\r\n    if (deleteProgram === true) {\r\n\r\n      // avoid using array.splice, this is costlier than creating new array from scratch\r\n\r\n      var newPrograms = [];\r\n\r\n      for (i = 0, il = _programs.length; i < il; i++) {\r\n\r\n        programInfo = _programs[i];\r\n\r\n        if (programInfo.program !== program) {\r\n\r\n          newPrograms.push(programInfo);\r\n\r\n        }\r\n\r\n      }\r\n\r\n      _programs = newPrograms;\r\n\r\n      _gl.deleteProgram(program);\r\n\r\n      _this.info.memory.programs--;\r\n\r\n    }\r\n\r\n  };\r\n\r\n  // Buffer initialization\r\n\r\n  function initCustomAttributes(object) {\r\n\r\n    var geometry = object.geometry;\r\n    var material = object.material;\r\n\r\n    var nvertices = geometry.vertices.length;\r\n\r\n    if (material.attributes) {\r\n\r\n      if (geometry.__webglCustomAttributesList === undefined) {\r\n\r\n        geometry.__webglCustomAttributesList = [];\r\n\r\n      }\r\n\r\n      for (var name in material.attributes) {\r\n\r\n        var attribute = material.attributes[name];\r\n\r\n        if (!attribute.__webglInitialized || attribute.createUniqueBuffers) {\r\n\r\n          attribute.__webglInitialized = true;\r\n\r\n          var size = 1; // \"f\" and \"i\"\r\n\r\n          if (attribute.type === 'v2') size = 2;\r\n          else if (attribute.type === 'v3') size = 3;\r\n          else if (attribute.type === 'v4') size = 4;\r\n          else if (attribute.type === 'c') size = 3;\r\n\r\n          attribute.size = size;\r\n\r\n          attribute.array = new Float32Array(nvertices * size);\r\n\r\n          attribute.buffer = _gl.createBuffer();\r\n          attribute.buffer.belongsToAttribute = name;\r\n\r\n          attribute.needsUpdate = true;\r\n\r\n        }\r\n\r\n        geometry.__webglCustomAttributesList.push(attribute);\r\n\r\n      }\r\n\r\n    }\r\n\r\n  };\r\n\r\n  function initParticleBuffers(geometry, object) {\r\n\r\n    var nvertices = geometry.vertices.length;\r\n\r\n    geometry.__vertexArray = new Float32Array(nvertices * 3);\r\n    geometry.__colorArray = new Float32Array(nvertices * 3);\r\n\r\n    geometry.__webglParticleCount = nvertices;\r\n\r\n    initCustomAttributes(object);\r\n\r\n  };\r\n\r\n  function initLineBuffers(geometry, object) {\r\n\r\n    var nvertices = geometry.vertices.length;\r\n\r\n    geometry.__vertexArray = new Float32Array(nvertices * 3);\r\n    geometry.__colorArray = new Float32Array(nvertices * 3);\r\n    geometry.__lineDistanceArray = new Float32Array(nvertices * 1);\r\n\r\n    geometry.__webglLineCount = nvertices;\r\n\r\n    initCustomAttributes(object);\r\n\r\n  };\r\n\r\n  function initMeshBuffers(geometryGroup, object) {\r\n\r\n    var geometry = object.geometry,\r\n      faces3 = geometryGroup.faces3,\r\n\r\n      nvertices = faces3.length * 3,\r\n      ntris = faces3.length * 1,\r\n      nlines = faces3.length * 3,\r\n\r\n      material = getBufferMaterial(object, geometryGroup);\r\n\r\n    geometryGroup.__vertexArray = new Float32Array(nvertices * 3);\r\n    geometryGroup.__normalArray = new Float32Array(nvertices * 3);\r\n    geometryGroup.__colorArray = new Float32Array(nvertices * 3);\r\n    geometryGroup.__uvArray = new Float32Array(nvertices * 2);\r\n\r\n    if (geometry.faceVertexUvs.length > 1) {\r\n\r\n      geometryGroup.__uv2Array = new Float32Array(nvertices * 2);\r\n\r\n    }\r\n\r\n    if (geometry.hasTangents) {\r\n\r\n      geometryGroup.__tangentArray = new Float32Array(nvertices * 4);\r\n\r\n    }\r\n\r\n    if (object.geometry.skinWeights.length && object.geometry.skinIndices.length) {\r\n\r\n      geometryGroup.__skinIndexArray = new Float32Array(nvertices * 4);\r\n      geometryGroup.__skinWeightArray = new Float32Array(nvertices * 4);\r\n\r\n    }\r\n\r\n    var UintArray = extensions.get('OES_element_index_uint') !== null && ntris > 21845 ? Uint32Array : Uint16Array; // 65535 / 3\r\n\r\n    geometryGroup.__typeArray = UintArray;\r\n    geometryGroup.__faceArray = new UintArray(ntris * 3);\r\n    geometryGroup.__lineArray = new UintArray(nlines * 2);\r\n\r\n    var numMorphTargets = geometryGroup.numMorphTargets;\r\n\r\n    if (numMorphTargets) {\r\n\r\n      geometryGroup.__morphTargetsArrays = [];\r\n\r\n      for (var m = 0, ml = numMorphTargets; m < ml; m++) {\r\n\r\n        geometryGroup.__morphTargetsArrays.push(new Float32Array(nvertices * 3));\r\n\r\n      }\r\n\r\n    }\r\n\r\n    var numMorphNormals = geometryGroup.numMorphNormals;\r\n\r\n    if (numMorphNormals) {\r\n\r\n      geometryGroup.__morphNormalsArrays = [];\r\n\r\n      for (var m = 0, ml = numMorphNormals; m < ml; m++) {\r\n\r\n        geometryGroup.__morphNormalsArrays.push(new Float32Array(nvertices * 3));\r\n\r\n      }\r\n\r\n    }\r\n\r\n    geometryGroup.__webglFaceCount = ntris * 3;\r\n    geometryGroup.__webglLineCount = nlines * 2;\r\n\r\n\r\n    // custom attributes\r\n\r\n    if (material.attributes) {\r\n\r\n      if (geometryGroup.__webglCustomAttributesList === undefined) {\r\n\r\n        geometryGroup.__webglCustomAttributesList = [];\r\n\r\n      }\r\n\r\n      for (var name in material.attributes) {\r\n\r\n        // Do a shallow copy of the attribute object so different geometryGroup chunks use different\r\n        // attribute buffers which are correctly indexed in the setMeshBuffers function\r\n\r\n        var originalAttribute = material.attributes[name];\r\n\r\n        var attribute = {};\r\n\r\n        for (var property in originalAttribute) {\r\n\r\n          attribute[property] = originalAttribute[property];\r\n\r\n        }\r\n\r\n        if (!attribute.__webglInitialized || attribute.createUniqueBuffers) {\r\n\r\n          attribute.__webglInitialized = true;\r\n\r\n          var size = 1; // \"f\" and \"i\"\r\n\r\n          if (attribute.type === 'v2') size = 2;\r\n          else if (attribute.type === 'v3') size = 3;\r\n          else if (attribute.type === 'v4') size = 4;\r\n          else if (attribute.type === 'c') size = 3;\r\n\r\n          attribute.size = size;\r\n\r\n          attribute.array = new Float32Array(nvertices * size);\r\n\r\n          attribute.buffer = _gl.createBuffer();\r\n          attribute.buffer.belongsToAttribute = name;\r\n\r\n          originalAttribute.needsUpdate = true;\r\n          attribute.__original = originalAttribute;\r\n\r\n        }\r\n\r\n        geometryGroup.__webglCustomAttributesList.push(attribute);\r\n\r\n      }\r\n\r\n    }\r\n\r\n    geometryGroup.__inittedArrays = true;\r\n\r\n  };\r\n\r\n  function getBufferMaterial(object, geometryGroup) {\r\n\r\n    return object.material instanceof THREE.MeshFaceMaterial ? object.material.materials[geometryGroup.materialIndex] : object.material;\r\n\r\n  }\r\n\r\n  function materialNeedsFaceNormals(material) {\r\n\r\n    return material instanceof THREE.MeshPhongMaterial === false && material.shading === THREE.FlatShading;\r\n\r\n  }\r\n\r\n  // Buffer setting\r\n\r\n  function setParticleBuffers(geometry, hint, object) {\r\n\r\n    var v, c, vertex, offset, color,\r\n\r\n      vertices = geometry.vertices,\r\n      vl = vertices.length,\r\n\r\n      colors = geometry.colors,\r\n      cl = colors.length,\r\n\r\n      vertexArray = geometry.__vertexArray,\r\n      colorArray = geometry.__colorArray,\r\n\r\n      dirtyVertices = geometry.verticesNeedUpdate,\r\n      dirtyColors = geometry.colorsNeedUpdate,\r\n\r\n      customAttributes = geometry.__webglCustomAttributesList,\r\n      i, il,\r\n      ca, cal, value,\r\n      customAttribute;\r\n\r\n    if (dirtyVertices) {\r\n\r\n      for (v = 0; v < vl; v++) {\r\n\r\n        vertex = vertices[v];\r\n\r\n        offset = v * 3;\r\n\r\n        vertexArray[offset] = vertex.x;\r\n        vertexArray[offset + 1] = vertex.y;\r\n        vertexArray[offset + 2] = vertex.z;\r\n\r\n      }\r\n\r\n      _gl.bindBuffer(_gl.ARRAY_BUFFER, geometry.__webglVertexBuffer);\r\n      _gl.bufferData(_gl.ARRAY_BUFFER, vertexArray, hint);\r\n\r\n    }\r\n\r\n    if (dirtyColors) {\r\n\r\n      for (c = 0; c < cl; c++) {\r\n\r\n        color = colors[c];\r\n\r\n        offset = c * 3;\r\n\r\n        colorArray[offset] = color.r;\r\n        colorArray[offset + 1] = color.g;\r\n        colorArray[offset + 2] = color.b;\r\n\r\n      }\r\n\r\n      _gl.bindBuffer(_gl.ARRAY_BUFFER, geometry.__webglColorBuffer);\r\n      _gl.bufferData(_gl.ARRAY_BUFFER, colorArray, hint);\r\n\r\n    }\r\n\r\n    if (customAttributes) {\r\n\r\n      for (i = 0, il = customAttributes.length; i < il; i++) {\r\n\r\n        customAttribute = customAttributes[i];\r\n\r\n        if (customAttribute.needsUpdate && (customAttribute.boundTo === undefined || customAttribute.boundTo === 'vertices')) {\r\n\r\n          cal = customAttribute.value.length;\r\n\r\n          offset = 0;\r\n\r\n          if (customAttribute.size === 1) {\r\n\r\n            for (ca = 0; ca < cal; ca++) {\r\n\r\n              customAttribute.array[ca] = customAttribute.value[ca];\r\n\r\n            }\r\n\r\n          }\r\n          else if (customAttribute.size === 2) {\r\n\r\n            for (ca = 0; ca < cal; ca++) {\r\n\r\n              value = customAttribute.value[ca];\r\n\r\n              customAttribute.array[offset] = value.x;\r\n              customAttribute.array[offset + 1] = value.y;\r\n\r\n              offset += 2;\r\n\r\n            }\r\n\r\n          }\r\n          else if (customAttribute.size === 3) {\r\n\r\n            if (customAttribute.type === 'c') {\r\n\r\n              for (ca = 0; ca < cal; ca++) {\r\n\r\n                value = customAttribute.value[ca];\r\n\r\n                customAttribute.array[offset] = value.r;\r\n                customAttribute.array[offset + 1] = value.g;\r\n                customAttribute.array[offset + 2] = value.b;\r\n\r\n                offset += 3;\r\n\r\n              }\r\n\r\n            }\r\n            else {\r\n\r\n              for (ca = 0; ca < cal; ca++) {\r\n\r\n                value = customAttribute.value[ca];\r\n\r\n                customAttribute.array[offset] = value.x;\r\n                customAttribute.array[offset + 1] = value.y;\r\n                customAttribute.array[offset + 2] = value.z;\r\n\r\n                offset += 3;\r\n\r\n              }\r\n\r\n            }\r\n\r\n          }\r\n          else if (customAttribute.size === 4) {\r\n\r\n            for (ca = 0; ca < cal; ca++) {\r\n\r\n              value = customAttribute.value[ca];\r\n\r\n              customAttribute.array[offset] = value.x;\r\n              customAttribute.array[offset + 1] = value.y;\r\n              customAttribute.array[offset + 2] = value.z;\r\n              customAttribute.array[offset + 3] = value.w;\r\n\r\n              offset += 4;\r\n\r\n            }\r\n\r\n          }\r\n\r\n        }\r\n\r\n        _gl.bindBuffer(_gl.ARRAY_BUFFER, customAttribute.buffer);\r\n        _gl.bufferData(_gl.ARRAY_BUFFER, customAttribute.array, hint);\r\n\r\n        customAttribute.needsUpdate = false;\r\n\r\n      }\r\n\r\n    }\r\n\r\n  }\r\n\r\n  function setLineBuffers(geometry, hint) {\r\n\r\n    var v, c, d, vertex, offset, color,\r\n\r\n      vertices = geometry.vertices,\r\n      colors = geometry.colors,\r\n      lineDistances = geometry.lineDistances,\r\n\r\n      vl = vertices.length,\r\n      cl = colors.length,\r\n      dl = lineDistances.length,\r\n\r\n      vertexArray = geometry.__vertexArray,\r\n      colorArray = geometry.__colorArray,\r\n      lineDistanceArray = geometry.__lineDistanceArray,\r\n\r\n      dirtyVertices = geometry.verticesNeedUpdate,\r\n      dirtyColors = geometry.colorsNeedUpdate,\r\n      dirtyLineDistances = geometry.lineDistancesNeedUpdate,\r\n\r\n      customAttributes = geometry.__webglCustomAttributesList,\r\n\r\n      i, il,\r\n      ca, cal, value,\r\n      customAttribute;\r\n\r\n    if (dirtyVertices) {\r\n\r\n      for (v = 0; v < vl; v++) {\r\n\r\n        vertex = vertices[v];\r\n\r\n        offset = v * 3;\r\n\r\n        vertexArray[offset] = vertex.x;\r\n        vertexArray[offset + 1] = vertex.y;\r\n        vertexArray[offset + 2] = vertex.z;\r\n\r\n      }\r\n\r\n      _gl.bindBuffer(_gl.ARRAY_BUFFER, geometry.__webglVertexBuffer);\r\n      _gl.bufferData(_gl.ARRAY_BUFFER, vertexArray, hint);\r\n\r\n    }\r\n\r\n    if (dirtyColors) {\r\n\r\n      for (c = 0; c < cl; c++) {\r\n\r\n        color = colors[c];\r\n\r\n        offset = c * 3;\r\n\r\n        colorArray[offset] = color.r;\r\n        colorArray[offset + 1] = color.g;\r\n        colorArray[offset + 2] = color.b;\r\n\r\n      }\r\n\r\n      _gl.bindBuffer(_gl.ARRAY_BUFFER, geometry.__webglColorBuffer);\r\n      _gl.bufferData(_gl.ARRAY_BUFFER, colorArray, hint);\r\n\r\n    }\r\n\r\n    if (dirtyLineDistances) {\r\n\r\n      for (d = 0; d < dl; d++) {\r\n\r\n        lineDistanceArray[d] = lineDistances[d];\r\n\r\n      }\r\n\r\n      _gl.bindBuffer(_gl.ARRAY_BUFFER, geometry.__webglLineDistanceBuffer);\r\n      _gl.bufferData(_gl.ARRAY_BUFFER, lineDistanceArray, hint);\r\n\r\n    }\r\n\r\n    if (customAttributes) {\r\n\r\n      for (i = 0, il = customAttributes.length; i < il; i++) {\r\n\r\n        customAttribute = customAttributes[i];\r\n\r\n        if (customAttribute.needsUpdate && (customAttribute.boundTo === undefined || customAttribute.boundTo === 'vertices')) {\r\n\r\n          offset = 0;\r\n\r\n          cal = customAttribute.value.length;\r\n\r\n          if (customAttribute.size === 1) {\r\n\r\n            for (ca = 0; ca < cal; ca++) {\r\n\r\n              customAttribute.array[ca] = customAttribute.value[ca];\r\n\r\n            }\r\n\r\n          }\r\n          else if (customAttribute.size === 2) {\r\n\r\n            for (ca = 0; ca < cal; ca++) {\r\n\r\n              value = customAttribute.value[ca];\r\n\r\n              customAttribute.array[offset] = value.x;\r\n              customAttribute.array[offset + 1] = value.y;\r\n\r\n              offset += 2;\r\n\r\n            }\r\n\r\n          }\r\n          else if (customAttribute.size === 3) {\r\n\r\n            if (customAttribute.type === 'c') {\r\n\r\n              for (ca = 0; ca < cal; ca++) {\r\n\r\n                value = customAttribute.value[ca];\r\n\r\n                customAttribute.array[offset] = value.r;\r\n                customAttribute.array[offset + 1] = value.g;\r\n                customAttribute.array[offset + 2] = value.b;\r\n\r\n                offset += 3;\r\n\r\n              }\r\n\r\n            }\r\n            else {\r\n\r\n              for (ca = 0; ca < cal; ca++) {\r\n\r\n                value = customAttribute.value[ca];\r\n\r\n                customAttribute.array[offset] = value.x;\r\n                customAttribute.array[offset + 1] = value.y;\r\n                customAttribute.array[offset + 2] = value.z;\r\n\r\n                offset += 3;\r\n\r\n              }\r\n\r\n            }\r\n\r\n          }\r\n          else if (customAttribute.size === 4) {\r\n\r\n            for (ca = 0; ca < cal; ca++) {\r\n\r\n              value = customAttribute.value[ca];\r\n\r\n              customAttribute.array[offset] = value.x;\r\n              customAttribute.array[offset + 1] = value.y;\r\n              customAttribute.array[offset + 2] = value.z;\r\n              customAttribute.array[offset + 3] = value.w;\r\n\r\n              offset += 4;\r\n\r\n            }\r\n\r\n          }\r\n\r\n          _gl.bindBuffer(_gl.ARRAY_BUFFER, customAttribute.buffer);\r\n          _gl.bufferData(_gl.ARRAY_BUFFER, customAttribute.array, hint);\r\n\r\n          customAttribute.needsUpdate = false;\r\n\r\n        }\r\n\r\n      }\r\n\r\n    }\r\n\r\n  }\r\n\r\n  function setMeshBuffers(geometryGroup, object, hint, dispose, material) {\r\n\r\n    if (!geometryGroup.__inittedArrays) {\r\n\r\n      return;\r\n\r\n    }\r\n\r\n    var needsFaceNormals = materialNeedsFaceNormals(material);\r\n\r\n    var f, fl, fi, face,\r\n      vertexNormals, faceNormal,\r\n      vertexColors, faceColor,\r\n      vertexTangents,\r\n      uv, uv2, v1, v2, v3, t1, t2, t3, n1, n2, n3,\r\n      c1, c2, c3,\r\n      sw1, sw2, sw3,\r\n      si1, si2, si3,\r\n      i, il,\r\n      vn, uvi, uv2i,\r\n      vk, vkl, vka,\r\n      nka, chf, faceVertexNormals,\r\n\r\n      vertexIndex = 0,\r\n\r\n      offset = 0,\r\n      offset_uv = 0,\r\n      offset_uv2 = 0,\r\n      offset_face = 0,\r\n      offset_normal = 0,\r\n      offset_tangent = 0,\r\n      offset_line = 0,\r\n      offset_color = 0,\r\n      offset_skin = 0,\r\n      offset_morphTarget = 0,\r\n      offset_custom = 0,\r\n\r\n      value,\r\n\r\n      vertexArray = geometryGroup.__vertexArray,\r\n      uvArray = geometryGroup.__uvArray,\r\n      uv2Array = geometryGroup.__uv2Array,\r\n      normalArray = geometryGroup.__normalArray,\r\n      tangentArray = geometryGroup.__tangentArray,\r\n      colorArray = geometryGroup.__colorArray,\r\n\r\n      skinIndexArray = geometryGroup.__skinIndexArray,\r\n      skinWeightArray = geometryGroup.__skinWeightArray,\r\n\r\n      morphTargetsArrays = geometryGroup.__morphTargetsArrays,\r\n      morphNormalsArrays = geometryGroup.__morphNormalsArrays,\r\n\r\n      customAttributes = geometryGroup.__webglCustomAttributesList,\r\n      customAttribute,\r\n\r\n      faceArray = geometryGroup.__faceArray,\r\n      lineArray = geometryGroup.__lineArray,\r\n\r\n      geometry = object.geometry, // this is shared for all chunks\r\n\r\n      dirtyVertices = geometry.verticesNeedUpdate,\r\n      dirtyElements = geometry.elementsNeedUpdate,\r\n      dirtyUvs = geometry.uvsNeedUpdate,\r\n      dirtyNormals = geometry.normalsNeedUpdate,\r\n      dirtyTangents = geometry.tangentsNeedUpdate,\r\n      dirtyColors = geometry.colorsNeedUpdate,\r\n      dirtyMorphTargets = geometry.morphTargetsNeedUpdate,\r\n\r\n      vertices = geometry.vertices,\r\n      chunk_faces3 = geometryGroup.faces3,\r\n      obj_faces = geometry.faces,\r\n\r\n      obj_uvs = geometry.faceVertexUvs[0],\r\n      obj_uvs2 = geometry.faceVertexUvs[1],\r\n\r\n      obj_skinIndices = geometry.skinIndices,\r\n      obj_skinWeights = geometry.skinWeights,\r\n\r\n      morphTargets = geometry.morphTargets,\r\n      morphNormals = geometry.morphNormals;\r\n\r\n    if (dirtyVertices) {\r\n\r\n      for (f = 0, fl = chunk_faces3.length; f < fl; f++) {\r\n\r\n        face = obj_faces[chunk_faces3[f]];\r\n\r\n        v1 = vertices[face.a];\r\n        v2 = vertices[face.b];\r\n        v3 = vertices[face.c];\r\n\r\n        vertexArray[offset] = v1.x;\r\n        vertexArray[offset + 1] = v1.y;\r\n        vertexArray[offset + 2] = v1.z;\r\n\r\n        vertexArray[offset + 3] = v2.x;\r\n        vertexArray[offset + 4] = v2.y;\r\n        vertexArray[offset + 5] = v2.z;\r\n\r\n        vertexArray[offset + 6] = v3.x;\r\n        vertexArray[offset + 7] = v3.y;\r\n        vertexArray[offset + 8] = v3.z;\r\n\r\n        offset += 9;\r\n\r\n      }\r\n\r\n      _gl.bindBuffer(_gl.ARRAY_BUFFER, geometryGroup.__webglVertexBuffer);\r\n      _gl.bufferData(_gl.ARRAY_BUFFER, vertexArray, hint);\r\n\r\n    }\r\n\r\n    if (dirtyMorphTargets) {\r\n\r\n      for (vk = 0, vkl = morphTargets.length; vk < vkl; vk++) {\r\n\r\n        offset_morphTarget = 0;\r\n\r\n        for (f = 0, fl = chunk_faces3.length; f < fl; f++) {\r\n\r\n          chf = chunk_faces3[f];\r\n          face = obj_faces[chf];\r\n\r\n          // morph positions\r\n\r\n          v1 = morphTargets[vk].vertices[face.a];\r\n          v2 = morphTargets[vk].vertices[face.b];\r\n          v3 = morphTargets[vk].vertices[face.c];\r\n\r\n          vka = morphTargetsArrays[vk];\r\n\r\n          vka[offset_morphTarget] = v1.x;\r\n          vka[offset_morphTarget + 1] = v1.y;\r\n          vka[offset_morphTarget + 2] = v1.z;\r\n\r\n          vka[offset_morphTarget + 3] = v2.x;\r\n          vka[offset_morphTarget + 4] = v2.y;\r\n          vka[offset_morphTarget + 5] = v2.z;\r\n\r\n          vka[offset_morphTarget + 6] = v3.x;\r\n          vka[offset_morphTarget + 7] = v3.y;\r\n          vka[offset_morphTarget + 8] = v3.z;\r\n\r\n          // morph normals\r\n\r\n          if (material.morphNormals) {\r\n\r\n            if (needsFaceNormals) {\r\n\r\n              n1 = morphNormals[vk].faceNormals[chf];\r\n              n2 = n1;\r\n              n3 = n1;\r\n\r\n            }\r\n            else {\r\n\r\n              faceVertexNormals = morphNormals[vk].vertexNormals[chf];\r\n\r\n              n1 = faceVertexNormals.a;\r\n              n2 = faceVertexNormals.b;\r\n              n3 = faceVertexNormals.c;\r\n\r\n            }\r\n\r\n            nka = morphNormalsArrays[vk];\r\n\r\n            nka[offset_morphTarget] = n1.x;\r\n            nka[offset_morphTarget + 1] = n1.y;\r\n            nka[offset_morphTarget + 2] = n1.z;\r\n\r\n            nka[offset_morphTarget + 3] = n2.x;\r\n            nka[offset_morphTarget + 4] = n2.y;\r\n            nka[offset_morphTarget + 5] = n2.z;\r\n\r\n            nka[offset_morphTarget + 6] = n3.x;\r\n            nka[offset_morphTarget + 7] = n3.y;\r\n            nka[offset_morphTarget + 8] = n3.z;\r\n\r\n          }\r\n\r\n          //\r\n\r\n          offset_morphTarget += 9;\r\n\r\n        }\r\n\r\n        _gl.bindBuffer(_gl.ARRAY_BUFFER, geometryGroup.__webglMorphTargetsBuffers[vk]);\r\n        _gl.bufferData(_gl.ARRAY_BUFFER, morphTargetsArrays[vk], hint);\r\n\r\n        if (material.morphNormals) {\r\n\r\n          _gl.bindBuffer(_gl.ARRAY_BUFFER, geometryGroup.__webglMorphNormalsBuffers[vk]);\r\n          _gl.bufferData(_gl.ARRAY_BUFFER, morphNormalsArrays[vk], hint);\r\n\r\n        }\r\n\r\n      }\r\n\r\n    }\r\n\r\n    if (obj_skinWeights.length) {\r\n\r\n      for (f = 0, fl = chunk_faces3.length; f < fl; f++) {\r\n\r\n        face = obj_faces[chunk_faces3[f]];\r\n\r\n        // weights\r\n\r\n        sw1 = obj_skinWeights[face.a];\r\n        sw2 = obj_skinWeights[face.b];\r\n        sw3 = obj_skinWeights[face.c];\r\n\r\n        skinWeightArray[offset_skin] = sw1.x;\r\n        skinWeightArray[offset_skin + 1] = sw1.y;\r\n        skinWeightArray[offset_skin + 2] = sw1.z;\r\n        skinWeightArray[offset_skin + 3] = sw1.w;\r\n\r\n        skinWeightArray[offset_skin + 4] = sw2.x;\r\n        skinWeightArray[offset_skin + 5] = sw2.y;\r\n        skinWeightArray[offset_skin + 6] = sw2.z;\r\n        skinWeightArray[offset_skin + 7] = sw2.w;\r\n\r\n        skinWeightArray[offset_skin + 8] = sw3.x;\r\n        skinWeightArray[offset_skin + 9] = sw3.y;\r\n        skinWeightArray[offset_skin + 10] = sw3.z;\r\n        skinWeightArray[offset_skin + 11] = sw3.w;\r\n\r\n        // indices\r\n\r\n        si1 = obj_skinIndices[face.a];\r\n        si2 = obj_skinIndices[face.b];\r\n        si3 = obj_skinIndices[face.c];\r\n\r\n        skinIndexArray[offset_skin] = si1.x;\r\n        skinIndexArray[offset_skin + 1] = si1.y;\r\n        skinIndexArray[offset_skin + 2] = si1.z;\r\n        skinIndexArray[offset_skin + 3] = si1.w;\r\n\r\n        skinIndexArray[offset_skin + 4] = si2.x;\r\n        skinIndexArray[offset_skin + 5] = si2.y;\r\n        skinIndexArray[offset_skin + 6] = si2.z;\r\n        skinIndexArray[offset_skin + 7] = si2.w;\r\n\r\n        skinIndexArray[offset_skin + 8] = si3.x;\r\n        skinIndexArray[offset_skin + 9] = si3.y;\r\n        skinIndexArray[offset_skin + 10] = si3.z;\r\n        skinIndexArray[offset_skin + 11] = si3.w;\r\n\r\n        offset_skin += 12;\r\n\r\n      }\r\n\r\n      if (offset_skin > 0) {\r\n\r\n        _gl.bindBuffer(_gl.ARRAY_BUFFER, geometryGroup.__webglSkinIndicesBuffer);\r\n        _gl.bufferData(_gl.ARRAY_BUFFER, skinIndexArray, hint);\r\n\r\n        _gl.bindBuffer(_gl.ARRAY_BUFFER, geometryGroup.__webglSkinWeightsBuffer);\r\n        _gl.bufferData(_gl.ARRAY_BUFFER, skinWeightArray, hint);\r\n\r\n      }\r\n\r\n    }\r\n\r\n    if (dirtyColors) {\r\n\r\n      for (f = 0, fl = chunk_faces3.length; f < fl; f++) {\r\n\r\n        face = obj_faces[chunk_faces3[f]];\r\n\r\n        vertexColors = face.vertexColors;\r\n        faceColor = face.color;\r\n\r\n        if (vertexColors.length === 3 && material.vertexColors === THREE.VertexColors) {\r\n\r\n          c1 = vertexColors[0];\r\n          c2 = vertexColors[1];\r\n          c3 = vertexColors[2];\r\n\r\n        }\r\n        else {\r\n\r\n          c1 = faceColor;\r\n          c2 = faceColor;\r\n          c3 = faceColor;\r\n\r\n        }\r\n\r\n        colorArray[offset_color] = c1.r;\r\n        colorArray[offset_color + 1] = c1.g;\r\n        colorArray[offset_color + 2] = c1.b;\r\n\r\n        colorArray[offset_color + 3] = c2.r;\r\n        colorArray[offset_color + 4] = c2.g;\r\n        colorArray[offset_color + 5] = c2.b;\r\n\r\n        colorArray[offset_color + 6] = c3.r;\r\n        colorArray[offset_color + 7] = c3.g;\r\n        colorArray[offset_color + 8] = c3.b;\r\n\r\n        offset_color += 9;\r\n\r\n      }\r\n\r\n      if (offset_color > 0) {\r\n\r\n        _gl.bindBuffer(_gl.ARRAY_BUFFER, geometryGroup.__webglColorBuffer);\r\n        _gl.bufferData(_gl.ARRAY_BUFFER, colorArray, hint);\r\n\r\n      }\r\n\r\n    }\r\n\r\n    if (dirtyTangents && geometry.hasTangents) {\r\n\r\n      for (f = 0, fl = chunk_faces3.length; f < fl; f++) {\r\n\r\n        face = obj_faces[chunk_faces3[f]];\r\n\r\n        vertexTangents = face.vertexTangents;\r\n\r\n        t1 = vertexTangents[0];\r\n        t2 = vertexTangents[1];\r\n        t3 = vertexTangents[2];\r\n\r\n        tangentArray[offset_tangent] = t1.x;\r\n        tangentArray[offset_tangent + 1] = t1.y;\r\n        tangentArray[offset_tangent + 2] = t1.z;\r\n        tangentArray[offset_tangent + 3] = t1.w;\r\n\r\n        tangentArray[offset_tangent + 4] = t2.x;\r\n        tangentArray[offset_tangent + 5] = t2.y;\r\n        tangentArray[offset_tangent + 6] = t2.z;\r\n        tangentArray[offset_tangent + 7] = t2.w;\r\n\r\n        tangentArray[offset_tangent + 8] = t3.x;\r\n        tangentArray[offset_tangent + 9] = t3.y;\r\n        tangentArray[offset_tangent + 10] = t3.z;\r\n        tangentArray[offset_tangent + 11] = t3.w;\r\n\r\n        offset_tangent += 12;\r\n\r\n      }\r\n\r\n      _gl.bindBuffer(_gl.ARRAY_BUFFER, geometryGroup.__webglTangentBuffer);\r\n      _gl.bufferData(_gl.ARRAY_BUFFER, tangentArray, hint);\r\n\r\n    }\r\n\r\n    if (dirtyNormals) {\r\n\r\n      for (f = 0, fl = chunk_faces3.length; f < fl; f++) {\r\n\r\n        face = obj_faces[chunk_faces3[f]];\r\n\r\n        vertexNormals = face.vertexNormals;\r\n        faceNormal = face.normal;\r\n\r\n        if (vertexNormals.length === 3 && needsFaceNormals === false) {\r\n\r\n          for (i = 0; i < 3; i++) {\r\n\r\n            vn = vertexNormals[i];\r\n\r\n            normalArray[offset_normal] = vn.x;\r\n            normalArray[offset_normal + 1] = vn.y;\r\n            normalArray[offset_normal + 2] = vn.z;\r\n\r\n            offset_normal += 3;\r\n\r\n          }\r\n\r\n        }\r\n        else {\r\n\r\n          for (i = 0; i < 3; i++) {\r\n\r\n            normalArray[offset_normal] = faceNormal.x;\r\n            normalArray[offset_normal + 1] = faceNormal.y;\r\n            normalArray[offset_normal + 2] = faceNormal.z;\r\n\r\n            offset_normal += 3;\r\n\r\n          }\r\n\r\n        }\r\n\r\n      }\r\n\r\n      _gl.bindBuffer(_gl.ARRAY_BUFFER, geometryGroup.__webglNormalBuffer);\r\n      _gl.bufferData(_gl.ARRAY_BUFFER, normalArray, hint);\r\n\r\n    }\r\n\r\n    if (dirtyUvs && obj_uvs) {\r\n\r\n      for (f = 0, fl = chunk_faces3.length; f < fl; f++) {\r\n\r\n        fi = chunk_faces3[f];\r\n\r\n        uv = obj_uvs[fi];\r\n\r\n        if (uv === undefined) continue;\r\n\r\n        for (i = 0; i < 3; i++) {\r\n\r\n          uvi = uv[i];\r\n\r\n          uvArray[offset_uv] = uvi.x;\r\n          uvArray[offset_uv + 1] = uvi.y;\r\n\r\n          offset_uv += 2;\r\n\r\n        }\r\n\r\n      }\r\n\r\n      if (offset_uv > 0) {\r\n\r\n        _gl.bindBuffer(_gl.ARRAY_BUFFER, geometryGroup.__webglUVBuffer);\r\n        _gl.bufferData(_gl.ARRAY_BUFFER, uvArray, hint);\r\n\r\n      }\r\n\r\n    }\r\n\r\n    if (dirtyUvs && obj_uvs2) {\r\n\r\n      for (f = 0, fl = chunk_faces3.length; f < fl; f++) {\r\n\r\n        fi = chunk_faces3[f];\r\n\r\n        uv2 = obj_uvs2[fi];\r\n\r\n        if (uv2 === undefined) continue;\r\n\r\n        for (i = 0; i < 3; i++) {\r\n\r\n          uv2i = uv2[i];\r\n\r\n          uv2Array[offset_uv2] = uv2i.x;\r\n          uv2Array[offset_uv2 + 1] = uv2i.y;\r\n\r\n          offset_uv2 += 2;\r\n\r\n        }\r\n\r\n      }\r\n\r\n      if (offset_uv2 > 0) {\r\n\r\n        _gl.bindBuffer(_gl.ARRAY_BUFFER, geometryGroup.__webglUV2Buffer);\r\n        _gl.bufferData(_gl.ARRAY_BUFFER, uv2Array, hint);\r\n\r\n      }\r\n\r\n    }\r\n\r\n    if (dirtyElements) {\r\n\r\n      for (f = 0, fl = chunk_faces3.length; f < fl; f++) {\r\n\r\n        faceArray[offset_face] = vertexIndex;\r\n        faceArray[offset_face + 1] = vertexIndex + 1;\r\n        faceArray[offset_face + 2] = vertexIndex + 2;\r\n\r\n        offset_face += 3;\r\n\r\n        lineArray[offset_line] = vertexIndex;\r\n        lineArray[offset_line + 1] = vertexIndex + 1;\r\n\r\n        lineArray[offset_line + 2] = vertexIndex;\r\n        lineArray[offset_line + 3] = vertexIndex + 2;\r\n\r\n        lineArray[offset_line + 4] = vertexIndex + 1;\r\n        lineArray[offset_line + 5] = vertexIndex + 2;\r\n\r\n        offset_line += 6;\r\n\r\n        vertexIndex += 3;\r\n\r\n      }\r\n\r\n      _gl.bindBuffer(_gl.ELEMENT_ARRAY_BUFFER, geometryGroup.__webglFaceBuffer);\r\n      _gl.bufferData(_gl.ELEMENT_ARRAY_BUFFER, faceArray, hint);\r\n\r\n      _gl.bindBuffer(_gl.ELEMENT_ARRAY_BUFFER, geometryGroup.__webglLineBuffer);\r\n      _gl.bufferData(_gl.ELEMENT_ARRAY_BUFFER, lineArray, hint);\r\n\r\n    }\r\n\r\n    if (customAttributes) {\r\n\r\n      for (i = 0, il = customAttributes.length; i < il; i++) {\r\n\r\n        customAttribute = customAttributes[i];\r\n\r\n        if (!customAttribute.__original.needsUpdate) continue;\r\n\r\n        offset_custom = 0;\r\n\r\n        if (customAttribute.size === 1) {\r\n\r\n          if (customAttribute.boundTo === undefined || customAttribute.boundTo === 'vertices') {\r\n\r\n            for (f = 0, fl = chunk_faces3.length; f < fl; f++) {\r\n\r\n              face = obj_faces[chunk_faces3[f]];\r\n\r\n              customAttribute.array[offset_custom] = customAttribute.value[face.a];\r\n              customAttribute.array[offset_custom + 1] = customAttribute.value[face.b];\r\n              customAttribute.array[offset_custom + 2] = customAttribute.value[face.c];\r\n\r\n              offset_custom += 3;\r\n\r\n            }\r\n\r\n          }\r\n          else if (customAttribute.boundTo === 'faces') {\r\n\r\n            for (f = 0, fl = chunk_faces3.length; f < fl; f++) {\r\n\r\n              value = customAttribute.value[chunk_faces3[f]];\r\n\r\n              customAttribute.array[offset_custom] = value;\r\n              customAttribute.array[offset_custom + 1] = value;\r\n              customAttribute.array[offset_custom + 2] = value;\r\n\r\n              offset_custom += 3;\r\n\r\n            }\r\n\r\n          }\r\n\r\n        }\r\n        else if (customAttribute.size === 2) {\r\n\r\n          if (customAttribute.boundTo === undefined || customAttribute.boundTo === 'vertices') {\r\n\r\n            for (f = 0, fl = chunk_faces3.length; f < fl; f++) {\r\n\r\n              face = obj_faces[chunk_faces3[f]];\r\n\r\n              v1 = customAttribute.value[face.a];\r\n              v2 = customAttribute.value[face.b];\r\n              v3 = customAttribute.value[face.c];\r\n\r\n              customAttribute.array[offset_custom] = v1.x;\r\n              customAttribute.array[offset_custom + 1] = v1.y;\r\n\r\n              customAttribute.array[offset_custom + 2] = v2.x;\r\n              customAttribute.array[offset_custom + 3] = v2.y;\r\n\r\n              customAttribute.array[offset_custom + 4] = v3.x;\r\n              customAttribute.array[offset_custom + 5] = v3.y;\r\n\r\n              offset_custom += 6;\r\n\r\n            }\r\n\r\n          }\r\n          else if (customAttribute.boundTo === 'faces') {\r\n\r\n            for (f = 0, fl = chunk_faces3.length; f < fl; f++) {\r\n\r\n              value = customAttribute.value[chunk_faces3[f]];\r\n\r\n              v1 = value;\r\n              v2 = value;\r\n              v3 = value;\r\n\r\n              customAttribute.array[offset_custom] = v1.x;\r\n              customAttribute.array[offset_custom + 1] = v1.y;\r\n\r\n              customAttribute.array[offset_custom + 2] = v2.x;\r\n              customAttribute.array[offset_custom + 3] = v2.y;\r\n\r\n              customAttribute.array[offset_custom + 4] = v3.x;\r\n              customAttribute.array[offset_custom + 5] = v3.y;\r\n\r\n              offset_custom += 6;\r\n\r\n            }\r\n\r\n          }\r\n\r\n        }\r\n        else if (customAttribute.size === 3) {\r\n\r\n          var pp;\r\n\r\n          if (customAttribute.type === 'c') {\r\n\r\n            pp = ['r', 'g', 'b'];\r\n\r\n          }\r\n          else {\r\n\r\n            pp = ['x', 'y', 'z'];\r\n\r\n          }\r\n\r\n          if (customAttribute.boundTo === undefined || customAttribute.boundTo === 'vertices') {\r\n\r\n            for (f = 0, fl = chunk_faces3.length; f < fl; f++) {\r\n\r\n              face = obj_faces[chunk_faces3[f]];\r\n\r\n              v1 = customAttribute.value[face.a];\r\n              v2 = customAttribute.value[face.b];\r\n              v3 = customAttribute.value[face.c];\r\n\r\n              customAttribute.array[offset_custom] = v1[pp[0]];\r\n              customAttribute.array[offset_custom + 1] = v1[pp[1]];\r\n              customAttribute.array[offset_custom + 2] = v1[pp[2]];\r\n\r\n              customAttribute.array[offset_custom + 3] = v2[pp[0]];\r\n              customAttribute.array[offset_custom + 4] = v2[pp[1]];\r\n              customAttribute.array[offset_custom + 5] = v2[pp[2]];\r\n\r\n              customAttribute.array[offset_custom + 6] = v3[pp[0]];\r\n              customAttribute.array[offset_custom + 7] = v3[pp[1]];\r\n              customAttribute.array[offset_custom + 8] = v3[pp[2]];\r\n\r\n              offset_custom += 9;\r\n\r\n            }\r\n\r\n          }\r\n          else if (customAttribute.boundTo === 'faces') {\r\n\r\n            for (f = 0, fl = chunk_faces3.length; f < fl; f++) {\r\n\r\n              value = customAttribute.value[chunk_faces3[f]];\r\n\r\n              v1 = value;\r\n              v2 = value;\r\n              v3 = value;\r\n\r\n              customAttribute.array[offset_custom] = v1[pp[0]];\r\n              customAttribute.array[offset_custom + 1] = v1[pp[1]];\r\n              customAttribute.array[offset_custom + 2] = v1[pp[2]];\r\n\r\n              customAttribute.array[offset_custom + 3] = v2[pp[0]];\r\n              customAttribute.array[offset_custom + 4] = v2[pp[1]];\r\n              customAttribute.array[offset_custom + 5] = v2[pp[2]];\r\n\r\n              customAttribute.array[offset_custom + 6] = v3[pp[0]];\r\n              customAttribute.array[offset_custom + 7] = v3[pp[1]];\r\n              customAttribute.array[offset_custom + 8] = v3[pp[2]];\r\n\r\n              offset_custom += 9;\r\n\r\n            }\r\n\r\n          }\r\n          else if (customAttribute.boundTo === 'faceVertices') {\r\n\r\n            for (f = 0, fl = chunk_faces3.length; f < fl; f++) {\r\n\r\n              value = customAttribute.value[chunk_faces3[f]];\r\n\r\n              v1 = value[0];\r\n              v2 = value[1];\r\n              v3 = value[2];\r\n\r\n              customAttribute.array[offset_custom] = v1[pp[0]];\r\n              customAttribute.array[offset_custom + 1] = v1[pp[1]];\r\n              customAttribute.array[offset_custom + 2] = v1[pp[2]];\r\n\r\n              customAttribute.array[offset_custom + 3] = v2[pp[0]];\r\n              customAttribute.array[offset_custom + 4] = v2[pp[1]];\r\n              customAttribute.array[offset_custom + 5] = v2[pp[2]];\r\n\r\n              customAttribute.array[offset_custom + 6] = v3[pp[0]];\r\n              customAttribute.array[offset_custom + 7] = v3[pp[1]];\r\n              customAttribute.array[offset_custom + 8] = v3[pp[2]];\r\n\r\n              offset_custom += 9;\r\n\r\n            }\r\n\r\n          }\r\n\r\n        }\r\n        else if (customAttribute.size === 4) {\r\n\r\n          if (customAttribute.boundTo === undefined || customAttribute.boundTo === 'vertices') {\r\n\r\n            for (f = 0, fl = chunk_faces3.length; f < fl; f++) {\r\n\r\n              face = obj_faces[chunk_faces3[f]];\r\n\r\n              v1 = customAttribute.value[face.a];\r\n              v2 = customAttribute.value[face.b];\r\n              v3 = customAttribute.value[face.c];\r\n\r\n              customAttribute.array[offset_custom] = v1.x;\r\n              customAttribute.array[offset_custom + 1] = v1.y;\r\n              customAttribute.array[offset_custom + 2] = v1.z;\r\n              customAttribute.array[offset_custom + 3] = v1.w;\r\n\r\n              customAttribute.array[offset_custom + 4] = v2.x;\r\n              customAttribute.array[offset_custom + 5] = v2.y;\r\n              customAttribute.array[offset_custom + 6] = v2.z;\r\n              customAttribute.array[offset_custom + 7] = v2.w;\r\n\r\n              customAttribute.array[offset_custom + 8] = v3.x;\r\n              customAttribute.array[offset_custom + 9] = v3.y;\r\n              customAttribute.array[offset_custom + 10] = v3.z;\r\n              customAttribute.array[offset_custom + 11] = v3.w;\r\n\r\n              offset_custom += 12;\r\n\r\n            }\r\n\r\n          }\r\n          else if (customAttribute.boundTo === 'faces') {\r\n\r\n            for (f = 0, fl = chunk_faces3.length; f < fl; f++) {\r\n\r\n              value = customAttribute.value[chunk_faces3[f]];\r\n\r\n              v1 = value;\r\n              v2 = value;\r\n              v3 = value;\r\n\r\n              customAttribute.array[offset_custom] = v1.x;\r\n              customAttribute.array[offset_custom + 1] = v1.y;\r\n              customAttribute.array[offset_custom + 2] = v1.z;\r\n              customAttribute.array[offset_custom + 3] = v1.w;\r\n\r\n              customAttribute.array[offset_custom + 4] = v2.x;\r\n              customAttribute.array[offset_custom + 5] = v2.y;\r\n              customAttribute.array[offset_custom + 6] = v2.z;\r\n              customAttribute.array[offset_custom + 7] = v2.w;\r\n\r\n              customAttribute.array[offset_custom + 8] = v3.x;\r\n              customAttribute.array[offset_custom + 9] = v3.y;\r\n              customAttribute.array[offset_custom + 10] = v3.z;\r\n              customAttribute.array[offset_custom + 11] = v3.w;\r\n\r\n              offset_custom += 12;\r\n\r\n            }\r\n\r\n          }\r\n          else if (customAttribute.boundTo === 'faceVertices') {\r\n\r\n            for (f = 0, fl = chunk_faces3.length; f < fl; f++) {\r\n\r\n              value = customAttribute.value[chunk_faces3[f]];\r\n\r\n              v1 = value[0];\r\n              v2 = value[1];\r\n              v3 = value[2];\r\n\r\n              customAttribute.array[offset_custom] = v1.x;\r\n              customAttribute.array[offset_custom + 1] = v1.y;\r\n              customAttribute.array[offset_custom + 2] = v1.z;\r\n              customAttribute.array[offset_custom + 3] = v1.w;\r\n\r\n              customAttribute.array[offset_custom + 4] = v2.x;\r\n              customAttribute.array[offset_custom + 5] = v2.y;\r\n              customAttribute.array[offset_custom + 6] = v2.z;\r\n              customAttribute.array[offset_custom + 7] = v2.w;\r\n\r\n              customAttribute.array[offset_custom + 8] = v3.x;\r\n              customAttribute.array[offset_custom + 9] = v3.y;\r\n              customAttribute.array[offset_custom + 10] = v3.z;\r\n              customAttribute.array[offset_custom + 11] = v3.w;\r\n\r\n              offset_custom += 12;\r\n\r\n            }\r\n\r\n          }\r\n\r\n        }\r\n\r\n        _gl.bindBuffer(_gl.ARRAY_BUFFER, customAttribute.buffer);\r\n        _gl.bufferData(_gl.ARRAY_BUFFER, customAttribute.array, hint);\r\n\r\n      }\r\n\r\n    }\r\n\r\n    if (dispose) {\r\n\r\n      delete geometryGroup.__inittedArrays;\r\n      delete geometryGroup.__colorArray;\r\n      delete geometryGroup.__normalArray;\r\n      delete geometryGroup.__tangentArray;\r\n      delete geometryGroup.__uvArray;\r\n      delete geometryGroup.__uv2Array;\r\n      delete geometryGroup.__faceArray;\r\n      delete geometryGroup.__vertexArray;\r\n      delete geometryGroup.__lineArray;\r\n      delete geometryGroup.__skinIndexArray;\r\n      delete geometryGroup.__skinWeightArray;\r\n\r\n    }\r\n\r\n  };\r\n\r\n  // Buffer rendering\r\n\r\n  this.renderBufferImmediate = function(object, program, material) {\r\n\r\n    state.initAttributes();\r\n\r\n    if (object.hasPositions && !object.__webglVertexBuffer) object.__webglVertexBuffer = _gl.createBuffer();\r\n    if (object.hasNormals && !object.__webglNormalBuffer) object.__webglNormalBuffer = _gl.createBuffer();\r\n    if (object.hasUvs && !object.__webglUvBuffer) object.__webglUvBuffer = _gl.createBuffer();\r\n    if (object.hasColors && !object.__webglColorBuffer) object.__webglColorBuffer = _gl.createBuffer();\r\n\r\n    if (object.hasPositions) {\r\n\r\n      _gl.bindBuffer(_gl.ARRAY_BUFFER, object.__webglVertexBuffer);\r\n      _gl.bufferData(_gl.ARRAY_BUFFER, object.positionArray, _gl.DYNAMIC_DRAW);\r\n\r\n      state.enableAttribute(program.attributes.position);\r\n\r\n      _gl.vertexAttribPointer(program.attributes.position, 3, _gl.FLOAT, false, 0, 0);\r\n\r\n    }\r\n\r\n    if (object.hasNormals) {\r\n\r\n      _gl.bindBuffer(_gl.ARRAY_BUFFER, object.__webglNormalBuffer);\r\n\r\n      if (material instanceof THREE.MeshPhongMaterial === false &&\r\n        material.shading === THREE.FlatShading) {\r\n\r\n        var nx, ny, nz,\r\n          nax, nbx, ncx, nay, nby, ncy, naz, nbz, ncz,\r\n          normalArray,\r\n          i, il = object.count * 3;\r\n\r\n        for (i = 0; i < il; i += 9) {\r\n\r\n          normalArray = object.normalArray;\r\n\r\n          nax = normalArray[i];\r\n          nay = normalArray[i + 1];\r\n          naz = normalArray[i + 2];\r\n\r\n          nbx = normalArray[i + 3];\r\n          nby = normalArray[i + 4];\r\n          nbz = normalArray[i + 5];\r\n\r\n          ncx = normalArray[i + 6];\r\n          ncy = normalArray[i + 7];\r\n          ncz = normalArray[i + 8];\r\n\r\n          nx = (nax + nbx + ncx) / 3;\r\n          ny = (nay + nby + ncy) / 3;\r\n          nz = (naz + nbz + ncz) / 3;\r\n\r\n          normalArray[i] = nx;\r\n          normalArray[i + 1] = ny;\r\n          normalArray[i + 2] = nz;\r\n\r\n          normalArray[i + 3] = nx;\r\n          normalArray[i + 4] = ny;\r\n          normalArray[i + 5] = nz;\r\n\r\n          normalArray[i + 6] = nx;\r\n          normalArray[i + 7] = ny;\r\n          normalArray[i + 8] = nz;\r\n\r\n        }\r\n\r\n      }\r\n\r\n      _gl.bufferData(_gl.ARRAY_BUFFER, object.normalArray, _gl.DYNAMIC_DRAW);\r\n\r\n      state.enableAttribute(program.attributes.normal);\r\n\r\n      _gl.vertexAttribPointer(program.attributes.normal, 3, _gl.FLOAT, false, 0, 0);\r\n\r\n    }\r\n\r\n    if (object.hasUvs && material.map) {\r\n\r\n      _gl.bindBuffer(_gl.ARRAY_BUFFER, object.__webglUvBuffer);\r\n      _gl.bufferData(_gl.ARRAY_BUFFER, object.uvArray, _gl.DYNAMIC_DRAW);\r\n\r\n      state.enableAttribute(program.attributes.uv);\r\n\r\n      _gl.vertexAttribPointer(program.attributes.uv, 2, _gl.FLOAT, false, 0, 0);\r\n\r\n    }\r\n\r\n    if (object.hasColors && material.vertexColors !== THREE.NoColors) {\r\n\r\n      _gl.bindBuffer(_gl.ARRAY_BUFFER, object.__webglColorBuffer);\r\n      _gl.bufferData(_gl.ARRAY_BUFFER, object.colorArray, _gl.DYNAMIC_DRAW);\r\n\r\n      state.enableAttribute(program.attributes.color);\r\n\r\n      _gl.vertexAttribPointer(program.attributes.color, 3, _gl.FLOAT, false, 0, 0);\r\n\r\n    }\r\n\r\n    state.disableUnusedAttributes();\r\n\r\n    _gl.drawArrays(_gl.TRIANGLES, 0, object.count);\r\n\r\n    object.count = 0;\r\n\r\n  };\r\n\r\n  function setupVertexAttributes(material, program, geometry, startIndex) {\r\n\r\n    var geometryAttributes = geometry.attributes;\r\n\r\n    var programAttributes = program.attributes;\r\n    var programAttributesKeys = program.attributesKeys;\r\n\r\n    for (var i = 0, l = programAttributesKeys.length; i < l; i++) {\r\n\r\n      var key = programAttributesKeys[i];\r\n      var programAttribute = programAttributes[key];\r\n\r\n      if (programAttribute >= 0) {\r\n\r\n        var geometryAttribute = geometryAttributes[key];\r\n\r\n        if (geometryAttribute !== undefined) {\r\n\r\n          var size = geometryAttribute.itemSize;\r\n\r\n          _gl.bindBuffer(_gl.ARRAY_BUFFER, geometryAttribute.buffer);\r\n\r\n          state.enableAttribute(programAttribute);\r\n\r\n          _gl.vertexAttribPointer(programAttribute, size, _gl.FLOAT, false, 0, startIndex * size * 4); // 4 bytes per Float32\r\n\r\n        }\r\n        else if (material.defaultAttributeValues !== undefined) {\r\n\r\n          if (material.defaultAttributeValues[key].length === 2) {\r\n\r\n            _gl.vertexAttrib2fv(programAttribute, material.defaultAttributeValues[key]);\r\n\r\n          }\r\n          else if (material.defaultAttributeValues[key].length === 3) {\r\n\r\n            _gl.vertexAttrib3fv(programAttribute, material.defaultAttributeValues[key]);\r\n\r\n          }\r\n\r\n        }\r\n\r\n      }\r\n\r\n    }\r\n\r\n    state.disableUnusedAttributes();\r\n\r\n  }\r\n\r\n  this.renderBufferDirect = function(camera, lights, fog, material, geometry, object) {\r\n\r\n    if (material.visible === false) return;\r\n\r\n    updateObject(object);\r\n\r\n    var program = setProgram(camera, lights, fog, material, object);\r\n\r\n    var updateBuffers = false,\r\n      wireframeBit = material.wireframe ? 1 : 0,\r\n      geometryProgram = 'direct_' + geometry.id + '_' + program.id + '_' + wireframeBit;\r\n\r\n    if (geometryProgram !== _currentGeometryProgram) {\r\n\r\n      _currentGeometryProgram = geometryProgram;\r\n      updateBuffers = true;\r\n\r\n    }\r\n\r\n    if (updateBuffers) {\r\n\r\n      state.initAttributes();\r\n\r\n    }\r\n\r\n    // render mesh\r\n\r\n    if (object instanceof THREE.Mesh) {\r\n\r\n      var mode = material.wireframe === true ? _gl.LINES : _gl.TRIANGLES;\r\n\r\n      var index = geometry.attributes.index;\r\n\r\n      if (index) {\r\n\r\n        // indexed triangles\r\n\r\n        var type, size;\r\n\r\n        if (index.array instanceof Uint32Array && extensions.get('OES_element_index_uint')) {\r\n\r\n          type = _gl.UNSIGNED_INT;\r\n          size = 4;\r\n\r\n        }\r\n        else {\r\n\r\n          type = _gl.UNSIGNED_SHORT;\r\n          size = 2;\r\n\r\n        }\r\n\r\n        var offsets = geometry.offsets;\r\n\r\n        if (offsets.length === 0) {\r\n\r\n          if (updateBuffers) {\r\n\r\n            setupVertexAttributes(material, program, geometry, 0);\r\n            _gl.bindBuffer(_gl.ELEMENT_ARRAY_BUFFER, index.buffer);\r\n\r\n          }\r\n\r\n          _gl.drawElements(mode, index.array.length, type, 0);\r\n\r\n          _this.info.render.calls++;\r\n          _this.info.render.vertices += index.array.length; // not really true, here vertices can be shared\r\n          _this.info.render.faces += index.array.length / 3;\r\n\r\n        }\r\n        else {\r\n\r\n          // if there is more than 1 chunk\r\n          // must set attribute pointers to use new offsets for each chunk\r\n          // even if geometry and materials didn't change\r\n\r\n          updateBuffers = true;\r\n\r\n          for (var i = 0, il = offsets.length; i < il; i++) {\r\n\r\n            var startIndex = offsets[i].index;\r\n\r\n            if (updateBuffers) {\r\n\r\n              setupVertexAttributes(material, program, geometry, startIndex);\r\n              _gl.bindBuffer(_gl.ELEMENT_ARRAY_BUFFER, index.buffer);\r\n\r\n            }\r\n\r\n            // render indexed triangles\r\n\r\n            _gl.drawElements(mode, offsets[i].count, type, offsets[i].start * size);\r\n\r\n            _this.info.render.calls++;\r\n            _this.info.render.vertices += offsets[i].count; // not really true, here vertices can be shared\r\n            _this.info.render.faces += offsets[i].count / 3;\r\n\r\n          }\r\n\r\n        }\r\n\r\n      }\r\n      else {\r\n\r\n        // non-indexed triangles\r\n\r\n        if (updateBuffers) {\r\n\r\n          setupVertexAttributes(material, program, geometry, 0);\r\n\r\n        }\r\n\r\n        var position = geometry.attributes['position'];\r\n\r\n        // render non-indexed triangles\r\n\r\n        _gl.drawArrays(mode, 0, position.array.length / position.itemSize);\r\n\r\n        _this.info.render.calls++;\r\n        _this.info.render.vertices += position.array.length / position.itemSize;\r\n        _this.info.render.faces += position.array.length / (3 * position.itemSize);\r\n\r\n      }\r\n\r\n    }\r\n    else if (object instanceof THREE.PointCloud) {\r\n\r\n      // render particles\r\n\r\n      var mode = _gl.POINTS;\r\n\r\n      var index = geometry.attributes.index;\r\n\r\n      if (index) {\r\n\r\n        // indexed points\r\n\r\n        var type, size;\r\n\r\n        if (index.array instanceof Uint32Array && extensions.get('OES_element_index_uint')) {\r\n\r\n          type = _gl.UNSIGNED_INT;\r\n          size = 4;\r\n\r\n        }\r\n        else {\r\n\r\n          type = _gl.UNSIGNED_SHORT;\r\n          size = 2;\r\n\r\n        }\r\n\r\n        var offsets = geometry.offsets;\r\n\r\n        if (offsets.length === 0) {\r\n\r\n          if (updateBuffers) {\r\n\r\n            setupVertexAttributes(material, program, geometry, 0);\r\n            _gl.bindBuffer(_gl.ELEMENT_ARRAY_BUFFER, index.buffer);\r\n\r\n          }\r\n\r\n          _gl.drawElements(mode, index.array.length, type, 0);\r\n\r\n          _this.info.render.calls++;\r\n          _this.info.render.points += index.array.length;\r\n\r\n        }\r\n        else {\r\n\r\n          // if there is more than 1 chunk\r\n          // must set attribute pointers to use new offsets for each chunk\r\n          // even if geometry and materials didn't change\r\n\r\n          if (offsets.length > 1) updateBuffers = true;\r\n\r\n          for (var i = 0, il = offsets.length; i < il; i++) {\r\n\r\n            var startIndex = offsets[i].index;\r\n\r\n            if (updateBuffers) {\r\n\r\n              setupVertexAttributes(material, program, geometry, startIndex);\r\n              _gl.bindBuffer(_gl.ELEMENT_ARRAY_BUFFER, index.buffer);\r\n\r\n            }\r\n\r\n            // render indexed points\r\n\r\n            _gl.drawElements(mode, offsets[i].count, type, offsets[i].start * size);\r\n\r\n            _this.info.render.calls++;\r\n            _this.info.render.points += offsets[i].count;\r\n\r\n          }\r\n\r\n        }\r\n\r\n      }\r\n      else {\r\n\r\n        // non-indexed points\r\n\r\n        if (updateBuffers) {\r\n\r\n          setupVertexAttributes(material, program, geometry, 0);\r\n\r\n        }\r\n\r\n        var position = geometry.attributes.position;\r\n        var offsets = geometry.offsets;\r\n\r\n        if (offsets.length === 0) {\r\n\r\n          _gl.drawArrays(mode, 0, position.array.length / 3);\r\n\r\n          _this.info.render.calls++;\r\n          _this.info.render.points += position.array.length / 3;\r\n\r\n        }\r\n        else {\r\n\r\n          for (var i = 0, il = offsets.length; i < il; i++) {\r\n\r\n            _gl.drawArrays(mode, offsets[i].index, offsets[i].count);\r\n\r\n            _this.info.render.calls++;\r\n            _this.info.render.points += offsets[i].count;\r\n\r\n          }\r\n\r\n        }\r\n\r\n      }\r\n\r\n    }\r\n    else if (object instanceof THREE.Line) {\r\n\r\n      var mode = (object.mode === THREE.LineStrip) ? _gl.LINE_STRIP : _gl.LINES;\r\n\r\n      state.setLineWidth(material.linewidth * pixelRatio);\r\n\r\n      var index = geometry.attributes.index;\r\n\r\n      if (index) {\r\n\r\n        // indexed lines\r\n\r\n        var type, size;\r\n\r\n        if (index.array instanceof Uint32Array) {\r\n\r\n          type = _gl.UNSIGNED_INT;\r\n          size = 4;\r\n\r\n        }\r\n        else {\r\n\r\n          type = _gl.UNSIGNED_SHORT;\r\n          size = 2;\r\n\r\n        }\r\n\r\n        var offsets = geometry.offsets;\r\n\r\n        if (offsets.length === 0) {\r\n\r\n          if (updateBuffers) {\r\n\r\n            setupVertexAttributes(material, program, geometry, 0);\r\n            _gl.bindBuffer(_gl.ELEMENT_ARRAY_BUFFER, index.buffer);\r\n\r\n          }\r\n\r\n          _gl.drawElements(mode, index.array.length, type, 0); // 2 bytes per Uint16Array\r\n\r\n          _this.info.render.calls++;\r\n          _this.info.render.vertices += index.array.length; // not really true, here vertices can be shared\r\n\r\n        }\r\n        else {\r\n\r\n          // if there is more than 1 chunk\r\n          // must set attribute pointers to use new offsets for each chunk\r\n          // even if geometry and materials didn't change\r\n\r\n          if (offsets.length > 1) updateBuffers = true;\r\n\r\n          for (var i = 0, il = offsets.length; i < il; i++) {\r\n\r\n            var startIndex = offsets[i].index;\r\n\r\n            if (updateBuffers) {\r\n\r\n              setupVertexAttributes(material, program, geometry, startIndex);\r\n              _gl.bindBuffer(_gl.ELEMENT_ARRAY_BUFFER, index.buffer);\r\n\r\n            }\r\n\r\n            // render indexed lines\r\n\r\n            _gl.drawElements(mode, offsets[i].count, type, offsets[i].start * size); // 2 bytes per Uint16Array\r\n\r\n            _this.info.render.calls++;\r\n            _this.info.render.vertices += offsets[i].count; // not really true, here vertices can be shared\r\n\r\n          }\r\n\r\n        }\r\n\r\n      }\r\n      else {\r\n\r\n        // non-indexed lines\r\n\r\n        if (updateBuffers) {\r\n\r\n          setupVertexAttributes(material, program, geometry, 0);\r\n\r\n        }\r\n\r\n        var position = geometry.attributes.position;\r\n        var offsets = geometry.offsets;\r\n\r\n        if (offsets.length === 0) {\r\n\r\n          _gl.drawArrays(mode, 0, position.array.length / 3);\r\n\r\n          _this.info.render.calls++;\r\n          _this.info.render.vertices += position.array.length / 3;\r\n\r\n        }\r\n        else {\r\n\r\n          for (var i = 0, il = offsets.length; i < il; i++) {\r\n\r\n            _gl.drawArrays(mode, offsets[i].index, offsets[i].count);\r\n\r\n            _this.info.render.calls++;\r\n            _this.info.render.vertices += offsets[i].count;\r\n\r\n          }\r\n\r\n        }\r\n\r\n      }\r\n\r\n    }\r\n\r\n  };\r\n\r\n  this.renderBuffer = function(camera, lights, fog, material, geometryGroup, object) {\r\n\r\n    if (material.visible === false) return;\r\n\r\n    updateObject(object);\r\n\r\n    var program = setProgram(camera, lights, fog, material, object);\r\n\r\n    var attributes = program.attributes;\r\n\r\n    var updateBuffers = false,\r\n      wireframeBit = material.wireframe ? 1 : 0,\r\n      geometryProgram = geometryGroup.id + '_' + program.id + '_' + wireframeBit;\r\n\r\n    if (geometryProgram !== _currentGeometryProgram) {\r\n\r\n      _currentGeometryProgram = geometryProgram;\r\n      updateBuffers = true;\r\n\r\n    }\r\n\r\n    if (updateBuffers) {\r\n\r\n      state.initAttributes();\r\n\r\n    }\r\n\r\n    // vertices\r\n\r\n    if (!material.morphTargets && attributes.position >= 0) {\r\n\r\n      if (updateBuffers) {\r\n\r\n        _gl.bindBuffer(_gl.ARRAY_BUFFER, geometryGroup.__webglVertexBuffer);\r\n\r\n        state.enableAttribute(attributes.position);\r\n\r\n        _gl.vertexAttribPointer(attributes.position, 3, _gl.FLOAT, false, 0, 0);\r\n\r\n      }\r\n\r\n    }\r\n    else {\r\n\r\n      if (object.morphTargetBase) {\r\n\r\n        setupMorphTargets(material, geometryGroup, object);\r\n\r\n      }\r\n\r\n    }\r\n\r\n\r\n    if (updateBuffers) {\r\n\r\n      // custom attributes\r\n\r\n      // Use the per-geometryGroup custom attribute arrays which are setup in initMeshBuffers\r\n\r\n      if (geometryGroup.__webglCustomAttributesList) {\r\n\r\n        for (var i = 0, il = geometryGroup.__webglCustomAttributesList.length; i < il; i++) {\r\n\r\n          var attribute = geometryGroup.__webglCustomAttributesList[i];\r\n\r\n          if (attributes[attribute.buffer.belongsToAttribute] >= 0) {\r\n\r\n            _gl.bindBuffer(_gl.ARRAY_BUFFER, attribute.buffer);\r\n\r\n            state.enableAttribute(attributes[attribute.buffer.belongsToAttribute]);\r\n\r\n            _gl.vertexAttribPointer(attributes[attribute.buffer.belongsToAttribute], attribute.size, _gl.FLOAT, false, 0, 0);\r\n\r\n          }\r\n\r\n        }\r\n\r\n      }\r\n\r\n\r\n      // colors\r\n\r\n      if (attributes.color >= 0) {\r\n\r\n        if (object.geometry.colors.length > 0 || object.geometry.faces.length > 0) {\r\n\r\n          _gl.bindBuffer(_gl.ARRAY_BUFFER, geometryGroup.__webglColorBuffer);\r\n\r\n          state.enableAttribute(attributes.color);\r\n\r\n          _gl.vertexAttribPointer(attributes.color, 3, _gl.FLOAT, false, 0, 0);\r\n\r\n        }\r\n        else if (material.defaultAttributeValues !== undefined) {\r\n\r\n\r\n          _gl.vertexAttrib3fv(attributes.color, material.defaultAttributeValues.color);\r\n\r\n        }\r\n\r\n      }\r\n\r\n      // normals\r\n\r\n      if (attributes.normal >= 0) {\r\n\r\n        _gl.bindBuffer(_gl.ARRAY_BUFFER, geometryGroup.__webglNormalBuffer);\r\n\r\n        state.enableAttribute(attributes.normal);\r\n\r\n        _gl.vertexAttribPointer(attributes.normal, 3, _gl.FLOAT, false, 0, 0);\r\n\r\n      }\r\n\r\n      // tangents\r\n\r\n      if (attributes.tangent >= 0) {\r\n\r\n        _gl.bindBuffer(_gl.ARRAY_BUFFER, geometryGroup.__webglTangentBuffer);\r\n\r\n        state.enableAttribute(attributes.tangent);\r\n\r\n        _gl.vertexAttribPointer(attributes.tangent, 4, _gl.FLOAT, false, 0, 0);\r\n\r\n      }\r\n\r\n      // uvs\r\n\r\n      if (attributes.uv >= 0) {\r\n\r\n        if (object.geometry.faceVertexUvs[0]) {\r\n\r\n          _gl.bindBuffer(_gl.ARRAY_BUFFER, geometryGroup.__webglUVBuffer);\r\n\r\n          state.enableAttribute(attributes.uv);\r\n\r\n          _gl.vertexAttribPointer(attributes.uv, 2, _gl.FLOAT, false, 0, 0);\r\n\r\n        }\r\n        else if (material.defaultAttributeValues !== undefined) {\r\n\r\n\r\n          _gl.vertexAttrib2fv(attributes.uv, material.defaultAttributeValues.uv);\r\n\r\n        }\r\n\r\n      }\r\n\r\n      if (attributes.uv2 >= 0) {\r\n\r\n        if (object.geometry.faceVertexUvs[1]) {\r\n\r\n          _gl.bindBuffer(_gl.ARRAY_BUFFER, geometryGroup.__webglUV2Buffer);\r\n\r\n          state.enableAttribute(attributes.uv2);\r\n\r\n          _gl.vertexAttribPointer(attributes.uv2, 2, _gl.FLOAT, false, 0, 0);\r\n\r\n        }\r\n        else if (material.defaultAttributeValues !== undefined) {\r\n\r\n\r\n          _gl.vertexAttrib2fv(attributes.uv2, material.defaultAttributeValues.uv2);\r\n\r\n        }\r\n\r\n      }\r\n\r\n      if (material.skinning &&\r\n        attributes.skinIndex >= 0 && attributes.skinWeight >= 0) {\r\n\r\n        _gl.bindBuffer(_gl.ARRAY_BUFFER, geometryGroup.__webglSkinIndicesBuffer);\r\n\r\n        state.enableAttribute(attributes.skinIndex);\r\n\r\n        _gl.vertexAttribPointer(attributes.skinIndex, 4, _gl.FLOAT, false, 0, 0);\r\n\r\n        _gl.bindBuffer(_gl.ARRAY_BUFFER, geometryGroup.__webglSkinWeightsBuffer);\r\n\r\n        state.enableAttribute(attributes.skinWeight);\r\n\r\n        _gl.vertexAttribPointer(attributes.skinWeight, 4, _gl.FLOAT, false, 0, 0);\r\n\r\n      }\r\n\r\n      // line distances\r\n\r\n      if (attributes.lineDistance >= 0) {\r\n\r\n        _gl.bindBuffer(_gl.ARRAY_BUFFER, geometryGroup.__webglLineDistanceBuffer);\r\n\r\n        state.enableAttribute(attributes.lineDistance);\r\n\r\n        _gl.vertexAttribPointer(attributes.lineDistance, 1, _gl.FLOAT, false, 0, 0);\r\n\r\n      }\r\n\r\n    }\r\n\r\n    state.disableUnusedAttributes();\r\n\r\n    // render mesh\r\n\r\n    if (object instanceof THREE.Mesh) {\r\n\r\n      var type = geometryGroup.__typeArray === Uint32Array ? _gl.UNSIGNED_INT : _gl.UNSIGNED_SHORT;\r\n\r\n      // wireframe\r\n\r\n      if (material.wireframe) {\r\n\r\n        state.setLineWidth(material.wireframeLinewidth * pixelRatio);\r\n\r\n        if (updateBuffers) _gl.bindBuffer(_gl.ELEMENT_ARRAY_BUFFER, geometryGroup.__webglLineBuffer);\r\n        _gl.drawElements(_gl.LINES, geometryGroup.__webglLineCount, type, 0);\r\n\r\n        // triangles\r\n\r\n      }\r\n      else {\r\n\r\n        if (updateBuffers) _gl.bindBuffer(_gl.ELEMENT_ARRAY_BUFFER, geometryGroup.__webglFaceBuffer);\r\n        _gl.drawElements(_gl.TRIANGLES, geometryGroup.__webglFaceCount, type, 0);\r\n\r\n      }\r\n\r\n      _this.info.render.calls++;\r\n      _this.info.render.vertices += geometryGroup.__webglFaceCount;\r\n      _this.info.render.faces += geometryGroup.__webglFaceCount / 3;\r\n\r\n      // render lines\r\n\r\n    }\r\n    else if (object instanceof THREE.Line) {\r\n\r\n      var mode = (object.mode === THREE.LineStrip) ? _gl.LINE_STRIP : _gl.LINES;\r\n\r\n      state.setLineWidth(material.linewidth * pixelRatio);\r\n\r\n      _gl.drawArrays(mode, 0, geometryGroup.__webglLineCount);\r\n\r\n      _this.info.render.calls++;\r\n\r\n      // render particles\r\n\r\n    }\r\n    else if (object instanceof THREE.PointCloud) {\r\n\r\n      _gl.drawArrays(_gl.POINTS, 0, geometryGroup.__webglParticleCount);\r\n\r\n      _this.info.render.calls++;\r\n      _this.info.render.points += geometryGroup.__webglParticleCount;\r\n\r\n    }\r\n\r\n  };\r\n\r\n  function setupMorphTargets(material, geometryGroup, object) {\r\n\r\n    // set base\r\n\r\n    var attributes = material.program.attributes;\r\n\r\n    if (object.morphTargetBase !== -1 && attributes.position >= 0) {\r\n\r\n      _gl.bindBuffer(_gl.ARRAY_BUFFER, geometryGroup.__webglMorphTargetsBuffers[object.morphTargetBase]);\r\n\r\n      state.enableAttribute(attributes.position);\r\n\r\n      _gl.vertexAttribPointer(attributes.position, 3, _gl.FLOAT, false, 0, 0);\r\n\r\n    }\r\n    else if (attributes.position >= 0) {\r\n\r\n      _gl.bindBuffer(_gl.ARRAY_BUFFER, geometryGroup.__webglVertexBuffer);\r\n\r\n      state.enableAttribute(attributes.position);\r\n\r\n      _gl.vertexAttribPointer(attributes.position, 3, _gl.FLOAT, false, 0, 0);\r\n\r\n    }\r\n\r\n    if (object.morphTargetForcedOrder.length) {\r\n\r\n      // set forced order\r\n\r\n      var m = 0;\r\n      var order = object.morphTargetForcedOrder;\r\n      var influences = object.morphTargetInfluences;\r\n\r\n      var attribute;\r\n\r\n      while (m < material.numSupportedMorphTargets && m < order.length) {\r\n\r\n        attribute = attributes['morphTarget' + m];\r\n\r\n        if (attribute >= 0) {\r\n\r\n          _gl.bindBuffer(_gl.ARRAY_BUFFER, geometryGroup.__webglMorphTargetsBuffers[order[m]]);\r\n\r\n          state.enableAttribute(attribute);\r\n\r\n          _gl.vertexAttribPointer(attribute, 3, _gl.FLOAT, false, 0, 0);\r\n\r\n        }\r\n\r\n        attribute = attributes['morphNormal' + m];\r\n\r\n        if (attribute >= 0 && material.morphNormals) {\r\n\r\n          _gl.bindBuffer(_gl.ARRAY_BUFFER, geometryGroup.__webglMorphNormalsBuffers[order[m]]);\r\n\r\n          state.enableAttribute(attribute);\r\n\r\n          _gl.vertexAttribPointer(attribute, 3, _gl.FLOAT, false, 0, 0);\r\n\r\n        }\r\n\r\n        object.__webglMorphTargetInfluences[m] = influences[order[m]];\r\n\r\n        m++;\r\n\r\n      }\r\n\r\n    }\r\n    else {\r\n\r\n      // find the most influencing\r\n\r\n      var activeInfluenceIndices = [];\r\n      var influences = object.morphTargetInfluences;\r\n      var morphTargets = object.geometry.morphTargets;\r\n\r\n      if (influences.length > morphTargets.length) {\r\n\r\n        console.warn('THREE.WebGLRenderer: Influences array is bigger than morphTargets array.');\r\n        influences.length = morphTargets.length;\r\n\r\n      }\r\n\r\n      for (var i = 0, il = influences.length; i < il; i++) {\r\n\r\n        var influence = influences[i];\r\n\r\n        activeInfluenceIndices.push([influence, i]);\r\n\r\n      }\r\n\r\n      if (activeInfluenceIndices.length > material.numSupportedMorphTargets) {\r\n\r\n        activeInfluenceIndices.sort(numericalSort);\r\n        activeInfluenceIndices.length = material.numSupportedMorphTargets;\r\n\r\n      }\r\n      else if (activeInfluenceIndices.length > material.numSupportedMorphNormals) {\r\n\r\n        activeInfluenceIndices.sort(numericalSort);\r\n\r\n      }\r\n      else if (activeInfluenceIndices.length === 0) {\r\n\r\n        activeInfluenceIndices.push([0, 0]);\r\n\r\n      }\r\n\r\n      var attribute;\r\n\r\n      for (var m = 0, ml = material.numSupportedMorphTargets; m < ml; m++) {\r\n\r\n        if (activeInfluenceIndices[m]) {\r\n\r\n          var influenceIndex = activeInfluenceIndices[m][1];\r\n\r\n          attribute = attributes['morphTarget' + m];\r\n\r\n          if (attribute >= 0) {\r\n\r\n            _gl.bindBuffer(_gl.ARRAY_BUFFER, geometryGroup.__webglMorphTargetsBuffers[influenceIndex]);\r\n\r\n            state.enableAttribute(attribute);\r\n\r\n            _gl.vertexAttribPointer(attribute, 3, _gl.FLOAT, false, 0, 0);\r\n\r\n          }\r\n\r\n          attribute = attributes['morphNormal' + m];\r\n\r\n          if (attribute >= 0 && material.morphNormals) {\r\n\r\n            _gl.bindBuffer(_gl.ARRAY_BUFFER, geometryGroup.__webglMorphNormalsBuffers[influenceIndex]);\r\n\r\n            state.enableAttribute(attribute);\r\n\r\n            _gl.vertexAttribPointer(attribute, 3, _gl.FLOAT, false, 0, 0);\r\n\r\n          }\r\n\r\n          object.__webglMorphTargetInfluences[m] = influences[influenceIndex];\r\n\r\n        }\r\n        else {\r\n\r\n          /*\r\n          _gl.vertexAttribPointer( attributes[ \"morphTarget\" + m ], 3, _gl.FLOAT, false, 0, 0 );\r\n\r\n          if ( material.morphNormals ) {\r\n\r\n          \t_gl.vertexAttribPointer( attributes[ \"morphNormal\" + m ], 3, _gl.FLOAT, false, 0, 0 );\r\n\r\n          }\r\n          */\r\n\r\n          object.__webglMorphTargetInfluences[m] = 0;\r\n\r\n        }\r\n\r\n      }\r\n\r\n    }\r\n\r\n    // load updated influences uniform\r\n\r\n    if (material.program.uniforms.morphTargetInfluences !== null) {\r\n\r\n      _gl.uniform1fv(material.program.uniforms.morphTargetInfluences, object.__webglMorphTargetInfluences);\r\n\r\n    }\r\n\r\n  }\r\n\r\n  // Sorting\r\n\r\n  function painterSortStable(a, b) {\r\n\r\n    if (a.object.renderOrder !== b.object.renderOrder) {\r\n\r\n      return a.object.renderOrder - b.object.renderOrder;\r\n\r\n    }\r\n    else if (a.material.id !== b.material.id) {\r\n\r\n      return a.material.id - b.material.id;\r\n\r\n    }\r\n    else if (a.z !== b.z) {\r\n\r\n      return a.z - b.z;\r\n\r\n    }\r\n    else {\r\n\r\n      return a.id - b.id;\r\n\r\n    }\r\n\r\n  }\r\n\r\n  function reversePainterSortStable(a, b) {\r\n\r\n    if (a.object.renderOrder !== b.object.renderOrder) {\r\n\r\n      return a.object.renderOrder - b.object.renderOrder;\r\n\r\n    }\r\n    if (a.z !== b.z) {\r\n\r\n      return b.z - a.z;\r\n\r\n    }\r\n    else {\r\n\r\n      return a.id - b.id;\r\n\r\n    }\r\n\r\n  }\r\n\r\n  function numericalSort(a, b) {\r\n\r\n    return b[0] - a[0];\r\n\r\n  }\r\n\r\n  // Rendering\r\n\r\n  this.render = function(scene, camera, renderTarget, forceClear) {\r\n\r\n    if (camera instanceof THREE.Camera === false) {\r\n\r\n      THREE.error('THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.');\r\n      return;\r\n\r\n    }\r\n\r\n    var fog = scene.fog;\r\n\r\n    // reset caching for this frame\r\n\r\n    _currentGeometryProgram = '';\r\n    _currentMaterialId = -1;\r\n    _currentCamera = null;\r\n    _lightsNeedUpdate = true;\r\n\r\n    // update scene graph\r\n\r\n    if (scene.autoUpdate === true) scene.updateMatrixWorld();\r\n\r\n    // update camera matrices and frustum\r\n\r\n    if (camera.parent === undefined) camera.updateMatrixWorld();\r\n\r\n    // update Skeleton objects\r\n\r\n    scene.traverse(function(object) {\r\n\r\n      if (object instanceof THREE.SkinnedMesh) {\r\n\r\n        object.skeleton.update();\r\n\r\n      }\r\n\r\n    });\r\n\r\n    camera.matrixWorldInverse.getInverse(camera.matrixWorld);\r\n\r\n    _projScreenMatrix.multiplyMatrices(camera.projectionMatrix, camera.matrixWorldInverse);\r\n    _frustum.setFromMatrix(_projScreenMatrix);\r\n\r\n    lights.length = 0;\r\n    opaqueObjects.length = 0;\r\n    transparentObjects.length = 0;\r\n\r\n    sprites.length = 0;\r\n    lensFlares.length = 0;\r\n\r\n    projectObject(scene);\r\n\r\n    if (_this.sortObjects === true) {\r\n\r\n      opaqueObjects.sort(painterSortStable);\r\n      transparentObjects.sort(reversePainterSortStable);\r\n\r\n    }\r\n\r\n    // custom render plugins (pre pass)\r\n\r\n    shadowMapPlugin.render(scene, camera);\r\n\r\n    //\r\n\r\n    _this.info.render.calls = 0;\r\n    _this.info.render.vertices = 0;\r\n    _this.info.render.faces = 0;\r\n    _this.info.render.points = 0;\r\n\r\n    this.setRenderTarget(renderTarget);\r\n\r\n    if (this.autoClear || forceClear) {\r\n\r\n      this.clear(this.autoClearColor, this.autoClearDepth, this.autoClearStencil);\r\n\r\n    }\r\n\r\n    // set matrices for immediate objects\r\n\r\n    for (var i = 0, il = _webglObjectsImmediate.length; i < il; i++) {\r\n\r\n      var webglObject = _webglObjectsImmediate[i];\r\n      var object = webglObject.object;\r\n\r\n      if (object.visible) {\r\n\r\n        setupMatrices(object, camera);\r\n\r\n        unrollImmediateBufferMaterial(webglObject);\r\n\r\n      }\r\n\r\n    }\r\n\r\n    if (scene.overrideMaterial) {\r\n\r\n      var overrideMaterial = scene.overrideMaterial;\r\n\r\n      setMaterial(overrideMaterial);\r\n\r\n      renderObjects(opaqueObjects, camera, lights, fog, overrideMaterial);\r\n      renderObjects(transparentObjects, camera, lights, fog, overrideMaterial);\r\n      renderObjectsImmediate(_webglObjectsImmediate, '', camera, lights, fog, overrideMaterial);\r\n\r\n    }\r\n    else {\r\n\r\n      // opaque pass (front-to-back order)\r\n\r\n      state.setBlending(THREE.NoBlending);\r\n\r\n      renderObjects(opaqueObjects, camera, lights, fog, null);\r\n      renderObjectsImmediate(_webglObjectsImmediate, 'opaque', camera, lights, fog, null);\r\n\r\n      // transparent pass (back-to-front order)\r\n\r\n      renderObjects(transparentObjects, camera, lights, fog, null);\r\n      renderObjectsImmediate(_webglObjectsImmediate, 'transparent', camera, lights, fog, null);\r\n\r\n    }\r\n\r\n    // custom render plugins (post pass)\r\n\r\n    spritePlugin.render(scene, camera);\r\n    lensFlarePlugin.render(scene, camera, _currentWidth, _currentHeight);\r\n\r\n    // Generate mipmap if we're using any kind of mipmap filtering\r\n\r\n    if (renderTarget && renderTarget.generateMipmaps && renderTarget.minFilter !== THREE.NearestFilter && renderTarget.minFilter !== THREE.LinearFilter) {\r\n\r\n      updateRenderTargetMipmap(renderTarget);\r\n\r\n    }\r\n\r\n    // Ensure depth buffer writing is enabled so it can be cleared on next render\r\n\r\n    state.setDepthTest(true);\r\n    state.setDepthWrite(true);\r\n    state.setColorWrite(true);\r\n\r\n    // _gl.finish();\r\n\r\n  };\r\n\r\n  function projectObject(object) {\r\n\r\n    if (object.visible === false) return;\r\n\r\n    if (object instanceof THREE.Scene || object instanceof THREE.Group) {\r\n\r\n      // skip\r\n\r\n    }\r\n    else {\r\n\r\n      initObject(object);\r\n\r\n      if (object instanceof THREE.Light) {\r\n\r\n        lights.push(object);\r\n\r\n      }\r\n      else if (object instanceof THREE.Sprite) {\r\n\r\n        sprites.push(object);\r\n\r\n      }\r\n      else if (object instanceof THREE.LensFlare) {\r\n\r\n        lensFlares.push(object);\r\n\r\n      }\r\n      else {\r\n\r\n        var webglObjects = _webglObjects[object.id];\r\n\r\n        if (webglObjects && (object.frustumCulled === false || _frustum.intersectsObject(object) === true)) {\r\n\r\n          for (var i = 0, l = webglObjects.length; i < l; i++) {\r\n\r\n            var webglObject = webglObjects[i];\r\n\r\n            unrollBufferMaterial(webglObject);\r\n\r\n            webglObject.render = true;\r\n\r\n            if (_this.sortObjects === true) {\r\n\r\n              _vector3.setFromMatrixPosition(object.matrixWorld);\r\n              _vector3.applyProjection(_projScreenMatrix);\r\n\r\n              webglObject.z = _vector3.z;\r\n\r\n            }\r\n\r\n          }\r\n\r\n        }\r\n\r\n      }\r\n\r\n    }\r\n\r\n    for (var i = 0, l = object.children.length; i < l; i++) {\r\n\r\n      projectObject(object.children[i]);\r\n\r\n    }\r\n\r\n  }\r\n\r\n  function renderObjects(renderList, camera, lights, fog, overrideMaterial) {\r\n\r\n    var material;\r\n\r\n    for (var i = 0, l = renderList.length; i < l; i++) {\r\n\r\n      var webglObject = renderList[i];\r\n\r\n      var object = webglObject.object;\r\n      var buffer = webglObject.buffer;\r\n\r\n      setupMatrices(object, camera);\r\n\r\n      if (overrideMaterial) {\r\n\r\n        material = overrideMaterial;\r\n\r\n      }\r\n      else {\r\n\r\n        material = webglObject.material;\r\n\r\n        if (!material) continue;\r\n\r\n        setMaterial(material);\r\n\r\n      }\r\n\r\n      _this.setMaterialFaces(material);\r\n\r\n      if (buffer instanceof THREE.BufferGeometry) {\r\n\r\n        _this.renderBufferDirect(camera, lights, fog, material, buffer, object);\r\n\r\n      }\r\n      else {\r\n\r\n        _this.renderBuffer(camera, lights, fog, material, buffer, object);\r\n\r\n      }\r\n\r\n    }\r\n\r\n  }\r\n\r\n  function renderObjectsImmediate(renderList, materialType, camera, lights, fog, overrideMaterial) {\r\n\r\n    var material;\r\n\r\n    for (var i = 0, l = renderList.length; i < l; i++) {\r\n\r\n      var webglObject = renderList[i];\r\n      var object = webglObject.object;\r\n\r\n      if (object.visible) {\r\n\r\n        if (overrideMaterial) {\r\n\r\n          material = overrideMaterial;\r\n\r\n        }\r\n        else {\r\n\r\n          material = webglObject[materialType];\r\n\r\n          if (!material) continue;\r\n\r\n          setMaterial(material);\r\n\r\n        }\r\n\r\n        _this.renderImmediateObject(camera, lights, fog, material, object);\r\n\r\n      }\r\n\r\n    }\r\n\r\n  }\r\n\r\n  this.renderImmediateObject = function(camera, lights, fog, material, object) {\r\n\r\n    var program = setProgram(camera, lights, fog, material, object);\r\n\r\n    _currentGeometryProgram = '';\r\n\r\n    _this.setMaterialFaces(material);\r\n\r\n    if (object.immediateRenderCallback) {\r\n\r\n      object.immediateRenderCallback(program, _gl, _frustum);\r\n\r\n    }\r\n    else {\r\n\r\n      object.render(function(object) {\r\n        _this.renderBufferImmediate(object, program, material);\r\n      });\r\n\r\n    }\r\n\r\n  };\r\n\r\n  function unrollImmediateBufferMaterial(globject) {\r\n\r\n    var object = globject.object,\r\n      material = object.material;\r\n\r\n    if (material.transparent) {\r\n\r\n      globject.transparent = material;\r\n      globject.opaque = null;\r\n\r\n    }\r\n    else {\r\n\r\n      globject.opaque = material;\r\n      globject.transparent = null;\r\n\r\n    }\r\n\r\n  }\r\n\r\n  function unrollBufferMaterial(globject) {\r\n\r\n    var object = globject.object;\r\n    var buffer = globject.buffer;\r\n\r\n    var geometry = object.geometry;\r\n    var material = object.material;\r\n\r\n    if (material instanceof THREE.MeshFaceMaterial) {\r\n\r\n      var materialIndex = geometry instanceof THREE.BufferGeometry ? 0 : buffer.materialIndex;\r\n\r\n      material = material.materials[materialIndex];\r\n\r\n      globject.material = material;\r\n\r\n      if (material.transparent) {\r\n\r\n        transparentObjects.push(globject);\r\n\r\n      }\r\n      else {\r\n\r\n        opaqueObjects.push(globject);\r\n\r\n      }\r\n\r\n    }\r\n    else if (material) {\r\n\r\n      globject.material = material;\r\n\r\n      if (material.transparent) {\r\n\r\n        transparentObjects.push(globject);\r\n\r\n      }\r\n      else {\r\n\r\n        opaqueObjects.push(globject);\r\n\r\n      }\r\n\r\n    }\r\n\r\n  }\r\n\r\n  function initObject(object) {\r\n\r\n    if (object.__webglInit === undefined) {\r\n\r\n      object.__webglInit = true;\r\n      object._modelViewMatrix = new THREE.Matrix4();\r\n      object._normalMatrix = new THREE.Matrix3();\r\n\r\n      object.addEventListener('removed', onObjectRemoved);\r\n\r\n    }\r\n\r\n    var geometry = object.geometry;\r\n\r\n    if (geometry === undefined) {\r\n\r\n      // ImmediateRenderObject\r\n\r\n    }\r\n    else if (geometry.__webglInit === undefined) {\r\n\r\n      geometry.__webglInit = true;\r\n      geometry.addEventListener('dispose', onGeometryDispose);\r\n\r\n      if (geometry instanceof THREE.BufferGeometry) {\r\n\r\n        _this.info.memory.geometries++;\r\n\r\n      }\r\n      else if (object instanceof THREE.Mesh) {\r\n\r\n        initGeometryGroups(object, geometry);\r\n\r\n      }\r\n      else if (object instanceof THREE.Line) {\r\n\r\n        if (geometry.__webglVertexBuffer === undefined) {\r\n\r\n          createLineBuffers(geometry);\r\n          initLineBuffers(geometry, object);\r\n\r\n          geometry.verticesNeedUpdate = true;\r\n          geometry.colorsNeedUpdate = true;\r\n          geometry.lineDistancesNeedUpdate = true;\r\n\r\n        }\r\n\r\n      }\r\n      else if (object instanceof THREE.PointCloud) {\r\n\r\n        if (geometry.__webglVertexBuffer === undefined) {\r\n\r\n          createParticleBuffers(geometry);\r\n          initParticleBuffers(geometry, object);\r\n\r\n          geometry.verticesNeedUpdate = true;\r\n          geometry.colorsNeedUpdate = true;\r\n\r\n        }\r\n\r\n      }\r\n\r\n    }\r\n\r\n    if (object.__webglActive === undefined) {\r\n\r\n      object.__webglActive = true;\r\n\r\n      if (object instanceof THREE.Mesh) {\r\n\r\n        if (geometry instanceof THREE.BufferGeometry) {\r\n\r\n          addBuffer(_webglObjects, geometry, object);\r\n\r\n        }\r\n        else if (geometry instanceof THREE.Geometry) {\r\n\r\n          var geometryGroupsList = geometryGroups[geometry.id];\r\n\r\n          for (var i = 0, l = geometryGroupsList.length; i < l; i++) {\r\n\r\n            addBuffer(_webglObjects, geometryGroupsList[i], object);\r\n\r\n          }\r\n\r\n        }\r\n\r\n      }\r\n      else if (object instanceof THREE.Line || object instanceof THREE.PointCloud) {\r\n\r\n        addBuffer(_webglObjects, geometry, object);\r\n\r\n      }\r\n      else if (object instanceof THREE.ImmediateRenderObject || object.immediateRenderCallback) {\r\n\r\n        addBufferImmediate(_webglObjectsImmediate, object);\r\n\r\n      }\r\n\r\n    }\r\n\r\n  }\r\n\r\n  // Geometry splitting\r\n\r\n  var geometryGroups = {};\r\n  var geometryGroupCounter = 0;\r\n\r\n  function makeGroups(geometry, usesFaceMaterial) {\r\n\r\n    var maxVerticesInGroup = extensions.get('OES_element_index_uint') ? 4294967296 : 65535;\r\n\r\n    var groupHash, hash_map = {};\r\n\r\n    var numMorphTargets = geometry.morphTargets.length;\r\n    var numMorphNormals = geometry.morphNormals.length;\r\n\r\n    var group;\r\n    var groups = {};\r\n    var groupsList = [];\r\n\r\n    for (var f = 0, fl = geometry.faces.length; f < fl; f++) {\r\n\r\n      var face = geometry.faces[f];\r\n      var materialIndex = usesFaceMaterial ? face.materialIndex : 0;\r\n\r\n      if (!(materialIndex in hash_map)) {\r\n\r\n        hash_map[materialIndex] = {\r\n          hash: materialIndex,\r\n          counter: 0\r\n        };\r\n\r\n      }\r\n\r\n      groupHash = hash_map[materialIndex].hash + '_' + hash_map[materialIndex].counter;\r\n\r\n      if (!(groupHash in groups)) {\r\n\r\n        group = {\r\n          id: geometryGroupCounter++,\r\n          faces3: [],\r\n          materialIndex: materialIndex,\r\n          vertices: 0,\r\n          numMorphTargets: numMorphTargets,\r\n          numMorphNormals: numMorphNormals\r\n        };\r\n\r\n        groups[groupHash] = group;\r\n        groupsList.push(group);\r\n\r\n      }\r\n\r\n      if (groups[groupHash].vertices + 3 > maxVerticesInGroup) {\r\n\r\n        hash_map[materialIndex].counter += 1;\r\n        groupHash = hash_map[materialIndex].hash + '_' + hash_map[materialIndex].counter;\r\n\r\n        if (!(groupHash in groups)) {\r\n\r\n          group = {\r\n            id: geometryGroupCounter++,\r\n            faces3: [],\r\n            materialIndex: materialIndex,\r\n            vertices: 0,\r\n            numMorphTargets: numMorphTargets,\r\n            numMorphNormals: numMorphNormals\r\n          };\r\n\r\n          groups[groupHash] = group;\r\n          groupsList.push(group);\r\n\r\n        }\r\n\r\n      }\r\n\r\n      groups[groupHash].faces3.push(f);\r\n      groups[groupHash].vertices += 3;\r\n\r\n    }\r\n\r\n    return groupsList;\r\n\r\n  }\r\n\r\n  function initGeometryGroups(object, geometry) {\r\n\r\n    var material = object.material,\r\n      addBuffers = false;\r\n\r\n    if (geometryGroups[geometry.id] === undefined || geometry.groupsNeedUpdate === true) {\r\n\r\n      delete _webglObjects[object.id];\r\n\r\n      geometryGroups[geometry.id] = makeGroups(geometry, material instanceof THREE.MeshFaceMaterial);\r\n\r\n      geometry.groupsNeedUpdate = false;\r\n\r\n    }\r\n\r\n    var geometryGroupsList = geometryGroups[geometry.id];\r\n\r\n    // create separate VBOs per geometry chunk\r\n\r\n    for (var i = 0, il = geometryGroupsList.length; i < il; i++) {\r\n\r\n      var geometryGroup = geometryGroupsList[i];\r\n\r\n      // initialise VBO on the first access\r\n\r\n      if (geometryGroup.__webglVertexBuffer === undefined) {\r\n\r\n        createMeshBuffers(geometryGroup);\r\n        initMeshBuffers(geometryGroup, object);\r\n\r\n        geometry.verticesNeedUpdate = true;\r\n        geometry.morphTargetsNeedUpdate = true;\r\n        geometry.elementsNeedUpdate = true;\r\n        geometry.uvsNeedUpdate = true;\r\n        geometry.normalsNeedUpdate = true;\r\n        geometry.tangentsNeedUpdate = true;\r\n        geometry.colorsNeedUpdate = true;\r\n\r\n        addBuffers = true;\r\n\r\n      }\r\n      else {\r\n\r\n        addBuffers = false;\r\n\r\n      }\r\n\r\n      if (addBuffers || object.__webglActive === undefined) {\r\n\r\n        addBuffer(_webglObjects, geometryGroup, object);\r\n\r\n      }\r\n\r\n    }\r\n\r\n    object.__webglActive = true;\r\n\r\n  }\r\n\r\n  function addBuffer(objlist, buffer, object) {\r\n\r\n    var id = object.id;\r\n    objlist[id] = objlist[id] || [];\r\n    objlist[id].push({\r\n      id: id,\r\n      buffer: buffer,\r\n      object: object,\r\n      material: null,\r\n      z: 0\r\n    });\r\n\r\n  };\r\n\r\n  function addBufferImmediate(objlist, object) {\r\n\r\n    objlist.push({\r\n      id: null,\r\n      object: object,\r\n      opaque: null,\r\n      transparent: null,\r\n      z: 0\r\n    });\r\n\r\n  };\r\n\r\n  // Objects updates\r\n\r\n  function updateObject(object) {\r\n\r\n    var geometry = object.geometry;\r\n\r\n    if (geometry instanceof THREE.BufferGeometry) {\r\n\r\n      var attributes = geometry.attributes;\r\n      var attributesKeys = geometry.attributesKeys;\r\n\r\n      for (var i = 0, l = attributesKeys.length; i < l; i++) {\r\n\r\n        var key = attributesKeys[i];\r\n        var attribute = attributes[key];\r\n        var bufferType = (key === 'index') ? _gl.ELEMENT_ARRAY_BUFFER : _gl.ARRAY_BUFFER;\r\n\r\n        if (attribute.buffer === undefined) {\r\n\r\n          attribute.buffer = _gl.createBuffer();\r\n          _gl.bindBuffer(bufferType, attribute.buffer);\r\n          _gl.bufferData(bufferType, attribute.array, (attribute instanceof THREE.DynamicBufferAttribute) ? _gl.DYNAMIC_DRAW : _gl.STATIC_DRAW);\r\n\r\n          attribute.needsUpdate = false;\r\n\r\n        }\r\n        else if (attribute.needsUpdate === true) {\r\n\r\n          _gl.bindBuffer(bufferType, attribute.buffer);\r\n\r\n          if (attribute.updateRange === undefined || attribute.updateRange.count === -1) { // Not using update ranges\r\n\r\n            _gl.bufferSubData(bufferType, 0, attribute.array);\r\n\r\n          }\r\n          else if (attribute.updateRange.count === 0) {\r\n\r\n            console.error('THREE.WebGLRenderer.updateObject: using updateRange for THREE.DynamicBufferAttribute and marked as needsUpdate but count is 0, ensure you are using set methods or updating manually.');\r\n\r\n          }\r\n          else {\r\n\r\n            _gl.bufferSubData(bufferType, attribute.updateRange.offset * attribute.array.BYTES_PER_ELEMENT,\r\n              attribute.array.subarray(attribute.updateRange.offset, attribute.updateRange.offset + attribute.updateRange.count));\r\n\r\n            attribute.updateRange.count = 0; // reset range\r\n\r\n          }\r\n\r\n          attribute.needsUpdate = false;\r\n\r\n        }\r\n\r\n      }\r\n\r\n    }\r\n    else if (object instanceof THREE.Mesh) {\r\n\r\n      // check all geometry groups\r\n\r\n      if (geometry.groupsNeedUpdate === true) {\r\n\r\n        initGeometryGroups(object, geometry);\r\n\r\n      }\r\n\r\n      var geometryGroupsList = geometryGroups[geometry.id];\r\n\r\n      for (var i = 0, il = geometryGroupsList.length; i < il; i++) {\r\n\r\n        var geometryGroup = geometryGroupsList[i];\r\n        var material = getBufferMaterial(object, geometryGroup);\r\n\r\n        var customAttributesDirty = material.attributes && areCustomAttributesDirty(material);\r\n\r\n        if (geometry.verticesNeedUpdate || geometry.morphTargetsNeedUpdate || geometry.elementsNeedUpdate ||\r\n          geometry.uvsNeedUpdate || geometry.normalsNeedUpdate ||\r\n          geometry.colorsNeedUpdate || geometry.tangentsNeedUpdate || customAttributesDirty) {\r\n\r\n          setMeshBuffers(geometryGroup, object, _gl.DYNAMIC_DRAW, !geometry.dynamic, material);\r\n\r\n        }\r\n\r\n      }\r\n\r\n      geometry.verticesNeedUpdate = false;\r\n      geometry.morphTargetsNeedUpdate = false;\r\n      geometry.elementsNeedUpdate = false;\r\n      geometry.uvsNeedUpdate = false;\r\n      geometry.normalsNeedUpdate = false;\r\n      geometry.colorsNeedUpdate = false;\r\n      geometry.tangentsNeedUpdate = false;\r\n\r\n      material.attributes && clearCustomAttributes(material);\r\n\r\n    }\r\n    else if (object instanceof THREE.Line) {\r\n\r\n      var material = getBufferMaterial(object, geometry);\r\n      var customAttributesDirty = material.attributes && areCustomAttributesDirty(material);\r\n\r\n      if (geometry.verticesNeedUpdate || geometry.colorsNeedUpdate || geometry.lineDistancesNeedUpdate || customAttributesDirty) {\r\n\r\n        setLineBuffers(geometry, _gl.DYNAMIC_DRAW);\r\n\r\n      }\r\n\r\n      geometry.verticesNeedUpdate = false;\r\n      geometry.colorsNeedUpdate = false;\r\n      geometry.lineDistancesNeedUpdate = false;\r\n\r\n      material.attributes && clearCustomAttributes(material);\r\n\r\n    }\r\n    else if (object instanceof THREE.PointCloud) {\r\n\r\n      var material = getBufferMaterial(object, geometry);\r\n      var customAttributesDirty = material.attributes && areCustomAttributesDirty(material);\r\n\r\n      if (geometry.verticesNeedUpdate || geometry.colorsNeedUpdate || customAttributesDirty) {\r\n\r\n        setParticleBuffers(geometry, _gl.DYNAMIC_DRAW, object);\r\n\r\n      }\r\n\r\n      geometry.verticesNeedUpdate = false;\r\n      geometry.colorsNeedUpdate = false;\r\n\r\n      material.attributes && clearCustomAttributes(material);\r\n\r\n    }\r\n\r\n  }\r\n\r\n  // Objects updates - custom attributes check\r\n\r\n  function areCustomAttributesDirty(material) {\r\n\r\n    for (var name in material.attributes) {\r\n\r\n      if (material.attributes[name].needsUpdate) return true;\r\n\r\n    }\r\n\r\n    return false;\r\n\r\n  }\r\n\r\n  function clearCustomAttributes(material) {\r\n\r\n    for (var name in material.attributes) {\r\n\r\n      material.attributes[name].needsUpdate = false;\r\n\r\n    }\r\n\r\n  }\r\n\r\n  // Objects removal\r\n\r\n  function removeObject(object) {\r\n\r\n    if (object instanceof THREE.Mesh ||\r\n      object instanceof THREE.PointCloud ||\r\n      object instanceof THREE.Line) {\r\n\r\n      delete _webglObjects[object.id];\r\n\r\n    }\r\n    else if (object instanceof THREE.ImmediateRenderObject || object.immediateRenderCallback) {\r\n\r\n      removeInstances(_webglObjectsImmediate, object);\r\n\r\n    }\r\n\r\n    delete object.__webglInit;\r\n    delete object._modelViewMatrix;\r\n    delete object._normalMatrix;\r\n\r\n    delete object.__webglActive;\r\n\r\n  }\r\n\r\n  function removeInstances(objlist, object) {\r\n\r\n    for (var o = objlist.length - 1; o >= 0; o--) {\r\n\r\n      if (objlist[o].object === object) {\r\n\r\n        objlist.splice(o, 1);\r\n\r\n      }\r\n\r\n    }\r\n\r\n  }\r\n\r\n  // Materials\r\n\r\n  var shaderIDs = {\r\n    MeshDepthMaterial: 'depth',\r\n    MeshNormalMaterial: 'normal',\r\n    MeshBasicMaterial: 'basic',\r\n    MeshLambertMaterial: 'lambert',\r\n    MeshPhongMaterial: 'phong',\r\n    LineBasicMaterial: 'basic',\r\n    LineDashedMaterial: 'dashed',\r\n    PointCloudMaterial: 'particle_basic'\r\n  };\r\n\r\n  function initMaterial(material, lights, fog, object) {\r\n\r\n    material.addEventListener('dispose', onMaterialDispose);\r\n\r\n    var shaderID = shaderIDs[material.type];\r\n\r\n    if (shaderID) {\r\n\r\n      var shader = THREE.ShaderLib[shaderID];\r\n\r\n      material.__webglShader = {\r\n        uniforms: THREE.UniformsUtils.clone(shader.uniforms),\r\n        vertexShader: shader.vertexShader,\r\n        fragmentShader: shader.fragmentShader\r\n      }\r\n\r\n    }\r\n    else {\r\n\r\n      material.__webglShader = {\r\n        uniforms: material.uniforms,\r\n        vertexShader: material.vertexShader,\r\n        fragmentShader: material.fragmentShader\r\n      }\r\n\r\n    }\r\n\r\n    // heuristics to create shader parameters according to lights in the scene\r\n    // (not to blow over maxLights budget)\r\n\r\n    var maxLightCount = allocateLights(lights);\r\n    var maxShadows = allocateShadows(lights);\r\n    var maxBones = allocateBones(object);\r\n\r\n    var parameters = {\r\n\r\n      precision: _precision,\r\n      supportsVertexTextures: _supportsVertexTextures,\r\n\r\n      map: !!material.map,\r\n      envMap: !!material.envMap,\r\n      envMapMode: material.envMap && material.envMap.mapping,\r\n      lightMap: !!material.lightMap,\r\n      bumpMap: !!material.bumpMap,\r\n      normalMap: !!material.normalMap,\r\n      specularMap: !!material.specularMap,\r\n      alphaMap: !!material.alphaMap,\r\n\r\n      combine: material.combine,\r\n\r\n      vertexColors: material.vertexColors,\r\n\r\n      fog: fog,\r\n      useFog: material.fog,\r\n      fogExp: fog instanceof THREE.FogExp2,\r\n\r\n      flatShading: material.shading === THREE.FlatShading,\r\n\r\n      sizeAttenuation: material.sizeAttenuation,\r\n      logarithmicDepthBuffer: _logarithmicDepthBuffer,\r\n\r\n      skinning: material.skinning,\r\n      maxBones: maxBones,\r\n      useVertexTexture: _supportsBoneTextures && object && object.skeleton && object.skeleton.useVertexTexture,\r\n\r\n      morphTargets: material.morphTargets,\r\n      morphNormals: material.morphNormals,\r\n      maxMorphTargets: _this.maxMorphTargets,\r\n      maxMorphNormals: _this.maxMorphNormals,\r\n\r\n      maxDirLights: maxLightCount.directional,\r\n      maxPointLights: maxLightCount.point,\r\n      maxSpotLights: maxLightCount.spot,\r\n      maxHemiLights: maxLightCount.hemi,\r\n\r\n      maxShadows: maxShadows,\r\n      shadowMapEnabled: _this.shadowMapEnabled && object.receiveShadow && maxShadows > 0,\r\n      shadowMapType: _this.shadowMapType,\r\n      shadowMapDebug: _this.shadowMapDebug,\r\n      shadowMapCascade: _this.shadowMapCascade,\r\n\r\n      alphaTest: material.alphaTest,\r\n      metal: material.metal,\r\n      wrapAround: material.wrapAround,\r\n      doubleSided: material.side === THREE.DoubleSide,\r\n      flipSided: material.side === THREE.BackSide\r\n\r\n    };\r\n\r\n    // Generate code\r\n\r\n    var chunks = [];\r\n\r\n    if (shaderID) {\r\n\r\n      chunks.push(shaderID);\r\n\r\n    }\r\n    else {\r\n\r\n      chunks.push(material.fragmentShader);\r\n      chunks.push(material.vertexShader);\r\n\r\n    }\r\n\r\n    if (material.defines !== undefined) {\r\n\r\n      for (var name in material.defines) {\r\n\r\n        chunks.push(name);\r\n        chunks.push(material.defines[name]);\r\n\r\n      }\r\n\r\n    }\r\n\r\n    for (var name in parameters) {\r\n\r\n      chunks.push(name);\r\n      chunks.push(parameters[name]);\r\n\r\n    }\r\n\r\n    var code = chunks.join();\r\n\r\n    var program;\r\n\r\n    // Check if code has been already compiled\r\n\r\n    for (var p = 0, pl = _programs.length; p < pl; p++) {\r\n\r\n      var programInfo = _programs[p];\r\n\r\n      if (programInfo.code === code) {\r\n\r\n        program = programInfo;\r\n        program.usedTimes++;\r\n\r\n        break;\r\n\r\n      }\r\n\r\n    }\r\n\r\n    if (program === undefined) {\r\n\r\n      program = new THREE.WebGLProgram(_this, code, material, parameters);\r\n      _programs.push(program);\r\n\r\n      _this.info.memory.programs = _programs.length;\r\n\r\n    }\r\n\r\n    material.program = program;\r\n\r\n    var attributes = program.attributes;\r\n\r\n    if (material.morphTargets) {\r\n\r\n      material.numSupportedMorphTargets = 0;\r\n\r\n      var id, base = 'morphTarget';\r\n\r\n      for (var i = 0; i < _this.maxMorphTargets; i++) {\r\n\r\n        id = base + i;\r\n\r\n        if (attributes[id] >= 0) {\r\n\r\n          material.numSupportedMorphTargets++;\r\n\r\n        }\r\n\r\n      }\r\n\r\n    }\r\n\r\n    if (material.morphNormals) {\r\n\r\n      material.numSupportedMorphNormals = 0;\r\n\r\n      var id, base = 'morphNormal';\r\n\r\n      for (i = 0; i < _this.maxMorphNormals; i++) {\r\n\r\n        id = base + i;\r\n\r\n        if (attributes[id] >= 0) {\r\n\r\n          material.numSupportedMorphNormals++;\r\n\r\n        }\r\n\r\n      }\r\n\r\n    }\r\n\r\n    material.uniformsList = [];\r\n\r\n    for (var u in material.__webglShader.uniforms) {\r\n\r\n      var location = material.program.uniforms[u];\r\n\r\n      if (location) {\r\n        material.uniformsList.push([material.__webglShader.uniforms[u], location]);\r\n      }\r\n\r\n    }\r\n\r\n  }\r\n\r\n  function setMaterial(material) {\r\n\r\n    if (material.transparent === true) {\r\n\r\n      state.setBlending(material.blending, material.blendEquation, material.blendSrc, material.blendDst, material.blendEquationAlpha, material.blendSrcAlpha, material.blendDstAlpha);\r\n\r\n    }\r\n    else {\r\n\r\n      state.setBlending(THREE.NoBlending);\r\n\r\n    }\r\n\r\n    state.setDepthTest(material.depthTest);\r\n    state.setDepthWrite(material.depthWrite);\r\n    state.setColorWrite(material.colorWrite);\r\n    state.setPolygonOffset(material.polygonOffset, material.polygonOffsetFactor, material.polygonOffsetUnits);\r\n\r\n  }\r\n\r\n  function setProgram(camera, lights, fog, material, object) {\r\n\r\n    _usedTextureUnits = 0;\r\n\r\n    if (material.needsUpdate) {\r\n\r\n      if (material.program) deallocateMaterial(material);\r\n\r\n      initMaterial(material, lights, fog, object);\r\n      material.needsUpdate = false;\r\n\r\n    }\r\n\r\n    if (material.morphTargets) {\r\n\r\n      if (!object.__webglMorphTargetInfluences) {\r\n\r\n        object.__webglMorphTargetInfluences = new Float32Array(_this.maxMorphTargets);\r\n\r\n      }\r\n\r\n    }\r\n\r\n    var refreshProgram = false;\r\n    var refreshMaterial = false;\r\n    var refreshLights = false;\r\n\r\n    var program = material.program,\r\n      p_uniforms = program.uniforms,\r\n      m_uniforms = material.__webglShader.uniforms;\r\n\r\n    if (program.id !== _currentProgram) {\r\n\r\n      _gl.useProgram(program.program);\r\n      _currentProgram = program.id;\r\n\r\n      refreshProgram = true;\r\n      refreshMaterial = true;\r\n      refreshLights = true;\r\n\r\n    }\r\n\r\n    if (material.id !== _currentMaterialId) {\r\n\r\n      if (_currentMaterialId === -1) refreshLights = true;\r\n      _currentMaterialId = material.id;\r\n\r\n      refreshMaterial = true;\r\n\r\n    }\r\n\r\n    if (refreshProgram || camera !== _currentCamera) {\r\n\r\n      _gl.uniformMatrix4fv(p_uniforms.projectionMatrix, false, camera.projectionMatrix.elements);\r\n\r\n      if (_logarithmicDepthBuffer) {\r\n\r\n        _gl.uniform1f(p_uniforms.logDepthBufFC, 2.0 / (Math.log(camera.far + 1.0) / Math.LN2));\r\n\r\n      }\r\n\r\n\r\n      if (camera !== _currentCamera) _currentCamera = camera;\r\n\r\n      // load material specific uniforms\r\n      // (shader material also gets them for the sake of genericity)\r\n\r\n      if (material instanceof THREE.ShaderMaterial ||\r\n        material instanceof THREE.MeshPhongMaterial ||\r\n        material.envMap) {\r\n\r\n        if (p_uniforms.cameraPosition !== null) {\r\n\r\n          _vector3.setFromMatrixPosition(camera.matrixWorld);\r\n          _gl.uniform3f(p_uniforms.cameraPosition, _vector3.x, _vector3.y, _vector3.z);\r\n\r\n        }\r\n\r\n      }\r\n\r\n      if (material instanceof THREE.MeshPhongMaterial ||\r\n        material instanceof THREE.MeshLambertMaterial ||\r\n        material instanceof THREE.MeshBasicMaterial ||\r\n        material instanceof THREE.ShaderMaterial ||\r\n        material.skinning) {\r\n\r\n        if (p_uniforms.viewMatrix !== null) {\r\n\r\n          _gl.uniformMatrix4fv(p_uniforms.viewMatrix, false, camera.matrixWorldInverse.elements);\r\n\r\n        }\r\n\r\n      }\r\n\r\n    }\r\n\r\n    // skinning uniforms must be set even if material didn't change\r\n    // auto-setting of texture unit for bone texture must go before other textures\r\n    // not sure why, but otherwise weird things happen\r\n\r\n    if (material.skinning) {\r\n\r\n      if (object.bindMatrix && p_uniforms.bindMatrix !== null) {\r\n\r\n        _gl.uniformMatrix4fv(p_uniforms.bindMatrix, false, object.bindMatrix.elements);\r\n\r\n      }\r\n\r\n      if (object.bindMatrixInverse && p_uniforms.bindMatrixInverse !== null) {\r\n\r\n        _gl.uniformMatrix4fv(p_uniforms.bindMatrixInverse, false, object.bindMatrixInverse.elements);\r\n\r\n      }\r\n\r\n      if (_supportsBoneTextures && object.skeleton && object.skeleton.useVertexTexture) {\r\n\r\n        if (p_uniforms.boneTexture !== null) {\r\n\r\n          var textureUnit = getTextureUnit();\r\n\r\n          _gl.uniform1i(p_uniforms.boneTexture, textureUnit);\r\n          _this.setTexture(object.skeleton.boneTexture, textureUnit);\r\n\r\n        }\r\n\r\n        if (p_uniforms.boneTextureWidth !== null) {\r\n\r\n          _gl.uniform1i(p_uniforms.boneTextureWidth, object.skeleton.boneTextureWidth);\r\n\r\n        }\r\n\r\n        if (p_uniforms.boneTextureHeight !== null) {\r\n\r\n          _gl.uniform1i(p_uniforms.boneTextureHeight, object.skeleton.boneTextureHeight);\r\n\r\n        }\r\n\r\n      }\r\n      else if (object.skeleton && object.skeleton.boneMatrices) {\r\n\r\n        if (p_uniforms.boneGlobalMatrices !== null) {\r\n\r\n          _gl.uniformMatrix4fv(p_uniforms.boneGlobalMatrices, false, object.skeleton.boneMatrices);\r\n\r\n        }\r\n\r\n      }\r\n\r\n    }\r\n\r\n    if (refreshMaterial) {\r\n\r\n      // refresh uniforms common to several materials\r\n\r\n      if (fog && material.fog) {\r\n\r\n        refreshUniformsFog(m_uniforms, fog);\r\n\r\n      }\r\n\r\n      if (material instanceof THREE.MeshPhongMaterial ||\r\n        material instanceof THREE.MeshLambertMaterial ||\r\n        material.lights) {\r\n\r\n        if (_lightsNeedUpdate) {\r\n\r\n          refreshLights = true;\r\n          setupLights(lights);\r\n          _lightsNeedUpdate = false;\r\n        }\r\n\r\n        if (refreshLights) {\r\n          refreshUniformsLights(m_uniforms, _lights);\r\n          markUniformsLightsNeedsUpdate(m_uniforms, true);\r\n        }\r\n        else {\r\n          markUniformsLightsNeedsUpdate(m_uniforms, false);\r\n        }\r\n\r\n      }\r\n\r\n      if (material instanceof THREE.MeshBasicMaterial ||\r\n        material instanceof THREE.MeshLambertMaterial ||\r\n        material instanceof THREE.MeshPhongMaterial) {\r\n\r\n        refreshUniformsCommon(m_uniforms, material);\r\n\r\n      }\r\n\r\n      // refresh single material specific uniforms\r\n\r\n      if (material instanceof THREE.LineBasicMaterial) {\r\n\r\n        refreshUniformsLine(m_uniforms, material);\r\n\r\n      }\r\n      else if (material instanceof THREE.LineDashedMaterial) {\r\n\r\n        refreshUniformsLine(m_uniforms, material);\r\n        refreshUniformsDash(m_uniforms, material);\r\n\r\n      }\r\n      else if (material instanceof THREE.PointCloudMaterial) {\r\n\r\n        refreshUniformsParticle(m_uniforms, material);\r\n\r\n      }\r\n      else if (material instanceof THREE.MeshPhongMaterial) {\r\n\r\n        refreshUniformsPhong(m_uniforms, material);\r\n\r\n      }\r\n      else if (material instanceof THREE.MeshLambertMaterial) {\r\n\r\n        refreshUniformsLambert(m_uniforms, material);\r\n\r\n      }\r\n      else if (material instanceof THREE.MeshDepthMaterial) {\r\n\r\n        m_uniforms.mNear.value = camera.near;\r\n        m_uniforms.mFar.value = camera.far;\r\n        m_uniforms.opacity.value = material.opacity;\r\n\r\n      }\r\n      else if (material instanceof THREE.MeshNormalMaterial) {\r\n\r\n        m_uniforms.opacity.value = material.opacity;\r\n\r\n      }\r\n\r\n      if (object.receiveShadow && !material._shadowPass) {\r\n\r\n        refreshUniformsShadow(m_uniforms, lights);\r\n\r\n      }\r\n\r\n      // load common uniforms\r\n\r\n      loadUniformsGeneric(material.uniformsList);\r\n\r\n    }\r\n\r\n    loadUniformsMatrices(p_uniforms, object);\r\n\r\n    if (p_uniforms.modelMatrix !== null) {\r\n\r\n      _gl.uniformMatrix4fv(p_uniforms.modelMatrix, false, object.matrixWorld.elements);\r\n\r\n    }\r\n\r\n    return program;\r\n\r\n  }\r\n\r\n  // Uniforms (refresh uniforms objects)\r\n\r\n  function refreshUniformsCommon(uniforms, material) {\r\n\r\n    uniforms.opacity.value = material.opacity;\r\n\r\n    uniforms.diffuse.value = material.color;\r\n\r\n    uniforms.map.value = material.map;\r\n    uniforms.lightMap.value = material.lightMap;\r\n    uniforms.specularMap.value = material.specularMap;\r\n    uniforms.alphaMap.value = material.alphaMap;\r\n\r\n    if (material.bumpMap) {\r\n\r\n      uniforms.bumpMap.value = material.bumpMap;\r\n      uniforms.bumpScale.value = material.bumpScale;\r\n\r\n    }\r\n\r\n    if (material.normalMap) {\r\n\r\n      uniforms.normalMap.value = material.normalMap;\r\n      uniforms.normalScale.value.copy(material.normalScale);\r\n\r\n    }\r\n\r\n    // uv repeat and offset setting priorities\r\n    //  1. color map\r\n    //  2. specular map\r\n    //  3. normal map\r\n    //  4. bump map\r\n    //  5. alpha map\r\n\r\n    var uvScaleMap;\r\n\r\n    if (material.map) {\r\n\r\n      uvScaleMap = material.map;\r\n\r\n    }\r\n    else if (material.specularMap) {\r\n\r\n      uvScaleMap = material.specularMap;\r\n\r\n    }\r\n    else if (material.normalMap) {\r\n\r\n      uvScaleMap = material.normalMap;\r\n\r\n    }\r\n    else if (material.bumpMap) {\r\n\r\n      uvScaleMap = material.bumpMap;\r\n\r\n    }\r\n    else if (material.alphaMap) {\r\n\r\n      uvScaleMap = material.alphaMap;\r\n\r\n    }\r\n\r\n    if (uvScaleMap !== undefined) {\r\n\r\n      var offset = uvScaleMap.offset;\r\n      var repeat = uvScaleMap.repeat;\r\n\r\n      uniforms.offsetRepeat.value.set(offset.x, offset.y, repeat.x, repeat.y);\r\n\r\n    }\r\n\r\n    uniforms.envMap.value = material.envMap;\r\n    uniforms.flipEnvMap.value = (material.envMap instanceof THREE.WebGLRenderTargetCube) ? 1 : -1;\r\n\r\n    uniforms.reflectivity.value = material.reflectivity;\r\n    uniforms.refractionRatio.value = material.refractionRatio;\r\n\r\n  }\r\n\r\n  function refreshUniformsLine(uniforms, material) {\r\n\r\n    uniforms.diffuse.value = material.color;\r\n    uniforms.opacity.value = material.opacity;\r\n\r\n  }\r\n\r\n  function refreshUniformsDash(uniforms, material) {\r\n\r\n    uniforms.dashSize.value = material.dashSize;\r\n    uniforms.totalSize.value = material.dashSize + material.gapSize;\r\n    uniforms.scale.value = material.scale;\r\n\r\n  }\r\n\r\n  function refreshUniformsParticle(uniforms, material) {\r\n\r\n    uniforms.psColor.value = material.color;\r\n    uniforms.opacity.value = material.opacity;\r\n    uniforms.size.value = material.size;\r\n    uniforms.scale.value = _canvas.height / 2.0; // TODO: Cache this.\r\n\r\n    uniforms.map.value = material.map;\r\n\r\n    if (material.map !== null) {\r\n\r\n      var offset = material.map.offset;\r\n      var repeat = material.map.repeat;\r\n\r\n      uniforms.offsetRepeat.value.set(offset.x, offset.y, repeat.x, repeat.y);\r\n\r\n    }\r\n\r\n  }\r\n\r\n  function refreshUniformsFog(uniforms, fog) {\r\n\r\n    uniforms.fogColor.value = fog.color;\r\n\r\n    if (fog instanceof THREE.Fog) {\r\n\r\n      uniforms.fogNear.value = fog.near;\r\n      uniforms.fogFar.value = fog.far;\r\n\r\n    }\r\n    else if (fog instanceof THREE.FogExp2) {\r\n\r\n      uniforms.fogDensity.value = fog.density;\r\n\r\n    }\r\n\r\n  }\r\n\r\n  function refreshUniformsPhong(uniforms, material) {\r\n\r\n    uniforms.shininess.value = material.shininess;\r\n\r\n    uniforms.emissive.value = material.emissive;\r\n    uniforms.specular.value = material.specular;\r\n\r\n    if (material.wrapAround) {\r\n\r\n      uniforms.wrapRGB.value.copy(material.wrapRGB);\r\n\r\n    }\r\n\r\n  }\r\n\r\n  function refreshUniformsLambert(uniforms, material) {\r\n\r\n    uniforms.emissive.value = material.emissive;\r\n\r\n    if (material.wrapAround) {\r\n\r\n      uniforms.wrapRGB.value.copy(material.wrapRGB);\r\n\r\n    }\r\n\r\n  }\r\n\r\n  function refreshUniformsLights(uniforms, lights) {\r\n\r\n    uniforms.ambientLightColor.value = lights.ambient;\r\n\r\n    uniforms.directionalLightColor.value = lights.directional.colors;\r\n    uniforms.directionalLightDirection.value = lights.directional.positions;\r\n\r\n    uniforms.pointLightColor.value = lights.point.colors;\r\n    uniforms.pointLightPosition.value = lights.point.positions;\r\n    uniforms.pointLightDistance.value = lights.point.distances;\r\n    uniforms.pointLightDecay.value = lights.point.decays;\r\n\r\n    uniforms.spotLightColor.value = lights.spot.colors;\r\n    uniforms.spotLightPosition.value = lights.spot.positions;\r\n    uniforms.spotLightDistance.value = lights.spot.distances;\r\n    uniforms.spotLightDirection.value = lights.spot.directions;\r\n    uniforms.spotLightAngleCos.value = lights.spot.anglesCos;\r\n    uniforms.spotLightExponent.value = lights.spot.exponents;\r\n    uniforms.spotLightDecay.value = lights.spot.decays;\r\n\r\n    uniforms.hemisphereLightSkyColor.value = lights.hemi.skyColors;\r\n    uniforms.hemisphereLightGroundColor.value = lights.hemi.groundColors;\r\n    uniforms.hemisphereLightDirection.value = lights.hemi.positions;\r\n\r\n  }\r\n\r\n  // If uniforms are marked as clean, they don't need to be loaded to the GPU.\r\n\r\n  function markUniformsLightsNeedsUpdate(uniforms, value) {\r\n\r\n    uniforms.ambientLightColor.needsUpdate = value;\r\n\r\n    uniforms.directionalLightColor.needsUpdate = value;\r\n    uniforms.directionalLightDirection.needsUpdate = value;\r\n\r\n    uniforms.pointLightColor.needsUpdate = value;\r\n    uniforms.pointLightPosition.needsUpdate = value;\r\n    uniforms.pointLightDistance.needsUpdate = value;\r\n    uniforms.pointLightDecay.needsUpdate = value;\r\n\r\n    uniforms.spotLightColor.needsUpdate = value;\r\n    uniforms.spotLightPosition.needsUpdate = value;\r\n    uniforms.spotLightDistance.needsUpdate = value;\r\n    uniforms.spotLightDirection.needsUpdate = value;\r\n    uniforms.spotLightAngleCos.needsUpdate = value;\r\n    uniforms.spotLightExponent.needsUpdate = value;\r\n    uniforms.spotLightDecay.needsUpdate = value;\r\n\r\n    uniforms.hemisphereLightSkyColor.needsUpdate = value;\r\n    uniforms.hemisphereLightGroundColor.needsUpdate = value;\r\n    uniforms.hemisphereLightDirection.needsUpdate = value;\r\n\r\n  }\r\n\r\n  function refreshUniformsShadow(uniforms, lights) {\r\n\r\n    if (uniforms.shadowMatrix) {\r\n\r\n      var j = 0;\r\n\r\n      for (var i = 0, il = lights.length; i < il; i++) {\r\n\r\n        var light = lights[i];\r\n\r\n        if (!light.castShadow) continue;\r\n\r\n        if (light instanceof THREE.SpotLight || (light instanceof THREE.DirectionalLight && !light.shadowCascade)) {\r\n\r\n          uniforms.shadowMap.value[j] = light.shadowMap;\r\n          uniforms.shadowMapSize.value[j] = light.shadowMapSize;\r\n\r\n          uniforms.shadowMatrix.value[j] = light.shadowMatrix;\r\n\r\n          uniforms.shadowDarkness.value[j] = light.shadowDarkness;\r\n          uniforms.shadowBias.value[j] = light.shadowBias;\r\n\r\n          j++;\r\n\r\n        }\r\n\r\n      }\r\n\r\n    }\r\n\r\n  }\r\n\r\n  // Uniforms (load to GPU)\r\n\r\n  function loadUniformsMatrices(uniforms, object) {\r\n\r\n    _gl.uniformMatrix4fv(uniforms.modelViewMatrix, false, object._modelViewMatrix.elements);\r\n\r\n    if (uniforms.normalMatrix) {\r\n\r\n      _gl.uniformMatrix3fv(uniforms.normalMatrix, false, object._normalMatrix.elements);\r\n\r\n    }\r\n\r\n  }\r\n\r\n  function getTextureUnit() {\r\n\r\n    var textureUnit = _usedTextureUnits;\r\n\r\n    if (textureUnit >= _maxTextures) {\r\n\r\n      THREE.warn('WebGLRenderer: trying to use ' + textureUnit + ' texture units while this GPU supports only ' + _maxTextures);\r\n\r\n    }\r\n\r\n    _usedTextureUnits += 1;\r\n\r\n    return textureUnit;\r\n\r\n  }\r\n\r\n  function loadUniformsGeneric(uniforms) {\r\n\r\n    var texture, textureUnit, offset;\r\n\r\n    for (var j = 0, jl = uniforms.length; j < jl; j++) {\r\n\r\n      var uniform = uniforms[j][0];\r\n\r\n      // needsUpdate property is not added to all uniforms.\r\n      if (uniform.needsUpdate === false) continue;\r\n\r\n      var type = uniform.type;\r\n      var value = uniform.value;\r\n      var location = uniforms[j][1];\r\n\r\n      switch (type) {\r\n\r\n        case '1i':\r\n          _gl.uniform1i(location, value);\r\n          break;\r\n\r\n        case '1f':\r\n          _gl.uniform1f(location, value);\r\n          break;\r\n\r\n        case '2f':\r\n          _gl.uniform2f(location, value[0], value[1]);\r\n          break;\r\n\r\n        case '3f':\r\n          _gl.uniform3f(location, value[0], value[1], value[2]);\r\n          break;\r\n\r\n        case '4f':\r\n          _gl.uniform4f(location, value[0], value[1], value[2], value[3]);\r\n          break;\r\n\r\n        case '1iv':\r\n          _gl.uniform1iv(location, value);\r\n          break;\r\n\r\n        case '3iv':\r\n          _gl.uniform3iv(location, value);\r\n          break;\r\n\r\n        case '1fv':\r\n          _gl.uniform1fv(location, value);\r\n          break;\r\n\r\n        case '2fv':\r\n          _gl.uniform2fv(location, value);\r\n          break;\r\n\r\n        case '3fv':\r\n          _gl.uniform3fv(location, value);\r\n          break;\r\n\r\n        case '4fv':\r\n          _gl.uniform4fv(location, value);\r\n          break;\r\n\r\n        case 'Matrix3fv':\r\n          _gl.uniformMatrix3fv(location, false, value);\r\n          break;\r\n\r\n        case 'Matrix4fv':\r\n          _gl.uniformMatrix4fv(location, false, value);\r\n          break;\r\n\r\n          //\r\n\r\n        case 'i':\r\n\r\n          // single integer\r\n          _gl.uniform1i(location, value);\r\n\r\n          break;\r\n\r\n        case 'f':\r\n\r\n          // single float\r\n          _gl.uniform1f(location, value);\r\n\r\n          break;\r\n\r\n        case 'v2':\r\n\r\n          // single THREE.Vector2\r\n          _gl.uniform2f(location, value.x, value.y);\r\n\r\n          break;\r\n\r\n        case 'v3':\r\n\r\n          // single THREE.Vector3\r\n          _gl.uniform3f(location, value.x, value.y, value.z);\r\n\r\n          break;\r\n\r\n        case 'v4':\r\n\r\n          // single THREE.Vector4\r\n          _gl.uniform4f(location, value.x, value.y, value.z, value.w);\r\n\r\n          break;\r\n\r\n        case 'c':\r\n\r\n          // single THREE.Color\r\n          _gl.uniform3f(location, value.r, value.g, value.b);\r\n\r\n          break;\r\n\r\n        case 'iv1':\r\n\r\n          // flat array of integers (JS or typed array)\r\n          _gl.uniform1iv(location, value);\r\n\r\n          break;\r\n\r\n        case 'iv':\r\n\r\n          // flat array of integers with 3 x N size (JS or typed array)\r\n          _gl.uniform3iv(location, value);\r\n\r\n          break;\r\n\r\n        case 'fv1':\r\n\r\n          // flat array of floats (JS or typed array)\r\n          _gl.uniform1fv(location, value);\r\n\r\n          break;\r\n\r\n        case 'fv':\r\n\r\n          // flat array of floats with 3 x N size (JS or typed array)\r\n          _gl.uniform3fv(location, value);\r\n\r\n          break;\r\n\r\n        case 'v2v':\r\n\r\n          // array of THREE.Vector2\r\n\r\n          if (uniform._array === undefined) {\r\n\r\n            uniform._array = new Float32Array(2 * value.length);\r\n\r\n          }\r\n\r\n          for (var i = 0, il = value.length; i < il; i++) {\r\n\r\n            offset = i * 2;\r\n\r\n            uniform._array[offset] = value[i].x;\r\n            uniform._array[offset + 1] = value[i].y;\r\n\r\n          }\r\n\r\n          _gl.uniform2fv(location, uniform._array);\r\n\r\n          break;\r\n\r\n        case 'v3v':\r\n\r\n          // array of THREE.Vector3\r\n\r\n          if (uniform._array === undefined) {\r\n\r\n            uniform._array = new Float32Array(3 * value.length);\r\n\r\n          }\r\n\r\n          for (var i = 0, il = value.length; i < il; i++) {\r\n\r\n            offset = i * 3;\r\n\r\n            uniform._array[offset] = value[i].x;\r\n            uniform._array[offset + 1] = value[i].y;\r\n            uniform._array[offset + 2] = value[i].z;\r\n\r\n          }\r\n\r\n          _gl.uniform3fv(location, uniform._array);\r\n\r\n          break;\r\n\r\n        case 'v4v':\r\n\r\n          // array of THREE.Vector4\r\n\r\n          if (uniform._array === undefined) {\r\n\r\n            uniform._array = new Float32Array(4 * value.length);\r\n\r\n          }\r\n\r\n          for (var i = 0, il = value.length; i < il; i++) {\r\n\r\n            offset = i * 4;\r\n\r\n            uniform._array[offset] = value[i].x;\r\n            uniform._array[offset + 1] = value[i].y;\r\n            uniform._array[offset + 2] = value[i].z;\r\n            uniform._array[offset + 3] = value[i].w;\r\n\r\n          }\r\n\r\n          _gl.uniform4fv(location, uniform._array);\r\n\r\n          break;\r\n\r\n        case 'm3':\r\n\r\n          // single THREE.Matrix3\r\n          _gl.uniformMatrix3fv(location, false, value.elements);\r\n\r\n          break;\r\n\r\n        case 'm3v':\r\n\r\n          // array of THREE.Matrix3\r\n\r\n          if (uniform._array === undefined) {\r\n\r\n            uniform._array = new Float32Array(9 * value.length);\r\n\r\n          }\r\n\r\n          for (var i = 0, il = value.length; i < il; i++) {\r\n\r\n            value[i].flattenToArrayOffset(uniform._array, i * 9);\r\n\r\n          }\r\n\r\n          _gl.uniformMatrix3fv(location, false, uniform._array);\r\n\r\n          break;\r\n\r\n        case 'm4':\r\n\r\n          // single THREE.Matrix4\r\n          _gl.uniformMatrix4fv(location, false, value.elements);\r\n\r\n          break;\r\n\r\n        case 'm4v':\r\n\r\n          // array of THREE.Matrix4\r\n\r\n          if (uniform._array === undefined) {\r\n\r\n            uniform._array = new Float32Array(16 * value.length);\r\n\r\n          }\r\n\r\n          for (var i = 0, il = value.length; i < il; i++) {\r\n\r\n            value[i].flattenToArrayOffset(uniform._array, i * 16);\r\n\r\n          }\r\n\r\n          _gl.uniformMatrix4fv(location, false, uniform._array);\r\n\r\n          break;\r\n\r\n        case 't':\r\n\r\n          // single THREE.Texture (2d or cube)\r\n\r\n          texture = value;\r\n          textureUnit = getTextureUnit();\r\n\r\n          _gl.uniform1i(location, textureUnit);\r\n\r\n          if (!texture) continue;\r\n\r\n          if (texture instanceof THREE.CubeTexture ||\r\n            (texture.image instanceof Array && texture.image.length === 6)) { // CompressedTexture can have Array in image :/\r\n\r\n            setCubeTexture(texture, textureUnit);\r\n\r\n          }\r\n          else if (texture instanceof THREE.WebGLRenderTargetCube) {\r\n\r\n            setCubeTextureDynamic(texture, textureUnit);\r\n\r\n          }\r\n          else {\r\n\r\n            _this.setTexture(texture, textureUnit);\r\n\r\n          }\r\n\r\n          break;\r\n\r\n        case 'tv':\r\n\r\n          // array of THREE.Texture (2d)\r\n\r\n          if (uniform._array === undefined) {\r\n\r\n            uniform._array = [];\r\n\r\n          }\r\n\r\n          for (var i = 0, il = uniform.value.length; i < il; i++) {\r\n\r\n            uniform._array[i] = getTextureUnit();\r\n\r\n          }\r\n\r\n          _gl.uniform1iv(location, uniform._array);\r\n\r\n          for (var i = 0, il = uniform.value.length; i < il; i++) {\r\n\r\n            texture = uniform.value[i];\r\n            textureUnit = uniform._array[i];\r\n\r\n            if (!texture) continue;\r\n\r\n            _this.setTexture(texture, textureUnit);\r\n\r\n          }\r\n\r\n          break;\r\n\r\n        default:\r\n\r\n          THREE.warn('THREE.WebGLRenderer: Unknown uniform type: ' + type);\r\n\r\n      }\r\n\r\n    }\r\n\r\n  }\r\n\r\n  function setupMatrices(object, camera) {\r\n\r\n    object._modelViewMatrix.multiplyMatrices(camera.matrixWorldInverse, object.matrixWorld);\r\n    object._normalMatrix.getNormalMatrix(object._modelViewMatrix);\r\n\r\n  }\r\n\r\n  function setColorLinear(array, offset, color, intensity) {\r\n\r\n    array[offset] = color.r * intensity;\r\n    array[offset + 1] = color.g * intensity;\r\n    array[offset + 2] = color.b * intensity;\r\n\r\n  }\r\n\r\n  function setupLights(lights) {\r\n\r\n    var l, ll, light,\r\n      r = 0,\r\n      g = 0,\r\n      b = 0,\r\n      color, skyColor, groundColor,\r\n      intensity,\r\n      distance,\r\n\r\n      zlights = _lights,\r\n\r\n      dirColors = zlights.directional.colors,\r\n      dirPositions = zlights.directional.positions,\r\n\r\n      pointColors = zlights.point.colors,\r\n      pointPositions = zlights.point.positions,\r\n      pointDistances = zlights.point.distances,\r\n      pointDecays = zlights.point.decays,\r\n\r\n      spotColors = zlights.spot.colors,\r\n      spotPositions = zlights.spot.positions,\r\n      spotDistances = zlights.spot.distances,\r\n      spotDirections = zlights.spot.directions,\r\n      spotAnglesCos = zlights.spot.anglesCos,\r\n      spotExponents = zlights.spot.exponents,\r\n      spotDecays = zlights.spot.decays,\r\n\r\n      hemiSkyColors = zlights.hemi.skyColors,\r\n      hemiGroundColors = zlights.hemi.groundColors,\r\n      hemiPositions = zlights.hemi.positions,\r\n\r\n      dirLength = 0,\r\n      pointLength = 0,\r\n      spotLength = 0,\r\n      hemiLength = 0,\r\n\r\n      dirCount = 0,\r\n      pointCount = 0,\r\n      spotCount = 0,\r\n      hemiCount = 0,\r\n\r\n      dirOffset = 0,\r\n      pointOffset = 0,\r\n      spotOffset = 0,\r\n      hemiOffset = 0;\r\n\r\n    for (l = 0, ll = lights.length; l < ll; l++) {\r\n\r\n      light = lights[l];\r\n\r\n      if (light.onlyShadow) continue;\r\n\r\n      color = light.color;\r\n      intensity = light.intensity;\r\n      distance = light.distance;\r\n\r\n      if (light instanceof THREE.AmbientLight) {\r\n\r\n        if (!light.visible) continue;\r\n\r\n        r += color.r;\r\n        g += color.g;\r\n        b += color.b;\r\n\r\n      }\r\n      else if (light instanceof THREE.DirectionalLight) {\r\n\r\n        dirCount += 1;\r\n\r\n        if (!light.visible) continue;\r\n\r\n        _direction.setFromMatrixPosition(light.matrixWorld);\r\n        _vector3.setFromMatrixPosition(light.target.matrixWorld);\r\n        _direction.sub(_vector3);\r\n        _direction.normalize();\r\n\r\n        dirOffset = dirLength * 3;\r\n\r\n        dirPositions[dirOffset] = _direction.x;\r\n        dirPositions[dirOffset + 1] = _direction.y;\r\n        dirPositions[dirOffset + 2] = _direction.z;\r\n\r\n        setColorLinear(dirColors, dirOffset, color, intensity);\r\n\r\n        dirLength += 1;\r\n\r\n      }\r\n      else if (light instanceof THREE.PointLight) {\r\n\r\n        pointCount += 1;\r\n\r\n        if (!light.visible) continue;\r\n\r\n        pointOffset = pointLength * 3;\r\n\r\n        setColorLinear(pointColors, pointOffset, color, intensity);\r\n\r\n        _vector3.setFromMatrixPosition(light.matrixWorld);\r\n\r\n        pointPositions[pointOffset] = _vector3.x;\r\n        pointPositions[pointOffset + 1] = _vector3.y;\r\n        pointPositions[pointOffset + 2] = _vector3.z;\r\n\r\n        // distance is 0 if decay is 0, because there is no attenuation at all.\r\n        pointDistances[pointLength] = distance;\r\n        pointDecays[pointLength] = (light.distance === 0) ? 0.0 : light.decay;\r\n\r\n        pointLength += 1;\r\n\r\n      }\r\n      else if (light instanceof THREE.SpotLight) {\r\n\r\n        spotCount += 1;\r\n\r\n        if (!light.visible) continue;\r\n\r\n        spotOffset = spotLength * 3;\r\n\r\n        setColorLinear(spotColors, spotOffset, color, intensity);\r\n\r\n        _direction.setFromMatrixPosition(light.matrixWorld);\r\n\r\n        spotPositions[spotOffset] = _direction.x;\r\n        spotPositions[spotOffset + 1] = _direction.y;\r\n        spotPositions[spotOffset + 2] = _direction.z;\r\n\r\n        spotDistances[spotLength] = distance;\r\n\r\n        _vector3.setFromMatrixPosition(light.target.matrixWorld);\r\n        _direction.sub(_vector3);\r\n        _direction.normalize();\r\n\r\n        spotDirections[spotOffset] = _direction.x;\r\n        spotDirections[spotOffset + 1] = _direction.y;\r\n        spotDirections[spotOffset + 2] = _direction.z;\r\n\r\n        spotAnglesCos[spotLength] = Math.cos(light.angle);\r\n        spotExponents[spotLength] = light.exponent;\r\n        spotDecays[spotLength] = (light.distance === 0) ? 0.0 : light.decay;\r\n\r\n        spotLength += 1;\r\n\r\n      }\r\n      else if (light instanceof THREE.HemisphereLight) {\r\n\r\n        hemiCount += 1;\r\n\r\n        if (!light.visible) continue;\r\n\r\n        _direction.setFromMatrixPosition(light.matrixWorld);\r\n        _direction.normalize();\r\n\r\n        hemiOffset = hemiLength * 3;\r\n\r\n        hemiPositions[hemiOffset] = _direction.x;\r\n        hemiPositions[hemiOffset + 1] = _direction.y;\r\n        hemiPositions[hemiOffset + 2] = _direction.z;\r\n\r\n        skyColor = light.color;\r\n        groundColor = light.groundColor;\r\n\r\n        setColorLinear(hemiSkyColors, hemiOffset, skyColor, intensity);\r\n        setColorLinear(hemiGroundColors, hemiOffset, groundColor, intensity);\r\n\r\n        hemiLength += 1;\r\n\r\n      }\r\n\r\n    }\r\n\r\n    // null eventual remains from removed lights\r\n    // (this is to avoid if in shader)\r\n\r\n    for (l = dirLength * 3, ll = Math.max(dirColors.length, dirCount * 3); l < ll; l++) dirColors[l] = 0.0;\r\n    for (l = pointLength * 3, ll = Math.max(pointColors.length, pointCount * 3); l < ll; l++) pointColors[l] = 0.0;\r\n    for (l = spotLength * 3, ll = Math.max(spotColors.length, spotCount * 3); l < ll; l++) spotColors[l] = 0.0;\r\n    for (l = hemiLength * 3, ll = Math.max(hemiSkyColors.length, hemiCount * 3); l < ll; l++) hemiSkyColors[l] = 0.0;\r\n    for (l = hemiLength * 3, ll = Math.max(hemiGroundColors.length, hemiCount * 3); l < ll; l++) hemiGroundColors[l] = 0.0;\r\n\r\n    zlights.directional.length = dirLength;\r\n    zlights.point.length = pointLength;\r\n    zlights.spot.length = spotLength;\r\n    zlights.hemi.length = hemiLength;\r\n\r\n    zlights.ambient[0] = r;\r\n    zlights.ambient[1] = g;\r\n    zlights.ambient[2] = b;\r\n\r\n  }\r\n\r\n  // GL state setting\r\n\r\n  this.setFaceCulling = function(cullFace, frontFaceDirection) {\r\n\r\n    if (cullFace === THREE.CullFaceNone) {\r\n\r\n      _gl.disable(_gl.CULL_FACE);\r\n\r\n    }\r\n    else {\r\n\r\n      if (frontFaceDirection === THREE.FrontFaceDirectionCW) {\r\n\r\n        _gl.frontFace(_gl.CW);\r\n\r\n      }\r\n      else {\r\n\r\n        _gl.frontFace(_gl.CCW);\r\n\r\n      }\r\n\r\n      if (cullFace === THREE.CullFaceBack) {\r\n\r\n        _gl.cullFace(_gl.BACK);\r\n\r\n      }\r\n      else if (cullFace === THREE.CullFaceFront) {\r\n\r\n        _gl.cullFace(_gl.FRONT);\r\n\r\n      }\r\n      else {\r\n\r\n        _gl.cullFace(_gl.FRONT_AND_BACK);\r\n\r\n      }\r\n\r\n      _gl.enable(_gl.CULL_FACE);\r\n\r\n    }\r\n\r\n  };\r\n\r\n  this.setMaterialFaces = function(material) {\r\n\r\n    state.setDoubleSided(material.side === THREE.DoubleSide);\r\n    state.setFlipSided(material.side === THREE.BackSide);\r\n\r\n  };\r\n\r\n  // Textures\r\n\r\n  function setTextureParameters(textureType, texture, isImagePowerOfTwo) {\r\n\r\n    var extension;\r\n\r\n    if (isImagePowerOfTwo) {\r\n\r\n      _gl.texParameteri(textureType, _gl.TEXTURE_WRAP_S, paramThreeToGL(texture.wrapS));\r\n      _gl.texParameteri(textureType, _gl.TEXTURE_WRAP_T, paramThreeToGL(texture.wrapT));\r\n\r\n      _gl.texParameteri(textureType, _gl.TEXTURE_MAG_FILTER, paramThreeToGL(texture.magFilter));\r\n      _gl.texParameteri(textureType, _gl.TEXTURE_MIN_FILTER, paramThreeToGL(texture.minFilter));\r\n\r\n    }\r\n    else {\r\n\r\n      _gl.texParameteri(textureType, _gl.TEXTURE_WRAP_S, _gl.CLAMP_TO_EDGE);\r\n      _gl.texParameteri(textureType, _gl.TEXTURE_WRAP_T, _gl.CLAMP_TO_EDGE);\r\n\r\n      if (texture.wrapS !== THREE.ClampToEdgeWrapping || texture.wrapT !== THREE.ClampToEdgeWrapping) {\r\n\r\n        THREE.warn('THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping. ( ' + texture.sourceFile + ' )');\r\n\r\n      }\r\n\r\n      _gl.texParameteri(textureType, _gl.TEXTURE_MAG_FILTER, filterFallback(texture.magFilter));\r\n      _gl.texParameteri(textureType, _gl.TEXTURE_MIN_FILTER, filterFallback(texture.minFilter));\r\n\r\n      if (texture.minFilter !== THREE.NearestFilter && texture.minFilter !== THREE.LinearFilter) {\r\n\r\n        THREE.warn('THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter. ( ' + texture.sourceFile + ' )');\r\n\r\n      }\r\n\r\n    }\r\n\r\n    extension = extensions.get('EXT_texture_filter_anisotropic');\r\n\r\n    if (extension && texture.type !== THREE.FloatType && texture.type !== THREE.HalfFloatType) {\r\n\r\n      if (texture.anisotropy > 1 || texture.__currentAnisotropy) {\r\n\r\n        _gl.texParameterf(textureType, extension.TEXTURE_MAX_ANISOTROPY_EXT, Math.min(texture.anisotropy, _this.getMaxAnisotropy()));\r\n        texture.__currentAnisotropy = texture.anisotropy;\r\n\r\n      }\r\n\r\n    }\r\n\r\n  }\r\n\r\n  this.uploadTexture = function(texture) {\r\n\r\n    if (texture.__webglInit === undefined) {\r\n\r\n      texture.__webglInit = true;\r\n\r\n      texture.addEventListener('dispose', onTextureDispose);\r\n\r\n      texture.__webglTexture = _gl.createTexture();\r\n\r\n      _this.info.memory.textures++;\r\n\r\n    }\r\n\r\n    _gl.bindTexture(_gl.TEXTURE_2D, texture.__webglTexture);\r\n\r\n    _gl.pixelStorei(_gl.UNPACK_FLIP_Y_WEBGL, texture.flipY);\r\n    _gl.pixelStorei(_gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL, texture.premultiplyAlpha);\r\n    _gl.pixelStorei(_gl.UNPACK_ALIGNMENT, texture.unpackAlignment);\r\n\r\n    texture.image = clampToMaxSize(texture.image, _maxTextureSize);\r\n\r\n    var image = texture.image,\r\n      isImagePowerOfTwo = THREE.Math.isPowerOfTwo(image.width) && THREE.Math.isPowerOfTwo(image.height),\r\n      glFormat = paramThreeToGL(texture.format),\r\n      glType = paramThreeToGL(texture.type);\r\n\r\n    setTextureParameters(_gl.TEXTURE_2D, texture, isImagePowerOfTwo);\r\n\r\n    var mipmap, mipmaps = texture.mipmaps;\r\n\r\n    if (texture instanceof THREE.DataTexture) {\r\n\r\n      // use manually created mipmaps if available\r\n      // if there are no manual mipmaps\r\n      // set 0 level mipmap and then use GL to generate other mipmap levels\r\n\r\n      if (mipmaps.length > 0 && isImagePowerOfTwo) {\r\n\r\n        for (var i = 0, il = mipmaps.length; i < il; i++) {\r\n\r\n          mipmap = mipmaps[i];\r\n          _gl.texImage2D(_gl.TEXTURE_2D, i, glFormat, mipmap.width, mipmap.height, 0, glFormat, glType, mipmap.data);\r\n\r\n        }\r\n\r\n        texture.generateMipmaps = false;\r\n\r\n      }\r\n      else {\r\n\r\n        _gl.texImage2D(_gl.TEXTURE_2D, 0, glFormat, image.width, image.height, 0, glFormat, glType, image.data);\r\n\r\n      }\r\n\r\n    }\r\n    else if (texture instanceof THREE.CompressedTexture) {\r\n\r\n      for (var i = 0, il = mipmaps.length; i < il; i++) {\r\n\r\n        mipmap = mipmaps[i];\r\n\r\n        if (texture.format !== THREE.RGBAFormat && texture.format !== THREE.RGBFormat) {\r\n\r\n          if (getCompressedTextureFormats().indexOf(glFormat) > -1) {\r\n\r\n            _gl.compressedTexImage2D(_gl.TEXTURE_2D, i, glFormat, mipmap.width, mipmap.height, 0, mipmap.data);\r\n\r\n          }\r\n          else {\r\n\r\n            THREE.warn(\"THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()\");\r\n\r\n          }\r\n\r\n        }\r\n        else {\r\n\r\n          _gl.texImage2D(_gl.TEXTURE_2D, i, glFormat, mipmap.width, mipmap.height, 0, glFormat, glType, mipmap.data);\r\n\r\n        }\r\n\r\n      }\r\n\r\n    }\r\n    else { // regular Texture (image, video, canvas)\r\n\r\n      // use manually created mipmaps if available\r\n      // if there are no manual mipmaps\r\n      // set 0 level mipmap and then use GL to generate other mipmap levels\r\n\r\n      if (mipmaps.length > 0 && isImagePowerOfTwo) {\r\n\r\n        for (var i = 0, il = mipmaps.length; i < il; i++) {\r\n\r\n          mipmap = mipmaps[i];\r\n          _gl.texImage2D(_gl.TEXTURE_2D, i, glFormat, glFormat, glType, mipmap);\r\n\r\n        }\r\n\r\n        texture.generateMipmaps = false;\r\n\r\n      }\r\n      else {\r\n\r\n        _gl.texImage2D(_gl.TEXTURE_2D, 0, glFormat, glFormat, glType, texture.image);\r\n\r\n      }\r\n\r\n    }\r\n\r\n    if (texture.generateMipmaps && isImagePowerOfTwo) _gl.generateMipmap(_gl.TEXTURE_2D);\r\n\r\n    texture.needsUpdate = false;\r\n\r\n    if (texture.onUpdate) texture.onUpdate();\r\n\r\n  };\r\n\r\n  this.setTexture = function(texture, slot) {\r\n\r\n    _gl.activeTexture(_gl.TEXTURE0 + slot);\r\n\r\n    if (texture.needsUpdate) {\r\n\r\n      _this.uploadTexture(texture);\r\n\r\n    }\r\n    else {\r\n\r\n      _gl.bindTexture(_gl.TEXTURE_2D, texture.__webglTexture);\r\n\r\n    }\r\n\r\n  };\r\n\r\n  function clampToMaxSize(image, maxSize) {\r\n\r\n    if (image.width > maxSize || image.height > maxSize) {\r\n\r\n      // Warning: Scaling through the canvas will only work with images that use\r\n      // premultiplied alpha.\r\n\r\n      var scale = maxSize / Math.max(image.width, image.height);\r\n\r\n      var canvas = document.createElement('canvas');\r\n      canvas.width = Math.floor(image.width * scale);\r\n      canvas.height = Math.floor(image.height * scale);\r\n\r\n      var context = canvas.getContext('2d');\r\n      context.drawImage(image, 0, 0, image.width, image.height, 0, 0, canvas.width, canvas.height);\r\n\r\n      THREE.warn('THREE.WebGLRenderer: image is too big (' + image.width + 'x' + image.height + '). Resized to ' + canvas.width + 'x' + canvas.height, image);\r\n\r\n      return canvas;\r\n\r\n    }\r\n\r\n    return image;\r\n\r\n  }\r\n\r\n  function setCubeTexture(texture, slot) {\r\n\r\n    if (texture.image.length === 6) {\r\n\r\n      if (texture.needsUpdate) {\r\n\r\n        if (!texture.image.__webglTextureCube) {\r\n\r\n          texture.addEventListener('dispose', onTextureDispose);\r\n\r\n          texture.image.__webglTextureCube = _gl.createTexture();\r\n\r\n          _this.info.memory.textures++;\r\n\r\n        }\r\n\r\n        _gl.activeTexture(_gl.TEXTURE0 + slot);\r\n        _gl.bindTexture(_gl.TEXTURE_CUBE_MAP, texture.image.__webglTextureCube);\r\n\r\n        _gl.pixelStorei(_gl.UNPACK_FLIP_Y_WEBGL, texture.flipY);\r\n\r\n        var isCompressed = texture instanceof THREE.CompressedTexture;\r\n        var isDataTexture = texture.image[0] instanceof THREE.DataTexture;\r\n\r\n        var cubeImage = [];\r\n\r\n        for (var i = 0; i < 6; i++) {\r\n\r\n          if (_this.autoScaleCubemaps && !isCompressed && !isDataTexture) {\r\n\r\n            cubeImage[i] = clampToMaxSize(texture.image[i], _maxCubemapSize);\r\n\r\n          }\r\n          else {\r\n\r\n            cubeImage[i] = isDataTexture ? texture.image[i].image : texture.image[i];\r\n\r\n          }\r\n\r\n        }\r\n\r\n        var image = cubeImage[0],\r\n          isImagePowerOfTwo = THREE.Math.isPowerOfTwo(image.width) && THREE.Math.isPowerOfTwo(image.height),\r\n          glFormat = paramThreeToGL(texture.format),\r\n          glType = paramThreeToGL(texture.type);\r\n\r\n        setTextureParameters(_gl.TEXTURE_CUBE_MAP, texture, isImagePowerOfTwo);\r\n\r\n        for (var i = 0; i < 6; i++) {\r\n\r\n          if (!isCompressed) {\r\n\r\n            if (isDataTexture) {\r\n\r\n              _gl.texImage2D(_gl.TEXTURE_CUBE_MAP_POSITIVE_X + i, 0, glFormat, cubeImage[i].width, cubeImage[i].height, 0, glFormat, glType, cubeImage[i].data);\r\n\r\n            }\r\n            else {\r\n\r\n              _gl.texImage2D(_gl.TEXTURE_CUBE_MAP_POSITIVE_X + i, 0, glFormat, glFormat, glType, cubeImage[i]);\r\n\r\n            }\r\n\r\n          }\r\n          else {\r\n\r\n            var mipmap, mipmaps = cubeImage[i].mipmaps;\r\n\r\n            for (var j = 0, jl = mipmaps.length; j < jl; j++) {\r\n\r\n              mipmap = mipmaps[j];\r\n\r\n              if (texture.format !== THREE.RGBAFormat && texture.format !== THREE.RGBFormat) {\r\n\r\n                if (getCompressedTextureFormats().indexOf(glFormat) > -1) {\r\n\r\n                  _gl.compressedTexImage2D(_gl.TEXTURE_CUBE_MAP_POSITIVE_X + i, j, glFormat, mipmap.width, mipmap.height, 0, mipmap.data);\r\n\r\n                }\r\n                else {\r\n\r\n                  THREE.warn(\"THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setCubeTexture()\");\r\n\r\n                }\r\n\r\n              }\r\n              else {\r\n\r\n                _gl.texImage2D(_gl.TEXTURE_CUBE_MAP_POSITIVE_X + i, j, glFormat, mipmap.width, mipmap.height, 0, glFormat, glType, mipmap.data);\r\n\r\n              }\r\n\r\n            }\r\n\r\n          }\r\n\r\n        }\r\n\r\n        if (texture.generateMipmaps && isImagePowerOfTwo) {\r\n\r\n          _gl.generateMipmap(_gl.TEXTURE_CUBE_MAP);\r\n\r\n        }\r\n\r\n        texture.needsUpdate = false;\r\n\r\n        if (texture.onUpdate) texture.onUpdate();\r\n\r\n      }\r\n      else {\r\n\r\n        _gl.activeTexture(_gl.TEXTURE0 + slot);\r\n        _gl.bindTexture(_gl.TEXTURE_CUBE_MAP, texture.image.__webglTextureCube);\r\n\r\n      }\r\n\r\n    }\r\n\r\n  }\r\n\r\n  function setCubeTextureDynamic(texture, slot) {\r\n\r\n    _gl.activeTexture(_gl.TEXTURE0 + slot);\r\n    _gl.bindTexture(_gl.TEXTURE_CUBE_MAP, texture.__webglTexture);\r\n\r\n  }\r\n\r\n  // Render targets\r\n\r\n  function setupFrameBuffer(framebuffer, renderTarget, textureTarget) {\r\n\r\n    _gl.bindFramebuffer(_gl.FRAMEBUFFER, framebuffer);\r\n    _gl.framebufferTexture2D(_gl.FRAMEBUFFER, _gl.COLOR_ATTACHMENT0, textureTarget, renderTarget.__webglTexture, 0);\r\n\r\n  }\r\n\r\n  function setupRenderBuffer(renderbuffer, renderTarget) {\r\n\r\n    _gl.bindRenderbuffer(_gl.RENDERBUFFER, renderbuffer);\r\n\r\n    if (renderTarget.depthBuffer && !renderTarget.stencilBuffer) {\r\n\r\n      _gl.renderbufferStorage(_gl.RENDERBUFFER, _gl.DEPTH_COMPONENT16, renderTarget.width, renderTarget.height);\r\n      _gl.framebufferRenderbuffer(_gl.FRAMEBUFFER, _gl.DEPTH_ATTACHMENT, _gl.RENDERBUFFER, renderbuffer);\r\n\r\n      /* For some reason this is not working. Defaulting to RGBA4.\r\n      } else if ( ! renderTarget.depthBuffer && renderTarget.stencilBuffer ) {\r\n\r\n      \t_gl.renderbufferStorage( _gl.RENDERBUFFER, _gl.STENCIL_INDEX8, renderTarget.width, renderTarget.height );\r\n      \t_gl.framebufferRenderbuffer( _gl.FRAMEBUFFER, _gl.STENCIL_ATTACHMENT, _gl.RENDERBUFFER, renderbuffer );\r\n      */\r\n    }\r\n    else if (renderTarget.depthBuffer && renderTarget.stencilBuffer) {\r\n\r\n      _gl.renderbufferStorage(_gl.RENDERBUFFER, _gl.DEPTH_STENCIL, renderTarget.width, renderTarget.height);\r\n      _gl.framebufferRenderbuffer(_gl.FRAMEBUFFER, _gl.DEPTH_STENCIL_ATTACHMENT, _gl.RENDERBUFFER, renderbuffer);\r\n\r\n    }\r\n    else {\r\n\r\n      _gl.renderbufferStorage(_gl.RENDERBUFFER, _gl.RGBA4, renderTarget.width, renderTarget.height);\r\n\r\n    }\r\n\r\n  }\r\n\r\n  this.setRenderTarget = function(renderTarget) {\r\n\r\n    var isCube = (renderTarget instanceof THREE.WebGLRenderTargetCube);\r\n\r\n    if (renderTarget && renderTarget.__webglFramebuffer === undefined) {\r\n\r\n      if (renderTarget.depthBuffer === undefined) renderTarget.depthBuffer = true;\r\n      if (renderTarget.stencilBuffer === undefined) renderTarget.stencilBuffer = true;\r\n\r\n      renderTarget.addEventListener('dispose', onRenderTargetDispose);\r\n\r\n      renderTarget.__webglTexture = _gl.createTexture();\r\n\r\n      _this.info.memory.textures++;\r\n\r\n      // Setup texture, create render and frame buffers\r\n\r\n      var isTargetPowerOfTwo = THREE.Math.isPowerOfTwo(renderTarget.width) && THREE.Math.isPowerOfTwo(renderTarget.height),\r\n        glFormat = paramThreeToGL(renderTarget.format),\r\n        glType = paramThreeToGL(renderTarget.type);\r\n\r\n      if (isCube) {\r\n\r\n        renderTarget.__webglFramebuffer = [];\r\n        renderTarget.__webglRenderbuffer = [];\r\n\r\n        _gl.bindTexture(_gl.TEXTURE_CUBE_MAP, renderTarget.__webglTexture);\r\n        setTextureParameters(_gl.TEXTURE_CUBE_MAP, renderTarget, isTargetPowerOfTwo);\r\n\r\n        for (var i = 0; i < 6; i++) {\r\n\r\n          renderTarget.__webglFramebuffer[i] = _gl.createFramebuffer();\r\n          renderTarget.__webglRenderbuffer[i] = _gl.createRenderbuffer();\r\n\r\n          _gl.texImage2D(_gl.TEXTURE_CUBE_MAP_POSITIVE_X + i, 0, glFormat, renderTarget.width, renderTarget.height, 0, glFormat, glType, null);\r\n\r\n          setupFrameBuffer(renderTarget.__webglFramebuffer[i], renderTarget, _gl.TEXTURE_CUBE_MAP_POSITIVE_X + i);\r\n          setupRenderBuffer(renderTarget.__webglRenderbuffer[i], renderTarget);\r\n\r\n        }\r\n\r\n        if (isTargetPowerOfTwo) _gl.generateMipmap(_gl.TEXTURE_CUBE_MAP);\r\n\r\n      }\r\n      else {\r\n\r\n        renderTarget.__webglFramebuffer = _gl.createFramebuffer();\r\n\r\n        if (renderTarget.shareDepthFrom) {\r\n\r\n          renderTarget.__webglRenderbuffer = renderTarget.shareDepthFrom.__webglRenderbuffer;\r\n\r\n        }\r\n        else {\r\n\r\n          renderTarget.__webglRenderbuffer = _gl.createRenderbuffer();\r\n\r\n        }\r\n\r\n        _gl.bindTexture(_gl.TEXTURE_2D, renderTarget.__webglTexture);\r\n        setTextureParameters(_gl.TEXTURE_2D, renderTarget, isTargetPowerOfTwo);\r\n\r\n        _gl.texImage2D(_gl.TEXTURE_2D, 0, glFormat, renderTarget.width, renderTarget.height, 0, glFormat, glType, null);\r\n\r\n        setupFrameBuffer(renderTarget.__webglFramebuffer, renderTarget, _gl.TEXTURE_2D);\r\n\r\n        if (renderTarget.shareDepthFrom) {\r\n\r\n          if (renderTarget.depthBuffer && !renderTarget.stencilBuffer) {\r\n\r\n            _gl.framebufferRenderbuffer(_gl.FRAMEBUFFER, _gl.DEPTH_ATTACHMENT, _gl.RENDERBUFFER, renderTarget.__webglRenderbuffer);\r\n\r\n          }\r\n          else if (renderTarget.depthBuffer && renderTarget.stencilBuffer) {\r\n\r\n            _gl.framebufferRenderbuffer(_gl.FRAMEBUFFER, _gl.DEPTH_STENCIL_ATTACHMENT, _gl.RENDERBUFFER, renderTarget.__webglRenderbuffer);\r\n\r\n          }\r\n\r\n        }\r\n        else {\r\n\r\n          setupRenderBuffer(renderTarget.__webglRenderbuffer, renderTarget);\r\n\r\n        }\r\n\r\n        if (isTargetPowerOfTwo) _gl.generateMipmap(_gl.TEXTURE_2D);\r\n\r\n      }\r\n\r\n      // Release everything\r\n\r\n      if (isCube) {\r\n\r\n        _gl.bindTexture(_gl.TEXTURE_CUBE_MAP, null);\r\n\r\n      }\r\n      else {\r\n\r\n        _gl.bindTexture(_gl.TEXTURE_2D, null);\r\n\r\n      }\r\n\r\n      _gl.bindRenderbuffer(_gl.RENDERBUFFER, null);\r\n      _gl.bindFramebuffer(_gl.FRAMEBUFFER, null);\r\n\r\n    }\r\n\r\n    var framebuffer, width, height, vx, vy;\r\n\r\n    if (renderTarget) {\r\n\r\n      if (isCube) {\r\n\r\n        framebuffer = renderTarget.__webglFramebuffer[renderTarget.activeCubeFace];\r\n\r\n      }\r\n      else {\r\n\r\n        framebuffer = renderTarget.__webglFramebuffer;\r\n\r\n      }\r\n\r\n      width = renderTarget.width;\r\n      height = renderTarget.height;\r\n\r\n      vx = 0;\r\n      vy = 0;\r\n\r\n    }\r\n    else {\r\n\r\n      framebuffer = null;\r\n\r\n      width = _viewportWidth;\r\n      height = _viewportHeight;\r\n\r\n      vx = _viewportX;\r\n      vy = _viewportY;\r\n\r\n    }\r\n\r\n    if (framebuffer !== _currentFramebuffer) {\r\n\r\n      _gl.bindFramebuffer(_gl.FRAMEBUFFER, framebuffer);\r\n      _gl.viewport(vx, vy, width, height);\r\n\r\n      _currentFramebuffer = framebuffer;\r\n\r\n    }\r\n\r\n    _currentWidth = width;\r\n    _currentHeight = height;\r\n\r\n  };\r\n\r\n  this.readRenderTargetPixels = function(renderTarget, x, y, width, height, buffer) {\r\n\r\n    if (!(renderTarget instanceof THREE.WebGLRenderTarget)) {\r\n\r\n      console.error('THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.');\r\n      return;\r\n\r\n    }\r\n\r\n    if (renderTarget.__webglFramebuffer) {\r\n\r\n      if (renderTarget.format !== THREE.RGBAFormat) {\r\n\r\n        console.error('THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA format. readPixels can read only RGBA format.');\r\n        return;\r\n\r\n      }\r\n\r\n      var restore = false;\r\n\r\n      if (renderTarget.__webglFramebuffer !== _currentFramebuffer) {\r\n\r\n        _gl.bindFramebuffer(_gl.FRAMEBUFFER, renderTarget.__webglFramebuffer);\r\n\r\n        restore = true;\r\n\r\n      }\r\n\r\n      if (_gl.checkFramebufferStatus(_gl.FRAMEBUFFER) === _gl.FRAMEBUFFER_COMPLETE) {\r\n\r\n        _gl.readPixels(x, y, width, height, _gl.RGBA, _gl.UNSIGNED_BYTE, buffer);\r\n\r\n      }\r\n      else {\r\n\r\n        console.error('THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.');\r\n\r\n      }\r\n\r\n      if (restore) {\r\n\r\n        _gl.bindFramebuffer(_gl.FRAMEBUFFER, _currentFramebuffer);\r\n\r\n      }\r\n\r\n    }\r\n\r\n  };\r\n\r\n  function updateRenderTargetMipmap(renderTarget) {\r\n\r\n    if (renderTarget instanceof THREE.WebGLRenderTargetCube) {\r\n\r\n      _gl.bindTexture(_gl.TEXTURE_CUBE_MAP, renderTarget.__webglTexture);\r\n      _gl.generateMipmap(_gl.TEXTURE_CUBE_MAP);\r\n      _gl.bindTexture(_gl.TEXTURE_CUBE_MAP, null);\r\n\r\n    }\r\n    else {\r\n\r\n      _gl.bindTexture(_gl.TEXTURE_2D, renderTarget.__webglTexture);\r\n      _gl.generateMipmap(_gl.TEXTURE_2D);\r\n      _gl.bindTexture(_gl.TEXTURE_2D, null);\r\n\r\n    }\r\n\r\n  }\r\n\r\n  // Fallback filters for non-power-of-2 textures\r\n\r\n  function filterFallback(f) {\r\n\r\n    if (f === THREE.NearestFilter || f === THREE.NearestMipMapNearestFilter || f === THREE.NearestMipMapLinearFilter) {\r\n\r\n      return _gl.NEAREST;\r\n\r\n    }\r\n\r\n    return _gl.LINEAR;\r\n\r\n  }\r\n\r\n  // Map three.js constants to WebGL constants\r\n\r\n  function paramThreeToGL(p) {\r\n\r\n    var extension;\r\n\r\n    if (p === THREE.RepeatWrapping) return _gl.REPEAT;\r\n    if (p === THREE.ClampToEdgeWrapping) return _gl.CLAMP_TO_EDGE;\r\n    if (p === THREE.MirroredRepeatWrapping) return _gl.MIRRORED_REPEAT;\r\n\r\n    if (p === THREE.NearestFilter) return _gl.NEAREST;\r\n    if (p === THREE.NearestMipMapNearestFilter) return _gl.NEAREST_MIPMAP_NEAREST;\r\n    if (p === THREE.NearestMipMapLinearFilter) return _gl.NEAREST_MIPMAP_LINEAR;\r\n\r\n    if (p === THREE.LinearFilter) return _gl.LINEAR;\r\n    if (p === THREE.LinearMipMapNearestFilter) return _gl.LINEAR_MIPMAP_NEAREST;\r\n    if (p === THREE.LinearMipMapLinearFilter) return _gl.LINEAR_MIPMAP_LINEAR;\r\n\r\n    if (p === THREE.UnsignedByteType) return _gl.UNSIGNED_BYTE;\r\n    if (p === THREE.UnsignedShort4444Type) return _gl.UNSIGNED_SHORT_4_4_4_4;\r\n    if (p === THREE.UnsignedShort5551Type) return _gl.UNSIGNED_SHORT_5_5_5_1;\r\n    if (p === THREE.UnsignedShort565Type) return _gl.UNSIGNED_SHORT_5_6_5;\r\n\r\n    if (p === THREE.ByteType) return _gl.BYTE;\r\n    if (p === THREE.ShortType) return _gl.SHORT;\r\n    if (p === THREE.UnsignedShortType) return _gl.UNSIGNED_SHORT;\r\n    if (p === THREE.IntType) return _gl.INT;\r\n    if (p === THREE.UnsignedIntType) return _gl.UNSIGNED_INT;\r\n    if (p === THREE.FloatType) return _gl.FLOAT;\r\n\r\n    extension = extensions.get('OES_texture_half_float');\r\n\r\n    if (extension !== null) {\r\n\r\n      if (p === THREE.HalfFloatType) return extension.HALF_FLOAT_OES;\r\n\r\n    }\r\n\r\n    if (p === THREE.AlphaFormat) return _gl.ALPHA;\r\n    if (p === THREE.RGBFormat) return _gl.RGB;\r\n    if (p === THREE.RGBAFormat) return _gl.RGBA;\r\n    if (p === THREE.LuminanceFormat) return _gl.LUMINANCE;\r\n    if (p === THREE.LuminanceAlphaFormat) return _gl.LUMINANCE_ALPHA;\r\n\r\n    if (p === THREE.AddEquation) return _gl.FUNC_ADD;\r\n    if (p === THREE.SubtractEquation) return _gl.FUNC_SUBTRACT;\r\n    if (p === THREE.ReverseSubtractEquation) return _gl.FUNC_REVERSE_SUBTRACT;\r\n\r\n    if (p === THREE.ZeroFactor) return _gl.ZERO;\r\n    if (p === THREE.OneFactor) return _gl.ONE;\r\n    if (p === THREE.SrcColorFactor) return _gl.SRC_COLOR;\r\n    if (p === THREE.OneMinusSrcColorFactor) return _gl.ONE_MINUS_SRC_COLOR;\r\n    if (p === THREE.SrcAlphaFactor) return _gl.SRC_ALPHA;\r\n    if (p === THREE.OneMinusSrcAlphaFactor) return _gl.ONE_MINUS_SRC_ALPHA;\r\n    if (p === THREE.DstAlphaFactor) return _gl.DST_ALPHA;\r\n    if (p === THREE.OneMinusDstAlphaFactor) return _gl.ONE_MINUS_DST_ALPHA;\r\n\r\n    if (p === THREE.DstColorFactor) return _gl.DST_COLOR;\r\n    if (p === THREE.OneMinusDstColorFactor) return _gl.ONE_MINUS_DST_COLOR;\r\n    if (p === THREE.SrcAlphaSaturateFactor) return _gl.SRC_ALPHA_SATURATE;\r\n\r\n    extension = extensions.get('WEBGL_compressed_texture_s3tc');\r\n\r\n    if (extension !== null) {\r\n\r\n      if (p === THREE.RGB_S3TC_DXT1_Format) return extension.COMPRESSED_RGB_S3TC_DXT1_EXT;\r\n      if (p === THREE.RGBA_S3TC_DXT1_Format) return extension.COMPRESSED_RGBA_S3TC_DXT1_EXT;\r\n      if (p === THREE.RGBA_S3TC_DXT3_Format) return extension.COMPRESSED_RGBA_S3TC_DXT3_EXT;\r\n      if (p === THREE.RGBA_S3TC_DXT5_Format) return extension.COMPRESSED_RGBA_S3TC_DXT5_EXT;\r\n\r\n    }\r\n\r\n    extension = extensions.get('WEBGL_compressed_texture_pvrtc');\r\n\r\n    if (extension !== null) {\r\n\r\n      if (p === THREE.RGB_PVRTC_4BPPV1_Format) return extension.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;\r\n      if (p === THREE.RGB_PVRTC_2BPPV1_Format) return extension.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;\r\n      if (p === THREE.RGBA_PVRTC_4BPPV1_Format) return extension.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;\r\n      if (p === THREE.RGBA_PVRTC_2BPPV1_Format) return extension.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG;\r\n\r\n    }\r\n\r\n    extension = extensions.get('EXT_blend_minmax');\r\n\r\n    if (extension !== null) {\r\n\r\n      if (p === THREE.MinEquation) return extension.MIN_EXT;\r\n      if (p === THREE.MaxEquation) return extension.MAX_EXT;\r\n\r\n    }\r\n\r\n    return 0;\r\n\r\n  }\r\n\r\n  // Allocations\r\n\r\n  function allocateBones(object) {\r\n\r\n    if (_supportsBoneTextures && object && object.skeleton && object.skeleton.useVertexTexture) {\r\n\r\n      return 1024;\r\n\r\n    }\r\n    else {\r\n\r\n      // default for when object is not specified\r\n      // ( for example when prebuilding shader\r\n      //   to be used with multiple objects )\r\n      //\r\n      //  - leave some extra space for other uniforms\r\n      //  - limit here is ANGLE's 254 max uniform vectors\r\n      //    (up to 54 should be safe)\r\n\r\n      var nVertexUniforms = _gl.getParameter(_gl.MAX_VERTEX_UNIFORM_VECTORS);\r\n      var nVertexMatrices = Math.floor((nVertexUniforms - 20) / 4);\r\n\r\n      var maxBones = nVertexMatrices;\r\n\r\n      if (object !== undefined && object instanceof THREE.SkinnedMesh) {\r\n\r\n        maxBones = Math.min(object.skeleton.bones.length, maxBones);\r\n\r\n        if (maxBones < object.skeleton.bones.length) {\r\n\r\n          THREE.warn('WebGLRenderer: too many bones - ' + object.skeleton.bones.length + ', this GPU supports just ' + maxBones + ' (try OpenGL instead of ANGLE)');\r\n\r\n        }\r\n\r\n      }\r\n\r\n      return maxBones;\r\n\r\n    }\r\n\r\n  }\r\n\r\n  function allocateLights(lights) {\r\n\r\n    var dirLights = 0;\r\n    var pointLights = 0;\r\n    var spotLights = 0;\r\n    var hemiLights = 0;\r\n\r\n    for (var l = 0, ll = lights.length; l < ll; l++) {\r\n\r\n      var light = lights[l];\r\n\r\n      if (light.onlyShadow || light.visible === false) continue;\r\n\r\n      if (light instanceof THREE.DirectionalLight) dirLights++;\r\n      if (light instanceof THREE.PointLight) pointLights++;\r\n      if (light instanceof THREE.SpotLight) spotLights++;\r\n      if (light instanceof THREE.HemisphereLight) hemiLights++;\r\n\r\n    }\r\n\r\n    return {\r\n      'directional': dirLights,\r\n      'point': pointLights,\r\n      'spot': spotLights,\r\n      'hemi': hemiLights\r\n    };\r\n\r\n  }\r\n\r\n  function allocateShadows(lights) {\r\n\r\n    var maxShadows = 0;\r\n\r\n    for (var l = 0, ll = lights.length; l < ll; l++) {\r\n\r\n      var light = lights[l];\r\n\r\n      if (!light.castShadow) continue;\r\n\r\n      if (light instanceof THREE.SpotLight) maxShadows++;\r\n      if (light instanceof THREE.DirectionalLight && !light.shadowCascade) maxShadows++;\r\n\r\n    }\r\n\r\n    return maxShadows;\r\n\r\n  }\r\n\r\n  // DEPRECATED\r\n\r\n  this.initMaterial = function() {\r\n\r\n    THREE.warn('THREE.WebGLRenderer: .initMaterial() has been removed.');\r\n\r\n  };\r\n\r\n  this.addPrePlugin = function() {\r\n\r\n    THREE.warn('THREE.WebGLRenderer: .addPrePlugin() has been removed.');\r\n\r\n  };\r\n\r\n  this.addPostPlugin = function() {\r\n\r\n    THREE.warn('THREE.WebGLRenderer: .addPostPlugin() has been removed.');\r\n\r\n  };\r\n\r\n  this.updateShadowMap = function() {\r\n\r\n    THREE.warn('THREE.WebGLRenderer: .updateShadowMap() has been removed.');\r\n\r\n  };\r\n\r\n};\r\n\r\n// File:src/renderers/WebGLRenderTarget.js\r\n\r\n/**\r\n * @author szimek / https://github.com/szimek/\r\n * @author alteredq / http://alteredqualia.com/\r\n */\r\n\r\nTHREE.WebGLRenderTarget = function(width, height, options) {\r\n\r\n  this.width = width;\r\n  this.height = height;\r\n\r\n  options = options || {};\r\n\r\n  this.wrapS = options.wrapS !== undefined ? options.wrapS : THREE.ClampToEdgeWrapping;\r\n  this.wrapT = options.wrapT !== undefined ? options.wrapT : THREE.ClampToEdgeWrapping;\r\n\r\n  this.magFilter = options.magFilter !== undefined ? options.magFilter : THREE.LinearFilter;\r\n  this.minFilter = options.minFilter !== undefined ? options.minFilter : THREE.LinearMipMapLinearFilter;\r\n\r\n  this.anisotropy = options.anisotropy !== undefined ? options.anisotropy : 1;\r\n\r\n  this.offset = new THREE.Vector2(0, 0);\r\n  this.repeat = new THREE.Vector2(1, 1);\r\n\r\n  this.format = options.format !== undefined ? options.format : THREE.RGBAFormat;\r\n  this.type = options.type !== undefined ? options.type : THREE.UnsignedByteType;\r\n\r\n  this.depthBuffer = options.depthBuffer !== undefined ? options.depthBuffer : true;\r\n  this.stencilBuffer = options.stencilBuffer !== undefined ? options.stencilBuffer : true;\r\n\r\n  this.generateMipmaps = true;\r\n\r\n  this.shareDepthFrom = options.shareDepthFrom !== undefined ? options.shareDepthFrom : null;\r\n\r\n};\r\n\r\nTHREE.WebGLRenderTarget.prototype = {\r\n\r\n  constructor: THREE.WebGLRenderTarget,\r\n\r\n  setSize: function(width, height) {\r\n\r\n    this.width = width;\r\n    this.height = height;\r\n\r\n  },\r\n\r\n  clone: function() {\r\n\r\n    var tmp = new THREE.WebGLRenderTarget(this.width, this.height);\r\n\r\n    tmp.wrapS = this.wrapS;\r\n    tmp.wrapT = this.wrapT;\r\n\r\n    tmp.magFilter = this.magFilter;\r\n    tmp.minFilter = this.minFilter;\r\n\r\n    tmp.anisotropy = this.anisotropy;\r\n\r\n    tmp.offset.copy(this.offset);\r\n    tmp.repeat.copy(this.repeat);\r\n\r\n    tmp.format = this.format;\r\n    tmp.type = this.type;\r\n\r\n    tmp.depthBuffer = this.depthBuffer;\r\n    tmp.stencilBuffer = this.stencilBuffer;\r\n\r\n    tmp.generateMipmaps = this.generateMipmaps;\r\n\r\n    tmp.shareDepthFrom = this.shareDepthFrom;\r\n\r\n    return tmp;\r\n\r\n  },\r\n\r\n  dispose: function() {\r\n\r\n    this.dispatchEvent({\r\n      type: 'dispose'\r\n    });\r\n\r\n  }\r\n\r\n};\r\n\r\nTHREE.EventDispatcher.prototype.apply(THREE.WebGLRenderTarget.prototype);\r\n\r\n// File:src/renderers/WebGLRenderTargetCube.js\r\n\r\n/**\r\n * @author alteredq / http://alteredqualia.com\r\n */\r\n\r\nTHREE.WebGLRenderTargetCube = function(width, height, options) {\r\n\r\n  THREE.WebGLRenderTarget.call(this, width, height, options);\r\n\r\n  this.activeCubeFace = 0; // PX 0, NX 1, PY 2, NY 3, PZ 4, NZ 5\r\n\r\n};\r\n\r\nTHREE.WebGLRenderTargetCube.prototype = Object.create(THREE.WebGLRenderTarget.prototype);\r\nTHREE.WebGLRenderTargetCube.prototype.constructor = THREE.WebGLRenderTargetCube;\r\n\r\n// File:src/renderers/webgl/WebGLExtensions.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.WebGLExtensions = function(gl) {\r\n\r\n  var extensions = {};\r\n\r\n  this.get = function(name) {\r\n\r\n    if (extensions[name] !== undefined) {\r\n\r\n      return extensions[name];\r\n\r\n    }\r\n\r\n    var extension;\r\n\r\n    switch (name) {\r\n\r\n      case 'EXT_texture_filter_anisotropic':\r\n        extension = gl.getExtension('EXT_texture_filter_anisotropic') || gl.getExtension('MOZ_EXT_texture_filter_anisotropic') || gl.getExtension('WEBKIT_EXT_texture_filter_anisotropic');\r\n        break;\r\n\r\n      case 'WEBGL_compressed_texture_s3tc':\r\n        extension = gl.getExtension('WEBGL_compressed_texture_s3tc') || gl.getExtension('MOZ_WEBGL_compressed_texture_s3tc') || gl.getExtension('WEBKIT_WEBGL_compressed_texture_s3tc');\r\n        break;\r\n\r\n      case 'WEBGL_compressed_texture_pvrtc':\r\n        extension = gl.getExtension('WEBGL_compressed_texture_pvrtc') || gl.getExtension('WEBKIT_WEBGL_compressed_texture_pvrtc');\r\n        break;\r\n\r\n      default:\r\n        extension = gl.getExtension(name);\r\n\r\n    }\r\n\r\n    if (extension === null) {\r\n\r\n      THREE.warn('THREE.WebGLRenderer: ' + name + ' extension not supported.');\r\n\r\n    }\r\n\r\n    extensions[name] = extension;\r\n\r\n    return extension;\r\n\r\n  };\r\n\r\n};\r\n\r\n// File:src/renderers/webgl/WebGLProgram.js\r\n\r\nTHREE.WebGLProgram = (function() {\r\n\r\n  var programIdCount = 0;\r\n\r\n  var generateDefines = function(defines) {\r\n\r\n    var value, chunk, chunks = [];\r\n\r\n    for (var d in defines) {\r\n\r\n      value = defines[d];\r\n      if (value === false) continue;\r\n\r\n      chunk = '#define ' + d + ' ' + value;\r\n      chunks.push(chunk);\r\n\r\n    }\r\n\r\n    return chunks.join('\\n');\r\n\r\n  };\r\n\r\n  var cacheUniformLocations = function(gl, program, identifiers) {\r\n\r\n    var uniforms = {};\r\n\r\n    for (var i = 0, l = identifiers.length; i < l; i++) {\r\n\r\n      var id = identifiers[i];\r\n      uniforms[id] = gl.getUniformLocation(program, id);\r\n\r\n    }\r\n\r\n    return uniforms;\r\n\r\n  };\r\n\r\n  var cacheAttributeLocations = function(gl, program, identifiers) {\r\n\r\n    var attributes = {};\r\n\r\n    for (var i = 0, l = identifiers.length; i < l; i++) {\r\n\r\n      var id = identifiers[i];\r\n      attributes[id] = gl.getAttribLocation(program, id);\r\n\r\n    }\r\n\r\n    return attributes;\r\n\r\n  };\r\n\r\n  return function(renderer, code, material, parameters) {\r\n\r\n    var _this = renderer;\r\n    var _gl = _this.context;\r\n\r\n    var defines = material.defines;\r\n    var uniforms = material.__webglShader.uniforms;\r\n    var attributes = material.attributes;\r\n\r\n    var vertexShader = material.__webglShader.vertexShader;\r\n    var fragmentShader = material.__webglShader.fragmentShader;\r\n\r\n    var index0AttributeName = material.index0AttributeName;\r\n\r\n    if (index0AttributeName === undefined && parameters.morphTargets === true) {\r\n\r\n      // programs with morphTargets displace position out of attribute 0\r\n\r\n      index0AttributeName = 'position';\r\n\r\n    }\r\n\r\n    var shadowMapTypeDefine = 'SHADOWMAP_TYPE_BASIC';\r\n\r\n    if (parameters.shadowMapType === THREE.PCFShadowMap) {\r\n\r\n      shadowMapTypeDefine = 'SHADOWMAP_TYPE_PCF';\r\n\r\n    }\r\n    else if (parameters.shadowMapType === THREE.PCFSoftShadowMap) {\r\n\r\n      shadowMapTypeDefine = 'SHADOWMAP_TYPE_PCF_SOFT';\r\n\r\n    }\r\n\r\n    var envMapTypeDefine = 'ENVMAP_TYPE_CUBE';\r\n    var envMapModeDefine = 'ENVMAP_MODE_REFLECTION';\r\n    var envMapBlendingDefine = 'ENVMAP_BLENDING_MULTIPLY';\r\n\r\n    if (parameters.envMap) {\r\n\r\n      switch (material.envMap.mapping) {\r\n\r\n        case THREE.CubeReflectionMapping:\r\n        case THREE.CubeRefractionMapping:\r\n          envMapTypeDefine = 'ENVMAP_TYPE_CUBE';\r\n          break;\r\n\r\n        case THREE.EquirectangularReflectionMapping:\r\n        case THREE.EquirectangularRefractionMapping:\r\n          envMapTypeDefine = 'ENVMAP_TYPE_EQUIREC';\r\n          break;\r\n\r\n        case THREE.SphericalReflectionMapping:\r\n          envMapTypeDefine = 'ENVMAP_TYPE_SPHERE';\r\n          break;\r\n\r\n      }\r\n\r\n      switch (material.envMap.mapping) {\r\n\r\n        case THREE.CubeRefractionMapping:\r\n        case THREE.EquirectangularRefractionMapping:\r\n          envMapModeDefine = 'ENVMAP_MODE_REFRACTION';\r\n          break;\r\n\r\n      }\r\n\r\n      switch (material.combine) {\r\n\r\n        case THREE.MultiplyOperation:\r\n          envMapBlendingDefine = 'ENVMAP_BLENDING_MULTIPLY';\r\n          break;\r\n\r\n        case THREE.MixOperation:\r\n          envMapBlendingDefine = 'ENVMAP_BLENDING_MIX';\r\n          break;\r\n\r\n        case THREE.AddOperation:\r\n          envMapBlendingDefine = 'ENVMAP_BLENDING_ADD';\r\n          break;\r\n\r\n      }\r\n\r\n    }\r\n\r\n    var gammaFactorDefine = (renderer.gammaFactor > 0) ? renderer.gammaFactor : 1.0;\r\n\r\n    // console.log( 'building new program ' );\r\n\r\n    //\r\n\r\n    var customDefines = generateDefines(defines);\r\n\r\n    //\r\n\r\n    var program = _gl.createProgram();\r\n\r\n    var prefix_vertex, prefix_fragment;\r\n\r\n    if (material instanceof THREE.RawShaderMaterial) {\r\n\r\n      prefix_vertex = '';\r\n      prefix_fragment = '';\r\n\r\n    }\r\n    else {\r\n\r\n      prefix_vertex = [\r\n\r\n        'precision ' + parameters.precision + ' float;',\r\n        'precision ' + parameters.precision + ' int;',\r\n\r\n        customDefines,\r\n\r\n        parameters.supportsVertexTextures ? '#define VERTEX_TEXTURES' : '',\r\n\r\n        _this.gammaInput ? '#define GAMMA_INPUT' : '',\r\n        _this.gammaOutput ? '#define GAMMA_OUTPUT' : '',\r\n        '#define GAMMA_FACTOR ' + gammaFactorDefine,\r\n\r\n        '#define MAX_DIR_LIGHTS ' + parameters.maxDirLights,\r\n        '#define MAX_POINT_LIGHTS ' + parameters.maxPointLights,\r\n        '#define MAX_SPOT_LIGHTS ' + parameters.maxSpotLights,\r\n        '#define MAX_HEMI_LIGHTS ' + parameters.maxHemiLights,\r\n\r\n        '#define MAX_SHADOWS ' + parameters.maxShadows,\r\n\r\n        '#define MAX_BONES ' + parameters.maxBones,\r\n\r\n        parameters.map ? '#define USE_MAP' : '',\r\n        parameters.envMap ? '#define USE_ENVMAP' : '',\r\n        parameters.envMap ? '#define ' + envMapModeDefine : '',\r\n        parameters.lightMap ? '#define USE_LIGHTMAP' : '',\r\n        parameters.bumpMap ? '#define USE_BUMPMAP' : '',\r\n        parameters.normalMap ? '#define USE_NORMALMAP' : '',\r\n        parameters.specularMap ? '#define USE_SPECULARMAP' : '',\r\n        parameters.alphaMap ? '#define USE_ALPHAMAP' : '',\r\n        parameters.vertexColors ? '#define USE_COLOR' : '',\r\n\r\n        parameters.flatShading ? '#define FLAT_SHADED' : '',\r\n\r\n        parameters.skinning ? '#define USE_SKINNING' : '',\r\n        parameters.useVertexTexture ? '#define BONE_TEXTURE' : '',\r\n\r\n        parameters.morphTargets ? '#define USE_MORPHTARGETS' : '',\r\n        parameters.morphNormals ? '#define USE_MORPHNORMALS' : '',\r\n        parameters.wrapAround ? '#define WRAP_AROUND' : '',\r\n        parameters.doubleSided ? '#define DOUBLE_SIDED' : '',\r\n        parameters.flipSided ? '#define FLIP_SIDED' : '',\r\n\r\n        parameters.shadowMapEnabled ? '#define USE_SHADOWMAP' : '',\r\n        parameters.shadowMapEnabled ? '#define ' + shadowMapTypeDefine : '',\r\n        parameters.shadowMapDebug ? '#define SHADOWMAP_DEBUG' : '',\r\n        parameters.shadowMapCascade ? '#define SHADOWMAP_CASCADE' : '',\r\n\r\n        parameters.sizeAttenuation ? '#define USE_SIZEATTENUATION' : '',\r\n\r\n        parameters.logarithmicDepthBuffer ? '#define USE_LOGDEPTHBUF' : '',\r\n        //_this._glExtensionFragDepth ? '#define USE_LOGDEPTHBUF_EXT' : '',\r\n\r\n\r\n        'uniform mat4 modelMatrix;',\r\n        'uniform mat4 modelViewMatrix;',\r\n        'uniform mat4 projectionMatrix;',\r\n        'uniform mat4 viewMatrix;',\r\n        'uniform mat3 normalMatrix;',\r\n        'uniform vec3 cameraPosition;',\r\n\r\n        'attribute vec3 position;',\r\n        'attribute vec3 normal;',\r\n        'attribute vec2 uv;',\r\n        'attribute vec2 uv2;',\r\n\r\n        '#ifdef USE_COLOR',\r\n\r\n        '\tattribute vec3 color;',\r\n\r\n        '#endif',\r\n\r\n        '#ifdef USE_MORPHTARGETS',\r\n\r\n        '\tattribute vec3 morphTarget0;',\r\n        '\tattribute vec3 morphTarget1;',\r\n        '\tattribute vec3 morphTarget2;',\r\n        '\tattribute vec3 morphTarget3;',\r\n\r\n        '\t#ifdef USE_MORPHNORMALS',\r\n\r\n        '\t\tattribute vec3 morphNormal0;',\r\n        '\t\tattribute vec3 morphNormal1;',\r\n        '\t\tattribute vec3 morphNormal2;',\r\n        '\t\tattribute vec3 morphNormal3;',\r\n\r\n        '\t#else',\r\n\r\n        '\t\tattribute vec3 morphTarget4;',\r\n        '\t\tattribute vec3 morphTarget5;',\r\n        '\t\tattribute vec3 morphTarget6;',\r\n        '\t\tattribute vec3 morphTarget7;',\r\n\r\n        '\t#endif',\r\n\r\n        '#endif',\r\n\r\n        '#ifdef USE_SKINNING',\r\n\r\n        '\tattribute vec4 skinIndex;',\r\n        '\tattribute vec4 skinWeight;',\r\n\r\n        '#endif',\r\n\r\n        ''\r\n\r\n      ].join('\\n');\r\n\r\n      prefix_fragment = [\r\n\r\n        'precision ' + parameters.precision + ' float;',\r\n        'precision ' + parameters.precision + ' int;',\r\n\r\n        (parameters.bumpMap || parameters.normalMap || parameters.flatShading) ? '#extension GL_OES_standard_derivatives : enable' : '',\r\n\r\n        customDefines,\r\n\r\n        '#define MAX_DIR_LIGHTS ' + parameters.maxDirLights,\r\n        '#define MAX_POINT_LIGHTS ' + parameters.maxPointLights,\r\n        '#define MAX_SPOT_LIGHTS ' + parameters.maxSpotLights,\r\n        '#define MAX_HEMI_LIGHTS ' + parameters.maxHemiLights,\r\n\r\n        '#define MAX_SHADOWS ' + parameters.maxShadows,\r\n\r\n        parameters.alphaTest ? '#define ALPHATEST ' + parameters.alphaTest : '',\r\n\r\n        _this.gammaInput ? '#define GAMMA_INPUT' : '',\r\n        _this.gammaOutput ? '#define GAMMA_OUTPUT' : '',\r\n        '#define GAMMA_FACTOR ' + gammaFactorDefine,\r\n\r\n        (parameters.useFog && parameters.fog) ? '#define USE_FOG' : '', (parameters.useFog && parameters.fogExp) ? '#define FOG_EXP2' : '',\r\n\r\n        parameters.map ? '#define USE_MAP' : '',\r\n        parameters.envMap ? '#define USE_ENVMAP' : '',\r\n        parameters.envMap ? '#define ' + envMapTypeDefine : '',\r\n        parameters.envMap ? '#define ' + envMapModeDefine : '',\r\n        parameters.envMap ? '#define ' + envMapBlendingDefine : '',\r\n        parameters.lightMap ? '#define USE_LIGHTMAP' : '',\r\n        parameters.bumpMap ? '#define USE_BUMPMAP' : '',\r\n        parameters.normalMap ? '#define USE_NORMALMAP' : '',\r\n        parameters.specularMap ? '#define USE_SPECULARMAP' : '',\r\n        parameters.alphaMap ? '#define USE_ALPHAMAP' : '',\r\n        parameters.vertexColors ? '#define USE_COLOR' : '',\r\n\r\n        parameters.flatShading ? '#define FLAT_SHADED' : '',\r\n\r\n        parameters.metal ? '#define METAL' : '',\r\n        parameters.wrapAround ? '#define WRAP_AROUND' : '',\r\n        parameters.doubleSided ? '#define DOUBLE_SIDED' : '',\r\n        parameters.flipSided ? '#define FLIP_SIDED' : '',\r\n\r\n        parameters.shadowMapEnabled ? '#define USE_SHADOWMAP' : '',\r\n        parameters.shadowMapEnabled ? '#define ' + shadowMapTypeDefine : '',\r\n        parameters.shadowMapDebug ? '#define SHADOWMAP_DEBUG' : '',\r\n        parameters.shadowMapCascade ? '#define SHADOWMAP_CASCADE' : '',\r\n\r\n        parameters.logarithmicDepthBuffer ? '#define USE_LOGDEPTHBUF' : '',\r\n        //_this._glExtensionFragDepth ? '#define USE_LOGDEPTHBUF_EXT' : '',\r\n\r\n        'uniform mat4 viewMatrix;',\r\n        'uniform vec3 cameraPosition;',\r\n        ''\r\n\r\n      ].join('\\n');\r\n\r\n    }\r\n\r\n    var glVertexShader = new THREE.WebGLShader(_gl, _gl.VERTEX_SHADER, prefix_vertex + vertexShader);\r\n    var glFragmentShader = new THREE.WebGLShader(_gl, _gl.FRAGMENT_SHADER, prefix_fragment + fragmentShader);\r\n\r\n    _gl.attachShader(program, glVertexShader);\r\n    _gl.attachShader(program, glFragmentShader);\r\n\r\n    if (index0AttributeName !== undefined) {\r\n\r\n      // Force a particular attribute to index 0.\r\n      // because potentially expensive emulation is done by browser if attribute 0 is disabled.\r\n      // And, color, for example is often automatically bound to index 0 so disabling it\r\n\r\n      _gl.bindAttribLocation(program, 0, index0AttributeName);\r\n\r\n    }\r\n\r\n    _gl.linkProgram(program);\r\n\r\n    var programLogInfo = _gl.getProgramInfoLog(program);\r\n\r\n    if (_gl.getProgramParameter(program, _gl.LINK_STATUS) === false) {\r\n\r\n      THREE.error('THREE.WebGLProgram: shader error: ' + _gl.getError(), 'gl.VALIDATE_STATUS', _gl.getProgramParameter(program, _gl.VALIDATE_STATUS), 'gl.getPRogramInfoLog', programLogInfo);\r\n\r\n    }\r\n\r\n    if (programLogInfo !== '') {\r\n\r\n      THREE.warn('THREE.WebGLProgram: gl.getProgramInfoLog()' + programLogInfo);\r\n      // THREE.warn( _gl.getExtension( 'WEBGL_debug_shaders' ).getTranslatedShaderSource( glVertexShader ) );\r\n      // THREE.warn( _gl.getExtension( 'WEBGL_debug_shaders' ).getTranslatedShaderSource( glFragmentShader ) );\r\n\r\n    }\r\n\r\n    // clean up\r\n\r\n    _gl.deleteShader(glVertexShader);\r\n    _gl.deleteShader(glFragmentShader);\r\n\r\n    // cache uniform locations\r\n\r\n    var identifiers = [\r\n\r\n      'viewMatrix',\r\n      'modelViewMatrix',\r\n      'projectionMatrix',\r\n      'normalMatrix',\r\n      'modelMatrix',\r\n      'cameraPosition',\r\n      'morphTargetInfluences',\r\n      'bindMatrix',\r\n      'bindMatrixInverse'\r\n\r\n    ];\r\n\r\n    if (parameters.useVertexTexture) {\r\n\r\n      identifiers.push('boneTexture');\r\n      identifiers.push('boneTextureWidth');\r\n      identifiers.push('boneTextureHeight');\r\n\r\n    }\r\n    else {\r\n\r\n      identifiers.push('boneGlobalMatrices');\r\n\r\n    }\r\n\r\n    if (parameters.logarithmicDepthBuffer) {\r\n\r\n      identifiers.push('logDepthBufFC');\r\n\r\n    }\r\n\r\n\r\n    for (var u in uniforms) {\r\n\r\n      identifiers.push(u);\r\n\r\n    }\r\n\r\n    this.uniforms = cacheUniformLocations(_gl, program, identifiers);\r\n\r\n    // cache attributes locations\r\n\r\n    identifiers = [\r\n\r\n      'position',\r\n      'normal',\r\n      'uv',\r\n      'uv2',\r\n      'tangent',\r\n      'color',\r\n      'skinIndex',\r\n      'skinWeight',\r\n      'lineDistance'\r\n\r\n    ];\r\n\r\n    for (var i = 0; i < parameters.maxMorphTargets; i++) {\r\n\r\n      identifiers.push('morphTarget' + i);\r\n\r\n    }\r\n\r\n    for (var i = 0; i < parameters.maxMorphNormals; i++) {\r\n\r\n      identifiers.push('morphNormal' + i);\r\n\r\n    }\r\n\r\n    for (var a in attributes) {\r\n\r\n      identifiers.push(a);\r\n\r\n    }\r\n\r\n    this.attributes = cacheAttributeLocations(_gl, program, identifiers);\r\n    this.attributesKeys = Object.keys(this.attributes);\r\n\r\n    //\r\n\r\n    this.id = programIdCount++;\r\n    this.code = code;\r\n    this.usedTimes = 1;\r\n    this.program = program;\r\n    this.vertexShader = glVertexShader;\r\n    this.fragmentShader = glFragmentShader;\r\n\r\n    return this;\r\n\r\n  };\r\n\r\n})();\r\n\r\n// File:src/renderers/webgl/WebGLShader.js\r\n\r\nTHREE.WebGLShader = (function() {\r\n\r\n  var addLineNumbers = function(string) {\r\n\r\n    var lines = string.split('\\n');\r\n\r\n    for (var i = 0; i < lines.length; i++) {\r\n\r\n      lines[i] = (i + 1) + ': ' + lines[i];\r\n\r\n    }\r\n\r\n    return lines.join('\\n');\r\n\r\n  };\r\n\r\n  return function(gl, type, string) {\r\n\r\n    var shader = gl.createShader(type);\r\n\r\n    gl.shaderSource(shader, string);\r\n    gl.compileShader(shader);\r\n\r\n    if (gl.getShaderParameter(shader, gl.COMPILE_STATUS) === false) {\r\n\r\n      THREE.error('THREE.WebGLShader: Shader couldn\\'t compile.');\r\n\r\n    }\r\n\r\n    if (gl.getShaderInfoLog(shader) !== '') {\r\n\r\n      THREE.warn('THREE.WebGLShader: gl.getShaderInfoLog()', gl.getShaderInfoLog(shader), addLineNumbers(string));\r\n\r\n    }\r\n\r\n    // --enable-privileged-webgl-extension\r\n    // console.log( type, gl.getExtension( 'WEBGL_debug_shaders' ).getTranslatedShaderSource( shader ) );\r\n\r\n    return shader;\r\n\r\n  };\r\n\r\n})();\r\n\r\n// File:src/renderers/webgl/WebGLState.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.WebGLState = function(gl, paramThreeToGL) {\r\n\r\n  var newAttributes = new Uint8Array(16);\r\n  var enabledAttributes = new Uint8Array(16);\r\n\r\n  var currentBlending = null;\r\n  var currentBlendEquation = null;\r\n  var currentBlendSrc = null;\r\n  var currentBlendDst = null;\r\n  var currentBlendEquationAlpha = null;\r\n  var currentBlendSrcAlpha = null;\r\n  var currentBlendDstAlpha = null;\r\n\r\n  var currentDepthTest = null;\r\n  var currentDepthWrite = null;\r\n\r\n  var currentColorWrite = null;\r\n\r\n  var currentDoubleSided = null;\r\n  var currentFlipSided = null;\r\n\r\n  var currentLineWidth = null;\r\n\r\n  var currentPolygonOffset = null;\r\n  var currentPolygonOffsetFactor = null;\r\n  var currentPolygonOffsetUnits = null;\r\n\r\n  this.initAttributes = function() {\r\n\r\n    for (var i = 0, l = newAttributes.length; i < l; i++) {\r\n\r\n      newAttributes[i] = 0;\r\n\r\n    }\r\n\r\n  };\r\n\r\n  this.enableAttribute = function(attribute) {\r\n\r\n    newAttributes[attribute] = 1;\r\n\r\n    if (enabledAttributes[attribute] === 0) {\r\n\r\n      gl.enableVertexAttribArray(attribute);\r\n      enabledAttributes[attribute] = 1;\r\n\r\n    }\r\n\r\n  };\r\n\r\n  this.disableUnusedAttributes = function() {\r\n\r\n    for (var i = 0, l = enabledAttributes.length; i < l; i++) {\r\n\r\n      if (enabledAttributes[i] !== newAttributes[i]) {\r\n\r\n        gl.disableVertexAttribArray(i);\r\n        enabledAttributes[i] = 0;\r\n\r\n      }\r\n\r\n    }\r\n\r\n  };\r\n\r\n  this.setBlending = function(blending, blendEquation, blendSrc, blendDst, blendEquationAlpha, blendSrcAlpha, blendDstAlpha) {\r\n\r\n    if (blending !== currentBlending) {\r\n\r\n      if (blending === THREE.NoBlending) {\r\n\r\n        gl.disable(gl.BLEND);\r\n\r\n      }\r\n      else if (blending === THREE.AdditiveBlending) {\r\n\r\n        gl.enable(gl.BLEND);\r\n        gl.blendEquation(gl.FUNC_ADD);\r\n        gl.blendFunc(gl.SRC_ALPHA, gl.ONE);\r\n\r\n      }\r\n      else if (blending === THREE.SubtractiveBlending) {\r\n\r\n        // TODO: Find blendFuncSeparate() combination\r\n        gl.enable(gl.BLEND);\r\n        gl.blendEquation(gl.FUNC_ADD);\r\n        gl.blendFunc(gl.ZERO, gl.ONE_MINUS_SRC_COLOR);\r\n\r\n      }\r\n      else if (blending === THREE.MultiplyBlending) {\r\n\r\n        // TODO: Find blendFuncSeparate() combination\r\n        gl.enable(gl.BLEND);\r\n        gl.blendEquation(gl.FUNC_ADD);\r\n        gl.blendFunc(gl.ZERO, gl.SRC_COLOR);\r\n\r\n      }\r\n      else if (blending === THREE.CustomBlending) {\r\n\r\n        gl.enable(gl.BLEND);\r\n\r\n      }\r\n      else {\r\n\r\n        gl.enable(gl.BLEND);\r\n        gl.blendEquationSeparate(gl.FUNC_ADD, gl.FUNC_ADD);\r\n        gl.blendFuncSeparate(gl.SRC_ALPHA, gl.ONE_MINUS_SRC_ALPHA, gl.ONE, gl.ONE_MINUS_SRC_ALPHA);\r\n\r\n      }\r\n\r\n      currentBlending = blending;\r\n\r\n    }\r\n\r\n    if (blending === THREE.CustomBlending) {\r\n\r\n      blendEquationAlpha = blendEquationAlpha || blendEquation;\r\n      blendSrcAlpha = blendSrcAlpha || blendSrc;\r\n      blendDstAlpha = blendDstAlpha || blendDst;\r\n\r\n      if (blendEquation !== currentBlendEquation || blendEquationAlpha !== currentBlendEquationAlpha) {\r\n\r\n        gl.blendEquationSeparate(paramThreeToGL(blendEquation), paramThreeToGL(blendEquationAlpha));\r\n\r\n        currentBlendEquation = blendEquation;\r\n        currentBlendEquationAlpha = blendEquationAlpha;\r\n\r\n      }\r\n\r\n      if (blendSrc !== currentBlendSrc || blendDst !== currentBlendDst || blendSrcAlpha !== currentBlendSrcAlpha || blendDstAlpha !== currentBlendDstAlpha) {\r\n\r\n        gl.blendFuncSeparate(paramThreeToGL(blendSrc), paramThreeToGL(blendDst), paramThreeToGL(blendSrcAlpha), paramThreeToGL(blendDstAlpha));\r\n\r\n        currentBlendSrc = blendSrc;\r\n        currentBlendDst = blendDst;\r\n        currentBlendSrcAlpha = blendSrcAlpha;\r\n        currentBlendDstAlpha = blendDstAlpha;\r\n\r\n      }\r\n\r\n    }\r\n    else {\r\n\r\n      currentBlendEquation = null;\r\n      currentBlendSrc = null;\r\n      currentBlendDst = null;\r\n      currentBlendEquationAlpha = null;\r\n      currentBlendSrcAlpha = null;\r\n      currentBlendDstAlpha = null;\r\n\r\n    }\r\n\r\n  };\r\n\r\n  this.setDepthTest = function(depthTest) {\r\n\r\n    if (currentDepthTest !== depthTest) {\r\n\r\n      if (depthTest) {\r\n\r\n        gl.enable(gl.DEPTH_TEST);\r\n\r\n      }\r\n      else {\r\n\r\n        gl.disable(gl.DEPTH_TEST);\r\n\r\n      }\r\n\r\n      currentDepthTest = depthTest;\r\n\r\n    }\r\n\r\n  };\r\n\r\n  this.setDepthWrite = function(depthWrite) {\r\n\r\n    if (currentDepthWrite !== depthWrite) {\r\n\r\n      gl.depthMask(depthWrite);\r\n      currentDepthWrite = depthWrite;\r\n\r\n    }\r\n\r\n  };\r\n\r\n  this.setColorWrite = function(colorWrite) {\r\n\r\n    if (currentColorWrite !== colorWrite) {\r\n\r\n      gl.colorMask(colorWrite, colorWrite, colorWrite, colorWrite);\r\n      currentColorWrite = colorWrite;\r\n\r\n    }\r\n\r\n  };\r\n\r\n  this.setDoubleSided = function(doubleSided) {\r\n\r\n    if (currentDoubleSided !== doubleSided) {\r\n\r\n      if (doubleSided) {\r\n\r\n        gl.disable(gl.CULL_FACE);\r\n\r\n      }\r\n      else {\r\n\r\n        gl.enable(gl.CULL_FACE);\r\n\r\n      }\r\n\r\n      currentDoubleSided = doubleSided;\r\n\r\n    }\r\n\r\n  };\r\n\r\n  this.setFlipSided = function(flipSided) {\r\n\r\n    if (currentFlipSided !== flipSided) {\r\n\r\n      if (flipSided) {\r\n\r\n        gl.frontFace(gl.CW);\r\n\r\n      }\r\n      else {\r\n\r\n        gl.frontFace(gl.CCW);\r\n\r\n      }\r\n\r\n      currentFlipSided = flipSided;\r\n\r\n    }\r\n\r\n  };\r\n\r\n  this.setLineWidth = function(width) {\r\n\r\n    if (width !== currentLineWidth) {\r\n\r\n      gl.lineWidth(width);\r\n\r\n      currentLineWidth = width;\r\n\r\n    }\r\n\r\n  };\r\n\r\n  this.setPolygonOffset = function(polygonoffset, factor, units) {\r\n\r\n    if (currentPolygonOffset !== polygonoffset) {\r\n\r\n      if (polygonoffset) {\r\n\r\n        gl.enable(gl.POLYGON_OFFSET_FILL);\r\n\r\n      }\r\n      else {\r\n\r\n        gl.disable(gl.POLYGON_OFFSET_FILL);\r\n\r\n      }\r\n\r\n      currentPolygonOffset = polygonoffset;\r\n\r\n    }\r\n\r\n    if (polygonoffset && (currentPolygonOffsetFactor !== factor || currentPolygonOffsetUnits !== units)) {\r\n\r\n      gl.polygonOffset(factor, units);\r\n\r\n      currentPolygonOffsetFactor = factor;\r\n      currentPolygonOffsetUnits = units;\r\n\r\n    }\r\n\r\n  };\r\n\r\n  this.reset = function() {\r\n\r\n    for (var i = 0; i < enabledAttributes.length; i++) {\r\n\r\n      enabledAttributes[i] = 0;\r\n\r\n    }\r\n\r\n    currentBlending = null;\r\n    currentDepthTest = null;\r\n    currentDepthWrite = null;\r\n    currentColorWrite = null;\r\n    currentDoubleSided = null;\r\n    currentFlipSided = null;\r\n\r\n  };\r\n\r\n};\r\n\r\n// File:src/renderers/webgl/plugins/LensFlarePlugin.js\r\n\r\n/**\r\n * @author mikael emtinger / http://gomo.se/\r\n * @author alteredq / http://alteredqualia.com/\r\n */\r\n\r\nTHREE.LensFlarePlugin = function(renderer, flares) {\r\n\r\n  var gl = renderer.context;\r\n\r\n  var vertexBuffer, elementBuffer;\r\n  var program, attributes, uniforms;\r\n  var hasVertexTexture;\r\n\r\n  var tempTexture, occlusionTexture;\r\n\r\n  var init = function() {\r\n\r\n    var vertices = new Float32Array([-1, -1, 0, 0,\r\n      1, -1, 1, 0,\r\n      1, 1, 1, 1, -1, 1, 0, 1\r\n    ]);\r\n\r\n    var faces = new Uint16Array([\r\n      0, 1, 2,\r\n      0, 2, 3\r\n    ]);\r\n\r\n    // buffers\r\n\r\n    vertexBuffer = gl.createBuffer();\r\n    elementBuffer = gl.createBuffer();\r\n\r\n    gl.bindBuffer(gl.ARRAY_BUFFER, vertexBuffer);\r\n    gl.bufferData(gl.ARRAY_BUFFER, vertices, gl.STATIC_DRAW);\r\n\r\n    gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, elementBuffer);\r\n    gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, faces, gl.STATIC_DRAW);\r\n\r\n    // textures\r\n\r\n    tempTexture = gl.createTexture();\r\n    occlusionTexture = gl.createTexture();\r\n\r\n    gl.bindTexture(gl.TEXTURE_2D, tempTexture);\r\n    gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGB, 16, 16, 0, gl.RGB, gl.UNSIGNED_BYTE, null);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);\r\n\r\n    gl.bindTexture(gl.TEXTURE_2D, occlusionTexture);\r\n    gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, 16, 16, 0, gl.RGBA, gl.UNSIGNED_BYTE, null);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);\r\n\r\n    hasVertexTexture = gl.getParameter(gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS) > 0;\r\n\r\n    var shader;\r\n\r\n    if (hasVertexTexture) {\r\n\r\n      shader = {\r\n\r\n        vertexShader: [\r\n\r\n          \"uniform lowp int renderType;\",\r\n\r\n          \"uniform vec3 screenPosition;\",\r\n          \"uniform vec2 scale;\",\r\n          \"uniform float rotation;\",\r\n\r\n          \"uniform sampler2D occlusionMap;\",\r\n\r\n          \"attribute vec2 position;\",\r\n          \"attribute vec2 uv;\",\r\n\r\n          \"varying vec2 vUV;\",\r\n          \"varying float vVisibility;\",\r\n\r\n          \"void main() {\",\r\n\r\n          \"vUV = uv;\",\r\n\r\n          \"vec2 pos = position;\",\r\n\r\n          \"if( renderType == 2 ) {\",\r\n\r\n          \"vec4 visibility = texture2D( occlusionMap, vec2( 0.1, 0.1 ) );\",\r\n          \"visibility += texture2D( occlusionMap, vec2( 0.5, 0.1 ) );\",\r\n          \"visibility += texture2D( occlusionMap, vec2( 0.9, 0.1 ) );\",\r\n          \"visibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) );\",\r\n          \"visibility += texture2D( occlusionMap, vec2( 0.9, 0.9 ) );\",\r\n          \"visibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) );\",\r\n          \"visibility += texture2D( occlusionMap, vec2( 0.1, 0.9 ) );\",\r\n          \"visibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) );\",\r\n          \"visibility += texture2D( occlusionMap, vec2( 0.5, 0.5 ) );\",\r\n\r\n          \"vVisibility =        visibility.r / 9.0;\",\r\n          \"vVisibility *= 1.0 - visibility.g / 9.0;\",\r\n          \"vVisibility *=       visibility.b / 9.0;\",\r\n          \"vVisibility *= 1.0 - visibility.a / 9.0;\",\r\n\r\n          \"pos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;\",\r\n          \"pos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;\",\r\n\r\n          \"}\",\r\n\r\n          \"gl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );\",\r\n\r\n          \"}\"\r\n\r\n        ].join(\"\\n\"),\r\n\r\n        fragmentShader: [\r\n\r\n          \"uniform lowp int renderType;\",\r\n\r\n          \"uniform sampler2D map;\",\r\n          \"uniform float opacity;\",\r\n          \"uniform vec3 color;\",\r\n\r\n          \"varying vec2 vUV;\",\r\n          \"varying float vVisibility;\",\r\n\r\n          \"void main() {\",\r\n\r\n          // pink square\r\n\r\n          \"if( renderType == 0 ) {\",\r\n\r\n          \"gl_FragColor = vec4( 1.0, 0.0, 1.0, 0.0 );\",\r\n\r\n          // restore\r\n\r\n          \"} else if( renderType == 1 ) {\",\r\n\r\n          \"gl_FragColor = texture2D( map, vUV );\",\r\n\r\n          // flare\r\n\r\n          \"} else {\",\r\n\r\n          \"vec4 texture = texture2D( map, vUV );\",\r\n          \"texture.a *= opacity * vVisibility;\",\r\n          \"gl_FragColor = texture;\",\r\n          \"gl_FragColor.rgb *= color;\",\r\n\r\n          \"}\",\r\n\r\n          \"}\"\r\n\r\n        ].join(\"\\n\")\r\n\r\n      };\r\n\r\n    }\r\n    else {\r\n\r\n      shader = {\r\n\r\n        vertexShader: [\r\n\r\n          \"uniform lowp int renderType;\",\r\n\r\n          \"uniform vec3 screenPosition;\",\r\n          \"uniform vec2 scale;\",\r\n          \"uniform float rotation;\",\r\n\r\n          \"attribute vec2 position;\",\r\n          \"attribute vec2 uv;\",\r\n\r\n          \"varying vec2 vUV;\",\r\n\r\n          \"void main() {\",\r\n\r\n          \"vUV = uv;\",\r\n\r\n          \"vec2 pos = position;\",\r\n\r\n          \"if( renderType == 2 ) {\",\r\n\r\n          \"pos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;\",\r\n          \"pos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;\",\r\n\r\n          \"}\",\r\n\r\n          \"gl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );\",\r\n\r\n          \"}\"\r\n\r\n        ].join(\"\\n\"),\r\n\r\n        fragmentShader: [\r\n\r\n          \"precision mediump float;\",\r\n\r\n          \"uniform lowp int renderType;\",\r\n\r\n          \"uniform sampler2D map;\",\r\n          \"uniform sampler2D occlusionMap;\",\r\n          \"uniform float opacity;\",\r\n          \"uniform vec3 color;\",\r\n\r\n          \"varying vec2 vUV;\",\r\n\r\n          \"void main() {\",\r\n\r\n          // pink square\r\n\r\n          \"if( renderType == 0 ) {\",\r\n\r\n          \"gl_FragColor = vec4( texture2D( map, vUV ).rgb, 0.0 );\",\r\n\r\n          // restore\r\n\r\n          \"} else if( renderType == 1 ) {\",\r\n\r\n          \"gl_FragColor = texture2D( map, vUV );\",\r\n\r\n          // flare\r\n\r\n          \"} else {\",\r\n\r\n          \"float visibility = texture2D( occlusionMap, vec2( 0.5, 0.1 ) ).a;\",\r\n          \"visibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) ).a;\",\r\n          \"visibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) ).a;\",\r\n          \"visibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) ).a;\",\r\n          \"visibility = ( 1.0 - visibility / 4.0 );\",\r\n\r\n          \"vec4 texture = texture2D( map, vUV );\",\r\n          \"texture.a *= opacity * visibility;\",\r\n          \"gl_FragColor = texture;\",\r\n          \"gl_FragColor.rgb *= color;\",\r\n\r\n          \"}\",\r\n\r\n          \"}\"\r\n\r\n        ].join(\"\\n\")\r\n\r\n      };\r\n\r\n    }\r\n\r\n    program = createProgram(shader);\r\n\r\n    attributes = {\r\n      vertex: gl.getAttribLocation(program, \"position\"),\r\n      uv: gl.getAttribLocation(program, \"uv\")\r\n    }\r\n\r\n    uniforms = {\r\n      renderType: gl.getUniformLocation(program, \"renderType\"),\r\n      map: gl.getUniformLocation(program, \"map\"),\r\n      occlusionMap: gl.getUniformLocation(program, \"occlusionMap\"),\r\n      opacity: gl.getUniformLocation(program, \"opacity\"),\r\n      color: gl.getUniformLocation(program, \"color\"),\r\n      scale: gl.getUniformLocation(program, \"scale\"),\r\n      rotation: gl.getUniformLocation(program, \"rotation\"),\r\n      screenPosition: gl.getUniformLocation(program, \"screenPosition\")\r\n    };\r\n\r\n  };\r\n\r\n  /*\r\n   * Render lens flares\r\n   * Method: renders 16x16 0xff00ff-colored points scattered over the light source area,\r\n   *         reads these back and calculates occlusion.\r\n   */\r\n\r\n  this.render = function(scene, camera, viewportWidth, viewportHeight) {\r\n\r\n    if (flares.length === 0) return;\r\n\r\n    var tempPosition = new THREE.Vector3();\r\n\r\n    var invAspect = viewportHeight / viewportWidth,\r\n      halfViewportWidth = viewportWidth * 0.5,\r\n      halfViewportHeight = viewportHeight * 0.5;\r\n\r\n    var size = 16 / viewportHeight,\r\n      scale = new THREE.Vector2(size * invAspect, size);\r\n\r\n    var screenPosition = new THREE.Vector3(1, 1, 0),\r\n      screenPositionPixels = new THREE.Vector2(1, 1);\r\n\r\n    if (program === undefined) {\r\n\r\n      init();\r\n\r\n    }\r\n\r\n    gl.useProgram(program);\r\n\r\n    gl.enableVertexAttribArray(attributes.vertex);\r\n    gl.enableVertexAttribArray(attributes.uv);\r\n\r\n    // loop through all lens flares to update their occlusion and positions\r\n    // setup gl and common used attribs/unforms\r\n\r\n    gl.uniform1i(uniforms.occlusionMap, 0);\r\n    gl.uniform1i(uniforms.map, 1);\r\n\r\n    gl.bindBuffer(gl.ARRAY_BUFFER, vertexBuffer);\r\n    gl.vertexAttribPointer(attributes.vertex, 2, gl.FLOAT, false, 2 * 8, 0);\r\n    gl.vertexAttribPointer(attributes.uv, 2, gl.FLOAT, false, 2 * 8, 8);\r\n\r\n    gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, elementBuffer);\r\n\r\n    gl.disable(gl.CULL_FACE);\r\n    gl.depthMask(false);\r\n\r\n    for (var i = 0, l = flares.length; i < l; i++) {\r\n\r\n      size = 16 / viewportHeight;\r\n      scale.set(size * invAspect, size);\r\n\r\n      // calc object screen position\r\n\r\n      var flare = flares[i];\r\n\r\n      tempPosition.set(flare.matrixWorld.elements[12], flare.matrixWorld.elements[13], flare.matrixWorld.elements[14]);\r\n\r\n      tempPosition.applyMatrix4(camera.matrixWorldInverse);\r\n      tempPosition.applyProjection(camera.projectionMatrix);\r\n\r\n      // setup arrays for gl programs\r\n\r\n      screenPosition.copy(tempPosition)\r\n\r\n      screenPositionPixels.x = screenPosition.x * halfViewportWidth + halfViewportWidth;\r\n      screenPositionPixels.y = screenPosition.y * halfViewportHeight + halfViewportHeight;\r\n\r\n      // screen cull\r\n\r\n      if (hasVertexTexture || (\r\n          screenPositionPixels.x > 0 &&\r\n          screenPositionPixels.x < viewportWidth &&\r\n          screenPositionPixels.y > 0 &&\r\n          screenPositionPixels.y < viewportHeight)) {\r\n\r\n        // save current RGB to temp texture\r\n\r\n        gl.activeTexture(gl.TEXTURE1);\r\n        gl.bindTexture(gl.TEXTURE_2D, tempTexture);\r\n        gl.copyTexImage2D(gl.TEXTURE_2D, 0, gl.RGB, screenPositionPixels.x - 8, screenPositionPixels.y - 8, 16, 16, 0);\r\n\r\n\r\n        // render pink quad\r\n\r\n        gl.uniform1i(uniforms.renderType, 0);\r\n        gl.uniform2f(uniforms.scale, scale.x, scale.y);\r\n        gl.uniform3f(uniforms.screenPosition, screenPosition.x, screenPosition.y, screenPosition.z);\r\n\r\n        gl.disable(gl.BLEND);\r\n        gl.enable(gl.DEPTH_TEST);\r\n\r\n        gl.drawElements(gl.TRIANGLES, 6, gl.UNSIGNED_SHORT, 0);\r\n\r\n\r\n        // copy result to occlusionMap\r\n\r\n        gl.activeTexture(gl.TEXTURE0);\r\n        gl.bindTexture(gl.TEXTURE_2D, occlusionTexture);\r\n        gl.copyTexImage2D(gl.TEXTURE_2D, 0, gl.RGBA, screenPositionPixels.x - 8, screenPositionPixels.y - 8, 16, 16, 0);\r\n\r\n\r\n        // restore graphics\r\n\r\n        gl.uniform1i(uniforms.renderType, 1);\r\n        gl.disable(gl.DEPTH_TEST);\r\n\r\n        gl.activeTexture(gl.TEXTURE1);\r\n        gl.bindTexture(gl.TEXTURE_2D, tempTexture);\r\n        gl.drawElements(gl.TRIANGLES, 6, gl.UNSIGNED_SHORT, 0);\r\n\r\n\r\n        // update object positions\r\n\r\n        flare.positionScreen.copy(screenPosition)\r\n\r\n        if (flare.customUpdateCallback) {\r\n\r\n          flare.customUpdateCallback(flare);\r\n\r\n        }\r\n        else {\r\n\r\n          flare.updateLensFlares();\r\n\r\n        }\r\n\r\n        // render flares\r\n\r\n        gl.uniform1i(uniforms.renderType, 2);\r\n        gl.enable(gl.BLEND);\r\n\r\n        for (var j = 0, jl = flare.lensFlares.length; j < jl; j++) {\r\n\r\n          var sprite = flare.lensFlares[j];\r\n\r\n          if (sprite.opacity > 0.001 && sprite.scale > 0.001) {\r\n\r\n            screenPosition.x = sprite.x;\r\n            screenPosition.y = sprite.y;\r\n            screenPosition.z = sprite.z;\r\n\r\n            size = sprite.size * sprite.scale / viewportHeight;\r\n\r\n            scale.x = size * invAspect;\r\n            scale.y = size;\r\n\r\n            gl.uniform3f(uniforms.screenPosition, screenPosition.x, screenPosition.y, screenPosition.z);\r\n            gl.uniform2f(uniforms.scale, scale.x, scale.y);\r\n            gl.uniform1f(uniforms.rotation, sprite.rotation);\r\n\r\n            gl.uniform1f(uniforms.opacity, sprite.opacity);\r\n            gl.uniform3f(uniforms.color, sprite.color.r, sprite.color.g, sprite.color.b);\r\n\r\n            renderer.state.setBlending(sprite.blending, sprite.blendEquation, sprite.blendSrc, sprite.blendDst);\r\n            renderer.setTexture(sprite.texture, 1);\r\n\r\n            gl.drawElements(gl.TRIANGLES, 6, gl.UNSIGNED_SHORT, 0);\r\n\r\n          }\r\n\r\n        }\r\n\r\n      }\r\n\r\n    }\r\n\r\n    // restore gl\r\n\r\n    gl.enable(gl.CULL_FACE);\r\n    gl.enable(gl.DEPTH_TEST);\r\n    gl.depthMask(true);\r\n\r\n    renderer.resetGLState();\r\n\r\n  };\r\n\r\n  function createProgram(shader) {\r\n\r\n    var program = gl.createProgram();\r\n\r\n    var fragmentShader = gl.createShader(gl.FRAGMENT_SHADER);\r\n    var vertexShader = gl.createShader(gl.VERTEX_SHADER);\r\n\r\n    var prefix = \"precision \" + renderer.getPrecision() + \" float;\\n\";\r\n\r\n    gl.shaderSource(fragmentShader, prefix + shader.fragmentShader);\r\n    gl.shaderSource(vertexShader, prefix + shader.vertexShader);\r\n\r\n    gl.compileShader(fragmentShader);\r\n    gl.compileShader(vertexShader);\r\n\r\n    gl.attachShader(program, fragmentShader);\r\n    gl.attachShader(program, vertexShader);\r\n\r\n    gl.linkProgram(program);\r\n\r\n    return program;\r\n\r\n  }\r\n\r\n};\r\n\r\n// File:src/renderers/webgl/plugins/ShadowMapPlugin.js\r\n\r\n/**\r\n * @author alteredq / http://alteredqualia.com/\r\n */\r\n\r\nTHREE.ShadowMapPlugin = function(_renderer, _lights, _webglObjects, _webglObjectsImmediate) {\r\n\r\n  var _gl = _renderer.context;\r\n\r\n  var _depthMaterial, _depthMaterialMorph, _depthMaterialSkin, _depthMaterialMorphSkin,\r\n\r\n    _frustum = new THREE.Frustum(),\r\n    _projScreenMatrix = new THREE.Matrix4(),\r\n\r\n    _min = new THREE.Vector3(),\r\n    _max = new THREE.Vector3(),\r\n\r\n    _matrixPosition = new THREE.Vector3(),\r\n\r\n    _renderList = [];\r\n\r\n  // init\r\n\r\n  var depthShader = THREE.ShaderLib[\"depthRGBA\"];\r\n  var depthUniforms = THREE.UniformsUtils.clone(depthShader.uniforms);\r\n\r\n  _depthMaterial = new THREE.ShaderMaterial({\r\n    uniforms: depthUniforms,\r\n    vertexShader: depthShader.vertexShader,\r\n    fragmentShader: depthShader.fragmentShader\r\n  });\r\n\r\n  _depthMaterialMorph = new THREE.ShaderMaterial({\r\n    uniforms: depthUniforms,\r\n    vertexShader: depthShader.vertexShader,\r\n    fragmentShader: depthShader.fragmentShader,\r\n    morphTargets: true\r\n  });\r\n\r\n  _depthMaterialSkin = new THREE.ShaderMaterial({\r\n    uniforms: depthUniforms,\r\n    vertexShader: depthShader.vertexShader,\r\n    fragmentShader: depthShader.fragmentShader,\r\n    skinning: true\r\n  });\r\n\r\n  _depthMaterialMorphSkin = new THREE.ShaderMaterial({\r\n    uniforms: depthUniforms,\r\n    vertexShader: depthShader.vertexShader,\r\n    fragmentShader: depthShader.fragmentShader,\r\n    morphTargets: true,\r\n    skinning: true\r\n  });\r\n\r\n  _depthMaterial._shadowPass = true;\r\n  _depthMaterialMorph._shadowPass = true;\r\n  _depthMaterialSkin._shadowPass = true;\r\n  _depthMaterialMorphSkin._shadowPass = true;\r\n\r\n  this.render = function(scene, camera) {\r\n\r\n    if (_renderer.shadowMapEnabled === false) return;\r\n\r\n    var i, il, j, jl, n,\r\n\r\n      shadowMap, shadowMatrix, shadowCamera,\r\n      buffer, material,\r\n      webglObject, object, light,\r\n\r\n      lights = [],\r\n      k = 0,\r\n\r\n      fog = null;\r\n\r\n    // set GL state for depth map\r\n\r\n    _gl.clearColor(1, 1, 1, 1);\r\n    _gl.disable(_gl.BLEND);\r\n\r\n    _gl.enable(_gl.CULL_FACE);\r\n    _gl.frontFace(_gl.CCW);\r\n\r\n    if (_renderer.shadowMapCullFace === THREE.CullFaceFront) {\r\n\r\n      _gl.cullFace(_gl.FRONT);\r\n\r\n    }\r\n    else {\r\n\r\n      _gl.cullFace(_gl.BACK);\r\n\r\n    }\r\n\r\n    _renderer.state.setDepthTest(true);\r\n\r\n    // preprocess lights\r\n    // \t- skip lights that are not casting shadows\r\n    //\t- create virtual lights for cascaded shadow maps\r\n\r\n    for (i = 0, il = _lights.length; i < il; i++) {\r\n\r\n      light = _lights[i];\r\n\r\n      if (!light.castShadow) continue;\r\n\r\n      if ((light instanceof THREE.DirectionalLight) && light.shadowCascade) {\r\n\r\n        for (n = 0; n < light.shadowCascadeCount; n++) {\r\n\r\n          var virtualLight;\r\n\r\n          if (!light.shadowCascadeArray[n]) {\r\n\r\n            virtualLight = createVirtualLight(light, n);\r\n            virtualLight.originalCamera = camera;\r\n\r\n            var gyro = new THREE.Gyroscope();\r\n            gyro.position.copy(light.shadowCascadeOffset);\r\n\r\n            gyro.add(virtualLight);\r\n            gyro.add(virtualLight.target);\r\n\r\n            camera.add(gyro);\r\n\r\n            light.shadowCascadeArray[n] = virtualLight;\r\n\r\n            //console.log( \"Created virtualLight\", virtualLight );\r\n\r\n          }\r\n          else {\r\n\r\n            virtualLight = light.shadowCascadeArray[n];\r\n\r\n          }\r\n\r\n          updateVirtualLight(light, n);\r\n\r\n          lights[k] = virtualLight;\r\n          k++;\r\n\r\n        }\r\n\r\n      }\r\n      else {\r\n\r\n        lights[k] = light;\r\n        k++;\r\n\r\n      }\r\n\r\n    }\r\n\r\n    // render depth map\r\n\r\n    for (i = 0, il = lights.length; i < il; i++) {\r\n\r\n      light = lights[i];\r\n\r\n      if (!light.shadowMap) {\r\n\r\n        var shadowFilter = THREE.LinearFilter;\r\n\r\n        if (_renderer.shadowMapType === THREE.PCFSoftShadowMap) {\r\n\r\n          shadowFilter = THREE.NearestFilter;\r\n\r\n        }\r\n\r\n        var pars = {\r\n          minFilter: shadowFilter,\r\n          magFilter: shadowFilter,\r\n          format: THREE.RGBAFormat\r\n        };\r\n\r\n        light.shadowMap = new THREE.WebGLRenderTarget(light.shadowMapWidth, light.shadowMapHeight, pars);\r\n        light.shadowMapSize = new THREE.Vector2(light.shadowMapWidth, light.shadowMapHeight);\r\n\r\n        light.shadowMatrix = new THREE.Matrix4();\r\n\r\n      }\r\n\r\n      if (!light.shadowCamera) {\r\n\r\n        if (light instanceof THREE.SpotLight) {\r\n\r\n          light.shadowCamera = new THREE.PerspectiveCamera(light.shadowCameraFov, light.shadowMapWidth / light.shadowMapHeight, light.shadowCameraNear, light.shadowCameraFar);\r\n\r\n        }\r\n        else if (light instanceof THREE.DirectionalLight) {\r\n\r\n          light.shadowCamera = new THREE.OrthographicCamera(light.shadowCameraLeft, light.shadowCameraRight, light.shadowCameraTop, light.shadowCameraBottom, light.shadowCameraNear, light.shadowCameraFar);\r\n\r\n        }\r\n        else {\r\n\r\n          THREE.error(\"THREE.ShadowMapPlugin: Unsupported light type for shadow\", light);\r\n          continue;\r\n\r\n        }\r\n\r\n        scene.add(light.shadowCamera);\r\n\r\n        if (scene.autoUpdate === true) scene.updateMatrixWorld();\r\n\r\n      }\r\n\r\n      if (light.shadowCameraVisible && !light.cameraHelper) {\r\n\r\n        light.cameraHelper = new THREE.CameraHelper(light.shadowCamera);\r\n        scene.add(light.cameraHelper);\r\n\r\n      }\r\n\r\n      if (light.isVirtual && virtualLight.originalCamera == camera) {\r\n\r\n        updateShadowCamera(camera, light);\r\n\r\n      }\r\n\r\n      shadowMap = light.shadowMap;\r\n      shadowMatrix = light.shadowMatrix;\r\n      shadowCamera = light.shadowCamera;\r\n\r\n      //\r\n\r\n      shadowCamera.position.setFromMatrixPosition(light.matrixWorld);\r\n      _matrixPosition.setFromMatrixPosition(light.target.matrixWorld);\r\n      shadowCamera.lookAt(_matrixPosition);\r\n      shadowCamera.updateMatrixWorld();\r\n\r\n      shadowCamera.matrixWorldInverse.getInverse(shadowCamera.matrixWorld);\r\n\r\n      //\r\n\r\n      if (light.cameraHelper) light.cameraHelper.visible = light.shadowCameraVisible;\r\n      if (light.shadowCameraVisible) light.cameraHelper.update();\r\n\r\n      // compute shadow matrix\r\n\r\n      shadowMatrix.set(\r\n        0.5, 0.0, 0.0, 0.5,\r\n        0.0, 0.5, 0.0, 0.5,\r\n        0.0, 0.0, 0.5, 0.5,\r\n        0.0, 0.0, 0.0, 1.0\r\n      );\r\n\r\n      shadowMatrix.multiply(shadowCamera.projectionMatrix);\r\n      shadowMatrix.multiply(shadowCamera.matrixWorldInverse);\r\n\r\n      // update camera matrices and frustum\r\n\r\n      _projScreenMatrix.multiplyMatrices(shadowCamera.projectionMatrix, shadowCamera.matrixWorldInverse);\r\n      _frustum.setFromMatrix(_projScreenMatrix);\r\n\r\n      // render shadow map\r\n\r\n      _renderer.setRenderTarget(shadowMap);\r\n      _renderer.clear();\r\n\r\n      // set object matrices & frustum culling\r\n\r\n      _renderList.length = 0;\r\n\r\n      projectObject(scene, scene, shadowCamera);\r\n\r\n\r\n      // render regular objects\r\n\r\n      var objectMaterial, useMorphing, useSkinning;\r\n\r\n      for (j = 0, jl = _renderList.length; j < jl; j++) {\r\n\r\n        webglObject = _renderList[j];\r\n\r\n        object = webglObject.object;\r\n        buffer = webglObject.buffer;\r\n\r\n        // culling is overriden globally for all objects\r\n        // while rendering depth map\r\n\r\n        // need to deal with MeshFaceMaterial somehow\r\n        // in that case just use the first of material.materials for now\r\n        // (proper solution would require to break objects by materials\r\n        //  similarly to regular rendering and then set corresponding\r\n        //  depth materials per each chunk instead of just once per object)\r\n\r\n        objectMaterial = getObjectMaterial(object);\r\n\r\n        useMorphing = object.geometry.morphTargets !== undefined && object.geometry.morphTargets.length > 0 && objectMaterial.morphTargets;\r\n        useSkinning = object instanceof THREE.SkinnedMesh && objectMaterial.skinning;\r\n\r\n        if (object.customDepthMaterial) {\r\n\r\n          material = object.customDepthMaterial;\r\n\r\n        }\r\n        else if (useSkinning) {\r\n\r\n          material = useMorphing ? _depthMaterialMorphSkin : _depthMaterialSkin;\r\n\r\n        }\r\n        else if (useMorphing) {\r\n\r\n          material = _depthMaterialMorph;\r\n\r\n        }\r\n        else {\r\n\r\n          material = _depthMaterial;\r\n\r\n        }\r\n\r\n        _renderer.setMaterialFaces(objectMaterial);\r\n\r\n        if (buffer instanceof THREE.BufferGeometry) {\r\n\r\n          _renderer.renderBufferDirect(shadowCamera, _lights, fog, material, buffer, object);\r\n\r\n        }\r\n        else {\r\n\r\n          _renderer.renderBuffer(shadowCamera, _lights, fog, material, buffer, object);\r\n\r\n        }\r\n\r\n      }\r\n\r\n      // set matrices and render immediate objects\r\n\r\n      for (j = 0, jl = _webglObjectsImmediate.length; j < jl; j++) {\r\n\r\n        webglObject = _webglObjectsImmediate[j];\r\n        object = webglObject.object;\r\n\r\n        if (object.visible && object.castShadow) {\r\n\r\n          object._modelViewMatrix.multiplyMatrices(shadowCamera.matrixWorldInverse, object.matrixWorld);\r\n\r\n          _renderer.renderImmediateObject(shadowCamera, _lights, fog, _depthMaterial, object);\r\n\r\n        }\r\n\r\n      }\r\n\r\n    }\r\n\r\n    // restore GL state\r\n\r\n    var clearColor = _renderer.getClearColor(),\r\n      clearAlpha = _renderer.getClearAlpha();\r\n\r\n    _gl.clearColor(clearColor.r, clearColor.g, clearColor.b, clearAlpha);\r\n    _gl.enable(_gl.BLEND);\r\n\r\n    if (_renderer.shadowMapCullFace === THREE.CullFaceFront) {\r\n\r\n      _gl.cullFace(_gl.BACK);\r\n\r\n    }\r\n\r\n    _renderer.resetGLState();\r\n\r\n  };\r\n\r\n  function projectObject(scene, object, shadowCamera) {\r\n\r\n    if (object.visible) {\r\n\r\n      var webglObjects = _webglObjects[object.id];\r\n\r\n      if (webglObjects && object.castShadow && (object.frustumCulled === false || _frustum.intersectsObject(object) === true)) {\r\n\r\n        for (var i = 0, l = webglObjects.length; i < l; i++) {\r\n\r\n          var webglObject = webglObjects[i];\r\n\r\n          object._modelViewMatrix.multiplyMatrices(shadowCamera.matrixWorldInverse, object.matrixWorld);\r\n          _renderList.push(webglObject);\r\n\r\n        }\r\n\r\n      }\r\n\r\n      for (var i = 0, l = object.children.length; i < l; i++) {\r\n\r\n        projectObject(scene, object.children[i], shadowCamera);\r\n\r\n      }\r\n\r\n    }\r\n\r\n  }\r\n\r\n  function createVirtualLight(light, cascade) {\r\n\r\n    var virtualLight = new THREE.DirectionalLight();\r\n\r\n    virtualLight.isVirtual = true;\r\n\r\n    virtualLight.onlyShadow = true;\r\n    virtualLight.castShadow = true;\r\n\r\n    virtualLight.shadowCameraNear = light.shadowCameraNear;\r\n    virtualLight.shadowCameraFar = light.shadowCameraFar;\r\n\r\n    virtualLight.shadowCameraLeft = light.shadowCameraLeft;\r\n    virtualLight.shadowCameraRight = light.shadowCameraRight;\r\n    virtualLight.shadowCameraBottom = light.shadowCameraBottom;\r\n    virtualLight.shadowCameraTop = light.shadowCameraTop;\r\n\r\n    virtualLight.shadowCameraVisible = light.shadowCameraVisible;\r\n\r\n    virtualLight.shadowDarkness = light.shadowDarkness;\r\n\r\n    virtualLight.shadowBias = light.shadowCascadeBias[cascade];\r\n    virtualLight.shadowMapWidth = light.shadowCascadeWidth[cascade];\r\n    virtualLight.shadowMapHeight = light.shadowCascadeHeight[cascade];\r\n\r\n    virtualLight.pointsWorld = [];\r\n    virtualLight.pointsFrustum = [];\r\n\r\n    var pointsWorld = virtualLight.pointsWorld,\r\n      pointsFrustum = virtualLight.pointsFrustum;\r\n\r\n    for (var i = 0; i < 8; i++) {\r\n\r\n      pointsWorld[i] = new THREE.Vector3();\r\n      pointsFrustum[i] = new THREE.Vector3();\r\n\r\n    }\r\n\r\n    var nearZ = light.shadowCascadeNearZ[cascade];\r\n    var farZ = light.shadowCascadeFarZ[cascade];\r\n\r\n    pointsFrustum[0].set(-1, -1, nearZ);\r\n    pointsFrustum[1].set(1, -1, nearZ);\r\n    pointsFrustum[2].set(-1, 1, nearZ);\r\n    pointsFrustum[3].set(1, 1, nearZ);\r\n\r\n    pointsFrustum[4].set(-1, -1, farZ);\r\n    pointsFrustum[5].set(1, -1, farZ);\r\n    pointsFrustum[6].set(-1, 1, farZ);\r\n    pointsFrustum[7].set(1, 1, farZ);\r\n\r\n    return virtualLight;\r\n\r\n  }\r\n\r\n  // Synchronize virtual light with the original light\r\n\r\n  function updateVirtualLight(light, cascade) {\r\n\r\n    var virtualLight = light.shadowCascadeArray[cascade];\r\n\r\n    virtualLight.position.copy(light.position);\r\n    virtualLight.target.position.copy(light.target.position);\r\n    virtualLight.lookAt(virtualLight.target);\r\n\r\n    virtualLight.shadowCameraVisible = light.shadowCameraVisible;\r\n    virtualLight.shadowDarkness = light.shadowDarkness;\r\n\r\n    virtualLight.shadowBias = light.shadowCascadeBias[cascade];\r\n\r\n    var nearZ = light.shadowCascadeNearZ[cascade];\r\n    var farZ = light.shadowCascadeFarZ[cascade];\r\n\r\n    var pointsFrustum = virtualLight.pointsFrustum;\r\n\r\n    pointsFrustum[0].z = nearZ;\r\n    pointsFrustum[1].z = nearZ;\r\n    pointsFrustum[2].z = nearZ;\r\n    pointsFrustum[3].z = nearZ;\r\n\r\n    pointsFrustum[4].z = farZ;\r\n    pointsFrustum[5].z = farZ;\r\n    pointsFrustum[6].z = farZ;\r\n    pointsFrustum[7].z = farZ;\r\n\r\n  }\r\n\r\n  // Fit shadow camera's ortho frustum to camera frustum\r\n\r\n  function updateShadowCamera(camera, light) {\r\n\r\n    var shadowCamera = light.shadowCamera,\r\n      pointsFrustum = light.pointsFrustum,\r\n      pointsWorld = light.pointsWorld;\r\n\r\n    _min.set(Infinity, Infinity, Infinity);\r\n    _max.set(-Infinity, -Infinity, -Infinity);\r\n\r\n    for (var i = 0; i < 8; i++) {\r\n\r\n      var p = pointsWorld[i];\r\n\r\n      p.copy(pointsFrustum[i]);\r\n      p.unproject(camera);\r\n\r\n      p.applyMatrix4(shadowCamera.matrixWorldInverse);\r\n\r\n      if (p.x < _min.x) _min.x = p.x;\r\n      if (p.x > _max.x) _max.x = p.x;\r\n\r\n      if (p.y < _min.y) _min.y = p.y;\r\n      if (p.y > _max.y) _max.y = p.y;\r\n\r\n      if (p.z < _min.z) _min.z = p.z;\r\n      if (p.z > _max.z) _max.z = p.z;\r\n\r\n    }\r\n\r\n    shadowCamera.left = _min.x;\r\n    shadowCamera.right = _max.x;\r\n    shadowCamera.top = _max.y;\r\n    shadowCamera.bottom = _min.y;\r\n\r\n    // can't really fit near/far\r\n    //shadowCamera.near = _min.z;\r\n    //shadowCamera.far = _max.z;\r\n\r\n    shadowCamera.updateProjectionMatrix();\r\n\r\n  }\r\n\r\n  // For the moment just ignore objects that have multiple materials with different animation methods\r\n  // Only the first material will be taken into account for deciding which depth material to use for shadow maps\r\n\r\n  function getObjectMaterial(object) {\r\n\r\n    return object.material instanceof THREE.MeshFaceMaterial ? object.material.materials[0] : object.material;\r\n\r\n  };\r\n\r\n};\r\n\r\n// File:src/renderers/webgl/plugins/SpritePlugin.js\r\n\r\n/**\r\n * @author mikael emtinger / http://gomo.se/\r\n * @author alteredq / http://alteredqualia.com/\r\n */\r\n\r\nTHREE.SpritePlugin = function(renderer, sprites) {\r\n\r\n  var gl = renderer.context;\r\n\r\n  var vertexBuffer, elementBuffer;\r\n  var program, attributes, uniforms;\r\n\r\n  var texture;\r\n\r\n  // decompose matrixWorld\r\n\r\n  var spritePosition = new THREE.Vector3();\r\n  var spriteRotation = new THREE.Quaternion();\r\n  var spriteScale = new THREE.Vector3();\r\n\r\n  var init = function() {\r\n\r\n    var vertices = new Float32Array([-0.5, -0.5, 0, 0,\r\n      0.5, -0.5, 1, 0,\r\n      0.5, 0.5, 1, 1, -0.5, 0.5, 0, 1\r\n    ]);\r\n\r\n    var faces = new Uint16Array([\r\n      0, 1, 2,\r\n      0, 2, 3\r\n    ]);\r\n\r\n    vertexBuffer = gl.createBuffer();\r\n    elementBuffer = gl.createBuffer();\r\n\r\n    gl.bindBuffer(gl.ARRAY_BUFFER, vertexBuffer);\r\n    gl.bufferData(gl.ARRAY_BUFFER, vertices, gl.STATIC_DRAW);\r\n\r\n    gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, elementBuffer);\r\n    gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, faces, gl.STATIC_DRAW);\r\n\r\n    program = createProgram();\r\n\r\n    attributes = {\r\n      position: gl.getAttribLocation(program, 'position'),\r\n      uv: gl.getAttribLocation(program, 'uv')\r\n    };\r\n\r\n    uniforms = {\r\n      uvOffset: gl.getUniformLocation(program, 'uvOffset'),\r\n      uvScale: gl.getUniformLocation(program, 'uvScale'),\r\n\r\n      rotation: gl.getUniformLocation(program, 'rotation'),\r\n      scale: gl.getUniformLocation(program, 'scale'),\r\n\r\n      color: gl.getUniformLocation(program, 'color'),\r\n      map: gl.getUniformLocation(program, 'map'),\r\n      opacity: gl.getUniformLocation(program, 'opacity'),\r\n\r\n      modelViewMatrix: gl.getUniformLocation(program, 'modelViewMatrix'),\r\n      projectionMatrix: gl.getUniformLocation(program, 'projectionMatrix'),\r\n\r\n      fogType: gl.getUniformLocation(program, 'fogType'),\r\n      fogDensity: gl.getUniformLocation(program, 'fogDensity'),\r\n      fogNear: gl.getUniformLocation(program, 'fogNear'),\r\n      fogFar: gl.getUniformLocation(program, 'fogFar'),\r\n      fogColor: gl.getUniformLocation(program, 'fogColor'),\r\n\r\n      alphaTest: gl.getUniformLocation(program, 'alphaTest')\r\n    };\r\n\r\n    var canvas = document.createElement('canvas');\r\n    canvas.width = 8;\r\n    canvas.height = 8;\r\n\r\n    var context = canvas.getContext('2d');\r\n    context.fillStyle = 'white';\r\n    context.fillRect(0, 0, 8, 8);\r\n\r\n    texture = new THREE.Texture(canvas);\r\n    texture.needsUpdate = true;\r\n\r\n  };\r\n\r\n  this.render = function(scene, camera) {\r\n\r\n    if (sprites.length === 0) return;\r\n\r\n    // setup gl\r\n\r\n    if (program === undefined) {\r\n\r\n      init();\r\n\r\n    }\r\n\r\n    gl.useProgram(program);\r\n\r\n    gl.enableVertexAttribArray(attributes.position);\r\n    gl.enableVertexAttribArray(attributes.uv);\r\n\r\n    gl.disable(gl.CULL_FACE);\r\n    gl.enable(gl.BLEND);\r\n\r\n    gl.bindBuffer(gl.ARRAY_BUFFER, vertexBuffer);\r\n    gl.vertexAttribPointer(attributes.position, 2, gl.FLOAT, false, 2 * 8, 0);\r\n    gl.vertexAttribPointer(attributes.uv, 2, gl.FLOAT, false, 2 * 8, 8);\r\n\r\n    gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, elementBuffer);\r\n\r\n    gl.uniformMatrix4fv(uniforms.projectionMatrix, false, camera.projectionMatrix.elements);\r\n\r\n    gl.activeTexture(gl.TEXTURE0);\r\n    gl.uniform1i(uniforms.map, 0);\r\n\r\n    var oldFogType = 0;\r\n    var sceneFogType = 0;\r\n    var fog = scene.fog;\r\n\r\n    if (fog) {\r\n\r\n      gl.uniform3f(uniforms.fogColor, fog.color.r, fog.color.g, fog.color.b);\r\n\r\n      if (fog instanceof THREE.Fog) {\r\n\r\n        gl.uniform1f(uniforms.fogNear, fog.near);\r\n        gl.uniform1f(uniforms.fogFar, fog.far);\r\n\r\n        gl.uniform1i(uniforms.fogType, 1);\r\n        oldFogType = 1;\r\n        sceneFogType = 1;\r\n\r\n      }\r\n      else if (fog instanceof THREE.FogExp2) {\r\n\r\n        gl.uniform1f(uniforms.fogDensity, fog.density);\r\n\r\n        gl.uniform1i(uniforms.fogType, 2);\r\n        oldFogType = 2;\r\n        sceneFogType = 2;\r\n\r\n      }\r\n\r\n    }\r\n    else {\r\n\r\n      gl.uniform1i(uniforms.fogType, 0);\r\n      oldFogType = 0;\r\n      sceneFogType = 0;\r\n\r\n    }\r\n\r\n\r\n    // update positions and sort\r\n\r\n    for (var i = 0, l = sprites.length; i < l; i++) {\r\n\r\n      var sprite = sprites[i];\r\n\r\n      sprite._modelViewMatrix.multiplyMatrices(camera.matrixWorldInverse, sprite.matrixWorld);\r\n      sprite.z = -sprite._modelViewMatrix.elements[14];\r\n\r\n    }\r\n\r\n    sprites.sort(painterSortStable);\r\n\r\n    // render all sprites\r\n\r\n    var scale = [];\r\n\r\n    for (var i = 0, l = sprites.length; i < l; i++) {\r\n\r\n      var sprite = sprites[i];\r\n      var material = sprite.material;\r\n\r\n      gl.uniform1f(uniforms.alphaTest, material.alphaTest);\r\n      gl.uniformMatrix4fv(uniforms.modelViewMatrix, false, sprite._modelViewMatrix.elements);\r\n\r\n      sprite.matrixWorld.decompose(spritePosition, spriteRotation, spriteScale);\r\n\r\n      scale[0] = spriteScale.x;\r\n      scale[1] = spriteScale.y;\r\n\r\n      var fogType = 0;\r\n\r\n      if (scene.fog && material.fog) {\r\n\r\n        fogType = sceneFogType;\r\n\r\n      }\r\n\r\n      if (oldFogType !== fogType) {\r\n\r\n        gl.uniform1i(uniforms.fogType, fogType);\r\n        oldFogType = fogType;\r\n\r\n      }\r\n\r\n      if (material.map !== null) {\r\n\r\n        gl.uniform2f(uniforms.uvOffset, material.map.offset.x, material.map.offset.y);\r\n        gl.uniform2f(uniforms.uvScale, material.map.repeat.x, material.map.repeat.y);\r\n\r\n      }\r\n      else {\r\n\r\n        gl.uniform2f(uniforms.uvOffset, 0, 0);\r\n        gl.uniform2f(uniforms.uvScale, 1, 1);\r\n\r\n      }\r\n\r\n      gl.uniform1f(uniforms.opacity, material.opacity);\r\n      gl.uniform3f(uniforms.color, material.color.r, material.color.g, material.color.b);\r\n\r\n      gl.uniform1f(uniforms.rotation, material.rotation);\r\n      gl.uniform2fv(uniforms.scale, scale);\r\n\r\n      renderer.state.setBlending(material.blending, material.blendEquation, material.blendSrc, material.blendDst);\r\n      renderer.state.setDepthTest(material.depthTest);\r\n      renderer.state.setDepthWrite(material.depthWrite);\r\n\r\n      if (material.map && material.map.image && material.map.image.width) {\r\n\r\n        renderer.setTexture(material.map, 0);\r\n\r\n      }\r\n      else {\r\n\r\n        renderer.setTexture(texture, 0);\r\n\r\n      }\r\n\r\n      gl.drawElements(gl.TRIANGLES, 6, gl.UNSIGNED_SHORT, 0);\r\n\r\n    }\r\n\r\n    // restore gl\r\n\r\n    gl.enable(gl.CULL_FACE);\r\n\r\n    renderer.resetGLState();\r\n\r\n  };\r\n\r\n  function createProgram() {\r\n\r\n    var program = gl.createProgram();\r\n\r\n    var vertexShader = gl.createShader(gl.VERTEX_SHADER);\r\n    var fragmentShader = gl.createShader(gl.FRAGMENT_SHADER);\r\n\r\n    gl.shaderSource(vertexShader, [\r\n\r\n      'precision ' + renderer.getPrecision() + ' float;',\r\n\r\n      'uniform mat4 modelViewMatrix;',\r\n      'uniform mat4 projectionMatrix;',\r\n      'uniform float rotation;',\r\n      'uniform vec2 scale;',\r\n      'uniform vec2 uvOffset;',\r\n      'uniform vec2 uvScale;',\r\n\r\n      'attribute vec2 position;',\r\n      'attribute vec2 uv;',\r\n\r\n      'varying vec2 vUV;',\r\n\r\n      'void main() {',\r\n\r\n      'vUV = uvOffset + uv * uvScale;',\r\n\r\n      'vec2 alignedPosition = position * scale;',\r\n\r\n      'vec2 rotatedPosition;',\r\n      'rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;',\r\n      'rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;',\r\n\r\n      'vec4 finalPosition;',\r\n\r\n      'finalPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );',\r\n      'finalPosition.xy += rotatedPosition;',\r\n      'finalPosition = projectionMatrix * finalPosition;',\r\n\r\n      'gl_Position = finalPosition;',\r\n\r\n      '}'\r\n\r\n    ].join('\\n'));\r\n\r\n    gl.shaderSource(fragmentShader, [\r\n\r\n      'precision ' + renderer.getPrecision() + ' float;',\r\n\r\n      'uniform vec3 color;',\r\n      'uniform sampler2D map;',\r\n      'uniform float opacity;',\r\n\r\n      'uniform int fogType;',\r\n      'uniform vec3 fogColor;',\r\n      'uniform float fogDensity;',\r\n      'uniform float fogNear;',\r\n      'uniform float fogFar;',\r\n      'uniform float alphaTest;',\r\n\r\n      'varying vec2 vUV;',\r\n\r\n      'void main() {',\r\n\r\n      'vec4 texture = texture2D( map, vUV );',\r\n\r\n      'if ( texture.a < alphaTest ) discard;',\r\n\r\n      'gl_FragColor = vec4( color * texture.xyz, texture.a * opacity );',\r\n\r\n      'if ( fogType > 0 ) {',\r\n\r\n      'float depth = gl_FragCoord.z / gl_FragCoord.w;',\r\n      'float fogFactor = 0.0;',\r\n\r\n      'if ( fogType == 1 ) {',\r\n\r\n      'fogFactor = smoothstep( fogNear, fogFar, depth );',\r\n\r\n      '} else {',\r\n\r\n      'const float LOG2 = 1.442695;',\r\n      'float fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );',\r\n      'fogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );',\r\n\r\n      '}',\r\n\r\n      'gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );',\r\n\r\n      '}',\r\n\r\n      '}'\r\n\r\n    ].join('\\n'));\r\n\r\n    gl.compileShader(vertexShader);\r\n    gl.compileShader(fragmentShader);\r\n\r\n    gl.attachShader(program, vertexShader);\r\n    gl.attachShader(program, fragmentShader);\r\n\r\n    gl.linkProgram(program);\r\n\r\n    return program;\r\n\r\n  };\r\n\r\n  function painterSortStable(a, b) {\r\n\r\n    if (a.z !== b.z) {\r\n\r\n      return b.z - a.z;\r\n\r\n    }\r\n    else {\r\n\r\n      return b.id - a.id;\r\n\r\n    }\r\n\r\n  };\r\n\r\n};\r\n\r\n// File:src/extras/GeometryUtils.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.GeometryUtils = {\r\n\r\n  merge: function(geometry1, geometry2, materialIndexOffset) {\r\n\r\n    THREE.warn('THREE.GeometryUtils: .merge() has been moved to Geometry. Use geometry.merge( geometry2, matrix, materialIndexOffset ) instead.');\r\n\r\n    var matrix;\r\n\r\n    if (geometry2 instanceof THREE.Mesh) {\r\n\r\n      geometry2.matrixAutoUpdate && geometry2.updateMatrix();\r\n\r\n      matrix = geometry2.matrix;\r\n      geometry2 = geometry2.geometry;\r\n\r\n    }\r\n\r\n    geometry1.merge(geometry2, matrix, materialIndexOffset);\r\n\r\n  },\r\n\r\n  center: function(geometry) {\r\n\r\n    THREE.warn('THREE.GeometryUtils: .center() has been moved to Geometry. Use geometry.center() instead.');\r\n    return geometry.center();\r\n\r\n  }\r\n\r\n};\r\n\r\n// File:src/extras/ImageUtils.js\r\n\r\n/**\r\n * @author alteredq / http://alteredqualia.com/\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author Daosheng Mu / https://github.com/DaoshengMu/\r\n */\r\n\r\nTHREE.ImageUtils = {\r\n\r\n  crossOrigin: undefined,\r\n\r\n  loadTexture: function(url, mapping, onLoad, onError) {\r\n\r\n    var loader = new THREE.ImageLoader();\r\n    loader.crossOrigin = this.crossOrigin;\r\n\r\n    var texture = new THREE.Texture(undefined, mapping);\r\n\r\n    loader.load(url, function(image) {\r\n\r\n      texture.image = image;\r\n      texture.needsUpdate = true;\r\n\r\n      if (onLoad) onLoad(texture);\r\n\r\n    }, undefined, function(event) {\r\n\r\n      if (onError) onError(event);\r\n\r\n    });\r\n\r\n    texture.sourceFile = url;\r\n\r\n    return texture;\r\n\r\n  },\r\n\r\n  loadTextureCube: function(array, mapping, onLoad, onError) {\r\n\r\n    var images = [];\r\n\r\n    var loader = new THREE.ImageLoader();\r\n    loader.crossOrigin = this.crossOrigin;\r\n\r\n    var texture = new THREE.CubeTexture(images, mapping);\r\n\r\n    // no flipping needed for cube textures\r\n\r\n    texture.flipY = false;\r\n\r\n    var loaded = 0;\r\n\r\n    var loadTexture = function(i) {\r\n\r\n      loader.load(array[i], function(image) {\r\n\r\n        texture.images[i] = image;\r\n\r\n        loaded += 1;\r\n\r\n        if (loaded === 6) {\r\n\r\n          texture.needsUpdate = true;\r\n\r\n          if (onLoad) onLoad(texture);\r\n\r\n        }\r\n\r\n      }, undefined, onError);\r\n\r\n    }\r\n\r\n    for (var i = 0, il = array.length; i < il; ++i) {\r\n\r\n      loadTexture(i);\r\n\r\n    }\r\n\r\n    return texture;\r\n\r\n  },\r\n\r\n  loadCompressedTexture: function() {\r\n\r\n    THREE.error('THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.')\r\n\r\n  },\r\n\r\n  loadCompressedTextureCube: function() {\r\n\r\n    THREE.error('THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.')\r\n\r\n  },\r\n\r\n  getNormalMap: function(image, depth) {\r\n\r\n    // Adapted from http://www.paulbrunt.co.uk/lab/heightnormal/\r\n\r\n    var cross = function(a, b) {\r\n\r\n      return [a[1] * b[2] - a[2] * b[1], a[2] * b[0] - a[0] * b[2], a[0] * b[1] - a[1] * b[0]];\r\n\r\n    }\r\n\r\n    var subtract = function(a, b) {\r\n\r\n      return [a[0] - b[0], a[1] - b[1], a[2] - b[2]];\r\n\r\n    }\r\n\r\n    var normalize = function(a) {\r\n\r\n      var l = Math.sqrt(a[0] * a[0] + a[1] * a[1] + a[2] * a[2]);\r\n      return [a[0] / l, a[1] / l, a[2] / l];\r\n\r\n    }\r\n\r\n    depth = depth | 1;\r\n\r\n    var width = image.width;\r\n    var height = image.height;\r\n\r\n    var canvas = document.createElement('canvas');\r\n    canvas.width = width;\r\n    canvas.height = height;\r\n\r\n    var context = canvas.getContext('2d');\r\n    context.drawImage(image, 0, 0);\r\n\r\n    var data = context.getImageData(0, 0, width, height).data;\r\n    var imageData = context.createImageData(width, height);\r\n    var output = imageData.data;\r\n\r\n    for (var x = 0; x < width; x++) {\r\n\r\n      for (var y = 0; y < height; y++) {\r\n\r\n        var ly = y - 1 < 0 ? 0 : y - 1;\r\n        var uy = y + 1 > height - 1 ? height - 1 : y + 1;\r\n        var lx = x - 1 < 0 ? 0 : x - 1;\r\n        var ux = x + 1 > width - 1 ? width - 1 : x + 1;\r\n\r\n        var points = [];\r\n        var origin = [0, 0, data[(y * width + x) * 4] / 255 * depth];\r\n        points.push([-1, 0, data[(y * width + lx) * 4] / 255 * depth]);\r\n        points.push([-1, -1, data[(ly * width + lx) * 4] / 255 * depth]);\r\n        points.push([0, -1, data[(ly * width + x) * 4] / 255 * depth]);\r\n        points.push([1, -1, data[(ly * width + ux) * 4] / 255 * depth]);\r\n        points.push([1, 0, data[(y * width + ux) * 4] / 255 * depth]);\r\n        points.push([1, 1, data[(uy * width + ux) * 4] / 255 * depth]);\r\n        points.push([0, 1, data[(uy * width + x) * 4] / 255 * depth]);\r\n        points.push([-1, 1, data[(uy * width + lx) * 4] / 255 * depth]);\r\n\r\n        var normals = [];\r\n        var num_points = points.length;\r\n\r\n        for (var i = 0; i < num_points; i++) {\r\n\r\n          var v1 = points[i];\r\n          var v2 = points[(i + 1) % num_points];\r\n          v1 = subtract(v1, origin);\r\n          v2 = subtract(v2, origin);\r\n          normals.push(normalize(cross(v1, v2)));\r\n\r\n        }\r\n\r\n        var normal = [0, 0, 0];\r\n\r\n        for (var i = 0; i < normals.length; i++) {\r\n\r\n          normal[0] += normals[i][0];\r\n          normal[1] += normals[i][1];\r\n          normal[2] += normals[i][2];\r\n\r\n        }\r\n\r\n        normal[0] /= normals.length;\r\n        normal[1] /= normals.length;\r\n        normal[2] /= normals.length;\r\n\r\n        var idx = (y * width + x) * 4;\r\n\r\n        output[idx] = ((normal[0] + 1.0) / 2.0 * 255) | 0;\r\n        output[idx + 1] = ((normal[1] + 1.0) / 2.0 * 255) | 0;\r\n        output[idx + 2] = (normal[2] * 255) | 0;\r\n        output[idx + 3] = 255;\r\n\r\n      }\r\n\r\n    }\r\n\r\n    context.putImageData(imageData, 0, 0);\r\n\r\n    return canvas;\r\n\r\n  },\r\n\r\n  generateDataTexture: function(width, height, color) {\r\n\r\n    var size = width * height;\r\n    var data = new Uint8Array(3 * size);\r\n\r\n    var r = Math.floor(color.r * 255);\r\n    var g = Math.floor(color.g * 255);\r\n    var b = Math.floor(color.b * 255);\r\n\r\n    for (var i = 0; i < size; i++) {\r\n\r\n      data[i * 3] = r;\r\n      data[i * 3 + 1] = g;\r\n      data[i * 3 + 2] = b;\r\n\r\n    }\r\n\r\n    var texture = new THREE.DataTexture(data, width, height, THREE.RGBFormat);\r\n    texture.needsUpdate = true;\r\n\r\n    return texture;\r\n\r\n  }\r\n\r\n};\r\n\r\n// File:src/extras/SceneUtils.js\r\n\r\n/**\r\n * @author alteredq / http://alteredqualia.com/\r\n */\r\n\r\nTHREE.SceneUtils = {\r\n\r\n  createMultiMaterialObject: function(geometry, materials) {\r\n\r\n    var group = new THREE.Object3D();\r\n\r\n    for (var i = 0, l = materials.length; i < l; i++) {\r\n\r\n      group.add(new THREE.Mesh(geometry, materials[i]));\r\n\r\n    }\r\n\r\n    return group;\r\n\r\n  },\r\n\r\n  detach: function(child, parent, scene) {\r\n\r\n    child.applyMatrix(parent.matrixWorld);\r\n    parent.remove(child);\r\n    scene.add(child);\r\n\r\n  },\r\n\r\n  attach: function(child, scene, parent) {\r\n\r\n    var matrixWorldInverse = new THREE.Matrix4();\r\n    matrixWorldInverse.getInverse(parent.matrixWorld);\r\n    child.applyMatrix(matrixWorldInverse);\r\n\r\n    scene.remove(child);\r\n    parent.add(child);\r\n\r\n  }\r\n\r\n};\r\n\r\n// File:src/extras/FontUtils.js\r\n\r\n/**\r\n * @author zz85 / http://www.lab4games.net/zz85/blog\r\n * @author alteredq / http://alteredqualia.com/\r\n *\r\n * For Text operations in three.js (See TextGeometry)\r\n *\r\n * It uses techniques used in:\r\n *\r\n * \ttypeface.js and canvastext\r\n * \t\tFor converting fonts and rendering with javascript\r\n *\t\thttp://typeface.neocracy.org\r\n *\r\n *\tTriangulation ported from AS3\r\n *\t\tSimple Polygon Triangulation\r\n *\t\thttp://actionsnippet.com/?p=1462\r\n *\r\n * \tA Method to triangulate shapes with holes\r\n *\t\thttp://www.sakri.net/blog/2009/06/12/an-approach-to-triangulating-polygons-with-holes/\r\n *\r\n */\r\n\r\nTHREE.FontUtils = {\r\n\r\n  faces: {},\r\n\r\n  // Just for now. face[weight][style]\r\n\r\n  face: 'helvetiker',\r\n  weight: 'normal',\r\n  style: 'normal',\r\n  size: 150,\r\n  divisions: 10,\r\n\r\n  getFace: function() {\r\n\r\n    try {\r\n\r\n      return this.faces[this.face][this.weight][this.style];\r\n\r\n    }\r\n    catch (e) {\r\n\r\n      throw \"The font \" + this.face + \" with \" + this.weight + \" weight and \" + this.style + \" style is missing.\"\r\n\r\n    };\r\n\r\n  },\r\n\r\n  loadFace: function(data) {\r\n\r\n    var family = data.familyName.toLowerCase();\r\n\r\n    var ThreeFont = this;\r\n\r\n    ThreeFont.faces[family] = ThreeFont.faces[family] || {};\r\n\r\n    ThreeFont.faces[family][data.cssFontWeight] = ThreeFont.faces[family][data.cssFontWeight] || {};\r\n    ThreeFont.faces[family][data.cssFontWeight][data.cssFontStyle] = data;\r\n\r\n    ThreeFont.faces[family][data.cssFontWeight][data.cssFontStyle] = data;\r\n\r\n    return data;\r\n\r\n  },\r\n\r\n  drawText: function(text) {\r\n\r\n    // RenderText\r\n\r\n    var i,\r\n      face = this.getFace(),\r\n      scale = this.size / face.resolution,\r\n      offset = 0,\r\n      chars = String(text).split(''),\r\n      length = chars.length;\r\n\r\n    var fontPaths = [];\r\n\r\n    for (i = 0; i < length; i++) {\r\n\r\n      var path = new THREE.Path();\r\n\r\n      var ret = this.extractGlyphPoints(chars[i], face, scale, offset, path);\r\n      offset += ret.offset;\r\n\r\n      fontPaths.push(ret.path);\r\n\r\n    }\r\n\r\n    // get the width\r\n\r\n    var width = offset / 2;\r\n    //\r\n    // for ( p = 0; p < allPts.length; p++ ) {\r\n    //\r\n    // \tallPts[ p ].x -= width;\r\n    //\r\n    // }\r\n\r\n    //var extract = this.extractPoints( allPts, characterPts );\r\n    //extract.contour = allPts;\r\n\r\n    //extract.paths = fontPaths;\r\n    //extract.offset = width;\r\n\r\n    return {\r\n      paths: fontPaths,\r\n      offset: width\r\n    };\r\n\r\n  },\r\n\r\n\r\n\r\n\r\n  extractGlyphPoints: function(c, face, scale, offset, path) {\r\n\r\n    var pts = [];\r\n\r\n    var i, i2, divisions,\r\n      outline, action, length,\r\n      scaleX, scaleY,\r\n      x, y, cpx, cpy, cpx0, cpy0, cpx1, cpy1, cpx2, cpy2,\r\n      laste,\r\n      glyph = face.glyphs[c] || face.glyphs['?'];\r\n\r\n    if (!glyph) return;\r\n\r\n    if (glyph.o) {\r\n\r\n      outline = glyph._cachedOutline || (glyph._cachedOutline = glyph.o.split(' '));\r\n      length = outline.length;\r\n\r\n      scaleX = scale;\r\n      scaleY = scale;\r\n\r\n      for (i = 0; i < length;) {\r\n\r\n        action = outline[i++];\r\n\r\n        //console.log( action );\r\n\r\n        switch (action) {\r\n\r\n          case 'm':\r\n\r\n            // Move To\r\n\r\n            x = outline[i++] * scaleX + offset;\r\n            y = outline[i++] * scaleY;\r\n\r\n            path.moveTo(x, y);\r\n            break;\r\n\r\n          case 'l':\r\n\r\n            // Line To\r\n\r\n            x = outline[i++] * scaleX + offset;\r\n            y = outline[i++] * scaleY;\r\n            path.lineTo(x, y);\r\n            break;\r\n\r\n          case 'q':\r\n\r\n            // QuadraticCurveTo\r\n\r\n            cpx = outline[i++] * scaleX + offset;\r\n            cpy = outline[i++] * scaleY;\r\n            cpx1 = outline[i++] * scaleX + offset;\r\n            cpy1 = outline[i++] * scaleY;\r\n\r\n            path.quadraticCurveTo(cpx1, cpy1, cpx, cpy);\r\n\r\n            laste = pts[pts.length - 1];\r\n\r\n            if (laste) {\r\n\r\n              cpx0 = laste.x;\r\n              cpy0 = laste.y;\r\n\r\n              for (i2 = 1, divisions = this.divisions; i2 <= divisions; i2++) {\r\n\r\n                var t = i2 / divisions;\r\n                THREE.Shape.Utils.b2(t, cpx0, cpx1, cpx);\r\n                THREE.Shape.Utils.b2(t, cpy0, cpy1, cpy);\r\n              }\r\n\r\n            }\r\n\r\n            break;\r\n\r\n          case 'b':\r\n\r\n            // Cubic Bezier Curve\r\n\r\n            cpx = outline[i++] * scaleX + offset;\r\n            cpy = outline[i++] * scaleY;\r\n            cpx1 = outline[i++] * scaleX + offset;\r\n            cpy1 = outline[i++] * scaleY;\r\n            cpx2 = outline[i++] * scaleX + offset;\r\n            cpy2 = outline[i++] * scaleY;\r\n\r\n            path.bezierCurveTo(cpx1, cpy1, cpx2, cpy2, cpx, cpy);\r\n\r\n            laste = pts[pts.length - 1];\r\n\r\n            if (laste) {\r\n\r\n              cpx0 = laste.x;\r\n              cpy0 = laste.y;\r\n\r\n              for (i2 = 1, divisions = this.divisions; i2 <= divisions; i2++) {\r\n\r\n                var t = i2 / divisions;\r\n                THREE.Shape.Utils.b3(t, cpx0, cpx1, cpx2, cpx);\r\n                THREE.Shape.Utils.b3(t, cpy0, cpy1, cpy2, cpy);\r\n\r\n              }\r\n\r\n            }\r\n\r\n            break;\r\n\r\n        }\r\n\r\n      }\r\n    }\r\n\r\n\r\n\r\n    return {\r\n      offset: glyph.ha * scale,\r\n      path: path\r\n    };\r\n  }\r\n\r\n};\r\n\r\n\r\nTHREE.FontUtils.generateShapes = function(text, parameters) {\r\n\r\n  // Parameters \r\n\r\n  parameters = parameters || {};\r\n\r\n  var size = parameters.size !== undefined ? parameters.size : 100;\r\n  var curveSegments = parameters.curveSegments !== undefined ? parameters.curveSegments : 4;\r\n\r\n  var font = parameters.font !== undefined ? parameters.font : 'helvetiker';\r\n  var weight = parameters.weight !== undefined ? parameters.weight : 'normal';\r\n  var style = parameters.style !== undefined ? parameters.style : 'normal';\r\n\r\n  THREE.FontUtils.size = size;\r\n  THREE.FontUtils.divisions = curveSegments;\r\n\r\n  THREE.FontUtils.face = font;\r\n  THREE.FontUtils.weight = weight;\r\n  THREE.FontUtils.style = style;\r\n\r\n  // Get a Font data json object\r\n\r\n  var data = THREE.FontUtils.drawText(text);\r\n\r\n  var paths = data.paths;\r\n  var shapes = [];\r\n\r\n  for (var p = 0, pl = paths.length; p < pl; p++) {\r\n\r\n    Array.prototype.push.apply(shapes, paths[p].toShapes());\r\n\r\n  }\r\n\r\n  return shapes;\r\n\r\n};\r\n\r\n\r\n/**\r\n * This code is a quick port of code written in C++ which was submitted to\r\n * flipcode.com by John W. Ratcliff  // July 22, 2000\r\n * See original code and more information here:\r\n * http://www.flipcode.com/archives/Efficient_Polygon_Triangulation.shtml\r\n *\r\n * ported to actionscript by Zevan Rosser\r\n * www.actionsnippet.com\r\n *\r\n * ported to javascript by Joshua Koo\r\n * http://www.lab4games.net/zz85/blog\r\n *\r\n */\r\n\r\n\r\n(function(namespace) {\r\n\r\n  var EPSILON = 0.0000000001;\r\n\r\n  // takes in an contour array and returns\r\n\r\n  var process = function(contour, indices) {\r\n\r\n    var n = contour.length;\r\n\r\n    if (n < 3) return null;\r\n\r\n    var result = [],\r\n      verts = [],\r\n      vertIndices = [];\r\n\r\n    /* we want a counter-clockwise polygon in verts */\r\n\r\n    var u, v, w;\r\n\r\n    if (area(contour) > 0.0) {\r\n\r\n      for (v = 0; v < n; v++) verts[v] = v;\r\n\r\n    }\r\n    else {\r\n\r\n      for (v = 0; v < n; v++) verts[v] = (n - 1) - v;\r\n\r\n    }\r\n\r\n    var nv = n;\r\n\r\n    /*  remove nv - 2 vertices, creating 1 triangle every time */\r\n\r\n    var count = 2 * nv; /* error detection */\r\n\r\n    for (v = nv - 1; nv > 2;) {\r\n\r\n      /* if we loop, it is probably a non-simple polygon */\r\n\r\n      if ((count--) <= 0) {\r\n\r\n        //** Triangulate: ERROR - probable bad polygon!\r\n\r\n        //throw ( \"Warning, unable to triangulate polygon!\" );\r\n        //return null;\r\n        // Sometimes warning is fine, especially polygons are triangulated in reverse.\r\n        THREE.warn('THREE.FontUtils: Warning, unable to triangulate polygon! in Triangulate.process()');\r\n\r\n        if (indices) return vertIndices;\r\n        return result;\r\n\r\n      }\r\n\r\n      /* three consecutive vertices in current polygon, <u,v,w> */\r\n\r\n      u = v;\r\n      if (nv <= u) u = 0; /* previous */\r\n      v = u + 1;\r\n      if (nv <= v) v = 0; /* new v    */\r\n      w = v + 1;\r\n      if (nv <= w) w = 0; /* next     */\r\n\r\n      if (snip(contour, u, v, w, nv, verts)) {\r\n\r\n        var a, b, c, s, t;\r\n\r\n        /* true names of the vertices */\r\n\r\n        a = verts[u];\r\n        b = verts[v];\r\n        c = verts[w];\r\n\r\n        /* output Triangle */\r\n\r\n        result.push([contour[a],\r\n          contour[b],\r\n          contour[c]\r\n        ]);\r\n\r\n\r\n        vertIndices.push([verts[u], verts[v], verts[w]]);\r\n\r\n        /* remove v from the remaining polygon */\r\n\r\n        for (s = v, t = v + 1; t < nv; s++, t++) {\r\n\r\n          verts[s] = verts[t];\r\n\r\n        }\r\n\r\n        nv--;\r\n\r\n        /* reset error detection counter */\r\n\r\n        count = 2 * nv;\r\n\r\n      }\r\n\r\n    }\r\n\r\n    if (indices) return vertIndices;\r\n    return result;\r\n\r\n  };\r\n\r\n  // calculate area of the contour polygon\r\n\r\n  var area = function(contour) {\r\n\r\n    var n = contour.length;\r\n    var a = 0.0;\r\n\r\n    for (var p = n - 1, q = 0; q < n; p = q++) {\r\n\r\n      a += contour[p].x * contour[q].y - contour[q].x * contour[p].y;\r\n\r\n    }\r\n\r\n    return a * 0.5;\r\n\r\n  };\r\n\r\n  var snip = function(contour, u, v, w, n, verts) {\r\n\r\n    var p;\r\n    var ax, ay, bx, by;\r\n    var cx, cy, px, py;\r\n\r\n    ax = contour[verts[u]].x;\r\n    ay = contour[verts[u]].y;\r\n\r\n    bx = contour[verts[v]].x;\r\n    by = contour[verts[v]].y;\r\n\r\n    cx = contour[verts[w]].x;\r\n    cy = contour[verts[w]].y;\r\n\r\n    if (EPSILON > (((bx - ax) * (cy - ay)) - ((by - ay) * (cx - ax)))) return false;\r\n\r\n    var aX, aY, bX, bY, cX, cY;\r\n    var apx, apy, bpx, bpy, cpx, cpy;\r\n    var cCROSSap, bCROSScp, aCROSSbp;\r\n\r\n    aX = cx - bx;\r\n    aY = cy - by;\r\n    bX = ax - cx;\r\n    bY = ay - cy;\r\n    cX = bx - ax;\r\n    cY = by - ay;\r\n\r\n    for (p = 0; p < n; p++) {\r\n\r\n      px = contour[verts[p]].x\r\n      py = contour[verts[p]].y\r\n\r\n      if (((px === ax) && (py === ay)) ||\r\n        ((px === bx) && (py === by)) ||\r\n        ((px === cx) && (py === cy))) continue;\r\n\r\n      apx = px - ax;\r\n      apy = py - ay;\r\n      bpx = px - bx;\r\n      bpy = py - by;\r\n      cpx = px - cx;\r\n      cpy = py - cy;\r\n\r\n      // see if p is inside triangle abc\r\n\r\n      aCROSSbp = aX * bpy - aY * bpx;\r\n      cCROSSap = cX * apy - cY * apx;\r\n      bCROSScp = bX * cpy - bY * cpx;\r\n\r\n      if ((aCROSSbp >= -EPSILON) && (bCROSScp >= -EPSILON) && (cCROSSap >= -EPSILON)) return false;\r\n\r\n    }\r\n\r\n    return true;\r\n\r\n  };\r\n\r\n\r\n  namespace.Triangulate = process;\r\n  namespace.Triangulate.area = area;\r\n\r\n  return namespace;\r\n\r\n})(THREE.FontUtils);\r\n\r\n// To use the typeface.js face files, hook up the API\r\nself._typeface_js = {\r\n  faces: THREE.FontUtils.faces,\r\n  loadFace: THREE.FontUtils.loadFace\r\n};\r\nTHREE.typeface_js = self._typeface_js;\r\n\r\n// File:src/extras/audio/Audio.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.Audio = function(listener) {\r\n\r\n  THREE.Object3D.call(this);\r\n\r\n  this.type = 'Audio';\r\n\r\n  this.context = listener.context;\r\n  this.source = this.context.createBufferSource();\r\n  this.source.onended = this.onEnded.bind(this);\r\n\r\n  this.gain = this.context.createGain();\r\n  this.gain.connect(this.context.destination);\r\n\r\n  this.panner = this.context.createPanner();\r\n  this.panner.connect(this.gain);\r\n\r\n  this.autoplay = false;\r\n\r\n  this.startTime = 0;\r\n  this.isPlaying = false;\r\n\r\n};\r\n\r\nTHREE.Audio.prototype = Object.create(THREE.Object3D.prototype);\r\nTHREE.Audio.prototype.constructor = THREE.Audio;\r\n\r\nTHREE.Audio.prototype.load = function(file) {\r\n\r\n  var scope = this;\r\n\r\n  var request = new XMLHttpRequest();\r\n  request.open('GET', file, true);\r\n  request.responseType = 'arraybuffer';\r\n  request.onload = function(e) {\r\n\r\n    scope.context.decodeAudioData(this.response, function(buffer) {\r\n\r\n      scope.source.buffer = buffer;\r\n\r\n      if (scope.autoplay) scope.play();\r\n\r\n    });\r\n\r\n  };\r\n  request.send();\r\n\r\n  return this;\r\n\r\n};\r\n\r\nTHREE.Audio.prototype.play = function() {\r\n\r\n  if (this.isPlaying === true) {\r\n\r\n    THREE.warn('THREE.Audio: Audio is already playing.');\r\n    return;\r\n\r\n  }\r\n\r\n  var source = this.context.createBufferSource();\r\n\r\n  source.buffer = this.source.buffer;\r\n  source.loop = this.source.loop;\r\n  source.onended = this.source.onended;\r\n  source.connect(this.panner);\r\n  source.start(0, this.startTime);\r\n\r\n  this.isPlaying = true;\r\n\r\n  this.source = source;\r\n\r\n};\r\n\r\nTHREE.Audio.prototype.pause = function() {\r\n\r\n  this.source.stop();\r\n  this.startTime = this.context.currentTime;\r\n\r\n};\r\n\r\nTHREE.Audio.prototype.stop = function() {\r\n\r\n  this.source.stop();\r\n  this.startTime = 0;\r\n\r\n};\r\n\r\nTHREE.Audio.prototype.onEnded = function() {\r\n\r\n  this.isPlaying = false;\r\n\r\n};\r\n\r\nTHREE.Audio.prototype.setLoop = function(value) {\r\n\r\n  this.source.loop = value;\r\n\r\n};\r\n\r\nTHREE.Audio.prototype.setRefDistance = function(value) {\r\n\r\n  this.panner.refDistance = value;\r\n\r\n};\r\n\r\nTHREE.Audio.prototype.setRolloffFactor = function(value) {\r\n\r\n  this.panner.rolloffFactor = value;\r\n\r\n};\r\n\r\nTHREE.Audio.prototype.setVolume = function(value) {\r\n\r\n  this.gain.gain.value = value;\r\n\r\n};\r\n\r\nTHREE.Audio.prototype.updateMatrixWorld = (function() {\r\n\r\n  var position = new THREE.Vector3();\r\n\r\n  return function(force) {\r\n\r\n    THREE.Object3D.prototype.updateMatrixWorld.call(this, force);\r\n\r\n    position.setFromMatrixPosition(this.matrixWorld);\r\n\r\n    this.panner.setPosition(position.x, position.y, position.z);\r\n\r\n  };\r\n\r\n})();\r\n\r\n// File:src/extras/audio/AudioListener.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.AudioListener = function() {\r\n\r\n  THREE.Object3D.call(this);\r\n\r\n  this.type = 'AudioListener';\r\n\r\n  this.context = new(window.AudioContext || window.webkitAudioContext)();\r\n\r\n};\r\n\r\nTHREE.AudioListener.prototype = Object.create(THREE.Object3D.prototype);\r\nTHREE.AudioListener.prototype.constructor = THREE.AudioListener;\r\n\r\nTHREE.AudioListener.prototype.updateMatrixWorld = (function() {\r\n\r\n  var position = new THREE.Vector3();\r\n  var quaternion = new THREE.Quaternion();\r\n  var scale = new THREE.Vector3();\r\n\r\n  var orientation = new THREE.Vector3();\r\n  var velocity = new THREE.Vector3();\r\n\r\n  var positionPrev = new THREE.Vector3();\r\n\r\n  return function(force) {\r\n\r\n    THREE.Object3D.prototype.updateMatrixWorld.call(this, force);\r\n\r\n    var listener = this.context.listener;\r\n    var up = this.up;\r\n\r\n    this.matrixWorld.decompose(position, quaternion, scale);\r\n\r\n    orientation.set(0, 0, -1).applyQuaternion(quaternion);\r\n    velocity.subVectors(position, positionPrev);\r\n\r\n    listener.setPosition(position.x, position.y, position.z);\r\n    listener.setOrientation(orientation.x, orientation.y, orientation.z, up.x, up.y, up.z);\r\n    listener.setVelocity(velocity.x, velocity.y, velocity.z);\r\n\r\n    positionPrev.copy(position);\r\n\r\n  };\r\n\r\n})();\r\n\r\n// File:src/extras/core/Curve.js\r\n\r\n/**\r\n * @author zz85 / http://www.lab4games.net/zz85/blog\r\n * Extensible curve object\r\n *\r\n * Some common of Curve methods\r\n * .getPoint(t), getTangent(t)\r\n * .getPointAt(u), getTagentAt(u)\r\n * .getPoints(), .getSpacedPoints()\r\n * .getLength()\r\n * .updateArcLengths()\r\n *\r\n * This following classes subclasses THREE.Curve:\r\n *\r\n * -- 2d classes --\r\n * THREE.LineCurve\r\n * THREE.QuadraticBezierCurve\r\n * THREE.CubicBezierCurve\r\n * THREE.SplineCurve\r\n * THREE.ArcCurve\r\n * THREE.EllipseCurve\r\n *\r\n * -- 3d classes --\r\n * THREE.LineCurve3\r\n * THREE.QuadraticBezierCurve3\r\n * THREE.CubicBezierCurve3\r\n * THREE.SplineCurve3\r\n * THREE.ClosedSplineCurve3\r\n *\r\n * A series of curves can be represented as a THREE.CurvePath\r\n *\r\n **/\r\n\r\n/**************************************************************\r\n *\tAbstract Curve base class\r\n **************************************************************/\r\n\r\nTHREE.Curve = function() {\r\n\r\n};\r\n\r\n// Virtual base class method to overwrite and implement in subclasses\r\n//\t- t [0 .. 1]\r\n\r\nTHREE.Curve.prototype.getPoint = function(t) {\r\n\r\n  THREE.warn(\"THREE.Curve: Warning, getPoint() not implemented!\");\r\n  return null;\r\n\r\n};\r\n\r\n// Get point at relative position in curve according to arc length\r\n// - u [0 .. 1]\r\n\r\nTHREE.Curve.prototype.getPointAt = function(u) {\r\n\r\n  var t = this.getUtoTmapping(u);\r\n  return this.getPoint(t);\r\n\r\n};\r\n\r\n// Get sequence of points using getPoint( t )\r\n\r\nTHREE.Curve.prototype.getPoints = function(divisions) {\r\n\r\n  if (!divisions) divisions = 5;\r\n\r\n  var d, pts = [];\r\n\r\n  for (d = 0; d <= divisions; d++) {\r\n\r\n    pts.push(this.getPoint(d / divisions));\r\n\r\n  }\r\n\r\n  return pts;\r\n\r\n};\r\n\r\n// Get sequence of points using getPointAt( u )\r\n\r\nTHREE.Curve.prototype.getSpacedPoints = function(divisions) {\r\n\r\n  if (!divisions) divisions = 5;\r\n\r\n  var d, pts = [];\r\n\r\n  for (d = 0; d <= divisions; d++) {\r\n\r\n    pts.push(this.getPointAt(d / divisions));\r\n\r\n  }\r\n\r\n  return pts;\r\n\r\n};\r\n\r\n// Get total curve arc length\r\n\r\nTHREE.Curve.prototype.getLength = function() {\r\n\r\n  var lengths = this.getLengths();\r\n  return lengths[lengths.length - 1];\r\n\r\n};\r\n\r\n// Get list of cumulative segment lengths\r\n\r\nTHREE.Curve.prototype.getLengths = function(divisions) {\r\n\r\n  if (!divisions) divisions = (this.__arcLengthDivisions) ? (this.__arcLengthDivisions) : 200;\r\n\r\n  if (this.cacheArcLengths && (this.cacheArcLengths.length == divisions + 1) && !this.needsUpdate) {\r\n\r\n    //console.log( \"cached\", this.cacheArcLengths );\r\n    return this.cacheArcLengths;\r\n\r\n  }\r\n\r\n  this.needsUpdate = false;\r\n\r\n  var cache = [];\r\n  var current, last = this.getPoint(0);\r\n  var p, sum = 0;\r\n\r\n  cache.push(0);\r\n\r\n  for (p = 1; p <= divisions; p++) {\r\n\r\n    current = this.getPoint(p / divisions);\r\n    sum += current.distanceTo(last);\r\n    cache.push(sum);\r\n    last = current;\r\n\r\n  }\r\n\r\n  this.cacheArcLengths = cache;\r\n\r\n  return cache; // { sums: cache, sum:sum }; Sum is in the last element.\r\n\r\n};\r\n\r\n\r\nTHREE.Curve.prototype.updateArcLengths = function() {\r\n  this.needsUpdate = true;\r\n  this.getLengths();\r\n};\r\n\r\n// Given u ( 0 .. 1 ), get a t to find p. This gives you points which are equi distance\r\n\r\nTHREE.Curve.prototype.getUtoTmapping = function(u, distance) {\r\n\r\n  var arcLengths = this.getLengths();\r\n\r\n  var i = 0,\r\n    il = arcLengths.length;\r\n\r\n  var targetArcLength; // The targeted u distance value to get\r\n\r\n  if (distance) {\r\n\r\n    targetArcLength = distance;\r\n\r\n  }\r\n  else {\r\n\r\n    targetArcLength = u * arcLengths[il - 1];\r\n\r\n  }\r\n\r\n  //var time = Date.now();\r\n\r\n  // binary search for the index with largest value smaller than target u distance\r\n\r\n  var low = 0,\r\n    high = il - 1,\r\n    comparison;\r\n\r\n  while (low <= high) {\r\n\r\n    i = Math.floor(low + (high - low) / 2); // less likely to overflow, though probably not issue here, JS doesn't really have integers, all numbers are floats\r\n\r\n    comparison = arcLengths[i] - targetArcLength;\r\n\r\n    if (comparison < 0) {\r\n\r\n      low = i + 1;\r\n\r\n    }\r\n    else if (comparison > 0) {\r\n\r\n      high = i - 1;\r\n\r\n    }\r\n    else {\r\n\r\n      high = i;\r\n      break;\r\n\r\n      // DONE\r\n\r\n    }\r\n\r\n  }\r\n\r\n  i = high;\r\n\r\n  //console.log('b' , i, low, high, Date.now()- time);\r\n\r\n  if (arcLengths[i] == targetArcLength) {\r\n\r\n    var t = i / (il - 1);\r\n    return t;\r\n\r\n  }\r\n\r\n  // we could get finer grain at lengths, or use simple interpolatation between two points\r\n\r\n  var lengthBefore = arcLengths[i];\r\n  var lengthAfter = arcLengths[i + 1];\r\n\r\n  var segmentLength = lengthAfter - lengthBefore;\r\n\r\n  // determine where we are between the 'before' and 'after' points\r\n\r\n  var segmentFraction = (targetArcLength - lengthBefore) / segmentLength;\r\n\r\n  // add that fractional amount to t\r\n\r\n  var t = (i + segmentFraction) / (il - 1);\r\n\r\n  return t;\r\n\r\n};\r\n\r\n// Returns a unit vector tangent at t\r\n// In case any sub curve does not implement its tangent derivation,\r\n// 2 points a small delta apart will be used to find its gradient\r\n// which seems to give a reasonable approximation\r\n\r\nTHREE.Curve.prototype.getTangent = function(t) {\r\n\r\n  var delta = 0.0001;\r\n  var t1 = t - delta;\r\n  var t2 = t + delta;\r\n\r\n  // Capping in case of danger\r\n\r\n  if (t1 < 0) t1 = 0;\r\n  if (t2 > 1) t2 = 1;\r\n\r\n  var pt1 = this.getPoint(t1);\r\n  var pt2 = this.getPoint(t2);\r\n\r\n  var vec = pt2.clone().sub(pt1);\r\n  return vec.normalize();\r\n\r\n};\r\n\r\n\r\nTHREE.Curve.prototype.getTangentAt = function(u) {\r\n\r\n  var t = this.getUtoTmapping(u);\r\n  return this.getTangent(t);\r\n\r\n};\r\n\r\n\r\n\r\n\r\n\r\n/**************************************************************\r\n *\tUtils\r\n **************************************************************/\r\n\r\nTHREE.Curve.Utils = {\r\n\r\n  tangentQuadraticBezier: function(t, p0, p1, p2) {\r\n\r\n    return 2 * (1 - t) * (p1 - p0) + 2 * t * (p2 - p1);\r\n\r\n  },\r\n\r\n  // Puay Bing, thanks for helping with this derivative!\r\n\r\n  tangentCubicBezier: function(t, p0, p1, p2, p3) {\r\n\r\n    return -3 * p0 * (1 - t) * (1 - t) +\r\n      3 * p1 * (1 - t) * (1 - t) - 6 * t * p1 * (1 - t) +\r\n      6 * t * p2 * (1 - t) - 3 * t * t * p2 +\r\n      3 * t * t * p3;\r\n\r\n  },\r\n\r\n  tangentSpline: function(t, p0, p1, p2, p3) {\r\n\r\n    // To check if my formulas are correct\r\n\r\n    var h00 = 6 * t * t - 6 * t; // derived from 2t^3  3t^2 + 1\r\n    var h10 = 3 * t * t - 4 * t + 1; // t^3  2t^2 + t\r\n    var h01 = -6 * t * t + 6 * t; //  2t3 + 3t2\r\n    var h11 = 3 * t * t - 2 * t; // t3  t2\r\n\r\n    return h00 + h10 + h01 + h11;\r\n\r\n  },\r\n\r\n  // Catmull-Rom\r\n\r\n  interpolate: function(p0, p1, p2, p3, t) {\r\n\r\n    var v0 = (p2 - p0) * 0.5;\r\n    var v1 = (p3 - p1) * 0.5;\r\n    var t2 = t * t;\r\n    var t3 = t * t2;\r\n    return (2 * p1 - 2 * p2 + v0 + v1) * t3 + (-3 * p1 + 3 * p2 - 2 * v0 - v1) * t2 + v0 * t + p1;\r\n\r\n  }\r\n\r\n};\r\n\r\n\r\n// TODO: Transformation for Curves?\r\n\r\n/**************************************************************\r\n *\t3D Curves\r\n **************************************************************/\r\n\r\n// A Factory method for creating new curve subclasses\r\n\r\nTHREE.Curve.create = function(constructor, getPointFunc) {\r\n\r\n  constructor.prototype = Object.create(THREE.Curve.prototype);\r\n  constructor.prototype.constructor = constructor;\r\n  constructor.prototype.getPoint = getPointFunc;\r\n\r\n  return constructor;\r\n\r\n};\r\n\r\n// File:src/extras/core/CurvePath.js\r\n\r\n/**\r\n * @author zz85 / http://www.lab4games.net/zz85/blog\r\n *\r\n **/\r\n\r\n/**************************************************************\r\n *\tCurved Path - a curve path is simply a array of connected\r\n *  curves, but retains the api of a curve\r\n **************************************************************/\r\n\r\nTHREE.CurvePath = function() {\r\n\r\n  this.curves = [];\r\n  this.bends = [];\r\n\r\n  this.autoClose = false; // Automatically closes the path\r\n};\r\n\r\nTHREE.CurvePath.prototype = Object.create(THREE.Curve.prototype);\r\nTHREE.CurvePath.prototype.constructor = THREE.CurvePath;\r\n\r\nTHREE.CurvePath.prototype.add = function(curve) {\r\n\r\n  this.curves.push(curve);\r\n\r\n};\r\n\r\nTHREE.CurvePath.prototype.checkConnection = function() {\r\n  // TODO\r\n  // If the ending of curve is not connected to the starting\r\n  // or the next curve, then, this is not a real path\r\n};\r\n\r\nTHREE.CurvePath.prototype.closePath = function() {\r\n  // TODO Test\r\n  // and verify for vector3 (needs to implement equals)\r\n  // Add a line curve if start and end of lines are not connected\r\n  var startPoint = this.curves[0].getPoint(0);\r\n  var endPoint = this.curves[this.curves.length - 1].getPoint(1);\r\n\r\n  if (!startPoint.equals(endPoint)) {\r\n    this.curves.push(new THREE.LineCurve(endPoint, startPoint));\r\n  }\r\n\r\n};\r\n\r\n// To get accurate point with reference to\r\n// entire path distance at time t,\r\n// following has to be done:\r\n\r\n// 1. Length of each sub path have to be known\r\n// 2. Locate and identify type of curve\r\n// 3. Get t for the curve\r\n// 4. Return curve.getPointAt(t')\r\n\r\nTHREE.CurvePath.prototype.getPoint = function(t) {\r\n\r\n  var d = t * this.getLength();\r\n  var curveLengths = this.getCurveLengths();\r\n  var i = 0,\r\n    diff, curve;\r\n\r\n  // To think about boundaries points.\r\n\r\n  while (i < curveLengths.length) {\r\n\r\n    if (curveLengths[i] >= d) {\r\n\r\n      diff = curveLengths[i] - d;\r\n      curve = this.curves[i];\r\n\r\n      var u = 1 - diff / curve.getLength();\r\n\r\n      return curve.getPointAt(u);\r\n\r\n    }\r\n\r\n    i++;\r\n\r\n  }\r\n\r\n  return null;\r\n\r\n  // loop where sum != 0, sum > d , sum+1 <d\r\n\r\n};\r\n\r\n/*\r\nTHREE.CurvePath.prototype.getTangent = function( t ) {\r\n};*/\r\n\r\n\r\n// We cannot use the default THREE.Curve getPoint() with getLength() because in\r\n// THREE.Curve, getLength() depends on getPoint() but in THREE.CurvePath\r\n// getPoint() depends on getLength\r\n\r\nTHREE.CurvePath.prototype.getLength = function() {\r\n\r\n  var lens = this.getCurveLengths();\r\n  return lens[lens.length - 1];\r\n\r\n};\r\n\r\n// Compute lengths and cache them\r\n// We cannot overwrite getLengths() because UtoT mapping uses it.\r\n\r\nTHREE.CurvePath.prototype.getCurveLengths = function() {\r\n\r\n  // We use cache values if curves and cache array are same length\r\n\r\n  if (this.cacheLengths && this.cacheLengths.length == this.curves.length) {\r\n\r\n    return this.cacheLengths;\r\n\r\n  };\r\n\r\n  // Get length of subsurve\r\n  // Push sums into cached array\r\n\r\n  var lengths = [],\r\n    sums = 0;\r\n  var i, il = this.curves.length;\r\n\r\n  for (i = 0; i < il; i++) {\r\n\r\n    sums += this.curves[i].getLength();\r\n    lengths.push(sums);\r\n\r\n  }\r\n\r\n  this.cacheLengths = lengths;\r\n\r\n  return lengths;\r\n\r\n};\r\n\r\n\r\n\r\n// Returns min and max coordinates\r\n\r\nTHREE.CurvePath.prototype.getBoundingBox = function() {\r\n\r\n  var points = this.getPoints();\r\n\r\n  var maxX, maxY, maxZ;\r\n  var minX, minY, minZ;\r\n\r\n  maxX = maxY = Number.NEGATIVE_INFINITY;\r\n  minX = minY = Number.POSITIVE_INFINITY;\r\n\r\n  var p, i, il, sum;\r\n\r\n  var v3 = points[0] instanceof THREE.Vector3;\r\n\r\n  sum = v3 ? new THREE.Vector3() : new THREE.Vector2();\r\n\r\n  for (i = 0, il = points.length; i < il; i++) {\r\n\r\n    p = points[i];\r\n\r\n    if (p.x > maxX) maxX = p.x;\r\n    else if (p.x < minX) minX = p.x;\r\n\r\n    if (p.y > maxY) maxY = p.y;\r\n    else if (p.y < minY) minY = p.y;\r\n\r\n    if (v3) {\r\n\r\n      if (p.z > maxZ) maxZ = p.z;\r\n      else if (p.z < minZ) minZ = p.z;\r\n\r\n    }\r\n\r\n    sum.add(p);\r\n\r\n  }\r\n\r\n  var ret = {\r\n\r\n    minX: minX,\r\n    minY: minY,\r\n    maxX: maxX,\r\n    maxY: maxY\r\n\r\n  };\r\n\r\n  if (v3) {\r\n\r\n    ret.maxZ = maxZ;\r\n    ret.minZ = minZ;\r\n\r\n  }\r\n\r\n  return ret;\r\n\r\n};\r\n\r\n/**************************************************************\r\n *\tCreate Geometries Helpers\r\n **************************************************************/\r\n\r\n/// Generate geometry from path points (for Line or Points objects)\r\n\r\nTHREE.CurvePath.prototype.createPointsGeometry = function(divisions) {\r\n\r\n  var pts = this.getPoints(divisions, true);\r\n  return this.createGeometry(pts);\r\n\r\n};\r\n\r\n// Generate geometry from equidistance sampling along the path\r\n\r\nTHREE.CurvePath.prototype.createSpacedPointsGeometry = function(divisions) {\r\n\r\n  var pts = this.getSpacedPoints(divisions, true);\r\n  return this.createGeometry(pts);\r\n\r\n};\r\n\r\nTHREE.CurvePath.prototype.createGeometry = function(points) {\r\n\r\n  var geometry = new THREE.Geometry();\r\n\r\n  for (var i = 0; i < points.length; i++) {\r\n\r\n    geometry.vertices.push(new THREE.Vector3(points[i].x, points[i].y, points[i].z || 0));\r\n\r\n  }\r\n\r\n  return geometry;\r\n\r\n};\r\n\r\n\r\n/**************************************************************\r\n *\tBend / Wrap Helper Methods\r\n **************************************************************/\r\n\r\n// Wrap path / Bend modifiers?\r\n\r\nTHREE.CurvePath.prototype.addWrapPath = function(bendpath) {\r\n\r\n  this.bends.push(bendpath);\r\n\r\n};\r\n\r\nTHREE.CurvePath.prototype.getTransformedPoints = function(segments, bends) {\r\n\r\n  var oldPts = this.getPoints(segments); // getPoints getSpacedPoints\r\n  var i, il;\r\n\r\n  if (!bends) {\r\n\r\n    bends = this.bends;\r\n\r\n  }\r\n\r\n  for (i = 0, il = bends.length; i < il; i++) {\r\n\r\n    oldPts = this.getWrapPoints(oldPts, bends[i]);\r\n\r\n  }\r\n\r\n  return oldPts;\r\n\r\n};\r\n\r\nTHREE.CurvePath.prototype.getTransformedSpacedPoints = function(segments, bends) {\r\n\r\n  var oldPts = this.getSpacedPoints(segments);\r\n\r\n  var i, il;\r\n\r\n  if (!bends) {\r\n\r\n    bends = this.bends;\r\n\r\n  }\r\n\r\n  for (i = 0, il = bends.length; i < il; i++) {\r\n\r\n    oldPts = this.getWrapPoints(oldPts, bends[i]);\r\n\r\n  }\r\n\r\n  return oldPts;\r\n\r\n};\r\n\r\n// This returns getPoints() bend/wrapped around the contour of a path.\r\n// Read http://www.planetclegg.com/projects/WarpingTextToSplines.html\r\n\r\nTHREE.CurvePath.prototype.getWrapPoints = function(oldPts, path) {\r\n\r\n  var bounds = this.getBoundingBox();\r\n\r\n  var i, il, p, oldX, oldY, xNorm;\r\n\r\n  for (i = 0, il = oldPts.length; i < il; i++) {\r\n\r\n    p = oldPts[i];\r\n\r\n    oldX = p.x;\r\n    oldY = p.y;\r\n\r\n    xNorm = oldX / bounds.maxX;\r\n\r\n    // If using actual distance, for length > path, requires line extrusions\r\n    //xNorm = path.getUtoTmapping(xNorm, oldX); // 3 styles. 1) wrap stretched. 2) wrap stretch by arc length 3) warp by actual distance\r\n\r\n    xNorm = path.getUtoTmapping(xNorm, oldX);\r\n\r\n    // check for out of bounds?\r\n\r\n    var pathPt = path.getPoint(xNorm);\r\n    var normal = path.getTangent(xNorm);\r\n    normal.set(-normal.y, normal.x).multiplyScalar(oldY);\r\n\r\n    p.x = pathPt.x + normal.x;\r\n    p.y = pathPt.y + normal.y;\r\n\r\n  }\r\n\r\n  return oldPts;\r\n\r\n};\r\n\r\n\r\n// File:src/extras/core/Gyroscope.js\r\n\r\n/**\r\n * @author alteredq / http://alteredqualia.com/\r\n */\r\n\r\nTHREE.Gyroscope = function() {\r\n\r\n  THREE.Object3D.call(this);\r\n\r\n};\r\n\r\nTHREE.Gyroscope.prototype = Object.create(THREE.Object3D.prototype);\r\nTHREE.Gyroscope.prototype.constructor = THREE.Gyroscope;\r\n\r\nTHREE.Gyroscope.prototype.updateMatrixWorld = (function() {\r\n\r\n  var translationObject = new THREE.Vector3();\r\n  var quaternionObject = new THREE.Quaternion();\r\n  var scaleObject = new THREE.Vector3();\r\n\r\n  var translationWorld = new THREE.Vector3();\r\n  var quaternionWorld = new THREE.Quaternion();\r\n  var scaleWorld = new THREE.Vector3();\r\n\r\n  return function(force) {\r\n\r\n    this.matrixAutoUpdate && this.updateMatrix();\r\n\r\n    // update matrixWorld\r\n\r\n    if (this.matrixWorldNeedsUpdate || force) {\r\n\r\n      if (this.parent) {\r\n\r\n        this.matrixWorld.multiplyMatrices(this.parent.matrixWorld, this.matrix);\r\n\r\n        this.matrixWorld.decompose(translationWorld, quaternionWorld, scaleWorld);\r\n        this.matrix.decompose(translationObject, quaternionObject, scaleObject);\r\n\r\n        this.matrixWorld.compose(translationWorld, quaternionObject, scaleWorld);\r\n\r\n\r\n      }\r\n      else {\r\n\r\n        this.matrixWorld.copy(this.matrix);\r\n\r\n      }\r\n\r\n\r\n      this.matrixWorldNeedsUpdate = false;\r\n\r\n      force = true;\r\n\r\n    }\r\n\r\n    // update children\r\n\r\n    for (var i = 0, l = this.children.length; i < l; i++) {\r\n\r\n      this.children[i].updateMatrixWorld(force);\r\n\r\n    }\r\n\r\n  };\r\n\r\n}());\r\n\r\n// File:src/extras/core/Path.js\r\n\r\n/**\r\n * @author zz85 / http://www.lab4games.net/zz85/blog\r\n * Creates free form 2d path using series of points, lines or curves.\r\n *\r\n **/\r\n\r\nTHREE.Path = function(points) {\r\n\r\n  THREE.CurvePath.call(this);\r\n\r\n  this.actions = [];\r\n\r\n  if (points) {\r\n\r\n    this.fromPoints(points);\r\n\r\n  }\r\n\r\n};\r\n\r\nTHREE.Path.prototype = Object.create(THREE.CurvePath.prototype);\r\nTHREE.Path.prototype.constructor = THREE.Path;\r\n\r\nTHREE.PathActions = {\r\n\r\n  MOVE_TO: 'moveTo',\r\n  LINE_TO: 'lineTo',\r\n  QUADRATIC_CURVE_TO: 'quadraticCurveTo', // Bezier quadratic curve\r\n  BEZIER_CURVE_TO: 'bezierCurveTo', // Bezier cubic curve\r\n  CSPLINE_THRU: 'splineThru', // Catmull-rom spline\r\n  ARC: 'arc', // Circle\r\n  ELLIPSE: 'ellipse'\r\n};\r\n\r\n// TODO Clean up PATH API\r\n\r\n// Create path using straight lines to connect all points\r\n// - vectors: array of Vector2\r\n\r\nTHREE.Path.prototype.fromPoints = function(vectors) {\r\n\r\n  this.moveTo(vectors[0].x, vectors[0].y);\r\n\r\n  for (var v = 1, vlen = vectors.length; v < vlen; v++) {\r\n\r\n    this.lineTo(vectors[v].x, vectors[v].y);\r\n\r\n  };\r\n\r\n};\r\n\r\n// startPath() endPath()?\r\n\r\nTHREE.Path.prototype.moveTo = function(x, y) {\r\n\r\n  var args = Array.prototype.slice.call(arguments);\r\n  this.actions.push({\r\n    action: THREE.PathActions.MOVE_TO,\r\n    args: args\r\n  });\r\n\r\n};\r\n\r\nTHREE.Path.prototype.lineTo = function(x, y) {\r\n\r\n  var args = Array.prototype.slice.call(arguments);\r\n\r\n  var lastargs = this.actions[this.actions.length - 1].args;\r\n\r\n  var x0 = lastargs[lastargs.length - 2];\r\n  var y0 = lastargs[lastargs.length - 1];\r\n\r\n  var curve = new THREE.LineCurve(new THREE.Vector2(x0, y0), new THREE.Vector2(x, y));\r\n  this.curves.push(curve);\r\n\r\n  this.actions.push({\r\n    action: THREE.PathActions.LINE_TO,\r\n    args: args\r\n  });\r\n\r\n};\r\n\r\nTHREE.Path.prototype.quadraticCurveTo = function(aCPx, aCPy, aX, aY) {\r\n\r\n  var args = Array.prototype.slice.call(arguments);\r\n\r\n  var lastargs = this.actions[this.actions.length - 1].args;\r\n\r\n  var x0 = lastargs[lastargs.length - 2];\r\n  var y0 = lastargs[lastargs.length - 1];\r\n\r\n  var curve = new THREE.QuadraticBezierCurve(new THREE.Vector2(x0, y0),\r\n    new THREE.Vector2(aCPx, aCPy),\r\n    new THREE.Vector2(aX, aY));\r\n  this.curves.push(curve);\r\n\r\n  this.actions.push({\r\n    action: THREE.PathActions.QUADRATIC_CURVE_TO,\r\n    args: args\r\n  });\r\n\r\n};\r\n\r\nTHREE.Path.prototype.bezierCurveTo = function(aCP1x, aCP1y,\r\n  aCP2x, aCP2y,\r\n  aX, aY) {\r\n\r\n  var args = Array.prototype.slice.call(arguments);\r\n\r\n  var lastargs = this.actions[this.actions.length - 1].args;\r\n\r\n  var x0 = lastargs[lastargs.length - 2];\r\n  var y0 = lastargs[lastargs.length - 1];\r\n\r\n  var curve = new THREE.CubicBezierCurve(new THREE.Vector2(x0, y0),\r\n    new THREE.Vector2(aCP1x, aCP1y),\r\n    new THREE.Vector2(aCP2x, aCP2y),\r\n    new THREE.Vector2(aX, aY));\r\n  this.curves.push(curve);\r\n\r\n  this.actions.push({\r\n    action: THREE.PathActions.BEZIER_CURVE_TO,\r\n    args: args\r\n  });\r\n\r\n};\r\n\r\nTHREE.Path.prototype.splineThru = function(pts /*Array of Vector*/ ) {\r\n\r\n  var args = Array.prototype.slice.call(arguments);\r\n  var lastargs = this.actions[this.actions.length - 1].args;\r\n\r\n  var x0 = lastargs[lastargs.length - 2];\r\n  var y0 = lastargs[lastargs.length - 1];\r\n  //---\r\n  var npts = [new THREE.Vector2(x0, y0)];\r\n  Array.prototype.push.apply(npts, pts);\r\n\r\n  var curve = new THREE.SplineCurve(npts);\r\n  this.curves.push(curve);\r\n\r\n  this.actions.push({\r\n    action: THREE.PathActions.CSPLINE_THRU,\r\n    args: args\r\n  });\r\n\r\n};\r\n\r\n// FUTURE: Change the API or follow canvas API?\r\n\r\nTHREE.Path.prototype.arc = function(aX, aY, aRadius,\r\n  aStartAngle, aEndAngle, aClockwise) {\r\n\r\n  var lastargs = this.actions[this.actions.length - 1].args;\r\n  var x0 = lastargs[lastargs.length - 2];\r\n  var y0 = lastargs[lastargs.length - 1];\r\n\r\n  this.absarc(aX + x0, aY + y0, aRadius,\r\n    aStartAngle, aEndAngle, aClockwise);\r\n\r\n};\r\n\r\nTHREE.Path.prototype.absarc = function(aX, aY, aRadius,\r\n  aStartAngle, aEndAngle, aClockwise) {\r\n  this.absellipse(aX, aY, aRadius, aRadius, aStartAngle, aEndAngle, aClockwise);\r\n};\r\n\r\nTHREE.Path.prototype.ellipse = function(aX, aY, xRadius, yRadius,\r\n  aStartAngle, aEndAngle, aClockwise) {\r\n\r\n  var lastargs = this.actions[this.actions.length - 1].args;\r\n  var x0 = lastargs[lastargs.length - 2];\r\n  var y0 = lastargs[lastargs.length - 1];\r\n\r\n  this.absellipse(aX + x0, aY + y0, xRadius, yRadius,\r\n    aStartAngle, aEndAngle, aClockwise);\r\n\r\n};\r\n\r\n\r\nTHREE.Path.prototype.absellipse = function(aX, aY, xRadius, yRadius,\r\n  aStartAngle, aEndAngle, aClockwise) {\r\n\r\n  var args = Array.prototype.slice.call(arguments);\r\n  var curve = new THREE.EllipseCurve(aX, aY, xRadius, yRadius,\r\n    aStartAngle, aEndAngle, aClockwise);\r\n  this.curves.push(curve);\r\n\r\n  var lastPoint = curve.getPoint(1);\r\n  args.push(lastPoint.x);\r\n  args.push(lastPoint.y);\r\n\r\n  this.actions.push({\r\n    action: THREE.PathActions.ELLIPSE,\r\n    args: args\r\n  });\r\n\r\n};\r\n\r\nTHREE.Path.prototype.getSpacedPoints = function(divisions, closedPath) {\r\n\r\n  if (!divisions) divisions = 40;\r\n\r\n  var points = [];\r\n\r\n  for (var i = 0; i < divisions; i++) {\r\n\r\n    points.push(this.getPoint(i / divisions));\r\n\r\n    //if( !this.getPoint( i / divisions ) ) throw \"DIE\";\r\n\r\n  }\r\n\r\n  // if ( closedPath ) {\r\n  //\r\n  // \tpoints.push( points[ 0 ] );\r\n  //\r\n  // }\r\n\r\n  return points;\r\n\r\n};\r\n\r\n/* Return an array of vectors based on contour of the path */\r\n\r\nTHREE.Path.prototype.getPoints = function(divisions, closedPath) {\r\n\r\n  if (this.useSpacedPoints) {\r\n    console.log('tata');\r\n    return this.getSpacedPoints(divisions, closedPath);\r\n  }\r\n\r\n  divisions = divisions || 12;\r\n\r\n  var points = [];\r\n\r\n  var i, il, item, action, args;\r\n  var cpx, cpy, cpx2, cpy2, cpx1, cpy1, cpx0, cpy0,\r\n    laste, j,\r\n    t, tx, ty;\r\n\r\n  for (i = 0, il = this.actions.length; i < il; i++) {\r\n\r\n    item = this.actions[i];\r\n\r\n    action = item.action;\r\n    args = item.args;\r\n\r\n    switch (action) {\r\n\r\n      case THREE.PathActions.MOVE_TO:\r\n\r\n        points.push(new THREE.Vector2(args[0], args[1]));\r\n\r\n        break;\r\n\r\n      case THREE.PathActions.LINE_TO:\r\n\r\n        points.push(new THREE.Vector2(args[0], args[1]));\r\n\r\n        break;\r\n\r\n      case THREE.PathActions.QUADRATIC_CURVE_TO:\r\n\r\n        cpx = args[2];\r\n        cpy = args[3];\r\n\r\n        cpx1 = args[0];\r\n        cpy1 = args[1];\r\n\r\n        if (points.length > 0) {\r\n\r\n          laste = points[points.length - 1];\r\n\r\n          cpx0 = laste.x;\r\n          cpy0 = laste.y;\r\n\r\n        }\r\n        else {\r\n\r\n          laste = this.actions[i - 1].args;\r\n\r\n          cpx0 = laste[laste.length - 2];\r\n          cpy0 = laste[laste.length - 1];\r\n\r\n        }\r\n\r\n        for (j = 1; j <= divisions; j++) {\r\n\r\n          t = j / divisions;\r\n\r\n          tx = THREE.Shape.Utils.b2(t, cpx0, cpx1, cpx);\r\n          ty = THREE.Shape.Utils.b2(t, cpy0, cpy1, cpy);\r\n\r\n          points.push(new THREE.Vector2(tx, ty));\r\n\r\n        }\r\n\r\n        break;\r\n\r\n      case THREE.PathActions.BEZIER_CURVE_TO:\r\n\r\n        cpx = args[4];\r\n        cpy = args[5];\r\n\r\n        cpx1 = args[0];\r\n        cpy1 = args[1];\r\n\r\n        cpx2 = args[2];\r\n        cpy2 = args[3];\r\n\r\n        if (points.length > 0) {\r\n\r\n          laste = points[points.length - 1];\r\n\r\n          cpx0 = laste.x;\r\n          cpy0 = laste.y;\r\n\r\n        }\r\n        else {\r\n\r\n          laste = this.actions[i - 1].args;\r\n\r\n          cpx0 = laste[laste.length - 2];\r\n          cpy0 = laste[laste.length - 1];\r\n\r\n        }\r\n\r\n\r\n        for (j = 1; j <= divisions; j++) {\r\n\r\n          t = j / divisions;\r\n\r\n          tx = THREE.Shape.Utils.b3(t, cpx0, cpx1, cpx2, cpx);\r\n          ty = THREE.Shape.Utils.b3(t, cpy0, cpy1, cpy2, cpy);\r\n\r\n          points.push(new THREE.Vector2(tx, ty));\r\n\r\n        }\r\n\r\n        break;\r\n\r\n      case THREE.PathActions.CSPLINE_THRU:\r\n\r\n        laste = this.actions[i - 1].args;\r\n\r\n        var last = new THREE.Vector2(laste[laste.length - 2], laste[laste.length - 1]);\r\n        var spts = [last];\r\n\r\n        var n = divisions * args[0].length;\r\n\r\n        spts = spts.concat(args[0]);\r\n\r\n        var spline = new THREE.SplineCurve(spts);\r\n\r\n        for (j = 1; j <= n; j++) {\r\n\r\n          points.push(spline.getPointAt(j / n));\r\n\r\n        }\r\n\r\n        break;\r\n\r\n      case THREE.PathActions.ARC:\r\n\r\n        var aX = args[0],\r\n          aY = args[1],\r\n          aRadius = args[2],\r\n          aStartAngle = args[3],\r\n          aEndAngle = args[4],\r\n          aClockwise = !!args[5];\r\n\r\n        var deltaAngle = aEndAngle - aStartAngle;\r\n        var angle;\r\n        var tdivisions = divisions * 2;\r\n\r\n        for (j = 1; j <= tdivisions; j++) {\r\n\r\n          t = j / tdivisions;\r\n\r\n          if (!aClockwise) {\r\n\r\n            t = 1 - t;\r\n\r\n          }\r\n\r\n          angle = aStartAngle + t * deltaAngle;\r\n\r\n          tx = aX + aRadius * Math.cos(angle);\r\n          ty = aY + aRadius * Math.sin(angle);\r\n\r\n          //console.log('t', t, 'angle', angle, 'tx', tx, 'ty', ty);\r\n\r\n          points.push(new THREE.Vector2(tx, ty));\r\n\r\n        }\r\n\r\n        //console.log(points);\r\n\r\n        break;\r\n\r\n      case THREE.PathActions.ELLIPSE:\r\n\r\n        var aX = args[0],\r\n          aY = args[1],\r\n          xRadius = args[2],\r\n          yRadius = args[3],\r\n          aStartAngle = args[4],\r\n          aEndAngle = args[5],\r\n          aClockwise = !!args[6];\r\n\r\n\r\n        var deltaAngle = aEndAngle - aStartAngle;\r\n        var angle;\r\n        var tdivisions = divisions * 2;\r\n\r\n        for (j = 1; j <= tdivisions; j++) {\r\n\r\n          t = j / tdivisions;\r\n\r\n          if (!aClockwise) {\r\n\r\n            t = 1 - t;\r\n\r\n          }\r\n\r\n          angle = aStartAngle + t * deltaAngle;\r\n\r\n          tx = aX + xRadius * Math.cos(angle);\r\n          ty = aY + yRadius * Math.sin(angle);\r\n\r\n          //console.log('t', t, 'angle', angle, 'tx', tx, 'ty', ty);\r\n\r\n          points.push(new THREE.Vector2(tx, ty));\r\n\r\n        }\r\n\r\n        //console.log(points);\r\n\r\n        break;\r\n\r\n    } // end switch\r\n\r\n  }\r\n\r\n\r\n\r\n  // Normalize to remove the closing point by default.\r\n  var lastPoint = points[points.length - 1];\r\n  var EPSILON = 0.0000000001;\r\n  if (Math.abs(lastPoint.x - points[0].x) < EPSILON &&\r\n    Math.abs(lastPoint.y - points[0].y) < EPSILON)\r\n    points.splice(points.length - 1, 1);\r\n  if (closedPath) {\r\n\r\n    points.push(points[0]);\r\n\r\n  }\r\n\r\n  return points;\r\n\r\n};\r\n\r\n//\r\n// Breaks path into shapes\r\n//\r\n//\tAssumptions (if parameter isCCW==true the opposite holds):\r\n//\t- solid shapes are defined clockwise (CW)\r\n//\t- holes are defined counterclockwise (CCW)\r\n//\r\n//\tIf parameter noHoles==true:\r\n//  - all subPaths are regarded as solid shapes\r\n//  - definition order CW/CCW has no relevance\r\n//\r\n\r\nTHREE.Path.prototype.toShapes = function(isCCW, noHoles) {\r\n\r\n  function extractSubpaths(inActions) {\r\n\r\n    var i, il, item, action, args;\r\n\r\n    var subPaths = [],\r\n      lastPath = new THREE.Path();\r\n\r\n    for (i = 0, il = inActions.length; i < il; i++) {\r\n\r\n      item = inActions[i];\r\n\r\n      args = item.args;\r\n      action = item.action;\r\n\r\n      if (action == THREE.PathActions.MOVE_TO) {\r\n\r\n        if (lastPath.actions.length != 0) {\r\n\r\n          subPaths.push(lastPath);\r\n          lastPath = new THREE.Path();\r\n\r\n        }\r\n\r\n      }\r\n\r\n      lastPath[action].apply(lastPath, args);\r\n\r\n    }\r\n\r\n    if (lastPath.actions.length != 0) {\r\n\r\n      subPaths.push(lastPath);\r\n\r\n    }\r\n\r\n    // console.log(subPaths);\r\n\r\n    return subPaths;\r\n  }\r\n\r\n  function toShapesNoHoles(inSubpaths) {\r\n\r\n    var shapes = [];\r\n\r\n    for (var i = 0, il = inSubpaths.length; i < il; i++) {\r\n\r\n      var tmpPath = inSubpaths[i];\r\n\r\n      var tmpShape = new THREE.Shape();\r\n      tmpShape.actions = tmpPath.actions;\r\n      tmpShape.curves = tmpPath.curves;\r\n\r\n      shapes.push(tmpShape);\r\n    }\r\n\r\n    //console.log(\"shape\", shapes);\r\n\r\n    return shapes;\r\n  };\r\n\r\n  function isPointInsidePolygon(inPt, inPolygon) {\r\n    var EPSILON = 0.0000000001;\r\n\r\n    var polyLen = inPolygon.length;\r\n\r\n    // inPt on polygon contour => immediate success    or\r\n    // toggling of inside/outside at every single! intersection point of an edge\r\n    //  with the horizontal line through inPt, left of inPt\r\n    //  not counting lowerY endpoints of edges and whole edges on that line\r\n    var inside = false;\r\n    for (var p = polyLen - 1, q = 0; q < polyLen; p = q++) {\r\n      var edgeLowPt = inPolygon[p];\r\n      var edgeHighPt = inPolygon[q];\r\n\r\n      var edgeDx = edgeHighPt.x - edgeLowPt.x;\r\n      var edgeDy = edgeHighPt.y - edgeLowPt.y;\r\n\r\n      if (Math.abs(edgeDy) > EPSILON) { // not parallel\r\n        if (edgeDy < 0) {\r\n          edgeLowPt = inPolygon[q];\r\n          edgeDx = -edgeDx;\r\n          edgeHighPt = inPolygon[p];\r\n          edgeDy = -edgeDy;\r\n        }\r\n        if ((inPt.y < edgeLowPt.y) || (inPt.y > edgeHighPt.y)) continue;\r\n\r\n        if (inPt.y == edgeLowPt.y) {\r\n          if (inPt.x == edgeLowPt.x) return true; // inPt is on contour ?\r\n          // continue;\t\t\t\t// no intersection or edgeLowPt => doesn't count !!!\r\n        }\r\n        else {\r\n          var perpEdge = edgeDy * (inPt.x - edgeLowPt.x) - edgeDx * (inPt.y - edgeLowPt.y);\r\n          if (perpEdge == 0) return true; // inPt is on contour ?\r\n          if (perpEdge < 0) continue;\r\n          inside = !inside; // true intersection left of inPt\r\n        }\r\n      }\r\n      else { // parallel or colinear\r\n        if (inPt.y != edgeLowPt.y) continue; // parallel\r\n        // egde lies on the same horizontal line as inPt\r\n        if (((edgeHighPt.x <= inPt.x) && (inPt.x <= edgeLowPt.x)) ||\r\n          ((edgeLowPt.x <= inPt.x) && (inPt.x <= edgeHighPt.x))) return true; // inPt: Point on contour !\r\n        // continue;\r\n      }\r\n    }\r\n\r\n    return inside;\r\n  }\r\n\r\n\r\n  var subPaths = extractSubpaths(this.actions);\r\n  if (subPaths.length == 0) return [];\r\n\r\n  if (noHoles === true) return toShapesNoHoles(subPaths);\r\n\r\n\r\n  var solid, tmpPath, tmpShape, shapes = [];\r\n\r\n  if (subPaths.length == 1) {\r\n\r\n    tmpPath = subPaths[0];\r\n    tmpShape = new THREE.Shape();\r\n    tmpShape.actions = tmpPath.actions;\r\n    tmpShape.curves = tmpPath.curves;\r\n    shapes.push(tmpShape);\r\n    return shapes;\r\n\r\n  }\r\n\r\n  var holesFirst = !THREE.Shape.Utils.isClockWise(subPaths[0].getPoints());\r\n  holesFirst = isCCW ? !holesFirst : holesFirst;\r\n\r\n  // console.log(\"Holes first\", holesFirst);\r\n\r\n  var betterShapeHoles = [];\r\n  var newShapes = [];\r\n  var newShapeHoles = [];\r\n  var mainIdx = 0;\r\n  var tmpPoints;\r\n\r\n  newShapes[mainIdx] = undefined;\r\n  newShapeHoles[mainIdx] = [];\r\n\r\n  var i, il;\r\n\r\n  for (i = 0, il = subPaths.length; i < il; i++) {\r\n\r\n    tmpPath = subPaths[i];\r\n    tmpPoints = tmpPath.getPoints();\r\n    solid = THREE.Shape.Utils.isClockWise(tmpPoints);\r\n    solid = isCCW ? !solid : solid;\r\n\r\n    if (solid) {\r\n\r\n      if ((!holesFirst) && (newShapes[mainIdx])) mainIdx++;\r\n\r\n      newShapes[mainIdx] = {\r\n        s: new THREE.Shape(),\r\n        p: tmpPoints\r\n      };\r\n      newShapes[mainIdx].s.actions = tmpPath.actions;\r\n      newShapes[mainIdx].s.curves = tmpPath.curves;\r\n\r\n      if (holesFirst) mainIdx++;\r\n      newShapeHoles[mainIdx] = [];\r\n\r\n      //console.log('cw', i);\r\n\r\n    }\r\n    else {\r\n\r\n      newShapeHoles[mainIdx].push({\r\n        h: tmpPath,\r\n        p: tmpPoints[0]\r\n      });\r\n\r\n      //console.log('ccw', i);\r\n\r\n    }\r\n\r\n  }\r\n\r\n  // only Holes? -> probably all Shapes with wrong orientation\r\n  if (!newShapes[0]) return toShapesNoHoles(subPaths);\r\n\r\n\r\n  if (newShapes.length > 1) {\r\n    var ambigious = false;\r\n    var toChange = [];\r\n\r\n    for (var sIdx = 0, sLen = newShapes.length; sIdx < sLen; sIdx++) {\r\n      betterShapeHoles[sIdx] = [];\r\n    }\r\n    for (var sIdx = 0, sLen = newShapes.length; sIdx < sLen; sIdx++) {\r\n      var sho = newShapeHoles[sIdx];\r\n      for (var hIdx = 0; hIdx < sho.length; hIdx++) {\r\n        var ho = sho[hIdx];\r\n        var hole_unassigned = true;\r\n        for (var s2Idx = 0; s2Idx < newShapes.length; s2Idx++) {\r\n          if (isPointInsidePolygon(ho.p, newShapes[s2Idx].p)) {\r\n            if (sIdx != s2Idx) toChange.push({\r\n              froms: sIdx,\r\n              tos: s2Idx,\r\n              hole: hIdx\r\n            });\r\n            if (hole_unassigned) {\r\n              hole_unassigned = false;\r\n              betterShapeHoles[s2Idx].push(ho);\r\n            }\r\n            else {\r\n              ambigious = true;\r\n            }\r\n          }\r\n        }\r\n        if (hole_unassigned) {\r\n          betterShapeHoles[sIdx].push(ho);\r\n        }\r\n      }\r\n    }\r\n    // console.log(\"ambigious: \", ambigious);\r\n    if (toChange.length > 0) {\r\n      // console.log(\"to change: \", toChange);\r\n      if (!ambigious) newShapeHoles = betterShapeHoles;\r\n    }\r\n  }\r\n\r\n  var tmpHoles, j, jl;\r\n  for (i = 0, il = newShapes.length; i < il; i++) {\r\n    tmpShape = newShapes[i].s;\r\n    shapes.push(tmpShape);\r\n    tmpHoles = newShapeHoles[i];\r\n    for (j = 0, jl = tmpHoles.length; j < jl; j++) {\r\n      tmpShape.holes.push(tmpHoles[j].h);\r\n    }\r\n  }\r\n\r\n  //console.log(\"shape\", shapes);\r\n\r\n  return shapes;\r\n\r\n};\r\n\r\n// File:src/extras/core/Shape.js\r\n\r\n/**\r\n * @author zz85 / http://www.lab4games.net/zz85/blog\r\n * Defines a 2d shape plane using paths.\r\n **/\r\n\r\n// STEP 1 Create a path.\r\n// STEP 2 Turn path into shape.\r\n// STEP 3 ExtrudeGeometry takes in Shape/Shapes\r\n// STEP 3a - Extract points from each shape, turn to vertices\r\n// STEP 3b - Triangulate each shape, add faces.\r\n\r\nTHREE.Shape = function() {\r\n\r\n  THREE.Path.apply(this, arguments);\r\n  this.holes = [];\r\n\r\n};\r\n\r\nTHREE.Shape.prototype = Object.create(THREE.Path.prototype);\r\nTHREE.Shape.prototype.constructor = THREE.Shape;\r\n\r\n// Convenience method to return ExtrudeGeometry\r\n\r\nTHREE.Shape.prototype.extrude = function(options) {\r\n\r\n  var extruded = new THREE.ExtrudeGeometry(this, options);\r\n  return extruded;\r\n\r\n};\r\n\r\n// Convenience method to return ShapeGeometry\r\n\r\nTHREE.Shape.prototype.makeGeometry = function(options) {\r\n\r\n  var geometry = new THREE.ShapeGeometry(this, options);\r\n  return geometry;\r\n\r\n};\r\n\r\n// Get points of holes\r\n\r\nTHREE.Shape.prototype.getPointsHoles = function(divisions) {\r\n\r\n  var i, il = this.holes.length,\r\n    holesPts = [];\r\n\r\n  for (i = 0; i < il; i++) {\r\n\r\n    holesPts[i] = this.holes[i].getTransformedPoints(divisions, this.bends);\r\n\r\n  }\r\n\r\n  return holesPts;\r\n\r\n};\r\n\r\n// Get points of holes (spaced by regular distance)\r\n\r\nTHREE.Shape.prototype.getSpacedPointsHoles = function(divisions) {\r\n\r\n  var i, il = this.holes.length,\r\n    holesPts = [];\r\n\r\n  for (i = 0; i < il; i++) {\r\n\r\n    holesPts[i] = this.holes[i].getTransformedSpacedPoints(divisions, this.bends);\r\n\r\n  }\r\n\r\n  return holesPts;\r\n\r\n};\r\n\r\n\r\n// Get points of shape and holes (keypoints based on segments parameter)\r\n\r\nTHREE.Shape.prototype.extractAllPoints = function(divisions) {\r\n\r\n  return {\r\n\r\n    shape: this.getTransformedPoints(divisions),\r\n    holes: this.getPointsHoles(divisions)\r\n\r\n  };\r\n\r\n};\r\n\r\nTHREE.Shape.prototype.extractPoints = function(divisions) {\r\n\r\n  if (this.useSpacedPoints) {\r\n    return this.extractAllSpacedPoints(divisions);\r\n  }\r\n\r\n  return this.extractAllPoints(divisions);\r\n\r\n};\r\n\r\n//\r\n// THREE.Shape.prototype.extractAllPointsWithBend = function ( divisions, bend ) {\r\n//\r\n// \treturn {\r\n//\r\n// \t\tshape: this.transform( bend, divisions ),\r\n// \t\tholes: this.getPointsHoles( divisions, bend )\r\n//\r\n// \t};\r\n//\r\n// };\r\n\r\n// Get points of shape and holes (spaced by regular distance)\r\n\r\nTHREE.Shape.prototype.extractAllSpacedPoints = function(divisions) {\r\n\r\n  return {\r\n\r\n    shape: this.getTransformedSpacedPoints(divisions),\r\n    holes: this.getSpacedPointsHoles(divisions)\r\n\r\n  };\r\n\r\n};\r\n\r\n/**************************************************************\r\n *\tUtils\r\n **************************************************************/\r\n\r\nTHREE.Shape.Utils = {\r\n\r\n  triangulateShape: function(contour, holes) {\r\n\r\n    function point_in_segment_2D_colin(inSegPt1, inSegPt2, inOtherPt) {\r\n      // inOtherPt needs to be colinear to the inSegment\r\n      if (inSegPt1.x != inSegPt2.x) {\r\n        if (inSegPt1.x < inSegPt2.x) {\r\n          return ((inSegPt1.x <= inOtherPt.x) && (inOtherPt.x <= inSegPt2.x));\r\n        }\r\n        else {\r\n          return ((inSegPt2.x <= inOtherPt.x) && (inOtherPt.x <= inSegPt1.x));\r\n        }\r\n      }\r\n      else {\r\n        if (inSegPt1.y < inSegPt2.y) {\r\n          return ((inSegPt1.y <= inOtherPt.y) && (inOtherPt.y <= inSegPt2.y));\r\n        }\r\n        else {\r\n          return ((inSegPt2.y <= inOtherPt.y) && (inOtherPt.y <= inSegPt1.y));\r\n        }\r\n      }\r\n    }\r\n\r\n    function intersect_segments_2D(inSeg1Pt1, inSeg1Pt2, inSeg2Pt1, inSeg2Pt2, inExcludeAdjacentSegs) {\r\n      var EPSILON = 0.0000000001;\r\n\r\n      var seg1dx = inSeg1Pt2.x - inSeg1Pt1.x,\r\n        seg1dy = inSeg1Pt2.y - inSeg1Pt1.y;\r\n      var seg2dx = inSeg2Pt2.x - inSeg2Pt1.x,\r\n        seg2dy = inSeg2Pt2.y - inSeg2Pt1.y;\r\n\r\n      var seg1seg2dx = inSeg1Pt1.x - inSeg2Pt1.x;\r\n      var seg1seg2dy = inSeg1Pt1.y - inSeg2Pt1.y;\r\n\r\n      var limit = seg1dy * seg2dx - seg1dx * seg2dy;\r\n      var perpSeg1 = seg1dy * seg1seg2dx - seg1dx * seg1seg2dy;\r\n\r\n      if (Math.abs(limit) > EPSILON) { // not parallel\r\n\r\n        var perpSeg2;\r\n        if (limit > 0) {\r\n          if ((perpSeg1 < 0) || (perpSeg1 > limit)) return [];\r\n          perpSeg2 = seg2dy * seg1seg2dx - seg2dx * seg1seg2dy;\r\n          if ((perpSeg2 < 0) || (perpSeg2 > limit)) return [];\r\n        }\r\n        else {\r\n          if ((perpSeg1 > 0) || (perpSeg1 < limit)) return [];\r\n          perpSeg2 = seg2dy * seg1seg2dx - seg2dx * seg1seg2dy;\r\n          if ((perpSeg2 > 0) || (perpSeg2 < limit)) return [];\r\n        }\r\n\r\n        // i.e. to reduce rounding errors\r\n        // intersection at endpoint of segment#1?\r\n        if (perpSeg2 == 0) {\r\n          if ((inExcludeAdjacentSegs) &&\r\n            ((perpSeg1 == 0) || (perpSeg1 == limit))) return [];\r\n          return [inSeg1Pt1];\r\n        }\r\n        if (perpSeg2 == limit) {\r\n          if ((inExcludeAdjacentSegs) &&\r\n            ((perpSeg1 == 0) || (perpSeg1 == limit))) return [];\r\n          return [inSeg1Pt2];\r\n        }\r\n        // intersection at endpoint of segment#2?\r\n        if (perpSeg1 == 0) return [inSeg2Pt1];\r\n        if (perpSeg1 == limit) return [inSeg2Pt2];\r\n\r\n        // return real intersection point\r\n        var factorSeg1 = perpSeg2 / limit;\r\n        return [{\r\n          x: inSeg1Pt1.x + factorSeg1 * seg1dx,\r\n          y: inSeg1Pt1.y + factorSeg1 * seg1dy\r\n        }];\r\n\r\n      }\r\n      else { // parallel or colinear\r\n        if ((perpSeg1 != 0) ||\r\n          (seg2dy * seg1seg2dx != seg2dx * seg1seg2dy)) return [];\r\n\r\n        // they are collinear or degenerate\r\n        var seg1Pt = ((seg1dx == 0) && (seg1dy == 0)); // segment1 ist just a point?\r\n        var seg2Pt = ((seg2dx == 0) && (seg2dy == 0)); // segment2 ist just a point?\r\n        // both segments are points\r\n        if (seg1Pt && seg2Pt) {\r\n          if ((inSeg1Pt1.x != inSeg2Pt1.x) ||\r\n            (inSeg1Pt1.y != inSeg2Pt1.y)) return []; // they are distinct  points\r\n          return [inSeg1Pt1]; // they are the same point\r\n        }\r\n        // segment#1  is a single point\r\n        if (seg1Pt) {\r\n          if (!point_in_segment_2D_colin(inSeg2Pt1, inSeg2Pt2, inSeg1Pt1)) return []; // but not in segment#2\r\n          return [inSeg1Pt1];\r\n        }\r\n        // segment#2  is a single point\r\n        if (seg2Pt) {\r\n          if (!point_in_segment_2D_colin(inSeg1Pt1, inSeg1Pt2, inSeg2Pt1)) return []; // but not in segment#1\r\n          return [inSeg2Pt1];\r\n        }\r\n\r\n        // they are collinear segments, which might overlap\r\n        var seg1min, seg1max, seg1minVal, seg1maxVal;\r\n        var seg2min, seg2max, seg2minVal, seg2maxVal;\r\n        if (seg1dx != 0) { // the segments are NOT on a vertical line\r\n          if (inSeg1Pt1.x < inSeg1Pt2.x) {\r\n            seg1min = inSeg1Pt1;\r\n            seg1minVal = inSeg1Pt1.x;\r\n            seg1max = inSeg1Pt2;\r\n            seg1maxVal = inSeg1Pt2.x;\r\n          }\r\n          else {\r\n            seg1min = inSeg1Pt2;\r\n            seg1minVal = inSeg1Pt2.x;\r\n            seg1max = inSeg1Pt1;\r\n            seg1maxVal = inSeg1Pt1.x;\r\n          }\r\n          if (inSeg2Pt1.x < inSeg2Pt2.x) {\r\n            seg2min = inSeg2Pt1;\r\n            seg2minVal = inSeg2Pt1.x;\r\n            seg2max = inSeg2Pt2;\r\n            seg2maxVal = inSeg2Pt2.x;\r\n          }\r\n          else {\r\n            seg2min = inSeg2Pt2;\r\n            seg2minVal = inSeg2Pt2.x;\r\n            seg2max = inSeg2Pt1;\r\n            seg2maxVal = inSeg2Pt1.x;\r\n          }\r\n        }\r\n        else { // the segments are on a vertical line\r\n          if (inSeg1Pt1.y < inSeg1Pt2.y) {\r\n            seg1min = inSeg1Pt1;\r\n            seg1minVal = inSeg1Pt1.y;\r\n            seg1max = inSeg1Pt2;\r\n            seg1maxVal = inSeg1Pt2.y;\r\n          }\r\n          else {\r\n            seg1min = inSeg1Pt2;\r\n            seg1minVal = inSeg1Pt2.y;\r\n            seg1max = inSeg1Pt1;\r\n            seg1maxVal = inSeg1Pt1.y;\r\n          }\r\n          if (inSeg2Pt1.y < inSeg2Pt2.y) {\r\n            seg2min = inSeg2Pt1;\r\n            seg2minVal = inSeg2Pt1.y;\r\n            seg2max = inSeg2Pt2;\r\n            seg2maxVal = inSeg2Pt2.y;\r\n          }\r\n          else {\r\n            seg2min = inSeg2Pt2;\r\n            seg2minVal = inSeg2Pt2.y;\r\n            seg2max = inSeg2Pt1;\r\n            seg2maxVal = inSeg2Pt1.y;\r\n          }\r\n        }\r\n        if (seg1minVal <= seg2minVal) {\r\n          if (seg1maxVal < seg2minVal) return [];\r\n          if (seg1maxVal == seg2minVal) {\r\n            if (inExcludeAdjacentSegs) return [];\r\n            return [seg2min];\r\n          }\r\n          if (seg1maxVal <= seg2maxVal) return [seg2min, seg1max];\r\n          return [seg2min, seg2max];\r\n        }\r\n        else {\r\n          if (seg1minVal > seg2maxVal) return [];\r\n          if (seg1minVal == seg2maxVal) {\r\n            if (inExcludeAdjacentSegs) return [];\r\n            return [seg1min];\r\n          }\r\n          if (seg1maxVal <= seg2maxVal) return [seg1min, seg1max];\r\n          return [seg1min, seg2max];\r\n        }\r\n      }\r\n    }\r\n\r\n    function isPointInsideAngle(inVertex, inLegFromPt, inLegToPt, inOtherPt) {\r\n      // The order of legs is important\r\n\r\n      var EPSILON = 0.0000000001;\r\n\r\n      // translation of all points, so that Vertex is at (0,0)\r\n      var legFromPtX = inLegFromPt.x - inVertex.x,\r\n        legFromPtY = inLegFromPt.y - inVertex.y;\r\n      var legToPtX = inLegToPt.x - inVertex.x,\r\n        legToPtY = inLegToPt.y - inVertex.y;\r\n      var otherPtX = inOtherPt.x - inVertex.x,\r\n        otherPtY = inOtherPt.y - inVertex.y;\r\n\r\n      // main angle >0: < 180 deg.; 0: 180 deg.; <0: > 180 deg.\r\n      var from2toAngle = legFromPtX * legToPtY - legFromPtY * legToPtX;\r\n      var from2otherAngle = legFromPtX * otherPtY - legFromPtY * otherPtX;\r\n\r\n      if (Math.abs(from2toAngle) > EPSILON) { // angle != 180 deg.\r\n\r\n        var other2toAngle = otherPtX * legToPtY - otherPtY * legToPtX;\r\n        // console.log( \"from2to: \" + from2toAngle + \", from2other: \" + from2otherAngle + \", other2to: \" + other2toAngle );\r\n\r\n        if (from2toAngle > 0) { // main angle < 180 deg.\r\n          return ((from2otherAngle >= 0) && (other2toAngle >= 0));\r\n        }\r\n        else { // main angle > 180 deg.\r\n          return ((from2otherAngle >= 0) || (other2toAngle >= 0));\r\n        }\r\n      }\r\n      else { // angle == 180 deg.\r\n        // console.log( \"from2to: 180 deg., from2other: \" + from2otherAngle  );\r\n        return (from2otherAngle > 0);\r\n      }\r\n    }\r\n\r\n\r\n    function removeHoles(contour, holes) {\r\n\r\n      var shape = contour.concat(); // work on this shape\r\n      var hole;\r\n\r\n      function isCutLineInsideAngles(inShapeIdx, inHoleIdx) {\r\n        // Check if hole point lies within angle around shape point\r\n        var lastShapeIdx = shape.length - 1;\r\n\r\n        var prevShapeIdx = inShapeIdx - 1;\r\n        if (prevShapeIdx < 0) prevShapeIdx = lastShapeIdx;\r\n\r\n        var nextShapeIdx = inShapeIdx + 1;\r\n        if (nextShapeIdx > lastShapeIdx) nextShapeIdx = 0;\r\n\r\n        var insideAngle = isPointInsideAngle(shape[inShapeIdx], shape[prevShapeIdx], shape[nextShapeIdx], hole[inHoleIdx]);\r\n        if (!insideAngle) {\r\n          // console.log( \"Vertex (Shape): \" + inShapeIdx + \", Point: \" + hole[inHoleIdx].x + \"/\" + hole[inHoleIdx].y );\r\n          return false;\r\n        }\r\n\r\n        // Check if shape point lies within angle around hole point\r\n        var lastHoleIdx = hole.length - 1;\r\n\r\n        var prevHoleIdx = inHoleIdx - 1;\r\n        if (prevHoleIdx < 0) prevHoleIdx = lastHoleIdx;\r\n\r\n        var nextHoleIdx = inHoleIdx + 1;\r\n        if (nextHoleIdx > lastHoleIdx) nextHoleIdx = 0;\r\n\r\n        insideAngle = isPointInsideAngle(hole[inHoleIdx], hole[prevHoleIdx], hole[nextHoleIdx], shape[inShapeIdx]);\r\n        if (!insideAngle) {\r\n          // console.log( \"Vertex (Hole): \" + inHoleIdx + \", Point: \" + shape[inShapeIdx].x + \"/\" + shape[inShapeIdx].y );\r\n          return false;\r\n        }\r\n\r\n        return true;\r\n      }\r\n\r\n      function intersectsShapeEdge(inShapePt, inHolePt) {\r\n        // checks for intersections with shape edges\r\n        var sIdx, nextIdx, intersection;\r\n        for (sIdx = 0; sIdx < shape.length; sIdx++) {\r\n          nextIdx = sIdx + 1;\r\n          nextIdx %= shape.length;\r\n          intersection = intersect_segments_2D(inShapePt, inHolePt, shape[sIdx], shape[nextIdx], true);\r\n          if (intersection.length > 0) return true;\r\n        }\r\n\r\n        return false;\r\n      }\r\n\r\n      var indepHoles = [];\r\n\r\n      function intersectsHoleEdge(inShapePt, inHolePt) {\r\n        // checks for intersections with hole edges\r\n        var ihIdx, chkHole,\r\n          hIdx, nextIdx, intersection;\r\n        for (ihIdx = 0; ihIdx < indepHoles.length; ihIdx++) {\r\n          chkHole = holes[indepHoles[ihIdx]];\r\n          for (hIdx = 0; hIdx < chkHole.length; hIdx++) {\r\n            nextIdx = hIdx + 1;\r\n            nextIdx %= chkHole.length;\r\n            intersection = intersect_segments_2D(inShapePt, inHolePt, chkHole[hIdx], chkHole[nextIdx], true);\r\n            if (intersection.length > 0) return true;\r\n          }\r\n        }\r\n        return false;\r\n      }\r\n\r\n      var holeIndex, shapeIndex,\r\n        shapePt, holePt,\r\n        holeIdx, cutKey, failedCuts = [],\r\n        tmpShape1, tmpShape2,\r\n        tmpHole1, tmpHole2;\r\n\r\n      for (var h = 0, hl = holes.length; h < hl; h++) {\r\n\r\n        indepHoles.push(h);\r\n\r\n      }\r\n\r\n      var minShapeIndex = 0;\r\n      var counter = indepHoles.length * 2;\r\n      while (indepHoles.length > 0) {\r\n        counter--;\r\n        if (counter < 0) {\r\n          console.log(\"Infinite Loop! Holes left:\" + indepHoles.length + \", Probably Hole outside Shape!\");\r\n          break;\r\n        }\r\n\r\n        // search for shape-vertex and hole-vertex,\r\n        // which can be connected without intersections\r\n        for (shapeIndex = minShapeIndex; shapeIndex < shape.length; shapeIndex++) {\r\n\r\n          shapePt = shape[shapeIndex];\r\n          holeIndex = -1;\r\n\r\n          // search for hole which can be reached without intersections\r\n          for (var h = 0; h < indepHoles.length; h++) {\r\n            holeIdx = indepHoles[h];\r\n\r\n            // prevent multiple checks\r\n            cutKey = shapePt.x + \":\" + shapePt.y + \":\" + holeIdx;\r\n            if (failedCuts[cutKey] !== undefined) continue;\r\n\r\n            hole = holes[holeIdx];\r\n            for (var h2 = 0; h2 < hole.length; h2++) {\r\n              holePt = hole[h2];\r\n              if (!isCutLineInsideAngles(shapeIndex, h2)) continue;\r\n              if (intersectsShapeEdge(shapePt, holePt)) continue;\r\n              if (intersectsHoleEdge(shapePt, holePt)) continue;\r\n\r\n              holeIndex = h2;\r\n              indepHoles.splice(h, 1);\r\n\r\n              tmpShape1 = shape.slice(0, shapeIndex + 1);\r\n              tmpShape2 = shape.slice(shapeIndex);\r\n              tmpHole1 = hole.slice(holeIndex);\r\n              tmpHole2 = hole.slice(0, holeIndex + 1);\r\n\r\n              shape = tmpShape1.concat(tmpHole1).concat(tmpHole2).concat(tmpShape2);\r\n\r\n              minShapeIndex = shapeIndex;\r\n\r\n              // Debug only, to show the selected cuts\r\n              // glob_CutLines.push( [ shapePt, holePt ] );\r\n\r\n              break;\r\n            }\r\n            if (holeIndex >= 0) break; // hole-vertex found\r\n\r\n            failedCuts[cutKey] = true; // remember failure\r\n          }\r\n          if (holeIndex >= 0) break; // hole-vertex found\r\n        }\r\n      }\r\n\r\n      return shape; /* shape with no holes */\r\n    }\r\n\r\n\r\n    var i, il, f, face,\r\n      key, index,\r\n      allPointsMap = {};\r\n\r\n    // To maintain reference to old shape, one must match coordinates, or offset the indices from original arrays. It's probably easier to do the first.\r\n\r\n    var allpoints = contour.concat();\r\n\r\n    for (var h = 0, hl = holes.length; h < hl; h++) {\r\n\r\n      Array.prototype.push.apply(allpoints, holes[h]);\r\n\r\n    }\r\n\r\n    //console.log( \"allpoints\",allpoints, allpoints.length );\r\n\r\n    // prepare all points map\r\n\r\n    for (i = 0, il = allpoints.length; i < il; i++) {\r\n\r\n      key = allpoints[i].x + \":\" + allpoints[i].y;\r\n\r\n      if (allPointsMap[key] !== undefined) {\r\n\r\n        THREE.warn(\"THREE.Shape: Duplicate point\", key);\r\n\r\n      }\r\n\r\n      allPointsMap[key] = i;\r\n\r\n    }\r\n\r\n    // remove holes by cutting paths to holes and adding them to the shape\r\n    var shapeWithoutHoles = removeHoles(contour, holes);\r\n\r\n    var triangles = THREE.FontUtils.Triangulate(shapeWithoutHoles, false); // True returns indices for points of spooled shape\r\n    //console.log( \"triangles\",triangles, triangles.length );\r\n\r\n    // check all face vertices against all points map\r\n\r\n    for (i = 0, il = triangles.length; i < il; i++) {\r\n\r\n      face = triangles[i];\r\n\r\n      for (f = 0; f < 3; f++) {\r\n\r\n        key = face[f].x + \":\" + face[f].y;\r\n\r\n        index = allPointsMap[key];\r\n\r\n        if (index !== undefined) {\r\n\r\n          face[f] = index;\r\n\r\n        }\r\n\r\n      }\r\n\r\n    }\r\n\r\n    return triangles.concat();\r\n\r\n  },\r\n\r\n  isClockWise: function(pts) {\r\n\r\n    return THREE.FontUtils.Triangulate.area(pts) < 0;\r\n\r\n  },\r\n\r\n  // Bezier Curves formulas obtained from\r\n  // http://en.wikipedia.org/wiki/B%C3%A9zier_curve\r\n\r\n  // Quad Bezier Functions\r\n\r\n  b2p0: function(t, p) {\r\n\r\n    var k = 1 - t;\r\n    return k * k * p;\r\n\r\n  },\r\n\r\n  b2p1: function(t, p) {\r\n\r\n    return 2 * (1 - t) * t * p;\r\n\r\n  },\r\n\r\n  b2p2: function(t, p) {\r\n\r\n    return t * t * p;\r\n\r\n  },\r\n\r\n  b2: function(t, p0, p1, p2) {\r\n\r\n    return this.b2p0(t, p0) + this.b2p1(t, p1) + this.b2p2(t, p2);\r\n\r\n  },\r\n\r\n  // Cubic Bezier Functions\r\n\r\n  b3p0: function(t, p) {\r\n\r\n    var k = 1 - t;\r\n    return k * k * k * p;\r\n\r\n  },\r\n\r\n  b3p1: function(t, p) {\r\n\r\n    var k = 1 - t;\r\n    return 3 * k * k * t * p;\r\n\r\n  },\r\n\r\n  b3p2: function(t, p) {\r\n\r\n    var k = 1 - t;\r\n    return 3 * k * t * t * p;\r\n\r\n  },\r\n\r\n  b3p3: function(t, p) {\r\n\r\n    return t * t * t * p;\r\n\r\n  },\r\n\r\n  b3: function(t, p0, p1, p2, p3) {\r\n\r\n    return this.b3p0(t, p0) + this.b3p1(t, p1) + this.b3p2(t, p2) + this.b3p3(t, p3);\r\n\r\n  }\r\n\r\n};\r\n\r\n\r\n// File:src/extras/curves/LineCurve.js\r\n\r\n/**************************************************************\r\n *\tLine\r\n **************************************************************/\r\n\r\nTHREE.LineCurve = function(v1, v2) {\r\n\r\n  this.v1 = v1;\r\n  this.v2 = v2;\r\n\r\n};\r\n\r\nTHREE.LineCurve.prototype = Object.create(THREE.Curve.prototype);\r\nTHREE.LineCurve.prototype.constructor = THREE.LineCurve;\r\n\r\nTHREE.LineCurve.prototype.getPoint = function(t) {\r\n\r\n  var point = this.v2.clone().sub(this.v1);\r\n  point.multiplyScalar(t).add(this.v1);\r\n\r\n  return point;\r\n\r\n};\r\n\r\n// Line curve is linear, so we can overwrite default getPointAt\r\n\r\nTHREE.LineCurve.prototype.getPointAt = function(u) {\r\n\r\n  return this.getPoint(u);\r\n\r\n};\r\n\r\nTHREE.LineCurve.prototype.getTangent = function(t) {\r\n\r\n  var tangent = this.v2.clone().sub(this.v1);\r\n\r\n  return tangent.normalize();\r\n\r\n};\r\n\r\n// File:src/extras/curves/QuadraticBezierCurve.js\r\n\r\n/**************************************************************\r\n *\tQuadratic Bezier curve\r\n **************************************************************/\r\n\r\n\r\nTHREE.QuadraticBezierCurve = function(v0, v1, v2) {\r\n\r\n  this.v0 = v0;\r\n  this.v1 = v1;\r\n  this.v2 = v2;\r\n\r\n};\r\n\r\nTHREE.QuadraticBezierCurve.prototype = Object.create(THREE.Curve.prototype);\r\nTHREE.QuadraticBezierCurve.prototype.constructor = THREE.QuadraticBezierCurve;\r\n\r\n\r\nTHREE.QuadraticBezierCurve.prototype.getPoint = function(t) {\r\n\r\n  var vector = new THREE.Vector2();\r\n\r\n  vector.x = THREE.Shape.Utils.b2(t, this.v0.x, this.v1.x, this.v2.x);\r\n  vector.y = THREE.Shape.Utils.b2(t, this.v0.y, this.v1.y, this.v2.y);\r\n\r\n  return vector;\r\n\r\n};\r\n\r\n\r\nTHREE.QuadraticBezierCurve.prototype.getTangent = function(t) {\r\n\r\n  var vector = new THREE.Vector2();\r\n\r\n  vector.x = THREE.Curve.Utils.tangentQuadraticBezier(t, this.v0.x, this.v1.x, this.v2.x);\r\n  vector.y = THREE.Curve.Utils.tangentQuadraticBezier(t, this.v0.y, this.v1.y, this.v2.y);\r\n\r\n  // returns unit vector\r\n\r\n  return vector.normalize();\r\n\r\n};\r\n\r\n// File:src/extras/curves/CubicBezierCurve.js\r\n\r\n/**************************************************************\r\n *\tCubic Bezier curve\r\n **************************************************************/\r\n\r\nTHREE.CubicBezierCurve = function(v0, v1, v2, v3) {\r\n\r\n  this.v0 = v0;\r\n  this.v1 = v1;\r\n  this.v2 = v2;\r\n  this.v3 = v3;\r\n\r\n};\r\n\r\nTHREE.CubicBezierCurve.prototype = Object.create(THREE.Curve.prototype);\r\nTHREE.CubicBezierCurve.prototype.constructor = THREE.CubicBezierCurve;\r\n\r\nTHREE.CubicBezierCurve.prototype.getPoint = function(t) {\r\n\r\n  var tx, ty;\r\n\r\n  tx = THREE.Shape.Utils.b3(t, this.v0.x, this.v1.x, this.v2.x, this.v3.x);\r\n  ty = THREE.Shape.Utils.b3(t, this.v0.y, this.v1.y, this.v2.y, this.v3.y);\r\n\r\n  return new THREE.Vector2(tx, ty);\r\n\r\n};\r\n\r\nTHREE.CubicBezierCurve.prototype.getTangent = function(t) {\r\n\r\n  var tx, ty;\r\n\r\n  tx = THREE.Curve.Utils.tangentCubicBezier(t, this.v0.x, this.v1.x, this.v2.x, this.v3.x);\r\n  ty = THREE.Curve.Utils.tangentCubicBezier(t, this.v0.y, this.v1.y, this.v2.y, this.v3.y);\r\n\r\n  var tangent = new THREE.Vector2(tx, ty);\r\n  tangent.normalize();\r\n\r\n  return tangent;\r\n\r\n};\r\n\r\n// File:src/extras/curves/SplineCurve.js\r\n\r\n/**************************************************************\r\n *\tSpline curve\r\n **************************************************************/\r\n\r\nTHREE.SplineCurve = function(points /* array of Vector2 */ ) {\r\n\r\n  this.points = (points == undefined) ? [] : points;\r\n\r\n};\r\n\r\nTHREE.SplineCurve.prototype = Object.create(THREE.Curve.prototype);\r\nTHREE.SplineCurve.prototype.constructor = THREE.SplineCurve;\r\n\r\nTHREE.SplineCurve.prototype.getPoint = function(t) {\r\n\r\n  var points = this.points;\r\n  var point = (points.length - 1) * t;\r\n\r\n  var intPoint = Math.floor(point);\r\n  var weight = point - intPoint;\r\n\r\n  var point0 = points[intPoint == 0 ? intPoint : intPoint - 1]\r\n  var point1 = points[intPoint]\r\n  var point2 = points[intPoint > points.length - 2 ? points.length - 1 : intPoint + 1]\r\n  var point3 = points[intPoint > points.length - 3 ? points.length - 1 : intPoint + 2]\r\n\r\n  var vector = new THREE.Vector2();\r\n\r\n  vector.x = THREE.Curve.Utils.interpolate(point0.x, point1.x, point2.x, point3.x, weight);\r\n  vector.y = THREE.Curve.Utils.interpolate(point0.y, point1.y, point2.y, point3.y, weight);\r\n\r\n  return vector;\r\n\r\n};\r\n\r\n// File:src/extras/curves/EllipseCurve.js\r\n\r\n/**************************************************************\r\n *\tEllipse curve\r\n **************************************************************/\r\n\r\nTHREE.EllipseCurve = function(aX, aY, xRadius, yRadius, aStartAngle, aEndAngle, aClockwise) {\r\n\r\n  this.aX = aX;\r\n  this.aY = aY;\r\n\r\n  this.xRadius = xRadius;\r\n  this.yRadius = yRadius;\r\n\r\n  this.aStartAngle = aStartAngle;\r\n  this.aEndAngle = aEndAngle;\r\n\r\n  this.aClockwise = aClockwise;\r\n\r\n};\r\n\r\nTHREE.EllipseCurve.prototype = Object.create(THREE.Curve.prototype);\r\nTHREE.EllipseCurve.prototype.constructor = THREE.EllipseCurve;\r\n\r\nTHREE.EllipseCurve.prototype.getPoint = function(t) {\r\n\r\n  var deltaAngle = this.aEndAngle - this.aStartAngle;\r\n\r\n  if (deltaAngle < 0) deltaAngle += Math.PI * 2;\r\n  if (deltaAngle > Math.PI * 2) deltaAngle -= Math.PI * 2;\r\n\r\n  var angle;\r\n\r\n  if (this.aClockwise === true) {\r\n\r\n    angle = this.aEndAngle + (1 - t) * (Math.PI * 2 - deltaAngle);\r\n\r\n  }\r\n  else {\r\n\r\n    angle = this.aStartAngle + t * deltaAngle;\r\n\r\n  }\r\n\r\n  var vector = new THREE.Vector2();\r\n\r\n  vector.x = this.aX + this.xRadius * Math.cos(angle);\r\n  vector.y = this.aY + this.yRadius * Math.sin(angle);\r\n\r\n  return vector;\r\n\r\n};\r\n\r\n// File:src/extras/curves/ArcCurve.js\r\n\r\n/**************************************************************\r\n *\tArc curve\r\n **************************************************************/\r\n\r\nTHREE.ArcCurve = function(aX, aY, aRadius, aStartAngle, aEndAngle, aClockwise) {\r\n\r\n  THREE.EllipseCurve.call(this, aX, aY, aRadius, aRadius, aStartAngle, aEndAngle, aClockwise);\r\n};\r\n\r\nTHREE.ArcCurve.prototype = Object.create(THREE.EllipseCurve.prototype);\r\nTHREE.ArcCurve.prototype.constructor = THREE.ArcCurve;\r\n\r\n// File:src/extras/curves/LineCurve3.js\r\n\r\n/**************************************************************\r\n *\tLine3D\r\n **************************************************************/\r\n\r\nTHREE.LineCurve3 = THREE.Curve.create(\r\n\r\n  function(v1, v2) {\r\n\r\n    this.v1 = v1;\r\n    this.v2 = v2;\r\n\r\n  },\r\n\r\n  function(t) {\r\n\r\n    var vector = new THREE.Vector3();\r\n\r\n    vector.subVectors(this.v2, this.v1); // diff\r\n    vector.multiplyScalar(t);\r\n    vector.add(this.v1);\r\n\r\n    return vector;\r\n\r\n  }\r\n\r\n);\r\n\r\n// File:src/extras/curves/QuadraticBezierCurve3.js\r\n\r\n/**************************************************************\r\n *\tQuadratic Bezier 3D curve\r\n **************************************************************/\r\n\r\nTHREE.QuadraticBezierCurve3 = THREE.Curve.create(\r\n\r\n  function(v0, v1, v2) {\r\n\r\n    this.v0 = v0;\r\n    this.v1 = v1;\r\n    this.v2 = v2;\r\n\r\n  },\r\n\r\n  function(t) {\r\n\r\n    var vector = new THREE.Vector3();\r\n\r\n    vector.x = THREE.Shape.Utils.b2(t, this.v0.x, this.v1.x, this.v2.x);\r\n    vector.y = THREE.Shape.Utils.b2(t, this.v0.y, this.v1.y, this.v2.y);\r\n    vector.z = THREE.Shape.Utils.b2(t, this.v0.z, this.v1.z, this.v2.z);\r\n\r\n    return vector;\r\n\r\n  }\r\n\r\n);\r\n\r\n// File:src/extras/curves/CubicBezierCurve3.js\r\n\r\n/**************************************************************\r\n *\tCubic Bezier 3D curve\r\n **************************************************************/\r\n\r\nTHREE.CubicBezierCurve3 = THREE.Curve.create(\r\n\r\n  function(v0, v1, v2, v3) {\r\n\r\n    this.v0 = v0;\r\n    this.v1 = v1;\r\n    this.v2 = v2;\r\n    this.v3 = v3;\r\n\r\n  },\r\n\r\n  function(t) {\r\n\r\n    var vector = new THREE.Vector3();\r\n\r\n    vector.x = THREE.Shape.Utils.b3(t, this.v0.x, this.v1.x, this.v2.x, this.v3.x);\r\n    vector.y = THREE.Shape.Utils.b3(t, this.v0.y, this.v1.y, this.v2.y, this.v3.y);\r\n    vector.z = THREE.Shape.Utils.b3(t, this.v0.z, this.v1.z, this.v2.z, this.v3.z);\r\n\r\n    return vector;\r\n\r\n  }\r\n\r\n);\r\n\r\n// File:src/extras/curves/SplineCurve3.js\r\n\r\n/**************************************************************\r\n *\tSpline 3D curve\r\n **************************************************************/\r\n\r\n\r\nTHREE.SplineCurve3 = THREE.Curve.create(\r\n\r\n  function(points /* array of Vector3 */ ) {\r\n\r\n    this.points = (points == undefined) ? [] : points;\r\n\r\n  },\r\n\r\n  function(t) {\r\n\r\n    var points = this.points;\r\n    var point = (points.length - 1) * t;\r\n\r\n    var intPoint = Math.floor(point);\r\n    var weight = point - intPoint;\r\n\r\n    var point0 = points[intPoint == 0 ? intPoint : intPoint - 1];\r\n    var point1 = points[intPoint];\r\n    var point2 = points[intPoint > points.length - 2 ? points.length - 1 : intPoint + 1];\r\n    var point3 = points[intPoint > points.length - 3 ? points.length - 1 : intPoint + 2];\r\n\r\n    var vector = new THREE.Vector3();\r\n\r\n    vector.x = THREE.Curve.Utils.interpolate(point0.x, point1.x, point2.x, point3.x, weight);\r\n    vector.y = THREE.Curve.Utils.interpolate(point0.y, point1.y, point2.y, point3.y, weight);\r\n    vector.z = THREE.Curve.Utils.interpolate(point0.z, point1.z, point2.z, point3.z, weight);\r\n\r\n    return vector;\r\n\r\n  }\r\n\r\n);\r\n\r\n// File:src/extras/curves/ClosedSplineCurve3.js\r\n\r\n/**************************************************************\r\n *\tClosed Spline 3D curve\r\n **************************************************************/\r\n\r\n\r\nTHREE.ClosedSplineCurve3 = THREE.Curve.create(\r\n\r\n  function(points /* array of Vector3 */ ) {\r\n\r\n    this.points = (points == undefined) ? [] : points;\r\n\r\n  },\r\n\r\n  function(t) {\r\n\r\n    var points = this.points;\r\n    var point = (points.length - 0) * t; // This needs to be from 0-length +1\r\n\r\n    var intPoint = Math.floor(point);\r\n    var weight = point - intPoint;\r\n\r\n    intPoint += intPoint > 0 ? 0 : (Math.floor(Math.abs(intPoint) / points.length) + 1) * points.length;\r\n\r\n    var point0 = points[(intPoint - 1) % points.length];\r\n    var point1 = points[(intPoint) % points.length];\r\n    var point2 = points[(intPoint + 1) % points.length];\r\n    var point3 = points[(intPoint + 2) % points.length];\r\n\r\n    var vector = new THREE.Vector3();\r\n\r\n    vector.x = THREE.Curve.Utils.interpolate(point0.x, point1.x, point2.x, point3.x, weight);\r\n    vector.y = THREE.Curve.Utils.interpolate(point0.y, point1.y, point2.y, point3.y, weight);\r\n    vector.z = THREE.Curve.Utils.interpolate(point0.z, point1.z, point2.z, point3.z, weight);\r\n\r\n    return vector;\r\n\r\n  }\r\n\r\n);\r\n\r\n// File:src/extras/animation/AnimationHandler.js\r\n\r\n/**\r\n * @author mikael emtinger / http://gomo.se/\r\n */\r\n\r\nTHREE.AnimationHandler = {\r\n\r\n  LINEAR: 0,\r\n  CATMULLROM: 1,\r\n  CATMULLROM_FORWARD: 2,\r\n\r\n  //\r\n\r\n  add: function() {\r\n    THREE.warn('THREE.AnimationHandler.add() has been deprecated.');\r\n  },\r\n  get: function() {\r\n    THREE.warn('THREE.AnimationHandler.get() has been deprecated.');\r\n  },\r\n  remove: function() {\r\n    THREE.warn('THREE.AnimationHandler.remove() has been deprecated.');\r\n  },\r\n\r\n  //\r\n\r\n  animations: [],\r\n\r\n  init: function(data) {\r\n\r\n    if (data.initialized === true) return data;\r\n\r\n    // loop through all keys\r\n\r\n    for (var h = 0; h < data.hierarchy.length; h++) {\r\n\r\n      for (var k = 0; k < data.hierarchy[h].keys.length; k++) {\r\n\r\n        // remove minus times\r\n\r\n        if (data.hierarchy[h].keys[k].time < 0) {\r\n\r\n          data.hierarchy[h].keys[k].time = 0;\r\n\r\n        }\r\n\r\n        // create quaternions\r\n\r\n        if (data.hierarchy[h].keys[k].rot !== undefined &&\r\n          !(data.hierarchy[h].keys[k].rot instanceof THREE.Quaternion)) {\r\n\r\n          var quat = data.hierarchy[h].keys[k].rot;\r\n          data.hierarchy[h].keys[k].rot = new THREE.Quaternion().fromArray(quat);\r\n\r\n        }\r\n\r\n      }\r\n\r\n      // prepare morph target keys\r\n\r\n      if (data.hierarchy[h].keys.length && data.hierarchy[h].keys[0].morphTargets !== undefined) {\r\n\r\n        // get all used\r\n\r\n        var usedMorphTargets = {};\r\n\r\n        for (var k = 0; k < data.hierarchy[h].keys.length; k++) {\r\n\r\n          for (var m = 0; m < data.hierarchy[h].keys[k].morphTargets.length; m++) {\r\n\r\n            var morphTargetName = data.hierarchy[h].keys[k].morphTargets[m];\r\n            usedMorphTargets[morphTargetName] = -1;\r\n\r\n          }\r\n\r\n        }\r\n\r\n        data.hierarchy[h].usedMorphTargets = usedMorphTargets;\r\n\r\n\r\n        // set all used on all frames\r\n\r\n        for (var k = 0; k < data.hierarchy[h].keys.length; k++) {\r\n\r\n          var influences = {};\r\n\r\n          for (var morphTargetName in usedMorphTargets) {\r\n\r\n            for (var m = 0; m < data.hierarchy[h].keys[k].morphTargets.length; m++) {\r\n\r\n              if (data.hierarchy[h].keys[k].morphTargets[m] === morphTargetName) {\r\n\r\n                influences[morphTargetName] = data.hierarchy[h].keys[k].morphTargetsInfluences[m];\r\n                break;\r\n\r\n              }\r\n\r\n            }\r\n\r\n            if (m === data.hierarchy[h].keys[k].morphTargets.length) {\r\n\r\n              influences[morphTargetName] = 0;\r\n\r\n            }\r\n\r\n          }\r\n\r\n          data.hierarchy[h].keys[k].morphTargetsInfluences = influences;\r\n\r\n        }\r\n\r\n      }\r\n\r\n\r\n      // remove all keys that are on the same time\r\n\r\n      for (var k = 1; k < data.hierarchy[h].keys.length; k++) {\r\n\r\n        if (data.hierarchy[h].keys[k].time === data.hierarchy[h].keys[k - 1].time) {\r\n\r\n          data.hierarchy[h].keys.splice(k, 1);\r\n          k--;\r\n\r\n        }\r\n\r\n      }\r\n\r\n\r\n      // set index\r\n\r\n      for (var k = 0; k < data.hierarchy[h].keys.length; k++) {\r\n\r\n        data.hierarchy[h].keys[k].index = k;\r\n\r\n      }\r\n\r\n    }\r\n\r\n    data.initialized = true;\r\n\r\n    return data;\r\n\r\n  },\r\n\r\n  parse: function(root) {\r\n\r\n    var parseRecurseHierarchy = function(root, hierarchy) {\r\n\r\n      hierarchy.push(root);\r\n\r\n      for (var c = 0; c < root.children.length; c++)\r\n        parseRecurseHierarchy(root.children[c], hierarchy);\r\n\r\n    };\r\n\r\n    // setup hierarchy\r\n\r\n    var hierarchy = [];\r\n\r\n    if (root instanceof THREE.SkinnedMesh) {\r\n\r\n      for (var b = 0; b < root.skeleton.bones.length; b++) {\r\n\r\n        hierarchy.push(root.skeleton.bones[b]);\r\n\r\n      }\r\n\r\n    }\r\n    else {\r\n\r\n      parseRecurseHierarchy(root, hierarchy);\r\n\r\n    }\r\n\r\n    return hierarchy;\r\n\r\n  },\r\n\r\n  play: function(animation) {\r\n\r\n    if (this.animations.indexOf(animation) === -1) {\r\n\r\n      this.animations.push(animation);\r\n\r\n    }\r\n\r\n  },\r\n\r\n  stop: function(animation) {\r\n\r\n    var index = this.animations.indexOf(animation);\r\n\r\n    if (index !== -1) {\r\n\r\n      this.animations.splice(index, 1);\r\n\r\n    }\r\n\r\n  },\r\n\r\n  update: function(deltaTimeMS) {\r\n\r\n    for (var i = 0; i < this.animations.length; i++) {\r\n\r\n      this.animations[i].resetBlendWeights();\r\n\r\n    }\r\n\r\n    for (var i = 0; i < this.animations.length; i++) {\r\n\r\n      this.animations[i].update(deltaTimeMS);\r\n\r\n    }\r\n\r\n  }\r\n\r\n};\r\n\r\n// File:src/extras/animation/Animation.js\r\n\r\n/**\r\n * @author mikael emtinger / http://gomo.se/\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author alteredq / http://alteredqualia.com/\r\n */\r\n\r\nTHREE.Animation = function(root, data) {\r\n\r\n  this.root = root;\r\n  this.data = THREE.AnimationHandler.init(data);\r\n  this.hierarchy = THREE.AnimationHandler.parse(root);\r\n\r\n  this.currentTime = 0;\r\n  this.timeScale = 1;\r\n\r\n  this.isPlaying = false;\r\n  this.loop = true;\r\n  this.weight = 0;\r\n\r\n  this.interpolationType = THREE.AnimationHandler.LINEAR;\r\n\r\n};\r\n\r\nTHREE.Animation.prototype = {\r\n\r\n  constructor: THREE.Animation,\r\n\r\n  keyTypes: [\"pos\", \"rot\", \"scl\"],\r\n\r\n  play: function(startTime, weight) {\r\n\r\n    this.currentTime = startTime !== undefined ? startTime : 0;\r\n    this.weight = weight !== undefined ? weight : 1;\r\n\r\n    this.isPlaying = true;\r\n\r\n    this.reset();\r\n\r\n    THREE.AnimationHandler.play(this);\r\n\r\n  },\r\n\r\n  stop: function() {\r\n\r\n    this.isPlaying = false;\r\n\r\n    THREE.AnimationHandler.stop(this);\r\n\r\n  },\r\n\r\n  reset: function() {\r\n\r\n    for (var h = 0, hl = this.hierarchy.length; h < hl; h++) {\r\n\r\n      var object = this.hierarchy[h];\r\n\r\n      if (object.animationCache === undefined) {\r\n\r\n        object.animationCache = {\r\n          animations: {},\r\n          blending: {\r\n            positionWeight: 0.0,\r\n            quaternionWeight: 0.0,\r\n            scaleWeight: 0.0\r\n          }\r\n        };\r\n      }\r\n\r\n      var name = this.data.name;\r\n      var animations = object.animationCache.animations;\r\n      var animationCache = animations[name];\r\n\r\n      if (animationCache === undefined) {\r\n\r\n        animationCache = {\r\n          prevKey: {\r\n            pos: 0,\r\n            rot: 0,\r\n            scl: 0\r\n          },\r\n          nextKey: {\r\n            pos: 0,\r\n            rot: 0,\r\n            scl: 0\r\n          },\r\n          originalMatrix: object.matrix\r\n        };\r\n\r\n        animations[name] = animationCache;\r\n\r\n      }\r\n\r\n      // Get keys to match our current time\r\n\r\n      for (var t = 0; t < 3; t++) {\r\n\r\n        var type = this.keyTypes[t];\r\n\r\n        var prevKey = this.data.hierarchy[h].keys[0];\r\n        var nextKey = this.getNextKeyWith(type, h, 1);\r\n\r\n        while (nextKey.time < this.currentTime && nextKey.index > prevKey.index) {\r\n\r\n          prevKey = nextKey;\r\n          nextKey = this.getNextKeyWith(type, h, nextKey.index + 1);\r\n\r\n        }\r\n\r\n        animationCache.prevKey[type] = prevKey;\r\n        animationCache.nextKey[type] = nextKey;\r\n\r\n      }\r\n\r\n    }\r\n\r\n  },\r\n\r\n  resetBlendWeights: function() {\r\n\r\n    for (var h = 0, hl = this.hierarchy.length; h < hl; h++) {\r\n\r\n      var object = this.hierarchy[h];\r\n      var animationCache = object.animationCache;\r\n\r\n      if (animationCache !== undefined) {\r\n\r\n        var blending = animationCache.blending;\r\n\r\n        blending.positionWeight = 0.0;\r\n        blending.quaternionWeight = 0.0;\r\n        blending.scaleWeight = 0.0;\r\n\r\n      }\r\n\r\n    }\r\n\r\n  },\r\n\r\n  update: (function() {\r\n\r\n    var points = [];\r\n    var target = new THREE.Vector3();\r\n    var newVector = new THREE.Vector3();\r\n    var newQuat = new THREE.Quaternion();\r\n\r\n    // Catmull-Rom spline\r\n\r\n    var interpolateCatmullRom = function(points, scale) {\r\n\r\n      var c = [],\r\n        v3 = [],\r\n        point, intPoint, weight, w2, w3,\r\n        pa, pb, pc, pd;\r\n\r\n      point = (points.length - 1) * scale;\r\n      intPoint = Math.floor(point);\r\n      weight = point - intPoint;\r\n\r\n      c[0] = intPoint === 0 ? intPoint : intPoint - 1;\r\n      c[1] = intPoint;\r\n      c[2] = intPoint > points.length - 2 ? intPoint : intPoint + 1;\r\n      c[3] = intPoint > points.length - 3 ? intPoint : intPoint + 2;\r\n\r\n      pa = points[c[0]];\r\n      pb = points[c[1]];\r\n      pc = points[c[2]];\r\n      pd = points[c[3]];\r\n\r\n      w2 = weight * weight;\r\n      w3 = weight * w2;\r\n\r\n      v3[0] = interpolate(pa[0], pb[0], pc[0], pd[0], weight, w2, w3);\r\n      v3[1] = interpolate(pa[1], pb[1], pc[1], pd[1], weight, w2, w3);\r\n      v3[2] = interpolate(pa[2], pb[2], pc[2], pd[2], weight, w2, w3);\r\n\r\n      return v3;\r\n\r\n    };\r\n\r\n    var interpolate = function(p0, p1, p2, p3, t, t2, t3) {\r\n\r\n      var v0 = (p2 - p0) * 0.5,\r\n        v1 = (p3 - p1) * 0.5;\r\n\r\n      return (2 * (p1 - p2) + v0 + v1) * t3 + (-3 * (p1 - p2) - 2 * v0 - v1) * t2 + v0 * t + p1;\r\n\r\n    };\r\n\r\n    return function(delta) {\r\n\r\n      if (this.isPlaying === false) return;\r\n\r\n      this.currentTime += delta * this.timeScale;\r\n\r\n      if (this.weight === 0)\r\n        return;\r\n\r\n      //\r\n\r\n      var duration = this.data.length;\r\n\r\n      if (this.currentTime > duration || this.currentTime < 0) {\r\n\r\n        if (this.loop) {\r\n\r\n          this.currentTime %= duration;\r\n\r\n          if (this.currentTime < 0)\r\n            this.currentTime += duration;\r\n\r\n          this.reset();\r\n\r\n        }\r\n        else {\r\n\r\n          this.stop();\r\n\r\n        }\r\n\r\n      }\r\n\r\n      for (var h = 0, hl = this.hierarchy.length; h < hl; h++) {\r\n\r\n        var object = this.hierarchy[h];\r\n        var animationCache = object.animationCache.animations[this.data.name];\r\n        var blending = object.animationCache.blending;\r\n\r\n        // loop through pos/rot/scl\r\n\r\n        for (var t = 0; t < 3; t++) {\r\n\r\n          // get keys\r\n\r\n          var type = this.keyTypes[t];\r\n          var prevKey = animationCache.prevKey[type];\r\n          var nextKey = animationCache.nextKey[type];\r\n\r\n          if ((this.timeScale > 0 && nextKey.time <= this.currentTime) ||\r\n            (this.timeScale < 0 && prevKey.time >= this.currentTime)) {\r\n\r\n            prevKey = this.data.hierarchy[h].keys[0];\r\n            nextKey = this.getNextKeyWith(type, h, 1);\r\n\r\n            while (nextKey.time < this.currentTime && nextKey.index > prevKey.index) {\r\n\r\n              prevKey = nextKey;\r\n              nextKey = this.getNextKeyWith(type, h, nextKey.index + 1);\r\n\r\n            }\r\n\r\n            animationCache.prevKey[type] = prevKey;\r\n            animationCache.nextKey[type] = nextKey;\r\n\r\n          }\r\n\r\n          var scale = (this.currentTime - prevKey.time) / (nextKey.time - prevKey.time);\r\n\r\n          var prevXYZ = prevKey[type];\r\n          var nextXYZ = nextKey[type];\r\n\r\n          if (scale < 0) scale = 0;\r\n          if (scale > 1) scale = 1;\r\n\r\n          // interpolate\r\n\r\n          if (type === \"pos\") {\r\n\r\n            if (this.interpolationType === THREE.AnimationHandler.LINEAR) {\r\n\r\n              newVector.x = prevXYZ[0] + (nextXYZ[0] - prevXYZ[0]) * scale;\r\n              newVector.y = prevXYZ[1] + (nextXYZ[1] - prevXYZ[1]) * scale;\r\n              newVector.z = prevXYZ[2] + (nextXYZ[2] - prevXYZ[2]) * scale;\r\n\r\n              // blend\r\n              var proportionalWeight = this.weight / (this.weight + blending.positionWeight);\r\n              object.position.lerp(newVector, proportionalWeight);\r\n              blending.positionWeight += this.weight;\r\n\r\n            }\r\n            else if (this.interpolationType === THREE.AnimationHandler.CATMULLROM ||\r\n              this.interpolationType === THREE.AnimationHandler.CATMULLROM_FORWARD) {\r\n\r\n              points[0] = this.getPrevKeyWith(\"pos\", h, prevKey.index - 1)[\"pos\"];\r\n              points[1] = prevXYZ;\r\n              points[2] = nextXYZ;\r\n              points[3] = this.getNextKeyWith(\"pos\", h, nextKey.index + 1)[\"pos\"];\r\n\r\n              scale = scale * 0.33 + 0.33;\r\n\r\n              var currentPoint = interpolateCatmullRom(points, scale);\r\n              var proportionalWeight = this.weight / (this.weight + blending.positionWeight);\r\n              blending.positionWeight += this.weight;\r\n\r\n              // blend\r\n\r\n              var vector = object.position;\r\n\r\n              vector.x = vector.x + (currentPoint[0] - vector.x) * proportionalWeight;\r\n              vector.y = vector.y + (currentPoint[1] - vector.y) * proportionalWeight;\r\n              vector.z = vector.z + (currentPoint[2] - vector.z) * proportionalWeight;\r\n\r\n              if (this.interpolationType === THREE.AnimationHandler.CATMULLROM_FORWARD) {\r\n\r\n                var forwardPoint = interpolateCatmullRom(points, scale * 1.01);\r\n\r\n                target.set(forwardPoint[0], forwardPoint[1], forwardPoint[2]);\r\n                target.sub(vector);\r\n                target.y = 0;\r\n                target.normalize();\r\n\r\n                var angle = Math.atan2(target.x, target.z);\r\n                object.rotation.set(0, angle, 0);\r\n\r\n              }\r\n\r\n            }\r\n\r\n          }\r\n          else if (type === \"rot\") {\r\n\r\n            THREE.Quaternion.slerp(prevXYZ, nextXYZ, newQuat, scale);\r\n\r\n            // Avoid paying the cost of an additional slerp if we don't have to\r\n            if (blending.quaternionWeight === 0) {\r\n\r\n              object.quaternion.copy(newQuat);\r\n              blending.quaternionWeight = this.weight;\r\n\r\n            }\r\n            else {\r\n\r\n              var proportionalWeight = this.weight / (this.weight + blending.quaternionWeight);\r\n              THREE.Quaternion.slerp(object.quaternion, newQuat, object.quaternion, proportionalWeight);\r\n              blending.quaternionWeight += this.weight;\r\n\r\n            }\r\n\r\n          }\r\n          else if (type === \"scl\") {\r\n\r\n            newVector.x = prevXYZ[0] + (nextXYZ[0] - prevXYZ[0]) * scale;\r\n            newVector.y = prevXYZ[1] + (nextXYZ[1] - prevXYZ[1]) * scale;\r\n            newVector.z = prevXYZ[2] + (nextXYZ[2] - prevXYZ[2]) * scale;\r\n\r\n            var proportionalWeight = this.weight / (this.weight + blending.scaleWeight);\r\n            object.scale.lerp(newVector, proportionalWeight);\r\n            blending.scaleWeight += this.weight;\r\n\r\n          }\r\n\r\n        }\r\n\r\n      }\r\n\r\n      return true;\r\n\r\n    };\r\n\r\n  })(),\r\n\r\n  getNextKeyWith: function(type, h, key) {\r\n\r\n    var keys = this.data.hierarchy[h].keys;\r\n\r\n    if (this.interpolationType === THREE.AnimationHandler.CATMULLROM ||\r\n      this.interpolationType === THREE.AnimationHandler.CATMULLROM_FORWARD) {\r\n\r\n      key = key < keys.length - 1 ? key : keys.length - 1;\r\n\r\n    }\r\n    else {\r\n\r\n      key = key % keys.length;\r\n\r\n    }\r\n\r\n    for (; key < keys.length; key++) {\r\n\r\n      if (keys[key][type] !== undefined) {\r\n\r\n        return keys[key];\r\n\r\n      }\r\n\r\n    }\r\n\r\n    return this.data.hierarchy[h].keys[0];\r\n\r\n  },\r\n\r\n  getPrevKeyWith: function(type, h, key) {\r\n\r\n    var keys = this.data.hierarchy[h].keys;\r\n\r\n    if (this.interpolationType === THREE.AnimationHandler.CATMULLROM ||\r\n      this.interpolationType === THREE.AnimationHandler.CATMULLROM_FORWARD) {\r\n\r\n      key = key > 0 ? key : 0;\r\n\r\n    }\r\n    else {\r\n\r\n      key = key >= 0 ? key : key + keys.length;\r\n\r\n    }\r\n\r\n\r\n    for (; key >= 0; key--) {\r\n\r\n      if (keys[key][type] !== undefined) {\r\n\r\n        return keys[key];\r\n\r\n      }\r\n\r\n    }\r\n\r\n    return this.data.hierarchy[h].keys[keys.length - 1];\r\n\r\n  }\r\n\r\n};\r\n\r\n// File:src/extras/animation/KeyFrameAnimation.js\r\n\r\n/**\r\n * @author mikael emtinger / http://gomo.se/\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author alteredq / http://alteredqualia.com/\r\n * @author khang duong\r\n * @author erik kitson\r\n */\r\n\r\nTHREE.KeyFrameAnimation = function(data) {\r\n\r\n  this.root = data.node;\r\n  this.data = THREE.AnimationHandler.init(data);\r\n  this.hierarchy = THREE.AnimationHandler.parse(this.root);\r\n  this.currentTime = 0;\r\n  this.timeScale = 0.001;\r\n  this.isPlaying = false;\r\n  this.isPaused = true;\r\n  this.loop = true;\r\n\r\n  // initialize to first keyframes\r\n\r\n  for (var h = 0, hl = this.hierarchy.length; h < hl; h++) {\r\n\r\n    var keys = this.data.hierarchy[h].keys,\r\n      sids = this.data.hierarchy[h].sids,\r\n      obj = this.hierarchy[h];\r\n\r\n    if (keys.length && sids) {\r\n\r\n      for (var s = 0; s < sids.length; s++) {\r\n\r\n        var sid = sids[s],\r\n          next = this.getNextKeyWith(sid, h, 0);\r\n\r\n        if (next) {\r\n\r\n          next.apply(sid);\r\n\r\n        }\r\n\r\n      }\r\n\r\n      obj.matrixAutoUpdate = false;\r\n      this.data.hierarchy[h].node.updateMatrix();\r\n      obj.matrixWorldNeedsUpdate = true;\r\n\r\n    }\r\n\r\n  }\r\n\r\n};\r\n\r\nTHREE.KeyFrameAnimation.prototype = {\r\n\r\n  constructor: THREE.KeyFrameAnimation,\r\n\r\n  play: function(startTime) {\r\n\r\n    this.currentTime = startTime !== undefined ? startTime : 0;\r\n\r\n    if (this.isPlaying === false) {\r\n\r\n      this.isPlaying = true;\r\n\r\n      // reset key cache\r\n\r\n      var h, hl = this.hierarchy.length,\r\n        object,\r\n        node;\r\n\r\n      for (h = 0; h < hl; h++) {\r\n\r\n        object = this.hierarchy[h];\r\n        node = this.data.hierarchy[h];\r\n\r\n        if (node.animationCache === undefined) {\r\n\r\n          node.animationCache = {};\r\n          node.animationCache.prevKey = null;\r\n          node.animationCache.nextKey = null;\r\n          node.animationCache.originalMatrix = object.matrix;\r\n\r\n        }\r\n\r\n        var keys = this.data.hierarchy[h].keys;\r\n\r\n        if (keys.length) {\r\n\r\n          node.animationCache.prevKey = keys[0];\r\n          node.animationCache.nextKey = keys[1];\r\n\r\n          this.startTime = Math.min(keys[0].time, this.startTime);\r\n          this.endTime = Math.max(keys[keys.length - 1].time, this.endTime);\r\n\r\n        }\r\n\r\n      }\r\n\r\n      this.update(0);\r\n\r\n    }\r\n\r\n    this.isPaused = false;\r\n\r\n    THREE.AnimationHandler.play(this);\r\n\r\n  },\r\n\r\n  stop: function() {\r\n\r\n    this.isPlaying = false;\r\n    this.isPaused = false;\r\n\r\n    THREE.AnimationHandler.stop(this);\r\n\r\n    // reset JIT matrix and remove cache\r\n\r\n    for (var h = 0; h < this.data.hierarchy.length; h++) {\r\n\r\n      var obj = this.hierarchy[h];\r\n      var node = this.data.hierarchy[h];\r\n\r\n      if (node.animationCache !== undefined) {\r\n\r\n        var original = node.animationCache.originalMatrix;\r\n\r\n        original.copy(obj.matrix);\r\n        obj.matrix = original;\r\n\r\n        delete node.animationCache;\r\n\r\n      }\r\n\r\n    }\r\n\r\n  },\r\n\r\n  update: function(delta) {\r\n\r\n    if (this.isPlaying === false) return;\r\n\r\n    this.currentTime += delta * this.timeScale;\r\n\r\n    //\r\n\r\n    var duration = this.data.length;\r\n\r\n    if (this.loop === true && this.currentTime > duration) {\r\n\r\n      this.currentTime %= duration;\r\n\r\n    }\r\n\r\n    this.currentTime = Math.min(this.currentTime, duration);\r\n\r\n    for (var h = 0, hl = this.hierarchy.length; h < hl; h++) {\r\n\r\n      var object = this.hierarchy[h];\r\n      var node = this.data.hierarchy[h];\r\n\r\n      var keys = node.keys,\r\n        animationCache = node.animationCache;\r\n\r\n\r\n      if (keys.length) {\r\n\r\n        var prevKey = animationCache.prevKey;\r\n        var nextKey = animationCache.nextKey;\r\n\r\n        if (nextKey.time <= this.currentTime) {\r\n\r\n          while (nextKey.time < this.currentTime && nextKey.index > prevKey.index) {\r\n\r\n            prevKey = nextKey;\r\n            nextKey = keys[prevKey.index + 1];\r\n\r\n          }\r\n\r\n          animationCache.prevKey = prevKey;\r\n          animationCache.nextKey = nextKey;\r\n\r\n        }\r\n\r\n        if (nextKey.time >= this.currentTime) {\r\n\r\n          prevKey.interpolate(nextKey, this.currentTime);\r\n\r\n        }\r\n        else {\r\n\r\n          prevKey.interpolate(nextKey, nextKey.time);\r\n\r\n        }\r\n\r\n        this.data.hierarchy[h].node.updateMatrix();\r\n        object.matrixWorldNeedsUpdate = true;\r\n\r\n      }\r\n\r\n    }\r\n\r\n  },\r\n\r\n  getNextKeyWith: function(sid, h, key) {\r\n\r\n    var keys = this.data.hierarchy[h].keys;\r\n    key = key % keys.length;\r\n\r\n    for (; key < keys.length; key++) {\r\n\r\n      if (keys[key].hasTarget(sid)) {\r\n\r\n        return keys[key];\r\n\r\n      }\r\n\r\n    }\r\n\r\n    return keys[0];\r\n\r\n  },\r\n\r\n  getPrevKeyWith: function(sid, h, key) {\r\n\r\n    var keys = this.data.hierarchy[h].keys;\r\n    key = key >= 0 ? key : key + keys.length;\r\n\r\n    for (; key >= 0; key--) {\r\n\r\n      if (keys[key].hasTarget(sid)) {\r\n\r\n        return keys[key];\r\n\r\n      }\r\n\r\n    }\r\n\r\n    return keys[keys.length - 1];\r\n\r\n  }\r\n\r\n};\r\n\r\n// File:src/extras/animation/MorphAnimation.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com\r\n * @author willy-vvu / http://willy-vvu.github.io\r\n */\r\n\r\nTHREE.MorphAnimation = function(mesh) {\r\n\r\n  this.mesh = mesh;\r\n  this.frames = mesh.morphTargetInfluences.length;\r\n  this.currentTime = 0;\r\n  this.duration = 1000;\r\n  this.loop = true;\r\n  this.lastFrame = 0;\r\n  this.currentFrame = 0;\r\n\r\n  this.isPlaying = false;\r\n\r\n};\r\n\r\nTHREE.MorphAnimation.prototype = {\r\n\r\n  constructor: THREE.MorphAnimation,\r\n\r\n  play: function() {\r\n\r\n    this.isPlaying = true;\r\n\r\n  },\r\n\r\n  pause: function() {\r\n\r\n    this.isPlaying = false;\r\n\r\n  },\r\n\r\n  update: function(delta) {\r\n\r\n    if (this.isPlaying === false) return;\r\n\r\n    this.currentTime += delta;\r\n\r\n    if (this.loop === true && this.currentTime > this.duration) {\r\n\r\n      this.currentTime %= this.duration;\r\n\r\n    }\r\n\r\n    this.currentTime = Math.min(this.currentTime, this.duration);\r\n\r\n    var interpolation = this.duration / this.frames;\r\n    var frame = Math.floor(this.currentTime / interpolation);\r\n\r\n    var influences = this.mesh.morphTargetInfluences;\r\n\r\n    if (frame != this.currentFrame) {\r\n\r\n      influences[this.lastFrame] = 0;\r\n      influences[this.currentFrame] = 1;\r\n      influences[frame] = 0;\r\n\r\n      this.lastFrame = this.currentFrame;\r\n      this.currentFrame = frame;\r\n\r\n    }\r\n\r\n    influences[frame] = (this.currentTime % interpolation) / interpolation;\r\n    influences[this.lastFrame] = 1 - influences[frame];\r\n\r\n  }\r\n\r\n};\r\n\r\n// File:src/extras/geometries/BoxGeometry.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * based on http://papervision3d.googlecode.com/svn/trunk/as3/trunk/src/org/papervision3d/objects/primitives/Cube.as\r\n */\r\n\r\nTHREE.BoxGeometry = function(width, height, depth, widthSegments, heightSegments, depthSegments) {\r\n\r\n  THREE.Geometry.call(this);\r\n\r\n  this.type = 'BoxGeometry';\r\n\r\n  this.parameters = {\r\n    width: width,\r\n    height: height,\r\n    depth: depth,\r\n    widthSegments: widthSegments,\r\n    heightSegments: heightSegments,\r\n    depthSegments: depthSegments\r\n  };\r\n\r\n  this.widthSegments = widthSegments || 1;\r\n  this.heightSegments = heightSegments || 1;\r\n  this.depthSegments = depthSegments || 1;\r\n\r\n  var scope = this;\r\n\r\n  var width_half = width / 2;\r\n  var height_half = height / 2;\r\n  var depth_half = depth / 2;\r\n\r\n  buildPlane('z', 'y', -1, -1, depth, height, width_half, 0); // px\r\n  buildPlane('z', 'y', 1, -1, depth, height, -width_half, 1); // nx\r\n  buildPlane('x', 'z', 1, 1, width, depth, height_half, 2); // py\r\n  buildPlane('x', 'z', 1, -1, width, depth, -height_half, 3); // ny\r\n  buildPlane('x', 'y', 1, -1, width, height, depth_half, 4); // pz\r\n  buildPlane('x', 'y', -1, -1, width, height, -depth_half, 5); // nz\r\n\r\n  function buildPlane(u, v, udir, vdir, width, height, depth, materialIndex) {\r\n\r\n    var w, ix, iy,\r\n      gridX = scope.widthSegments,\r\n      gridY = scope.heightSegments,\r\n      width_half = width / 2,\r\n      height_half = height / 2,\r\n      offset = scope.vertices.length;\r\n\r\n    if ((u === 'x' && v === 'y') || (u === 'y' && v === 'x')) {\r\n\r\n      w = 'z';\r\n\r\n    }\r\n    else if ((u === 'x' && v === 'z') || (u === 'z' && v === 'x')) {\r\n\r\n      w = 'y';\r\n      gridY = scope.depthSegments;\r\n\r\n    }\r\n    else if ((u === 'z' && v === 'y') || (u === 'y' && v === 'z')) {\r\n\r\n      w = 'x';\r\n      gridX = scope.depthSegments;\r\n\r\n    }\r\n\r\n    var gridX1 = gridX + 1,\r\n      gridY1 = gridY + 1,\r\n      segment_width = width / gridX,\r\n      segment_height = height / gridY,\r\n      normal = new THREE.Vector3();\r\n\r\n    normal[w] = depth > 0 ? 1 : -1;\r\n\r\n    for (iy = 0; iy < gridY1; iy++) {\r\n\r\n      for (ix = 0; ix < gridX1; ix++) {\r\n\r\n        var vector = new THREE.Vector3();\r\n        vector[u] = (ix * segment_width - width_half) * udir;\r\n        vector[v] = (iy * segment_height - height_half) * vdir;\r\n        vector[w] = depth;\r\n\r\n        scope.vertices.push(vector);\r\n\r\n      }\r\n\r\n    }\r\n\r\n    for (iy = 0; iy < gridY; iy++) {\r\n\r\n      for (ix = 0; ix < gridX; ix++) {\r\n\r\n        var a = ix + gridX1 * iy;\r\n        var b = ix + gridX1 * (iy + 1);\r\n        var c = (ix + 1) + gridX1 * (iy + 1);\r\n        var d = (ix + 1) + gridX1 * iy;\r\n\r\n        var uva = new THREE.Vector2(ix / gridX, 1 - iy / gridY);\r\n        var uvb = new THREE.Vector2(ix / gridX, 1 - (iy + 1) / gridY);\r\n        var uvc = new THREE.Vector2((ix + 1) / gridX, 1 - (iy + 1) / gridY);\r\n        var uvd = new THREE.Vector2((ix + 1) / gridX, 1 - iy / gridY);\r\n\r\n        var face = new THREE.Face3(a + offset, b + offset, d + offset);\r\n        face.normal.copy(normal);\r\n        face.vertexNormals.push(normal.clone(), normal.clone(), normal.clone());\r\n        face.materialIndex = materialIndex;\r\n\r\n        scope.faces.push(face);\r\n        scope.faceVertexUvs[0].push([uva, uvb, uvd]);\r\n\r\n        face = new THREE.Face3(b + offset, c + offset, d + offset);\r\n        face.normal.copy(normal);\r\n        face.vertexNormals.push(normal.clone(), normal.clone(), normal.clone());\r\n        face.materialIndex = materialIndex;\r\n\r\n        scope.faces.push(face);\r\n        scope.faceVertexUvs[0].push([uvb.clone(), uvc, uvd.clone()]);\r\n\r\n      }\r\n\r\n    }\r\n\r\n  }\r\n\r\n  this.mergeVertices();\r\n\r\n};\r\n\r\nTHREE.BoxGeometry.prototype = Object.create(THREE.Geometry.prototype);\r\nTHREE.BoxGeometry.prototype.constructor = THREE.BoxGeometry;\r\n\r\n// File:src/extras/geometries/CircleGeometry.js\r\n\r\n/**\r\n * @author hughes\r\n */\r\n\r\nTHREE.CircleGeometry = function(radius, segments, thetaStart, thetaLength) {\r\n\r\n  THREE.Geometry.call(this);\r\n\r\n  this.type = 'CircleGeometry';\r\n\r\n  this.parameters = {\r\n    radius: radius,\r\n    segments: segments,\r\n    thetaStart: thetaStart,\r\n    thetaLength: thetaLength\r\n  };\r\n\r\n  radius = radius || 50;\r\n  segments = segments !== undefined ? Math.max(3, segments) : 8;\r\n\r\n  thetaStart = thetaStart !== undefined ? thetaStart : 0;\r\n  thetaLength = thetaLength !== undefined ? thetaLength : Math.PI * 2;\r\n\r\n  var i, uvs = [],\r\n    center = new THREE.Vector3(),\r\n    centerUV = new THREE.Vector2(0.5, 0.5);\r\n\r\n  this.vertices.push(center);\r\n  uvs.push(centerUV);\r\n\r\n  for (i = 0; i <= segments; i++) {\r\n\r\n    var vertex = new THREE.Vector3();\r\n    var segment = thetaStart + i / segments * thetaLength;\r\n\r\n    vertex.x = radius * Math.cos(segment);\r\n    vertex.y = radius * Math.sin(segment);\r\n\r\n    this.vertices.push(vertex);\r\n    uvs.push(new THREE.Vector2((vertex.x / radius + 1) / 2, (vertex.y / radius + 1) / 2));\r\n\r\n  }\r\n\r\n  var n = new THREE.Vector3(0, 0, 1);\r\n\r\n  for (i = 1; i <= segments; i++) {\r\n\r\n    this.faces.push(new THREE.Face3(i, i + 1, 0, [n.clone(), n.clone(), n.clone()]));\r\n    this.faceVertexUvs[0].push([uvs[i].clone(), uvs[i + 1].clone(), centerUV.clone()]);\r\n\r\n  }\r\n\r\n  this.computeFaceNormals();\r\n\r\n  this.boundingSphere = new THREE.Sphere(new THREE.Vector3(), radius);\r\n\r\n};\r\n\r\nTHREE.CircleGeometry.prototype = Object.create(THREE.Geometry.prototype);\r\nTHREE.CircleGeometry.prototype.constructor = THREE.CircleGeometry;\r\n\r\n// File:src/extras/geometries/CubeGeometry.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\n\r\nTHREE.CubeGeometry = function(width, height, depth, widthSegments, heightSegments, depthSegments) {\r\n\r\n  THREE.warn('THREE.CubeGeometry has been renamed to THREE.BoxGeometry.');\r\n  return new THREE.BoxGeometry(width, height, depth, widthSegments, heightSegments, depthSegments);\r\n\r\n};\r\n\r\n// File:src/extras/geometries/CylinderGeometry.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.CylinderGeometry = function(radiusTop, radiusBottom, height, radialSegments, heightSegments, openEnded, thetaStart, thetaLength) {\r\n\r\n  THREE.Geometry.call(this);\r\n\r\n  this.type = 'CylinderGeometry';\r\n\r\n  this.parameters = {\r\n    radiusTop: radiusTop,\r\n    radiusBottom: radiusBottom,\r\n    height: height,\r\n    radialSegments: radialSegments,\r\n    heightSegments: heightSegments,\r\n    openEnded: openEnded,\r\n    thetaStart: thetaStart,\r\n    thetaLength: thetaLength\r\n  };\r\n\r\n  radiusTop = radiusTop !== undefined ? radiusTop : 20;\r\n  radiusBottom = radiusBottom !== undefined ? radiusBottom : 20;\r\n  height = height !== undefined ? height : 100;\r\n\r\n  radialSegments = radialSegments || 8;\r\n  heightSegments = heightSegments || 1;\r\n\r\n  openEnded = openEnded !== undefined ? openEnded : false;\r\n  thetaStart = thetaStart !== undefined ? thetaStart : 0;\r\n  thetaLength = thetaLength !== undefined ? thetaLength : 2 * Math.PI;\r\n\r\n  var heightHalf = height / 2;\r\n\r\n  var x, y, vertices = [],\r\n    uvs = [];\r\n\r\n  for (y = 0; y <= heightSegments; y++) {\r\n\r\n    var verticesRow = [];\r\n    var uvsRow = [];\r\n\r\n    var v = y / heightSegments;\r\n    var radius = v * (radiusBottom - radiusTop) + radiusTop;\r\n\r\n    for (x = 0; x <= radialSegments; x++) {\r\n\r\n      var u = x / radialSegments;\r\n\r\n      var vertex = new THREE.Vector3();\r\n      vertex.x = radius * Math.sin(u * thetaLength + thetaStart);\r\n      vertex.y = -v * height + heightHalf;\r\n      vertex.z = radius * Math.cos(u * thetaLength + thetaStart);\r\n\r\n      this.vertices.push(vertex);\r\n\r\n      verticesRow.push(this.vertices.length - 1);\r\n      uvsRow.push(new THREE.Vector2(u, 1 - v));\r\n\r\n    }\r\n\r\n    vertices.push(verticesRow);\r\n    uvs.push(uvsRow);\r\n\r\n  }\r\n\r\n  var tanTheta = (radiusBottom - radiusTop) / height;\r\n  var na, nb;\r\n\r\n  for (x = 0; x < radialSegments; x++) {\r\n\r\n    if (radiusTop !== 0) {\r\n\r\n      na = this.vertices[vertices[0][x]].clone();\r\n      nb = this.vertices[vertices[0][x + 1]].clone();\r\n\r\n    }\r\n    else {\r\n\r\n      na = this.vertices[vertices[1][x]].clone();\r\n      nb = this.vertices[vertices[1][x + 1]].clone();\r\n\r\n    }\r\n\r\n    na.setY(Math.sqrt(na.x * na.x + na.z * na.z) * tanTheta).normalize();\r\n    nb.setY(Math.sqrt(nb.x * nb.x + nb.z * nb.z) * tanTheta).normalize();\r\n\r\n    for (y = 0; y < heightSegments; y++) {\r\n\r\n      var v1 = vertices[y][x];\r\n      var v2 = vertices[y + 1][x];\r\n      var v3 = vertices[y + 1][x + 1];\r\n      var v4 = vertices[y][x + 1];\r\n\r\n      var n1 = na.clone();\r\n      var n2 = na.clone();\r\n      var n3 = nb.clone();\r\n      var n4 = nb.clone();\r\n\r\n      var uv1 = uvs[y][x].clone();\r\n      var uv2 = uvs[y + 1][x].clone();\r\n      var uv3 = uvs[y + 1][x + 1].clone();\r\n      var uv4 = uvs[y][x + 1].clone();\r\n\r\n      this.faces.push(new THREE.Face3(v1, v2, v4, [n1, n2, n4]));\r\n      this.faceVertexUvs[0].push([uv1, uv2, uv4]);\r\n\r\n      this.faces.push(new THREE.Face3(v2, v3, v4, [n2.clone(), n3, n4.clone()]));\r\n      this.faceVertexUvs[0].push([uv2.clone(), uv3, uv4.clone()]);\r\n\r\n    }\r\n\r\n  }\r\n\r\n  // top cap\r\n\r\n  if (openEnded === false && radiusTop > 0) {\r\n\r\n    this.vertices.push(new THREE.Vector3(0, heightHalf, 0));\r\n\r\n    for (x = 0; x < radialSegments; x++) {\r\n\r\n      var v1 = vertices[0][x];\r\n      var v2 = vertices[0][x + 1];\r\n      var v3 = this.vertices.length - 1;\r\n\r\n      var n1 = new THREE.Vector3(0, 1, 0);\r\n      var n2 = new THREE.Vector3(0, 1, 0);\r\n      var n3 = new THREE.Vector3(0, 1, 0);\r\n\r\n      var uv1 = uvs[0][x].clone();\r\n      var uv2 = uvs[0][x + 1].clone();\r\n      var uv3 = new THREE.Vector2(uv2.x, 0);\r\n\r\n      this.faces.push(new THREE.Face3(v1, v2, v3, [n1, n2, n3]));\r\n      this.faceVertexUvs[0].push([uv1, uv2, uv3]);\r\n\r\n    }\r\n\r\n  }\r\n\r\n  // bottom cap\r\n\r\n  if (openEnded === false && radiusBottom > 0) {\r\n\r\n    this.vertices.push(new THREE.Vector3(0, -heightHalf, 0));\r\n\r\n    for (x = 0; x < radialSegments; x++) {\r\n\r\n      var v1 = vertices[heightSegments][x + 1];\r\n      var v2 = vertices[heightSegments][x];\r\n      var v3 = this.vertices.length - 1;\r\n\r\n      var n1 = new THREE.Vector3(0, -1, 0);\r\n      var n2 = new THREE.Vector3(0, -1, 0);\r\n      var n3 = new THREE.Vector3(0, -1, 0);\r\n\r\n      var uv1 = uvs[heightSegments][x + 1].clone();\r\n      var uv2 = uvs[heightSegments][x].clone();\r\n      var uv3 = new THREE.Vector2(uv2.x, 1);\r\n\r\n      this.faces.push(new THREE.Face3(v1, v2, v3, [n1, n2, n3]));\r\n      this.faceVertexUvs[0].push([uv1, uv2, uv3]);\r\n\r\n    }\r\n\r\n  }\r\n\r\n  this.computeFaceNormals();\r\n\r\n};\r\n\r\nTHREE.CylinderGeometry.prototype = Object.create(THREE.Geometry.prototype);\r\nTHREE.CylinderGeometry.prototype.constructor = THREE.CylinderGeometry;\r\n\r\n// File:src/extras/geometries/ExtrudeGeometry.js\r\n\r\n/**\r\n * @author zz85 / http://www.lab4games.net/zz85/blog\r\n *\r\n * Creates extruded geometry from a path shape.\r\n *\r\n * parameters = {\r\n *\r\n *  curveSegments: <int>, // number of points on the curves\r\n *  steps: <int>, // number of points for z-side extrusions / used for subdividing segements of extrude spline too\r\n *  amount: <int>, // Depth to extrude the shape\r\n *\r\n *  bevelEnabled: <bool>, // turn on bevel\r\n *  bevelThickness: <float>, // how deep into the original shape bevel goes\r\n *  bevelSize: <float>, // how far from shape outline is bevel\r\n *  bevelSegments: <int>, // number of bevel layers\r\n *\r\n *  extrudePath: <THREE.CurvePath> // 3d spline path to extrude shape along. (creates Frames if .frames aren't defined)\r\n *  frames: <THREE.TubeGeometry.FrenetFrames> // containing arrays of tangents, normals, binormals\r\n *\r\n *  material: <int> // material index for front and back faces\r\n *  extrudeMaterial: <int> // material index for extrusion and beveled faces\r\n *  uvGenerator: <Object> // object that provides UV generator functions\r\n *\r\n * }\r\n **/\r\n\r\nTHREE.ExtrudeGeometry = function(shapes, options) {\r\n\r\n  if (typeof(shapes) === \"undefined\") {\r\n    shapes = [];\r\n    return;\r\n  }\r\n\r\n  THREE.Geometry.call(this);\r\n\r\n  this.type = 'ExtrudeGeometry';\r\n\r\n  shapes = shapes instanceof Array ? shapes : [shapes];\r\n\r\n  this.addShapeList(shapes, options);\r\n\r\n  this.computeFaceNormals();\r\n\r\n  // can't really use automatic vertex normals\r\n  // as then front and back sides get smoothed too\r\n  // should do separate smoothing just for sides\r\n\r\n  //this.computeVertexNormals();\r\n\r\n  //console.log( \"took\", ( Date.now() - startTime ) );\r\n\r\n};\r\n\r\nTHREE.ExtrudeGeometry.prototype = Object.create(THREE.Geometry.prototype);\r\nTHREE.ExtrudeGeometry.prototype.constructor = THREE.ExtrudeGeometry;\r\n\r\nTHREE.ExtrudeGeometry.prototype.addShapeList = function(shapes, options) {\r\n  var sl = shapes.length;\r\n\r\n  for (var s = 0; s < sl; s++) {\r\n    var shape = shapes[s];\r\n    this.addShape(shape, options);\r\n  }\r\n};\r\n\r\nTHREE.ExtrudeGeometry.prototype.addShape = function(shape, options) {\r\n\r\n  var amount = options.amount !== undefined ? options.amount : 100;\r\n\r\n  var bevelThickness = options.bevelThickness !== undefined ? options.bevelThickness : 6; // 10\r\n  var bevelSize = options.bevelSize !== undefined ? options.bevelSize : bevelThickness - 2; // 8\r\n  var bevelSegments = options.bevelSegments !== undefined ? options.bevelSegments : 3;\r\n\r\n  var bevelEnabled = options.bevelEnabled !== undefined ? options.bevelEnabled : true; // false\r\n\r\n  var curveSegments = options.curveSegments !== undefined ? options.curveSegments : 12;\r\n\r\n  var steps = options.steps !== undefined ? options.steps : 1;\r\n\r\n  var extrudePath = options.extrudePath;\r\n  var extrudePts, extrudeByPath = false;\r\n\r\n  var material = options.material;\r\n  var extrudeMaterial = options.extrudeMaterial;\r\n\r\n  // Use default WorldUVGenerator if no UV generators are specified.\r\n  var uvgen = options.UVGenerator !== undefined ? options.UVGenerator : THREE.ExtrudeGeometry.WorldUVGenerator;\r\n\r\n  var splineTube, binormal, normal, position2;\r\n  if (extrudePath) {\r\n\r\n    extrudePts = extrudePath.getSpacedPoints(steps);\r\n\r\n    extrudeByPath = true;\r\n    bevelEnabled = false; // bevels not supported for path extrusion\r\n\r\n    // SETUP TNB variables\r\n\r\n    // Reuse TNB from TubeGeomtry for now.\r\n    // TODO1 - have a .isClosed in spline?\r\n\r\n    splineTube = options.frames !== undefined ? options.frames : new THREE.TubeGeometry.FrenetFrames(extrudePath, steps, false);\r\n\r\n    // console.log(splineTube, 'splineTube', splineTube.normals.length, 'steps', steps, 'extrudePts', extrudePts.length);\r\n\r\n    binormal = new THREE.Vector3();\r\n    normal = new THREE.Vector3();\r\n    position2 = new THREE.Vector3();\r\n\r\n  }\r\n\r\n  // Safeguards if bevels are not enabled\r\n\r\n  if (!bevelEnabled) {\r\n\r\n    bevelSegments = 0;\r\n    bevelThickness = 0;\r\n    bevelSize = 0;\r\n\r\n  }\r\n\r\n  // Variables initalization\r\n\r\n  var ahole, h, hl; // looping of holes\r\n  var scope = this;\r\n\r\n  var shapesOffset = this.vertices.length;\r\n\r\n  var shapePoints = shape.extractPoints(curveSegments);\r\n\r\n  var vertices = shapePoints.shape;\r\n  var holes = shapePoints.holes;\r\n\r\n  var reverse = !THREE.Shape.Utils.isClockWise(vertices);\r\n\r\n  if (reverse) {\r\n\r\n    vertices = vertices.reverse();\r\n\r\n    // Maybe we should also check if holes are in the opposite direction, just to be safe ...\r\n\r\n    for (h = 0, hl = holes.length; h < hl; h++) {\r\n\r\n      ahole = holes[h];\r\n\r\n      if (THREE.Shape.Utils.isClockWise(ahole)) {\r\n\r\n        holes[h] = ahole.reverse();\r\n\r\n      }\r\n\r\n    }\r\n\r\n    reverse = false; // If vertices are in order now, we shouldn't need to worry about them again (hopefully)!\r\n\r\n  }\r\n\r\n\r\n  var faces = THREE.Shape.Utils.triangulateShape(vertices, holes);\r\n\r\n  /* Vertices */\r\n\r\n  var contour = vertices; // vertices has all points but contour has only points of circumference\r\n\r\n  for (h = 0, hl = holes.length; h < hl; h++) {\r\n\r\n    ahole = holes[h];\r\n\r\n    vertices = vertices.concat(ahole);\r\n\r\n  }\r\n\r\n\r\n  function scalePt2(pt, vec, size) {\r\n\r\n    if (!vec) THREE.error(\"THREE.ExtrudeGeometry: vec does not exist\");\r\n\r\n    return vec.clone().multiplyScalar(size).add(pt);\r\n\r\n  }\r\n\r\n  var b, bs, t, z,\r\n    vert, vlen = vertices.length,\r\n    face, flen = faces.length;\r\n\r\n\r\n  // Find directions for point movement\r\n\r\n\r\n  function getBevelVec(inPt, inPrev, inNext) {\r\n\r\n    var EPSILON = 0.0000000001;\r\n\r\n    // computes for inPt the corresponding point inPt' on a new contour\r\n    //   shiftet by 1 unit (length of normalized vector) to the left\r\n    // if we walk along contour clockwise, this new contour is outside the old one\r\n    //\r\n    // inPt' is the intersection of the two lines parallel to the two\r\n    //  adjacent edges of inPt at a distance of 1 unit on the left side.\r\n\r\n    var v_trans_x, v_trans_y, shrink_by = 1; // resulting translation vector for inPt\r\n\r\n    // good reading for geometry algorithms (here: line-line intersection)\r\n    // http://geomalgorithms.com/a05-_intersect-1.html\r\n\r\n    var v_prev_x = inPt.x - inPrev.x,\r\n      v_prev_y = inPt.y - inPrev.y;\r\n    var v_next_x = inNext.x - inPt.x,\r\n      v_next_y = inNext.y - inPt.y;\r\n\r\n    var v_prev_lensq = (v_prev_x * v_prev_x + v_prev_y * v_prev_y);\r\n\r\n    // check for colinear edges\r\n    var colinear0 = (v_prev_x * v_next_y - v_prev_y * v_next_x);\r\n\r\n    if (Math.abs(colinear0) > EPSILON) { // not colinear\r\n\r\n      // length of vectors for normalizing\r\n\r\n      var v_prev_len = Math.sqrt(v_prev_lensq);\r\n      var v_next_len = Math.sqrt(v_next_x * v_next_x + v_next_y * v_next_y);\r\n\r\n      // shift adjacent points by unit vectors to the left\r\n\r\n      var ptPrevShift_x = (inPrev.x - v_prev_y / v_prev_len);\r\n      var ptPrevShift_y = (inPrev.y + v_prev_x / v_prev_len);\r\n\r\n      var ptNextShift_x = (inNext.x - v_next_y / v_next_len);\r\n      var ptNextShift_y = (inNext.y + v_next_x / v_next_len);\r\n\r\n      // scaling factor for v_prev to intersection point\r\n\r\n      var sf = ((ptNextShift_x - ptPrevShift_x) * v_next_y -\r\n          (ptNextShift_y - ptPrevShift_y) * v_next_x) /\r\n        (v_prev_x * v_next_y - v_prev_y * v_next_x);\r\n\r\n      // vector from inPt to intersection point\r\n\r\n      v_trans_x = (ptPrevShift_x + v_prev_x * sf - inPt.x);\r\n      v_trans_y = (ptPrevShift_y + v_prev_y * sf - inPt.y);\r\n\r\n      // Don't normalize!, otherwise sharp corners become ugly\r\n      //  but prevent crazy spikes\r\n      var v_trans_lensq = (v_trans_x * v_trans_x + v_trans_y * v_trans_y)\r\n      if (v_trans_lensq <= 2) {\r\n        return new THREE.Vector2(v_trans_x, v_trans_y);\r\n      }\r\n      else {\r\n        shrink_by = Math.sqrt(v_trans_lensq / 2);\r\n      }\r\n\r\n    }\r\n    else { // handle special case of colinear edges\r\n\r\n      var direction_eq = false; // assumes: opposite\r\n      if (v_prev_x > EPSILON) {\r\n        if (v_next_x > EPSILON) {\r\n          direction_eq = true;\r\n        }\r\n      }\r\n      else {\r\n        if (v_prev_x < -EPSILON) {\r\n          if (v_next_x < -EPSILON) {\r\n            direction_eq = true;\r\n          }\r\n        }\r\n        else {\r\n          if (Math.sign(v_prev_y) == Math.sign(v_next_y)) {\r\n            direction_eq = true;\r\n          }\r\n        }\r\n      }\r\n\r\n      if (direction_eq) {\r\n        // console.log(\"Warning: lines are a straight sequence\");\r\n        v_trans_x = -v_prev_y;\r\n        v_trans_y = v_prev_x;\r\n        shrink_by = Math.sqrt(v_prev_lensq);\r\n      }\r\n      else {\r\n        // console.log(\"Warning: lines are a straight spike\");\r\n        v_trans_x = v_prev_x;\r\n        v_trans_y = v_prev_y;\r\n        shrink_by = Math.sqrt(v_prev_lensq / 2);\r\n      }\r\n\r\n    }\r\n\r\n    return new THREE.Vector2(v_trans_x / shrink_by, v_trans_y / shrink_by);\r\n\r\n  }\r\n\r\n\r\n  var contourMovements = [];\r\n\r\n  for (var i = 0, il = contour.length, j = il - 1, k = i + 1; i < il; i++, j++, k++) {\r\n\r\n    if (j === il) j = 0;\r\n    if (k === il) k = 0;\r\n\r\n    //  (j)---(i)---(k)\r\n    // console.log('i,j,k', i, j , k)\r\n\r\n    contourMovements[i] = getBevelVec(contour[i], contour[j], contour[k]);\r\n\r\n  }\r\n\r\n  var holesMovements = [],\r\n    oneHoleMovements, verticesMovements = contourMovements.concat();\r\n\r\n  for (h = 0, hl = holes.length; h < hl; h++) {\r\n\r\n    ahole = holes[h];\r\n\r\n    oneHoleMovements = [];\r\n\r\n    for (i = 0, il = ahole.length, j = il - 1, k = i + 1; i < il; i++, j++, k++) {\r\n\r\n      if (j === il) j = 0;\r\n      if (k === il) k = 0;\r\n\r\n      //  (j)---(i)---(k)\r\n      oneHoleMovements[i] = getBevelVec(ahole[i], ahole[j], ahole[k]);\r\n\r\n    }\r\n\r\n    holesMovements.push(oneHoleMovements);\r\n    verticesMovements = verticesMovements.concat(oneHoleMovements);\r\n\r\n  }\r\n\r\n\r\n  // Loop bevelSegments, 1 for the front, 1 for the back\r\n\r\n  for (b = 0; b < bevelSegments; b++) {\r\n    //for ( b = bevelSegments; b > 0; b -- ) {\r\n\r\n    t = b / bevelSegments;\r\n    z = bevelThickness * (1 - t);\r\n\r\n    //z = bevelThickness * t;\r\n    bs = bevelSize * (Math.sin(t * Math.PI / 2)); // curved\r\n    //bs = bevelSize * t ; // linear\r\n\r\n    // contract shape\r\n\r\n    for (i = 0, il = contour.length; i < il; i++) {\r\n\r\n      vert = scalePt2(contour[i], contourMovements[i], bs);\r\n\r\n      v(vert.x, vert.y, -z);\r\n\r\n    }\r\n\r\n    // expand holes\r\n\r\n    for (h = 0, hl = holes.length; h < hl; h++) {\r\n\r\n      ahole = holes[h];\r\n      oneHoleMovements = holesMovements[h];\r\n\r\n      for (i = 0, il = ahole.length; i < il; i++) {\r\n\r\n        vert = scalePt2(ahole[i], oneHoleMovements[i], bs);\r\n\r\n        v(vert.x, vert.y, -z);\r\n\r\n      }\r\n\r\n    }\r\n\r\n  }\r\n\r\n  bs = bevelSize;\r\n\r\n  // Back facing vertices\r\n\r\n  for (i = 0; i < vlen; i++) {\r\n\r\n    vert = bevelEnabled ? scalePt2(vertices[i], verticesMovements[i], bs) : vertices[i];\r\n\r\n    if (!extrudeByPath) {\r\n\r\n      v(vert.x, vert.y, 0);\r\n\r\n    }\r\n    else {\r\n\r\n      // v( vert.x, vert.y + extrudePts[ 0 ].y, extrudePts[ 0 ].x );\r\n\r\n      normal.copy(splineTube.normals[0]).multiplyScalar(vert.x);\r\n      binormal.copy(splineTube.binormals[0]).multiplyScalar(vert.y);\r\n\r\n      position2.copy(extrudePts[0]).add(normal).add(binormal);\r\n\r\n      v(position2.x, position2.y, position2.z);\r\n\r\n    }\r\n\r\n  }\r\n\r\n  // Add stepped vertices...\r\n  // Including front facing vertices\r\n\r\n  var s;\r\n\r\n  for (s = 1; s <= steps; s++) {\r\n\r\n    for (i = 0; i < vlen; i++) {\r\n\r\n      vert = bevelEnabled ? scalePt2(vertices[i], verticesMovements[i], bs) : vertices[i];\r\n\r\n      if (!extrudeByPath) {\r\n\r\n        v(vert.x, vert.y, amount / steps * s);\r\n\r\n      }\r\n      else {\r\n\r\n        // v( vert.x, vert.y + extrudePts[ s - 1 ].y, extrudePts[ s - 1 ].x );\r\n\r\n        normal.copy(splineTube.normals[s]).multiplyScalar(vert.x);\r\n        binormal.copy(splineTube.binormals[s]).multiplyScalar(vert.y);\r\n\r\n        position2.copy(extrudePts[s]).add(normal).add(binormal);\r\n\r\n        v(position2.x, position2.y, position2.z);\r\n\r\n      }\r\n\r\n    }\r\n\r\n  }\r\n\r\n\r\n  // Add bevel segments planes\r\n\r\n  //for ( b = 1; b <= bevelSegments; b ++ ) {\r\n  for (b = bevelSegments - 1; b >= 0; b--) {\r\n\r\n    t = b / bevelSegments;\r\n    z = bevelThickness * (1 - t);\r\n    //bs = bevelSize * ( 1-Math.sin ( ( 1 - t ) * Math.PI/2 ) );\r\n    bs = bevelSize * Math.sin(t * Math.PI / 2);\r\n\r\n    // contract shape\r\n\r\n    for (i = 0, il = contour.length; i < il; i++) {\r\n\r\n      vert = scalePt2(contour[i], contourMovements[i], bs);\r\n      v(vert.x, vert.y, amount + z);\r\n\r\n    }\r\n\r\n    // expand holes\r\n\r\n    for (h = 0, hl = holes.length; h < hl; h++) {\r\n\r\n      ahole = holes[h];\r\n      oneHoleMovements = holesMovements[h];\r\n\r\n      for (i = 0, il = ahole.length; i < il; i++) {\r\n\r\n        vert = scalePt2(ahole[i], oneHoleMovements[i], bs);\r\n\r\n        if (!extrudeByPath) {\r\n\r\n          v(vert.x, vert.y, amount + z);\r\n\r\n        }\r\n        else {\r\n\r\n          v(vert.x, vert.y + extrudePts[steps - 1].y, extrudePts[steps - 1].x + z);\r\n\r\n        }\r\n\r\n      }\r\n\r\n    }\r\n\r\n  }\r\n\r\n  /* Faces */\r\n\r\n  // Top and bottom faces\r\n\r\n  buildLidFaces();\r\n\r\n  // Sides faces\r\n\r\n  buildSideFaces();\r\n\r\n\r\n  /////  Internal functions\r\n\r\n  function buildLidFaces() {\r\n\r\n    if (bevelEnabled) {\r\n\r\n      var layer = 0; // steps + 1\r\n      var offset = vlen * layer;\r\n\r\n      // Bottom faces\r\n\r\n      for (i = 0; i < flen; i++) {\r\n\r\n        face = faces[i];\r\n        f3(face[2] + offset, face[1] + offset, face[0] + offset);\r\n\r\n      }\r\n\r\n      layer = steps + bevelSegments * 2;\r\n      offset = vlen * layer;\r\n\r\n      // Top faces\r\n\r\n      for (i = 0; i < flen; i++) {\r\n\r\n        face = faces[i];\r\n        f3(face[0] + offset, face[1] + offset, face[2] + offset);\r\n\r\n      }\r\n\r\n    }\r\n    else {\r\n\r\n      // Bottom faces\r\n\r\n      for (i = 0; i < flen; i++) {\r\n\r\n        face = faces[i];\r\n        f3(face[2], face[1], face[0]);\r\n\r\n      }\r\n\r\n      // Top faces\r\n\r\n      for (i = 0; i < flen; i++) {\r\n\r\n        face = faces[i];\r\n        f3(face[0] + vlen * steps, face[1] + vlen * steps, face[2] + vlen * steps);\r\n\r\n      }\r\n    }\r\n\r\n  }\r\n\r\n  // Create faces for the z-sides of the shape\r\n\r\n  function buildSideFaces() {\r\n\r\n    var layeroffset = 0;\r\n    sidewalls(contour, layeroffset);\r\n    layeroffset += contour.length;\r\n\r\n    for (h = 0, hl = holes.length; h < hl; h++) {\r\n\r\n      ahole = holes[h];\r\n      sidewalls(ahole, layeroffset);\r\n\r\n      //, true\r\n      layeroffset += ahole.length;\r\n\r\n    }\r\n\r\n  }\r\n\r\n  function sidewalls(contour, layeroffset) {\r\n\r\n    var j, k;\r\n    i = contour.length;\r\n\r\n    while (--i >= 0) {\r\n\r\n      j = i;\r\n      k = i - 1;\r\n      if (k < 0) k = contour.length - 1;\r\n\r\n      //console.log('b', i,j, i-1, k,vertices.length);\r\n\r\n      var s = 0,\r\n        sl = steps + bevelSegments * 2;\r\n\r\n      for (s = 0; s < sl; s++) {\r\n\r\n        var slen1 = vlen * s;\r\n        var slen2 = vlen * (s + 1);\r\n\r\n        var a = layeroffset + j + slen1,\r\n          b = layeroffset + k + slen1,\r\n          c = layeroffset + k + slen2,\r\n          d = layeroffset + j + slen2;\r\n\r\n        f4(a, b, c, d, contour, s, sl, j, k);\r\n\r\n      }\r\n    }\r\n\r\n  }\r\n\r\n\r\n  function v(x, y, z) {\r\n\r\n    scope.vertices.push(new THREE.Vector3(x, y, z));\r\n\r\n  }\r\n\r\n  function f3(a, b, c) {\r\n\r\n    a += shapesOffset;\r\n    b += shapesOffset;\r\n    c += shapesOffset;\r\n\r\n    // normal, color, material\r\n    scope.faces.push(new THREE.Face3(a, b, c, null, null, material));\r\n\r\n    var uvs = uvgen.generateTopUV(scope, a, b, c);\r\n\r\n    scope.faceVertexUvs[0].push(uvs);\r\n\r\n  }\r\n\r\n  function f4(a, b, c, d, wallContour, stepIndex, stepsLength, contourIndex1, contourIndex2) {\r\n\r\n    a += shapesOffset;\r\n    b += shapesOffset;\r\n    c += shapesOffset;\r\n    d += shapesOffset;\r\n\r\n    scope.faces.push(new THREE.Face3(a, b, d, null, null, extrudeMaterial));\r\n    scope.faces.push(new THREE.Face3(b, c, d, null, null, extrudeMaterial));\r\n\r\n    var uvs = uvgen.generateSideWallUV(scope, a, b, c, d);\r\n\r\n    scope.faceVertexUvs[0].push([uvs[0], uvs[1], uvs[3]]);\r\n    scope.faceVertexUvs[0].push([uvs[1], uvs[2], uvs[3]]);\r\n\r\n  }\r\n\r\n};\r\n\r\nTHREE.ExtrudeGeometry.WorldUVGenerator = {\r\n\r\n  generateTopUV: function(geometry, indexA, indexB, indexC) {\r\n\r\n    var vertices = geometry.vertices;\r\n\r\n    var a = vertices[indexA];\r\n    var b = vertices[indexB];\r\n    var c = vertices[indexC];\r\n\r\n    return [\r\n      new THREE.Vector2(a.x, a.y),\r\n      new THREE.Vector2(b.x, b.y),\r\n      new THREE.Vector2(c.x, c.y)\r\n    ];\r\n\r\n  },\r\n\r\n  generateSideWallUV: function(geometry, indexA, indexB, indexC, indexD) {\r\n\r\n    var vertices = geometry.vertices;\r\n\r\n    var a = vertices[indexA];\r\n    var b = vertices[indexB];\r\n    var c = vertices[indexC];\r\n    var d = vertices[indexD];\r\n\r\n    if (Math.abs(a.y - b.y) < 0.01) {\r\n      return [\r\n        new THREE.Vector2(a.x, 1 - a.z),\r\n        new THREE.Vector2(b.x, 1 - b.z),\r\n        new THREE.Vector2(c.x, 1 - c.z),\r\n        new THREE.Vector2(d.x, 1 - d.z)\r\n      ];\r\n    }\r\n    else {\r\n      return [\r\n        new THREE.Vector2(a.y, 1 - a.z),\r\n        new THREE.Vector2(b.y, 1 - b.z),\r\n        new THREE.Vector2(c.y, 1 - c.z),\r\n        new THREE.Vector2(d.y, 1 - d.z)\r\n      ];\r\n    }\r\n  }\r\n};\r\n\r\n// File:src/extras/geometries/ShapeGeometry.js\r\n\r\n/**\r\n * @author jonobr1 / http://jonobr1.com\r\n *\r\n * Creates a one-sided polygonal geometry from a path shape. Similar to\r\n * ExtrudeGeometry.\r\n *\r\n * parameters = {\r\n *\r\n *\tcurveSegments: <int>, // number of points on the curves. NOT USED AT THE MOMENT.\r\n *\r\n *\tmaterial: <int> // material index for front and back faces\r\n *\tuvGenerator: <Object> // object that provides UV generator functions\r\n *\r\n * }\r\n **/\r\n\r\nTHREE.ShapeGeometry = function(shapes, options) {\r\n\r\n  THREE.Geometry.call(this);\r\n\r\n  this.type = 'ShapeGeometry';\r\n\r\n  if (shapes instanceof Array === false) shapes = [shapes];\r\n\r\n  this.addShapeList(shapes, options);\r\n\r\n  this.computeFaceNormals();\r\n\r\n};\r\n\r\nTHREE.ShapeGeometry.prototype = Object.create(THREE.Geometry.prototype);\r\nTHREE.ShapeGeometry.prototype.constructor = THREE.ShapeGeometry;\r\n\r\n/**\r\n * Add an array of shapes to THREE.ShapeGeometry.\r\n */\r\nTHREE.ShapeGeometry.prototype.addShapeList = function(shapes, options) {\r\n\r\n  for (var i = 0, l = shapes.length; i < l; i++) {\r\n\r\n    this.addShape(shapes[i], options);\r\n\r\n  }\r\n\r\n  return this;\r\n\r\n};\r\n\r\n/**\r\n * Adds a shape to THREE.ShapeGeometry, based on THREE.ExtrudeGeometry.\r\n */\r\nTHREE.ShapeGeometry.prototype.addShape = function(shape, options) {\r\n\r\n  if (options === undefined) options = {};\r\n  var curveSegments = options.curveSegments !== undefined ? options.curveSegments : 12;\r\n\r\n  var material = options.material;\r\n  var uvgen = options.UVGenerator === undefined ? THREE.ExtrudeGeometry.WorldUVGenerator : options.UVGenerator;\r\n\r\n  //\r\n\r\n  var i, l, hole;\r\n\r\n  var shapesOffset = this.vertices.length;\r\n  var shapePoints = shape.extractPoints(curveSegments);\r\n\r\n  var vertices = shapePoints.shape;\r\n  var holes = shapePoints.holes;\r\n\r\n  var reverse = !THREE.Shape.Utils.isClockWise(vertices);\r\n\r\n  if (reverse) {\r\n\r\n    vertices = vertices.reverse();\r\n\r\n    // Maybe we should also check if holes are in the opposite direction, just to be safe...\r\n\r\n    for (i = 0, l = holes.length; i < l; i++) {\r\n\r\n      hole = holes[i];\r\n\r\n      if (THREE.Shape.Utils.isClockWise(hole)) {\r\n\r\n        holes[i] = hole.reverse();\r\n\r\n      }\r\n\r\n    }\r\n\r\n    reverse = false;\r\n\r\n  }\r\n\r\n  var faces = THREE.Shape.Utils.triangulateShape(vertices, holes);\r\n\r\n  // Vertices\r\n\r\n  var contour = vertices;\r\n\r\n  for (i = 0, l = holes.length; i < l; i++) {\r\n\r\n    hole = holes[i];\r\n    vertices = vertices.concat(hole);\r\n\r\n  }\r\n\r\n  //\r\n\r\n  var vert, vlen = vertices.length;\r\n  var face, flen = faces.length;\r\n\r\n  for (i = 0; i < vlen; i++) {\r\n\r\n    vert = vertices[i];\r\n\r\n    this.vertices.push(new THREE.Vector3(vert.x, vert.y, 0));\r\n\r\n  }\r\n\r\n  for (i = 0; i < flen; i++) {\r\n\r\n    face = faces[i];\r\n\r\n    var a = face[0] + shapesOffset;\r\n    var b = face[1] + shapesOffset;\r\n    var c = face[2] + shapesOffset;\r\n\r\n    this.faces.push(new THREE.Face3(a, b, c, null, null, material));\r\n    this.faceVertexUvs[0].push(uvgen.generateTopUV(this, a, b, c));\r\n\r\n  }\r\n\r\n};\r\n\r\n// File:src/extras/geometries/LatheGeometry.js\r\n\r\n/**\r\n * @author astrodud / http://astrodud.isgreat.org/\r\n * @author zz85 / https://github.com/zz85\r\n * @author bhouston / http://exocortex.com\r\n */\r\n\r\n// points - to create a closed torus, one must use a set of points \r\n//    like so: [ a, b, c, d, a ], see first is the same as last.\r\n// segments - the number of circumference segments to create\r\n// phiStart - the starting radian\r\n// phiLength - the radian (0 to 2*PI) range of the lathed section\r\n//    2*pi is a closed lathe, less than 2PI is a portion.\r\n\r\nTHREE.LatheGeometry = function(points, segments, phiStart, phiLength) {\r\n\r\n  THREE.Geometry.call(this);\r\n\r\n  this.type = 'LatheGeometry';\r\n\r\n  this.parameters = {\r\n    points: points,\r\n    segments: segments,\r\n    phiStart: phiStart,\r\n    phiLength: phiLength\r\n  };\r\n\r\n  segments = segments || 12;\r\n  phiStart = phiStart || 0;\r\n  phiLength = phiLength || 2 * Math.PI;\r\n\r\n  var inversePointLength = 1.0 / (points.length - 1);\r\n  var inverseSegments = 1.0 / segments;\r\n\r\n  for (var i = 0, il = segments; i <= il; i++) {\r\n\r\n    var phi = phiStart + i * inverseSegments * phiLength;\r\n\r\n    var c = Math.cos(phi),\r\n      s = Math.sin(phi);\r\n\r\n    for (var j = 0, jl = points.length; j < jl; j++) {\r\n\r\n      var pt = points[j];\r\n\r\n      var vertex = new THREE.Vector3();\r\n\r\n      vertex.x = c * pt.x - s * pt.y;\r\n      vertex.y = s * pt.x + c * pt.y;\r\n      vertex.z = pt.z;\r\n\r\n      this.vertices.push(vertex);\r\n\r\n    }\r\n\r\n  }\r\n\r\n  var np = points.length;\r\n\r\n  for (var i = 0, il = segments; i < il; i++) {\r\n\r\n    for (var j = 0, jl = points.length - 1; j < jl; j++) {\r\n\r\n      var base = j + np * i;\r\n      var a = base;\r\n      var b = base + np;\r\n      var c = base + 1 + np;\r\n      var d = base + 1;\r\n\r\n      var u0 = i * inverseSegments;\r\n      var v0 = j * inversePointLength;\r\n      var u1 = u0 + inverseSegments;\r\n      var v1 = v0 + inversePointLength;\r\n\r\n      this.faces.push(new THREE.Face3(a, b, d));\r\n\r\n      this.faceVertexUvs[0].push([\r\n\r\n        new THREE.Vector2(u0, v0),\r\n        new THREE.Vector2(u1, v0),\r\n        new THREE.Vector2(u0, v1)\r\n\r\n      ]);\r\n\r\n      this.faces.push(new THREE.Face3(b, c, d));\r\n\r\n      this.faceVertexUvs[0].push([\r\n\r\n        new THREE.Vector2(u1, v0),\r\n        new THREE.Vector2(u1, v1),\r\n        new THREE.Vector2(u0, v1)\r\n\r\n      ]);\r\n\r\n\r\n    }\r\n\r\n  }\r\n\r\n  this.mergeVertices();\r\n  this.computeFaceNormals();\r\n  this.computeVertexNormals();\r\n\r\n};\r\n\r\nTHREE.LatheGeometry.prototype = Object.create(THREE.Geometry.prototype);\r\nTHREE.LatheGeometry.prototype.constructor = THREE.LatheGeometry;\r\n\r\n// File:src/extras/geometries/PlaneGeometry.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * based on http://papervision3d.googlecode.com/svn/trunk/as3/trunk/src/org/papervision3d/objects/primitives/Plane.as\r\n */\r\n\r\nTHREE.PlaneGeometry = function(width, height, widthSegments, heightSegments) {\r\n\r\n  console.info('THREE.PlaneGeometry: Consider using THREE.PlaneBufferGeometry for lower memory footprint.');\r\n\r\n  THREE.Geometry.call(this);\r\n\r\n  this.type = 'PlaneGeometry';\r\n\r\n  this.parameters = {\r\n    width: width,\r\n    height: height,\r\n    widthSegments: widthSegments,\r\n    heightSegments: heightSegments\r\n  };\r\n\r\n  this.fromBufferGeometry(new THREE.PlaneBufferGeometry(width, height, widthSegments, heightSegments));\r\n\r\n};\r\n\r\nTHREE.PlaneGeometry.prototype = Object.create(THREE.Geometry.prototype);\r\nTHREE.PlaneGeometry.prototype.constructor = THREE.PlaneGeometry;\r\n\r\n// File:src/extras/geometries/PlaneBufferGeometry.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * based on http://papervision3d.googlecode.com/svn/trunk/as3/trunk/src/org/papervision3d/objects/primitives/Plane.as\r\n */\r\n\r\nTHREE.PlaneBufferGeometry = function(width, height, widthSegments, heightSegments) {\r\n\r\n  THREE.BufferGeometry.call(this);\r\n\r\n  this.type = 'PlaneBufferGeometry';\r\n\r\n  this.parameters = {\r\n    width: width,\r\n    height: height,\r\n    widthSegments: widthSegments,\r\n    heightSegments: heightSegments\r\n  };\r\n\r\n  var width_half = width / 2;\r\n  var height_half = height / 2;\r\n\r\n  var gridX = widthSegments || 1;\r\n  var gridY = heightSegments || 1;\r\n\r\n  var gridX1 = gridX + 1;\r\n  var gridY1 = gridY + 1;\r\n\r\n  var segment_width = width / gridX;\r\n  var segment_height = height / gridY;\r\n\r\n  var vertices = new Float32Array(gridX1 * gridY1 * 3);\r\n  var normals = new Float32Array(gridX1 * gridY1 * 3);\r\n  var uvs = new Float32Array(gridX1 * gridY1 * 2);\r\n\r\n  var offset = 0;\r\n  var offset2 = 0;\r\n\r\n  for (var iy = 0; iy < gridY1; iy++) {\r\n\r\n    var y = iy * segment_height - height_half;\r\n\r\n    for (var ix = 0; ix < gridX1; ix++) {\r\n\r\n      var x = ix * segment_width - width_half;\r\n\r\n      vertices[offset] = x;\r\n      vertices[offset + 1] = -y;\r\n\r\n      normals[offset + 2] = 1;\r\n\r\n      uvs[offset2] = ix / gridX;\r\n      uvs[offset2 + 1] = 1 - (iy / gridY);\r\n\r\n      offset += 3;\r\n      offset2 += 2;\r\n\r\n    }\r\n\r\n  }\r\n\r\n  offset = 0;\r\n\r\n  var indices = new((vertices.length / 3) > 65535 ? Uint32Array : Uint16Array)(gridX * gridY * 6);\r\n\r\n  for (var iy = 0; iy < gridY; iy++) {\r\n\r\n    for (var ix = 0; ix < gridX; ix++) {\r\n\r\n      var a = ix + gridX1 * iy;\r\n      var b = ix + gridX1 * (iy + 1);\r\n      var c = (ix + 1) + gridX1 * (iy + 1);\r\n      var d = (ix + 1) + gridX1 * iy;\r\n\r\n      indices[offset] = a;\r\n      indices[offset + 1] = b;\r\n      indices[offset + 2] = d;\r\n\r\n      indices[offset + 3] = b;\r\n      indices[offset + 4] = c;\r\n      indices[offset + 5] = d;\r\n\r\n      offset += 6;\r\n\r\n    }\r\n\r\n  }\r\n\r\n  this.addAttribute('index', new THREE.BufferAttribute(indices, 1));\r\n  this.addAttribute('position', new THREE.BufferAttribute(vertices, 3));\r\n  this.addAttribute('normal', new THREE.BufferAttribute(normals, 3));\r\n  this.addAttribute('uv', new THREE.BufferAttribute(uvs, 2));\r\n\r\n};\r\n\r\nTHREE.PlaneBufferGeometry.prototype = Object.create(THREE.BufferGeometry.prototype);\r\nTHREE.PlaneBufferGeometry.prototype.constructor = THREE.PlaneBufferGeometry;\r\n\r\n// File:src/extras/geometries/RingGeometry.js\r\n\r\n/**\r\n * @author Kaleb Murphy\r\n */\r\n\r\nTHREE.RingGeometry = function(innerRadius, outerRadius, thetaSegments, phiSegments, thetaStart, thetaLength) {\r\n\r\n  THREE.Geometry.call(this);\r\n\r\n  this.type = 'RingGeometry';\r\n\r\n  this.parameters = {\r\n    innerRadius: innerRadius,\r\n    outerRadius: outerRadius,\r\n    thetaSegments: thetaSegments,\r\n    phiSegments: phiSegments,\r\n    thetaStart: thetaStart,\r\n    thetaLength: thetaLength\r\n  };\r\n\r\n  innerRadius = innerRadius || 0;\r\n  outerRadius = outerRadius || 50;\r\n\r\n  thetaStart = thetaStart !== undefined ? thetaStart : 0;\r\n  thetaLength = thetaLength !== undefined ? thetaLength : Math.PI * 2;\r\n\r\n  thetaSegments = thetaSegments !== undefined ? Math.max(3, thetaSegments) : 8;\r\n  phiSegments = phiSegments !== undefined ? Math.max(1, phiSegments) : 8;\r\n\r\n  var i, o, uvs = [],\r\n    radius = innerRadius,\r\n    radiusStep = ((outerRadius - innerRadius) / phiSegments);\r\n\r\n  for (i = 0; i < phiSegments + 1; i++) { // concentric circles inside ring\r\n\r\n    for (o = 0; o < thetaSegments + 1; o++) { // number of segments per circle\r\n\r\n      var vertex = new THREE.Vector3();\r\n      var segment = thetaStart + o / thetaSegments * thetaLength;\r\n      vertex.x = radius * Math.cos(segment);\r\n      vertex.y = radius * Math.sin(segment);\r\n\r\n      this.vertices.push(vertex);\r\n      uvs.push(new THREE.Vector2((vertex.x / outerRadius + 1) / 2, (vertex.y / outerRadius + 1) / 2));\r\n    }\r\n\r\n    radius += radiusStep;\r\n\r\n  }\r\n\r\n  var n = new THREE.Vector3(0, 0, 1);\r\n\r\n  for (i = 0; i < phiSegments; i++) { // concentric circles inside ring\r\n\r\n    var thetaSegment = i * (thetaSegments + 1);\r\n\r\n    for (o = 0; o < thetaSegments; o++) { // number of segments per circle\r\n\r\n      var segment = o + thetaSegment;\r\n\r\n      var v1 = segment;\r\n      var v2 = segment + thetaSegments + 1;\r\n      var v3 = segment + thetaSegments + 2;\r\n\r\n      this.faces.push(new THREE.Face3(v1, v2, v3, [n.clone(), n.clone(), n.clone()]));\r\n      this.faceVertexUvs[0].push([uvs[v1].clone(), uvs[v2].clone(), uvs[v3].clone()]);\r\n\r\n      v1 = segment;\r\n      v2 = segment + thetaSegments + 2;\r\n      v3 = segment + 1;\r\n\r\n      this.faces.push(new THREE.Face3(v1, v2, v3, [n.clone(), n.clone(), n.clone()]));\r\n      this.faceVertexUvs[0].push([uvs[v1].clone(), uvs[v2].clone(), uvs[v3].clone()]);\r\n\r\n    }\r\n  }\r\n\r\n  this.computeFaceNormals();\r\n\r\n  this.boundingSphere = new THREE.Sphere(new THREE.Vector3(), radius);\r\n\r\n};\r\n\r\nTHREE.RingGeometry.prototype = Object.create(THREE.Geometry.prototype);\r\nTHREE.RingGeometry.prototype.constructor = THREE.RingGeometry;\r\n\r\n\r\n// File:src/extras/geometries/SphereGeometry.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.SphereGeometry = function(radius, widthSegments, heightSegments, phiStart, phiLength, thetaStart, thetaLength) {\r\n\r\n  THREE.Geometry.call(this);\r\n\r\n  this.type = 'SphereGeometry';\r\n\r\n  this.parameters = {\r\n    radius: radius,\r\n    widthSegments: widthSegments,\r\n    heightSegments: heightSegments,\r\n    phiStart: phiStart,\r\n    phiLength: phiLength,\r\n    thetaStart: thetaStart,\r\n    thetaLength: thetaLength\r\n  };\r\n\r\n  radius = radius || 50;\r\n\r\n  widthSegments = Math.max(3, Math.floor(widthSegments) || 8);\r\n  heightSegments = Math.max(2, Math.floor(heightSegments) || 6);\r\n\r\n  phiStart = phiStart !== undefined ? phiStart : 0;\r\n  phiLength = phiLength !== undefined ? phiLength : Math.PI * 2;\r\n\r\n  thetaStart = thetaStart !== undefined ? thetaStart : 0;\r\n  thetaLength = thetaLength !== undefined ? thetaLength : Math.PI;\r\n\r\n  var x, y, vertices = [],\r\n    uvs = [];\r\n\r\n  for (y = 0; y <= heightSegments; y++) {\r\n\r\n    var verticesRow = [];\r\n    var uvsRow = [];\r\n\r\n    for (x = 0; x <= widthSegments; x++) {\r\n\r\n      var u = x / widthSegments;\r\n      var v = y / heightSegments;\r\n\r\n      var vertex = new THREE.Vector3();\r\n      vertex.x = -radius * Math.cos(phiStart + u * phiLength) * Math.sin(thetaStart + v * thetaLength);\r\n      vertex.y = radius * Math.cos(thetaStart + v * thetaLength);\r\n      vertex.z = radius * Math.sin(phiStart + u * phiLength) * Math.sin(thetaStart + v * thetaLength);\r\n\r\n      this.vertices.push(vertex);\r\n\r\n      verticesRow.push(this.vertices.length - 1);\r\n      uvsRow.push(new THREE.Vector2(u, 1 - v));\r\n\r\n    }\r\n\r\n    vertices.push(verticesRow);\r\n    uvs.push(uvsRow);\r\n\r\n  }\r\n\r\n  for (y = 0; y < heightSegments; y++) {\r\n\r\n    for (x = 0; x < widthSegments; x++) {\r\n\r\n      var v1 = vertices[y][x + 1];\r\n      var v2 = vertices[y][x];\r\n      var v3 = vertices[y + 1][x];\r\n      var v4 = vertices[y + 1][x + 1];\r\n\r\n      var n1 = this.vertices[v1].clone().normalize();\r\n      var n2 = this.vertices[v2].clone().normalize();\r\n      var n3 = this.vertices[v3].clone().normalize();\r\n      var n4 = this.vertices[v4].clone().normalize();\r\n\r\n      var uv1 = uvs[y][x + 1].clone();\r\n      var uv2 = uvs[y][x].clone();\r\n      var uv3 = uvs[y + 1][x].clone();\r\n      var uv4 = uvs[y + 1][x + 1].clone();\r\n\r\n      if (Math.abs(this.vertices[v1].y) === radius) {\r\n\r\n        uv1.x = (uv1.x + uv2.x) / 2;\r\n        this.faces.push(new THREE.Face3(v1, v3, v4, [n1, n3, n4]));\r\n        this.faceVertexUvs[0].push([uv1, uv3, uv4]);\r\n\r\n      }\r\n      else if (Math.abs(this.vertices[v3].y) === radius) {\r\n\r\n        uv3.x = (uv3.x + uv4.x) / 2;\r\n        this.faces.push(new THREE.Face3(v1, v2, v3, [n1, n2, n3]));\r\n        this.faceVertexUvs[0].push([uv1, uv2, uv3]);\r\n\r\n      }\r\n      else {\r\n\r\n        this.faces.push(new THREE.Face3(v1, v2, v4, [n1, n2, n4]));\r\n        this.faceVertexUvs[0].push([uv1, uv2, uv4]);\r\n\r\n        this.faces.push(new THREE.Face3(v2, v3, v4, [n2.clone(), n3, n4.clone()]));\r\n        this.faceVertexUvs[0].push([uv2.clone(), uv3, uv4.clone()]);\r\n\r\n      }\r\n\r\n    }\r\n\r\n  }\r\n\r\n  this.computeFaceNormals();\r\n\r\n  this.boundingSphere = new THREE.Sphere(new THREE.Vector3(), radius);\r\n\r\n};\r\n\r\nTHREE.SphereGeometry.prototype = Object.create(THREE.Geometry.prototype);\r\nTHREE.SphereGeometry.prototype.constructor = THREE.SphereGeometry;\r\n\r\n// File:src/extras/geometries/TextGeometry.js\r\n\r\n/**\r\n * @author zz85 / http://www.lab4games.net/zz85/blog\r\n * @author alteredq / http://alteredqualia.com/\r\n *\r\n * For creating 3D text geometry in three.js\r\n *\r\n * Text = 3D Text\r\n *\r\n * parameters = {\r\n *  size: \t\t\t<float>, \t// size of the text\r\n *  height: \t\t<float>, \t// thickness to extrude text\r\n *  curveSegments: \t<int>,\t\t// number of points on the curves\r\n *\r\n *  font: \t\t\t<string>,\t\t// font name\r\n *  weight: \t\t<string>,\t\t// font weight (normal, bold)\r\n *  style: \t\t\t<string>,\t\t// font style  (normal, italics)\r\n *\r\n *  bevelEnabled:\t<bool>,\t\t\t// turn on bevel\r\n *  bevelThickness: <float>, \t\t// how deep into text bevel goes\r\n *  bevelSize:\t\t<float>, \t\t// how far from text outline is bevel\r\n *  }\r\n *\r\n */\r\n\r\n/*\tUsage Examples\r\n\r\n\t// TextGeometry wrapper\r\n\r\n\tvar text3d = new TextGeometry( text, options );\r\n\r\n\t// Complete manner\r\n\r\n\tvar textShapes = THREE.FontUtils.generateShapes( text, options );\r\n\tvar text3d = new ExtrudeGeometry( textShapes, options );\r\n\r\n*/\r\n\r\n\r\nTHREE.TextGeometry = function(text, parameters) {\r\n\r\n  parameters = parameters || {};\r\n\r\n  var textShapes = THREE.FontUtils.generateShapes(text, parameters);\r\n\r\n  // translate parameters to ExtrudeGeometry API\r\n\r\n  parameters.amount = parameters.height !== undefined ? parameters.height : 50;\r\n\r\n  // defaults\r\n\r\n  if (parameters.bevelThickness === undefined) parameters.bevelThickness = 10;\r\n  if (parameters.bevelSize === undefined) parameters.bevelSize = 8;\r\n  if (parameters.bevelEnabled === undefined) parameters.bevelEnabled = false;\r\n\r\n  THREE.ExtrudeGeometry.call(this, textShapes, parameters);\r\n\r\n  this.type = 'TextGeometry';\r\n\r\n};\r\n\r\nTHREE.TextGeometry.prototype = Object.create(THREE.ExtrudeGeometry.prototype);\r\nTHREE.TextGeometry.prototype.constructor = THREE.TextGeometry;\r\n\r\n// File:src/extras/geometries/TorusGeometry.js\r\n\r\n/**\r\n * @author oosmoxiecode\r\n * @author mrdoob / http://mrdoob.com/\r\n * based on http://code.google.com/p/away3d/source/browse/trunk/fp10/Away3DLite/src/away3dlite/primitives/Torus.as?r=2888\r\n */\r\n\r\nTHREE.TorusGeometry = function(radius, tube, radialSegments, tubularSegments, arc) {\r\n\r\n  THREE.Geometry.call(this);\r\n\r\n  this.type = 'TorusGeometry';\r\n\r\n  this.parameters = {\r\n    radius: radius,\r\n    tube: tube,\r\n    radialSegments: radialSegments,\r\n    tubularSegments: tubularSegments,\r\n    arc: arc\r\n  };\r\n\r\n  radius = radius || 100;\r\n  tube = tube || 40;\r\n  radialSegments = radialSegments || 8;\r\n  tubularSegments = tubularSegments || 6;\r\n  arc = arc || Math.PI * 2;\r\n\r\n  var center = new THREE.Vector3(),\r\n    uvs = [],\r\n    normals = [];\r\n\r\n  for (var j = 0; j <= radialSegments; j++) {\r\n\r\n    for (var i = 0; i <= tubularSegments; i++) {\r\n\r\n      var u = i / tubularSegments * arc;\r\n      var v = j / radialSegments * Math.PI * 2;\r\n\r\n      center.x = radius * Math.cos(u);\r\n      center.y = radius * Math.sin(u);\r\n\r\n      var vertex = new THREE.Vector3();\r\n      vertex.x = (radius + tube * Math.cos(v)) * Math.cos(u);\r\n      vertex.y = (radius + tube * Math.cos(v)) * Math.sin(u);\r\n      vertex.z = tube * Math.sin(v);\r\n\r\n      this.vertices.push(vertex);\r\n\r\n      uvs.push(new THREE.Vector2(i / tubularSegments, j / radialSegments));\r\n      normals.push(vertex.clone().sub(center).normalize());\r\n\r\n    }\r\n\r\n  }\r\n\r\n  for (var j = 1; j <= radialSegments; j++) {\r\n\r\n    for (var i = 1; i <= tubularSegments; i++) {\r\n\r\n      var a = (tubularSegments + 1) * j + i - 1;\r\n      var b = (tubularSegments + 1) * (j - 1) + i - 1;\r\n      var c = (tubularSegments + 1) * (j - 1) + i;\r\n      var d = (tubularSegments + 1) * j + i;\r\n\r\n      var face = new THREE.Face3(a, b, d, [normals[a].clone(), normals[b].clone(), normals[d].clone()]);\r\n      this.faces.push(face);\r\n      this.faceVertexUvs[0].push([uvs[a].clone(), uvs[b].clone(), uvs[d].clone()]);\r\n\r\n      face = new THREE.Face3(b, c, d, [normals[b].clone(), normals[c].clone(), normals[d].clone()]);\r\n      this.faces.push(face);\r\n      this.faceVertexUvs[0].push([uvs[b].clone(), uvs[c].clone(), uvs[d].clone()]);\r\n\r\n    }\r\n\r\n  }\r\n\r\n  this.computeFaceNormals();\r\n\r\n};\r\n\r\nTHREE.TorusGeometry.prototype = Object.create(THREE.Geometry.prototype);\r\nTHREE.TorusGeometry.prototype.constructor = THREE.TorusGeometry;\r\n\r\n// File:src/extras/geometries/TorusKnotGeometry.js\r\n\r\n/**\r\n * @author oosmoxiecode\r\n * based on http://code.google.com/p/away3d/source/browse/trunk/fp10/Away3D/src/away3d/primitives/TorusKnot.as?spec=svn2473&r=2473\r\n */\r\n\r\nTHREE.TorusKnotGeometry = function(radius, tube, radialSegments, tubularSegments, p, q, heightScale) {\r\n\r\n  THREE.Geometry.call(this);\r\n\r\n  this.type = 'TorusKnotGeometry';\r\n\r\n  this.parameters = {\r\n    radius: radius,\r\n    tube: tube,\r\n    radialSegments: radialSegments,\r\n    tubularSegments: tubularSegments,\r\n    p: p,\r\n    q: q,\r\n    heightScale: heightScale\r\n  };\r\n\r\n  radius = radius || 100;\r\n  tube = tube || 40;\r\n  radialSegments = radialSegments || 64;\r\n  tubularSegments = tubularSegments || 8;\r\n  p = p || 2;\r\n  q = q || 3;\r\n  heightScale = heightScale || 1;\r\n\r\n  var grid = new Array(radialSegments);\r\n  var tang = new THREE.Vector3();\r\n  var n = new THREE.Vector3();\r\n  var bitan = new THREE.Vector3();\r\n\r\n  for (var i = 0; i < radialSegments; ++i) {\r\n\r\n    grid[i] = new Array(tubularSegments);\r\n    var u = i / radialSegments * 2 * p * Math.PI;\r\n    var p1 = getPos(u, q, p, radius, heightScale);\r\n    var p2 = getPos(u + 0.01, q, p, radius, heightScale);\r\n    tang.subVectors(p2, p1);\r\n    n.addVectors(p2, p1);\r\n\r\n    bitan.crossVectors(tang, n);\r\n    n.crossVectors(bitan, tang);\r\n    bitan.normalize();\r\n    n.normalize();\r\n\r\n    for (var j = 0; j < tubularSegments; ++j) {\r\n\r\n      var v = j / tubularSegments * 2 * Math.PI;\r\n      var cx = -tube * Math.cos(v); // TODO: Hack: Negating it so it faces outside.\r\n      var cy = tube * Math.sin(v);\r\n\r\n      var pos = new THREE.Vector3();\r\n      pos.x = p1.x + cx * n.x + cy * bitan.x;\r\n      pos.y = p1.y + cx * n.y + cy * bitan.y;\r\n      pos.z = p1.z + cx * n.z + cy * bitan.z;\r\n\r\n      grid[i][j] = this.vertices.push(pos) - 1;\r\n\r\n    }\r\n\r\n  }\r\n\r\n  for (var i = 0; i < radialSegments; ++i) {\r\n\r\n    for (var j = 0; j < tubularSegments; ++j) {\r\n\r\n      var ip = (i + 1) % radialSegments;\r\n      var jp = (j + 1) % tubularSegments;\r\n\r\n      var a = grid[i][j];\r\n      var b = grid[ip][j];\r\n      var c = grid[ip][jp];\r\n      var d = grid[i][jp];\r\n\r\n      var uva = new THREE.Vector2(i / radialSegments, j / tubularSegments);\r\n      var uvb = new THREE.Vector2((i + 1) / radialSegments, j / tubularSegments);\r\n      var uvc = new THREE.Vector2((i + 1) / radialSegments, (j + 1) / tubularSegments);\r\n      var uvd = new THREE.Vector2(i / radialSegments, (j + 1) / tubularSegments);\r\n\r\n      this.faces.push(new THREE.Face3(a, b, d));\r\n      this.faceVertexUvs[0].push([uva, uvb, uvd]);\r\n\r\n      this.faces.push(new THREE.Face3(b, c, d));\r\n      this.faceVertexUvs[0].push([uvb.clone(), uvc, uvd.clone()]);\r\n\r\n    }\r\n  }\r\n\r\n  this.computeFaceNormals();\r\n  this.computeVertexNormals();\r\n\r\n  function getPos(u, in_q, in_p, radius, heightScale) {\r\n\r\n    var cu = Math.cos(u);\r\n    var su = Math.sin(u);\r\n    var quOverP = in_q / in_p * u;\r\n    var cs = Math.cos(quOverP);\r\n\r\n    var tx = radius * (2 + cs) * 0.5 * cu;\r\n    var ty = radius * (2 + cs) * su * 0.5;\r\n    var tz = heightScale * radius * Math.sin(quOverP) * 0.5;\r\n\r\n    return new THREE.Vector3(tx, ty, tz);\r\n\r\n  }\r\n\r\n};\r\n\r\nTHREE.TorusKnotGeometry.prototype = Object.create(THREE.Geometry.prototype);\r\nTHREE.TorusKnotGeometry.prototype.constructor = THREE.TorusKnotGeometry;\r\n\r\n// File:src/extras/geometries/TubeGeometry.js\r\n\r\n/**\r\n * @author WestLangley / https://github.com/WestLangley\r\n * @author zz85 / https://github.com/zz85\r\n * @author miningold / https://github.com/miningold\r\n * @author jonobr1 / https://github.com/jonobr1\r\n *\r\n * Modified from the TorusKnotGeometry by @oosmoxiecode\r\n *\r\n * Creates a tube which extrudes along a 3d spline\r\n *\r\n * Uses parallel transport frames as described in\r\n * http://www.cs.indiana.edu/pub/techreports/TR425.pdf\r\n */\r\n\r\nTHREE.TubeGeometry = function(path, segments, radius, radialSegments, closed, taper) {\r\n\r\n  THREE.Geometry.call(this);\r\n\r\n  this.type = 'TubeGeometry';\r\n\r\n  this.parameters = {\r\n    path: path,\r\n    segments: segments,\r\n    radius: radius,\r\n    radialSegments: radialSegments,\r\n    closed: closed\r\n  };\r\n\r\n  segments = segments || 64;\r\n  radius = radius || 1;\r\n  radialSegments = radialSegments || 8;\r\n  closed = closed || false;\r\n  taper = taper || THREE.TubeGeometry.NoTaper;\r\n\r\n  var grid = [];\r\n\r\n  var scope = this,\r\n\r\n    tangent,\r\n    normal,\r\n    binormal,\r\n\r\n    numpoints = segments + 1,\r\n\r\n    u, v, r,\r\n\r\n    cx, cy,\r\n    pos, pos2 = new THREE.Vector3(),\r\n    i, j,\r\n    ip, jp,\r\n    a, b, c, d,\r\n    uva, uvb, uvc, uvd;\r\n\r\n  var frames = new THREE.TubeGeometry.FrenetFrames(path, segments, closed),\r\n    tangents = frames.tangents,\r\n    normals = frames.normals,\r\n    binormals = frames.binormals;\r\n\r\n  // proxy internals\r\n  this.tangents = tangents;\r\n  this.normals = normals;\r\n  this.binormals = binormals;\r\n\r\n  function vert(x, y, z) {\r\n\r\n    return scope.vertices.push(new THREE.Vector3(x, y, z)) - 1;\r\n\r\n  }\r\n\r\n  // consruct the grid\r\n\r\n  for (i = 0; i < numpoints; i++) {\r\n\r\n    grid[i] = [];\r\n\r\n    u = i / (numpoints - 1);\r\n\r\n    pos = path.getPointAt(u);\r\n\r\n    tangent = tangents[i];\r\n    normal = normals[i];\r\n    binormal = binormals[i];\r\n\r\n    r = radius * taper(u);\r\n\r\n    for (j = 0; j < radialSegments; j++) {\r\n\r\n      v = j / radialSegments * 2 * Math.PI;\r\n\r\n      cx = -r * Math.cos(v); // TODO: Hack: Negating it so it faces outside.\r\n      cy = r * Math.sin(v);\r\n\r\n      pos2.copy(pos);\r\n      pos2.x += cx * normal.x + cy * binormal.x;\r\n      pos2.y += cx * normal.y + cy * binormal.y;\r\n      pos2.z += cx * normal.z + cy * binormal.z;\r\n\r\n      grid[i][j] = vert(pos2.x, pos2.y, pos2.z);\r\n\r\n    }\r\n  }\r\n\r\n\r\n  // construct the mesh\r\n\r\n  for (i = 0; i < segments; i++) {\r\n\r\n    for (j = 0; j < radialSegments; j++) {\r\n\r\n      ip = (closed) ? (i + 1) % segments : i + 1;\r\n      jp = (j + 1) % radialSegments;\r\n\r\n      a = grid[i][j]; // *** NOT NECESSARILY PLANAR ! ***\r\n      b = grid[ip][j];\r\n      c = grid[ip][jp];\r\n      d = grid[i][jp];\r\n\r\n      uva = new THREE.Vector2(i / segments, j / radialSegments);\r\n      uvb = new THREE.Vector2((i + 1) / segments, j / radialSegments);\r\n      uvc = new THREE.Vector2((i + 1) / segments, (j + 1) / radialSegments);\r\n      uvd = new THREE.Vector2(i / segments, (j + 1) / radialSegments);\r\n\r\n      this.faces.push(new THREE.Face3(a, b, d));\r\n      this.faceVertexUvs[0].push([uva, uvb, uvd]);\r\n\r\n      this.faces.push(new THREE.Face3(b, c, d));\r\n      this.faceVertexUvs[0].push([uvb.clone(), uvc, uvd.clone()]);\r\n\r\n    }\r\n  }\r\n\r\n  this.computeFaceNormals();\r\n  this.computeVertexNormals();\r\n\r\n};\r\n\r\nTHREE.TubeGeometry.prototype = Object.create(THREE.Geometry.prototype);\r\nTHREE.TubeGeometry.prototype.constructor = THREE.TubeGeometry;\r\n\r\nTHREE.TubeGeometry.NoTaper = function(u) {\r\n\r\n  return 1;\r\n\r\n};\r\n\r\nTHREE.TubeGeometry.SinusoidalTaper = function(u) {\r\n\r\n  return Math.sin(Math.PI * u);\r\n\r\n};\r\n\r\n// For computing of Frenet frames, exposing the tangents, normals and binormals the spline\r\nTHREE.TubeGeometry.FrenetFrames = function(path, segments, closed) {\r\n\r\n  var normal = new THREE.Vector3(),\r\n\r\n    tangents = [],\r\n    normals = [],\r\n    binormals = [],\r\n\r\n    vec = new THREE.Vector3(),\r\n    mat = new THREE.Matrix4(),\r\n\r\n    numpoints = segments + 1,\r\n    theta,\r\n    epsilon = 0.0001,\r\n    smallest,\r\n\r\n    tx, ty, tz,\r\n    i, u;\r\n\r\n\r\n  // expose internals\r\n  this.tangents = tangents;\r\n  this.normals = normals;\r\n  this.binormals = binormals;\r\n\r\n  // compute the tangent vectors for each segment on the path\r\n\r\n  for (i = 0; i < numpoints; i++) {\r\n\r\n    u = i / (numpoints - 1);\r\n\r\n    tangents[i] = path.getTangentAt(u);\r\n    tangents[i].normalize();\r\n\r\n  }\r\n\r\n  initialNormal3();\r\n\r\n  /*\r\n  function initialNormal1(lastBinormal) {\r\n  \t// fixed start binormal. Has dangers of 0 vectors\r\n  \tnormals[ 0 ] = new THREE.Vector3();\r\n  \tbinormals[ 0 ] = new THREE.Vector3();\r\n  \tif (lastBinormal===undefined) lastBinormal = new THREE.Vector3( 0, 0, 1 );\r\n  \tnormals[ 0 ].crossVectors( lastBinormal, tangents[ 0 ] ).normalize();\r\n  \tbinormals[ 0 ].crossVectors( tangents[ 0 ], normals[ 0 ] ).normalize();\r\n  }\r\n\r\n  function initialNormal2() {\r\n\r\n  \t// This uses the Frenet-Serret formula for deriving binormal\r\n  \tvar t2 = path.getTangentAt( epsilon );\r\n\r\n  \tnormals[ 0 ] = new THREE.Vector3().subVectors( t2, tangents[ 0 ] ).normalize();\r\n  \tbinormals[ 0 ] = new THREE.Vector3().crossVectors( tangents[ 0 ], normals[ 0 ] );\r\n\r\n  \tnormals[ 0 ].crossVectors( binormals[ 0 ], tangents[ 0 ] ).normalize(); // last binormal x tangent\r\n  \tbinormals[ 0 ].crossVectors( tangents[ 0 ], normals[ 0 ] ).normalize();\r\n\r\n  }\r\n  */\r\n\r\n  function initialNormal3() {\r\n    // select an initial normal vector perpenicular to the first tangent vector,\r\n    // and in the direction of the smallest tangent xyz component\r\n\r\n    normals[0] = new THREE.Vector3();\r\n    binormals[0] = new THREE.Vector3();\r\n    smallest = Number.MAX_VALUE;\r\n    tx = Math.abs(tangents[0].x);\r\n    ty = Math.abs(tangents[0].y);\r\n    tz = Math.abs(tangents[0].z);\r\n\r\n    if (tx <= smallest) {\r\n      smallest = tx;\r\n      normal.set(1, 0, 0);\r\n    }\r\n\r\n    if (ty <= smallest) {\r\n      smallest = ty;\r\n      normal.set(0, 1, 0);\r\n    }\r\n\r\n    if (tz <= smallest) {\r\n      normal.set(0, 0, 1);\r\n    }\r\n\r\n    vec.crossVectors(tangents[0], normal).normalize();\r\n\r\n    normals[0].crossVectors(tangents[0], vec);\r\n    binormals[0].crossVectors(tangents[0], normals[0]);\r\n  }\r\n\r\n\r\n  // compute the slowly-varying normal and binormal vectors for each segment on the path\r\n\r\n  for (i = 1; i < numpoints; i++) {\r\n\r\n    normals[i] = normals[i - 1].clone();\r\n\r\n    binormals[i] = binormals[i - 1].clone();\r\n\r\n    vec.crossVectors(tangents[i - 1], tangents[i]);\r\n\r\n    if (vec.length() > epsilon) {\r\n\r\n      vec.normalize();\r\n\r\n      theta = Math.acos(THREE.Math.clamp(tangents[i - 1].dot(tangents[i]), -1, 1)); // clamp for floating pt errors\r\n\r\n      normals[i].applyMatrix4(mat.makeRotationAxis(vec, theta));\r\n\r\n    }\r\n\r\n    binormals[i].crossVectors(tangents[i], normals[i]);\r\n\r\n  }\r\n\r\n\r\n  // if the curve is closed, postprocess the vectors so the first and last normal vectors are the same\r\n\r\n  if (closed) {\r\n\r\n    theta = Math.acos(THREE.Math.clamp(normals[0].dot(normals[numpoints - 1]), -1, 1));\r\n    theta /= (numpoints - 1);\r\n\r\n    if (tangents[0].dot(vec.crossVectors(normals[0], normals[numpoints - 1])) > 0) {\r\n\r\n      theta = -theta;\r\n\r\n    }\r\n\r\n    for (i = 1; i < numpoints; i++) {\r\n\r\n      // twist a little...\r\n      normals[i].applyMatrix4(mat.makeRotationAxis(tangents[i], theta * i));\r\n      binormals[i].crossVectors(tangents[i], normals[i]);\r\n\r\n    }\r\n\r\n  }\r\n};\r\n\r\n// File:src/extras/geometries/PolyhedronGeometry.js\r\n\r\n/**\r\n * @author clockworkgeek / https://github.com/clockworkgeek\r\n * @author timothypratley / https://github.com/timothypratley\r\n * @author WestLangley / http://github.com/WestLangley\r\n */\r\n\r\nTHREE.PolyhedronGeometry = function(vertices, indices, radius, detail) {\r\n\r\n  THREE.Geometry.call(this);\r\n\r\n  this.type = 'PolyhedronGeometry';\r\n\r\n  this.parameters = {\r\n    vertices: vertices,\r\n    indices: indices,\r\n    radius: radius,\r\n    detail: detail\r\n  };\r\n\r\n  radius = radius || 1;\r\n  detail = detail || 0;\r\n\r\n  var that = this;\r\n\r\n  for (var i = 0, l = vertices.length; i < l; i += 3) {\r\n\r\n    prepare(new THREE.Vector3(vertices[i], vertices[i + 1], vertices[i + 2]));\r\n\r\n  }\r\n\r\n  var p = this.vertices;\r\n\r\n  var faces = [];\r\n\r\n  for (var i = 0, j = 0, l = indices.length; i < l; i += 3, j++) {\r\n\r\n    var v1 = p[indices[i]];\r\n    var v2 = p[indices[i + 1]];\r\n    var v3 = p[indices[i + 2]];\r\n\r\n    faces[j] = new THREE.Face3(v1.index, v2.index, v3.index, [v1.clone(), v2.clone(), v3.clone()]);\r\n\r\n  }\r\n\r\n  var centroid = new THREE.Vector3();\r\n\r\n  for (var i = 0, l = faces.length; i < l; i++) {\r\n\r\n    subdivide(faces[i], detail);\r\n\r\n  }\r\n\r\n\r\n  // Handle case when face straddles the seam\r\n\r\n  for (var i = 0, l = this.faceVertexUvs[0].length; i < l; i++) {\r\n\r\n    var uvs = this.faceVertexUvs[0][i];\r\n\r\n    var x0 = uvs[0].x;\r\n    var x1 = uvs[1].x;\r\n    var x2 = uvs[2].x;\r\n\r\n    var max = Math.max(x0, Math.max(x1, x2));\r\n    var min = Math.min(x0, Math.min(x1, x2));\r\n\r\n    if (max > 0.9 && min < 0.1) { // 0.9 is somewhat arbitrary\r\n\r\n      if (x0 < 0.2) uvs[0].x += 1;\r\n      if (x1 < 0.2) uvs[1].x += 1;\r\n      if (x2 < 0.2) uvs[2].x += 1;\r\n\r\n    }\r\n\r\n  }\r\n\r\n\r\n  // Apply radius\r\n\r\n  for (var i = 0, l = this.vertices.length; i < l; i++) {\r\n\r\n    this.vertices[i].multiplyScalar(radius);\r\n\r\n  }\r\n\r\n\r\n  // Merge vertices\r\n\r\n  this.mergeVertices();\r\n\r\n  this.computeFaceNormals();\r\n\r\n  this.boundingSphere = new THREE.Sphere(new THREE.Vector3(), radius);\r\n\r\n\r\n  // Project vector onto sphere's surface\r\n\r\n  function prepare(vector) {\r\n\r\n    var vertex = vector.normalize().clone();\r\n    vertex.index = that.vertices.push(vertex) - 1;\r\n\r\n    // Texture coords are equivalent to map coords, calculate angle and convert to fraction of a circle.\r\n\r\n    var u = azimuth(vector) / 2 / Math.PI + 0.5;\r\n    var v = inclination(vector) / Math.PI + 0.5;\r\n    vertex.uv = new THREE.Vector2(u, 1 - v);\r\n\r\n    return vertex;\r\n\r\n  }\r\n\r\n\r\n  // Approximate a curved face with recursively sub-divided triangles.\r\n\r\n  function make(v1, v2, v3) {\r\n\r\n    var face = new THREE.Face3(v1.index, v2.index, v3.index, [v1.clone(), v2.clone(), v3.clone()]);\r\n    that.faces.push(face);\r\n\r\n    centroid.copy(v1).add(v2).add(v3).divideScalar(3);\r\n\r\n    var azi = azimuth(centroid);\r\n\r\n    that.faceVertexUvs[0].push([\r\n      correctUV(v1.uv, v1, azi),\r\n      correctUV(v2.uv, v2, azi),\r\n      correctUV(v3.uv, v3, azi)\r\n    ]);\r\n\r\n  }\r\n\r\n\r\n  // Analytically subdivide a face to the required detail level.\r\n\r\n  function subdivide(face, detail) {\r\n\r\n    var cols = Math.pow(2, detail);\r\n    var a = prepare(that.vertices[face.a]);\r\n    var b = prepare(that.vertices[face.b]);\r\n    var c = prepare(that.vertices[face.c]);\r\n    var v = [];\r\n\r\n    // Construct all of the vertices for this subdivision.\r\n\r\n    for (var i = 0; i <= cols; i++) {\r\n\r\n      v[i] = [];\r\n\r\n      var aj = prepare(a.clone().lerp(c, i / cols));\r\n      var bj = prepare(b.clone().lerp(c, i / cols));\r\n      var rows = cols - i;\r\n\r\n      for (var j = 0; j <= rows; j++) {\r\n\r\n        if (j == 0 && i == cols) {\r\n\r\n          v[i][j] = aj;\r\n\r\n        }\r\n        else {\r\n\r\n          v[i][j] = prepare(aj.clone().lerp(bj, j / rows));\r\n\r\n        }\r\n\r\n      }\r\n\r\n    }\r\n\r\n    // Construct all of the faces.\r\n\r\n    for (var i = 0; i < cols; i++) {\r\n\r\n      for (var j = 0; j < 2 * (cols - i) - 1; j++) {\r\n\r\n        var k = Math.floor(j / 2);\r\n\r\n        if (j % 2 == 0) {\r\n\r\n          make(\r\n            v[i][k + 1],\r\n            v[i + 1][k],\r\n            v[i][k]\r\n          );\r\n\r\n        }\r\n        else {\r\n\r\n          make(\r\n            v[i][k + 1],\r\n            v[i + 1][k + 1],\r\n            v[i + 1][k]\r\n          );\r\n\r\n        }\r\n\r\n      }\r\n\r\n    }\r\n\r\n  }\r\n\r\n\r\n  // Angle around the Y axis, counter-clockwise when looking from above.\r\n\r\n  function azimuth(vector) {\r\n\r\n    return Math.atan2(vector.z, -vector.x);\r\n\r\n  }\r\n\r\n\r\n  // Angle above the XZ plane.\r\n\r\n  function inclination(vector) {\r\n\r\n    return Math.atan2(-vector.y, Math.sqrt((vector.x * vector.x) + (vector.z * vector.z)));\r\n\r\n  }\r\n\r\n\r\n  // Texture fixing helper. Spheres have some odd behaviours.\r\n\r\n  function correctUV(uv, vector, azimuth) {\r\n\r\n    if ((azimuth < 0) && (uv.x === 1)) uv = new THREE.Vector2(uv.x - 1, uv.y);\r\n    if ((vector.x === 0) && (vector.z === 0)) uv = new THREE.Vector2(azimuth / 2 / Math.PI + 0.5, uv.y);\r\n    return uv.clone();\r\n\r\n  }\r\n\r\n\r\n};\r\n\r\nTHREE.PolyhedronGeometry.prototype = Object.create(THREE.Geometry.prototype);\r\nTHREE.PolyhedronGeometry.prototype.constructor = THREE.PolyhedronGeometry;\r\n\r\n// File:src/extras/geometries/DodecahedronGeometry.js\r\n\r\n/**\r\n * @author Abe Pazos / https://hamoid.com\r\n */\r\n\r\nTHREE.DodecahedronGeometry = function(radius, detail) {\r\n\r\n  this.parameters = {\r\n    radius: radius,\r\n    detail: detail\r\n  };\r\n\r\n  var t = (1 + Math.sqrt(5)) / 2;\r\n  var r = 1 / t;\r\n\r\n  var vertices = [\r\n\r\n    // (1, 1, 1)\r\n    -1, -1, -1, -1, -1, 1, -1, 1, -1, -1, 1, 1,\r\n    1, -1, -1, 1, -1, 1,\r\n    1, 1, -1, 1, 1, 1,\r\n\r\n    // (0, 1/, )\r\n    0, -r, -t, 0, -r, t,\r\n    0, r, -t, 0, r, t,\r\n\r\n    // (1/, , 0)\r\n    -r, -t, 0, -r, t, 0,\r\n    r, -t, 0, r, t, 0,\r\n\r\n    // (, 0, 1/)\r\n    -t, 0, -r, t, 0, -r, -t, 0, r, t, 0, r\r\n  ];\r\n\r\n  var indices = [\r\n    3, 11, 7, 3, 7, 15, 3, 15, 13,\r\n    7, 19, 17, 7, 17, 6, 7, 6, 15,\r\n    17, 4, 8, 17, 8, 10, 17, 10, 6,\r\n    8, 0, 16, 8, 16, 2, 8, 2, 10,\r\n    0, 12, 1, 0, 1, 18, 0, 18, 16,\r\n    6, 10, 2, 6, 2, 13, 6, 13, 15,\r\n    2, 16, 18, 2, 18, 3, 2, 3, 13,\r\n    18, 1, 9, 18, 9, 11, 18, 11, 3,\r\n    4, 14, 12, 4, 12, 0, 4, 0, 8,\r\n    11, 9, 5, 11, 5, 19, 11, 19, 7,\r\n    19, 5, 14, 19, 14, 4, 19, 4, 17,\r\n    1, 12, 14, 1, 14, 5, 1, 5, 9\r\n  ];\r\n\r\n  THREE.PolyhedronGeometry.call(this, vertices, indices, radius, detail);\r\n\r\n};\r\n\r\nTHREE.DodecahedronGeometry.prototype = Object.create(THREE.Geometry.prototype);\r\nTHREE.DodecahedronGeometry.prototype.constructor = THREE.DodecahedronGeometry;\r\n\r\n// File:src/extras/geometries/IcosahedronGeometry.js\r\n\r\n/**\r\n * @author timothypratley / https://github.com/timothypratley\r\n */\r\n\r\nTHREE.IcosahedronGeometry = function(radius, detail) {\r\n\r\n  var t = (1 + Math.sqrt(5)) / 2;\r\n\r\n  var vertices = [-1, t, 0, 1, t, 0, -1, -t, 0, 1, -t, 0,\r\n    0, -1, t, 0, 1, t, 0, -1, -t, 0, 1, -t,\r\n    t, 0, -1, t, 0, 1, -t, 0, -1, -t, 0, 1\r\n  ];\r\n\r\n  var indices = [\r\n    0, 11, 5, 0, 5, 1, 0, 1, 7, 0, 7, 10, 0, 10, 11,\r\n    1, 5, 9, 5, 11, 4, 11, 10, 2, 10, 7, 6, 7, 1, 8,\r\n    3, 9, 4, 3, 4, 2, 3, 2, 6, 3, 6, 8, 3, 8, 9,\r\n    4, 9, 5, 2, 4, 11, 6, 2, 10, 8, 6, 7, 9, 8, 1\r\n  ];\r\n\r\n  THREE.PolyhedronGeometry.call(this, vertices, indices, radius, detail);\r\n\r\n  this.type = 'IcosahedronGeometry';\r\n\r\n  this.parameters = {\r\n    radius: radius,\r\n    detail: detail\r\n  };\r\n};\r\n\r\nTHREE.IcosahedronGeometry.prototype = Object.create(THREE.Geometry.prototype);\r\nTHREE.IcosahedronGeometry.prototype.constructor = THREE.IcosahedronGeometry;\r\n\r\n// File:src/extras/geometries/OctahedronGeometry.js\r\n\r\n/**\r\n * @author timothypratley / https://github.com/timothypratley\r\n */\r\n\r\nTHREE.OctahedronGeometry = function(radius, detail) {\r\n\r\n  this.parameters = {\r\n    radius: radius,\r\n    detail: detail\r\n  };\r\n\r\n  var vertices = [\r\n    1, 0, 0, -1, 0, 0, 0, 1, 0, 0, -1, 0, 0, 0, 1, 0, 0, -1\r\n  ];\r\n\r\n  var indices = [\r\n    0, 2, 4, 0, 4, 3, 0, 3, 5, 0, 5, 2, 1, 2, 5, 1, 5, 3, 1, 3, 4, 1, 4, 2\r\n  ];\r\n\r\n  THREE.PolyhedronGeometry.call(this, vertices, indices, radius, detail);\r\n\r\n  this.type = 'OctahedronGeometry';\r\n\r\n  this.parameters = {\r\n    radius: radius,\r\n    detail: detail\r\n  };\r\n};\r\n\r\nTHREE.OctahedronGeometry.prototype = Object.create(THREE.Geometry.prototype);\r\nTHREE.OctahedronGeometry.prototype.constructor = THREE.OctahedronGeometry;\r\n\r\n// File:src/extras/geometries/TetrahedronGeometry.js\r\n\r\n/**\r\n * @author timothypratley / https://github.com/timothypratley\r\n */\r\n\r\nTHREE.TetrahedronGeometry = function(radius, detail) {\r\n\r\n  var vertices = [\r\n    1, 1, 1, -1, -1, 1, -1, 1, -1, 1, -1, -1\r\n  ];\r\n\r\n  var indices = [\r\n    2, 1, 0, 0, 3, 2, 1, 3, 0, 2, 3, 1\r\n  ];\r\n\r\n  THREE.PolyhedronGeometry.call(this, vertices, indices, radius, detail);\r\n\r\n  this.type = 'TetrahedronGeometry';\r\n\r\n  this.parameters = {\r\n    radius: radius,\r\n    detail: detail\r\n  };\r\n\r\n};\r\n\r\nTHREE.TetrahedronGeometry.prototype = Object.create(THREE.Geometry.prototype);\r\nTHREE.TetrahedronGeometry.prototype.constructor = THREE.TetrahedronGeometry;\r\n\r\n// File:src/extras/geometries/ParametricGeometry.js\r\n\r\n/**\r\n * @author zz85 / https://github.com/zz85\r\n * Parametric Surfaces Geometry\r\n * based on the brilliant article by @prideout http://prideout.net/blog/?p=44\r\n *\r\n * new THREE.ParametricGeometry( parametricFunction, uSegments, ySegements );\r\n *\r\n */\r\n\r\nTHREE.ParametricGeometry = function(func, slices, stacks) {\r\n\r\n  THREE.Geometry.call(this);\r\n\r\n  this.type = 'ParametricGeometry';\r\n\r\n  this.parameters = {\r\n    func: func,\r\n    slices: slices,\r\n    stacks: stacks\r\n  };\r\n\r\n  var verts = this.vertices;\r\n  var faces = this.faces;\r\n  var uvs = this.faceVertexUvs[0];\r\n\r\n  var i, j, p;\r\n  var u, v;\r\n\r\n  var sliceCount = slices + 1;\r\n\r\n  for (i = 0; i <= stacks; i++) {\r\n\r\n    v = i / stacks;\r\n\r\n    for (j = 0; j <= slices; j++) {\r\n\r\n      u = j / slices;\r\n\r\n      p = func(u, v);\r\n      verts.push(p);\r\n\r\n    }\r\n  }\r\n\r\n  var a, b, c, d;\r\n  var uva, uvb, uvc, uvd;\r\n\r\n  for (i = 0; i < stacks; i++) {\r\n\r\n    for (j = 0; j < slices; j++) {\r\n\r\n      a = i * sliceCount + j;\r\n      b = i * sliceCount + j + 1;\r\n      c = (i + 1) * sliceCount + j + 1;\r\n      d = (i + 1) * sliceCount + j;\r\n\r\n      uva = new THREE.Vector2(j / slices, i / stacks);\r\n      uvb = new THREE.Vector2((j + 1) / slices, i / stacks);\r\n      uvc = new THREE.Vector2((j + 1) / slices, (i + 1) / stacks);\r\n      uvd = new THREE.Vector2(j / slices, (i + 1) / stacks);\r\n\r\n      faces.push(new THREE.Face3(a, b, d));\r\n      uvs.push([uva, uvb, uvd]);\r\n\r\n      faces.push(new THREE.Face3(b, c, d));\r\n      uvs.push([uvb.clone(), uvc, uvd.clone()]);\r\n\r\n    }\r\n\r\n  }\r\n\r\n  // console.log(this);\r\n\r\n  // magic bullet\r\n  // var diff = this.mergeVertices();\r\n  // console.log('removed ', diff, ' vertices by merging');\r\n\r\n  this.computeFaceNormals();\r\n  this.computeVertexNormals();\r\n\r\n};\r\n\r\nTHREE.ParametricGeometry.prototype = Object.create(THREE.Geometry.prototype);\r\nTHREE.ParametricGeometry.prototype.constructor = THREE.ParametricGeometry;\r\n\r\n// File:src/extras/helpers/AxisHelper.js\r\n\r\n/**\r\n * @author sroucheray / http://sroucheray.org/\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.AxisHelper = function(size) {\r\n\r\n  size = size || 1;\r\n\r\n  var vertices = new Float32Array([\r\n    0, 0, 0, size, 0, 0,\r\n    0, 0, 0, 0, size, 0,\r\n    0, 0, 0, 0, 0, size\r\n  ]);\r\n\r\n  var colors = new Float32Array([\r\n    1, 0, 0, 1, 0.6, 0,\r\n    0, 1, 0, 0.6, 1, 0,\r\n    0, 0, 1, 0, 0.6, 1\r\n  ]);\r\n\r\n  var geometry = new THREE.BufferGeometry();\r\n  geometry.addAttribute('position', new THREE.BufferAttribute(vertices, 3));\r\n  geometry.addAttribute('color', new THREE.BufferAttribute(colors, 3));\r\n\r\n  var material = new THREE.LineBasicMaterial({\r\n    vertexColors: THREE.VertexColors\r\n  });\r\n\r\n  THREE.Line.call(this, geometry, material, THREE.LinePieces);\r\n\r\n};\r\n\r\nTHREE.AxisHelper.prototype = Object.create(THREE.Line.prototype);\r\nTHREE.AxisHelper.prototype.constructor = THREE.AxisHelper;\r\n\r\n// File:src/extras/helpers/ArrowHelper.js\r\n\r\n/**\r\n * @author WestLangley / http://github.com/WestLangley\r\n * @author zz85 / http://github.com/zz85\r\n * @author bhouston / http://exocortex.com\r\n *\r\n * Creates an arrow for visualizing directions\r\n *\r\n * Parameters:\r\n *  dir - Vector3\r\n *  origin - Vector3\r\n *  length - Number\r\n *  color - color in hex value\r\n *  headLength - Number\r\n *  headWidth - Number\r\n */\r\n\r\nTHREE.ArrowHelper = (function() {\r\n\r\n  var lineGeometry = new THREE.Geometry();\r\n  lineGeometry.vertices.push(new THREE.Vector3(0, 0, 0), new THREE.Vector3(0, 1, 0));\r\n\r\n  var coneGeometry = new THREE.CylinderGeometry(0, 0.5, 1, 5, 1);\r\n  coneGeometry.applyMatrix(new THREE.Matrix4().makeTranslation(0, -0.5, 0));\r\n\r\n  return function(dir, origin, length, color, headLength, headWidth) {\r\n\r\n    // dir is assumed to be normalized\r\n\r\n    THREE.Object3D.call(this);\r\n\r\n    if (color === undefined) color = 0xffff00;\r\n    if (length === undefined) length = 1;\r\n    if (headLength === undefined) headLength = 0.2 * length;\r\n    if (headWidth === undefined) headWidth = 0.2 * headLength;\r\n\r\n    this.position.copy(origin);\r\n\r\n    this.line = new THREE.Line(lineGeometry, new THREE.LineBasicMaterial({\r\n      color: color\r\n    }));\r\n    this.line.matrixAutoUpdate = false;\r\n    this.add(this.line);\r\n\r\n    this.cone = new THREE.Mesh(coneGeometry, new THREE.MeshBasicMaterial({\r\n      color: color\r\n    }));\r\n    this.cone.matrixAutoUpdate = false;\r\n    this.add(this.cone);\r\n\r\n    this.setDirection(dir);\r\n    this.setLength(length, headLength, headWidth);\r\n\r\n  }\r\n\r\n}());\r\n\r\nTHREE.ArrowHelper.prototype = Object.create(THREE.Object3D.prototype);\r\nTHREE.ArrowHelper.prototype.constructor = THREE.ArrowHelper;\r\n\r\nTHREE.ArrowHelper.prototype.setDirection = (function() {\r\n\r\n  var axis = new THREE.Vector3();\r\n  var radians;\r\n\r\n  return function(dir) {\r\n\r\n    // dir is assumed to be normalized\r\n\r\n    if (dir.y > 0.99999) {\r\n\r\n      this.quaternion.set(0, 0, 0, 1);\r\n\r\n    }\r\n    else if (dir.y < -0.99999) {\r\n\r\n      this.quaternion.set(1, 0, 0, 0);\r\n\r\n    }\r\n    else {\r\n\r\n      axis.set(dir.z, 0, -dir.x).normalize();\r\n\r\n      radians = Math.acos(dir.y);\r\n\r\n      this.quaternion.setFromAxisAngle(axis, radians);\r\n\r\n    }\r\n\r\n  };\r\n\r\n}());\r\n\r\nTHREE.ArrowHelper.prototype.setLength = function(length, headLength, headWidth) {\r\n\r\n  if (headLength === undefined) headLength = 0.2 * length;\r\n  if (headWidth === undefined) headWidth = 0.2 * headLength;\r\n\r\n  this.line.scale.set(1, length - headLength, 1);\r\n  this.line.updateMatrix();\r\n\r\n  this.cone.scale.set(headWidth, headLength, headWidth);\r\n  this.cone.position.y = length;\r\n  this.cone.updateMatrix();\r\n\r\n};\r\n\r\nTHREE.ArrowHelper.prototype.setColor = function(color) {\r\n\r\n  this.line.material.color.set(color);\r\n  this.cone.material.color.set(color);\r\n\r\n};\r\n\r\n// File:src/extras/helpers/BoxHelper.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.BoxHelper = function(object) {\r\n\r\n  var geometry = new THREE.BufferGeometry();\r\n  geometry.addAttribute('position', new THREE.BufferAttribute(new Float32Array(72), 3));\r\n\r\n  THREE.Line.call(this, geometry, new THREE.LineBasicMaterial({\r\n    color: 0xffff00\r\n  }), THREE.LinePieces);\r\n\r\n  if (object !== undefined) {\r\n\r\n    this.update(object);\r\n\r\n  }\r\n\r\n};\r\n\r\nTHREE.BoxHelper.prototype = Object.create(THREE.Line.prototype);\r\nTHREE.BoxHelper.prototype.constructor = THREE.BoxHelper;\r\n\r\nTHREE.BoxHelper.prototype.update = function(object) {\r\n\r\n  var geometry = object.geometry;\r\n\r\n  if (geometry.boundingBox === null) {\r\n\r\n    geometry.computeBoundingBox();\r\n\r\n  }\r\n\r\n  var min = geometry.boundingBox.min;\r\n  var max = geometry.boundingBox.max;\r\n\r\n  /*\r\n    5____4\r\n  1/___0/|\r\n  | 6__|_7\r\n  2/___3/\r\n\r\n  0: max.x, max.y, max.z\r\n  1: min.x, max.y, max.z\r\n  2: min.x, min.y, max.z\r\n  3: max.x, min.y, max.z\r\n  4: max.x, max.y, min.z\r\n  5: min.x, max.y, min.z\r\n  6: min.x, min.y, min.z\r\n  7: max.x, min.y, min.z\r\n  */\r\n\r\n  var vertices = this.geometry.attributes.position.array;\r\n\r\n  vertices[0] = max.x;\r\n  vertices[1] = max.y;\r\n  vertices[2] = max.z;\r\n  vertices[3] = min.x;\r\n  vertices[4] = max.y;\r\n  vertices[5] = max.z;\r\n\r\n  vertices[6] = min.x;\r\n  vertices[7] = max.y;\r\n  vertices[8] = max.z;\r\n  vertices[9] = min.x;\r\n  vertices[10] = min.y;\r\n  vertices[11] = max.z;\r\n\r\n  vertices[12] = min.x;\r\n  vertices[13] = min.y;\r\n  vertices[14] = max.z;\r\n  vertices[15] = max.x;\r\n  vertices[16] = min.y;\r\n  vertices[17] = max.z;\r\n\r\n  vertices[18] = max.x;\r\n  vertices[19] = min.y;\r\n  vertices[20] = max.z;\r\n  vertices[21] = max.x;\r\n  vertices[22] = max.y;\r\n  vertices[23] = max.z;\r\n\r\n  //\r\n\r\n  vertices[24] = max.x;\r\n  vertices[25] = max.y;\r\n  vertices[26] = min.z;\r\n  vertices[27] = min.x;\r\n  vertices[28] = max.y;\r\n  vertices[29] = min.z;\r\n\r\n  vertices[30] = min.x;\r\n  vertices[31] = max.y;\r\n  vertices[32] = min.z;\r\n  vertices[33] = min.x;\r\n  vertices[34] = min.y;\r\n  vertices[35] = min.z;\r\n\r\n  vertices[36] = min.x;\r\n  vertices[37] = min.y;\r\n  vertices[38] = min.z;\r\n  vertices[39] = max.x;\r\n  vertices[40] = min.y;\r\n  vertices[41] = min.z;\r\n\r\n  vertices[42] = max.x;\r\n  vertices[43] = min.y;\r\n  vertices[44] = min.z;\r\n  vertices[45] = max.x;\r\n  vertices[46] = max.y;\r\n  vertices[47] = min.z;\r\n\r\n  //\r\n\r\n  vertices[48] = max.x;\r\n  vertices[49] = max.y;\r\n  vertices[50] = max.z;\r\n  vertices[51] = max.x;\r\n  vertices[52] = max.y;\r\n  vertices[53] = min.z;\r\n\r\n  vertices[54] = min.x;\r\n  vertices[55] = max.y;\r\n  vertices[56] = max.z;\r\n  vertices[57] = min.x;\r\n  vertices[58] = max.y;\r\n  vertices[59] = min.z;\r\n\r\n  vertices[60] = min.x;\r\n  vertices[61] = min.y;\r\n  vertices[62] = max.z;\r\n  vertices[63] = min.x;\r\n  vertices[64] = min.y;\r\n  vertices[65] = min.z;\r\n\r\n  vertices[66] = max.x;\r\n  vertices[67] = min.y;\r\n  vertices[68] = max.z;\r\n  vertices[69] = max.x;\r\n  vertices[70] = min.y;\r\n  vertices[71] = min.z;\r\n\r\n  this.geometry.attributes.position.needsUpdate = true;\r\n\r\n  this.geometry.computeBoundingSphere();\r\n\r\n  this.matrix = object.matrixWorld;\r\n  this.matrixAutoUpdate = false;\r\n\r\n};\r\n\r\n// File:src/extras/helpers/BoundingBoxHelper.js\r\n\r\n/**\r\n * @author WestLangley / http://github.com/WestLangley\r\n */\r\n\r\n// a helper to show the world-axis-aligned bounding box for an object\r\n\r\nTHREE.BoundingBoxHelper = function(object, hex) {\r\n\r\n  var color = (hex !== undefined) ? hex : 0x888888;\r\n\r\n  this.object = object;\r\n\r\n  this.box = new THREE.Box3();\r\n\r\n  THREE.Mesh.call(this, new THREE.BoxGeometry(1, 1, 1), new THREE.MeshBasicMaterial({\r\n    color: color,\r\n    wireframe: true\r\n  }));\r\n\r\n};\r\n\r\nTHREE.BoundingBoxHelper.prototype = Object.create(THREE.Mesh.prototype);\r\nTHREE.BoundingBoxHelper.prototype.constructor = THREE.BoundingBoxHelper;\r\n\r\nTHREE.BoundingBoxHelper.prototype.update = function() {\r\n\r\n  this.box.setFromObject(this.object);\r\n\r\n  this.box.size(this.scale);\r\n\r\n  this.box.center(this.position);\r\n\r\n};\r\n\r\n// File:src/extras/helpers/CameraHelper.js\r\n\r\n/**\r\n * @author alteredq / http://alteredqualia.com/\r\n *\r\n *\t- shows frustum, line of sight and up of the camera\r\n *\t- suitable for fast updates\r\n * \t- based on frustum visualization in lightgl.js shadowmap example\r\n *\t\thttp://evanw.github.com/lightgl.js/tests/shadowmap.html\r\n */\r\n\r\nTHREE.CameraHelper = function(camera) {\r\n\r\n  var geometry = new THREE.Geometry();\r\n  var material = new THREE.LineBasicMaterial({\r\n    color: 0xffffff,\r\n    vertexColors: THREE.FaceColors\r\n  });\r\n\r\n  var pointMap = {};\r\n\r\n  // colors\r\n\r\n  var hexFrustum = 0xffaa00;\r\n  var hexCone = 0xff0000;\r\n  var hexUp = 0x00aaff;\r\n  var hexTarget = 0xffffff;\r\n  var hexCross = 0x333333;\r\n\r\n  // near\r\n\r\n  addLine(\"n1\", \"n2\", hexFrustum);\r\n  addLine(\"n2\", \"n4\", hexFrustum);\r\n  addLine(\"n4\", \"n3\", hexFrustum);\r\n  addLine(\"n3\", \"n1\", hexFrustum);\r\n\r\n  // far\r\n\r\n  addLine(\"f1\", \"f2\", hexFrustum);\r\n  addLine(\"f2\", \"f4\", hexFrustum);\r\n  addLine(\"f4\", \"f3\", hexFrustum);\r\n  addLine(\"f3\", \"f1\", hexFrustum);\r\n\r\n  // sides\r\n\r\n  addLine(\"n1\", \"f1\", hexFrustum);\r\n  addLine(\"n2\", \"f2\", hexFrustum);\r\n  addLine(\"n3\", \"f3\", hexFrustum);\r\n  addLine(\"n4\", \"f4\", hexFrustum);\r\n\r\n  // cone\r\n\r\n  addLine(\"p\", \"n1\", hexCone);\r\n  addLine(\"p\", \"n2\", hexCone);\r\n  addLine(\"p\", \"n3\", hexCone);\r\n  addLine(\"p\", \"n4\", hexCone);\r\n\r\n  // up\r\n\r\n  addLine(\"u1\", \"u2\", hexUp);\r\n  addLine(\"u2\", \"u3\", hexUp);\r\n  addLine(\"u3\", \"u1\", hexUp);\r\n\r\n  // target\r\n\r\n  addLine(\"c\", \"t\", hexTarget);\r\n  addLine(\"p\", \"c\", hexCross);\r\n\r\n  // cross\r\n\r\n  addLine(\"cn1\", \"cn2\", hexCross);\r\n  addLine(\"cn3\", \"cn4\", hexCross);\r\n\r\n  addLine(\"cf1\", \"cf2\", hexCross);\r\n  addLine(\"cf3\", \"cf4\", hexCross);\r\n\r\n  function addLine(a, b, hex) {\r\n\r\n    addPoint(a, hex);\r\n    addPoint(b, hex);\r\n\r\n  }\r\n\r\n  function addPoint(id, hex) {\r\n\r\n    geometry.vertices.push(new THREE.Vector3());\r\n    geometry.colors.push(new THREE.Color(hex));\r\n\r\n    if (pointMap[id] === undefined) {\r\n\r\n      pointMap[id] = [];\r\n\r\n    }\r\n\r\n    pointMap[id].push(geometry.vertices.length - 1);\r\n\r\n  }\r\n\r\n  THREE.Line.call(this, geometry, material, THREE.LinePieces);\r\n\r\n  this.camera = camera;\r\n  this.matrix = camera.matrixWorld;\r\n  this.matrixAutoUpdate = false;\r\n\r\n  this.pointMap = pointMap;\r\n\r\n  this.update();\r\n\r\n};\r\n\r\nTHREE.CameraHelper.prototype = Object.create(THREE.Line.prototype);\r\nTHREE.CameraHelper.prototype.constructor = THREE.CameraHelper;\r\n\r\nTHREE.CameraHelper.prototype.update = function() {\r\n\r\n  var geometry, pointMap;\r\n\r\n  var vector = new THREE.Vector3();\r\n  var camera = new THREE.Camera();\r\n\r\n  var setPoint = function(point, x, y, z) {\r\n\r\n    vector.set(x, y, z).unproject(camera);\r\n\r\n    var points = pointMap[point];\r\n\r\n    if (points !== undefined) {\r\n\r\n      for (var i = 0, il = points.length; i < il; i++) {\r\n\r\n        geometry.vertices[points[i]].copy(vector);\r\n\r\n      }\r\n\r\n    }\r\n\r\n  };\r\n\r\n  return function() {\r\n\r\n    geometry = this.geometry;\r\n    pointMap = this.pointMap;\r\n\r\n    var w = 1,\r\n      h = 1;\r\n\r\n    // we need just camera projection matrix\r\n    // world matrix must be identity\r\n\r\n    camera.projectionMatrix.copy(this.camera.projectionMatrix);\r\n\r\n    // center / target\r\n\r\n    setPoint(\"c\", 0, 0, -1);\r\n    setPoint(\"t\", 0, 0, 1);\r\n\r\n    // near\r\n\r\n    setPoint(\"n1\", -w, -h, -1);\r\n    setPoint(\"n2\", w, -h, -1);\r\n    setPoint(\"n3\", -w, h, -1);\r\n    setPoint(\"n4\", w, h, -1);\r\n\r\n    // far\r\n\r\n    setPoint(\"f1\", -w, -h, 1);\r\n    setPoint(\"f2\", w, -h, 1);\r\n    setPoint(\"f3\", -w, h, 1);\r\n    setPoint(\"f4\", w, h, 1);\r\n\r\n    // up\r\n\r\n    setPoint(\"u1\", w * 0.7, h * 1.1, -1);\r\n    setPoint(\"u2\", -w * 0.7, h * 1.1, -1);\r\n    setPoint(\"u3\", 0, h * 2, -1);\r\n\r\n    // cross\r\n\r\n    setPoint(\"cf1\", -w, 0, 1);\r\n    setPoint(\"cf2\", w, 0, 1);\r\n    setPoint(\"cf3\", 0, -h, 1);\r\n    setPoint(\"cf4\", 0, h, 1);\r\n\r\n    setPoint(\"cn1\", -w, 0, -1);\r\n    setPoint(\"cn2\", w, 0, -1);\r\n    setPoint(\"cn3\", 0, -h, -1);\r\n    setPoint(\"cn4\", 0, h, -1);\r\n\r\n    geometry.verticesNeedUpdate = true;\r\n\r\n  };\r\n\r\n}();\r\n\r\n// File:src/extras/helpers/DirectionalLightHelper.js\r\n\r\n/**\r\n * @author alteredq / http://alteredqualia.com/\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author WestLangley / http://github.com/WestLangley\r\n */\r\n\r\nTHREE.DirectionalLightHelper = function(light, size) {\r\n\r\n  THREE.Object3D.call(this);\r\n\r\n  this.light = light;\r\n  this.light.updateMatrixWorld();\r\n\r\n  this.matrix = light.matrixWorld;\r\n  this.matrixAutoUpdate = false;\r\n\r\n  size = size || 1;\r\n\r\n  var geometry = new THREE.Geometry();\r\n  geometry.vertices.push(\r\n    new THREE.Vector3(-size, size, 0),\r\n    new THREE.Vector3(size, size, 0),\r\n    new THREE.Vector3(size, -size, 0),\r\n    new THREE.Vector3(-size, -size, 0),\r\n    new THREE.Vector3(-size, size, 0)\r\n  );\r\n\r\n  var material = new THREE.LineBasicMaterial({\r\n    fog: false\r\n  });\r\n  material.color.copy(this.light.color).multiplyScalar(this.light.intensity);\r\n\r\n  this.lightPlane = new THREE.Line(geometry, material);\r\n  this.add(this.lightPlane);\r\n\r\n  geometry = new THREE.Geometry();\r\n  geometry.vertices.push(\r\n    new THREE.Vector3(),\r\n    new THREE.Vector3()\r\n  );\r\n\r\n  material = new THREE.LineBasicMaterial({\r\n    fog: false\r\n  });\r\n  material.color.copy(this.light.color).multiplyScalar(this.light.intensity);\r\n\r\n  this.targetLine = new THREE.Line(geometry, material);\r\n  this.add(this.targetLine);\r\n\r\n  this.update();\r\n\r\n};\r\n\r\nTHREE.DirectionalLightHelper.prototype = Object.create(THREE.Object3D.prototype);\r\nTHREE.DirectionalLightHelper.prototype.constructor = THREE.DirectionalLightHelper;\r\n\r\nTHREE.DirectionalLightHelper.prototype.dispose = function() {\r\n\r\n  this.lightPlane.geometry.dispose();\r\n  this.lightPlane.material.dispose();\r\n  this.targetLine.geometry.dispose();\r\n  this.targetLine.material.dispose();\r\n};\r\n\r\nTHREE.DirectionalLightHelper.prototype.update = function() {\r\n\r\n  var v1 = new THREE.Vector3();\r\n  var v2 = new THREE.Vector3();\r\n  var v3 = new THREE.Vector3();\r\n\r\n  return function() {\r\n\r\n    v1.setFromMatrixPosition(this.light.matrixWorld);\r\n    v2.setFromMatrixPosition(this.light.target.matrixWorld);\r\n    v3.subVectors(v2, v1);\r\n\r\n    this.lightPlane.lookAt(v3);\r\n    this.lightPlane.material.color.copy(this.light.color).multiplyScalar(this.light.intensity);\r\n\r\n    this.targetLine.geometry.vertices[1].copy(v3);\r\n    this.targetLine.geometry.verticesNeedUpdate = true;\r\n    this.targetLine.material.color.copy(this.lightPlane.material.color);\r\n\r\n  };\r\n\r\n}();\r\n\r\n// File:src/extras/helpers/EdgesHelper.js\r\n\r\n/**\r\n * @author WestLangley / http://github.com/WestLangley\r\n * @param object THREE.Mesh whose geometry will be used\r\n * @param hex line color\r\n * @param thresholdAngle the minimim angle (in degrees),\r\n * between the face normals of adjacent faces,\r\n * that is required to render an edge. A value of 10 means\r\n * an edge is only rendered if the angle is at least 10 degrees.\r\n */\r\n\r\nTHREE.EdgesHelper = function(object, hex, thresholdAngle) {\r\n\r\n  var color = (hex !== undefined) ? hex : 0xffffff;\r\n  thresholdAngle = (thresholdAngle !== undefined) ? thresholdAngle : 1;\r\n\r\n  var thresholdDot = Math.cos(THREE.Math.degToRad(thresholdAngle));\r\n\r\n  var edge = [0, 0],\r\n    hash = {};\r\n  var sortFunction = function(a, b) {\r\n    return a - b\r\n  };\r\n\r\n  var keys = ['a', 'b', 'c'];\r\n  var geometry = new THREE.BufferGeometry();\r\n\r\n  var geometry2;\r\n\r\n  if (object.geometry instanceof THREE.BufferGeometry) {\r\n\r\n    geometry2 = new THREE.Geometry();\r\n    geometry2.fromBufferGeometry(object.geometry);\r\n\r\n  }\r\n  else {\r\n\r\n    geometry2 = object.geometry.clone();\r\n\r\n  }\r\n\r\n  geometry2.mergeVertices();\r\n  geometry2.computeFaceNormals();\r\n\r\n  var vertices = geometry2.vertices;\r\n  var faces = geometry2.faces;\r\n  var numEdges = 0;\r\n\r\n  for (var i = 0, l = faces.length; i < l; i++) {\r\n\r\n    var face = faces[i];\r\n\r\n    for (var j = 0; j < 3; j++) {\r\n\r\n      edge[0] = face[keys[j]];\r\n      edge[1] = face[keys[(j + 1) % 3]];\r\n      edge.sort(sortFunction);\r\n\r\n      var key = edge.toString();\r\n\r\n      if (hash[key] === undefined) {\r\n\r\n        hash[key] = {\r\n          vert1: edge[0],\r\n          vert2: edge[1],\r\n          face1: i,\r\n          face2: undefined\r\n        };\r\n        numEdges++;\r\n\r\n      }\r\n      else {\r\n\r\n        hash[key].face2 = i;\r\n\r\n      }\r\n\r\n    }\r\n\r\n  }\r\n\r\n  var coords = new Float32Array(numEdges * 2 * 3);\r\n\r\n  var index = 0;\r\n\r\n  for (var key in hash) {\r\n\r\n    var h = hash[key];\r\n\r\n    if (h.face2 === undefined || faces[h.face1].normal.dot(faces[h.face2].normal) <= thresholdDot) {\r\n\r\n      var vertex = vertices[h.vert1];\r\n      coords[index++] = vertex.x;\r\n      coords[index++] = vertex.y;\r\n      coords[index++] = vertex.z;\r\n\r\n      vertex = vertices[h.vert2];\r\n      coords[index++] = vertex.x;\r\n      coords[index++] = vertex.y;\r\n      coords[index++] = vertex.z;\r\n\r\n    }\r\n\r\n  }\r\n\r\n  geometry.addAttribute('position', new THREE.BufferAttribute(coords, 3));\r\n\r\n  THREE.Line.call(this, geometry, new THREE.LineBasicMaterial({\r\n    color: color\r\n  }), THREE.LinePieces);\r\n\r\n  this.matrix = object.matrixWorld;\r\n  this.matrixAutoUpdate = false;\r\n\r\n};\r\n\r\nTHREE.EdgesHelper.prototype = Object.create(THREE.Line.prototype);\r\nTHREE.EdgesHelper.prototype.constructor = THREE.EdgesHelper;\r\n\r\n// File:src/extras/helpers/FaceNormalsHelper.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author WestLangley / http://github.com/WestLangley\r\n */\r\n\r\nTHREE.FaceNormalsHelper = function(object, size, hex, linewidth) {\r\n\r\n  this.object = object;\r\n\r\n  this.size = (size !== undefined) ? size : 1;\r\n\r\n  var color = (hex !== undefined) ? hex : 0xffff00;\r\n\r\n  var width = (linewidth !== undefined) ? linewidth : 1;\r\n\r\n  var geometry = new THREE.Geometry();\r\n\r\n  var faces = this.object.geometry.faces;\r\n\r\n  for (var i = 0, l = faces.length; i < l; i++) {\r\n\r\n    geometry.vertices.push(new THREE.Vector3(), new THREE.Vector3());\r\n\r\n  }\r\n\r\n  THREE.Line.call(this, geometry, new THREE.LineBasicMaterial({\r\n    color: color,\r\n    linewidth: width\r\n  }), THREE.LinePieces);\r\n\r\n  this.matrixAutoUpdate = false;\r\n\r\n  this.normalMatrix = new THREE.Matrix3();\r\n\r\n  this.update();\r\n\r\n};\r\n\r\nTHREE.FaceNormalsHelper.prototype = Object.create(THREE.Line.prototype);\r\nTHREE.FaceNormalsHelper.prototype.constructor = THREE.FaceNormalsHelper;\r\n\r\nTHREE.FaceNormalsHelper.prototype.update = function() {\r\n\r\n  var vertices = this.geometry.vertices;\r\n\r\n  var object = this.object;\r\n  var objectVertices = object.geometry.vertices;\r\n  var objectFaces = object.geometry.faces;\r\n  var objectWorldMatrix = object.matrixWorld;\r\n\r\n  object.updateMatrixWorld(true);\r\n\r\n  this.normalMatrix.getNormalMatrix(objectWorldMatrix);\r\n\r\n  for (var i = 0, i2 = 0, l = objectFaces.length; i < l; i++, i2 += 2) {\r\n\r\n    var face = objectFaces[i];\r\n\r\n    vertices[i2].copy(objectVertices[face.a])\r\n      .add(objectVertices[face.b])\r\n      .add(objectVertices[face.c])\r\n      .divideScalar(3)\r\n      .applyMatrix4(objectWorldMatrix);\r\n\r\n    vertices[i2 + 1].copy(face.normal)\r\n      .applyMatrix3(this.normalMatrix)\r\n      .normalize()\r\n      .multiplyScalar(this.size)\r\n      .add(vertices[i2]);\r\n\r\n  }\r\n\r\n  this.geometry.verticesNeedUpdate = true;\r\n\r\n  return this;\r\n\r\n};\r\n\r\n\r\n// File:src/extras/helpers/GridHelper.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.GridHelper = function(size, step) {\r\n\r\n  var geometry = new THREE.Geometry();\r\n  var material = new THREE.LineBasicMaterial({\r\n    vertexColors: THREE.VertexColors\r\n  });\r\n\r\n  this.color1 = new THREE.Color(0x444444);\r\n  this.color2 = new THREE.Color(0x888888);\r\n\r\n  for (var i = -size; i <= size; i += step) {\r\n\r\n    geometry.vertices.push(\r\n      new THREE.Vector3(-size, 0, i), new THREE.Vector3(size, 0, i),\r\n      new THREE.Vector3(i, 0, -size), new THREE.Vector3(i, 0, size)\r\n    );\r\n\r\n    var color = i === 0 ? this.color1 : this.color2;\r\n\r\n    geometry.colors.push(color, color, color, color);\r\n\r\n  }\r\n\r\n  THREE.Line.call(this, geometry, material, THREE.LinePieces);\r\n\r\n};\r\n\r\nTHREE.GridHelper.prototype = Object.create(THREE.Line.prototype);\r\nTHREE.GridHelper.prototype.constructor = THREE.GridHelper;\r\n\r\nTHREE.GridHelper.prototype.setColors = function(colorCenterLine, colorGrid) {\r\n\r\n  this.color1.set(colorCenterLine);\r\n  this.color2.set(colorGrid);\r\n\r\n  this.geometry.colorsNeedUpdate = true;\r\n\r\n}\r\n\r\n// File:src/extras/helpers/HemisphereLightHelper.js\r\n\r\n/**\r\n * @author alteredq / http://alteredqualia.com/\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.HemisphereLightHelper = function(light, sphereSize) {\r\n\r\n  THREE.Object3D.call(this);\r\n\r\n  this.light = light;\r\n  this.light.updateMatrixWorld();\r\n\r\n  this.matrix = light.matrixWorld;\r\n  this.matrixAutoUpdate = false;\r\n\r\n  this.colors = [new THREE.Color(), new THREE.Color()];\r\n\r\n  var geometry = new THREE.SphereGeometry(sphereSize, 4, 2);\r\n  geometry.applyMatrix(new THREE.Matrix4().makeRotationX(-Math.PI / 2));\r\n\r\n  for (var i = 0, il = 8; i < il; i++) {\r\n\r\n    geometry.faces[i].color = this.colors[i < 4 ? 0 : 1];\r\n\r\n  }\r\n\r\n  var material = new THREE.MeshBasicMaterial({\r\n    vertexColors: THREE.FaceColors,\r\n    wireframe: true\r\n  });\r\n\r\n  this.lightSphere = new THREE.Mesh(geometry, material);\r\n  this.add(this.lightSphere);\r\n\r\n  this.update();\r\n\r\n};\r\n\r\nTHREE.HemisphereLightHelper.prototype = Object.create(THREE.Object3D.prototype);\r\nTHREE.HemisphereLightHelper.prototype.constructor = THREE.HemisphereLightHelper;\r\n\r\nTHREE.HemisphereLightHelper.prototype.dispose = function() {\r\n  this.lightSphere.geometry.dispose();\r\n  this.lightSphere.material.dispose();\r\n};\r\n\r\nTHREE.HemisphereLightHelper.prototype.update = function() {\r\n\r\n  var vector = new THREE.Vector3();\r\n\r\n  return function() {\r\n\r\n    this.colors[0].copy(this.light.color).multiplyScalar(this.light.intensity);\r\n    this.colors[1].copy(this.light.groundColor).multiplyScalar(this.light.intensity);\r\n\r\n    this.lightSphere.lookAt(vector.setFromMatrixPosition(this.light.matrixWorld).negate());\r\n    this.lightSphere.geometry.colorsNeedUpdate = true;\r\n\r\n  }\r\n\r\n}();\r\n\r\n// File:src/extras/helpers/PointLightHelper.js\r\n\r\n/**\r\n * @author alteredq / http://alteredqualia.com/\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.PointLightHelper = function(light, sphereSize) {\r\n\r\n  this.light = light;\r\n  this.light.updateMatrixWorld();\r\n\r\n  var geometry = new THREE.SphereGeometry(sphereSize, 4, 2);\r\n  var material = new THREE.MeshBasicMaterial({\r\n    wireframe: true,\r\n    fog: false\r\n  });\r\n  material.color.copy(this.light.color).multiplyScalar(this.light.intensity);\r\n\r\n  THREE.Mesh.call(this, geometry, material);\r\n\r\n  this.matrix = this.light.matrixWorld;\r\n  this.matrixAutoUpdate = false;\r\n\r\n  /*\r\n  var distanceGeometry = new THREE.IcosahedronGeometry( 1, 2 );\r\n  var distanceMaterial = new THREE.MeshBasicMaterial( { color: hexColor, fog: false, wireframe: true, opacity: 0.1, transparent: true } );\r\n\r\n  this.lightSphere = new THREE.Mesh( bulbGeometry, bulbMaterial );\r\n  this.lightDistance = new THREE.Mesh( distanceGeometry, distanceMaterial );\r\n\r\n  var d = light.distance;\r\n\r\n  if ( d === 0.0 ) {\r\n\r\n  \tthis.lightDistance.visible = false;\r\n\r\n  } else {\r\n\r\n  \tthis.lightDistance.scale.set( d, d, d );\r\n\r\n  }\r\n\r\n  this.add( this.lightDistance );\r\n  */\r\n\r\n};\r\n\r\nTHREE.PointLightHelper.prototype = Object.create(THREE.Mesh.prototype);\r\nTHREE.PointLightHelper.prototype.constructor = THREE.PointLightHelper;\r\n\r\nTHREE.PointLightHelper.prototype.dispose = function() {\r\n\r\n  this.geometry.dispose();\r\n  this.material.dispose();\r\n};\r\n\r\nTHREE.PointLightHelper.prototype.update = function() {\r\n\r\n  this.material.color.copy(this.light.color).multiplyScalar(this.light.intensity);\r\n\r\n  /*\r\n  var d = this.light.distance;\r\n\r\n  if ( d === 0.0 ) {\r\n\r\n  \tthis.lightDistance.visible = false;\r\n\r\n  } else {\r\n\r\n  \tthis.lightDistance.visible = true;\r\n  \tthis.lightDistance.scale.set( d, d, d );\r\n\r\n  }\r\n  */\r\n\r\n};\r\n\r\n// File:src/extras/helpers/SkeletonHelper.js\r\n\r\n/**\r\n * @author Sean Griffin / http://twitter.com/sgrif\r\n * @author Michael Guerrero / http://realitymeltdown.com\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author ikerr / http://verold.com\r\n */\r\n\r\nTHREE.SkeletonHelper = function(object) {\r\n\r\n  this.bones = this.getBoneList(object);\r\n\r\n  var geometry = new THREE.Geometry();\r\n\r\n  for (var i = 0; i < this.bones.length; i++) {\r\n\r\n    var bone = this.bones[i];\r\n\r\n    if (bone.parent instanceof THREE.Bone) {\r\n\r\n      geometry.vertices.push(new THREE.Vector3());\r\n      geometry.vertices.push(new THREE.Vector3());\r\n      geometry.colors.push(new THREE.Color(0, 0, 1));\r\n      geometry.colors.push(new THREE.Color(0, 1, 0));\r\n\r\n    }\r\n\r\n  }\r\n\r\n  var material = new THREE.LineBasicMaterial({\r\n    vertexColors: THREE.VertexColors,\r\n    depthTest: false,\r\n    depthWrite: false,\r\n    transparent: true\r\n  });\r\n\r\n  THREE.Line.call(this, geometry, material, THREE.LinePieces);\r\n\r\n  this.root = object;\r\n\r\n  this.matrix = object.matrixWorld;\r\n  this.matrixAutoUpdate = false;\r\n\r\n  this.update();\r\n\r\n};\r\n\r\n\r\nTHREE.SkeletonHelper.prototype = Object.create(THREE.Line.prototype);\r\nTHREE.SkeletonHelper.prototype.constructor = THREE.SkeletonHelper;\r\n\r\nTHREE.SkeletonHelper.prototype.getBoneList = function(object) {\r\n\r\n  var boneList = [];\r\n\r\n  if (object instanceof THREE.Bone) {\r\n\r\n    boneList.push(object);\r\n\r\n  }\r\n\r\n  for (var i = 0; i < object.children.length; i++) {\r\n\r\n    boneList.push.apply(boneList, this.getBoneList(object.children[i]));\r\n\r\n  }\r\n\r\n  return boneList;\r\n\r\n};\r\n\r\nTHREE.SkeletonHelper.prototype.update = function() {\r\n\r\n  var geometry = this.geometry;\r\n\r\n  var matrixWorldInv = new THREE.Matrix4().getInverse(this.root.matrixWorld);\r\n\r\n  var boneMatrix = new THREE.Matrix4();\r\n\r\n  var j = 0;\r\n\r\n  for (var i = 0; i < this.bones.length; i++) {\r\n\r\n    var bone = this.bones[i];\r\n\r\n    if (bone.parent instanceof THREE.Bone) {\r\n\r\n      boneMatrix.multiplyMatrices(matrixWorldInv, bone.matrixWorld);\r\n      geometry.vertices[j].setFromMatrixPosition(boneMatrix);\r\n\r\n      boneMatrix.multiplyMatrices(matrixWorldInv, bone.parent.matrixWorld);\r\n      geometry.vertices[j + 1].setFromMatrixPosition(boneMatrix);\r\n\r\n      j += 2;\r\n\r\n    }\r\n\r\n  }\r\n\r\n  geometry.verticesNeedUpdate = true;\r\n\r\n  geometry.computeBoundingSphere();\r\n\r\n};\r\n\r\n// File:src/extras/helpers/SpotLightHelper.js\r\n\r\n/**\r\n * @author alteredq / http://alteredqualia.com/\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author WestLangley / http://github.com/WestLangley\r\n */\r\n\r\nTHREE.SpotLightHelper = function(light) {\r\n\r\n  THREE.Object3D.call(this);\r\n\r\n  this.light = light;\r\n  this.light.updateMatrixWorld();\r\n\r\n  this.matrix = light.matrixWorld;\r\n  this.matrixAutoUpdate = false;\r\n\r\n  var geometry = new THREE.CylinderGeometry(0, 1, 1, 8, 1, true);\r\n\r\n  geometry.applyMatrix(new THREE.Matrix4().makeTranslation(0, -0.5, 0));\r\n  geometry.applyMatrix(new THREE.Matrix4().makeRotationX(-Math.PI / 2));\r\n\r\n  var material = new THREE.MeshBasicMaterial({\r\n    wireframe: true,\r\n    fog: false\r\n  });\r\n\r\n  this.cone = new THREE.Mesh(geometry, material);\r\n  this.add(this.cone);\r\n\r\n  this.update();\r\n\r\n};\r\n\r\nTHREE.SpotLightHelper.prototype = Object.create(THREE.Object3D.prototype);\r\nTHREE.SpotLightHelper.prototype.constructor = THREE.SpotLightHelper;\r\n\r\nTHREE.SpotLightHelper.prototype.dispose = function() {\r\n  this.cone.geometry.dispose();\r\n  this.cone.material.dispose();\r\n};\r\n\r\nTHREE.SpotLightHelper.prototype.update = function() {\r\n\r\n  var vector = new THREE.Vector3();\r\n  var vector2 = new THREE.Vector3();\r\n\r\n  return function() {\r\n\r\n    var coneLength = this.light.distance ? this.light.distance : 10000;\r\n    var coneWidth = coneLength * Math.tan(this.light.angle);\r\n\r\n    this.cone.scale.set(coneWidth, coneWidth, coneLength);\r\n\r\n    vector.setFromMatrixPosition(this.light.matrixWorld);\r\n    vector2.setFromMatrixPosition(this.light.target.matrixWorld);\r\n\r\n    this.cone.lookAt(vector2.sub(vector));\r\n\r\n    this.cone.material.color.copy(this.light.color).multiplyScalar(this.light.intensity);\r\n\r\n  };\r\n\r\n}();\r\n\r\n// File:src/extras/helpers/VertexNormalsHelper.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author WestLangley / http://github.com/WestLangley\r\n */\r\n\r\nTHREE.VertexNormalsHelper = function(object, size, hex, linewidth) {\r\n\r\n  this.object = object;\r\n\r\n  this.size = (size !== undefined) ? size : 1;\r\n\r\n  var color = (hex !== undefined) ? hex : 0xff0000;\r\n\r\n  var width = (linewidth !== undefined) ? linewidth : 1;\r\n\r\n  var geometry = new THREE.Geometry();\r\n\r\n  var faces = object.geometry.faces;\r\n\r\n  for (var i = 0, l = faces.length; i < l; i++) {\r\n\r\n    var face = faces[i];\r\n\r\n    for (var j = 0, jl = face.vertexNormals.length; j < jl; j++) {\r\n\r\n      geometry.vertices.push(new THREE.Vector3(), new THREE.Vector3());\r\n\r\n    }\r\n\r\n  }\r\n\r\n  THREE.Line.call(this, geometry, new THREE.LineBasicMaterial({\r\n    color: color,\r\n    linewidth: width\r\n  }), THREE.LinePieces);\r\n\r\n  this.matrixAutoUpdate = false;\r\n\r\n  this.normalMatrix = new THREE.Matrix3();\r\n\r\n  this.update();\r\n\r\n};\r\n\r\nTHREE.VertexNormalsHelper.prototype = Object.create(THREE.Line.prototype);\r\nTHREE.VertexNormalsHelper.prototype.constructor = THREE.VertexNormalsHelper;\r\n\r\nTHREE.VertexNormalsHelper.prototype.update = (function(object) {\r\n\r\n  var v1 = new THREE.Vector3();\r\n\r\n  return function(object) {\r\n\r\n    var keys = ['a', 'b', 'c', 'd'];\r\n\r\n    this.object.updateMatrixWorld(true);\r\n\r\n    this.normalMatrix.getNormalMatrix(this.object.matrixWorld);\r\n\r\n    var vertices = this.geometry.vertices;\r\n\r\n    var verts = this.object.geometry.vertices;\r\n\r\n    var faces = this.object.geometry.faces;\r\n\r\n    var worldMatrix = this.object.matrixWorld;\r\n\r\n    var idx = 0;\r\n\r\n    for (var i = 0, l = faces.length; i < l; i++) {\r\n\r\n      var face = faces[i];\r\n\r\n      for (var j = 0, jl = face.vertexNormals.length; j < jl; j++) {\r\n\r\n        var vertexId = face[keys[j]];\r\n        var vertex = verts[vertexId];\r\n\r\n        var normal = face.vertexNormals[j];\r\n\r\n        vertices[idx].copy(vertex).applyMatrix4(worldMatrix);\r\n\r\n        v1.copy(normal).applyMatrix3(this.normalMatrix).normalize().multiplyScalar(this.size);\r\n\r\n        v1.add(vertices[idx]);\r\n        idx = idx + 1;\r\n\r\n        vertices[idx].copy(v1);\r\n        idx = idx + 1;\r\n\r\n      }\r\n\r\n    }\r\n\r\n    this.geometry.verticesNeedUpdate = true;\r\n\r\n    return this;\r\n\r\n  }\r\n\r\n}());\r\n\r\n// File:src/extras/helpers/VertexTangentsHelper.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author WestLangley / http://github.com/WestLangley\r\n */\r\n\r\nTHREE.VertexTangentsHelper = function(object, size, hex, linewidth) {\r\n\r\n  this.object = object;\r\n\r\n  this.size = (size !== undefined) ? size : 1;\r\n\r\n  var color = (hex !== undefined) ? hex : 0x0000ff;\r\n\r\n  var width = (linewidth !== undefined) ? linewidth : 1;\r\n\r\n  var geometry = new THREE.Geometry();\r\n\r\n  var faces = object.geometry.faces;\r\n\r\n  for (var i = 0, l = faces.length; i < l; i++) {\r\n\r\n    var face = faces[i];\r\n\r\n    for (var j = 0, jl = face.vertexTangents.length; j < jl; j++) {\r\n\r\n      geometry.vertices.push(new THREE.Vector3());\r\n      geometry.vertices.push(new THREE.Vector3());\r\n\r\n    }\r\n\r\n  }\r\n\r\n  THREE.Line.call(this, geometry, new THREE.LineBasicMaterial({\r\n    color: color,\r\n    linewidth: width\r\n  }), THREE.LinePieces);\r\n\r\n  this.matrixAutoUpdate = false;\r\n\r\n  this.update();\r\n\r\n};\r\n\r\nTHREE.VertexTangentsHelper.prototype = Object.create(THREE.Line.prototype);\r\nTHREE.VertexTangentsHelper.prototype.constructor = THREE.VertexTangentsHelper;\r\n\r\nTHREE.VertexTangentsHelper.prototype.update = (function(object) {\r\n\r\n  var v1 = new THREE.Vector3();\r\n\r\n  return function(object) {\r\n\r\n    var keys = ['a', 'b', 'c', 'd'];\r\n\r\n    this.object.updateMatrixWorld(true);\r\n\r\n    var vertices = this.geometry.vertices;\r\n\r\n    var verts = this.object.geometry.vertices;\r\n\r\n    var faces = this.object.geometry.faces;\r\n\r\n    var worldMatrix = this.object.matrixWorld;\r\n\r\n    var idx = 0;\r\n\r\n    for (var i = 0, l = faces.length; i < l; i++) {\r\n\r\n      var face = faces[i];\r\n\r\n      for (var j = 0, jl = face.vertexTangents.length; j < jl; j++) {\r\n\r\n        var vertexId = face[keys[j]];\r\n        var vertex = verts[vertexId];\r\n\r\n        var tangent = face.vertexTangents[j];\r\n\r\n        vertices[idx].copy(vertex).applyMatrix4(worldMatrix);\r\n\r\n        v1.copy(tangent).transformDirection(worldMatrix).multiplyScalar(this.size);\r\n\r\n        v1.add(vertices[idx]);\r\n        idx = idx + 1;\r\n\r\n        vertices[idx].copy(v1);\r\n        idx = idx + 1;\r\n\r\n      }\r\n\r\n    }\r\n\r\n    this.geometry.verticesNeedUpdate = true;\r\n\r\n    return this;\r\n\r\n  }\r\n\r\n}());\r\n\r\n// File:src/extras/helpers/WireframeHelper.js\r\n\r\n/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.WireframeHelper = function(object, hex) {\r\n\r\n  var color = (hex !== undefined) ? hex : 0xffffff;\r\n\r\n  var edge = [0, 0],\r\n    hash = {};\r\n  var sortFunction = function(a, b) {\r\n    return a - b\r\n  };\r\n\r\n  var keys = ['a', 'b', 'c'];\r\n  var geometry = new THREE.BufferGeometry();\r\n\r\n  if (object.geometry instanceof THREE.Geometry) {\r\n\r\n    var vertices = object.geometry.vertices;\r\n    var faces = object.geometry.faces;\r\n    var numEdges = 0;\r\n\r\n    // allocate maximal size\r\n    var edges = new Uint32Array(6 * faces.length);\r\n\r\n    for (var i = 0, l = faces.length; i < l; i++) {\r\n\r\n      var face = faces[i];\r\n\r\n      for (var j = 0; j < 3; j++) {\r\n\r\n        edge[0] = face[keys[j]];\r\n        edge[1] = face[keys[(j + 1) % 3]];\r\n        edge.sort(sortFunction);\r\n\r\n        var key = edge.toString();\r\n\r\n        if (hash[key] === undefined) {\r\n\r\n          edges[2 * numEdges] = edge[0];\r\n          edges[2 * numEdges + 1] = edge[1];\r\n          hash[key] = true;\r\n          numEdges++;\r\n\r\n        }\r\n\r\n      }\r\n\r\n    }\r\n\r\n    var coords = new Float32Array(numEdges * 2 * 3);\r\n\r\n    for (var i = 0, l = numEdges; i < l; i++) {\r\n\r\n      for (var j = 0; j < 2; j++) {\r\n\r\n        var vertex = vertices[edges[2 * i + j]];\r\n\r\n        var index = 6 * i + 3 * j;\r\n        coords[index + 0] = vertex.x;\r\n        coords[index + 1] = vertex.y;\r\n        coords[index + 2] = vertex.z;\r\n\r\n      }\r\n\r\n    }\r\n\r\n    geometry.addAttribute('position', new THREE.BufferAttribute(coords, 3));\r\n\r\n  }\r\n  else if (object.geometry instanceof THREE.BufferGeometry) {\r\n\r\n    if (object.geometry.attributes.index !== undefined) { // Indexed BufferGeometry\r\n\r\n      var vertices = object.geometry.attributes.position.array;\r\n      var indices = object.geometry.attributes.index.array;\r\n      var drawcalls = object.geometry.drawcalls;\r\n      var numEdges = 0;\r\n\r\n      if (drawcalls.length === 0) {\r\n\r\n        drawcalls = [{\r\n          count: indices.length,\r\n          index: 0,\r\n          start: 0\r\n        }];\r\n\r\n      }\r\n\r\n      // allocate maximal size\r\n      var edges = new Uint32Array(2 * indices.length);\r\n\r\n      for (var o = 0, ol = drawcalls.length; o < ol; ++o) {\r\n\r\n        var start = drawcalls[o].start;\r\n        var count = drawcalls[o].count;\r\n        var index = drawcalls[o].index;\r\n\r\n        for (var i = start, il = start + count; i < il; i += 3) {\r\n\r\n          for (var j = 0; j < 3; j++) {\r\n\r\n            edge[0] = index + indices[i + j];\r\n            edge[1] = index + indices[i + (j + 1) % 3];\r\n            edge.sort(sortFunction);\r\n\r\n            var key = edge.toString();\r\n\r\n            if (hash[key] === undefined) {\r\n\r\n              edges[2 * numEdges] = edge[0];\r\n              edges[2 * numEdges + 1] = edge[1];\r\n              hash[key] = true;\r\n              numEdges++;\r\n\r\n            }\r\n\r\n          }\r\n\r\n        }\r\n\r\n      }\r\n\r\n      var coords = new Float32Array(numEdges * 2 * 3);\r\n\r\n      for (var i = 0, l = numEdges; i < l; i++) {\r\n\r\n        for (var j = 0; j < 2; j++) {\r\n\r\n          var index = 6 * i + 3 * j;\r\n          var index2 = 3 * edges[2 * i + j];\r\n          coords[index + 0] = vertices[index2];\r\n          coords[index + 1] = vertices[index2 + 1];\r\n          coords[index + 2] = vertices[index2 + 2];\r\n\r\n        }\r\n\r\n      }\r\n\r\n      geometry.addAttribute('position', new THREE.BufferAttribute(coords, 3));\r\n\r\n    }\r\n    else { // non-indexed BufferGeometry\r\n\r\n      var vertices = object.geometry.attributes.position.array;\r\n      var numEdges = vertices.length / 3;\r\n      var numTris = numEdges / 3;\r\n\r\n      var coords = new Float32Array(numEdges * 2 * 3);\r\n\r\n      for (var i = 0, l = numTris; i < l; i++) {\r\n\r\n        for (var j = 0; j < 3; j++) {\r\n\r\n          var index = 18 * i + 6 * j;\r\n\r\n          var index1 = 9 * i + 3 * j;\r\n          coords[index + 0] = vertices[index1];\r\n          coords[index + 1] = vertices[index1 + 1];\r\n          coords[index + 2] = vertices[index1 + 2];\r\n\r\n          var index2 = 9 * i + 3 * ((j + 1) % 3);\r\n          coords[index + 3] = vertices[index2];\r\n          coords[index + 4] = vertices[index2 + 1];\r\n          coords[index + 5] = vertices[index2 + 2];\r\n\r\n        }\r\n\r\n      }\r\n\r\n      geometry.addAttribute('position', new THREE.BufferAttribute(coords, 3));\r\n\r\n    }\r\n\r\n  }\r\n\r\n  THREE.Line.call(this, geometry, new THREE.LineBasicMaterial({\r\n    color: color\r\n  }), THREE.LinePieces);\r\n\r\n  this.matrix = object.matrixWorld;\r\n  this.matrixAutoUpdate = false;\r\n\r\n};\r\n\r\nTHREE.WireframeHelper.prototype = Object.create(THREE.Line.prototype);\r\nTHREE.WireframeHelper.prototype.constructor = THREE.WireframeHelper;\r\n\r\n// File:src/extras/objects/ImmediateRenderObject.js\r\n\r\n/**\r\n * @author alteredq / http://alteredqualia.com/\r\n */\r\n\r\nTHREE.ImmediateRenderObject = function() {\r\n\r\n  THREE.Object3D.call(this);\r\n\r\n  this.render = function(renderCallback) {};\r\n\r\n};\r\n\r\nTHREE.ImmediateRenderObject.prototype = Object.create(THREE.Object3D.prototype);\r\nTHREE.ImmediateRenderObject.prototype.constructor = THREE.ImmediateRenderObject;\r\n\r\n// File:src/extras/objects/MorphBlendMesh.js\r\n\r\n/**\r\n * @author alteredq / http://alteredqualia.com/\r\n */\r\n\r\nTHREE.MorphBlendMesh = function(geometry, material) {\r\n\r\n  THREE.Mesh.call(this, geometry, material);\r\n\r\n  this.animationsMap = {};\r\n  this.animationsList = [];\r\n\r\n  // prepare default animation\r\n  // (all frames played together in 1 second)\r\n\r\n  var numFrames = this.geometry.morphTargets.length;\r\n\r\n  var name = \"__default\";\r\n\r\n  var startFrame = 0;\r\n  var endFrame = numFrames - 1;\r\n\r\n  var fps = numFrames / 1;\r\n\r\n  this.createAnimation(name, startFrame, endFrame, fps);\r\n  this.setAnimationWeight(name, 1);\r\n\r\n};\r\n\r\nTHREE.MorphBlendMesh.prototype = Object.create(THREE.Mesh.prototype);\r\nTHREE.MorphBlendMesh.prototype.constructor = THREE.MorphBlendMesh;\r\n\r\nTHREE.MorphBlendMesh.prototype.createAnimation = function(name, start, end, fps) {\r\n\r\n  var animation = {\r\n\r\n    startFrame: start,\r\n    endFrame: end,\r\n\r\n    length: end - start + 1,\r\n\r\n    fps: fps,\r\n    duration: (end - start) / fps,\r\n\r\n    lastFrame: 0,\r\n    currentFrame: 0,\r\n\r\n    active: false,\r\n\r\n    time: 0,\r\n    direction: 1,\r\n    weight: 1,\r\n\r\n    directionBackwards: false,\r\n    mirroredLoop: false\r\n\r\n  };\r\n\r\n  this.animationsMap[name] = animation;\r\n  this.animationsList.push(animation);\r\n\r\n};\r\n\r\nTHREE.MorphBlendMesh.prototype.autoCreateAnimations = function(fps) {\r\n\r\n  var pattern = /([a-z]+)_?(\\d+)/;\r\n\r\n  var firstAnimation, frameRanges = {};\r\n\r\n  var geometry = this.geometry;\r\n\r\n  for (var i = 0, il = geometry.morphTargets.length; i < il; i++) {\r\n\r\n    var morph = geometry.morphTargets[i];\r\n    var chunks = morph.name.match(pattern);\r\n\r\n    if (chunks && chunks.length > 1) {\r\n\r\n      var name = chunks[1];\r\n\r\n      if (!frameRanges[name]) frameRanges[name] = {\r\n        start: Infinity,\r\n        end: -Infinity\r\n      };\r\n\r\n      var range = frameRanges[name];\r\n\r\n      if (i < range.start) range.start = i;\r\n      if (i > range.end) range.end = i;\r\n\r\n      if (!firstAnimation) firstAnimation = name;\r\n\r\n    }\r\n\r\n  }\r\n\r\n  for (var name in frameRanges) {\r\n\r\n    var range = frameRanges[name];\r\n    this.createAnimation(name, range.start, range.end, fps);\r\n\r\n  }\r\n\r\n  this.firstAnimation = firstAnimation;\r\n\r\n};\r\n\r\nTHREE.MorphBlendMesh.prototype.setAnimationDirectionForward = function(name) {\r\n\r\n  var animation = this.animationsMap[name];\r\n\r\n  if (animation) {\r\n\r\n    animation.direction = 1;\r\n    animation.directionBackwards = false;\r\n\r\n  }\r\n\r\n};\r\n\r\nTHREE.MorphBlendMesh.prototype.setAnimationDirectionBackward = function(name) {\r\n\r\n  var animation = this.animationsMap[name];\r\n\r\n  if (animation) {\r\n\r\n    animation.direction = -1;\r\n    animation.directionBackwards = true;\r\n\r\n  }\r\n\r\n};\r\n\r\nTHREE.MorphBlendMesh.prototype.setAnimationFPS = function(name, fps) {\r\n\r\n  var animation = this.animationsMap[name];\r\n\r\n  if (animation) {\r\n\r\n    animation.fps = fps;\r\n    animation.duration = (animation.end - animation.start) / animation.fps;\r\n\r\n  }\r\n\r\n};\r\n\r\nTHREE.MorphBlendMesh.prototype.setAnimationDuration = function(name, duration) {\r\n\r\n  var animation = this.animationsMap[name];\r\n\r\n  if (animation) {\r\n\r\n    animation.duration = duration;\r\n    animation.fps = (animation.end - animation.start) / animation.duration;\r\n\r\n  }\r\n\r\n};\r\n\r\nTHREE.MorphBlendMesh.prototype.setAnimationWeight = function(name, weight) {\r\n\r\n  var animation = this.animationsMap[name];\r\n\r\n  if (animation) {\r\n\r\n    animation.weight = weight;\r\n\r\n  }\r\n\r\n};\r\n\r\nTHREE.MorphBlendMesh.prototype.setAnimationTime = function(name, time) {\r\n\r\n  var animation = this.animationsMap[name];\r\n\r\n  if (animation) {\r\n\r\n    animation.time = time;\r\n\r\n  }\r\n\r\n};\r\n\r\nTHREE.MorphBlendMesh.prototype.getAnimationTime = function(name) {\r\n\r\n  var time = 0;\r\n\r\n  var animation = this.animationsMap[name];\r\n\r\n  if (animation) {\r\n\r\n    time = animation.time;\r\n\r\n  }\r\n\r\n  return time;\r\n\r\n};\r\n\r\nTHREE.MorphBlendMesh.prototype.getAnimationDuration = function(name) {\r\n\r\n  var duration = -1;\r\n\r\n  var animation = this.animationsMap[name];\r\n\r\n  if (animation) {\r\n\r\n    duration = animation.duration;\r\n\r\n  }\r\n\r\n  return duration;\r\n\r\n};\r\n\r\nTHREE.MorphBlendMesh.prototype.playAnimation = function(name) {\r\n\r\n  var animation = this.animationsMap[name];\r\n\r\n  if (animation) {\r\n\r\n    animation.time = 0;\r\n    animation.active = true;\r\n\r\n  }\r\n  else {\r\n\r\n    THREE.warn(\"THREE.MorphBlendMesh: animation[\" + name + \"] undefined in .playAnimation()\");\r\n\r\n  }\r\n\r\n};\r\n\r\nTHREE.MorphBlendMesh.prototype.stopAnimation = function(name) {\r\n\r\n  var animation = this.animationsMap[name];\r\n\r\n  if (animation) {\r\n\r\n    animation.active = false;\r\n\r\n  }\r\n\r\n};\r\n\r\nTHREE.MorphBlendMesh.prototype.update = function(delta) {\r\n\r\n  for (var i = 0, il = this.animationsList.length; i < il; i++) {\r\n\r\n    var animation = this.animationsList[i];\r\n\r\n    if (!animation.active) continue;\r\n\r\n    var frameTime = animation.duration / animation.length;\r\n\r\n    animation.time += animation.direction * delta;\r\n\r\n    if (animation.mirroredLoop) {\r\n\r\n      if (animation.time > animation.duration || animation.time < 0) {\r\n\r\n        animation.direction *= -1;\r\n\r\n        if (animation.time > animation.duration) {\r\n\r\n          animation.time = animation.duration;\r\n          animation.directionBackwards = true;\r\n\r\n        }\r\n\r\n        if (animation.time < 0) {\r\n\r\n          animation.time = 0;\r\n          animation.directionBackwards = false;\r\n\r\n        }\r\n\r\n      }\r\n\r\n    }\r\n    else {\r\n\r\n      animation.time = animation.time % animation.duration;\r\n\r\n      if (animation.time < 0) animation.time += animation.duration;\r\n\r\n    }\r\n\r\n    var keyframe = animation.startFrame + THREE.Math.clamp(Math.floor(animation.time / frameTime), 0, animation.length - 1);\r\n    var weight = animation.weight;\r\n\r\n    if (keyframe !== animation.currentFrame) {\r\n\r\n      this.morphTargetInfluences[animation.lastFrame] = 0;\r\n      this.morphTargetInfluences[animation.currentFrame] = 1 * weight;\r\n\r\n      this.morphTargetInfluences[keyframe] = 0;\r\n\r\n      animation.lastFrame = animation.currentFrame;\r\n      animation.currentFrame = keyframe;\r\n\r\n    }\r\n\r\n    var mix = (animation.time % frameTime) / frameTime;\r\n\r\n    if (animation.directionBackwards) mix = 1 - mix;\r\n\r\n    this.morphTargetInfluences[animation.currentFrame] = mix * weight;\r\n    this.morphTargetInfluences[animation.lastFrame] = (1 - mix) * weight;\r\n\r\n  }\r\n\r\n};\r\n\r\n\r\n// Export the THREE object for **Node.js**, with\r\n// backwards-compatibility for the old `require()` API. If we're in\r\n// the browser, add `_` as a global object via a string identifier,\r\n// for Closure Compiler \"advanced\" mode.\r\nif (typeof exports !== 'undefined') {\r\n  if (typeof module !== 'undefined' && module.exports) {\r\n    exports = module.exports = THREE;\r\n  }\r\n  exports.THREE = THREE;\r\n}\r\nelse {\r\n  this['THREE'] = THREE;\r\n}\r\n\r\n","module.exports = {\r\n  Position: require('./components/Position.js'),\r\n  Velocity: require('./components/Velocity.js'),\r\n  Jump: require('./components/Jump.js'),\r\n  Drawable: require('./components/Drawable.js'),\r\n  Expirable: require('./components/Expirable.js'),\r\n  CameraFollow: require('./components/CameraFollow.js'),\r\n  ShootDelay: require('./components/ShootDelay.js'),\r\n  OneTimeHit: require('./components/OneTimeHit.js'),\r\n  Hurt: require('./components/Hurt.js')\r\n};\r\n\r\n","module.exports = {\n\n  Entity         : require('./lib/Entity.js'),\n  EntityManager  : require('./lib/EntityManager.js'),\n  Messanger      : require('./lib/Messanger.js'),\n  ObjectPool     : require('./lib/ObjectPool.js'),\n  QuadTree       : require('./lib/QuadTree.js'),\n  Spatial        : require('./lib/Spatial.js'),\n  Vec2           : require('./lib/Vec2.js')\n\n};\n","module.exports = Position;\r\n\r\nfunction Position() {\r\n  this.x = 0;\r\n  this.y = 0;\r\n  this.z = 0;\r\n}\r\n\r\n","module.exports = Velocity;\r\n\r\nfunction Velocity() {\r\n  this.x = 0;\r\n  this.y = 0;\r\n  this.z = 0;\r\n\r\n  this.rotationMatrix = null;\r\n}\r\n\r\n","module.exports = Expirable;\r\n\r\nfunction Expirable() {\r\n  this.age = 0;\r\n  this.maxAge = 5;\r\n}\r\n\r\n","module.exports = Drawable;\r\n\r\nfunction Drawable() {\r\n  this.mesh = null;\r\n  this.scene = null;\r\n}\r\n\r\n","module.exports = CameraFollow;\r\n\r\nfunction CameraFollow() {\r\n  this.controls = null;\r\n  this.object = null;\r\n  this.offset = new THREE.Vector3();\r\n}\r\n\r\n","module.exports = Jump;\r\n\r\nfunction Jump() {\r\n  this.canJump = true;\r\n}\r\n\r\n","module.exports = ShootDelay;\r\n\r\nfunction ShootDelay() {\r\n  this.canShoot = true;\r\n\r\n  this.timer = 0;\r\n  this.delayTheshold = 0.2;\r\n}\r\n\r\n","module.exports = Hurt;\r\n\r\nfunction Hurt() {\r\n  this.timer = 0;\r\n  this.invulnerabilityFrames = 1;\r\n\r\n  this.hurtColor = new THREE.Color(0xdd0000);\r\n  this.originalColor = 0xffffff;\r\n}\r\n\r\n","module.exports = OneTimeHit;\r\n\r\nfunction OneTimeHit() {\r\n  this.alreadyHit = [];\r\n}\r\n\r\n","module.exports = ObjectPool;\n\n/**\n * Minimize garbage collector thrashing by re-using existing objects instead of\n * creating new ones. Requires manually lifecycle management.\n * @constructor\n * @param {Function} T\n */\nfunction ObjectPool(T)\n{\n  this.freeList = [];\n  this.count    = 0;\n  this.T        = T;\n}\n\n/**\n * Get a pooled object\n */\nObjectPool.prototype.aquire = function()\n{\n  // Grow the list by 20%ish if we're out\n  if (this.freeList.length <= 0) {\n    this.expand(Math.round(this.count*0.2) + 1);\n  }\n\n  var item = this.freeList.pop();\n\n  // We can provide explicit initing, otherwise re-call constructor (hackish)\n  if (item.__init)\n    item.__init();\n  else\n    this.T.call(item);\n\n  return item;\n};\n\n/**\n * Return an object back to the pool.\n */\nObjectPool.prototype.release = function(item)\n{\n  this.freeList.push(item);\n};\n\n/**\n * @param {Number} Amount of new objects to allocate for this pool.\n */\nObjectPool.prototype.expand = function(count)\n{\n  for (var n = 0; n < count; n++)\n    this.freeList.push(new this.T());\n  this.count += count;\n};\n\n/**\n * @return {Number} Total amount of allocated objects (available and in-use).\n */\nObjectPool.prototype.totalSize = function()\n{\n  return this.count;\n};\n\n/**\n * @return {Number} Total number of objects currently available.\n */\nObjectPool.prototype.totalFree = function()\n{\n  return this.freeList.length;\n};\n\n/**\n * @return {Number} Total number of objects currently in-use.\n */\nObjectPool.prototype.totalUsed = function()\n{\n  return this.count - this.freeList.length;\n};\n\n","module.exports = Spatial;\n\nvar Vec2 = require('./Vec2.js');\n\n/**\n * Basic component giving an entity the concept of being located somewhere.\n * Creates basic spatial heirachy, positions, rotation, etc.\n * @constructor\n */\nfunction Spatial()\n{\n  // Alloc our types\n  this.position     = new Vec2();\n  this.scale        = new Vec2();\n  this.hwidth       = new Vec2();\n\n  this._absScale    = new Vec2();\n  this._absPosition = new Vec2();\n  this._absHwidth   = new Vec2();\n\n  // Setup\n  this.__init();\n}\n\n/**\n * Setup called by pool.\n * @private\n */\nSpatial.prototype.__init = function()\n{\n  this.rotation = 0;\n\n  // Ref to quad tree node this component is in\n  this._node = null;\n\n  // Parent component\n  this.parent = null;\n\n  this.position.clear();\n  this.scale.set(1, 1);\n  this.hwidth.clear();\n  this._absPosition.clear();\n  this._absScale.set(1, 1);\n  this._absHwidth.clear();\n};\n\n/**\n * Fired when spatials overlap.\n * @event\n */\nSpatial.COINCIDENT = 'Spatial#COINCIDENT';\n\n/**\n * Attach this component to another entity's Spatial.\n * @param {{spatial: Spatial}} entity An entity with a Spatial component\n */\nSpatial.prototype.attachTo = function(entity)\n{\n  if (this.parent)\n    throw new Error ('Entity already attached');\n\n  if (!entity || !entity.spatial)\n    throw new Error('Invalid / missing entity');\n\n  this.parent = entity.spatial;\n};\n\n/**\n * The absolute world position of this component.\n * @return {Vec2}\n */\nSpatial.prototype.absPosition = function()\n{\n  var v = this._absPosition.assign(this.position);\n\n  // Trivial case, no parent\n  if (!this.parent) {\n    return v;\n  }\n\n  var parent = this.parent;\n\n  // Rotate our angle by parent's angle\n  var r = this.absRotation();\n  v.rotate(parent.absRotation());\n\n  // Scale by parents scale\n  var pScale = parent.absScale();\n  v.set(v.x * pScale.x, v.y * pScale.y);\n\n  // Add parent's position\n  return v.add(parent.absPosition());\n};\n\n/**\n * The absolute world rotation of this component.\n * @return {Number}\n */\nSpatial.prototype.absRotation = function()\n{\n  // Trivial case\n  if (!this.parent)\n    return this.rotation;\n\n  // This + parent\n  var r = this.rotation + this.parent.absRotation();\n\n  return r % (Math.PI*2);\n};\n\n/**\n * The absolute world hwidth for this component.\n * @return {Vec2}\n */\nSpatial.prototype.absHwidth = function()\n{\n  var h = this._absHwidth.assign(this.hwidth);\n\n  if (!this.parent)\n    return h;\n\n  var scale = this.absScale();\n\n  return h.set(h.x * scale.x, h.y * scale.y);\n};\n\n/**\n * The absolute world scale of this component.\n * @return {Vec2}\n */\nSpatial.prototype.absScale = function()\n{\n  var v = this._absScale.assign(this.scale);\n\n  // Trivial case\n  if (!this.parent) {\n    return v;\n  }\n\n  var pScale = this.parent.absScale();\n\n  return v.set(v.x * pScale.x, v.y * pScale.y);\n};\n\n","module.exports = Messanger;\n\nvar Event = require('./Event.js');\n\n/**\n * General event aggregation with filtering on components or tags.\n * @constructor\n */\nfunction Messanger()\n{\n  this._events = {};\n  this.fired   = 0;\n  this.handled = 0;\n}\n\n/**\n * @param {String} eventName\n * @param {Function} callback\n * @return {Event}\n */\nMessanger.prototype.listenTo = function(eventName, callback)\n{\n  if (!this._events[eventName])\n    this._events[eventName] = [];\n\n  var event = new Event(eventName, callback);\n\n  // Dump and chump\n  this._events[eventName].push(event);\n  return event;\n};\n\n/**\n * @param {String} eventName\n * @param {Object=} entity\n * @param {Option=} option\n */\nMessanger.prototype.trigger = function(eventName, entity, option)\n{\n  this.fired++;\n\n  var events = this._events[eventName];\n  if (!events) return;\n\n  // Try all events\n  for (var n = 0; n < events.length; n++) {\n    var event = events[n];\n    if (event.fire(eventName, entity, option))\n      this.handled++;\n  }\n};\n\n","module.exports = EntityManager;\n\nvar Entity     = require('./Entity.js');\nvar ObjectPool = require('./ObjectPool.js');\nvar Messanger  = require('./Messanger.js');\nvar getName    = require('typedef').getName;\n\n/**\n * Manage, create, and destroy entities. Can use methods to mutate entities\n * (tags, components) directly or via the facade on the Entity.\n * @param {Messanger} messanger\n * @constructor\n */\nfunction EntityManager(messanger)\n{\n  this.messanger = messanger;\n  this._tags = {};\n\n  /**\n   * @type {Array.<Entity>}\n   */\n  this._entities = [];\n\n  /**\n   * @type {Array.<Group>}\n   */\n  this._groups = {};\n\n  this._entityPool = new ObjectPool(Entity);\n\n  this._componentPools = {};\n}\n\n/**\n * Fired AFTER an entity has be created.\n * @event\n */\nEntityManager.ENTITY_CREATED = 'EntityManager#ENTITY_CREATED';\n\n/**\n * Fired BEFORE an entity has been removed.\n * @event\n */\nEntityManager.ENTITY_REMOVE = 'EntityManager#ENTITY_REMOVE';\n\n/**\n * Fired AFTER a component has been removed.\n * @event\n */\nEntityManager.COMPONENT_ADDED = 'EntityManager#COMPONENT_ADDED';\n\n/**\n * Fired BEFORE a component has been removedt\n * @event\n */\nEntityManager.COMPONENT_REMOVE = 'EntityManager#COMPONENT_REMOVE';\n\n/**\n * @constructor\n * @param {Array.<Function>} Components\n * @param {Array<Entity>} entities\n */\nfunction Group(Components, entities)\n{\n  this.Components = Components || [];\n  this.entities = entities || [];\n}\n\n/**\n * Get a new entity.\n * @return {Entity}\n */\nEntityManager.prototype.createEntity = function()\n{\n  var entity = this._entityPool.aquire();\n\n  this._entities.push(entity);\n  entity._manager = this;\n  this._trigger(EntityManager.ENTITY_CREATED, entity);\n  return entity;\n};\n\n/**\n * Cleanly remove entities based on tag. Avoids loop issues.\n * @param {String} tag\n */\nEntityManager.prototype.removeEntitiesByTag = function(tag)\n{\n  var entities = this._tags[tag];\n\n  if (!entities) return;\n\n  for (var x = entities.length - 1; x >= 0; x--) {\n    var entity = entities[x];\n    entity.remove();\n  }\n};\n\n/**\n * Dump all entities out of the manager. Avoids loop issues.\n */\nEntityManager.prototype.removeAllEntities = function()\n{\n  for (var x = this._entities.length - 1; x >= 0; x--) {\n    this._entities[x].remove();\n  }\n};\n\n/**\n * Drop an entity. Returns it to the pool and fires all events for removing\n * components as well.\n * @param {Entity} entity\n */\nEntityManager.prototype.removeEntity = function(entity)\n{\n  var index = this._entities.indexOf(entity);\n\n  if (!~index)\n    throw new Error('Tried to remove entity not in list');\n\n  this.entityRemoveAllComponents(entity);\n\n  // Remove from entity list\n  this._trigger(EntityManager.ENTITY_REMOVE, entity);\n  this._entities.splice(index, 1);\n\n  // Remove entity from any tag groups\n  entity._tags = null;\n  for (var tag in this._tags) {\n    var entities = this._tags[tag];\n    var n = entities.indexOf(entity);\n    if (~n) entities.splice(n, 1);\n  }\n\n  // Prevent any acecss and free\n  entity._manager = null;\n  this._entityPool.release(entity);\n};\n\n/**\n * @param {Entity} entity\n * @param {String} tag\n */\nEntityManager.prototype.entityAddTag = function(entity, tag)\n{\n  var entities = this._tags[tag];\n\n  if (!entities)\n    entities = this._tags[tag] = [];\n\n  // Don't add if already there\n  if (~entities.indexOf(entity)) return;\n\n  entities.push(entity);\n  entity._tags.push(tag);\n};\n\n/**\n * @param {Entity} entity\n * @param {String} tag\n */\nEntityManager.prototype.entityRemoveTag = function(entity, tag)\n{\n  var entities = this._tags[tag];\n  if (!entities) return;\n\n  var index = entities.indexOf(entity);\n  if (!~index) return;\n\n  entities.splice(index, 1);\n  entity._tags.splice(entity._tags.indexOf(tag), 1);\n};\n\n/**\n * @param {Entity} entity\n * @param {Function} Component\n */\nEntityManager.prototype.entityAddComponent = function(entity, Component)\n{\n  if (~entity._Components.indexOf(Component)) return;\n\n  entity._Components.push(Component);\n\n  // Create the reference on the entity to this (aquired) component\n  var cName = componentPropertyName(Component);\n  var cPool = this._componentPools[cName];\n  if (!cPool)\n    cPool = this._componentPools[cName] = new ObjectPool(Component);\n  var component = cPool.aquire();\n  entity[cName] = component;\n\n  // Check each indexed group to see if we need to add this entity to the list\n  for (var groupName in this._groups) {\n    var group = this._groups[groupName];\n\n    if (!~group.Components.indexOf(Component))\n      continue;\n    if (!entity.hasAllComponents(group.Components))\n      continue;\n    if (~group.entities.indexOf(entity))\n      continue;\n\n    group.entities.push(entity);\n  }\n\n  this._trigger(EntityManager.COMPONENT_ADDED, entity, Component);\n};\n\n/**\n * Drop all components on an entity.\n * @param {Entity} entity\n */\nEntityManager.prototype.entityRemoveAllComponents = function(entity)\n{\n  var Cs = entity._Components;\n\n  for (var j = Cs.length - 1; j >= 0; j--) {\n    var C = Cs[j];\n    entity.removeComponent(C);\n  }\n};\n\n/**\n * @param {Entity} entity\n * @param {Function} Component\n */\nEntityManager.prototype.entityRemoveComponent = function(entity, Component)\n{\n  var index = entity._Components.indexOf(Component);\n  if (!~index) return;\n\n  this._trigger(EntityManager.COMPONENT_REMOVE, entity, Component);\n\n  // Check each indexed group to see if we need to remove it\n  for (var groupName in this._groups) {\n    var group = this._groups[groupName];\n\n    if (!~group.Components.indexOf(Component))\n      continue;\n    if (!entity.hasAllComponents(group.Components))\n      continue;\n\n    var loc = group.entities.indexOf(entity);\n    if (~loc) {\n      group.entities.splice(loc, 1);\n    }\n  }\n\n  // Remove T listing on entity and property ref, then free the component.\n  var propName = componentPropertyName(Component);\n  entity._Components.splice(index, 1);\n  var component = entity[propName];\n  delete entity[propName];\n  this._componentPools[propName].release(component);\n};\n\n/**\n * @param {Array.<Function>} Components\n * @return {Array.<Entity>}\n */\nEntityManager.prototype.queryComponents = function(Components)\n{\n  var group = this._groups[groupKey(Components)];\n\n  if (!group) {\n    group = this._indexGroup(Components);\n  }\n\n  return group.entities;\n};\n\n/**\n * @param {String} tag\n * @return {Array.<Entity>}\n */\nEntityManager.prototype.queryTag = function(tag)\n{\n  var entities = this._tags[tag];\n\n  if (entities === undefined)\n    entities = this._tags[tag] = [];\n\n  return entities;\n};\n\n/**\n * @return {Number} Total number of entities.\n */\nEntityManager.prototype.count = function()\n{\n  return this._entities.length;\n};\n\n/**\n * Get information about the object pools of the entities and the various\n * components.\n * @return {Object}\n */\nEntityManager.prototype.poolStats = function()\n{\n  var stats = {};\n  var e = this._entityPool;\n  stats.entity = {\n    used: this._entityPool.totalUsed(),\n    size: this._entityPool.count\n  };\n\n  for (var cName in this._componentPools) {\n    var pool = this._componentPools[cName];\n    stats[cName] = {\n      used: pool.totalUsed(),\n      size: pool.count\n    };\n  }\n\n  return stats;\n};\n\n/**\n * Create an index of entities with a set of components.\n * @param {Array.<Function>} Components\n * @private\n */\nEntityManager.prototype._indexGroup = function(Components)\n{\n  var key = groupKey(Components);\n\n  if (this._groups[key]) return;\n\n  var group = this._groups[key] = new Group(Components);\n\n  for (var n = 0; n < this._entities.length; n++) {\n    var entity = this._entities[n];\n    if (entity.hasAllComponents(Components)) {\n      group.entities.push(entity);\n    }\n  }\n\n  return group;\n};\n\n/**\n * Trigger the messanger if we have one.\n * @param {String} event\n * @param {Object=} a\n * @param {Object=} b\n */\nEntityManager.prototype._trigger = function(event, a, b)\n{\n  if (this.messanger)\n    this.messanger.trigger(event, a, b);\n};\n\n/**\n * @param {Function} Component\n * @return {String}\n * @private\n */\nfunction componentPropertyName(Component)\n{\n  var name = getName(Component);\n  return name.charAt(0).toLowerCase() + name.slice(1);\n}\n\n/**\n * @param {Array.<Function>} Components\n * @return {String}\n * @private\n */\nfunction groupKey(Components)\n{\n  var names = [];\n  for (var n = 0; n < Components.length; n++) {\n    var T = Components[n];\n    names.push(getName(T));\n  }\n\n  return names\n    .map(function(x) { return x.toLowerCase(); })\n    .sort()\n    .join('-');\n}\n\n","module.exports = QuadTree;\n\nvar ObjectPool = require('./ObjectPool.js');\nvar Spatial    = require('./Spatial.js');\nvar Vec2       = require('./Vec2.js');\n\n/**\n * Effectively store positional and sized objects. Each tree has a position and\n * size, as well as up to 4 child nodes (other trees) and an array of entries.\n * @constructor\n */\nfunction QuadTree()\n{\n  this.level       = 0;\n  this.position    = new Vec2();\n  this.size        = new Vec2();\n  this.maxEntities = 15;\n  this.maxLevels   = 10;\n\n  /**\n   * Pool that is used for all internal quad trees. Only root node has one, all\n   * others have a refence.\n   */\n  this.pool = new ObjectPool(QuadTree);\n\n  /**\n   * @type {Array.<QuadTree>}\n   */\n  this.nodes = [];\n\n  /**\n   * @type {Array.<{spatial: Spatial}>}\n   */\n  this.entities = [];\n}\n\n/**\n * Reset for pool.\n * @private\n */\nQuadTree.prototype.__init = function()\n{\n  this.level = 0;\n  this.position.clear();\n  this.size.clear();\n  this.nodes.length = 0;\n  this.entities.length = 0;\n\n  // Only root node has actual ref to pool\n  this.pool = null;\n};\n\n/**\n * Add an entity to the tree\n * @param {{spatial: Spatial}} entity\n */\nQuadTree.prototype.insert = function(entity)\n{\n  // Recurse if we can\n  if (this.nodes.length) {\n    var index = this._getIndex(entity.spatial.absPosition(),\n      entity.spatial.absHwidth());\n    if (~index) return this.nodes[index].insert(entity);\n  }\n\n  // Actually add the entity\n  this.entities.push(entity);\n  this._splitAndRedistributeIfNeeded();\n  entity.spatial._node = this;\n  return entity;\n};\n\n/**\n * Remove an entity from this tree.\n * @param {{spatial: Spatial}} param\n */\nQuadTree.prototype.remove = function(entity)\n{\n  // Remove if we can\n  var n = this.entities.indexOf(entity);\n  if (~n) {\n    this.entities.splice(n, 1);\n    entity.spatial._node = null;\n    if (!this.totalSize())\n      this.clear();\n    return;\n  }\n\n  // Recuse if we can\n  if (this.nodes.length) {\n    var index = this._getIndex(entity.spatial.absPosition(),\n      entity.spatial.absHwidth());\n    if (~index) return this.nodes[index].remove(entity);\n  }\n};\n\n/**\n * Total recursive size of this tree.\n * @return {Number}\n */\nQuadTree.prototype.totalSize = function()\n{\n  var size = this.entities.length;\n\n  for (var n = 0; n < this.nodes.length; n++) {\n    var node = this.nodes[n];\n    size += node.totalSize();\n  }\n\n  return size;\n};\n\n/**\n * Empty the tree recursively.\n */\nQuadTree.prototype.clear = function()\n{\n  // Clear entity area\n  for (var m = 0; m < this.entities.length; m++) {\n    var entity = this.entities[m];\n    entity.spatial._node = null;\n  }\n  this.entities.length = 0;\n\n  // Recurse, free the node, and wipe out our node length\n  for (var n = 0; n < this.nodes.length; n++) {\n    var node = this.nodes[n];\n    node.clear();\n    this.pool.release(node);\n  }\n  this.nodes.length = 0;\n};\n\n/**\n * Get all tree entries that are interesected by a rectangle defined with\n * position and hwidth.\n * @param {Vec2} position\n * @param {Vec2} hwidth\n * @param {Array.<{spatial: Spatial}>=} out__objects Return objects.\n * @return {Array.<{spatial: Spatial}>} The out__objects parameter (filled up now)\n */\nQuadTree.prototype.queryArea = function(position, hwidth, out__entities)\n{\n  var entities = out__entities || [];\n\n  // If query belongs in ONLY a single node, then recurse\n  var index = this._getIndex(position, hwidth);\n  if (~index && this.nodes.length) {\n    this.nodes[index].queryArea(position, hwidth, entities);\n\n  // Otherwise, we have to add ALL of the nodes as it may be overlapping one\n  } else {\n    for (var j = 0; j < this.nodes.length; j++) {\n      var node = this.nodes[j];\n      node.queryArea(position, hwidth, entities);\n    }\n  }\n\n  // Also add everything from this node itself\n  for (var m = 0; m < this.entities.length; m++) {\n    var entity = this.entities[m];\n\n    var overlapping = Vec2.rectIntersect(\n      entity.spatial.absPosition(),\n      entity.spatial.absHwidth(),\n      position,\n      hwidth);\n\n    if (overlapping) {\n      entities.push(entity);\n    }\n  }\n\n  return entities;\n};\n\n/**\n * Do a complete reset of the tree.\n */\nQuadTree.prototype.reIndex = function()\n{\n  this._combine();\n  this._splitAndRedistributeIfNeeded();\n};\n\nvar tSize = new Vec2();\nvar tPos  = new Vec2();\n\n/**\n * Check to see if an entity is still valid.\n * @param {{spatial: Spatial}} entity\n * @return {Boolean} True if the entity is in this tree (non-recursive) in its\n * correct place. False implies we need to re-add it.\n */\nQuadTree.prototype.validateEntity = function(entity)\n{\n  var pos = entity.spatial.position;\n  var hw  = entity.spatial.hwidth;\n\n  // Check to see if we're still inside this node\n  tSize.assign(this.size).smult(0.5);\n  tPos.assign(tSize).add(this.position);\n  var inside = Vec2.rectContains(pos, hw, tPos, tSize);\n\n  if (!inside) return false;\n\n  // No children nodes, then we're good\n  if (!this.nodes.length)\n    return true;\n\n  // Or if children nodes and we overlap, still good\n  var index = this._getIndex(entity.spatial.absPosition(),\n    entity.spatial.absHwidth());\n  if (this.nodes.length && !~index)\n    return true;\n\n  // Didnt make it\n  return false;\n};\n\n/**\n * Return which of the 4 quandrants of this tree an object would go into.\n * @param {Vec2} position\n * @param {Vec2} hwidth\n * @return {Number} Which quandrant, or -1 if won't fit.\n * @private\n */\nQuadTree.prototype._getIndex = function(position, hwidth)\n{\n  var midX = this.position.x + this.size.x / 2;\n  var midY = this.position.y + this.size.y / 2;\n\n  var left   = position.x - hwidth.x < midX && position.x + hwidth.x < midX;\n  var right  = position.x - hwidth.x > midX && position.x + hwidth.x > midX;\n  var top    = position.y - hwidth.y < midY && position.y + hwidth.y < midY;\n  var bottom = position.y - hwidth.y > midY && position.y + hwidth.y > midY;\n\n  if (top && right) return 0;\n  if (top && left) return 1;\n  if (bottom && left) return 2;\n  if (bottom && right) return 3;\n\n  return -1;\n};\n\n/**\n * If we've overpacked this tree, then split into 4 smaller trees (if we\n * haven't already) and redistribute.\n * @private\n */\nQuadTree.prototype._splitAndRedistributeIfNeeded = function()\n{\n  if (this.entities.length > this.maxEntities &&\n    this.level < this.maxLevels)\n  {\n    this._split();\n    this._redistribute();\n  }\n};\n\n/**\n * Create a sub quad tree\n * @return {QuadTree}\n * @private\n */\nQuadTree.prototype._factory = function()\n{\n  var node = this.pool.aquire();\n\n  node.pool        = this.pool;\n  node.level       = this.level + 1;\n  node.maxEntities = this.maxEntities;\n  node.maxLevels   = this.maxLevels;\n\n  return node;\n};\n\n/**\n * Create 4 sub nodes for the tree (does not populate tho)\n * @private\n */\nQuadTree.prototype._split = function()\n{\n  if (this.nodes.length) return;\n\n  var x = this.position.x;\n  var y = this.position.y;\n\n  var w = this.size.x / 2;\n  var h = this.size.y / 2;\n\n  // Create the seperate nodes\n  for (var n = 0; n < 4; n++) {\n    var node = this._factory();\n    node.size.set(w, h);\n\n    switch(n) {\n      case 0:\n        node.position.set(x + w, y);\n        break;\n      case 1:\n        node.position.set(x, y);\n        break;\n      case 2:\n        node.position.set(x, y + h);\n        break;\n      case 3:\n        node.position.set(x + w, y + h);\n        break;\n    }\n\n    this.nodes.push(node);\n  }\n};\n\n/**\n * Distrubute all entities into child nodes if we can.\n * @private\n */\nQuadTree.prototype._redistribute = function()\n{\n  // Loop through all of our entries and if they can fit into a child node,\n  // move them there\n  var i = 0;\n  while (i < this.entities.length) {\n    var entity = this.entities[i];\n    var index = this._getIndex(entity.spatial.absPosition(),\n      entity.spatial.absHwidth());\n\n    // Insert into child, remove from our array if they belong in another node\n    if (~index) {\n      this.nodes[index].insert(entity);\n      this.entities.splice(i, 1);\n    } else {\n      i++;\n    }\n  }\n};\n\n/**\n * Unwinds this node. Move all child nodes into this node and remove child\n * nodes.\n * @private\n */\nQuadTree.prototype._combine = function()\n{\n  for (var n = 0; n < this.nodes.length; n++) {\n    var node = this.nodes[n];\n\n    // Combine all children first\n    node._combine();\n\n    // All entries combined on node, now add it to US\n    for (var m = 0; m < node.entities.length; m++) {\n      var entity = node.entities[m];\n      this.entities.push(entity);\n    }\n\n    // Clear out and ensure we release it\n    node.entities.length = 0;\n    node.clear();\n    this.pool.release(node);\n  }\n\n  // Clear nodes array\n  this.nodes.length = 0;\n};\n\n","module.exports = Vec2;\n\nvar ObjectPool = require('./ObjectPool.js');\n\n/**\n * 2-dimension Cartesian vector with built-in (optional) object pool.\n * @constructor\n * @param {Number} x\n * @param {Number} y\n */\nfunction Vec2(x, y)\n{\n  this.x = +x || 0.0;\n  this.y = +y || 0.0;\n}\n\n/**\n * Reset for pool.\n * @private\n */\nVec2.prototype.__init = function()\n{\n  this.clear();\n};\n\n// Interal static object pool\nvar pool = new ObjectPool(Vec2);\n\n/**\n * Get a vector from the pool.\n * @return {Vec2}\n */\nVec2.aquire = function()\n{\n  return pool.aquire();\n};\n\n/**\n * Return a vector to the pool.\n * @param {Vec2} v\n * @return {Number}\n */\nVec2.release = function(v)\n{\n  if (v) pool.release(v);\n  return pool.count - pool.freeList.length;\n};\n\n/**\n * Reset this vector to (0,0).\n * @return {Vec2} This vector.\n */\nVec2.prototype.clear = function()\n{\n  this.x = this.y = 0.0;\n  return this;\n};\n\n/**\n * Assign this vector the value of another.\n * @param {Vec2} v\n * @return {Vec2} This vector.\n */\nVec2.prototype.assign = function(v)\n{\n  this.x = v.x;\n  this.y = v.y;\n  return this;\n};\n\n/**\n * Determine if this vector is equal to another.\n * @param {Vec2} v\n * @return {Boolean} True if vectors are equal.\n */\nVec2.prototype.equals = function(v)\n{\n  return this.x === v.x && this.y === v.y;\n};\n\n/**\n * Set this vector to a set of coordinates.\n * @param {Number} x\n * @param {Number} y\n * @return {Vec2} This vector.\n */\nVec2.prototype.set = function(x, y)\n{\n  this.x = +x;\n  this.y = +y;\n  return this;\n};\n\n/**\n * Limit this vector to a specific magnitude.\n * @param {Number} size\n * @return {Vec2} This vector.\n */\nVec2.prototype.limit = function(size)\n{\n  size = +size;\n  if (!size)\n    return this;\n  else if (this.magnitude() > size)\n    return this.normalize(size);\n  else\n    return this;\n};\n\n/**\n * Normalize this vector.\n * @param {Number=} m Length.\n * @return {Vec2} This vector.\n */\nVec2.prototype.normalize = function(m)\n{\n  m = m || +1.0;\n  var length = Math.sqrt(this.x * this.x + this.y * this.y);\n  this.x = m * this.x / length;\n  this.y = m * this.y / length;\n  return this;\n};\n\n/**\n * Subtract some vector from this one.\n * @param {Vec2} v\n * @return {Vec2} This vector.\n */\nVec2.prototype.sub = function(v)\n{\n  this.x -= v.x;\n  this.y -= v.y;\n  return this;\n};\n\n/**\n * Add some vector to this one.\n * @param {Vec2} v\n * @return {Vec2} This vector.\n */\nVec2.prototype.add = function(v)\n{\n  this.x += v.x;\n  this.y += v.y;\n  return this;\n};\n\n/**\n * Scalar multiply this vector by a value.\n * @param {Number} n\n * @return {Vec2} This vector.\n */\nVec2.prototype.smult = function(n)\n{\n  n = +n;\n  this.x *= n;\n  this.y *= n;\n  return this;\n};\n\n/**\n * Rotate this vector clockwise about the origin by a certain angle.\n * @param {Number} theta\n * @return {Vec2} This vector.\n */\nVec2.prototype.rotate = function(theta)\n{\n  return this.set(\n    this.x * Math.cos(theta) - this.y * Math.sin(theta),\n    this.x * Math.sin(theta) + this.y * Math.cos(theta)\n  );\n};\n\n/**\n * Get the dot product of this vector and another.\n * @param {Vec2} v\n * @return {Number}\n */\nVec2.prototype.dot = function(v)\n{\n  return +(this.x * v.x + this.y * v.y);\n};\n\n/**\n * Get the determinate of this vector and another.\n * @param {Vec2} v\n * @return {Number}\n */\nVec2.prototype.det = function(v)\n{\n  return +(this.x * v.y - this.y * v.x);\n};\n\n/**\n * Get the magnitude of this vector.\n * @return {Number}\n */\nVec2.prototype.magnitude = function()\n{\n  return Math.sqrt(this.x * this.x + this.y * this.y);\n};\n\n/**\n * Get the squared magnitude of this vector.\n * @return {Number}\n */\nVec2.prototype.magnitude2 = function()\n{\n  return this.x * this.x + this.y * this.y;\n};\n\n/**\n * Get the angle of this vector.\n * @return {Number}\n */\nVec2.prototype.angle = function()\n{\n  return Math.atan2(this.y, this.x);\n};\n\n/**\n * Get the angle between this vector and another.\n * @param {Vec2} v\n * @return {Number}\n */\nVec2.prototype.angleBetween = function(v)\n{\n  return Math.atan2(this.det(v), this.dot(v));\n};\n\n/**\n * Make a pooled copy of this vector\n * @return {Vec2} A new vector.\n */\nVec2.prototype.pcopy = function()\n{\n  return Vec2.aquire().assign(this);\n};\n\n/**\n * Make a copy of this vector.\n * @return {Vec2} A new vector.\n */\nVec2.prototype.copy = function()\n{\n  return new Vec2().assign(this);\n};\n\n/**\n * Create a vector with a specific angle and magnitude.\n * @param {Number} theta\n * @param {Number=} m\n * @return {Vec2} A new vector.\n */\nVec2.fromAngle = function(theta, m)\n{\n  m = +m || 1.0;\n  return new Vec2(Math.cos(theta) * m, Math.sin(theta) * m);\n};\n\n/**\n * Create a pooled vector with a specific angle and magnitude.\n * @param {Number} theta\n * @param {Number} m\n * @return {Vec2} A new vector.\n */\nVec2.pfromAngle = function(theta, m)\n{\n  m = +m || 1.0;\n  return Vec2.aquire().set(\n    Math.cos(theta) * m,\n    Math.sin(theta) * m\n  );\n};\n\n/**\n * Determine if two rectangles, defined by a position and a halfwidth vector,\n * overlap.\n * @param {Vec2} p1 Position of rectangle 1\n * @param {Vec2} r1 Halfwidths of rectangle 1\n * @param {Vec2} p2 Position of rectangle 2\n * @param {Vec2} r2 Halfwidths of rectangle 2\n * @return {Boolean} True if they intersect\n */\nVec2.rectIntersect = function(p1, r1, p2, r2)\n{\n  // Basically, rectangles dont intersect if one's bottom is higher than ones\n  // top, ones left is more left than ones right, etc\n  var a = p1.x + r1.x < p2.x - r2.x;\n  var b = p1.x - r1.x > p2.x + r2.x;\n  var c = p1.y + r1.y < p2.y - r2.y;\n  var d = p1.y - r1.y > p2.y + r2.y;\n\n  // We want if they do\n  return !(a || b || c || d);\n};\n\n/**\n * Determines if rectangle 1 is entirely inside of rectangle 2.\n * @param {Vec2} p1 Position of rectangle 1\n * @param {Vec2} r1 Halfwidths of rectangle 1\n * @param {Vec2} p2 Position of rectangle 2\n * @param {Vec2} r2 Halfwidths of rectangle 2\n * @return {Boolean} True if they rectangle 1 is inside of rectangle 2\n */\nVec2.rectContains = function(p1, r1, p2, r2)\n{\n  if (p1.x - r1.x < p2.x - r2.x) return false;\n  if (p1.x + r1.x > p2.x + r2.x) return false;\n  if (p1.y - r1.y < p2.y - r2.y) return false;\n  if (p1.y + r1.y > p2.y + r2.y) return false;\n\n  return true;\n};\n\n/**\n * Convert a rectangle specified by top-left point + size into center location\n * + halfwidths.\n * @param {Vec2} position\n * @param {Vec2} size\n * @param {Vec2} out__position Output position\n * @param {Vec2} out__hwidth Output hwidths\n */\nVec2.sizeToHwidth = function(position, size, out__position, out__hwidth)\n{\n  out__hwidth.assign(size).smult(0.5);\n  out__position.assign(position).add(out__hwidth);\n};\n\n/**\n * Output this vector.\n */\nVec2.prototype.toString = function()\n{\n  return '' + (this.x.toFixed(2)) + ',' + (this.y.toFixed(2));\n};\n\n","module.exports = Entity;\n\n/**\n * Basic component-driven object with facade functions for interacting with the\n * injected EntityManager object.\n * @constructor\n */\nfunction Entity()\n{\n  // Injected by EntityManager\n  this._manager    = null;\n\n  /**\n   * @type {Array.<Function>}\n   * @private\n   */\n  this._Components = [];\n\n  /**\n   * @type {Array.<String>}\n   * @private\n   */\n  this._tags       = [];\n}\n\n/**\n * @param {Function} TComponent\n * @return {Entity} This entity.\n */\nEntity.prototype.addComponent = function(TComponent)\n{\n  this._manager.entityAddComponent(this, TComponent);\n  return this;\n};\n\n/**\n * @param {Function} TComponent\n * @return {Entity} This entity.\n */\nEntity.prototype.removeComponent = function(TComponent)\n{\n  this._manager.entityRemoveComponent(this, TComponent);\n  return this;\n};\n\n/**\n * @param {Function} TComponent\n * @return {boolean} True if this entity has TComponent.\n */\nEntity.prototype.hasComponent = function(TComponent)\n{\n  return !!~this._Components.indexOf(TComponent);\n};\n\n/**\n * @param {Array.<Function>} Components\n * @return {boolean} True if entity has all Components.\n */\nEntity.prototype.hasAllComponents = function(Components)\n{\n  var b = true;\n\n  for (var i = 0; i < Components.length; i++) {\n    var C = Components[i];\n    b &= !!~this._Components.indexOf(C);\n  }\n\n  return b;\n};\n\n/**\n * @param {String} tag\n * @return {boolean} True if entity has tag.\n */\nEntity.prototype.hasTag = function(tag)\n{\n  return !!~this._tags.indexOf(tag);\n};\n\n/**\n * @param {String} tag\n * @return {Entity} This entity.\n */\nEntity.prototype.addTag = function(tag)\n{\n  this._manager.entityAddTag(this, tag);\n  return this;\n};\n\n/**\n * @param {String} tag\n * @return {Entity} This entity.\n */\nEntity.prototype.removeTag = function(tag)\n{\n  this._manager.entityRemoveTag(this, tag);\n  return this;\n};\n\n/**\n * @return {void}\n */\nEntity.prototype.remove = function()\n{\n  return this._manager.removeEntity(this);\n};\n\n","module.exports = Event;\n\n/**\n * @constructor\n */\nfunction Event(name, callback)\n{\n  this._name     = name || 'name';\n  this._callback = callback || null;\n\n  // Additional filters\n  this._Components = [];\n}\n\n/**\n * @param {String} eventName\n * @param {{hasAllComponents:Function}} entity\n * @param {Object=} option\n * @return {Boolean} True if fired.\n */\nEvent.prototype.fire = function(eventName, entity, option)\n{\n  // Name check\n  if (eventName !== this._name)\n    return false;\n\n  // Component filters\n  var Comps = this._Components;\n  if (entity && entity.hasAllComponents && Comps.length) {\n    if (!entity || !entity.hasAllComponents(Comps))\n      return false;\n  }\n\n  // Made it\n  this._callback(entity, option);\n  return true;\n};\n\n/**\n * @param {Function} T\n * @return {Event} This object.\n */\nEvent.prototype.whereComponent = function(T)\n{\n  this._Components.push(T);\n};\n\n/**\n * @param {Array.<Function>} Components\n * @return {Event} This object.\n */\nEvent.prototype.whereComponents = function(Components)\n{\n  this._Components = this._Components.concat(Components);\n  return this;\n};\n\n","module.exports = {\n\n  'extends'      : require('./lib/extends.js'),\n  'mixin'        : require('./lib/mixin.js'),\n  'getArguments' : require('./lib/getArguments.js'),\n  'getName'      : require('./lib/getName.js')\n\n};\n\n\n","module.exports = getName;\n\nvar FUNCTION_NAME = /function\\s+([^\\s(]+)/;\n\n/**\n * Get the name of a function (e.g. constructor)\n * @param {Function} f\n * @return {String} The function name.\n */\nfunction getName(f)\n{\n  var name = '';\n\n  if (f instanceof Function) {\n    if (f.name) {\n      return f.name;\n    }\n\n    var match = f.toString().match(FUNCTION_NAME);\n\n    if (match) {\n      name = match[1];\n    }\n  } else if (f && f.constructor instanceof Function) {\n    name = getName(f.constructor);\n  }\n\n  return name;\n}\n","module.exports = getArguments;\n\nvar FUNCTION_ARGS = /^\\w*function[^\\(]*\\(([^\\)]+)/;\n\n/**\n * Get the parameter names of a function.\n * @param {Function} f A function.\n * @return {Array.<String>} An array of the argument names of a function.\n */\nfunction getArguments(f)\n{\n  var ret = [];\n  var args = f.toString().match(FUNCTION_ARGS);\n\n  if (args) {\n    args = args[1]\n      .replace(/[ ]*,[ ]*/, ',')\n      .split(',');\n    for (var n = 0; n < args.length; n++) {\n      var a = args[n].replace(/^\\s+|\\s+$/g, '');\n      if (a) ret.push(a);\n    }\n  }\n\n  return ret;\n}\n\n","module.exports = extends_;\n\n/**\n * The well documented, oft-used (Coffeescript, Typescript, ES6... etc) extends\n * pattern to get some sort of single-inheritance in Javascript.  Modify a\n * Child class to have inherited the static members via copying and link the\n * prototypes.\n * @param {Function} Child Child constructor function.\n * @param {Function} Parent Parent contrusctor function.\n * @return {Function} The Child constructor.\n */\nfunction extends_(Child, Parent)\n{\n  // Drop in statics\n  for (var key in Parent) {\n    if (!Child.hasOwnProperty(key) && Parent.hasOwnProperty(key)) {\n      Child[key] = Parent[key];\n    }\n  }\n\n  // Give static to access parent\n  Child.Super = Parent;\n\n  // Child's prototype property is an object with the parent's prototype\n  // property its [[prototype]] + constructor\n  if (Object.create instanceof Function) {\n    Child.prototype = Object.create(Parent.prototype, {\n      constructor: { value: Child }\n    });\n  } else {\n    // IE8 and below shim\n    var T = makeT(Child);\n    T.prototype = Parent.prototype;\n    Child.prototype = new T();\n  }\n\n  return Child;\n}\n\n/**\n * @param {Function} Child\n * @return {Function}\n */\nfunction makeT(Child)\n{\n  return function T() { this.constructor = Child; };\n}\n\n","module.exports = mixin_;\n\n/**\n * Add all own properties of mixin to the prototype property of class T\n * @param {Function} T Class we want to mix into.\n * @param {Function|Object} mixin Mixin we want to mixt\n */\nfunction mixin_(T, mixin)\n{\n  // If we're mixing in a class (constructor function), then first mix in all\n  // things hanging directly off the mixin as \"statics\", then switch the mixin\n  // ref to point to the prototype\n  if (mixin instanceof Function) {\n    for (var k in mixin) {\n      T[k] = mixin[k];\n    }\n    mixin = mixin.prototype;\n  }\n\n  // Dump everything on the mixin into the prototype of our class\n  for (var key in mixin) {\n    if (mixin.hasOwnProperty(key)) {\n      T.prototype[key] = mixin[key];\n    }\n  }\n}\n\n"]}